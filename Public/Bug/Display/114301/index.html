<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #114301 for Git-Repository: Git::Repository / System::Command modules</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #114301 for Git-Repository: Git::Repository / System::Command modules</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Git-Repository/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Git-Repository/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Git-Repository/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Git-Repository/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Git-Repository">Git-Repository CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">114301</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Git-Repository/Active/">Git-Repository</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
Lisa.Hansen [...] sas.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-233462-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-233463-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.320    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




build.log<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1674750/898762/build.log">
Wed Oct 05 05:52:42 2016 (15.7k) by Lisa.Hansen [...] sas.com
</a>
</font></li>
</ul>


test_stderr_buffer_full.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1636326/877101/test_stderr_buffer_full.txt">
Thu Jun 09 03:17:28 2016 (6.1k) by Lisa.Hansen [...] sas.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;10&nbsp;07:44:09&nbsp;2016</span>
    <span class="description">Lisa.Hansen [...] sas.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Git::Repository / System::Command modules</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 10 May 2016 13:43:41 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-git-repository [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Lisa Hansen &lt;Lisa.Hansen [...] sas.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I have been using your Git::Repository module for some time, with great success &#40;it was in fact the only Git module I could ever get working in Windows&#41;. Unfortunately I have run into a problem &#40;due to a stupid hook that I am not able to change&#41;, which I am not sure if it is related to System::Command or IPC::Run, but I am hoping that you can help me.

My apologies if this seems like a long story...

A couple of years ago, Git::Repository ran perfect on Windows 2003. When forced to upgrade to Windows 2008, we started having hangs, but only every 3 or 4 weeks and occasionally a few times over the period of a day or two and then nothing again for a few weeks. Basically the three pipes would be left open, and the script would hang, even if I forked the Git::Repository &#34;run&#34; command. I wrote this off as a problem with IPC::Run and I created a way to detect when a process was hanging and email me and then I manually killed the pipe to stderr, and the script continued as it should &#40;I usually got all of the output to stdout, and this was good enough&#41; or I could easily recover from that point and re-run our process. 

You have recently made great improvements and most of the hangs were resolved, but I found that on one of the repositories we use, there is a server side trigger that prints a diff when running git push, and if there were many files changed, IPC::Run would hang because the stderr pipe would receive too much data &#40;sometimes a change was several hundred files and therefore the output was huge&#41;. Since the output was coming from the server, using a --quiet for the git push command didn&#39;t work. But with your new changes, the hang was different and with the Git::Repository &#34;run&#34; command forked, my script could automatically detect when it was hanging and kill the command &#40;but then I didn&#39;t get any output from the command&#41; and then an automatic retry of the command would say everything was up to date, and no manual intervention was required. And since I could actually see what was happening, I also found a way to reproduce it and attempted to fix System::Command.

Unfortunately, I could not find a solution that I can submit to you for a fix, but I can tell you what I tried. Then, maybe you can fix it, or you can tell me if I need to open a bug against IPC::Run, if it isn&#39;t something you can fix &#40;or isn&#39;t something you want to fix because it isn&#39;t a problem with your module&#41;.

The first thing I tried was changing System::Command::Reaper.pm from:
    $out and $out-&gt;opened and $out-&gt;close || carp &#34;error closing stdout: $!&#34;;
    $err and $err-&gt;opened and $err-&gt;close || carp &#34;error closing stderr: $!&#34;;
To:
    $out and $out-&gt;opened and $out-&gt;flush and $out-&gt;close || carp &#34;error closing stdout: $!&#34;;
    $err and $err-&gt;opened and $err-&gt;flush and $err-&gt;close || carp &#34;error closing stderr: $!&#34;;

This at least gave me the output that System::Command had received, but the process didn&#39;t continue. I am passing this on, because I think that maybe this would still be a good idea to implement, because at least if someone encounters a similar error and kills the command, they might see some output.

Then I tried changing the stderr pipe to use a file instead, so, from:
        $pid = IPC::Run::start&#40;
            [@cmd],
            &#39;&lt;pipe&#39;  =&gt; $in,
            &#39;&gt;pipe&#39;  =&gt; $out,
            &#39;2&gt;pipe&#39; =&gt; $err,
        &#41;;
To:
        my &#40;$fh, $file&#41;;
        eval {
        &#40;$fh, $file&#41; = tempfile&#40;TEMPLATE =&gt; &#39;errXXXXX&#39;,
                                DIR =&gt; $ENV{TEMP},
                                SUFFIX =&gt; &#39;.txt&#39;,
                                UNLINK =&gt; 1&#41;;
        };
        if &#40;$@&#41; {
            croak &#34;error: Unable to open temp file to capture stderr: $@\n&#34;;
        } else {
            #this call passes stderr via a file
            $pid = IPC::Run::start&#40;
                debug    =&gt; 0,
                [@cmd],
                &#39;&lt;pipe&#39;  =&gt; $in,
                &#39;&gt;pipe&#39;  =&gt; $out,
                &#39;2&gt;&#39; =&gt; $file,
            &#41;;
            $err = \*$fh;
        }

But I found that the following no longer worked:
$cmd = $r-&gt;command&#40; &#39;checkout&#39;, $branch &#41;;
@errput = $cmd-&gt;stderr-&gt;getlines&#40;&#41;;

I, for the life of me, cannot figure out why getlines doesn&#39;t read from the file handle, but maybe you can figure that out.

Then I changed it to:
    my &#40;$fh, $file&#41;;
    eval {
    &#40;$fh, $file&#41; = tempfile&#40;TEMPLATE =&gt; &#39;errXXXXX&#39;,
                            DIR =&gt; $ENV{TEMP},
                            SUFFIX =&gt; &#39;.txt&#39;,
                            UNLINK =&gt; 1,
                            EXLOCK =&gt; 0
                            &#41;;
    };
    if &#40;$@&#41; {
        croak &#34;error: Unable to open temp file to capture stderr: $@\n&#34;;
    } else {
        #this call combines stderr with stdout
        $pid = IPC::Run::start&#40;
            debug    =&gt; 0,
            [@cmd],
            &#39;&lt;pipe&#39;  =&gt; $in,
            &#39;&gt;pipe&#39;  =&gt; $out,
            &#39;2&gt;&#38;1&#39;
        &#41;;
        $err = \*$fh; #using an empty temp file keeps the reaper for complaining that $err isn&#39;t open
    }

A surprise to me, but this doesn&#39;t hang. Of course it only works because all output goes to stdout and therefore this still doesn&#39;t work:
$cmd = $r-&gt;command&#40; &#39;checkout&#39;, $branch &#41;;
@errput = $cmd-&gt;stderr-&gt;getlines&#40;&#41;;

But to get what I need, I can just use the following command, and parse the output looking for fatal or error after running this:
@output = $r-&gt;run&#40; &#39;checkout&#39;, $branch &#41;;

Anyway, I hope this is useful and I hope you can help me and fix System::Command so it won&#39;t hang. If you need more information, please let me know.

Kind Regards,
Lisa
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;10&nbsp;07:52:02&nbsp;2016</span>
    <span class="description">book [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #114301] Git::Repository / System::Command modules</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 10 May 2016 13:51:38 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-git-repository [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Philippe Bruhat &#40;BooK&#41;&#34; &lt;book [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, May 09, 2016 at 09:52:44AM +0000, Lisa Hansen wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; I have been using your Git::Repository module for some time, with
&gt; great success &#40;it was in fact the only Git module I could ever get
&gt; working in Windows&#41;.
</div>
That&#39;s good to know, thanks for the information.

Maybe you could mention this in a review:
<span class="clickylink"><a target="new" rel="nofollow" href="http://cpanratings.perl.org/dist/Git-Repository">http://cpanratings.perl.org/dist/Git-Repository</a></span>

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; My apologies if this seems like a long story...
</div>
No worries. And thanks for the detailed report.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; You have recently made great improvements and most of the hangs were
&gt; resolved, but I found that on one of the repositories we use, there is
&gt; a server side trigger that prints a diff when running git push, and if
&gt; there were many files changed, IPC::Run would hang because the stderr pipe
&gt; would receive too much data &#40;sometimes a change was several hundred files
&gt; and therefore the output was huge&#41;.
</div>
I think the buffers are basically 4k, so anything bigger than that will
cause trouble.

Luckily, the latest version of System::Command &#40;1.117&#41; has a new method,
loop_on&#40;&#41;, that should help with this issue.
<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/pod/System::Command#loop_on">https://metacpan.org/pod/System::Command#loop_on</a></span>

I&#39;ll rewrite Git::Repository::Command&#39;s final_output&#40;&#41; method using
System::Command&#39;s loop_on&#40;&#41; and point you to a branch, so you can test it
before I actually release it.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; And since I could actually see what was happening, I also found a way
&gt; to reproduce it and attempted to fix System::Command.
</div>
I would be very interested in seeing how you reproduce the issue.
That would make a great addition to the Git::Repository or System::Command
test suite.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Anyway, I hope this is useful and I hope you can help me and fix
&gt; System::Command so it won&#39;t hang. If you need more information, please
&gt; let me know.
</div>
Yes, it is very useful. Many thanks for the detailed report and tentative
patches. This was the best bug reports I got &#40;to be better it would
have to include a test and a working patch, but I wouldn&#39;t be of much
use then ;-&#41;

-- 
 Philippe Bruhat &#40;BooK&#41;

 All of life is a series of trades. And the more you exchange, the less you
 have to show for it.             &#40;Moral from Groo The Wanderer #4 &#40;Pacific&#41;&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;10&nbsp;07:52:03&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;10&nbsp;07:55:12&nbsp;2016</span>
    <span class="description">Lisa.Hansen [...] sas.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #114301] Git::Repository / System::Command modules</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 10 May 2016 13:54:56 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-git-repository [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Lisa Hansen &lt;Lisa.Hansen [...] sas.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -----Original Message-----
&gt; From: Philippe Bruhat &#40;BooK&#41; [mailto:book@cpan.org]
&gt; Sent: 10. maj 2016 09:30
&gt; To: Lisa Hansen &lt;Lisa.Hansen@sas.com&gt;
&gt; Subject: Re: Git::Repository / System::Command modules
&gt; 
&gt; Maybe you could mention this in a review:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://cpanratings.perl.org/dist/Git-Repository">http://cpanratings.perl.org/dist/Git-Repository</a></span>
&gt; 
</div>
Done. 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think the buffers are basically 4k, so anything bigger than that will cause
&gt; trouble.
</div>
That is correct for stderr, at least. I never had stdout hang, even after I piped stderr to it.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Luckily, the latest version of System::Command &#40;1.117&#41; has a new method,
&gt; loop_on&#40;&#41;, that should help with this issue.
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/pod/System::Command#loop_on">https://metacpan.org/pod/System::Command#loop_on</a></span>
&gt; 
&gt; I&#39;ll rewrite Git::Repository::Command&#39;s final_output&#40;&#41; method using
&gt; System::Command&#39;s loop_on&#40;&#41; and point you to a branch, so you can test it
&gt; before I actually release it.
</div>
OK, I&#39;ve never tested a pre-release before, sounds cool.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; And since I could actually see what was happening, I also found a way
&gt; &gt; to reproduce it and attempted to fix System::Command.
</div>&gt; 
&gt; I would be very interested in seeing how you reproduce the issue.
&gt; That would make a great addition to the Git::Repository or
&gt; System::Command test suite.
</div>
This is what I did to reproduce it:
The repository has a server-side diff hook after the push &#40;ours runs &#34;git diff --name-status &lt;commit_id_old&gt; &lt;commit_id_new&gt;&#34;&#41;. 
1&#41; Created a test branch from the main branch using a commit id in the past where there were several hundred files &#40;&gt;300&#41; that differed from the current head. 
2&#41; Pushed this test branch to the server. 
3&#41; Merged the main branch &#40;head&#41; into my test branch.
4&#41; Pushed my test branch and it would generate a long diff that prints to stderr and the script would hang. &#40;this push was forked&#41;
5&#41; After 10 minutes of waiting on my forked child to complete, I would find the end process in my process tree and kill it &#40;it was ssh, so I also had to kill the git process in the process tree above it, and then the script would continue&#41;. If you decide to add a kill, in case of a hang, I used pslist to find the process in Windows, but maybe you can use the ps in cygwin with Windows Git in order to make it platform independent.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Yes, it is very useful. Many thanks for the detailed report and tentative
&gt; patches. This was the best bug reports I got &#40;to be better it would have to
&gt; include a test and a working patch, but I wouldn&#39;t be of much use then ;-&#41;
</div>
Maybe next time I&#39;ll do better ;-&#41; But that would require that I learn how to write a test :-O

Thanks for your fast response, you really made my day. :-&#41;

Lisa
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;02&nbsp;19:23:46&nbsp;2016</span>
    <span class="description">book [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue May 10 07:55:12 2016, Lisa.Hansen@sas.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; Luckily, the latest version of System::Command &#40;1.117&#41; has a new
&gt; &gt; method,
&gt; &gt; loop_on&#40;&#41;, that should help with this issue.
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/pod/System::Command#loop_on">https://metacpan.org/pod/System::Command#loop_on</a></span>
&gt; &gt;
&gt; &gt; I&#39;ll rewrite Git::Repository::Command&#39;s final_output&#40;&#41; method using
&gt; &gt; System::Command&#39;s loop_on&#40;&#41; and point you to a branch, so you can
&gt; &gt; test it
&gt; &gt; before I actually release it.
</div></div>
It turned out that the code in System-Command 1.117 was producing lost of warnings, so I fixed it and made a new release &#40;v1.118&#41;.

I&#39;ve finally pushed the fix for Git::Repository to Github, as commit aabbecbadba67af293bca3e2decef8664ae5b507 on the master branch.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; OK, I&#39;ve never tested a pre-release before, sounds cool.
</div>
Sorry for the delay. Let me know if that fixes your issue.

Regards,

-- BooK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;03&nbsp;08:26:36&nbsp;2016</span>
    <span class="description">Lisa.Hansen [...] sas.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #114301] Git::Repository / System::Command modules</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 3 Jun 2016 12:26:13 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Git-Repository [...] rt.cpan.org&#34; &lt;bug-Git-Repository [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Lisa Hansen &lt;Lisa.Hansen [...] sas.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi BooK,

Unfortunately this didn&#39;t do the trick. It still hangs.

Lisa

</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;03&nbsp;09:22:20&nbsp;2016</span>
    <span class="description">book [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #114301] Git::Repository / System::Command modules</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 3 Jun 2016 15:22:07 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Lisa Hansen via RT &lt;bug-Git-Repository [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Philippe Bruhat &#40;BooK&#41;&#34; &lt;book [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Jun 03, 2016 at 08:26:37AM -0400, Lisa Hansen via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Git-Repository
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=114301">https://rt.cpan.org/Ticket/Display.html?id=114301</a></span> &gt;
&gt; 
&gt; Unfortunately this didn&#39;t do the trick. It still hangs.
&gt; 
</div>
Thanks for the feedback. Do you think you could write a test script
that exposes the issue?

If it&#39;s easier for you, it can work with one of your repositories
&#40;just send my a bundle or tarball in private&#41;. I will anonymize it /
generate a similar one before publishing the code on CPAN, of course.

Regards,

-- 
 Philippe Bruhat &#40;BooK&#41;

 Even when the words are true, they may not speak the truth.
                                    &#40;Moral from Groo The Wanderer #70 &#40;Epic&#41;&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;06&nbsp;03:45:05&nbsp;2016</span>
    <span class="description">Lisa.Hansen [...] sas.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #114301] Git::Repository / System::Command modules</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 6 Jun 2016 07:44:47 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Git-Repository [...] rt.cpan.org&#34; &lt;bug-Git-Repository [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Lisa Hansen &lt;Lisa.Hansen [...] sas.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I will try writing a test script by making a dummy repository. How long it takes depends on how busy I am at work, so I can&#39;t guarantee when I can have it done.

Lisa

</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;06&nbsp;08:52:26&nbsp;2016</span>
    <span class="description">book [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #114301] Git::Repository / System::Command modules</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 6 Jun 2016 10:12:46 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Lisa Hansen via RT &lt;bug-Git-Repository [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Philippe Bruhat &#40;BooK&#41;&#34; &lt;book [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, Jun 06, 2016 at 03:45:06AM -0400, Lisa Hansen via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Git-Repository
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=114301">https://rt.cpan.org/Ticket/Display.html?id=114301</a></span> &gt;
&gt; 
&gt; I will try writing a test script by making a dummy repository. How long it takes depends on how busy I am at work, so I can&#39;t guarantee when I can have it done.
&gt; 
</div>
Don&#39;t worry about the delays. Once I have the test script, I can work on
finding where the issue is, fixing it, and making sure it&#39;s gone.

Many thanks for your help in improving this module!

-- 
 Philippe Bruhat &#40;BooK&#41;

 When you double-cross a friend, you triple-cross yourself.
                                     &#40;Moral from Groo The Wanderer #8 &#40;Epic&#41;&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;09&nbsp;03:17:28&nbsp;2016</span>
    <span class="description">Lisa.Hansen [...] sas.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #114301] Git::Repository / System::Command modules</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 9 Jun 2016 07:17:05 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Git-Repository [...] rt.cpan.org&#34; &lt;bug-Git-Repository [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Lisa Hansen &lt;Lisa.Hansen [...] sas.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I thought of a quick and dirty way to make my test script fail with most any repository. I started by choosing a random repository from GitHub and cloning it. Then, by creating a local pre-rebase hook &#40;and adjusting the hook to repeat the print of output until it is enough that the command hangs&#41;, setting my test branch to a past commit ID, and then rebasing from master, it will hang on the rebase.

I hope this is good enough.

The test script is attached &#40;as a txt file&#41;.

Thanks!
Lisa

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -----Original Message-----
&gt; From: Philippe Bruhat &#40;BooK&#41; via RT [mailto:bug-Git-Repository@rt.cpan.org]
&gt; Sent: 6. juni 2016 14:52
&gt; To: Lisa Hansen &lt;Lisa.Hansen@sas.com&gt;
&gt; Subject: Re: [rt.cpan.org #114301] Git::Repository / System::Command
&gt; modules
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=114301">https://rt.cpan.org/Ticket/Display.html?id=114301</a></span> &gt;
&gt; 
&gt; On Mon, Jun 06, 2016 at 03:45:06AM -0400, Lisa Hansen via RT wrote:
<div class="message-stanza open">&gt; &gt;        Queue: Git-Repository
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=114301">https://rt.cpan.org/Ticket/Display.html?id=114301</a></span> &gt;
&gt; &gt;
&gt; &gt; I will try writing a test script by making a dummy repository. How long it
</div>&gt; takes depends on how busy I am at work, so I can&#39;t guarantee when I can
&gt; have it done.
<div class="message-stanza open">&gt; &gt;
</div>&gt; 
&gt; Don&#39;t worry about the delays. Once I have the test script, I can work on
&gt; finding where the issue is, fixing it, and making sure it&#39;s gone.
&gt; 
&gt; Many thanks for your help in improving this module!
&gt; 
&gt; --
&gt;  Philippe Bruhat &#40;BooK&#41;
&gt; 
&gt;  When you double-cross a friend, you triple-cross yourself.
&gt;                                      &#40;Moral from Groo The Wanderer #8 &#40;Epic&#41;&#41;
</div>
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;13&nbsp;03:16:44&nbsp;2016</span>
    <span class="description">book [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jun 09 03:17:28 2016, Lisa.Hansen@sas.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I thought of a quick and dirty way to make my test script fail with
&gt; most any repository. I started by choosing a random repository from
&gt; GitHub and cloning it.
</div>
Awesome idea!

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Then, by creating a local pre-rebase hook &#40;and
&gt; adjusting the hook to repeat the print of output until it is enough
&gt; that the command hangs&#41;, setting my test branch to a past commit ID,
&gt; and then rebasing from master, it will hang on the rebase.
&gt; 
&gt; I hope this is good enough.
&gt; 
&gt; The test script is attached &#40;as a txt file&#41;.
</div>
Many thanks for the test, I&#39;ll use it to try to figure out what is happening and how to fix the issue.

-- BooK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;20&nbsp;03:50:34&nbsp;2016</span>
    <span class="description">CHOROBA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [rt.cpan.org #114301] Re: Git::Repository at CPAN PR Challenge</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 20 Jun 2016 09:50:20 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Git-Repository [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;E. Choroba&#34; &lt;choroba [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi BooK,

I&#39;m not able to reproduce the issue - I&#39;m on Linux. I changed the test script
to chmod the hook, but it doesn&#39;t hang, even if I enlarge its output 3000
times. It takes few seconds to finish, but that&#39;s it.

Google shows three possibly related issues:

1. &#34;Hang in git.Repo.clone_from&#40;&#41; [Inter-process Communication Problem]&#34;
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/gitpython-developers/GitPython/issues/72">https://github.com/gitpython-developers/GitPython/issues/72</a></span>

2. &#34;Push tags=True blocks on github&#34;
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/gitpython-developers/GitPython/issues/145">https://github.com/gitpython-developers/GitPython/issues/145</a></span>

3. &#34;stderr output from .NET apps causes shell hangs when cygwin is not running
in Windows console&#34;
<span class="clickylink"><a target="new" rel="nofollow" href="https://www.cygwin.com/ml/cygwin/2012-06/msg00128.html">https://www.cygwin.com/ml/cygwin/2012-06/msg00128.html</a></span>

Unfortunately, I&#39;m not sure whether I can get to a MSWin machine in the near
future to experiment further.

Cheers,

Ch.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;10&nbsp;04:25:26&nbsp;2016</span>
    <span class="description">Lisa.Hansen [...] sas.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #114301] Re: Git::Repository at CPAN PR Challenge</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 10 Aug 2016 08:25:06 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Git-Repository [...] rt.cpan.org&#34; &lt;bug-Git-Repository [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Lisa Hansen &lt;Lisa.Hansen [...] sas.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Can I suggest that you test with a windows 10 evaluation version in a VM on linux?

Lisa
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;05&nbsp;05:52:42&nbsp;2016</span>
    <span class="description">Lisa.Hansen [...] sas.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #114301] Git::Repository / System::Command modules</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 5 Oct 2016 09:52:23 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Git-Repository [...] rt.cpan.org&#34; &lt;bug-Git-Repository [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Lisa Hansen &lt;Lisa.Hansen [...] sas.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi BooK,

I tried to install Git-Repository-1.320  on Window Server, but it doesn&#39;t work. The tests start failing at t05 &#40;see attached build.log&#41;, and after forcing the install, git commands don&#39;t work, either. I have tried 2008 R2 Sp1 and 2012 R2, 1.319 works, but 1.320 fails. BTW, both versions work on Windows 7. I am assuming the changes are related to this, so I&#39;m adding the comment here. 

Lisa
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1674750/898762/build.log">Download build.log</a><br />
<span class="downloadcontenttype">application/octet-stream 15.7k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;14&nbsp;03:37:11&nbsp;2016</span>
    <span class="description">book [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

On Wed Oct 05 05:52:42 2016, Lisa.Hansen@sas.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; I tried to install Git-Repository-1.320  on Window Server, but it
&gt; doesn&#39;t work. The tests start failing at t05 &#40;see attached build.log&#41;,
&gt; and after forcing the install, git commands don&#39;t work, either. I have
&gt; tried 2008 R2 Sp1 and 2012 R2, 1.319 works, but 1.320 fails. BTW, both
&gt; versions work on Windows 7. I am assuming the changes are related to
&gt; this, so I&#39;m adding the comment here.
&gt; 
</div>
Have you checked if git itself works?

The log looks like every git command is failing, including `git --version`.

-- BooK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;14&nbsp;05:48:02&nbsp;2016</span>
    <span class="description">Lisa.Hansen [...] sas.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #114301] Git::Repository / System::Command modules</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 14 Oct 2016 09:47:42 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Git-Repository [...] rt.cpan.org&#34; &lt;bug-Git-Repository [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Lisa Hansen &lt;Lisa.Hansen [...] sas.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Yes, git works fine. 

I was using 1.319, with my script everything was working fine. I used cpanm to try to update, got the errors I sent, ran some of the failing tests manually from the command line &#40;e.g. &#34;perl .cpanm\work\1475657921.4176\Git-Repository-1.320\t\06-version.t&#34; no special environment setup so 1.319 was used&#41;. It went fine. Thought maybe that there was something weird with the build environment, since it could find git but couldn&#39;t even run &#34;git --version&#34; so forced the install of 1.320 anyway. Tested script, failed with fatal errors for every git command. Downgraded to 1.319 using cpanm, script is working again.

Lisa

</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;14&nbsp;09:24:36&nbsp;2016</span>
    <span class="description">book [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Oct 05 05:52:42 2016, Lisa.Hansen@sas.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; I tried to install Git-Repository-1.320  on Window Server, but it
&gt; doesn&#39;t work. The tests start failing at t05 &#40;see attached build.log&#41;,
&gt; and after forcing the install, git commands don&#39;t work, either. I have
&gt; tried 2008 R2 Sp1 and 2012 R2, 1.319 works, but 1.320 fails. BTW, both
&gt; versions work on Windows 7. I am assuming the changes are related to
&gt; this, so I&#39;m adding the comment here.
&gt; 
</div>
Luckily, the changes between v1.319 and v1.320 are quite small:
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/book/Git-Repository/compare/v1.319...v1.320">https://github.com/book/Git-Repository/compare/v1.319...v1.320</a></span>

Given this diff, I really think this issue is related to the change
in lib/Git/Repository/Command.pm, which depends on a more recent version
of System::Command.

See also:
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/book/Git-Repository/compare/v1.319...v1.320#diff-a580a87ff9da14b51504d149be8ecaffR23">https://github.com/book/Git-Repository/compare/v1.319...v1.320#diff-a580a87ff9da14b51504d149be8ecaffR23</a></span>

Which version of System::Command is installed on your system?

-- BooK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;16&nbsp;10:52:05&nbsp;2016</span>
    <span class="description">Lisa.Hansen [...] sas.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #114301] Git::Repository / System::Command modules</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 16 Oct 2016 14:51:45 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Git-Repository [...] rt.cpan.org&#34; &lt;bug-Git-Repository [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Lisa Hansen &lt;Lisa.Hansen [...] sas.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">They are all running 1.118, and I thought they were all running the same version of it, because I had patched it to keep our scripts from hanging, but apparently the Win7 PC didn&#39;t have my patch and that it why it worked &#40;and it doesn&#39;t run the Git scripts, I just try to keep all the modules we use up to date on it&#41;. I removed the patch on one of the servers and now 1.320 works in our script. I still have to test to see if it hangs, which I won&#39;t be able to get to in the next couple of weeks, but at least I have something to test with now.

Sorry about the false alarm!
Lisa
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;18&nbsp;09:15:15&nbsp;2016</span>
    <span class="description">Lisa.Hansen [...] sas.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #114301] Git::Repository / System::Command modules</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 18 Nov 2016 14:14:52 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Git-Repository [...] rt.cpan.org&#34; &lt;bug-Git-Repository [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Lisa Hansen &lt;Lisa.Hansen [...] sas.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have tested Git-Repository-1.320. This works, and I could not get the test script to hang, even with 10 times the data that would cause it to hang before &#40;I didn&#39;t test more&#41;. :-&#41; The problem is resolved.

Lisa
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;19&nbsp;21:10:45&nbsp;2016</span>
    <span class="description">book [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;19&nbsp;21:10:45&nbsp;2016</span>
    <span class="description">book [...] cpan.org -  Fixed in 1.320 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
