<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #69166 for XML-LibXML: </title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #69166 for XML-LibXML: </h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=XML-LibXML">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=XML-LibXML">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=XML-LibXML">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=XML-LibXML">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/XML-LibXML">XML-LibXML CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">69166</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=XML-LibXML">XML-LibXML</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
SAMSK [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-37350-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-37351-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




perl-XML LibXML+global_entity_loader-0.2.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/950640/494373/perl-XML%20LibXML%2Bglobal_entity_loader-0.2.diff">
Tue Jun 28 16:25:05 2011 (5k) by SAMSK [...] cpan.org
</a>
</font></li>
</ul>


perl-XML LibXML+global_entity_loader-0.4.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/951390/494826/perl-XML%20LibXML%2Bglobal_entity_loader-0.4.diff">
Thu Jun 30 14:56:02 2011 (5.7k) by SAMSK [...] cpan.org
</a>
</font></li>
</ul>


perl-XML__LibXML+global_entity_loader-0.3.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/950917/494545/perl-XML__LibXML%2Bglobal_entity_loader-0.3.diff">
Wed Jun 29 09:36:01 2011 (6.4k) by SAMSK [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=69166">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-950640" href="/Public/Bug/Display.html?id=69166#txn-950640">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;28&nbsp;16:25:05&nbsp;2011</span>
    <span class="description">SAMSK [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/950640/494372/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/494372">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 387b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have a simple patch adding function XML::LibXML::externalEntityLoader
for setting a global entity loader handler for whole app.

Unlike existing functionality &#40;ext_ent_handler parser option&#41;, this
entity loader handler works also for libXSLT processing &#40;in
import,include and document&#40;&#41;&#41; and others libraries using
xml*ExternalEntityLoader&#40;&#41; functions for processing external entities.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> perl-XML LibXML+global_entity_loader-0.2.diff</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/950640/494373/perl-XML%20LibXML%2Bglobal_entity_loader-0.2.diff">Download perl-XML LibXML+global_entity_loader-0.2.diff</a><br />
<span class="downloadcontenttype">text/x-diff 5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -ur XML-LibXML-1.75/LibXML.pm XML-LibXML-1.75-new/LibXML.pm
--- XML-LibXML-1.75/LibXML.pm	2011-06-24 18:56:47.000000000 +0200
+++ XML-LibXML-1.75-new/LibXML.pm	2011-06-28 21:47:58.000000000 +0200
@@ -443,6 +443,12 @@
 # callback functions                                                      #
 #-------------------------------------------------------------------------#
 
+use Data::Dumper;
+sub externalEntityLoader&#40;&#38;&#41;
+{
+	return _externalEntityLoader&#40;$_[0]&#41;;
+}
+
 sub input_callbacks {
     my $self     = shift;
     my $icbclass = shift;
diff -ur XML-LibXML-1.75/LibXML.xs XML-LibXML-1.75-new/LibXML.xs
--- XML-LibXML-1.75/LibXML.xs	2011-06-24 18:38:46.000000000 +0200
+++ XML-LibXML-1.75-new/LibXML.xs	2011-06-28 21:47:58.000000000 +0200
@@ -146,6 +146,9 @@
 /* this should keep the default */
 static xmlExternalEntityLoader LibXML_old_ext_ent_loader = NULL;
 
+/* global external entity loader */
+SV *EXTERNAL_ENTITY_LOADER_FUNC = &#40;SV *&#41;NULL;
+
 SV* PROXY_NODE_REGISTRY_MUTEX = NULL;
 
 /* ****************************************************************
@@ -778,8 +781,7 @@
         const char * ID,
         xmlParserCtxtPtr ctxt&#41;
 {
-    SV * self;
-    HV * real_obj;
+
     SV ** func;
     int count;
     SV * results;
@@ -787,7 +789,8 @@
     const char * results_pv;
     xmlParserInputBufferPtr input_buf;
 
-    if &#40;ctxt-&gt;_private == NULL&#41; {
+    if &#40;ctxt-&gt;_private == NULL
+    	&#38;&#38; EXTERNAL_ENTITY_LOADER_FUNC == NULL&#41; {
         return xmlNewInputFromFile&#40;ctxt, URL&#41;;
     }
 
@@ -798,11 +801,22 @@
         ID = &#34;&#34;;
     }
 
-    self = &#40;SV *&#41;ctxt-&gt;_private;
-    real_obj = &#40;HV *&#41;SvRV&#40;self&#41;;
-    func = hv_fetch&#40;real_obj, &#34;ext_ent_handler&#34;, 15, 0&#41;;
+    /* fetch entity loader function */
+    if&#40;EXTERNAL_ENTITY_LOADER_FUNC != NULL&#41;
+    {
+    	func = &#38;EXTERNAL_ENTITY_LOADER_FUNC;
+    }
+    else
+    {
+        SV * self;
+	HV * real_obj;
+    
+	self = &#40;SV *&#41;ctxt-&gt;_private;
+	real_obj = &#40;HV *&#41;SvRV&#40;self&#41;;
+	func = hv_fetch&#40;real_obj, &#34;ext_ent_handler&#34;, 15, 0&#41;;
+    }
 
-    if &#40;func != NULL  &#38;&#38; SvTRUE&#40;*func&#41;&#41; {
+    if &#40;func != NULL &#38;&#38; SvTRUE&#40;*func&#41;&#41; {
         dTHX;
         dSP;
 
@@ -899,18 +913,21 @@
             if &#40;ctxt&#41; ctxt-&gt;linenumbers = 0;
         }
 
-        item = hv_fetch&#40;real_obj, &#34;ext_ent_handler&#34;, 15, 0&#41;;
-        if &#40; item != NULL  &#38;&#38; SvTRUE&#40;*item&#41;&#41; {
-            LibXML_old_ext_ent_loader =  xmlGetExternalEntityLoader&#40;&#41;;
-            xmlSetExternalEntityLoader&#40; &#40;xmlExternalEntityLoader&#41;LibXML_load_external_entity &#41;;
-        }
-        else {
-            if &#40;parserOptions &#38; XML_PARSE_NONET&#41; {
-                LibXML_old_ext_ent_loader =  xmlGetExternalEntityLoader&#40;&#41;;
-                xmlSetExternalEntityLoader&#40; xmlNoNetExternalEntityLoader &#41;;
-            }
-            /* LibXML_old_ext_ent_loader =  NULL; */
-        }
+	if&#40;LibXML_old_ext_ent_loader == NULL&#41;
+	{
+	        item = hv_fetch&#40;real_obj, &#34;ext_ent_handler&#34;, 15, 0&#41;;
+	        if &#40;item != NULL  &#38;&#38; SvTRUE&#40;*item&#41;&#41; {
+	            LibXML_old_ext_ent_loader =  xmlGetExternalEntityLoader&#40;&#41;;
+	            xmlSetExternalEntityLoader&#40; &#40;xmlExternalEntityLoader&#41;LibXML_load_external_entity &#41;;
+	        }
+	        else {
+	            if &#40;parserOptions &#38; XML_PARSE_NONET&#41; {
+	                LibXML_old_ext_ent_loader =  xmlGetExternalEntityLoader&#40;&#41;;
+	                xmlSetExternalEntityLoader&#40; xmlNoNetExternalEntityLoader &#41;;
+	            }
+	            /* LibXML_old_ext_ent_loader =  NULL; */
+	        }
+	}
     }
 
     return real_obj;
@@ -921,7 +938,8 @@
 #ifndef WITH_SERRORS
     xmlGetWarningsDefaultValue = 0;
 #endif
-    if &#40;LibXML_old_ext_ent_loader != NULL &#41; {
+    if &#40;EXTERNAL_ENTITY_LOADER_FUNC == NULL
+    		&#38;&#38; LibXML_old_ext_ent_loader != NULL&#41; {
         xmlSetExternalEntityLoader&#40; &#40;xmlExternalEntityLoader&#41;LibXML_old_ext_ent_loader &#41;;
     }
 }
@@ -2642,6 +2660,27 @@
     OUTPUT:
         RETVAL
 
+SV*
+_externalEntityLoader&#40; loader &#41;
+	SV* loader
+    CODE:
+	{
+		RETVAL = EXTERNAL_ENTITY_LOADER_FUNC;
+		if&#40;EXTERNAL_ENTITY_LOADER_FUNC == NULL&#41;
+			EXTERNAL_ENTITY_LOADER_FUNC = newSVsv&#40;loader&#41;;
+/*
+		else
+			SvSetSv&#40;EXTERNAL_ENTITY_LOADER_FUNC, loader&#41;;
+*/
+		
+		if &#40;LibXML_old_ext_ent_loader == NULL &#41; {
+			LibXML_old_ext_ent_loader = xmlGetExternalEntityLoader&#40;&#41;;
+			xmlSetExternalEntityLoader&#40;&#40;xmlExternalEntityLoader&#41;LibXML_load_external_entity&#41;;
+		}
+	}
+    OUTPUT:
+    	RETVAL
+
 MODULE = XML::LibXML         PACKAGE = XML::LibXML::HashTable
 
 xmlHashTablePtr
@@ -9401,4 +9440,3 @@
 #endif
     OUTPUT:
         RETVAL
-
diff -ur XML-LibXML-1.75/lib/XML/LibXML/Parser.pod XML-LibXML-1.75-new/lib/XML/LibXML/Parser.pod
--- XML-LibXML-1.75/lib/XML/LibXML/Parser.pod	2011-06-24 18:57:22.000000000 +0200
+++ XML-LibXML-1.75-new/lib/XML/LibXML/Parser.pod	2011-06-28 22:15:57.000000000 +0200
@@ -71,6 +71,11 @@
                       
   $parser-&gt;load_catalog&#40; $catalog_file &#41;;
 
+  # Global external entity loader &#40;similar to ext_ent_handler option
+  #	but this works really globally, also in XML::LibXSLT include etc..&#41;
+  
+  XML::LibXML::externalEntityLoader&#40;&#38;my_loader&#41;;
+
 =head1 PARSING
 
 A XML document is read into a data structure such as a DOM tree by a piece of
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-950848" href="/Public/Bug/Display.html?id=69166#txn-950848">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;29&nbsp;06:47:40&nbsp;2011</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/950848/494502/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/494502">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 984b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi SAMSK,

On Tue Jun 28 16:25:05 2011, SAMSK wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have a simple patch adding function XML::LibXML::externalEntityLoader
&gt; for setting a global entity loader handler for whole app.
&gt; 
&gt; Unlike existing functionality &#40;ext_ent_handler parser option&#41;, this
&gt; entity loader handler works also for libXSLT processing &#40;in
&gt; import,include and document&#40;&#41;&#41; and others libraries using
&gt; xml*ExternalEntityLoader&#40;&#41; functions for processing external entities.
</div>
Thanks for your patch, but it has several issues:

1. It does not contain a test script in t/*.t &#40;should be written using
Test::More and with Test::Count annotations&#41;.

2. It violates some of the style guidelines in the HACKING.txt file
&#40;which admittedly I just added&#41;:

<span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/shlomif/perl-xml-libxml/src/f51ee01afca7/HACKING.txt">https://bitbucket.org/shlomif/perl-xml-libxml/src/f51ee01afca7/HACKING.txt</a></span>

* Tabs instead of spaces for indentation.

* Single-statement conditional/loop clauses.

------------

Please correct these issues and then we can proceed.

Regards,

-- Shlomi Fish
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-950851" href="/Public/Bug/Display.html?id=69166#txn-950851">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;29&nbsp;06:47:42&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-950917" href="/Public/Bug/Display.html?id=69166#txn-950917">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;29&nbsp;09:36:01&nbsp;2011</span>
    <span class="description">SAMSK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/950917/494544/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/494544">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 746b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

   i&#39;ve added test 49 and changed formating to conform new guidelines.
   Patch attached - hope its better now ;&#41;

  Sam

On Wed Jun 29 06:47:40 2011, SHLOMIF wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Thanks for your patch, but it has several issues:
&gt; 
&gt; 1. It does not contain a test script in t/*.t &#40;should be written using
&gt; Test::More and with Test::Count annotations&#41;.
&gt; 
&gt; 2. It violates some of the style guidelines in the HACKING.txt file
&gt; &#40;which admittedly I just added&#41;:
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/shlomif/perl-xml-libxml/src/f51ee01afca7/HACKING.txt">https://bitbucket.org/shlomif/perl-xml-libxml/src/f51ee01afca7/HACKING.txt</a></span>
&gt; 
&gt; * Tabs instead of spaces for indentation.
&gt; 
&gt; * Single-statement conditional/loop clauses.
&gt; 
&gt; ------------
&gt; 
&gt; Please correct these issues and then we can proceed.
&gt; 
&gt; Regards,
&gt; 
&gt; -- Shlomi Fish
</div></div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> perl-XML__LibXML+global_entity_loader-0.3.diff</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/950917/494545/perl-XML__LibXML%2Bglobal_entity_loader-0.3.diff">Download perl-XML__LibXML+global_entity_loader-0.3.diff</a><br />
<span class="downloadcontenttype">text/x-diff 6.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -urN XML-LibXML-1.75/LibXML.pm XML-LibXML-1.75-new/LibXML.pm
--- XML-LibXML-1.75/LibXML.pm	2011-06-24 18:56:47.000000000 +0200
+++ XML-LibXML-1.75-new/LibXML.pm	2011-06-29 14:42:27.000000000 +0200
@@ -443,6 +443,12 @@
 # callback functions                                                      #
 #-------------------------------------------------------------------------#
 
+use Data::Dumper;
+sub externalEntityLoader&#40;&#38;&#41;
+{
+     return _externalEntityLoader&#40;$_[0]&#41;;
+}
+
 sub input_callbacks {
     my $self     = shift;
     my $icbclass = shift;
diff -urN XML-LibXML-1.75/LibXML.xs XML-LibXML-1.75-new/LibXML.xs
--- XML-LibXML-1.75/LibXML.xs	2011-06-24 18:38:46.000000000 +0200
+++ XML-LibXML-1.75-new/LibXML.xs	2011-06-29 15:05:55.000000000 +0200
@@ -146,6 +146,9 @@
 /* this should keep the default */
 static xmlExternalEntityLoader LibXML_old_ext_ent_loader = NULL;
 
+/* global external entity loader */
+SV *EXTERNAL_ENTITY_LOADER_FUNC = &#40;SV *&#41;NULL;
+
 SV* PROXY_NODE_REGISTRY_MUTEX = NULL;
 
 /* ****************************************************************
@@ -778,8 +781,7 @@
         const char * ID,
         xmlParserCtxtPtr ctxt&#41;
 {
-    SV * self;
-    HV * real_obj;
+
     SV ** func;
     int count;
     SV * results;
@@ -787,7 +789,8 @@
     const char * results_pv;
     xmlParserInputBufferPtr input_buf;
 
-    if &#40;ctxt-&gt;_private == NULL&#41; {
+    if &#40;ctxt-&gt;_private == NULL &#38;&#38; EXTERNAL_ENTITY_LOADER_FUNC == NULL&#41; 
+    {
         return xmlNewInputFromFile&#40;ctxt, URL&#41;;
     }
 
@@ -798,11 +801,22 @@
         ID = &#34;&#34;;
     }
 
-    self = &#40;SV *&#41;ctxt-&gt;_private;
-    real_obj = &#40;HV *&#41;SvRV&#40;self&#41;;
-    func = hv_fetch&#40;real_obj, &#34;ext_ent_handler&#34;, 15, 0&#41;;
+    /* fetch entity loader function */
+    if&#40;EXTERNAL_ENTITY_LOADER_FUNC != NULL&#41;
+    {
+       func = &#38;EXTERNAL_ENTITY_LOADER_FUNC;
+    }
+    else
+    {
+       SV * self;
+       HV * real_obj;
+
+       self = &#40;SV *&#41;ctxt-&gt;_private;
+       real_obj = &#40;HV *&#41;SvRV&#40;self&#41;;
+       func = hv_fetch&#40;real_obj, &#34;ext_ent_handler&#34;, 15, 0&#41;;
+    }
 
-    if &#40;func != NULL  &#38;&#38; SvTRUE&#40;*func&#41;&#41; {
+    if &#40;func != NULL &#38;&#38; SvTRUE&#40;*func&#41;&#41; {
         dTHX;
         dSP;
 
@@ -899,18 +913,23 @@
             if &#40;ctxt&#41; ctxt-&gt;linenumbers = 0;
         }
 
-        item = hv_fetch&#40;real_obj, &#34;ext_ent_handler&#34;, 15, 0&#41;;
-        if &#40; item != NULL  &#38;&#38; SvTRUE&#40;*item&#41;&#41; {
-            LibXML_old_ext_ent_loader =  xmlGetExternalEntityLoader&#40;&#41;;
-            xmlSetExternalEntityLoader&#40; &#40;xmlExternalEntityLoader&#41;LibXML_load_external_entity &#41;;
-        }
-        else {
-            if &#40;parserOptions &#38; XML_PARSE_NONET&#41; {
+       if&#40;LibXML_old_ext_ent_loader == NULL&#41;
+       {
+            item = hv_fetch&#40;real_obj, &#34;ext_ent_handler&#34;, 15, 0&#41;;
+            if &#40;item != NULL  &#38;&#38; SvTRUE&#40;*item&#41;&#41; {
                 LibXML_old_ext_ent_loader =  xmlGetExternalEntityLoader&#40;&#41;;
-                xmlSetExternalEntityLoader&#40; xmlNoNetExternalEntityLoader &#41;;
+                xmlSetExternalEntityLoader&#40; &#40;xmlExternalEntityLoader&#41;LibXML_load_external_entity &#41;;
             }
-            /* LibXML_old_ext_ent_loader =  NULL; */
-        }
+            else 
+             {
+                if &#40;parserOptions &#38; XML_PARSE_NONET&#41;
+                {
+                    LibXML_old_ext_ent_loader = xmlGetExternalEntityLoader&#40;&#41;;
+                    xmlSetExternalEntityLoader&#40; xmlNoNetExternalEntityLoader &#41;;
+                }
+                /* LibXML_old_ext_ent_loader =  NULL; */
+            }
+       }
     }
 
     return real_obj;
@@ -921,7 +940,8 @@
 #ifndef WITH_SERRORS
     xmlGetWarningsDefaultValue = 0;
 #endif
-    if &#40;LibXML_old_ext_ent_loader != NULL &#41; {
+    if &#40;EXTERNAL_ENTITY_LOADER_FUNC == NULL &#38;&#38; LibXML_old_ext_ent_loader != NULL&#41;
+    {
         xmlSetExternalEntityLoader&#40; &#40;xmlExternalEntityLoader&#41;LibXML_old_ext_ent_loader &#41;;
     }
 }
@@ -2642,6 +2662,26 @@
     OUTPUT:
         RETVAL
 
+SV*
+_externalEntityLoader&#40; loader &#41;
+        SV* loader
+    CODE:
+        {
+            RETVAL = EXTERNAL_ENTITY_LOADER_FUNC;
+            if&#40;EXTERNAL_ENTITY_LOADER_FUNC == NULL&#41;
+            {
+                EXTERNAL_ENTITY_LOADER_FUNC = newSVsv&#40;loader&#41;;
+            }
+
+            if &#40;LibXML_old_ext_ent_loader == NULL &#41;
+            {
+                LibXML_old_ext_ent_loader = xmlGetExternalEntityLoader&#40;&#41;;
+                xmlSetExternalEntityLoader&#40;&#40;xmlExternalEntityLoader&#41;LibXML_load_external_entity&#41;;
+            }
+        }
+    OUTPUT:
+        RETVAL
+
 MODULE = XML::LibXML         PACKAGE = XML::LibXML::HashTable
 
 xmlHashTablePtr
@@ -9401,4 +9441,3 @@
 #endif
     OUTPUT:
         RETVAL
-
diff -urN XML-LibXML-1.75/lib/XML/LibXML/Parser.pod XML-LibXML-1.75-new/lib/XML/LibXML/Parser.pod
--- XML-LibXML-1.75/lib/XML/LibXML/Parser.pod	2011-06-24 18:57:22.000000000 +0200
+++ XML-LibXML-1.75-new/lib/XML/LibXML/Parser.pod	2011-06-29 15:18:26.000000000 +0200
@@ -71,6 +71,11 @@
                       
   $parser-&gt;load_catalog&#40; $catalog_file &#41;;
 
+  # Global external entity loader &#40;similar to ext_ent_handler option
+  #	but this works really globally, also in XML::LibXSLT include etc..&#41;
+  
+  XML::LibXML::externalEntityLoader&#40;\&#38;my_loader&#41;;
+
 =head1 PARSING
 
 A XML document is read into a data structure such as a DOM tree by a piece of
diff -urN XML-LibXML-1.75/t/49global_extent.t XML-LibXML-1.75-new/t/49global_extent.t
--- XML-LibXML-1.75/t/49global_extent.t	1970-01-01 01:00:00.000000000 +0100
+++ XML-LibXML-1.75-new/t/49global_extent.t	2011-06-29 15:26:01.000000000 +0200
@@ -0,0 +1,51 @@
+# Test file created outside of h2xs framework.
+# Run this like so: `perl 49global_extent.t&#39;
+#   samuel&#40;_dot_&#41;behan&#40;-at-&#41;dob&#40;_dot_&#41;sk     2011/06/29 15:18:43
+
+#########################
+
+# change &#39;tests =&gt; 1&#39; to &#39;tests =&gt; last_test_to_print&#39;;
+
+use Test::More tests =&gt; 1;
+
+use warnings;
+use strict;
+use XML::LibXML;
+$|=1;
+
+if &#40;20627 &gt; XML::LibXML::LIBXML_VERSION&#41; {
+    skip&#40;&#34;skipping for libxml2 &lt; 2.6.27&#34;&#41; for 1..7;
+} else {
+
+# global entity loader
+XML::LibXML::externalEntityLoader&#40;\&#38;handler&#41;;
+
+my $parser = XML::LibXML-&gt;new&#40;{
+  expand_entities =&gt; 1,
+}&#41;;
+
+sub handler {
+  return &#34;ENTITY:&#34; . join&#40;&#34;,&#34;,@_&#41;;
+}
+
+my $xml = &lt;&lt;&#39;EOF&#39;;
+&lt;?xml version=&#34;1.0&#34;?&gt;
+&lt;!DOCTYPE foo [
+&lt;!ENTITY a PUBLIC &#34;//foo/bar/b&#34; &#34;file:/dev/null&#34;&gt;
+&lt;!ENTITY b SYSTEM &#34;file:///dev/null&#34;&gt;
+]&gt;
+&lt;root&gt;
+  &lt;a&gt;&#38;a;&lt;/a&gt;
+  &lt;b&gt;&#38;b;&lt;/b&gt;
+&lt;/root&gt;
+EOF
+my $xml_out = $xml;
+$xml_out =~ s{&#38;a;}{ENTITY:file:/dev/null,//foo/bar/b};
+$xml_out =~ s{&#38;b;}{ENTITY:file:///dev/null,};
+
+my $doc = $parser-&gt;parse_string&#40;$xml&#41;;
+
+# TEST
+ok&#40; $doc-&gt;toString&#40;&#41; eq $xml_out &#41;;
+
+}
\ No newline at end of file
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-951158" href="/Public/Bug/Display.html?id=69166#txn-951158">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;29&nbsp;18:55:26&nbsp;2011</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/951158/494686/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/494686">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1005b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Sam,

On Wed Jun 29 09:36:01 2011, SAMSK wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt; 
&gt;    i&#39;ve added test 49 and changed formating to conform new guidelines.
&gt;    Patch attached - hope its better now ;&#41;
&gt; 
</div>
Thanks for the quick response. I&#39;ll take a look at what you&#39;ve written
later. Now it&#39;s too late as it&#39;s 2 AM here.

Regards,

-- Shlomi Fish 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;   Sam
&gt; 
&gt; On Wed Jun 29 06:47:40 2011, SHLOMIF wrote:
<div class="message-stanza open">&gt; &gt; 
&gt; &gt; Thanks for your patch, but it has several issues:
&gt; &gt; 
&gt; &gt; 1. It does not contain a test script in t/*.t &#40;should be written using
&gt; &gt; Test::More and with Test::Count annotations&#41;.
&gt; &gt; 
&gt; &gt; 2. It violates some of the style guidelines in the HACKING.txt file
&gt; &gt; &#40;which admittedly I just added&#41;:
&gt; &gt; 
&gt; &gt;
</div></div><span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/shlomif/perl-xml-libxml/src/f51ee01afca7/HACKING.txt">https://bitbucket.org/shlomif/perl-xml-libxml/src/f51ee01afca7/HACKING.txt</a></span>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; 
&gt; &gt; * Tabs instead of spaces for indentation.
&gt; &gt; 
&gt; &gt; * Single-statement conditional/loop clauses.
&gt; &gt; 
&gt; &gt; ------------
&gt; &gt; 
&gt; &gt; Please correct these issues and then we can proceed.
&gt; &gt; 
&gt; &gt; Regards,
&gt; &gt; 
&gt; &gt; -- Shlomi Fish
</div>&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-951369" href="/Public/Bug/Display.html?id=69166#txn-951369">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;30&nbsp;13:11:56&nbsp;2011</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Global external entity handler.</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/951369/494814/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/494814">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jun 29 09:36:01 2011, SAMSK wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt; 
&gt;    i&#39;ve added test 49 and changed formating to conform new guidelines.
&gt;    Patch attached - hope its better now ;&#41;
&gt; 
&gt;   Sam
&gt; 
&gt; On Wed Jun 29 06:47:40 2011, SHLOMIF wrote:
<div class="message-stanza open">&gt; &gt; 
&gt; &gt; Thanks for your patch, but it has several issues:
&gt; &gt; 
&gt; &gt; 1. It does not contain a test script in t/*.t &#40;should be written using
&gt; &gt; Test::More and with Test::Count annotations&#41;.
&gt; &gt; 
&gt; &gt; 2. It violates some of the style guidelines in the HACKING.txt file
&gt; &gt; &#40;which admittedly I just added&#41;:
&gt; &gt; 
&gt; &gt;
</div></div><span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/shlomif/perl-xml-libxml/src/f51ee01afca7/HACKING.txt">https://bitbucket.org/shlomif/perl-xml-libxml/src/f51ee01afca7/HACKING.txt</a></span>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; 
&gt; &gt; * Tabs instead of spaces for indentation.
&gt; &gt; 
&gt; &gt; * Single-statement conditional/loop clauses.
&gt; &gt; 
&gt; &gt; ------------
&gt; &gt; 
&gt; &gt; Please correct these issues and then we can proceed.
&gt; &gt; 
&gt; &gt; Regards,
&gt; &gt; 
&gt; &gt; -- Shlomi Fish
</div>&gt; 
</div>
Hi Sam,

Thanks for your patch. Here are the remaining issues with it:

[QUOTE]
diff -urN XML-LibXML-1.75/LibXML.pm XML-LibXML-1.75-new/LibXML.pm
--- XML-LibXML-1.75/LibXML.pm   2011-06-24 18:56:47.000000000 +0200
+++ XML-LibXML-1.75-new/LibXML.pm       2011-06-29 14:42:27.000000000 +0200
@@ -443,6 +443,12 @@
 # callback functions                                                      #
 #-------------------------------------------------------------------------#
 
+use Data::Dumper;
+sub externalEntityLoader&#40;&#38;&#41;
+{
+     return _externalEntityLoader&#40;$_[0]&#41;;
+}
+
[/QUOTE]

1. Why do you need to load Data::Dumper?

2. You have a 5 space indent instead of a 4-space indent.

[QUOTE]
SV *EXTERNAL_ENTITY_LOADER_FUNC = &#40;SV *&#41;NULL;
[/QUOTE]

1. Why should the name be in ALL-CAPS?

2. Should it be a global or should it belong to the parser instance?

[QUOTE]
-    SV * self;
-    HV * real_obj;
+
[/QUOTE]

You have a maverick empty line here.

You also have some lines with trailing space.

[QUOTE]
diff -urN XML-LibXML-1.75/lib/XML/LibXML/Parser.pod
XML-LibXML-1.75-new/lib/XML/LibXML/Parser.pod
--- XML-LibXML-1.75/lib/XML/LibXML/Parser.pod   2011-06-24
18:57:22.000000000 +0200
+++ XML-LibXML-1.75-new/lib/XML/LibXML/Parser.pod       2011-06-29
15:18:26.000000000 +0200
@@ -71,6 +71,11 @@
                       
   $parser-&gt;load_catalog&#40; $catalog_file &#41;;
 
+  # Global external entity loader &#40;similar to ext_ent_handler option
+  #    but this works really globally, also in XML::LibXSLT include etc..&#41;
+  
+  XML::LibXML::externalEntityLoader&#40;\&#38;my_loader&#41;;
+
[/QUOTE]

Don&#39;t patch Parser.pod directly - instead patch docs/libxml.dbk . You
also have a tab character there.

[QUOTE]
diff -urN XML-LibXML-1.75/t/49global_extent.t
XML-LibXML-1.75-new/t/49global_extent.t
--- XML-LibXML-1.75/t/49global_extent.t 1970-01-01 01:00:00.000000000 +0100
+++ XML-LibXML-1.75-new/t/49global_extent.t     2011-06-29
15:26:01.000000000 +0200
@@ -0,0 +1,51 @@
+# Test file created outside of h2xs framework.
+# Run this like so: `perl 49global_extent.t&#39;
+#   samuel&#40;_dot_&#41;behan&#40;-at-&#41;dob&#40;_dot_&#41;sk     2011/06/29 15:18:43
+
[/QUOTE]

No need for this comment. Well, you can keep your name there and maybe a
copyright blurb. You can look at
<span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/shlomif/perl-xml-libxml/src/5b6ce7779709/t/49_load_html.t">https://bitbucket.org/shlomif/perl-xml-libxml/src/5b6ce7779709/t/49_load_html.t</a></span>
for how to put it under the MIT/X11 licence. 


[QUOTE]
+#########################
+
+# change &#39;tests =&gt; 1&#39; to &#39;tests =&gt; last_test_to_print&#39;;
+
+use Test::More tests =&gt; 1;
+
+use warnings;
+use strict;
[/QUOTE]

Put the strict/warnings before the use Test::More.

[QUOTE]
+use XML::LibXML;
+$|=1;
[/QUOTE]

use IO::Handle-&gt;autoflush&#40;1&#41; instead &#40;if you really need it.&#41;.

[QUOTE]
+
+if &#40;20627 &gt; XML::LibXML::LIBXML_VERSION&#41; {
+    skip&#40;&#34;skipping for libxml2 &lt; 2.6.27&#34;&#41; for 1..7;
[/QUOTE]

You only skip once and you should use skip_all.

[QUOTE]
+} else {
+
+# global entity loader
+XML::LibXML::externalEntityLoader&#40;\&#38;handler&#41;;
+
+my $parser = XML::LibXML-&gt;new&#40;{
+  expand_entities =&gt; 1,
+}&#41;;
+
+sub handler {
+  return &#34;ENTITY:&#34; . join&#40;&#34;,&#34;,@_&#41;;
+}
+
+my $xml = &lt;&lt;&#39;EOF&#39;;
+&lt;?xml version=&#34;1.0&#34;?&gt;
+&lt;!DOCTYPE foo [
+&lt;!ENTITY a PUBLIC &#34;//foo/bar/b&#34; &#34;file:/dev/null&#34;&gt;
+&lt;!ENTITY b SYSTEM &#34;file:///dev/null&#34;&gt;
+]&gt;
+&lt;root&gt;
+  &lt;a&gt;&#38;a;&lt;/a&gt;
+  &lt;b&gt;&#38;b;&lt;/b&gt;
+&lt;/root&gt;
+EOF
+my $xml_out = $xml;
+$xml_out =~ s{&#38;a;}{ENTITY:file:/dev/null,//foo/bar/b};
+$xml_out =~ s{&#38;b;}{ENTITY:file:///dev/null,};
+
+my $doc = $parser-&gt;parse_string&#40;$xml&#41;;
+
+# TEST
+ok&#40; $doc-&gt;toString&#40;&#41; eq $xml_out &#41;;
+
[/QUOTE]

Please fix or comment on all these issues.

Here you can use Test::More::is&#40;&#41; or maybe use eq_or_diff from
TestHelpers.pm in the repository.

Regards,

-- Shlomi Fish
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-951390" href="/Public/Bug/Display.html?id=69166#txn-951390">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;30&nbsp;14:56:02&nbsp;2011</span>
    <span class="description">SAMSK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/951390/494825/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/494825">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jun 30 13:11:56 2011, SHLOMIF wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Hi Sam,
&gt; 
&gt; Thanks for your patch. Here are the remaining issues with it:
&gt; 
&gt; [QUOTE]
&gt; diff -urN XML-LibXML-1.75/LibXML.pm XML-LibXML-1.75-new/LibXML.pm
&gt; --- XML-LibXML-1.75/LibXML.pm 2011-06-24 18:56:47.000000000 +0200
&gt; +++ XML-LibXML-1.75-new/LibXML.pm     2011-06-29 14:42:27.000000000 +0200
&gt; @@ -443,6 +443,12 @@
&gt;  # callback functions
&gt; #
&gt; 
</div>#-------------------------------------------------------------------------
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; #
&gt; 
&gt; +use Data::Dumper;
&gt; +sub externalEntityLoader&#40;&#38;&#41;
&gt; +{
&gt; +     return _externalEntityLoader&#40;$_[0]&#41;;
&gt; +}
&gt; +
&gt; [/QUOTE]
&gt; 
&gt; 1. Why do you need to load Data::Dumper?
&gt; 
&gt; 2. You have a 5 space indent instead of a 4-space indent.
&gt; 
</div>
fixed

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; [QUOTE]
&gt; SV *EXTERNAL_ENTITY_LOADER_FUNC = &#40;SV *&#41;NULL;
&gt; [/QUOTE]
&gt; 
&gt; 1. Why should the name be in ALL-CAPS?
&gt; 
&gt; 2. Should it be a global or should it belong to the parser instance?
&gt; 
</div>
By &#40;first&#41; implementation I&#39;ve followed style of original code, where XS
globals are all-caps &#40;see LibXML.xs:152&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; [QUOTE]
&gt; -    SV * self;
&gt; -    HV * real_obj;
&gt; +
&gt; [/QUOTE]
&gt; 
&gt; You have a maverick empty line here.
&gt; 
&gt; You also have some lines with trailing space.
&gt; 
</div>
removed.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; [QUOTE]
&gt; diff -urN XML-LibXML-1.75/lib/XML/LibXML/Parser.pod
&gt; XML-LibXML-1.75-new/lib/XML/LibXML/Parser.pod
&gt; --- XML-LibXML-1.75/lib/XML/LibXML/Parser.pod 2011-06-24
&gt; 18:57:22.000000000 +0200
&gt; +++ XML-LibXML-1.75-new/lib/XML/LibXML/Parser.pod     2011-06-29
&gt; 15:18:26.000000000 +0200
&gt; @@ -71,6 +71,11 @@
&gt; 
&gt;    $parser-&gt;load_catalog&#40; $catalog_file &#41;;
&gt; 
&gt; +  # Global external entity loader &#40;similar to ext_ent_handler option
&gt; +  #  but this works really globally, also in XML::LibXSLT include
&gt; etc..&#41;
&gt; +
&gt; +  XML::LibXML::externalEntityLoader&#40;\&#38;my_loader&#41;;
&gt; +
&gt; [/QUOTE]
&gt; 
&gt; Don&#39;t patch Parser.pod directly - instead patch docs/libxml.dbk . You
&gt; also have a tab character there.
</div>
ok, not patching parser.pod. Sorry, no time to play with book xml.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; [QUOTE]
&gt; diff -urN XML-LibXML-1.75/t/49global_extent.t
&gt; XML-LibXML-1.75-new/t/49global_extent.t
&gt; --- XML-LibXML-1.75/t/49global_extent.t       1970-01-01 01:00:00.000000000
&gt; +0100
&gt; +++ XML-LibXML-1.75-new/t/49global_extent.t   2011-06-29
&gt; 15:26:01.000000000 +0200
&gt; @@ -0,0 +1,51 @@
&gt; +# Test file created outside of h2xs framework.
&gt; +# Run this like so: `perl 49global_extent.t&#39;
&gt; +#   samuel&#40;_dot_&#41;behan&#40;-at-&#41;dob&#40;_dot_&#41;sk     2011/06/29 15:18:43
&gt; +
&gt; [/QUOTE]
&gt; 
&gt; No need for this comment. Well, you can keep your name there and maybe
&gt; a
&gt; copyright blurb. You can look at
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/shlomif/perl-xml-">https://bitbucket.org/shlomif/perl-xml-</a></span>
&gt; libxml/src/5b6ce7779709/t/49_load_html.t
&gt; for how to put it under the MIT/X11 licence.
&gt; 
</div>
removed.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; [QUOTE]
&gt; +#########################
&gt; +
&gt; +# change &#39;tests =&gt; 1&#39; to &#39;tests =&gt; last_test_to_print&#39;;
&gt; +
&gt; +use Test::More tests =&gt; 1;
&gt; +
&gt; +use warnings;
&gt; +use strict;
&gt; [/QUOTE]
&gt; 
&gt; Put the strict/warnings before the use Test::More.
&gt; 
</div>
fixed.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; [QUOTE]
&gt; +use XML::LibXML;
&gt; +$|=1;
&gt; [/QUOTE]
&gt; 
&gt; use IO::Handle-&gt;autoflush&#40;1&#41; instead &#40;if you really need it.&#41;.
&gt; 
</div>
removed.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; [QUOTE]
&gt; +
&gt; +if &#40;20627 &gt; XML::LibXML::LIBXML_VERSION&#41; {
&gt; +    skip&#40;&#34;skipping for libxml2 &lt; 2.6.27&#34;&#41; for 1..7;
&gt; [/QUOTE]
&gt; 
&gt; You only skip once and you should use skip_all.
&gt; 
</div>
fixed.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; [QUOTE]
&gt; +} else {
&gt; +
&gt; +# global entity loader
&gt; +XML::LibXML::externalEntityLoader&#40;\&#38;handler&#41;;
&gt; +
&gt; +my $parser = XML::LibXML-&gt;new&#40;{
&gt; +  expand_entities =&gt; 1,
&gt; +}&#41;;
&gt; +
&gt; +sub handler {
&gt; +  return &#34;ENTITY:&#34; . join&#40;&#34;,&#34;,@_&#41;;
&gt; +}
&gt; +
&gt; +my $xml = &lt;&lt;&#39;EOF&#39;;
&gt; +&lt;?xml version=&#34;1.0&#34;?&gt;
&gt; +&lt;!DOCTYPE foo [
&gt; +&lt;!ENTITY a PUBLIC &#34;//foo/bar/b&#34; &#34;file:/dev/null&#34;&gt;
&gt; +&lt;!ENTITY b SYSTEM &#34;file:///dev/null&#34;&gt;
&gt; +]&gt;
&gt; +&lt;root&gt;
&gt; +  &lt;a&gt;&#38;a;&lt;/a&gt;
&gt; +  &lt;b&gt;&#38;b;&lt;/b&gt;
&gt; +&lt;/root&gt;
&gt; +EOF
&gt; +my $xml_out = $xml;
&gt; +$xml_out =~ s{&#38;a;}{ENTITY:file:/dev/null,//foo/bar/b};
&gt; +$xml_out =~ s{&#38;b;}{ENTITY:file:///dev/null,};
&gt; +
&gt; +my $doc = $parser-&gt;parse_string&#40;$xml&#41;;
&gt; +
&gt; +# TEST
&gt; +ok&#40; $doc-&gt;toString&#40;&#41; eq $xml_out &#41;;
&gt; +
&gt; [/QUOTE]
&gt; 
&gt; Please fix or comment on all these issues.
&gt; 
&gt; Here you can use Test::More::is&#40;&#41; or maybe use eq_or_diff from
&gt; TestHelpers.pm in the repository.
&gt; 
&gt; Regards,
&gt; 
&gt; -- Shlomi Fish
&gt; 
</div>
Regards
  Sam
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> perl-XML LibXML+global_entity_loader-0.4.diff</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/951390/494826/perl-XML%20LibXML%2Bglobal_entity_loader-0.4.diff">Download perl-XML LibXML+global_entity_loader-0.4.diff</a><br />
<span class="downloadcontenttype">text/x-diff 5.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -urN XML-LibXML-1.75/LibXML.pm XML-LibXML-1.75-new/LibXML.pm
--- XML-LibXML-1.75/LibXML.pm	2011-06-24 18:56:47.000000000 +0200
+++ XML-LibXML-1.75-new/LibXML.pm	2011-06-30 19:56:14.000000000 +0200
@@ -443,6 +443,11 @@
 # callback functions                                                      #
 #-------------------------------------------------------------------------#
 
+sub externalEntityLoader&#40;&#38;&#41;
+{
+    return _externalEntityLoader&#40;$_[0]&#41;;
+}
+
 sub input_callbacks {
     my $self     = shift;
     my $icbclass = shift;
diff -urN XML-LibXML-1.75/LibXML.xs XML-LibXML-1.75-new/LibXML.xs
--- XML-LibXML-1.75/LibXML.xs	2011-06-24 18:38:46.000000000 +0200
+++ XML-LibXML-1.75-new/LibXML.xs	2011-06-30 20:49:54.000000000 +0200
@@ -146,6 +146,9 @@
 /* this should keep the default */
 static xmlExternalEntityLoader LibXML_old_ext_ent_loader = NULL;
 
+/* global external entity loader */
+SV *EXTERNAL_ENTITY_LOADER_FUNC = &#40;SV *&#41;NULL;
+
 SV* PROXY_NODE_REGISTRY_MUTEX = NULL;
 
 /* ****************************************************************
@@ -778,8 +781,6 @@
         const char * ID,
         xmlParserCtxtPtr ctxt&#41;
 {
-    SV * self;
-    HV * real_obj;
     SV ** func;
     int count;
     SV * results;
@@ -787,7 +788,8 @@
     const char * results_pv;
     xmlParserInputBufferPtr input_buf;
 
-    if &#40;ctxt-&gt;_private == NULL&#41; {
+    if &#40;ctxt-&gt;_private == NULL &#38;&#38; EXTERNAL_ENTITY_LOADER_FUNC == NULL&#41;
+    {
         return xmlNewInputFromFile&#40;ctxt, URL&#41;;
     }
 
@@ -798,11 +800,22 @@
         ID = &#34;&#34;;
     }
 
-    self = &#40;SV *&#41;ctxt-&gt;_private;
-    real_obj = &#40;HV *&#41;SvRV&#40;self&#41;;
-    func = hv_fetch&#40;real_obj, &#34;ext_ent_handler&#34;, 15, 0&#41;;
+    /* fetch entity loader function */
+    if&#40;EXTERNAL_ENTITY_LOADER_FUNC != NULL&#41;
+    {
+       func = &#38;EXTERNAL_ENTITY_LOADER_FUNC;
+    }
+    else
+    {
+       SV * self;
+       HV * real_obj;
+
+       self = &#40;SV *&#41;ctxt-&gt;_private;
+       real_obj = &#40;HV *&#41;SvRV&#40;self&#41;;
+       func = hv_fetch&#40;real_obj, &#34;ext_ent_handler&#34;, 15, 0&#41;;
+    }
 
-    if &#40;func != NULL  &#38;&#38; SvTRUE&#40;*func&#41;&#41; {
+    if &#40;func != NULL &#38;&#38; SvTRUE&#40;*func&#41;&#41; {
         dTHX;
         dSP;
 
@@ -899,18 +912,23 @@
             if &#40;ctxt&#41; ctxt-&gt;linenumbers = 0;
         }
 
-        item = hv_fetch&#40;real_obj, &#34;ext_ent_handler&#34;, 15, 0&#41;;
-        if &#40; item != NULL  &#38;&#38; SvTRUE&#40;*item&#41;&#41; {
-            LibXML_old_ext_ent_loader =  xmlGetExternalEntityLoader&#40;&#41;;
-            xmlSetExternalEntityLoader&#40; &#40;xmlExternalEntityLoader&#41;LibXML_load_external_entity &#41;;
-        }
-        else {
-            if &#40;parserOptions &#38; XML_PARSE_NONET&#41; {
+       if&#40;EXTERNAL_ENTITY_LOADER_FUNC == NULL&#41;
+       {
+            item = hv_fetch&#40;real_obj, &#34;ext_ent_handler&#34;, 15, 0&#41;;
+            if &#40;item != NULL  &#38;&#38; SvTRUE&#40;*item&#41;&#41; {
                 LibXML_old_ext_ent_loader =  xmlGetExternalEntityLoader&#40;&#41;;
-                xmlSetExternalEntityLoader&#40; xmlNoNetExternalEntityLoader &#41;;
+                xmlSetExternalEntityLoader&#40; &#40;xmlExternalEntityLoader&#41;LibXML_load_external_entity &#41;;
             }
-            /* LibXML_old_ext_ent_loader =  NULL; */
-        }
+            else 
+             {
+                if &#40;parserOptions &#38; XML_PARSE_NONET&#41;
+                {
+                    LibXML_old_ext_ent_loader = xmlGetExternalEntityLoader&#40;&#41;;
+                    xmlSetExternalEntityLoader&#40; xmlNoNetExternalEntityLoader &#41;;
+                }
+                /* LibXML_old_ext_ent_loader =  NULL; */
+            }
+       }
     }
 
     return real_obj;
@@ -921,7 +939,8 @@
 #ifndef WITH_SERRORS
     xmlGetWarningsDefaultValue = 0;
 #endif
-    if &#40;LibXML_old_ext_ent_loader != NULL &#41; {
+    if &#40;EXTERNAL_ENTITY_LOADER_FUNC == NULL &#38;&#38; LibXML_old_ext_ent_loader != NULL&#41;
+    {
         xmlSetExternalEntityLoader&#40; &#40;xmlExternalEntityLoader&#41;LibXML_old_ext_ent_loader &#41;;
     }
 }
@@ -2642,6 +2661,26 @@
     OUTPUT:
         RETVAL
 
+SV*
+_externalEntityLoader&#40; loader &#41;
+        SV* loader
+    CODE:
+        {
+            RETVAL = EXTERNAL_ENTITY_LOADER_FUNC;
+            if&#40;EXTERNAL_ENTITY_LOADER_FUNC == NULL&#41;
+            {
+                EXTERNAL_ENTITY_LOADER_FUNC = newSVsv&#40;loader&#41;;
+            }
+
+            if &#40;LibXML_old_ext_ent_loader == NULL &#41;
+            {
+                LibXML_old_ext_ent_loader = xmlGetExternalEntityLoader&#40;&#41;;
+                xmlSetExternalEntityLoader&#40;&#40;xmlExternalEntityLoader&#41;LibXML_load_external_entity&#41;;
+            }
+        }
+    OUTPUT:
+        RETVAL
+
 MODULE = XML::LibXML         PACKAGE = XML::LibXML::HashTable
 
 xmlHashTablePtr
@@ -9401,4 +9440,3 @@
 #endif
     OUTPUT:
         RETVAL
-
diff -urN XML-LibXML-1.75/t/49global_extent.t XML-LibXML-1.75-new/t/49global_extent.t
--- XML-LibXML-1.75/t/49global_extent.t	1970-01-01 01:00:00.000000000 +0100
+++ XML-LibXML-1.75-new/t/49global_extent.t	2011-06-30 20:46:10.000000000 +0200
@@ -0,0 +1,50 @@
+# Test file created outside of h2xs framework.
+# Run this like so: `perl 49global_extent.t&#39;
+#
+
+#########################
+
+# change &#39;tests =&gt; 1&#39; to &#39;tests =&gt; last_test_to_print&#39;;
+
+use warnings;
+use strict;
+
+use Test::More tests =&gt; 1;
+use XML::LibXML;
+
+if &#40;20627 &gt; XML::LibXML::LIBXML_VERSION&#41; {
+    skip_all&#40;&#34;skipping for libxml2 &lt; 2.6.27&#34;&#41; for 1..7;
+} else {
+
+# global entity loader
+XML::LibXML::externalEntityLoader&#40;\&#38;handler&#41;;
+
+my $parser = XML::LibXML-&gt;new&#40;{
+  expand_entities =&gt; 1,
+}&#41;;
+
+sub handler {
+  return &#34;ENTITY:&#34; . join&#40;&#34;,&#34;,@_&#41;;
+}
+
+my $xml = &lt;&lt;&#39;EOF&#39;;
+&lt;?xml version=&#34;1.0&#34;?&gt;
+&lt;!DOCTYPE foo [
+&lt;!ENTITY a PUBLIC &#34;//foo/bar/b&#34; &#34;file:/dev/null&#34;&gt;
+&lt;!ENTITY b SYSTEM &#34;file:///dev/null&#34;&gt;
+]&gt;
+&lt;root&gt;
+  &lt;a&gt;&#38;a;&lt;/a&gt;
+  &lt;b&gt;&#38;b;&lt;/b&gt;
+&lt;/root&gt;
+EOF
+my $xml_out = $xml;
+$xml_out =~ s{&#38;a;}{ENTITY:file:/dev/null,//foo/bar/b};
+$xml_out =~ s{&#38;b;}{ENTITY:file:///dev/null,};
+
+my $doc = $parser-&gt;parse_string&#40;$xml&#41;;
+
+# TEST
+is&#40; $doc-&gt;toString&#40;&#41;, $xml_out &#41;;
+
+}
\ No newline at end of file
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-951704" href="/Public/Bug/Display.html?id=69166#txn-951704">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;01&nbsp;07:02:01&nbsp;2011</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/951704/495003/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/495003">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 239b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Sam,

thanks for your patch. I applied it with some tweaks &#40;and while adding
some documentation&#41; to the repository here:

<span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/shlomif/perl-xml-libxml">https://bitbucket.org/shlomif/perl-xml-libxml</a></span>

It will be part of the next CPAN release.

Regards,

-- Shlomi Fish
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-951707" href="/Public/Bug/Display.html?id=69166#txn-951707">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;01&nbsp;07:02:04&nbsp;2011</span>
    <span class="description">SHLOMIF [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.489268</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
