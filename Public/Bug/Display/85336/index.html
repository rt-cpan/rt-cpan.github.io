<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #85336 for Inline: Fails often when tested in parallel</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #85336 for Inline: Fails often when tested in parallel</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Inline/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Inline/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Inline/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Inline/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/ingydotnet/inline-pm/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Inline">Inline CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">85336</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Inline/Active/">Inline</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ANDK [...] cpan.org

<br />
KENTNL [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-16878-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.53    </td>
  </tr>
  <tr id="CF-16879-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




0001-Makefile.PL-simplify-5.6-PREREQ_PM-handling.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1346876/714801/0001-Makefile.PL-simplify-5.6-PREREQ_PM-handling.patch">
Fri Apr 04 14:02:09 2014 (1.3k) by rurban [...] x-ray.at
</a>
</font></li>
</ul>


0002-0.54_01-import-Fcntl-constants-for-flock.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1346876/714799/0002-0.54_01-import-Fcntl-constants-for-flock.patch">
Fri Apr 04 14:02:09 2014 (1.4k) by rurban [...] x-ray.at
</a>
</font></li>
</ul>


0003-flock-only-on-supported-platforms.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1346876/714802/0003-flock-only-on-supported-platforms.patch">
Fri Apr 04 14:02:09 2014 (1k) by rurban [...] x-ray.at
</a>
</font></li>
</ul>


0004-MSWin32-disable-BUILD_NOISY-redirects-on-MSWin32-wit.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1346876/714798/0004-MSWin32-disable-BUILD_NOISY-redirects-on-MSWin32-wit.patch">
Fri Apr 04 14:02:09 2014 (1.8k) by rurban [...] x-ray.at
</a>
</font></li>
</ul>


0005-C-fix-make-jn-test-parallel-tests-Ticket-85336.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1346876/714800/0005-C-fix-make-jn-test-parallel-tests-Ticket-85336.patch">
Fri Apr 04 14:02:09 2014 (2.6k) by rurban [...] x-ray.at
</a>
</font></li>
</ul>


Inline_C_N.out<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1328692/704773/Inline_C_N.out">
Thu Feb 20 03:51:10 2014 (3.8k) by KENTNL [...] cpan.org
</a>
</font></li>
</ul>


Inline_C_Y.out<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1328692/704774/Inline_C_Y.out">
Thu Feb 20 03:51:10 2014 (3.5k) by KENTNL [...] cpan.org
</a>
</font></li>
</ul>


try.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1381460/733478/try.pl">
Tue Jul 01 04:27:36 2014 (4.2k) by sisyphus [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;15&nbsp;23:11:13&nbsp;2013</span>
    <span class="description">ANDK [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Fails often when tested in parallel</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Yesterday my smoker produced two fails while 4 processes were testing Inline 0.53:

<span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/62c114d6-bda4-11e2-874b-cb6a10d45c6b">http://www.cpantesters.org/cpan/report/62c114d6-bda4-11e2-874b-cb6a10d45c6b</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/64619edc-bda4-11e2-924f-916b10d45c6b">http://www.cpantesters.org/cpan/report/64619edc-bda4-11e2-924f-916b10d45c6b</a></span>

It&#39;s possible that these two were disturbing each other, they were both distrubed by some other, succeeding test run. I smoked with 4 parallel processes. It&#39;s not for the first time this happens, I have produced more fail reports in the past but not always they come in pairs. But I have not seen more than two in a row.

There seems to be a race condition somewhere.

HTH,
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;18&nbsp;02:20:38&nbsp;2013</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed May 15 23:11:13 2013, ANDK wrote:
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There seems to be a race condition somewhere.
</div>
Both of the affected test scripts &#40;t/21read_DATA.t and t/22read_DATA.t&#41; use the same Inline build directory &#40;.Inline&#41; - and they therefore need to access the same configuration file.

If you think that could be the source of the problem, I could work around that by designating 2 different &#40;separate&#41; build directories for those 2 test scripts - thereby assuring that each script has its own copy of the configuration details.
Is that worth trying ? &#40;If so, let me know, and I&#39;ll upload a new developer version of Inline that does exactly that and we can see how that goes.&#41;

Cheers,
Rob
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;18&nbsp;02:20:39&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;18&nbsp;10:40:47&nbsp;2013</span>
    <span class="description">andreas.koenig.7os6VVqR [...] franz.ak.mind.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> inline [...] perl.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #85336] Fails often when tested in parallel</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 18 May 2013 16:40:20 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Inline [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Andreas Koenig &lt;andreas.koenig.7os6VVqR [...] franz.ak.mind.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Sisyphus via RT&#34; &lt;bug-Inline@rt.cpan.org&gt; writes:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Is that worth trying ?
</div>
This, or maybe apply some locking? Depends on how much work it is, and
on how relevant for later real world behaviour it is.

Except for this, I&#39;d leave the judgement to the implementor;&#41;

-- 
andreas
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;18&nbsp;11:23:47&nbsp;2013</span>
    <span class="description">daoswald [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #85336] Fails often when tested in parallel</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 18 May 2013 09:23:10 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Inline [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> David Oswald &lt;daoswald [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I get test failures in Inline::CPP when running tests in parallel.
I&#39;ve gone through Inline::CPP and implemented file locking to
eliminate race conditions, but the issue persists.  That leads me to
believe that there needs to be a similar fix in Inline.  Changing
Inline&#39;s tests to use separate build directories wouldn&#39;t fix the
underlying issue of Inline not supporting concurrency.  Proper file
locking probably would resolve the issue, not only for Inline, but
also for plugins such as Inline::CPP.


On Sat, May 18, 2013 at 8:40 AM, &#40;Andreas J. Koenig&#41; via RT
&lt;bug-Inline@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sat May 18 10:40:47 2013: Request 85336 was acted upon.
&gt; Transaction: Correspondence added by andreas.koenig.7os6VVqR@franz.ak.mind.de
&gt;        Queue: Inline
&gt;      Subject: Re: [rt.cpan.org #85336] Fails often when tested in parallel
&gt;    Broken in: 0.53
&gt;     Severity: &#40;no value&#41;
&gt;        Owner: Nobody
&gt;   Requestors: ANDK@cpan.org
&gt;       Status: open
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=85336">https://rt.cpan.org/Ticket/Display.html?id=85336</a></span> &gt;
&gt;
&gt;
&gt; &#34;Sisyphus via RT&#34; &lt;bug-Inline@rt.cpan.org&gt; writes:
&gt;
<div class="message-stanza open">&gt;&gt; Is that worth trying ?
</div>&gt;
&gt; This, or maybe apply some locking? Depends on how much work it is, and
&gt; on how relevant for later real world behaviour it is.
&gt;
&gt; Except for this, I&#39;d leave the judgement to the implementor;&#41;
&gt;
&gt; --
&gt; andreas
&gt;
</div>


-- 

David Oswald
daoswald@gmail.com
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;19&nbsp;01:37:37&nbsp;2013</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat May 18 10:40:47 2013, andreas.koenig.7os6VVqR@franz.ak.mind.de wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#34;Sisyphus via RT&#34; &lt;bug-Inline@rt.cpan.org&gt; writes:
&gt; 
<div class="message-stanza open">&gt; &gt; Is that worth trying ?
</div>&gt; 
&gt; This, or maybe apply some locking? Depends on how much work it is, and
&gt; on how relevant for later real world behaviour it is.
&gt; 
&gt; Except for this, I&#39;d leave the judgement to the implementor;&#41;
</div>
I don&#39;t think it&#39;s very relevant to real world usage - and hence my &#40;personal&#41; interest in this is nowhere near as keen as it would otherwise be.

However, David Oswald wants to write some patches that will put in place file locking. If there&#39;s no problem with those patches, I&#39;ll apply them &#40;when I receive them&#41; and release a new devel version of Inline.

Hopefully, that will keep everyone happy :-&#41;

Cheers,
Rob
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;20&nbsp;03:47:03&nbsp;2014</span>
    <span class="description">KENTNL [...] cpan.org -  Requestor KENTNL added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;20&nbsp;03:51:10&nbsp;2014</span>
    <span class="description">KENTNL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza"><p>
	You&#39;ll note quite a few fail reports on cpan testers from me.</p>

<p>
	&nbsp;</p>

<p>
	I had in fact just assumed Inline was entirely broken somehow due to how long I&#39;ve been seeing these errors, and due to the way they failed suggesting strange things ( For instance, telling me I have a MAD perl when I do not is very very weird )</p>

<p>
	Indeed, double checking and running the tests without parallelism makes all the problems mysteriously vanish!</p>


</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Inline_C_N.out</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1328692/704773/Inline_C_N.out">Download Inline_C_N.out</a><br />
<span class="downloadcontenttype">application/octet-stream 3.8k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Inline_C_Y.out</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1328692/704774/Inline_C_Y.out">Download Inline_C_Y.out</a><br />
<span class="downloadcontenttype">application/octet-stream 3.5k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;04&nbsp;11:51:31&nbsp;2014</span>
    <span class="description">rurban [...] x-ray.at -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rurban [...] x-ray.at</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Feb 20 03:51:10 2014, KENTNL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; You&#39;ll note quite a few fail reports on cpan testers from me.
</div>
Confirmed and repro even standalone.

The pure Inline/C tests fail on SMP systems with make &#40;tested with gmake 4.0&#41; 
in t/25proto.t and t/08taint_1.p
On 5.6 and 5.14 perls &#40;linux&#41;

$@: make[1]: Entering directory `/home/rurban/Perl/Inline/C/_Inline_test/build/PROTO4_7cc8&#39;
make[1]: *** write jobserver: Bad file descriptor.  Stop.
make[1]: *** Waiting for unfinished jobs....
make[1]: *** write jobserver: Bad file descriptor.  Stop.

I&#39;ll try to fix it at <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/rurban/Inline">https://github.com/rurban/Inline</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;04&nbsp;13:56:12&nbsp;2014</span>
    <span class="description">rurban [...] x-ray.at -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rurban [...] x-ray.at</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Apr 04 11:51:31 2014, rurban@x-ray.at wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Feb 20 03:51:10 2014, KENTNL wrote:
<div class="message-stanza open">&gt; &gt; You&#39;ll note quite a few fail reports on cpan testers from me.
</div>&gt; 
&gt; Confirmed and repro even standalone.
&gt; 
&gt; The pure Inline/C tests fail on SMP systems with make &#40;tested with
&gt; gmake 4.0&#41;
&gt; in t/25proto.t and t/08taint_1.p
&gt; On 5.6 and 5.14 perls &#40;linux&#41;
&gt; 
&gt; $@: make[1]: Entering directory
&gt; `/home/rurban/Perl/Inline/C/_Inline_test/build/PROTO4_7cc8&#39;
&gt; make[1]: *** write jobserver: Bad file descriptor.  Stop.
&gt; make[1]: *** Waiting for unfinished jobs....
&gt; make[1]: *** write jobserver: Bad file descriptor.  Stop.
&gt; 
&gt; I&#39;ll try to fix it at <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/rurban/Inline">https://github.com/rurban/Inline</a></span>
</div>
The problem is obvious.
make inherits these ENV values from the master make test:
MAKEFLAGS = w --jobserver-fds=3,4 -j -- PREFIX=/usr/local LINKTYPE=dynamic LIBPERL_A=libperl.a
MAKELEVEL = 2
MAKEOVERRIDES = ${-*-command-variables-*-}

The jobserver-fds are wrong, need to be stripped.

All tests with make -j4 pass now. See <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/rurban/Inline">https://github.com/rurban/Inline</a></span> 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;04&nbsp;14:02:09&nbsp;2014</span>
    <span class="description">rurban [...] x-ray.at -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rurban [...] x-ray.at</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Patches for the next release attached
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0004-MSWin32-disable-BUILD_NOISY-redirects-on-MSWin32-wit.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From ddb07b21a81466fe21ab92440edfdee5dc521100 Mon Sep 17 00:00:00 2001
From: Reini Urban &lt;rurban@cpanel.net&gt;
Date: Fri, 4 Apr 2014 12:37:08 -0500
Subject: [PATCH 4/5] MSWin32: disable BUILD_NOISY redirects on MSWin32 with
 cmd.exe

also print exitcode with failed commands
---
 C/C.pm  | 5 ++++-
 Changes | 7 +++++++
 2 files changed, 11 insertions&#40;+&#41;, 1 deletion&#40;-&#41;

diff --git C/C.pm C/C.pm
index f76e34b..21f7dfe 100644
--- C/C.pm
+++ C/C.pm
@@ -804,6 +804,7 @@ sub makefile_pl {
     -f &#40;$perl = $Config::Config{perlpath}&#41;
       or &#40;$perl = $^X&#41;
       or croak &#34;Can&#39;t locate your perl binary&#34;;
+    $perl = qq{&#34;$perl&#34;} if $perl =~ m/\s/;
     $o-&gt;system_call&#40;&#34;$perl Makefile.PL&#34;, &#39;out.Makefile_PL&#39;&#41;;
     $o-&gt;fix_make;
 }
@@ -841,6 +842,7 @@ sub system_call {
       defined $ENV{PERL_INLINE_BUILD_NOISY}
       ? $ENV{PERL_INLINE_BUILD_NOISY}
       : $o-&gt;{CONFIG}{BUILD_NOISY};
+    $build_noisy = undef if $build_noisy and $^O eq &#39;MSWin32&#39; and $Config::Config{sh} =~ /^cmd/;
     if &#40;not $build_noisy&#41; {
         $cmd = &#34;$cmd &gt; $output_file 2&gt;&#38;1&#34;;
     }
@@ -861,11 +863,12 @@ sub build_error_message {
         close OUTPUT;
     }
 
+    my $errcode = $? &gt;&gt; 8;
     return $output . &lt;&lt;END;
 
 A problem was encountered while attempting to compile and install your Inline
 $o-&gt;{API}{language} code. The command that failed was:
-  $cmd
+  \&#34;$cmd\&#34; with error code $errcode
 
 The build directory was:
 $build_dir
diff --git Changes Changes
index eed0437..641e8ba 100644
--- Changes
+++ Changes
@@ -1,5 +1,12 @@
 # Revision history for Perl extension Inline.
 
+--- version 0.54_01
+date 2014-04-04 12:22:37
+     import Fcntl constants for flock &#40;rurban&#41;
+     flock only on supported platforms, would die on VMS,riscos,VOS &#40;rurban&#41;
+     print exitcode with failed commands
+     disable BUILD_NOISY redirects on MSWin32 with cmd.exe
+
 --- version 0.54
 date Sat 29 Mar 2014
      Update version number to 0.54
-- 
1.9.1

</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0002-0.54_01-import-Fcntl-constants-for-flock.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 96f009221620e148c55d1a50f7aa6d06f9940ad9 Mon Sep 17 00:00:00 2001
From: Reini Urban &lt;rurban@cpanel.net&gt;
Date: Fri, 4 Apr 2014 11:31:33 -0500
Subject: [PATCH 2/5] 0.54_01: import Fcntl constants for flock

Bareword &#34;LOCK_EX&#34; not allowed while &#34;strict subs&#34; in use at ../blib/lib/Inline.pm line 861
---
 C/Makefile.PL | 4 ++--
 Inline.pm     | 3 ++-
 2 files changed, 4 insertions&#40;+&#41;, 3 deletions&#40;-&#41;

diff --git C/Makefile.PL C/Makefile.PL
index 03306ee..214b7bd 100644
--- C/Makefile.PL
+++ C/Makefile.PL
@@ -36,8 +36,8 @@ Inline::C is packaged with Inline.pm because it is the most commonly used
 Inline Language Support Module &#40;ILSM&#41;.
 
 See also: Inline::ASM, ::Awk, ::BC, ::Basic, ::Befunge, ::CPP &#40;C++&#41;, ::CPR,
-          ::Foo, ::Guile, ::Java, ::Octave, ::PERL, ::Python, ::Ruby, ::TT,
-          ::Tcl and ::WebChat.
+          ::Filters, ::Foo, ::Guile, ::Java, ::Octave, ::PERL, ::Python, ::Ruby,
+          ::TT, ::Tcl and ::WebChat.
 
 Config.pm indicates that your version of Perl was built with this C compiler:
 
diff --git Inline.pm Inline.pm
index 062b29f..dc0d504 100644
--- Inline.pm
+++ Inline.pm
@@ -2,7 +2,7 @@ package Inline;
 
 use strict;
 require 5.006;
-$Inline::VERSION = &#39;0.54&#39;;
+$Inline::VERSION = &#39;0.54_01&#39;;
 $Inline::VERSION = eval $Inline::VERSION;
 
 use AutoLoader &#39;AUTOLOAD&#39;;
@@ -12,6 +12,7 @@ use Carp;
 use Cwd qw&#40;abs_path cwd&#41;;
 use File::Spec;
 use File::Spec::Unix;
+use Fcntl qw&#40;LOCK_EX LOCK_UN&#41;;
 
 my %CONFIG = &#40;&#41;;
 my @DATA_OBJS = &#40;&#41;;
-- 
1.9.1

</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0005-C-fix-make-jn-test-parallel-tests-Ticket-85336.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 2ce1aed6d8980ae341cd3499d8efc36ce9b2ac5d Mon Sep 17 00:00:00 2001
From: Reini Urban &lt;rurban@cpanel.net&gt;
Date: Fri, 4 Apr 2014 12:59:31 -0500
Subject: [PATCH 5/5] C: fix make -jn test, parallel tests &#40;Ticket #85336&#41;

strip make jobserver-fds from MAKEFLAGS
print MAKE* ENV values with failed make command
---
 C/C.pm    | 10 +++++++++-
 C/Changes |  6 ++++++
 Changes   |  3 +--
 3 files changed, 16 insertions&#40;+&#41;, 3 deletions&#40;-&#41;

diff --git C/C.pm C/C.pm
index 21f7dfe..0dfa73b 100644
--- C/C.pm
+++ C/C.pm
@@ -812,12 +812,14 @@ sub make {
     my &#40;$o&#41; = @_;
     my $make = $o-&gt;{ILSM}{MAKE} || $Config::Config{make}
       or croak &#34;Can&#39;t locate your make binary&#34;;
+    local $ENV{MAKEFLAGS} = $ENV{MAKEFLAGS} =~ s/&#40;--jobserver-fds=[\d,]+&#41;//;
     $o-&gt;system_call&#40;&#34;$make&#34;, &#39;out.make&#39;&#41;;
 }
 sub make_install {
     my &#40;$o&#41; = @_;
     my $make = $o-&gt;{ILSM}{MAKE} || $Config::Config{make}
       or croak &#34;Can&#39;t locate your make binary&#34;;
+    local $ENV{MAKEFLAGS} = $ENV{MAKEFLAGS} =~ s/&#40;--jobserver-fds=[\d,]+&#41;//;
     $o-&gt;system_call&#40;&#34;$make pure_install&#34;, &#39;out.make_install&#39;&#41;;
 }
 sub cleanup {
@@ -864,7 +866,7 @@ sub build_error_message {
     }
 
     my $errcode = $? &gt;&gt; 8;
-    return $output . &lt;&lt;END;
+    $output .= &lt;&lt;END;
 
 A problem was encountered while attempting to compile and install your Inline
 $o-&gt;{API}{language} code. The command that failed was:
@@ -876,6 +878,12 @@ $build_dir
 To debug the problem, cd to the build directory, and inspect the output files.
 
 END
+    if &#40;$cmd =~ /^make &gt;/&#41; {
+      for &#40;sort keys %ENV&#41; {
+        $output .= &#34;$_ = $ENV{$_}\n&#34; if /^MAKE/;
+      }
+    }
+    return $output;
 }
 
 #==============================================================================
diff --git C/Changes C/Changes
index f3406ac..0019ec6 100644
--- C/Changes
+++ C/Changes
@@ -1,5 +1,11 @@
 Revision history for Perl extension Inline::C.
 
+--- version 0.54_01
+date 2014-04-04
+     fix make -jn test, parallel tests &#40;Ticket #85336&#41; &#40;rurban&#41;
+     disable BUILD_NOISY redirects on MSWin32 with cmd.exe &#40;rurban&#41;
+     print exitcode with failed commands and MAKE* ENV values &#40;rurban&#41;
+
 0.54 Sat 29 mar 2014
      Update version number to 0.54
      Release version 0.54 to CPAN
diff --git Changes Changes
index 641e8ba..c128032 100644
--- Changes
+++ Changes
@@ -1,11 +1,10 @@
 # Revision history for Perl extension Inline.
 
 --- version 0.54_01
-date 2014-04-04 12:22:37
+date 2014-04-04
      import Fcntl constants for flock &#40;rurban&#41;
      flock only on supported platforms, would die on VMS,riscos,VOS &#40;rurban&#41;
      print exitcode with failed commands
-     disable BUILD_NOISY redirects on MSWin32 with cmd.exe
 
 --- version 0.54
 date Sat 29 Mar 2014
-- 
1.9.1

</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-Makefile.PL-simplify-5.6-PREREQ_PM-handling.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From f195ee259a0247f382b961fa38cdd20f41c25c54 Mon Sep 17 00:00:00 2001
From: Reini Urban &lt;rurban@cpanel.net&gt;
Date: Fri, 4 Apr 2014 10:31:41 -0500
Subject: [PATCH 1/5] Makefile.PL: simplify 5.6 PREREQ_PM handling

---
 Makefile.PL | 24 ++++++++----------------
 1 file changed, 8 insertions&#40;+&#41;, 16 deletions&#40;-&#41;

diff --git Makefile.PL Makefile.PL
index 8ea8cfb..158bafa 100644
--- Makefile.PL
+++ Makefile.PL
@@ -40,22 +40,14 @@ unless&#40;$md5_check&#41; {
 
 my $twv = $] &gt; 5.013 ? 0.23 : 0.21;
 
-my $prereq_pm = $] &gt; 5.007 ?
-                             {
-                              Data::Dumper =&gt; 2.09,
-                              Digest::MD5 =&gt; 2.09,
-	                        Parse::RecDescent =&gt; 1.80,
-                              File::Spec =&gt; 0.8,
-                              Test::Warn =&gt; $twv,
-                             }
-
-                           :
-                             {
-                              Data::Dumper =&gt; 2.09,
-                              Digest::MD5 =&gt; 2.09,
-	                        Parse::RecDescent =&gt; 1.80,
-                              File::Spec =&gt; 0.8,
-                             };
+my $prereq_pm = {
+    Data::Dumper =&gt; 2.09,
+    Digest::MD5 =&gt; 2.09,
+    Parse::RecDescent =&gt; 1.80,
+    File::Spec =&gt; 0.8,
+    Test::Warn =&gt; $twv,
+};
+delete $prereq_pm-&gt;{&#39;Test::Warn&#39;} if $] &lt;= 5.007;
 
 WriteMakefile&#40;
     NAME =&gt; &#39;Inline&#39;,
-- 
1.9.1

</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0003-flock-only-on-supported-platforms.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 8c217ba881b2e72b622aacacfcffab525125b6f3 Mon Sep 17 00:00:00 2001
From: Reini Urban &lt;rurban@cpanel.net&gt;
Date: Fri, 4 Apr 2014 12:22:17 -0500
Subject: [PATCH 3/5] flock only on supported platforms

see perldoc perlport
---
 Inline.pm | 4 ++--
 1 file changed, 2 insertions&#40;+&#41;, 2 deletions&#40;-&#41;

diff --git Inline.pm Inline.pm
index dc0d504..760f4f0 100644
--- Inline.pm
+++ Inline.pm
@@ -859,7 +859,7 @@ sub create_config_file {
 
     my $file = File::Spec-&gt;catfile&#40;$ARGV[0], $configuration_file&#41;;
     open CONFIG, &#34;&gt; $file&#34; or croak M24_open_for_output_failed&#40;$file&#41;;
-    flock&#40;CONFIG, LOCK_EX&#41;;
+    flock&#40;CONFIG, LOCK_EX&#41; if $^O !~ /^VMS|riscos|VOS$/;
     print CONFIG Inline::denter-&gt;new&#40;&#41;
       -&gt;indent&#40;*version =&gt; $Inline::VERSION,
 	       *languages =&gt; \%languages,
@@ -867,7 +867,7 @@ sub create_config_file {
 	       *modules =&gt; \%modules,
 	       *suffixes =&gt; \%suffixes,
 	      &#41;;
-    flock&#40;CONFIG, LOCK_UN&#41;;
+    flock&#40;CONFIG, LOCK_UN&#41; if $^O !~ /^VMS|riscos|VOS$/;
     close CONFIG;
     exit 0;
 }
-- 
1.9.1

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;06&nbsp;03:55:40&nbsp;2014</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Apr 04 14:02:09 2014, rurban@x-ray.at wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Patches for the next release attached
</div>
Thanks Reini.
These patches have been applied &#40;by hand&#41; .... hope I got &#39;em right. Inline-0.54_01 &#40;which contains these patches&#41; has now been uploaded to CPAN.
All being well, it will be re-released as Inline-0.55 in a week or so.

For the Changes and C/Changes files I generally structure it so that Changes lists alterations to Inline and C/Changes alterations to Inline::C. &#40;All this really achieves is to make it difficult for myself - especially in those cases where both packages are affected by the one set of changes.&#41;

One will find that Changes and C/Changes have not been altered in strict accordance with the provided patches.

The only other alteration made to the provided patches was to rewrite the 2 occurrences of:

local $ENV{MAKEFLAGS} = $ENV{MAKEFLAGS} =~ s/&#40;--jobserver-fds=[\d,]+&#41;//;

as:

if&#40;$ENV{MAKEFLAGS}&#41; {
  local $ENV{MAKEFLAGS} = $ENV{MAKEFLAGS} =~ s/&#40;--jobserver-fds=[\d,]+&#41;//;
}

This was done to avoid &#39;uninitialized&#39; warnings on systems where $ENV{MAKEFLAGS} was unset.

Cheers,
Rob
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;12&nbsp;18:46:34&nbsp;2014</span>
    <span class="description">SLAFFAN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The local assignment to $ENV{MAKEFLAGS} won&#39;t apply outside the if block, will it?  

This should, though:


local $ENV{MAKEFLAGS} = $ENV{MAKEFLAGS} =~ s/&#40;--jobserver-fds=[\d,]+&#41;//
  if $ENV{MAKEFLAGS};


Or it could be localised before that condition if postfix conditions are not preferred &#40;albeit postfix conditions are used elsewhere in the package&#41;:


local $ENV{MAKEFLAGS} = $ENV{MAKEFLAGS};
if&#40;$ENV{MAKEFLAGS}&#41; {
  $ENV{MAKEFLAGS} = $ENV{MAKEFLAGS} =~ s/&#40;--jobserver-fds=[\d,]+&#41;//;
}


Regards,
Shawn.



On Sun Apr 06 03:55:40 2014, SISYPHUS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri Apr 04 14:02:09 2014, rurban@x-ray.at wrote:
<div class="message-stanza open">&gt; &gt; Patches for the next release attached
</div>&gt; 
&gt; Thanks Reini.
&gt; These patches have been applied &#40;by hand&#41; .... hope I got &#39;em right.
&gt; Inline-0.54_01 &#40;which contains these patches&#41; has now been uploaded to
&gt; CPAN.
&gt; All being well, it will be re-released as Inline-0.55 in a week or so.
&gt; 
&gt; For the Changes and C/Changes files I generally structure it so that
&gt; Changes lists alterations to Inline and C/Changes alterations to
&gt; Inline::C. &#40;All this really achieves is to make it difficult for
&gt; myself - especially in those cases where both packages are affected by
&gt; the one set of changes.&#41;
&gt; 
&gt; One will find that Changes and C/Changes have not been altered in
&gt; strict accordance with the provided patches.
&gt; 
&gt; The only other alteration made to the provided patches was to rewrite
&gt; the 2 occurrences of:
&gt; 
&gt; local $ENV{MAKEFLAGS} = $ENV{MAKEFLAGS} =~ s/&#40;--jobserver-
&gt; fds=[\d,]+&#41;//;
&gt; 
&gt; as:
&gt; 
&gt; if&#40;$ENV{MAKEFLAGS}&#41; {
&gt;   local $ENV{MAKEFLAGS} = $ENV{MAKEFLAGS} =~ s/&#40;--jobserver-
&gt; fds=[\d,]+&#41;//;
&gt; }
&gt; 
&gt; This was done to avoid &#39;uninitialized&#39; warnings on systems where
&gt; $ENV{MAKEFLAGS} was unset.
&gt; 
&gt; Cheers,
&gt; Rob
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;13&nbsp;07:17:59&nbsp;2014</span>
    <span class="description">sisyphus1 [...] optusnet.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #85336] Fails often when tested in parallel</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 13 Apr 2014 21:17:05 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Inline [...] rt.cpan.org&gt;, &lt;inline [...] perl.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;sisyphus1 [...] optusnet.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message----- 
From: Shawn Laffan via RT

<div class="message-stanza open">&gt; The local assignment to $ENV{MAKEFLAGS} won&#39;t apply outside the if block, 
&gt; will it?
</div>
Duh !!

<div class="message-stanza open">&gt; This should, though:
&gt;
&gt; local $ENV{MAKEFLAGS} = $ENV{MAKEFLAGS} =~ s/&#40;--jobserver-fds=[\d,]+&#41;//
&gt;  if $ENV{MAKEFLAGS};
</div>
Thanks - fixed in git.

Cheers,
Rob 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;12&nbsp;04:37:14&nbsp;2014</span>
    <span class="description">ETJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> andreas.koenig.7os6VVqR [...] franz.ak.mind.de, rurban [...] x-ray.at,
 inline [...] perl.org, daoswald [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;d be very interested to know whether the change proposed in <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/mohawk2/inline-pm/commit/9fef7cfbd731249579deb3510d96a318115a0928">https://github.com/mohawk2/inline-pm/commit/9fef7cfbd731249579deb3510d96a318115a0928</a></span> fixes this issue.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;24&nbsp;05:06:27&nbsp;2014</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Fixed as of 0.55_01
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;24&nbsp;05:06:28&nbsp;2014</span>
    <span class="description">sisyphus [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;01&nbsp;04:27:36&nbsp;2014</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Re-opening because of the following patch that was applied to Inline-0.55 as part of this ticket:

####################################
Subject: [PATCH 4/5] MSWin32: disable BUILD_NOISY redirects on MSWin32 with
 cmd.exe

also print exitcode with failed commands

diff --git C/C.pm C/C.pm
index f76e34b..21f7dfe 100644
--- C/C.pm
+++ C/C.pm
@@ -804,6 +804,7 @@ sub makefile_pl {
     -f &#40;$perl = $Config::Config{perlpath}&#41;
       or &#40;$perl = $^X&#41;
       or croak &#34;Can&#39;t locate your perl binary&#34;;
+    $perl = qq{&#34;$perl&#34;} if $perl =~ m/\s/;
     $o-&gt;system_call&#40;&#34;$perl Makefile.PL&#34;, &#39;out.Makefile_PL&#39;&#41;;
     $o-&gt;fix_make;
 }
@@ -841,6 +842,7 @@ sub system_call {
       defined $ENV{PERL_INLINE_BUILD_NOISY}
       ? $ENV{PERL_INLINE_BUILD_NOISY}
       : $o-&gt;{CONFIG}{BUILD_NOISY};
+    $build_noisy = undef if $build_noisy and $^O eq &#39;MSWin32&#39; and $Config::Config{sh} =~ /^cmd/;
     if &#40;not $build_noisy&#41; {
         $cmd = &#34;$cmd &gt; $output_file 2&gt;&#38;1&#34;;
     }
@@ -861,11 +863,12 @@ sub build_error_message {
         close OUTPUT;
     }
 
+    my $errcode = $? &gt;&gt; 8;
     return $output . &lt;&lt;END;
 
 A problem was encountered while attempting to compile and install your Inline
 $o-&gt;{API}{language} code. The command that failed was:
-  $cmd
+  \&#34;$cmd\&#34; with error code $errcode
 
 The build directory was:
 $build_dir
####################################

I wondered at the time &#40;and still wonder&#41; what that was about - but I applied it anyway, as it didn&#39;t break any tests.

However, it does break BUILD_NOISY on Win32 - to the extent that the compiler/linker commands/warnings of a successful build are not seen.

simply removing the line:

    $build_noisy = undef if $build_noisy and $^O eq &#39;MSWin32&#39; and $Config::Config{sh} =~ /^cmd/;

from the patched &#40;0.55&#41; C.pm is sufficient to regain correct functioning of BUILD_NOISY on Windows.
However, doing that probably also destroys whatever it was that the patch was designed to fix.

This episode exposes a need for a test script that examines the output of a BUILD_NOISY build to detect that this output is present.
It would be hard to check that the entire output is as it should be, but we should at least be able to check for the presence of certain key elements like  - eg that the output matches the string &#34;perl&#34;, that it matches the &#40;interpolated&#41;&#34;$Config{LD}&#34; and that it matches the name of any Inline-C function whose compilation is expected to emit a warning.

I think this breakage of BUILD_NOISY needs to be fixed for the next stable release.

Attached is a try.pl that demonstrates the problem. It shows the expected output of the script, and the actual output I get on one of my Win32 perls using Inline-0.55.

Cheers,
Rob
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> try.pl</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">use strict;
use warnings;

use Inline C =&gt; Config =&gt;
    BUILD_NOISY =&gt; 1,
;

use Inline C =&gt; &lt;&lt;&#39;EOC&#39;;

void inline_warner&#40;&#41; {
   int *x;
   x = 2;
}


EOC

print &#34;DONE&#34;;

__END__

Should output &#40;for me on Windows&#41;:

#############################################
validate Stage
Starting Build Preprocess Stage
get_maps Stage
Finished Build Preprocess Stage

Starting Build Parse Stage
Finished Build Parse Stage

Starting Build Glue 1 Stage
Finished Build Glue 1 Stage

Starting Build Glue 2 Stage
Finished Build Glue 2 Stage

Starting Build Glue 3 Stage
Finished Build Glue 3 Stage

Starting Build Compile Stage
  Starting &#34;perl Makefile.PL&#34; Stage
Writing Makefile for try_pl_534c
Writing MYMETA.yml
  Finished &#34;perl Makefile.PL&#34; Stage

  Starting &#34;make&#34; Stage
C:\perl514_M\bin\perl.exe C:\perl514_M\lib\ExtUtils\xsubpp  -typemap &#34;C:\perl514_M\lib\ExtUtils\typemap&#34; -typemap &#34;C:\_32\pscrpt\inline\typemap&#34;  try_pl_534c.xs &gt; try_pl_534c.xsc &#38;&#38; C:\perl514_M\bin\perl.exe -MExtUtils::Command -e &#34;mv&#34; -- try_pl_534c.xsc try_pl_534c.c
gcc -c  -I&#34;C:/_32/pscrpt/inline&#34; 	-s -O2 -DWIN32 -DPERL_TEXTMODE_SCRIPTS -DPERL_IMPLICIT_CONTEXT -DPERL_IMPLICIT_SYS -fno-strict-aliasing -mms-bitfields -s -O2 	  -DVERSION=\&#34;0.00\&#34; 	-DXS_VERSION=\&#34;0.00\&#34;  &#34;-IC:\perl514_M\lib\CORE&#34;   try_pl_534c.c
try_pl_534c.xs: In function `inline_warner&#39;:
try_pl_534c.xs:8: warning: assignment makes pointer from integer without a cast
Running Mkbootstrap for try_pl_534c &#40;&#41;
C:\perl514_M\bin\perl.exe -MExtUtils::Command -e &#34;chmod&#34; -- 644 try_pl_534c.bs
C:\perl514_M\bin\perl.exe -MExtUtils::Mksymlists \
     -e &#34;Mksymlists&#40;&#39;NAME&#39;=&gt;\&#34;try_pl_534c\&#34;, &#39;DLBASE&#39; =&gt; &#39;try_pl_534c&#39;, &#39;DL_FUNCS&#39; =&gt; {  }, &#39;FUNCLIST&#39; =&gt; [], &#39;IMPORTS&#39; =&gt; {  }, &#39;DL_VARS&#39; =&gt; []&#41;;&#34;
dlltool --def try_pl_534c.def --output-exp dll.exp
g++ -o blib\arch\auto\try_pl_534c\try_pl_534c.dll -Wl,--base-file -Wl,dll.base -mdll -s -L&#34;c:\perl514_M\lib\CORE&#34; -L&#34;C:\home\rob\mingw_vista\i686-pc-mingw32\lib&#34; try_pl_534c.o   C:\perl514_M\lib\CORE\libperl514.a -lmoldname -lkernel32 -luser32 -lgdi32 -lwinspool -lcomdlg32 -ladvapi32 -lshell32 -lole32 -loleaut32 -lnetapi32 -luuid -lws2_32 -lmpr -lwinmm -lversion -lodbc32 -lodbccp32 -lcomctl32 dll.exp
dlltool --def try_pl_534c.def --base-file dll.base --output-exp dll.exp
g++ -o blib\arch\auto\try_pl_534c\try_pl_534c.dll -mdll -s -L&#34;c:\perl514_M\lib\CORE&#34; -L&#34;C:\home\rob\mingw_vista\i686-pc-mingw32\lib&#34; try_pl_534c.o   C:\perl514_M\lib\CORE\libperl514.a -lmoldname -lkernel32 -luser32 -lgdi32 -lwinspool -lcomdlg32 -ladvapi32 -lshell32 -lole32 -loleaut32 -lnetapi32 -luuid -lws2_32 -lmpr -lwinmm -lversion -lodbc32 -lodbccp32 -lcomctl32 dll.exp 
C:\perl514_M\bin\perl.exe -MExtUtils::Command -e &#34;chmod&#34; -- 755 blib\arch\auto\try_pl_534c\try_pl_534c.dll
C:\perl514_M\bin\perl.exe -MExtUtils::Command -e &#34;cp&#34; -- try_pl_534c.bs blib\arch\auto\try_pl_534c\try_pl_534c.bs
C:\perl514_M\bin\perl.exe -MExtUtils::Command -e &#34;chmod&#34; -- 644 blib\arch\auto\try_pl_534c\try_pl_534c.bs
dmake:  Warning: -- Target [blibdirs] was made but the time stamp has not been updated.
  Finished &#34;make&#34; Stage

  Starting &#34;make install&#34; Stage
Files found in blib\arch: installing files in blib\lib into architecture dependent library tree
Installing C:\_32\pscrpt\inline\_Inline\lib\auto\try_pl_534c\try_pl_534c.dll
Installing C:\_32\pscrpt\inline\_Inline\lib\auto\try_pl_534c\try_pl_534c.bs
  Finished &#34;make install&#34; Stage

  Starting Cleaning Up Stage
  Finished Cleaning Up Stage

Finished Build Compile Stage

DONE
#######################################

But, with Inline-0.55 outputs:

#######################################
validate Stage
Starting Build Preprocess Stage
get_maps Stage
Finished Build Preprocess Stage

Starting Build Parse Stage
Finished Build Parse Stage

Starting Build Glue 1 Stage
Finished Build Glue 1 Stage

Starting Build Glue 2 Stage
Finished Build Glue 2 Stage

Starting Build Glue 3 Stage
Finished Build Glue 3 Stage

Starting Build Compile Stage
  Starting &#34;perl Makefile.PL&#34; Stage
  Finished &#34;perl Makefile.PL&#34; Stage

  Starting &#34;make&#34; Stage
  Finished &#34;make&#34; Stage

  Starting &#34;make install&#34; Stage
  Finished &#34;make install&#34; Stage

  Starting Cleaning Up Stage
  Finished Cleaning Up Stage

Finished Build Compile Stage

DONE
#######################################</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;01&nbsp;04:27:37&nbsp;2014</span>
    <span class="description">sisyphus [...] cpan.org -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;02&nbsp;00:55:23&nbsp;2014</span>
    <span class="description">ETJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">FYI, the code to show the correct operation of BUILD_NOISY can be one-linered like so:

perl -MInline=C,Config,BUILD_NOISY,1,FORCE_BUILD,1 -e &#34;use Inline C =&gt; q[void inline_warner&#40;&#41; { int *x = 2; }]&#34;

My reading of the patch in question is that it turns off BUILD_NOISY when it&#39;s Windows and the shell is cmd. If BUILD_NOISY does the right thing with Win32 and CMD, let&#39;s undo that change?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;02&nbsp;05:52:27&nbsp;2014</span>
    <span class="description">sisyphus1 [...] optusnet.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #85336] Fails often when tested in parallel</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 2 Jul 2014 19:52:09 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Inline [...] rt.cpan.org&gt;, &lt;inline [...] perl.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Sisyphus&#34; &lt;sisyphus1 [...] optusnet.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">----- Original Message ----- 
From: &#34;Ed J via RT&#34; &lt;bug-Inline@rt.cpan.org&gt;

<div class="message-stanza open">&gt; FYI, the code to show the correct operation of BUILD_NOISY can be 
&gt; one-linered like so:
&gt;
&gt; perl -MInline=C,Config,BUILD_NOISY,1,FORCE_BUILD,1 -e &#34;use Inline C =&gt; 
&gt; q[void inline_warner&#40;&#41; { int *x = 2; }]&#34;
</div>
Yes, for a test  I&#39;m thinking just have the test script run something like 
that as a system command with output redirected to a file - and then check 
that file &#40;to an extent that allows us to be confident that BUILD_NOISY is 
behaving as expected&#41;.

<div class="message-stanza open">&gt; My reading of the patch in question is that it turns off BUILD_NOISY when 
&gt; it&#39;s Windows and the shell is cmd.
</div>
That&#39;s about the extent of it. But I&#39;m damned if I can think of any reason 
that ought to be done.

<div class="message-stanza open">&gt; If BUILD_NOISY does the right thing with Win32 and CMD, let&#39;s undo that 
&gt; change?
</div>
BUILD_NOISY has always done the right thing for me on Win32 in the cmd.exe 
shell - that is, until 0.55 ;-&#41;
So yes - we definitely need to revert to pre-0.55 behaviour.

&#40;This Windows laptop I&#39;m using while I&#39;m not at home doesn&#39;t have a git 
client, and I can&#39;t be bothered installing one on it. I&#39;ll be back home 
tomorrow night and will attend to this BUILD_NOISY issue then, if no-one 
else has.&#41;

Cheers,
Rob 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;02&nbsp;18:01:36&nbsp;2014</span>
    <span class="description">ETJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">commit 0bcdb0f7dfa065ff5bf68f2f3033ec7c549e38c3
Author: ...
Date:   Wed Jul 2 22:43:44 2014 +0100

    Undo change disabling BUILD_NOISY for Win32 when shell eq &#34;cmd&#34;.

In new 0.55_03:

diff --git a/C/C.pm b/C/C.pm
index 0b8073e..cc2f4a0 100644
--- a/C/C.pm
+++ b/C/C.pm
@@ -852,7 +852,8 @@ sub system_call {
       defined $ENV{PERL_INLINE_BUILD_NOISY}
       ? $ENV{PERL_INLINE_BUILD_NOISY}
       : $o-&gt;{CONFIG}{BUILD_NOISY};
-    $build_noisy = undef if $build_noisy and $^O eq &#39;MSWin32&#39; and $Config::Conf
+    # test this functionality with:
+    #perl -MInline=C,Config,BUILD_NOISY,1,FORCE_BUILD,1 -e &#34;use Inline C =&gt; q[v
     if &#40;not $build_noisy&#41; {
         $cmd = &#34;$cmd &gt; $output_file 2&gt;&#38;1&#34;;
     }
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;02&nbsp;18:01:39&nbsp;2014</span>
    <span class="description">ETJ [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
