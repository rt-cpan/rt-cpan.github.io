<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #3165 for WWW-Mechanize: Follow link based on surrounding text</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #3165 for WWW-Mechanize: Follow link based on surrounding text</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=WWW-Mechanize">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=WWW-Mechanize">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=WWW-Mechanize">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=WWW-Mechanize">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/libwww-perl/WWW-Mechanize/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/WWW-Mechanize">WWW-Mechanize CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">3165</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=WWW-Mechanize">WWW-Mechanize</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
siegmann [...] tinbergen.nl

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-36214-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-36215-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




oldnew.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/85269/12406/oldnew.patch">
Sat Oct 04 09:38:43 2003 (3.1k) by 
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=3165">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-85267" href="/Public/Bug/Display.html?id=3165#txn-85267">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;06&nbsp;05:22:29&nbsp;2003</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Follow link based on surrounding text</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/85267/10784/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/10784">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is a great module, but I run into the following issue every time: Websites with electronic versions of &#40;academic&#41; journal
articles, e.g., sciencedirect.com, generally present the stuff you
want, followed by links to possible generic actions. My wish is therefore to be able to follow a link based on the *preceding material*, and not one of the properties of the link itself. This is comparable with the request someone did for scraping Google news: suppose I want to read all the stories about Iraq, then I won&#39;t get far by examining the url-text/href on news.google.com....

And now for a concrete example:
Suppose we have two entries for journal articles on 1 page:

On the theory of reference-dependent preferences, Pages 407-428
Alistair Munro and Robert Sugden
Abstract | Full Text + Links | PDF &#40;149 K&#41;

Melioration learning in games with constant and frequency-dependent
pay-offs, Pages 429-448
Thomas Brenner and Ulrich Witt
Abstract | Full Text + Links | PDF &#40;114 K&#41;

In this case, doing $agent-&gt;follow&#40;&#39;PDF&#39;&#41; &#40;or having an url_regex matching &#39;.pdf&#39;&#41; is not useful, as you do not
want to follow a pdf link, but follow the link to the pdf just
right after the correct pagenumbers are mentioned. This is a problem that
can occur for several other applications, I imagine. For example,
screen scraping your inbox from webmail: for each subject line you can
choose &#39;reply&#39;, &#39;read&#39;, &#39;delete&#39;, etc., but the links to those actions
are not distinguishable by their name&#40;or url&#41; for the different
emails.

I think this problem is ultimately solved by having something like a
function &#34;follow_context&#40;R1, R2&#41;&#34;, which matches R1 on the visible text, and matches R2 on the links that follow
after the match of R1. Also, R2 could be allowed to be an integer &#40;possibly negative&#41;, which gives the
link number starting from the match of R1.

I am using my own patched version of WWW::Mechanize that does this and it works great. Therefore, I would love to send in a patch, but I need to think of a non-dirty way of getting the text nodes from a page. I.e., HTML::TokeParser only accepts one parameter in get_text, while we need it to get the text until it meets an &lt;a&gt;, &lt;iframe&gt;, or &lt;frame&gt; tag. 
Any ideas on this?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-85268" href="/Public/Bug/Display.html?id=3165#txn-85268">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;06&nbsp;07:05:38&nbsp;2003</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/85268/10788/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/10788">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 138b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Seems interesting and useful. I think this is a great idea, but we need
a real implementation to discuss the benefits of this API further.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-85269" href="/Public/Bug/Display.html?id=3165#txn-85269">#</a>      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;04&nbsp;09:38:42&nbsp;2003</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> siegmann [...] tinbergen.nl</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/85269/12405/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/12405">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 868b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[guest - Wed Aug  6 07:05:38 2003]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Seems interesting and useful. I think this is a great idea, but we 
</div>need
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; a real implementation to discuss the benefits of this API further.
</div>
Please find a patch attached oldnew.patch &#40;unified diff&#41; relative to
version 0.58. It extends the implementation of follow_link to include a
context_regex, which is matched on the &#40;non-link&#41; text of a page. If a
match is found $parms{n} gives the number of the nth link after the
match that should be followed &#40;default 1&#41;. 

It took a few changes in follow_link to include context_regex. A few 
extra lines do the match on the non-link text and return the nth link 
after the match.

I&#39;ve tried to minimize the changes to _extract_links in order to get it 
filling a @texts array with the pieces of text between the recorded 
urltags.

Please let me know what you think!

Arjen Siegmann
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/85269/12406/oldnew.patch">Download oldnew.patch</a><br />
<span class="downloadcontenttype">text/x-diff 3.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- Mechanize.old	Tue Sep  2 09:30:30 2003
+++ Mechanize.new	Wed Sep  3 11:20:09 2003
@@ -853,13 +853,14 @@
     my %parms = &#40; n=&gt;1, @_ &#41;;
 
     my @links = @{$self-&gt;{links}};
+		my @texts = @{$self-&gt;{texts}};
 
     return unless @links ;
 
     my $wantall = &#40; $parms{n} eq &#34;all&#34; &#41;;
 
     for &#40; keys %parms &#41; {
-	if &#40; !/^&#40;n|&#40;text|url&#41;&#40;_regex&#41;?&#41;$/ &#41; {
+	if &#40; !/^&#40;n|&#40;text|url|context&#41;&#40;_regex&#41;?&#41;$/ &#41; {
 	    $self-&gt;_carp&#40; qq{Unknown link-finding parameter &#34;$_&#34;} &#41;;
 	}
     }
@@ -869,6 +870,7 @@
     push @conditions, q/ $_[0]-&gt;[0] =~ $parms{url_regex} /  if defined $parms{url_regex};
     push @conditions, q/ defined&#40;$_[0]-&gt;[1]&#41; and $_[0]-&gt;[1] eq $parms{text} /	    if defined $parms{text};
     push @conditions, q/ defined&#40;$_[0]-&gt;[1]&#41; and $_[0]-&gt;[1] =~ $parms{text_regex} / if defined $parms{text_regex};
+    push @conditions, q/ defined&#40;$_[0]&#41; and $_[0] =~ $parms{context_regex} / if defined $parms{context_regex};
 
     my $matchfunc;
     if &#40; @conditions &#41; {
@@ -878,6 +880,8 @@
 	$matchfunc = sub{1};
     }
 
+	# simple case: search url or text of links
+	if&#40;not defined $parms{context_regex}&#41; {
     my $nmatches = 0;
     my @matches;
     for my $link &#40; @links &#41; {
@@ -897,7 +901,21 @@
     }
 
     return;
-} # find_link
+	} # find_link
+
+	# defined $param{context_regex}
+	my $link_count = 0;
+my $i=0;
+	for my $text &#40; @texts &#41; {
+		if &#40; $matchfunc-&gt;&#40;$text&#41; &#41; {
+			my $num = $link_count+$parms{n}-1;
+			return $links[$num];
+		}
+		$link_count++;
+	}
+
+	return 0;	#nothing found
+} 
 
 =head2 C&lt;&lt; $a-&gt;find_all_links&#40; ... &#41; &gt;&gt;
 
@@ -1148,24 +1166,41 @@
     my $p = HTML::TokeParser-&gt;new&#40;\$self-&gt;{content}&#41;;
     
     $self-&gt;{links} = [];
+    $self-&gt;{texts} = [];
+
+		my $inter_text;
+		my $text;
+		my $token;
+
+		# We need to workaround incorrect html, i.e., not starting with a tag
+		while &#40; $text = $p-&gt;get_trimmed_text or $token = $p-&gt;get_tag&#41; {
+			$inter_text .= $text;
+			&#40; $token = $p-&gt;get_tag &#41; unless defined $text;
 
-    while &#40;my $token = $p-&gt;get_tag&#40; keys %urltags &#41;&#41; {
-        my $tag = $token-&gt;[0];
-        my $url = $token-&gt;[1]{$urltags{$tag}};
-        next unless defined $url;   # probably just a name link or &lt;AREA NOHREF...&gt;
+			my $tag= $token-&gt;[0];
+			next unless&#40; $urltags{$tag} &#41;;	# read more text if not an urltag
 
-        my $text;
+			my $url = $token-&gt;[1]{$urltags{$tag}};
+			next unless defined $url;   # probably just a name link or &lt;AREA NOHREF...&gt;
+
+        my $link_text;
 	my $name;
 	if &#40; $tag eq &#34;a&#34; &#41; {
-	    $text = $p-&gt;get_trimmed_text&#40;&#34;/$tag&#34;&#41;;
-	    $text = &#34;&#34; unless defined $text;
+	    $link_text = $p-&gt;get_trimmed_text&#40;&#34;/$tag&#34;&#41;;
+	    $link_text = &#34;&#34; unless defined $link_text;
 	}
 	if &#40; $tag ne &#34;area&#34; &#41; {
 	    $name = $token-&gt;[1]{name};
 	}
 
-        push&#40; @{$self-&gt;{links}}, WWW::Mechanize::Link-&gt;new&#40; $url, $text, $name, $tag &#41; &#41;;
-    }
+				push&#40; @{$self-&gt;{texts}}, $inter_text &#41;;
+				$inter_text = &#34;&#34;;
+        push&#40; @{$self-&gt;{links}}, WWW::Mechanize::Link-&gt;new&#40; $url, $link_text, $name, $tag &#41; &#41;;
+    } 
+
+	if&#40;$inter_text ne &#34;&#34;&#41; {	#some text after final urltag
+			push&#40; @{$self-&gt;{texts}}, $inter_text &#41;;
+	}
 
     # Old extract_links&#40;&#41; returned a value.  Carp if someone expects
     # this version to return something.

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-85270" href="/Public/Bug/Display.html?id=3165#txn-85270">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;18&nbsp;21:42:11&nbsp;2004</span>
    <span class="description">MARKSTOS [...] cpan.org -  Status changed from &#39;new&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-85271" href="/Public/Bug/Display.html?id=3165#txn-85271">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;18&nbsp;21:42:11&nbsp;2004</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/85271/23573/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/23573">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1023b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[guest - Sat Oct  4 09:38:42 2003]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; [guest - Wed Aug  6 07:05:38 2003]:
&gt; 
<div class="message-stanza open">&gt; &gt; Seems interesting and useful. I think this is a great idea, but we
</div>&gt; need
<div class="message-stanza open">&gt; &gt; a real implementation to discuss the benefits of this API further.
</div>&gt; 
&gt; Please find a patch attached oldnew.patch &#40;unified diff&#41; relative to
&gt; version 0.58. It extends the implementation of follow_link to include
&gt;    a
&gt; context_regex, which is matched on the &#40;non-link&#41; text of a page. If a
&gt; match is found $parms{n} gives the number of the nth link after the
&gt; match that should be followed &#40;default 1&#41;.
</div>
Sorry for the massive delay. Andy got way behind on the bug tracking
system, and I&#39;m helping him out. This still  looks like an interesting
feature. 

Could you extend you patch to update the test suite and documentation as
well? The feature is unique enough that we&#39;ll probably want to try it an
beta before finally accepting. You&#39;ll will be given credit in the
&#39;Changes&#39; file for the idea and implementation. 

Thanks for the submission Arjen!

  Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-223994" href="/Public/Bug/Display.html?id=3165#txn-223994">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;15&nbsp;20:23:59&nbsp;2006</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Follow link based on surrounding text &#40;can it be a plugin?&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> MARKSTOS [...] cpan.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/223994/92658/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/92658">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

I&#39;m following up on this old &#34;Wish&#34; for Mechanize. It is an interesting
idea, but I think it is best to keep the Mechanize module itself lean,
and extend it through plugins. 

I encourage to look at releasing this functionality but writing a plugin
 for use with WWW::Mechanize::Pluggable. 

If for some reason that isn&#39;t feasible, I&#39;m interested to know about the
details, so that we can improve the plugin system to enable features
likes this to be plugged-in.

   Mark

On Wed Aug 06 05:22:29 2003, guest wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This is a great module, but I run into the following issue every time:
&gt;    Websites with electronic versions of &#40;academic&#41; journal
&gt; articles, e.g., sciencedirect.com, generally present the stuff you
&gt; want, followed by links to possible generic actions. My wish is
&gt;    therefore to be able to follow a link based on the *preceding
&gt;    material*, and not one of the properties of the link itself. This
&gt;    is comparable with the request someone did for scraping Google
&gt;    news: suppose I want to read all the stories about Iraq, then I
&gt;    won&#39;t get far by examining the url-text/href on news.google.com....
&gt; 
&gt; And now for a concrete example:
&gt; Suppose we have two entries for journal articles on 1 page:
&gt; 
&gt; On the theory of reference-dependent preferences, Pages 407-428
&gt; Alistair Munro and Robert Sugden
&gt; Abstract | Full Text + Links | PDF &#40;149 K&#41;
&gt; 
&gt; Melioration learning in games with constant and frequency-dependent
&gt; pay-offs, Pages 429-448
&gt; Thomas Brenner and Ulrich Witt
&gt; Abstract | Full Text + Links | PDF &#40;114 K&#41;
&gt; 
&gt; In this case, doing $agent-&gt;follow&#40;&#39;PDF&#39;&#41; &#40;or having an url_regex
&gt;    matching &#39;.pdf&#39;&#41; is not useful, as you do not
&gt; want to follow a pdf link, but follow the link to the pdf just
&gt; right after the correct pagenumbers are mentioned. This is a problem
&gt;    that
&gt; can occur for several other applications, I imagine. For example,
&gt; screen scraping your inbox from webmail: for each subject line you can
&gt; choose &#39;reply&#39;, &#39;read&#39;, &#39;delete&#39;, etc., but the links to those actions
&gt; are not distinguishable by their name&#40;or url&#41; for the different
&gt; emails.
&gt; 
&gt; I think this problem is ultimately solved by having something like a
&gt; function &#34;follow_context&#40;R1, R2&#41;&#34;, which matches R1 on the visible
&gt;    text, and matches R2 on the links that follow
&gt; after the match of R1. Also, R2 could be allowed to be an integer
&gt;    &#40;possibly negative&#41;, which gives the
&gt; link number starting from the match of R1.
&gt; 
&gt; I am using my own patched version of WWW::Mechanize that does this and
&gt;    it works great. Therefore, I would love to send in a patch, but I
&gt;    need to think of a non-dirty way of getting the text nodes from a
&gt;    page. I.e., HTML::TokeParser only accepts one parameter in
&gt;    get_text, while we need it to get the text until it meets an &lt;a&gt;,
&gt;    &lt;iframe&gt;, or &lt;frame&gt; tag.
&gt; Any ideas on this?
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-223995" href="/Public/Bug/Display.html?id=3165#txn-223995">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;15&nbsp;20:23:59&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-376833" href="/Public/Bug/Display.html?id=3165#txn-376833">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;30&nbsp;01:09:38&nbsp;2007</span>
    <span class="description">PETDANCE [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.35455</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
