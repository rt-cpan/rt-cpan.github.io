<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #88669 for Contextual-Return: redefining blessed breaks Moose</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #88669 for Contextual-Return: redefining blessed breaks Moose</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Contextual-Return">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Contextual-Return">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Contextual-Return">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Contextual-Return">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Contextual-Return">Contextual-Return CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">88669</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Contextual-Return">Contextual-Return</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
mzrinsky [...] redanvil.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
ether [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-7874-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
0.004004</li>
<li>
0.004005</li>
<li>
0.004006</li>
<li>
0.004007</li>
</ul>
    </td>
  </tr>
  <tr id="CF-7875-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




blessed_bug.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1370823/727855/blessed_bug.pl">
Mon Jun 02 03:49:48 2014 (116b) by mzrinsky [...] redanvil.net
</a>
</font></li>
</ul>


IO__Prompter-error-message.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1369617/727170/IO__Prompter-error-message.txt">
Thu May 29 06:42:19 2014 (1k) by BRAD [...] cpan.org
</a>
</font></li>
</ul>


IO__Prompter-error.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1369617/727171/IO__Prompter-error.pl">
Thu May 29 06:42:19 2014 (281b) by BRAD [...] cpan.org
</a>
</font></li>
</ul>


TestClass.pm<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1370823/727856/TestClass.pm">
Mon Jun 02 03:49:48 2014 (123b) by mzrinsky [...] redanvil.net
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=88669">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1262767" href="/Public/Bug/Display.html?id=88669#txn-1262767">#</a>      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;14&nbsp;03:57:55&nbsp;2013</span>
    <span class="description">mzrinsky [...] redanvil.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> redefining blessed breaks Moose</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1262767/668640/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/668640">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 592b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Moose and Moose::Role make blessed available to modules that use Moose; or use Moose::Role;

Using Contextual::Return anywhere in any module clobbers that.

In my case I was using IO::Prompter, which makes use of Contextual::Return and that caused modules looking for blessed to fail to find it with a undefined subroutine the::module::blessed error.

Version 0.004003 and before do not have this error &#40;as blessed was not overridden then&#41;.

I&#39;m not sure what the real problem is between the 2 modules, as I only use Contextual::Return indirectly through the IO::Prompter module as mentioned.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1266863" href="/Public/Bug/Display.html?id=88669#txn-1266863">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;25&nbsp;02:39:49&nbsp;2013</span>
    <span class="description">damian [...] conway.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #88669] redefining blessed breaks Moose</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 25 Sep 2013 16:38:56 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Contextual-Return [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Damian Conway &lt;damian [...] conway.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1266863/670784/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/670784">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 354b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Moose and Moose::Role make blessed available to modules that use Moose; or use Moose::Role;
&gt; Using Contextual::Return anywhere in any module clobbers that.
</div>

Thanks for the report. I am surprised by this, but have been unable to
reproduce the problem.
Could you possibly send me a &#40;short!&#41; code example than demonstrates
the problem?

Thanks,

Damian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1266864" href="/Public/Bug/Display.html?id=88669#txn-1266864">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;25&nbsp;02:39:50&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1369617" href="/Public/Bug/Display.html?id=88669#txn-1369617">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;29&nbsp;06:42:19&nbsp;2014</span>
    <span class="description">BRAD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> damian [...] conway.org, damian [...] conway.org</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1369617/727169/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/727169">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 275b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Damian,

I&#39;m getting the same, adding IO::Prompter to an existing Moose project. I&#39;m attaching a snippet of code that produces the attached error without needing any objects defined - swapping the order of use for TryCatch and IO::Prompter solves the issue.

Cheers

Brad
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> IO__Prompter-error-message.txt</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1369617/727170/IO__Prompter-error-message.txt">Download IO__Prompter-error-message.txt</a><br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[5s] ./test.pl --arg
Can&#39;t locate object method &#34;blessed&#34; via package &#34;MooseX::Types::EXPORTED_TYPE_CONSTRAINT&#34; at /home/brad/perl5/lib/perl5/MooseX/Types.pm line 385.
BEGIN failed--compilation aborted at /home/brad/perl5/lib/perl5/Parse/Method/Signatures/Types.pm line 18.
Compilation failed in require at /home/brad/perl5/lib/perl5/Parse/Method/Signatures/ParamCollection.pm line 5.
BEGIN failed--compilation aborted at /home/brad/perl5/lib/perl5/Parse/Method/Signatures/ParamCollection.pm line 5.
Compilation failed in require at /home/brad/perl5/lib/perl5/Parse/Method/Signatures.pm line 11.
BEGIN failed--compilation aborted at /home/brad/perl5/lib/perl5/Parse/Method/Signatures.pm line 11.
Compilation failed in require at /home/brad/perl5/lib/perl5/x86_64-linux-thread-multi/TryCatch.pm line 11.
BEGIN failed--compilation aborted at /home/brad/perl5/lib/perl5/x86_64-linux-thread-multi/TryCatch.pm line 11.
Compilation failed in require at ./test.pl line 16.
BEGIN failed--compilation aborted at ./test.pl line 16.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> IO__Prompter-error.pl</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1369617/727171/IO__Prompter-error.pl">Download IO__Prompter-error.pl</a><br />
<span class="downloadcontenttype">text/x-perl 281b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/env perl

BEGIN { use version; our $VERSION = qv&#40;&#39;1.0.0&#39;&#41; }

use strict;
use warnings;
use utf8;
use English;

use open IO =&gt; &#39;:utf8&#39;;

#use Getopt::Euclid;
#use Params::Validate qw&#40;:all&#41;;
#use Smart::Comments -ENV;
use IO::Prompter;
use TryCatch;

1;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1369822" href="/Public/Bug/Display.html?id=88669#txn-1369822">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;29&nbsp;16:41:50&nbsp;2014</span>
    <span class="description">damian [...] conway.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #88669] redefining blessed breaks Moose</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 30 May 2014 06:41:01 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Contextual-Return [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Damian Conway &lt;damian [...] conway.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1369822/727293/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/727293">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Brad,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m getting the same, adding IO::Prompter to an existing Moose
&gt; project. I&#39;m attaching a snippet of code that produces the attached
&gt; error without needing any objects defined - swapping the order of use
&gt; for TryCatch and IO::Prompter solves the issue.
</div>
Thanks for the minimalist example.

Tracking through the problem, this seems to be a bad interaction between
Scalar::Util, Moose::Exporter, and Contextual::Return under 5.18 and later.

Unfortunately, it doesn&#39;t seem to be an interaction that I can fix via
Contextual::Return &#40;which is the only one of those three modules I control&#41;.

There&#39;s a simple fix via MooseX::Types, which is to change the line:

    use Scalar::Util                      &#39;reftype&#39;;

to:

    use Scalar::Util                      &#39;reftype&#39;, &#39;blessed&#39;;

The only other alternative, as you have already discerned, is to ensure that
IO::Prompter loads after Moose. Even just putting:

    use Moose &#40;&#41;;

at the start of the main program solves the problem.

Sorry not to be of more help,

Damian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1370823" href="/Public/Bug/Display.html?id=88669#txn-1370823">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;02&nbsp;03:49:48&nbsp;2014</span>
    <span class="description">mzrinsky [...] redanvil.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mzrinsky [...] redanvil.net</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1370823/727854/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/727854">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 322b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I don&#39;t know why, but I never thought to swap the order of the modules.
Moving IO::Prompter to be the last module loaded worked.

Just for the heck of it here is an additional test case that shows the issue.

Either way, it is resolved for me now anyway by just making sure IO::Prompter is the last module loaded.

Thanks!
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> blessed_bug.pl</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1370823/727855/blessed_bug.pl">Download blessed_bug.pl</a><br />
<span class="downloadcontenttype">text/x-perl 116b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">use strict;
use warnings;
use lib qw&#39;.\/&#39;;
use IO::Prompter;
use TestClass;

my $t = TestClass-&gt;new&#40;&#41;;
$t-&gt;test&#40;&#41;;

</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> TestClass.pm</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1370823/727856/TestClass.pm">Download TestClass.pm</a><br />
<span class="downloadcontenttype">text/x-perl 123b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">package TestClass;
use Moose;

sub test {
	my $self = shift;
	my $t = bless&#40;{}, &#39;base_test_1&#39;&#41;;
	return blessed&#40;$t&#41;;
}

1;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1424900" href="/Public/Bug/Display.html?id=88669#txn-1424900">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;24&nbsp;13:27:02&nbsp;2014</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> damian [...] conway.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1424900/756876/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/756876">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 961b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2014-05-29 13:41:50, damian@conway.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Brad,
&gt; 
<div class="message-stanza open">&gt; &gt; I&#39;m getting the same, adding IO::Prompter to an existing Moose
&gt; &gt; project. I&#39;m attaching a snippet of code that produces the attached
&gt; &gt; error without needing any objects defined - swapping the order of use
&gt; &gt; for TryCatch and IO::Prompter solves the issue.
</div>&gt; 
&gt; Thanks for the minimalist example.
&gt; 
&gt; Tracking through the problem, this seems to be a bad interaction between
&gt; Scalar::Util, Moose::Exporter, and Contextual::Return under 5.18 and later.
&gt; 
&gt; Unfortunately, it doesn&#39;t seem to be an interaction that I can fix via
&gt; Contextual::Return &#40;which is the only one of those three modules I control&#41;.
&gt; 
&gt; There&#39;s a simple fix via MooseX::Types, which is to change the line:
</div>

Now that I am aware of this issue, I am making this patch, and similar patches in other code &#40;a core Moose module is similarly affected&#41;.

PLEASE IN FUTURE raise tickets on the other affected modules!!!!!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1424904" href="/Public/Bug/Display.html?id=88669#txn-1424904">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;24&nbsp;13:31:04&nbsp;2014</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1424904/756880/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/756880">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 619b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2014-05-29 13:41:50, damian@conway.org wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Tracking through the problem, this seems to be a bad interaction between
&gt; Scalar::Util, Moose::Exporter, and Contextual::Return under 5.18 and later.
&gt; 
&gt; Unfortunately, it doesn&#39;t seem to be an interaction that I can fix via
&gt; Contextual::Return &#40;which is the only one of those three modules I control&#41;.
</div>
This *is* fixable in Contextual-Return, by the way -- the problem is that the patched version of the function is not being named.  All you need to do is wrap it in a call to Sub::Name::subname &#40;or Sub::Util::set_subname, a modern clone of this implementation&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1424908" href="/Public/Bug/Display.html?id=88669#txn-1424908">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;24&nbsp;13:31:27&nbsp;2014</span>
    <span class="description">ether [...] cpan.org -  Cc ETHER added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1424910" href="/Public/Bug/Display.html?id=88669#txn-1424910">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;24&nbsp;13:50:58&nbsp;2014</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1424910/756885/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/756885">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 897b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Oct 24 13:31:04 2014, ETHER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2014-05-29 13:41:50, damian@conway.org wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; Tracking through the problem, this seems to be a bad interaction
&gt; &gt; between
&gt; &gt; Scalar::Util, Moose::Exporter, and Contextual::Return under 5.18 and
&gt; &gt; later.
&gt; &gt;
&gt; &gt; Unfortunately, it doesn&#39;t seem to be an interaction that I can fix
&gt; &gt; via
&gt; &gt; Contextual::Return &#40;which is the only one of those three modules I
&gt; &gt; control&#41;.
</div>&gt; 
&gt; This *is* fixable in Contextual-Return, by the way -- the problem is
&gt; that the patched version of the function is not being named.  All you
&gt; need to do is wrap it in a call to Sub::Name::subname &#40;or
&gt; Sub::Util::set_subname, a modern clone of this implementation&#41;.
</div>
If you donâ€™t want Contextual::Return to depend on more modules, you could also eval &#39;sub Scalar::Util::blessed  {...}&#39; to accomplish the same thing, instead of *Scalar::Util::blessed=sub{...}.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.743563</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
