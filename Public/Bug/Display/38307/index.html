<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #38307 for Pod-Tree: Fixes to make tests pass &#38; output to strings work</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #38307 for Pod-Tree: Fixes to make tests pass &#38; output to strings work</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Pod-Tree/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Pod-Tree/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Pod-Tree/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Pod-Tree/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="http://github.com/szabgab/Pod-Tree/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Pod-Tree">Pod-Tree CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">38307</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">3 hours (180 min)

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Pod-Tree/Active/">Pod-Tree</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">SWMCD [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
he [...] NetBSD.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-26216-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-26217-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;07&nbsp;19:17:32&nbsp;2008</span>
    <span class="description">he [...] NetBSD.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Fixes to make tests pass &#38; output to strings work</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 08 Aug 2008 01:17:13 +0200 &#40;CEST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Pod-Tree [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Havard Eidnes &lt;he [...] NetBSD.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

while packaging an update of Pod::Tree for pkgsrc, I found that
many of the tests in this package fail.

I&#39;ve dug a bit deeper, and have come up with the attached patches
which fix these problems.

This should also fix the other reported problem, id 34755.

One major problem which caused many of the tests to fail is the
_resolve_dest&#40;&#41; in Pod::Tree::HTML, when used with HTML::Stream
version 1.60 &#40;not sure that version matters&#41;, and the code ended
up making files named SCALAR&#40;0xaddr&#41; in the top-level directory
instead of writing to the variable given by the scalar reference.
Proper detection and use of IO::String fixes this problem.

This also gets rid of the half-assed and confusing IO::String in
the tests, and instead uses the real IO::String -- the proper use
of IO::String in Pod::Tree::HTML conflicts with the dummy define
in the tests and cropped up as the next problem after the first
one was fixed.  This again caused some of the tests having to be
rewritten to fish out the string reference out of the IO::String
object.

Best regards,

- HÃ¥vard
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- lib/Pod/Tree/HTML.pm.orig   2007-06-24 16:51:41.000000000 +0200
+++ lib/Pod/Tree/HTML.pm
@@ -5,6 +5,7 @@
 use strict;
 use HTML::Stream;
 use IO::File;
+use IO::String;
 use Pod::Tree;
 use Text::Template;
 
@@ -120,7 +121,12 @@ sub _resolve_dest
     isa&#40;$dest, &#39;IO::File&#39;    &#41; and return &#40;$dest, new HTML::Stream $dest&#41;;
     can&#40;$dest, &#39;print&#39;       &#41; and return &#40;$dest, new HTML::Stream $dest&#41;;
 
-    if &#40;ref $dest eq &#39;SCALAR&#39; or ref $dest eq &#39;&#39; and $dest&#41;
+    if &#40;ref $dest eq &#39;SCALAR&#39;&#41;
+    {
+       my $fh = new IO::String $dest;
+       return &#40;$fh, new HTML::Stream $fh&#41;;
+    }
+    if &#40;ref $dest eq &#39;&#39; and $dest&#41;
     {
        my $fh = new IO::File;
        $fh-&gt;open&#40;$dest, &#39;&gt;&#39;&#41; or die &#34;Pod::Tree::HTML::new: Can&#39;t open $dest: $!\n&#34;;
--- t/html.t.orig       2007-06-24 16:57:52.000000000 +0200
+++ t/html.t
@@ -3,6 +3,7 @@
 use strict;
 use diagnostics;
 use HTML::Stream;
+use IO::String;
 use Pod::Tree;
 use Pod::Tree::HTML;
 
@@ -97,7 +98,7 @@ sub Dest1
        $html-&gt;translate;
 
     my $expected = ReadFile&#40;&#34;$Dir/paragraph.exp&#34;&#41;;
-       $$actual eq $expected or Not; OK;
+       ${$actual-&gt;string_ref} eq $expected or Not; OK;
 }
 
 sub Dest2
@@ -122,7 +123,7 @@ sub Dest3
        $html-&gt;translate;
 
     my $expected = ReadFile&#40;&#34;$Dir/paragraph.exp&#34;&#41;;
-    my $actual   = $$string;
+    my $actual   = ${$string-&gt;string_ref};
        $actual eq $expected or Not; OK;
 }
 
@@ -265,19 +266,3 @@ sub WriteFile
     close FILE;
     chmod 0644, $file or die &#34;Can&#39;t chmod $file: $!\n&#34;;
 }
-
-
-package IO::String;
-
-sub new 
-{
-    my $self = &#39;&#39;;
-    bless \$self, shift;
-}
-
-sub print 
-{
-    my $self = shift;
-    $$self .= join&#40;&#39;&#39;, @_&#41;;
-}
-    
--- Makefile.PL.orig    2008-08-08 01:02:27.000000000 +0200
+++ Makefile.PL
@@ -16,5 +16,6 @@ WriteMakefile&#40;NAME          =&gt; &#39;Pod::Tree&#39;,
              EXE_FILES       =&gt; [qw&#40;podtree2html pods2html perl2html&#41;],
              PREREQ_PM       =&gt; { HTML::Stream   =&gt; 1.49,
                                   Pod::Escapes   =&gt; 1.02,
+                                  IO::String     =&gt; 0,
                                   Text::Template =&gt; 1      },
 &#41;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;10&nbsp;23:21:10&nbsp;2009</span>
    <span class="description">SWMCD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">180 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Should be fixed in Pod-Tree 1.16
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;10&nbsp;23:21:11&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;10&nbsp;23:21:12&nbsp;2009</span>
    <span class="description">SWMCD [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Give odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;10&nbsp;23:21:13&nbsp;2009</span>
    <span class="description">SWMCD [...] cpan.org -  Given to SWMCD</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
