<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #125331 for DBIx-Class: [RFE] support for window functions</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #125331 for DBIx-Class: [RFE] support for window functions</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBIx-Class">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBIx-Class">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBIx-Class">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBIx-Class">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBIx-Class">DBIx-Class CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">125331</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBIx-Class">DBIx-Class</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
rrwo [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10410-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10411-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=125331">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1786505" href="/Public/Bug/Display.html?id=125331#txn-1786505">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;16&nbsp;19:39:04&nbsp;2018</span>
    <span class="description">rrwo [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [RFE] support for window functions</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 17 May 2018 00:38:54 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Robert Rothenberg &lt;rrwo [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1786505/960873/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/960873">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 465b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
It would be nice to have support for window functions, e.g.

   ROW_NUMBER&#40;&#41; OVER &#40; PARTITION BY some_column ORDER BY other &#41;

It could probably be handled by allowing sn &#34;-over&#34; key in a select clause, e.g.

   $rs-&gt;select_rs&#40;
     ...,
     {
       &#39;+select&#39; =&gt; [

          row_number =&gt; [],
          -over =&gt; {
             partition_by =&gt; [...], # same as group_by
             order_by =&gt; [...],     # same as order_by
          },

        ],
     }
   &#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1786546" href="/Public/Bug/Display.html?id=125331#txn-1786546">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;17&nbsp;02:45:56&nbsp;2018</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #125331] [RFE] support for window functions</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 17 May 2018 08:44:58 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Rabbitson &lt;ribasushi [...] leporine.io&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1786546/960916/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/960916">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 05/17/2018 01:39 AM, Robert Rothenberg via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It would be nice to have support for window functions, e.g.
&gt; 
&gt;     ROW_NUMBER&#40;&#41; OVER &#40; PARTITION BY some_column ORDER BY other &#41;
&gt; 
&gt; It could probably be handled by allowing sn &#34;-over&#34; key in a select clause, e.g.
&gt; 
&gt;     $rs-&gt;select_rs&#40;
&gt;       ...,
&gt;       {
&gt;         &#39;+select&#39; =&gt; [
&gt; 
&gt;            row_number =&gt; [],
&gt;            -over =&gt; {
&gt;               partition_by =&gt; [...], # same as group_by
&gt;               order_by =&gt; [...],     # same as order_by
&gt;            },
&gt; 
&gt;          ],
&gt;       }
&gt;     &#41;
&gt; 
</div>
Generally the core API strives to remain tethered to &#34;lowest common 
denominator&#34; of what various SQL databases would understand. There have 
been attempts to add rdbms-specific syntax, all of them turned out 
rather... badly.

At the same time it should be beyond trivial and much safer from an 
experimentation angle to make an external ResultSet component which 
implements pre-parsing of attributes handed to search_rs&#40;&#41;.

Is there a reason why you didn&#39;t consider going the route of an 
extension? Let me know your thoughts!

P.S. An example implementation of such an extension: 
<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/FREW/DBIx-Class-Helpers-2.033004/lib/DBIx/Class/Helper/ResultSet/RemoveColumns.pm">https://metacpan.org/source/FREW/DBIx-Class-Helpers-2.033004/lib/DBIx/Class/Helper/ResultSet/RemoveColumns.pm</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1786547" href="/Public/Bug/Display.html?id=125331#txn-1786547">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;17&nbsp;02:45:56&nbsp;2018</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1786558" href="/Public/Bug/Display.html?id=125331#txn-1786558">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;17&nbsp;03:31:34&nbsp;2018</span>
    <span class="description">rrwo [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #125331] [RFE] support for window functions</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 17 May 2018 08:31:20 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Robert Rothenberg &lt;rrwo [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1786558/960924/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/960924">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Window functions are part of SQL &#40;2003?&#41; standard, and are one of the 
fallbacks used for implementing limits in DBIx::Class.

There&#39;s a difference between supporting a feature that some databases do not 
support vs requiring it.


I didn&#39;t consider an extension, but I will look into it.

On 17/05/18 07:45, Peter Rabbitson via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125331">https://rt.cpan.org/Ticket/Display.html?id=125331</a></span> &gt;
&gt; 
&gt; On 05/17/2018 01:39 AM, Robert Rothenberg via RT wrote:
&gt; 
<div class="message-stanza open">&gt;&gt; It would be nice to have support for window functions, e.g.
&gt;&gt;
&gt;&gt;      ROW_NUMBER&#40;&#41; OVER &#40; PARTITION BY some_column ORDER BY other &#41;
&gt;&gt;
&gt;&gt; It could probably be handled by allowing sn &#34;-over&#34; key in a select clause, e.g.
&gt;&gt;
&gt;&gt;      $rs-&gt;select_rs&#40;
&gt;&gt;        ...,
&gt;&gt;        {
&gt;&gt;          &#39;+select&#39; =&gt; [
&gt;&gt;
&gt;&gt;             row_number =&gt; [],
&gt;&gt;             -over =&gt; {
&gt;&gt;                partition_by =&gt; [...], # same as group_by
&gt;&gt;                order_by =&gt; [...],     # same as order_by
&gt;&gt;             },
&gt;&gt;
&gt;&gt;           ],
&gt;&gt;        }
&gt;&gt;      &#41;
&gt;&gt;
</div>&gt; 
&gt; Generally the core API strives to remain tethered to &#34;lowest common
&gt; denominator&#34; of what various SQL databases would understand. There have
&gt; been attempts to add rdbms-specific syntax, all of them turned out
&gt; rather... badly.
&gt; 
&gt; At the same time it should be beyond trivial and much safer from an
&gt; experimentation angle to make an external ResultSet component which
&gt; implements pre-parsing of attributes handed to search_rs&#40;&#41;.
&gt; 
&gt; Is there a reason why you didn&#39;t consider going the route of an
&gt; extension? Let me know your thoughts!
&gt; 
&gt; P.S. An example implementation of such an extension:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/FREW/DBIx-Class-Helpers-2.033004/lib/DBIx/Class/Helper/ResultSet/RemoveColumns.pm">https://metacpan.org/source/FREW/DBIx-Class-Helpers-2.033004/lib/DBIx/Class/Helper/ResultSet/RemoveColumns.pm</a></span>
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1786560" href="/Public/Bug/Display.html?id=125331#txn-1786560">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;17&nbsp;03:44:35&nbsp;2018</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #125331] [RFE] support for window functions</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 17 May 2018 09:44:02 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Rabbitson &lt;ribasushi [...] leporine.io&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1786560/960926/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/960926">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 05/17/2018 09:31 AM, Robert Rothenberg via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: DBIx-Class
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125331">https://rt.cpan.org/Ticket/Display.html?id=125331</a></span> &gt;
&gt; 
&gt; 
&gt; Window functions are part of SQL &#40;2003?&#41; standard, and are one of the
&gt; fallbacks used for implementing limits in DBIx::Class.
</div>
Not a fallback, but rather convoluted mechanism which is designed to be 
fully encapsulated / non-reusable and is activated in very tightly 
controlled circumstances.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There&#39;s a difference between supporting a feature that some databases do not
&gt; support vs requiring it.
&gt; 
</div>
The current context is not about supporting a standardized feature that 
has several outliers. It is about not mixing things that are truly 
standard with things that are standardized only on paper in the same 
API. In reality there is essentially no window function expression that 
you can take from one engine and run on another. Add to that that they 
are in general poorly supported &#40; only Pg and Oracle have sufficiently 
similar syntax iirc, with MSSQLServer having something similar yet 
different, but I have not looked at this for about 3 years, so don&#39;t 
take my word on it &#41;.

Bottom line is that I am not comfortable extending the main DBIC API 
surface into &#34;one-off&#34; territory &#40; and while I understand the sentiment 
of &#34;but the standard says...&#34; - I strongly disagree with it &#41;.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I didn&#39;t consider an extension, but I will look into it.
</div>
If you run into major difficulties creating an extension - we should 
definitely look into providing whatever foundation is missing.

I will keep this ticket open for a while, to serve as a spot to 
coordinate whatever further questions may arise

Cheers!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1786564" href="/Public/Bug/Display.html?id=125331#txn-1786564">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;17&nbsp;04:08:55&nbsp;2018</span>
    <span class="description">robrwo [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #125331] [RFE] support for window functions</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 17 May 2018 09:08:37 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org, rrwo [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Robert Rothenberg &lt;robrwo [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1786564/960929/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/960929">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
I&#39;m not sure how modifying the ResultSet will be able to add how SQL is 
generated.

It could call the &#40;private&#41; sql_maker methods for handling the select fields 
to generate the function SQL, but that seems like more of a hack than just 
subclassing DBIx::Class::SQLMaker and changing to that class in storage.

Ideally, it would be nice to have an easy way to apply plugins without 
resorting to monkey-patching.



On 17/05/18 08:44, Peter Rabbitson via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125331">https://rt.cpan.org/Ticket/Display.html?id=125331</a></span> &gt;
&gt; 
&gt; On 05/17/2018 09:31 AM, Robert Rothenberg via RT wrote:
<div class="message-stanza open">&gt;&gt;          Queue: DBIx-Class
&gt;&gt;    Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125331">https://rt.cpan.org/Ticket/Display.html?id=125331</a></span> &gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; Window functions are part of SQL &#40;2003?&#41; standard, and are one of the
&gt;&gt; fallbacks used for implementing limits in DBIx::Class.
</div>&gt; 
&gt; Not a fallback, but rather convoluted mechanism which is designed to be
&gt; fully encapsulated / non-reusable and is activated in very tightly
&gt; controlled circumstances.
&gt; 
<div class="message-stanza open">&gt;&gt; There&#39;s a difference between supporting a feature that some databases do not
&gt;&gt; support vs requiring it.
&gt;&gt;
</div>&gt; 
&gt; The current context is not about supporting a standardized feature that
&gt; has several outliers. It is about not mixing things that are truly
&gt; standard with things that are standardized only on paper in the same
&gt; API. In reality there is essentially no window function expression that
&gt; you can take from one engine and run on another. Add to that that they
&gt; are in general poorly supported &#40; only Pg and Oracle have sufficiently
&gt; similar syntax iirc, with MSSQLServer having something similar yet
&gt; different, but I have not looked at this for about 3 years, so don&#39;t
&gt; take my word on it &#41;.
&gt; 
&gt; Bottom line is that I am not comfortable extending the main DBIC API
&gt; surface into &#34;one-off&#34; territory &#40; and while I understand the sentiment
&gt; of &#34;but the standard says...&#34; - I strongly disagree with it &#41;.
&gt; 
&gt; 
<div class="message-stanza open">&gt;&gt; I didn&#39;t consider an extension, but I will look into it.
</div>&gt; 
&gt; If you run into major difficulties creating an extension - we should
&gt; definitely look into providing whatever foundation is missing.
&gt; 
&gt; I will keep this ticket open for a while, to serve as a spot to
&gt; coordinate whatever further questions may arise
&gt; 
&gt; Cheers!
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1786574" href="/Public/Bug/Display.html?id=125331#txn-1786574">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;17&nbsp;04:19:52&nbsp;2018</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #125331] [RFE] support for window functions</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 17 May 2018 10:19:31 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Rabbitson &lt;ribasushi [...] leporine.io&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1786574/960935/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/960935">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 671b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 05/17/2018 10:08 AM, Robert Rothenberg via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: DBIx-Class
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125331">https://rt.cpan.org/Ticket/Display.html?id=125331</a></span> &gt;
&gt; 
&gt; 
&gt; I&#39;m not sure how modifying the ResultSet will be able to add how SQL is
&gt; generated.
&gt; 
</div>
No monkeypatching was suggested / would be required. Your hook  would 
inject the already-rendered SQL &#40; possibly by re-usin 
$rs-&gt;result_source-&gt;schema-&gt;storage-&gt;sql_maker &#41; into the appropriate 
part of the search&#40;&#41; attr stack as literals, before passing the call 
further.

I.e. you can and should rely on this mechanism:
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/Perl5/DBIx-Class/blob/dc7d89911/lib/DBIx/Class/Storage/DBIHacks.pm#L398-L411">https://github.com/Perl5/DBIx-Class/blob/dc7d89911/lib/DBIx/Class/Storage/DBIHacks.pm#L398-L411</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1787430" href="/Public/Bug/Display.html?id=125331#txn-1787430">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;22&nbsp;08:32:37&nbsp;2018</span>
    <span class="description">rrwo [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #125331] [RFE] support for window functions</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 22 May 2018 13:32:09 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Robert Rothenberg &lt;rrwo [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1787430/961422/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/961422">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
I have a prototype at 
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/robrwo/DBIx-Class-Helper-ResultSet-WindowFunctions">https://github.com/robrwo/DBIx-Class-Helper-ResultSet-WindowFunctions</a></span>

It still needs some work. Notably, I&#39;m not sure how to add the 
current_source_alias to column names in the generated SQL.

Note that the tests just use SQLite so that it can test SQL generation. 
Obviously window functions are not &#40;yet&#41; supported by it.



On 17/05/18 09:19, Peter Rabbitson via RT wrote:


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125331">https://rt.cpan.org/Ticket/Display.html?id=125331</a></span> &gt;
&gt; 
&gt; On 05/17/2018 10:08 AM, Robert Rothenberg via RT wrote:
<div class="message-stanza open">&gt;&gt;          Queue: DBIx-Class
&gt;&gt;    Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125331">https://rt.cpan.org/Ticket/Display.html?id=125331</a></span> &gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; I&#39;m not sure how modifying the ResultSet will be able to add how SQL is
&gt;&gt; generated.
&gt;&gt;
</div>&gt; 
&gt; No monkeypatching was suggested / would be required. Your hook  would
&gt; inject the already-rendered SQL &#40; possibly by re-usin
&gt; $rs-&gt;result_source-&gt;schema-&gt;storage-&gt;sql_maker &#41; into the appropriate
&gt; part of the search&#40;&#41; attr stack as literals, before passing the call
&gt; further.
&gt; 
&gt; I.e. you can and should rely on this mechanism:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/Perl5/DBIx-Class/blob/dc7d89911/lib/DBIx/Class/Storage/DBIHacks.pm#L398-L411">https://github.com/Perl5/DBIx-Class/blob/dc7d89911/lib/DBIx/Class/Storage/DBIHacks.pm#L398-L411</a></span>
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1787438" href="/Public/Bug/Display.html?id=125331#txn-1787438">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;22&nbsp;09:17:56&nbsp;2018</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #125331] [RFE] support for window functions</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 22 May 2018 15:17:36 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Rabbitson &lt;ribasushi [...] leporine.io&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1787438/961424/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/961424">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 05/22/2018 02:32 PM, Robert Rothenberg via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: DBIx-Class
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125331">https://rt.cpan.org/Ticket/Display.html?id=125331</a></span> &gt;
&gt; 
&gt; 
&gt; I have a prototype at
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/robrwo/DBIx-Class-Helper-ResultSet-WindowFunctions">https://github.com/robrwo/DBIx-Class-Helper-ResultSet-WindowFunctions</a></span>
</div>
You got the right idea, yes. However, I would first call 
$rs-&gt;next::method, and then operate on it result: it already would have 
normalized the select/all lists, unpacking the columns attributes as 
appropriate. I.e. all this work: 
<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/RIBASUSHI/DBIx-Class-0.082841/lib/DBIx/Class/ResultSet.pm#L3528-3592">https://metacpan.org/source/RIBASUSHI/DBIx-Class-0.082841/lib/DBIx/Class/ResultSet.pm#L3528-3592</a></span>

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; It still needs some work. Notably, I&#39;m not sure how to add the
&gt; current_source_alias to column names in the generated SQL.
</div>
What do you mean? You already have $rs-&gt;current_source_alias at your 
disposal in that method...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Note that the tests just use SQLite so that it can test SQL generation.
&gt; Obviously window functions are not &#40;yet&#41; supported by it.
&gt; 
</div>
Try to avoid `like $sql, ...` constructs in tests, as they would fail in 
the face of small non-semantic changes the generated SQL &#40; it happens 
rarely, but it happens &#41;. Instead I would strongly suggest using: 
<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/pod/release/RIBASUSHI/SQL-Abstract-1.81/lib/SQL/Abstract/Test.pm#SYNOPSIS">https://metacpan.org/pod/release/RIBASUSHI/SQL-Abstract-1.81/lib/SQL/Abstract/Test.pm#SYNOPSIS</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1787441" href="/Public/Bug/Display.html?id=125331#txn-1787441">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;22&nbsp;09:46:57&nbsp;2018</span>
    <span class="description">rrwo [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #125331] [RFE] support for window functions</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 22 May 2018 14:46:33 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Robert Rothenberg &lt;rrwo [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1787441/961427/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/961427">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 22/05/18 14:17, Peter Rabbitson via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125331">https://rt.cpan.org/Ticket/Display.html?id=125331</a></span> &gt;
&gt; 
&gt; On 05/22/2018 02:32 PM, Robert Rothenberg via RT wrote:
<div class="message-stanza open">&gt;&gt;          Queue: DBIx-Class
&gt;&gt;    Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125331">https://rt.cpan.org/Ticket/Display.html?id=125331</a></span> &gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; I have a prototype at
&gt;&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/robrwo/DBIx-Class-Helper-ResultSet-WindowFunctions">https://github.com/robrwo/DBIx-Class-Helper-ResultSet-WindowFunctions</a></span>
</div>&gt; 
&gt; You got the right idea, yes. However, I would first call
&gt; $rs-&gt;next::method, and then operate on it result: it already would have
&gt; normalized the select/all lists, unpacking the columns attributes as
&gt; appropriate. I.e. all this work:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/RIBASUSHI/DBIx-Class-0.082841/lib/DBIx/Class/ResultSet.pm#L3528-3592">https://metacpan.org/source/RIBASUSHI/DBIx-Class-0.082841/lib/DBIx/Class/ResultSet.pm#L3528-3592</a></span>
</div>
If I don&#39;t remove the &#34;-over&#34; argument, I get the following error:

  DBIx::Class::SQLMaker::_recurse_fields&#40;&#41;: Malformed select argument - too 
many keys in hash: -as,-over,rank at t/01-basic.t line 28



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt;&gt;
&gt;&gt; It still needs some work. Notably, I&#39;m not sure how to add the
&gt;&gt; current_source_alias to column names in the generated SQL.
</div>&gt; 
&gt; What do you mean? You already have $rs-&gt;current_source_alias at your
&gt; disposal in that method...
</div>
Yes, but I&#39;d like to avoid duplucating existing code.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt;
&gt;&gt; Note that the tests just use SQLite so that it can test SQL generation.
&gt;&gt; Obviously window functions are not &#40;yet&#41; supported by it.
&gt;&gt;
</div>&gt; 
&gt; Try to avoid `like $sql, ...` constructs in tests, as they would fail in
&gt; the face of small non-semantic changes the generated SQL &#40; it happens
&gt; rarely, but it happens &#41;. Instead I would strongly suggest using:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/pod/release/RIBASUSHI/SQL-Abstract-1.81/lib/SQL/Abstract/Test.pm#SYNOPSIS">https://metacpan.org/pod/release/RIBASUSHI/SQL-Abstract-1.81/lib/SQL/Abstract/Test.pm#SYNOPSIS</a></span>
&gt; 
</div>
Thanks.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1787443" href="/Public/Bug/Display.html?id=125331#txn-1787443">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;22&nbsp;10:20:47&nbsp;2018</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #125331] [RFE] support for window functions</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 22 May 2018 16:20:25 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Rabbitson &lt;ribasushi [...] leporine.io&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1787443/961429/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/961429">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 05/22/2018 03:46 PM, Robert Rothenberg via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: DBIx-Class
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125331">https://rt.cpan.org/Ticket/Display.html?id=125331</a></span> &gt;
&gt; 
&gt; On 22/05/18 14:17, Peter Rabbitson via RT wrote:
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125331">https://rt.cpan.org/Ticket/Display.html?id=125331</a></span> &gt;
&gt;&gt;
&gt;&gt; On 05/22/2018 02:32 PM, Robert Rothenberg via RT wrote:
<div class="message-stanza open">&gt;&gt;&gt;           Queue: DBIx-Class
&gt;&gt;&gt;     Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125331">https://rt.cpan.org/Ticket/Display.html?id=125331</a></span> &gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; I have a prototype at
&gt;&gt;&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/robrwo/DBIx-Class-Helper-ResultSet-WindowFunctions">https://github.com/robrwo/DBIx-Class-Helper-ResultSet-WindowFunctions</a></span>
</div>&gt;&gt;
&gt;&gt; You got the right idea, yes. However, I would first call
&gt;&gt; $rs-&gt;next::method, and then operate on it result: it already would have
&gt;&gt; normalized the select/all lists, unpacking the columns attributes as
&gt;&gt; appropriate. I.e. all this work:
&gt;&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/RIBASUSHI/DBIx-Class-0.082841/lib/DBIx/Class/ResultSet.pm#L3528-3592">https://metacpan.org/source/RIBASUSHI/DBIx-Class-0.082841/lib/DBIx/Class/ResultSet.pm#L3528-3592</a></span>
</div>&gt; 
&gt; If I don&#39;t remove the &#34;-over&#34; argument, I get the following error:
&gt; 
&gt;    DBIx::Class::SQLMaker::_recurse_fields&#40;&#41;: Malformed select argument - too
&gt; many keys in hash: -as,-over,rank at t/01-basic.t line 28
&gt; 
</div>
I see... hm hm hm. For the time being leaving things as-you-wrote-them 
would make most sense, but gives me food for thought


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt;
<div class="message-stanza open">&gt;&gt;&gt;
&gt;&gt;&gt; It still needs some work. Notably, I&#39;m not sure how to add the
&gt;&gt;&gt; current_source_alias to column names in the generated SQL.
</div>&gt;&gt;
&gt;&gt; What do you mean? You already have $rs-&gt;current_source_alias at your
&gt;&gt; disposal in that method...
</div>&gt; 
&gt; Yes, but I&#39;d like to avoid duplucating existing code.
&gt; 
</div>
Errr... you need to expand on that. From my perspective there is no 
specific handling of c_s_a aside from this: 
<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/RIBASUSHI/DBIx-Class-0.082841/lib/DBIx/Class/ResultSet.pm#L3564-3565">https://metacpan.org/source/RIBASUSHI/DBIx-Class-0.082841/lib/DBIx/Class/ResultSet.pm#L3564-3565</a></span>

You seem to see this as something more involved, thus my confusion...
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.531617</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
