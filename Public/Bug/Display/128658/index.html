<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #128658 for Net-OpenSSH: freebsd 11.2 bug</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #128658 for Net-OpenSSH: freebsd 11.2 bug</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-OpenSSH/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-OpenSSH/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-OpenSSH/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-OpenSSH/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-OpenSSH">Net-OpenSSH CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">128658</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-OpenSSH/Active/">Net-OpenSSH</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
avv314 [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-224796-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-224797-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;27&nbsp;15:09:16&nbsp;2019</span>
    <span class="description">avv314 [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> freebsd 11.2 bug</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 27 Feb 2019 23:08:51 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-OpenSSH [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Andrew Vylegzhanin &lt;avv314 [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi!
I&#39;ve successfully used Net::OpenSSH for couple years under FeeBSD
9.3-RELEASE.
It&#39;s simple perl script invoked by propraetry billing system for handling
external events by coping files via scp.
Here is fragment:

    open&#40; my $stderr_fh, &#34;&gt;&gt;&#34;, $LOGDIR.&#34;vg-arcd-ssh.log&#34; &#41; || warn &#34;Can&#39;t
log\n&#34;;

    my $tm = localtime;

    print $stderr_fh &#34;$tm [$$] \n&#34;;


    $Net::OpenSSH::debug_fh = $stderr_fh;

    $Net::OpenSSH::debug = ~0;

    my $ssh = Net::OpenSSH-&gt;new&#40; &#39;cptctrl@2.2.2.2:8844&#39;, default_stderr_fh
=&gt; $stderr_fh, default_stdout_fh =&gt; $stderr_fh, async =&gt; 0 &#41;;


    if&#40; $ssh-&gt;error &#41; {

        syslog&#40; &#34;Couldn&#39;t establish SSH connection: &#34;. $ssh-&gt;error &#41;;

        syslog&#40; &#34;Moving job file to queue&#34; &#41;;

        rename&#40; $DATADIR.$tmpfile, $DATADIR.&#34;jobs/&#34;.$tmpfile &#41;;

    }


    else {

        syslog&#40; &#34;DEBUG: before scp&#34; &#41;;

        $ssh-&gt;scp_put&#40; {async =&gt; 0, timeout =&gt; 10 }, $DATADIR.$tmpfile,
&#34;jobs&#34; &#41; || syslog&#40; &#34;DEBUG: scp failed: &#34; . $ssh-&gt;error &#41;;

        syslog&#40; &#34;DEBUG: after scp&#34; &#41;;

        if&#40; $ssh-&gt;error &#41; {

            syslog&#40; &#34;scp_put to remote host failed: &#34;.$ssh-&gt;error  &#41;;

            syslog&#40; &#34;Moving job file to queue&#34; &#41;;

            rename&#40; $DATADIR.$tmpfile, $DATADIR.&#34;jobs/&#34;.$tmpfile &#41;;

        }


        else {

            syslog&#40; &#34;Copied&#34; &#41;;

            unlink&#40; $DATADIR.$tmpfile &#41;;

        }

    }

After upgrading to FreeBSD 11.2-RELEASE I&#39;ve got following problem:
- when I run this script from command line &#40;from bash&#41;, everything is ok,
always.
- when this script invoked from billing system &#40;from FreeBSD process,
written on C++ mostly AFAIK&#41;, it&#39;s perl process ends without errors on
OpenSSH-&gt;new or after $ssh-&gt;scp_put &#40;so sometimes it copied files&#41;

Here is debug output from  $Net::OpenSSH::debug = ~0

From command line:

# open_ex: [&#39;ssh&#39;,&#39;-V&#39;]

# io3 mloop, cin: 0, cout: 1, cerr: 0

# io3 fast, cin: 0, cout: 1, cerr: 0

# stdout, bytes read: 51 at offset 0

#&gt; 4f 70 65 6e 53 53 48 5f 37 2e 35 70 31 2c 20 4f 70 65 6e 53 53 4c 20 31
2e 30 2e 32 6f 2d 66 72 | OpenSSH_7.5p1, OpenSSL 1.0.2o-fr

#&gt; 65 65 62 73 64 20 20 32 37 20 4d 61 72 20 32 30 31 38 0a
                        | eebsd  27 Mar 2018.

# io3 fast, cin: 0, cout: 1, cerr: 0

# stdout, bytes read: 0 at offset 51

# leaving _io3&#40;&#41;

# _waitpid&#40;50657&#41; =&gt; pid: 50657, rc: 0, err:

# OpenSSH version is 7.5p1,

# ctl_path: /root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
ctl_dir: /root/.libnet-openssh-perl/

# _is_secure_path&#40;dir: /root/.libnet-openssh-perl, file mode: 16832, file
uid: 0, euid: 0

# _is_secure_path&#40;dir: /root, file mode: 16877, file uid: 0, euid: 0

# set_error&#40;0 - 0&#41;

# call args:
[&#39;ssh&#39;,&#39;-o&#39;,&#39;ServerAliveInterval=30&#39;,&#39;-o&#39;,&#39;ControlPersist=no&#39;,&#39;-2MNx&#39;,&#39;-S&#39;,&#39;/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb&#39;,&#39;-l&#39;,&#39;cptctrl&#39;,&#39;-p&#39;,&#39;8844&#39;,&#39;2.2.2.2&#39;,&#39;--&#39;]

# tracer attached, ssh pid: 50658, tracer pid: 50659

# master state jumping from _STATE_START to _STATE_AWAITING_MUX

# file object not yet found at
/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
state:_STATE_AWAITING_MUX

# file object not yet found at
/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
state:_STATE_AWAITING_MUX

# file object not yet found at
/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
state:_STATE_AWAITING_MUX

# file object not yet found at
/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
state:_STATE_AWAITING_MUX

# file object not yet found at
/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
state:_STATE_AWAITING_MUX

# file object not yet found at
/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
state:_STATE_AWAITING_MUX

# file object not yet found at
/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
state:_STATE_AWAITING_MUX

# file object not yet found at
/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
state:_STATE_AWAITING_MUX

# file object not yet found at
/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
state:_STATE_AWAITING_MUX

# file object not yet found at
/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
state:_STATE_AWAITING_MUX

# file object not yet found at
/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
state:_STATE_AWAITING_MUX

# file object not yet found at
/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
state:_STATE_AWAITING_MUX

# file object not yet found at
/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
state:_STATE_AWAITING_MUX

# file object not yet found at
/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
state:_STATE_AWAITING_MUX

# file object not yet found at
/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
state:_STATE_AWAITING_MUX

# file object not yet found at
/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
state:_STATE_AWAITING_MUX

# file object not yet found at
/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
state:_STATE_AWAITING_MUX

# file object not yet found at
/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
state:_STATE_AWAITING_MUX

# file object found at
/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb

# master state jumping from _STATE_AWAITING_MUX to _STATE_RUNNING

# call args:
[&#39;ssh&#39;,&#39;-O&#39;,&#39;check&#39;,&#39;-T&#39;,&#39;-S&#39;,&#39;/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb&#39;,&#39;-l&#39;,&#39;cptctrl&#39;,&#39;-p&#39;,&#39;8844&#39;,&#39;2.2.2.2&#39;,&#39;--&#39;]

# open_ex:
[&#39;ssh&#39;,&#39;-O&#39;,&#39;check&#39;,&#39;-T&#39;,&#39;-S&#39;,&#39;/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb&#39;,&#39;-l&#39;,&#39;cptctrl&#39;,&#39;-p&#39;,&#39;8844&#39;,&#39;2.2.2.2

# io3 mloop, cin: 0, cout: 1, cerr: 0

# io3 fast, cin: 0, cout: 1, cerr: 0

# stdout, bytes read: 28 at offset 0

#&gt; 4d 61 73 74 65 72 20 72 75 6e 6e 69 6e 67 20 28 70 69 64 3d 35 30 36 35
38 29 0d 0a             | Master running &#40;pid=50658&#41;..

# io3 fast, cin: 0, cout: 1, cerr: 0

# stdout, bytes read: 0 at offset 28

# leaving _io3&#40;&#41;

# _waitpid&#40;50668&#41; =&gt; pid: 50668, rc: 0, err:

# scp call args:
[&#39;scp&#39;,&#39;-q&#39;,&#39;-o&#39;,&#39;ControlPath=/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb&#39;,&#39;-S&#39;,&#39;ssh&#39;,&#39;-P&#39;,&#39;8844&#39;,&#39;--&#39;,&#39;/prov/tsey/cpt.job.50656r&#39;,&#39;cptctrl@2.2.2.2:
jobs&#39;]

# open_ex:
[&#39;scp&#39;,&#39;-q&#39;,&#39;-o&#39;,&#39;ControlPath=/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb&#39;,&#39;-S&#39;,&#39;ssh&#39;,&#39;-P&#39;,&#39;8844&#39;,&#39;--&#39;,&#39;/prov/tsey/cpt.job.50656r&#39;,&#39;cptctrl@2.2.2.2:
jobs&#39;]

# _waitpid&#40;50669&#41; =&gt; pid: 50669, rc: 0, err: Interrupted system call

# DESTROY&#40;Net::OpenSSH=HASH&#40;0x80259f288&#41;, pid: 50658&#41;

# sending exit control to master

# call args:
[&#39;ssh&#39;,&#39;-O&#39;,&#39;exit&#39;,&#39;-T&#39;,&#39;-S&#39;,&#39;/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb&#39;,&#39;-l&#39;,&#39;cptctrl&#39;,&#39;-p&#39;,&#39;8844&#39;,&#39;2.2.2.2&#39;,&#39;--&#39;]

# open_ex:
[&#39;ssh&#39;,&#39;-O&#39;,&#39;exit&#39;,&#39;-T&#39;,&#39;-S&#39;,&#39;/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb&#39;,&#39;-l&#39;,&#39;cptctrl&#39;,&#39;-p&#39;,&#39;8844&#39;,&#39;2.2.2.2&#39;,&#39;--&#39;]

# io3 mloop, cin: 0, cout: 1, cerr: 0

# io3 fast, cin: 0, cout: 1, cerr: 0

# stdout, bytes read: 20 at offset 0

#&gt; 45 78 69 74 20 72 65 71 75 65 73 74 20 73 65 6e 74 2e 0d 0a
                        | Exit request sent...

# io3 fast, cin: 0, cout: 1, cerr: 0

# stdout, bytes read: 0 at offset 20

# leaving _io3&#40;&#41;

# _waitpid&#40;50671&#41; =&gt; pid: 50671, rc: 0, err:

# set_error&#40;1 - aborted&#41;

# master state jumping from _STATE_RUNNING to _STATE_KILLING

# killing master

# _master_kill: 50658

# waitpid&#40;master: 50658&#41; =&gt; pid: 0, rc:

# waitpid&#40;master: 50658&#41; =&gt; pid: 50658, rc: Interrupted system call

# master state jumping from _STATE_KILLING to _STATE_GONE


Invoked from billing system:

# open_ex: [&#39;ssh&#39;,&#39;-V&#39;]

# io3 mloop, cin: 0, cout: 1, cerr: 0

# io3 fast, cin: 0, cout: 1, cerr: 0

# stdout, bytes read: 51 at offset 0

#&gt; 4f 70 65 6e 53 53 48 5f 37 2e 35 70 31 2c 20 4f 70 65 6e 53 53 4c 20 31
2e 30 2e 32 6f 2d 66 72 | OpenSSH_7.5p1, OpenSSL 1.0.2o-fr

#&gt; 65 65 62 73 64 20 20 32 37 20 4d 61 72 20 32 30 31 38 0a
                        | eebsd  27 Mar 2018.

# io3 fast, cin: 0, cout: 1, cerr: 0

# stdout, bytes read: 0 at offset 51

# leaving _io3&#40;&#41;

# _waitpid&#40;62488&#41; =&gt; pid: 62488, rc: 0, err:

# OpenSSH version is 7.5p1,

# ctl_path: /root/.libnet-openssh-perl/ca9523a03741dc7955578d7fb1933c0d,
ctl_dir: /root/.libnet-openssh-perl/

# _is_secure_path&#40;dir: /root/.libnet-openssh-perl, file mode: 16832, file
uid: 0, euid: 0

# _is_secure_path&#40;dir: /root, file mode: 16877, file uid: 0, euid: 0

# set_error&#40;0 - 0&#41;

# call args:
[&#39;ssh&#39;,&#39;-o&#39;,&#39;ServerAliveInterval=30&#39;,&#39;-o&#39;,&#39;ControlPersist=no&#39;,&#39;-2MNx&#39;,&#39;-S&#39;,&#39;/root/.libnet-openssh-perl/ca9523a03741dc7955578d7fb1933c0d&#39;,&#39;-l&#39;,&#39;cptctrl&#39;,&#39;-p&#39;,&#39;8844&#39;,&#39;2.2.2.2&#39;,&#39;--&#39;]

# tracer attached, ssh pid: 62489, tracer pid: 62490

What I should look for?

--
Andrew
</div></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;01&nbsp;03:27:01&nbsp;2019</span>
    <span class="description">sfandino [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #128658] freebsd 11.2 bug</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 1 Mar 2019 09:26:46 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-OpenSSH [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Salvador Fandiño &lt;sfandino [...] yahoo.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On 2/27/19 9:09 PM, Andrew Vylegzhanin via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Wed Feb 27 15:09:16 2019: Request 128658 was acted upon.
&gt; Transaction: Ticket created by avv314@gmail.com
&gt;         Queue: Net-OpenSSH
&gt;       Subject: freebsd 11.2 bug
&gt;     Broken in: &#40;no value&#41;
&gt;      Severity: &#40;no value&#41;
&gt;         Owner: Nobody
&gt;    Requestors: avv314@gmail.com
&gt;        Status: new
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=128658">https://rt.cpan.org/Ticket/Display.html?id=128658</a></span> &gt;
&gt;
&gt;
&gt; Hi!
&gt; I&#39;ve successfully used Net::OpenSSH for couple years under FeeBSD
&gt; 9.3-RELEASE.
&gt; It&#39;s simple perl script invoked by propraetry billing system for handling
&gt; external events by coping files via scp.
&gt; Here is fragment:
&gt;
&gt;      open&#40; my $stderr_fh, &#34;&gt;&gt;&#34;, $LOGDIR.&#34;vg-arcd-ssh.log&#34; &#41; || warn &#34;Can&#39;t
&gt; log\n&#34;;
&gt;
&gt;      my $tm = localtime;
&gt;
&gt;      print $stderr_fh &#34;$tm [$$] \n&#34;;
&gt;
&gt;
&gt;      $Net::OpenSSH::debug_fh = $stderr_fh;
&gt;
&gt;      $Net::OpenSSH::debug = ~0;
&gt;
&gt;      my $ssh = Net::OpenSSH-&gt;new&#40; &#39;cptctrl@2.2.2.2:8844&#39;, default_stderr_fh
&gt; =&gt; $stderr_fh, default_stdout_fh =&gt; $stderr_fh, async =&gt; 0 &#41;;
&gt;
&gt;
&gt;      if&#40; $ssh-&gt;error &#41; {
&gt;
&gt;          syslog&#40; &#34;Couldn&#39;t establish SSH connection: &#34;. $ssh-&gt;error &#41;;
&gt;
&gt;          syslog&#40; &#34;Moving job file to queue&#34; &#41;;
&gt;
&gt;          rename&#40; $DATADIR.$tmpfile, $DATADIR.&#34;jobs/&#34;.$tmpfile &#41;;
&gt;
&gt;      }
&gt;
&gt;
&gt;      else {
&gt;
&gt;          syslog&#40; &#34;DEBUG: before scp&#34; &#41;;
&gt;
&gt;          $ssh-&gt;scp_put&#40; {async =&gt; 0, timeout =&gt; 10 }, $DATADIR.$tmpfile,
&gt; &#34;jobs&#34; &#41; || syslog&#40; &#34;DEBUG: scp failed: &#34; . $ssh-&gt;error &#41;;
&gt;
&gt;          syslog&#40; &#34;DEBUG: after scp&#34; &#41;;
&gt;
&gt;          if&#40; $ssh-&gt;error &#41; {
&gt;
&gt;              syslog&#40; &#34;scp_put to remote host failed: &#34;.$ssh-&gt;error  &#41;;
&gt;
&gt;              syslog&#40; &#34;Moving job file to queue&#34; &#41;;
&gt;
&gt;              rename&#40; $DATADIR.$tmpfile, $DATADIR.&#34;jobs/&#34;.$tmpfile &#41;;
&gt;
&gt;          }
&gt;
&gt;
&gt;          else {
&gt;
&gt;              syslog&#40; &#34;Copied&#34; &#41;;
&gt;
&gt;              unlink&#40; $DATADIR.$tmpfile &#41;;
&gt;
&gt;          }
&gt;
&gt;      }
&gt;
&gt; After upgrading to FreeBSD 11.2-RELEASE I&#39;ve got following problem:
&gt; - when I run this script from command line &#40;from bash&#41;, everything is ok,
&gt; always.
&gt; - when this script invoked from billing system &#40;from FreeBSD process,
&gt; written on C++ mostly AFAIK&#41;, it&#39;s perl process ends without errors on
&gt; OpenSSH-&gt;new or after $ssh-&gt;scp_put &#40;so sometimes it copied files&#41;
&gt;
&gt; Here is debug output from  $Net::OpenSSH::debug = ~0
&gt;
&gt;  From command line:
&gt;
&gt; # open_ex: [&#39;ssh&#39;,&#39;-V&#39;]
&gt;
&gt; # io3 mloop, cin: 0, cout: 1, cerr: 0
&gt;
&gt; # io3 fast, cin: 0, cout: 1, cerr: 0
&gt;
&gt; # stdout, bytes read: 51 at offset 0
&gt;
&gt; #&gt; 4f 70 65 6e 53 53 48 5f 37 2e 35 70 31 2c 20 4f 70 65 6e 53 53 4c 20 31
&gt; 2e 30 2e 32 6f 2d 66 72 | OpenSSH_7.5p1, OpenSSL 1.0.2o-fr
&gt;
&gt; #&gt; 65 65 62 73 64 20 20 32 37 20 4d 61 72 20 32 30 31 38 0a
&gt;                          | eebsd  27 Mar 2018.
&gt;
&gt; # io3 fast, cin: 0, cout: 1, cerr: 0
&gt;
&gt; # stdout, bytes read: 0 at offset 51
&gt;
&gt; # leaving _io3&#40;&#41;
&gt;
&gt; # _waitpid&#40;50657&#41; =&gt; pid: 50657, rc: 0, err:
&gt;
&gt; # OpenSSH version is 7.5p1,
&gt;
&gt; # ctl_path: /root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
&gt; ctl_dir: /root/.libnet-openssh-perl/
&gt;
&gt; # _is_secure_path&#40;dir: /root/.libnet-openssh-perl, file mode: 16832, file
&gt; uid: 0, euid: 0
&gt;
&gt; # _is_secure_path&#40;dir: /root, file mode: 16877, file uid: 0, euid: 0
&gt;
&gt; # set_error&#40;0 - 0&#41;
&gt;
&gt; # call args:
&gt; [&#39;ssh&#39;,&#39;-o&#39;,&#39;ServerAliveInterval=30&#39;,&#39;-o&#39;,&#39;ControlPersist=no&#39;,&#39;-2MNx&#39;,&#39;-S&#39;,&#39;/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb&#39;,&#39;-l&#39;,&#39;cptctrl&#39;,&#39;-p&#39;,&#39;8844&#39;,&#39;2.2.2.2&#39;,&#39;--&#39;]
&gt;
&gt; # tracer attached, ssh pid: 50658, tracer pid: 50659
&gt;
&gt; # master state jumping from _STATE_START to _STATE_AWAITING_MUX
&gt;
&gt; # file object not yet found at
&gt; /root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
&gt; state:_STATE_AWAITING_MUX
&gt;
&gt; # file object not yet found at
&gt; /root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
&gt; state:_STATE_AWAITING_MUX
&gt;
&gt; # file object not yet found at
&gt; /root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
&gt; state:_STATE_AWAITING_MUX
&gt;
&gt; # file object not yet found at
&gt; /root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
&gt; state:_STATE_AWAITING_MUX
&gt;
&gt; # file object not yet found at
&gt; /root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
&gt; state:_STATE_AWAITING_MUX
&gt;
&gt; # file object not yet found at
&gt; /root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
&gt; state:_STATE_AWAITING_MUX
&gt;
&gt; # file object not yet found at
&gt; /root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
&gt; state:_STATE_AWAITING_MUX
&gt;
&gt; # file object not yet found at
&gt; /root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
&gt; state:_STATE_AWAITING_MUX
&gt;
&gt; # file object not yet found at
&gt; /root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
&gt; state:_STATE_AWAITING_MUX
&gt;
&gt; # file object not yet found at
&gt; /root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
&gt; state:_STATE_AWAITING_MUX
&gt;
&gt; # file object not yet found at
&gt; /root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
&gt; state:_STATE_AWAITING_MUX
&gt;
&gt; # file object not yet found at
&gt; /root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
&gt; state:_STATE_AWAITING_MUX
&gt;
&gt; # file object not yet found at
&gt; /root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
&gt; state:_STATE_AWAITING_MUX
&gt;
&gt; # file object not yet found at
&gt; /root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
&gt; state:_STATE_AWAITING_MUX
&gt;
&gt; # file object not yet found at
&gt; /root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
&gt; state:_STATE_AWAITING_MUX
&gt;
&gt; # file object not yet found at
&gt; /root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
&gt; state:_STATE_AWAITING_MUX
&gt;
&gt; # file object not yet found at
&gt; /root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
&gt; state:_STATE_AWAITING_MUX
&gt;
&gt; # file object not yet found at
&gt; /root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb,
&gt; state:_STATE_AWAITING_MUX
&gt;
&gt; # file object found at
&gt; /root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb
&gt;
&gt; # master state jumping from _STATE_AWAITING_MUX to _STATE_RUNNING
&gt;
&gt; # call args:
&gt; [&#39;ssh&#39;,&#39;-O&#39;,&#39;check&#39;,&#39;-T&#39;,&#39;-S&#39;,&#39;/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb&#39;,&#39;-l&#39;,&#39;cptctrl&#39;,&#39;-p&#39;,&#39;8844&#39;,&#39;2.2.2.2&#39;,&#39;--&#39;]
&gt;
&gt; # open_ex:
&gt; [&#39;ssh&#39;,&#39;-O&#39;,&#39;check&#39;,&#39;-T&#39;,&#39;-S&#39;,&#39;/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb&#39;,&#39;-l&#39;,&#39;cptctrl&#39;,&#39;-p&#39;,&#39;8844&#39;,&#39;2.2.2.2
&gt;
&gt; # io3 mloop, cin: 0, cout: 1, cerr: 0
&gt;
&gt; # io3 fast, cin: 0, cout: 1, cerr: 0
&gt;
&gt; # stdout, bytes read: 28 at offset 0
&gt;
&gt; #&gt; 4d 61 73 74 65 72 20 72 75 6e 6e 69 6e 67 20 28 70 69 64 3d 35 30 36 35
&gt; 38 29 0d 0a             | Master running &#40;pid=50658&#41;..
&gt;
&gt; # io3 fast, cin: 0, cout: 1, cerr: 0
&gt;
&gt; # stdout, bytes read: 0 at offset 28
&gt;
&gt; # leaving _io3&#40;&#41;
&gt;
&gt; # _waitpid&#40;50668&#41; =&gt; pid: 50668, rc: 0, err:
&gt;
&gt; # scp call args:
&gt; [&#39;scp&#39;,&#39;-q&#39;,&#39;-o&#39;,&#39;ControlPath=/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb&#39;,&#39;-S&#39;,&#39;ssh&#39;,&#39;-P&#39;,&#39;8844&#39;,&#39;--&#39;,&#39;/prov/tsey/cpt.job.50656r&#39;,&#39;cptctrl@2.2.2.2:
&gt; jobs&#39;]
&gt;
&gt; # open_ex:
&gt; [&#39;scp&#39;,&#39;-q&#39;,&#39;-o&#39;,&#39;ControlPath=/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb&#39;,&#39;-S&#39;,&#39;ssh&#39;,&#39;-P&#39;,&#39;8844&#39;,&#39;--&#39;,&#39;/prov/tsey/cpt.job.50656r&#39;,&#39;cptctrl@2.2.2.2:
&gt; jobs&#39;]
&gt;
&gt; # _waitpid&#40;50669&#41; =&gt; pid: 50669, rc: 0, err: Interrupted system call
&gt;
&gt; # DESTROY&#40;Net::OpenSSH=HASH&#40;0x80259f288&#41;, pid: 50658&#41;
&gt;
&gt; # sending exit control to master
&gt;
&gt; # call args:
&gt; [&#39;ssh&#39;,&#39;-O&#39;,&#39;exit&#39;,&#39;-T&#39;,&#39;-S&#39;,&#39;/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb&#39;,&#39;-l&#39;,&#39;cptctrl&#39;,&#39;-p&#39;,&#39;8844&#39;,&#39;2.2.2.2&#39;,&#39;--&#39;]
&gt;
&gt; # open_ex:
&gt; [&#39;ssh&#39;,&#39;-O&#39;,&#39;exit&#39;,&#39;-T&#39;,&#39;-S&#39;,&#39;/root/.libnet-openssh-perl/0c3865501b7c522fd3404c3e5c0e36cb&#39;,&#39;-l&#39;,&#39;cptctrl&#39;,&#39;-p&#39;,&#39;8844&#39;,&#39;2.2.2.2&#39;,&#39;--&#39;]
&gt;
&gt; # io3 mloop, cin: 0, cout: 1, cerr: 0
&gt;
&gt; # io3 fast, cin: 0, cout: 1, cerr: 0
&gt;
&gt; # stdout, bytes read: 20 at offset 0
&gt;
&gt; #&gt; 45 78 69 74 20 72 65 71 75 65 73 74 20 73 65 6e 74 2e 0d 0a
&gt;                          | Exit request sent...
&gt;
&gt; # io3 fast, cin: 0, cout: 1, cerr: 0
&gt;
&gt; # stdout, bytes read: 0 at offset 20
&gt;
&gt; # leaving _io3&#40;&#41;
&gt;
&gt; # _waitpid&#40;50671&#41; =&gt; pid: 50671, rc: 0, err:
&gt;
&gt; # set_error&#40;1 - aborted&#41;
&gt;
&gt; # master state jumping from _STATE_RUNNING to _STATE_KILLING
&gt;
&gt; # killing master
&gt;
&gt; # _master_kill: 50658
&gt;
&gt; # waitpid&#40;master: 50658&#41; =&gt; pid: 0, rc:
&gt;
&gt; # waitpid&#40;master: 50658&#41; =&gt; pid: 50658, rc: Interrupted system call
&gt;
&gt; # master state jumping from _STATE_KILLING to _STATE_GONE
&gt;
&gt;
&gt; Invoked from billing system:
&gt;
&gt; # open_ex: [&#39;ssh&#39;,&#39;-V&#39;]
&gt;
&gt; # io3 mloop, cin: 0, cout: 1, cerr: 0
&gt;
&gt; # io3 fast, cin: 0, cout: 1, cerr: 0
&gt;
&gt; # stdout, bytes read: 51 at offset 0
&gt;
&gt; #&gt; 4f 70 65 6e 53 53 48 5f 37 2e 35 70 31 2c 20 4f 70 65 6e 53 53 4c 20 31
&gt; 2e 30 2e 32 6f 2d 66 72 | OpenSSH_7.5p1, OpenSSL 1.0.2o-fr
&gt;
&gt; #&gt; 65 65 62 73 64 20 20 32 37 20 4d 61 72 20 32 30 31 38 0a
&gt;                          | eebsd  27 Mar 2018.
&gt;
&gt; # io3 fast, cin: 0, cout: 1, cerr: 0
&gt;
&gt; # stdout, bytes read: 0 at offset 51
&gt;
&gt; # leaving _io3&#40;&#41;
&gt;
&gt; # _waitpid&#40;62488&#41; =&gt; pid: 62488, rc: 0, err:
&gt;
&gt; # OpenSSH version is 7.5p1,
&gt;
&gt; # ctl_path: /root/.libnet-openssh-perl/ca9523a03741dc7955578d7fb1933c0d,
&gt; ctl_dir: /root/.libnet-openssh-perl/
&gt;
&gt; # _is_secure_path&#40;dir: /root/.libnet-openssh-perl, file mode: 16832, file
&gt; uid: 0, euid: 0
&gt;
&gt; # _is_secure_path&#40;dir: /root, file mode: 16877, file uid: 0, euid: 0
&gt;
&gt; # set_error&#40;0 - 0&#41;
&gt;
&gt; # call args:
&gt; [&#39;ssh&#39;,&#39;-o&#39;,&#39;ServerAliveInterval=30&#39;,&#39;-o&#39;,&#39;ControlPersist=no&#39;,&#39;-2MNx&#39;,&#39;-S&#39;,&#39;/root/.libnet-openssh-perl/ca9523a03741dc7955578d7fb1933c0d&#39;,&#39;-l&#39;,&#39;cptctrl&#39;,&#39;-p&#39;,&#39;8844&#39;,&#39;2.2.2.2&#39;,&#39;--&#39;]
&gt;
&gt; # tracer attached, ssh pid: 62489, tracer pid: 62490
</div>
Is that really all the debugging output you get from the Perl script? Is 
it ending or hanging?

It should also be leaving a ktrace file at /tmp/net_openssh_master*, you 
can use kdump to examine it and see what the script was doing at the OS 
level just before finishing.

Also, as the debugging output ends just after invoking ktrace on itself, 
you can try disabling it. Change the line where you activate debugging to...

     $Net::OpenSSH::debug = &#40;~512&#41;;

And finally, you can also try activating debugging for the ssh process 
from the Net::OpenSSH constructor...

    my $ssh = Net::OpenSSH-&gt;new&#40;..., master_opts =&gt; &#39;-vvv&#39;&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;01&nbsp;03:27:02&nbsp;2019</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;02&nbsp;21:07:18&nbsp;2019</span>
    <span class="description">avv314 [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #128658] freebsd 11.2 bug</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 3 Mar 2019 05:06:56 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-OpenSSH [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Andrew Vylegzhanin &lt;avv314 [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">пт, 1 мар. 2019 г. в 11:27, Salvador \&#34;Fandiño\&#34; via RT &lt;
bug-Net-OpenSSH@rt.cpan.org&gt;:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=128658">https://rt.cpan.org/Ticket/Display.html?id=128658</a></span> &gt;
&gt;
&gt;
&gt; On 2/27/19 9:09 PM, Andrew Vylegzhanin via RT wrote:
<div class="message-stanza open">&gt; &gt; Wed Feb 27 15:09:16 2019: Request 128658 was acted upon.
&gt; &gt; Transaction: Ticket created by avv314@gmail.com
&gt; &gt;         Queue: Net-OpenSSH
&gt; &gt;       Subject: freebsd 11.2 bug
&gt; &gt;     Broken in: &#40;no value&#41;
&gt; &gt;      Severity: &#40;no value&#41;
&gt; &gt;         Owner: Nobody
&gt; &gt;    Requestors: avv314@gmail.com
&gt; &gt;        Status: new
&gt; &gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=128658">https://rt.cpan.org/Ticket/Display.html?id=128658</a></span> &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; # set_error&#40;0 - 0&#41;
&gt; &gt;
&gt; &gt; # call args:
&gt; &gt;
</div>&gt; [&#39;ssh&#39;,&#39;-o&#39;,&#39;ServerAliveInterval=30&#39;,&#39;-o&#39;,&#39;ControlPersist=no&#39;,&#39;-2MNx&#39;,&#39;-S&#39;,&#39;/root/.libnet-openssh-perl/ca9523a03741dc7955578d7fb1933c0d&#39;,&#39;-l&#39;,&#39;cptctrl&#39;,&#39;-p&#39;,&#39;8844&#39;,&#39;2.2.2.2&#39;,&#39;--&#39;]
<div class="message-stanza open">&gt; &gt;
&gt; &gt; # tracer attached, ssh pid: 62489, tracer pid: 62490
</div>&gt;
&gt; Is that really all the debugging output you get from the Perl script? Is
&gt; it ending or hanging?
&gt;
&gt;
</div>The script is ending on
But ssh process &#40;and remote ssh server on target host&#41;  lives up to kill -9.

48377  -  S          0:00.21 ssh -o ServerAliveInterval=30 -o
ControlPersist=no -2MNx -S
/root/.libnet-openssh-perl/6ed6a5277b133de750bfce98bcdbec16 -l cptctrl -p
8844 2.2.2.2 --

48860  -  I          0:00.20 ssh -o ServerAliveInterval=30 -o
ControlPersist=no -2MNx -S
/root/.libnet-openssh-perl/e738e184529e56573683b7ebb59901a0 -l cptctrl -p
8844 2.2.2.2 --
52049  -  S          0:00.07 ssh -o ServerAliveInterval=30 -o
ControlPersist=no -2MNx -S
/root/.libnet-openssh-perl/f6cd719e430a9f3f4db0cf5db6d783d0 -l cptctrl -p
8844 2.2.2.2 --

It should also be leaving a ktrace file at /tmp/net_openssh_master*, you
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; can use kdump to examine it and see what the script was doing at the OS
&gt; level just before finishing.
&gt;
&gt;
</div>It&#39;s loop around select/read/write up to manual killing:

 52444 ssh      RET   read 28/0x1c

 52444 ssh      CALL  select&#40;0x5,0x8020161e0,0x8020161b8,0,0x7fffffffa860&#41;

 52444 ssh      RET   select 0

 52444 ssh      CALL  getpid

 52444 ssh      RET   getpid 52444/0xccdc

 52444 ssh      CALL  select&#40;0x5,0x8020161e0,0x8020161b8,0,0x7fffffffa860&#41;

 52444 ssh      RET   select 1

 52444 ssh      CALL  write&#40;0x3,0x8021215f0,0x34&#41;
 52444 ssh      GIO   fd 3 wrote 52 bytes

# ls -la /tmp/*ktrace

-rw-------  1 root  wheel  1977306 Mar  2 08:13
/tmp/net_openssh_master.33903.ktrace

-rw-------  1 root  wheel  1943930 Mar  2 08:13
/tmp/net_openssh_master.34146.ktrace

-rw-------  1 root  wheel   281090 Mar  2 08:14
/tmp/net_openssh_master.44790.ktrace

-rw-------  1 root  wheel  2605599 Mar  3 04:39
/tmp/net_openssh_master.48377.ktrace

-rw-------  1 root  wheel  2531559 Mar  3 04:39
/tmp/net_openssh_master.48860.ktrace

-rw-------  1 root  wheel   225249 Feb 25 23:52
/tmp/net_openssh_master.50586.ktrace

-rw-------  1 root  wheel   224801 Feb 25 23:55
/tmp/net_openssh_master.50658.ktrace

-rw-------  1 root  wheel  2026151 Mar  3 04:39
/tmp/net_openssh_master.52049.ktrace

-rw-------  1 root  wheel  1980855 Mar  3 04:39
/tmp/net_openssh_master.52353.ktrace

.......

So, it seems, the problem is in perl module not in OpenSSH itself

Any ideas?

--
Andrew


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Also, as the debugging output ends just after invoking ktrace on itself,
&gt; you can try disabling it. Change the line where you activate debugging
&gt; to...
&gt;
&gt;      $Net::OpenSSH::debug = &#40;~512&#41;;
&gt;
&gt; And finally, you can also try activating debugging for the ssh process
&gt; from the Net::OpenSSH constructor...
&gt;
&gt;     my $ssh = Net::OpenSSH-&gt;new&#40;..., master_opts =&gt; &#39;-vvv&#39;&#41;
&gt;
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;03&nbsp;03:06:39&nbsp;2019</span>
    <span class="description">sfandino [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #128658] freebsd 11.2 bug</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 3 Mar 2019 09:06:25 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-OpenSSH [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Salvador Fandiño &lt;sfandino [...] yahoo.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On 3/3/19 3:07 AM, Andrew Vylegzhanin via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: Net-OpenSSH
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=128658">https://rt.cpan.org/Ticket/Display.html?id=128658</a></span> &gt;
&gt;
&gt; пт, 1 мар. 2019 г. в 11:27, Salvador \&#34;Fandiño\&#34; via RT &lt;
&gt; bug-Net-OpenSSH@rt.cpan.org&gt;:
&gt;
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=128658">https://rt.cpan.org/Ticket/Display.html?id=128658</a></span> &gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; On 2/27/19 9:09 PM, Andrew Vylegzhanin via RT wrote:
<div class="message-stanza open">&gt;&gt;&gt; Wed Feb 27 15:09:16 2019: Request 128658 was acted upon.
&gt;&gt;&gt; Transaction: Ticket created by avv314@gmail.com
&gt;&gt;&gt;          Queue: Net-OpenSSH
&gt;&gt;&gt;        Subject: freebsd 11.2 bug
&gt;&gt;&gt;      Broken in: &#40;no value&#41;
&gt;&gt;&gt;       Severity: &#40;no value&#41;
&gt;&gt;&gt;          Owner: Nobody
&gt;&gt;&gt;     Requestors: avv314@gmail.com
&gt;&gt;&gt;         Status: new
&gt;&gt;&gt;    Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=128658">https://rt.cpan.org/Ticket/Display.html?id=128658</a></span> &gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; # set_error&#40;0 - 0&#41;
&gt;&gt;&gt;
&gt;&gt;&gt; # call args:
&gt;&gt;&gt;
</div>&gt;&gt; [&#39;ssh&#39;,&#39;-o&#39;,&#39;ServerAliveInterval=30&#39;,&#39;-o&#39;,&#39;ControlPersist=no&#39;,&#39;-2MNx&#39;,&#39;-S&#39;,&#39;/root/.libnet-openssh-perl/ca9523a03741dc7955578d7fb1933c0d&#39;,&#39;-l&#39;,&#39;cptctrl&#39;,&#39;-p&#39;,&#39;8844&#39;,&#39;2.2.2.2&#39;,&#39;--&#39;]
<div class="message-stanza open">&gt;&gt;&gt; # tracer attached, ssh pid: 62489, tracer pid: 62490
</div>&gt;&gt; Is that really all the debugging output you get from the Perl script? Is
&gt;&gt; it ending or hanging?
&gt;&gt;
&gt;&gt;
</div>&gt; The script is ending on
&gt; But ssh process &#40;and remote ssh server on target host&#41;  lives up to kill -9.
&gt;
&gt; 48377  -  S          0:00.21 ssh -o ServerAliveInterval=30 -o
&gt; ControlPersist=no -2MNx -S
&gt; /root/.libnet-openssh-perl/6ed6a5277b133de750bfce98bcdbec16 -l cptctrl -p
&gt; 8844 2.2.2.2 --
&gt;
&gt; 48860  -  I          0:00.20 ssh -o ServerAliveInterval=30 -o
&gt; ControlPersist=no -2MNx -S
&gt; /root/.libnet-openssh-perl/e738e184529e56573683b7ebb59901a0 -l cptctrl -p
&gt; 8844 2.2.2.2 --
&gt; 52049  -  S          0:00.07 ssh -o ServerAliveInterval=30 -o
&gt; ControlPersist=no -2MNx -S
&gt; /root/.libnet-openssh-perl/f6cd719e430a9f3f4db0cf5db6d783d0 -l cptctrl -p
&gt; 8844 2.2.2.2 --
&gt;
&gt; It should also be leaving a ktrace file at /tmp/net_openssh_master*, you
<div class="message-stanza open">&gt;&gt; can use kdump to examine it and see what the script was doing at the OS
&gt;&gt; level just before finishing.
&gt;&gt;
&gt;&gt;
</div>&gt; It&#39;s loop around select/read/write up to manual killing:
&gt;
&gt;   52444 ssh      RET   read 28/0x1c
&gt;
&gt;   52444 ssh      CALL  select&#40;0x5,0x8020161e0,0x8020161b8,0,0x7fffffffa860&#41;
&gt;
&gt;   52444 ssh      RET   select 0
&gt;
&gt;   52444 ssh      CALL  getpid
&gt;
&gt;   52444 ssh      RET   getpid 52444/0xccdc
&gt;
&gt;   52444 ssh      CALL  select&#40;0x5,0x8020161e0,0x8020161b8,0,0x7fffffffa860&#41;
&gt;
&gt;   52444 ssh      RET   select 1
&gt;
&gt;   52444 ssh      CALL  write&#40;0x3,0x8021215f0,0x34&#41;
&gt;   52444 ssh      GIO   fd 3 wrote 52 bytes
</div>
This looks like the dump for some ssh subprocess. I would like to see 
the dump for the perl script instead &#40;or probably both processes&#41;. Also, 
just some line would not make it, actually it would be better if you 
include the full dump but be aware that that could expose sensitive 
information as passwords.



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; # ls -la /tmp/*ktrace
&gt;
&gt; -rw-------  1 root  wheel  1977306 Mar  2 08:13
&gt; /tmp/net_openssh_master.33903.ktrace
&gt;
&gt; -rw-------  1 root  wheel  1943930 Mar  2 08:13
&gt; /tmp/net_openssh_master.34146.ktrace
&gt;
&gt; -rw-------  1 root  wheel   281090 Mar  2 08:14
&gt; /tmp/net_openssh_master.44790.ktrace
&gt;
&gt; -rw-------  1 root  wheel  2605599 Mar  3 04:39
&gt; /tmp/net_openssh_master.48377.ktrace
&gt;
&gt; -rw-------  1 root  wheel  2531559 Mar  3 04:39
&gt; /tmp/net_openssh_master.48860.ktrace
&gt;
&gt; -rw-------  1 root  wheel   225249 Feb 25 23:52
&gt; /tmp/net_openssh_master.50586.ktrace
&gt;
&gt; -rw-------  1 root  wheel   224801 Feb 25 23:55
&gt; /tmp/net_openssh_master.50658.ktrace
&gt;
&gt; -rw-------  1 root  wheel  2026151 Mar  3 04:39
&gt; /tmp/net_openssh_master.52049.ktrace
&gt;
&gt; -rw-------  1 root  wheel  1980855 Mar  3 04:39
&gt; /tmp/net_openssh_master.52353.ktrace
&gt;
&gt; .......
</div>
Every time you run the script with full debugging enabled, a new ktrace 
file is created.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;09&nbsp;14:32:00&nbsp;2019</span>
    <span class="description">avv314 [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #128658] freebsd 11.2 bug</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 9 Mar 2019 22:31:39 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-OpenSSH [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Andrew Vylegzhanin &lt;avv314 [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">вс, 3 мар. 2019 г. в 11:06, Salvador \&#34;Fandiño\&#34; via RT &lt;
bug-Net-OpenSSH@rt.cpan.org&gt;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=128658">https://rt.cpan.org/Ticket/Display.html?id=128658</a></span> &gt;
&gt;
<div class="message-stanza open">&gt; &gt;   52444 ssh      CALL  write&#40;0x3,0x8021215f0,0x34&#41;
&gt; &gt;   52444 ssh      GIO   fd 3 wrote 52 bytes
</div>&gt;
&gt; This looks like the dump for some ssh subprocess. I would like to see
</div>
Of course this is ssh subprocess started by Net::OpenSSH-&gt;new.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; the dump for the perl script instead &#40;or probably both processes&#41;. Also,
&gt; just some line would not make it, actually it would be better if you
&gt; include the full dump but be aware that that could expose sensitive
&gt; information as passwords.
&gt;
</div>
After adding shell wrapper for tracing perl script like this:

#!/bin/sh
ktrace -f vgarcd.out.$$ vg-arcd.pl $0 $1 $2 $3 $4 $5

The problem is disappeared!  Net::OpenSSH-&gt;new now is returing normal state
and scp working.

So, I will try to start via perl wrapper later for to check if perl is
affecting.

--
Andrew
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
