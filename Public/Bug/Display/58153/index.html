<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #58153 for SVG: CDATA are no child nodes</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #58153 for SVG: CDATA are no child nodes</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/SVG/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/SVG/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/SVG/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/SVG/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/SVG">SVG CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">58153</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/SVG/Active/">SVG</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
LGEHLEN [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-30238-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.50    </td>
  </tr>
  <tr id="CF-30239-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;04&nbsp;19:49:14&nbsp;2010</span>
    <span class="description">LGEHLEN [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> CDATA are no child nodes</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dear Ronan,
I have noticed that SVG does not treat PCDATA sections &#40;e.g. inside a
text elements&#41; as child nodes. This leads to several problems.

1&#41; According to the DOM &#40;e.g. <span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/TR/DOM-Level-3-">http://www.w3.org/TR/DOM-Level-3-</a></span>
you do for example

my $svg  = SVG-&gt;new&#40;width =&gt; 200, height =&gt; 200&#41;;
my $text = $svg-&gt;text&#40;&#39;x&#39; =&gt; 20, &#39;y&#39; =&gt; 100, id =&gt; &#39;t01&#39;&#41;;
$text-&gt;tspan-&gt;cdata&#40;&#39;foo&#39;&#41;;
$text-&gt;cdata&#40;&#39;bar&#39;&#41;;

then $text-&gt;getChildNodes should give you the tspan and the cdata
nodes. XML parsers like libxml2 do this. If you feed the SVG document
&lt;?xml version=&#34;1.0&#34; standalone=&#34;no&#34;?&gt;
&lt;!DOCTYPE svg PUBLIC &#34;-//W3C//DTD SVG 1.1//EN&#34;
  &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd</a></span>&#34;&gt;
&lt;svg width=&#34;200&#34; height=&#34;200&#34; xmlns=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/2000/svg">http://www.w3.org/2000/svg</a></span>&#34;
version=&#34;1.1&#34;&gt;
  &lt;text x=&#34;20&#34; y=&#34;100&#34;&gt;&lt;tspan&gt;foo&lt;/tspan&gt;bar&lt;tspan&gt;baz&lt;/text&gt;
&lt;/svg&gt;

into the code
use XML::LibXML;

my $parser = XML::LibXML-&gt;new&#40;&#41;;
$parser-&gt;validation&#40;0&#41;;
$parser-&gt;no_network&#40;1&#41;;
$parser-&gt;recover&#40;1&#41;;
my $dom = $parser-&gt;parse_file&#40;&#39;tspan_cdata.svg&#39;&#41;;

foreach&#40;$dom-&gt;getElementsByTagName&#40;&#39;text&#39;&#41;&#41; {
    foreach&#40;$_-&gt;getChildNodes&#41; {
        print $_-&gt;getName, &#34;\n&#34;;
    }
}

you get the output
tspan
#text

I am aware of the fact that SVG does not attempt to implement the full
DOM, but I think that the supported subset should follow the DOM
specification.

2&#41; More importantly, the issue is not purely academic. The SVG DTD &#40;see
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/TR/SVG11/text.html#TextElement">http://www.w3.org/TR/SVG11/text.html#TextElement</a></span> for the relevant
section&#41; specifies the content of the text element as:
&#34;&#40; #PCDATA | %SVG.Description.class; | %SVG.Animation.class;
       %SVG.TextContent.class; %SVG.Hyperlink.class;
       %SVG.text.extra.content; &#41;*&#34;

This means that it is perfectly valid to mix multiple tspan &#40;or tref
etc.&#41; elements with multiple CDATA sections. However, the code
my $svg  = SVG-&gt;new&#40;width =&gt; 200, height =&gt; 200&#41;;
my $text = $svg-&gt;text&#40;&#39;x&#39; =&gt; 20, &#39;y&#39; =&gt; 100, id =&gt; &#39;t01&#39;&#41;;
$text-&gt;tspan-&gt;cdata&#40;&#39;foo&#39;&#41;;
$text-&gt;cdata&#40;&#39;bar&#39;&#41;;
$text-&gt;tspan-&gt;cdata&#40;&#39;baz&#39;&#41;;
$text-&gt;cdata&#40;&#39;qux&#39;&#41;;
print $svg-&gt;xmlify, &#34;\n&#34;;

produces
&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; standalone=&#34;yes&#34;?&gt;
&lt;!DOCTYPE svg PUBLIC &#34;-//W3C//DTD SVG 1.0//EN&#34;
&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd</a></span>&#34;&gt;
&lt;svg height=&#34;200&#34; width=&#34;200&#34; xmlns=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/2000/svg">http://www.w3.org/2000/svg</a></span>&#34;
xmlns:svg=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/2000/svg">http://www.w3.org/2000/svg</a></span>&#34;
xmlns:xlink=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/1999/xlink">http://www.w3.org/1999/xlink</a></span>&#34;&gt;
        &lt;text id=&#34;t01&#34; x=&#34;20&#34; y=&#34;100&#34;&gt;
                &lt;tspan &gt;foo&lt;/tspan&gt;
                &lt;tspan &gt;baz&lt;/tspan&gt;qux&lt;/text&gt;
        &lt;!--
        Generated using the Perl SVG Module V2.50
        by Ronan Oger
        Info: <span class="clickylink"><a target="new" rel="nofollow" href="http://www.roitsystems.com/">http://www.roitsystems.com/</a></span>
 --&gt;
&lt;/svg&gt;

which contains only the second CDATA section. Moreover, the CDATA
section always shows up at the very end of the text element, no matter
if it was specified before or after tspan elements. Also, the order is
not recoverable by inspecting $text-&gt;getChildNodes and $text-&gt;cdata.
However, there are situation where the order does matter. This issue
could be resolved by maintaining CDATA sections as child nodes.

Best wishes,
Lutz
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;06&nbsp;04:25:48&nbsp;2010</span>
    <span class="description">LGEHLEN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">An addition:
The proper solution to the problem would probably be to create a
SVG::Node class which SVG::Element inherits from. Then a node object
would maintain a list of child nodes. To conform with the DOM
specification, attributes would also be SVG::Node objects in this list.
The getAttributes and a getChildElements methods would then grep the
respective nodes from the list.

In order to provide backwards compatibility you code add a flag that by
default retains the old functionality, but could be switched to the DOM
conforming behaviour.

I admit that this solution would require some work. However, the
muliplicity and order of cdata sections are not only a spec compliance
issues. Anyway, I would appreciate a comment from your side whether you
are planning to do anything about it or if I have to find a permanent
instead of a temporary workaround for the problem.

Cheers,
Lutz
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;06&nbsp;20:06:22&nbsp;2010</span>
    <span class="description">florent.angly [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Lutz,

Thanks for the bug reports. I&#39;m speaking for Ronan here, but as far as I
know, he is not available for quite some time.

There is not much I can do really because I do not fully understand the
ins and outs of this issue.

If you can you provide a patch for this, this would probably help having
a fix released sooner.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;06&nbsp;20:06:23&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;06&nbsp;20:37:51&nbsp;2010</span>
    <span class="description">LGEHLEN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Florent,
thanks for your reply. I will take a deeper look into the code and try
to come up with a patch. I&#39;ll have to think about the best way to fix
the problem while keeping the current behaviour as default.

Best wishes,
Lutz
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;16&nbsp;02:53:27&nbsp;2012</span>
    <span class="description">SZABGAB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Please fork the repository here: <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/szabgab/SVG">https://github.com/szabgab/SVG</a></span> and send
a test case and if possible a patch too.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
