<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #34310 for CGI-Simple: CGI::Simple::Cookie</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #34310 for CGI-Simple: CGI::Simple::Cookie</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/CGI-Simple/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/CGI-Simple/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/CGI-Simple/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/CGI-Simple/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/CGI-Simple">CGI-Simple CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">34310</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/CGI-Simple/Active/">CGI-Simple</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
RSAVAGE [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-5940-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.103    </td>
  </tr>
  <tr id="CF-5941-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;20&nbsp;23:24:48&nbsp;2008</span>
    <span class="description">RSAVAGE [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> CGI::Simple::Cookie</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Line 34 of CGI::Simple::Cookie says:
$pair =~ s/^\s+|\s+$//;    # trim leading trailing whitespace
but this is missing a /g. It trims either leading or trailing spaces,
but not both.
Compare with line 93 of CGI::Cookie which does trim both:
s/\s*&#40;.*?&#41;\s*/$1/;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;21&nbsp;15:06:06&nbsp;2008</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> CGI::Simple::Cookie: should support max_age</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Perhaps this should be a separate bug report, but here&#39;s another issue
to fix in CGI::Session::Cookie. 

The Cookie RFC &#40; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.w3.org/Protocols/rfc2109/rfc2109">http://www.w3.org/Protocols/rfc2109/rfc2109</a></span> &#41;
recommends using &#34;Max-Age&#34;, not &#34;Expires&#34; to set the expiration date.
&#40;&#34;Expires&#34; remains as a legacy option and uses a different date format. &#41;

&#34;max-age&#34; should be added as a constructor option and a &#34;max_age&#40;&#41;&#34;
getter/setter method should also be added. 

This will also increase compatibility with CGI.pm, which added Max-Age
support somewhere in the 2.8x series. 

&#40; Related to this: a new version of a CGI::Session is about to come out
which is expected to switch from using &#34;expires&#34; to &#34;Max-age&#34; to be more
RFC-compliant, fixing an issue with Safari. Until CGI::Simple is
updated, it will not be a compatible replacement. &#41;

Thanks!

    Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;21&nbsp;15:06:14&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;06&nbsp;18:12:36&nbsp;2008</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> CGI::Simple::Cookie &#40;4 patches&#41;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">By comparing the current CGI::Simple::Cookie to CGI.pm, I found several
bugs that had been fixed in CGI.pm since the fork in 2001, and not in
CGI::Simple. In each of the 4 cases, I also updated an updated test to
illustrate the problem and fix. 

You can review and apply the pages in the order from to 1 to 4, or the
&#34;combined_cookie.patch&#34; represents all the work in one file. 

&#40; None of these address &#34;max_age&#34; support, where CGI::Simple still lags
CGI.pm. &#41; 

   Mark
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sat Dec  6 17:19:14 EST 2008  Mark Stosberg &lt;mark@summersault.com&gt;
  * Support cookies which have an equals sign in the value. Ported from CGI.pm 
diff -rN -u old-CGI-Simple-1.106/Changes new-CGI-Simple-1.106/Changes
--- old-CGI-Simple-1.106/Changes	2008-12-06 18:04:31.000000000 -0500
+++ new-CGI-Simple-1.106/Changes	2008-12-06 18:04:31.000000000 -0500
@@ -144,6 +144,6 @@
       - Accept a comma as well as semi-colon as a cookie separator. This is consistent with CGI.pm   
         as well as RFC 2965, which states:  &#34;A server SHOULD also accept comma &#40;,&#41;
         as the separator between cookie-values for future compatibility.&#34; &#40;Mark Stosberg&#41; 
-
+      - Support cookies which have an equals sign in the value. Ported from CGI.pm &#40;Mark Stosberg&#41;   
 
 
diff -rN -u old-CGI-Simple-1.106/lib/CGI/Simple/Cookie.pm new-CGI-Simple-1.106/lib/CGI/Simple/Cookie.pm
--- old-CGI-Simple-1.106/lib/CGI/Simple/Cookie.pm	2008-12-06 18:04:31.000000000 -0500
+++ new-CGI-Simple-1.106/lib/CGI/Simple/Cookie.pm	2008-12-06 18:04:31.000000000 -0500
@@ -32,7 +32,7 @@
   my @pairs = split &#34;[;,] ?&#34;, $raw_cookie;
   for my $pair &#40; @pairs &#41; {
     $pair =~ s/^\s+|\s+$//g;    # trim leading trailing whitespace
-    my &#40; $key, $value &#41; = split &#34;=&#34;, $pair;
+    my&#40;$key,$value&#41; = split&#40;&#34;=&#34;,$pair,2&#41;;
     next unless defined $value;
     my @values = map { unescape&#40; $_ &#41; } split /[&#38;;]/, $value;
     $key = unescape&#40; $key &#41;;
diff -rN -u old-CGI-Simple-1.106/t/020.cookie.t new-CGI-Simple-1.106/t/020.cookie.t
--- old-CGI-Simple-1.106/t/020.cookie.t	2008-12-06 18:04:31.000000000 -0500
+++ new-CGI-Simple-1.106/t/020.cookie.t	2008-12-06 18:04:31.000000000 -0500
@@ -17,7 +17,7 @@
 }
 
 my @test_cookie = &#40;
-  &#39;foo=123, bar=qwerty;  baz=wibble ; qux=a1&#39;,
+  &#39;foo=123, bar=qwerty;  baz=wib=ble ; qux=a1&#39;,
   &#39;foo=123; bar=qwerty; baz=wibble;&#39;,
   &#39;foo=vixen; bar=cow; baz=bitch; qux=politician&#39;,
   &#39;foo=a%20phrase; bar=yes%2C%20a%20phrase; baz=%5Ewibble; qux=%27&#39;,
@@ -44,7 +44,7 @@
 
   is&#40; $result{foo}-&gt;value, &#39;123&#39;,    &#34;cookie foo is correct&#34; &#41;;
   is&#40; $result{bar}-&gt;value, &#39;qwerty&#39;, &#34;cookie bar is correct&#34; &#41;;
-  is&#40; $result{baz}-&gt;value, &#39;wibble&#39;, &#34;cookie baz is correct&#34; &#41;;
+  is&#40; $result{baz}-&gt;value, &#39;wib=ble&#39;, &#34;cookie baz is correct&#34; &#41;;
   is&#40; $result{qux}-&gt;value, &#39;a1&#39;,     &#34;cookie qux is correct&#34; &#41;;
 }
 

</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sat Dec  6 17:28:09 EST 2008  Mark Stosberg &lt;mark@summersault.com&gt;
  * Support cookies in which one of multiple values is empty. Ported from CGI.pm
diff -rN -u old-CGI-Simple-1.106/Changes new-CGI-Simple-1.106/Changes
--- old-CGI-Simple-1.106/Changes	2008-12-06 18:05:09.000000000 -0500
+++ new-CGI-Simple-1.106/Changes	2008-12-06 18:05:09.000000000 -0500
@@ -145,5 +145,6 @@
         as well as RFC 2965, which states:  &#34;A server SHOULD also accept comma &#40;,&#41;
         as the separator between cookie-values for future compatibility.&#34; &#40;Mark Stosberg&#41; 
       - Support cookies which have an equals sign in the value. Ported from CGI.pm &#40;Mark Stosberg&#41;   
+      - Support cookies in which one of multiple values is empty. Ported from CGI.pm &#40;Mark Stosberg&#41;
 
 
diff -rN -u old-CGI-Simple-1.106/lib/CGI/Simple/Cookie.pm new-CGI-Simple-1.106/lib/CGI/Simple/Cookie.pm
--- old-CGI-Simple-1.106/lib/CGI/Simple/Cookie.pm	2008-12-06 18:05:09.000000000 -0500
+++ new-CGI-Simple-1.106/lib/CGI/Simple/Cookie.pm	2008-12-06 18:05:09.000000000 -0500
@@ -33,9 +33,13 @@
   for my $pair &#40; @pairs &#41; {
     $pair =~ s/^\s+|\s+$//g;    # trim leading trailing whitespace
     my&#40;$key,$value&#41; = split&#40;&#34;=&#34;,$pair,2&#41;;
-    next unless defined $value;
-    my @values = map { unescape&#40; $_ &#41; } split /[&#38;;]/, $value;
-    $key = unescape&#40; $key &#41;;
+    next if !defined&#40;$value&#41;;
+    my @values = &#40;&#41;;
+    if &#40;$value ne &#39;&#39;&#41; {
+      @values = map unescape&#40;$_&#41;,split&#40;/[&#38;;]/,$value.&#39;&#38;dmy&#39;&#41;;
+      pop @values;
+    }
+    $key = unescape&#40;$key&#41;;
 
     # A bug in Netscape can cause several cookies with same name to
     # appear.  The FIRST one in HTTP_COOKIE is the most recent version.
diff -rN -u old-CGI-Simple-1.106/t/020.cookie.t new-CGI-Simple-1.106/t/020.cookie.t
--- old-CGI-Simple-1.106/t/020.cookie.t	2008-12-06 18:05:09.000000000 -0500
+++ new-CGI-Simple-1.106/t/020.cookie.t	2008-12-06 18:05:09.000000000 -0500
@@ -17,7 +17,7 @@
 }
 
 my @test_cookie = &#40;
-  &#39;foo=123, bar=qwerty;  baz=wib=ble ; qux=a1&#39;,
+  &#39;foo=123, bar=qwerty;  baz=wib=ble ; qux=1&#38;2&#38;&#39;,
   &#39;foo=123; bar=qwerty; baz=wibble;&#39;,
   &#39;foo=vixen; bar=cow; baz=bitch; qux=politician&#39;,
   &#39;foo=a%20phrase; bar=yes%2C%20a%20phrase; baz=%5Ewibble; qux=%27&#39;,
@@ -45,7 +45,8 @@
   is&#40; $result{foo}-&gt;value, &#39;123&#39;,    &#34;cookie foo is correct&#34; &#41;;
   is&#40; $result{bar}-&gt;value, &#39;qwerty&#39;, &#34;cookie bar is correct&#34; &#41;;
   is&#40; $result{baz}-&gt;value, &#39;wib=ble&#39;, &#34;cookie baz is correct&#34; &#41;;
-  is&#40; $result{qux}-&gt;value, &#39;a1&#39;,     &#34;cookie qux is correct&#34; &#41;;
+  my @values = $result{qux}-&gt;value;
+  is_deeply &#40; \@values, [1,2,&#39;&#39;], &#34;multiple values are supported including empty values.&#34; &#41;;
 }
 
 #-----------------------------------------------------------------------------

</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sat Dec  6 16:38:08 EST 2008  Mark Stosberg &lt;mark@summersault.com&gt;
  * - CGI::Simple::Cookie, fixed bug when cookie had both leading and trailing white space
diff -rN -u old-CGI-Simple-1.106/Changes new-CGI-Simple-1.106/Changes
--- old-CGI-Simple-1.106/Changes	2008-12-06 18:02:52.000000000 -0500
+++ new-CGI-Simple-1.106/Changes	2008-12-06 18:02:52.000000000 -0500
@@ -139,4 +139,6 @@
 1.107   2008-12-06
       - Fixed bug when calling unescapeHTML on HTML that wasn&#39;t properly escaped in the first place. 
         Thanks to M-Uchino and Mark Stosberg.          
+      - CGI::Simple::Cookie, fixed bug when cookie had both leading and trailing white space 
+        &#40;RT#34314, Ron Savage and Mark Stosberg&#41;
 
diff -rN -u old-CGI-Simple-1.106/lib/CGI/Simple/Cookie.pm new-CGI-Simple-1.106/lib/CGI/Simple/Cookie.pm
--- old-CGI-Simple-1.106/lib/CGI/Simple/Cookie.pm	2008-12-06 18:02:52.000000000 -0500
+++ new-CGI-Simple-1.106/lib/CGI/Simple/Cookie.pm	2008-12-06 18:02:52.000000000 -0500
@@ -31,7 +31,7 @@
   my %results;
   my @pairs = split &#34;; ?&#34;, $raw_cookie;
   for my $pair &#40; @pairs &#41; {
-    $pair =~ s/^\s+|\s+$//;    # trim leading trailing whitespace
+    $pair =~ s/^\s+|\s+$//g;    # trim leading trailing whitespace
     my &#40; $key, $value &#41; = split &#34;=&#34;, $pair;
     next unless defined $value;
     my @values = map { unescape&#40; $_ &#41; } split /[&#38;;]/, $value;
diff -rN -u old-CGI-Simple-1.106/t/020.cookie.t new-CGI-Simple-1.106/t/020.cookie.t
--- old-CGI-Simple-1.106/t/020.cookie.t	2008-12-06 18:02:52.000000000 -0500
+++ new-CGI-Simple-1.106/t/020.cookie.t	2008-12-06 18:02:52.000000000 -0500
@@ -17,7 +17,7 @@
 }
 
 my @test_cookie = &#40;
-  &#39;foo=123; bar=qwerty; baz=wibble; qux=a1&#39;,
+  &#39;foo=123; bar=qwerty;  baz=wibble ; qux=a1&#39;,
   &#39;foo=123; bar=qwerty; baz=wibble;&#39;,
   &#39;foo=vixen; bar=cow; baz=bitch; qux=politician&#39;,
   &#39;foo=a%20phrase; bar=yes%2C%20a%20phrase; baz=%5Ewibble; qux=%27&#39;,

</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sat Dec  6 17:28:09 EST 2008  Mark Stosberg &lt;mark@summersault.com&gt;
  * Support cookies in which one of multiple values is empty. Ported from CGI.pm
Sat Dec  6 17:19:14 EST 2008  Mark Stosberg &lt;mark@summersault.com&gt;
  * Support cookies which have an equals sign in the value. Ported from CGI.pm 
Sat Dec  6 16:52:03 EST 2008  Mark Stosberg &lt;mark@summersault.com&gt;
  * - Accept a comma as well as semi-colon as a cookie separator. This is consistent with CGI.pm
    as well as RFC 2965, which states:  &#34;A server SHOULD also accept comma &#40;,&#41;
    as the separator between cookie-values for future compatibility.&#34;
Sat Dec  6 16:38:08 EST 2008  Mark Stosberg &lt;mark@summersault.com&gt;
  * - CGI::Simple::Cookie, fixed bug when cookie had both leading and trailing white space
diff -rN -u old-CGI-Simple-1.106/Changes new-CGI-Simple-1.106/Changes
--- old-CGI-Simple-1.106/Changes	2008-12-06 18:05:52.000000000 -0500
+++ new-CGI-Simple-1.106/Changes	2008-12-06 18:05:52.000000000 -0500
@@ -139,4 +139,12 @@
 1.107   2008-12-06
       - Fixed bug when calling unescapeHTML on HTML that wasn&#39;t properly escaped in the first place. 
         Thanks to M-Uchino and Mark Stosberg.          
+      - CGI::Simple::Cookie, fixed bug when cookie had both leading and trailing white space 
+        &#40;RT#34314, Ron Savage and Mark Stosberg&#41;
+      - Accept a comma as well as semi-colon as a cookie separator. This is consistent with CGI.pm   
+        as well as RFC 2965, which states:  &#34;A server SHOULD also accept comma &#40;,&#41;
+        as the separator between cookie-values for future compatibility.&#34; &#40;Mark Stosberg&#41; 
+      - Support cookies which have an equals sign in the value. Ported from CGI.pm &#40;Mark Stosberg&#41;   
+      - Support cookies in which one of multiple values is empty. Ported from CGI.pm &#40;Mark Stosberg&#41;
+
 
diff -rN -u old-CGI-Simple-1.106/lib/CGI/Simple/Cookie.pm new-CGI-Simple-1.106/lib/CGI/Simple/Cookie.pm
--- old-CGI-Simple-1.106/lib/CGI/Simple/Cookie.pm	2008-12-06 18:05:52.000000000 -0500
+++ new-CGI-Simple-1.106/lib/CGI/Simple/Cookie.pm	2008-12-06 18:05:52.000000000 -0500
@@ -29,13 +29,17 @@
   my &#40; $self, $raw_cookie &#41; = @_;
   return &#40;&#41; unless $raw_cookie;
   my %results;
-  my @pairs = split &#34;; ?&#34;, $raw_cookie;
+  my @pairs = split &#34;[;,] ?&#34;, $raw_cookie;
   for my $pair &#40; @pairs &#41; {
-    $pair =~ s/^\s+|\s+$//;    # trim leading trailing whitespace
-    my &#40; $key, $value &#41; = split &#34;=&#34;, $pair;
-    next unless defined $value;
-    my @values = map { unescape&#40; $_ &#41; } split /[&#38;;]/, $value;
-    $key = unescape&#40; $key &#41;;
+    $pair =~ s/^\s+|\s+$//g;    # trim leading trailing whitespace
+    my&#40;$key,$value&#41; = split&#40;&#34;=&#34;,$pair,2&#41;;
+    next if !defined&#40;$value&#41;;
+    my @values = &#40;&#41;;
+    if &#40;$value ne &#39;&#39;&#41; {
+      @values = map unescape&#40;$_&#41;,split&#40;/[&#38;;]/,$value.&#39;&#38;dmy&#39;&#41;;
+      pop @values;
+    }
+    $key = unescape&#40;$key&#41;;
 
     # A bug in Netscape can cause several cookies with same name to
     # appear.  The FIRST one in HTTP_COOKIE is the most recent version.
diff -rN -u old-CGI-Simple-1.106/t/020.cookie.t new-CGI-Simple-1.106/t/020.cookie.t
--- old-CGI-Simple-1.106/t/020.cookie.t	2008-12-06 18:05:52.000000000 -0500
+++ new-CGI-Simple-1.106/t/020.cookie.t	2008-12-06 18:05:52.000000000 -0500
@@ -17,7 +17,7 @@
 }
 
 my @test_cookie = &#40;
-  &#39;foo=123; bar=qwerty; baz=wibble; qux=a1&#39;,
+  &#39;foo=123, bar=qwerty;  baz=wib=ble ; qux=1&#38;2&#38;&#39;,
   &#39;foo=123; bar=qwerty; baz=wibble;&#39;,
   &#39;foo=vixen; bar=cow; baz=bitch; qux=politician&#39;,
   &#39;foo=a%20phrase; bar=yes%2C%20a%20phrase; baz=%5Ewibble; qux=%27&#39;,
@@ -44,8 +44,9 @@
 
   is&#40; $result{foo}-&gt;value, &#39;123&#39;,    &#34;cookie foo is correct&#34; &#41;;
   is&#40; $result{bar}-&gt;value, &#39;qwerty&#39;, &#34;cookie bar is correct&#34; &#41;;
-  is&#40; $result{baz}-&gt;value, &#39;wibble&#39;, &#34;cookie baz is correct&#34; &#41;;
-  is&#40; $result{qux}-&gt;value, &#39;a1&#39;,     &#34;cookie qux is correct&#34; &#41;;
+  is&#40; $result{baz}-&gt;value, &#39;wib=ble&#39;, &#34;cookie baz is correct&#34; &#41;;
+  my @values = $result{qux}-&gt;value;
+  is_deeply &#40; \@values, [1,2,&#39;&#39;], &#34;multiple values are supported including empty values.&#34; &#41;;
 }
 
 #-----------------------------------------------------------------------------

</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sat Dec  6 16:52:03 EST 2008  Mark Stosberg &lt;mark@summersault.com&gt;
  * - Accept a comma as well as semi-colon as a cookie separator. This is consistent with CGI.pm
    as well as RFC 2965, which states:  &#34;A server SHOULD also accept comma &#40;,&#41;
    as the separator between cookie-values for future compatibility.&#34;
diff -rN -u old-CGI-Simple-1.106/Changes new-CGI-Simple-1.106/Changes
--- old-CGI-Simple-1.106/Changes	2008-12-06 18:04:04.000000000 -0500
+++ new-CGI-Simple-1.106/Changes	2008-12-06 18:04:04.000000000 -0500
@@ -141,4 +141,9 @@
         Thanks to M-Uchino and Mark Stosberg.          
       - CGI::Simple::Cookie, fixed bug when cookie had both leading and trailing white space 
         &#40;RT#34314, Ron Savage and Mark Stosberg&#41;
+      - Accept a comma as well as semi-colon as a cookie separator. This is consistent with CGI.pm   
+        as well as RFC 2965, which states:  &#34;A server SHOULD also accept comma &#40;,&#41;
+        as the separator between cookie-values for future compatibility.&#34; &#40;Mark Stosberg&#41; 
+
+
 
diff -rN -u old-CGI-Simple-1.106/lib/CGI/Simple/Cookie.pm new-CGI-Simple-1.106/lib/CGI/Simple/Cookie.pm
--- old-CGI-Simple-1.106/lib/CGI/Simple/Cookie.pm	2008-12-06 18:04:04.000000000 -0500
+++ new-CGI-Simple-1.106/lib/CGI/Simple/Cookie.pm	2008-12-06 18:04:04.000000000 -0500
@@ -29,7 +29,7 @@
   my &#40; $self, $raw_cookie &#41; = @_;
   return &#40;&#41; unless $raw_cookie;
   my %results;
-  my @pairs = split &#34;; ?&#34;, $raw_cookie;
+  my @pairs = split &#34;[;,] ?&#34;, $raw_cookie;
   for my $pair &#40; @pairs &#41; {
     $pair =~ s/^\s+|\s+$//g;    # trim leading trailing whitespace
     my &#40; $key, $value &#41; = split &#34;=&#34;, $pair;
diff -rN -u old-CGI-Simple-1.106/t/020.cookie.t new-CGI-Simple-1.106/t/020.cookie.t
--- old-CGI-Simple-1.106/t/020.cookie.t	2008-12-06 18:04:04.000000000 -0500
+++ new-CGI-Simple-1.106/t/020.cookie.t	2008-12-06 18:04:04.000000000 -0500
@@ -17,7 +17,7 @@
 }
 
 my @test_cookie = &#40;
-  &#39;foo=123; bar=qwerty;  baz=wibble ; qux=a1&#39;,
+  &#39;foo=123, bar=qwerty;  baz=wibble ; qux=a1&#39;,
   &#39;foo=123; bar=qwerty; baz=wibble;&#39;,
   &#39;foo=vixen; bar=cow; baz=bitch; qux=politician&#39;,
   &#39;foo=a%20phrase; bar=yes%2C%20a%20phrase; baz=%5Ewibble; qux=%27&#39;,

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;06&nbsp;19:27:53&nbsp;2008</span>
    <span class="description">ron [...] savage.net.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #34310] CGI::Simple::Cookie &#40;4 patches&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 07 Dec 2008 11:29:13 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Cgi-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ron Savage &lt;ron [...] savage.net.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Mark

That&#39;s a nice bit of work, although scary at the same time.

Here&#39;s the output of my attempt to patch:

ron@zoe:/tmp$ patch -p0 &lt; combined_cookie.patch 
patching file old-CGI-Simple-1.106/Changes
Hunk #1 FAILED at 139.
1 out of 1 hunk FAILED -- saving rejects to file
old-CGI-Simple-1.106/Changes.rej
patching file old-CGI-Simple-1.106/lib/CGI/Simple/Cookie.pm
patching file old-CGI-Simple-1.106/t/020.cookie.t

I can&#39;t see why this failed:
Contents of Changes.rej &#40;pity about the wrap&#41;:

***************
*** 139,142 ****
  1.107   2008-12-06
        - Fixed bug when calling unescapeHTML on HTML that wasn&#39;t
properly escaped in the first place. 
          Thanks to M-Uchino and Mark Stosberg.          
  
--- 139,150 ----
  1.107   2008-12-06
        - Fixed bug when calling unescapeHTML on HTML that wasn&#39;t
properly escaped in the first place. 
          Thanks to M-Uchino and Mark Stosberg.          
+       - CGI::Simple::Cookie, fixed bug when cookie had both leading
and trailing white space 
+         &#40;RT#34314, Ron Savage and Mark Stosberg&#41;
+       - Accept a comma as well as semi-colon as a cookie separator.
This is consistent with CGI.pm   
+         as well as RFC 2965, which states:  &#34;A server SHOULD also
accept comma &#40;,&#41;
+         as the separator between cookie-values for future
compatibility.&#34; &#40;Mark Stosberg&#41; 
+       - Support cookies which have an equals sign in the value. Ported
from CGI.pm &#40;Mark Stosberg&#41;   
+       - Support cookies in which one of multiple values is empty.
Ported from CGI.pm &#40;Mark Stosberg&#41;
+ 


-- 
Ron Savage
ron@savage.net.au
<span class="clickylink"><a target="new" rel="nofollow" href="http://savage.net.au/index.html">http://savage.net.au/index.html</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;21&nbsp;18:46:52&nbsp;2008</span>
    <span class="description">ron [...] savage.net.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #34310] CGI::Simple::Cookie &#40;4 patches&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 22 Dec 2008 10:48:12 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Cgi-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ron Savage &lt;ron [...] savage.net.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Mark

Have you noticed that when you go to CPAN, 0 bugs are noted for
CGI::Simple?

<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~andya/CGI-Simple-1.106/">http://search.cpan.org/~andya/CGI-Simple-1.106/</a></span>

I&#39;ve reported this to RT&#39;s admin.

-- 
Ron Savage
ron@savage.net.au
<span class="clickylink"><a target="new" rel="nofollow" href="http://savage.net.au/index.html">http://savage.net.au/index.html</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;07&nbsp;14:11:48&nbsp;2009</span>
    <span class="description">andy [...] hexten.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Mar 20 23:24:48 2008, RSAVAGE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Line 34 of CGI::Simple::Cookie says:
&gt; $pair =~ s/^\s+|\s+$//;    # trim leading trailing whitespace
&gt; but this is missing a /g. It trims either leading or trailing spaces,
&gt; but not both.
&gt; Compare with line 93 of CGI::Cookie which does trim both:
&gt; s/\s*&#40;.*?&#41;\s*/$1/;
</div>
Fixed in #4446, thanks.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;07&nbsp;14:19:40&nbsp;2009</span>
    <span class="description">andy [...] hexten.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Patches applied as r4447. Thanks very much Mark!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;07&nbsp;14:19:41&nbsp;2009</span>
    <span class="description">andy [...] hexten.net -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
