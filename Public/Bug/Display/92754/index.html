<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #92754 for File-LockDir: bug in LockDir.pm?</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #92754 for File-LockDir: bug in LockDir.pm?</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/File-LockDir/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/File-LockDir/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/File-LockDir/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/File-LockDir/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/File-LockDir">File-LockDir CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">92754</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/File-LockDir/Active/">File-LockDir</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
john.t.kerich [...] nasa.gov

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-39852-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-39853-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;05&nbsp;10:07:46&nbsp;2014</span>
    <span class="description">john.t.kerich [...] nasa.gov -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> bug in LockDir.pm?</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 5 Feb 2014 15:07:21 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-file-lockdir [...] rt.cpan.org&#34; &lt;bug-file-lockdir [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Kerich, John T. &#40;GSFC-444.0&#41;[COLUMBUS TECHNOLOGIES AND SERVICES INC]&#34; &lt;john.t.kerich [...] nasa.gov&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Own I&#38;T people were testing the file lock logic path and created a &#34;fake&#34; mms_EftaDailyLog.log.LOCKDIR directory.  In the directory they then touch owner so it&#39;s an empty file.  When the script tried to create the lock directory the following happened:

Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
returns  &#40;my debug stuff&#41;
end if &#40;my debug stuff&#41;

I expected that the eval would have capture any the error message, it was not set.  In the perl -d mode I see the error stack being dumped out.
        eval {...} called at eftaCron.pl line 717
        main::dailyStatus&#40;&#39;/mms/am1/dev2/config/eftaCronAM1OPS.cnfg&#39;&#41; called at eftaCron.pl line 273
        main::executeType&#40;&#39;DAILY_STATUS&#39;, &#39;/mms/am1/dev2/config/eftaCronAM1OPS.cnfg&#39;&#41; called at eftaCron.pl line 3308
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98
        File::LockDir::_readlock&#40;&#39;File::LockDir=HASH&#40;0xf31d760&#41;&#39;, &#39;/mms/am1/dev2/efta/mms_EftaDailyLog.log.LOCKDIR&#39;&#41; called at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 138
        File::LockDir::nflock&#40;&#39;File::LockDir=HASH&#40;0xf31d760&#41;&#39;, &#39;/mms/am1/dev2/efta/mms_EftaDailyLog.log&#39;, 45, &#39;mms_dev&#39;, &#39;lomvsrv01&#39;&#41; called at eftaCron.pl line 717
        eval {...} called at eftaCron.pl line 717
        main::dailyStatus&#40;&#39;/mms/am1/dev2/config/eftaCronAM1OPS.cnfg&#39;&#41; called at eftaCron.pl line 273
        main::executeType&#40;&#39;DAILY_STATUS&#39;, &#39;/mms/am1/dev2/config/eftaCronAM1OPS.cnfg&#39;&#41; called at eftaCron.pl line 3308
Use of uninitialized value in concatenation &#40;.&#41; or string at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98.
at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 98
        File::LockDir::_readlock&#40;&#39;File::LockDir=HASH&#40;0xf31d760&#41;&#39;, &#39;/mms/am1/dev2/efta/mms_EftaDailyLog.log.LOCKDIR&#39;&#41; called at /usr/lib/perl5/site_perl/5.8.8/File/LockDir.pm line 138
        File::LockDir::nflock&#40;&#39;File::LockDir=HASH&#40;0xf31d760&#41;&#39;, &#39;/mms/am1/dev2/efta/mms_EftaDailyLog.log&#39;, 45, &#39;mms_dev&#39;, &#39;lomvsrv01&#39;&#41; called at eftaCron.pl line 717

The $lock_status also not set to anything &#40;defined &#40;$lock_status&#41; prints blank so it not set to undef either&#41; and the $lock_status is set to blank too.  The &#34;if &#40;! $lock_status&#41;&#34;  check fails the call ok so I know it didn&#39;t work but the documentation indicates it should have been set to false, not blank.

===============
code is:
===============
                              my &#40;$lock_status, $lockee&#41;;
               eval { &#40;$lock_status, $lockee&#41; = $G_LockDir{locker}-&gt;nflock&#40; $G_LockDir{lockFile}, $G_LockDir{stdLockTimeout}, $G_LockDir{stdLockUser}, hostname&#41;; };
prints &#34;returns $@ \n&#34;;
                              if &#40; $@ &#41; {
print &#34;error path&#34;;
                                             note &#40;&#34;eftaCron::sendEmail&#34;, __LINE__, SEVERITY_CRITICAL, &#34;Call to nflock died: &#34; . $@ &#41;;
                                             $Status = 1;
                                             next SUBSYS;
                              }
print &#34;end if\n&#34;;

                              if &#40;! $lock_status&#41; {
                                             note &#40;&#34;eftaCron::dailyStatus&#34;, __LINE__, SEVERITY_CRITICAL, &#34;Couldn&#39;t lock file $dailyLog\nSkipping email of $dailyLog&#34;&#41;;
                                             $Status = 1;
                                             next SUBSYS;
                              }

                              if &#40;! -e $dailyLog&#41; {
                                             #Well the daily log file doesn&#39;t exist someone else emailed it or there has been no action
                                             $G_LockDir{locker}-&gt;nunflock&#40;$G_LockDir{lockFile}&#41;;
                                             $G_LockDir{lockFile} = undef;
                                             next SUBSYS;
                              }


So,

1&#41;      Why is $lock_status not set to 0 on failure?

2&#41;      Why is $@ not set to an error message, your module knows it failing after all.

3&#41;      Are these bugs or what you wanted to do?  If so, why does the documentation not say how your function really is handling errors?  You should add some example code for errors.


John T. Kerich
Columbus Technologies and Services, Inc
Nasa GSFC
Building 13 Room 141 Cube 4
8800 Greenbelt Road
Greenbelt, MD 20771
Tel. #: &#40;301&#41; 286-5138
Fax #: &#40;301&#41; 286-7475
Email: john.t.kerich@nasa.gov&lt;mailto:john.t.kerich@nasa.gov&gt;
</div></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
