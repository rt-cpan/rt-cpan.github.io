<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #61381 for IO-Prompt: Weird behavior with IO::Prompt and numbers</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #61381 for IO-Prompt: Weird behavior with IO::Prompt and numbers</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/IO-Prompt/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/IO-Prompt/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/IO-Prompt/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/IO-Prompt/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/IO-Prompt">IO-Prompt CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">61381</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/IO-Prompt/Active/">IO-Prompt</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
edward.doolittle [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-17190-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-17191-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;16&nbsp;00:49:09&nbsp;2010</span>
    <span class="description">edward.doolittle [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Weird behavior with IO::Prompt and numbers</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 15 Sep 2010 22:48:59 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-io-prompt [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Edward Doolittle &lt;edward.doolittle [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I&#39;m using IO::Prompt to gather some information about dates at the
terminal.  Below is a transcript of the output, followed by the program.  As
you can see the calculated weekday for 2010-9-15 bounces all over the place,
as if there were some weird invisible garbage in the $day, $month, and/or
$year variables.  However, if I uncomment the commented line in my program
which just injects numbers into those variables rather than reads them from
the command line, the output is normal, consistent, and correct as
expected.  I concluded that the problem is with IO::Prompt and not with
Date::Calc.  I&#39;m running

This is perl, v5.10.1 &#40;*&#41; built for i486-linux-gnu-thread-multi
&#40;with 46 registered patches, see perl -V for more detail&#41;

on Debian Linux and version 0.997001 of IO::Prompt.  Can you tell me what
I&#39;m doing wrong, or what is wrong with IO::Prompt?

Edward


Month number: 9
Day number: 15
Year number: 2010
year is 2010, month is 9, day is 15, wday is 6
September 15, 2010 was a Saturday

Month number: 9
Day number: 15
Year number: 2010
year is 2010, month is 9, day is 15, wday is 3
September 15, 2010 was a Wednesday

Month number: 9
Day number: 15
Year number: 2010
year is 2010, month is 9, day is 15, wday is 6
September 15, 2010 was a Saturday

Month number: 9
Day number: 15
Year number: 2010
year is 2010, month is 9, day is 15, wday is 2
September 15, 2010 was a Tuesday

Month number: ^D dolittle@yoyodyne:~/Courses/math101$


#!/usr/bin/perl

use strict;
use warnings;
use Readonly;

use Date::Calc qw&#40; Day_of_Week &#41;;
use IO::Prompt;

my @days = qw&#40; Error    Monday    Tuesday  Wednesday
               Thursday Friday    Saturday Sunday
             &#41;;

my @mons = qw&#40; Error    January   February March
               April    May       June     July
               August   September October  November
               December
             &#41;;

Readonly my $MONTH_PROMPT   =&gt; q{Month number: };
Readonly my $DAY_PROMPT     =&gt; q{Day number:   };
Readonly my $YEAR_PROMPT    =&gt; q{Year number:  };

Readonly my $MONTH_REGEX    =&gt; qr/ [1-9] | 1[0-2] /x;
Readonly my $DAY_REGEX      =&gt; qr/ [1-9] | [1-2][0-9] | 3[0-1] /x;
Readonly my $YEAR_REGEX     =&gt; qr/ [1-9][0-9]* /x;

Readonly my $MONTH_REPROMPT =&gt; q{&#40;must be in range 1..12&#41; Month number: };
Readonly my $DAY_REPROMPT   =&gt; q{&#40;must be in range 1..31&#41; Day number:   };
Readonly my $YEAR_REPROMPT  =&gt; q{&#40;must be positve integer&#41; Year number: };

DATE:
while &#40;1&#41; {
    my $month
        = prompt&#40; $MONTH_PROMPT, -req =&gt; { $MONTH_REPROMPT =&gt; $MONTH_REGEX
}&#41;;
    last DATE if !$month;

    my $day
        = prompt&#40; $DAY_PROMPT,   -req =&gt; { $DAY_REPROMPT   =&gt; $DAY_REGEX }
&#41;;
    last DATE if !$day;

    my $year
        = prompt&#40; $YEAR_PROMPT,  -req =&gt; { $YEAR_REPROMPT  =&gt; $YEAR_REGEX }
&#41;;
    last DATE if !$year;

    last DATE if &#40;$month==6 &#38;&#38; $day==6 &#38;&#38; $year==66&#41;;

    #&#40;$year,$month,$day&#41; = &#40;2010,9,15&#41;;
    my $wday = Day_of_Week&#40;$year,$month,$day&#41;;

    print &#34;year is $year, month is $month, day is $day, wday is $wday\n&#34;;
    print &#34;$mons[$month] $day, $year was a $days[$wday]\n\n&#34;;
}

-- 
Edward Doolittle
Associate Professor of Mathematics
Department of Science
First Nations University of Canada
1 First Nations Way, Regina SK S4S 7K2
+1 &#40;306&#41; 537-9631
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;16&nbsp;04:18:13&nbsp;2010</span>
    <span class="description">damian [...] conway.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #61381] Weird behavior with IO::Prompt and numbers</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 16 Sep 2010 16:17:24 +0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-IO-Prompt [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Damian Conway &lt;damian [...] conway.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Edward,

I can&#39;t replicate the &#40;weird&#41; behaviour you&#39;re seeing when I run your
sample code on my own system under Perl 5.10.0.

That makes it tough to diagnose the problem. About the only possibility
that come to mind is that IO::Prompt returns an object &#40;with a
stringification overloading&#41;, not a simple string. It is *possible* that
Date::Calc::Day_of_Week&#40;&#41; doesn&#39;t like to be fed objects. In which case,
you could try changing the line:

   my $wday = Day_of_Week&#40;$year,$month,$day&#41;;

to:

   my $wday = Day_of_Week&#40;&#34;$year&#34;,&#34;$month&#34;,&#34;$day&#34;&#41;;

to ensure that you&#39;re feeding it actual strings &#40;instead of
stringifiable objects&#41;.

Let me know if that helps. If it does solve the problem, then &#40;arguably&#41;
the bug is in Date::Calc...but all that really matters is that we solved
your problem. :-&#41;

Meanwhile, I&#39;ll keep thinking about what else might be causing your
difficulties.

All the best,

Damian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;16&nbsp;04:18:14&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;16&nbsp;05:15:45&nbsp;2010</span>
    <span class="description">edward.doolittle [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #61381] Weird behavior with IO::Prompt and numbers</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 16 Sep 2010 03:15:33 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-IO-Prompt [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Edward Doolittle &lt;edward.doolittle [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Damian,

Stringifying the stringifiable objects as per your suggestion works for me.
Thanks!

The non-deterministic nature of the bug was rather surprising ... I guess it
might have something to do with the index of the memory location of the
object.

Should I report a bug to Date::Calc?

Edward



On Thu, Sep 16, 2010 at 2:18 AM, damian@conway.org via RT &lt;
bug-IO-Prompt@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=61381">https://rt.cpan.org/Ticket/Display.html?id=61381</a></span> &gt;
&gt;
&gt; Hi Edward,
&gt;
&gt; I can&#39;t replicate the &#40;weird&#41; behaviour you&#39;re seeing when I run your
&gt; sample code on my own system under Perl 5.10.0.
&gt;
&gt; That makes it tough to diagnose the problem. About the only possibility
&gt; that come to mind is that IO::Prompt returns an object &#40;with a
&gt; stringification overloading&#41;, not a simple string. It is *possible* that
&gt; Date::Calc::Day_of_Week&#40;&#41; doesn&#39;t like to be fed objects. In which case,
&gt; you could try changing the line:
&gt;
&gt;   my $wday = Day_of_Week&#40;$year,$month,$day&#41;;
&gt;
&gt; to:
&gt;
&gt;   my $wday = Day_of_Week&#40;&#34;$year&#34;,&#34;$month&#34;,&#34;$day&#34;&#41;;
&gt;
&gt; to ensure that you&#39;re feeding it actual strings &#40;instead of
&gt; stringifiable objects&#41;.
&gt;
&gt; Let me know if that helps. If it does solve the problem, then &#40;arguably&#41;
&gt; the bug is in Date::Calc...but all that really matters is that we solved
&gt; your problem. :-&#41;
&gt;
&gt; Meanwhile, I&#39;ll keep thinking about what else might be causing your
&gt; difficulties.
&gt;
&gt; All the best,
&gt;
&gt; Damian
&gt;
&gt;
</div>

-- 
Edward Doolittle
Associate Professor of Mathematics
Department of Science
First Nations University of Canada
1 First Nations Way, Regina SK S4S 7K2
&#40;306&#41; 537-9631
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;16&nbsp;16:36:00&nbsp;2010</span>
    <span class="description">damian [...] conway.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #61381] Weird behavior with IO::Prompt and numbers</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 17 Sep 2010 04:35:12 +0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-IO-Prompt [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Damian Conway &lt;damian [...] conway.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Edward,

Glad to hear that...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Stringifying the stringifiable objects as per your suggestion works for me.
</div>
I suspect that you&#39;re right: the inconsistent results might have been caused
by Date::Calc using the object addresses, rather than the object numerification.
This may be due to the fact that the module is implemented in C, not Perl
&#40;i.e. the C functions may be assuming they are passed day/month/year
numbers, but not
actually checking that, and hence just using the object references
directly as if they
were numbers, instead of invoking the correct numerical overloading.&#41;

If that is indeed the case, then it might be considered a bug in
Date::Calc, or at
least an omission from its documentation. On the other hand, since it worked
fine on my Mac under 5.10.0, it might also be a bug in Perl 5.10.1, or
in the C compiler
on Debian.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Should I report a bug to Date::Calc?
</div>
I think you should report the *situation* to Date::Calc and let the maintainer
decide if it&#39;s a bug &#40;or a feature ;-&#41;

All the best,

Damian

PS: If your using 5.10 or later and you find IO::Prompt useful, you
    might also be interested in its successor: IO::Prompter. It has a
    slightly different interface and feature set, but some nice
    additions you might find useful, not the least of which is that
    its feature set is fully documented!
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
