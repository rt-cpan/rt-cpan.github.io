<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #77078 for Tk: Tk::Spinbox , -invalidcommand not working</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #77078 for Tk: Tk::Spinbox , -invalidcommand not working</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Tk/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Tk/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Tk/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Tk/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Tk">Tk CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">77078</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Tk/Active/">Tk</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">SREZIC [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
DJIBEL [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-33610-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
804.030    </td>
  </tr>
  <tr id="CF-33611-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;09&nbsp;08:40:26&nbsp;2012</span>
    <span class="description">DJIBEL [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Tk::Spinbox , -invalidcommand not working</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dear,

-invalidcommand option not seem to be work.
run this script to see.

Return 0 have not effect too use -invalidcommand.

Best Regards,

N.B. Perl 5.14 &#40;ActivePerl&#41; on Windows XP, Debian &#40;perl 5.10&#41;.

#!/usr/bin/perl
use warnings;
use strict;             
use Tk;
 
my $mw = MainWindow-&gt;new&#40;-title =&gt; &#34;spinbox&#34;&#41;;
my $spinbox1 = $mw-&gt;Spinbox&#40;
                -width =&gt; 20,
                -value =&gt; [1 .. 10],
                -validate =&gt; &#39;all&#39;,
                -vcmd =&gt; \&#38;validate,
                -invalidcommand =&gt; \&#38;invalidate,
        &#41;-&gt;pack;
 
sub validate {
  my &#40;$proposed_value, undef, $current_value&#41; = @_;
        if &#40; $proposed_value == 3 &#41; { return 0; }
        
  print &#34;$current_value and $proposed_value\n&#34;;
        return 1;
}
 
sub invalidation {
  my &#40;$proposed_value, undef, $current_value&#41; = @_;
  print &#34;invalid : $proposed_value\n&#34;;
  $mw-&gt;bell;
}
 
MainLoop&#40;&#41;;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;17&nbsp;17:31:39&nbsp;2013</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2012-05-09 08:40:26, DJIBEL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Dear,
&gt; 
&gt; -invalidcommand option not seem to be work.
&gt; run this script to see.
&gt; 
&gt; Return 0 have not effect too use -invalidcommand.
&gt; 
&gt; Best Regards,
&gt; 
&gt; N.B. Perl 5.14 &#40;ActivePerl&#41; on Windows XP, Debian &#40;perl 5.10&#41;.
&gt; 
&gt; #!/usr/bin/perl
&gt; use warnings;
&gt; use strict;           
&gt; use Tk;
&gt;  
&gt; my $mw = MainWindow-&gt;new&#40;-title =&gt; &#34;spinbox&#34;&#41;;
&gt; my $spinbox1 = $mw-&gt;Spinbox&#40;
&gt;               -width =&gt; 20,
&gt;               -value =&gt; [1 .. 10],
&gt;               -validate =&gt; &#39;all&#39;,
&gt;               -vcmd =&gt; \&#38;validate,
&gt;               -invalidcommand =&gt; \&#38;invalidate,
&gt;       &#41;-&gt;pack;
&gt;  
&gt; sub validate {
&gt;   my &#40;$proposed_value, undef, $current_value&#41; = @_;
&gt;       if &#40; $proposed_value == 3 &#41; { return 0; }
&gt;       
&gt;   print &#34;$current_value and $proposed_value\n&#34;;
&gt;       return 1;
&gt; }
&gt;  
&gt; sub invalidation {
&gt;   my &#40;$proposed_value, undef, $current_value&#41; = @_;
&gt;   print &#34;invalid : $proposed_value\n&#34;;
&gt;   $mw-&gt;bell;
&gt; }
&gt;  
&gt; MainLoop&#40;&#41;;
</div>
I see a problem in your script: -invalidcommand calls invalidate, but the sub is actually called invalidation.

Regards,
    Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;17&nbsp;17:31:39&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;17&nbsp;17:31:40&nbsp;2013</span>
    <span class="description">SREZIC [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;18&nbsp;05:43:07&nbsp;2013</span>
    <span class="description">DJIBEL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le Ven 17 Mai 2013 17:31:39, SREZIC a écrit :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2012-05-09 08:40:26, DJIBEL wrote:
<div class="message-stanza open">&gt; &gt; Dear,
&gt; &gt;
&gt; &gt; -invalidcommand option not seem to be work.
&gt; &gt; run this script to see.
&gt; &gt;
&gt; &gt; Return 0 have not effect too use -invalidcommand.
&gt; &gt;
&gt; &gt; Best Regards,
&gt; &gt;
&gt; &gt; N.B. Perl 5.14 &#40;ActivePerl&#41; on Windows XP, Debian &#40;perl 5.10&#41;.
&gt; &gt;
&gt; &gt; #!/usr/bin/perl
&gt; &gt; use warnings;
&gt; &gt; use strict;
&gt; &gt; use Tk;
&gt; &gt;
&gt; &gt; my $mw = MainWindow-&gt;new&#40;-title =&gt; &#34;spinbox&#34;&#41;;
&gt; &gt; my $spinbox1 = $mw-&gt;Spinbox&#40;
&gt; &gt;             -width =&gt; 20,
&gt; &gt;             -value =&gt; [1 .. 10],
&gt; &gt;             -validate =&gt; &#39;all&#39;,
&gt; &gt;             -vcmd =&gt; \&#38;validate,
&gt; &gt;             -invalidcommand =&gt; \&#38;invalidate,
&gt; &gt;     &#41;-&gt;pack;
&gt; &gt;
&gt; &gt; sub validate {
&gt; &gt;   my &#40;$proposed_value, undef, $current_value&#41; = @_;
&gt; &gt;     if &#40; $proposed_value == 3 &#41; { return 0; }
&gt; &gt;
&gt; &gt;   print &#34;$current_value and $proposed_value\n&#34;;
&gt; &gt;     return 1;
&gt; &gt; }
&gt; &gt;
&gt; &gt; sub invalidation {
&gt; &gt;   my &#40;$proposed_value, undef, $current_value&#41; = @_;
&gt; &gt;   print &#34;invalid : $proposed_value\n&#34;;
&gt; &gt;   $mw-&gt;bell;
&gt; &gt; }
&gt; &gt;
&gt; &gt; MainLoop&#40;&#41;;
</div>&gt; 
&gt; I see a problem in your script: -invalidcommand calls invalidate, but
&gt; the sub is actually called invalidation.
&gt; 
&gt; Regards,
&gt;     Slaven
</div>
Dear Slaven,

Test this script :

#!/usr/bin/perl
use warnings;
use strict;             
use Tk;
 
my $mw = MainWindow-&gt;new&#40;-title =&gt; &#34;spinbox&#34;&#41;;
my $spinbox1 = $mw-&gt;Spinbox&#40;
                -width          =&gt; 20,
                -value          =&gt; [1 .. 10],
                -validate       =&gt; &#39;all&#39;,
                -vcmd           =&gt; \&#38;validate,
                -invalidcommand =&gt; \&#38;invalidation,
&#41;-&gt;pack;
 
sub validate {
  my &#40;$proposed_value, undef, $current_value&#41; = @_;
        if &#40; $proposed_value == 3 &#41; { 
                print &#34;Sub : validate -&gt; $proposed_value\n&#34;;
                $mw-&gt;bell;
                return 0; 
        }
        
        print &#34;$current_value and $proposed_value\n&#34;;
        return 1;
}
 
sub invalidation {
  my &#40;$proposed_value, undef, $current_value&#41; = @_;
        
  print &#34;Sub : invalidation -&gt; $proposed_value and $current_value\n&#34;;
  $mw-&gt;bell;
}
 
MainLoop&#40;&#41;;

The invalidation sub is never called.
If you use spinbox from 1 to 10, at 3, the invalidation sub is not called, just validate sub. And after that, from 4 to 10 any sub didn&#39;t called.

Best Regards,

Djibel
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;18&nbsp;05:44:10&nbsp;2013</span>
    <span class="description">DJIBEL [...] cpan.org -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;18&nbsp;05:44:10&nbsp;2013</span>
    <span class="description">DJIBEL [...] cpan.org -  Given to SREZIC</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;16&nbsp;10:02:10&nbsp;2013</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2013-05-18 05:43:07, DJIBEL wrote:

[..]

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; The invalidation sub is never called.
&gt; If you use spinbox from 1 to 10, at 3, the invalidation sub is not
&gt; called, just validate sub. And after that, from 4 to 10 any sub didn&#39;t
&gt; called.
</div>
Hello Djibel,

my analysis look like following: validation seems to work if numbers are entered directly in the entry part of the spinbox. So if I enter &#34;3&#34; into the entry, I see the &#34;Sub : invalidation ...&#34; string printed, and validation of further numbers still works. It just does not work if the arrow buttons of the spinbox are used. Once the invalidcmd is hit, validation is completely turned off.

A similar Tcl/Tk script &#40;see attachment&#41; behaves the same.

Looking at the C code, the problem seems to happen in EntryValidateChang in tkEntry.c. There&#39;s a comment telling:

        /*
         * If we were doing forced validation &#40;like via a variable trace&#41; and
         * the command returned 0, the we turn off validation because we
         * assume that textvariables have precedence in managing the value.
         * We also don&#39;t call the invcmd, as it may want to do entry
         * manipulation which the setting of the var will later wipe anyway.
         */

It seems that this &#34;turn off validation&#34; unfortunately also happens for selecting the up/down arrows.

I can just propose a workaround: define the -command option to explicitely do the validation, e.g. like this:

    -command =&gt; sub { $spinbox1-&gt;validate },

This way the invalidecmd seems also to be called when selecting the up/down arrows.

Let me know if this workaround works for you.

Regards,
    Slaven
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> invtk.tcl</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">proc val {a} {
    if {$a == 3} { return 0 }
    puts &#34;val: $a&#34;
    return 1
}

proc invalidation {a} {
    puts &#34;inv: $a&#34;
    return 0
}

       
spinbox .s -value &#34;1 2 3 4 5&#34; -width 20 -validate all -vcmd {val %P} -invalidcommand {invalidation %P}
pack .s

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;26&nbsp;14:21:29&nbsp;2014</span>
    <span class="description">DJIBEL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le Sam 16 Nov 2013 10:02:10, SREZIC a écrit :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2013-05-18 05:43:07, DJIBEL wrote:
&gt; 
&gt; [..]
&gt; 
<div class="message-stanza open">&gt; &gt;
&gt; &gt; The invalidation sub is never called.
&gt; &gt; If you use spinbox from 1 to 10, at 3, the invalidation sub is not
&gt; &gt; called, just validate sub. And after that, from 4 to 10 any sub
&gt; &gt; didn&#39;t
&gt; &gt; called.
</div>&gt; 
&gt; Hello Djibel,
&gt; 
&gt; my analysis look like following: validation seems to work if numbers
&gt; are entered directly in the entry part of the spinbox. So if I enter
&gt; &#34;3&#34; into the entry, I see the &#34;Sub : invalidation ...&#34; string printed,
&gt; and validation of further numbers still works. It just does not work
&gt; if the arrow buttons of the spinbox are used. Once the invalidcmd is
&gt; hit, validation is completely turned off.
&gt; 
&gt; A similar Tcl/Tk script &#40;see attachment&#41; behaves the same.
&gt; 
&gt; Looking at the C code, the problem seems to happen in
&gt; EntryValidateChang in tkEntry.c. There&#39;s a comment telling:
&gt; 
&gt; /*
&gt;  * If we were doing forced validation &#40;like via a variable trace&#41; and
&gt;  * the command returned 0, the we turn off validation because we
&gt;  * assume that textvariables have precedence in managing the value.
&gt;  * We also don&#39;t call the invcmd, as it may want to do entry
&gt;  * manipulation which the setting of the var will later wipe anyway.
&gt;  */
&gt; 
&gt; It seems that this &#34;turn off validation&#34; unfortunately also happens
&gt; for selecting the up/down arrows.
&gt; 
&gt; I can just propose a workaround: define the -command option to
&gt; explicitely do the validation, e.g. like this:
&gt; 
&gt; -command =&gt; sub { $spinbox1-&gt;validate },
&gt; 
&gt; This way the invalidecmd seems also to be called when selecting the
&gt; up/down arrows.
&gt; 
&gt; Let me know if this workaround works for you.
&gt; 
&gt; Regards,
&gt;     Slaven
</div>

Dear Slaven,

Using this program seem to be ok

#!/usr/bin/perl 
use warnings;
use strict;
use Tk;
my $mw = MainWindow-&gt;new&#40; -title =&gt; &#34;spinbox&#34; &#41;;
my $spinbox1 = $mw-&gt;Spinbox&#40;
        -width          =&gt; 20,
        -value          =&gt; [ 1 .. 10 ],
        -validate       =&gt; &#39;all&#39;,
        -vcmd           =&gt; \&#38;validate,
        -invalidcommand =&gt; \&#38;invalidation,
&#41;-&gt;pack;
$spinbox1-&gt;configure&#40; -command =&gt; sub { $spinbox1-&gt;validate } &#41;;
sub validate {
        my &#40; $proposed_value, undef, $current_value &#41; = @_;
        if &#40; $proposed_value == 3 &#41; { print &#34;Sub : validate -&gt; $proposed_value\n&#34;; $mw-&gt;bell; return 0; }
        print &#34;$current_value and $proposed_value\n&#34;;
        return 1;
}

sub invalidation {
        my &#40; $proposed_value, undef, $current_value &#41; = @_;
        print &#34;Sub : invalidation -&gt; $proposed_value and $current_value\n&#34;;
        $mw-&gt;bell;
}
MainLoop&#40;&#41;;

I have add your suggestion : $spinbox1-&gt;configure&#40; -command =&gt; sub { $spinbox1-&gt;validate } &#41;;

I don&#39;t know how you can patch Tk module.


Best Regards
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
