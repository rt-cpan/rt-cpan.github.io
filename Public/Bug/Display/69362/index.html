<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #69362 for DBD-ODBC: Does not prepend N to Unicode strings when preparing statements for MSSQL.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #69362 for DBD-ODBC: Does not prepend N to Unicode strings when preparing statements for MSSQL.</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DBD-ODBC/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DBD-ODBC/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DBD-ODBC/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DBD-ODBC/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-ODBC">DBD-ODBC CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">69362</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DBD-ODBC/Active/">DBD-ODBC</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
starrychloe [...] oliveyou.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-10188-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.31    </td>
  </tr>
  <tr id="CF-10189-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;08&nbsp;09:09:21&nbsp;2011</span>
    <span class="description">starrychloe [...] oliveyou.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Does not prepend N to Unicode strings when preparing statements
 for MSSQL.</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here is some code and the output

my $db1 = DBI-&gt;connect&#40;&#39;dbi:ODBC:SFSDB&#39;, &#39;xxx&#39;, &#39;xxx&#39;&#41;;
...
print &#34;ODBC has unicode=&#34;,$db1-&gt;{&#39;odbc_has_unicode&#39;},&#34;\n&#34;;
...
map {printf &#40;&#34;$_, %d\n&#34;, utf8::is_utf8&#40;$_&#41;&#41;} @values;
print &#34;Values: &#34;, Dumper&#40;@values&#41;;
$sthUpdate-&gt;trace&#40;2&#41;;
$sthUpdate-&gt;execute&#40;@values&#41;;

----------

ODBC has unicode=1
7, 1
1411, 1
...
Buster Caf├⌐, 1
...
Values: $VAR1 = &#39;7&#39;;
$VAR2 = &#39;1411&#39;;
...
$VAR5 = &#34;Buster Caf\x{c3}\x{a9}&#34;;
...
Binding parameters: update merchants set merchantStatus_id=&#39;7&#39;,
salesRep_id=&#39;1411&#39;, SICCodeID=&#39;xxxxx&#39;, MerchantName=&#39;xxxxxx&#39;,
MerchantDBA=&#39;Buster Caf├â┬⌐&#39;, TaxID=&#39;xxxxx&#39;, Website=NULL,
MinimumBridgeAccountBalance=&#39;xxxxx&#39;, ........ where id=&#39;35&#39;

------------------------
Resulting value in DB as displayed in MSSQL Studio: Buster CafÃ©
------------------------

The column is definitely nvarchar.
Windows Server 2008 R2
ActiveState Perl 5.10.1 x64
DBD::ODBC       : 1.31
DBI             : 1.615
MSSQL Server 2008
Notice ODBC has Unicode.
Notice is_utf8&#40;&#41; returns 1 for each value.
It does not display correctly in the console because of ActiveState.
ActiveState Perl won&#39;t even display a hard coded UTF character properly.
Only Cygwin Perl will display Unicode correctly in console.
Notice the hex values are correct for accented e &#40;é&#41;. 
Notice the generated SQL does not prepend a N to the strings.
This is a general purpose synchronization script, so it is unknown
beforehand if the field is text or number.
It relies on prepared statements and parameters.
This also fails in Strawberry Perl.
Unknown if Cygwin Perl succeeds, as the script also requires MySQL
driver which could not be compiled under Cygwin.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;08&nbsp;10:15:10&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jul 08 09:09:21 2011, starrychloe wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Here is some code and the output
&gt; 
&gt; my $db1 = DBI-&gt;connect&#40;&#39;dbi:ODBC:SFSDB&#39;, &#39;xxx&#39;, &#39;xxx&#39;&#41;;
&gt; ...
&gt; print &#34;ODBC has unicode=&#34;,$db1-&gt;{&#39;odbc_has_unicode&#39;},&#34;\n&#34;;
&gt; ...
&gt; map {printf &#40;&#34;$_, %d\n&#34;, utf8::is_utf8&#40;$_&#41;&#41;} @values;
&gt; print &#34;Values: &#34;, Dumper&#40;@values&#41;;
&gt; $sthUpdate-&gt;trace&#40;2&#41;;
&gt; $sthUpdate-&gt;execute&#40;@values&#41;;
&gt; 
&gt; ----------
&gt; 
&gt; ODBC has unicode=1
&gt; 7, 1
&gt; 1411, 1
&gt; ...
&gt; Buster Caf├⌐, 1
&gt; ...
&gt; Values: $VAR1 = &#39;7&#39;;
&gt; $VAR2 = &#39;1411&#39;;
&gt; ...
&gt; $VAR5 = &#34;Buster Caf\x{c3}\x{a9}&#34;;
&gt; ...
&gt; Binding parameters: update merchants set merchantStatus_id=&#39;7&#39;,
&gt; salesRep_id=&#39;1411&#39;, SICCodeID=&#39;xxxxx&#39;, MerchantName=&#39;xxxxxx&#39;,
&gt; MerchantDBA=&#39;Buster Caf├â┬⌐&#39;, TaxID=&#39;xxxxx&#39;, Website=NULL,
&gt; MinimumBridgeAccountBalance=&#39;xxxxx&#39;, ........ where id=&#39;35&#39;
&gt; 
&gt; ------------------------
&gt; Resulting value in DB as displayed in MSSQL Studio: Buster CafÃ©
&gt; ------------------------
&gt; 
&gt; The column is definitely nvarchar.
&gt; Windows Server 2008 R2
&gt; ActiveState Perl 5.10.1 x64
&gt; DBD::ODBC       : 1.31
&gt; DBI             : 1.615
&gt; MSSQL Server 2008
&gt; Notice ODBC has Unicode.
&gt; Notice is_utf8&#40;&#41; returns 1 for each value.
&gt; It does not display correctly in the console because of ActiveState.
&gt; ActiveState Perl won&#39;t even display a hard coded UTF character 
</div>properly.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Only Cygwin Perl will display Unicode correctly in console.
&gt; Notice the hex values are correct for accented e &#40;é&#41;. 
&gt; Notice the generated SQL does not prepend a N to the strings.
&gt; This is a general purpose synchronization script, so it is unknown
&gt; beforehand if the field is text or number.
&gt; It relies on prepared statements and parameters.
&gt; This also fails in Strawberry Perl.
&gt; Unknown if Cygwin Perl succeeds, as the script also requires MySQL
&gt; driver which could not be compiled under Cygwin.
</div>
I&#39;m confused by this report and especially with the subject as I don&#39;t 
see why DBD::ODBC should prepend N to anything. In any case you are 
binding parameters and your SQL itself is not unicode. How anything is 
displayed in a console is nothing to do with DBD::ODBC either.

The output you show of $VAR5 = &#34;Buster Caf\x{c3}\x{a9}&#34;; does not look 
right to me  either as it should be a single character not two.

Perhaps you can try:

use DBI;
use strict;
use Data::Dumper;

my $h = DBI-&gt;connect&#40;&#39;dbi:ODBC:xxx&#39;,&#39;xxx&#39;,&#39;xxx&#39;&#41;;
eval {
    $h-&gt;do&#40;q/drop table mje/&#41;;
};
$h-&gt;do&#40;q/create table mje &#40;a nvarchar&#40;20&#41;&#41;/&#41;;
$h-&gt;do&#40;q/insert into mje values&#40;?&#41;/, undef, &#34;\x{20ac}&#34;&#41;;
my $s = $h-&gt;prepare&#40;q/select * from mje/&#41;;
$s-&gt;execute;
my $f = $s-&gt;fetchall_arrayref;
print Dumper&#40;$f&#41;, &#34;\n&#34;;

which outputs:

$VAR1 = [
          [
            &#39;€&#39;
          ]
        ];

for me with a working unicode ODBC driver.

I cannot tell from your example whether your data is correct or not. 
Perhaps you could write a small example like mine above which 
demonstrates a problem instead of partial snippets from your code. For 
instance, put your unicode strings in the Perl code itself so I can see 
them.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;08&nbsp;10:15:12&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;08&nbsp;10:15:44&nbsp;2011</span>
    <span class="description">starrychloe [...] spamarrest.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #69362] Does not prepend N to Unicode strings when preparing statements for MSSQL.  &#40;verification&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri,  8 Jul 2011 09:15:30 -0500 &#40;CDT&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-dbd-odbc [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Chloe &lt;starrychloe [...] spamarrest.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Chloe here,

I&#39;m protecting myself from receiving junk mail.


Please click the link below to complete the verification process.
You have to do this only once.

<span class="clickylink"><a target="new" rel="nofollow" href="http://www.spamarrest.com/a2?AQR4AwV5BGcvqJpgMTWxYJ9xLzANpaDhL3Ouov5ipzpj">http://www.spamarrest.com/a2?AQR4AwV5BGcvqJpgMTWxYJ9xLzANpaDhL3Ouov5ipzpj</a></span>




Spam Arrest - Take control of your inbox!

------------------------------------------------------------
You are receiving this message in response to your email to
Chloe, a Spam Arrest customer.

Spam Arrest requests that senders verify themselves before
their email is delivered.

When you click the above link, you will be taken to a page
with a graphic on it. Simply read the word in the graphic,
type it into the form, and you&#39;re verified.

You have to do this only once per Spam Arrest customer.
------------------------------------------------------------
Below are the complete headers of the message that this email 
was generated in response to.

Return-path: &lt;rtcpan@cpan.rt.develooper.com&gt;
Envelope-to: starrychloe@oliveyou.net
Delivery-date: Fri, 08 Jul 2011 07:15:14 -0700
Received: from cpan.rt.develooper.com &#40;[207.171.7.181]&#41;
        by phobos.lunarpages.com with esmtp &#40;Exim 4.69&#41;
        &#40;envelope-from &lt;rtcpan@cpan.rt.develooper.com&gt;&#41;
        id 1QfBpq-0000X7-E2
        for starrychloe@oliveyou.net; Fri, 08 Jul 2011 07:15:14 -0700
Received: by cpan.rt.develooper.com &#40;Postfix, from userid 536&#41;
        id 35BF37057; Fri,  8 Jul 2011 07:15:12 -0700 &#40;PDT&#41;
Precedence: normal
Subject: [rt.cpan.org #69362] Does not prepend N to Unicode strings when preparing statements for MSSQL. 
From: &#34;Martin J Evans via RT&#34; &lt;bug-DBD-ODBC@rt.cpan.org&gt;
Reply-To: bug-DBD-ODBC@rt.cpan.org
In-Reply-To: 
References: &lt;RT-Ticket-69362@rt.cpan.org&gt;
Message-ID: &lt;rt-3.8.HEAD-9061-1310134511-16.69362-6-0@rt.cpan.org&gt;
X-RT-Loop-Prevention: rt.cpan.org
RT-Ticket: rt.cpan.org #69362
Managed-by: RT 3.8.HEAD &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.bestpractical.com/rt/&#41;">http://www.bestpractical.com/rt/&#41;</a></span>
RT-Originator: bohica@ntlworld.com
To: starrychloe@oliveyou.net
MIME-Version: 1.0
Content-Type: text/plain; charset=&#34;utf-8&#34;
X-RT-Original-Encoding: utf-8
Date: Fri, 8 Jul 2011 10:15:12 -0400
Content-Transfer-Encoding: quoted-printable
X-Spam-Status: No, score=-1.9
X-Spam-Score: -18
X-Spam-Bar: -
X-Ham-Report: Spam detection software, running on the system &#34;phobos.lunarpages.com&#34;, has
        identified this incoming email as possible spam.  The original message
        has been attached to this so you can view it &#40;if it isn&#39;t spam&#41; or label
        similar future email.  If you have any questions, see
        the administrator of that system for details.
        Content preview:  &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=69362">https://rt.cpan.org/Ticket/Display.html?id=69362</a></span> &gt; On
        Fri Jul 08 09:09:21 2011, starrychloe wrote: &gt; Here is some code and the
        output &gt; &gt; my $db1 = DBI-&gt;connect&#40;&#39;dbi:ODBC:SFSDB&#39;, &#39;xxx&#39;, &#39;xxx&#39;&#41;; &gt; ... &gt;
        print &#34;ODBC has unicode=&#34;,$db1-&gt;{&#39;odbc_has_unicode&#39;},&#34;\n&#34;; &gt; ... &gt; map {printf
        &#40;&#34;$_, %d\n&#34;, utf8::is_utf8&#40;$_&#41;&#41;} @values; &gt; print &#34;Values: &#34;, Dumper&#40;@values&#41;;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">        &gt; $sthUpdate-&gt;trace&#40;2&#41;; &gt; $sthUpdate-&gt;execute&#40;@values&#41;; &gt; &gt; &gt; &gt; ODBC has
</div>        unicode=1 &gt; 7, 1 &gt; 1411, 1 &gt; ... &gt; Buster Cafââ, 1 &gt; ... &gt; Values: $VAR1
        = &#39;7&#39;; &gt; $VAR2 = &#39;1411&#39;; &gt; ... &gt; $VAR5 = &#34;Buster Caf\x{c3}\x{a9}&#34;; &gt; ...
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">        &gt; Binding parameters: update merchants set merchantStatus_id=&#39;7&#39;, &gt; salesRep_id=&#39;1411&#39;,
</div>        SICCodeID=&#39;xxxxx&#39;, MerchantName=&#39;xxxxxx&#39;, &gt; MerchantDBA=&#39;Buster CafâÃ¢â¬â&#39;,
        TaxID=&#39;xxxxx&#39;, Website=NULL, &gt; MinimumBridgeAccountBalance=&#39;xxxxx&#39;, ........
        where id=&#39;35&#39; &gt; &gt; &gt; Resulting value in DB as displayed in MSSQL Studio: Buster
        CafÃÂ© &gt; &gt; &gt; The column is definitely nvarchar. &gt; Windows Server 2008 R2
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">        &gt; ActiveState Perl 5.10.1 x64 &gt; DBD::ODBC : 1.31 &gt; DBI : 1.615 &gt; MSSQL Server
</div>        2008 &gt; Notice ODBC has Unicode. &gt; Notice is_utf8&#40;&#41; returns 1 for each value.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">        &gt; It does not display correctly in the console because of ActiveState. &gt;
</div>        ActiveState Perl won&#39;t even display a hard coded UTF character properly. &gt;
        Only Cygwin Perl will display Unicode correctly in console. &gt; Notice the
        hex values are correct for accented e &#40;Ã©&#41;. &gt; Notice the generated SQL does
        not prepend a N to the strings. &gt; This is a general purpose synchronization
        script, so it is unknown &gt; beforehand if the field is text or number. &gt; It
        relies on prepared statements and parameters. &gt; This also fails in Strawberry
        Perl. &gt; Unknown if Cygwin Perl succeeds, as the script also requires MySQL
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">        &gt; driver which could not be compiled under Cygwin. [...] 
</div>        Content analysis details:   &#40;-1.9 points, 5.0 required&#41;
        pts rule name              description
        ---- ---------------------- --------------------------------------------------
        -0.0 T_RP_MATCHES_RCVD      Envelope sender domain matches handover relay
        domain
        -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
        [score: 0.0000]
X-Spam-Flag: NO
Received-SPF: none&#40;rt.cpan.org: rt.cpan.org does not designate permitted sender hosts&#41;



------------------------------------------------------------
Webmasters help stop spam and make 50%.
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.spamarrest.com/affl?4186299/affiliates/index.jsp">http://www.spamarrest.com/affl?4186299/affiliates/index.jsp</a></span> 

------------------------------------------------------------
</div></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;08&nbsp;11:09:09&nbsp;2011</span>
    <span class="description">starrychloe [...] oliveyou.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> starrychloe [...] oliveyou.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Unicode é is C3 A9 in bytes
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.utf8-chartable.de/">http://www.utf8-chartable.de/</a></span>

MSSQL doesn&#39;t support Unicode connections, so must specify N&#39;string&#39; to 
signify Unicode:
<span class="clickylink"><a target="new" rel="nofollow" href="http://support.microsoft.com/kb/239530">http://support.microsoft.com/kb/239530</a></span> 
<span class="clickylink"><a target="new" rel="nofollow" href="http://stackoverflow.com/questions/1379416/insert-utf8-data-into-a-ms-sql-">http://stackoverflow.com/questions/1379416/insert-utf8-data-into-a-ms-sql-</a></span>
server-2008

Will try your example...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;08&nbsp;12:21:34&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jul 08 11:09:09 2011, starrychloe wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Unicode é is C3 A9 in bytes
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.utf8-chartable.de/">http://www.utf8-chartable.de/</a></span>
&gt; 
&gt; MSSQL doesn&#39;t support Unicode connections, so must specify N&#39;string&#39; 
</div>to 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; signify Unicode:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://support.microsoft.com/kb/239530">http://support.microsoft.com/kb/239530</a></span> 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://stackoverflow.com/questions/1379416/insert-utf8-data-into-a-ms-">http://stackoverflow.com/questions/1379416/insert-utf8-data-into-a-ms-</a></span>
</div>sql-
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; server-2008
&gt; 
&gt; Will try your example...
</div>
Firstly there was a small error in the output I gave above. It should 
have been:

$VAR1 = [
          [
            &#34;\x{20ac}&#34;
          ]
        ];

Secondly, don&#39;t believe everything you read on the net as fact and don&#39;t 
take answers for C# as being the right answers for Perl and ODBC. The 
ODBC specification supports unicode encoded in UCS2 as does MS SQL 
Server and the MS SQL Server driver. The code I posted works and you 
don&#39;t need any N prefix.

I will drag out some more examples for you but it is going to make no 
difference. If you bind your parameters as in &#34;insert into mytable 
values&#40;?&#41;&#34; you only need to ensure they are bound as SQL_WCHARs and 
DBD::ODBC will do that for you. Avoid unicode in SQL text but that does 
mostly work too.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;08&nbsp;12:23:17&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jul 08 12:21:34 2011, MJEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri Jul 08 11:09:09 2011, starrychloe wrote:
<div class="message-stanza open">&gt; &gt; Unicode é is C3 A9 in bytes
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.utf8-chartable.de/">http://www.utf8-chartable.de/</a></span>
&gt; &gt; 
&gt; &gt; MSSQL doesn&#39;t support Unicode connections, so must specify N&#39;string&#39; 
</div>&gt; to 
<div class="message-stanza open">&gt; &gt; signify Unicode:
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://support.microsoft.com/kb/239530">http://support.microsoft.com/kb/239530</a></span> 
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://stackoverflow.com/questions/1379416/insert-utf8-data-into-a-">http://stackoverflow.com/questions/1379416/insert-utf8-data-into-a-</a></span>
</div></div>ms-
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; sql-
<div class="message-stanza open">&gt; &gt; server-2008
&gt; &gt; 
&gt; &gt; Will try your example...
</div>&gt; 
&gt; Firstly there was a small error in the output I gave above. It should 
&gt; have been:
&gt; 
&gt; $VAR1 = [
&gt;           [
&gt;             &#34;\x{20ac}&#34;
&gt;           ]
&gt;         ];
&gt; 
&gt; Secondly, don&#39;t believe everything you read on the net as fact and 
</div>don&#39;t 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; take answers for C# as being the right answers for Perl and ODBC. The 
&gt; ODBC specification supports unicode encoded in UCS2 as does MS SQL 
&gt; Server and the MS SQL Server driver. The code I posted works and you 
&gt; don&#39;t need any N prefix.
&gt; 
&gt; I will drag out some more examples for you but it is going to make no 
&gt; difference. If you bind your parameters as in &#34;insert into mytable 
&gt; values&#40;?&#41;&#34; you only need to ensure they are bound as SQL_WCHARs and 
&gt; DBD::ODBC will do that for you. Avoid unicode in SQL text but that 
</div>does 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; mostly work too.
&gt; 
&gt; Martin
</div>
unicode in sql example:

use DBI;
use strict;
use warnings;
use Data::Dumper;

my $h = DBI-&gt;connect&#40;&#39;dbi:ODBC:xxx&#39;,&#39;xx&#39;,&#39;xx&#39;&#41;;
eval {$h-&gt;do&#40;q/drop table martin/&#41;;};

print &#34;Has unicode: &#34; . $h-&gt;{odbc_has_unicode} . &#34;\n&#34;;

$h-&gt;do&#40;q/create table martin &#40;a nvarchar&#40;100&#41;&#41;/&#41;;

my $s = $h-&gt;prepare&#40;q/insert into martin values&#40;?&#41;/&#41;;
$s-&gt;execute&#40;&#34;\x{20ac}&#34;&#41;;

my $r = $h-&gt;selectall_arrayref&#40;q/select * from martin/&#41;;
print Dumper&#40;$r&#41;;

my $sql = &#39;insert into martin values&#40;&#39; . $h-&gt;quote&#40;&#34;\x{20ac}&#34;&#41; . &#39;&#41;&#39;;
$h-&gt;do&#40;$sql&#41;;

$r = $h-&gt;selectall_arrayref&#40;q/select * from martin/&#41;;

and output:

Has unicode: 1
$VAR1 = [
          [
            &#34;\x{20ac}&#34;
          ]
        ];
$VAR1 = [
          [
            &#34;\x{20ac}&#34;
          ],
          [
            &#34;\x{20ac}&#34;
          ]
        ];

Notice no N - it is not required.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;15&nbsp;22:37:15&nbsp;2011</span>
    <span class="description">starrychloe [...] oliveyou.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> starrychloe [...] oliveyou.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Yes, your example did work, and it did NOT work for the MySQL driver, 
despite &#39;set names utf8&#39; being called. I believe the error is with the 
MySQL driver and will enter a bug there instead.

I was confused because I displayed the hex values of the string inside 
the MSSQL Studio itself using

select master.dbo.fn_varbintohexstr&#40;cast&#40;a as varbinary&#41;&#41;, a from mje;

and the é is stored as E9 in MSSQL yet stored as C3 A9 in a text file 
and in MySQL. That was odd but I suppose it is ok. I believe it is 
because MSSQL is using UTF16 instead of UTF8. When updating or inserting 
C3 A9 into MSSQL, I expected it to recognize the é and display é inside 
MSSQL Studio. Now I realize Perl should not have received the bytes C3 
A9 in the first place, and the hex values inside Perl should have been 
E9 as well, with the Unicode bit set on the string. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;17&nbsp;04:37:06&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
