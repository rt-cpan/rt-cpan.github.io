<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #44860 for DBIx-Class: DBIx generates incorrect SQL with DISTINCT keyword</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #44860 for DBIx-Class: DBIx generates incorrect SQL with DISTINCT keyword</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DBIx-Class/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DBIx-Class/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DBIx-Class/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DBIx-Class/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBIx-Class">DBIx-Class CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">44860</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DBIx-Class/Active/">DBIx-Class</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
mfawcett [...] bigpond.net.au

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10410-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10411-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.08103    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;08&nbsp;01:40:09&nbsp;2009</span>
    <span class="description">mfawcett [...] bigpond.net.au -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> DBIx generates incorrect SQL with DISTINCT keyword</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 08 Apr 2009 15:39:52 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike Fawcett &lt;mfawcett [...] bigpond.net.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza">  
  


The following appears the be a bug in generating SQL where the select
list contains the DISTINCT keyword, inserting invalid brackets around
the select list columns.<br>

<br>

Postgresql database: (postgres version 8.1.5-13)<br>

create table member(<br>

&nbsp;&nbsp;&nbsp; member_id integer primary key,<br>

&nbsp;&nbsp;&nbsp; last_name text not null,<br>

&nbsp;&nbsp;&nbsp; first_name text not null<br>

) ;<br>

<br>

Perl program: (perl version is 5.8.8, DBIx::Class version is .08010)<br>

<br>

use strict;<br>

use warnings;<br>

use FindBin;<br>

use lib "$FindBin::Bin/../lib";<br>

<br>

use Fred::Schema ;<br>

<br>

my $schema = Fred::Schema-&gt;connect("dbi:Pg:dbname=fred","fred","") ;<br>

my $storage = $schema-&gt;storage ;<br>

$storage-&gt;debug(1) ;<br>

my @rows = $schema-&gt;resultset('Member')-&gt;search(<br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {},<br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { select =&gt; [{ distinct =&gt;
['member_id','last_name']}],<br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; as =&gt; ['member_id','last_name']<br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ) ;<br>

<br>

Program debugging output:<br>

<br>

SELECT DISTINCT( member_id, last_name ) FROM member me:<br>

DBIx::Class::ResultSet::search(): DBI Exception: DBD::Pg::st execute
failed: ERROR:&nbsp; could not identify an ordering operator for type record<br>

HINT:&nbsp; Use an explicit ordering operator or modify the query.<br>

&nbsp;[for Statement "SELECT DISTINCT( member_id, last_name ) FROM member
me"] at ./script/distinct.pl line 13<br>

<br>

Analysis:<br>

<br>

The brackets surrounding the select list column names are invalid
according to the SQL definition. <br>

SELECT DISTINCT<b>
<font>(</font>
 </b>member_id,
last_name<b>
<font> )</font>
</b> FROM member me:<br>

The correct SQL is:<br>

SELECT DISTINCT&nbsp; member_id, last_name&nbsp; FROM member me<br>

<br>

Regards<br>

<br>

Mike Fawcett<br>

<br>

<br>

<br>




</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;08&nbsp;05:47:15&nbsp;2009</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Apr 08 01:40:09 2009, mfawcett@bigpond.net.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  The following appears the be a bug in generating SQL where the select
&gt; list
&gt; contains the DISTINCT keyword, inserting invalid brackets around the
&gt; select
&gt; list columns.
&gt; 
&gt; The brackets surrounding the select list column names are invalid
&gt; according to
&gt; the SQL definition.
&gt; SELECT DISTINCT&#40; member_id, last_name &#41; FROM member me:
&gt; The correct SQL is:
&gt; SELECT DISTINCT member_id, last_name FROM member me
&gt; 
</div>
Hi Mike,

The version you are currently using is unfortunately rather old. You
would want to at least upgrade to 08013 which will pull in a rewritten
SQL::Abstract, which may very well solve your problem.

In any case I would encourage you to try our developer release 08099_08
aka 08100 RC2. Although we are not aware of any issues with it, we are
in great need of field testers to validate our assumptions about the
quality of this release. The sooner I receive *some* feedback from
anyone, the faster 08100 will become a reality.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;08&nbsp;05:47:15&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;09&nbsp;03:34:51&nbsp;2009</span>
    <span class="description">mfawcett [...] bigpond.net.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #44860] DBIx generates incorrect SQL with DISTINCT keyword</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 09 Apr 2009 17:34:35 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike Fawcett &lt;mfawcett [...] bigpond.net.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza">  
  


Hi Peter,<br>

<br>

I have installed DBIx 08013 and  identified the source of my problem 
in the module DBIx::Class::Storage::DBI.pm.<br>

When I make the change indicated in red below my problem is resolved.<br>

I'm not sure of the wider implications of the change. I can't offhand
think of a situation in SQL in which the brackets would be required,
but presumably they were put there for some good reason initially.<br>

<br>

I'd be happy to try your developer release, but I'm not quite sure how
to get hold of it.<br>

<br>

regards<br>

Mike Fawcett<br>

<br>

sub _recurse_fields {<br>

  my ($self, $fields, $params) = @_;<br>

  my $ref = ref $fields;<br>

  return $self-&gt;_quote($fields) unless $ref;<br>

  return $$fields if $ref eq 'SCALAR';<br>

<br>

  if ($ref eq 'ARRAY') {<br>

    return join(', ', map {<br>

      $self-&gt;_recurse_fields($_)<br>

        .(exists $self-&gt;{rownum_hack_count} &amp;&amp; !($params
&amp;&amp; $params-&gt;{no_rownum_hack})<br>

          ? ' AS col'.$self-&gt;{rownum_hack_count}++<br>

          : '')<br>

      } @$fields);<br>

  } elsif ($ref eq 'HASH') {<br>

    foreach my $func (keys %$fields) {<br>

<b>
<font>      return $self-&gt;_sqlcase($func)<br>
        . ' ' .$self-&gt;_recurse_fields($fields-&gt;{$func}). ' ' if
$func =~ /distinct/i ; # Mike Fawcett<br>
</font>
</b>      return $self-&gt;_sqlcase($func)<br>

        .'( '.$self-&gt;_recurse_fields($fields-&gt;{$func}).' )';<br>

    }<br>

  }<br>

}<br>

<br>

<br>

Peter Rabbitson via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><blockquote>

  
<pre>&lt;URL: <a href="https://rt.cpan.org/Ticket/Display.html?id=44860"><span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=44860">https://rt.cpan.org/Ticket/Display.html?id=44860</a></span></a> &gt;

On Wed Apr 08 01:40:09 2009, <a href="mailto:mfawcett@bigpond.net.au">mfawcett@bigpond.net.au</a> wrote:
  </pre>

  
<div class="message-stanza open"><blockquote>

    
<pre> The following appears the be a bug in generating SQL where the select
list
contains the DISTINCT keyword, inserting invalid brackets around the
select
list columns.

The brackets surrounding the select list column names are invalid
according to
the SQL definition.
SELECT DISTINCT( member_id, last_name ) FROM member me:
The correct SQL is:
SELECT DISTINCT member_id, last_name FROM member me

    </pre>

  </blockquote>
</div>  
<pre>
Hi Mike,

The version you are currently using is unfortunately rather old. You
would want to at least upgrade to 08013 which will pull in a rewritten
SQL::Abstract, which may very well solve your problem.

In any case I would encourage you to try our developer release 08099_08
aka 08100 RC2. Although we are not aware of any issues with it, we are
in great need of field testers to validate our assumptions about the
quality of this release. The sooner I receive *some* feedback from
anyone, the faster 08100 will become a reality.

  </pre>

</blockquote>
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;09&nbsp;04:17:11&nbsp;2009</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Apr 09 03:34:51 2009, mfawcett@bigpond.net.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  Hi Peter,
&gt; 
&gt; I have installed DBIx 08013 and identified the source of my problem in
&gt; the
&gt; module DBIx::Class::Storage::DBI.pm.
&gt; When I make the change indicated in red below my problem is resolved.
&gt; I&#39;m not sure of the wider implications of the change. I can&#39;t offhand
&gt; think of
&gt; a situation in SQL in which the brackets would be required, but
&gt; presumably they
&gt; were put there for some good reason initially.
</div>
This pat of the code needs heavy refactoring. See below. 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;d be happy to try your developer release, but I&#39;m not quite sure how
&gt; to get
&gt; hold of it.
&gt; 
</div>
Please download and install
<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/CPAN/authors/id/R/RI/RIBASUSHI/DBIx-Class-0.08099_08.tar.gz">http://search.cpan.org/CPAN/authors/id/R/RI/RIBASUSHI/DBIx-Class-0.08099_08.tar.gz</a></span>.
If ou have never installed a modul manually, `cpanp &lt;above url&gt;` should
do it for you. It is very possible that this problem was already
identified and fixed.

Cheers
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;09&nbsp;06:42:34&nbsp;2009</span>
    <span class="description">mfawcett [...] bigpond.net.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #44860] DBIx generates incorrect SQL with DISTINCT keyword</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 09 Apr 2009 20:41:18 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike Fawcett &lt;mfawcett [...] bigpond.net.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza">  


Hi Peter,<br>

<br>

I've installed the 0.08099_08 development release and the problem I
reported is not resolved. The relevant lines in DBI.pm are unaltered.<br>

I can certainly live with the minor hack I have made that solves my
immediate problem, and of course I will report any other issues I come
across. If you'd like me top be more systematic in testing this
release, please let me know how I can help.<br>

<br>

cheers<br>

Mike Fawcett<br>

<br>

Peter Rabbitson via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><blockquote>

  
<pre>&lt;URL: <a href="https://rt.cpan.org/Ticket/Display.html?id=44860"><span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=44860">https://rt.cpan.org/Ticket/Display.html?id=44860</a></span></a> &gt;

On Thu Apr 09 03:34:51 2009, <a href="mailto:mfawcett@bigpond.net.au">mfawcett@bigpond.net.au</a> wrote:
  </pre>

  
<div class="message-stanza open"><blockquote>

    
<pre> Hi Peter,

I have installed DBIx 08013 and identified the source of my problem in
the
module DBIx::Class::Storage::DBI.pm.
When I make the change indicated in red below my problem is resolved.
I'm not sure of the wider implications of the change. I can't offhand
think of
a situation in SQL in which the brackets would be required, but
presumably they
were put there for some good reason initially.
    </pre>

  </blockquote>
</div>  
<pre>
This pat of the code needs heavy refactoring. See below. 

  </pre>

  
<div class="message-stanza open"><blockquote>

    
<pre>I'd be happy to try your developer release, but I'm not quite sure how
to get
hold of it.

    </pre>

  </blockquote>
</div>  
<pre>
Please download and install
<a href="http://search.cpan.org/CPAN/authors/id/R/RI/RIBASUSHI/DBIx-Class-0.08099_08.tar.gz"><span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/CPAN/authors/id/R/RI/RIBASUSHI/DBIx-Class-0.08099_08.tar.gz">http://search.cpan.org/CPAN/authors/id/R/RI/RIBASUSHI/DBIx-Class-0.08099_08.tar.gz</a></span></a>.
If ou have never installed a modul manually, `cpanp &lt;above url&gt;` should
do it for you. It is very possible that this problem was already
identified and fixed.

Cheers

  </pre>

</blockquote>
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;27&nbsp;04:41:40&nbsp;2009</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Apr 09 06:42:34 2009, mfawcett@bigpond.net.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  Hi Peter,
&gt; 
&gt; I&#39;ve installed the 0.08099_08 development release and the problem I
&gt; reported is
&gt; not resolved. The relevant lines in DBI.pm are unaltered.
&gt; I can certainly live with the minor hack I have made that solves my
&gt; immediate
&gt; problem, and of course I will report any other issues I come across.
</div>
Hi,

There is ongoing work to reimplement DISTINCT internally as to not use
it at all, so all of our discussion above is moot. This should hit trunk
in a month or so. In the meantime this is what the author had to say:

&lt;arcanez&gt; you might also tell Mike Fawcett he can select =&gt;
[&#39;member_id&#39;, &#39;last_name&#39;], group_by =&gt; [&#39;member_id&#39;, &#39;last_name&#39;] to
emulate DISTINCT
&lt;arcanez&gt; it very well may be faster

Cheers
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;27&nbsp;04:48:45&nbsp;2009</span>
    <span class="description">mfawcett [...] bigpond.net.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #44860] DBIx generates incorrect SQL with DISTINCT keyword</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 27 Apr 2009 18:48:29 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike Fawcett &lt;mfawcett [...] bigpond.net.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza">  


Thanks Peter. I'll keep an eye on new releases.<br>

cheers<br>

Mike<br>

<br>

Peter Rabbitson via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><blockquote>

  
<pre>&lt;URL: <a href="https://rt.cpan.org/Ticket/Display.html?id=44860"><span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=44860">https://rt.cpan.org/Ticket/Display.html?id=44860</a></span></a> &gt;

On Thu Apr 09 06:42:34 2009, <a href="mailto:mfawcett@bigpond.net.au">mfawcett@bigpond.net.au</a> wrote:
  </pre>

  
<div class="message-stanza open"><blockquote>

    
<pre> Hi Peter,

I've installed the 0.08099_08 development release and the problem I
reported is
not resolved. The relevant lines in DBI.pm are unaltered.
I can certainly live with the minor hack I have made that solves my
immediate
problem, and of course I will report any other issues I come across.
    </pre>

  </blockquote>
</div>  
<pre>
Hi,

There is ongoing work to reimplement DISTINCT internally as to not use
it at all, so all of our discussion above is moot. This should hit trunk
in a month or so. In the meantime this is what the author had to say:

&lt;arcanez&gt; you might also tell Mike Fawcett he can select =&gt;
['member_id', 'last_name'], group_by =&gt; ['member_id', 'last_name'] to
emulate DISTINCT
&lt;arcanez&gt; it very well may be faster

Cheers



  </pre>

</blockquote>
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;30&nbsp;04:43:39&nbsp;2009</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Stalling until branches/count_distinct merges
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;30&nbsp;04:43:40&nbsp;2009</span>
    <span class="description">ribasushi [...] leporine.io -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;18&nbsp;01:55:52&nbsp;2009</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Apr 27 04:48:45 2009, mfawcett@bigpond.net.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  Thanks Peter. I&#39;ll keep an eye on new releases.
&gt; cheers
&gt; Mike
&gt; 
&gt; Peter Rabbitson via RT wrote:
&gt; 
&gt;   &lt;URL:   <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=44860">https://rt.cpan.org/Ticket/Display.html?id=44860</a></span>   &gt;
&gt;   
&gt;   On Thu Apr 09 06:42:34 2009,   mfawcett@bigpond.net.au   wrote:
&gt;         
&gt; 
&gt;      Hi Peter,
&gt;     
&gt;     I&#39;ve installed the 0.08099_08 development release and the problem I
&gt;     reported is
&gt;     not resolved. The relevant lines in DBI.pm are unaltered.
&gt;     I can certainly live with the minor hack I have made that solves my
&gt;     immediate
&gt;     problem, and of course I will report any other issues I come across.
&gt;           
&gt; 
&gt;   Hi,
&gt;   
&gt;   There is ongoing work to reimplement DISTINCT internally as to not use
&gt;   it at all, so all of our discussion above is moot. This should hit trunk
&gt;   in a month or so. In the meantime this is what the author had to say:
&gt;   
&gt;   &lt;arcanez&gt; you might also tell Mike Fawcett he can select =&gt;
&gt;   [&#39;member_id&#39;, &#39;last_name&#39;], group_by =&gt; [&#39;member_id&#39;, &#39;last_name&#39;] to
&gt;   emulate DISTINCT
&gt;   &lt;arcanez&gt; it very well may be faster
&gt;   
&gt;   Cheers
</div>
Please checkout and try:
<span class="clickylink"><a target="new" rel="nofollow" href="http://dev.catalyst.perl.org/repos/bast/DBIx-Class/0.08/branches/joined_count">http://dev.catalyst.perl.org/repos/bast/DBIx-Class/0.08/branches/joined_count</a></span>
This should be the final fix, but is not in trunk yet, due to lack of
testing volunteers.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;18&nbsp;01:55:53&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;26&nbsp;16:24:36&nbsp;2009</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">DBIx::Class 0.08103 just released on CPAN fixes this RT. The
multi-distinct syntax is deprecated in favor of group_by or distinct =&gt;
1. Refer to the documentation of DBIx::Class::ResultSet for more info.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;26&nbsp;16:24:37&nbsp;2009</span>
    <span class="description">ribasushi [...] leporine.io -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;May&nbsp;27&nbsp;01:04:20&nbsp;2009</span>
    <span class="description">ribasushi [...] leporine.io -  Fixed in 0.08103 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
