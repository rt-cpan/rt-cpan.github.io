<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #71928 for DBIx-Class: t/53lean_startup.t: Can&#39;t locate Tie/ExtraHash.pm</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #71928 for DBIx-Class: t/53lean_startup.t: Can&#39;t locate Tie/ExtraHash.pm</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBIx-Class">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBIx-Class">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBIx-Class">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBIx-Class">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBIx-Class">DBIx-Class CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">71928</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBIx-Class">DBIx-Class</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
w.phillip.moore [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-10410-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.08195    </td>
  </tr>
  <tr id="CF-10411-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.08196    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




make_test.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/991885/516504/make_test.txt">
Tue Oct 25 15:08:26 2011 (37.9k) by w.phillip.moore [...] gmail.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=71928">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-991885" href="/Public/Bug/Display.html?id=71928#txn-991885">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;25&nbsp;15:08:26&nbsp;2011</span>
    <span class="description">w.phillip.moore [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> t/53lean_startup.t: Can&#39;t locate Tie/ExtraHash.pm</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/991885/516503/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/516503">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m getting the following test suite failure for 5.10.1, 5.12.4 and 5.14.2, on 32 and 64 bit 
builds on RHEL 5, Solaris 10 and AIX 6.

[2011-10-25 16:54:20]  Can&#39;t locate Tie/ExtraHash.pm in @INC &#40;@INC contains: &lt;long path 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">deleted&gt;&gt;&#41; at t/53lean_startup.t line 10.
</div>[2011-10-25 16:54:20]   ...propagated at /efs/dist/perl5/core/5.14.2-build002/.exec/x86-
64.rhel.5/lib/perl5/base.pm line 94.
[2011-10-25 16:54:20]  BEGIN failed--compilation aborted at &#40;eval 31&#41; line 10.
[2011-10-25 16:54:20]  BEGIN failed--compilation aborted at /efs/dist/perl5/namespace-
clean/0.21/.exec/x86-64.rhel.5/5.14/lib/perl5/namespace/c\
lean.pm line 92.
[2011-10-25 16:54:20]  Compilation failed in require at t/53lean_startup.t line 10.
[2011-10-25 16:54:20]  BEGIN failed--compilation aborted at /var/tmp/perl5-DBIx-Class-
0.08195-build001-build/x86-64.rhel.5/5.14/source/DBIx-Cla\
ss-0.08195/blib/lib/DBIx/Class/Carp.pm line 18.
[2011-10-25 16:54:20]  Compilation failed in require at t/53lean_startup.t line 10.
[2011-10-25 16:54:20]  BEGIN failed--compilation aborted at /var/tmp/perl5-DBIx-Class-
0.08195-build001-build/x86-64.rhel.5/5.14/source/DBIx-Cla\
ss-0.08195/blib/lib/DBIx/Class/Exception.pm line 6.
[2011-10-25 16:54:20]  Compilation failed in require at t/53lean_startup.t line 10.
[2011-10-25 16:54:20]  BEGIN failed--compilation aborted at /var/tmp/perl5-DBIx-Class-
0.08195-build001-build/x86-64.rhel.5/5.14/source/DBIx-Cla\
ss-0.08195/blib/lib/DBIx/Class/Schema.pm line 6.
[2011-10-25 16:54:20]  Compilation failed in require at t/53lean_startup.t line 10.
[2011-10-25 16:54:20]   ...propagated at /efs/dist/perl5/core/5.14.2-build002/.exec/x86-
64.rhel.5/lib/perl5/base.pm line 94.
[2011-10-25 16:54:20]  BEGIN failed--compilation aborted at t/lib/DBICTest/Schema.pm 
line 4.
[2011-10-25 16:54:20]  Compilation failed in require at t/53lean_startup.t line 10.
[2011-10-25 16:54:20]  BEGIN failed--compilation aborted at t/lib/DBICTest.pm line 7.
[2011-10-25 16:54:20]  Compilation failed in require at t/53lean_startup.t line 10.
[2011-10-25 16:54:20]  BEGIN failed--compilation aborted at t/53lean_startup.t line 95.
[2011-10-25 16:54:20]  t/53lean_startup.t ...............................
[2011-10-25 16:54:20]  Dubious, test returned 2 &#40;wstat 512, 0x200&#41;
[2011-10-25 16:54:20]  No subtests run

I do not understand what this script is doing, but Tie::ExtraHash is a package inside the 
Tie/Hash.pm file, and there isn&#39;t a separate Tie/ExtraHash.pm file to be found.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> make_test.txt</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/991885/516504/make_test.txt">Download make_test.txt</a><br />
<span class="downloadcontenttype">text/plain 37.9k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-992407" href="/Public/Bug/Display.html?id=71928#txn-992407">#</a>      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;26&nbsp;13:08:05&nbsp;2011</span>
    <span class="description">w.phillip.moore [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/992407/516804/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/516804">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve found the root cause of this, and I&#39;m very curious why noone else is seeing this error yet.

Obviously, nothing in DBIx-Class refers to Tie::ExtraHash.   That dependency actually comes 
from namespace::clean, which is used by DBIx::Class::Carp.   In namespace::clean, the &#34;right 
thing&#34; is done to use Tie::ExtraHash as a base class:

    use Tie::Hash;
    use base &#39;Tie::ExtraHash&#39;;

This works because base-&gt;import does the following:

    eval &#34;require $base&#34;;
    die $@ if $@ &#38;&#38; $@ !~ /^Can&#39;t locate .*? at \&#40;eval/;

However, in t/53lean_startup.t, because the require method is wrapped in the first BEGIN 
block, the error that&#39;s thrown is NOT &#34;at &#40;eval&#41;&#34; it is &#34;at t/53lean_startup.t&#34;, the regexp fails to 
match, and base-&gt;import re-throws the error.

I&#39;ve reduced the problem to a very simple test case, which fails for every perl I&#39;ve tried, on 
every platform:

BEGIN {
    *CORE::GLOBAL::require = sub {
        CORE::require&#40;$_[0]&#41;;
    };
}

use Tie::Hash;
use base &#39;Tie::ExtraHash&#39;;

Run this, and you get:

pmoore@Renegade$ perl ~/base.pl 
Can&#39;t locate Tie/ExtraHash.pm in @INC &#40;@INC contains: /Users/pmoore/lib/perl5 
/opt/local/lib/perl5/site_perl/5.12.3/darwin-multi-2level /opt/lo\
cal/lib/perl5/site_perl/5.12.3 /opt/local/lib/perl5/vendor_perl/5.12.3/darwin-multi-2level 
/opt/local/lib/perl5/vendor_perl/5.12.3 /opt/local/l\
ib/perl5/5.12.3/darwin-multi-2level /opt/local/lib/perl5/5.12.3 
/opt/local/lib/perl5/site_perl /opt/local/lib/perl5/vendor_perl .&#41; at /Users/pm\
oore/base.pl line 5.
        ...propagated at /opt/local/lib/perl5/5.12.3/base.pm line 94.
BEGIN failed--compilation aborted at /Users/pmoore/base.pl line 10.

That appears to be the root cause of this problem.  The wrapped require method results in 
confusing base.pm, because the error doesn&#39;t appear to come from the eval of that string, ot 
appears to come from some other file, and the code dies.

If you download and install:

<span class="clickylink"><a target="new" rel="nofollow" href="http://backpan.perl.org/authors/id/R/RI/RIBASUSHI/namespace-clean-0.20_01.tar.gz">http://backpan.perl.org/authors/id/R/RI/RIBASUSHI/namespace-clean-0.20_01.tar.gz</a></span>

then that test passes fine.   This is because in 0.20_01, Tie::ExtraHash is refered to via:

./lib/namespace/clean.pm:      tie&#40; %^H, &#39;Tie::ExtraHash&#39;, namespace::clean::_ScopeGuard-
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;arm&#40;shift&#41; &#41;;
</div>
But in 0.21, this was changed to:

./lib/namespace/clean.pm:    use base &#39;Tie::ExtraHash&#39;;

I have tried hacking in several workarounds, but in every case for which the hack &#34;fixes&#34; my 
test program above, it breaks something else in t/53lean_startup.t.   For example, I can make 
the test script work if I do this:

BEGIN {
    *CORE::GLOBAL::require = sub {
        eval { CORE::require&#40;$_[0]&#41;; };
        if &#40; $@ &#41; {
            $@ =~ s{at\s+\S+}{at &#40;eval 1&#41;}gmsx;
            die $@;
        }
    };
}

IOW, hack $@ so that it looks like it came from eval.   However, if I add this to 
t/53lean_projects.t, I get an even stranger set of errors.

[efsops@shou18l560-02 DBIx-Class-0.08195]$ perl -Mblib t/53lean_startup.t                                               
DBIx::Class::Schema::throw_exception&#40;&#41;: Can&#39;t locate object method &#34;table&#34; via package 
&#34;DBICTest::BaseResult&#34; at t/lib/DBICTest/BaseResult.pm line 11.
Compilation failed in require at &#40;eval 1&#41; line 10.
        ...propagated at /efs/dist/perl5/core/5.14.2-
build002/.exec/powerpc32.aix.6/lib/perl5/base.pm line 94.
BEGIN failed--compilation aborted at t/lib/DBICTest/Schema/Artist.pm line 4.
Compilation failed in require at &#40;eval 1&#41; line 10. at /efs/dist/perl5/Class-C3-
Componentised/1.001000/.exec/powerpc32.aix.6/5.14/lib/perl5/Class/C3/Componentised.
pm line 155
Compilation failed in require at &#40;eval 1&#41; line 10.
BEGIN failed--compilation aborted at t/lib/DBICTest.pm line 7.
Compilation failed in require at &#40;eval 1&#41; line 10.
BEGIN failed--compilation aborted at t/53lean_startup.t line 99.

Clearly, that workaround is NOT general enough, although since require normally raises an 
exception, it&#39;s hard to understand why it doesn&#39;t.

In any case, I don&#39;t really understand how to patch DBIx-Class to fix, or really just 
workaround, this issue.   For now, I&#39;ve downgraded namespace::clean to 0.20_01, but one of 
these days, I&#39;ll want/need to upgrade, so this will eventually need to be fixed.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-992409" href="/Public/Bug/Display.html?id=71928#txn-992409">#</a>      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;26&nbsp;13:08:08&nbsp;2011</span>
    <span class="description">w.phillip.moore [...] gmail.com -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-992418" href="/Public/Bug/Display.html?id=71928#txn-992418">#</a>      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;26&nbsp;13:16:37&nbsp;2011</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #71928] t/53lean_startup.t: Can&#39;t locate Tie/ExtraHash.pm</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 26 Oct 2011 13:16:28 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Phillip Moore via RT &lt;bug-DBIx-Class [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Rabbitson &lt;ribasushi [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/992418/516808/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/516808">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, Oct 26, 2011 at 01:08:07PM -0400, Phillip Moore via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: DBIx-Class
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=71928">https://rt.cpan.org/Ticket/Display.html?id=71928</a></span> &gt;
&gt; 
&gt; I&#39;ve found the root cause of this, and I&#39;m very curious why noone else is seeing this error yet.
&gt; 
&gt; Obviously, nothing in DBIx-Class refers to Tie::ExtraHash.   That dependency actually comes 
&gt; from namespace::clean, which is used by DBIx::Class::Carp.   In namespace::clean, the &#34;right 
&gt; thing&#34; is done to use Tie::ExtraHash as a base class:
&gt; 
&gt;     use Tie::Hash;
&gt;     use base &#39;Tie::ExtraHash&#39;;
&gt; 
&gt; This works because base-&gt;import does the following:
&gt; 
&gt;     eval &#34;require $base&#34;;
&gt;     die $@ if $@ &#38;&#38; $@ !~ /^Can&#39;t locate .*? at \&#40;eval/;
&gt; 
&gt; However, in t/53lean_startup.t, because the require method is wrapped in the first BEGIN 
&gt; block, the error that&#39;s thrown is NOT &#34;at &#40;eval&#41;&#34; it is &#34;at t/53lean_startup.t&#34;, the regexp fails to 
&gt; match, and base-&gt;import re-throws the error.
&gt; 
&gt; I&#39;ve reduced the problem to a very simple test case, which fails for every perl I&#39;ve tried, on 
&gt; every platform:
&gt; 
&gt; BEGIN {
&gt;     *CORE::GLOBAL::require = sub {
&gt;         CORE::require&#40;$_[0]&#41;;
&gt;     };
&gt; }
&gt; 
&gt; use Tie::Hash;
&gt; use base &#39;Tie::ExtraHash&#39;;
&gt; 
</div>
Fuck you base.pm. Ok 2 things here:

1&#41; There was some work on this test done in the DBIC repo. Please checkout
current master[1] and see if the issue has been fixed &#40;the require&#40;&#41;
override is much much cleverer now&#41;

2&#41; Since someone *else* may fuck this up in weird and unknown ways, I am
thinking to ship a version of n::c that sets @ISA instead of mucking with
use base &#40;given how n::c is a pretty central thing these days&#41;. I do not
know if this is warranted yet, will ponder with interested parties.

Thank you so very much for tracking this down, I am just as dumbfounded as
you on why nobody else experiences this...

Cheers
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-992430" href="/Public/Bug/Display.html?id=71928#txn-992430">#</a>      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;26&nbsp;14:14:47&nbsp;2011</span>
    <span class="description">w.phillip.moore [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #71928] t/53lean_startup.t: Can&#39;t locate Tie/ExtraHash.pm</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 26 Oct 2011 14:14:35 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Phillip Moore &lt;w.phillip.moore [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/992430/516820/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/516820">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have an answer for why noone else has seen this yet....

I&#39;m working on trying to reproduce the OTHER problem I reported yesterday,
and the first thing I noticed was that t/53lean_startup.t was passing, when
I was expecting it to fail.   Huh?

Well, I hacked base.pm in the standalone test setup I just built, and when
t/53lean_projects.t runs, base.pm NEVER SEES Tie::ExtraHash passed to it.
 Well, if you look inside clean.pm, it&#39;s clear why.

Tie::Hash and Tie::ExtraHash are only used if B::Hooks::EndOfScope is NOT
installed.  If it IS installed, then it is used, and the code that causes
this problem is not called.

My working test case was simply a build of perl5.14.2 along with ALL of the
dependencies my app has, installed as a bundle using cpanp.    Somehow,
cpanp figured out that namespace::clean 021 requires B::Hooks::EndOfScope,
but the META.yml file for namespace::clean doesn&#39;t list this at all.   cpanp
figures this out when by parsing the output of Makefile.PL &#40;or possibly
using MYMETA.yml?  have to go look...&#41;, but the build system in the failing
case is very different -- it is driven entirely by metadata found in
META.yml files, so when I installed namespace::clean, it was NOT built and
tested against B::Hooks::EndOfScope.

So.....

In this case, the reason noone else is seeing it is that I have made the
mistake of depending on META.yml files having correct dependency
information, and when they information is missing, I depend on the tests
failing, so I can address the missing ones.   This is an edge case, where
the Makefile.PL tries to dynamically figure out what can and can not be
depended on, and the result is that the META.yml file included with it has a
PARTIAL but not a COMPLETE list of dependencies.

Oddly, if you run &#34;perl Makefile.PL&#34;, and let MYMETA.yml get generated, that
correctly lists the B::Hooks::EndOfScope dependency as &#34;required&#34;.
However, if you then run &#34;make manifest dist&#34; to regenerate the META.yml
file, it says nothing about it.

It looks like I need to change my build system to prefer MYMETA.yml over
META.yml, since I can recreate these when they are missing &#40;people are STILL
uploading stuff to CPAN with no META.yml files&#41;.   There may or may be a way
to change namespace-clean&#39;s Makefile.PL to get that dependency listed
correctly in the META.yml file, but regardless, lots of other modules will
have similar issues, so I need to code a solution into my build system.

I think it&#39;s safe to say that you can close this ticket, although I suppose
that since namespace::clean CAN be installed without B::Hooks::EndOfScope
and work fine, and since DBIx::Class doesn&#39;t depend on it, it IS possible
that someone will see this, but very unlikely.

On Wed, Oct 26, 2011 at 1:16 PM, Peter Rabbitson via RT &lt;
bug-DBIx-Class@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=71928">https://rt.cpan.org/Ticket/Display.html?id=71928</a></span> &gt;
&gt;
&gt; On Wed, Oct 26, 2011 at 01:08:07PM -0400, Phillip Moore via RT wrote:
<div class="message-stanza open">&gt; &gt;        Queue: DBIx-Class
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=71928">https://rt.cpan.org/Ticket/Display.html?id=71928</a></span> &gt;
&gt; &gt;
&gt; &gt; I&#39;ve found the root cause of this, and I&#39;m very curious why noone else is
</div>&gt; seeing this error yet.
<div class="message-stanza open">&gt; &gt;
&gt; &gt; Obviously, nothing in DBIx-Class refers to Tie::ExtraHash.   That
</div>&gt; dependency actually comes
<div class="message-stanza open">&gt; &gt; from namespace::clean, which is used by DBIx::Class::Carp.   In
</div>&gt; namespace::clean, the &#34;right
<div class="message-stanza open">&gt; &gt; thing&#34; is done to use Tie::ExtraHash as a base class:
&gt; &gt;
&gt; &gt;     use Tie::Hash;
&gt; &gt;     use base &#39;Tie::ExtraHash&#39;;
&gt; &gt;
&gt; &gt; This works because base-&gt;import does the following:
&gt; &gt;
&gt; &gt;     eval &#34;require $base&#34;;
&gt; &gt;     die $@ if $@ &#38;&#38; $@ !~ /^Can&#39;t locate .*? at \&#40;eval/;
&gt; &gt;
&gt; &gt; However, in t/53lean_startup.t, because the require method is wrapped in
</div>&gt; the first BEGIN
<div class="message-stanza open">&gt; &gt; block, the error that&#39;s thrown is NOT &#34;at &#40;eval&#41;&#34; it is &#34;at
</div>&gt; t/53lean_startup.t&#34;, the regexp fails to
<div class="message-stanza open">&gt; &gt; match, and base-&gt;import re-throws the error.
&gt; &gt;
&gt; &gt; I&#39;ve reduced the problem to a very simple test case, which fails for
</div>&gt; every perl I&#39;ve tried, on
<div class="message-stanza open">&gt; &gt; every platform:
&gt; &gt;
&gt; &gt; BEGIN {
&gt; &gt;     *CORE::GLOBAL::require = sub {
&gt; &gt;         CORE::require&#40;$_[0]&#41;;
&gt; &gt;     };
&gt; &gt; }
&gt; &gt;
&gt; &gt; use Tie::Hash;
&gt; &gt; use base &#39;Tie::ExtraHash&#39;;
&gt; &gt;
</div>&gt;
&gt; Fuck you base.pm. Ok 2 things here:
&gt;
&gt; 1&#41; There was some work on this test done in the DBIC repo. Please checkout
&gt; current master[1] and see if the issue has been fixed &#40;the require&#40;&#41;
&gt; override is much much cleverer now&#41;
&gt;
&gt; 2&#41; Since someone *else* may fuck this up in weird and unknown ways, I am
&gt; thinking to ship a version of n::c that sets @ISA instead of mucking with
&gt; use base &#40;given how n::c is a pretty central thing these days&#41;. I do not
&gt; know if this is warranted yet, will ponder with interested parties.
&gt;
&gt; Thank you so very much for tracking this down, I am just as dumbfounded as
&gt; you on why nobody else experiences this...
&gt;
&gt; Cheers
&gt;
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/992430/516821/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/516821">with headers</a>
<br />
<span class="downloadcontenttype">text/html 5.8k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1031136" href="/Public/Bug/Display.html?id=71928#txn-1031136">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;01&nbsp;03:59:55&nbsp;2012</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1031136/537881/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/537881">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Oct 26 13:08:05 2011, WPMOORE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve found the root cause of this, and I&#39;m very curious why noone else
&gt; is seeing this error yet.
&gt; 
&gt; Obviously, nothing in DBIx-Class refers to Tie::ExtraHash.   That
&gt; dependency actually comes
&gt; from namespace::clean, which is used by DBIx::Class::Carp.   In
&gt; namespace::clean, the &#34;right
&gt; thing&#34; is done to use Tie::ExtraHash as a base class:
&gt; 
&gt;     use Tie::Hash;
&gt;     use base &#39;Tie::ExtraHash&#39;;
&gt; 
&gt; This works because base-&gt;import does the following:
&gt; 
&gt;     eval &#34;require $base&#34;;
&gt;     die $@ if $@ &#38;&#38; $@ !~ /^Can&#39;t locate .*? at \&#40;eval/;
&gt; 
&gt; However, in t/53lean_startup.t, because the require method is wrapped
&gt; in the first BEGIN
&gt; block, the error that&#39;s thrown is NOT &#34;at &#40;eval&#41;&#34; it is &#34;at
&gt; t/53lean_startup.t&#34;, the regexp fails to
&gt; match, and base-&gt;import re-throws the error.
&gt; 
&gt; I&#39;ve reduced the problem to a very simple test case, which fails for
&gt; every perl I&#39;ve tried, on
&gt; every platform:
&gt; 
&gt; BEGIN {
&gt;     *CORE::GLOBAL::require = sub {
&gt;         CORE::require&#40;$_[0]&#41;;
&gt;     };
&gt; }
&gt; 
&gt; use Tie::Hash;
&gt; use base &#39;Tie::ExtraHash&#39;;
&gt; 
</div>
Right, we eventually got to the bottom of this, but forgot to close the
ticket.The problem was indeed in DBIC itself, because it did not do the
require override properly. I nicked the correct way from Zefram&#39;s
Lexical::SealRequireHints, and even abstracted it into a nicer
interface. However I did not put it on CPAN as we couldn&#39;t agree with
Zefram what is the sane way of going forward.

I am putting all the relevant information here, hoping that maybe you
will get this to CPAN-dom &#40;it is a very very tricky thing to do right,
and it ought to be properly encapsulated&#41;.

This works:

BEGIN {
  unshift @INC, &#39;t/lib&#39;;
  require DBICTest::Util::OverrideRequire;

  DBICTest::Util::OverrideRequire::override_global_require&#40; sub {
    $_[0]-&gt;&#40;&#41;
  }&#41;;
}

use Tie::Hash;
use base &#39;Tie::ExtraHash&#39;;

And this is how it is implemented:
<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/ARODLAND/DBIx-Class-0.08196/t/lib/DBICTest/Util/OverrideRequire.pm">https://metacpan.org/source/ARODLAND/DBIx-Class-0.08196/t/lib/DBICTest/Util/OverrideRequire.pm</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1031139" href="/Public/Bug/Display.html?id=71928#txn-1031139">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;01&nbsp;04:01:24&nbsp;2012</span>
    <span class="description">ribasushi [...] leporine.io -  Fixed in 0.08196 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1031140" href="/Public/Bug/Display.html?id=71928#txn-1031140">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;01&nbsp;04:01:24&nbsp;2012</span>
    <span class="description">ribasushi [...] leporine.io -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.358059</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
