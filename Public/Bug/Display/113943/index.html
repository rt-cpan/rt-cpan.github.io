<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #113943 for Math-BigInt: Possibly new bug in the Math::BigFloat</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #113943 for Math-BigInt: Possibly new bug in the Math::BigFloat</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Math-BigInt">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Math-BigInt">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Math-BigInt">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Math-BigInt">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Math-BigInt">Math-BigInt CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">113943</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Math-BigInt">Math-BigInt</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ZDM [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-20500-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-20501-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.999719    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=113943">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1620089" href="/Public/Bug/Display.html?id=113943#txn-1620089">#</a>      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;23&nbsp;13:42:52&nbsp;2016</span>
    <span class="description">ZDM [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Possibly new bug in the Math::BigFloat</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1620089/867502/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/867502">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 353b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi.

We found, that CBOR::XS has stpped building after latest Math::* update. After the short investigation we found, that this is, possibly, new bug in Math::BigFloat.

   use Math::BigFloat;

   $x = Math::BigFloat-&gt;new &#40;3&#41;;
   $x = $x-&gt;blsft &#40;-1, 2&#41;;
   warn &#34;$x&#34;;

This should give 1.5, but results in NaN. With older versions, this works
correctly.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1620226" href="/Public/Bug/Display.html?id=113943#txn-1620226">#</a>      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;24&nbsp;04:47:34&nbsp;2016</span>
    <span class="description">peter.john.acklam [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1620226/867576/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/867576">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; use Math::BigFloat;
&gt; 
&gt; $x = Math::BigFloat-&gt;new &#40;3&#41;;
&gt; $x = $x-&gt;blsft &#40;-1, 2&#41;;
&gt; warn &#34;$x&#34;;
&gt; 
&gt; This should give 1.5, but results in NaN. With older versions,
&gt; this works correctly.
</div>
Shifting floats make no sense, because the internal representation
is not just a sequence of bits that can be shifted left and right.
If you search the net for bit-shifting floats you will find
explanations for this.

Since shifting floats make no sense, core Perl truncates floats to
integers when you apply bit operations to floats. In the
Math::Big* modules, shifting left by -1 is equivalent to shifting
right by 1. Doing this with Perl gives you 1, not 1.5:

$ perl -Mstrict -wle &#39;print 3 &gt;&gt; 1&#39;
1

Note that bits that &#34;fall off the end&#34; to the right are dropped,
so the result of a bit-shift operation in Perl is always an
integer.

The intention in the latest version of Math::BigFloat &#40;and
Math::BigRat&#41; is to behave like core Perl in this manner. I.e.,
bit-shifting operations on a float truncates the float to an
integer, applies the bit-shifting &#40;dropping bits that &#34;fall of the
end&#34; to the right&#41;. So I expected the answer to be 1.

I won&#39;t agree that it is a bug that you don&#39;t get 1.5, but it is
certainly a bug that the result is a NaN.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1620227" href="/Public/Bug/Display.html?id=113943#txn-1620227">#</a>      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;24&nbsp;04:47:34&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1620391" href="/Public/Bug/Display.html?id=113943#txn-1620391">#</a>      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;24&nbsp;14:48:59&nbsp;2016</span>
    <span class="description">SREZIC [...] cpan.org -  Reference by ticket #113956 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1620527" href="/Public/Bug/Display.html?id=113943#txn-1620527">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;25&nbsp;04:37:25&nbsp;2016</span>
    <span class="description">peter.john.acklam [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1620527/867757/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/867757">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I was wrong, when I wrote &#34;In the Math::Big* modules, shifting
left by -1 is equivalent to shifting right by 1. This was true
only for Math::BigFloat, and it was not according to the
documentation. The documentation says blsft&#40;&#41; and brsft&#40;&#41; shifts
left and right, and refers to the documentation in Math::BigInt,
which says &#34;Right shifting usually amounts to dividing $x by
$n ** $y and truncating the result&#34;. So, the fact that you got 1.5
rather than 1, was not according to the documentation.

With Math::BigInt, shifting left by a negative amount results in a
NaN, and since Math::BigFloat now lets Math::BigInt do the actual
shifting, that&#39;s why you got the NaN.

In Perl, shifting left by a negative amount causes the bits to
wrap, so while 3 &gt;&gt; 2 gives 0, 3 &lt;&lt; -2 gives 13835058055282163712
&#40;with 64 bit integer support&#41;. The equivalent in Math::BigInt is
to return inf, I believe.

By the way, if what you actually want to do is to multiply by a
number &#40;base&#41; raised to some power, replace

    $x -&gt; blsft&#40;$n, $b&#41;

with

    $x -&gt; bmul&#40;$b -&gt; copy&#40;&#41; -&gt; bpow&#40;$n&#41;&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1620539" href="/Public/Bug/Display.html?id=113943#txn-1620539">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;25&nbsp;04:52:14&nbsp;2016</span>
    <span class="description">dzagashev [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #113943] Possibly new bug in the Math::BigFloat</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 25 Apr 2016 11:51:52 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Math-BigInt [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;dzagashev [...] gmail.com&#34; &lt;dzagashev [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1620539/867767/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/867767">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Please, read this analysis report.

<span class="clickylink"><a target="new" rel="nofollow" href="http://blog.schmorp.de/2016-04-23-mathbigfloat-maintainer-fail.html">http://blog.schmorp.de/2016-04-23-mathbigfloat-maintainer-fail.html</a></span>


On 25.04.2016 11:37, Peter John Acklam via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=113943">https://rt.cpan.org/Ticket/Display.html?id=113943</a></span> &gt;
&gt;
&gt; I was wrong, when I wrote &#34;In the Math::Big* modules, shifting
&gt; left by -1 is equivalent to shifting right by 1. This was true
&gt; only for Math::BigFloat, and it was not according to the
&gt; documentation. The documentation says blsft&#40;&#41; and brsft&#40;&#41; shifts
&gt; left and right, and refers to the documentation in Math::BigInt,
&gt; which says &#34;Right shifting usually amounts to dividing $x by
&gt; $n ** $y and truncating the result&#34;. So, the fact that you got 1.5
&gt; rather than 1, was not according to the documentation.
&gt;
&gt; With Math::BigInt, shifting left by a negative amount results in a
&gt; NaN, and since Math::BigFloat now lets Math::BigInt do the actual
&gt; shifting, that&#39;s why you got the NaN.
&gt;
&gt; In Perl, shifting left by a negative amount causes the bits to
&gt; wrap, so while 3 &gt;&gt; 2 gives 0, 3 &lt;&lt; -2 gives 13835058055282163712
&gt; &#40;with 64 bit integer support&#41;. The equivalent in Math::BigInt is
&gt; to return inf, I believe.
&gt;
&gt; By the way, if what you actually want to do is to multiply by a
&gt; number &#40;base&#41; raised to some power, replace
&gt;
&gt;     $x -&gt; blsft&#40;$n, $b&#41;
&gt;
&gt; with
&gt;
&gt;     $x -&gt; bmul&#40;$b -&gt; copy&#40;&#41; -&gt; bpow&#40;$n&#41;&#41;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1620605" href="/Public/Bug/Display.html?id=113943#txn-1620605">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;25&nbsp;08:30:10&nbsp;2016</span>
    <span class="description">peter.john.acklam [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1620605/867821/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/867821">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Apr 25 04:52:14 2016, dzagashev@gmail.com wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Please, read this analysis report.
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://blog.schmorp.de/2016-04-23-mathbigfloat-maintainer-fail.html">http://blog.schmorp.de/2016-04-23-mathbigfloat-maintainer-fail.html</a></span>
</div>
I have read the &#34;analysis&#34;, and I have to admit it would be easier
to take it more seriously if it weren&#39;t for all the ranting, straw
man arguments, and false assumtions made there.

I am more than willing to discuss my change, including how blsft&#40;&#41;
and brsft&#40;&#41; ought to behave, but I am not going to spend time wading
through a lot of ranting.

I have a few replies to the &#34;analysis&#34;.

- Just because some piece of code has behaved in a certain way over
  many years, doesn&#39;t make that behaviour correct. Hence, changing a
  certain old behaviour isn&#39;t necessarily a bug.

- blsft&#40;&#41; and brsft&#40;&#41; are so poorly documented that it is not
  obvious what is the correct behaviour. The documentation provided
  in the &#34;analysis&#34; is just one of several fragments. The actual
  documentation in the modules contain other pieces of documentation
  that can be interpreted differently than the one provided in the
  &#34;analysis&#34;.

- Considering Math::Big&#40;Int|Float|Rat&#41; toy modules that are too
  unreliable for serious use is nothing new. They have been toy
  modues ever since TELS redesigned these modules more than 10 years
  ago. Initially, my intention was to use these modules for
  numerical analysis of special functions, but I didn&#39;t dare,
  because I quickly realized that these modules contain a staggering
  amount of bugs, inconsistencies and a fundamentally flawed design.
  This has also been commented by some of the most well-known people
  in the Perl community.

- Am I the best maintainer for these modules? Maybe not, but at
  least I am maintaining them. I took over as maintainer because no
  one else gave these modules the priority they deserved. I believe
  I have both reported and fixed more bugs in these modules than
  anyone else. And when someone has pointed out that I have,
  unfortunately, introduced a bug, I have fixed it quickly.

- I have not claimed that Perl core has a blsft&#40;&#41; method. However,
  since others have referred to &lt;&lt; and &gt;&gt; as bitwise operators, and
  since Math::Big* overloads &lt;&lt; and &gt;&gt; to directly call blsft&#40;&#41; and
  brsft&#40;&#41; I was under the impression that blsft&#40;&#41; and brsft&#40;&#41; were
  bitwise operators.

- I have not claimed that &lt;&lt; and &gt;&gt; in Math::Big* should emulate
  Perl core &lt;&lt; and &gt;&gt; in every aspect.

- I have not claimed that I will keep the current behaviour of
  blsft&#40;&#41; and brsft&#40;&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1620641" href="/Public/Bug/Display.html?id=113943#txn-1620641">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;25&nbsp;11:29:55&nbsp;2016</span>
    <span class="description">peter.john.acklam [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1620641/867835/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/867835">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 169b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I see now that when blsft&#40;&#41; is tested in the test suite file t/bigfltpm.inc, it actually runs &lt;&lt;, not blsft&#40;&#41;, again indicating that &lt;&lt; and blsft&#40;&#41; should be equivalent.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1620740" href="/Public/Bug/Display.html?id=113943#txn-1620740">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;25&nbsp;15:30:22&nbsp;2016</span>
    <span class="description">peter.john.acklam [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1620740/867892/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/867892">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 126b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have reverted the changes to blsft&#40;&#41; and brsft&#40;&#41; in Math::BigFloat and uploaded v1.999719 of the Math-BigInt distro to CPAN.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1620923" href="/Public/Bug/Display.html?id=113943#txn-1620923">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;26&nbsp;05:38:37&nbsp;2016</span>
    <span class="description">peter.john.acklam [...] gmail.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1620925" href="/Public/Bug/Display.html?id=113943#txn-1620925">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;26&nbsp;05:38:43&nbsp;2016</span>
    <span class="description">peter.john.acklam [...] gmail.com -  Fixed in 1.999719 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1621039" href="/Public/Bug/Display.html?id=113943#txn-1621039">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;26&nbsp;10:31:33&nbsp;2016</span>
    <span class="description">dzagashev [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #113943] Resolved: Possibly new bug in the Math::BigFloat</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 26 Apr 2016 17:31:05 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Math-BigInt [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;dzagashev [...] gmail.com&#34; &lt;dzagashev [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1621039/868098/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/868098">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 387b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Peter, you are the best maintainer for this modules. I am sorry, if that
article was too critical and thank you for your work.


On 26.04.2016 12:38, Peter John Acklam via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=113943">https://rt.cpan.org/Ticket/Display.html?id=113943</a></span> &gt;
&gt;
&gt; According to our records, your request has been resolved. If you have any
&gt; further questions or concerns, please respond to this message.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1621714" href="/Public/Bug/Display.html?id=113943#txn-1621714">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;28&nbsp;15:07:42&nbsp;2016</span>
    <span class="description">nospam-abuse [...] bloodgate.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #113943] Resolved: Possibly new bug in the Math::BigFloat</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 28 Apr 2016 15:07:28 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Math-BigInt [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Tels&#34; &lt;nospam-abuse [...] bloodgate.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1621714/868495/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/868495">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On Tue, April 26, 2016 10:31 am, dzagashev@gmail.com via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Math-BigInt
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=113943">https://rt.cpan.org/Ticket/Display.html?id=113943</a></span> &gt;
&gt;
&gt; Peter, you are the best maintainer for this modules. I am sorry, if that
&gt; article was too critical and thank you for your work.
&gt;
&gt;
&gt; On 26.04.2016 12:38, Peter John Acklam via RT wrote:
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=113943">https://rt.cpan.org/Ticket/Display.html?id=113943</a></span> &gt;
&gt;&gt;
&gt;&gt; According to our records, your request has been resolved. If you have
&gt;&gt; any
&gt;&gt; further questions or concerns, please respond to this message.
</div></div>
Hello together,

sorry for the late reply, I seldom check my emails these days.

Thank you, Peter for mainting my pileofcrap^Wmodules! This is much
appeciated, and a lot of work you probably get not thanks for :&#41;


According to the bugreport, the changes have already been reverted. I&#39;d
still like to add a bit of reasoning and history here, just for the
record. Maybe this helps in the future with such decisions.

There was some reasoning along the lines of &#34;&lt;&lt; uses blsft&#40;&#41; so they must
be equivalent.&#34;. That&#39;s not what was intended.

First: the &#34;bigfloat&#34; etc modules where invented to get better math into
Perl without having to rewrite scripts. Even after much work, that never
really works except in special cases. However, to get them even to work,
we need overloaded operators. And to avoid reinventing the wheel, &#34;&lt;&lt;&#34;
simply uses blsft&#40;&#41;. That does not mean, however, that blsft&#40;&#41; should work
only on or return integers, or that the &#34;&lt;&lt;&#34; operator should actually be
exactly the same as blsft&#40;&#41;!

&#40;Yes, I know, I should have added a lot more documentation. My bad.&#41;

And second:  Math::BigRat should be a superset of Math::BigFloat and this
should be a superset of Math::BigInt. So a method in BigRat should return
&#40;if possible&#41; a BigRat, in BigFloat a BigFloat - and not just truncate to
BigInt. I think the confusion might come from the fact that the modules
share a lot of code, design and are interwined a lot. In theory, however,
you should be able to use Math::BigFloat and compute with BigFloats w/o
even knowing about Math::BigInt.

Anyway, the Math::Big modules have indeed not had the best history - and
while my rewrite back then took staggering amounts of work it still left
way too many loose ends for my taste.

I probably also added a few bad design choices and bugs - sorry for that,
but my &#40;Perl&#41; knowledge was limited back then. The rewritten modules are
still, IMHO, light-years ahead than what we had before. If anyone thinks
they are still insufficient for real work - well, you can always roll your
own :&#41;

Thanx for reading,

tels

-- 
<span class="clickylink"><a target="new" rel="nofollow" href="http://bloodgate.com/galleries/">http://bloodgate.com/galleries/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1634745" href="/Public/Bug/Display.html?id=113943#txn-1634745">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;04&nbsp;10:43:32&nbsp;2016</span>
    <span class="description">peter.john.acklam [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1634745/876217/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/876217">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Apr 28 15:07:42 2016, nospam-abuse@bloodgate.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; &#40;Yes, I know, I should have added a lot more documentation. My bad.&#41;
</div>
The lack of documentation makes it more difficult to determine what is a
big. Without the documentation there is no reference stating how it should
actually work. But lack of documentation is just one part of the problem
-- equally bad is all the documentation that is wrong.

Here are some cases extracted from just a few lines in Math::BigFloat:

  - Output values are BigFloat objects &#40;normalized&#41;, except for bstr&#40;&#41; and
    bsstr&#40;&#41;.

    Wrong. The parts&#40;&#41; method returns BigInt objects, not BigFloats.

  - The string output will always have leading and trailing zeros stripped
    and drop a plus sign.

    Wrong. Zeros are padded to the current accuracy or precision. E.g.,
    the number 2 with accuracy 3 prints &#34;2.00&#34;.

  - The input &#39;  -123 123 123&#39; will cause bsstr&#40;&#41; to print &#39;-123123123E0&#39;.

    Wrong. Firstly, the input &#39;  -123 123 123&#39; is invalid and will produce
    a NaN. Secondly, if the input was valid, the output would be
    &#39;-123123123e+0&#39;, with a lower-case &#39;e&#39; and a sign in the exponent.

  - bsstr&#40;&#41; returns a string in scientific notation.

    Questionable. The value of &#34;3141592e-6&#34; is correct, but standard
    scientific notation is &#34;3.141592e+0&#34; or &#34;.3141592e+1&#34;, the latter
    possibly with a leading zero.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; And second:  Math::BigRat should be a superset of Math::BigFloat and this
&gt; should be a superset of Math::BigInt.
</div>
That hardly makes sense, since rational numbers is not a superset of
floating point numbers. However, both rational numbers and floating point
numbers are supersets of integers.

In any case, I can not make sens of the way it is implemented. Currently,
a Math::BigInt object is a sign and an integer. And it would make sense if
a Math::BigFloat object was a Math::BigInt with an added fraction part,
but that isn&#39;t at all how it is implemented. The only thing a
Math::BigInt, a Math::BigFloat and a Math::BigRat have in common is the
sign. And with that implementation, it doesn&#39;t make sense that they are
subclasses of each other. If this wasn&#39;t enough, Math::BigFloat-&gt;isa&#40;&#41;
tells that Math::BigFloat isn&#39;t a Math::BigInt after all. There is no end
to the mess.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If anyone thinks they are still insufficient for real work - well, you
&gt; can always roll your own :&#41;
</div>
That is just arrogant. Math::BigInt, Math::BigFloat, and Math::BigRat are
in the Perl distribution, so people expect them to work properly.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.634785</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
