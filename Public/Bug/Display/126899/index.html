<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #126899 for IO-Socket-SSL: Tests fail with OpenSSL 1.1.1</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #126899 for IO-Socket-SSL: Tests fail with OpenSSL 1.1.1</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/IO-Socket-SSL/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/IO-Socket-SSL/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/IO-Socket-SSL/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/IO-Socket-SSL/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/IO-Socket-SSL">IO-Socket-SSL CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">126899</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/IO-Socket-SSL/Active/">IO-Socket-SSL</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ppisar [...] redhat.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
dam [...] cpan.org

<br />
gregoa [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-17228-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.059    </td>
  </tr>
  <tr id="CF-17229-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




0001-Adapt-to-OpenSSL-1.1.1.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1806167/972332/0001-Adapt-to-OpenSSL-1.1.1.patch">
Fri Aug 17 08:15:03 2018 (4.7k) by ppisar [...] redhat.com
</a>
</font></li>
</ul>


0001-Do-two-way-shutdown-in-t-sni.t.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1806807/972531/0001-Do-two-way-shutdown-in-t-sni.t.patch">
Tue Aug 21 10:13:26 2018 (2.1k) by ppisar [...] redhat.com
</a>
</font></li>
</ul>


0001-Do-two-way-shutdown-in-t-sni_verify.t.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1806181/972347/0001-Do-two-way-shutdown-in-t-sni_verify.t.patch">
Fri Aug 17 08:52:13 2018 (1.3k) by ppisar [...] redhat.com
</a>
</font></li>
</ul>


0001-Exclude-TLSv1.3-from-t-session_ticket.t.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1806797/972526/0001-Exclude-TLSv1.3-from-t-session_ticket.t.patch">
Tue Aug 21 08:15:45 2018 (1.9k) by ppisar [...] redhat.com
</a>
</font></li>
</ul>


0001-Fix-building-on-systems-without-TLSv1.3-support.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1806810/972536/0001-Fix-building-on-systems-without-TLSv1.3-support.patch">
Tue Aug 21 11:10:45 2018 (1.4k) by ppisar [...] redhat.com
</a>
</font></li>
</ul>


0001-NPN-is-unavailable-in-TLSv1.3.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1806185/972352/0001-NPN-is-unavailable-in-TLSv1.3.patch">
Fri Aug 17 09:18:55 2018 (1.6k) by ppisar [...] redhat.com
</a>
</font></li>
</ul>


more-sigpipe-ignore.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1810152/974216/more-sigpipe-ignore.patch">
Mon Sep 17 07:54:39 2018 (2.6k) by dam [...] cpan.org
</a>
</font></li>
</ul>


signature.asc<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1808625/973450/signature.asc">
Tue Sep 04 08:09:58 2018 (228b) by ppisar [...] redhat.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;17&nbsp;08:15:03&nbsp;2018</span>
    <span class="description">ppisar [...] redhat.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Tests fail with OpenSSL 1.1.1</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">OpenSSL has released 1.1.1pre7 version, a preview of 1.1.1 version with default TLSv1.3 support.

This needs a proper support in Net-SSLeay and then in IO-Socket-SSL. Net-SSLeay support is on the way &#40;CPAN RT#125218&#41; and with all its patches and some tweaks for IO-Socket-SSL, I was able to pass all IO-Socket-SSL tests except:

t/npn.t  -- NPN does not work for unknown reason
t/session_ticket.t -- TLSv1.3 tickets needs to use SSL_CTX_sess_set_new_cb&#40;&#41; that is not yet provided by Net-SSLeay.
t/sni_verify.t -- server dies with SIGPIPE because tickets send to closes TCP socket, trivial to fix with a proper SSL_shutdown in t/sni_verify.t.

Latest changes for IO-Socket-SSL are attached.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-Adapt-to-OpenSSL-1.1.1.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From d432295468a1efa18e56c1fbb34e3a23bb07d1e8 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Petr=20P=C3=ADsa=C5=99?= &lt;ppisar@redhat.com&gt;
Date: Thu, 16 Aug 2018 14:56:23 +0200
Subject: [PATCH] Adapt to OpenSSL 1.1.1
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

It needs patched Net-SSLeay &#40;CPAN RT#125218&#41;.

This patch introduces some TLSv1.3 identifiers but does not document
them. This is to let the IO-Socket-SSL maintainer to define the API.

This is not a final patch. We need to fix failures in:

t/npn.t
t/session_ticket.t
t/sni_verify.t

Signed-off-by: Petr PÃ­saÅ &lt;ppisar@redhat.com&gt;
---
 lib/IO/Socket/SSL.pm | 17 +++++++++++++++--
 t/ecdhe.t            | 16 +++++++++++-----
 t/protocol_version.t |  4 ++--
 t/session_ticket.t   |  2 ++
 4 files changed, 30 insertions&#40;+&#41;, 9 deletions&#40;-&#41;

diff --git a/lib/IO/Socket/SSL.pm b/lib/IO/Socket/SSL.pm
index 9c81ffc..5b43467 100644
--- a/lib/IO/Socket/SSL.pm
+++ b/lib/IO/Socket/SSL.pm
@@ -211,7 +211,8 @@ BEGIN{
 # get constants for SSL_OP_NO_* now, instead calling the related functions
 # every time we setup a connection
 my %SSL_OP_NO;
-for&#40;qw&#40; SSLv2 SSLv3 TLSv1 TLSv1_1 TLSv11:TLSv1_1 TLSv1_2 TLSv12:TLSv1_2 &#41;&#41; {
+for&#40;qw&#40; SSLv2 SSLv3 TLSv1 TLSv1_1 TLSv11:TLSv1_1 TLSv1_2 TLSv12:TLSv1_2
+        TLSv1_3 TLSv13:TLSv1_3 &#41;&#41; {
     my &#40;$k,$op&#41; = m{:} ? split&#40;m{:},$_,2&#41; : &#40;$_,$_&#41;;
     my $sub = &#34;Net::SSLeay::OP_NO_$op&#34;;
     local $SIG{__DIE__};
@@ -1836,6 +1837,7 @@ sub get_sslversion {
     my $ssl = shift&#40;&#41;-&gt;_get_ssl_object || return;
     my $version = Net::SSLeay::version&#40;$ssl&#41; or return;
     return
+	$version == 0x0304 ? &#39;TLSv1_3&#39; :
 	$version == 0x0303 ? &#39;TLSv1_2&#39; :
 	$version == 0x0302 ? &#39;TLSv1_1&#39; :
 	$version == 0x0301 ? &#39;TLSv1&#39;   :
@@ -2281,7 +2283,7 @@ sub new {
 
     my $ver = &#39;&#39;;
     for &#40;split&#40;/\s*:\s*/,$arg_hash-&gt;{SSL_version}&#41;&#41; {
-	m{^&#40;!?&#41;&#40;?:&#40;SSL&#40;?:v2|v3|v23|v2/3&#41;&#41;|&#40;TLSv1&#40;?:_?[12]&#41;?&#41;&#41;$}i
+	m{^&#40;!?&#41;&#40;?:&#40;SSL&#40;?:v2|v3|v23|v2/3&#41;&#41;|&#40;TLSv1&#40;?:_?[123]&#41;?&#41;&#41;$}i
 	or croak&#40;&#34;invalid SSL_version specified&#34;&#41;;
 	my $not = $1;
 	&#40; my $v = lc&#40;$2||$3&#41; &#41; =~s{^&#40;...&#41;}{\U$1};
@@ -2329,6 +2331,17 @@ sub new {
 	    IO::Socket::SSL-&gt;error&#40;&#34;SSL Context init failed&#34;&#41;;
 	$CTX_CREATED_IN_THIS_THREAD{$ctx} = 1 if $use_threads;
 
+	# There is no CTX_tlsv1_3_new&#40;&#41;. Create TLSv1.3 only context using
+	# a flexible method.
+	if &#40;$ver eq &#39;TLSv1_3&#39;&#41; {
+	    if &#40;!Net::SSLeay::CTX_set_min_proto_version&#40;$ctx,
+		    Net::SSLeay::TLS1_3_VERSION&#40;&#41;&#41; or
+		!Net::SSLeay::CTX_set_max_proto_version&#40;$ctx,
+		    Net::SSLeay::TLS1_3_VERSION&#40;&#41;&#41;&#41; {
+		IO::Socket::SSL-&gt;error&#40;&#34;TLSv1_3 context init failed&#34;&#41;;
+	    }
+	}
+
 	# SSL_OP_CIPHER_SERVER_PREFERENCE
 	$ssl_op |= 0x00400000 if $arg_hash-&gt;{SSL_honor_cipher_order};
 
diff --git a/t/ecdhe.t b/t/ecdhe.t
index 638d82b..1b229c5 100644
--- a/t/ecdhe.t
+++ b/t/ecdhe.t
@@ -53,12 +53,18 @@ if &#40; !defined $pid &#41; {
     };
     ok&#40; &#34;client connected&#34; &#41;;
 
-    my $cipher = $to_server-&gt;get_cipher&#40;&#41;;
-    if &#40; $cipher !~m/^ECDHE-/ &#41; {
-	notok&#40;&#34;bad key exchange: $cipher&#34;&#41;;
-	exit;
+    my $protocol = $to_server-&gt;get_sslversion;
+    if &#40;$protocol eq &#39;TLSv1_3&#39;&#41; {
+        # &lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://www.openssl.org/blog/blog/2017/05/04/tlsv1.3/">https://www.openssl.org/blog/blog/2017/05/04/tlsv1.3/</a></span>&gt;
+        ok&#40;&#34;# SKIP TLSv1.3 doesn&#39;t advertize key exchange in a chipher name&#34;&#41;;
+    } else {
+        my $cipher = $to_server-&gt;get_cipher&#40;&#41;;
+        if &#40; $cipher !~m/^ECDHE-/ &#41; {
+            notok&#40;&#34;bad key exchange: $cipher&#34;&#41;;
+            exit;
+        }
+        ok&#40;&#34;ecdh key exchange: $cipher&#34;&#41;;
     }
-    ok&#40;&#34;ecdh key exchange: $cipher&#34;&#41;;
 
 } else {                ###### Server
 
diff --git a/t/protocol_version.t b/t/protocol_version.t
index e3853d8..3577720 100644
--- a/t/protocol_version.t
+++ b/t/protocol_version.t
@@ -13,7 +13,7 @@ plan skip_all =&gt; &#34;Test::More has no done_testing&#34;
 $|=1;
 
 my $XDEBUG = 0;
-my @versions = qw&#40;SSLv3 TLSv1 TLSv1_1 TLSv1_2&#41;;
+my @versions = qw&#40;SSLv3 TLSv1 TLSv1_1 TLSv1_2 TLSv1_3&#41;;
 
 my $server = IO::Socket::SSL-&gt;new&#40;
     LocalAddr =&gt; &#39;127.0.0.1&#39;,
@@ -82,7 +82,7 @@ if &#40;$pid == 0&#41; {
     die &#34;best protocol version server supports is $ver&#34; if $supported{foo};
 
     # Check if the OpenSSL was compiled without support for specific protocols
-    for&#40;qw&#40;SSLv3 TLSv1 TLSv1_1&#41;&#41; {
+    for&#40;qw&#40;SSLv3 TLSv1 TLSv1_1 TLSv1_2 TLSv1_3&#41;&#41; {
 	if &#40; ! $check-&gt;&#40;$_,&#39;&#39;&#41;&#41; {
 	    diag&#40;&#34;looks like OpenSSL was compiled without $_ support&#34;&#41;;
 	    delete $supported{$_};
diff --git a/t/session_ticket.t b/t/session_ticket.t
index d3c15d9..bff6a86 100644
--- a/t/session_ticket.t
+++ b/t/session_ticket.t
@@ -73,6 +73,8 @@ my $client = sub {
 };
 
 
+# FIXME: TLSv1.3 requires to use SSL_CTX_sess_set_new_cb&#40;&#41; by clients instead
+# of SSL_get1_session&#40;&#41;. Missing from Net::SSLeay.
 $client-&gt;&#40;0,0,&#34;no initial session -&gt; no reuse&#34;&#41;;
 $client-&gt;&#40;0,1,&#34;reuse with the next session and secret[0]&#34;&#41;;
 $client-&gt;&#40;1,1,&#34;reuse even though server changed, since they share ticket secret&#34;&#41;;
-- 
2.14.4

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;17&nbsp;08:16:46&nbsp;2018</span>
    <span class="description">ppisar [...] redhat.com -  Dependency on ticket #125218 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;17&nbsp;08:52:13&nbsp;2018</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne Pá 17.srp.2018 08:15:03, ppisar napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; t/sni_verify.t -- server dies with SIGPIPE because tickets send to
&gt; closes TCP socket, trivial to fix with a proper SSL_shutdown in
&gt; t/sni_verify.t.
&gt; 
</div>Fix for t/sni_verify.t is attached.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-Do-two-way-shutdown-in-t-sni_verify.t.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 84a3bc6c273977bcd4b709e0d9a3d9fcdd58e36d Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Petr=20P=C3=ADsa=C5=99?= &lt;ppisar@redhat.com&gt;
Date: Fri, 17 Aug 2018 14:46:33 +0200
Subject: [PATCH] Do two-way shutdown in t/sni_verify.t
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

OpenSSL 1.1.1-pre7 sigipipes TLSv1.3 server if client does not
shutdown TLS properly.
&lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/openssl/openssl/issues/6904">https://github.com/openssl/openssl/issues/6904</a></span>&gt;

Signed-off-by: Petr PÃ­saÅ &lt;ppisar@redhat.com&gt;
---
 t/sni_verify.t | 10 ++++++++++
 1 file changed, 10 insertions&#40;+&#41;

diff --git a/t/sni_verify.t b/t/sni_verify.t
index b3b299b..b5ac4bd 100644
--- a/t/sni_verify.t
+++ b/t/sni_verify.t
@@ -71,6 +71,13 @@ if &#40; $pid == 0 &#41; {
 
 	$client-&gt;verify_hostname&#40;$host,&#39;http&#39;&#41; or print &#34;not &#34;;
 	print &#34;ok # client verify hostname in cert $host\n&#34;;
+
+	if &#40;$client&#41; {
+	    # Shutdown TLS properly. Otherwise TLSv1.3 server will receive SIGPIPE
+	    # in SSL_accept&#40;&#41; and dies.
+	    # &lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/openssl/openssl/issues/6904">https://github.com/openssl/openssl/issues/6904</a></span>&gt;.
+	    $client-&gt;close&#40;&#39;SSL_fast_shutdown&#39; =&gt; 0&#41;;
+	}
     }
     exit;
 }
@@ -81,5 +88,8 @@ for my $host &#40;@tests&#41; {
     my $name = $csock-&gt;get_servername;
     print &#34;not &#34; if ! $name or $name ne $host;
     print &#34;ok # server got SNI name $host\n&#34;;
+    if &#40;$csock&#41; {
+        $csock-&gt;close&#40;&#39;SSL_fast_shutdown&#39; =&gt; 0&#41;;
+    }
 }
 wait;
-- 
2.14.4

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;17&nbsp;09:18:55&nbsp;2018</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne Pá 17.srp.2018 08:15:03, ppisar napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; t/npn.t  -- NPN does not work for unknown reason
</div>
It turned out TLSv1.3 does not support NPN &lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/openssl/openssl/issues/3665">https://github.com/openssl/openssl/issues/3665</a></span>&gt;. Attached patch corrects the test.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-NPN-is-unavailable-in-TLSv1.3.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 94b0b52f05911bd8cfe579406248c8afe36004d7 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Petr=20P=C3=ADsa=C5=99?= &lt;ppisar@redhat.com&gt;
Date: Fri, 17 Aug 2018 15:14:40 +0200
Subject: [PATCH] NPN is unavailable in TLSv1.3
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

TLSv1.3 does not support NPN. Application can use ALPN. This caused
t/npn.t failures when TLSv1.3 was negotiated. This patch disables
TLSv1.3 in the test.

&lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/openssl/openssl/issues/3665">https://github.com/openssl/openssl/issues/3665</a></span>&gt;

Signed-off-by: Petr PÃ­saÅ &lt;ppisar@redhat.com&gt;
---
 lib/IO/Socket/SSL.pod | 2 +-
 t/npn.t               | 2 ++
 2 files changed, 3 insertions&#40;+&#41;, 1 deletion&#40;-&#41;

diff --git a/lib/IO/Socket/SSL.pod b/lib/IO/Socket/SSL.pod
index 95401aa..363901b 100644
--- a/lib/IO/Socket/SSL.pod
+++ b/lib/IO/Socket/SSL.pod
@@ -1336,7 +1336,7 @@ as an array ref.
 See also method C&lt;next_proto_negotiated&gt;.
 
 Next Protocol Negotiation &#40;NPN&#41; is available with Net::SSLeay 1.46+ and
-openssl-1.0.1+.
+openssl-1.0.1+. NPN is unavailable in TLSv1.3 protocol.
 To check support you might call C&lt;&lt; IO::Socket::SSL-&gt;can_npn&#40;&#41; &gt;&gt;.
 If you use this option with an unsupported Net::SSLeay/OpenSSL it will
 throw an error.
diff --git a/t/npn.t b/t/npn.t
index 8992a77..6ee6ca6 100644
--- a/t/npn.t
+++ b/t/npn.t
@@ -25,6 +25,8 @@ my $addr = &#39;127.0.0.1&#39;;
 my $server = IO::Socket::SSL-&gt;new&#40;
     LocalAddr =&gt; $addr,
     Listen =&gt; 2,
+    SSL_version =&gt; &#39;SSLv23:!TLSv1_3&#39;, # NPN does not exist in TLSv1.3
+                                # <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/openssl/openssl/issues/3665">https://github.com/openssl/openssl/issues/3665</a></span>
     SSL_cert_file =&gt; &#39;certs/server-cert.pem&#39;,
     SSL_key_file =&gt; &#39;certs/server-key.pem&#39;,
     SSL_npn_protocols =&gt; [qw&#40;one two&#41;],
-- 
2.14.4

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;21&nbsp;08:15:24&nbsp;2018</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne Pá 17.srp.2018 08:15:03, ppisar napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; t/session_ticket.t -- TLSv1.3 tickets needs to use
&gt; SSL_CTX_sess_set_new_cb&#40;&#41; that is not yet provided by Net-SSLeay.
</div>
It seems a proper support would need more than SSL_CTX_sess_set_new_cb&#40;&#41; because the new API is quite rich including interaction with internal OpenSSL session cache.

Attached patch excluded TLSv1.3 from the t/session_ticket.t.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;21&nbsp;08:15:45&nbsp;2018</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne Pá 17.srp.2018 08:15:03, ppisar napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; t/session_ticket.t -- TLSv1.3 tickets needs to use
&gt; SSL_CTX_sess_set_new_cb&#40;&#41; that is not yet provided by Net-SSLeay.
</div>
It seems a proper support would need more than SSL_CTX_sess_set_new_cb&#40;&#41; because the new API is quite rich including interaction with internal OpenSSL session cache.

Attached patch excluded TLSv1.3 from the t/session_ticket.t.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-Exclude-TLSv1.3-from-t-session_ticket.t.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From c332d19048735e32e2754685fa3c8654ca068b78 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Petr=20P=C3=ADsa=C5=99?= &lt;ppisar@redhat.com&gt;
Date: Tue, 21 Aug 2018 12:32:39 +0200
Subject: [PATCH] Exclude TLSv1.3 from t/session_ticket.t
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

The test fails with OpenSSL 1.1.1 because SSL_get1_session&#40;&#41; is not
reliable with TLSv1.3. A proper resumption support would need
migration to SSL_CTX_sess_set_new_cb&#40;&#41; API.

This patch also performs full SSL_shutdown in the test becasue
SSL_get1_session&#40;&#41; manual documents that a connection must be properly
SSL_shutdowned, otherwise the session will be removed from the
&#40;internal&#41; session cache.

Signed-off-by: Petr PÃ­saÅ &lt;ppisar@redhat.com&gt;
---
 t/session_ticket.t | 9 +++++++--
 1 file changed, 7 insertions&#40;+&#41;, 2 deletions&#40;-&#41;

diff --git a/t/session_ticket.t b/t/session_ticket.t
index bff6a86..69cbc96 100644
--- a/t/session_ticket.t
+++ b/t/session_ticket.t
@@ -69,7 +69,7 @@ my $client = sub {
     diag&#40;&#34;connect to $i: &#34;.
 	&#40;$cl ? &#34;success reuse=$reuse&#34; : &#34;error: $!,$SSL_ERROR&#34;&#41;&#41;;
     is&#40;$reuse,$expect_reuse,$desc&#41;;
-    close&#40;$cl&#41;;
+    $cl-&gt;close&#40;&#39;SSL_fast_shutdown&#39; =&gt; 0&#41;;
 };
 
 
@@ -123,6 +123,11 @@ sub _server {
 	    SSL_verify_mode =&gt; SSL_VERIFY_PEER|SSL_VERIFY_FAIL_IF_NO_PEER_CERT,
 	    SSL_ticket_keycb =&gt; $get_ticket_key,
 	    SSL_session_id_context =&gt; &#39;foobar&#39;,
+	    SSL_version =&gt; &#39;SSLv23:!TLSv1_3&#39;, # TLSv1.3 sends session tickes after
+		# a handshake, this SSL_get1_session&#40;&#41; is not reliable anymore.
+		# Exclude TLSv1.3 from tests. Proper TLSv1.3 session resumption
+		# will need SSL_CTX_sess_set_new_cb&#40;&#41;.
+		# &lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://www.openssl.org/blog/blog/2017/05/04/tlsv1.3/">https://www.openssl.org/blog/blog/2017/05/04/tlsv1.3/</a></span>&gt;
 	&#41; or die &#34;failed to create SSL context: $SSL_ERROR&#34;;
     }
 
@@ -158,7 +163,7 @@ sub _server {
 		print &#34;rotate secrets\n&#34;;
 		push @secrets, shift&#40;@secrets&#41;;
 	    }
-	    close&#40;$cl&#41;;
+	    $cl-&gt;close&#40;&#39;SSL_fast_shutdown&#39; =&gt; 0&#41;;
 	    alarm&#40;0&#41;;
 	    last;
 	}
-- 
2.14.4

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;21&nbsp;10:13:26&nbsp;2018</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne Pá 17.srp.2018 08:15:03, ppisar napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; t/sni_verify.t -- server dies with SIGPIPE because tickets send to
&gt; closes TCP socket, trivial to fix with a proper SSL_shutdown in
&gt; t/sni_verify.t.
&gt; 
</div>Similar bug is n t/sni.t. But here instead of SIGPIPE the accept simply failed and undefined client socket lead to run-time exception when invoking a method on it.

Attached patch fixes it.

Maybe IO::Socket::SSL should default to &#39;SSL_fast_shutdown&#39; =&gt; 0 in globally. Otherwise many application will be surprised.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-Do-two-way-shutdown-in-t-sni.t.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 1d19a7d01960fd8dc00bb3929a1ffaee186470fd Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Petr=20P=C3=ADsa=C5=99?= &lt;ppisar@redhat.com&gt;
Date: Tue, 21 Aug 2018 16:02:19 +0200
Subject: [PATCH] Do two-way shutdown in t/sni.t
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

TLSv1.3 performs more reading and writing in SSL_accept&#40;&#41;. If a client
disconnects after the handshake but before the server finishes
SSL_accept&#40;&#41;, the t/sni.t test would fail because accept&#40;&#41; could fail with
ECONNRESET. This happened randomly.

Failed accept&#40;&#41; lead to undef-&gt;get_servername&#40;&#41; call that triggered
a run-time exception and that caused a client being stucked and the
test script never exited.

This fixes both these issues.

Signed-off-by: Petr PÃ­saÅ &lt;ppisar@redhat.com&gt;
---
 t/sni.t | 20 ++++++++++++++++++--
 1 file changed, 18 insertions&#40;+&#41;, 2 deletions&#40;-&#41;

diff --git a/t/sni.t b/t/sni.t
index de0f06e..91206de 100644
--- a/t/sni.t
+++ b/t/sni.t
@@ -68,15 +68,31 @@ if &#40; $pid == 0 &#41; {
 
 	$client-&gt;verify_hostname&#40;$host,&#39;http&#39;&#41; or print &#34;not &#34;;
 	print &#34;ok # client verify hostname in cert $host\n&#34;;
+	# Shutdown TLS properly. Otherwise TLSv1.3 $server-&gt;accept&#40;&#41; fails with
+	# ECONNRESET when a client disconnects too early.
+	$client-&gt;close&#40;&#39;SSL_fast_shutdown&#39; =&gt; 0&#41;;
     }
     exit;
 }
 
+# If the server dies, a client can get stuck in read&#40;2&#41; while Perl interpreter
+# is collecting children status in the die handler using wait4&#40;2&#41;.
+$SIG{__DIE__} = sub {
+    STDERR-&gt;print&#40;&#34;Server died. Killing client with $pid PID.\n&#34;&#41;;
+    kill&#40;9, $pid&#41;;
+};
 for my $host &#40;@tests&#41; {
-    my $csock = $server-&gt;accept or print &#34;not &#34;;
-    print &#34;ok # server accept\n&#34;;
+    my $csock = $server-&gt;accept;
+    if &#40;!$csock&#41; {
+        print &#34;not ok # server accept SSL_ERROR=&#39;$SSL_ERROR&#39;, errno=&#39;$!&#39;&#34;;
+    } else {
+        print &#34;ok # server accept\n&#34;;
+    }
     my $name = $csock-&gt;get_servername;
     print &#34;not &#34; if ! $name or $name ne $host;
     print &#34;ok # server got SNI name $host\n&#34;;
+    # Shutdown TLS properly. Otherwise TLSv1.3 $server-&gt;accept&#40;&#41; fails with
+    # ECONNRESET when a client disconnects too early.
+    $csock-&gt;close&#40;&#39;SSL_fast_shutdown&#39; =&gt; 0&#41;;
 }
 wait;
-- 
2.14.4

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;21&nbsp;11:10:45&nbsp;2018</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne Pá 17.srp.2018 08:15:03, ppisar napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Latest changes for IO-Socket-SSL are attached.
</div>
Adapt-to-OpenSSL-1.1.1.patch added TLSv1_3 constant and implemented TLSv1.3 only contexts using Net::SSLeay::TLS1_3_VERSION&#40;&#41;. Using this constant-subroutine blasts if Net::SSLeay was built on a system with old OpenSSL without TLSv1.3 support.

Attached patch fixes Net::SSLeay::TLS1_3_VERSION&#40;&#41; use so that it&#39;s possible to build and pass all tests on systems with and without OpenSSL 1.1.1
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-Fix-building-on-systems-without-TLSv1.3-support.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 12ff43c81b10446bd74cc719f0a6913040598c58 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Petr=20P=C3=ADsa=C5=99?= &lt;ppisar@redhat.com&gt;
Date: Tue, 21 Aug 2018 16:34:39 +0200
Subject: [PATCH] Fix building on systems without TLSv1.3 support
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

If OpenSSL does not support TLSv1.3, Net::SSLeay does not have
TLS1_3_VERSION&#40;&#41; and t/protocol_version.t fails with:

    #   Failed test &#39;Your vendor has not defined SSLeay macro TLS1_3_VERSION at /home/test/fedora/perl-IO-Socket-SSL/IO-Socket-SSL-2.059/blib/lib/IO/Socket/SSL.pm line 2337.
    # &#39;
    #   at ./t/testlib.pl line 39.

This patch fixes creating IO::Socket:SSL context for TLSv1.3 by
checking whether it&#39;s supported by Net::SSLeay.

Signed-off-by: Petr PÃ­saÅ &lt;ppisar@redhat.com&gt;
---
 lib/IO/Socket/SSL.pm | 4 ++++
 1 file changed, 4 insertions&#40;+&#41;

diff --git a/lib/IO/Socket/SSL.pm b/lib/IO/Socket/SSL.pm
index 5b43467..7138ab0 100644
--- a/lib/IO/Socket/SSL.pm
+++ b/lib/IO/Socket/SSL.pm
@@ -2334,6 +2334,10 @@ sub new {
 	# There is no CTX_tlsv1_3_new&#40;&#41;. Create TLSv1.3 only context using
 	# a flexible method.
 	if &#40;$ver eq &#39;TLSv1_3&#39;&#41; {
+	    if &#40;!eval {Net::SSLeay::TLS1_3_VERSION&#40;&#41;}&#41; {
+		return IO::Socket::SSL-&gt;_internal_error&#40;
+		    &#34;SSL Version $ver not supported&#34;,9&#41;;
+	    }
 	    if &#40;!Net::SSLeay::CTX_set_min_proto_version&#40;$ctx,
 		    Net::SSLeay::TLS1_3_VERSION&#40;&#41;&#41; or
 		!Net::SSLeay::CTX_set_max_proto_version&#40;$ctx,
-- 
2.14.4

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;24&nbsp;10:04:43&nbsp;2018</span>
    <span class="description">RADIATOR [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On pe 17.elokuu 2018 08:15:03, ppisar wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; t/session_ticket.t -- TLSv1.3 tickets needs to use
&gt; SSL_CTX_sess_set_new_cb&#40;&#41; that is not yet provided by Net-SSLeay.
</div>
Github issue now exists to track this:
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/radiator-software/p5-net-ssleay/issues/38">https://github.com/radiator-software/p5-net-ssleay/issues/38</a></span>

-- 
Heikki
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;24&nbsp;10:04:44&nbsp;2018</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;24&nbsp;18:32:55&nbsp;2018</span>
    <span class="description">gregoa [...] cpan.org -  Cc GREGOA added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;29&nbsp;12:15:14&nbsp;2018</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the input so far.

From my perspective support in Perl for TLS 1.3 with OpenSSL 1.1.1 seems to be not really stable right now - there seem to be still changes needed in Net::SSLeay before TLS 1.3 can be fully integrated, tested and supported by IO::Socket::SSL.  While your changes look fine in general I&#39;m not really comfortable with the necessary SSL_fast_shutdown on various places in the tests, since this also means that end users might face and address these problems themselves in their own code when moving to the new OpenSSL version.

If possible I would prefer if you take these changes to github since its easier to handle larger changes there instead of extracting all patches and hopefully only the latest from this issuer tracker.

Regards,
Steffen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;29&nbsp;12:15:15&nbsp;2018</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Status changed from &#39;open&#39; to &#39;new&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;04&nbsp;08:09:58&nbsp;2018</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #126899] Tests fail with OpenSSL 1.1.1</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 4 Sep 2018 14:01:52 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Steffen Ullrich via RT &lt;bug-IO-Socket-SSL [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Petr Pisar &lt;ppisar [...] redhat.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, Aug 29, 2018 at 12:15:15PM -0400, Steffen Ullrich via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; While your changes look fine in general I&#39;m not really comfortable with the
&gt; necessary SSL_fast_shutdown on various places in the tests, since this also
&gt; means that end users might face and address these problems themselves in
&gt; their own code when moving to the new OpenSSL version.
&gt; 
</div>I agree with you. I was only worried about non-blocking mode that cannot
change default SSL shutdown to full two-way shutdown because of the nature of
the non-blocking mode. Therefore blocking and non-blocking mode would behave
differently.

Fortunately OpenSSL commited a change
&lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/openssl/openssl/commit/f273ff953abfafbb5fc4d68904469f862fbeae8a">https://github.com/openssl/openssl/commit/f273ff953abfafbb5fc4d68904469f862fbeae8a</a></span>&gt;
that allows SSL_accept&#40;&#41; to survive a half-closed TCP connection without
reporting an error. The only deficiency is that a server still has to
actively ignore SIGPIPE signal.

I will retest IO-Socket-SSL with the OpenSSL change. Probably won&#39;t need
the SSL_fast_shutdown anymore.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If possible I would prefer if you take these changes to github since its
&gt; easier to handle larger changes there instead of extracting all patches and
&gt; hopefully only the latest from this issuer tracker.
&gt; 
</div>Here it is &lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/ppisar/p5-io-socket-ssl/commits/TLSv1.3">https://github.com/ppisar/p5-io-socket-ssl/commits/TLSv1.3</a></span>&gt;. I was
reluctant to use the github repository as it lack behined the
IO-Socket-SSL-2.059 CPAN release.

-- Petr
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1808625/973450/signature.asc">Download signature.asc</a><br />
<span class="downloadcontenttype">application/pgp-signature 228b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;04&nbsp;08:31:05&nbsp;2018</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;.... I was
&gt; reluctant to use the github repository as it lack behined the
&gt; IO-Socket-SSL-2.059 CPAN release.
&gt; 
</div>
It looks like I forgot to push the changes. github should now be up-to-date.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;04&nbsp;08:31:05&nbsp;2018</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;15&nbsp;09:49:13&nbsp;2018</span>
    <span class="description">kurt [...] roeckx.be -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #126899] Tests fail with OpenSSL 1.1.1</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 15 Sep 2018 15:41:05 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-IO-Socket-SSL [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kurt Roeckx &lt;kurt [...] roeckx.be&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">With OpenSSL 1.1.1, when acting as client, I suggest that you turn
SSL_fast_shutdown into a 2 way shutdown.

This has the following advantages:
- This will prevent the server from getting an EPIPE.
- You can resume sessions, assuming you ask them at the right
  time.

The disadvantage is that you of course need to wait for the reply
of the server.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;16&nbsp;15:22:36&nbsp;2018</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Am Sa 15. Sep 2018, 09:49:13, kurt@roeckx.be schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; With OpenSSL 1.1.1, when acting as client, I suggest that you turn
&gt; SSL_fast_shutdown into a 2 way shutdown.
&gt; 
&gt; This has the following advantages:
&gt; - This will prevent the server from getting an EPIPE.
&gt; - You can resume sessions, assuming you ask them at the right
&gt;   time.
&gt; 
&gt; The disadvantage is that you of course need to wait for the reply
&gt; of the server.
</div>
The expectation with close on IO::Socket objects is that it returns immediately. I would like to fullfill this expectation and not have it behave differently depending on the version of OpenSSL.
But I think  that users of IO::Socket::SSL must be more aware on how much different a SSL socket from a &#34;normal&#34; socket can behave. It was actually possible even before OpenSSL 1.1.1 that a a signal PIPE might have been triggered during accept &#40;i.e. SSL_accept&#41; or close &#40;i.e. SSL_shutdown&#41; since both functions send data to the peer and the peer might already have been closed at the TCP level. It is only more likely that this happens now, but it is not actually new.
Therefore I added PIPE handling to the tests and also updated the documentation in 2.060 to specifically point out these problems.  
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;16&nbsp;15:27:20&nbsp;2018</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Am Di 04. Sep 2018, 08:31:05, SULLR schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt;.... I was
&gt; &gt; reluctant to use the github repository as it lack behined the
&gt; &gt; IO-Socket-SSL-2.059 CPAN release.
&gt; &gt; 
</div>&gt; 
&gt; It looks like I forgot to push the changes. github should now be up-to-date.
</div>
Thanks,
I just release 2.060 which should be compatible with TLS 1.3 and OpenSSL 1.1.1. I&#39;ve incorporated some of your changes but also did some things different than you did. Session resume is not yet done for TLS 1.3 but the tests should now all succeed so I close this issue.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;17&nbsp;06:35:26&nbsp;2018</span>
    <span class="description">dam [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">На 16 септ. 2018, нд 22:27:20, SULLR написа:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I just release 2.060 which should be compatible with TLS 1.3 and
&gt; OpenSSL 1.1.1. I&#39;ve incorporated some of your changes but also did
&gt; some things different than you did. Session resume is not yet done for
&gt; TLS 1.3 but the tests should now all succeed so I close this issue.
</div>
Thanks for the new release!

The Debian package of 2.060 still managed to fail a couple of tests, see <span class="clickylink"><a target="new" rel="nofollow" href="https://buildd.debian.org/status/fetch.php?pkg=libio-socket-ssl-perl&#38;arch=all&#38;ver=2.060-1&#38;stamp=1537167776&#38;raw=0">https://buildd.debian.org/status/fetch.php?pkg=libio-socket-ssl-perl&#38;arch=all&#38;ver=2.060-1&#38;stamp=1537167776&#38;raw=0</a></span>

Locally I also made t/startssl.t fail by running it in a loop and loading the CPU.

I wonder if it would be appropriate to ignore SIGPIPE in all tests that involve forking.

-- dam
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;17&nbsp;06:36:49&nbsp;2018</span>
    <span class="description">dam [...] cpan.org -  Cc DAM added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;17&nbsp;07:54:39&nbsp;2018</span>
    <span class="description">dam [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">На 17 септ. 2018, пн 13:35:26, DAM написа:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I wonder if it would be appropriate to ignore SIGPIPE in all tests
&gt; that involve forking.
</div>
Here&#39;s the list of the tests that still fail in 2.060 when run in a loop on my system with overloaded CPU:

 - t/alpn.t
 - t/compatibility.t
 - t/dhe.t
 - t/ecdhe.t
 - t/io-socket-inet6.t
 - t/io-socket-ip.t
 - t/public_suffix_ssl.t
 - t/sessions.t
 - t/startssl.t
 - t/verify_fingerprint.t
 - t/verify_hostname.t

The symptom is Wstatus=13.

Ignoring SIGPIPE seems to make them to pass under the same conditions.

Attaching more-sigpipe-ignore.patch - a convenience patch adding $SIG{&#39;PIPE&#39;} = &#34;IGNORE&#34; to them.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> more-sigpipe-ignore.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Description: ignore SIGPIPE in more tests
 These are the tests which failed &#40;killed with SIGPIPE, Wstat=13&#41; when
 run continuously on a CPU-loaded system.
Author: Damyan Ivanov &lt;dmn@debian.org&gt;

--- a/t/compatibility.t
+++ b/t/compatibility.t
@@ -14,6 +14,7 @@ Test::More-&gt;builder-&gt;use_numbers&#40;0&#41;;
 Test::More-&gt;builder-&gt;no_ending&#40;1&#41;;
 
 $SIG{&#39;CHLD&#39;} = &#34;IGNORE&#34;;
+$SIG{&#39;PIPE&#39;} = &#34;IGNORE&#34;;
 
 IO::Socket::SSL::context_init&#40;SSL_verify_mode =&gt; 0x01&#41;;
 
--- a/t/verify_hostname.t
+++ b/t/verify_hostname.t
@@ -14,6 +14,7 @@ my $can_idn  = eval { require Encode } &#38;
     || eval { require URI; URI-&gt;VERSION&#40;1.50&#41; }
 &#41;;
 
+$SIG{&#39;PIPE&#39;} = &#34;IGNORE&#34;;
 $|=1;
 my $max = 42;
 $max+=3 if $can_idn;
--- a/t/startssl.t
+++ b/t/startssl.t
@@ -8,6 +8,8 @@ use IO::Socket::SSL;
 use IO::Select;
 do &#39;./testlib.pl&#39; || do &#39;./t/testlib.pl&#39; || die &#34;no testlib&#34;;
 
+$SIG{&#39;PIPE&#39;} = &#34;IGNORE&#34;;
+
 $|=1;
 print &#34;1..21\n&#34;;
 
--- a/t/dhe.t
+++ b/t/dhe.t
@@ -11,6 +11,7 @@ use Socket;
 use IO::Socket::SSL;
 do &#39;./testlib.pl&#39; || do &#39;./t/testlib.pl&#39; || die &#34;no testlib&#34;;
 
+$SIG{&#39;PIPE&#39;} = &#34;IGNORE&#34;;
 $|=1;
 print &#34;1..3\n&#34;;
 
--- a/t/ecdhe.t
+++ b/t/ecdhe.t
@@ -14,6 +14,7 @@ if &#40; ! IO::Socket::SSL-&gt;can_ecdh &#41; {
     exit
 }
 
+$SIG{&#39;PIPE&#39;} = &#34;IGNORE&#34;;
 $|=1;
 print &#34;1..4\n&#34;;
 
--- a/t/alpn.t
+++ b/t/alpn.t
@@ -17,6 +17,7 @@ if &#40; ! IO::Socket::SSL-&gt;can_alpn &#41; {
     exit;
 }
 
+$SIG{&#39;PIPE&#39;} = &#34;IGNORE&#34;;
 print &#34;1..5\n&#34;;
 
 # first create simple ssl-server
--- a/t/io-socket-ip.t
+++ b/t/io-socket-ip.t
@@ -29,6 +29,8 @@ unless&#40; IO::Socket::SSL-&gt;CAN_IPV6 eq &#34;IO
     exit
 }
 
+$SIG{&#39;PIPE&#39;} = &#34;IGNORE&#34;;
+
 my $addr = &#39;::1&#39;;
 # check if we can use ::1, e.g. if the computer has IPv6 enabled
 if &#40; ! IO::Socket::IP-&gt;new&#40;
--- a/t/io-socket-inet6.t
+++ b/t/io-socket-inet6.t
@@ -37,6 +37,8 @@ unless&#40; IO::Socket::SSL-&gt;CAN_IPV6 eq &#34;IO
     exit
 }
 
+$SIG{&#39;PIPE&#39;} = &#34;IGNORE&#34;;
+
 my $addr = &#39;::1&#39;;
 # check if we can use ::1, e.g. if the computer has IPv6 enabled
 if &#40; ! IO::Socket::INET6-&gt;new&#40;
--- a/t/public_suffix_ssl.t
+++ b/t/public_suffix_ssl.t
@@ -34,6 +34,7 @@ my @tests = qw&#40;
     ok:www.foo.nodomain|*.foo.nodomain
 &#41;;
 
+$SIG{&#39;PIPE&#39;} = &#34;IGNORE&#34;;
 $|=1;
 plan tests =&gt; 0+@tests;
 
--- a/t/sessions.t
+++ b/t/sessions.t
@@ -9,6 +9,7 @@ use Socket;
 use IO::Socket::SSL;
 do &#39;./testlib.pl&#39; || do &#39;./t/testlib.pl&#39; || die &#34;no testlib&#34;;
 
+$SIG{&#39;PIPE&#39;} = &#34;IGNORE&#34;;
 $|=1;
 my $numtests = 35;
 print &#34;1..$numtests\n&#34;;
--- a/t/verify_fingerprint.t
+++ b/t/verify_fingerprint.t
@@ -8,6 +8,8 @@ do &#39;./testlib.pl&#39; || do &#39;./t/testlib.pl&#39;
 
 plan tests =&gt; 13;
 
+$SIG{&#39;PIPE&#39;} = &#34;IGNORE&#34;;
+
 my &#40;$ca1,$cakey1&#41; = CERT_create&#40; CA =&gt; 1, subject =&gt; { CN =&gt; &#39;ca1&#39; }&#41;;
 my &#40;$cert1,$key1&#41; = CERT_create&#40; 
     subject =&gt; { CN =&gt; &#39;cert1&#39; },
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;17&nbsp;08:12:30&nbsp;2018</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Am Mo 17. Sep 2018, 07:54:39, DAM schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; На 17 септ. 2018, пн 13:35:26, DAM написа:
<div class="message-stanza open">&gt; &gt; I wonder if it would be appropriate to ignore SIGPIPE in all tests
&gt; &gt; that involve forking.
</div></div>
I think this is a good idea. I made the relevant change to t/testlib.pl since this is used
by all tests which fork. 
See <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/noxxi/p5-io-socket-ssl/commit/e96b1c9e394011de4ee181cfa42b8021796bf7d4">https://github.com/noxxi/p5-io-socket-ssl/commit/e96b1c9e394011de4ee181cfa42b8021796bf7d4</a></span>.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;24&nbsp;09:33:19&nbsp;2018</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne Ne 16.zář.2018 15:27:20, SULLR napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I just release 2.060 which should be compatible with TLS 1.3 and
&gt; OpenSSL 1.1.1.
</div>
I sent you documentation update &lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/noxxi/p5-io-socket-ssl/pull/75">https://github.com/noxxi/p5-io-socket-ssl/pull/75</a></span>&gt; for TLSv1_3 SSL_protocol.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;02&nbsp;11:42:57&nbsp;2019</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Support for OpenSSL 1.1.1 and TLS 1.3 is included in IO::Socket::SSL 2.061 but it needs Net::SSLeay 1.86 &#40;not released yet, 1.86_07 works&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;02&nbsp;11:42:59&nbsp;2019</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
