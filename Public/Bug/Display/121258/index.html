<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #121258 for ExtUtils-MakeMaker: &#39;.&#39; is injected into @INC uring EU:MM test phase</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #121258 for ExtUtils-MakeMaker: &#39;.&#39; is injected into @INC uring EU:MM test phase</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/ExtUtils-MakeMaker/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/ExtUtils-MakeMaker/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/ExtUtils-MakeMaker/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/ExtUtils-MakeMaker/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/ExtUtils-MakeMaker">ExtUtils-MakeMaker CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">121258</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/ExtUtils-MakeMaker/Active/">ExtUtils-MakeMaker</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
djerius [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
DBOOK [...] cpan.org

<br />
KENTNL [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-12494-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
7.24    </td>
  </tr>
  <tr id="CF-12495-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;20&nbsp;15:47:05&nbsp;2017</span>
    <span class="description">djerius [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> &#39;.&#39; is injected into @INC uring EU:MM test phase</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m using the ExtUtils::MakeMaker bundled with 5.25.11.

I&#39;ve compiled 5.25.11 with the -Ddefault_inc_excludes_dot flag to
ensure that it excludes &#39;.&#39; from inc.

% perl -V:config_args
config_args=&#39;-Dprefix=/home/dj/.plenv/versions/5.25.11-no-dot -de -Dusedevel -Ddefault_inc_excludes_dot -A&#39;eval:scriptdir=/home/dj/.plenv/versions/5.25.11-no-dot/bin&#39;&#39;;



Here&#39;s the default @INC from perl -V:

  @INC:
    /home/dj/.plenv/versions/5.25.11-no-dot/lib/perl5/site_perl/5.25.11/x86_64-linux
    /home/dj/.plenv/versions/5.25.11-no-dot/lib/perl5/site_perl/5.25.11
    /home/dj/.plenv/versions/5.25.11-no-dot/lib/perl5/5.25.11/x86_64-linux
    /home/dj/.plenv/versions/5.25.11-no-dot/lib/perl5/5.25.11


I expected the lack of &#39;.&#39; to persist throughout the Perl toolchain,
but it seems that &#39;.&#39; is added to @INC during the ExtUtils::MakeMaker
test phase, which allowed tests to pass which should have failed.

I&#39;ve attached a very simply distribution whose test exhibits this
behavior.  The test simply dumps @INC, and results in:

% make test
PERL_DL_NONLAZY=1 &#34;/data/pelf1/dj/hd0/root/dot/plenv/versions/5.25.11-no-dot/bin/perl5.25.11&#34; &#34;-MExtUtils::Command::MM&#34; &#34;-MTest::Harness&#34; &#34;-e&#34; &#34;undef *Test::Harness::Switches; test_harness&#40;0, &#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/*.t
t/test.t .. # [
#   &#39;/data/macabretmp/dj/test-inc/blib/lib&#39;,
#   &#39;/data/macabretmp/dj/test-inc/blib/arch&#39;,
#   &#39;/home/dj/.plenv/versions/5.25.11-no-dot/lib/perl5/site_perl/5.25.11/x86_64-linux&#39;,
#   &#39;/home/dj/.plenv/versions/5.25.11-no-dot/lib/perl5/site_perl/5.25.11&#39;,
#   &#39;/home/dj/.plenv/versions/5.25.11-no-dot/lib/perl5/5.25.11/x86_64-linux&#39;,
#   &#39;/home/dj/.plenv/versions/5.25.11-no-dot/lib/perl5/5.25.11&#39;,
#   &#39;.&#39;
# ]


Notice the trailing &#39;.&#39;.  

If I set PERL_USE_UNSAFE_INC=0, I get the expected results:

% PERL_USE_UNSAFE_INC=0 make test
PERL_DL_NONLAZY=1 &#34;/data/pelf1/dj/hd0/root/dot/plenv/versions/5.25.11-no-dot/bin/perl5.25.11&#34; &#34;-MExtUtils::Command::MM&#34; &#34;-MTest::Harness&#34; &#34;-e&#34; &#34;undef *Test::Harness::Switches; test_harness&#40;0, &#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/*.t
t/test.t .. # [
#   &#39;/data/macabretmp/dj/test-inc/blib/lib&#39;,
#   &#39;/data/macabretmp/dj/test-inc/blib/arch&#39;,
#   &#39;/home/dj/.plenv/versions/5.25.11-no-dot/lib/perl5/site_perl/5.25.11/x86_64-linux&#39;,
#   &#39;/home/dj/.plenv/versions/5.25.11-no-dot/lib/perl5/site_perl/5.25.11&#39;,
#   &#39;/home/dj/.plenv/versions/5.25.11-no-dot/lib/perl5/5.25.11/x86_64-linux&#39;,
#   &#39;/home/dj/.plenv/versions/5.25.11-no-dot/lib/perl5/5.25.11&#39;
# ]


I find this behavior confusing. If a &#39;.&#39; in @INC is evil, shouldn&#39;t the entire toolchain shun it?

It may be the case that this is fixed in version not bundled with Perl 5.25.11, but perlbug directed me here.

Thanks!
Diab
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Foo-Bar-0.01.tar.gz</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;20&nbsp;16:45:13&nbsp;2017</span>
    <span class="description">rt-cpan [...] trout.me.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Apr 20 15:47:05 2017, DJERIUS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I find this behavior confusing. If a &#39;.&#39; in @INC is evil, shouldn&#39;t
&gt; the entire toolchain shun it?
</div>
A &#39;.&#39; in @INC is a security risk *if* you don&#39;t control which directory your code is being executed from.

For tests, where the code is being executed from the root of an unpacked distro tarball, and executing it from any other path is unsupported and unlikely to work, there is no risk at all.

As such, your assertion that such tests &#34;should&#34; fail is inaccurate - there&#39;s absolutely nothing to be gained by forcing them to fail, and lots of extra pain for downstream packagers and users if we did that, since there&#39;s not actually anything wrong or risky involved.

As such, this is 100% expected, was done intentionally to avoid taking a steaming dump on our userbase, and is not a bug.

Sorry for any confusion.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;20&nbsp;16:45:15&nbsp;2017</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;20&nbsp;16:45:15&nbsp;2017</span>
    <span class="description">rt-cpan [...] trout.me.uk -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;20&nbsp;17:39:08&nbsp;2017</span>
    <span class="description">djerius [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #121258] &#39;.&#39; is injected into @INC uring EU:MM test phase</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 20 Apr 2017 17:38:01 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-ExtUtils-MakeMaker [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Diab Jerius &lt;djerius [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Apr 20, 2017 at 4:45 PM, Matt S Trout via RT &lt;
bug-ExtUtils-MakeMaker@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=121258">https://rt.cpan.org/Ticket/Display.html?id=121258</a></span> &gt;
&gt;
&gt; On Thu Apr 20 15:47:05 2017, DJERIUS wrote:
<div class="message-stanza open">&gt; &gt; I find this behavior confusing. If a &#39;.&#39; in @INC is evil, shouldn&#39;t
&gt; &gt; the entire toolchain shun it?
</div>&gt;
&gt; A &#39;.&#39; in @INC is a security risk *if* you don&#39;t control which directory
&gt; your code is being executed from.
&gt;
&gt; For tests, where the code is being executed from the root of an unpacked
&gt; distro tarball, and executing it from any other path is unsupported and
&gt; unlikely to work, there is no risk at all.
&gt;
&gt; As such, your assertion that such tests &#34;should&#34; fail is inaccurate -
&gt; there&#39;s absolutely nothing to be gained by forcing them to fail, and lots
&gt; of extra pain for downstream packagers and users if we did that, since
&gt; there&#39;s not actually anything wrong or risky involved.
&gt;
&gt; As such, this is 100% expected, was done intentionally to avoid taking a
&gt; steaming dump on our userbase, and is not a bug.
&gt;
&gt; Sorry for any confusion.
&gt;
</div>
​I&#39;m getting reports that one of my modules is failing tests because the
tester sets​
 PERL_USE_UNSAFE_INC=0
​, and thus the the &#39;.&#39; added by ExtUtils::MakeMaker is being removed.

That flag breaks ExtUtils::MakeMaker behavior.  What&#39;s the proper response
to that tester?  Stop doing that and it won&#39;t hurt any more?  Ignore them?
PERL_USE_UNSAFE_INC=0​ seems to be the go to method for testing things out,
yet it changes the behavior of a core module. I&#39;m a part of that userbase
you&#39;re worried about, and I feel some of that steaming dump is being slung
my way.
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;20&nbsp;20:36:55&nbsp;2017</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2017-04-20 14:39:08, DJERIUS wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ​I&#39;m getting reports that one of my modules is failing tests because the
&gt; tester sets​
&gt;  PERL_USE_UNSAFE_INC=0
&gt; ​, and thus the the &#39;.&#39; added by ExtUtils::MakeMaker is being removed.
&gt; 
&gt; That flag breaks ExtUtils::MakeMaker behavior.  What&#39;s the proper response
&gt; to that tester?  Stop doing that and it won&#39;t hurt any more?  Ignore them?
&gt; PERL_USE_UNSAFE_INC=0​ seems to be the go to method for testing things out,
&gt; yet it changes the behavior of a core module. I&#39;m a part of that userbase
&gt; you&#39;re worried about, and I feel some of that steaming dump is being slung
&gt; my way.
</div>
It&#39;s fair for a tester to be setting that variable -- it&#39;s checking what *would* happen if we removed the workaround in EUMM and Test::Harness to add . to @INC &#40;which we might do in a few years -- I think the current plan was to do this for the 5.30 release?&#41;

For an author, the proper response is to fix the code -- either add &#39;.&#39; to @INC, or to restructure the code so it doesn&#39;t need . in @INC anymore.

e.g. something like:

    use lib &#39;.&#39;;

or &#40;for example&#41;:

    mkdir t/lib
    mv t/Foo.pm t/lib/Foo.pm
    perl -p -i -e&#34;s/package t::Foo/package Foo/&#34; t/lib/Foo.pm
    perl -p -i -e&#34;s/use t::Foo/use lib &#39;t&#39;;\nuse Foo/&#39; t/*
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;21&nbsp;10:16:56&nbsp;2017</span>
    <span class="description">djerius [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #121258] &#39;.&#39; is injected into @INC uring EU:MM test phase</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 21 Apr 2017 10:15:55 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-ExtUtils-MakeMaker [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Diab Jerius &lt;djerius [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Apr 20, 2017 at 8:36 PM, Karen Etheridge via RT &lt;
bug-ExtUtils-MakeMaker@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=121258">https://rt.cpan.org/Ticket/Display.html?id=121258</a></span> &gt;
&gt;
&gt; On 2017-04-20 14:39:08, DJERIUS wrote:
&gt;
<div class="message-stanza open">&gt; &gt; ​I&#39;m getting reports that one of my modules is failing tests because the
&gt; &gt; tester sets​
&gt; &gt;  PERL_USE_UNSAFE_INC=0
&gt; &gt; ​, and thus the the &#39;.&#39; added by ExtUtils::MakeMaker is being removed.
&gt; &gt;
&gt; &gt; That flag breaks ExtUtils::MakeMaker behavior.  What&#39;s the proper
</div>&gt; response
<div class="message-stanza open">&gt; &gt; to that tester?  Stop doing that and it won&#39;t hurt any more?  Ignore
</div>&gt; them?
<div class="message-stanza open">&gt; &gt; PERL_USE_UNSAFE_INC=0​ seems to be the go to method for testing things
</div>&gt; out,
<div class="message-stanza open">&gt; &gt; yet it changes the behavior of a core module. I&#39;m a part of that userbase
&gt; &gt; you&#39;re worried about, and I feel some of that steaming dump is being
</div>&gt; slung
<div class="message-stanza open">&gt; &gt; my way.
</div>&gt;
&gt; It&#39;s fair for a tester to be setting that variable -- it&#39;s checking what
&gt; *would* happen if we removed the workaround in EUMM and Test::Harness to
&gt; add . to @INC &#40;which we might do in a few years -- I think the current plan
&gt; was to do this for the 5.30 release?&#41;
&gt;
&gt; For an author, the proper response is to fix the code -- either add &#39;.&#39; to
&gt; @INC, or to restructure the code so it doesn&#39;t need . in @INC anymore.
&gt;
&gt; e.g. something like:
&gt;
&gt;     use lib &#39;.&#39;;
&gt;
&gt; or &#40;for example&#41;:
&gt;
&gt;     mkdir t/lib
&gt;     mv t/Foo.pm t/lib/Foo.pm
&gt;     perl -p -i -e&#34;s/package t::Foo/package Foo/&#34; t/lib/Foo.pm
&gt;     perl -p -i -e&#34;s/use t::Foo/use lib &#39;t&#39;;\nuse Foo/&#39; t/*
&gt;
</div>
​
I rarely rant in public, but I&#39;m going to make an exception
here. I&#39;m rather frustrated with the situation and the tone of
the response that I&#39;m getting.

Let me lay this out in another fashion.

I&#39;m a CPAN author.

I download the latest development version of Perl, make sure I&#39;m
in a clean environment, fix the code so that it works.

Now I&#39;m informed, not by p5p, nor anyone working on the
toolchain, but via a bug report from a tester, that there&#39;s a
special environment variable that now has to be set to pass CPAN
tests.

A non-standard, poorly documented variable at that.  There&#39;s
nothing in the release notes which indicates that
PERL_USE_UNSAFE_INC=0 is special, only that setting it to 1 has a
particular effect.  Any reasonable person would assume that
setting it to 0 would be the same as not setting it, but that&#39;s
obviously not the case.

It may be fair for the testers to set that variable, but it&#39;s
blatantly *unfair* to CPAN authors not to inform them of this new
requirement.  There has been no communications from p5p or the
toolchain maintainers to CPAN authors.  You do have our email
addresses!

A simple email would suffice to clear everything up.  We aren&#39;t
privy to what&#39;s going on in the innards.

Give developers clear guidance on what to do. Make it public!

Don&#39;t make us read through the code or pore through release notes
for umpteen things to figure out why special environment
variables work or don&#39;t work.

And please, don&#39;t tell me what the &#34;proper&#34; response as a
developer is.  That&#39;s patronizing and offensive.  I wouldn&#39;t have
started this conversation if I didn&#39;t already take my
​responsibility seriously.

Diab
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;21&nbsp;12:38:54&nbsp;2017</span>
    <span class="description">KENTNL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza"><p>
	On 2017-04-22 02:16:56, DJERIUS wrote:<br>

	&gt;<br>

	&gt; I rarely rant in public, but I&#39;m going to make an exception<br>

	&gt; here. I&#39;m rather frustrated with the situation and the tone of<br>

	&gt; the response that I&#39;m getting.<br>

	&gt;<br>

	&gt; Let me lay this out in another fashion.<br>

	&gt;<br>

	&gt; I&#39;m a CPAN author.<br>

	&gt;<br>

	&gt; I download the latest development version of Perl, make sure I&#39;m<br>

	&gt; in a clean environment, fix the code so that it works.<br>

	&gt;<br>

	&gt; Now I&#39;m informed, not by p5p, nor anyone working on the<br>

	&gt; toolchain, but via a bug report from a tester, that there&#39;s a<br>

	&gt; special environment variable that now has to be set to pass CPAN<br>

	&gt; tests.<br>

	<br>

	<br>

	Hi. It may have been me, or one of the other 4 people I saw filing bugs, that reported this, so if it was me, I apologize for lack of clarity.</p>

<p>
	But it should stand that the reason for filing that bug was that I was taking this problem seriously, and taking it upon myself to at least inform authors in some manner that a future Perl release will, in some future, break your code in some way.</p>

<p>
	Thus, maybe it wasn&#39;t clear, but I am intending to work in some capacity as a toolchain worker :)<br>

	<br>

	Sadly, there is just too many of these problems, &gt;20% of CPAN is broken under this condition.</p>

<p>
	I&#39;ve practically spent every free minute of my life for the last 2 months ( and that is far from an exaggeration ) simply hunting down and reporting distributions that are affected, in the hope that there will be at&nbsp; least *some* indicator of this problem before it starts affecting people.</p>

<p>
	So believe me when I say &quot;This is an unprecedented situation&quot;</p>

<p>
	This is incredibly problematic and difficult, and the change, though long planned, was activated and deployed very last minute, and there&#39;s subsequently a mad rush to mitigate the fallout.<br>

	<br>

	&gt; A non-standard, poorly documented variable at that. There&#39;s<br>

	&gt; nothing in the release notes which indicates that<br>

	&gt; PERL_USE_UNSAFE_INC=0 is special, only that setting it to 1 has a<br>

	&gt; particular effect. Any reasonable person would assume that<br>

	&gt; setting it to 0 would be the same as not setting it, but that&#39;s<br>

	&gt; obviously not the case.<br>

	<br>

	Indeed, and agreed. And such documentation is planned ... but I still can&#39;t find it anywhere. Rumour has it it might land in the 5.26 release notes.</p>

<p>
	But its only existed since 5.25.10!</p>

<p>
	But the point is *not* that end users should be setting it.&nbsp;</p>

<p>
	The point is a significant and long relied upon mechanic in Perl has become broken By Design, and P5P have provided a *temporary hack* to counter-act the reality that lots of this code ( See aforementioned lack of precedent ) is broken by this change.</p>

<p>
	P5P could have opted never to produce said variable, and we&#39;d just be in the same sticky mess we&#39;re in now, but it would be more dire,&nbsp; because affected code would not only be broken for people using non-CPAN tooling like me, not just for maintainers and hand-installations, but for _everyone_ on CPAN.</p>

<p>
	And there are so many ADAMK dists&nbsp; that would be broken, its just not realistic to have no-workaround :/<br>

	<br>

	&gt; It may be fair for the testers to set that variable, but it&#39;s<br>

	&gt; blatantly *unfair* to CPAN authors not to inform them of this new<br>

	&gt; requirement. There has been no communications from p5p or the<br>

	&gt; toolchain maintainers to CPAN authors. You do have our email<br>

	&gt; addresses!<br>

	&gt;<br>

	&gt; A simple email would suffice to clear everything up. We aren&#39;t<br>

	&gt; privy to what&#39;s going on in the innards.<br>

	&gt;<br>

	&gt; Give developers clear guidance on what to do. Make it public!<br>

	&gt;<br>

	&gt; Don&#39;t make us read through the code or pore through release notes<br>

	&gt; for umpteen things to figure out why special environment<br>

	&gt; variables work or don&#39;t work.<br>

	&gt;<br>

	&gt; And please, don&#39;t tell me what the &quot;proper&quot; response as a<br>

	&gt; developer is. That&#39;s patronizing and offensive. I wouldn&#39;t have<br>

	&gt; started this conversation if I didn&#39;t already take my<br>

	&gt; ​responsibility seriously.<br>

	<br>

	In reality, there&#39;s so much confusion here, and I don&#39;t blame you really. I&#39;ve seen ex-pumpkings and many other people who could be imagined they *should* know better mess this up.</p>

<p>
	In reality, even though this variable is created ( and instituted in tooling ) as a stop-gap to protect end users from catastrophe, its very existence and the mechanisms we use to protect users act as a direct disservice to CPAN authors, because its nature and prevalence is simply that *having it set* hides *real bugs*<br>

	<br>

	Consequently, there&#39;s been a raft of &quot;I reported this dist failed&quot; and people applying fixes and releasing them ... only to find they didn&#39;t fix the issue, because their tools hid the failures from them. That&#39;s great for end users, but for maintainers, that&#39;s just giving them a false sense of security which will collapse in one way or another ( either immediately after installation, or 2 years from now )</p>

<p>
	I really wish we&#39;d found an approach that made sense where only users were protected, but authors still got the horror shows of breakage ... but . Well, nobody managed to figure out how yet.<br>

	<br>

	Yes, this is all horrible, and the nightmare is long from over for me :/</p>

<p>
	What you should do?</p>

<p>
	You want your code to work with that flag in either condition, you should assume it won&#39;t be there one day, and forcibly turn it off to simulate how it will eventually be [ or in some cases, will be outside `cpanm` and friends ]</p>

<p>
	Think of the flag as being called PERL_BE_524_COMPATIBLE=1</p>

<p>
	With the flag on in 5.25.11, you&#39;re seeing Perl how it behaves on perls before 5.25</p>

<p>
	With the flag off in 5.25.11, you&#39;re seeing how Perl is designed to work &quot;now&quot;<br>

	<br>

	End users shouldn&#39;t care about the flag, because its not really an end users job to fix CPAN modules that no longer work on newer perls, but end users have that flag as a defence because CPAN is a huge unmaintained wasteland sometimes.</p>

<p>
	Again, sorry for the lack of clarity, everything here is awful</p>

<p>
	Additionally, hopefully the draft documentation here is useful, and if not, please ask for clarification/corrections, because I&#39;d hate for our final documentation in 5.26 to also be useless.</p>

<p>
	<span class="clickylink"><a target="new" rel="nofollow" href="http://www.nntp.perl.org/group/perl.perl5.porters/2017/04/msg243878.html">http://www.nntp.perl.org/group/perl.perl5.porters/2017/04/msg243878.html</a></span></p>

<p>
	I do think this situation is significant enough that every CPAN author needs to know about it, but how do we achieve that?</p>

<p>
	We may have *your* email on file, I assume your @CPAN address works, but how do we deal with the large numbers of @CPAN addresses that now just end up bouncing?</p>

<p>
	There were numerous blogs about this on blogs.perl.org , they got referenced on reddit, its been a daily conversation on IRC. ( <span class="clickylink"><a target="new" rel="nofollow" href="http://blogs.perl.org/users/ryan_voots/2017/04/trials-and-troubles-with-changing-inc.html">http://blogs.perl.org/users/ryan_voots/2017/04/trials-and-troubles-with-changing-inc.html</a></span> )</p>

<p>
	What other channels are there to explore to ensure people who need to know know?</p>

<p>
	Would social networks help?<br>

	<br>

	--&nbsp;<br>

	- CPAN kentnl@cpan.org<br>

	- Gentoo Perl Maintainer kentnl@gentoo.org ( perl@gentoo.org )<br>

	&nbsp;</p>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;21&nbsp;13:02:28&nbsp;2017</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2017-04-21 07:16:56, DJERIUS wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; there&#39;s a special environment variable that now has to be set to pass CPAN tests.
&gt; It may be fair for the testers to set that variable, but it&#39;s
&gt; blatantly *unfair* to CPAN authors not to inform them of this new
&gt; requirement...
</div>
I think you misunderstood.  This variable is not one that is intended to be widely used.
It is a back door to &#40;temporarily!&#41; circumvent stricter requirements that are coming in 5.26.0.
This is the security issue that is being closed that is discussed at <span class="clickylink"><a target="new" rel="nofollow" href="http://blogs.perl.org/users/ryan_voots/2017/04/trials-and-troubles-with-changing-inc.html">http://blogs.perl.org/users/ryan_voots/2017/04/trials-and-troubles-with-changing-inc.html</a></span> &#40;I see you saw that thread, as
you replied to it&#41;.

Neither authors are being expected to set this variable to install their modules. It is being set temporarily in the toolchain so that not all of CPAN breaks at once when the no-dot-in-INC change rolls out.

The communication failure here is from testers &#40;automated systems, so we must forgive them for being terse&#41; to authors that there is a new failure mode that needs to be closed &#34;soon&#34;, and that there is a temporary workaround in place which results in some PASS results still coming to you.  We&#39;re sorry about that; we &#40;developers and computers alike&#41; are terrible at communicating.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;21&nbsp;13:21:58&nbsp;2017</span>
    <span class="description">KENTNL [...] cpan.org -  Cc KENTNL added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;21&nbsp;13:28:10&nbsp;2017</span>
    <span class="description">cwhitener [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Diab,

I can certainly understand being frustrated about changes. It seems like the explanations given here describe what is going on and the reasoning behind it. What appears to be the problem here is communication, so I&#39;ll take a quick stab at hopefully clearing that up.

If your dist currently relies on &#39;.&#39; being in @INC, you&#39;ll need to ensure your dist has it there by altering your Makefile.PL like ether suggested. <span class="clickylink"><a target="new" rel="nofollow" href="http://blogs.perl.org/users/ryan_voots/2017/04/trials-and-troubles-with-changing-inc.html">http://blogs.perl.org/users/ryan_voots/2017/04/trials-and-troubles-with-changing-inc.html</a></span> That blog article explains a bit about the need to remove &#39;.&#39; from @INC in general.

Having the &#39;.&#39; in @INC during the build/test phase isn&#39;t a security problem, as was described in a reply above. So, EUMM tries to be helpful and give you that so that your dist won&#39;t break if you only rely on that feature for installation. Testers can test with EUMM&#39;s helpful addition and without.

Since the testers may test both ways &#40;with EUMM injecting the &#39;.&#39; for you and without&#41; they may find issues in distributions that don&#39;t yet handle it themselves. If you inject it yourself, they won&#39;t find an issue.

That being said, the real fix for the change has to be done within each individual dist that&#39;s affected.  Ether&#39;s reply was a suggestion on how many dists can be fixed.

Apologies if the replies here seemed to be patronizing, but I really don&#39;t think that was anyone&#39;s intention. I think everyone here would be more than happy to help you find a way to update your dists to get around the changes. Maybe a few minutes with us in IRC would help as the conversation could go a bit more rapidly?

<span class="clickylink"><a target="new" rel="nofollow" href="https://chat.mibbit.com/?channel=%23perl&#38;server=irc.perl.org">https://chat.mibbit.com/?channel=%23perl&#38;server=irc.perl.org</a></span>

Again, apologies for the miscommunication as it certainly wasn&#39;t anyone&#39;s intent to be patronizing. 

Thanks,
Chase
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;21&nbsp;14:25:32&nbsp;2017</span>
    <span class="description">DBOOK [...] cpan.org -  Cc DBOOK added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
