<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #33231 for IO-Compress-Zlib: IO::Uncompress::Gunzip errors when reading from Net::FTP data socket</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #33231 for IO-Compress-Zlib: IO::Uncompress::Gunzip errors when reading from Net::FTP data socket</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/IO-Compress-Zlib/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/IO-Compress-Zlib/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/IO-Compress-Zlib/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/IO-Compress-Zlib/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/IO-Compress-Zlib">IO-Compress-Zlib CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">33231</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/IO-Compress-Zlib/Active/">IO-Compress-Zlib</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ianburrell [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-38616-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.008    </td>
  </tr>
  <tr id="CF-38617-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
2.009    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;13&nbsp;15:35:57&nbsp;2008</span>
    <span class="description">ianburrell [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> IO::Uncompress::Gunzip errors when reading from Net::FTP data socket</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">We are getting errors when using an IO::Uncompress::Gunzip object that
is reading from an FTP data connection socket.

    my $in_fh = $ftp-&gt;retr&#40;$filename&#41;;
    my $gz = IO::Uncompress::Gunzip-&gt;new&#40;$in_fh&#41;;
    print $out_fh $buffer while $gz-&gt;read&#40;$buffer, 1000&#41; &gt; 0;

Timeout at /dp/usr/imb/perl/lib/IO/Uncompress/Base.pm line 67

When using Compress::Zlib, we get &#34;data error&#34; errors when doing gzread.

We didn&#39;t have any trouble reading directly from the socket with
Compress::Zlib 1.x.

    my $gz = gzopen&#40;$in_fh, &#39;rb&#39;&#41; or die &#34;Can&#39;t gzopen: $gzerrno&#34;;
    my $buffer;
    while &#40;my $size = $gz-&gt;gzread&#40;$buffer&#41;&#41; {
        die &#34;Read error: $gzerrno\n&#34; if $size &lt; 0;
        print $out_fh $buffer;
    }

This is on RHEL 4, with locally-built Perl 5.8.8, and Net::FTP 2.75.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;14&nbsp;04:27:30&nbsp;2008</span>
    <span class="description">pmqs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Feb 13 15:35:57 2008, ianburrell@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; We are getting errors when using an IO::Uncompress::Gunzip object that
&gt; is reading from an FTP data connection socket.
&gt; 
&gt;     my $in_fh = $ftp-&gt;retr&#40;$filename&#41;;
&gt;     my $gz = IO::Uncompress::Gunzip-&gt;new&#40;$in_fh&#41;;
&gt;     print $out_fh $buffer while $gz-&gt;read&#40;$buffer, 1000&#41; &gt; 0;
&gt; 
&gt; Timeout at /dp/usr/imb/perl/lib/IO/Uncompress/Base.pm line 67
&gt; 
&gt; When using Compress::Zlib, we get &#34;data error&#34; errors when doing gzread.
&gt; 
&gt; We didn&#39;t have any trouble reading directly from the socket with
&gt; Compress::Zlib 1.x.
&gt; 
&gt;     my $gz = gzopen&#40;$in_fh, &#39;rb&#39;&#41; or die &#34;Can&#39;t gzopen: $gzerrno&#34;;
&gt;     my $buffer;
&gt;     while &#40;my $size = $gz-&gt;gzread&#40;$buffer&#41;&#41; {
&gt;         die &#34;Read error: $gzerrno\n&#34; if $size &lt; 0;
&gt;         print $out_fh $buffer;
&gt;     }
&gt; 
&gt; This is on RHEL 4, with locally-built Perl 5.8.8, and Net::FTP 2.75.
&gt; 
&gt; 
</div>

Hi Ian,

do you have problems with all the gzip files you access from the ftp
server, or just some?

any chance you could send me one of the gzip files that is causing you
problems?

Paul
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;14&nbsp;04:27:32&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;14&nbsp;14:56:54&nbsp;2008</span>
    <span class="description">ianburrell [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33231] IO::Uncompress::Gunzip errors when reading from Net::FTP data socket</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 14 Feb 2008 11:56:19 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-IO-Compress-Zlib [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Ian Burrell&#34; &lt;ianburrell [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Feb 14, 2008 at 1:27 AM, Paul Marquess via RT
&lt;bug-IO-Compress-Zlib@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;  do you have problems with all the gzip files you access from the ftp
&gt;  server, or just some?
&gt;
&gt;  any chance you could send me one of the gzip files that is causing you
&gt;  problems?
&gt;
</div>
It seems to happen with every .gz file.  The problem only happens with
Net::FTP.  We worked around the problem by downloading to a temp file
and reading from that.  Normal pipes and sockets work fine.

I think I found the problem and I think the bug is in Net::FTP.  The
Net::FTP:I::read method has the parameters
read&#40;$buf,$size,[$timeout]&#41;.  The standard handle read method is
read&#40;$buf, $size, $offset&#41;.  IO::Uncompress::Base::smartRead passes 0
for the $offset.  But Net::FTP::I interprets that as 0 timeout which
causes a &#34;Timeout&#34; error whenever there is no data immediately
available for reading.

The reason that old version of Compress::Zlib worked is that it read
directly from the socket and bypassed the read method.

I&#39;ll enter a bug for Net::FTP.

 - Ian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;14&nbsp;15:24:35&nbsp;2008</span>
    <span class="description">ianburrell [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33231] IO::Uncompress::Gunzip errors when reading from Net::FTP data socket</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 14 Feb 2008 12:22:21 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-IO-Compress-Zlib [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Ian Burrell&#34; &lt;ianburrell [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I entered #33268 for Net::FTP about the discrepancy in the read arguments.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;14&nbsp;16:02:59&nbsp;2008</span>
    <span class="description">pmqs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Feb 14 14:56:54 2008, ianburrell@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu, Feb 14, 2008 at 1:27 AM, Paul Marquess via RT
&gt; &lt;bug-IO-Compress-Zlib@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt; &gt;
&gt; &gt;  do you have problems with all the gzip files you access from the ftp
&gt; &gt;  server, or just some?
&gt; &gt;
&gt; &gt;  any chance you could send me one of the gzip files that is causing you
&gt; &gt;  problems?
&gt; &gt;
</div>&gt; 
&gt; It seems to happen with every .gz file.  The problem only happens with
&gt; Net::FTP.  We worked around the problem by downloading to a temp file
&gt; and reading from that.  Normal pipes and sockets work fine.
&gt; 
&gt; I think I found the problem and I think the bug is in Net::FTP.  The
&gt; Net::FTP:I::read method has the parameters
&gt; read&#40;$buf,$size,[$timeout]&#41;.  The standard handle read method is
&gt; read&#40;$buf, $size, $offset&#41;.  IO::Uncompress::Base::smartRead passes 0
&gt; for the $offset.  But Net::FTP::I interprets that as 0 timeout which
&gt; causes a &#34;Timeout&#34; error whenever there is no data immediately
&gt; available for reading.
&gt; 
&gt; The reason that old version of Compress::Zlib worked is that it read
&gt; directly from the socket and bypassed the read method.
</div>
Yep, just got round to trying it out myself. That exactly what the
problem is.

I&#39;ve attached a tentative patch for lib/IO/Uncompress/Base.pm that
should sort it. I need to do some more testing before I release it into
the wild.

Give me a shout if it doesn&#39;t work for you.

Paul
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"></div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;14&nbsp;17:18:15&nbsp;2008</span>
    <span class="description">ianburrell [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33231] IO::Uncompress::Gunzip errors when reading from Net::FTP data socket</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 14 Feb 2008 14:18:03 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-IO-Compress-Zlib [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Ian Burrell&#34; &lt;ianburrell [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Feb 14, 2008 at 1:03 PM, Paul Marquess via RT
&lt;bug-IO-Compress-Zlib@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;  &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=33231">http://rt.cpan.org/Ticket/Display.html?id=33231</a></span> &gt;
&gt;
&gt;
&gt;  Yep, just got round to trying it out myself. That exactly what the
&gt;  problem is.
&gt;
&gt;  I&#39;ve attached a tentative patch for lib/IO/Uncompress/Base.pm that
&gt;  should sort it. I need to do some more testing before I release it into
&gt;  the wild.
&gt;
</div>
I don&#39;t see an attachment, either on the email or in RT.  It probably
got eaten by RT.

 - Ian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;14&nbsp;17:47:32&nbsp;2008</span>
    <span class="description">pmqs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Feb 14 17:18:15 2008, ianburrell@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu, Feb 14, 2008 at 1:03 PM, Paul Marquess via RT
&gt; &lt;bug-IO-Compress-Zlib@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt; &gt;
&gt; &gt;  &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=33231">http://rt.cpan.org/Ticket/Display.html?id=33231</a></span> &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt;  Yep, just got round to trying it out myself. That exactly what the
&gt; &gt;  problem is.
&gt; &gt;
&gt; &gt;  I&#39;ve attached a tentative patch for lib/IO/Uncompress/Base.pm that
&gt; &gt;  should sort it. I need to do some more testing before I release it into
&gt; &gt;  the wild.
&gt; &gt;
</div>&gt; 
&gt; I don&#39;t see an attachment, either on the email or in RT.  It probably
&gt; got eaten by RT.
</div>

Hmmm, so it isn&#39;t. Let see if it works this time.

Paul
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">*** IO_Compress_Base/lib/IO/Uncompress/Base.pm	2007-11-12 10:44:47.000000000 +0000
--- IO-Base/lib/IO/Uncompress/Base.pm	2008-02-14 17:59:46.000000000 +0000
***************
*** 63,70 ****
      #    $get_size = min&#40;$get_size, *$self-&gt;{InputLengthRemaining}&#41;;
      #}
  
!     if &#40;defined *$self-&gt;{FH}&#41;
!       { *$self-&gt;{FH}-&gt;read&#40;$$out, $get_size, $offset&#41; }
      elsif &#40;defined *$self-&gt;{InputEvent}&#41; {
          my $got = 1 ;
          while &#40;length $$out &lt; $size&#41; {
--- 63,78 ----
      #    $get_size = min&#40;$get_size, *$self-&gt;{InputLengthRemaining}&#41;;
      #}
  
!     if &#40;defined *$self-&gt;{FH}&#41; {
!         if &#40;$offset&#41; {
!             #*$self-&gt;{FH}-&gt;read&#40;$$out, $get_size, $offset&#41;;
!             my $tmp;
!             *$self-&gt;{FH}-&gt;read&#40;$tmp, $get_size&#41;;
!             substr&#40;$$out, $offset&#41; = $tmp;
!         }
!         else
!           { *$self-&gt;{FH}-&gt;read&#40;$$out, $get_size&#41; }
!     }
      elsif &#40;defined *$self-&gt;{InputEvent}&#41; {
          my $got = 1 ;
          while &#40;length $$out &lt; $size&#41; {
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;14&nbsp;19:04:40&nbsp;2008</span>
    <span class="description">ianburrell [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33231] IO::Uncompress::Gunzip errors when reading from Net::FTP data socket</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 14 Feb 2008 16:04:18 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-IO-Compress-Zlib [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Ian Burrell&#34; &lt;ianburrell [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Feb 14, 2008 at 2:47 PM, Paul Marquess via RT
&lt;bug-IO-Compress-Zlib@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;  &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=33231">http://rt.cpan.org/Ticket/Display.html?id=33231</a></span> &gt;
&gt;
&gt;
&gt;  Hmmm, so it isn&#39;t. Let see if it works this time.
&gt;
</div>
The patch is there and fixes the problem.

BTW, substr throws an error if the offset is beyond the end of the
string instead of extending it.  This block of code will pad the
buffer with NULLs, like is described in the read perlfunc description:

      if &#40;length&#40;$buf&#41; &lt; $offset&#41; {
          $buf .= &#40;&#39;\0&#39; x &#40;$offset + 1 - length&#40;$buf&#41;&#41;&#41;;
      }

I added a patch to the Net::FTP bug which fixes it on their end but
we&#39;ll see how willing they are to change the interface and break
backwards compatibility to improve compatibility with other modules.

 - Ian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;15&nbsp;09:06:55&nbsp;2008</span>
    <span class="description">pmqs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Feb 14 19:04:40 2008, ianburrell@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu, Feb 14, 2008 at 2:47 PM, Paul Marquess via RT
&gt; &lt;bug-IO-Compress-Zlib@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt; &gt;
&gt; &gt;  &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=33231">http://rt.cpan.org/Ticket/Display.html?id=33231</a></span> &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt;  Hmmm, so it isn&#39;t. Let see if it works this time.
&gt; &gt;
</div>&gt; 
&gt; The patch is there and fixes the problem.
</div>
Good.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; BTW, substr throws an error if the offset is beyond the end of the
&gt; string instead of extending it.  This block of code will pad the
&gt; buffer with NULLs, like is described in the read perlfunc description:
&gt; 
&gt;       if &#40;length&#40;$buf&#41; &lt; $offset&#41; {
&gt;           $buf .= &#40;&#39;\0&#39; x &#40;$offset + 1 - length&#40;$buf&#41;&#41;&#41;;
&gt;       }
</div>
Thanks. I&#39;ll check that out when I find the time to carry out some
rigorous testing.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I added a patch to the Net::FTP bug which fixes it on their end but
&gt; we&#39;ll see how willing they are to change the interface and break
&gt; backwards compatibility to improve compatibility with other modules.
</div>
As I&#39;ve noted in the bug you raised against Net::FTP, I&#39;m agree with
Graham that it&#39;s too late to mess with Net::FTP.

cheers
Paul
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;05&nbsp;15:58:50&nbsp;2008</span>
    <span class="description">pmqs [...] cpan.org -  Fixed in 2.009 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;05&nbsp;15:58:52&nbsp;2008</span>
    <span class="description">pmqs [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
