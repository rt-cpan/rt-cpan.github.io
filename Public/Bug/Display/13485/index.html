<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #13485 for Net-SNMP: Corrupt messages with tainted variables</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #13485 for Net-SNMP: Corrupt messages with tainted variables</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Net-SNMP">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Net-SNMP">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Net-SNMP">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Net-SNMP">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-SNMP">Net-SNMP CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">13485</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">25 min

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Net-SNMP">Net-SNMP</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">dtown [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
g.vetterlein [...] ntl.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-23238-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
4.1.2    </td>
  </tr>
  <tr id="CF-23239-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
5.0.0    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=13485">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135433" href="/Public/Bug/Display.html?id=13485#txn-135433">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;30&nbsp;12:43:04&nbsp;2005</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Corrupt messages with tainted variables</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/135433/36785/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/36785">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 565b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve just stumbled across a problem whereby if TAINTED variables
is used in a varbind value, then the SNMP message appears to be
corrupt &#40;snmptrad cannot format&#41;. I run tests with a tainted variable, then
overwriting it&#39;s value with a constant &#40;untainted&#41;. The debug from Net::
SNMP show different hex messages and snmptrapd shows same diff
AND fails to format the tainted version but works fine with untainted.

I&#39;ve searched docs and bugs for reference to taint. If this is a new
default, I will collect detailed info and submit. Please advise if this is
unknown.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135434" href="/Public/Bug/Display.html?id=13485#txn-135434">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;30&nbsp;13:16:03&nbsp;2005</span>
    <span class="description">dtown [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">5 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/135434/36792/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/36792">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 976b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[guest - Thu Jun 30 12:43:04 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve just stumbled across a problem whereby if TAINTED variables
&gt; is used in a varbind value, then the SNMP message appears to be
&gt; corrupt &#40;snmptrad cannot format&#41;. I run tests with a tainted variable,
&gt;    then
&gt; overwriting it&#39;s value with a constant &#40;untainted&#41;. The debug from
&gt;    Net::
&gt; SNMP show different hex messages and snmptrapd shows same diff
&gt; AND fails to format the tainted version but works fine with untainted.
&gt; 
&gt; I&#39;ve searched docs and bugs for reference to taint. If this is a new
&gt; default, I will collect detailed info and submit. Please advise if
&gt;    this is
&gt; unknown.
</div>
Can you provide an example of what you are seeing?  The distribution
comes with a &#34;snmpset.pl&#34; script which takes command line arguments to
populate the varBindList.  Command line arguments are considered
&#34;tainted&#34; by Perl.  I have not seen problems with this in the past. 

What version of Perl and Net::SNMP are you using?

-David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Give odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135435" href="/Public/Bug/Display.html?id=13485#txn-135435">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;30&nbsp;13:16:04&nbsp;2005</span>
    <span class="description">dtown [...] cpan.org -  Given to DTOWN</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135436" href="/Public/Bug/Display.html?id=13485#txn-135436">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;01&nbsp;04:45:40&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Graeme V</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/135436/36813/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/36813">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 789b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Can you provide an example of what you are seeing?  The distribution
&gt; comes with a &#34;snmpset.pl&#34; script which takes command line arguments to
&gt; populate the varBindList.  Command line arguments are considered
&gt; &#34;tainted&#34; by Perl.  I have not seen problems with this in the past.
</div>...elided..
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; -David
</div>
OK thanks David, this does not sound like a &#39;well known problem&#39; , 
I&#39;ll try to produce a minimal working+failing version with logs. If I
don&#39;t manage it in the next couple of days, It&#39;ll be a couple of weeks
before I can get near a computer :-&#40;  .. I had two other developers sit
with me and go line by line through the code, we ended up with things
like if &#40;$st eq 200&#41; {print &#34;value IS 200\n&#34;;} because we stopped
trusting our eyes :-&#41;. The upside was, it was VERY repeatable.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135437" href="/Public/Bug/Display.html?id=13485#txn-135437">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;11&nbsp;13:50:08&nbsp;2005</span>
    <span class="description">dtown [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135438" href="/Public/Bug/Display.html?id=13485#txn-135438">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;11&nbsp;13:50:08&nbsp;2005</span>
    <span class="description">dtown [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">5 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/135438/37329/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/37329">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 955b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[guest - Fri Jul  1 04:45:40 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; OK thanks David, this does not sound like a &#39;well known problem&#39; , 
&gt; I&#39;ll try to produce a minimal working+failing version with logs. If I
&gt; don&#39;t manage it in the next couple of days, It&#39;ll be a couple of weeks
&gt; before I can get near a computer :-&#40;  .. I had two other developers sit
&gt; with me and go line by line through the code, we ended up with things
&gt; like if &#40;$st eq 200&#41; {print &#34;value IS 200\n&#34;;} because we stopped
&gt; trusting our eyes :-&#41;. The upside was, it was VERY repeatable.
&gt; 
&gt; 
</div>
Are you sure that the problem is really tainted variables?  Where are
the values that you are placing into the varBindList coming from?  Are
they being read from some sort of database?  An issue was reported in
the past where values read from an Oracle database were being flagged as
UTF8 &#40;Unicode&#41; characters.  When displayed, they appeared correctly, but
when encoded they included the extended bytes.

-David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135440" href="/Public/Bug/Display.html?id=13485#txn-135440">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;01&nbsp;11:09:31&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Graeme vetterlein</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/135440/38263/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/38263">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Are you sure that the problem is really tainted variables?  Where are
&gt; the values that you are placing into the varBindList coming from?  
</div>
I just tried to create a cut-down example by getting &#39;tainted&#39; values 
from LWP &#40;the retuned content from a request&#41; ... this is similar to my 
real case, however it DID NOT exhibit the problem.  To be sure that has 
not gone away I reran various cut down versions of the original code.

The orginal code sends XML requests &#40;via HTTP&#41; the uses the XML parsing
modules to extract status&#38;codes. The number in question is a code 
comming back via that route.

The change &#40;in original code&#41; I make in the &#39;client&#39; is:

Original:
        $pairs{$tagname} = $text;


With untainting &#40;at least that whit I intended it to do :-&#41;
        $text =~ /&#40;.*&#41;/;
        $pairs{$tagname} = $1;

The &#39;untainted version&#39; produces reasonable looking output from 
snmptrapd&#40;1&#41;  run as snmptrapd -d -f -P -DALL. 

The &#39;tainted version&#39;
produces just the hex dump &#40;no formatted version&#41; AND a message &#40;from 
debug?&#41; saying sess_process_packet: &#39;parse fail&#39;

... I&#39;m still trying to produce a cut-down version, but it&#39;s proving 
more difficult than I expected
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135441" href="/Public/Bug/Display.html?id=13485#txn-135441">#</a>      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;02&nbsp;04:17:41&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Graeme vetterlein</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/135441/38308/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/38308">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Are you sure that the problem is really tainted variables?  Where are
&gt; the values that you are placing into the varBindList coming from?  
</div>
I just tried to create a cut-down example by getting &#39;tainted&#39; values 
from LWP &#40;the retuned content from a request&#41; ... this is similar to my 
real case, however it DID NOT exhibit the problem.  To be sure that has 
not gone away I reran various cut down versions of the original code.

The orginal code sends XML requests &#40;via HTTP&#41; the uses the XML parsing
modules to extract status&#38;codes. The number in question is a code 
comming back via that route.

The change &#40;in original code&#41; I make in the &#39;client&#39; is:

Original:
        $pairs{$tagname} = $text;


With untainting &#40;at least that whit I intended it to do :-&#41;
        $text =~ /&#40;.*&#41;/;
        $pairs{$tagname} = $1;

The &#39;untainted version&#39; produces reasonable looking output from 
snmptrapd&#40;1&#41;  run as snmptrapd -d -f -P -DALL. 

The &#39;tainted version&#39;
produces just the hex dump &#40;no formatted version&#41; AND a message &#40;from 
debug?&#41; saying sess_process_packet: &#39;parse fail&#39;

... I&#39;m still trying to produce a cut-down version, but it&#39;s proving 
more difficult than I expected
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135442" href="/Public/Bug/Display.html?id=13485#txn-135442">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;03&nbsp;15:25:39&nbsp;2005</span>
    <span class="description">dtown [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">10 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/135442/38400/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/38400">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">You never replied with the version of Perl and Net::SNMP.  But from what
I can reproduce, you are probably running Perl 5.6.1 and Net::SNMP prior
to 5.0.0.  

The handling of UFT8 strings in Perl 5.6.1 was not really ready for
prime time.  A prepend call to substr&#40;&#41; in Perl 5.6.1 with a UFT8 string
 would result in &#34;garbage&#34; being added to the string.  When the
Net::SNMP module builds a packet it uses prepend calls to substr&#40;&#41;.

The &#34;untainting&#34; example you provided actually &#34;changes&#34; the string from
a UFT8 string to a regular string &#40;in 5.6.1&#41;.  You can also add the line
&#34;use bytes;&#34; to your script which tells Perl to treat all strings as
plain ASCII characters.  This line was added to Net::SNMP in v5.0.0.

-David 


[guest - Tue Aug  2 04:17:41 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; Are you sure that the problem is really tainted variables?  Where are
&gt; &gt; the values that you are placing into the varBindList coming from?  
</div>&gt; 
&gt; I just tried to create a cut-down example by getting &#39;tainted&#39; values 
&gt; from LWP &#40;the retuned content from a request&#41; ... this is similar to my 
&gt; real case, however it DID NOT exhibit the problem.  To be sure that has 
&gt; not gone away I reran various cut down versions of the original code.
&gt; 
&gt; The orginal code sends XML requests &#40;via HTTP&#41; the uses the XML parsing
&gt; modules to extract status&#38;codes. The number in question is a code 
&gt; comming back via that route.
&gt; 
&gt; The change &#40;in original code&#41; I make in the &#39;client&#39; is:
&gt; 
&gt; Original:
&gt;         $pairs{$tagname} = $text;
&gt; 
&gt; 
&gt; With untainting &#40;at least that whit I intended it to do :-&#41;
&gt;         $text =~ /&#40;.*&#41;/;
&gt;       $pairs{$tagname} = $1;
&gt; 
&gt; The &#39;untainted version&#39; produces reasonable looking output from 
&gt; snmptrapd&#40;1&#41;  run as snmptrapd -d -f -P -DALL. 
&gt; 
&gt; The &#39;tainted version&#39;
&gt; produces just the hex dump &#40;no formatted version&#41; AND a message &#40;from 
&gt; debug?&#41; saying sess_process_packet: &#39;parse fail&#39;
&gt; 
&gt; ... I&#39;m still trying to produce a cut-down version, but it&#39;s proving 
&gt; more difficult than I expected
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135443" href="/Public/Bug/Display.html?id=13485#txn-135443">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;03&nbsp;15:25:40&nbsp;2005</span>
    <span class="description">dtown [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135444" href="/Public/Bug/Display.html?id=13485#txn-135444">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;04&nbsp;08:52:24&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/135444/38422/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/38422">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[DTOWN - Wed Aug  3 15:25:39 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; You never replied with the version of Perl and Net::SNMP.  But from 
</div>what
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I can reproduce, you are probably running Perl 5.6.1 and Net::SNMP 
</div>prior
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; to 5.0.0.  
</div>
Sorry about that. While I thought this was a new problem, rather than 
something well-known, I was planning to produce a cut-down test case 
with all the details of environment etc. However, I suspect you&#39;re 
correct about the UTF-8 :-&#41; ... To that end, here are the versions:

 /data/perl/bin/perl -v

This is perl, v5.6.1 built for sun4-solaris

Copyright 1987-2001, Larry Wall

....

# -*- mode: perl -*-
# 
========================================================================
====

package Net::SNMP;

# $Id: SNMP.pm,v 4.8 2003/09/11 19:14:42 dtown Exp $

# Copyright &#40;c&#41; 1998-2003 David M. Town &lt;dtown@cpan.org&gt;
# All rights reserved.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The handling of UFT8 strings in Perl 5.6.1 was not really ready for
&gt; prime time.  A prepend call to substr&#40;&#41; in Perl 5.6.1 with a UFT8 
</div>string
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  would result in &#34;garbage&#34; being added to the string.  When the
&gt; Net::SNMP module builds a packet it uses prepend calls to substr&#40;&#41;.
</div>
I was not aware that any of the data I was getting was UTF-8 &#40;I am 
now!&#41;. The XML
requests I&#39;m generating are going to a new &#39;Box&#39; and there is scant 
little documentation about the return codes etc ... mind you, had they 
said it was UTF-8, I might well have missed it :-&#41; !

 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The &#34;untainting&#34; example you provided actually &#34;changes&#34; the string 
</div>from
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; a UFT8 string to a regular string &#40;in 5.6.1&#41;. 
</div>
Ahh! ... as a matter of interest, how could I have found that out 
&#40;without you telling me&#41;? ... I guess this is new &#39;side-effect&#39; &#40;in 
X3J11 sense&#41; of RE that started happening with utf-8 support?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; You can also add the line
&gt; &#34;use bytes;&#34; to your script which tells Perl to treat all strings as
&gt; plain ASCII characters.  This line was added to Net::SNMP in v5.0.0.
</div>
Will that help? The XML service IS &#40;I now realise&#41; sending me UTF-8
codes. Now in this example it is in the &#39;ASCII range&#39; but they also
send textual error messages, which I guess might include some those new 
new &#40;horrrible&#41; quotes. I did also consider using UTF8STRING on varbinds
but I guess from what you&#39;re saying that won&#39;t help.

I guess I need to CONVERT from UTF-8 to say 8859-1. This is sorta what
you&#39;re saying the &#39;untainting&#39; bit does ... so what would happen if that
untainting code met a non-ascii char?

.

Thanks for all you help with, especially as it turns out to be my
screw-up :-&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135445" href="/Public/Bug/Display.html?id=13485#txn-135445">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;04&nbsp;08:52:25&nbsp;2005</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135446" href="/Public/Bug/Display.html?id=13485#txn-135446">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;04&nbsp;13:51:57&nbsp;2005</span>
    <span class="description">dtown [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">5 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/135446/38430/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/38430">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[guest - Thu Aug  4 08:52:24 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; The &#34;untainting&#34; example you provided actually &#34;changes&#34; the string 
</div>&gt; from
<div class="message-stanza open">&gt; &gt; a UFT8 string to a regular string &#40;in 5.6.1&#41;. 
</div>&gt; 
&gt; Ahh! ... as a matter of interest, how could I have found that out 
&gt; &#40;without you telling me&#41;? ... I guess this is new &#39;side-effect&#39; &#40;in 
&gt; X3J11 sense&#41; of RE that started happening with utf-8 support?
</div>
I had to use the module &#34;Devel::Peek&#34; and call the function Dump&#40;&#41; on
the variable in question.  The handling of UNICODE is supposed to be
transparent, so there is no easy way to determine this information.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; You can also add the line
&gt; &gt; &#34;use bytes;&#34; to your script which tells Perl to treat all strings as
&gt; &gt; plain ASCII characters.  This line was added to Net::SNMP in v5.0.0.
</div>&gt; 
&gt; Will that help? The XML service IS &#40;I now realise&#41; sending me UTF-8
&gt; codes. Now in this example it is in the &#39;ASCII range&#39; but they also
&gt; send textual error messages, which I guess might include some those new 
&gt; new &#40;horrrible&#41; quotes.
</div>
What is most likely happening is that the variables populated by the XML
library contained only ASCII character, but the variable is being flag
as UFT8.  The substr&#40;&#41; function in 5.6.1 does not handle variables
flagged as UFT8 properly. 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I did also consider using UTF8STRING on varbinds
&gt; but I guess from what you&#39;re saying that won&#39;t help.
&gt; 
&gt; I guess I need to CONVERT from UTF-8 to say 8859-1. This is sorta what
&gt; you&#39;re saying the &#39;untainting&#39; bit does ... so what would happen if that
&gt; untainting code met a non-ascii char?
&gt; 
&gt; .
</div>
Your best bet is to use Net::SNMP v5.1.0 and at least Perl 5.8.0. 
Putting &#34;use bytes;&#34; in your script will remove any UFT8 characters. 
The &#34;use bytes;&#34; in the Net::SNMP module will take any UFT8 variable and
transmit as UFT8 encoded bytes.

-David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135447" href="/Public/Bug/Display.html?id=13485#txn-135447">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;04&nbsp;13:51:58&nbsp;2005</span>
    <span class="description">dtown [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135448" href="/Public/Bug/Display.html?id=13485#txn-135448">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;04&nbsp;13:53:38&nbsp;2005</span>
    <span class="description">dtown [...] cpan.org -  Fixed in 5.0.0 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-135449" href="/Public/Bug/Display.html?id=13485#txn-135449">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;04&nbsp;13:53:38&nbsp;2005</span>
    <span class="description">dtown [...] cpan.org -  Broken in 4.1.2 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.312484</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
