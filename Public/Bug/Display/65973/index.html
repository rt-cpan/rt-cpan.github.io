<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #65973 for Term-ReadLine-Gnu: Broken with Readline 6.2 &#40; Missing Symbol xmalloc &#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #65973 for Term-ReadLine-Gnu: Broken with Readline 6.2 &#40; Missing Symbol xmalloc &#41;</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Term-ReadLine-Gnu">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Term-ReadLine-Gnu">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Term-ReadLine-Gnu">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Term-ReadLine-Gnu">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Term-ReadLine-Gnu">Term-ReadLine-Gnu CPAN distribution</a>.</p>


<h3>Maintainer&#40;s&#41;&#39; notes</h3>

<p>When you report a bug, please provide the following information;

<pre>
- output of
	perl -V
	perl Makefile.PL verbose
	make test TEST_VERBOSE=1
	perl -Mblib t/00checkver.t
	echo $TERM
- terminal emulator which you are using
- compiler which is used to compile the GNU Readline Library (libreadline.a) if you can know.
</pre>

Read <a href="http://search.cpan.org/src/HAYASHI/Term-ReadLine-Gnu-1.23/INSTALL">INSTALL</a> in the distribution for more details.
</p>



<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">65973</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Term-ReadLine-Gnu">Term-ReadLine-Gnu</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
KENTNL [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-31188-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.20    </td>
  </tr>
  <tr id="CF-31189-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Term-ReadLine-Gnu-1.20-xmalloc.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1280583/678627/Term-ReadLine-Gnu-1.20-xmalloc.patch">
Tue Oct 29 05:02:14 2013 (2.8k) by MAUKE [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=65973">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-900590" href="/Public/Bug/Display.html?id=65973#txn-900590">#</a>      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;20&nbsp;21:46:02&nbsp;2011</span>
    <span class="description">KENTNL [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Broken with Readline 6.2 &#40; Missing Symbol xmalloc &#41;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/900590/467039/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/467039">with headers</a>
<br />
<span class="downloadcontenttype">text/html 233b</span>
</div>
<div class="messagebody">
<div class="message-stanza">/usr/bin/perl: symbol lookup error: /usr/lib64/perl5/vendor_perl/5.12.3/x86_64-linux-thread-multi/auto/Term/ReadLine/Gnu/Gnu.so: undefined symbol: xmalloc<br>

<br>

<span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.gentoo.org/show_bug.cgi?id=355145">http://bugs.gentoo.org/show_bug.cgi?id=355145</a></span><br>

<br>

<br>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-900935" href="/Public/Bug/Display.html?id=65973#txn-900935">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;21&nbsp;10:42:45&nbsp;2011</span>
    <span class="description">HAYASHI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/900935/467230/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/467230">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 477b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2011-2月-20 日 21:46:02, KENTNL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; /usr/bin/perl: symbol lookup error:
&gt; /usr/lib64/perl5/vendor_perl/5.12.3/x86_64-linux-thread-
&gt; multi/auto/Term/ReadLine/Gnu/Gnu.so:
&gt; undefined symbol: xmalloc
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.gentoo.org/show_bug.cgi?id=355145">http://bugs.gentoo.org/show_bug.cgi?id=355145</a></span>
</div>
Check if your libreadline.a is broken or not first.
You can use some sample files in GNU Readline Library distribution.

Then send me the information written in INSTALL file in the
Term::ReadLine::Gnu distribution.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-900937" href="/Public/Bug/Display.html?id=65973#txn-900937">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;21&nbsp;10:42:46&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-900938" href="/Public/Bug/Display.html?id=65973#txn-900938">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;21&nbsp;10:42:46&nbsp;2011</span>
    <span class="description">HAYASHI [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-900999" href="/Public/Bug/Display.html?id=65973#txn-900999">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;21&nbsp;12:34:30&nbsp;2011</span>
    <span class="description">KENTNL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/900999/467266/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/467266">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza">Thanks for the reasonably prompt response. <br>

<br>

More research has been done, and it appears this is due to a change in something we do in Gentoo, but, based on what it is and why it is, this is a &quot;heads up&quot; because it looks like its an indicator of future changes from Upstream.<br>

<br>

Gentoo are doing this on readline now:&nbsp;<br>

<br>

CPPFLAGS+=&quot;&nbsp;-Dxrealloc=_rl_realloc -Dxmalloc=_rl_malloc -Dxfree=_rl_free &quot;<br>

<br>

And this is a workaround for this bug:&nbsp;<br>

<br>

<span class="clickylink"><a target="new" rel="nofollow" href="http://lists.gnu.org/archive/html/bug-readline/2010-07/msg00013.html">http://lists.gnu.org/archive/html/bug-readline/2010-07/msg00013.html</a></span><br>

<br>

Even if upstream don't do it, I&nbsp;hope this bug report can serve as a possible heads-up to other distribution maintainers if they try doing the same thing. <br>

<br>

If Term-ReadLine-Gnu do not wish to / are unable to solve this problem as well on their end (&nbsp;I&nbsp;don't think they are at this stage&nbsp;), then a work-around that downstream distributions can perform is trying to stuff this variable into make:<br>

<br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; PASTHRU_DEFINE = -Dxrealloc=_rl_realloc -Dxmalloc=_rl_malloc -Dxfree=_rl_free<br>

<br>

Or something similar.<br>

<br>

hope that helps =)<br>

<br>

<br>

<br>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-901002" href="/Public/Bug/Display.html?id=65973#txn-901002">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;21&nbsp;12:34:31&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1114944" href="/Public/Bug/Display.html?id=65973#txn-1114944">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;31&nbsp;06:55:52&nbsp;2012</span>
    <span class="description">vitaliy.tokarev [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> vitaliy.tokarev [...] gmail.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1114944/586571/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/586571">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 374b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Feb 21 12:34:30 2011, KENTNL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Gentoo are doing this on readline now:
&gt; 
&gt; CPPFLAGS+=&#34; -Dxrealloc=_rl_realloc -Dxmalloc=_rl_malloc
&gt; -Dxfree=_rl_free &#34;
</div>
Thanks for solution!

Easy way in cpan console type:

o conf makepl_arg &#39;CCFLAGS=&#34; -Dxrealloc=_rl_realloc -
Dxmalloc=_rl_malloc -Dxfree=_rl_free &#34;&#39;

test Term::ReadLine::Gnu

or 

install Term::ReadLine::Gnu
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1280583" href="/Public/Bug/Display.html?id=65973#txn-1280583">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;29&nbsp;05:02:14&nbsp;2013</span>
    <span class="description">MAUKE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1280583/678626/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/678626">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 457b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Feb 20 21:46:02 2011, KENTNL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; /usr/bin/perl: symbol lookup error:
&gt; /usr/lib64/perl5/vendor_perl/5.12.3/x86_64-linux-thread-
&gt; multi/auto/Term/ReadLine/Gnu/Gnu.so:
&gt; undefined symbol: xmalloc
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.gentoo.org/show_bug.cgi?id=355145">http://bugs.gentoo.org/show_bug.cgi?id=355145</a></span>
</div>
I have attached a patch to Term-ReadLine-Gnu Makefile.PL.

With this patch I was able to compile and test Term::ReadLine::Gnu successfully on Gentoo Linux.

Could this be included in version 1.21?
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Term-ReadLine-Gnu-1.20-xmalloc.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1280583/678627/Term-ReadLine-Gnu-1.20-xmalloc.patch">Download Term-ReadLine-Gnu-1.20-xmalloc.patch</a><br />
<span class="downloadcontenttype">text/x-diff 2.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -ru Term-ReadLine-Gnu-1.20/Makefile.PL Term-ReadLine-Gnu-1.20-hax/Makefile.PL
--- Term-ReadLine-Gnu-1.20/Makefile.PL	2010-05-02 12:37:55.000000000 +0200
+++ Term-ReadLine-Gnu-1.20-hax/Makefile.PL	2013-10-29 09:55:08.000000000 +0100
@@ -90,6 +90,11 @@
     }
 }
 
+# Check whether xmalloc has been renamed to _rl_malloc &#40;Gentoo Linux&#41;
+if &#40;my $extra_defs = guess_malloc_names&#40;$RLINC, $RLLIB, $defs, $lddflags, $libs&#41;&#41; {
+    $defs .= &#34; $extra_defs&#34;;
+}
+
 # generate a Makefile
 WriteMakefile
     &#40;
@@ -105,7 +110,7 @@
       &#41; : &#40;&#41; &#41;,
      INC	  =&gt; $RLINC,
      dist	  =&gt; { COMPRESS =&gt; &#39;gzip -9f&#39;, SUFFIX =&gt; &#39;gz&#39; },
-     clean	  =&gt; { FILES =&gt; &#34;rlver.c rlver$Config{_exe}&#34; },
+     clean	  =&gt; { FILES =&gt; &#34;rlver.c rlver$Config{_exe} rlmalloc.c rlmalloc$Config{_exe}&#34; },
 &#41;;
 
 if &#40;$Config{usesfio} eq &#39;true&#39;&#41; {
@@ -214,4 +219,76 @@
     # $rlver may be &#39;8.21-beta3&#39; or &#39;4.2a&#39;
     return $rlver =~ /&#40;\d+&#41;\.&#40;\d+&#41;/;
 }
+
+########################################################################
+# Check whether the xmalloc exported by readline is indeed called
+# &#39;xmalloc&#39; or whether it has been renamed to &#39;_rl_malloc&#39;.
+sub guess_malloc_names {
+    my &#40;$RLINC, $RLLIB, $defs, $lddflags, $libs&#41; = @_;
+    my $frlmalloc = &#39;rlmalloc.c&#39;;
+
+    my @symbol_sets = &#40;
+	{
+	    # try defaults first
+	    # xmalloc  =&gt; &#39;xmalloc&#39;,
+	    # xrealloc =&gt; &#39;xrealloc&#39;,
+	    # xfree    =&gt; &#39;xfree&#39;,
+	},
+	{
+	    xmalloc  =&gt; &#39;_rl_malloc&#39;,
+	    xrealloc =&gt; &#39;_rl_realloc&#39;,
+	    xfree    =&gt; &#39;_rl_free&#39;,
+	},
+    &#41;;
+
+    # make temp file
+    open&#40;my $F, &#34;&gt;&#34;, $frlmalloc&#41; || die &#34;Cannot open $frlmalloc: $!\n&#34;;
+    print {$F} &lt;&lt;&#39;EOF&#39;;
+/* used by Makefile.pl to check the names of xmalloc etc. of the GNU Readline Library */
+#include &lt;stdio.h&gt;
+#include &lt;readline/readline.h&gt;
+
+/* we assume support for ANSI C */
+extern void *xmalloc&#40;int&#41;;
+extern void *xrealloc&#40;void *, int&#41;;
+extern void xfree&#40;void *&#41;;
+
+int main&#40;&#41; {
+    char *p;
+    p = xmalloc&#40;1&#41;;
+    p[0] = &#39;o&#39;;
+    p = xrealloc&#40;p, 3&#41;;
+    p[1] = &#39;k&#39;;
+    p[2] = &#39;\0&#39;;
+    puts&#40;p&#41;;
+    xfree&#40;p&#41;;
+    return 0;
+}
+EOF
+    close&#40;$F&#41;;
+
+    my $extra_defs;
+    for my $symbol_set &#40;@symbol_sets&#41; {
+	my $xdef = join &#34; &#34;, map &#34;-D$_=$symbol_set-&gt;{$_}&#34;, sort keys %$symbol_set;
+	# compile it
+	my $comp_cmd = &#34;$Config{cc} $RLINC $Config{ccflags} $defs $xdef $frlmalloc -o rlmalloc $RLLIB $lddflags $Config{ldflags} $libs&#34;;
+	print $comp_cmd, &#34;\n&#34;;
+	system&#40;$comp_cmd&#41;;
+	unless &#40;system&#40;$comp_cmd&#41; || `./rlmalloc` !~ /^ok$/ || $?&#41; {
+	    $extra_defs = $xdef;
+	    last;
+	}
+    }
+
+    unless &#40;defined $extra_defs&#41; {
+	warn &lt;&lt;EOM;
+!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
+I was unable to find a working xmalloc in your readline library.
+!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
+EOM
+	exit $err;
+    }
+
+    return $extra_defs;
+}
 # End of Makefile.PL
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1332386" href="/Public/Bug/Display.html?id=65973#txn-1332386">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;01&nbsp;12:29:19&nbsp;2014</span>
    <span class="description">HAYASHI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1332386/706820/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/706820">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 77b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve released Term::ReadLine::Gnu 1.21 which includes your patch.
Thank you.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1332388" href="/Public/Bug/Display.html?id=65973#txn-1332388">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;01&nbsp;12:29:20&nbsp;2014</span>
    <span class="description">HAYASHI [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.510285</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
