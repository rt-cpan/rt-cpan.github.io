<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #60729 for libnet: Net::Domain-&gt;hostfqdn result is based on unecessarily flaky assumptions</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #60729 for libnet: Net::Domain-&gt;hostfqdn result is based on unecessarily flaky assumptions</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=libnet">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=libnet">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=libnet">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=libnet">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/libnet">libnet CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">60729</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=libnet">libnet</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
torge [...] husfeldt.info

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
KTDREYER [...] ktdreyer.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-18284-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-18285-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Domain.pm<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1045971/546529/Domain.pm">
Sat Mar 03 21:47:04 2012 (10.4k) by eponymousalias [...] yahoo.com
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/912045/473065/Domain.pm">
Sat Mar 19 20:53:12 2011 (10.4k) by eponymousalias [...] yahoo.com
</a>
</font></li>
</ul>


Net::Domain.pm.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/822340/426055/Net%3A%3ADomain.pm.patch">
Wed Aug 25 09:42:41 2010 (892b) by torge [...] husfeldt.info
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=60729">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-822340" href="/Public/Bug/Display.html?id=60729#txn-822340">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;25&nbsp;09:42:41&nbsp;2010</span>
    <span class="description">torge [...] husfeldt.info -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Net::Domain-&gt;hostfqdn result is based on unecessarily flaky
 assumptions</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/822340/426054/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/426054">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is a bug report for perl from torge@husfeldt.info,
generated with the help of perlbug 1.39 running under perl 5.10.1.


-----------------------------------------------------------------
[Please describe your issue here]
On *nix systems, the result of:

Net::Domain-&gt;hostfqnd&#40;&#41;

is always based on the assumption that the domain of localhost is
the first &#34;word&#34;&#40;in regexp-terminology&#41; following the last occurence of
either &#34;domain&#34; or &#34;search&#34; in the first column of the file
/etc/resolv.conf -- without preference for one or the other.

In this it differs from the result of

`hostname -f`

which correctly takes into account the value for &#34;domain&#34;, if present
&#40;as well as other information not necessarily accessible in a system-
independent way&#41;.

To reproduce:
edit &#40;as administrator&#41; /etc/resolv.conf so that a domain name different
from your local domain is the first entry in search-domain and the
domain line if present precedes the search-domain line.
use Net::Domain;
print Net::Domain-&gt;hostfqdn&#40;&#41;


See details &#40;version info, ...&#41; in original bug posted using perlbug
<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.perl.org/rt3//Public/Bug/Display.html?id=77136">http://rt.perl.org/rt3//Public/Bug/Display.html?id=77136</a></span>
&#40;btw is there a similar tool cpanbug?&#41;
This is perl, v5.10.1 &#40;*&#41; built for i486-linux-gnu-thread-multi
2.6.32-24-generic #38-Ubuntu SMP Mon Jul 5 09:22:14 UTC 2010 i686 GNU/Linux
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Net::Domain.pm.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/822340/426055/Net%3A%3ADomain.pm.patch">Download Net::Domain.pm.patch</a><br />
<span class="downloadcontenttype">text/x-diff 892b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">*** /usr/share/perl/5.10.1/Net/Domain.pm	2010-08-10 16:15:09.000000000 +0200
--- /usr/share/perl/5.10.1/Net/Domain.pm.bak	2010-08-10 16:06:02.000000000 +0200
***************
*** 127,147 ****
    local *RES;
    local &#40;$_&#41;;
  
-   my $res_first_search_domain;
- 
    if &#40;open&#40;RES, &#34;/etc/resolv.conf&#34;&#41;&#41; {
      while &#40;&lt;RES&gt;&#41; {
!       if &#40;/\A\s*domain\s+&#40;\S+&#41;/&#41; {
!         $domain = $1;
!         last;
!       }
!       $res_first_search_domain = $1
!         if &#40;/\A\s*search\s+&#40;\S+&#41;/&#41;;
      }
      close&#40;RES&#41;;
  
-     $domain ||= $res_first_search_domain;
- 
      return $domain
        if &#40;defined $domain&#41;;
    }
--- 127,139 ----
    local *RES;
    local &#40;$_&#41;;
  
    if &#40;open&#40;RES, &#34;/etc/resolv.conf&#34;&#41;&#41; {
      while &#40;&lt;RES&gt;&#41; {
!       $domain = $1
!         if &#40;/\A\s*&#40;?:domain|search&#41;\s+&#40;\S+&#41;/&#41;;
      }
      close&#40;RES&#41;;
  
      return $domain
        if &#40;defined $domain&#41;;
    }
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-897572" href="/Public/Bug/Display.html?id=60729#txn-897572">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;15&nbsp;19:37:05&nbsp;2011</span>
    <span class="description">KTDREYER [...] ktdreyer.com -  Cc KTDREYER added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-912045" href="/Public/Bug/Display.html?id=60729#txn-912045">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;19&nbsp;20:53:11&nbsp;2011</span>
    <span class="description">eponymousalias [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> eponymousalias [...] yahoo.com</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/912045/473064/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/473064">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The previous patch provided for bug 60729 is broken, because
it fails to recognize the rules by which /etc/resolv.conf lines
are supposed to be processed, and that they have a well-defined
precedence &#40;from the man page:  The domain and search keywords are
mutually exclusive.  If more than one instance of these keywords is
present, the last instance wins.&#41;.  That patch also continues the
failure of the original code to understand that the search keyword
may be followed by a list of domains, which should be searched in
turn &#40;provided there is no following domain or search keyword&#41;,
rather than either assuming that the first item supplied is the
right one or that some preceding domain value should be used.
A proper interpretation of the file content would solve the actual
problem with the bug reporter&#39;s configuration file.  The previous
patch also continues to misinterpret how the LOCALDOMAIN environment
variable is to be treated.

We hereby provide a replacement upgrade of the Domain.pm file,
attached as a complete file rather than as a patch.  You may run
your own diffs to see the modifications.

Here are the changes represented by this version of the Domain.pm
file, with respect to the copy provided in the libnet-1.22_01
development release as a baseline:

* Bump up the $VERSION number.

* Remove useless escapes before dots in character classes.

* Fix /etc/resolv.conf processing to correctly handle multiple
  domains specified with a search keyword, according to the same
  rules used by the system resolver, rather than mistakenly assuming
  the first domain listed is the actual one for this host.  See the
  resolv.conf man page for details.

* Fix the handling of the LOCALDOMAIN environment variable, to
  override domain and search keywords in the /etc/resolv.conf file,
  per the rules used by the system resolver, and to recognize
  that it can contain a list of multiple possible domain names,
  not just a single domain name.  See the resolv.conf man page and
  the resolver res_init.c source code for details.

* Fix the branch logic within _hostdomain&#40;&#41; to avoid referencing
  an undefined $host variable.

* Add comments about certain ways in which the computed results
  can be unreliable.

* Add a clear&#40;&#41; routine to clear the cache, allowing a reset of
  the Net::Domain package in case it has settled on incorrect
  discovered results.

* Add a BUGS section to the documentation.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Domain.pm</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/912045/473065/Domain.pm">Download Domain.pm</a><br />
<span class="downloadcontenttype">text/x-perl 10.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"># Net::Domain.pm
#
# Copyright &#40;c&#41; 1995-1998 Graham Barr &lt;gbarr@pobox.com&gt;. All rights reserved.
# This program is free software; you can redistribute it and/or
# modify it under the same terms as Perl itself.

package Net::Domain;

require Exporter;

use Carp;
use strict;
use vars qw&#40;$VERSION @ISA @EXPORT_OK&#41;;
use Net::Config;

@ISA       = qw&#40;Exporter&#41;;
@EXPORT_OK = qw&#40;hostname hostdomain hostfqdn domainname clear&#41;;

$VERSION = &#34;2.22&#34;;

my &#40;$host, $domain, $fqdn&#41; = &#40;undef, undef, undef&#41;;

# Try every conceivable way to get hostname.


sub _hostname {

  # we already know it
  return $host
    if &#40;defined $host&#41;;

  if &#40;$^O eq &#39;MSWin32&#39;&#41; {
    require Socket;
    my &#40;$name, $alias, $type, $len, @addr&#41; = gethostbyname&#40;$ENV{&#39;COMPUTERNAME&#39;} || &#39;localhost&#39;&#41;;
    while &#40;@addr&#41; {
      my $a = shift&#40;@addr&#41;;
      $host = gethostbyaddr&#40;$a, Socket::AF_INET&#40;&#41;&#41;;
      last if defined $host;
    }
    if &#40;defined&#40;$host&#41; &#38;&#38; index&#40;$host, &#39;.&#39;&#41; &gt; 0&#41; {
      $fqdn = $host;
      &#40;$host, $domain&#41; = $fqdn =~ /^&#40;[^.]+&#41;\.&#40;.*&#41;$/;
    }
    return $host;
  }
  elsif &#40;$^O eq &#39;MacOS&#39;&#41; {
    chomp&#40;$host = `hostname`&#41;;
  }
  elsif &#40;$^O eq &#39;VMS&#39;&#41; {    ## multiple varieties of net s/w makes this hard
    $host = $ENV{&#39;UCX$INET_HOST&#39;}      if defined&#40;$ENV{&#39;UCX$INET_HOST&#39;}&#41;;
    $host = $ENV{&#39;MULTINET_HOST_NAME&#39;} if defined&#40;$ENV{&#39;MULTINET_HOST_NAME&#39;}&#41;;
    if &#40;index&#40;$host, &#39;.&#39;&#41; &gt; 0&#41; {
      $fqdn = $host;
      &#40;$host, $domain&#41; = $fqdn =~ /^&#40;[^.]+&#41;\.&#40;.*&#41;$/;
    }
    return $host;
  }
  else {
    local $SIG{&#39;__DIE__&#39;};

    # syscall is preferred since it avoids tainting problems
    eval {
      my $tmp = &#34;\0&#34; x 256;    ## preload scalar
      eval {
        package main;
        require &#34;syscall.ph&#34;;
        defined&#40;&#38;main::SYS_gethostname&#41;;
        }
        || eval {
        package main;
        require &#34;sys/syscall.ph&#34;;
        defined&#40;&#38;main::SYS_gethostname&#41;;
        }
        and $host =
        &#40;syscall&#40;&#38;main::SYS_gethostname, $tmp, 256&#41; == 0&#41;
        ? $tmp
        : undef;
      }

      # POSIX
      || eval {
      require POSIX;
      $host = &#40;POSIX::uname&#40;&#41;&#41;[1];
      }

      # trusty old hostname command
      || eval {
      chop&#40;$host = `&#40;hostname&#41; 2&gt;/dev/null`&#41;;    # BSD&#39;ish
      }

      # sysV/POSIX uname command &#40;may truncate&#41;
      || eval {
      chop&#40;$host = `uname -n 2&gt;/dev/null`&#41;;      ## SYSV&#39;ish &#38;&#38; POSIX&#39;ish
      }

      # Apollo pre-SR10
      || eval { $host = &#40;split&#40;/[:. ]/, `/com/host`, 6&#41;&#41;[0]; }

      || eval { $host = &#34;&#34;; };
  }

  # remove garbage
  $host =~ s/[\0\r\n]+//go;
  $host =~ s/&#40;\A\.+|\.+\Z&#41;//go;
  $host =~ s/\.\.+/\./go;

  $host;
}


sub _hostdomain {

  # we already know it
  return $domain
    if &#40;defined $domain&#41;;

  local $SIG{&#39;__DIE__&#39;};

  return $domain = $NetConfig{&#39;inet_domain&#39;}
    if defined $NetConfig{&#39;inet_domain&#39;};

  # try looking in /etc/resolv.conf
  # putting this here and assuming that it is correct, eliminates
  # calls to gethostbyname, and therefore DNS lookups. This helps
  # those on dialup systems.

  local *RES;
  local &#40;$_&#41;;

  my @search_domains = &#40;&#41;;

  # From resolv.conf&#40;5&#41;:
  #   The search keyword of a system&#39;s resolv.conf file can be overridden on
  #   a per-process basis by setting the environment variable &#34;LOCALDOMAIN&#34;
  #   to a space-separated list of search domains.
  # In fact, it also overrides any domain keyword in resolv.conf.
  # LOCALDOMAIN may contain a list of domains to search.
  if &#40;defined $ENV{LOCALDOMAIN}&#41; {
    @search_domains = split&#40;&#39; &#39;, $ENV{LOCALDOMAIN}&#41;;
  }
  elsif &#40;open&#40;RES, &#34;/etc/resolv.conf&#34;&#41;&#41; {
    while &#40;&lt;RES&gt;&#41; {
      # From resolv.conf&#40;5&#41;:
      #   The domain and search keywords are mutually exclusive.  If more than
      #   one instance of these keywords is present, the last instance wins.
      if &#40;/\A\s*domain\s+&#40;\S+&#41;/&#41; {
        $domain = $1;
        @search_domains = &#40;&#41;;
        last;
      }
      elsif &#40;/\A\s*search\s+&#40;\S.*&#41;/&#41; {
        @search_domains = split&#40;&#39; &#39;, $1&#41;;
        $domain = undef;
      }
    }
    close&#40;RES&#41;;
  }

  return $domain
    if &#40;defined $domain&#41;;

  my $host = _hostname&#40;&#41;;

  if &#40;defined&#40;$host&#41; &#38;&#38; @search_domains&#41; {
    foreach my $s_dom &#40;@search_domains&#41; {
      my @info = gethostbyname&#40;&#40;$host =~ /\.$s_dom$/&#41; ? $host : &#34;$host.$s_dom&#34;&#41;;
      next unless @info;

      # look at real name &#38; aliases
      my $site;
      foreach $site &#40;$info[0], split&#40;/ /, $info[1]&#41;&#41; {
        if &#40;rindex&#40;$site, &#34;.&#34;&#41; &gt; 0&#41; {
          ## Extract domain from FQDN
          &#40;$domain = $site&#41; =~ s/\A[^.]+\.//;
          return $domain;
        }
      }
    }
  }

  # just try hostname and system calls

  my &#40;@hosts&#41;;

  @hosts = &#40;$host, &#34;localhost&#34;&#41;;

  if &#40;defined&#40;$host&#41;&#41; {
    unless &#40;$host =~ /\./&#41; {
      my $dom = undef;
      eval {
        my $tmp = &#34;\0&#34; x 256;    ## preload scalar
        eval {
          package main;
          require &#34;syscall.ph&#34;;
          }
          || eval {
          package main;
          require &#34;sys/syscall.ph&#34;;
          }
          and $dom =
          &#40;syscall&#40;&#38;main::SYS_getdomainname, $tmp, 256&#41; == 0&#41;
          ? $tmp
          : undef;
      };

      if &#40;$^O eq &#39;VMS&#39;&#41; {
        $dom ||= $ENV{&#39;TCPIP$INET_DOMAIN&#39;}
          || $ENV{&#39;UCX$INET_DOMAIN&#39;};
      }

      chop&#40;$dom = `domainname 2&gt;/dev/null`&#41;
        unless &#40;defined $dom || $^O =~ /^&#40;?:cygwin|MSWin32&#41;/&#41;;

      # This strategy of testing against truncated domains is not reliable, because calls
      # to gethostbyname&#40;&#41; may depend on network resources.  If the gethostbyname&#40;&#41; call
      # below fails on some transient outage when trying to test the actual hostname, the
      # loop can continue on and match some other hostname completely outside your actual
      # domain, say if a subsequent call resolves to some general Internet site.  For
      # example, if my machine is foobar.mydomain.com and that call fails, it will test
      # foobar.com and that will likely succeed.
      if &#40;defined $dom&#41; {
        my @h = &#40;&#41;;
        $dom =~ s/^\.+//;
        while &#40;length&#40;$dom&#41;&#41; {
          push&#40;@h, &#34;$host.$dom&#34;&#41;;
          $dom =~ s/^[^.]+.+// or last;
        }
        unshift&#40;@hosts, @h&#41;;
      }
    }
  }

  # Attempt to locate FQDN

  foreach &#40;grep { defined $_ } @hosts&#41; {
    my @info = gethostbyname&#40;$_&#41;;

    next unless @info;

    # look at real name &#38; aliases
    my $site;
    foreach $site &#40;$info[0], split&#40;/ /, $info[1]&#41;&#41; {
      if &#40;rindex&#40;$site, &#34;.&#34;&#41; &gt; 0&#41; {

        # Extract domain from FQDN

        &#40;$domain = $site&#41; =~ s/\A[^.]+\.//;
        return $domain;
      }
    }
  }

  # Look for environment variable

  $domain ||= $ENV{DOMAIN};

  if &#40;defined $domain&#41; {
    $domain =~ s/[\r\n\0]+//g;
    $domain =~ s/&#40;\A\.+|\.+\Z&#41;//g;
    $domain =~ s/\.\.+/\./g;
  }

  $domain;
}


sub domainname {

  return $fqdn
    if &#40;defined $fqdn&#41;;

  _hostname&#40;&#41;;

  # *.local names are special on darwin. If we call gethostbyname below, it
  # may hang while waiting for another, non-existent computer to respond.
  if&#40;$^O eq &#39;darwin&#39; &#38;&#38; $host =~ /\.local$/&#41; {
    return $host;
  }

  _hostdomain&#40;&#41;;

  # Assumption: If the host name does not contain a period
  # and the domain name does, then assume that they are correct
  # this helps to eliminate calls to gethostbyname, and therefore
  # eleminate DNS lookups

  return $fqdn = $host . &#34;.&#34; . $domain
    if &#40;defined $host
    and defined $domain
    and $host !~ /\./
    and $domain =~ /\./&#41;;

  # For hosts that have no name, just an IP address
  return $fqdn = $host if defined $host and $host =~ /^\d+&#40;\.\d+&#41;{3}$/;

  my @host   = defined $host   ? split&#40;/\./, $host&#41;   : &#40;&#39;localhost&#39;&#41;;
  my @domain = defined $domain ? split&#40;/\./, $domain&#41; : &#40;&#41;;
  my @fqdn   = &#40;&#41;;

  # Determine from @host &#38; @domain the FQDN

  my @d = @domain;

LOOP:
  while &#40;1&#41; {
    my @h = @host;
    while &#40;@h&#41; {
      my $tmp = join&#40;&#34;.&#34;, @h, @d&#41;;
      if &#40;&#40;gethostbyname&#40;$tmp&#41;&#41;[0]&#41; {
        @fqdn = &#40;@h, @d&#41;;
        $fqdn = $tmp;
        last LOOP;
      }
      pop @h;
    }
    last unless shift @d;
  }

  if &#40;@fqdn&#41; {
    $host = shift @fqdn;
    until &#40;&#40;gethostbyname&#40;$host&#41;&#41;[0]&#41; {
      $host .= &#34;.&#34; . shift @fqdn;
    }
    $domain = join&#40;&#34;.&#34;, @fqdn&#41;;
  }
  else {
    undef $host;
    undef $domain;
    undef $fqdn;
  }

  $fqdn;
}


sub hostfqdn { domainname&#40;&#41; }


sub hostname {
  domainname&#40;&#41;
    unless &#40;defined $host&#41;;
  return $host;
}


sub hostdomain {
  domainname&#40;&#41;
    unless &#40;defined $domain&#41;;
  return $domain;
}

sub clear {
  $host = undef;
  $domain = undef;
  $fqdn = undef;
}

1;    # Keep require happy

__END__

=head1 NAME

Net::Domain - Attempt to evaluate the current host&#39;s internet name and domain

=head1 SYNOPSIS

    use Net::Domain qw&#40;hostname hostfqdn hostdomain domainname&#41;;

=head1 DESCRIPTION

Using various methods B&lt;attempt&gt; to find the Fully Qualified Domain Name &#40;FQDN&#41;
of the current host. From this determine the host-name and the host-domain.

Each of the functions will return I&lt;undef&gt; if the FQDN cannot be determined.

=over 4

=item hostfqdn &#40;&#41;

Identify and return the FQDN of the current host.

=item domainname &#40;&#41;

An alias for hostfqdn &#40;&#41;.

=item hostname &#40;&#41;

Returns the smallest part of the FQDN which can be used to identify the host.

=item hostdomain &#40;&#41;

Returns the remainder of the FQDN after the I&lt;hostname&gt; has been removed.

=item clear &#40;&#41;

Net::Domain caches the results of apparently successful calls, and
subsequent calls just return the precomputed data.  However, it operates
by using a series of heuristics, which might fail &#40;say, due to transient
network outages&#41;.  This can result in incorrect cached values, which would
then be impossible to reset.  If you suspect the cache is contaminated,
you can call clear&#40;&#41; to empty it so the next call is forced to recompute
its result from scratch.  Without this routine, you would need to restart
your entire application process to clear the cache.

This being a fairly generic term, you will probably not want to import
the clear&#40;&#41; routine name.  Call it as Net::Domain::clear&#40;&#41; instead.

=back

=head1 BUGS

Ideally, these routines would use the SIOCGLIFCONF ioctl&#40;&#41; [supporting
both IPv4 and IPv6] or the SIOCGIFCONF ioctl&#40;&#41; [IPv4 only] to prove
the discovered hostname is accurate, by checking its address against
those supported by the actual network interfaces currently active on
the machine.  However, those ioctls only list the addresses supported
by the physical network interfaces, and will not find a VPN address.

=head1 AUTHOR

Graham Barr &lt;gbarr@pobox.com&gt;.
Adapted from Sys::Hostname by David Sundstrom &lt;sunds@asictest.sc.ti.com&gt;

=head1 COPYRIGHT

Copyright &#40;c&#41; 1995-1998 Graham Barr. All rights reserved.
This program is free software; you can redistribute it and/or modify
it under the same terms as Perl itself.

=cut
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-912048" href="/Public/Bug/Display.html?id=60729#txn-912048">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;19&nbsp;20:53:12&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1045971" href="/Public/Bug/Display.html?id=60729#txn-1045971">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;03&nbsp;21:47:04&nbsp;2012</span>
    <span class="description">eponymousalias [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> eponymousalias [...] yahoo.com</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1045971/546528/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/546528">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 660b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">My own previous revised copy of Domain.pm for bug 60729
still contained a bug:  if a &#34;domain&#34; directive was present
in /etc/resolv.conf, then any subsequent domain or search
directives got ignored.  This is counter to the resolv.conf&#40;5&#41;
documentation, which says explicitly:

    The domain and search keywords are mutually exclusive.
    If more than one instance of these keywords is present,
    the last instance wins.

The attached revised copy of Domain.pm fixes that problem, and
should properly reflect the manner in which the /etc/resolv.conf
contents are processed by the system libraries.

This should address both CPAN bug 60729 and CPAN bug 73410.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Domain.pm</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1045971/546529/Domain.pm">Download Domain.pm</a><br />
<span class="downloadcontenttype">text/x-perl 10.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"># Net::Domain.pm
#
# Copyright &#40;c&#41; 1995-1998 Graham Barr &lt;gbarr@pobox.com&gt;. All rights reserved.
# This program is free software; you can redistribute it and/or
# modify it under the same terms as Perl itself.

package Net::Domain;

require Exporter;

use Carp;
use strict;
use vars qw&#40;$VERSION @ISA @EXPORT_OK&#41;;
use Net::Config;

@ISA       = qw&#40;Exporter&#41;;
@EXPORT_OK = qw&#40;hostname hostdomain hostfqdn domainname clear&#41;;

$VERSION = &#34;2.22&#34;;

my &#40;$host, $domain, $fqdn&#41; = &#40;undef, undef, undef&#41;;

# Try every conceivable way to get hostname.


sub _hostname {

  # we already know it
  return $host
    if &#40;defined $host&#41;;

  if &#40;$^O eq &#39;MSWin32&#39;&#41; {
    require Socket;
    my &#40;$name, $alias, $type, $len, @addr&#41; = gethostbyname&#40;$ENV{&#39;COMPUTERNAME&#39;} || &#39;localhost&#39;&#41;;
    while &#40;@addr&#41; {
      my $a = shift&#40;@addr&#41;;
      $host = gethostbyaddr&#40;$a, Socket::AF_INET&#40;&#41;&#41;;
      last if defined $host;
    }
    if &#40;defined&#40;$host&#41; &#38;&#38; index&#40;$host, &#39;.&#39;&#41; &gt; 0&#41; {
      $fqdn = $host;
      &#40;$host, $domain&#41; = $fqdn =~ /^&#40;[^.]+&#41;\.&#40;.*&#41;$/;
    }
    return $host;
  }
  elsif &#40;$^O eq &#39;MacOS&#39;&#41; {
    chomp&#40;$host = `hostname`&#41;;
  }
  elsif &#40;$^O eq &#39;VMS&#39;&#41; {    ## multiple varieties of net s/w makes this hard
    $host = $ENV{&#39;UCX$INET_HOST&#39;}      if defined&#40;$ENV{&#39;UCX$INET_HOST&#39;}&#41;;
    $host = $ENV{&#39;MULTINET_HOST_NAME&#39;} if defined&#40;$ENV{&#39;MULTINET_HOST_NAME&#39;}&#41;;
    if &#40;index&#40;$host, &#39;.&#39;&#41; &gt; 0&#41; {
      $fqdn = $host;
      &#40;$host, $domain&#41; = $fqdn =~ /^&#40;[^.]+&#41;\.&#40;.*&#41;$/;
    }
    return $host;
  }
  else {
    local $SIG{&#39;__DIE__&#39;};

    # syscall is preferred since it avoids tainting problems
    eval {
      my $tmp = &#34;\0&#34; x 256;    ## preload scalar
      eval {
        package main;
        require &#34;syscall.ph&#34;;
        defined&#40;&#38;main::SYS_gethostname&#41;;
        }
        || eval {
        package main;
        require &#34;sys/syscall.ph&#34;;
        defined&#40;&#38;main::SYS_gethostname&#41;;
        }
        and $host =
        &#40;syscall&#40;&#38;main::SYS_gethostname, $tmp, 256&#41; == 0&#41;
        ? $tmp
        : undef;
      }

      # POSIX
      || eval {
      require POSIX;
      $host = &#40;POSIX::uname&#40;&#41;&#41;[1];
      }

      # trusty old hostname command
      || eval {
      chop&#40;$host = `&#40;hostname&#41; 2&gt;/dev/null`&#41;;    # BSD&#39;ish
      }

      # sysV/POSIX uname command &#40;may truncate&#41;
      || eval {
      chop&#40;$host = `uname -n 2&gt;/dev/null`&#41;;      ## SYSV&#39;ish &#38;&#38; POSIX&#39;ish
      }

      # Apollo pre-SR10
      || eval { $host = &#40;split&#40;/[:. ]/, `/com/host`, 6&#41;&#41;[0]; }

      || eval { $host = &#34;&#34;; };
  }

  # remove garbage
  $host =~ s/[\0\r\n]+//go;
  $host =~ s/&#40;\A\.+|\.+\Z&#41;//go;
  $host =~ s/\.\.+/\./go;

  $host;
}


sub _hostdomain {

  # we already know it
  return $domain
    if &#40;defined $domain&#41;;

  local $SIG{&#39;__DIE__&#39;};

  return $domain = $NetConfig{&#39;inet_domain&#39;}
    if defined $NetConfig{&#39;inet_domain&#39;};

  # try looking in /etc/resolv.conf
  # putting this here and assuming that it is correct, eliminates
  # calls to gethostbyname, and therefore DNS lookups. This helps
  # those on dialup systems.

  local *RES;
  local &#40;$_&#41;;

  my @search_domains = &#40;&#41;;

  # From resolv.conf&#40;5&#41;:
  #   The search keyword of a system&#39;s resolv.conf file can be overridden on
  #   a per-process basis by setting the environment variable &#34;LOCALDOMAIN&#34;
  #   to a space-separated list of search domains.
  # In fact, it also overrides any domain keyword in resolv.conf.
  # LOCALDOMAIN may contain a list of domains to search.
  if &#40;defined $ENV{LOCALDOMAIN}&#41; {
    @search_domains = split&#40;&#39; &#39;, $ENV{LOCALDOMAIN}&#41;;
  }
  elsif &#40;open&#40;RES, &#34;/etc/resolv.conf&#34;&#41;&#41; {
    while &#40;&lt;RES&gt;&#41; {
      # From resolv.conf&#40;5&#41;:
      #   The domain and search keywords are mutually exclusive.  If more than
      #   one instance of these keywords is present, the last instance wins.
      if &#40;/\A\s*domain\s+&#40;\S+&#41;/&#41; {
        $domain = $1;
        @search_domains = &#40;&#41;;
      }
      elsif &#40;/\A\s*search\s+&#40;\S.*&#41;/&#41; {
        @search_domains = split&#40;&#39; &#39;, $1&#41;;
        $domain = undef;
      }
    }
    close&#40;RES&#41;;
  }

  return $domain
    if &#40;defined $domain&#41;;

  my $host = _hostname&#40;&#41;;

  if &#40;defined&#40;$host&#41; &#38;&#38; @search_domains&#41; {
    foreach my $s_dom &#40;@search_domains&#41; {
      my @info = gethostbyname&#40;&#40;$host =~ /\.$s_dom$/&#41; ? $host : &#34;$host.$s_dom&#34;&#41;;
      next unless @info;

      # look at real name &#38; aliases
      my $site;
      foreach $site &#40;$info[0], split&#40;/ /, $info[1]&#41;&#41; {
        if &#40;rindex&#40;$site, &#34;.&#34;&#41; &gt; 0&#41; {
          ## Extract domain from FQDN
          &#40;$domain = $site&#41; =~ s/\A[^.]+\.//;
          return $domain;
        }
      }
    }
  }

  # just try hostname and system calls

  my &#40;@hosts&#41;;

  @hosts = &#40;$host, &#34;localhost&#34;&#41;;

  if &#40;defined&#40;$host&#41;&#41; {
    unless &#40;$host =~ /\./&#41; {
      my $dom = undef;
      eval {
        my $tmp = &#34;\0&#34; x 256;    ## preload scalar
        eval {
          package main;
          require &#34;syscall.ph&#34;;
          }
          || eval {
          package main;
          require &#34;sys/syscall.ph&#34;;
          }
          and $dom =
          &#40;syscall&#40;&#38;main::SYS_getdomainname, $tmp, 256&#41; == 0&#41;
          ? $tmp
          : undef;
      };

      if &#40;$^O eq &#39;VMS&#39;&#41; {
        $dom ||= $ENV{&#39;TCPIP$INET_DOMAIN&#39;}
          || $ENV{&#39;UCX$INET_DOMAIN&#39;};
      }

      chop&#40;$dom = `domainname 2&gt;/dev/null`&#41;
        unless &#40;defined $dom || $^O =~ /^&#40;?:cygwin|MSWin32&#41;/&#41;;

      # This strategy of testing against truncated domains is not reliable, because calls
      # to gethostbyname&#40;&#41; may depend on network resources.  If the gethostbyname&#40;&#41; call
      # below fails on some transient outage when trying to test the actual hostname, the
      # loop can continue on and match some other hostname completely outside your actual
      # domain, say if a subsequent call resolves to some general Internet site.  For
      # example, if my machine is foobar.mydomain.com and that call fails, it will test
      # foobar.com and that will likely succeed.
      if &#40;defined $dom&#41; {
        my @h = &#40;&#41;;
        $dom =~ s/^\.+//;
        while &#40;length&#40;$dom&#41;&#41; {
          push&#40;@h, &#34;$host.$dom&#34;&#41;;
          $dom =~ s/^[^.]+.+// or last;
        }
        unshift&#40;@hosts, @h&#41;;
      }
    }
  }

  # Attempt to locate FQDN

  foreach &#40;grep { defined $_ } @hosts&#41; {
    my @info = gethostbyname&#40;$_&#41;;

    next unless @info;

    # look at real name &#38; aliases
    my $site;
    foreach $site &#40;$info[0], split&#40;/ /, $info[1]&#41;&#41; {
      if &#40;rindex&#40;$site, &#34;.&#34;&#41; &gt; 0&#41; {

        # Extract domain from FQDN

        &#40;$domain = $site&#41; =~ s/\A[^.]+\.//;
        return $domain;
      }
    }
  }

  # Look for environment variable

  $domain ||= $ENV{DOMAIN};

  if &#40;defined $domain&#41; {
    $domain =~ s/[\r\n\0]+//g;
    $domain =~ s/&#40;\A\.+|\.+\Z&#41;//g;
    $domain =~ s/\.\.+/\./g;
  }

  $domain;
}


sub domainname {

  return $fqdn
    if &#40;defined $fqdn&#41;;

  _hostname&#40;&#41;;

  # *.local names are special on darwin. If we call gethostbyname below, it
  # may hang while waiting for another, non-existent computer to respond.
  if&#40;$^O eq &#39;darwin&#39; &#38;&#38; $host =~ /\.local$/&#41; {
    return $host;
  }

  _hostdomain&#40;&#41;;

  # Assumption: If the host name does not contain a period
  # and the domain name does, then assume that they are correct
  # this helps to eliminate calls to gethostbyname, and therefore
  # eleminate DNS lookups

  return $fqdn = $host . &#34;.&#34; . $domain
    if &#40;defined $host
    and defined $domain
    and $host !~ /\./
    and $domain =~ /\./&#41;;

  # For hosts that have no name, just an IP address
  return $fqdn = $host if defined $host and $host =~ /^\d+&#40;\.\d+&#41;{3}$/;

  my @host   = defined $host   ? split&#40;/\./, $host&#41;   : &#40;&#39;localhost&#39;&#41;;
  my @domain = defined $domain ? split&#40;/\./, $domain&#41; : &#40;&#41;;
  my @fqdn   = &#40;&#41;;

  # Determine from @host &#38; @domain the FQDN

  my @d = @domain;

LOOP:
  while &#40;1&#41; {
    my @h = @host;
    while &#40;@h&#41; {
      my $tmp = join&#40;&#34;.&#34;, @h, @d&#41;;
      if &#40;&#40;gethostbyname&#40;$tmp&#41;&#41;[0]&#41; {
        @fqdn = &#40;@h, @d&#41;;
        $fqdn = $tmp;
        last LOOP;
      }
      pop @h;
    }
    last unless shift @d;
  }

  if &#40;@fqdn&#41; {
    $host = shift @fqdn;
    until &#40;&#40;gethostbyname&#40;$host&#41;&#41;[0]&#41; {
      $host .= &#34;.&#34; . shift @fqdn;
    }
    $domain = join&#40;&#34;.&#34;, @fqdn&#41;;
  }
  else {
    undef $host;
    undef $domain;
    undef $fqdn;
  }

  $fqdn;
}


sub hostfqdn { domainname&#40;&#41; }


sub hostname {
  domainname&#40;&#41;
    unless &#40;defined $host&#41;;
  return $host;
}


sub hostdomain {
  domainname&#40;&#41;
    unless &#40;defined $domain&#41;;
  return $domain;
}

sub clear {
  $host = undef;
  $domain = undef;
  $fqdn = undef;
}

1;    # Keep require happy

__END__

=head1 NAME

Net::Domain - Attempt to evaluate the current host&#39;s internet name and domain

=head1 SYNOPSIS

    use Net::Domain qw&#40;hostname hostfqdn hostdomain domainname&#41;;

=head1 DESCRIPTION

Using various methods B&lt;attempt&gt; to find the Fully Qualified Domain Name &#40;FQDN&#41;
of the current host. From this determine the host-name and the host-domain.

Each of the functions will return I&lt;undef&gt; if the FQDN cannot be determined.

=over 4

=item hostfqdn &#40;&#41;

Identify and return the FQDN of the current host.

=item domainname &#40;&#41;

An alias for hostfqdn &#40;&#41;.

=item hostname &#40;&#41;

Returns the smallest part of the FQDN which can be used to identify the host.

=item hostdomain &#40;&#41;

Returns the remainder of the FQDN after the I&lt;hostname&gt; has been removed.

=item clear &#40;&#41;

Net::Domain caches the results of apparently successful calls, and
subsequent calls just return the precomputed data.  However, it operates
by using a series of heuristics, which might fail &#40;say, due to transient
network outages&#41;.  This can result in incorrect cached values, which would
then be impossible to reset.  If you suspect the cache is contaminated,
you can call clear&#40;&#41; to empty it so the next call is forced to recompute
its result from scratch.  Without this routine, you would need to restart
your entire application process to clear the cache.

This being a fairly generic term, you will probably not want to import
the clear&#40;&#41; routine name.  Call it as Net::Domain::clear&#40;&#41; instead.

=back

=head1 BUGS

Ideally, these routines would use the SIOCGLIFCONF ioctl&#40;&#41; [supporting
both IPv4 and IPv6] or the SIOCGIFCONF ioctl&#40;&#41; [IPv4 only] to prove
the discovered hostname is accurate, by checking its address against
those supported by the actual network interfaces currently active on
the machine.  However, those ioctls only list the addresses supported
by the physical network interfaces, and will not find a VPN address.

=head1 AUTHOR

Graham Barr &lt;gbarr@pobox.com&gt;.
Adapted from Sys::Hostname by David Sundstrom &lt;sunds@asictest.sc.ti.com&gt;

=head1 COPYRIGHT

Copyright &#40;c&#41; 1995-1998 Graham Barr. All rights reserved.
This program is free software; you can redistribute it and/or modify
it under the same terms as Perl itself.

=cut
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1099697" href="/Public/Bug/Display.html?id=60729#txn-1099697">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;16&nbsp;04:23:31&nbsp;2012</span>
    <span class="description">TEX [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1099697/578198/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/578198">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 407b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2012-03-04 03:47:04, eponymousalias@yahoo.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The attached revised copy of Domain.pm fixes that problem, and
&gt; should properly reflect the manner in which the /etc/resolv.conf
&gt; contents are processed by the system libraries.
&gt; 
&gt; This should address both CPAN bug 60729 and CPAN bug 73410.
</div>
This patch looks pretty good and fixes our issues w/ Net::Domain on
Linux. Please consider applying it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1100129" href="/Public/Bug/Display.html?id=60729#txn-1100129">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;17&nbsp;05:00:25&nbsp;2012</span>
    <span class="description">vincent [...] vinc17.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> vincent [...] vinc17.net</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1100129/578440/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/578440">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le Lun 16 Jui 2012 04:23:31, TEX a Ã©critÂ :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2012-03-04 03:47:04, eponymousalias@yahoo.com wrote:
<div class="message-stanza open">&gt; &gt; The attached revised copy of Domain.pm fixes that problem, and
&gt; &gt; should properly reflect the manner in which the /etc/resolv.conf
&gt; &gt; contents are processed by the system libraries.
&gt; &gt; 
&gt; &gt; This should address both CPAN bug 60729 and CPAN bug 73410.
</div>&gt; 
&gt; This patch looks pretty good and fixes our issues w/ Net::Domain on
&gt; Linux. Please consider applying it.
</div>
The attached version from 19 March 2011 &#40;currently the latest
attachment&#41; is buggy: if my /etc/resolv.conf file contains

domain localdomain

then the script

use strict;
use Net::Domain qw&#40;hostfqdn&#41;;

print $Net::Domain::VERSION.&#34;\n&#34;;
print hostfqdn&#40;&#41;.&#34;\n&#34;;

gives

2.22
xvii

&#40;like version 2.20 provided by Debian&#41;, instead of the real FQDN
&#40;xvii.vinc17.org - note that you won&#39;t be able to resolve it on your
side since the machine is on a local network&#41;. FYI, I&#39;ve used the
following method for years and it has always worked:

use strict;
use POSIX;

my $nodename = &#40;POSIX::uname&#41;[1];
print &#34;Nodename: $nodename\n&#34;;

my @ghbn = gethostbyname $nodename;
print &#34;FQDN: $ghbn[0]\n&#34;;

$ghbn[0] !~ /\./ &#38;&#38; $ghbn[1] =~ /&#40;\S+\.\S+&#41;/
  and print &#34;Fixed FQDN from aliases: $1\n&#34;;

The FQDN line gives the same result as `hostname -f`. IMHO this is what
should be used in priority on POSIX machines.

However some machines are not configured correctly &#40;`hostname -f` output
doesn&#39;t contain a dot&#41;, and the &#34;Fixed FQDN&#34; line attempts to get a real
FQDN. You may also want to use that.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1100132" href="/Public/Bug/Display.html?id=60729#txn-1100132">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;17&nbsp;05:03:35&nbsp;2012</span>
    <span class="description">vincent [...] vinc17.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> vincent [...] vinc17.net</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1100132/578443/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/578443">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 234b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le Mar 17 Jui 2012 05:00:25, vincent@vinc17.net a Ã©critÂ :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The attached version from 19 March 2011 &#40;currently the latest
&gt; attachment&#41; is buggy: [...]
</div>
Oops, sorry, that&#39;s the version from 3 March 2012, but it has the same
problem.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.53994</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
