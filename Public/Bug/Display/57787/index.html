<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #57787 for Petal: Safe-2.27 breaks Petal</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #57787 for Petal: Safe-2.27 breaks Petal</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Petal">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Petal">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Petal">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Petal">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Petal">Petal CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">57787</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Petal">Petal</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ntyni [...] iki.fi

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
ANSGAR [...] cpan.org

<br />
dam [...] cpan.org

<br />
jquelin [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-25732-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.19    </td>
  </tr>
  <tr id="CF-25733-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




no-Safe.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/966916/503134/no-Safe.patch">
Sun Aug 14 06:36:13 2011 (1.5k) by dam [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=57787">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-781276" href="/Public/Bug/Display.html?id=57787#txn-781276">#</a>      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;23&nbsp;15:36:47&nbsp;2010</span>
    <span class="description">ntyni [...] iki.fi -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Safe-2.27 breaks Petal</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/781276/404628/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/404628">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1002b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Recent CPAN tester failures, for example this:

<span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/07267724-b19f-3f77-b713-d32bba55d77f">http://www.cpantesters.org/cpan/report/07267724-b19f-3f77-b713-d32bba55d77f</a></span> 

are caused by Safe.pm 2.27, which now wraps code refs returned from reval&#40;&#41;.

The symptoms are

% perl -I ../Safe-2.27/blib/blib -I ../Safe-2.27/blib/arch
t/008_Quoted_Params.t
        &#40;in cleanup&#41; Can&#39;t locate object method &#34;process&#34; via package
&#34;Petal::Hash::Var&#34; &#40;perhaps you forgot to load &#34;Petal::Hash::Var&#34;?&#41; at
lib/Petal/Hash.pm line 188.
not ok 1 - ran
#   Failed test &#39;ran&#39;
#   at t/008_Quoted_Params.t line 24.
# [PETAL ERROR] Can&#39;t locate object method &#34;process&#34; via package
&#34;Petal::Hash::Var&#34; &#40;perhaps you forgot to load &#34;Petal::Hash::Var&#34;?&#41; at
lib/Petal/Hash.pm line 188.
# . Debug info written in /tmp/petal_debug.19258.1274642976.ofugvhtngi
at lib/Petal.pm line 484.
1..1
# Looks like you failed 1 test of 1.

As Safe-2.27 is bundled with Perl 5.12.1, this will bite quite many people.

Thanks for your work on Petal,
-- 
Niko Tyni &#40;Debian Perl group&#41;
ntyni@debian.org
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-807191" href="/Public/Bug/Display.html?id=57787#txn-807191">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;21&nbsp;07:05:54&nbsp;2010</span>
    <span class="description">ANSGAR [...] cpan.org -  Cc ANSGAR added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-888812" href="/Public/Bug/Display.html?id=57787#txn-888812">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;28&nbsp;07:34:42&nbsp;2011</span>
    <span class="description">jquelin [...] cpan.org -  Cc JQUELIN added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-964066" href="/Public/Bug/Display.html?id=57787#txn-964066">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;05&nbsp;11:27:25&nbsp;2011</span>
    <span class="description">mathias.reitinger [...] loop0.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mathias.reitinger [...] loop0.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/964066/501687/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/501687">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 734b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">we have been using a modified[1] Petal version that works with perl 5.12
with CiderWebmail &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://ciderwebmail.org">http://ciderwebmail.org</a></span>&#41; for quite some time now.

i have been trying to reach the current maintainer &#40;Bruno Postle&#41; via
e-mail but the address listed in the README currently bounces.

if I am not able to reach the maintainer in the next few weeks I will
attempt to adopt this module so we can get a working version uploaded to
CPAN.

please note that I do not plan on any active development on petal other
than keeping it working with new perl versions - so if anyone is
interested in further development please go ahead!

[1] <span class="clickylink"><a target="new" rel="nofollow" href="http://arctic.loop0.org/~mathias/petal_perl_5.12.diff">http://arctic.loop0.org/~mathias/petal_perl_5.12.diff</a></span> - credit goes
to Stefan Seifert &#40;nine_AT_detonation_DOT_org&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-964069" href="/Public/Bug/Display.html?id=57787#txn-964069">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;05&nbsp;11:27:27&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-964450" href="/Public/Bug/Display.html?id=57787#txn-964450">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;05&nbsp;18:27:01&nbsp;2011</span>
    <span class="description">BPOSTLE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/964450/501886/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/501886">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 514b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Aug 05 11:27:25 2011, mreitinger wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; i have been trying to reach the current maintainer &#40;Bruno Postle&#41; via
&gt; e-mail but the address listed in the README currently bounces.
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; if I am not able to reach the maintainer in the next few weeks I will
&gt; attempt to adopt this module so we can get a working version uploaded to
&gt; CPAN.
</div>
Hi, my email is &lt;bruno@postle.net&gt;.

Though I still use Petal, I&#39;m not actively developing it. So yes I&#39;m
open to giving someone co-maintainership to get a new release out.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-965164" href="/Public/Bug/Display.html?id=57787#txn-965164">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;08&nbsp;13:21:45&nbsp;2011</span>
    <span class="description">gregoa [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> mathias.reitinger [...] loop0.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/965164/502268/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/502268">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 363b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Aug 05 11:27:25 2011, mreitinger wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; [1] <span class="clickylink"><a target="new" rel="nofollow" href="http://arctic.loop0.org/~mathias/petal_perl_5.12.diff">http://arctic.loop0.org/~mathias/petal_perl_5.12.diff</a></span> - credit goes
&gt; to Stefan Seifert &#40;nine_AT_detonation_DOT_org&#41;
</div>
Thanks for the patch!
Unfortunately it doesn&#39;t seem to fix _this_ bug, I still get the same
errors reported by Niko.

Cf. also <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/582805">http://bugs.debian.org/582805</a></span>

Cheers,
gregor, Debian Perl Group
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-966916" href="/Public/Bug/Display.html?id=57787#txn-966916">#</a>      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;14&nbsp;06:36:13&nbsp;2011</span>
    <span class="description">dam [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/966916/503133/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/503133">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 859b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">На Sun, 23 May 2010 22:36:47 +0300, ntyni@iki.fi написа:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Recent CPAN tester failures, for example this:
&gt; 
&gt;
</div><span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/07267724-b19f-3f77-b713-d32bba55d77f">http://www.cpantesters.org/cpan/report/07267724-b19f-3f77-b713-d32bba55d77f</a></span> 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; are caused by Safe.pm 2.27, which now wraps code refs returned from
</div>reval&#40;&#41;.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; The symptoms are
&gt; 
&gt; % perl -I ../Safe-2.27/blib/blib -I ../Safe-2.27/blib/arch
&gt; t/008_Quoted_Params.t
&gt;       &#40;in cleanup&#41; Can&#39;t locate object method &#34;process&#34; via package
&gt; &#34;Petal::Hash::Var&#34; &#40;perhaps you forgot to load &#34;Petal::Hash::Var&#34;?&#41; at
&gt; lib/Petal/Hash.pm line 188.
&gt; not ok 1 - ran
</div>
Here&#39;s a patch that removes usage of Safe &#40;and blind untainting&#41; from
_code_memory_cached. This has the potential to break other code that
feeds untainted text in tainted mode, but that code is broken already by
the Safe upgrade. At least the test suite now completes without problems.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> no-Safe.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/966916/503134/no-Safe.patch">Download no-Safe.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Description: drop usage of Safe in taint mode
 Safe 2.27 &#40;included in Perl 5.12.1&#41; adds a wrapper around code refs returned by reval. This causes severe problems in Petal internals.
Bug: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=57787">https://rt.cpan.org/Public/Bug/Display.html?id=57787</a></span>
Bug-Debian: <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/582805">http://bugs.debian.org/582805</a></span>
Author: Damyan Ivanov &lt;dmn@debian.org&gt;

--- a/lib/Petal.pm
+++ b/lib/Petal.pm
@@ -15,7 +15,6 @@ use Petal::Functions;
 use Petal::Entities;
 use File::Spec;
 use Carp;
-use Safe;
 use Data::Dumper;
 use Scalar::Util;
 use strict;
@@ -647,25 +646,9 @@ sub _code_memory_cached
 	my $code_perl = $self-&gt;_code_disk_cached;
 	my $VAR1 = undef;
 	
-	if &#40;$TAINT&#41;
-	{
-	    # important line, don&#39;t remove
-	    &#40;$code_perl&#41; = $code_perl =~ m/^&#40;.+&#41;$/s;
-	    die &#34;\$code_perl is empty after untainting!&#34; unless defined $code_perl &#38;&#38; $code_perl;
-	    my $cpt = Safe-&gt;new &#40;&#34;Petal::CPT&#34;&#41;;
-	    $cpt-&gt;permit &#40;&#39;entereval&#39;&#41;;
-	    $cpt-&gt;permit &#40;&#39;leaveeval&#39;&#41;;
-	    $cpt-&gt;permit &#40;&#39;require&#39;&#41;;
-	    $code = $cpt-&gt;reval&#40;$code_perl&#41;;
-	    confess &#40;&#34;Error in reval:\n&#34; . $@ . &#34;\n&#34; . $self-&gt;_code_with_line_numbers&#41; if $@;
-	    warn &#34;\$code is empty after reval.\n&#34; . Dumper&#40;$code, $Petal::CPT::VAR1, length&#40;$code_perl&#41;&#41; unless $code;
-	}
-	else
-	{
-	    eval &#34;$code_perl&#34;;
-	    confess &#40;$@ . &#34;\n&#34; . $self-&gt;_code_with_line_numbers&#41; if $@;
-	    $code = $VAR1;
-	}
+	eval &#34;$code_perl&#34;;
+	confess &#40;$@ . &#34;\n&#34; . $self-&gt;_code_with_line_numbers&#41; if $@;
+	$code = $VAR1;
 	
 	Petal::Cache::Memory-&gt;set &#40;$self-&gt;_file_path_with_macro, $code, $self-&gt;language&#41; if &#40;defined $MEMORY_CACHE and $MEMORY_CACHE&#41;;	
     }
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-966931" href="/Public/Bug/Display.html?id=57787#txn-966931">#</a>      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;14&nbsp;06:55:23&nbsp;2011</span>
    <span class="description">dam [...] cpan.org -  Cc DAM added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-971622" href="/Public/Bug/Display.html?id=57787#txn-971622">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;29&nbsp;03:36:59&nbsp;2011</span>
    <span class="description">nine [...] detonation.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/971622/505623/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/505623">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 288b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Applied both patches in this ticket and released Petal 2.20. Many thanks for the patch 
removing Safe usage. Though it has been a nice feature, AFAIK it has never been 
mentioned in any documentation and I just could not find a way to keep it working without 
a complete rewrite of Petal.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-971625" href="/Public/Bug/Display.html?id=57787#txn-971625">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;29&nbsp;03:37:00&nbsp;2011</span>
    <span class="description">nine [...] detonation.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.555547</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
