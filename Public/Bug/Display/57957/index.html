<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #57957 for DBD-ODBC: dbd_preparse not ignoring placeholders in comments</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #57957 for DBD-ODBC: dbd_preparse not ignoring placeholders in comments</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBD-ODBC">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBD-ODBC">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBD-ODBC">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBD-ODBC">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-ODBC">DBD-ODBC CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">57957</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBD-ODBC">DBD-ODBC</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
MPREWITT [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
prewittm [...] ms.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10188-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
1.23</li>
<li>
1.24</li>
</ul>
    </td>
  </tr>
  <tr id="CF-10189-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.24_2    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=57957">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-783778" href="/Public/Bug/Display.html?id=57957#txn-783778">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;28&nbsp;15:52:51&nbsp;2010</span>
    <span class="description">MPREWITT [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> prewittm [...] ms.com</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> dbd_preparse not ignoring placeholders in comments</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/783778/406010/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/406010">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">We encountered the &#39;DBD::ODBC does not yet support binding a named
parameter more than once&#39; error when something that looked like a
placeholder was found in the SQL comments part of a query like this:

/* $Date: 2010/05/01 12:00:00 */
select * from tb

The :00 and :00 were interpreted as placeholders.  I looked at
dbd_preparse in dbdimp.c and see why it is happening.  It looks like
there is no detection as to whether you are in or outside of a comment.
 If you look at the recent versions of dbdimp.c in DBD::Sybase, you&#39;ll
see they&#39;ve added code to detect this this situation and ignore anything
inside line or block comments:

        while &#40;*src&#41; {
                next_state = state; /* default situation */
        while &#40;*src&#41; {
                next_state = state; /* default situation */
                switch &#40;state&#41; {
                case DEFAULT:
                        if &#40;*src == &#39;\&#39;&#39; || *src == &#39;&#34;&#39;&#41; {
                                last_literal = *src;
                                next_state = LITERAL;
                        } else if &#40;*src == &#39;/&#39; &#38;&#38; *&#40;src+1&#41; == &#39;*&#39;&#41; {
                                next_state = COMMENT;
                        } else if &#40;*src == &#39;-&#39; &#38;&#38; *&#40;src+1&#41; == &#39;-&#39;&#41; {
                                next_state = LINE_COMMENT;
                        } else if &#40;*src == &#39;@&#39;&#41; {
                                varname[0] = &#39;@&#39;;
                                pos = 1;
                                next_state = VARIABLE;
                        }
                        break;
                case LITERAL:
                        if &#40;*src == last_literal&#41; {
                                next_state = DEFAULT;
                        }
                        break;
                case COMMENT:
                        if &#40;*&#40;src-1&#41; == &#39;*&#39; &#38;&#38; *src == &#39;/&#39;&#41; {
                                next_state = DEFAULT;
                        }
                        break;
                case LINE_COMMENT:
                        if &#40;*src == &#39;\n&#39;&#41; {
                                next_state = DEFAULT;
                        }
                        break;
                case VARIABLE:
                        if &#40;!isalnum&#40;*src&#41; &#38;&#38; *src != &#39;_&#39;&#41; {
                                varname[pos] = 0;
                                next_state = DEFAULT;
                        } else if &#40;pos &lt; VARNAME_LEN&#41; {
                                varname[pos++] = *src;
                        }
                }

It would be great to add this to the ODBC version of dbdimp.c &#40;looks
like it was originally copied from the DBD::Sybase implementation &#40;or a
common base&#41;&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-784849" href="/Public/Bug/Display.html?id=57957#txn-784849">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;01&nbsp;09:17:56&nbsp;2010</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/784849/406569/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/406569">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri May 28 15:52:51 2010, MPREWITT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; We encountered the &#39;DBD::ODBC does not yet support binding a named
&gt; parameter more than once&#39; error when something that looked like a
&gt; placeholder was found in the SQL comments part of a query like this:
&gt; 
&gt; /* $Date: 2010/05/01 12:00:00 */
&gt; select * from tb
&gt; 
&gt; The :00 and :00 were interpreted as placeholders.  I looked at
&gt; dbd_preparse in dbdimp.c and see why it is happening.  It looks like
&gt; there is no detection as to whether you are in or outside of a comment.
&gt;  If you look at the recent versions of dbdimp.c in DBD::Sybase, you&#39;ll
&gt; see they&#39;ve added code to detect this this situation and ignore anything
&gt; inside line or block comments:
&gt; 
&gt;       while &#40;*src&#41; {
&gt;               next_state = state; /* default situation */
&gt;       while &#40;*src&#41; {
&gt;               next_state = state; /* default situation */
&gt;               switch &#40;state&#41; {
&gt;               case DEFAULT:
&gt;                       if &#40;*src == &#39;\&#39;&#39; || *src == &#39;&#34;&#39;&#41; {
&gt;                               last_literal = *src;
&gt;                               next_state = LITERAL;
&gt;                       } else if &#40;*src == &#39;/&#39; &#38;&#38; *&#40;src+1&#41; == &#39;*&#39;&#41; {
&gt;                               next_state = COMMENT;
&gt;                       } else if &#40;*src == &#39;-&#39; &#38;&#38; *&#40;src+1&#41; == &#39;-&#39;&#41; {
&gt;                               next_state = LINE_COMMENT;
&gt;                       } else if &#40;*src == &#39;@&#39;&#41; {
&gt;                               varname[0] = &#39;@&#39;;
&gt;                               pos = 1;
&gt;                               next_state = VARIABLE;
&gt;                       }
&gt;                       break;
&gt;               case LITERAL:
&gt;                       if &#40;*src == last_literal&#41; {
&gt;                               next_state = DEFAULT;
&gt;                       }
&gt;                       break;
&gt;               case COMMENT:
&gt;                       if &#40;*&#40;src-1&#41; == &#39;*&#39; &#38;&#38; *src == &#39;/&#39;&#41; {
&gt;                               next_state = DEFAULT;
&gt;                       }
&gt;                       break;
&gt;               case LINE_COMMENT:
&gt;                       if &#40;*src == &#39;\n&#39;&#41; {
&gt;                               next_state = DEFAULT;
&gt;                       }
&gt;                       break;
&gt;               case VARIABLE:
&gt;                       if &#40;!isalnum&#40;*src&#41; &#38;&#38; *src != &#39;_&#39;&#41; {
&gt;                               varname[pos] = 0;
&gt;                               next_state = DEFAULT;
&gt;                       } else if &#40;pos &lt; VARNAME_LEN&#41; {
&gt;                               varname[pos++] = *src;
&gt;                       }
&gt;               }
&gt; 
&gt; It would be great to add this to the ODBC version of dbdimp.c &#40;looks
&gt; like it was originally copied from the DBD::Sybase implementation &#40;or a
&gt; common base&#41;&#41;.
</div>
I&#39;ve no idea where that code came from - before my time. I will try and
add this in 1.24_2.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-784852" href="/Public/Bug/Display.html?id=57957#txn-784852">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;01&nbsp;09:17:59&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-787729" href="/Public/Bug/Display.html?id=57957#txn-787729">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;07&nbsp;15:04:01&nbsp;2010</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/787729/408129/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/408129">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri May 28 15:52:51 2010, MPREWITT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; We encountered the &#39;DBD::ODBC does not yet support binding a named
&gt; parameter more than once&#39; error when something that looked like a
&gt; placeholder was found in the SQL comments part of a query like this:
&gt; 
&gt; /* $Date: 2010/05/01 12:00:00 */
&gt; select * from tb
&gt; 
&gt; The :00 and :00 were interpreted as placeholders.  I looked at
&gt; dbd_preparse in dbdimp.c and see why it is happening.  It looks like
&gt; there is no detection as to whether you are in or outside of a comment.
&gt;  If you look at the recent versions of dbdimp.c in DBD::Sybase, you&#39;ll
&gt; see they&#39;ve added code to detect this this situation and ignore anything
&gt; inside line or block comments:
&gt; 
&gt;       while &#40;*src&#41; {
&gt;               next_state = state; /* default situation */
&gt;       while &#40;*src&#41; {
&gt;               next_state = state; /* default situation */
&gt;               switch &#40;state&#41; {
&gt;               case DEFAULT:
&gt;                       if &#40;*src == &#39;\&#39;&#39; || *src == &#39;&#34;&#39;&#41; {
&gt;                               last_literal = *src;
&gt;                               next_state = LITERAL;
&gt;                       } else if &#40;*src == &#39;/&#39; &#38;&#38; *&#40;src+1&#41; == &#39;*&#39;&#41; {
&gt;                               next_state = COMMENT;
&gt;                       } else if &#40;*src == &#39;-&#39; &#38;&#38; *&#40;src+1&#41; == &#39;-&#39;&#41; {
&gt;                               next_state = LINE_COMMENT;
&gt;                       } else if &#40;*src == &#39;@&#39;&#41; {
&gt;                               varname[0] = &#39;@&#39;;
&gt;                               pos = 1;
&gt;                               next_state = VARIABLE;
&gt;                       }
&gt;                       break;
&gt;               case LITERAL:
&gt;                       if &#40;*src == last_literal&#41; {
&gt;                               next_state = DEFAULT;
&gt;                       }
&gt;                       break;
&gt;               case COMMENT:
&gt;                       if &#40;*&#40;src-1&#41; == &#39;*&#39; &#38;&#38; *src == &#39;/&#39;&#41; {
&gt;                               next_state = DEFAULT;
&gt;                       }
&gt;                       break;
&gt;               case LINE_COMMENT:
&gt;                       if &#40;*src == &#39;\n&#39;&#41; {
&gt;                               next_state = DEFAULT;
&gt;                       }
&gt;                       break;
&gt;               case VARIABLE:
&gt;                       if &#40;!isalnum&#40;*src&#41; &#38;&#38; *src != &#39;_&#39;&#41; {
&gt;                               varname[pos] = 0;
&gt;                               next_state = DEFAULT;
&gt;                       } else if &#40;pos &lt; VARNAME_LEN&#41; {
&gt;                               varname[pos++] = *src;
&gt;                       }
&gt;               }
&gt; 
&gt; It would be great to add this to the ODBC version of dbdimp.c &#40;looks
&gt; like it was originally copied from the DBD::Sybase implementation &#40;or a
&gt; common base&#41;&#41;.
</div>
Should be fixed in the subversion trunk now.
I added support for inline comments &#40;/* comment */&#41; and line comments
&#40;-- comment ends on newline&#41;.

I&#39;ve also added some tests for it.

If you want to give it a go send me you Perl distribution/platform
&#40;e.g., if ActiveState, Strawberry or UNIX&#41; and I&#39;ll mail you
instructions. I will probably release 1.24_2 with this change to CPAN
shortly.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-787766" href="/Public/Bug/Display.html?id=57957#txn-787766">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;07&nbsp;15:34:19&nbsp;2010</span>
    <span class="description">marc.prewitt [...] morganstanley.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> &#34;Banai, Zoltan&#34; &lt;Zoltan.Banai [...] morganstanley.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #57957] dbd_preparse not ignoring placeholders in comments </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 7 Jun 2010 15:33:20 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-DBD-ODBC [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Prewitt, Marc&#34; &lt;Marc.Prewitt [...] morganstanley.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/787766/408152/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/408152">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks Martin.  We&#39;re using perl 5.10/unix.  We&#39;ll give it a try.

Zoltan,

If we can try this out in /ms/dev I can test it out there.

Thanks,
Marc

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Martin J Evans via RT [mailto:bug-DBD-ODBC@rt.cpan.org] 
Sent: Monday, June 07, 2010 3:04 PM
To: MPREWITT@cpan.org
Cc: Prewitt, Marc &#40;IT&#41;
Subject: [rt.cpan.org #57957] dbd_preparse not ignoring placeholders in comments 

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=57957">https://rt.cpan.org/Ticket/Display.html?id=57957</a></span> &gt;

On Fri May 28 15:52:51 2010, MPREWITT wrote:
<div class="message-stanza open">&gt; We encountered the &#39;DBD::ODBC does not yet support binding a named
&gt; parameter more than once&#39; error when something that looked like a
&gt; placeholder was found in the SQL comments part of a query like this:
&gt; 
&gt; /* $Date: 2010/05/01 12:00:00 */
&gt; select * from tb
&gt; 
&gt; The :00 and :00 were interpreted as placeholders.  I looked at
&gt; dbd_preparse in dbdimp.c and see why it is happening.  It looks like
&gt; there is no detection as to whether you are in or outside of a comment.
&gt;  If you look at the recent versions of dbdimp.c in DBD::Sybase, you&#39;ll
&gt; see they&#39;ve added code to detect this this situation and ignore anything
&gt; inside line or block comments:
&gt; 
&gt;       while &#40;*src&#41; {
&gt;               next_state = state; /* default situation */
&gt;       while &#40;*src&#41; {
&gt;               next_state = state; /* default situation */
&gt;               switch &#40;state&#41; {
&gt;               case DEFAULT:
&gt;                       if &#40;*src == &#39;\&#39;&#39; || *src == &#39;&#34;&#39;&#41; {
&gt;                               last_literal = *src;
&gt;                               next_state = LITERAL;
&gt;                       } else if &#40;*src == &#39;/&#39; &#38;&#38; *&#40;src+1&#41; == &#39;*&#39;&#41; {
&gt;                               next_state = COMMENT;
&gt;                       } else if &#40;*src == &#39;-&#39; &#38;&#38; *&#40;src+1&#41; == &#39;-&#39;&#41; {
&gt;                               next_state = LINE_COMMENT;
&gt;                       } else if &#40;*src == &#39;@&#39;&#41; {
&gt;                               varname[0] = &#39;@&#39;;
&gt;                               pos = 1;
&gt;                               next_state = VARIABLE;
&gt;                       }
&gt;                       break;
&gt;               case LITERAL:
&gt;                       if &#40;*src == last_literal&#41; {
&gt;                               next_state = DEFAULT;
&gt;                       }
&gt;                       break;
&gt;               case COMMENT:
&gt;                       if &#40;*&#40;src-1&#41; == &#39;*&#39; &#38;&#38; *src == &#39;/&#39;&#41; {
&gt;                               next_state = DEFAULT;
&gt;                       }
&gt;                       break;
&gt;               case LINE_COMMENT:
&gt;                       if &#40;*src == &#39;\n&#39;&#41; {
&gt;                               next_state = DEFAULT;
&gt;                       }
&gt;                       break;
&gt;               case VARIABLE:
&gt;                       if &#40;!isalnum&#40;*src&#41; &#38;&#38; *src != &#39;_&#39;&#41; {
&gt;                               varname[pos] = 0;
&gt;                               next_state = DEFAULT;
&gt;                       } else if &#40;pos &lt; VARNAME_LEN&#41; {
&gt;                               varname[pos++] = *src;
&gt;                       }
&gt;               }
&gt; 
&gt; It would be great to add this to the ODBC version of dbdimp.c &#40;looks
&gt; like it was originally copied from the DBD::Sybase implementation &#40;or a
&gt; common base&#41;&#41;.
</div>
Should be fixed in the subversion trunk now.
I added support for inline comments &#40;/* comment */&#41; and line comments
&#40;-- comment ends on newline&#41;.

I&#39;ve also added some tests for it.

If you want to give it a go send me you Perl distribution/platform
&#40;e.g., if ActiveState, Strawberry or UNIX&#41; and I&#39;ll mail you
instructions. I will probably release 1.24_2 with this change to CPAN
shortly.

Martin
-- 
Martin J. Evans
Wetherby, UK

--------------------------------------------------------------------------
NOTICE: If received in error, please destroy, and notify sender. Sender does not intend to waive confidentiality or privilege. Use of this email is prohibited when received in error. We may monitor and store emails to the extent permitted by applicable law.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-788016" href="/Public/Bug/Display.html?id=57957#txn-788016">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;08&nbsp;04:00:10&nbsp;2010</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/788016/408269/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/408269">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 997b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jun 07 15:34:19 2010, marc.prewitt@morganstanley.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks Martin.  We&#39;re using perl 5.10/unix.  We&#39;ll give it a try.
&gt; 
&gt; Zoltan,
&gt; 
&gt; If we can try this out in /ms/dev I can test it out there.
&gt; 
&gt; Thanks,
&gt; Marc
</div>

If you have a subversion client then do:

svn checkout <span class="clickylink"><a target="new" rel="nofollow" href="http://svn.perl.org/modules/dbd-odbc/trunk">http://svn.perl.org/modules/dbd-odbc/trunk</a></span> &lt;your directory
name here&gt;

If you use an HTTP proxy you may need your http_proxy env var setting.

Alternatively, mail me &#40;mjevans at cpan dot org&#41; and I&#39;ll send you a
copy of the trunk.

cd &lt;your directory name here&gt;
export DBI_DSN=dbi:ODBC:yourdsn
export DBI_USER=db_username
export DBI_PASS=db_password
perl Makefile.PL
make
make test

The test t/rt_57957.t has a few minor tests for placeholders in comments
and literals.

To run your own perl with this DBD::ODBC either:

perl -I&lt;your directory name here&gt;/blib/lib
     -I&lt;your_directory_name_here&gt;/blib/arch myperl.pl

or make install it.

Let me know how you get on.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-790374" href="/Public/Bug/Display.html?id=57957#txn-790374">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;13&nbsp;14:57:36&nbsp;2010</span>
    <span class="description">marc.prewitt [...] morganstanley.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #57957] dbd_preparse not ignoring placeholders in comments</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 13 Jun 2010 14:57:25 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-DBD-ODBC [...] rt.cpan.org&gt;, &lt;MPREWITT [...] cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Prewitt, Marc&#34; &lt;Marc.Prewitt [...] morganstanley.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/790374/409527/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/409527">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Initial testing looks good. I&#39;m going to run this version on our devel system for a while and see if anything comes up. 

Thanks,
Marc


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">----- Original Message -----
From: Martin J Evans via RT &lt;bug-DBD-ODBC@rt.cpan.org&gt;
To: MPREWITT@cpan.org &lt;MPREWITT@cpan.org&gt;
Cc: Prewitt, Marc &#40;IT&#41;
Sent: Tue Jun 08 04:00:12 2010
Subject: [rt.cpan.org #57957] dbd_preparse not ignoring placeholders in comments 

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=57957">https://rt.cpan.org/Ticket/Display.html?id=57957</a></span> &gt;

On Mon Jun 07 15:34:19 2010, marc.prewitt@morganstanley.com wrote:
<div class="message-stanza open">&gt; Thanks Martin.  We&#39;re using perl 5.10/unix.  We&#39;ll give it a try.
&gt; 
&gt; Zoltan,
&gt; 
&gt; If we can try this out in /ms/dev I can test it out there.
&gt; 
&gt; Thanks,
&gt; Marc
</div>

If you have a subversion client then do:

svn checkout <span class="clickylink"><a target="new" rel="nofollow" href="http://svn.perl.org/modules/dbd-odbc/trunk">http://svn.perl.org/modules/dbd-odbc/trunk</a></span> &lt;your directory
name here&gt;

If you use an HTTP proxy you may need your http_proxy env var setting.

Alternatively, mail me &#40;mjevans at cpan dot org&#41; and I&#39;ll send you a
copy of the trunk.

cd &lt;your directory name here&gt;
export DBI_DSN=dbi:ODBC:yourdsn
export DBI_USER=db_username
export DBI_PASS=db_password
perl Makefile.PL
make
make test

The test t/rt_57957.t has a few minor tests for placeholders in comments
and literals.

To run your own perl with this DBD::ODBC either:

perl -I&lt;your directory name here&gt;/blib/lib
     -I&lt;your_directory_name_here&gt;/blib/arch myperl.pl

or make install it.

Let me know how you get on.

Martin
-- 
Martin J. Evans
Wetherby, UK

--------------------------------------------------------------------------
NOTICE: If received in error, please destroy, and notify sender. Sender does not intend to waive confidentiality or privilege. Use of this email is prohibited when received in error. We may monitor and store emails to the extent permitted by applicable law.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-792620" href="/Public/Bug/Display.html?id=57957#txn-792620">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;17&nbsp;16:28:01&nbsp;2010</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/792620/410836/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/410836">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 422b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Jun 13 14:57:36 2010, marc.prewitt@morganstanley.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Initial testing looks good. I&#39;m going to run this version on our devel
&gt;    system for a while and see if anything comes up. 
&gt; 
&gt; Thanks,
&gt; Marc
</div>
How are you getting on with this. I am close to doing a new development
release and would like some reassurance that this change has worked and
not broken something.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-808214" href="/Public/Bug/Display.html?id=57957#txn-808214">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;23&nbsp;14:24:04&nbsp;2010</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/808214/418984/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/418984">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 608b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jun 17 16:28:01 2010, MJEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sun Jun 13 14:57:36 2010, marc.prewitt@morganstanley.com wrote:
<div class="message-stanza open">&gt; &gt; Initial testing looks good. I&#39;m going to run this version on our devel
&gt; &gt;    system for a while and see if anything comes up. 
&gt; &gt; 
&gt; &gt; Thanks,
&gt; &gt; Marc
</div>&gt; 
&gt; How are you getting on with this. I am close to doing a new development
&gt; release and would like some reassurance that this change has worked and
&gt; not broken something.
&gt; 
&gt; Martin
</div>
This is fixed in DBD::ODBC 1.24_2 which is on its way to CPAN and I will
close it as soon as rt sees 1.24_2.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-808398" href="/Public/Bug/Display.html?id=57957#txn-808398">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;24&nbsp;04:31:14&nbsp;2010</span>
    <span class="description">bohica [...] ntlworld.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-808400" href="/Public/Bug/Display.html?id=57957#txn-808400">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;24&nbsp;04:31:15&nbsp;2010</span>
    <span class="description">bohica [...] ntlworld.com -  Fixed in 1.24_2 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.550554</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
