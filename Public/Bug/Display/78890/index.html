<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #78890 for Socket: Windows support for IPv6 - there, but broken in this release</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #78890 for Socket: Windows support for IPv6 - there, but broken in this release</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Socket">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Socket">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Socket">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Socket">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Socket">Socket CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">78890</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Socket">Socket</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
VINSWORLD [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-29154-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.002    </td>
  </tr>
  <tr id="CF-29155-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
2.005    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




v4v6Lookup.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1107895/582505/v4v6Lookup.pl">
Fri Aug 10 11:32:28 2012 (2.9k) by VINSWORLD [...] cpan.org
</a>
</font></li>
</ul>


ws2tcpip-win.h<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1107895/582506/ws2tcpip-win.h">
Fri Aug 10 11:32:28 2012 (1.3k) by VINSWORLD [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=78890">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1107895" href="/Public/Bug/Display.html?id=78890#txn-1107895">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;10&nbsp;11:32:28&nbsp;2012</span>
    <span class="description">VINSWORLD [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Windows support for IPv6 - there, but broken in this release</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1107895/582504/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/582504">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Windows 7 x64 / Strawberry Perl 5.14.2, 5.16.1 both using latest Socket 
2.002 from CPAN:

Socket::inet_ntop not implemented on this architecture at C:\Users\ ...

inet_ntop is certainly available on Windows 7.  Seems the gcc include 
files and lib files may be lacking?  Using the following process, I can 
write a C program using get*info calls and inet_ntop / pton and they 
work correctly.

Quick fix for Perl Socket module, but doesn&#39;t resolve completely:

add to ws2tcpip.h line 304:

#include &lt;ws2tcpip-win.h&gt;

--
Attached file is the ws2tcpip-win.h file.  Additionally, create new 
libws2-32.a library:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; pexports \Windows\system32\ws2_32.dll &gt; WS2_32.def
&gt; dlltool --as-flags=--64 -m i386:x86-64 -k --output-lib libws2_32-new.a 
</div>--input-def WS2_32.def

Put both files in locations:

\strawberry\c\x86_64-w64-mingw32\include\ws2tcpip-win.h
\strawberry\c\x86_64-w64-mingw32\lib\libws2_32-new.a

Edit generated Makefile:

DEFINE = -DHAS_IP_MREQ -DHAS_GETADDRINFO -DHAS_GETNAMEINFO -
DHAS_INETNTOP -DHAS_INETPTON -DAF_INET6 -DHAS_SOCKADDR_IN6

LDLOADLIBS = -lmoldname -lkernel32 -luser32 -lgdi32 -lwinspool -
lcomdlg32 -ladvapi32 -lshell32 -lole32 -loleaut32 -lnetapi32 -luuid -
lws2_32 -lmpr -lwinmm -lversion -lodbc32 -lodbccp32 -lcomctl32 -lws2_32-
new

dmake test

But ... still errors:

Socket-2.002&gt; perl -Mblib ..\..\tmp\v4v6Lookup.pl
OLD: gethostbyname&#40;&#41;/inet_ntoa&#40;&#41; Address = 10.200.200.254
OLD: gethostbyname&#40;&#41;/inet_ntoa&#40;&#41; Address = 10.100.100.254
OLD: gethostbyname&#40;&#41;/inet_ntoa&#40;&#41; Address = 192.168.100.254
OLD: gethostbyname&#40;&#41;/inet_ntoa&#40;&#41; Address = 192.168.10.101
OLD: gethostbyname&#40;&#41;/inet_ntoa&#40;&#41; Address = 192.168.12.1
OLD: gethostbyname&#40;&#41;/inet_ntoa&#40;&#41; Address = 192.168.58.1
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 3000:6e00:7273:6500::
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 3000:6e00:7273:6500::
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 3000:6e00:7273:6500::
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 3000:6e00:7273:6500::
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 3000:6e00:7273:6500::
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 3000:6e00:7273:6500::
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 192.168.12.1
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 192.168.58.1
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 192.168.10.101
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 10.200.200.254
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 10.100.100.254
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 192.168.100.254

Notice the IPv6 addresses are wrong.  They correctly resolve with Perl 
5.12.3 using Socket::GetAddrInfo and the above process:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; perl v4v6Lookup.pl
</div>OLD: gethostbyname&#40;&#41;/inet_ntoa&#40;&#41; Address = 10.200.200.254
OLD: gethostbyname&#40;&#41;/inet_ntoa&#40;&#41; Address = 10.100.100.254
OLD: gethostbyname&#40;&#41;/inet_ntoa&#40;&#41; Address = 192.168.100.254
OLD: gethostbyname&#40;&#41;/inet_ntoa&#40;&#41; Address = 192.168.10.101
OLD: gethostbyname&#40;&#41;/inet_ntoa&#40;&#41; Address = 192.168.12.1
OLD: gethostbyname&#40;&#41;/inet_ntoa&#40;&#41; Address = 192.168.58.1
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = fe80::eda4:ae73:XXXX:YYYY
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = fe80::8923:a275:XXXX:YYYY
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = fe80::3db7:ac68:XXXX:YYYY
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 
2001:470:1f07:157c:3db7:ac68:XXXX:YYYY
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = fe80::c4d5:7cb1:XXXX:YYYY
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = fe80::f800:da27:XXXX:YYYY
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 192.168.12.1
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 192.168.58.1
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 192.168.10.101
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 10.200.200.254
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 10.100.100.254
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 192.168.100.254

NOTE:  XXXX:YYYY added to obscure addresses.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> v4v6Lookup.pl</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1107895/582505/v4v6Lookup.pl">Download v4v6Lookup.pl</a><br />
<span class="downloadcontenttype">text/x-perl 2.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl

use strict;
use warnings;
use Getopt::Long qw&#40;:config no_ignore_case&#41;;
use Pod::Usage;

use if $] &lt;  5.014, &#34;Socket&#34; =&gt; qw&#40;inet_ntoa unpack_sockaddr_in IPPROTO_TCP AF_INET AF_UNSPEC&#41;;
use if $] &lt;  5.014, &#34;Socket6&#34;;
use if $] &lt;  5.014, &#34;Socket::GetAddrInfo&#34; =&gt; qw&#40;getaddrinfo getnameinfo&#41;;
use if $] &gt;= 5.014, &#34;Socket&#34; =&gt; qw&#40;:addrinfo inet_ntoa inet_ntop unpack_sockaddr_in unpack_sockaddr_in6 IPPROTO_TCP AF_INET AF_UNSPEC&#41;;
use Sys::Hostname;

my %opt;
my &#40;$opt_help, $opt_man&#41;;

GetOptions&#40;
  &#39;new!&#39;     =&gt; \$opt{new},
  &#39;old!&#39;     =&gt; \$opt{old},
  &#39;reverse!&#39; =&gt; \$opt{rev},
  &#39;help!&#39;    =&gt; \$opt_help,
  &#39;man!&#39;     =&gt; \$opt_man
&#41; or pod2usage&#40;-verbose =&gt; 0&#41;;

pod2usage&#40;-verbose =&gt; 1&#41; if defined $opt_help;
pod2usage&#40;-verbose =&gt; 2&#41; if defined $opt_man;

if &#40;!@ARGV&#41; {
    $ARGV[0] = hostname;
}

if &#40;&#40;!defined&#40;$opt{new}&#41;&#41; &#38;&#38; &#40;!defined&#40;$opt{old}&#41;&#41;&#41; {
    $opt{new} = $opt{old} = 1
}

if &#40;$opt{old}&#41; {
    if &#40;my @gethost = gethostbyname&#40;$ARGV[0]&#41;&#41; {
        for &#40;4..$#gethost&#41; {
            my $addr = inet_ntoa&#40;$gethost[$_]&#41;;
            print &#34;OLD: gethostbyname&#40;&#41;/inet_ntoa&#40;&#41; Address = $addr\n&#34;;

            if &#40;$opt{rev}&#41; {
                my $host = gethostbyaddr&#40;$gethost[$_], AF_INET&#41;;
                printf &#34; |_&gt;   gethostbyaddr&#40;&#41;              Name = %s\n&#34;, &#40;defined&#40;$host&#41;&#41; ? $host : &#39;&#39;
            }
        }
    } else {
        print &#34;$0: gethostbyname&#40;&#41; failed\n&#34;
    }
}

if &#40;$opt{new}&#41; {
    my %hints = &#40;
        family =&gt; AF_UNSPEC,
        protocol =&gt; IPPROTO_TCP
    &#41;;
    my &#40;$err, @getaddr&#41; = getaddrinfo&#40;$ARGV[0], undef, \%hints&#41;;
    if &#40;defined&#40;$getaddr[0]&#41;&#41; {
        for my $addr &#40;@getaddr&#41; {
            my $address;
            if &#40;$addr-&gt;{family} == AF_INET&#41; {
                $address = unpack_sockaddr_in&#40;$addr-&gt;{addr}&#41;
            } else {
                $address = unpack_sockaddr_in6&#40;$addr-&gt;{addr}&#41;
            }

            my $host = inet_ntop&#40;$addr-&gt;{family}, $address&#41;;
            print  &#34;NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = $host\n&#34;;

            if &#40;$opt{rev}&#41; {
                my &#40;$err, $host, $service&#41; = getnameinfo&#40;$addr-&gt;{addr}, NI_NAMEREQD&#41;;
                printf &#34; |_&gt;   getnameinfo&#40;&#41;                Name = %s\n&#34;, &#40;defined&#40;$host&#41;&#41; ? $host : $err
            }
        }
    } else {
        print &#34;$0: getaddrinfo&#40;&#41; failed - error = $err\n&#34;
    }
}

__END__

=head1 SYNOPSIS

 v4v6Lookup [options] [IP[v6]_address | hostname]

=head1 OPTIONS

 hostname         Name or IP[v6] to lookup.

 -n, --new        Use the new getaddrinfo&#40;&#41;/inet_ntop&#40;&#41;
                    functions.
                    DEFAULT:  &#40;or not specified&#41; Both.

 -o, --old        Use the old gethostbyname&#40;&#41;/inet_ntoa&#40;&#41;
                    functions.
                    DEFAULT:  &#40;or not specified&#41; Both.

 -r, --reverse    Do number to name lookup on resolved output.
                    DEFAULT:  &#40;or not specified&#41; no reverse.

 --help           Print Options and Arguments.
 --man            Print complete man page.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> ws2tcpip-win.h</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1107895/582506/ws2tcpip-win.h">Download ws2tcpip-win.h</a><br />
<span class="downloadcontenttype">text/x-chdr 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#ifndef WS2TCPIP_WIN_H
#define WS2TCPIP_WIN_H

typedef USHORT ADDRESS_FAMILY;

#if &#40;NTDDI_VERSION &gt;= NTDDI_VISTA&#41;
WINSOCK_API_LINKAGE INT WSAAPI inet_pton&#40;INT, PCSTR, PVOID&#41;;
WINSOCK_API_LINKAGE INT WSAAPI InetPtonW&#40;INT, PCWSTR, PVOID&#41;;

WINSOCK_API_LINKAGE PCSTR WSAAPI inet_ntop&#40;INT, PVOID, PSTR, size_t&#41;;
WINSOCK_API_LINKAGE PCWSTR WSAAPI InetNtopW&#40;INT, PVOID, PWSTR, size_t&#41;;

#define InetPtonA       inet_pton
#define InetNtopA       inet_ntop

#ifdef UNICODE
#define InetPton        InetPtonW
#define InetNtop        InetNtopW
#else
#define InetPton        InetPtonA
#define InetNtop        InetNtopA
#endif

#if INCL_WINSOCK_API_TYPEDEFS
typedef INT &#40;WSAAPI * LPFN_INET_PTONA&#41;&#40;INT Family, PCSTR pszAddrString, PVOID pAddrBuf&#41;;
typedef INT &#40;WSAAPI * LPFN_INET_PTONW&#41;&#40;INT Family, PCWSTR pszAddrString, PVOID pAddrBuf&#41;;

typedef PCSTR &#40;WSAAPI * LPFN_INET_NTOPA&#41;&#40;INT Family, PVOID pAddr, PSTR pStringBuf, size_t StringBufSize&#41;;
typedef PCWSTR &#40;WSAAPI * LPFN_INET_NTOPW&#41;&#40;INT Family, PVOID pAddr, PWSTR pStringBuf, size_t StringBufSize&#41;;

#ifdef UNICODE
#define LPFN_INET_PTON          LPFN_INET_PTONW
#define LPFN_INET_NTOP          LPFN_INET_NTOPW
#else
#define LPFN_INET_PTON          LPFN_INET_PTONA
#define LPFN_INET_NTOP          LPFN_INET_NTOPA
#endif

#endif  //  TYPEDEFS
#endif  //  &#40;NTDDI_VERSION &gt;= NTDDI_VISTA&#41;

#endif
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1109875" href="/Public/Bug/Display.html?id=78890#txn-1109875">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;16&nbsp;15:03:05&nbsp;2012</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1109875/583579/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/583579">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Aug 10 11:32:28 2012, VINSWORLD wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Windows 7 x64 / Strawberry Perl 5.14.2, 5.16.1 both using latest Socket 
&gt; 2.002 from CPAN:
&gt; 
&gt; Socket::inet_ntop not implemented on this architecture at C:\Users\ ...
&gt; 
&gt; inet_ntop is certainly available on Windows 7.  Seems the gcc include 
&gt; files and lib files may be lacking?  Using the following process, I can 
&gt; write a C program using get*info calls and inet_ntop / pton and they 
&gt; work correctly.
&gt; 
&gt; Quick fix for Perl Socket module, but doesn&#39;t resolve completely:
&gt; 
&gt; add to ws2tcpip.h line 304:
&gt; 
&gt; #include &lt;ws2tcpip-win.h&gt;
&gt; 
&gt; --
&gt; Attached file is the ws2tcpip-win.h file.  Additionally, create new 
&gt; libws2-32.a library:
&gt; 
<div class="message-stanza open">&gt; &gt; pexports \Windows\system32\ws2_32.dll &gt; WS2_32.def
&gt; &gt; dlltool --as-flags=--64 -m i386:x86-64 -k --output-lib libws2_32-new.a 
</div>&gt; --input-def WS2_32.def
&gt; 
&gt; Put both files in locations:
&gt; 
&gt; \strawberry\c\x86_64-w64-mingw32\include\ws2tcpip-win.h
&gt; \strawberry\c\x86_64-w64-mingw32\lib\libws2_32-new.a
&gt; 
&gt; Edit generated Makefile:
&gt; 
&gt; DEFINE = -DHAS_IP_MREQ -DHAS_GETADDRINFO -DHAS_GETNAMEINFO -
&gt; DHAS_INETNTOP -DHAS_INETPTON -DAF_INET6 -DHAS_SOCKADDR_IN6
&gt; 
&gt; LDLOADLIBS = -lmoldname -lkernel32 -luser32 -lgdi32 -lwinspool -
&gt; lcomdlg32 -ladvapi32 -lshell32 -lole32 -loleaut32 -lnetapi32 -luuid -
&gt; lws2_32 -lmpr -lwinmm -lversion -lodbc32 -lodbccp32 -lcomctl32 -lws2_32-
&gt; new
&gt; 
&gt; dmake test
</div>
This sounds like quite a long complex workaround here. Hopefully we can
find a neater solution; this level of hackery ought not be necessary.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; But ... still errors:
</div>
Yes, that&#39;s due to a bug in your v4v6Lookup.pl. It failed the same way
for me on Linux:

$ perl -Mblib v4v6Lookup.pl cel.leonerd.org.uk
OLD: gethostbyname&#40;&#41;/inet_ntoa&#40;&#41; Address = 81.187.167.226
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 81.187.167.226
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 3000:a7e2:7f:0:e8e0:4a91

$ perl -Mblib v4v6Lookup.pl cel.leonerd.org.uk
OLD: gethostbyname&#40;&#41;/inet_ntoa&#40;&#41; Address = 81.187.167.226
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 48.0.110.1
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 3000:6e01::b80e:c84d:ee7

That itself looks like a bug in Socket, perhaps using some uninitialised
memory. I&#39;ll hunt it down later.


unpack_sockaddr_in and _in6 return a list, whose first element is the
port number and the second is the raw IPv4 or v6 address. Lines 61-65
ought to read:

 61             if &#40;$addr-&gt;{family} == AF_INET&#41; {
 62                 &#40;undef, $address&#41; = unpack_sockaddr_in&#40;$addr-&gt;{addr}&#41;
 63             } else {
 64                 &#40;undef, $address&#41; = unpack_sockaddr_in6&#40;$addr-&gt;{addr}&#41;
 65             }

With this change in place, it now behaves as expected:

$ perl -Mblib v4v6Lookup.pl cel.leonerd.org.uk
OLD: gethostbyname&#40;&#41;/inet_ntoa&#40;&#41; Address = 81.187.167.226
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 81.187.167.226
NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 2001:8b0:3f7::2

Try that change, and see if yours now works.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1109878" href="/Public/Bug/Display.html?id=78890#txn-1109878">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;16&nbsp;15:03:06&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1109939" href="/Public/Bug/Display.html?id=78890#txn-1109939">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;16&nbsp;15:47:57&nbsp;2012</span>
    <span class="description">vinsworldcom [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #78890] Windows support for IPv6 - there, but broken in this release</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 16 Aug 2012 15:47:41 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Socket [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Vince &lt;vin [...] vinsworld.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1109939/583602/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/583602">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 7.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Wow.  I *hate* it when I&#39;m the culprit of a fix easily obtained with a
RTFM solution.  My apologies for the mistake in my script that
incorrectly attributed an error to Socket.pm.  Thanks for taking the
time to respond and set me straight and not just let this fade away.
Very much appreciate the work you&#39;re doing to get IPv6 working in
Perl.

When I *correctly* implemented the unpack_sockaddr_in&#40;6&#41; routines as
per your recommendation, the script using Socket 2.004 indeed worked.

Weird that the mistakes in my code did produce the correct results on
Perl 5.12.3 using the Socket6 module.  Anyway, not for further concern
on this topic / forum.

HOWEVER:
A simple:

perl Makefile.PL
dmake
dmake test
perl -Mblib v4v6lookup.pl

still failed with the Socket::inet_ntop error.  My elaborate
jiggery-pokery GCC messing about was needed for Socket to compile and
then produce the correct result &#40;after fixing my script&#41; on Windows.
I&#39;ve included the build process below, although like I said, this
ultimately seems to be a GCC library / include file issue not related
to the Socket module.

Go ahead and close this ticket.

----&lt;Socket 2.004 build process output&gt;----
VinsWorldcom@C:\Users\VinsWorldcom\Downloads\Socket-2.004&gt; perl Makefile.PL
Checking HAS_SOCKADDR_SA_LEN...
test-0.c: In function &#39;main&#39;:
test-0.c:15: error: &#39;struct sockaddr&#39; has no member named &#39;sa_len&#39;
Checking HAS_SOCKADDR_IN6...
Checking HAS_SIN6_SCOPE_ID...
Checking HAS_IP_MREQ...
Checking HAS_IPV6_MREQ...
Checking if your kit is complete...
Looks good
Writing Makefile for Socket

VinsWorldcom@C:\Users\VinsWorldcom\Downloads\Socket-2.004&gt; dmake
cp Socket.pm blib\lib\Socket.pm
C:\strawberry\perl\bin\perl.exe C:\strawberry\perl\lib\ExtUtils\xsubpp
-noprototypes -typemap C:\strawberry\perl\lib\ExtUtils\typemap
-typemap typemap  Socket.xs &gt; Socket.xsc &#38;&#38;
C:\strawberry\perl\bin\perl.exe -MExtUtils::Command -e &#34;mv&#34; --
Socket.xsc Socket.c
gcc -c          -s -O2 -DWIN32 -DHAVE_DES_FCRYPT -DWIN64
-DCONSERVATIVE -DUSE_SITECUSTOMIZE -DPERL_IMPLICIT_CONTEXT
-DPERL_IMPLICIT_SYS -fno-strict-aliasing -mms-bitfields
-DPERL_MSVCRT_READFIX -s -O2          -DVERSION=\&#34;2.004\&#34;   -DXS_VER
SION=\&#34;2.004\&#34;  &#34;-IC:\strawberry\perl\lib\CORE&#34;  -DHAS_SOCKADDR_IN6
-DHAS_SIN6_SCOPE_ID -DHAS_IP_MREQ -DHAS_IPV6_MREQ Socket.c
Socket.xs: In function &#39;XS_Socket_pack_sockaddr_un&#39;:
Socket.xs:699: warning: cast to pointer from integer of different size
Socket.xs: In function &#39;XS_Socket_unpack_sockaddr_un&#39;:
Socket.xs:745: warning: cast to pointer from integer of different size
Socket.xs: In function &#39;XS_Socket_inet_ntop&#39;:
Socket.xs:920: warning: cast to pointer from integer of different size
Socket.xs: In function &#39;XS_Socket_inet_pton&#39;:
Socket.xs:962: warning: cast to pointer from integer of different size
Running Mkbootstrap for Socket &#40;&#41;
C:\strawberry\perl\bin\perl.exe -MExtUtils::Command -e &#34;chmod&#34; -- 644 Socket.bs
C:\strawberry\perl\bin\perl.exe -MExtUtils::Mksymlists \
     -e &#34;Mksymlists&#40;&#39;NAME&#39;=&gt;\&#34;Socket\&#34;, &#39;DLBASE&#39; =&gt; &#39;Socket&#39;,
&#39;DL_FUNCS&#39; =&gt; {  }, &#39;FUNCLIST&#39; =&gt; [], &#39;IMPORTS&#39; =&gt; {  }, &#39;DL_VARS&#39; =&gt;
[]&#41;;&#34;
dlltool --def Socket.def --output-exp dll.exp
g++ -o blib\arch\auto\Socket\Socket.dll -Wl,--base-file -Wl,dll.base
-mdll -s -L&#34;C:\strawberry\perl\lib\CORE&#34; -L&#34;C:\strawberry\c\lib&#34;
Socket.o -Wl,--image-base,0x361b0000
C:\strawberry\perl\lib\CORE\libperl512.a -lmoldname -lkernel32
-luser32 -lgdi32 -lwinspool -lcomdlg32 -ladvapi32 -lshell32 -lole32
-loleaut32 -lnetapi32 -luuid -lws2_32 -lmpr -lwinmm -lversion -lodbc32
-lodbccp32 -lcomctl32 dll.exp
dlltool --def Socket.def --base-file dll.base --output-exp dll.exp
g++ -o blib\arch\auto\Socket\Socket.dll -mdll -s -L&#34;C:\strawberry\perl\lib\CORE&#34;
 -L&#34;C:\strawberry\c\lib&#34; Socket.o -Wl,--image-base,0x361b0000
C:\strawberry\perl\lib\CORE\libperl512.a -lmoldname -lkernel32
-luser32 -lgdi32 -lwinspool -lcomdlg32 -ladvapi32 -lshell32 -lole32
-loleaut32 -lnetapi32 -luuid -lws2_32 -lmpr -lwinmm -lversion -lodbc32
-lodbccp32 -lcomctl32 dll.exp
C:\strawberry\perl\bin\perl.exe -MExtUtils::Command -e &#34;chmod&#34; -- 755
blib\arch\auto\Socket\Socket.dll
C:\strawberry\perl\bin\perl.exe -MExtUtils::Command -e &#34;cp&#34; --
Socket.bs blib\arch\auto\Socket\Socket.bs
C:\strawberry\perl\bin\perl.exe -MExtUtils::Command -e &#34;chmod&#34; -- 644
blib\arch\auto\Socket\Socket.bs

VinsWorldcom@C:\Users\vincen_m\Downloads\Socket-2.004&gt; perl -Mblib
..\..\tmp\v4v6Lookup.pl www.google.com
OLD: gethostbyname&#40;&#41;/inet_ntoa&#40;&#41; Address = 173.194.73.106
OLD: gethostbyname&#40;&#41;/inet_ntoa&#40;&#41; Address = 173.194.73.104
OLD: gethostbyname&#40;&#41;/inet_ntoa&#40;&#41; Address = 173.194.73.99
OLD: gethostbyname&#40;&#41;/inet_ntoa&#40;&#41; Address = 173.194.73.147
OLD: gethostbyname&#40;&#41;/inet_ntoa&#40;&#41; Address = 173.194.73.103
OLD: gethostbyname&#40;&#41;/inet_ntoa&#40;&#41; Address = 173.194.73.105
Socket::inet_ntop not implemented on this architecture at
..\..\tmp\v4v6Lookup.pl line 68.


On Thu, Aug 16, 2012 at 3:03 PM, Paul Evans via RT
&lt;bug-Socket@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=78890">https://rt.cpan.org/Ticket/Display.html?id=78890</a></span> &gt;
&gt;
&gt; On Fri Aug 10 11:32:28 2012, VINSWORLD wrote:
<div class="message-stanza open">&gt;&gt; Windows 7 x64 / Strawberry Perl 5.14.2, 5.16.1 both using latest Socket
&gt;&gt; 2.002 from CPAN:
&gt;&gt;
&gt;&gt; Socket::inet_ntop not implemented on this architecture at C:\Users\ ...
&gt;&gt;
&gt;&gt; inet_ntop is certainly available on Windows 7.  Seems the gcc include
&gt;&gt; files and lib files may be lacking?  Using the following process, I can
&gt;&gt; write a C program using get*info calls and inet_ntop / pton and they
&gt;&gt; work correctly.
&gt;&gt;
&gt;&gt; Quick fix for Perl Socket module, but doesn&#39;t resolve completely:
&gt;&gt;
&gt;&gt; add to ws2tcpip.h line 304:
&gt;&gt;
&gt;&gt; #include &lt;ws2tcpip-win.h&gt;
&gt;&gt;
&gt;&gt; --
&gt;&gt; Attached file is the ws2tcpip-win.h file.  Additionally, create new
&gt;&gt; libws2-32.a library:
&gt;&gt;
<div class="message-stanza open">&gt;&gt; &gt; pexports \Windows\system32\ws2_32.dll &gt; WS2_32.def
&gt;&gt; &gt; dlltool --as-flags=--64 -m i386:x86-64 -k --output-lib libws2_32-new.a
</div>&gt;&gt; --input-def WS2_32.def
&gt;&gt;
&gt;&gt; Put both files in locations:
&gt;&gt;
&gt;&gt; \strawberry\c\x86_64-w64-mingw32\include\ws2tcpip-win.h
&gt;&gt; \strawberry\c\x86_64-w64-mingw32\lib\libws2_32-new.a
&gt;&gt;
&gt;&gt; Edit generated Makefile:
&gt;&gt;
&gt;&gt; DEFINE = -DHAS_IP_MREQ -DHAS_GETADDRINFO -DHAS_GETNAMEINFO -
&gt;&gt; DHAS_INETNTOP -DHAS_INETPTON -DAF_INET6 -DHAS_SOCKADDR_IN6
&gt;&gt;
&gt;&gt; LDLOADLIBS = -lmoldname -lkernel32 -luser32 -lgdi32 -lwinspool -
&gt;&gt; lcomdlg32 -ladvapi32 -lshell32 -lole32 -loleaut32 -lnetapi32 -luuid -
&gt;&gt; lws2_32 -lmpr -lwinmm -lversion -lodbc32 -lodbccp32 -lcomctl32 -lws2_32-
&gt;&gt; new
&gt;&gt;
&gt;&gt; dmake test
</div>&gt;
&gt; This sounds like quite a long complex workaround here. Hopefully we can
&gt; find a neater solution; this level of hackery ought not be necessary.
&gt;
<div class="message-stanza open">&gt;&gt; But ... still errors:
</div>&gt;
&gt; Yes, that&#39;s due to a bug in your v4v6Lookup.pl. It failed the same way
&gt; for me on Linux:
&gt;
&gt; $ perl -Mblib v4v6Lookup.pl cel.leonerd.org.uk
&gt; OLD: gethostbyname&#40;&#41;/inet_ntoa&#40;&#41; Address = 81.187.167.226
&gt; NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 81.187.167.226
&gt; NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 3000:a7e2:7f:0:e8e0:4a91
&gt;
&gt; $ perl -Mblib v4v6Lookup.pl cel.leonerd.org.uk
&gt; OLD: gethostbyname&#40;&#41;/inet_ntoa&#40;&#41; Address = 81.187.167.226
&gt; NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 48.0.110.1
&gt; NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 3000:6e01::b80e:c84d:ee7
&gt;
&gt; That itself looks like a bug in Socket, perhaps using some uninitialised
&gt; memory. I&#39;ll hunt it down later.
&gt;
&gt;
&gt; unpack_sockaddr_in and _in6 return a list, whose first element is the
&gt; port number and the second is the raw IPv4 or v6 address. Lines 61-65
&gt; ought to read:
&gt;
&gt;  61             if &#40;$addr-&gt;{family} == AF_INET&#41; {
&gt;  62                 &#40;undef, $address&#41; = unpack_sockaddr_in&#40;$addr-&gt;{addr}&#41;
&gt;  63             } else {
&gt;  64                 &#40;undef, $address&#41; = unpack_sockaddr_in6&#40;$addr-&gt;{addr}&#41;
&gt;  65             }
&gt;
&gt; With this change in place, it now behaves as expected:
&gt;
&gt; $ perl -Mblib v4v6Lookup.pl cel.leonerd.org.uk
&gt; OLD: gethostbyname&#40;&#41;/inet_ntoa&#40;&#41; Address = 81.187.167.226
&gt; NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 81.187.167.226
&gt; NEW:   getaddrinfo&#40;&#41;/inet_ntop&#40;&#41; Address = 2001:8b0:3f7::2
&gt;
&gt; Try that change, and see if yours now works.
&gt;
&gt; --
&gt;
&gt; Paul Evans
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1109961" href="/Public/Bug/Display.html?id=78890#txn-1109961">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;16&nbsp;16:20:53&nbsp;2012</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1109961/583618/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/583618">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Aug 16 15:47:57 2012, vinsworldcom@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Wow.  I *hate* it when I&#39;m the culprit of a fix easily obtained with a
&gt; RTFM solution.  My apologies for the mistake in my script that
&gt; incorrectly attributed an error to Socket.pm.  Thanks for taking the
&gt; time to respond and set me straight and not just let this fade away.
&gt; Very much appreciate the work you&#39;re doing to get IPv6 working in
&gt; Perl.
&gt; 
&gt; When I *correctly* implemented the unpack_sockaddr_in&#40;6&#41; routines as
&gt; per your recommendation, the script using Socket 2.004 indeed worked.
&gt; 
&gt; Weird that the mistakes in my code did produce the correct results on
&gt; Perl 5.12.3 using the Socket6 module.  Anyway, not for further concern
&gt; on this topic / forum.
</div>
I was looking into that, and I think it&#39;s a side-effect of calling an XS
function in scalar context that&#39;s expecting to be called in list
context; it has the effect of yielding the last value in the list.

Socket6&#39;s unpack_sockaddr_in6 only returned &#40;$port, $address&#41;, so in
scalar context it still returned the address. Socket&#39;s additionally
returns the flow info and scope ID fields, so I suspect what happened
was that your $address actually had the scope ID, which was a plain 0.
When inet_ntop&#40;&#41; wanted to get the raw PV bytes out of that, it
converted the 0 into the string &#34;0&#34;, whose first two bytes are 0x30,
0x00. Hence all your results starting with 3000:...

I suspect what I&#39;ll actually do, to avoid this breakage in future, is to
have unpack_sockaddr_in6&#40;&#41; yield just the address when called in scalar
context, to match Socket6, and the IPv4 unpack_sockaddr_in&#40;&#41;. This feels
the most useful behaviour anyway, as if you wanted just one value that&#39;s
the most likely one.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1109969" href="/Public/Bug/Display.html?id=78890#txn-1109969">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;16&nbsp;16:33:23&nbsp;2012</span>
    <span class="description">vinsworldcom [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #78890] Windows support for IPv6 - there, but broken in this release</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 16 Aug 2012 16:33:13 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Socket [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Vince &lt;vin [...] vinsworld.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1109969/583624/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/583624">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Aug 16 15:47:57 2012, vinsworldcom@gmail.com wrote:
<div class="message-stanza open">&gt;&gt; Wow.  I *hate* it when I&#39;m the culprit of a fix easily obtained with a
&gt;&gt; RTFM solution.  My apologies for the mistake in my script that
&gt;&gt; incorrectly attributed an error to Socket.pm.  Thanks for taking the
&gt;&gt; time to respond and set me straight and not just let this fade away.
&gt;&gt; Very much appreciate the work you&#39;re doing to get IPv6 working in
&gt;&gt; Perl.
&gt;&gt;
&gt;&gt; When I *correctly* implemented the unpack_sockaddr_in&#40;6&#41; routines as
&gt;&gt; per your recommendation, the script using Socket 2.004 indeed worked.
&gt;&gt;
&gt;&gt; Weird that the mistakes in my code did produce the correct results on
&gt;&gt; Perl 5.12.3 using the Socket6 module.  Anyway, not for further concern
&gt;&gt; on this topic / forum.
</div>&gt;
&gt; I was looking into that, and I think it&#39;s a side-effect of calling an XS
&gt; function in scalar context that&#39;s expecting to be called in list
&gt; context; it has the effect of yielding the last value in the list.
&gt;
&gt; Socket6&#39;s unpack_sockaddr_in6 only returned &#40;$port, $address&#41;, so in
&gt; scalar context it still returned the address. Socket&#39;s additionally
&gt; returns the flow info and scope ID fields, so I suspect what happened
&gt; was that your $address actually had the scope ID, which was a plain 0.
&gt; When inet_ntop&#40;&#41; wanted to get the raw PV bytes out of that, it
&gt; converted the 0 into the string &#34;0&#34;, whose first two bytes are 0x30,
&gt; 0x00. Hence all your results starting with 3000:...
</div>
Yes, because when I printed $address before sending to inet_ntop&#40;&#41;, I
got 0, which lead me to believe there was an error not so much in
inet_ntop&#40;&#41;, but again, I was wrong anyway, but this does explain all
the identical 3000: ... results.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I suspect what I&#39;ll actually do, to avoid this breakage in future, is to
&gt; have unpack_sockaddr_in6&#40;&#41; yield just the address when called in scalar
&gt; context, to match Socket6, and the IPv4 unpack_sockaddr_in&#40;&#41;. This feels
&gt; the most useful behaviour anyway, as if you wanted just one value that&#39;s
&gt; the most likely one.
&gt;
&gt; --
&gt;
&gt; Paul Evans
</div>
Brilliant - thanks again Paul.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1109974" href="/Public/Bug/Display.html?id=78890#txn-1109974">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;16&nbsp;17:27:56&nbsp;2012</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1109974/583629/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/583629">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 794b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Aug 16 16:33:23 2012, vinsworldcom@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &gt; I suspect what I&#39;ll actually do, to avoid this breakage in future, is to
&gt; &gt; have unpack_sockaddr_in6&#40;&#41; yield just the address when called in scalar
&gt; &gt; context, to match Socket6, and the IPv4 unpack_sockaddr_in&#40;&#41;. This feels
&gt; &gt; the most useful behaviour anyway, as if you wanted just one value that&#39;s
&gt; &gt; the most likely one.
</div>
Done.

Also added a check to inet_ntop to ensure it was passed the right length
scalars:

$ perl -Mblib -MSocket=inet_ntop,AF_INET6 -E &#39;say inet_ntop AF_INET6, 0&#39;
Bad address length for Socket::inet_ntop on AF_INET6; got -954301850,
should be 16 at -e l
ine 1.

as compared to:

$ perl -MSocket=inet_ntop,AF_INET6 -E &#39;say inet_ntop AF_INET6, 0&#39;
3000:2602:0:0:6c00::

Released as 2.005.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1109977" href="/Public/Bug/Display.html?id=78890#txn-1109977">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;16&nbsp;17:27:58&nbsp;2012</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1110167" href="/Public/Bug/Display.html?id=78890#txn-1110167">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;17&nbsp;06:55:10&nbsp;2012</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Status changed from &#39;patched&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1110169" href="/Public/Bug/Display.html?id=78890#txn-1110169">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;17&nbsp;06:55:11&nbsp;2012</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Fixed in 2.005 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.557092</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
