<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #104754 for App-Wallflower: Scramble Images</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #104754 for App-Wallflower: Scramble Images</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/App-Wallflower/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/App-Wallflower/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/App-Wallflower/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/App-Wallflower/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/App-Wallflower">App-Wallflower CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">104754</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/App-Wallflower/Active/">App-Wallflower</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ASB [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-245554-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.005    </td>
  </tr>
  <tr id="CF-245555-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.006    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




image.jpg<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1501187/799884/image.jpg">
Thu May 28 13:46:25 2015 (3.8k) by ASB [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;28&nbsp;13:46:25&nbsp;2015</span>
    <span class="description">ASB [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Scramble Images</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">When running wallflower, the image is stored to static/image.jpg, but it&#39;s content is all messed up. 
Please find attached an example.

This is the command I used:
wallflower --application script.cgi --dir static/

Here is an example application:

#!perl

use Mojolicious::Lite;

get &#39;/&#39; =&gt; sub {
  my $c = shift;
  $c-&gt;render&#40;template =&gt; &#39;index&#39;&#41;;
};

app-&gt;start;

__DATA__

@@ index.html.ep

&lt;html&gt;
&lt;body&gt;
  &lt;h1&gt;Image&lt;/h1&gt;
  &lt;img src=&#34;/image.jpg&#34; /&gt;
&lt;/body&gt;
&lt;/html&gt;

@@ image.jpg &#40;base64&#41;

R0lGODlhoACgAPfKAGet+oe16PTy72Sq94+55/fz8Gyv+cdQUKenp4CAgGex/qVsfoKWzX19fV5eXl1dXVRUVNzc3MpNSubm5s5NSsbGxouLi7GxsZKSkmxsbGhoaFZWVmOf4sZNTWuv+ri4uNHR0W6q8Wa1/6F2lMlOTJycnHJycs1KR81KRllZWWuu971aY4i153Kk2nV1dWum5W2x/dvb28nJyWRkZG2x/Gqv+G2m5oeHh3C3/2mv+ZmZmby8vJC55sxeXui3t2Sp9vj07leFuGag4s1hYc1kZJC66Pv27mah42Kf4vf08G+q63Gq6sxfX8pKSMpaWWay/stcXG6y/sdOTeezs2qt955xoKdnkmat+vfz74e152yv+G6y/GSp98lKSGyu+ERgf8NYXlmJvrFbgmS1/2ix/I+DuV2Sy2yy/Gy0/2Od22mo72qq6tQxRm6p759yitFGQGe4/9RHP2W0/VqMwm2y/sxLRm2x+12RykJceViIvaN0kG2w+22r84+Du12TzUhnimmw+dMzSWmp8Gqu916SzWys9e/v73Sj6Gyv+miw+3Cs9IqJw46EqJl4q2Op9muw+6Jsmmus9X+Y0lR/rmCX1Hif3rtPcGey/Gel6m+2/2ex/Wmw+2K4/4KVzGqu+G+1//n28pO961+U0V6Uz1N9rKZ1kmaz/maj56BvnnOj6MBXXsVEYH2X2Gex/EVigWez/FJ9q7tQcWym5W6y/YOUymyz/2ay/W2y/Wuw+mut9VeGu3Wi5m6k4WWg4mKb2aZse6lpeGK3/6FunNBLRpZ7rmuv+VNTU2yl5Gut9vDw8P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/wtYTVAgRGF0YVhNUDw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjEzQzJENEEzNTU1QjExRTNBNjVDQzI4MjMzM0E4MzhCIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjEzQzJENEE0NTU1QjExRTNBNjVDQzI4MjMzM0E4MzhCIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MTNDMkQ0QTE1NTVCMTFFM0E2NUNDMjgyMzMzQTgzOEIiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MTNDMkQ0QTI1NTVCMTFFM0E2NUNDMjgyMzMzQTgzOEIiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4B//79/Pv6+fj39vX08/Lx8O/u7ezr6uno5+bl5OPi4eDf3t3c29rZ2NfW1dTT0tHQz87NzMvKycjHxsXEw8LBwL++vby7urm4t7a1tLOysbCvrq2sq6qpqKempaSjoqGgn56dnJuamZiXlpWUk5KRkI+OjYyLiomIh4aFhIOCgYB/fn18e3p5eHd2dXRzcnFwb25tbGtqaWhnZmVkY2JhYF9eXVxbWllYV1ZVVFNSUVBPTk1MS0pJSEdGRURDQkFAPz49PDs6OTg3NjU0MzIx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

__END__
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> image.jpg</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1501187/799884/image.jpg">Download image.jpg</a><br />
<span class="downloadcontenttype">image/jpeg 3.8k</span>
</div>
<div class="messagebody">
<img alt="image.jpg" title="image.jpg" src="/Ticket/Attachment/1501187/799884/" /></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;03&nbsp;03:11:44&nbsp;2015</span>
    <span class="description">book [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #104754] Scramble Images</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 3 Jun 2015 09:11:35 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Alexander Becker via RT &lt;bug-App-Wallflower [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Philippe Bruhat &#40;BooK&#41;&#34; &lt;book [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, May 28, 2015 at 01:46:26PM -0400, Alexander Becker via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; This is the command I used:
&gt; wallflower --application script.cgi --dir static/
&gt; 
</div>
I copy/pasted your application in a script.cgi file on my Linux box, and ran:

    $ wallflower -a script.cgi -d static
    200 / =&gt; static/index.html [74]
    200 /image.jpg =&gt; static/image.jpg [3973]

    $ file static/image.jpg
    static/image.jpg: GIF image data, version 89a, 160 x 160

    $ identify static/image.jpg
    static/image.jpg[0] GIF 160x160 160x160+0+0 8-bit sRGB 256c 3.97KB 0.000u 0:00.000
    static/image.jpg[1] GIF 115x23 160x160+22+66 8-bit sRGB 256c 3.97KB 0.000u 0:00.000

So this is a GIF image with two frames. Looking at it with my browser, it
looks fine &#40;shows a Tk window with the text &#34;Perl + Tk&#34; with a blinking &#34;+&#34;&#41;.

Running the application in parallel with `plackup -p 5000 script.cgi`, I did:

    $ lwp-request -des <span class="clickylink"><a target="new" rel="nofollow" href="http://localhost:5000/image.jpg">http://localhost:5000/image.jpg</a></span>
    200 OK
    Date: Tue, 02 Jun 2015 22:38:57 GMT
    Date: Tue, 02 Jun 2015 22:38:57 GMT
    Accept-Ranges: bytes
    ETag: &#34;beb5ffb6b02170dea496b600198ee13e&#34;
    Server: HTTP::Server::PSGI
    Content-Length: 3973
    Content-Type: image/jpeg
    Last-Modified: Tue, 02 Jun 2015 22:38:41 GMT
    Client-Date: Tue, 02 Jun 2015 22:38:57 GMT
    Client-Peer: 127.0.0.1:5000
    Client-Response-Num: 1

Apart from the fact that a GIF image is served with a content-type of
image/jpeg, I didn&#39;t see anything weird.

I then downloaded the attached image, and compared it with the one
downloaded by wallflower:

    $ ls -l image.jpg static/image.jpg
    -rw-r----- 1 book book 3978 Jun  3 00:52 image.jpg
    -rw-r--r-- 1 book book 3973 Jun  3 00:40 static/image.jpg

So there&#39;s 5 extra bytes, it seems. When comparing two hexdumps &#40;basically
comparing the text output of running the `hexdump` command on both files&#41;,
the first difference I found was an extra 0x0d... Could if be an issue
with DOS/Unix end-of-lines? &#40;You&#39;re on Windows, aren&#39;t you?&#41; What about
opening the file for writing in binary mode?

Does the following patch work for you?

    diff --git a/lib/Wallflower.pm b/lib/Wallflower.pm
    index b34aa34..9771c8a 100644
    --- a/lib/Wallflower.pm
    +++ b/lib/Wallflower.pm
    @@ -125,7 +125,7 @@ sub get {
             # get a file to save the content in
             my $dir = &#40; $file = $target &#41;-&gt;dir;
             $dir-&gt;mkpath if !-e $dir;
    -        open my $fh, &#39;&gt;&#39;, $file or croak &#34;Can&#39;t open $file for writing: $!&#34;;
    +        open my $fh, &#39;&gt; :raw :bytes&#39;, $file or croak &#34;Can&#39;t open $file for writing: $!&#34;;
     
             # copy content to the file
             if &#40; ref $content eq &#39;ARRAY&#39; &#41; {

-- 
 Philippe Bruhat &#40;BooK&#41;

 When the employee is a fool, so is the employer.
                                    &#40;Moral from Groo The Wanderer #26 &#40;Epic&#41;&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;03&nbsp;03:11:45&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;03&nbsp;13:51:18&nbsp;2015</span>
    <span class="description">ASB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Am Mi 03. Jun 2015, 03:11:44, BOOK schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu, May 28, 2015 at 01:46:26PM -0400, Alexander Becker via RT
&gt; wrote:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; This is the command I used:
&gt; &gt; wallflower --application script.cgi --dir static/
&gt; &gt;
</div>&gt; 
&gt; I copy/pasted your application in a script.cgi file on my Linux box,
&gt; and ran:
&gt; 
&gt; $ wallflower -a script.cgi -d static
&gt; 200 / =&gt; static/index.html [74]
&gt; 200 /image.jpg =&gt; static/image.jpg [3973]
&gt; 
&gt; $ file static/image.jpg
&gt; static/image.jpg: GIF image data, version 89a, 160 x 160
&gt; 
&gt; $ identify static/image.jpg
&gt; static/image.jpg[0] GIF 160x160 160x160+0+0 8-bit sRGB 256c 3.97KB
&gt; 0.000u 0:00.000
&gt; static/image.jpg[1] GIF 115x23 160x160+22+66 8-bit sRGB 256c 3.97KB
&gt; 0.000u 0:00.000
&gt; 
&gt; So this is a GIF image with two frames. Looking at it with my browser,
&gt; it
&gt; looks fine &#40;shows a Tk window with the text &#34;Perl + Tk&#34; with a
&gt; blinking &#34;+&#34;&#41;.
&gt; 
&gt; Running the application in parallel with `plackup -p 5000 script.cgi`,
&gt; I did:
&gt; 
&gt; $ lwp-request -des <span class="clickylink"><a target="new" rel="nofollow" href="http://localhost:5000/image.jpg">http://localhost:5000/image.jpg</a></span>
&gt; 200 OK
&gt; Date: Tue, 02 Jun 2015 22:38:57 GMT
&gt; Date: Tue, 02 Jun 2015 22:38:57 GMT
&gt; Accept-Ranges: bytes
&gt; ETag: &#34;beb5ffb6b02170dea496b600198ee13e&#34;
&gt; Server: HTTP::Server::PSGI
&gt; Content-Length: 3973
&gt; Content-Type: image/jpeg
&gt; Last-Modified: Tue, 02 Jun 2015 22:38:41 GMT
&gt; Client-Date: Tue, 02 Jun 2015 22:38:57 GMT
&gt; Client-Peer: 127.0.0.1:5000
&gt; Client-Response-Num: 1
&gt; 
&gt; Apart from the fact that a GIF image is served with a content-type of
&gt; image/jpeg, I didn&#39;t see anything weird.
&gt; 
&gt; I then downloaded the attached image, and compared it with the one
&gt; downloaded by wallflower:
&gt; 
&gt; $ ls -l image.jpg static/image.jpg
&gt; -rw-r----- 1 book book 3978 Jun  3 00:52 image.jpg
&gt; -rw-r--r-- 1 book book 3973 Jun  3 00:40 static/image.jpg
&gt; 
&gt; So there&#39;s 5 extra bytes, it seems. When comparing two hexdumps
&gt; &#40;basically
&gt; comparing the text output of running the `hexdump` command on both
&gt; files&#41;,
&gt; the first difference I found was an extra 0x0d... Could if be an issue
&gt; with DOS/Unix end-of-lines? &#40;You&#39;re on Windows, aren&#39;t you?&#41; What
&gt; about
&gt; opening the file for writing in binary mode?
&gt; 
&gt; Does the following patch work for you?
&gt; 
&gt; diff --git a/lib/Wallflower.pm b/lib/Wallflower.pm
&gt; index b34aa34..9771c8a 100644
&gt; --- a/lib/Wallflower.pm
&gt; +++ b/lib/Wallflower.pm
&gt; @@ -125,7 +125,7 @@ sub get {
&gt;          # get a file to save the content in
&gt;          my $dir = &#40; $file = $target &#41;-&gt;dir;
&gt;          $dir-&gt;mkpath if !-e $dir;
&gt; -        open my $fh, &#39;&gt;&#39;, $file or croak &#34;Can&#39;t open $file for
&gt; writing: $!&#34;;
&gt; +        open my $fh, &#39;&gt; :raw :bytes&#39;, $file or croak &#34;Can&#39;t open
&gt; $file for writing: $!&#34;;
&gt; 
&gt; # copy content to the file
&gt; if &#40; ref $content eq &#39;ARRAY&#39; &#41; {
</div>

Yes, it worked!
Once the file was written in binary mode, the image could be displayed.

You were also right about the OS, I&#39;m on Windows here.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;03&nbsp;16:58:58&nbsp;2015</span>
    <span class="description">book [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jun 03 13:51:18 2015, ASB wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Am Mi 03. Jun 2015, 03:11:44, BOOK schrieb:
<div class="message-stanza open">&gt; &gt; 
&gt; &gt; Does the following patch work for you?
&gt; &gt; 
</div>&gt; 
&gt; Yes, it worked!
&gt; Once the file was written in binary mode, the image could be displayed.
&gt; 
</div>
So, after further investigation, the :bytes layer is unnecessary, since
the content MUST be bytes according to the PSGI standard:
<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/pod/distribution/PSGI/PSGI.pod#Body">https://metacpan.org/pod/distribution/PSGI/PSGI.pod#Body</a></span>

I&#39;ll apply the patch with only :raw and make a release shortly.

Thanks!

-- BooK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;03&nbsp;17:36:29&nbsp;2015</span>
    <span class="description">ASB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Am Mi 03. Jun 2015, 16:58:58, BOOK schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Jun 03 13:51:18 2015, ASB wrote:
<div class="message-stanza open">&gt; &gt; Am Mi 03. Jun 2015, 03:11:44, BOOK schrieb:
<div class="message-stanza open">&gt; &gt; &gt; 
&gt; &gt; &gt; Does the following patch work for you?
&gt; &gt; &gt; 
</div>&gt; &gt; 
&gt; &gt; Yes, it worked!
&gt; &gt; Once the file was written in binary mode, the image could be displayed.
&gt; &gt; 
</div>&gt; 
&gt; So, after further investigation, the :bytes layer is unnecessary, since
&gt; the content MUST be bytes according to the PSGI standard:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/pod/distribution/PSGI/PSGI.pod#Body">https://metacpan.org/pod/distribution/PSGI/PSGI.pod#Body</a></span>
&gt; 
&gt; I&#39;ll apply the patch with only :raw and make a release shortly.
&gt; 
&gt; Thanks!
&gt; 
&gt; -- BooK
</div>
I quickly confirmed it. Omitting the :bytes option yields the same results.

Thanks for patching!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;24&nbsp;04:05:10&nbsp;2015</span>
    <span class="description">book [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;24&nbsp;04:05:10&nbsp;2015</span>
    <span class="description">book [...] cpan.org -  Fixed in 1.006 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
