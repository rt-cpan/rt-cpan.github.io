<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #68985 for DBD-SQLite: Re: [PATCH] Won&#39;t compile on archaic OS</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #68985 for DBD-SQLite: Re: [PATCH] Won&#39;t compile on archaic OS</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DBD-SQLite/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DBD-SQLite/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DBD-SQLite/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DBD-SQLite/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-SQLite">DBD-SQLite CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">68985</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DBD-SQLite/Active/">DBD-SQLite</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
drh [...] sqlite.org

<br />
h.m.brand [...] xs4all.nl

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10248-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10249-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;21&nbsp;07:29:52&nbsp;2011</span>
    <span class="description">h.m.brand [...] xs4all.nl -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> sqlite-users [...] sqlite.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [PATCH] Won&#39;t compile on archaic OS</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 21 Jun 2011 13:29:41 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;Bugs in DBD-SQLite via RT&#34; &lt;bug-DBD-SQLite [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;H.Merijn Brand&#34; &lt;h.m.brand [...] xs4all.nl&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, 23 May 2011 18:45:14 +0200, &#34;Bugs in DBD-SQLite via RT&#34;
&lt;bug-DBD-SQLite@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; See also
&gt;     <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=68396">https://rt.cpan.org/Ticket/Display.html?id=68396</a></span>
</div>
This &#40;rather clear&#41; bug report neither got any acknowledgement, not
does it appear in the RT trackers.

Meanwhile things got even worse.
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Using gcc-3.4.6 on HP-UX 10.20:
</div>
HP-UX 10.20 does not have pread at all. -UUSE_PREAD doesn&#39;t work
&#40;enough&#41; as the test is &#40;very&#41; wrong. SQLITE_ENABLE_LOCKING_STYLE is
overruled in this section when passed as -USQLITE_ENABLE_LOCKING_STYLE

--8&lt;--- line 23983
#if !defined&#40;SQLITE_ENABLE_LOCKING_STYLE&#41;
#  if defined&#40;__APPLE__&#41;
#    define SQLITE_ENABLE_LOCKING_STYLE 1
#  else
#    define SQLITE_ENABLE_LOCKING_STYLE 0
#  endif
#endif
--&gt;8---

And thus leaving
--8&lt;--- line 24453
#if defined&#40;USE_PREAD&#41; || defined&#40;SQLITE_ENABLE_LOCKING_STYLE&#41;
  { &#34;pread&#34;,        &#40;sqlite3_syscall_ptr&#41;pread,      0  },
#else
  { &#34;pread&#34;,        &#40;sqlite3_syscall_ptr&#41;0,          0  },
#endif
--&gt;8---

a useless and bogus test.

That second test &#40;also for pwrite&#41; should either test for the *content*
of SQLITE_ENABLE_LOCKING_STYLE or not test on it at all

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; make test
</div>&gt; gcc -c  -I. -I/opt/perl/lib/site_perl/5.14.0/PA-RISC2.0/auto/DBI -mpa-
&gt; risc-1-1 -DPERL_DONT_CREATE_GVSV -D_HPUX_SOURCE -fno-strict-aliasing -
&gt; pipe -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -O2   -DVERSION=
&gt; \&#34;1.31\&#34; -DXS_VERSION=\&#34;1.31\&#34; -fPIC &#34;-I/opt/perl/lib/5.14.0/PA-RISC2.0/
&gt; CORE&#34;  -DSQLITE_ENABLE_FTS3 -DSQLITE_ENABLE_FTS3_PARENTHESIS -
&gt; DSQLITE_ENABLE_COLUMN_METADATA -DNDEBUG=1 -DHAVE_USLEEP=1 -
&gt; DTHREADSAFE=0 -DSQLITE_OMIT_LOAD_EXTENSION sqlite3.c
&gt; sqlite3.c: In function `unixShmMap&#39;:
&gt; sqlite3.c:26184: error: `MAP_FAILED&#39; undeclared &#40;first use in this 
&gt; function&#41;
&gt; sqlite3.c:26184: error: &#40;Each undeclared identifier is reported only 
&gt; once
&gt; sqlite3.c:26184: error: for each function it appears in.&#41;
&gt; 
&gt; After applying this patch:
&gt; --8&lt;---
&gt; --- sqlite3.c.org       2011-05-23 15:27:35 +0200
&gt; +++ sqlite3.c   2011-05-23 15:29:55 +0200
&gt; @@ -22661,6 +22661,10 @@ struct unixFile {
&gt;  */
&gt;  #define SQLITE_WHOLE_FILE_LOCKING  0x0001   /* Use whole-file locking */
&gt; 
&gt; +#ifndef MAP_FAILED
&gt; +#define MAP_FAILED   &#40;&#40;void *&#41; -1&#41;
&gt; +#endif
&gt; +
&gt;  /*
&gt;  ** Include code that is common to all os_*.c files
&gt;  */
&gt; --&gt;8---
&gt; 
<div class="message-stanza open">&gt; &gt; make test
</div>&gt; :
&gt; All tests successful.
&gt; Files=59, Tests=1308, 87 wallclock secs &#40; 4.61 usr  0.48 sys + 53.42 
&gt; cusr  3.96 csys = 62.47 CPU&#41;
&gt; Result: PASS
<div class="message-stanza open">&gt; &gt;
</div></div>

-- 
H.Merijn Brand  <span class="clickylink"><a target="new" rel="nofollow" href="http://tux.nl">http://tux.nl</a></span>      Perl Monger  <span class="clickylink"><a target="new" rel="nofollow" href="http://amsterdam.pm.org/">http://amsterdam.pm.org/</a></span>
using 5.00307 through 5.14 and porting perl5.15.x on HP-UX 10.20, 11.00,
11.11, 11.23 and 11.31, OpenSuSE 10.1, 11.0 .. 11.4 and AIX 5.2 and 5.3.
<span class="clickylink"><a target="new" rel="nofollow" href="http://mirrors.develooper.com/hpux/">http://mirrors.develooper.com/hpux/</a></span>           <span class="clickylink"><a target="new" rel="nofollow" href="http://www.test-smoke.org/">http://www.test-smoke.org/</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://qa.perl.org">http://qa.perl.org</a></span>      <span class="clickylink"><a target="new" rel="nofollow" href="http://www.goldmark.org/jeff/stupid-disclaimers/">http://www.goldmark.org/jeff/stupid-disclaimers/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;21&nbsp;13:50:20&nbsp;2011</span>
    <span class="description">darren [...] DarrenDuncan.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #68985] Re: [PATCH] Won&#39;t compile on archaic OS</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 21 Jun 2011 10:50:09 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-SQLite [...] rt.cpan.org, &#34;H.Merijn Brand&#34; &lt;h.m.brand [...] xs4all.nl&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Darren Duncan &lt;darren [...] darrenduncan.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">h.m.brand@xs4all.nl via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Tue Jun 21 07:29:52 2011: Request 68985 was acted upon.
&gt; Transaction: Ticket created by h.m.brand@xs4all.nl
&gt;        Queue: DBD-SQLite
&gt;      Subject: Re: [PATCH] Won&#39;t compile on archaic OS
&gt;    Broken in: &#40;no value&#41;
&gt;     Severity: &#40;no value&#41;
&gt;        Owner: Nobody
&gt;   Requestors: h.m.brand@xs4all.nl
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=68985">https://rt.cpan.org/Ticket/Display.html?id=68985</a></span> &gt;
&gt; 
&gt; On Mon, 23 May 2011 18:45:14 +0200, &#34;Bugs in DBD-SQLite via RT&#34;
&gt; &lt;bug-DBD-SQLite@rt.cpan.org&gt; wrote:
&gt; 
<div class="message-stanza open">&gt;&gt; See also
&gt;&gt;     <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=68396">https://rt.cpan.org/Ticket/Display.html?id=68396</a></span>
</div>&gt; 
&gt; This &#40;rather clear&#41; bug report neither got any acknowledgement, not
&gt; does it appear in the RT trackers.
&gt; 
&gt; Meanwhile things got even worse.
</div>
H.Merijn, this ticket was *so* acknowledged, and promptly.  Go see the url you 
provided and look at the responses to the ticket.  The ticket was rejected 
because you need to file with the upstream.  The issue is in SQLite itself, not 
in the Perl bridge to it.  See <span class="clickylink"><a target="new" rel="nofollow" href="http://sqlite.org/">http://sqlite.org/</a></span> about how to contact the 
SQLite team. -- Darren Duncan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;21&nbsp;13:50:21&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Create even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;22&nbsp;07:48:52&nbsp;2011</span>
    <span class="description">drh [...] sqlite.org - Ticket #69023:  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Bugs in DBD-SQLite via RT &lt;bug-DBD-SQLite [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [sqlite] [PATCH] Won&#39;t compile on archaic OS</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 22 Jun 2011 07:48:17 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> General Discussion of SQLite Database &lt;sqlite-users [...] sqlite.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Richard Hipp &lt;drh [...] sqlite.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, Jun 21, 2011 at 7:29 AM, H.Merijn Brand &lt;h.m.brand@xs4all.nl&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon, 23 May 2011 18:45:14 +0200, &#34;Bugs in DBD-SQLite via RT&#34;
&gt; &lt;bug-DBD-SQLite@rt.cpan.org&gt; wrote:
&gt;
<div class="message-stanza open">&gt; &gt; See also
&gt; &gt;     <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=68396">https://rt.cpan.org/Ticket/Display.html?id=68396</a></span>
</div>&gt;
&gt; This &#40;rather clear&#41; bug report neither got any acknowledgement, not
&gt; does it appear in the RT trackers.
&gt;
</div>
The problem was fixed in SQLite on 2011-04-15 with this check-in:
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.sqlite.org/src/ci/8775f159c1">http://www.sqlite.org/src/ci/8775f159c1</a></span>


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Meanwhile things got even worse.
&gt;
<div class="message-stanza open">&gt; &gt; Using gcc-3.4.6 on HP-UX 10.20:
</div>&gt;
&gt; HP-UX 10.20 does not have pread at all. -UUSE_PREAD doesn&#39;t work
&gt; &#40;enough&#41; as the test is &#40;very&#41; wrong. SQLITE_ENABLE_LOCKING_STYLE is
&gt; overruled in this section when passed as -USQLITE_ENABLE_LOCKING_STYLE
&gt;
&gt; --8&lt;--- line 23983
&gt; #if !defined&#40;SQLITE_ENABLE_LOCKING_STYLE&#41;
&gt; #  if defined&#40;__APPLE__&#41;
&gt; #    define SQLITE_ENABLE_LOCKING_STYLE 1
&gt; #  else
&gt; #    define SQLITE_ENABLE_LOCKING_STYLE 0
&gt; #  endif
&gt; #endif
&gt; --&gt;8---
&gt;
&gt; And thus leaving
&gt; --8&lt;--- line 24453
&gt; #if defined&#40;USE_PREAD&#41; || defined&#40;SQLITE_ENABLE_LOCKING_STYLE&#41;
&gt;  { &#34;pread&#34;,        &#40;sqlite3_syscall_ptr&#41;pread,      0  },
&gt; #else
&gt;  { &#34;pread&#34;,        &#40;sqlite3_syscall_ptr&#41;0,          0  },
&gt; #endif
&gt; --&gt;8---
&gt;
&gt; a useless and bogus test.
&gt;
&gt; That second test &#40;also for pwrite&#41; should either test for the *content*
&gt; of SQLITE_ENABLE_LOCKING_STYLE or not test on it at all
&gt;
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; make test
</div>&gt; &gt; gcc -c  -I. -I/opt/perl/lib/site_perl/5.14.0/PA-RISC2.0/auto/DBI -mpa-
&gt; &gt; risc-1-1 -DPERL_DONT_CREATE_GVSV -D_HPUX_SOURCE -fno-strict-aliasing -
&gt; &gt; pipe -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -O2   -DVERSION=
&gt; &gt; \&#34;1.31\&#34; -DXS_VERSION=\&#34;1.31\&#34; -fPIC &#34;-I/opt/perl/lib/5.14.0/PA-RISC2.0/
&gt; &gt; CORE&#34;  -DSQLITE_ENABLE_FTS3 -DSQLITE_ENABLE_FTS3_PARENTHESIS -
&gt; &gt; DSQLITE_ENABLE_COLUMN_METADATA -DNDEBUG=1 -DHAVE_USLEEP=1 -
&gt; &gt; DTHREADSAFE=0 -DSQLITE_OMIT_LOAD_EXTENSION sqlite3.c
&gt; &gt; sqlite3.c: In function `unixShmMap&#39;:
&gt; &gt; sqlite3.c:26184: error: `MAP_FAILED&#39; undeclared &#40;first use in this
&gt; &gt; function&#41;
&gt; &gt; sqlite3.c:26184: error: &#40;Each undeclared identifier is reported only
&gt; &gt; once
&gt; &gt; sqlite3.c:26184: error: for each function it appears in.&#41;
&gt; &gt;
&gt; &gt; After applying this patch:
&gt; &gt; --8&lt;---
&gt; &gt; --- sqlite3.c.org       2011-05-23 15:27:35 +0200
&gt; &gt; +++ sqlite3.c   2011-05-23 15:29:55 +0200
&gt; &gt; @@ -22661,6 +22661,10 @@ struct unixFile {
&gt; &gt;  */
&gt; &gt;  #define SQLITE_WHOLE_FILE_LOCKING  0x0001   /* Use whole-file locking */
&gt; &gt;
&gt; &gt; +#ifndef MAP_FAILED
&gt; &gt; +#define MAP_FAILED   &#40;&#40;void *&#41; -1&#41;
&gt; &gt; +#endif
&gt; &gt; +
&gt; &gt;  /*
&gt; &gt;  ** Include code that is common to all os_*.c files
&gt; &gt;  */
&gt; &gt; --&gt;8---
&gt; &gt;
<div class="message-stanza open">&gt; &gt; &gt; make test
</div>&gt; &gt; :
&gt; &gt; All tests successful.
&gt; &gt; Files=59, Tests=1308, 87 wallclock secs &#40; 4.61 usr  0.48 sys + 53.42
&gt; &gt; cusr  3.96 csys = 62.47 CPU&#41;
&gt; &gt; Result: PASS
<div class="message-stanza open">&gt; &gt; &gt;
</div></div>&gt;
&gt;
&gt; --
&gt; H.Merijn Brand  <span class="clickylink"><a target="new" rel="nofollow" href="http://tux.nl">http://tux.nl</a></span>      Perl Monger  <span class="clickylink"><a target="new" rel="nofollow" href="http://amsterdam.pm.org/">http://amsterdam.pm.org/</a></span>
&gt; using 5.00307 through 5.14 and porting perl5.15.x on HP-UX 10.20, 11.00,
&gt; 11.11, 11.23 and 11.31, OpenSuSE 10.1, 11.0 .. 11.4 and AIX 5.2 and 5.3.
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://mirrors.develooper.com/hpux/">http://mirrors.develooper.com/hpux/</a></span>           <span class="clickylink"><a target="new" rel="nofollow" href="http://www.test-smoke.org/">http://www.test-smoke.org/</a></span>
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://qa.perl.org">http://qa.perl.org</a></span>      <span class="clickylink"><a target="new" rel="nofollow" href="http://www.goldmark.org/jeff/stupid-disclaimers/">http://www.goldmark.org/jeff/stupid-disclaimers/</a></span>
&gt; _______________________________________________
&gt; sqlite-users mailing list
&gt; sqlite-users@sqlite.org
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://sqlite.org:8080/cgi-bin/mailman/listinfo/sqlite-users">http://sqlite.org:8080/cgi-bin/mailman/listinfo/sqlite-users</a></span>
&gt;
</div>


-- 
D. Richard Hipp
drh@sqlite.org
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;22&nbsp;09:08:15&nbsp;2011</span>
    <span class="description">ishigaki [...] cpan.org - Ticket #69023:  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> drh [...] sqlite.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m really glad to hear the news. The fix will be taken in DBD::SQLite 
in due time. Thank you for your kind reply.

-- Kenichi Ishigaki

On Wed Jun 22 07:48:52 2011, drh@sqlite.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Tue, Jun 21, 2011 at 7:29 AM, H.Merijn Brand &lt;h.m.brand@xs4all.nl&gt;
&gt; wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; On Mon, 23 May 2011 18:45:14 +0200, &#34;Bugs in DBD-SQLite via RT&#34;
&gt; &gt; &lt;bug-DBD-SQLite@rt.cpan.org&gt; wrote:
&gt; &gt;
<div class="message-stanza open">&gt; &gt; &gt; See also
&gt; &gt; &gt;     <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=68396">https://rt.cpan.org/Ticket/Display.html?id=68396</a></span>
</div>&gt; &gt;
&gt; &gt; This &#40;rather clear&#41; bug report neither got any acknowledgement, not
&gt; &gt; does it appear in the RT trackers.
&gt; &gt;
</div>&gt; 
&gt; The problem was fixed in SQLite on 2011-04-15 with this check-in:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.sqlite.org/src/ci/8775f159c1">http://www.sqlite.org/src/ci/8775f159c1</a></span>
&gt; 
&gt; 
<div class="message-stanza open">&gt; &gt;
&gt; &gt; Meanwhile things got even worse.
&gt; &gt;
<div class="message-stanza open">&gt; &gt; &gt; Using gcc-3.4.6 on HP-UX 10.20:
</div>&gt; &gt;
&gt; &gt; HP-UX 10.20 does not have pread at all. -UUSE_PREAD doesn&#39;t work
&gt; &gt; &#40;enough&#41; as the test is &#40;very&#41; wrong. SQLITE_ENABLE_LOCKING_STYLE is
&gt; &gt; overruled in this section when passed as
</div>&gt; -USQLITE_ENABLE_LOCKING_STYLE
<div class="message-stanza open">&gt; &gt;
&gt; &gt; --8&lt;--- line 23983
&gt; &gt; #if !defined&#40;SQLITE_ENABLE_LOCKING_STYLE&#41;
&gt; &gt; #  if defined&#40;__APPLE__&#41;
&gt; &gt; #    define SQLITE_ENABLE_LOCKING_STYLE 1
&gt; &gt; #  else
&gt; &gt; #    define SQLITE_ENABLE_LOCKING_STYLE 0
&gt; &gt; #  endif
&gt; &gt; #endif
&gt; &gt; --&gt;8---
&gt; &gt;
&gt; &gt; And thus leaving
&gt; &gt; --8&lt;--- line 24453
&gt; &gt; #if defined&#40;USE_PREAD&#41; || defined&#40;SQLITE_ENABLE_LOCKING_STYLE&#41;
&gt; &gt;  { &#34;pread&#34;,        &#40;sqlite3_syscall_ptr&#41;pread,      0  },
&gt; &gt; #else
&gt; &gt;  { &#34;pread&#34;,        &#40;sqlite3_syscall_ptr&#41;0,          0  },
&gt; &gt; #endif
&gt; &gt; --&gt;8---
&gt; &gt;
&gt; &gt; a useless and bogus test.
&gt; &gt;
&gt; &gt; That second test &#40;also for pwrite&#41; should either test for the
</div>&gt; *content*
<div class="message-stanza open">&gt; &gt; of SQLITE_ENABLE_LOCKING_STYLE or not test on it at all
&gt; &gt;
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt; make test
</div>&gt; &gt; &gt; gcc -c  -I. -I/opt/perl/lib/site_perl/5.14.0/PA-RISC2.0/auto/DBI
</div></div>&gt; -mpa-
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; risc-1-1 -DPERL_DONT_CREATE_GVSV -D_HPUX_SOURCE
</div></div>&gt; -fno-strict-aliasing -
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; pipe -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -O2   -DVERSION=
&gt; &gt; &gt; \&#34;1.31\&#34; -DXS_VERSION=\&#34;1.31\&#34; -fPIC &#34;-I/opt/perl/lib/5.14.0/PA-
</div></div>&gt; RISC2.0/
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; CORE&#34;  -DSQLITE_ENABLE_FTS3 -DSQLITE_ENABLE_FTS3_PARENTHESIS -
&gt; &gt; &gt; DSQLITE_ENABLE_COLUMN_METADATA -DNDEBUG=1 -DHAVE_USLEEP=1 -
&gt; &gt; &gt; DTHREADSAFE=0 -DSQLITE_OMIT_LOAD_EXTENSION sqlite3.c
&gt; &gt; &gt; sqlite3.c: In function `unixShmMap&#39;:
&gt; &gt; &gt; sqlite3.c:26184: error: `MAP_FAILED&#39; undeclared &#40;first use in this
&gt; &gt; &gt; function&#41;
&gt; &gt; &gt; sqlite3.c:26184: error: &#40;Each undeclared identifier is reported
</div></div>&gt; only
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; once
&gt; &gt; &gt; sqlite3.c:26184: error: for each function it appears in.&#41;
&gt; &gt; &gt;
&gt; &gt; &gt; After applying this patch:
&gt; &gt; &gt; --8&lt;---
&gt; &gt; &gt; --- sqlite3.c.org       2011-05-23 15:27:35 +0200
&gt; &gt; &gt; +++ sqlite3.c   2011-05-23 15:29:55 +0200
&gt; &gt; &gt; @@ -22661,6 +22661,10 @@ struct unixFile {
&gt; &gt; &gt;  */
&gt; &gt; &gt;  #define SQLITE_WHOLE_FILE_LOCKING  0x0001   /* Use whole-file
</div></div>&gt; locking */
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt;
&gt; &gt; &gt; +#ifndef MAP_FAILED
&gt; &gt; &gt; +#define MAP_FAILED   &#40;&#40;void *&#41; -1&#41;
&gt; &gt; &gt; +#endif
&gt; &gt; &gt; +
&gt; &gt; &gt;  /*
&gt; &gt; &gt;  ** Include code that is common to all os_*.c files
&gt; &gt; &gt;  */
&gt; &gt; &gt; --&gt;8---
&gt; &gt; &gt;
<div class="message-stanza open">&gt; &gt; &gt; &gt; make test
</div>&gt; &gt; &gt; :
&gt; &gt; &gt; All tests successful.
&gt; &gt; &gt; Files=59, Tests=1308, 87 wallclock secs &#40; 4.61 usr  0.48 sys +
</div></div>&gt; 53.42
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; cusr  3.96 csys = 62.47 CPU&#41;
&gt; &gt; &gt; Result: PASS
<div class="message-stanza open">&gt; &gt; &gt; &gt;
</div></div>&gt; &gt;
&gt; &gt;
&gt; &gt; --
&gt; &gt; H.Merijn Brand  <span class="clickylink"><a target="new" rel="nofollow" href="http://tux.nl">http://tux.nl</a></span>      Perl Monger
</div>&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://amsterdam.pm.org/">http://amsterdam.pm.org/</a></span>
<div class="message-stanza open">&gt; &gt; using 5.00307 through 5.14 and porting perl5.15.x on HP-UX 10.20,
</div>&gt; 11.00,
<div class="message-stanza open">&gt; &gt; 11.11, 11.23 and 11.31, OpenSuSE 10.1, 11.0 .. 11.4 and AIX 5.2 and
</div>&gt; 5.3.
<div class="message-stanza open">&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://mirrors.develooper.com/hpux/">http://mirrors.develooper.com/hpux/</a></span>           <span class="clickylink"><a target="new" rel="nofollow" href="http://www.test">http://www.test</a></span>-
</div>&gt; smoke.org/
<div class="message-stanza open">&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://qa.perl.org">http://qa.perl.org</a></span>      <span class="clickylink"><a target="new" rel="nofollow" href="http://www.goldmark.org/jeff/stupid-">http://www.goldmark.org/jeff/stupid-</a></span>
</div>&gt; disclaimers/
<div class="message-stanza open">&gt; &gt; _______________________________________________
&gt; &gt; sqlite-users mailing list
&gt; &gt; sqlite-users@sqlite.org
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://sqlite.org:8080/cgi-bin/mailman/listinfo/sqlite-users">http://sqlite.org:8080/cgi-bin/mailman/listinfo/sqlite-users</a></span>
&gt; &gt;
</div>&gt; 
&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;22&nbsp;09:08:17&nbsp;2011</span>
    <span class="description">The RT System itself - Ticket #69023:  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Take odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;12&nbsp;20:48:24&nbsp;2011</span>
    <span class="description">ishigaki [...] cpan.org - Ticket #69023:  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;12&nbsp;20:57:46&nbsp;2011</span>
    <span class="description">ishigaki [...] cpan.org - Ticket #69023:  Merged into ticket #68985</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;12&nbsp;20:57:46&nbsp;2011</span>
    <span class="description">ishigaki [...] cpan.org -  Merged into ticket #68985</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;16&nbsp;01:22:14&nbsp;2012</span>
    <span class="description">ishigaki [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I believe this has been fixed for some time. If not, please reopen this. 
Thanks.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;16&nbsp;01:22:16&nbsp;2012</span>
    <span class="description">ishigaki [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
