<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #40968 for Moose: Inherited constructor is silently masked by make_immutable</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #40968 for Moose: Inherited constructor is silently masked by make_immutable</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Moose">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Moose">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Moose">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Moose">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Moose">Moose CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">40968</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Moose">Moose</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
JSWARTZ [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-38786-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.61    </td>
  </tr>
  <tr id="CF-38787-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.62_02    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




010_inherited_constructor.t<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/533557/267543/010_inherited_constructor.t">
Sun Nov 16 00:15:56 2008 (419b) by JSWARTZ [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=40968">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-533557" href="/Public/Bug/Display.html?id=40968#txn-533557">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;16&nbsp;00:15:55&nbsp;2008</span>
    <span class="description">JSWARTZ [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Inherited constructor is silently masked by make_immutable</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/533557/267540/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/267540">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 282b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">An inherited new&#40;&#41; is silently masked by make_immutable in the derived
class. I realize that BUILD, etc. are preferred to new&#40;&#41;, but in this
case I had a good reason to override new&#40;&#41;, and it took me a while to
figure out why my inherited new&#40;&#41; wasn&#39;t being called.

Test attached.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 010_inherited_constructor.t</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/533557/267543/010_inherited_constructor.t">Download 010_inherited_constructor.t</a><br />
<span class="downloadcontenttype">text/x-perl 419b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl

use strict;
use warnings;

use Test::More tests =&gt; 1;

=pod

This tests that an inherited constructor will not be masked by make_immutable.

=cut

{
    package Foo;
    use Moose;

    our $new_called = 0;
    sub new {
        $new_called = 1;
    }
}

{
    package Bar;
    use Moose;
    extends &#39;Foo&#39;;

    Bar-&gt;meta-&gt;make_immutable&#40;&#41;;
}

Bar-&gt;new&#40;&#41;;
ok&#40;$Foo::new_called, &#34;Foo::new was called&#34;&#41;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-533560" href="/Public/Bug/Display.html?id=40968#txn-533560">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;16&nbsp;01:12:43&nbsp;2008</span>
    <span class="description">autarch [...] urth.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #40968] Inherited constructor is silently masked by make_immutable </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 16 Nov 2008 00:12:09 -0600 &#40;CST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> JSWARTZ via RT &lt;bug-Moose [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dave Rolsky &lt;autarch [...] urth.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/533560/267546/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/267546">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun, 16 Nov 2008, JSWARTZ via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sun Nov 16 00:15:55 2008: Request 40968 was acted upon.
&gt; Transaction: Ticket created by JSWARTZ
&gt;       Queue: Moose
&gt;     Subject: Inherited constructor is silently masked by make_immutable
&gt;   Broken in: 0.61
&gt;    Severity: Normal
&gt;       Owner: Nobody
&gt;  Requestors: JSWARTZ@cpan.org
&gt;      Status: new
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=40968">http://rt.cpan.org/Ticket/Display.html?id=40968</a></span> &gt;
&gt;
&gt;
&gt; An inherited new&#40;&#41; is silently masked by make_immutable in the derived
&gt; class. I realize that BUILD, etc. are preferred to new&#40;&#41;, but in this
&gt; case I had a good reason to override new&#40;&#41;, and it took me a while to
&gt; figure out why my inherited new&#40;&#41; wasn&#39;t being called.
</div>
This is pretty much what make_immutable is all about, and in fact this 
issue is one of the main reasons we tell people to not to override new&#40;&#41;.

If you _really_ want to override new and use make_immutable, you can 
provide your own immutable constructor class that replicates your new&#40;&#41; 
method. This is, obviously, a pain in the ass, but it&#39;s doable.

Fey::ORM has an example of this.

But this is definitely not a bug.


-dave

/*============================================================
<span class="clickylink"><a target="new" rel="nofollow" href="http://VegGuide.org">http://VegGuide.org</a></span>               <span class="clickylink"><a target="new" rel="nofollow" href="http://blog.urth.org">http://blog.urth.org</a></span>
Your guide to all that&#39;s veg      House Absolute&#40;ly Pointless&#41;
============================================================*/
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-533561" href="/Public/Bug/Display.html?id=40968#txn-533561">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;16&nbsp;01:12:49&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-533567" href="/Public/Bug/Display.html?id=40968#txn-533567">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;16&nbsp;01:46:22&nbsp;2008</span>
    <span class="description">rt.cpan [...] sartak.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #40968] Inherited constructor is silently masked by make_immutable</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 16 Nov 2008 01:46:10 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Moose [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Sartak &lt;sartak [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/533567/267552/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/267552">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun, Nov 16, 2008 at 1:12 AM, autarch@urth.org via RT
&lt;bug-Moose@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; An inherited new&#40;&#41; is silently masked by make_immutable in the derived
&gt;&gt; class. I realize that BUILD, etc. are preferred to new&#40;&#41;, but in this
&gt;&gt; case I had a good reason to override new&#40;&#41;, and it took me a while to
&gt;&gt; figure out why my inherited new&#40;&#41; wasn&#39;t being called.
</div>&gt;
&gt; This is pretty much what make_immutable is all about, and in fact this
&gt; issue is one of the main reasons we tell people to not to override new&#40;&#41;.
</div>
Sometimes you must inherit it from a non-Moose class.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If you _really_ want to override new and use make_immutable, you can
&gt; provide your own immutable constructor class that replicates your new&#40;&#41;
&gt; method. This is, obviously, a pain in the ass, but it&#39;s doable.
</div>
Passing inline_constructor =&gt; 0 to make_immutable is probably good
enough &#40;it was for me! :&#41;&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Fey::ORM has an example of this.
&gt;
&gt; But this is definitely not a bug.
</div>
Agreed. It might be useful to warn in this instance though. I&#39;ve been
bitten by the same thing. If the &#34;new&#34; is not provided by
Moose::Object, then we could warn if there&#39;s an *implicit*
inline_constructor =&gt; 1. Explicitly saying inline_constructor =&gt; 1
would silence the warning, because presumably you know what you&#39;re
doing.

I figure many users of Moose are just cargo culting the make_immutable
as an easy way to speed up the class, without knowing what it&#39;s
actually doing.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -dave
</div>
Shawn
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-533639" href="/Public/Bug/Display.html?id=40968#txn-533639">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;16&nbsp;08:46:33&nbsp;2008</span>
    <span class="description">stevan.little [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/533639/267606/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/267606">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 570b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Nov 16 01:46:22 2008, SARTAK wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sun, Nov 16, 2008 at 1:12 AM, autarch@urth.org via RT
<div class="message-stanza open">&gt; &gt;
&gt; &gt; But this is definitely not a bug.
</div></div>
I agree completely.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Agreed. It might be useful to warn in this instance though. I&#39;ve been
&gt; bitten by the same thing. If the &#34;new&#34; is not provided by
&gt; Moose::Object, then we could warn if there&#39;s an *implicit*
&gt; inline_constructor =&gt; 1. Explicitly saying inline_constructor =&gt; 1
&gt; would silence the warning, because presumably you know what you&#39;re
&gt; doing.
</div>
I like this idea, it seems a reasonable compromise.

- Stevan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-533642" href="/Public/Bug/Display.html?id=40968#txn-533642">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;16&nbsp;08:51:03&nbsp;2008</span>
    <span class="description">JSWARTZ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/533642/267609/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/267609">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Passing inline_constructor =&gt; 0 to make_immutable is probably good
&gt; enough &#40;it was for me! :&#41;&#41;.
</div>
Cool. Is this documented somewhere? The only documentation I could find
for make_immutable was Recipe7, which doesn&#39;t mention this.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt;
&gt; &gt; Fey::ORM has an example of this.
&gt; &gt;
&gt; &gt; But this is definitely not a bug.
</div>&gt; 
&gt; Agreed. It might be useful to warn in this instance though. I&#39;ve been
&gt; bitten by the same thing. If the &#34;new&#34; is not provided by
&gt; Moose::Object, then we could warn if there&#39;s an *implicit*
&gt; inline_constructor =&gt; 1. Explicitly saying inline_constructor =&gt; 1
&gt; would silence the warning, because presumably you know what you&#39;re
&gt; doing.
&gt; 
&gt; I figure many users of Moose are just cargo culting the make_immutable
&gt; as an easy way to speed up the class, without knowing what it&#39;s
&gt; actually doing.
</div>
Guilty as charged. But I shouldn&#39;t HAVE to understand how make_immutable
is implemented to use it. make_immutable is essentially documented as
&#34;this will speed up your class, but in return you can&#39;t make changes to
the metaclass afterwards&#34;. I followed those rules, and still got bitten,
because I assumed that basic OO rules &#40;like constructor inheritance&#41;
would not be affected. Sounds like Shawn got bitten too. I expect then
that many others will also get bitten.

If this behavior remains, as it sounds like it will, then there should
definitely at least be a warning, and something in the docs about &#34;this
will ignore inherited constructors.&#34;

What makes this worse is that you *can* override new&#40;&#41; in the class
itself, just not in its parents. If make_immutable were really &#34;all
about&#34; inlining the constructor &#40;it isn&#39;t - it&#39;s also about speeding up
attributes&#41;, then make_immutable ought to fail if there is a new&#40;&#41;
already defined.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This issue is one of the main reasons we tell people to not to
&gt; override new&#40;&#41;.
</div>
I didn&#39;t know that. I did know that overriding new&#40;&#41; is strongly
discouraged, but as I said, I had a legitimate reason to override new&#40;&#41;
in this case.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-533677" href="/Public/Bug/Display.html?id=40968#txn-533677">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;16&nbsp;12:01:07&nbsp;2008</span>
    <span class="description">stevan.little [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/533677/267620/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/267620">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Nov 16 08:51:03 2008, JSWARTZ wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Passing inline_constructor =&gt; 0 to make_immutable is probably good
&gt; &gt; enough &#40;it was for me! :&#41;&#41;.
</div>&gt; 
&gt; Cool. Is this documented somewhere? The only documentation I could find
&gt; for make_immutable was Recipe7, which doesn&#39;t mention this.
</div>
It should be mentioned in the Moose::Cookbook::WTF, there is a whole section on the evils of 
overriding new&#40;&#41; in there &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~drolsky/Moose-">http://search.cpan.org/~drolsky/Moose-</a></span>
0.61/lib/Moose/Cookbook/WTF.pod#Constructors_&#38;_Immutability&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; 
<div class="message-stanza open">&gt; &gt; &gt;
&gt; &gt; &gt; Fey::ORM has an example of this.
&gt; &gt; &gt;
&gt; &gt; &gt; But this is definitely not a bug.
</div>&gt; &gt; 
&gt; &gt; Agreed. It might be useful to warn in this instance though. I&#39;ve been
&gt; &gt; bitten by the same thing. If the &#34;new&#34; is not provided by
&gt; &gt; Moose::Object, then we could warn if there&#39;s an *implicit*
&gt; &gt; inline_constructor =&gt; 1. Explicitly saying inline_constructor =&gt; 1
&gt; &gt; would silence the warning, because presumably you know what you&#39;re
&gt; &gt; doing.
&gt; &gt; 
&gt; &gt; I figure many users of Moose are just cargo culting the make_immutable
&gt; &gt; as an easy way to speed up the class, without knowing what it&#39;s
&gt; &gt; actually doing.
</div>&gt; 
&gt; Guilty as charged. But I shouldn&#39;t HAVE to understand how make_immutable
&gt; is implemented to use it. 
</div>
Agreed, however I think all you need to understand here &#40;and unfortunately it doesnt seem to be 
documented clearly anywhere&#41; that immutable creates an inlined constructor for you, which means it 
will create a local -&gt;new&#40;&#41; which obviously will override.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; make_immutable is essentially documented as
&gt; &#34;this will speed up your class, but in return you can&#39;t make changes to
&gt; the metaclass afterwards&#34;. I followed those rules, and still got bitten,
&gt; because I assumed that basic OO rules &#40;like constructor inheritance&#41;
&gt; would not be affected. Sounds like Shawn got bitten too. I expect then
&gt; that many others will also get bitten.
</div>
I won&#39;t disagree that it can be surprising, however it is not breaking basic OO rules because it is 
creating a local -&gt;new&#40;&#41;, this it the trade off.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If this behavior remains, as it sounds like it will, then there should
&gt; definitely at least be a warning, and something in the docs about &#34;this
&gt; will ignore inherited constructors.&#34;
</div>
We can detect an inherited constructor so we can basically just warn in the specific circumstance, 
Shawn mentioned that above.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; What makes this worse is that you *can* override new&#40;&#41; in the class
&gt; itself, just not in its parents. If make_immutable were really &#34;all
&gt; about&#34; inlining the constructor &#40;it isn&#39;t - it&#39;s also about speeding up
&gt; attributes&#41;, then make_immutable ought to fail if there is a new&#40;&#41;
&gt; already defined.
</div>
Actually, that line in the docs is kind of misleading, because Moose already inlines the accessors for 
you by default. So immutability has little affect on the accessors and almost all of the benefit is in the 
constructors.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; This issue is one of the main reasons we tell people to not to
&gt; &gt; override new&#40;&#41;.
</div>&gt; 
&gt; I didn&#39;t know that. I did know that overriding new&#40;&#41; is strongly
&gt; discouraged, but as I said, I had a legitimate reason to override new&#40;&#41;
&gt; in this case.
</div>
Can you explain that reason? Perhaps there is a &#40;poorly documented&#41; feature that exists that we can 
point you too. Between BUILD, BUILDARGS, attribute defaults, attribute builders and attribute laziness 
there are very few good reasons left actually.

- Stevan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-536876" href="/Public/Bug/Display.html?id=40968#txn-536876">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;24&nbsp;15:43:24&nbsp;2008</span>
    <span class="description">swartz [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> JSWARTZ [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #40968] Inherited constructor is silently masked by make_immutable </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 24 Nov 2008 12:42:58 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Moose [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jonathan Swartz &lt;swartz [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/536876/269445/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/269445">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 811b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;
&gt;&gt;&gt; This issue is one of the main reasons we tell people to not to
&gt;&gt;&gt; override new&#40;&#41;.
</div>&gt;&gt;
&gt;&gt; I didn&#39;t know that. I did know that overriding new&#40;&#41; is strongly
&gt;&gt; discouraged, but as I said, I had a legitimate reason to override  
&gt;&gt; new&#40;&#41;
&gt;&gt; in this case.
</div>&gt;
&gt; Can you explain that reason? Perhaps there is a &#40;poorly documented&#41;  
&gt; feature that exists that we can
&gt; point you too. Between BUILD, BUILDARGS, attribute defaults,  
&gt; attribute builders and attribute laziness
&gt; there are very few good reasons left actually.
&gt;
</div>
Well, to be honest, it was because we are using an old version of  
Moose that doesn&#39;t have BUILDARGS. So upgrading would fix this. I  
still think people will override new some of the time, whether or not  
it is truly necessary. Anyway, thanks for your reasonable responses.

Jon
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-536966" href="/Public/Bug/Display.html?id=40968#txn-536966">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;24&nbsp;23:44:42&nbsp;2008</span>
    <span class="description">nothingmuch [...] woobling.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #40968] Inherited constructor is silently masked by make_immutable</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 25 Nov 2008 06:44:31 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Moose [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Yuval Kogman&#34; &lt;nothingmuch [...] woobling.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/536966/269506/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/269506">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 93b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">if &#40; $class-&gt;can&#40;&#34;new&#34;&#41; == &#34;Moose::Object&#34;-&gt;can&#40;&#34;new&#34;&#41; &#41; { # make an
immutable constructor }
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/536966/269507/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/269507">with headers</a>
<br />
<span class="downloadcontenttype">text/html 165b</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-543182" href="/Public/Bug/Display.html?id=40968#txn-543182">#</a>      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;12&nbsp;15:28:32&nbsp;2008</span>
    <span class="description">DROLSKY [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-543184" href="/Public/Bug/Display.html?id=40968#txn-543184">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;12&nbsp;15:28:32&nbsp;2008</span>
    <span class="description">DROLSKY [...] cpan.org -  Fixed in 0.62_02 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.627496</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
