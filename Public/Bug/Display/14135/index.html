<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #14135 for Maypole: send_output should return a status code</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #14135 for Maypole: send_output should return a status code</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Maypole/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Maypole/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Maypole/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Maypole/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Maypole">Maypole CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">14135</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Maypole/Active/">Maypole</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">TEEJAY [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dave [...] riverside-cms.co.uk

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-21076-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-21077-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;12&nbsp;06:46:22&nbsp;2005</span>
    <span class="description">cpan.zerofive [...] googlemail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> send_output should return a status code</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The send_output methods in the frontend classes should return a status code, and Maypole::handler&#40;&#41; should return that code, rather than assuming that the code has not changed from OK during send_output&#40;&#41;. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;22&nbsp;14:19:54&nbsp;2005</span>
    <span class="description">TEEJAY [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;22&nbsp;14:19:54&nbsp;2005</span>
    <span class="description">TEEJAY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[DAVEBAIRD - Fri Aug 12 06:46:22 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The send_output methods in the frontend classes should return a status
&gt; code, and Maypole::handler&#40;&#41; should return that code, rather than
&gt; assuming that the code has not changed from OK during send_output&#40;&#41;.
</div>

Can we have a bit more detail of which module send_output is in, etc?

If the solution is obvious can you apply a fix in SVN otherwise suggest
a general plan here or on the list

Thanks,

A.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;22&nbsp;18:30:39&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[TEEJAY - Mon Aug 22 14:19:54 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; [DAVEBAIRD - Fri Aug 12 06:46:22 2005]:
&gt; 
<div class="message-stanza open">&gt; &gt; The send_output methods in the frontend classes should return a
</div>&gt; status
<div class="message-stanza open">&gt; &gt; code, and Maypole::handler&#40;&#41; should return that code, rather than
&gt; &gt; assuming that the code has not changed from OK during send_output&#40;&#41;.
</div>&gt; 
&gt; 
&gt; Can we have a bit more detail of which module send_output is in, etc?
</div>
Maypole::handler&#40;&#41; finishes like this:

    my $status = $r-&gt;handler_guts&#40;&#41;;
    return $status unless $status == OK;
    $r-&gt;send_output;
    return $status;

send_output is defined in the particular frontend - CGI::Maypole,
Apache::MVC, MasonX::Maypole, Maypole::CLI. The first 2 print their
output, but don&#39;t check for an error from the print method, and
implicitly return the return value of the print call. These send_output
methods are pretty straightforward and there&#39;s not much opportunity for
an error, but if there is one, it will not be caught.

MasonX::Maypole::send_output has to jump through a few more hoops, so is
more error prone. Also, templates run perl code, which is run during
send_output, so there&#39;s plenty of scope for errors. The final call is to
the Mason exec&#40;&#41; method, which returns a HTTP status code i.e.
SERVER_ERROR if there&#39;s a syntax error in one of the templates. The
expectation is that the status code will be returned to the handler,
which will return it to the client. But the handler ignores it. 

 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If the solution is obvious can you apply a fix in SVN otherwise
&gt; suggest
&gt; a general plan here or on the list
</div>
The solution I think is that the frontends that don&#39;t want or need to
check for errors in send_output should return OK. Maypole::handler
should then return the rv from the send_output call:

    my $status = $r-&gt;handler_guts&#40;&#41;;
    return $status unless $status == OK;
    return $r-&gt;send_output;

If that looks reasonable I can fix up the frontends. 

d.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;12&nbsp;10:41:14&nbsp;2005</span>
    <span class="description">cpan.zerofive [...] googlemail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[guest - Mon Aug 22 18:30:39 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; [TEEJAY - Mon Aug 22 14:19:54 2005]:
&gt; 
<div class="message-stanza open">&gt; &gt; [DAVEBAIRD - Fri Aug 12 06:46:22 2005]:
&gt; &gt;
<div class="message-stanza open">&gt; &gt; &gt; The send_output methods in the frontend classes should return a
</div>&gt; &gt; status
<div class="message-stanza open">&gt; &gt; &gt; code, and Maypole::handler&#40;&#41; should return that code, rather than
&gt; &gt; &gt; assuming that the code has not changed from OK during
</div></div>&gt; send_output&#40;&#41;.
<div class="message-stanza open">&gt; &gt;
&gt; &gt;
&gt; &gt; Can we have a bit more detail of which module send_output is in,
</div>&gt; etc?
&gt; 
&gt; Maypole::handler&#40;&#41; finishes like this:
&gt; 
&gt;     my $status = $r-&gt;handler_guts&#40;&#41;;
&gt;     return $status unless $status == OK;
&gt;     $r-&gt;send_output;
&gt;     return $status;
&gt; 
&gt; send_output is defined in the particular frontend - CGI::Maypole,
&gt; Apache::MVC, MasonX::Maypole, Maypole::CLI. The first 2 print their
&gt; output, but don&#39;t check for an error from the print method, and
&gt; implicitly return the return value of the print call. These
&gt; send_output
&gt; methods are pretty straightforward and there&#39;s not much opportunity
&gt; for
&gt; an error, but if there is one, it will not be caught.
&gt; 
&gt; MasonX::Maypole::send_output has to jump through a few more hoops, so
&gt; is
&gt; more error prone. Also, templates run perl code, which is run during
&gt; send_output, so there&#39;s plenty of scope for errors. The final call is
&gt; to
&gt; the Mason exec&#40;&#41; method, which returns a HTTP status code i.e.
&gt; SERVER_ERROR if there&#39;s a syntax error in one of the templates. The
&gt; expectation is that the status code will be returned to the handler,
&gt; which will return it to the client. But the handler ignores it.
&gt; 
&gt; 
<div class="message-stanza open">&gt; &gt; If the solution is obvious can you apply a fix in SVN otherwise
&gt; &gt; suggest
&gt; &gt; a general plan here or on the list
</div>&gt; 
&gt; The solution I think is that the frontends that don&#39;t want or need to
&gt; check for errors in send_output should return OK. Maypole::handler
&gt; should then return the rv from the send_output call:
&gt; 
&gt;     my $status = $r-&gt;handler_guts&#40;&#41;;
&gt;     return $status unless $status == OK;
&gt;     return $r-&gt;send_output;
&gt; 
&gt; If that looks reasonable I can fix up the frontends.
&gt; 
&gt; d.
</div>

Let&#39;s tag this for 2.12. Although the fix is easy enough, we should look
at this together with the workflow changes.

d.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;02&nbsp;11:22:53&nbsp;2006</span>
    <span class="description">TEEJAY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">HTTP Status codes are now returned by the handler, does this overcome
the problem?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Give odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;02&nbsp;11:22:55&nbsp;2006</span>
    <span class="description">TEEJAY [...] cpan.org -  Given to TEEJAY</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
