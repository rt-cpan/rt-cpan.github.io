<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #103782 for Perl-Dist-Strawberry: strawberry-perl-5.18.4.1-32bit: perl518.dll cannot be relocated</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #103782 for Perl-Dist-Strawberry: strawberry-perl-5.18.4.1-32bit: perl518.dll cannot be relocated</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Perl-Dist-Strawberry/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Perl-Dist-Strawberry/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Perl-Dist-Strawberry/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Perl-Dist-Strawberry/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Perl-Dist-Strawberry">Perl-Dist-Strawberry CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">103782</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Perl-Dist-Strawberry/Active/">Perl-Dist-Strawberry</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
John.Unsworth [...] owmessaging.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-40214-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-40215-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;17&nbsp;06:12:16&nbsp;2015</span>
    <span class="description">John.Unsworth [...] owmessaging.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> strawberry-perl-5.18.4.1-32bit: perl518.dll cannot be relocated</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 17 Apr 2015 10:11:54 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Perl-Dist-Strawberry [...] rt.cpan.org&#34; &lt;bug-Perl-Dist-Strawberry [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Unsworth &lt;John.Unsworth [...] owmessaging.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Using strawberry-perl-5.18.4.1-32bit.msi.

I need to load perl518.dll in my application to use embedded perl calls. However if perl518.dll needs to be relocated &#40;a common requirement of windows dlls&#41; a memory access error occurs.

I built a simple Visual C application:

    printf&#40;&#34;Trying to load perl518.dll ...\n&#34;&#41;;
    HMODULE hm = LoadLibrary&#40;L&#34;C:\\strawberry518\\perl\\bin\\perl518.dll&#34;&#41;;
    if &#40;hm == NULL&#41;
    {
        LPVOID lpMsgBuf;
        LPTSTR args[2];
        args[0] = L&#34;perl518.dll&#34;;
        args[1] = NULL;
        FormatMessage&#40;
            FORMAT_MESSAGE_ALLOCATE_BUFFER |
            FORMAT_MESSAGE_FROM_SYSTEM |
            FORMAT_MESSAGE_IGNORE_INSERTS |
            FORMAT_MESSAGE_ARGUMENT_ARRAY,
            NULL,
            GetLastError&#40;&#41;,
            MAKELANGID&#40;LANG_NEUTRAL, SUBLANG_DEFAULT&#41;, // Default language
            &#40;LPTSTR&#41; &#38;lpMsgBuf,
            0,
            &#40;va_list*&#41;args
        &#41;;
        printf&#40;&#34;Error %d %S\n&#34;, GetLastError&#40;&#41;, &#40;const char*&#41;lpMsgBuf&#41;;
    }

If the application is built so that it loads at perl518 preferred address 0x63300000 then the above load results in:

Trying to load perl518.dll ...
Error 998 Invalid access to memory location.

The error occurs in the dll initialization function.

If I change the application base address so it doesn&#39;t clash then it loads successfully:

TestLoad.exe     C:\SmartSVN\CPMDS\Atlas\v4.0\shared\Bin\TestLoad.exe        64300000-6431A000
perl518.dll           C:\strawberry518\perl\bin\perl518.dll                                                   63300000-6347E000

It cannot be guaranteed that 63300000 will be available and so the dll has to be able to relocate. The same applies to any other dlls that you supply. This is a standard windows requirement.

Regards,
John.
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;22&nbsp;08:49:45&nbsp;2015</span>
    <span class="description">John.Unsworth [...] owmessaging.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #103782] strawberry-perl-5.18.4.1-32bit: perl518.dll cannot be relocated</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 22 Apr 2015 12:49:22 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Perl-Dist-Strawberry [...] rt.cpan.org&#34; &lt;bug-Perl-Dist-Strawberry [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Unsworth &lt;John.Unsworth [...] owmessaging.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">It seems that some relocation does go on however not everything is relocated correctly.

006D1443 8B 54 24 24          mov         edx,dword ptr [esp+24h]  
006D1447 C7 05 14 B1 BF 9D 00 00 00 00 mov         dword ptr ds:[9DBFB114h],0  
006D1451 83 FA 01             cmp         edx,1  
006D1454 74 1A                je          006D1470  

The dll is loaded at 0x006d0000. The jump has been correctly relocated but the code at 006D1447 hasn&#39;t.

John.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;25&nbsp;03:30:35&nbsp;2015</span>
    <span class="description">kmx [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #103782] strawberry-perl-5.18.4.1-32bit: perl518.dll cannot be relocated</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 25 Apr 2015 09:30:16 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Perl-Dist-Strawberry [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kmx &lt;kmx [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">John,

the strawberry perl uses standard build procedure for MS Windows + gcc 
environment.

If the resulting binaries are not OK it is probably an issue in perl core.

I&#39;ll try to ask people with more insight into this are.

If you have any proposal for special compiler/liker flags that have to be 
used to nake DLL/EXE files correctly relocatable, please post it here.

--
kmx
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;25&nbsp;03:30:35&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;25&nbsp;15:27:59&nbsp;2015</span>
    <span class="description">BULKDD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Apr 25 03:30:35 2015, KMX wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; John,
&gt; 
&gt; the strawberry perl uses standard build procedure for MS Windows + gcc 
&gt; environment.
&gt; 
&gt; If the resulting binaries are not OK it is probably an issue in perl core.
&gt; 
&gt; I&#39;ll try to ask people with more insight into this are.
&gt; 
&gt; If you have any proposal for special compiler/liker flags that have to be 
&gt; used to nake DLL/EXE files correctly relocatable, please post it here.
&gt; 
&gt; --
&gt; kmx
</div>

Probably related to <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=78395#txn-1458443">https://rt.cpan.org/Ticket/Display.html?id=78395#txn-1458443</a></span> where i used SP 5.18 to make that report.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;25&nbsp;15:43:30&nbsp;2015</span>
    <span class="description">BULKDD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Double relocation strikes again. From OP&#39;s post, prefered base address is 0x63300000, new addr by os is 0x006d0000, adjustment offset is 0x1006d0000-0x63300000=0x9D3D0000.
0x63300000+0x9D3D0000=0x006D0000. 

fault addr 0x9DBFB114-0x9D3D0000-0x9D3D0000 &#40;2 reloc offsets&#41;, is 0x6345B114. OP reports original preferered address range of the XS DLL was 0x63300000 to 0x6347E000 and 0x6345B114 is within those bounds.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;27&nbsp;17:03:37&nbsp;2015</span>
    <span class="description">John.Unsworth [...] owmessaging.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #103782] strawberry-perl-5.18.4.1-32bit: perl518.dll cannot be relocated</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 27 Apr 2015 21:03:27 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Perl-Dist-Strawberry [...] rt.cpan.org&#34; &lt;bug-Perl-Dist-Strawberry [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Unsworth &lt;John.Unsworth [...] owmessaging.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Note that ActiveState Perl 5.18 and 5.20 are built using mingw and have exactly the same problem. How do we get both Strawberry Perl and AS Perl fixed? Is the problem that causes the invalid relocations understood?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Daniel Dragan via RT [mailto:bug-Perl-Dist-Strawberry@rt.cpan.org] 
Sent: 25 April 2015 20:44
To: John Unsworth
Subject: [rt.cpan.org #103782] strawberry-perl-5.18.4.1-32bit: perl518.dll cannot be relocated

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=103782">https://rt.cpan.org/Ticket/Display.html?id=103782</a></span> &gt;

Double relocation strikes again. From OP&#39;s post, prefered base address is 0x63300000, new addr by os is 0x006d0000, adjustment offset is 0x1006d0000-0x63300000=0x9D3D0000.
0x63300000+0x9D3D0000=0x006D0000. 

fault addr 0x9DBFB114-0x9D3D0000-0x9D3D0000 &#40;2 reloc offsets&#41;, is 0x6345B114. OP reports original preferered address range of the XS DLL was 0x63300000 to 0x6347E000 and 0x6345B114 is within those bounds.


</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;28&nbsp;21:04:12&nbsp;2015</span>
    <span class="description">BULKDD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Apr 27 17:03:37 2015, John.Unsworth@owmessaging.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Note that ActiveState Perl 5.18 and 5.20 are built using mingw and
&gt; have exactly the same problem. How do we get both Strawberry Perl and
&gt; AS Perl fixed? Is the problem that causes the invalid relocations
&gt; understood?
</div>
Quick answer, switch to self compiled Visual C Perl.

GCC maintainers see GCC on Win32 as a toy. If you used Visual C &#40;like I do&#41;, you wouldn&#39;t have a linker that produces unrunable binaries. Mingw GCC still doesn&#39;t support 32 bit SEH, and GCC maintainers can&#39;t keep binary compatibility between GCC releases either &#40;try mixing an app that links to libstdc++-6.dll where one is made with 4.6 and the other with 4.8, either way around, and you can have only one libstdc++-6.dll in a process&#41;. 

In all reality, the first, and most widely distributed &#40;and still distributed by ActiveState PPM&#41; Mingw for Perl can&#39;t even produce a hello world binary that doesn&#39;t SEGV on start.

---------------------------------------------------------
C:\Documents and Settings\Administrator\Desktop\assert&gt;C:\Perl3216\site\bin\gcc.
exe -v
Reading specs from C:/Perl3216/site/lib/auto/MinGW/bin/../lib/gcc/mingw32/3.4.5/
specs
Configured with: ../gcc-3.4.5-20060117-3/configure --with-gcc --with-gnu-ld --wi
th-gnu-as --host=mingw32 --target=mingw32 --prefix=/mingw --enable-threads --dis
able-nls --enable-languages=c,c++,f77,ada,objc,java --disable-win32-registry --d
isable-shared --enable-sjlj-exceptions --enable-libgcj --disable-java-awt --with
out-x --enable-java-gc=boehm --disable-libgcj-debug --enable-interpreter --enabl
e-hash-synchronization --enable-libstdcxx-debug
Thread model: win32
gcc version 3.4.5 &#40;mingw-vista special r3&#41;

C:\Documents and Settings\Administrator\Desktop\assert&gt;type assert.c
int main&#40;void&#41; { return 0; }

C:\Documents and Settings\Administrator\Desktop\assert&gt;C:\Perl3216\site\bin\gcc.
exe -lkernel32 -lmsvcrt assert.c -o assert.exe

C:\Documents and Settings\Administrator\Desktop\assert&gt;assert.exe
****CRASH BOX******
C:\Documents and Settings\Administrator\Desktop\assert&gt;
----------------------------------------------------------

If you want to complain here are some places to try &#40;the maintenance chain is so opaque and fluid that there is no one correct place&#41;

<span class="clickylink"><a target="new" rel="nofollow" href="http://sourceforge.net/p/perlmingw/tickets/?source=navbar">http://sourceforge.net/p/perlmingw/tickets/?source=navbar</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://sourceforge.net/p/mingw-w64/bugs/">http://sourceforge.net/p/mingw-w64/bugs/</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://sourceforge.net/p/mingw/bugs/">http://sourceforge.net/p/mingw/bugs/</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="https://www.sourceware.org/bugzilla/">https://www.sourceware.org/bugzilla/</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="https://gcc.gnu.org/bugzilla/">https://gcc.gnu.org/bugzilla/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;29&nbsp;03:30:10&nbsp;2015</span>
    <span class="description">John.Unsworth [...] owmessaging.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #103782] strawberry-perl-5.18.4.1-32bit: perl518.dll cannot be relocated</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 29 Apr 2015 07:29:48 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Perl-Dist-Strawberry [...] rt.cpan.org&#34; &lt;bug-Perl-Dist-Strawberry [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Unsworth &lt;John.Unsworth [...] owmessaging.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Just to be clear. I use VC to compile my applications but use Perl embedded. For customer ease of use we have an ActiveState OEM licence. I was looking at Strawberry Perl as a possible replacement.

Regards,
John.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Daniel Dragan via RT [mailto:bug-Perl-Dist-Strawberry@rt.cpan.org] 
Sent: 29 April 2015 02:04
To: John Unsworth
Subject: [rt.cpan.org #103782] strawberry-perl-5.18.4.1-32bit: perl518.dll cannot be relocated

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=103782">https://rt.cpan.org/Ticket/Display.html?id=103782</a></span> &gt;

On Mon Apr 27 17:03:37 2015, John.Unsworth@owmessaging.com wrote:
<div class="message-stanza open">&gt; Note that ActiveState Perl 5.18 and 5.20 are built using mingw and 
&gt; have exactly the same problem. How do we get both Strawberry Perl and 
&gt; AS Perl fixed? Is the problem that causes the invalid relocations 
&gt; understood?
</div>
Quick answer, switch to self compiled Visual C Perl.

GCC maintainers see GCC on Win32 as a toy. If you used Visual C &#40;like I do&#41;, you wouldn&#39;t have a linker that produces unrunable binaries. Mingw GCC still doesn&#39;t support 32 bit SEH, and GCC maintainers can&#39;t keep binary compatibility between GCC releases either &#40;try mixing an app that links to libstdc++-6.dll where one is made with 4.6 and the other with 4.8, either way around, and you can have only one libstdc++-6.dll in a process&#41;. 

In all reality, the first, and most widely distributed &#40;and still distributed by ActiveState PPM&#41; Mingw for Perl can&#39;t even produce a hello world binary that doesn&#39;t SEGV on start.

---------------------------------------------------------
C:\Documents and Settings\Administrator\Desktop\assert&gt;C:\Perl3216\site\bin\gcc.
exe -v
Reading specs from C:/Perl3216/site/lib/auto/MinGW/bin/../lib/gcc/mingw32/3.4.5/
specs
Configured with: ../gcc-3.4.5-20060117-3/configure --with-gcc --with-gnu-ld --wi th-gnu-as --host=mingw32 --target=mingw32 --prefix=/mingw --enable-threads --dis able-nls --enable-languages=c,c++,f77,ada,objc,java --disable-win32-registry --d isable-shared --enable-sjlj-exceptions --enable-libgcj --disable-java-awt --with out-x --enable-java-gc=boehm --disable-libgcj-debug --enable-interpreter --enabl e-hash-synchronization --enable-libstdcxx-debug Thread model: win32 gcc version 3.4.5 &#40;mingw-vista special r3&#41;

C:\Documents and Settings\Administrator\Desktop\assert&gt;type assert.c int main&#40;void&#41; { return 0; }

C:\Documents and Settings\Administrator\Desktop\assert&gt;C:\Perl3216\site\bin\gcc.
exe -lkernel32 -lmsvcrt assert.c -o assert.exe

C:\Documents and Settings\Administrator\Desktop\assert&gt;assert.exe
****CRASH BOX******
C:\Documents and Settings\Administrator\Desktop\assert&gt;
----------------------------------------------------------

If you want to complain here are some places to try &#40;the maintenance chain is so opaque and fluid that there is no one correct place&#41;

<span class="clickylink"><a target="new" rel="nofollow" href="http://sourceforge.net/p/perlmingw/tickets/?source=navbar">http://sourceforge.net/p/perlmingw/tickets/?source=navbar</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://sourceforge.net/p/mingw-w64/bugs/">http://sourceforge.net/p/mingw-w64/bugs/</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://sourceforge.net/p/mingw/bugs/">http://sourceforge.net/p/mingw/bugs/</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="https://www.sourceware.org/bugzilla/">https://www.sourceware.org/bugzilla/</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="https://gcc.gnu.org/bugzilla/">https://gcc.gnu.org/bugzilla/</a></span>

</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;05&nbsp;11:28:45&nbsp;2015</span>
    <span class="description">kmx [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza">Could you please post here (or somewhere else) a small demo application (Visual studio *.sln) embeding strawberry perl?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;05&nbsp;11:53:07&nbsp;2015</span>
    <span class="description">John.Unsworth [...] owmessaging.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #103782] strawberry-perl-5.18.4.1-32bit: perl518.dll cannot be relocated</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 5 Jun 2015 15:52:51 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Perl-Dist-Strawberry [...] rt.cpan.org&#34; &lt;bug-Perl-Dist-Strawberry [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Unsworth &lt;John.Unsworth [...] owmessaging.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here is a MingW example. The same can be built using VS setting the correct options.

I have libperl518.a in the build folder c:\MinGW\test.
%PATH% has c:\strawberry518\perl\bin;c:\mingw\bin;...

TestLoad.c

#include &#34;config.h&#34;
#include &#34;EXTERN.h&#34;
#include &#34;perl.h&#34;
#include &#34;XSUB.h&#34;

int main&#40;int argc, char* argv[]&#41;
 {
    PerlInterpreter *my_perl = perl_alloc&#40;&#41;;
    return 0;
}

Build

c:\MinGW\test&gt;gcc -o testload.exe -I &#34;C:\strawberry518\perl\lib\CORE&#34; -Wl,--image-base,0x63300000 testload.c libperl518.a

Note that ActiveState Perl 518 has exactly the same problem because they built using MingW too. I am hoping for a test fix from them shortly that is supposed to sort out the double relocations.

John.


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;17&nbsp;09:19:12&nbsp;2015</span>
    <span class="description">John.Unsworth [...] owmessaging.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #103782] strawberry-perl-5.18.4.1-32bit: perl518.dll cannot be relocated</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 17 Aug 2015 13:18:49 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Perl-Dist-Strawberry [...] rt.cpan.org&#34; &lt;bug-Perl-Dist-Strawberry [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Unsworth &lt;John.Unsworth [...] owmessaging.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">FYI ActiveState have now released versions of Perl for Windows that fix this problem.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: John Unsworth 
Sent: 05 June 2015 16:53
To: &#39;bug-Perl-Dist-Strawberry@rt.cpan.org&#39; &lt;bug-Perl-Dist-Strawberry@rt.cpan.org&gt;
Subject: RE: [rt.cpan.org #103782] strawberry-perl-5.18.4.1-32bit: perl518.dll cannot be relocated

Here is a MingW example. The same can be built using VS setting the correct options.

I have libperl518.a in the build folder c:\MinGW\test.
%PATH% has c:\strawberry518\perl\bin;c:\mingw\bin;...

TestLoad.c

#include &#34;config.h&#34;
#include &#34;EXTERN.h&#34;
#include &#34;perl.h&#34;
#include &#34;XSUB.h&#34;

int main&#40;int argc, char* argv[]&#41;
 {
    PerlInterpreter *my_perl = perl_alloc&#40;&#41;;
    return 0;
}

Build

c:\MinGW\test&gt;gcc -o testload.exe -I &#34;C:\strawberry518\perl\lib\CORE&#34; -Wl,--image-base,0x63300000 testload.c libperl518.a

Note that ActiveState Perl 518 has exactly the same problem because they built using MingW too. I am hoping for a test fix from them shortly that is supposed to sort out the double relocations.

John.


</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;22&nbsp;16:40:56&nbsp;2015</span>
    <span class="description">kmx [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #103782] strawberry-perl-5.18.4.1-32bit: perl518.dll cannot be relocated</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 22 Aug 2015 22:40:42 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Perl-Dist-Strawberry [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kmx &lt;kmx [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 17.8.2015 15:19, John Unsworth via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; FYI ActiveState have now released versions of Perl for Windows that fix this problem.
</div>
Thanks for an update. Jan Dubois &#40;from ActiveState&#41; proposed a patch for 
perl core so it will be fixed in some future version &#40;I hope for 5.22.1&#41;

--
kmx
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
