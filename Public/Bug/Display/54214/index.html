<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #54214 for Text-Diff: Test-Differences Always Outputs UTF-8 text as ugly \x{....} escapes</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #54214 for Text-Diff: Test-Differences Always Outputs UTF-8 text as ugly \x{....} escapes</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Text-Diff">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Text-Diff">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Text-Diff">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Text-Diff">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Text-Diff">Text-Diff CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">54214</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Text-Diff">Text-Diff</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
SHLOMIF [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-31890-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.37    </td>
  </tr>
  <tr id="CF-31891-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




54214-unicode-output.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/754264/390002/54214-unicode-output.diff">
Sat Mar 27 09:42:35 2010 (4.5k) by SHLOMIF [...] cpan.org
</a>
</font></li>
</ul>


test-diff.t<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/727792/375870/test-diff.t">
Tue Feb 02 01:43:20 2010 (328b) by SHLOMIF [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=54214">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-727792" href="/Public/Bug/Display.html?id=54214#txn-727792">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;02&nbsp;01:43:20&nbsp;2010</span>
    <span class="description">SHLOMIF [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Test-Differences Always Outputs UTF-8 text as ugly \x{....} escapes</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/727792/375869/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/375869">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">When running the following test script &#40;also attached&#41;:

&lt;&lt;&lt;

#!/usr/bin/perl

use strict;
use warnings;

use utf8;

use Test::More tests =&gt; 1;
use Test::Differences;

# So we can output the text from the tests as UTF-8
binmode&#40;STDOUT, &#34;:encoding&#40;utf-8&#41;&#34;&#41;;
binmode&#40;STDERR, &#34;:encoding&#40;utf-8&#41;&#34;&#41;;

# TEST
eq_or_diff&#40;
    &lt;&lt;&#34;EOF&#34;,
Hello
שלוש
EOF
    &lt;&lt;&#34;EOF&#34;,
Hello
שלום
EOF
&#41;;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&gt;&gt;
</div>
I&#39;m getting the following output on the console:

&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
test-diff.t .. 1/1
#   Failed test at test-diff.t line 16.
#
+---+----------------------------------+----------------------------------+
# | Ln|Got                               |Expected                     
    |
#
+---+----------------------------------+----------------------------------+
# |  1|Hello                             |Hello                        
    |
# *  2|\x{05e9}\x{05dc}\x{05d5}\x{05e9} 
|\x{05e9}\x{05dc}\x{05d5}\x{05dd}  *
#
+---+----------------------------------+----------------------------------+
# Looks like you failed 1 test of 1.
test-diff.t .. Dubious, test returned 1 &#40;wstat 256, 0x100&#41;
Failed 1/1 subtests

Test Summary Report
-------------------
test-diff.t &#40;Wstat: 256 Tests: 1 Failed: 1&#41;
  Failed test:  1
  Non-zero exit status: 1
Files=1, Tests=1,  1 wallclock secs &#40; 0.07 usr  0.02 sys +  0.13 cusr 
0.02 csys =  0.24 CPU&#41;
Result: FAIL

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
</div>
I&#39;d like to get rid of this ugly \x{...} and see the actual Hebrew
characters. Please fix it appropriately.

Regards,

-- Shlomi Fish
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> test-diff.t</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/727792/375870/test-diff.t">Download test-diff.t</a><br />
<span class="downloadcontenttype">text/x-perl 328b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl

use strict;
use warnings;

use utf8;

use Test::More tests =&gt; 1;
use Test::Differences;

# So we can output the text from the tests as UTF-8
binmode&#40;STDOUT, &#34;:encoding&#40;utf-8&#41;&#34;&#41;;
binmode&#40;STDERR, &#34;:encoding&#40;utf-8&#41;&#34;&#41;;

# TEST
eq_or_diff&#40;
    &lt;&lt;&#34;EOF&#34;,
Hello
×©×××©
EOF
    &lt;&lt;&#34;EOF&#34;,
Hello
×©×××
EOF
&#41;;
        
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-728278" href="/Public/Bug/Display.html?id=54214#txn-728278">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;03&nbsp;03:29:51&nbsp;2010</span>
    <span class="description">ovid [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/728278/376168/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/376168">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 397b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Shlomi,

Thank you for the bug report. I hate to ask, but is there any chance you 
can supply a patch? I just don&#39;t know enough about utf8 to be sure of the 
best way to resolve this.

Plus, displaying as utf8 characters needs to be optional. Some utf8 
characters look very similar on various fonts, so people need to be able to 
see both the utf8 character and the \x{} version.

Cheers,
Ovid
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-728281" href="/Public/Bug/Display.html?id=54214#txn-728281">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;03&nbsp;03:29:52&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-728337" href="/Public/Bug/Display.html?id=54214#txn-728337">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;03&nbsp;06:48:14&nbsp;2010</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/728337/376199/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/376199">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 720b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Feb 03 03:29:51 2010, OVID wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Shlomi,
&gt; 
&gt; Thank you for the bug report. I hate to ask, but is there any chance you 
&gt; can supply a patch? I just don&#39;t know enough about utf8 to be sure of the 
&gt; best way to resolve this.
</div>
I can try to supply a patch, but I need some guidance - where exactly
does Test-Differences encode the special characters as \x{...} ? I
couldn&#39;t find it from a cursery glance.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Plus, displaying as utf8 characters needs to be optional. Some utf8 
&gt; characters look very similar on various fonts, so people need to be
</div>able to 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; see both the utf8 character and the \x{} version.
&gt; 
</div>
Sure, I will base it on an environment variable.

Regards,

-- Shlomi Fish

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Cheers,
&gt; Ovid
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-754216" href="/Public/Bug/Display.html?id=54214#txn-754216">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;27&nbsp;06:10:27&nbsp;2010</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/754216/389968/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/389968">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 898b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi!

Any news about it? That was over a month ago.

Regards,

-- Shlomi Fish

On Wed Feb 03 06:48:14 2010, SHLOMIF wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Feb 03 03:29:51 2010, OVID wrote:
<div class="message-stanza open">&gt; &gt; Hi Shlomi,
&gt; &gt; 
&gt; &gt; Thank you for the bug report. I hate to ask, but is there any chance
</div></div>you 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; can supply a patch? I just don&#39;t know enough about utf8 to be sure
</div></div>of the 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; best way to resolve this.
</div>&gt; 
&gt; I can try to supply a patch, but I need some guidance - where exactly
&gt; does Test-Differences encode the special characters as \x{...} ? I
&gt; couldn&#39;t find it from a cursery glance.
&gt; 
<div class="message-stanza open">&gt; &gt; 
&gt; &gt; Plus, displaying as utf8 characters needs to be optional. Some utf8 
&gt; &gt; characters look very similar on various fonts, so people need to be
</div>&gt; able to 
<div class="message-stanza open">&gt; &gt; see both the utf8 character and the \x{} version.
&gt; &gt; 
</div>&gt; 
&gt; Sure, I will base it on an environment variable.
&gt; 
&gt; Regards,
&gt; 
&gt; -- Shlomi Fish
&gt; 
<div class="message-stanza open">&gt; &gt; Cheers,
&gt; &gt; Ovid
</div>&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-754233" href="/Public/Bug/Display.html?id=54214#txn-754233">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;27&nbsp;07:46:07&nbsp;2010</span>
    <span class="description">curtis_ovid_poe [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #54214] Test-Differences Always Outputs UTF-8 text as ugly \x{....} escapes</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 27 Mar 2010 04:45:51 -0700 &#40;PDT&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-Diff [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ovid &lt;curtis_ovid_poe [...] yahoo.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/754233/389977/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/389977">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 613b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- On Sat, 27/3/10, Shlomi Fish via RT &lt;bug-Text-Diff@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; From: Shlomi Fish via RT &lt;bug-Text-Diff@rt.cpan.org&gt;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Hi!
&gt; 
&gt; Any news about it? That was over a month ago.
</div>
Hi Shlomi,

Sorry about this.  I&#39;ve got my hands seriously full with another project and work, so this has been fairly low priority. I&#39;d be happy to apply patches, though.

Cheers,
Ovid
--
Buy the book         - <span class="clickylink"><a target="new" rel="nofollow" href="http://www.oreilly.com/catalog/perlhks/">http://www.oreilly.com/catalog/perlhks/</a></span>
Tech blog            - <span class="clickylink"><a target="new" rel="nofollow" href="http://blogs.perl.org/users/ovid/">http://blogs.perl.org/users/ovid/</a></span>
Twitter              - <span class="clickylink"><a target="new" rel="nofollow" href="http://twitter.com/OvidPerl">http://twitter.com/OvidPerl</a></span>
Official Perl 6 Wiki - <span class="clickylink"><a target="new" rel="nofollow" href="http://www.perlfoundation.org/perl6">http://www.perlfoundation.org/perl6</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-754243" href="/Public/Bug/Display.html?id=54214#txn-754243">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;27&nbsp;08:11:50&nbsp;2010</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/754243/389985/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/389985">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 375b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi all!

I found a workaround for this bug. If you add the following after &#34;use
Test::Differences;&#34;, then everything works fine:

&lt;&lt;&lt;
use Text::Diff::Table;

sub Text::Diff::Table::escape&#40;$&#41;
{
    return shift;
}
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&gt;&gt;
</div>
I could write something that toggles it based on an environment variable
and a Perl global variable, but this seems to work for me.

Regards,

-- Shlomi Fish
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-754264" href="/Public/Bug/Display.html?id=54214#txn-754264">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;27&nbsp;09:42:35&nbsp;2010</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/754264/390001/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/390001">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 233b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi!

Here is the patch against the svn trunk. It includes some rudimentary
tests. Please apply it.

I hereby disclaim any owernship of the changes and/or license them under
Public Domain / CC-Zero / MIT/X11.

Regards,

-- Shlomi Fish
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 54214-unicode-output.diff</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/754264/390002/54214-unicode-output.diff">Download 54214-unicode-output.diff</a><br />
<span class="downloadcontenttype">text/x-diff 4.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: t/unicode.t
===================================================================
--- t/unicode.t	&#40;revision 0&#41;
+++ t/unicode.t	&#40;revision 0&#41;
@@ -0,0 +1,58 @@
+#!/usr/bin/perl
+
+use strict;
+
+BEGIN
+{
+    $ENV{&#39;DIFF_OUTPUT_UNICODE&#39;} = 1;
+}
+
+use Test::More;
+use Text::Diff;
+
+eval &#34;use Encode;&#34;;
+
+if &#40;$@&#41;
+{
+    plan skip_all =&gt; &#34;No utf8.&#34;;
+}
+else
+{
+    plan tests =&gt; 3;
+}
+
+sub u
+{
+    return decode&#40;&#34;utf-8&#34;, shift&#41;;
+}
+
+sub ind
+{
+    my $s = u&#40;shift&#40;@_&#41;&#41;;
+    return index&#40; diff&#40; \&#40;u&#40;&#34;×©×××&#34;&#41;, u&#40;&#34;×©×××©&#34;&#41;&#41;, { STYLE =&gt; &#34;Table&#34; } &#41;, $s &#41;;
+}
+
+# TEST
+ok &#40;
+    &#40;ind&#40;&#34;×©&#34;&#41; &gt;= 0&#41;,
+    &#34;Output in unicode.&#34;
+&#41;;
+
+{
+    local $Text::Diff::Config::Output_Unicode = 0;
+    # To settle use warnings;
+    $Text::Diff::Config::Output_Unicode = 0+0;
+
+    # TEST
+    ok &#40;
+        &#40;ind &#40;&#34;\\x{05e9}&#34; &#41; &gt;= 0&#41;,
+        &#34;Output not in unicode.&#34;
+    &#41;;
+    
+    # TEST
+    ok &#40;
+        &#40;ind&#40; &#34;×©&#34; &#41; &lt; 0 &#41;,
+        &#34;Output not in unicode - no unicode char found.&#34;
+    &#41;;
+}
+
Index: lib/Text/Diff/Config.pm
===================================================================
--- lib/Text/Diff/Config.pm	&#40;revision 0&#41;
+++ lib/Text/Diff/Config.pm	&#40;revision 0&#41;
@@ -0,0 +1,70 @@
+package Text::Diff::Config;
+
+use strict;
+use warnings;
+
+use vars qw&#40;$Output_Unicode&#41;;
+
+BEGIN
+{
+    $Output_Unicode = $ENV{&#39;DIFF_OUTPUT_UNICODE&#39;};
+}
+
+1;
+
+__END__
+
+=pod
+
+=head1 NAME
+
+Text::Diff::Config - global configuration for Text::Diff &#40;as a 
+separate module&#41;.
+
+=head1 SYNOPSIS
+
+  use Text::Diff::Config;
+  
+  $Text::Diff::Config::Output_Unicode = 1;
+
+=head1 DESCRIPTION
+
+This module configures Text::Diff and its related modules. Currently it contains
+only one global variable $Text::Diff::Config::Output_Unicode  which is a boolean
+flag, that if set outputs unicode characters as themselves without escaping them 
+as C&lt; \x{HHHH} &gt; first.
+
+It is initialized to the value of C&lt; $ENV{DIFF_OUTPUT_UNICODE} &gt;, but can be
+set to a different value at run-time, including using local.
+
+=head1 AUTHOR
+
+Shlomi Fish, L&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.shlomifish.org/">http://www.shlomifish.org/</a></span>&gt; .
+
+=head1 LICENSE
+
+Copyright 2010, Shlomi Fish.
+
+This file is licensed under the MIT/X11 License:
+L&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.opensource.org/licenses/mit-license.php">http://www.opensource.org/licenses/mit-license.php</a></span>&gt;.
+
+Permission is hereby granted, free of charge, to any person obtaining a copy
+of this software and associated documentation files &#40;the &#34;Software&#34;&#41;, to deal
+in the Software without restriction, including without limitation the rights
+to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
+copies of the Software, and to permit persons to whom the Software is
+furnished to do so, subject to the following conditions:
+
+The above copyright notice and this permission notice shall be included in
+all copies or substantial portions of the Software.
+
+THE SOFTWARE IS PROVIDED &#34;AS IS&#34;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
+AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
+LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
+OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
+THE SOFTWARE.
+
+=cut
+

Property changes on: lib/Text/Diff/Config.pm
___________________________________________________________________
Added: svn:eol-style
   + native

Index: lib/Text/Diff/Table.pm
===================================================================
--- lib/Text/Diff/Table.pm	&#40;revision 11778&#41;
+++ lib/Text/Diff/Table.pm	&#40;working copy&#41;
@@ -3,6 +3,8 @@
 use 5.00503;
 use strict;
 use Carp;
+use Text::Diff::Config;
+
 use vars qw{$VERSION @ISA @EXPORT_OK};
 BEGIN {
 	$VERSION   = &#39;1.37&#39;;
@@ -59,10 +61,13 @@
       sub escape&#40;$&#41; {
 	  use utf8;
 	  join &#34;&#34;, map {
+          my $c = $_;
 	      $_ = ord;
 	      exists $escapes{$_}
 		  ? $escapes{$_}
-		  : sprintf&#40; &#34;\\x{%04x}&#34;, $_ &#41;;
+		  : $Text::Diff::Config::Output_Unicode 
+          ? $c
+          : sprintf&#40; &#34;\\x{%04x}&#34;, $_ &#41;;
 	  } split //, shift;
       }
 
@@ -378,6 +383,13 @@
 Whether or not line 3 should have that tab character escaped is a judgement
 call; so far I&#39;m choosing not to.
 
+=head1 UNICODE
+
+To output the raw unicode chracters consult the documentation of 
+L&lt;Text::Diff::Config&gt;. You can set the C&lt;DIFF_OUTPUT_UNICODE&gt; environment
+variable to 1 to output it from the command line. For more information,
+consult this bug: L&lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=54214">https://rt.cpan.org/Ticket/Display.html?id=54214</a></span>&gt; .
+
 =head1 LIMITATIONS
 
 Table formatting requires buffering the entire diff in memory in order to
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-796781" href="/Public/Bug/Display.html?id=54214#txn-796781">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;25&nbsp;09:08:57&nbsp;2010</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/796781/413112/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/413112">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 358b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Mar 27 09:42:35 2010, SHLOMIF wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi!
&gt; 
&gt; Here is the patch against the svn trunk. It includes some rudimentary
&gt; tests. Please apply it.
&gt; 
&gt; I hereby disclaim any owernship of the changes and/or license them under
&gt; Public Domain / CC-Zero / MIT/X11.
&gt; 
</div>
Hi!

Please apply the patch.

Regards,

-- Shlomi Fish

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Regards,
&gt; 
&gt; -- Shlomi Fish
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-923752" href="/Public/Bug/Display.html?id=54214#txn-923752">#</a>      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;16&nbsp;11:09:17&nbsp;2011</span>
    <span class="description">ovid [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/923752/479304/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/479304">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 191b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Shlomi,

I&#39;ve applied the patch and uploaded it. It should hit the CPAN soon and I&#39;m adding it to the 
documentation of Test::Differences.

Sorry it took so long to get to.

Cheers,
Curtis
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-923755" href="/Public/Bug/Display.html?id=54214#txn-923755">#</a>      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;16&nbsp;11:09:18&nbsp;2011</span>
    <span class="description">ovid [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.527158</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
