<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #105004 for Xbase: Xbase-1.07: FPT file handling problem</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #105004 for Xbase: Xbase-1.07: FPT file handling problem</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Xbase/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Xbase/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Xbase/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Xbase/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Xbase">Xbase CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">105004</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Xbase/Active/">Xbase</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
frank_mckenney [...] mindspring.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-36862-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-36863-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;05&nbsp;14:39:17&nbsp;2015</span>
    <span class="description">frank_mckenney [...] mindspring.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Xbase-1.07: FPT file handling problem</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 5 Jun 2015 14:38:58 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Xbase [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Frank McKenney &lt;frank_mckenney [...] mindspring.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Module: Xbase-1.07 &#40;1996&#41;
Perl:   This is perl 5, version 12, subversion 3 &#40;v5.12.3&#41; built
        for i486-linux-thread-multi
OS:     Linux amun 3.2.63-grsec #1 SMP Fri Oct 24 13:43:09 PDT 2014
        i686 AMD Athlon&#40;tm&#41; II X2 250 Processor AuthenticAMD GNU/Linux

There is a bug in the section of Xbase.pm v1.07 that handles the
FPT files used by FoxBase, etc. to store MEMO fields.

Using Xbase v1.07, if the MEMO file is set up with a BLOCKSIZE
greater than 255 &#40;the default is 64&#41;, or if non-zero data is present
in certain officially unused portions of the FPT file header,
attempts to retrieve the contents of MEMO fields will fail or
return invalid results.

This appears to be the result of a combination of &#34;guessing&#34; where
the offset and BLOCKSIZE values were being stored in the header and
assuming Intel &#40;little endian&#41; values rather the correct Motorola
&#40;big endian&#41; values.

A diff file that, if applied to a v1.07 Xbase.pm file &#40;1996&#41;, will
fix this problem is attached. &#40; Since I don&#39;t know if e-mail bug
submission allows attachments, I&#39;ve also appended the contents of
the -- short -- file below. &#41;

Hope this helps someone else.


Frank McKenney
-- 
  To be a first-rate scientist it is not necessary &#40;and certainly not
  sufficient&#41; to be extremely clever, anyhow in a pyrotechnic sense.  One
  of the great social revolutions brought about by scientific research
  has been the democratization of learning.  Anyone who combines strong
  common sense with an ordinary degree of imaginativeness can become a
  creative scientist, and a happy one besides, in so far as happiness
  depends upon being able to develop to the limit of one&#39;s abilities.
                        -- Peter Medawar, &#34;Lucky Jim&#34; 1968
-- 
Frank McKenney, McKenney Associates
Richmond, Virginia / &#40;804&#41; 320-4887
Munged E-mail: frank uscore mckenney aatt mindspring ddoott com
--------------------------------------------------------
0a1,37
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; #-------------------
&gt; #
&gt; # 2015-05-19 FAMcK 
&gt; #
&gt; # Corrected several MEMO file &#40;FPT&#41; errors discovered while working
&gt; # with the Harbour Project compiler &#40;Clipper replacement&#41;:
&gt; #
&gt; #   1&#41; FPT &#34;BLOCKSIZE&#34; is a 16-bit BIG-endian value contained in
&gt; #      bytes 6-7 of the header of the associated DBF file.
&gt; #      Old code only worked due to the default BLOCKSIZE of 64
&gt; #      fitting into one byte and the presence of trailing zeroes
&gt; #      in bytes 8-10 of most &#40;but not all&#41; FPT files.
&gt; #
&gt; #      However, this would have failed with any FPT file with a
&gt; #      BLOCKSIZE &gt; 255.
&gt; #
&gt; #   2&#41; A MEMO block pointer of &#34;         0&#34; apparently indicates
&gt; #      an empty value &#40;&#34;&#34;&#41;. It definitely -- does not -- mean seek
&gt; #      to offset 0 of the FPT file. &lt;grin&gt;
&gt; #
&gt; # Note: The code used to obtain &#39;fpt_nextf&#39;, the next-free-block
&gt; #       pointer, also uses unpack&#40;&#34;V&#34;&#41; on a BIG-endian field, but
&gt; #       this does not cause any problems because that value is
&gt; #       never used. As the Xbase-1.07 Abstract says, this code
&gt; #       is intended only for reading.
&gt; #       
&gt; #                     Frank McKenney, McKenney Associates
&gt; #
&gt; # References:
&gt; #
&gt; #   Microsoft FoxPro Memo File Structure &#40;.FPT&#41;
&gt; #   <span class="clickylink"><a target="new" rel="nofollow" href="https://msdn.microsoft.com/en-us/library/8599s21w.aspx">https://msdn.microsoft.com/en-us/library/8599s21w.aspx</a></span>
&gt; #
&gt; #   Xbase File Format Description
&gt; #   <span class="clickylink"><a target="new" rel="nofollow" href="http://www.clicketyclick.dk/databases/xbase/format/index.html">http://www.clicketyclick.dk/databases/xbase/format/index.html</a></span>
&gt; #
&gt; #-------------------
</div>149c186
&lt;               $self-&gt;{&#39;fpt_blksize&#39;}=unpack&#40;&#34;l&#34;,pack&#40;&#34;L&#34;,unpack&#40;&#34;V&#34;,substr&#40;$fpth,7,4&#41;&#41;&#41;&#41;;
---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;               $self-&gt;{&#39;fpt_blksize&#39;}=unpack&#40;&#34;l&#34;,pack&#40;&#34;L&#34;,unpack&#40;&#34;n&#34;,substr&#40;$fpth,6,2&#41;&#41;&#41;&#41;; # 7,4 -&gt; 6,2  FAMcK
</div>467a505
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;     return &#34;&#34; if $memblk  == 0; # Empty MEMO field, don&#39;t seek.  FAMcK
</div>--------------------------------------------------------
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
