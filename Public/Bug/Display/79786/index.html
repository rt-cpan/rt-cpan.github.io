<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #79786 for XML-Compile-SOAP: Some namespace declarations confuse &#34;explain&#34;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #79786 for XML-Compile-SOAP: Some namespace declarations confuse &#34;explain&#34;</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/XML-Compile-SOAP/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/XML-Compile-SOAP/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/XML-Compile-SOAP/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/XML-Compile-SOAP/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/XML-Compile-SOAP">XML-Compile-SOAP CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">79786</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/XML-Compile-SOAP/Active/">XML-Compile-SOAP</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
mcdave [...] stanford.edu

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-45614-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.29    </td>
  </tr>
  <tr id="CF-45615-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
2.30    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




simple_bad.wsdl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1122192/590392/simple_bad.wsdl">
Fri Sep 21 23:06:20 2012 (1.5k) by mcdave [...] stanford.edu
</a>
</font></li>
</ul>


simple_good.wsdl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1122192/590390/simple_good.wsdl">
Fri Sep 21 23:06:20 2012 (1.5k) by mcdave [...] stanford.edu
</a>
</font></li>
</ul>


simple_good2.wsdl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1122192/590393/simple_good2.wsdl">
Fri Sep 21 23:06:20 2012 (1.5k) by mcdave [...] stanford.edu
</a>
</font></li>
</ul>


tkt79786_clue.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1124109/591420/tkt79786_clue.patch">
Fri Sep 28 11:10:07 2012 (883b) by mcdave [...] stanford.edu
</a>
</font></li>
</ul>


wsdl_test_explain.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1122192/590391/wsdl_test_explain.pl">
Fri Sep 21 23:06:20 2012 (1.5k) by mcdave [...] stanford.edu
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;21&nbsp;23:06:20&nbsp;2012</span>
    <span class="description">mcdave [...] stanford.edu -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Some namespace declarations confuse &#34;explain&#34;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Two of the attached WSDL files work just fine, but the one named
&#34;simple_bad&#34; confuses XML::Compile::WSDL11-&gt;explain.  Running the
attached script should &#34;explain&#34; the testOp method three times, but
instead the simple_bad WSDL gives

  error: no prefix known for namespace <span class="clickylink"><a target="new" rel="nofollow" href="http://www.example.com/otherSchema">http://www.example.com/otherSchema</a></span>

The offending line seems to be

  &lt;wsdl:part name=&#34;testInReq&#34; element=&#34;ns:testDetails&#34;
xmlns:ns=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.example.com/otherSchema">http://www.example.com/otherSchema</a></span>&#34;/&gt;

That&#39;s legal, right?  The &#34;ns&#34; in the QName isn&#39;t ambiguous or anything?

If &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.example.com/otherSchema">http://www.example.com/otherSchema</a></span>&#34; is given a name somewhere else
in the file, explain works.



It&#39;s interesting to note that &#34;compile&#34; and &#34;call&#34; work fine in all
cases; it&#39;s just &#34;explain&#34; that is a problem.  So it&#39;s not like you
can&#39;t use the WSDL with the funny namespaces.  You just can&#39;t get
explain to help.


This example was inspired by something on the mailing list last month,
where the advice was to examine the output of &#34;explain&#34; but that just
caused more errors.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> simple_good.wsdl</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1122192/590390/simple_good.wsdl">Download simple_good.wsdl</a><br />
<span class="downloadcontenttype">application/octet-stream 1.5k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> wsdl_test_explain.pl</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl

use strict ;
use warnings ;

use Data::Dumper ;
use XML::Compile::WSDL11;
use XML::Compile::SOAP11;
use XML::Compile::Transport::SOAPHTTP;
# use Log::Report mode =&gt; &#39;DEBUG&#39;;  # enable debugging

foreach my $w &#40;qw/simple_bad.wsdl simple_good.wsdl simple_good2.wsdl/&#41; {
    print &#34;Examining $w\n&#34; ;
    eval {
        tryWSDL&#40;$w&#41; ;
    } ;
    warn $@ if $@ ;
    print &#39;-x&#39; x 10, &#34;\n&#34; ;
}

sub tryWSDL {
    my &#40;$wsdlfile&#41; = @_ ;
    my $wsdl = XML::Compile::WSDL11-&gt;new&#40;$wsdlfile&#41;;

    # warn &#34;Compiling&#34; ;
    my $call = $wsdl-&gt;compileClient&#40; &#39;testOp&#39;
                                         , transport_hook =&gt; \&#38;fake_server
                                     &#41;;

    # warn &#34;Executing&#34; ;
    my &#40;$answer, $trace&#41; = $call-&gt;&#40; { testInReq =&gt; {} } &#41; ;
    print &#34;Answer is &#34; . Dumper&#40;$answer&#41; ;

    # warn &#34;Explaining&#34; ;
    print $wsdl-&gt;explain&#40; &#39;testOp&#39;,
                          PERL =&gt; &#39;INPUT&#39;,
                          recurse =&gt; 1,
                      &#41;;
}

sub fake_server&#40;$$&#41;
{   my &#40;$request, $trace&#41; = @_;
    my $content = $request-&gt;decoded_content;
    $content =~ s/&gt;&lt;/&gt;\n&lt;/g;
#    print $content;

    my $answer = &lt;&lt;_ANSWER;
&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
&lt;SOAP-ENV:Envelope
   xmlns:SOAP-ENV=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://schemas.xmlsoap.org/soap/envelope/">http://schemas.xmlsoap.org/soap/envelope/</a></span>&#34;
   xmlns:x0=&#34;boo&#34;&gt;
  &lt;SOAP-ENV:Body&gt;
     &lt;x0:hasVersion&gt;3.14&lt;/x0:hasVersion&gt;
  &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;
_ANSWER

    use HTTP::Response;

    HTTP::Response-&gt;new
      &#40; HTTP::Status::RC_OK
      , &#39;answer manually created&#39;
      , [ &#39;Content-Type&#39; =&gt; &#39;text/xml&#39; ]
      , $answer
      &#41;;
}

</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> simple_bad.wsdl</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1122192/590392/simple_bad.wsdl">Download simple_bad.wsdl</a><br />
<span class="downloadcontenttype">application/octet-stream 1.5k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> simple_good2.wsdl</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1122192/590393/simple_good2.wsdl">Download simple_good2.wsdl</a><br />
<span class="downloadcontenttype">application/octet-stream 1.5k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;27&nbsp;17:10:34&nbsp;2012</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Sep 21 20:06:20 2012, mcdave@stanford.edu wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Two of the attached WSDL files work just fine, but the one named
&gt; &#34;simple_bad&#34; confuses XML::Compile::WSDL11-&gt;explain.  Running the
&gt; attached script should &#34;explain&#34; the testOp method three times, but
&gt; instead the simple_bad WSDL gives
</div>
I&#39;ve run into this as well. I can provide a WSDL/XSD offline, as they
can&#39;t be made public.

To quote mcdave, who looked at this with me on irc:

    The wsdl contains: 
    &lt;wsdl:part name=&#34;head&#34; element=&#34;xsns:Foo&#34; xmlns:xsns=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://url/v2">http://url/v2</a></span>&#34;/&gt;

    At <span class="clickylink"><a target="new" rel="nofollow" href="http://schemas.xmlsoap.org/wsdl/">http://schemas.xmlsoap.org/wsdl/</a></span>, I read that &#34;wsdl:part&#34;&#39;s
&#34;element&#34; attribute is of type &#34;xs:QName&#34;, which I understand to be a
qualified name, and &#34;xsns:Foo&#34; makes perfect sense... as long as &#34;xsns&#34;
makes sense as a namespace.  And it&#39;s being declared as &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://url/v2">http://url/v2</a></span>&#34;
right there in the element.

    Is it legal to declare a namespace within an element and use it in a
attribute directly?  I can&#39;t tell what the &#34;scope&#34; of an xmlns
declaration is supposed to be, but evidently XML::Compile does not
believe it to include the values of attributes in the same element.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;27&nbsp;17:10:35&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;27&nbsp;18:39:16&nbsp;2012</span>
    <span class="description">webmaster [...] nlnet.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #79786] Some namespace declarations confuse &#34;explain&#34;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 28 Sep 2012 00:39:03 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Karen Etheridge via RT &lt;bug-XML-Compile-SOAP [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> NLnet webmaster &lt;webmaster [...] nlnet.nl&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Karen Etheridge via RT &#40;bug-XML-Compile-SOAP@rt.cpan.org&#41; [120927 21:10]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve run into this as well. I can provide a WSDL/XSD offline, as they
&gt; can&#39;t be made public.
</div>
please.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; To quote mcdave, who looked at this with me on irc:
&gt;     The wsdl contains: 
&gt;     &lt;wsdl:part name=&#34;head&#34; element=&#34;xsns:Foo&#34; xmlns:xsns=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://url/v2">http://url/v2</a></span>&#34;/&gt;
&gt; 
&gt; At <span class="clickylink"><a target="new" rel="nofollow" href="http://schemas.xmlsoap.org/wsdl/">http://schemas.xmlsoap.org/wsdl/</a></span>, I read that &#34;wsdl:part&#34;&#39;s
&gt; &#34;element&#34; attribute is of type &#34;xs:QName&#34;, which I understand to be a
&gt; qualified name, and &#34;xsns:Foo&#34; makes perfect sense... as long as &#34;xsns&#34;
&gt; makes sense as a namespace.  And it&#39;s being declared as &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://url/v2">http://url/v2</a></span>&#34;
&gt; right there in the element.
</div>
If I look at the code, in XML/Compile/Schema/BuiltInTypes.pm, I see
  $builtin_types{QName} =
  { parse   =&gt;
     sub { my &#40;$qname, $node&#41; = @_;
           $qname =~ s/\s//g;
           my $prefix = $qname =~ s/^&#40;[^:]*&#41;\:// ? $1 : &#39;&#39;;

           $node  = $node-&gt;node if $node-&gt;isa&#40;&#39;XML::Compile::Iterator&#39;&#41;;
 ---&gt;      my $ns = $node-&gt;lookupNamespaceURI&#40;$prefix&#41; || &#39;&#39;;
           pack_type $ns, $qname;

This should resolve the namespace.  No idea &#40;yet&#41; why that doesn&#39;t work.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Is it legal to declare a namespace within an element and use it in a
&gt; attribute directly?  I can&#39;t tell what the &#34;scope&#34; of an xmlns
&gt; declaration is supposed to be, but evidently XML::Compile does not
&gt; believe it to include the values of attributes in the same element.
</div>
Yes, legal.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;27&nbsp;18:55:55&nbsp;2012</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #79786] Some namespace declarations confuse &#34;explain&#34;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 28 Sep 2012 00:55:41 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Karen Etheridge via RT &lt;bug-XML-Compile-SOAP [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* NLnet Webmaster &#40;webmaster@nlnet.nl&#41; [120928 00:39]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If I look at the code, in XML/Compile/Schema/BuiltInTypes.pm, I see
&gt;   $builtin_types{QName} =
&gt;   { parse   =&gt;
&gt;      sub { my &#40;$qname, $node&#41; = @_;
&gt;            $qname =~ s/\s//g;
&gt;            my $prefix = $qname =~ s/^&#40;[^:]*&#41;\:// ? $1 : &#39;&#39;;
&gt; 
&gt;            $node  = $node-&gt;node if $node-&gt;isa&#40;&#39;XML::Compile::Iterator&#39;&#41;;
&gt;  ---&gt;      my $ns = $node-&gt;lookupNamespaceURI&#40;$prefix&#41; || &#39;&#39;;
&gt;            pack_type $ns, $qname;
</div>
This works correctly... So I am wondering why it does not work in
XML::Compile...

   use XML::LibXML;

   my $dom = XML::LibXML-&gt;load_xml&#40;string =&gt; &lt;&lt;__XML&#41;;
   &lt;wsdl:part xmlns:wsdl=&#34;/tmp/xx&#34; name=&#34;head&#34; element=&#34;xsns:Foo&#34;
      xmlns:xsns=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://url/v2">http://url/v2</a></span>&#34;/&gt;
   __XML

   my $root = $dom-&gt;documentElement;
   print $root-&gt;lookupNamespaceURI&#40;&#39;xsns&#39;&#41; || &#39;&#39;, &#34;\n&#34;;

   my $el = $root-&gt;getAttributeNode&#40;&#39;element&#39;&#41;;
   print $el-&gt;lookupNamespaceURI&#40;&#39;xsns&#39;&#41; || &#39;&#39;, &#34;\n&#34;;

-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;28&nbsp;11:10:07&nbsp;2012</span>
    <span class="description">mcdave [...] stanford.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mcdave [...] stanford.edu</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Sep 27 18:55:55 2012, Mark@Overmeer.net wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; * NLnet Webmaster &#40;webmaster@nlnet.nl&#41; [120928 00:39]:
<div class="message-stanza open">&gt; &gt; If I look at the code, in XML/Compile/Schema/BuiltInTypes.pm, I see
&gt; &gt;   $builtin_types{QName} =
&gt; &gt;   { parse   =&gt;
&gt; &gt;      sub { my &#40;$qname, $node&#41; = @_;
&gt; &gt;            $qname =~ s/\s//g;
&gt; &gt;            my $prefix = $qname =~ s/^&#40;[^:]*&#41;\:// ? $1 : &#39;&#39;;
&gt; &gt; 
&gt; &gt;            $node  = $node-&gt;node if $node-&gt;isa&#40;&#39;XML::Compile::Iterator&#39;&#41;;
&gt; &gt;  ---&gt;      my $ns = $node-&gt;lookupNamespaceURI&#40;$prefix&#41; || &#39;&#39;;
&gt; &gt;            pack_type $ns, $qname;
</div>&gt; 
&gt; This works correctly... So I am wondering why it does not work in
&gt; XML::Compile...
&gt; 
</div>
I think the problem is just that XML::Compile::Cache lost track of the
prefix momentarily during &#34;explain&#34;, and &#34;$schema-&gt;prefixed&#40;$value&#41;&#34;
returned an error instead of undef, so

  $schema-&gt;prefixed&#40;$value&#41; || $value

didn&#39;t behave as expected.  With the attached little change to
XML::Compile::SOAP11::Operation, explain stopped crashing on my test
case.  It&#39;s not a solution, just an experiment.

The output for the &#34;simple_bad.wsdl&#34; case turned into the text
below.  What was interesting to me is that, once it got past the initial
hurdle of not crashing when describing the body, the recursive part down
in XML::Compile::Translate::Template &#34;toPerl&#34; knew enough to make up the
prefix &#34;x0&#34; for the missing namespace.


Then I got lost and couldn&#39;t figure out a coherent explanation for why
it worked in one case but not another.



dave

--

...
# The details of the types and elements are attached below.

# Body part &#39;testInReq&#39; is element
{<span class="clickylink"><a target="new" rel="nofollow" href="http://www.example.com/otherSchema">http://www.example.com/otherSchema</a></span>}testDetails
my $testInReq = {};
...
#--------------------------------------------------------------
$testInReq =
# Describing simple x0:testDetails
#     {<span class="clickylink"><a target="new" rel="nofollow" href="http://www.example.com/otherSchema">http://www.example.com/otherSchema</a></span>}testDetails
# xmlns:x0        <span class="clickylink"><a target="new" rel="nofollow" href="http://www.example.com/otherSchema">http://www.example.com/otherSchema</a></span>

# is a xs:anyType
&#34;anything&#34;

;




<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;    use XML::LibXML;
&gt; 
&gt;    my $dom = XML::LibXML-&gt;load_xml&#40;string =&gt; &lt;&lt;__XML&#41;;
&gt;    &lt;wsdl:part xmlns:wsdl=&#34;/tmp/xx&#34; name=&#34;head&#34; element=&#34;xsns:Foo&#34;
&gt;       xmlns:xsns=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://url/v2">http://url/v2</a></span>&#34;/&gt;
&gt;    __XML
&gt; 
&gt;    my $root = $dom-&gt;documentElement;
&gt;    print $root-&gt;lookupNamespaceURI&#40;&#39;xsns&#39;&#41; || &#39;&#39;, &#34;\n&#34;;
&gt; 
&gt;    my $el = $root-&gt;getAttributeNode&#40;&#39;element&#39;&#41;;
&gt;    print $el-&gt;lookupNamespaceURI&#40;&#39;xsns&#39;&#41; || &#39;&#39;, &#34;\n&#34;;
&gt; 
</div></div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> tkt79786_clue.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/lib/XML/Compile/SOAP11/Operation.pm b/lib/XML/Compile/SOAP11/Operation.pm
index f236142..05196d7 100644
--- a/lib/XML/Compile/SOAP11/Operation.pm
+++ b/lib/XML/Compile/SOAP11/Operation.pm
@@ -322,15 +322,16 @@ sub explain&#40;$$$@&#41;
 
   BODY_PART:
     foreach my $part &#40; @{$def-&gt;{body}{parts} || []} &#41;
     {   my $name = $part-&gt;{name};
         my &#40;$kind, $value&#41; = $part-&gt;{type} ? &#40;type =&gt; $part-&gt;{type}&#41;
           : &#40;element =&gt; $part-&gt;{element}&#41;;
 
-        my $type = $schema-&gt;prefixed&#40;$value&#41; || $value;
+        my $type = $schema-&gt;prefixFor&#40;$value&#41; ?
+	  $schema-&gt;prefixed&#40;$value&#41; : $value ;
         push @main, &#39;&#39;
           , &#34;# Body part &#39;$name&#39; is $kind $type&#34;
           , &#40;$kind eq &#39;type&#39; &#38;&#38; $recurse ? &#34;# See fake element &#39;$name&#39;&#34; : &#40;&#41;&#41;
           , &#34;my \$$name = {};&#34;;
         push @struct, &#34;    $name =&gt; \$$name,&#34;;
 
         $recurse or next BODY_PART;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;28&nbsp;19:52:35&nbsp;2012</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #79786] Some namespace declarations confuse &#34;explain&#34;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 29 Sep 2012 01:52:22 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> David Tindall Mcmath via RT &lt;bug-XML-Compile-SOAP [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* David Tindall Mcmath via RT &#40;bug-XML-Compile-SOAP@rt.cpan.org&#41; [120928 15:10]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think the problem is just that XML::Compile::Cache lost track of the
&gt; prefix momentarily during &#34;explain&#34;, and &#34;$schema-&gt;prefixed&#40;$value&#41;&#34;
&gt; returned an error instead of undef, so
&gt; 
&gt;   $schema-&gt;prefixed&#40;$value&#41; || $value
</div>
Ah, it tries to do a reverse translation there...
You fix is sound, thanks!
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;03&nbsp;14:04:38&nbsp;2012</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve just tested mcdave&#39;s patch and confirmed it fixes my namespacing
issue as well &#40;as transmitted to Mark in private email&#41;. Thank you very
much!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;12&nbsp;14:57:44&nbsp;2012</span>
    <span class="description">ether [...] cpan.org -  Fixed in 2.30 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;16&nbsp;13:57:39&nbsp;2012</span>
    <span class="description">MARKOV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">fixed in 2.30
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;16&nbsp;13:57:39&nbsp;2012</span>
    <span class="description">MARKOV [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
