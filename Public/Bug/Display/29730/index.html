<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #29730 for SVN-Notify: &#40;feature request&#41; --svnlook-diff option</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #29730 for SVN-Notify: &#40;feature request&#41; --svnlook-diff option</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/SVN-Notify/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/SVN-Notify/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/SVN-Notify/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/SVN-Notify/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="http://github.com/theory/svn-notify/issues/">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/SVN-Notify">SVN-Notify CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">29730</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">stalled</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/SVN-Notify/Active/">SVN-Notify</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
kaneyuki [...] eva.hi-ho.ne.jp

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-30306-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-30307-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;03&nbsp;03:19:25&nbsp;2007</span>
    <span class="description">kaneyuki [...] eva.hi-ho.ne.jp -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 03 Oct 2007 16:13:52 +0900</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kin &lt;kaneyuki [...] eva.hi-ho.ne.jp&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,
Our development team are big fans of SVN::Notify.

It is much helpful if we can specify &#34;svnlook diff&#34; filter program by
command line option, like this:

--svnlook-diff /usr/local/bin/svnlook_diff_sjis

In above example, we use following filter script as svnlook_diff_sjis:
#!/bin/sh
PATH=/bin:/usr/bin
env LANG=C svnlook &#34;$@&#34; | iconv -f SHIFT-JIS -t UTF-8

Can you take this feature in?

Here is the patch against v2.66, w/o documentation part:

--- Notify.pm.org       2007-09-05 09:35:16.000000000 +0900
+++ Notify.pm   2007-09-05 10:29:50.000000000 +0900
@@ -647,16 +647,17 @@
     $params{svnlook}        ||= $ENV{SVNLOOK}  || $class-&gt;find_exe&#40;&#39;svnlook&#39;&#41;;
     $params{with_diff}      ||= $params{attach_diff};
     $params{verbose}        ||= 0;
     $params{charset}        ||= &#39;UTF-8&#39;;
     $params{io_layer}       ||= &#34;encoding&#40;$params{charset}&#41;&#34;;
     $params{smtp_authtype}  ||= &#39;PLAIN&#39;;
     $params{sendmail}       ||= $ENV{SENDMAIL} || $class-&gt;find_exe&#40;&#39;sendmail&#39;&#41;
         unless $params{smtp};
+    $params{svnlook_diff}   ||= $params{svnlook};
 
     die qq{Cannot find sendmail and no &#34;smtp&#34; parameter specified}
         unless $params{sendmail} || $params{smtp};
 
     # Set up the revision URL.
     $params{revision_url} ||= delete $params{svnweb_url}
                           ||  delete $params{viewcvs_url};
     if &#40;$params{revision_url} &#38;&#38; $params{revision_url} !~ /%s/&#41; {
@@ -767,16 +768,17 @@
         &#39;repos-path|p=s&#39;      =&gt; \$opts-&gt;{repos_path},
         &#39;revision|r=s&#39;        =&gt; \$opts-&gt;{revision},
         &#39;to|t=s@&#39;             =&gt; \$opts-&gt;{to},
         &#39;to-regex-map|x=s%&#39;   =&gt; \$opts-&gt;{to_regex_map},
         &#39;to-email-map=s%&#39;     =&gt; \$opts-&gt;{to_email_map},
         &#39;from|f=s&#39;            =&gt; \$opts-&gt;{from},
         &#39;user-domain|D=s&#39;     =&gt; \$opts-&gt;{user_domain},
         &#39;svnlook|l=s&#39;         =&gt; \$opts-&gt;{svnlook},
+        &#39;svnlook-diff=s&#39;      =&gt; \$opts-&gt;{svnlook_diff},
         &#39;sendmail|s=s&#39;        =&gt; \$opts-&gt;{sendmail},
         &#39;set-sender|E&#39;        =&gt; \$opts-&gt;{set_sender},
         &#39;smtp=s&#39;              =&gt; \$opts-&gt;{smtp},
         &#39;charset|c=s&#39;         =&gt; \$opts-&gt;{charset},
         &#39;io-layer|o=s&#39;        =&gt; \$opts-&gt;{io_layer},
         &#39;language|g=s&#39;        =&gt; \$opts-&gt;{language},
         &#39;with-diff|d&#39;         =&gt; \$opts-&gt;{with_diff},
         &#39;attach-diff|a&#39;       =&gt; \$opts-&gt;{attach_diff},
@@ -1549,17 +1551,17 @@
 will usually be passed as the second argument to C&lt;output_diff&#40;&#41;&gt; or
 C&lt;output_attached_diff&#40;&#41;&gt;.
 
 =cut
 
 sub diff_handle {
     my $self = shift;
     return $self-&gt;_pipe&#40;
-        &#39;-|&#39;   =&gt; $self-&gt;{svnlook},
+        &#39;-|&#39;   =&gt; $self-&gt;{svnlook_diff},
         &#39;diff&#39; =&gt; $self-&gt;{repos_path},
         &#39;-r&#39;   =&gt; $self-&gt;{revision},
         &#40; $self-&gt;{diff_switches}
             ? grep { defined &#38;&#38; $_ ne &#39;&#39; }
                 # Allow quoting of arguments, but strip out the quotes.
                 split /&#40;?:&#39;&#40;[^&#39;]+&#41;&#39;|&#34;&#40;[^&#34;]+&#41;&#34;&#41;?\s+&#40;?:&#39;&#40;[^&#39;]+&#41;&#39;|&#34;&#40;[^&#34;]+&#41;&#34;&#41;?/,
                 $self-&gt;{diff_switches}
             : &#40;&#41;
@@ -1607,16 +1609,17 @@
 __PACKAGE__-&gt;_accessors&#40;qw&#40;
     repos_path
     revision
     to_regex_map
     to_email_map
     from
     user_domain
     svnlook
+    svnlook_diff
     sendmail
     set_sender
     add_headers
     smtp
     charset
     io_layer
     language
     with_diff


Thanks in advance.

================
Toshikazu Kinkoh
kaneyuki@eva.hi-ho.ne.jp
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;05&nbsp;00:49:46&nbsp;2007</span>
    <span class="description">david [...] kineticode.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 4 Oct 2007 21:48:38 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;david [...] kineticode.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Oct 3, 2007, at 00:19, kin via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Our development team are big fans of SVN::Notify.
</div>
Thanks. :-&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It is much helpful if we can specify &#34;svnlook diff&#34; filter program by
&gt; command line option, like this:
&gt;
&gt; --svnlook-diff /usr/local/bin/svnlook_diff_sjis
&gt;
&gt; In above example, we use following filter script as svnlook_diff_sjis:
&gt; #!/bin/sh
&gt; PATH=/bin:/usr/bin
&gt; env LANG=C svnlook &#34;$@&#34; | iconv -f SHIFT-JIS -t UTF-8
&gt;
&gt; Can you take this feature in?
</div>
Hrm. Could you not just use the --charset and --io-layer options?

   svnnotify --charset SHIFT-JIS --io-layer raw

Does that not properly collect the log message and diff output in  
SHIFT-JIS for you?

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;05&nbsp;00:50:05&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;08&nbsp;00:06:09&nbsp;2007</span>
    <span class="description">kaneyuki [...] eva.hi-ho.ne.jp -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 08 Oct 2007 12:59:15 +0900</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kin &lt;kaneyuki [...] eva.hi-ho.ne.jp&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi David,
Thank you for the reply.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hrm. Could you not just use the --charset and --io-layer options?
&gt; 
&gt;    svnnotify --charset SHIFT-JIS --io-layer raw
&gt; 
&gt; Does that not properly collect the log message and diff output in  
&gt; SHIFT-JIS for you?
</div>
No, it slays log message.

Our repository runs UTF-8 base, so the log messages must be stored in 
UTF-8.  And most files stored in the repository are encoded in SHIFT-JIS,
so raw diff output is SHIFT-JIS.

My understanding for getting uncorrupted strings both for log message and 
diff output &#40;in one e-mail&#41; is to convert both outputs in different way.  
And it is the need for --snvlook-diff option.

FYI, we are using following options with hacked --svnlook-diff option:
 --with-diff \
 --language ja \
 --charset UTF-8 \
 --io-layer raw \
 --svnlook /usr/local/bin/svnlook2utf8 \

Please point out if we are doing something wrong.

Best regards,
Toshikazu
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;08&nbsp;14:17:46&nbsp;2007</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 8 Oct 2007 11:17:11 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Oct 7, 2007, at 21:06, kin via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; No, it slays log message.
&gt;
&gt; Our repository runs UTF-8 base, so the log messages must be stored in
&gt; UTF-8.  And most files stored in the repository are encoded in  
&gt; SHIFT-JIS,
&gt; so raw diff output is SHIFT-JIS.
&gt;
&gt; My understanding for getting uncorrupted strings both for log  
&gt; message and
&gt; diff output &#40;in one e-mail&#41; is to convert both outputs in different  
&gt; way.
&gt; And it is the need for --snvlook-diff option.
</div>
Ah, I understand. Well, what if we added a --diff-charset option? -- 
charset would apply to both the log message and the diff, unless -- 
diff-charset was specified, in which case it would use its own  
character set. That way you can specify two different character sets,  
one for the log message and one for the diff.

Does that make sense?

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;10&nbsp;02:34:23&nbsp;2007</span>
    <span class="description">kaneyuki [...] eva.hi-ho.ne.jp -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 10 Oct 2007 15:28:43 +0900</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Toshikazu Kinkoh &lt;kaneyuki [...] eva.hi-ho.ne.jp&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi David,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Ah, I understand. Well, what if we added a --diff-charset option? -- 
&gt; charset would apply to both the log message and the diff, unless -- 
&gt; diff-charset was specified, in which case it would use its own  
&gt; character set. That way you can specify two different character sets,  
&gt; one for the log message and one for the diff.
&gt; 
&gt; Does that make sense?
</div>
Oh, it sounds better solution.

I think --diff-charset option would work diff outputs to be converted from 
specified charset to the charset specified by --charset option, because 
--charset determines the final charset for email.  Is that right ?

Best regards,
Toshikazu
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;10&nbsp;13:49:53&nbsp;2007</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 10 Oct 2007 10:48:27 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Oct 9, 2007, at 23:34, kin via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Oh, it sounds better solution.
&gt;
&gt; I think --diff-charset option would work diff outputs to be  
&gt; converted from
&gt; specified charset to the charset specified by --charset option,  
&gt; because
&gt; --charset determines the final charset for email.  Is that right ?
</div>
Yes. Care to submit a patch? It&#39;ll probably be a couple of months  
before I can work on this &#40;and a million other planned improvements  
for SVN::Notify&#41;…

Thanks,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;11&nbsp;08:25:10&nbsp;2007</span>
    <span class="description">kaneyuki [...] eva.hi-ho.ne.jp -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 11 Oct 2007 21:19:17 +0900</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Toshikazu Kinkoh &lt;kaneyuki [...] eva.hi-ho.ne.jp&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi David,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Yes. Care to submit a patch? It&#39;ll probably be a couple of months  
&gt; before I can work on this &#40;and a million other planned improvements  
&gt; for SVN::Notify&#41;…
</div>
Well, ok.  I&#39;ll try it, but I&#39;m not very well aware of perl.  
So please wait patiently.

And where should I send a patch to ?  This email address ?

Best regards,
Toshikazu
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;11&nbsp;14:57:01&nbsp;2007</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 11 Oct 2007 11:54:50 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Oct 11, 2007, at 05:25, kin via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; Yes. Care to submit a patch? It&#39;ll probably be a couple of months
&gt;&gt; before I can work on this &#40;and a million other planned improvements
&gt;&gt; for SVN::Notify&#41;…
</div>&gt;
&gt; Well, ok.  I&#39;ll try it, but I&#39;m not very well aware of perl.
&gt; So please wait patiently.
</div>
No problem. It should be quite similar to how --charset is handled now.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; And where should I send a patch to ?  This email address ?
</div>
Yep, that would be fine. Thanks!

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;20&nbsp;09:59:58&nbsp;2007</span>
    <span class="description">kaneyuki [...] eva.hi-ho.ne.jp -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 20 Nov 2007 23:53:27 +0900</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Toshikazu Kinkoh &lt;kaneyuki [...] eva.hi-ho.ne.jp&gt;</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;06&nbsp;14:16:33&nbsp;2008</span>
    <span class="description">dwheeler [...] cpan.org -  Severity Wishlist added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;06&nbsp;15:13:38&nbsp;2008</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Nov 20 09:59:58 2007, kaneyuki@eva.hi-ho.ne.jp wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi David,
</div>
Hi Toshikazu. Apologies for the delayed reply. Apparently RT thought
that your message was &#34;too big&#34;, and so didn&#39;t forward it to me. I&#39;m
working on SVN::Notify now, and so finally saw your patch as I was going
through the RT queue.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have finished implementation for --diff-charset option.
</div>
Many thanks for your hard work on this. It looks great! Tell me, are you
using this patch in production? And if so, are the encodings now all as
they should be?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Basic ideas for the change are:
&gt; 1. To encode input pipe for svnlook properly.
&gt; 2. To keep svnlook outputs as PerlIO internal expression until just
&gt;    before printing them to mail pipe.
&gt; 3. To decode them to output encoding &#40;specified by --charset option&#41;
&gt;    by ourselves just before printing them to mail pipe.
&gt; 4. Mail pipe simply receives octet stream.
&gt; 
&gt; For this change, I have to add two more options.
&gt; Here is the brief descriptions for added options, and the changes of
&gt; meaning for
&gt; some existing options.
&gt; 
&gt; --env-lang [New]
&gt;   Specify LANG environmental variable, on which svnlook runs.
&gt;   Defaults to undef, usually only people dealing multi byte character
&gt;   should specify.
</div>
Very good idea. I&#39;ve tried to set this to &#39;C&#39; in the past to solve
encoding problems, but making it an option is a much better idea. I
think it should default to the value of --charset though, no?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; --server-charset [New]
&gt;  Character set to be set to svnlook input pipe.  This should be
&gt;  consistent with the setting of --env-lang option.  For example:
&gt;       --env-lang &#34;ja_JP.eucJP&#34; --server-charset &#34;euc-jp&#34;
&gt;   Defaults to &#39;ascii&#39;.
</div>
Hrm. Should it not then default to the proper equivalent of --env-lang?
I&#39;m trying to limit how many options the user actually has to specify.
And since more and more folks are using UTF-8 for nearly everything
&#40;outside of a few well-known geolocations, yours included&#41;, if --charset
was set to utf-8, then --env-lang should default to, perhaps,
&#39;en_US.UTF8&#39;, and then --server-charset would default to &#39;utf-8&#39;. Or
does it make sense to leave some of these blank? At any rate, I&#39;d prefer
a default of utf-8 to ascii.
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; --diff-charset [New]
&gt;   Character set used by svnlook diff.  This is the character set
&gt;   mainly used as actual file contents in the repository.  For example:
&gt;       --diff-charset &#34;shiftjis&#34;
&gt;   Defaults to the same value as --server-charsest.
</div>
Great, perfect.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; --charset [meaning change]
&gt;   Basically this specifies simply the output character set, resulting
&gt;   in mail and HTML character set.  This is independent how svnlook runs
&gt;   on server.
&gt;   For example:
&gt;       --charset &#34;UTF-8&#34; &#40;default&#41;
&gt;       --charset &#34;iso-8859-1&#34;
&gt;       --charset &#34;iso-2022-jp&#34;
</div>
Well, maybe then we need --output-charset, but if a user specifies
--charset and nothing else, we try to set all of the other
encoding-related options to their appropriate values. Thoughts?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; --io-layer [meaning and default value change]
&gt;   Modified defaults to undef.  And this option is basically obsolete.
</div>
So this is deprecated, then.
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The people using single byte character set need not change current
&gt; options of svnnotify.
</div>
That&#39;s fewer and fewer folks every day. :-&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Below details the modification &#40;and you can skip reading it ...&#41;:
&gt; -----------------------------------------------------------------
&gt; First of all, hook scripts of svn are executed under empty
&gt; environmental variables.
</div>
Right. Or, well, maybe. It depends on how the system is set up, IIRC.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This is perhaps equivalent to LANG=C, so when svnlook outputs
&gt; multibyte characters under that situation, the output is broken
&gt; for the first moment.
</div>
Good point. I wonder why it has been working so well up till now
&#40;impefectly, but not badly&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; For this reason, --env-lang option was added.  This option defaults
&gt; undef and if it is not specified, svnnotify should behave
&gt; identically as current version.
</div>
Right, good.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; When the --env-lang option is specified appropriately and the encoding
&gt; for input pipe of svnlook is consistently specified, then commit
&gt; messages will not be broken.   This encoding is specified by
&gt; --server-charset option.
</div>
Like I said, I&#39;d like to set this to a reasonable default relative to
the value of --env-lang. Something like this &#40;pseudo-code&#41;:

  if &#40; $opts-&gt;{env_lang} &#38;&#38; !$opts-&gt;{server_charset} &#41; {
    $opts-&gt;{server_charset} = $opts-&gt;{env_lang} =~ /[.]UTF-?8/
      ? &#39;UTF-8&#39;
      : split&#40; &#39;.&#39;, $opts-&gt;{env_lang}&#41;[-1] =~ s/_/-/g;
  }

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; svnlook diff outputs diff as binary data, and they are received with
&gt; the encoding specified by --diff-charset.
</div>
Good.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Item #3 in above listing stands on that specifying encoding to tied_fh
&gt; of SMTP by binmode has no effect.  This is the case of &#34;When Unicode
&gt; Does Not Happen&#34; in perlunicode doc.
</div>
Ah, I didn&#39;t know that. No wonder it never worked!

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; For this reason, --io-layer has been modified to default to undef, and
&gt; normally it is recommended not to be specified.
</div>
Yes, we should deprecate it.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Also for the change of #3, HTML.pm and ColorDiff.pm are modified.
</div>
Right, makes sense.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -----------------------------------------------------------------
&gt; 
&gt; 
&gt; And finally the patch against 2.66:
</div>
Thanks, this looks good. You obviously worked on it a lot! I&#39;m going to
spend a bit of time distilling it a little, and then I&#39;ll send a patch
back to you via RT to test. Would you mind doing that?

Thanks!

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;06&nbsp;20:13:28&nbsp;2008</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Feb 06 15:13:38 2008, DWHEELER wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks, this looks good. You obviously worked on it a lot! I&#39;m going to
&gt; spend a bit of time distilling it a little, and then I&#39;ll send a patch
&gt; back to you via RT to test. Would you mind doing that?
</div>
Hi Toshikazu,

I&#39;ve now integrated your patch. I changed quite a bit from how you had
it, but I *think* it&#39;s correct:

 * I used the `language` attribute to set `env_lang` rather than add
another option. It was already being used for this purpose, as it
happens. Let me know if it works properly, or if I need to strip out
dashes from character sets to make it work properly.

 * I named the option --svn-charset instead of --server-charset. It
defaults to the same value as --charset.

 * -diff-charset deffaults to the same value as --svn-charset.

 * I eliminated --io-layer altogether. Did I understand you right that
it is essentially a no-op?

 * Rather than have separate _pipe and _read_pipe methods, I just
integrated the encodings into the existing methods. This eliminates a
lot of duplication.

 * I changed a couple of other method names: _encode instead of _octets
and print_lines instead of print_octets.

 * I added documentation and got all tests passing. :-&#41;

Would you mind giving this patch a try and letting me know how it works
for you? If it&#39;s easier &#40;it should apply cleanly to 2.67&#41;, you can pull
it directly from Subversion:

  <span class="clickylink"><a target="new" rel="nofollow" href="https://svn.kineticode.com/SVN-Notify/trunk/">https://svn.kineticode.com/SVN-Notify/trunk/</a></span>

Please let me know if this works for you. I&#39;d like to release it soon,
but I&#39;d really like to hear from you that it works in the wild before I do.

Thanks!

David
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;10&nbsp;03:03:59&nbsp;2008</span>
    <span class="description">kaneyuki [...] eva.hi-ho.ne.jp -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 10 Feb 2008 16:56:18 +0900</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Toshikazu Kinkoh &lt;kaneyuki [...] eva.hi-ho.ne.jp&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi David,

I&#39;m happy to hear you basically accept my patch!

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Toshikazu. Apologies for the delayed reply. Apparently RT thought
&gt; that your message was &#34;too big&#34;, and so didn&#39;t forward it to me. I&#39;m
&gt; working on SVN::Notify now, and so finally saw your patch as I was going
&gt; through the RT queue.
</div>
Aaahhh, I&#39;m sorry.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Many thanks for your hard work on this. It looks great! Tell me, are you
&gt; using this patch in production? And if so, are the encodings now all as
&gt; they should be?
</div>
I&#39;m using the patched version in production for about 3 months, and working
fine.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hrm. Should it not then default to the proper equivalent of --env-lang?
&gt; I&#39;m trying to limit how many options the user actually has to specify.
&gt; And since more and more folks are using UTF-8 for nearly everything
&gt; &#40;outside of a few well-known geolocations, yours included&#41;, if --charset
&gt; was set to utf-8, then --env-lang should default to, perhaps,
&gt; &#39;en_US.UTF8&#39;, and then --server-charset would default to &#39;utf-8&#39;. Or
&gt; does it make sense to leave some of these blank? At any rate, I&#39;d prefer
&gt; a default of utf-8 to ascii.
</div>
I&#39;d forgotten that language and charset form $LANG at that time, and I agree
with you.

On Wed, 06 Feb 2008 20:13:40 -0500
David Wheeler via RT &lt;bug-SVN-Notify@rt.cpan.org&gt;-san wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve now integrated your patch. I changed quite a bit from how you had
&gt; it, but I *think* it&#39;s correct:
</div>
Ok.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  * I used the `language` attribute to set `env_lang` rather than add
&gt; another option. It was already being used for this purpose, as it
&gt; happens. Let me know if it works properly, or if I need to strip out
&gt; dashes from character sets to make it work properly.
</div>
I will answer after investigation and test run.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  * I eliminated --io-layer altogether. Did I understand you right that
&gt; it is essentially a no-op?
</div>
Yes.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  * I added documentation and got all tests passing. :-&#41;
</div>
Good! Thank you.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Would you mind giving this patch a try and letting me know how it works
&gt; for you? If it&#39;s easier &#40;it should apply cleanly to 2.67&#41;, you can pull
&gt; it directly from Subversion:
&gt; 
&gt;   <span class="clickylink"><a target="new" rel="nofollow" href="https://svn.kineticode.com/SVN-Notify/trunk/">https://svn.kineticode.com/SVN-Notify/trunk/</a></span>
&gt; 
&gt; Please let me know if this works for you. I&#39;d like to release it soon,
&gt; but I&#39;d really like to hear from you that it works in the wild before I do.
</div>
Ok, I will test this week and let you know the result.

Best regards.

Toshikazu
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;10&nbsp;13:10:35&nbsp;2008</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 10 Feb 2008 10:10:05 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Feb 10, 2008, at 00:04, kin via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; Hi Toshikazu. Apologies for the delayed reply. Apparently RT thought
&gt;&gt; that your message was &#34;too big&#34;, and so didn&#39;t forward it to me. I&#39;m
&gt;&gt; working on SVN::Notify now, and so finally saw your patch as I was  
&gt;&gt; going
&gt;&gt; through the RT queue.
</div>&gt;
&gt; Aaahhh, I&#39;m sorry.
</div>
No worries. I would not have had time to work on it before now, anyway.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;d forgotten that language and charset form $LANG at that time, and  
&gt; I agree
&gt; with you.
</div>
Great.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; Please let me know if this works for you. I&#39;d like to release it  
&gt;&gt; soon,
&gt;&gt; but I&#39;d really like to hear from you that it works in the wild  
&gt;&gt; before I do.
</div>&gt;
&gt; Ok, I will test this week and let you know the result.
</div>
Brilliant, many thanks.

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;19&nbsp;09:25:46&nbsp;2008</span>
    <span class="description">kaneyuki [...] eva.hi-ho.ne.jp -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 19 Feb 2008 23:15:56 +0900</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Toshikazu Kinkoh &lt;kaneyuki [...] eva.hi-ho.ne.jp&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi David,

I&#39;ve been testing the patched version that you sent and it works fine 
with small modifications.
I attach the patch.  It will be applied on patched v2.67 that your patch
has been applied.

Here is brief explanations about my modification:

*HTML.pm
Some print calls were replaced by print_lines.

*Notify.pm
I think the last half of $LANG should be created from svn_charset 
&#40;1st hunk&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; * I used the `language` attribute to set `env_lang` rather than add
&gt; &gt; another option. It was already being used for this purpose, as it
&gt; &gt; happens. Let me know if it works properly, or if I need to strip out
&gt; &gt; dashes from character sets to make it work properly.
</div>&gt; 
&gt; I will answer after investigation and test run.
</div>
I think &#39;-&#39; in language-and-country of $LANG should be replaced by &#39;_&#39;, and
&#39;-&#39; in encoding part should be stripped out unless it is &#39;UTF-8&#39; &#40;1st hunk&#41;.

Some print calls were replaced by print_lines &#40;2nd hunk&#41;.  It was recognized 
that they should be so just after I sent the first patch, and has been 
tested in a couple of months. 

Print call in _dbpnt was replaced print_lines &#40;3rd hunk&#41;.  This is very helpful
when we debug with various charsets.  Otherwise we will get many complains
saying &#34;Wide character in print at ....&#34;, so please integrate this modification
if you not mind.

Many thanks!

Toshikazu
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;19&nbsp;14:25:18&nbsp;2008</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 19 Feb 2008 11:24:21 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Feb 19, 2008, at 06:25, kin via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve been testing the patched version that you sent and it works fine
&gt; with small modifications.
&gt; I attach the patch.  It will be applied on patched v2.67 that your  
&gt; patch
&gt; has been applied
</div>
Many thanks, Toshikazu. I&#39;ve applied it in r3439, along with some  
fixes for the subject line encoding. Can you check it out and give it  
a try?

   svn co <span class="clickylink"><a target="new" rel="nofollow" href="https://svn.kineticode.com/SVN-Notify/trunk/">https://svn.kineticode.com/SVN-Notify/trunk/</a></span>

The only change I made was to use the `charset` parameter to create  
`env_lang`, rather than `svn_charset`. I think that this is more  
likely to be the expected value, and if it&#39;s not, users can always  
explicitly set the `$LANG` environment variable before executing  
`svnnotify`, in which case SVN::Notify will not set it.

I&#39;m looking to do a release in the next day or two with all of your  
fixes, plus a new feature: output filtering.

Thanks for all your help!

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;20&nbsp;04:22:42&nbsp;2008</span>
    <span class="description">kaneyuki [...] eva.hi-ho.ne.jp -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 20 Feb 2008 18:14:37 +0900</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Toshikazu Kinkoh &lt;kaneyuki [...] eva.hi-ho.ne.jp&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi David,

Thank you for integration of the patch.

On Tue, 19 Feb 2008 14:25:21 -0500
David Wheeler via RT &lt;bug-SVN-Notify@rt.cpan.org&gt;-san wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The only change I made was to use the `charset` parameter to create  
&gt; `env_lang`, rather than `svn_charset`. I think that this is more  
&gt; likely to be the expected value, and if it&#39;s not, users can always  
&gt; explicitly set the `$LANG` environment variable before executing  
&gt; `svnnotify`, in which case SVN::Notify will not set it.
</div>
Well, then svnnotify results in error in a certain test case... &#40;I have 
confirmed on trunk source, r3442&#41;

My test case is as follows:
 --language ja-JP \
 --charset iso-2022-jp \
 --svn-charset eucJP \
 --diff-charset shiftjis \

The charset iso-2022-jp is one of standard encoding for Japanese 
email and widely used, so this is expected as one of normal usage.

Suppose user wants to receive email notification which is encoded
in iso-2022-jp, so we set charset parameter to be so.

When svnnotify runs with above parameters, it makes $LANG to be
 ja_JP.iso2022jp then resulting runtime error because no such name
supported.

Here is the error outputs:
svnlook: error: cannot set LC_ALL locale
svnlook: error: environment variable LANG is ja-JP.iso2022jp
svnlook: error: please check that your locale name is correct


I think svn_charset specifies the output from svnlook on server
side so indeed specified in _pipe&#40;&#41; parameter, but $ENV{LANG} 
that is set just before it specifies another charset.
They should be consistent so I said $LANG should be made from
svn_charset not from charset.

Please point out if I have something misunderstanding.

Best,
Toshikazu
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;20&nbsp;16:51:46&nbsp;2008</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 20 Feb 2008 12:49:33 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Feb 20, 2008, at 01:22, kin via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thank you for integration of the patch.
</div>
My pleasure. I&#39;ve been doing a lot more work on it, though, and now I  
don&#39;t think I&#39;m going to need Encode anymore. I have `binmode` doing  
the right thing and am properly converting everything to Perl&#39;s utf8  
format when bringing it in. This will make things a lot cleaner.  
Please do give r3450 a try and let me know what you think. More on  
that revision below:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Well, then svnnotify results in error in a certain test case... &#40;I  
&gt; have
&gt; confirmed on trunk source, r3442&#41;
&gt;
&gt; My test case is as follows:
&gt; --language ja-JP \
&gt; --charset iso-2022-jp \
&gt; --svn-charset eucJP \
&gt; --diff-charset shiftjis \
&gt;
&gt; The charset iso-2022-jp is one of standard encoding for Japanese
&gt; email and widely used, so this is expected as one of normal usage.
</div>
Of course. It looks like I had incorrectly set up the language  
determination to do `s/_/-/` instead of `s/-/_/`. On my system at  
least, it should be &#34;ja_JP&#34;, not &#34;ja-JP&#34;, when setting the $LANG  
environment variable:

% locale -a | grep ja
ja_JP
ja_JP.eucJP
ja_JP.SJIS
ja_JP.UTF-8

So I fixed that.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Suppose user wants to receive email notification which is encoded
&gt; in iso-2022-jp, so we set charset parameter to be so.
</div>
Right. And it looks like it&#39;s supported, according to Encode::Supported.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; When svnnotify runs with above parameters, it makes $LANG to be
&gt; ja_JP.iso2022jp then resulting runtime error because no such name
&gt; supported.
</div>
Hrm.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Here is the error outputs:
&gt; svnlook: error: cannot set LC_ALL locale
&gt; svnlook: error: environment variable LANG is ja-JP.iso2022jp
&gt; svnlook: error: please check that your locale name is correct
</div>
This might be the problem that I fixed above. Does your OS have a  
locale named &#34;ja_JP.iso2022jp&#34;? Mine doesn&#39;t &#40;Mac OS X 10.5.2&#41;, but if  
yours does, it should work much better as of r3450.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think svn_charset specifies the output from svnlook on server
&gt; side so indeed specified in _pipe&#40;&#41; parameter, but $ENV{LANG}
&gt; that is set just before it specifies another charset.
&gt; They should be consistent so I said $LANG should be made from
&gt; svn_charset not from charset.
</div>
Yes, also in r3450, I&#39;ve changed it so that there are now three  
env_lang attributes:

env_lang: Used for the call to sendmail.
svn_env_lang: Used for calls to svnlook
diff_env_lang: Used for calls to svnlook diff

So that should make things better, too, since it now sets $LANG as  
appropriate for each setting of charset, svn-charset, and diff-charset.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Please point out if I have something misunderstanding.
</div>
No, I think it was my bug. Please do give r3450 or later a shot and  
let me know what you think.

Thanks,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;22&nbsp;22:02:49&nbsp;2008</span>
    <span class="description">kaneyuki [...] eva.hi-ho.ne.jp -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 23 Feb 2008 10:43:09 +0900</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Toshikazu Kinkoh &lt;kaneyuki [...] eva.hi-ho.ne.jp&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi David,

On Wed, 20 Feb 2008 16:51:52 -0500
David Wheeler via RT &lt;bug-SVN-Notify@rt.cpan.org&gt;-san wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Of course. It looks like I had incorrectly set up the language  
&gt; determination to do `s/_/-/` instead of `s/-/_/`. On my system at  
&gt; least, it should be &#34;ja_JP&#34;, not &#34;ja-JP&#34;, when setting the $LANG  
&gt; environment variable:
&gt; 
&gt; % locale -a | grep ja
&gt; ja_JP
&gt; ja_JP.eucJP
&gt; ja_JP.SJIS
&gt; ja_JP.UTF-8
&gt; 
&gt; So I fixed that.
</div>
Ok, thank you.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; When svnnotify runs with above parameters, it makes $LANG to be
&gt; &gt; ja_JP.iso2022jp then resulting runtime error because no such name
&gt; &gt; supported.
</div>&gt; 
&gt; Hrm.
&gt; 
<div class="message-stanza open">&gt; &gt; Here is the error outputs:
&gt; &gt; svnlook: error: cannot set LC_ALL locale
&gt; &gt; svnlook: error: environment variable LANG is ja-JP.iso2022jp
&gt; &gt; svnlook: error: please check that your locale name is correct
</div>&gt; 
&gt; This might be the problem that I fixed above. Does your OS have a  
&gt; locale named &#34;ja_JP.iso2022jp&#34;? Mine doesn&#39;t &#40;Mac OS X 10.5.2&#41;, but if  
&gt; yours does, it should work much better as of r3450.
</div>
No my environment also does not support &#34;ja_JP.iso2022jp&#34;. It is common
in email encoding but normally unsupported as LANG environment variable.
So the hyphen-underbar problem is not responsible for it.

I will try to summarize the situation and my thinking:

1. iso-2022-jp is not valid encoding as $LANG so we will get the same 
 result even if we fix hyphen-underbar problem.

2. In this case, we only want the mail encoded with iso-2022-jp, but it is 
 not necessary that svnlook runs under that encoding on server at all.

3. Here is my understanding about encoding transition on above test case:

svnlook --&gt; [eucJP -&gt; internal exp.] --&gt; [internal exp. -&gt; iso-2022-jp ] --&gt; sendmail
             --svn-charset                  &#40;UTF-8&#41;                    --charset

svnlook diff --&gt; [shift-jis -&gt; internal exp.] --&gt; [internal exp. -&gt; iso-2022-jp] --&gt; sendmail 
                   --diff-charset                  &#40;UTF-8&#41;                     --charset

As shown above, encoding specified by --charset is only effective when 
the outputs will be sent to receivers via sendmail.

4. I&#39;m not familiar with sendmail, but I suspect it doesn&#39;t require $LANG
 setting when it runs. We give sendmail just octet stream that was 
 appropriately encoded with what we want.
 If so, we only should set $LANG to &#34;&lt;--language&gt;.&lt;--svn-charset&gt;&#34; at
 beginning and only should reset before svnlook-diff to &#34;C&#34;.
 Other complex control is not required. I think this is simple and clear.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; I think svn_charset specifies the output from svnlook on server
&gt; &gt; side so indeed specified in _pipe&#40;&#41; parameter, but $ENV{LANG}
&gt; &gt; that is set just before it specifies another charset.
&gt; &gt; They should be consistent so I said $LANG should be made from
&gt; &gt; svn_charset not from charset.
</div>&gt; 
&gt; Yes, also in r3450, I&#39;ve changed it so that there are now three  
&gt; env_lang attributes:
&gt; 
&gt; env_lang: Used for the call to sendmail.
&gt; svn_env_lang: Used for calls to svnlook
&gt; diff_env_lang: Used for calls to svnlook diff
&gt; 
&gt; So that should make things better, too, since it now sets $LANG as  
&gt; appropriate for each setting of charset, svn-charset, and diff-charset.
&gt; 
<div class="message-stanza open">&gt; &gt; Please point out if I have something misunderstanding.
</div>&gt; 
&gt; No, I think it was my bug. Please do give r3450 or later a shot and  
&gt; let me know what you think.
</div>
I don&#39;t know these changes are really necessary, but I will test the 
properties. Can you please tell me how to specify the properties?

Thanks,

Toshikazu
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;23&nbsp;00:25:34&nbsp;2008</span>
    <span class="description">david [...] justatheory.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 22 Feb 2008 21:23:41 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;david [...] justatheory.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Feb 22, 2008, at 19:02, kin via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; No my environment also does not support &#34;ja_JP.iso2022jp&#34;. It is  
&gt; common
&gt; in email encoding but normally unsupported as LANG environment  
&gt; variable.
&gt; So the hyphen-underbar problem is not responsible for it.
</div>
I see.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I will try to summarize the situation and my thinking:
&gt;
&gt; 1. iso-2022-jp is not valid encoding as $LANG so we will get the same
&gt; result even if we fix hyphen-underbar problem.
</div>
Right.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 2. In this case, we only want the mail encoded with iso-2022-jp, but  
&gt; it is
&gt; not necessary that svnlook runs under that encoding on server at all.
</div>
Okay.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 3. Here is my understanding about encoding transition on above test  
&gt; case:
&gt;
&gt; svnlook --&gt; [eucJP -&gt; internal exp.] --&gt; [internal exp. -&gt; iso-2022- 
&gt; jp ] --&gt; sendmail
&gt;             --svn-charset                   
&gt; &#40;UTF-8&#41;                    --charset
&gt;
&gt; svnlook diff --&gt; [shift-jis -&gt; internal exp.] --&gt; [internal exp. -&gt;  
&gt; iso-2022-jp] --&gt; sendmail
&gt;                   --diff-charset                   
&gt; &#40;UTF-8&#41;                     --charset
</div>
I don&#39;t really follow this, but see below.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As shown above, encoding specified by --charset is only effective when
&gt; the outputs will be sent to receivers via sendmail.
</div>
Yes. If you specify --svn-charset, then --charset applies only to what  
gets generated in the email. If you also specfy --diff-charset, then -- 
svn-charset is only applied to `svn info` and `svn dirs-changed`.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 4. I&#39;m not familiar with sendmail, but I suspect it doesn&#39;t require  
&gt; $LANG
&gt; setting when it runs. We give sendmail just octet stream that was
&gt; appropriately encoded with what we want.
</div>
Yes, I think that&#39;s right. I wish the same was true of svnlook. :-&#40;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If so, we only should set $LANG to &#34;&lt;--language&gt;.&lt;--svn-charset&gt;&#34; at
&gt; beginning and only should reset before svnlook-diff to &#34;C&#34;.
</div>
I&#39;ve modified the code so that it sets $LANG to &#34;&lt;--language&gt;.&lt;--svn- 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">charset&gt;&#34; when it calls `svnlook info` and `svnlook dirs-changed`. It  
</div>sets $LANG to &#34;&lt;--language&gt;.&lt;--diff-charset&gt;&#34; for the call to `svnlook  
diff`. And it sets it to &#34;&lt;--language&gt;.&lt;--charset&gt;&#34; for sendmail just  
to be safe. I think taht covers all that you need. SVN::Notify no  
longer sets $LANG to &#34;C&#34;, though, as `svnlook diff` does not seem to  
pay attention to $LANG &#40;gotta love the consistency, eh? NOT&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Other complex control is not required. I think this is simple and  
&gt; clear.
</div>
Yes, I think we&#39;re on the same page here. Please let me know if I&#39;m  
wrong.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I don&#39;t know these changes are really necessary, but I will test the
&gt; properties. Can you please tell me how to specify the properties?
</div>
I think you want

   svnnotify -p &#34;$1&#34; -r &#34;$2&#34; --charset iso-2022-jp \
   --svn-charset eucJP --diff-charset shift-jis

I&#39;m assuming that:

  1. You want mail sent in iso-2022-jp
  2. Your commit log messages and file names are in eucJP
  3. Your source code is in shift-jis

If not, modify accordingly.

Many thanks,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;23&nbsp;00:33:57&nbsp;2008</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 22 Feb 2008 21:33:00 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; I think you want
&gt;
&gt;  svnnotify -p &#34;$1&#34; -r &#34;$2&#34; --charset iso-2022-jp \
&gt;  --svn-charset eucJP --diff-charset shift-jis
</div>
Um, make that:

  svnnotify -p &#34;$1&#34; -r &#34;$2&#34; --charset iso-2022-jp \
  --svn-charset eucJP --diff-charset shift-jis --language ja_JP \
  --with-diff

Sorry to have omitted those last two bits.

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;23&nbsp;12:19:47&nbsp;2008</span>
    <span class="description">kaneyuki [...] eva.hi-ho.ne.jp -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 24 Feb 2008 02:11:00 +0900</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Toshikazu Kinkoh &lt;kaneyuki [...] eva.hi-ho.ne.jp&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi David,

I&#39;m really glad to see we&#39;re on the same wavelength on this issue.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; As shown above, encoding specified by --charset is only effective when
&gt;&gt; the outputs will be sent to receivers via sendmail.
</div>&gt;
&gt;Yes. If you specify --svn-charset, then --charset applies only to what
&gt;gets generated in the email. If you also specfy --diff-charset, then --
&gt;svn-charset is only applied to `svn info` and `svn dirs-changed`.
</div>
Okay, my understanding agrees exactly what you says.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;I&#39;ve modified the code so that it sets $LANG to &#34;&lt;--language&gt;.&lt;--svn-
<div class="message-stanza open">&gt;charset&gt;&#34; when it calls `svnlook info` and `svnlook dirs-changed`. It
</div>&gt;sets $LANG to &#34;&lt;--language&gt;.&lt;--diff-charset&gt;&#34; for the call to `svnlook
&gt;diff`. And it sets it to &#34;&lt;--language&gt;.&lt;--charset&gt;&#34; for sendmail just
&gt;to be safe. I think taht covers all that you need. SVN::Notify no
&gt;longer sets $LANG to &#34;C&#34;, though, as `svnlook diff` does not seem to
&gt;pay attention to $LANG &#40;gotta love the consistency, eh? NOT&#41;.
</div>
Thanks, this seems to be almost good. But as for `svnlook diff`, $LANG
needs still set to &#34;C&#34;. Why it should be is commented shortly in source
&#40;see below in detail&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;`svnlook diff` does not seem to pay attention to $LANG 
</div>
Urm, that is true for diff contents themselves, but other output is
effected. For example, &#34;Modified:&#34; keyword shown in `svnlook diff`
output will be localized according to $LANG. In Japanese it is shown
as &#34;変更:&#34;.

This meddlesomeness of svnlook is harmful in two ways:
1. Filters such as Alternative::HTML expect the keywords in English so
 if it was output in other language, the result is broken.
2. When $LANG and diff-charset are differ, at least that keyword will
 be broken, and often break whole output of `svnlook diff`.

I think this will only be resolved to set it to &#34;C&#34;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; Other complex control is not required. I think this is simple and
&gt;&gt; clear.
</div>&gt;
&gt;Yes, I think we&#39;re on the same page here. Please let me know if I&#39;m
&gt;wrong.
</div>
Yes we&#39;re nearly the same, except only for `svnlook diff` part.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; I don&#39;t know these changes are really necessary, but I will test the
&gt;&gt; properties. Can you please tell me how to specify the properties?
</div>&gt;
&gt;I think you want
&gt;svnnotify -p &#34;$1&#34; -r &#34;$2&#34; --charset iso-2022-jp \
&gt;--svn-charset eucJP --diff-charset shift-jis --language ja_JP \
&gt;--with-diff
</div>
Ah, I see. I had been misunderstood that I should specify 
something another options, thank you.
I will do testing next week &#40;sorry not to have the environment 
to test at home&#41;, and let you know the result ASAP.

Thanks, and good night!
Toshikazu
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;23&nbsp;19:05:00&nbsp;2008</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 23 Feb 2008 16:04:45 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Feb 23, 2008, at 09:19, kin via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m really glad to see we&#39;re on the same wavelength on this issue.
</div>
I am, too.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Okay, my understanding agrees exactly what you says.
</div>

Excellent.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; Thanks, this seems to be almost good. But as for `svnlook diff`,  
&gt;&gt; $LANG
</div>&gt; needs still set to &#34;C&#34;. Why it should be is commented shortly in  
&gt; source
&gt; &#40;see below in detail&#41;.
</div>
D&#39;oh! That&#39;s what I get for not reading comments in the code.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; `svnlook diff` does not seem to pay attention to $LANG
</div>&gt;
&gt; Urm, that is true for diff contents themselves, but other output is
&gt; effected. For example, &#34;Modified:&#34; keyword shown in `svnlook diff`
&gt; output will be localized according to $LANG. In Japanese it is shown
&gt; as &#34;変更:&#34;.
&gt;
&gt; This meddlesomeness of svnlook is harmful in two ways:
&gt; 1. Filters such as Alternative::HTML expect the keywords in English so
&gt; if it was output in other language, the result is broken.
&gt; 2. When $LANG and diff-charset are differ, at least that keyword will
&gt; be broken, and often break whole output of `svnlook diff`.
&gt;
&gt; I think this will only be resolved to set it to &#34;C&#34;.
</div>
Yes, you are quite right. There was even a comment in the code to this  
effect. I&#39;ve now reverted to setting $LANG to &#34;C&#34; in r3460. And with  
that, I think we&#39;ve got everything covered. Now if only I could get my  
ancient FreeBSD box to support all my own UTF-8 multibyte characters,  
I&#39;d be in business!

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; I think you want
&gt;&gt; svnnotify -p &#34;$1&#34; -r &#34;$2&#34; --charset iso-2022-jp \
&gt;&gt; --svn-charset eucJP --diff-charset shift-jis --language ja_JP \
&gt;&gt; --with-diff
</div>&gt;
&gt; Ah, I see. I had been misunderstood that I should specify
&gt; something another options, thank you.
&gt; I will do testing next week &#40;sorry not to have the environment
&gt; to test at home&#41;, and let you know the result ASAP.
</div>
That would be greatly appreciated. I&#39;ve been trying to get this  
release out for a week, but I really need confirmation from you that  
it all works as it should, as my BSD box, as I said, isn&#39;t helping me  
out any. :-&#40;

Many thanks for your help.

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;25&nbsp;05:50:18&nbsp;2008</span>
    <span class="description">kaneyuki [...] eva.hi-ho.ne.jp -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 25 Feb 2008 19:38:09 +0900</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Toshikazu Kinkoh &lt;kaneyuki [...] eva.hi-ho.ne.jp&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi David,
I have tested r3460.

post-commit stops in $notifier-&gt;output_metadata&#40;$out&#41; with
following error:

| Date:     2008-02-14 11:20:45 +0900 &#40;?━ 14  2? 2008&#41;
| Wide character in syswrite at /usr/lib/perl5/5.8.5/Net/Cmd.pm line 436.

The commit Date output is localized &#40;so broken&#41;, but this is 
not the reason for the error.

As I mentioned in the past mail, we can&#39;t pass Perl&#39;s internal 
expression directly to sendmail even if the encoding is specified 
by binmode, but current code does that again.

What I sent:
---------------------------------------------------------
3. To decode them to output encoding &#40;specified by --charset option&#41; by ourselves 
  just before printing them to mail pipe.
4. Mail pipe simply receives octet stream.

Item #3 in above listing stands on that specifying encoding to tied_fh of SMTP by
binmode has no effect.  This is the case of &#34;When Unicode Does Not Happen&#34; in
perlunicode doc.
---------------------------------------------------------
As a result, I think it is imperative that we have to encode internal 
expression &#40;UTF-8&#41; to output encoding at least for mail contents.

Frankly speaking, I feel r3442 is very close to goal as for encoding.
How about re-start at that point?
If your decision is no, I will still give my cooperation for testing and
debugging of course. But maybe my response will get slow because 
the code understanding seems to take a time little.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; That would be greatly appreciated. I&#39;ve been trying to get this  
&gt; release out for a week, but I really need confirmation from you that  
&gt; it all works as it should, as my BSD box, as I said, isn&#39;t helping me  
&gt; out any. :-&#40;
</div>
I understand it is really difficult that this kind of matter to be confirmed
because you don&#39;t have environment.

Best,
Toshikazu
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;25&nbsp;13:10:27&nbsp;2008</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 25 Feb 2008 10:10:05 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Feb 25, 2008, at 02:50, kin via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have tested r3460.
</div>
Great!

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; post-commit stops in $notifier-&gt;output_metadata&#40;$out&#41; with
&gt; following error:
&gt;
&gt; | Date:     2008-02-14 11:20:45 +0900 &#40;?━ 14  2? 2008&#41;
&gt; | Wide character in syswrite at /usr/lib/perl5/5.8.5/Net/Cmd.pm line  
&gt; 436.
&gt;
&gt; The commit Date output is localized &#40;so broken&#41;, but this is
&gt; not the reason for the error.
</div>
Grrrr.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As I mentioned in the past mail, we can&#39;t pass Perl&#39;s internal
&gt; expression directly to sendmail even if the encoding is specified
&gt; by binmode, but current code does that again.
&gt;
&gt; What I sent:
&gt; ---------------------------------------------------------
&gt; 3. To decode them to output encoding &#40;specified by --charset option&#41;  
&gt; by ourselves
&gt;  just before printing them to mail pipe.
&gt; 4. Mail pipe simply receives octet stream.
</div>
That&#39;s exactly what binmode is supposed to automate, and does in the  
tests I&#39;ve written for it.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Item #3 in above listing stands on that specifying encoding to  
&gt; tied_fh of SMTP by
&gt; binmode has no effect.  This is the case of &#34;When Unicode Does Not  
&gt; Happen&#34; in
&gt; perlunicode doc.
&gt; ---------------------------------------------------------
&gt; As a result, I think it is imperative that we have to encode internal
&gt; expression &#40;UTF-8&#41; to output encoding at least for mail contents.
</div>
Oh, okay, so you&#39;re using --smtp rather than --sendmail? That would  
explain it; I can work with that. And looking up to that error, I see  
that the warning comes from Net::Cmd, which would confirm the use of  
SMTP. That explains a lot!

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Frankly speaking, I feel r3442 is very close to goal as for encoding.
&gt; How about re-start at that point?
</div>
I have a better idea: I&#39;ll fix SVN::Notify::SMTP so that it properly  
converts Perl&#39;s internal representation to octets…Done! Would you  
please try r3464?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If your decision is no, I will still give my cooperation for testing  
&gt; and
&gt; debugging of course. But maybe my response will get slow because
&gt; the code understanding seems to take a time little.
</div>
I really appreciate the help you&#39;ve given me with this. I want it to  
work as well as possible &#40;not US English bias please!&#41;, and your  
assistance has been invaluable. Your patience with me is much  
appreciated.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I understand it is really difficult that this kind of matter to be  
&gt; confirmed
&gt; because you don&#39;t have environment.
</div>
My Mac OS X box can do all the major locales, but I don&#39;t have my SVN  
server on it. :-&#40; That means I can&#39;t really test production commits,  
but I certainly can write lots of Perl tests until I get it right.

So in that vein, would you mind executing some commands against some  
revision of your SVN repository that I could add to tests? Such tests  
would be publicly distributed with SVN::Notify, so they should not  
contain anything you don&#39;t want to be public. Any simple change will  
do with a few wide characters as you normally encode them in your  
commit message and source code. I&#39;m assuming that you use eucJP for  
your commit messages and file names, and shift-jis for your source  
code. If not, please adjust accordingly and let me know what the  
proper encodings are. Substitute &#34;/path/to/svnroot&#34; for your svnroot  
and &#34;-r1234&#34; with an appropriate revision number.

LANG=ja_JP.eucJP svnlook info /path/to/svnroot -r1234 &gt; info.txt
LANG=ja_JP.eucJP svnlook changed /path/to/svnroot -r1234 &gt; changed.txt
LANG=ja_JP.eucJP svnlook dirs-changed /path/to/svnroot -r1234 &gt; dirs- 
changed.txt
LANG=ja_JP.shift-jis svnlook diff /path/to/svnroot -r1234 &gt; diff.txt

If you could then send me those *.diff files, I&#39;ll create test files  
for them in t/data and write a test that compares all of the encodings  
as appropriate, using sendmail *and* SMTP. Then we can make sure that  
this issue is licked once and for all.

Many thanks,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;26&nbsp;01:05:22&nbsp;2008</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 25 Feb 2008 22:04:30 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Feb 25, 2008, at 10:10, David E. Wheeler wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; Frankly speaking, I feel r3442 is very close to goal as for encoding.
&gt;&gt; How about re-start at that point?
</div>&gt;
&gt; I have a better idea: I&#39;ll fix SVN::Notify::SMTP so that it properly  
&gt; converts Perl&#39;s internal representation to octets…Done! Would you  
&gt; please try r3464?
</div>
FYI: As of r3476, I&#39;ve renamed the options from *charset to *encoding.  
So you&#39;ll need to do something like this now:

svnnotify -p &#34;$1&#34; -r &#34;$2&#34; --encoding iso-2022-jp \
--svn-encoding eucJP --diff-encoding shift-jis --language ja_JP \
--with-diff

Thanks!

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;26&nbsp;07:18:19&nbsp;2008</span>
    <span class="description">kaneyuki [...] eva.hi-ho.ne.jp -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 26 Feb 2008 21:09:38 +0900</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Toshikazu Kinkoh &lt;kaneyuki [...] eva.hi-ho.ne.jp&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi David,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Oh, okay, so you&#39;re using --smtp rather than --sendmail? That would
&gt; explain it; I can work with that. And looking up to that error, I see
&gt; that the warning comes from Net::Cmd, which would confirm the use of
&gt; SMTP. That explains a lot!
</div>
Yes, I&#39;m using --smtp and sorry for that I should have tell you earlier.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Frankly speaking, I feel r3442 is very close to goal as for encoding.
&gt; &gt; How about re-start at that point?
</div>&gt; 
&gt; I have a better idea: I&#39;ll fix SVN::Notify::SMTP so that it properly
&gt; converts Perl&#39;s internal representation to octets…Done! Would you
&gt; please try r3464?
</div>
I have checked and got the same result.
I&#39;m afraid Perl&#39;s IO layer does nothing because it is the case 
&#34;glob &#40;aka the &lt;*&gt;&#41;&#34; in &#34;When Unicode Does Not Happen&#34;, in perlunicode doc.
# <span class="clickylink"><a target="new" rel="nofollow" href="http://perldoc.perl.org/perlunicode.html#When-Unicode-Does-Not-Happen">http://perldoc.perl.org/perlunicode.html#When-Unicode-Does-Not-Happen</a></span>

So we should encode it by ourselves with Encode::encode&#40;&#41;, which has 
been eliminated in recent changes.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I really appreciate the help you&#39;ve given me with this. I want it to
&gt; work as well as possible &#40;not US English bias please!&#41;, and your
&gt; assistance has been invaluable. Your patience with me is much
&gt; appreciated.
</div>
I also appreciate your patience with me ! :-&#41; 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; My Mac OS X box can do all the major locales, but I don&#39;t have my SVN
&gt; server on it. :-&#40; That means I can&#39;t really test production commits,
&gt; but I certainly can write lots of Perl tests until I get it right.
</div>
I see.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If you could then send me those *.diff files, I&#39;ll create test files
&gt; for them in t/data and write a test that compares all of the encodings
&gt; as appropriate, using sendmail *and* SMTP. Then we can make sure that
&gt; this issue is licked once and for all.
</div>
That&#39;s a pretty good idea. I will make some test commits and send the
files. Please wait a while because I will try make effective data for 
test and make ... say, ready-to-expose data.

BTW, current code contains a little bug on debug print:
-sub _dbpnt { print __PACKAGE__, &#34;: $_[0]\n&#34; }
+sub _dbpnt { print __PACKAGE__, &#34;: $_[1]\n&#34; }

Best,
Toshikazu
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;26&nbsp;12:56:58&nbsp;2008</span>
    <span class="description">david [...] justatheory.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 26 Feb 2008 09:43:31 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;david [...] justatheory.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Feb 26, 2008, at 04:18, kin via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have checked and got the same result.
</div>
Gaaahh!

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m afraid Perl&#39;s IO layer does nothing because it is the case
&gt; &#34;glob &#40;aka the &lt;*&gt;&#41;&#34; in &#34;When Unicode Does Not Happen&#34;, in  
&gt; perlunicode doc.
&gt; # <span class="clickylink"><a target="new" rel="nofollow" href="http://perldoc.perl.org/perlunicode.html#When-Unicode-Does-Not-">http://perldoc.perl.org/perlunicode.html#When-Unicode-Does-Not-</a></span> 
&gt; Happen
</div>
I don&#39;t understand at all. Where is the code using a glob? SMTP is a  
tied file handle at line 2279, just like the PIPE tied file handles  
elsewhere. Adding the binmode&#40;&#41; call to it at line 2282 should have  
fixed the issue. There is no globbing there that I can see: it&#39;s just  
a file handle.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So we should encode it by ourselves with Encode::encode&#40;&#41;, which has
&gt; been eliminated in recent changes.
</div>
I can added it to the PRINT and PRINTF methods. That&#39;s probably what&#39;s  
needed. In fact, looking at it, that&#39;s probably the problem: although  
SMTP is binmode&#39;d, I guess it doesn&#39;t pass the encoded strings to  
PRINT. So it has to be done manually. So…it&#39;s fixed. For reals! In  
r3479. I know that it&#39;s really fixed because a test failed in t/ 
smtp.t, and all I had to do was let the test use octets in its  
comparison, rather than Perl&#39;s internal format. W00t! Please do give  
it a try to confirm, just for a sanity check.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; That&#39;s a pretty good idea. I will make some test commits and send the
&gt; files. Please wait a while because I will try make effective data for
&gt; test and make ... say, ready-to-expose data.
</div>
Perfect, thanks.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; BTW, current code contains a little bug on debug print:
&gt; -sub _dbpnt { print __PACKAGE__, &#34;: $_[0]\n&#34; }
&gt; +sub _dbpnt { print __PACKAGE__, &#34;: $_[1]\n&#34; }
</div>
Fixed, thanks.

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;27&nbsp;04:23:50&nbsp;2008</span>
    <span class="description">kaneyuki [...] eva.hi-ho.ne.jp -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 27 Feb 2008 18:14:52 +0900</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Toshikazu Kinkoh &lt;kaneyuki [...] eva.hi-ho.ne.jp&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi David,

I have tested r3486 and got good results for the files those names
are single byte. But the test case for those having multibyte 
character in file path &#40;I personally hate it but real is differ&#41; when HTML
or HTML::ColorDiff for Alternative are specified &#40;below&#41; was NG.

 --handler Alternative \
 --alternative HTML \
or
 --handler Alternative \
 --alternative HTML::ColorDiff \

It stops with following error:
Wide character in crypt at /usr/lib/perl5/site_perl/5.8.5/SVN/Notify/Alternative.pm line 131.

I didn&#39;t investigate further because I don&#39;t have enough time today.

Thanks,
Toshikazu
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;27&nbsp;15:21:57&nbsp;2008</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 27 Feb 2008 12:21:13 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Feb 27, 2008, at 01:23, kin via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have tested r3486 and got good results for the files those names
&gt; are single byte. But the test case for those having multibyte
&gt; character in file path &#40;I personally hate it but real is differ&#41;  
&gt; when HTML
&gt; or HTML::ColorDiff for Alternative are specified &#40;below&#41; was NG.
&gt;
&gt; --handler Alternative \
&gt; --alternative HTML \
&gt; or
&gt; --handler Alternative \
&gt; --alternative HTML::ColorDiff \
&gt;
&gt; It stops with following error:
&gt; Wide character in crypt at /usr/lib/perl5/site_perl/5.8.5/SVN/Notify/ 
&gt; Alternative.pm line 131.
&gt;
&gt; I didn&#39;t investigate further because I don&#39;t have enough time today.
</div>
Now we&#39;re getting somewhere! Fixed in r3487.

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;28&nbsp;15:32:41&nbsp;2008</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Feb 27 15:21:57 2008, DWHEELER wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Now we&#39;re getting somewhere! Fixed in r3487.
</div>
Can I take it from your silence that it now works for you? Have you had
a chance to try it?

Thanks,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;29&nbsp;04:36:28&nbsp;2008</span>
    <span class="description">kaneyuki [...] eva.hi-ho.ne.jp -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 29 Feb 2008 18:28:14 +0900</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Toshikazu Kinkoh &lt;kaneyuki [...] eva.hi-ho.ne.jp&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi David,

I&#39;m sorry for the delay of reply.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Now we&#39;re getting somewhere! Fixed in r3487.
</div>&gt; 
&gt; Can I take it from your silence that it now works for you? Have you had
&gt; a chance to try it?
</div>
I was busy so I couldn&#39;t test and reply.

Now I checked r3487 and confirmed it works all fine. I think we can release 
though I have not sent some test data. I hope they can be sent next week.

Thanks,
Toshikazu
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;29&nbsp;12:52:23&nbsp;2008</span>
    <span class="description">david [...] justatheory.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 29 Feb 2008 09:52:02 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;david [...] justatheory.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Feb 29, 2008, at 01:36, kin via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I was busy so I couldn&#39;t test and reply.
&gt;
&gt; Now I checked r3487 and confirmed it works all fine. I think we can  
&gt; release
&gt; though I have not sent some test data. I hope they can be sent next  
&gt; week.
</div>
W00t! Released!

   <span class="clickylink"><a target="new" rel="nofollow" href="http://justatheory.com/computers/programming/perl/modules/svnnotify-2.70.html">http://justatheory.com/computers/programming/perl/modules/svnnotify-2.70.html</a></span>

Thanks, and I look forward to getting those files and adding more tests.

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;07&nbsp;04:56:08&nbsp;2008</span>
    <span class="description">kaneyuki [...] eva.hi-ho.ne.jp -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29730] &#40;feature request&#41; --svnlook-diff option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 07 Mar 2008 18:47:18 +0900</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Notify [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Toshikazu Kinkoh &lt;kaneyuki [...] eva.hi-ho.ne.jp&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi David,

I have created test data.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; commit message and source code. I&#39;m assuming that you use eucJP for  
&gt; your commit messages and file names, and shift-jis for your source  
&gt; code. If not, please adjust accordingly and let me know what the  
&gt; proper encodings are. 
</div>
The commit messages and file names are UTF-8 in repository because
I&#39;m using svn with default settings. Source code is shift-jis.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; LANG=ja_JP.eucJP svnlook info /path/to/svnroot -r1234 &gt; info.txt
&gt; LANG=ja_JP.eucJP svnlook changed /path/to/svnroot -r1234 &gt; changed.txt
&gt; LANG=ja_JP.eucJP svnlook dirs-changed /path/to/svnroot -r1234 &gt; dirs- 
&gt; changed.txt
&gt; LANG=ja_JP.shift-jis svnlook diff /path/to/svnroot -r1234 &gt; diff.txt
</div>
Here is the executed commands to generate the files attached:
LANG=ja_JP.eucJP svnlook info /path/to/repos -r 30 &gt; info.txt
LANG=ja_JP.eucJP svnlook changed /path/to/repos -r 30 &gt; changed.txt
LANG=ja_JP.eucJP svnlook dirs-changed /path/to/repos -r 30 &gt; dirs-changed.txt
LANG=C svnlook diff /path/to/repos -r 31 &gt; diff.txt

I divided commit for diff &#40;r31&#41; and other commands &#40;r30&#41; because it would help 
test to focus one feature.
r30 contains file path with multibyte character. r31 is diff output with shift-jis,
and executed with LANG=C because ja_JP.shift-jis is not supported as I said.

Please let me know if you have any inconvenience.

Many thanks,
Toshikazu
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;13&nbsp;10:04:18&nbsp;2013</span>
    <span class="description">dwheeler [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
