<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #60176 for Devel-CheckLib: no way to test with dependent libraries</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #60176 for Devel-CheckLib: no way to test with dependent libraries</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Devel-CheckLib">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Devel-CheckLib">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Devel-CheckLib">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Devel-CheckLib">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Devel-CheckLib">Devel-CheckLib CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">60176</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Devel-CheckLib">Devel-CheckLib</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
TONYC [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-45794-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.699_002    </td>
  </tr>
  <tr id="CF-45795-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




dc-compat.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/814967/422312/dc-compat.diff">
Mon Aug 09 09:03:03 2010 (3.8k) by TONYC [...] cpan.org
</a>
</font></li>
</ul>


dc-like-eu-mm.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/814964/422308/dc-like-eu-mm.diff">
Mon Aug 09 09:00:16 2010 (3.5k) by TONYC [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=60176">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-814745" href="/Public/Bug/Display.html?id=60176#txn-814745">#</a>      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;08&nbsp;09:50:28&nbsp;2010</span>
    <span class="description">TONYC [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> no way to test with dependent libraries</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/814745/422135/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/422135">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Some libraries, on some platforms, require other libraries to perform
their function.

For example, on OpenBSD 4.7 the standard libpng package requires libz
and libm to be linked in, otherwise some symbols are unresolved:

# sample code from probes I do for Imager 0.75_02
bash-4.0$ cat pngtest.c 
#include &lt;png.h&gt;
#include &lt;stdio.h&gt;

int main&#40;&#41; {
  fprintf&#40;stderr, &#34;PNG: library version %ld, header version %ld\n&#34;,
&#40;long&#41;png_access_version_number&#40;&#41;,  &#40;long&#41;PNG_LIBPNG_VER&#41;;
  return 0;
}
bash-4.0$ pkg-config --libs libpng
-L/usr/local/lib -lpng -lz -lm
bash-4.0$ pkg-config --cflags libpng
-I/usr/local/include/libpng
bash-4.0$ cc -opngtest pngtest.c -I/usr/local/include/libpng
-L/usr/local/lib -lpng -lz -lm
bash-4.0$ ./pngtest
PNG: library version 10241, header version 10241

And yes, the extra libraries specified by pkg-config are required:

bash-4.0$ cc -opngtest pngtest.c -I/usr/local/include/libpng
-L/usr/local/lib -lpng  
/usr/local/lib/libpng.so.9.0: undefined reference to `deflate&#39;
/usr/local/lib/libpng.so.9.0: undefined reference to `inflate&#39;
/usr/local/lib/libpng.so.9.0: undefined reference to `inflateInit_&#39;
/usr/local/lib/libpng.so.9.0: undefined reference to `crc32&#39;
/usr/local/lib/libpng.so.9.0: undefined reference to `pow&#39;
/usr/local/lib/libpng.so.9.0: undefined reference to `deflateInit2_&#39;
/usr/local/lib/libpng.so.9.0: undefined reference to `inflateReset&#39;
/usr/local/lib/libpng.so.9.0: undefined reference to `deflateReset&#39;
/usr/local/lib/libpng.so.9.0: undefined reference to `inflateEnd&#39;
/usr/local/lib/libpng.so.9.0: undefined reference to `deflateEnd&#39;
collect2: ld returned 1 exit status

Now, if I supply LIBS with &#34;-L/usr/local/lib -lpng -lz -lm&#34; to EU::MM it
will use all of those options at once to build the library:

# extract from building Imager with the Devel::CheckLib check disabled
LD_RUN_PATH=&#34;/usr/local/lib:/usr/lib&#34; cc  -shared -fPIC 
-fstack-protector PNG.o impng.o  -o
../blib/arch/auto/Imager/File/PNG/PNG.so     -L/usr/local/lib -lpng -lz
-lm         

unfortunately Devel::CheckLib will apply the library options one at a
time, and so failing every time:

bash-4.0$ cat checklib.pl
#!perl -w
use Devel::CheckLib;
assert_lib
  &#40;
   debug =&gt; 1,
   function =&gt; &lt;&lt;&#39;CODE&#39;,
  fprintf&#40;stderr, &#34;PNG: library version %ld, header version %ld\n&#34;,
&#40;long&#41;png_access_version_number&#40;&#41;,  &#40;long&#41;PNG_LIBPNG_VER&#41;;
  return 0;
CODE
   LIBS =&gt; &#34;-L/usr/local/lib -lpng -lz -lm&#34;,
   INC =&gt; &#34;-I/usr/local/include/libpng&#34;,
   header =&gt; [ &#34;png.h&#34;, &#34;stdio.h&#34; ],
  &#41;;
bash-4.0$ perl -I/home/tony/dev/imager/svn/Imager/inc checklib.pl
# /usr/bin/cc assertlib7SvTIKT4.c -I/usr/local/include/libpng -o
assertlib9L8Q6Za_
# /usr/bin/cc assertlibIa6SBYbZ.c -I/usr/local/include/libpng -o
assertlibYpJcXz1F
# /usr/bin/cc assertlib_xG5BLU_.c -o assertlibDFkVO8hE -lpng
-I/usr/local/include/libpng -L/usr/local/lib
/usr/local/lib/libpng.so.9.0: undefined reference to `deflate&#39;
/usr/local/lib/libpng.so.9.0: undefined reference to `inflate&#39;
/usr/local/lib/libpng.so.9.0: undefined reference to `inflateInit_&#39;
/usr/local/lib/libpng.so.9.0: undefined reference to `crc32&#39;
/usr/local/lib/libpng.so.9.0: undefined reference to `pow&#39;
/usr/local/lib/libpng.so.9.0: undefined reference to `deflateInit2_&#39;
/usr/local/lib/libpng.so.9.0: undefined reference to `inflateReset&#39;
/usr/local/lib/libpng.so.9.0: undefined reference to `deflateReset&#39;
/usr/local/lib/libpng.so.9.0: undefined reference to `inflateEnd&#39;
/usr/local/lib/libpng.so.9.0: undefined reference to `deflateEnd&#39;
collect2: ld returned 1 exit status
# /usr/bin/cc assertlib_xG5BLU_.c -o assertlib1DI8N7tq -lz
-I/usr/local/include/libpng -L/usr/local/lib
/tmp//ccfQ8IgC.o&#40;.text+0x21&#41;: In function `main&#39;:
: undefined reference to `png_access_version_number&#39;
collect2: ld returned 1 exit status
# /usr/bin/cc assertlib_xG5BLU_.c -o assertlibstnQw0RH -lm
-I/usr/local/include/libpng -L/usr/local/lib
/tmp//ccxlAPpV.o&#40;.text+0x21&#41;: In function `main&#39;:
: undefined reference to `png_access_version_number&#39;
collect2: ld returned 1 exit status
Can&#39;t link/include &#39;png&#39;, &#39;z&#39;, &#39;m&#39;

I&#39;m willing to produce a patch for this, but making the behaviour match
EU::MM behaviour would break backwards compatibility, since the current
split-the-scalar-on-whitespace behaviour would need to be changed.

Also, unfortunately, I don&#39;t see a way to make the LIBS behaviour
exactly match the separate lib and libpaths parameters, since each
values in the LIBS array is independent, while D::CL applies all values
in libpath to each separate library name in libs.

I expect I&#39;d need to build a set of libtests, each with libpaths and
libraries, which would be built in different ways depending on whether
LIBS was supplied or lib/libpath.

Tony
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-814964" href="/Public/Bug/Display.html?id=60176#txn-814964">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;09&nbsp;09:00:16&nbsp;2010</span>
    <span class="description">TONYC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [patch] no way to test with dependent libraries</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/814964/422307/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/422307">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 199b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Patch: make LIBS act like EU::MM whether supplied as a scalar or array ref.

This may break backward compatibility.

This is the patch within the Imager dev tree, so the base directory is a
bit off.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> dc-like-eu-mm.diff</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/814964/422308/dc-like-eu-mm.diff">Download dc-like-eu-mm.diff</a><br />
<span class="downloadcontenttype">text/x-diff 3.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: Devel/CheckLib.pm
===================================================================
--- Devel/CheckLib.pm	&#40;revision 1785&#41;
+++ Devel/CheckLib.pm	&#40;revision 1786&#41;
@@ -185,6 +185,11 @@
     @incpaths = &#40;ref&#40;$args{incpath}&#41; ? @{$args{incpath}} : $args{incpath}&#41; 
         if $args{incpath};
 
+    # each entry is an arrayref containing:
+    # 0: arrayref of library search paths
+    # 1: arrayref of library names
+    my @link_cfgs = map [ \@libpaths, [ $_ ] ], @libs;
+
     # work-a-like for Makefile.PL&#39;s LIBS and INC arguments
     # if given as command-line argument, append to %args
     for my $arg &#40;@ARGV&#41; {
@@ -197,12 +202,14 @@
             }
         }
     }
-
     # using special form of split to trim whitespace
     if&#40;defined&#40;$args{LIBS}&#41;&#41; {
-        foreach my $arg &#40;split&#40;&#39; &#39;, $args{LIBS}&#41;&#41; {
-            die&#40;&#34;LIBS argument badly-formed: $arg\n&#34;&#41; unless&#40;$arg =~ /^-l/i&#41;;
-            push @{$arg =~ /^-l/ ? \@libs : \@libpaths}, substr&#40;$arg, 2&#41;;
+	my @LIBS = ref $args{LIBS} ? @{$args{LIBS}} : split &#39; &#39;, $args{LIBS};
+        foreach my $arg &#40;@LIBS&#41; {
+	    my @sep = split &#39; &#39;, $arg;
+	    my @libs = map { /^-l&#40;.+&#41;$/ ? $1 : &#40;&#41; } @sep;
+	    my @paths = map { /^-L&#40;.+&#41;$/ ? $1 : &#40;&#41; } @sep;
+	    push @link_cfgs, [ \@paths, \@libs ];
         }
     }
     if&#40;defined&#40;$args{INC}&#41;&#41; {
@@ -263,7 +270,8 @@
     print $ch qq{#include &lt;$_&gt;\n} foreach &#40;@headers&#41;;
     print $ch &#34;int main&#40;void&#41; { &#34;.&#40;$args{function} || &#39;return 0;&#39;&#41;.&#34; }\n&#34;;
     close&#40;$ch&#41;;
-    for my $lib &#40; @libs &#41; {
+    for my $link_cfg &#40; @link_cfgs &#41; {
+	my &#40;$paths, $libs&#41; = @$link_cfg;
         my $exefile = File::Temp::mktemp&#40; &#39;assertlibXXXXXXXX&#39; &#41; . $Config{_exe};
         my @sys_cmd;
         if &#40; $Config{cc} eq &#39;cl&#39; &#41; {                 # Microsoft compiler
@@ -275,20 +283,20 @@
             @sys_cmd = &#40;
                 @cc,
                 $cfile,
-                &#34;${lib}.lib&#34;,
+                &#40; map { &#34;$_.lib&#34; } @$libs &#41;,
                 &#34;/Fe$exefile&#34;, 
                 &#40;map { &#39;/I&#39;.Win32::GetShortPathName&#40;$_&#41; } @incpaths&#41;,
                 &#34;/link&#34;,
-                &#40;map {&#39;/libpath:&#39;.Win32::GetShortPathName&#40;$_&#41;} @libpaths&#41;,
+                &#40;map {&#39;/libpath:&#39;.Win32::GetShortPathName&#40;$_&#41;} @$paths&#41;,
             &#41;;
         } elsif&#40;$Config{cc} eq &#39;CC/DECC&#39;&#41; {          # VMS
         } elsif&#40;$Config{cc} =~ /bcc32&#40;\.exe&#41;?/&#41; {    # Borland
             @sys_cmd = &#40;
                 @cc,
                 &#34;-o$exefile&#34;,
-                &#34;-l$lib&#34;,
+                &#40;map { &#34;-l$_&#34; } @$libs &#41;,
                 &#40;map { &#34;-I$_&#34; } @incpaths&#41;,
-                &#40;map { &#34;-L$_&#34; } @libpaths&#41;,
+                &#40;map { &#34;-L$_&#34; } @$paths&#41;,
                 $cfile&#41;;
         } else {                                     # Unix-ish
                                                      # gcc, Sun, AIX &#40;gcc, cc&#41;
@@ -296,15 +304,15 @@
                 @cc,
                 $cfile,
                 &#34;-o&#34;, &#34;$exefile&#34;,
-                &#34;-l$lib&#34;,
+                &#40;map { &#34;-l$_&#34; } @$libs &#41;,
                 &#40;map { &#34;-I$_&#34; } @incpaths&#41;,
-                &#40;map { &#34;-L$_&#34; } @libpaths&#41;
+                &#40;map { &#34;-L$_&#34; } @$paths&#41;
             &#41;;
         }
         warn &#34;# @sys_cmd\n&#34; if $args{debug};
         my $rv = $args{debug} ? system&#40;@sys_cmd&#41; : _quiet_system&#40;@sys_cmd&#41;;
-        push @missing, $lib if $rv != 0 || ! -x $exefile;
-        push @wrongresult, $lib if $rv == 0 &#38;&#38; -x $exefile &#38;&#38; system&#40;File::Spec-&gt;rel2abs&#40;$exefile&#41;&#41; != 0; 
+        push @missing, @$libs if $rv != 0 || ! -x $exefile;
+        push @wrongresult, @$libs if $rv == 0 &#38;&#38; -x $exefile &#38;&#38; system&#40;File::Spec-&gt;rel2abs&#40;$exefile&#41;&#41; != 0; 
         _cleanup_exe&#40;$exefile&#41;;
     } 
     unlink $cfile;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-814966" href="/Public/Bug/Display.html?id=60176#txn-814966">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;09&nbsp;09:00:17&nbsp;2010</span>
    <span class="description">TONYC [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-814967" href="/Public/Bug/Display.html?id=60176#txn-814967">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;09&nbsp;09:03:03&nbsp;2010</span>
    <span class="description">TONYC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [PATCH] no way to test with dependent libraries</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/814967/422311/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/422311">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 239b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Patch: make LIBS act like EU::MM when supplied as an array ref, but
backward compatibly when supplied as a scalar.

This should retain backward compability.

This is the patch within the Imager dev tree, so the base directory is a
bit off.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> dc-compat.diff</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/814967/422312/dc-compat.diff">Download dc-compat.diff</a><br />
<span class="downloadcontenttype">text/x-diff 3.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: Devel/CheckLib.pm
===================================================================
--- Devel/CheckLib.pm	&#40;revision 1785&#41;
+++ Devel/CheckLib.pm	&#40;revision 1788&#41;
@@ -185,6 +185,11 @@
     @incpaths = &#40;ref&#40;$args{incpath}&#41; ? @{$args{incpath}} : $args{incpath}&#41; 
         if $args{incpath};
 
+    # each entry is an arrayref containing:
+    # 0: arrayref of library search paths
+    # 1: arrayref of library names
+    my @link_cfgs = map [ \@libpaths, [ $_ ] ], @libs;
+
     # work-a-like for Makefile.PL&#39;s LIBS and INC arguments
     # if given as command-line argument, append to %args
     for my $arg &#40;@ARGV&#41; {
@@ -197,13 +202,25 @@
             }
         }
     }
-
     # using special form of split to trim whitespace
     if&#40;defined&#40;$args{LIBS}&#41;&#41; {
-        foreach my $arg &#40;split&#40;&#39; &#39;, $args{LIBS}&#41;&#41; {
-            die&#40;&#34;LIBS argument badly-formed: $arg\n&#34;&#41; unless&#40;$arg =~ /^-l/i&#41;;
-            push @{$arg =~ /^-l/ ? \@libs : \@libpaths}, substr&#40;$arg, 2&#41;;
-        }
+        if &#40;ref $args{LIBS}&#41; {
+	    foreach my $arg &#40;@{$args{LIBS}}&#41; {
+		my @sep = split &#39; &#39;, $arg;
+		my @libs = map { /^-l&#40;.+&#41;$/ ? $1 : &#40;&#41; } @sep;
+		my @paths = map { /^-L&#40;.+&#41;$/ ? $1 : &#40;&#41; } @sep;
+		push @link_cfgs, [ \@paths, \@libs ];
+	    }
+	}
+	else {
+	    my @libs;
+	    my @paths;
+	    foreach my $arg &#40;split&#40;&#39; &#39;, $args{LIBS}&#41;&#41; {
+		die&#40;&#34;LIBS argument badly-formed: $arg\n&#34;&#41; unless&#40;$arg =~ /^-l/i&#41;;
+		push @{$arg =~ /^-l/ ? \@libs : \@paths}, substr&#40;$arg, 2&#41;;
+	    }
+	    push @link_cfgs, map [ \@paths, [ $_ ] ], @libs;
+	}
     }
     if&#40;defined&#40;$args{INC}&#41;&#41; {
         foreach my $arg &#40;split&#40;&#39; &#39;, $args{INC}&#41;&#41; {
@@ -263,7 +280,8 @@
     print $ch qq{#include &lt;$_&gt;\n} foreach &#40;@headers&#41;;
     print $ch &#34;int main&#40;void&#41; { &#34;.&#40;$args{function} || &#39;return 0;&#39;&#41;.&#34; }\n&#34;;
     close&#40;$ch&#41;;
-    for my $lib &#40; @libs &#41; {
+    for my $link_cfg &#40; @link_cfgs &#41; {
+	my &#40;$paths, $libs&#41; = @$link_cfg;
         my $exefile = File::Temp::mktemp&#40; &#39;assertlibXXXXXXXX&#39; &#41; . $Config{_exe};
         my @sys_cmd;
         if &#40; $Config{cc} eq &#39;cl&#39; &#41; {                 # Microsoft compiler
@@ -275,20 +293,20 @@
             @sys_cmd = &#40;
                 @cc,
                 $cfile,
-                &#34;${lib}.lib&#34;,
+                &#40; map { &#34;$_.lib&#34; } @$libs &#41;,
                 &#34;/Fe$exefile&#34;, 
                 &#40;map { &#39;/I&#39;.Win32::GetShortPathName&#40;$_&#41; } @incpaths&#41;,
                 &#34;/link&#34;,
-                &#40;map {&#39;/libpath:&#39;.Win32::GetShortPathName&#40;$_&#41;} @libpaths&#41;,
+                &#40;map {&#39;/libpath:&#39;.Win32::GetShortPathName&#40;$_&#41;} @$paths&#41;,
             &#41;;
         } elsif&#40;$Config{cc} eq &#39;CC/DECC&#39;&#41; {          # VMS
         } elsif&#40;$Config{cc} =~ /bcc32&#40;\.exe&#41;?/&#41; {    # Borland
             @sys_cmd = &#40;
                 @cc,
                 &#34;-o$exefile&#34;,
-                &#34;-l$lib&#34;,
+                &#40;map { &#34;-l$_&#34; } @$libs &#41;,
                 &#40;map { &#34;-I$_&#34; } @incpaths&#41;,
-                &#40;map { &#34;-L$_&#34; } @libpaths&#41;,
+                &#40;map { &#34;-L$_&#34; } @$paths&#41;,
                 $cfile&#41;;
         } else {                                     # Unix-ish
                                                      # gcc, Sun, AIX &#40;gcc, cc&#41;
@@ -296,15 +314,15 @@
                 @cc,
                 $cfile,
                 &#34;-o&#34;, &#34;$exefile&#34;,
-                &#34;-l$lib&#34;,
+                &#40;map { &#34;-l$_&#34; } @$libs &#41;,
                 &#40;map { &#34;-I$_&#34; } @incpaths&#41;,
-                &#40;map { &#34;-L$_&#34; } @libpaths&#41;
+                &#40;map { &#34;-L$_&#34; } @$paths&#41;
             &#41;;
         }
         warn &#34;# @sys_cmd\n&#34; if $args{debug};
         my $rv = $args{debug} ? system&#40;@sys_cmd&#41; : _quiet_system&#40;@sys_cmd&#41;;
-        push @missing, $lib if $rv != 0 || ! -x $exefile;
-        push @wrongresult, $lib if $rv == 0 &#38;&#38; -x $exefile &#38;&#38; system&#40;File::Spec-&gt;rel2abs&#40;$exefile&#41;&#41; != 0; 
+        push @missing, @$libs if $rv != 0 || ! -x $exefile;
+        push @wrongresult, @$libs if $rv == 0 &#38;&#38; -x $exefile &#38;&#38; system&#40;File::Spec-&gt;rel2abs&#40;$exefile&#41;&#41; != 0; 
         _cleanup_exe&#40;$exefile&#41;;
     } 
     unlink $cfile;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-815479" href="/Public/Bug/Display.html?id=60176#txn-815479">#</a>      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;10&nbsp;18:40:19&nbsp;2010</span>
    <span class="description">dcantrell [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/815479/422511/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/422511">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 115b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks.  I&#39;ll apply this.  However, I can&#39;t promise when I&#39;ll release it, as I also have some 
Windows bugs to fix.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.426465</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
