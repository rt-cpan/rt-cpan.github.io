<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #1256 for MailTools: MailTools having trouble parsing certain messages</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #1256 for MailTools: MailTools having trouble parsing certain messages</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/MailTools/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/MailTools/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/MailTools/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/MailTools/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/MailTools">MailTools CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">1256</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/MailTools/Active/">MailTools</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">MARKOV [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
mgrommet [...] yahoo.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-20244-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.47    </td>
  </tr>
  <tr id="CF-20245-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;08&nbsp;18:05:43&nbsp;2002</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> MailTools having trouble parsing certain messages</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve been using MailTools for quite some time with great success... I have constructed a mail parser for a client that strips attachments and scans for particular words and phrases... all has worked fine forever, until today when a couple of messages came into the system that were unparsable for some reason...

I know for a fact I need to tweak my debugging, but you might want to evaluate your parsing algorithms to see what funkiness might be going on here...  perhaps its something you want to handle, perhaps not.

If I do a print_header on the mailObj, I get this output:
Received: by 63.226.106.1 with Microsoft Outlook Express 5.50.4522.1200id &lt;P167413608064HER24&gt;; Tue, 2 Jul 2002 18:36:33 -0700
Message-Id: &lt;E167413608064AR3ZPZXH0DA1YOJ@63.226.106.1&gt;
Date: Tue, 2 Jul 2002 18:36:33 -0700



Here is the mail &#40;yeah, its spam, but its an example&#41;
---- snip ----
Received: by 63.226.106.1 with Microsoft Outlook Express 5.50.4522.1200id &lt;P167413608064HER24&gt;; Tue, 2 Jul 2002 18:36:33 -0700
Message-ID: &lt;E167413608064AR3ZPZXH0DA1YOJ@63.226.106.1&gt;
Date: Tue, 2 Jul 2002 18:36:33 -0700
X Mailer: Microsoft Outlook Express 5.50.4522.1200
From: &#34;Monica Jay&#34; &lt;monicajay@earthlink.net&gt;
To: a-zfinacial@sigmarep.com
Subject: just check it out
MIME-Version: 1.0
Content-Type: multipart/alternative;boundary=&#34;----= NextPart 000 0008 01C1FDE6.BC3E7600&#34;
X-RAVMilter-Version: 8.3.0&#40;snapshot 20010925&#41; &#40;sigmamail.elucidations.net&#41;

Teen Portal presents:                              ..............................................
For Those About The TEENS.
Find exactly what you want to. For Free...
If you recieved this email in error, please visit our Don&#39;t Email Me page
      TEENS_TEENS _TEENS_
      ARE READY TO GET D_I_R_T_Y   N_A_S_T_Y FOR FREE!  DON&#39;T MISS OUT ON THE BEST TEENS VIDEO &#38; PICS FREE SITES &#38; GALLERIES COLLECTION!
      PICS GALLERIES &gt; MOVIES &gt; LIVE FEEDS &gt; ~MAKE FRIENDS~
      FREE A_D_U_L_T CONTENT! TONS OF PICS. NO CREDIT CARD REQUIRED.  TEEN PORTAL WIIL HELP YOU TO FIND EXACTLY WHAT YOU WANT FROM 1000&#39;S _A_D_U_L_T_ SITES ON THE NET!
      WARNING! This site contains _s_e_x_u_a_l_l_y_ oriented _a_d_u_l_t_ material intended for individuals 18 years of age or older and of legal age to view sexually explicit material as determined by the local and national laws of the region in which you reside. If you are not yet 18, if _a_d_u_l_t_ material offends you, or if you are from any country where _a_d_u_l_t_ material is specifically prohibited by law, do not enter this site and remove this message.


If you recieved this email in error, please visit our Don&#39;t Email Me page.
Your email address will be immediately removed from the mailing list.
-------------------------





** An attachment named &lt; msg-30676-2.html &gt; was removed.
</div></div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;26&nbsp;01:58:28&nbsp;2002</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike Grommet</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">More information on this:  

Apparently its having trouble parsing the Recieved: part of the mail 
header... if I take an example &#40;such as the one below&#41; and combine the 
Recieved Header back to one line, everything seems to parse fine...

Using unfold on the mail object seems to have no affect on this.

[guest - Mon Jul  8 18:05:43 2002]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve been using MailTools for quite some time with great success... I
&gt;    have constructed a mail parser for a client that strips attachments
&gt;    and scans for particular words and phrases... all has worked fine
&gt;    forever, until today when a couple of messages came into the system
&gt;    that were unparsable for some reason...
&gt; 
&gt; I know for a fact I need to tweak my debugging, but you might want to
&gt;    evaluate your parsing algorithms to see what funkiness might be
&gt;    going on here...  perhaps its something you want to handle, perhaps
&gt;    not.
&gt; 
&gt; If I do a print_header on the mailObj, I get this output:
&gt; Received: by 63.226.106.1 with Microsoft Outlook Express
&gt;    5.50.4522.1200id &lt;P167413608064HER24&gt;; Tue, 2 Jul 2002 18:36:33
&gt;    -0700
&gt; Message-Id: &lt;E167413608064AR3ZPZXH0DA1YOJ@63.226.106.1&gt;
&gt; Date: Tue, 2 Jul 2002 18:36:33 -0700
&gt; 
&gt; 
&gt; 
&gt; Here is the mail &#40;yeah, its spam, but its an example&#41;
&gt; ---- snip ----
&gt; Received: by 63.226.106.1 with Microsoft Outlook Express
&gt;    5.50.4522.1200id &lt;P167413608064HER24&gt;; Tue, 2 Jul 2002 18:36:33
&gt;    -0700
&gt; Message-ID: &lt;E167413608064AR3ZPZXH0DA1YOJ@63.226.106.1&gt;
&gt; Date: Tue, 2 Jul 2002 18:36:33 -0700
&gt; X Mailer: Microsoft Outlook Express 5.50.4522.1200
&gt; From: &#34;Monica Jay&#34; &lt;monicajay@earthlink.net&gt;
&gt; To: a-zfinacial@sigmarep.com
&gt; Subject: just check it out
&gt; MIME-Version: 1.0
&gt; Content-Type: multipart/alternative;boundary=&#34;----= NextPart 000 0008
&gt;    01C1FDE6.BC3E7600&#34;
&gt; X-RAVMilter-Version: 8.3.0&#40;snapshot 20010925&#41;
&gt;    &#40;sigmamail.elucidations.net&#41;
&gt; 
&gt; Teen Portal presents:
&gt;    ..............................................
&gt; For Those About The TEENS.
&gt; Find exactly what you want to. For Free...
&gt; If you recieved this email in error, please visit our Don&#39;t Email Me
&gt;    page
&gt;       TEENS_TEENS _TEENS_
&gt;       ARE READY TO GET D_I_R_T_Y   N_A_S_T_Y FOR FREE!  DON&#39;T MISS OUT
&gt;    ON THE BEST TEENS VIDEO &#38; PICS FREE SITES &#38; GALLERIES COLLECTION!
&gt;       PICS GALLERIES &gt; MOVIES &gt; LIVE FEEDS &gt; ~MAKE FRIENDS~
&gt;       FREE A_D_U_L_T CONTENT! TONS OF PICS. NO CREDIT CARD REQUIRED.
&gt;    TEEN PORTAL WIIL HELP YOU TO FIND EXACTLY WHAT YOU WANT FROM 1000&#39;S
&gt;    _A_D_U_L_T_ SITES ON THE NET!
&gt;       WARNING! This site contains _s_e_x_u_a_l_l_y_ oriented
&gt;    _a_d_u_l_t_ material intended for individuals 18 years of age or
&gt;    older and of legal age to view sexually explicit material as
&gt;    determined by the local and national laws of the region in which
&gt;    you reside. If you are not yet 18, if _a_d_u_l_t_ material offends
&gt;    you, or if you are from any country where _a_d_u_l_t_ material is
&gt;    specifically prohibited by law, do not enter this site and remove
&gt;    this message.
&gt; 
&gt; 
&gt; If you recieved this email in error, please visit our Don&#39;t Email Me
&gt;    page.
&gt; Your email address will be immediately removed from the mailing list.
&gt; -------------------------
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; ** An attachment named &lt; msg-30676-2.html &gt; was removed.
</div></div></div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;01&nbsp;11:15:31&nbsp;2002</span>
    <span class="description">MARKOV [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;01&nbsp;11:23:29&nbsp;2002</span>
    <span class="description">MARKOV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[guest - Fri Jul 26 01:58:28 2002]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &gt; If I do a print_header on the mailObj, I get this output:
&gt; &gt; Received: by 63.226.106.1 with Microsoft Outlook Express
&gt; &gt;    5.50.4522.1200id &lt;P167413608064HER24&gt;; Tue, 2 Jul 2002 18:36:33
&gt; &gt;    -0700
&gt; &gt; Message-Id: &lt;E167413608064AR3ZPZXH0DA1YOJ@63.226.106.1&gt;
&gt; &gt; Date: Tue, 2 Jul 2002 18:36:33 -0700
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &gt; Here is the mail &#40;yeah, its spam, but its an example&#41;
&gt; &gt; ---- snip ----
&gt; &gt; Received: by 63.226.106.1 with Microsoft Outlook Express
&gt; &gt;    5.50.4522.1200id &lt;P167413608064HER24&gt;; Tue, 2 Jul 2002 18:36:33
&gt; &gt;    -0700
&gt; &gt; Message-ID: &lt;E167413608064AR3ZPZXH0DA1YOJ@63.226.106.1&gt;
&gt; &gt; Date: Tue, 2 Jul 2002 18:36:33 -0700
&gt; &gt; X Mailer: Microsoft Outlook Express 5.50.4522.1200
&gt; &gt; [SNIP]
</div>
As you can see, the parser stopped at the line:  &#39;X Mailer&#39;
The parser is right, because this is not a valid header line: there
must be a dash &#39;-&#39; i.s.o. the blank:  X-Mailer

Software can handle this error two ways: or ignore the erroneous
lines and continue until a blank line as end-of-header, or take the
first failing header line as start for the body of the message.
MailTools &#40;and Mail::Box for the sake&#41; implement the second approach,
which at least does not throw away information when the message is
printed as a whole....
--
   MarkOv     mailtools@overmeer.net
</div></div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;01&nbsp;11:23:30&nbsp;2002</span>
    <span class="description">MARKOV [...] cpan.org -  Status changed from &#39;new&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
