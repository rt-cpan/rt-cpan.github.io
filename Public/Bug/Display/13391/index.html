<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #13391 for JavaScript-SpiderMonkey: Modifications to allow perl mapped functions to return useful values</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #13391 for JavaScript-SpiderMonkey: Modifications to allow perl mapped functions to return useful values</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/JavaScript-SpiderMonkey/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/JavaScript-SpiderMonkey/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/JavaScript-SpiderMonkey/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/JavaScript-SpiderMonkey/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/JavaScript-SpiderMonkey">JavaScript-SpiderMonkey CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">13391</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/JavaScript-SpiderMonkey/Active/">JavaScript-SpiderMonkey</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
marc [...] igneousconsulting.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-17580-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
0.08</li>
<li>
0.10</li>
<li>
0.11</li>
</ul>
    </td>
  </tr>
  <tr id="CF-17581-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




JavaScript-SpiderMonkey-0.12.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/134910/36502/JavaScript-SpiderMonkey-0.12.patch">
Thu Jun 23 13:32:18 2005 (8.3k) by 
</a>
</font></li>
</ul>


JavaScript-SpiderMonkey-0.15-patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/206822/79242/JavaScript-SpiderMonkey-0.15-patch">
Sun Jun 11 05:42:39 2006 (6.9k) by agentzh [...] yahoo.cn
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;23&nbsp;13:32:17&nbsp;2005</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Modifications to allow perl mapped functions to return useful values</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Attached is a patch that will allow, mapped perl functions to return varied datatypes back to jscript.  Int&#39;s, Floats &#40;doubles&#41;, and strings can now all be returned.  It seems to work well for the cases I need it to, although others mileage may vary.  The advantage for this is that now you can write your javascript to call perl functions which can do work and get results that you never could have gotten by using the standard jscript library of functions.
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -urN JavaScript-SpiderMonkey-0.11/SpiderMonkey.xs JavaScript-SpiderMonkey-0.12/SpiderMonkey.xs
--- JavaScript-SpiderMonkey-0.11/SpiderMonkey.xs	2004-08-22 19:36:51.000000000 -0400
+++ JavaScript-SpiderMonkey-0.12/SpiderMonkey.xs	2005-06-23 11:51:10.581767304 -0400
@@ -130,6 +130,11 @@
 /* --------------------------------------------------------------------- */
     dSP; 
     SV         *sv;
+    SV         *nsv;
+    char        *n_jstr;
+    STRLEN      len;
+    int         n_jnum;
+    double      n_jdbl;
     unsigned    i;
     int         count;
     JSFunction *fun;
@@ -154,18 +159,59 @@
     count = call_pv&#40;&#34;JavaScript::SpiderMonkey::function_dispatcher&#34;, G_SCALAR&#41;;
     SPAGAIN;
 
+    /* This section modified by Marc Relation &#40;marc@igneousconsulting.com&#41;
+     * on behalf of Compendium Research Corporation &#40;www.compendium-research.com&#41;
+     */
+
     if&#40; count &gt; 0&#41; {
         sv = POPs;        
-        if&#40;SvIOK&#40;sv&#41;&#41; {
+        if&#40;SvROK&#40;sv&#41;&#41; {
+            /* Im getting a perl reference here, the user
+             * seems to want to send a perl object to jscript
+             * ok, we will do it, although it seems like a painful
+             * thing to me.
+             */
             if&#40;Debug&#41;
-                fprintf&#40;stderr, &#34;DEBUG: %lx is an IV\n&#34;, &#40;long&#41; sv&#41;;
-            *rval = OBJECT_TO_JSVAL&#40;SvIV&#40;sv&#41;&#41;;
-        } else {
+                fprintf&#40;stderr, &#34;DEBUG: %lx is a ref!\n&#34;, &#40;long&#41; sv&#41;;
+            *rval = OBJECT_TO_JSVAL&#40;SvIV&#40;SvRV&#40;sv&#41;&#41;&#41;;
+        }
+        else if&#40;SvIOK&#40;sv&#41;&#41; {
+            /* It appears that we have been sent an int return
+             * value.  Thats fine we can give javascript an int
+             */
+            n_jnum=SvIV&#40;sv&#41;;
+            if&#40;Debug&#41;
+                fprintf&#40;stderr, &#34;DEBUG: %lx is an int &#40;%d&#41;\n&#34;, &#40;long&#41; sv,n_jnum&#41;;
+            *rval = INT_TO_JSVAL&#40;n_jnum&#41;;
+        } else if&#40;SvNOK&#40;sv&#41;&#41; {
+            /* It appears that we have been sent an double return
+             * value.  Thats fine we can give javascript an double
+             */
+            n_jdbl=SvNV&#40;sv&#41;;
             if&#40;Debug&#41; 
-                fprintf&#40;stderr, &#34;DEBUG: %lx is a string\n&#34;, &#40;long&#41; sv&#41;;
-            *rval = STRING_TO_JSVAL&#40;SvPV&#40;sv, PL_na&#41;&#41;;
+                fprintf&#40;stderr, &#34;DEBUG: %lx is a double&#40;%f&#41;\n&#34;, &#40;long&#41; sv,n_jdbl&#41;;
+            *rval = DOUBLE_TO_JSVAL&#40;JS_NewDouble&#40;cx, n_jdbl&#41;&#41;;
+        } else if&#40;SvPOK&#40;sv&#41;&#41; {
+            // THIS IS tricky... we are either a string or an object....
+            // how to tell how to tell......
+            if&#40;strcmp&#40;SvPV&#40;sv,len&#41;,&#34;[undef]&#34;&#41;==0&#41;{
+                *rval = STRING_TO_JSVAL&#40;SvPV&#40;sv, PL_na&#41;&#41;;
+            }else{
+                /* It appears that we have been sent a string return
+                 * value.  Thats fine we can give javascript a string
+                 */
+                nsv = SvREFCNT_inc&#40;sv&#41;;
+                n_jstr=SvPV&#40;nsv,len&#41;;
+                if&#40;Debug&#41; 
+                    fprintf&#40;stderr, &#34;DEBUG: %lx is a string&#40;%s&#41; of length %d\n&#34;, &#40;long&#41; sv,n_jstr,len&#41;;
+                *rval = STRING_TO_JSVAL&#40;JS_NewString&#40;cx, n_jstr, len&#41;&#41;;
+            }
+        } else {
+            fprintf&#40;stderr, &#34;UNKNOWN TYPE GOODBYE....\n&#34;&#41;; 
+            *rval = BOOLEAN_TO_JSVAL&#40;0&#41;;
         }
     }
+    /* End of Modifications By Marc */
 
     PUTBACK;
     FREETMPS;
diff -urN JavaScript-SpiderMonkey-0.11/t/007funcret.t JavaScript-SpiderMonkey-0.12/t/007funcret.t
--- JavaScript-SpiderMonkey-0.11/t/007funcret.t	2004-06-20 17:16:16.000000000 -0400
+++ JavaScript-SpiderMonkey-0.12/t/007funcret.t	2005-06-23 11:47:59.233856608 -0400
@@ -29,7 +29,10 @@
 $js-&gt;property_by_path&#40;&#39;fooobj.style&#39; &#41;;
 $js-&gt;function_set&#40; &#39;getElementById&#39;, sub {
     if&#40;exists $JavaScript::SpiderMonkey::GLOBAL-&gt;{objects}-&gt;{&#39;fooobj&#39;}&#41; {
-        return ${$JavaScript::SpiderMonkey::GLOBAL-&gt;{objects}-&gt;{&#39;fooobj&#39;}};
+        # This line has been modified to not return a ref because returning
+        # the ref makes it impossible to distinguish from an int in xs.
+        # -Marc
+        return $JavaScript::SpiderMonkey::GLOBAL-&gt;{objects}-&gt;{&#39;fooobj&#39;};
     }
 }, $doc&#41;;
 $js-&gt;function_set&#40;&#34;write&#34;, sub { 
diff -urN JavaScript-SpiderMonkey-0.11/t/11intret.t JavaScript-SpiderMonkey-0.12/t/11intret.t
--- JavaScript-SpiderMonkey-0.11/t/11intret.t	1969-12-31 19:00:00.000000000 -0500
+++ JavaScript-SpiderMonkey-0.12/t/11intret.t	2005-06-23 11:53:24.139463448 -0400
@@ -0,0 +1,29 @@
+######################################################################
+# Testcase:     Returning integer values from perl 
+# Revision:     $Revision:$
+# Last Checkin: $Date:$
+# By:           $Author:$
+#
+# Author:       Marc Relation marc@igneousconsulting.com
+######################################################################
+
+use warnings;
+use strict;
+
+print &#34;1..1\n&#34;;
+
+use JavaScript::SpiderMonkey;
+
+my $js=new JavaScript::SpiderMonkey;
+my $buffer;
+$js-&gt;init;
+$js-&gt;function_set&#40;&#39;get_int&#39;,sub {return&#40;1000&#41;;}&#41;;
+$js-&gt;function_set&#40;&#39;get_float&#39;,sub {return&#40;10.21&#41;;}&#41;;
+$js-&gt;function_set&#40;&#39;booltest&#39;,sub {return 1==$_[0];}&#41;;
+#$js-&gt;function_set&#40;&#39;write&#39;,sub {print STDERR $_[0] . &#34;\n&#34;}&#41;;
+$js-&gt;function_set&#40;&#34;write&#34;,sub { $buffer .= join&#40;&#39;&#39;, @_&#41; }&#41;;
+$js-&gt;eval&#40;&#34;write&#40;get_int&#40;&#41;+1&#41;;&#34;&#41;;
+$js-&gt;destroy;
+# Check buffer from document.write&#40;&#41;
+print &#34;not &#34; unless $buffer == 1001;
+print &#34;ok 1\n&#34;;
diff -urN JavaScript-SpiderMonkey-0.11/t/12dblret.t JavaScript-SpiderMonkey-0.12/t/12dblret.t
--- JavaScript-SpiderMonkey-0.11/t/12dblret.t	1969-12-31 19:00:00.000000000 -0500
+++ JavaScript-SpiderMonkey-0.12/t/12dblret.t	2005-06-23 11:54:16.671477368 -0400
@@ -0,0 +1,25 @@
+######################################################################
+# Testcase:     Returning double values from perl 
+# Revision:     $Revision:$
+# Last Checkin: $Date:$
+# By:           $Author:$
+#
+# Author:       Marc Relation marc@igneousconsulting.com
+######################################################################
+
+use warnings;
+use strict;
+
+print &#34;1..1\n&#34;;
+use JavaScript::SpiderMonkey;
+
+my $js=new JavaScript::SpiderMonkey;
+my $buffer;
+$js-&gt;init;
+$js-&gt;function_set&#40;&#39;get_double&#39;,sub {return&#40;10.21&#41;;}&#41;;
+$js-&gt;function_set&#40;&#34;write&#34;,sub { $buffer .= join&#40;&#39;&#39;, @_&#41; }&#41;;
+$js-&gt;eval&#40;&#34;write&#40;get_double&#40;&#41;+1.2&#41;;&#34;&#41;;
+$js-&gt;destroy;
+# Check buffer from document.write&#40;&#41;
+print &#34;not &#34; unless $buffer == 11.41;
+print &#34;ok 1\n&#34;;
diff -urN JavaScript-SpiderMonkey-0.11/t/13strret.t JavaScript-SpiderMonkey-0.12/t/13strret.t
--- JavaScript-SpiderMonkey-0.11/t/13strret.t	1969-12-31 19:00:00.000000000 -0500
+++ JavaScript-SpiderMonkey-0.12/t/13strret.t	2005-06-23 11:54:33.015992624 -0400
@@ -0,0 +1,26 @@
+######################################################################
+# Testcase:     Returning string values from perl 
+# Revision:     $Revision:$
+# Last Checkin: $Date:$
+# By:           $Author:$
+#
+# Author:       Marc Relation marc@igneousconsulting.com
+######################################################################
+
+use warnings;
+use strict;
+
+print &#34;1..1\n&#34;;
+use JavaScript::SpiderMonkey;
+
+my $js=new JavaScript::SpiderMonkey;
+my $buffer;
+$js-&gt;init;
+$js-&gt;function_set&#40;&#39;get_string&#39;,sub {return&#40;&#34;John Doe&#34;&#41;;}&#41;;
+#$js-&gt;function_set&#40;&#39;write&#39;,sub {print STDERR $_[0] . &#34;\n&#34;}&#41;;
+$js-&gt;function_set&#40;&#34;write&#34;,sub { $buffer .= join&#40;&#39;&#39;, @_&#41; }&#41;;
+$js-&gt;eval&#40;&#34;write&#40;get_string&#40;&#41;+&#39; who&#39;&#41;;&#34;&#41;;
+$js-&gt;destroy;
+# Check buffer from document.write&#40;&#41;
+print &#34;not &#34; unless $buffer eq &#39;John Doe who&#39;;
+print &#34;ok 1\n&#34;;
diff -urN JavaScript-SpiderMonkey-0.11/t/testsm.pl JavaScript-SpiderMonkey-0.12/t/testsm.pl
--- JavaScript-SpiderMonkey-0.11/t/testsm.pl	1969-12-31 19:00:00.000000000 -0500
+++ JavaScript-SpiderMonkey-0.12/t/testsm.pl	2005-06-09 09:03:04.000000000 -0400
@@ -0,0 +1,27 @@
+#!/usr/bin/perl
+use strict;
+
+use JavaScript::SpiderMonkey;
+use Data::Dumper;
+
+my $js=new JavaScript::SpiderMonkey;
+$js-&gt;init;
+$js-&gt;function_set&#40;&#39;get_user_name&#39;,sub {return&#40;&#34;John Doe&#34;&#41;;}&#41;;
+$js-&gt;function_set&#40;&#39;addem&#39;,sub {
+    my $ret=0;
+    foreach&#40;@_&#41;
+    {
+        $ret+=$_; 
+    }
+    return $ret;
+}&#41;;
+$js-&gt;function_set&#40;&#39;get_user_id&#39;,sub {return&#40;1000&#41;;}&#41;;
+$js-&gt;function_set&#40;&#39;get_float&#39;,sub {return&#40;10.21&#41;;}&#41;;
+$js-&gt;function_set&#40;&#39;booltest&#39;,sub {return 1==$_[0];}&#41;;
+$js-&gt;function_set&#40;&#39;write&#39;,sub {print STDERR $_[0] . &#34;\n&#34;}&#41;;
+
+
+
+$js-&gt;eval&#40;&#34;write&#40;&#39;abc&#39;&#41;;var z=get_user_name&#40;&#41;;write&#40;&#39;def&#39;&#41;;write&#40;z&#41;;write&#40;z+&#39; who&#39;&#41;;write&#40;&#39;abc&#39;&#41;;k=get_user_id&#40;&#41;;write&#40;1+k+1&#41;;var a=addem&#40;1,5,7&#41;;write&#40;a&#41;;var b=get_float&#40;&#41;;write&#40;b+1.1&#41;;if&#40;booltest&#40;1&#41;&#41;{write&#40;&#39;true&#39;&#41;;}else{write&#40;&#39;false&#39;&#41;;};if&#40;booltest&#40;0&#41;&#41;{write&#40;&#39;true&#39;&#41;;}else{write&#40;&#39;false&#39;&#41;;}&#34;&#41;;
+$js-&gt;destroy;
+1;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;23&nbsp;13:35:21&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> marc [...] igneousconsulting.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">forgot to add that the patch is to be applied to
JavaScript-SpiderMonkey-0.11.tar.gz
eg.

mtr@zeus:~/sm/test$ ls
JavaScript-SpiderMonkey-0.11.tar.gz  JavaScript-SpiderMonkey-0.12.patch  js
mtr@zeus:~/sm/test$ tar -zxf JavaScript-SpiderMonkey-0.11.tar.gz 
mtr@zeus:~/sm/test$ patch -p0 &lt; JavaScript-SpiderMonkey-0.12.patch 
patching file JavaScript-SpiderMonkey-0.11/SpiderMonkey.xs
patching file JavaScript-SpiderMonkey-0.11/t/007funcret.t
patching file JavaScript-SpiderMonkey-0.11/t/11intret.t
patching file JavaScript-SpiderMonkey-0.11/t/12dblret.t
patching file JavaScript-SpiderMonkey-0.11/t/13strret.t
patching file JavaScript-SpiderMonkey-0.11/t/testsm.pl
mtr@zeus:~/sm/test$ 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;11&nbsp;05:42:39&nbsp;2006</span>
    <span class="description">agentzh [...] yahoo.cn -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Agent Zhang</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jun 23 13:32:17 2005, guest wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Attached is a patch that will allow, mapped perl functions to return
&gt;    varied datatypes back to jscript.  Int&#39;s, Floats &#40;doubles&#41;, and
&gt;    strings can now all be returned.  It seems to work well for the
&gt;    cases I need it to, although others mileage may vary.  The
&gt;    advantage for this is that now you can write your javascript to
&gt;    call perl functions which can do work and get results that you
&gt;    never could have gotten by using the standard jscript library of
&gt;    functions.
</div>

Marc Relation&#39;s patch can&#39;t directly apply to SpiderMonkey-0.15 atop
ActivePerl 5.8.7 and js-1.5 here. So I modified his patch a bit and made
0.15 work on my machine now. In theory, it also readily works on other
platforms IMHO.

My patch is more like a hack than a real fix. Anyway it works at least
for me. Hopefully the authors of this module will end up with a better
solution in the next release soon.

Cheers.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/206822/79242/JavaScript-SpiderMonkey-0.15-patch">Download JavaScript-SpiderMonkey-0.15-patch</a><br />
<span class="downloadcontenttype">application/octet-stream 6.9k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;11&nbsp;05:42:40&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;12&nbsp;06:02:37&nbsp;2006</span>
    <span class="description">tbusch [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #13391] Modifications to allow perl mapped functions to return useful values</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 12 Jun 2006 12:09:11 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-JavaScript-SpiderMonkey [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Thomas Busch &lt;tbusch [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

thanks for the patch. Before continuing I want to make 
sure the compiling part works well. It seems when
compiling in ActivePerl it doesn&#39;t find $JS_LIB_DIR.
This should be the location of js32.dll. 
Where is js32.dll usually installed on Windows ?

Thomas.


Quoting via RT &lt;bug-JavaScript-SpiderMonkey@rt.cpan.org&gt;:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt;        Queue: JavaScript-SpiderMonkey
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=13391">http://rt.cpan.org/Ticket/Display.html?id=13391</a></span> &gt;
&gt; 
&gt; On Thu Jun 23 13:32:17 2005, guest wrote:
<div class="message-stanza open">&gt; &gt; Attached is a patch that will allow, mapped perl functions to return
&gt; &gt;    varied datatypes back to jscript.  Int&#39;s, Floats &#40;doubles&#41;, and
&gt; &gt;    strings can now all be returned.  It seems to work well for the
&gt; &gt;    cases I need it to, although others mileage may vary.  The
&gt; &gt;    advantage for this is that now you can write your javascript to
&gt; &gt;    call perl functions which can do work and get results that you
&gt; &gt;    never could have gotten by using the standard jscript library of
&gt; &gt;    functions.
</div>&gt; 
&gt; 
&gt; Marc Relation&#39;s patch can&#39;t directly apply to SpiderMonkey-0.15 atop
&gt; ActivePerl 5.8.7 and js-1.5 here. So I modified his patch a bit and made
&gt; 0.15 work on my machine now. In theory, it also readily works on other
&gt; platforms IMHO.
&gt; 
&gt; My patch is more like a hack than a real fix. Anyway it works at least
&gt; for me. Hopefully the authors of this module will end up with a better
&gt; solution in the next release soon.
&gt; 
&gt; Cheers.
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;17&nbsp;07:14:17&nbsp;2006</span>
    <span class="description">thomas [...] careerjet.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">this is now resolved.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;17&nbsp;07:14:23&nbsp;2006</span>
    <span class="description">thomas [...] careerjet.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
