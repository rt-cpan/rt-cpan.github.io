<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #37624 for Template-Declare: Add Support for Wrappers</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #37624 for Template-Declare: Add Support for Wrappers</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Template-Declare/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Template-Declare/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Template-Declare/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Template-Declare/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Template-Declare">Template-Declare CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">37624</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Template-Declare/Active/">Template-Declare</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dwheeler [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-41550-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-41551-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;11&nbsp;15:16:56&nbsp;2008</span>
    <span class="description">dwheeler [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Add Support for Wrappers</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 11 Jul 2008 12:13:22 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-template-declare [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Howdy,

I&#39;ve whipped up a patch to add a new function, `wrapper`, that allows  
users to declare tag-like subs that can be used to wrap output. The  
patch is attached. It works like so:

   package MyApp::Templates;
   use Template::Declare::Tags;
   use base &#39;Template::Declare&#39;;

   BEGIN {
       wrapper wrap =&gt; sub {
           my $code = shift;
           my %params = @_;
           html {
               head { title { outs &#34;Hello, $params{user}!&#34;} };
               body {
                   $code-&gt;&#40;&#41;;
                   div { outs &#39;This is the end, my friend&#39; };
               };
           }
       };
   }

   template inner =&gt; sub {
       wrap {
           h1 { outs &#34;Hello, Jesse, s&#39;up?&#34; };
       } user =&gt; &#39;Jesse&#39;;
   };

Cool, eh? The only downside I see at this point is that the `wrap` sub  
gets installed in Template::Declare::Tags. Ideally it&#39;d just be  
installed in the caller and exported from there, but I&#39;m not sure how  
you want to handle that. This way it&#39;s just exported for every `use  
Template::Declare::Tags`, but maybe there&#39;d be some way to specify a  
wrapper set or something the way you currently specify a tagset? Let  
me know what you think.

Best,

David
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"></div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;12&nbsp;17:19:23&nbsp;2008</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #37624] AutoReply: Add Support for Wrappers </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 12 Jul 2008 14:19:05 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Template-Declare [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Jul 11, 2008, at 12:17, Bugs in Template-Declare via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Cool, eh? The only downside I see at this point is that the `wrap` sub
&gt; gets installed in Template::Declare::Tags. Ideally it&#39;d just be
&gt; installed in the caller and exported from there, but I&#39;m not sure how
&gt; you want to handle that. This way it&#39;s just exported for every `use
&gt; Template::Declare::Tags`, but maybe there&#39;d be some way to specify a
&gt; wrapper set or something the way you currently specify a tagset? Let
&gt; me know what you think.
</div>
I think I&#39;ve decided that this is a stupid idea. What I&#39;m thinking of  
doing instead is just writing a helper module that defines wrapper  
functions and import it into my template module, just like any other  
module. So the helper would look something like this:

package MyApp::Helper;
use base &#39;Exporter&#39;;
our @EXPORT = &#40;&#39;wrap&#39;&#41;;

sub wrap &#40;&#38;;@&#41; {
     my $code = shift;
     my %params = @_;
     html {
         head { title { outs &#34;Hello, $params{user}!&#34;} };
         body {
             $code-&gt;&#40;&#41;;
             div { outs &#39;This is the end, my friend&#39; };
         };
     }
};

I guess it&#39;d be okay to have some sort of wrapper module that provides  
sugar for this. Maybe something like this:

package MyApp::Helper;
use base &#39;Template::Declare::Helper&#39;;

wrapper wrap sub { ... };

But it&#39;s just sugar, and I personally don&#39;t care that much. If you&#39;re  
interested, I can go ahead and implement it and provide a patch. Or I  
guess it could be a separate distribution.

Either way, then one could just use it in a T::D module like so:

use MyApp::Helper &#39;wrap&#39;;
use Template::Declare::Tags;

template inner =&gt; sub {
     wrap {
         h1 { outs &#34;Hello, Jesse, s&#39;up?&#34; };
     } user =&gt; &#39;Jesse&#39;;
};

Or perhaps:

   use MyApp::Helper;

template inner =&gt; sub {
     show&#40; &#39;/wrap&#39; =&gt; sub {
         h1 { outs &#34;Hello, Jesse, s&#39;up?&#34; };
     }, user =&gt; &#39;Jesse&#39; &#41;;
};

But then really it&#39;s just another template that expects a sub  
argument, isn&#39;t it? Anyway, I&#39;m fine to just write my own modules for  
specific apps, as above using Exporter, but thought I&#39;d throw it out  
for you guys to chew over.

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;01&nbsp;17:19:11&nbsp;2008</span>
    <span class="description">rt.cpan [...] sartak.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Theory,

Thanks a lot for this patch. Making it easier to define wrappers is 
definitely a big win!

I really disliked the installation of wrappers in 
Template::Declare::Tags and automatically adding them to @EXPORT. It&#39;s 
too global for my taste. &#40;Template::Declare&#39;s existing globalness is my 
biggest.. nay, only, complaint against it&#41;

Having a helper module that defines your wrappers is probably best. :&#41;

Thanks again!
Shawn
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;01&nbsp;17:19:13&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;01&nbsp;17:19:14&nbsp;2008</span>
    <span class="description">rt.cpan [...] sartak.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;01&nbsp;17:41:43&nbsp;2008</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #37624] Add Support for Wrappers </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 1 Aug 2008 14:41:25 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Template-Declare [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Aug 1, 2008, at 14:19, Shawn M Moore via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Having a helper module that defines your wrappers is probably best. :&#41;
</div>
Um, so you decided to just commit my patch after all? I&#39;m really not  
sure that it&#39;s the ideal approach…

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;01&nbsp;17:41:45&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;01&nbsp;17:49:44&nbsp;2008</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Aug 01 17:41:43 2008, DWHEELER wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Um, so you decided to just commit my patch after all? I&#39;m really not  
&gt; sure that it&#39;s the ideal approach…
</div>
Oh, I see, you just stick it into the calling class. This is annoying,
though, because then it can&#39;t easily be used in any other templating
module. What it needs is some sugar to put the wrapper into an exporter
in the calling package, so that then it can be imported into other packages.

I&#39;ll take a look at doing that now…

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;01&nbsp;18:40:15&nbsp;2008</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Aug 01 17:49:44 2008, DWHEELER wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Oh, I see, you just stick it into the calling class. This is annoying,
&gt; though, because then it can&#39;t easily be used in any other templating
&gt; module. What it needs is some sugar to put the wrapper into an exporter
&gt; in the calling package, so that then it can be imported into other
</div>packages.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; I&#39;ll take a look at doing that now…
</div>
Okay, here you go. This patch is against current svn. It modifies the
behavior so that a module that defines wrappers should inherit from
Template::Declare::Wrapper. The wrapper function then tweaks the
inheritance in the calling module by shoving the new wrapper into
%EXPORT_TAGS{wrapper} and @EXPORT_OK so that they can easily be imported. 

Of course, you can still get the original behavior of an unexported,
packag-scoped wrapper by not inheriting from T::D::Wrapper and defining
your wrappers in a BEGIN block.

I think that this is a much cleaner solution, overall, although I&#39;m not
thrilled about the Exporter stuff. It&#39;s so ugly. But it works, and could
be replaced with something more robust in the future, if necessary
&#40;maybe Exporter::Tidy, which is quite nice&#41;.

Best,

David
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: t/wrappers.t
===================================================================
--- t/wrappers.t	&#40;revision 5650&#41;
+++ t/wrappers.t	&#40;working copy&#41;
@@ -1,11 +1,13 @@
 #!/usr/bin/perl
-package MyApp::Templates;
+package MyApp::Wrappers;
 use strict;
 use warnings;
 use Template::Declare::Tags;
-use base &#39;Template::Declare&#39;;
+use base &#39;Template::Declare::Wrapper&#39;;
 
 BEGIN {
+    $INC{&#39;MyApp/Wrappers.pm&#39;} = __FILE__;
+
     wrapper wrap =&gt; sub {
         my $code = shift;
         my %params = @_;
@@ -19,9 +21,24 @@
     };
 }
 
+package MyApp::Templates;
+use strict;
+use warnings;
+use Template::Declare::Tags;
+use MyApp::Wrappers &#39;:wrappers&#39;;
+use base &#39;Template::Declare&#39;;
+
+BEGIN {
+    wrapper bq =&gt; sub {
+        my $code = shift;
+        blockquote { p { $code-&gt;&#40;&#41; } };
+    };
+}
+
 template inner =&gt; sub {
     wrap {
         h1 { outs &#34;Hello, Jesse, s&#39;up?&#34; };
+        bq { outs outs &#39;Something profound&#39; }
     } user =&gt; &#39;Jesse&#39;;
 };
 
@@ -40,7 +57,9 @@
  &lt;/head&gt;
  &lt;body&gt;
   &lt;h1&gt;Hello, Jesse, s&#38;#39;up?&lt;/h1&gt;
+  &lt;blockquote&gt;
+   &lt;p&gt;Something profound&lt;/p&gt;
+  &lt;/blockquote&gt;
   &lt;div&gt;This is the end, my friend&lt;/div&gt;
  &lt;/body&gt;
 &lt;/html&gt;&#39;, &#39;Should have the wrapped output&#39;;
-
Index: lib/Template/Declare/Tags.pm
===================================================================
--- lib/Template/Declare/Tags.pm	&#40;revision 5650&#41;
+++ lib/Template/Declare/Tags.pm	&#40;working copy&#41;
@@ -276,39 +276,60 @@
 =head2 wrapper WRAPPERNAME =&gt; sub { &#39;Implementation&#39; };
 
 C&lt;wrapper&gt; declares a wrapper subroutine that can be called like a tag sub,
-but can optionally take arguments to be passed to the wrapper sub. For
-example, if you wanted to wrap all of the output of a template in the usual
-HTML headers and footers, you can do something like this:
+but can optionally take arguments to be passed to the wrapper sub. The idea is
+to declare wrappers in one or more helper modules and then use them in your
+template modules. For example, if you wanted to wrap all of the output of a
+template in the usual HTML headers and footers, you can do something like
+this:
 
+  package MyApp::Wrappers;
+  use Template::Declare::Tags;
+  use base &#39;Template::Declare::Wrapper&#39;;
+
+  wrapper wrap =&gt; sub {
+      my $code = shift;
+      my %params = @_;
+      html {
+          head { title { outs &#34;Hello, $params{user}!&#34;} };
+          body {
+              $code-&gt;&#40;&#41;;
+              div { outs &#39;This is the end, my friend&#39; };
+          };
+      }
+  };
+
+Now C&lt;use&gt; your wrapper module in a template module, passing in the special
+&#34;:wrappers&#34; tag which will import all the wrappers you&#39;ve defined in that
+module. Tempate::Declare::Wrapper is just using L&lt;Exporter|Exporter&gt;, so in
+fact you could also import your wrappers by name. Here&#39;s an example that uses
+the &#34;:wrappers&#34; tag. It also, coincidentally, creates its own, unexported
+wrapper, C&lt;bq&gt;, that can just be used in the scope of the module &#40;or by using
+the fully-qualified function name in another module&#41;:
+
   package MyApp::Templates;
+  use base &#39;Template::Declare&#39;;
+  use MyApp::Wrappers &#39;:wrappers&#39;;
   use Template::Declare::Tags;
-  use base &#39;Template::Declare&#39;;
 
   BEGIN {
-      wrapper wrap =&gt; sub {
+      wrapper bq =&gt; sub {
           my $code = shift;
-          my %params = @_;
-          html {
-              head { title { outs &#34;Hello, $params{user}!&#34;} };
-              body {
-                  $code-&gt;&#40;&#41;;
-                  div { outs &#39;This is the end, my friend&#39; };
-              };
-          }
+          blockquote { p { $code-&gt;&#40;&#41; } };
       };
   }
 
-  template inner =&gt; sub {
+  template howdy =&gt; sub {
       wrap {
           h1 { outs &#34;Hello, Jesse, s&#39;up?&#34; };
+          bq { outs &#39;Ask not what your country can do for you.&#39; }
       } user =&gt; &#39;Jesse&#39;;
   };
 
-Note how the C&lt;wrap&gt; wrapper function is available for calling after it has
-been declared in a C&lt;BEGIN&gt; block. Also note how you can pass arguments to the
-function after the closing brace &#40;you don&#39;t need a comma there!&#41;.
+Note how the C&lt;bq&gt; wrapper function is available for calling after it has been
+declared in a C&lt;BEGIN&gt; block. Also note how you can pass arguments to wrapper
+function calls after the closing brace &#40;you don&#39;t need a comma there!&#41;.
 
-The output from the &#34;inner&#34; template will look something like this:
+The output from the &#34;howdy&#34; template will look something like this:
 
   &lt;html&gt;
    &lt;head&gt;
@@ -316,6 +337,9 @@
    &lt;/head&gt;
    &lt;body&gt;
     &lt;h1&gt;Hello, Jesse, s&#38;#39;up?&lt;/h1&gt;
+    &lt;blockquote&gt;
+     &lt;p&gt;Something profound&lt;/p&gt;
+    &lt;/blockquote&gt;
     &lt;div&gt;This is the end, my friend&lt;/div&gt;
    &lt;/body&gt;
   &lt;/html&gt;
@@ -330,6 +354,21 @@
     # Shove the code ref into the calling class.
     no strict &#39;refs&#39;;
     *{&#34;$template_class\::$wrapper_name&#34;} = sub &#40;&#38;;@&#41; { goto $coderef };
+
+    # Just return unless inheriting from Wrapper.
+    return unless $template_class-&gt;isa&#40;&#39;Template::Declare::Wrapper&#39;&#41;;
+
+    # Make things exportabl from Wrapper by tweaking @EXPORT_OK and %EXPORT_TAGS.
+    if &#40;my $ok = *{&#34;$template_class\::EXPORT_OK&#34;}{ARRAY}&#41; {
+        push @{ $ok }, $wrapper_name;
+    } else {
+        *{&#34;$template_class\::EXPORT_OK&#34;} = [$wrapper_name ];
+    }
+    if &#40;my $tags = *{&#34;$template_class\::EXPORT_TAGS&#34;}{HASH}&#41; {
+        push @{ $tags-&gt;{wrappers} ||= [] }, $wrapper_name;
+    } else {
+        *{&#34;$template_class\::EXPORT_TAGS&#34;} = { wrappers =&gt; [$wrapper_name ] };
+    }
 }
 
 =head2 private template TEMPLATENAME =&gt; sub { &#39;Implementation&#39; };
@@ -962,4 +1001,7 @@
     }
 }
 
+package Template::Declare::Wrapper;
+use Exporter &#39;import&#39;;
+
 1;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;25&nbsp;17:06:34&nbsp;2009</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Not sure where things stand with this; it has been over a year since I looked at it. Is the 
wrapper stuff still in need of some love?

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;24&nbsp;04:57:40&nbsp;2009</span>
    <span class="description">rt.cpan [...] sartak.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Resolved at the request of the requestor :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;24&nbsp;04:57:44&nbsp;2009</span>
    <span class="description">rt.cpan [...] sartak.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
