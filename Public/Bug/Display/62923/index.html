<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #62923 for Module-Find: setmoduledirs&#40;undef&#41; doesn&#39;t reset to searching @INC</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #62923 for Module-Find: setmoduledirs&#40;undef&#41; doesn&#39;t reset to searching @INC</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Module-Find/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Module-Find/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Module-Find/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Module-Find/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Module-Find">Module-Find CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">62923</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Module-Find/Active/">Module-Find</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">crenz [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
colin.robertson [...] lovefilm.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-21618-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
0.10</li>
<li>
0.11</li>
</ul>
    </td>
  </tr>
  <tr id="CF-21619-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.12    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;11&nbsp;09:23:31&nbsp;2010</span>
    <span class="description">colin.robertson [...] lovefilm.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> setmoduledirs&#40;undef&#41; doesn&#39;t reset to searching @INC</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 11 Nov 2010 14:23:10 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Module-Find [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Colin Robertson &lt;colin.robertson [...] lovefilm.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">There appears to be a bug in Module::Find 0.10 when setting
setmoduledirs to undef to switch back to the default behaviour of
searching @INC. This can be reproduced with the following code:

        use Module::Find;
        use Data::Dumper;
        print Dumper&#40;[findallmod&#40;&#39;CGI&#39;&#41;]&#41;;
        setmoduledirs&#40;&#39;foo&#39;&#41;;
        setmoduledirs&#40;undef&#41;;
        print Dumper&#40;[findallmod&#40;&#39;CGI&#39;&#41;]&#41;;&#39;

On my system this prints:

        $VAR1 = [
                  &#39;CGI::Cookie&#39;,
                  &#39;CGI::Util&#39;,
                  &#39;CGI::Pretty&#39;,
                  &#39;CGI::Carp&#39;,
                  &#39;CGI::Push&#39;,
                  &#39;CGI::Switch&#39;,
                  &#39;CGI::Apache&#39;,
                  &#39;CGI::Fast&#39;
                ];
        $VAR1 = [];

&#40;Substituting setmoduledirs&#40;undef&#41; with setmoduledirs&#40;&#41; has the same
effect.&#41;

The issue is at line 169 with the check:

    if &#40;defined @Module::Find::ModuleDirs&#41; {

&#39;perldoc -f defined&#39; says:

    Use of &#34;defined&#34; on aggregates &#40;hashes and arrays&#41; is depre‐
    cated.  It used to report whether memory for that aggregate has
    ever been allocated.  This behavior may disappear in future
    versions of Perl.  You should instead use a simple test for
    size: ...

To fix the bug while preserving the documented interface I&#39;d suggest
something like the following &#40;untested&#41; code:

        sub setmoduledirs {
            if &#40;!@_ || &#40;@_ ==  1 &#38;&#38; !defined&#40;$_[0]&#41;&#41; {
                @Module::Find::ModuleDirs = &#40;&#41;;
                return;
            }
            else {
                return @Module::Find::ModuleDirs = @_;
            }
        }

and then the check at line 169 would become:

    if &#40;@Module::Find::ModuleDirs&#41; {

-----------------------------------------------------------------------------------------------------------------------------------------
LOVEFiLM UK Limited is a company registered in England and Wales. 
Registered Number: 06528297. 
Registered Office: No.9, 6 Portal Way, London W3 6RU, United Kingdom.

This e-mail is confidential to the ordinary user of the e-mail address to which it was addressed. If you have received it in error, 
please delete it from your system and notify the sender immediately.

This email message has been delivered safely and archived online by Mimecast.
For more information please visit <span class="clickylink"><a target="new" rel="nofollow" href="http://www.mimecast.co.uk">http://www.mimecast.co.uk</a></span> 
-----------------------------------------------------------------------------------------------------------------------------------------
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;22&nbsp;20:18:18&nbsp;2012</span>
    <span class="description">crenz [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;20&nbsp;11:03:50&nbsp;2013</span>
    <span class="description">lxp [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I suspect that this problem was partially fixed with the release of
Module::Find 0.11, but I&#39;m concerned by the module&#39;s treatment of
@Module::Find::ModuleDirs when set to &#40;undef&#41;--that is, a list with a
single undefined element.

Looking at the code for Module::Find 0.11, I suspect that the problem
still exists.

The following change to the &#34;setmoduledirs&#34; function should fix the
issue:

- return @Module::Find::ModuleDirs = @_;
+ return @Module::Find::ModuleDirs = grep { defined } @_;

On Fri Nov 12 01:23:31 2010, colin.robertson@lovefilm.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There appears to be a bug in Module::Find 0.10 when setting
&gt; setmoduledirs to undef to switch back to the default behaviour of
&gt; searching @INC. This can be reproduced with the following code:
&gt; 
&gt;         use Module::Find;
&gt;         use Data::Dumper;
&gt;         print Dumper&#40;[findallmod&#40;&#39;CGI&#39;&#41;]&#41;;
&gt;         setmoduledirs&#40;&#39;foo&#39;&#41;;
&gt;         setmoduledirs&#40;undef&#41;;
&gt;         print Dumper&#40;[findallmod&#40;&#39;CGI&#39;&#41;]&#41;;&#39;
&gt; 
&gt; On my system this prints:
&gt; 
&gt;         $VAR1 = [
&gt;                   &#39;CGI::Cookie&#39;,
&gt;                   &#39;CGI::Util&#39;,
&gt;                   &#39;CGI::Pretty&#39;,
&gt;                   &#39;CGI::Carp&#39;,
&gt;                   &#39;CGI::Push&#39;,
&gt;                   &#39;CGI::Switch&#39;,
&gt;                   &#39;CGI::Apache&#39;,
&gt;                   &#39;CGI::Fast&#39;
&gt;                 ];
&gt;         $VAR1 = [];
&gt; 
&gt; &#40;Substituting setmoduledirs&#40;undef&#41; with setmoduledirs&#40;&#41; has the same
&gt; effect.&#41;
&gt; 
&gt; The issue is at line 169 with the check:
&gt; 
&gt;     if &#40;defined @Module::Find::ModuleDirs&#41; {
&gt; 
&gt; &#39;perldoc -f defined&#39; says:
&gt; 
&gt;     Use of &#34;defined&#34; on aggregates &#40;hashes and arrays&#41; is depre‐
&gt;     cated.  It used to report whether memory for that aggregate has
&gt;     ever been allocated.  This behavior may disappear in future
&gt;     versions of Perl.  You should instead use a simple test for
&gt;     size: ...
&gt; 
&gt; To fix the bug while preserving the documented interface I&#39;d suggest
&gt; something like the following &#40;untested&#41; code:
&gt; 
&gt;         sub setmoduledirs {
&gt;             if &#40;!@_ || &#40;@_ ==  1 &#38;&#38; !defined&#40;$_[0]&#41;&#41; {
&gt;                 @Module::Find::ModuleDirs = &#40;&#41;;
&gt;                 return;
&gt;             }
&gt;             else {
&gt;                 return @Module::Find::ModuleDirs = @_;
&gt;             }
&gt;         }
&gt; 
&gt; and then the check at line 169 would become:
&gt; 
&gt;     if &#40;@Module::Find::ModuleDirs&#41; {
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;20&nbsp;11:03:51&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;20&nbsp;11:10:21&nbsp;2013</span>
    <span class="description">lxp [...] cpan.org -  Broken in 0.10 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;20&nbsp;11:10:22&nbsp;2013</span>
    <span class="description">lxp [...] cpan.org -  Broken in 0.11 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;07&nbsp;02:22:05&nbsp;2014</span>
    <span class="description">crenz [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you for your contribution, and your patience. This should be fixed in v0.12 now. I have also included your suggested change.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;07&nbsp;02:22:06&nbsp;2014</span>
    <span class="description">crenz [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;07&nbsp;02:22:07&nbsp;2014</span>
    <span class="description">crenz [...] cpan.org -  Fixed in 0.12 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
