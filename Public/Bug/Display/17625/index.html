<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #17625 for SVN-Web: Revision view seems to hang if binary files are involved</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #17625 for SVN-Web: Revision view seems to hang if binary files are involved</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=SVN-Web">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=SVN-Web">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=SVN-Web">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=SVN-Web">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/SVN-Web">SVN-Web CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">17625</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=SVN-Web">SVN-Web</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
mikee [...] s2technologies.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-30328-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-30329-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/165107/52649/diff">
Wed Feb 15 11:39:24 2006 (1.2k) by NIKC [...] cpan.org
</a>
</font></li>
</ul>


foo.dump.gz<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/175020/59299/foo.dump.gz">
Fri Mar 10 20:14:15 2006 (3376.1k) by mikee [...] s2technologies.com
</a>
</font></li>
</ul>


my_versions.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/176045/60116/my_versions.txt">
Sun Mar 12 09:56:32 2006 (3.9k) by mikee [...] s2technologies.com
</a>
</font></li>
</ul>


smime.p7s<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/177106/60805/smime.p7s">
Wed Mar 15 09:17:31 2006 (3k) by mikee [...] s2technologies.com
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/176930/60704/smime.p7s">
Tue Mar 14 17:28:52 2006 (3k) by mikee [...] s2technologies.com
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/176503/60455/smime.p7s">
Mon Mar 13 15:39:23 2006 (3k) by mikee [...] s2technologies.com
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/176045/60117/smime.p7s">
Sun Mar 12 09:56:32 2006 (3k) by mikee [...] s2technologies.com
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/175020/59300/smime.p7s">
Fri Mar 10 20:14:19 2006 (3k) by mikee [...] s2technologies.com
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/165125/52662/smime.p7s">
Wed Feb 15 13:32:01 2006 (3k) by mikee [...] s2technologies.com
</a>
</font></li>
</ul>


svnweb.dump.gz<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/176503/60454/svnweb.dump.gz">
Mon Mar 13 15:39:18 2006 (3324k) by mikee [...] s2technologies.com
</a>
</font></li>
</ul>


versions.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/176038/60106/versions.pl">
Sun Mar 12 09:07:36 2006 (322b) by nik [...] ngo.org.uk
</a>
</font></li>
</ul>


versions.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/176038/60107/versions.txt">
Sun Mar 12 09:07:36 2006 (3.9k) by nik [...] ngo.org.uk
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=17625">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-164561" href="/Public/Bug/Display.html?id=17625#txn-164561">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;13&nbsp;17:41:17&nbsp;2006</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Revision view seems to hang if binary files are involved</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/164561/52363/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/52363">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry, I&#39;m not sure what version I have installed, but I just set it up
last week, so it should be recent.

I&#39;ve encountered a problem viewing a particular revision number if that
revision happens to involve binary files.  The perl proc running SVN
seems to just eat CPU and I have to kill it.  All other revisions that
don&#39;t involve binary files work fine.

Perhaps the perl diff package is actually choking on the binary files -
but probably they shouldn&#39;t even be called if binary files are part of
the checkin.  I would be happy with a &#34;binary files differ&#34; type message
if a checkin involves binary files that have obviously changed &#40;based on
md5/checksum/whatever&#41;.  I don&#39;t expect to actually see diffs for binary
files.

Great module overall.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">---PERL VERSION---
C:\Documents and Settings\s2admin&gt;perl -v

This is perl, v5.8.7 built for MSWin32-x86-multi-thread
&#40;with 7 registered patches, see perl -V for more detail&#41;

Copyright 1987-2005, Larry Wall

Binary build 813 [148120] provided by ActiveState <span class="clickylink"><a target="new" rel="nofollow" href="http://www.ActiveState.com">http://www.ActiveState.com</a></span>
ActiveState is a division of Sophos.
Built Jun  6 2005 13:36:37

Perl may be copied only under the terms of either the Artistic License
or the
GNU General Public License, which may be found in the Perl 5 source kit.

Complete documentation for Perl, including FAQ lists, should be found on
this system using `man perl&#39; or `perldoc perl&#39;.  If you have access to the
Internet, point your browser at <span class="clickylink"><a target="new" rel="nofollow" href="http://www.perl.org/">http://www.perl.org/</a></span>, the Perl Home Page.

---OS---
Windows 2000 Server

<div class="message-stanza open">---Apache---
2.0.54
</div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-165107" href="/Public/Bug/Display.html?id=17625#txn-165107">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;15&nbsp;11:39:24&nbsp;2006</span>
    <span class="description">NIKC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/165107/52646/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/52646">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 71b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Does the attached patch &#40;to Revision.pm&#41; fix the problem for you? 
 
N 
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/165107/52649/diff">Download diff</a><br />
<span class="downloadcontenttype">text/x-diff 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">=== lib/SVN/Web/Revision.pm
==================================================================
--- lib/SVN/Web/Revision.pm	&#40;revision 30085&#41;
+++ lib/SVN/Web/Revision.pm	&#40;local&#41;
@@ -218,6 +218,11 @@
 	$kind = $root2-&gt;check_path&#40;$path&#41;;
 	next if $kind == $SVN::Node::none;
 
+	# Skip the diff if either of the revisions have a non-text MIME type
+	my $mt1 = $root1-&gt;node_prop&#40;$path, &#39;svn:mime-type&#39;&#41; || &#39;text/plain&#39;;
+	my $mt2 = $root2-&gt;node_prop&#40;$path, &#39;svn:mime-type&#39;&#41; || &#39;text/plain&#39;;
+	next if &#40;$mt1 !~ m{^text/}&#41; or &#40;$mt2 !~ m{^text/}&#41;;
+
 	$self-&gt;{REV}-&gt;{paths}{$path}{diff} = Text::Diff::diff
 	  &#40;$root2-&gt;file_contents&#40;$path&#41;,
 	   $root1-&gt;file_contents&#40;$path&#41;,
@@ -237,6 +242,11 @@
 	my $root1 = $fs-&gt;revision_root&#40;$rev&#41;;
 	my $root2 = $fs-&gt;revision_root&#40;$self-&gt;{REV}-&gt;{paths}{$path}{copyfromrev}&#41;;
 
+	# Skip the diff if either of the files have a non-text MIME type
+	my $mt1 = $root1-&gt;node_prop&#40;$path, &#39;svn:mime-type&#39;&#41; || &#39;text/plain&#39;;
+	my $mt2 = $root2-&gt;node_prop&#40;$path, &#39;svn:mime-type&#39;&#41; || &#39;text/plain&#39;;
+	next if &#40;$mt1 !~ m{^text/}&#41; or &#40;$mt2 !~ m{^text/}&#41;;
+
 	# If the files have differing MD5s then do a diff
 	if&#40;$root1-&gt;file_md5_checksum&#40;$path&#41; ne $root2-&gt;file_md5_checksum&#40;$src&#41;&#41; {
 	  $self-&gt;{REV}-&gt;{paths}{$path}{diff} = Text::Diff::diff
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-165108" href="/Public/Bug/Display.html?id=17625#txn-165108">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;15&nbsp;11:39:26&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-165125" href="/Public/Bug/Display.html?id=17625#txn-165125">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;15&nbsp;13:32:01&nbsp;2006</span>
    <span class="description">mikee [...] s2technologies.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #17625] Revision view seems to hang if binary files are involved </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 15 Feb 2006 10:30:58 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-SVN-Web [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Mike Ellery&#34; &lt;mikee [...] s2technologies.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/165125/52661/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/52661">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 987b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Yes - that seems to do it.  

Maybe in the next version you could just add a line like &#34;Binary File&#34; for
each binary file that is part of the revision.  

It looks like I still have a few revisions, unfortunately, that cause the
diff package to hang.  These revisions appear to involve only text files,
but they might have odd formatting or perhaps the line endings aren&#39;t
consistent.  If I find something more conclusive, I&#39;ll let you know - but
this is more likely a problem with the diff package.  The only thing
SVN::Web might be able to do is protect the diff package from files that
cause it harm &#40;as you did for binary files&#41;.

Thanks,
Mike Ellery

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -----Original Message-----
&gt; From: via RT [mailto:bug-SVN-Web@rt.cpan.org] 
&gt; Sent: Wednesday, February 15, 2006 8:39 AM
&gt; To: mikee@s2technologies.com
&gt; Subject: [rt.cpan.org #17625] Revision view seems to hang if 
&gt; binary files are involved 
&gt; 
&gt; Does the attached patch &#40;to Revision.pm&#41; fix the problem for you? 
&gt;  
&gt; N 
&gt; 
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/165125/52662/smime.p7s">Download smime.p7s</a><br />
<span class="downloadcontenttype">application/x-pkcs7-signature 3k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-168146" href="/Public/Bug/Display.html?id=17625#txn-168146">#</a>      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;24&nbsp;04:30:49&nbsp;2006</span>
    <span class="description">NIKC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/168146/54292/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/54292">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 831b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Feb 15 13:32:01 2006, mikee@s2technologies.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It looks like I still have a few revisions, unfortunately, that cause the
&gt; diff package to hang.  These revisions appear to involve only text files,
&gt; but they might have odd formatting or perhaps the line endings aren&#39;t
&gt; consistent.  If I find something more conclusive, I&#39;ll let you know - but
&gt; this is more likely a problem with the diff package.  The only thing
&gt; SVN::Web might be able to do is protect the diff package from files that
&gt; cause it harm &#40;as you did for binary files&#41;.
</div>
If the files in these revisions aren&#39;t confidential, could you put
together a test case?

To do that, create a new repo, and recreate the problem in there.  Then
attach the gzip&#39;d &#39;svnadmin dump&#39; of that repo to this ticket, so I can
reproduce the problem locally.

Thanks.

N
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-175020" href="/Public/Bug/Display.html?id=17625#txn-175020">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;10&nbsp;20:14:14&nbsp;2006</span>
    <span class="description">mikee [...] s2technologies.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #17625] Revision view seems to hang if binary files are involved </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 10 Mar 2006 17:09:35 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-SVN-Web [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Mike Ellery&#34; &lt;mikee [...] s2technologies.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/175020/59300/smime.p7s">Download smime.p7s</a><br />
<span class="downloadcontenttype">application/x-pkcs7-signature 3k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/175020/59298/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/59298">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Sorry for the long delay.  I finally got around to creating a mini test
repository.  I just threw a few of the files in there that seemed to cause
us problems.  I&#39;m attaching a gzip of the dump of my mini repository.  It
just has a few of the files with one bogus change applied to them.

Let me know if this helps.

Thanks,
Mike 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -----Original Message-----
&gt; From: via RT [mailto:bug-SVN-Web@rt.cpan.org] 
&gt; Sent: Friday, February 24, 2006 1:31 AM
&gt; To: mikee@s2technologies.com
&gt; Subject: [rt.cpan.org #17625] Revision view seems to hang if 
&gt; binary files are involved 
&gt; 
&gt; On Wed Feb 15 13:32:01 2006, mikee@s2technologies.com wrote:
<div class="message-stanza open">&gt; &gt; It looks like I still have a few revisions, unfortunately, 
</div>&gt; that cause the
<div class="message-stanza open">&gt; &gt; diff package to hang.  These revisions appear to involve 
</div>&gt; only text files,
<div class="message-stanza open">&gt; &gt; but they might have odd formatting or perhaps the line 
</div>&gt; endings aren&#39;t
<div class="message-stanza open">&gt; &gt; consistent.  If I find something more conclusive, I&#39;ll let 
</div>&gt; you know - but
<div class="message-stanza open">&gt; &gt; this is more likely a problem with the diff package.  The only thing
&gt; &gt; SVN::Web might be able to do is protect the diff package 
</div>&gt; from files that
<div class="message-stanza open">&gt; &gt; cause it harm &#40;as you did for binary files&#41;.
</div>&gt; 
&gt; If the files in these revisions aren&#39;t confidential, could you put
&gt; together a test case?
&gt; 
&gt; To do that, create a new repo, and recreate the problem in 
&gt; there.  Then
&gt; attach the gzip&#39;d &#39;svnadmin dump&#39; of that repo to this 
&gt; ticket, so I can
&gt; reproduce the problem locally.
&gt; 
&gt; Thanks.
&gt; 
&gt; N
&gt; 
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/175020/59299/foo.dump.gz">Download foo.dump.gz</a><br />
<span class="downloadcontenttype">application/x-gzip 3.2m</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-176038" href="/Public/Bug/Display.html?id=17625#txn-176038">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;12&nbsp;09:07:36&nbsp;2006</span>
    <span class="description">nik [...] ngo.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #17625] Revision view seems to hang if binary files are involved</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 12 Mar 2006 12:04:31 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Web [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Nik Clayton &lt;nik [...] ngo.org.uk&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/176038/60105/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/60105">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">mikee@s2technologies.com via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: SVN-Web
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=17625">http://rt.cpan.org/Ticket/Display.html?id=17625</a></span> &gt;
&gt; 
&gt; 
&gt; Sorry for the long delay.  I finally got around to creating a mini test
&gt; repository.  I just threw a few of the files in there that seemed to cause
&gt; us problems.  I&#39;m attaching a gzip of the dump of my mini repository.  It
&gt; just has a few of the files with one bogus change applied to them.
&gt; 
&gt; Let me know if this helps.
</div>
Thanks for that.

It sort of helps, but only in as much as it shows that I can&#39;t reproduce the 
problem you&#39;re seeing.

Specifically, I created a fresh repository and loaded your dump file in to it.

With SVN::Web I can browse all three revisions &#40;I assume it&#39;s rev 3 that&#39;s 
giving you trouble?&#41;, and I can go to each file and use SVN::Web::Diff to 
show me the differences between rev 2 and 3 of each file.  No hangs.

This was using bin/svnweb-server.

By the time you get this message I should have set up

     <span class="clickylink"><a target="new" rel="nofollow" href="http://jc.ngo.org.uk/svnweb/mikee/">http://jc.ngo.org.uk/svnweb/mikee/</a></span>

which runs under mod_perl, and should &#40;hopefully&#41; prove that this isn&#39;t a 
SVN::Web problem.  I&#39;m guessing it&#39;s a problem with the dependencies.

To try and track this down, attached is &#39;versions.pl&#39;.  It prints the 
version number of all the loaded Perl modules.

If you just run it you should see something like this:

     % perl versions.pl
     Carp                                               1.04
     Exporter                                           5.58
     strict                                             1.03
     warnings                                           1.03

If you run

     % perl -MSVN::Web -MSVN::Web::Revision -MSVN::Web::Diff versions.pl

you&#39;ll get output similar to the attached versions.txt.  Can you take a look 
through the output you get, a look through versions.txt, and see if there 
are any obvious discrepencies.  In particular, Algorithm::Diff and 
Text::Diff are possible candidates.

Thanks for your efforts so far in trying to resolve this.

N
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/176038/60106/versions.pl">Download versions.pl</a><br />
<span class="downloadcontenttype">text/x-perl 322b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/local/bin/perl

use warnings;
use strict;

no strict &#39;refs&#39;;

foreach my $pkg_file &#40;sort keys %INC&#41; {
    my $pkg_name = $pkg_file;
    $pkg_name =~ s{/}{::}g;
    $pkg_name =~ s/.pm$//;

    my $ver = ${&#34;${pkg_name}::VERSION&#34;};
    $ver = &#39;&lt;undef&gt;&#39; if ! defined $ver;

    printf&#40;&#34;%-50s %s\n&#34;, $pkg_name, $ver&#41;;
}
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/176038/60107/versions.txt">Download versions.txt</a><br />
<span class="downloadcontenttype">text/plain 3.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Algorithm::Diff                                    1.1901
AutoLoader                                         5.60
BSDPAN                                             &lt;undef&gt;
BSDPAN::Override                                   &lt;undef&gt;
Carp                                               1.04
Class::Data::Inheritable                           0.04
Class::Spiffy                                      0.12
Config                                             &lt;undef&gt;
Cwd                                                3.15
Data::Dumper                                       2.121_04
Devel::StackTrace                                  1.12
DynaLoader                                         1.05
Exception::Class                                   1.22
Exporter                                           5.58
Exporter::Heavy                                    5.58
Fcntl                                              1.05
File::Basename                                     2.73
File::Glob                                         1.04
File::Path                                         1.07
File::Spec                                         3.15
File::Spec::Unix                                   1.5
FileHandle                                         2.01
FindBin                                            1.44
I18N::LangTags                                     0.35
I18N::LangTags::Detect                             1.03
IO                                                 1.21
IO::File                                           1.11
IO::Handle                                         1.24
IO::Seekable                                       1.09
List::Util                                         1.18
Locale::Maketext                                   1.09
Locale::Maketext::Guts                             &lt;undef&gt;
Locale::Maketext::GutsLoader                       &lt;undef&gt;
Locale::Maketext::Lexicon                          0.49
Locale::Maketext::Lexicon::Auto                    0.02
Locale::Maketext::Lexicon::Gettext                 0.14
Locale::Maketext::Simple                           0.12
SVN::Base                                          &lt;undef&gt;
SVN::Core                                          1.3.0
SVN::Fs                                            &lt;undef&gt;
SVN::Repos                                         &lt;undef&gt;
SVN::Web                                           0.45
SVN::Web::Diff                                     &lt;undef&gt;
SVN::Web::Revision                                 &lt;undef&gt;
SVN::Web::X                                        1.1
Scalar::Util                                       1.18
SelectSaver                                        1.01
Symbol                                             1.06
Template                                           2.14
Template::Base                                     2.70
Template::Config                                   2.68
Template::Constants                                2.68
Template::Document                                 2.74
Template::Exception                                2.65
Template::Provider                                 2.81
Template::Service                                  2.77
Text::Diff                                         0.35
XSLoader                                           0.02
YAML                                               0.53
YAML::Base                                         &lt;undef&gt;
base                                               2.07
bytes                                              1.02
constant                                           1.05
integer                                            1.00
mixin                                              &lt;undef&gt;
overload                                           1.03
re                                                 0.04
strict                                             1.03
utf8                                               1.05
vars                                               1.01
warnings                                           1.03
warnings::register                                 1.00
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-176045" href="/Public/Bug/Display.html?id=17625#txn-176045">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;12&nbsp;09:56:31&nbsp;2006</span>
    <span class="description">mikee [...] s2technologies.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #17625] Revision view seems to hang if binary files are involved</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 12 Mar 2006 06:55:57 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-SVN-Web [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Mike Ellery&#34; &lt;mikee [...] s2technologies.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/176045/60117/smime.p7s">Download smime.p7s</a><br />
<span class="downloadcontenttype">application/x-pkcs7-signature 3k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/176045/60115/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/60115">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
I never reproduced the problem with this sample repository either - I guess
I should have tried first.  

I did have a lower version of Algorithm::Diff.  I upgraded, but it hangs on
a particular revision in my main repository.  Do you know of any way I could
dump just the files involved in a particular revision from my repo?  I tried
svnadmin dump -r NUM, but it still seems to give me the whole enchilada,
which is over 5 gigs.

I&#39;m attaching my versions file - there are a number of differences - let me
know if you think I need to correct some/all of the differences.  Looks like
we probably have different operating environments too - I run Apache and
perl &#40;ActiveState&#41; on windoze.  Also, I never could get mod-perl working, so
I run as CGI.

I&#39;ll see if I can repro the problem with a small repository locally.  If you
know how I can dump a particular revision, let me know.

Oh, BTW, I&#39;d appreciate it if you could dispose of the repository that I
sent you -- I don&#39;t think these particular files are very sensitive, but
everything in our source base is proprietary &#40;strictly speaking&#41;.

Thanks,
Mike
 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -----Original Message-----
&gt; From: nik@ngo.org.uk via RT [mailto:bug-SVN-Web@rt.cpan.org] 
&gt; Sent: Sunday, March 12, 2006 6:08 AM
&gt; To: mikee@s2technologies.com
&gt; Subject: Re: [rt.cpan.org #17625] Revision view seems to hang 
&gt; if binary files are involved
&gt; 
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=17625">http://rt.cpan.org/Ticket/Display.html?id=17625</a></span> &gt;
&gt; 
&gt; mikee@s2technologies.com via RT wrote:
<div class="message-stanza open">&gt; &gt;        Queue: SVN-Web
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=17625">http://rt.cpan.org/Ticket/Display.html?id=17625</a></span> &gt;
&gt; &gt; 
&gt; &gt; 
&gt; &gt; Sorry for the long delay.  I finally got around to creating 
</div>&gt; a mini test
<div class="message-stanza open">&gt; &gt; repository.  I just threw a few of the files in there that 
</div>&gt; seemed to cause
<div class="message-stanza open">&gt; &gt; us problems.  I&#39;m attaching a gzip of the dump of my mini 
</div>&gt; repository.  It
<div class="message-stanza open">&gt; &gt; just has a few of the files with one bogus change applied to them.
&gt; &gt; 
&gt; &gt; Let me know if this helps.
</div>&gt; 
&gt; Thanks for that.
&gt; 
&gt; It sort of helps, but only in as much as it shows that I 
&gt; can&#39;t reproduce the 
&gt; problem you&#39;re seeing.
&gt; 
&gt; Specifically, I created a fresh repository and loaded your 
&gt; dump file in to it.
&gt; 
&gt; With SVN::Web I can browse all three revisions &#40;I assume it&#39;s 
&gt; rev 3 that&#39;s 
&gt; giving you trouble?&#41;, and I can go to each file and use 
&gt; SVN::Web::Diff to 
&gt; show me the differences between rev 2 and 3 of each file.  No hangs.
&gt; 
&gt; This was using bin/svnweb-server.
&gt; 
&gt; By the time you get this message I should have set up
&gt; 
&gt;      <span class="clickylink"><a target="new" rel="nofollow" href="http://jc.ngo.org.uk/svnweb/mikee/">http://jc.ngo.org.uk/svnweb/mikee/</a></span>
&gt; 
&gt; which runs under mod_perl, and should &#40;hopefully&#41; prove that 
&gt; this isn&#39;t a 
&gt; SVN::Web problem.  I&#39;m guessing it&#39;s a problem with the dependencies.
&gt; 
&gt; To try and track this down, attached is &#39;versions.pl&#39;.  It prints the 
&gt; version number of all the loaded Perl modules.
&gt; 
&gt; If you just run it you should see something like this:
&gt; 
&gt;      % perl versions.pl
&gt;      Carp                                               1.04
&gt;      Exporter                                           5.58
&gt;      strict                                             1.03
&gt;      warnings                                           1.03
&gt; 
&gt; If you run
&gt; 
&gt;      % perl -MSVN::Web -MSVN::Web::Revision -MSVN::Web::Diff 
&gt; versions.pl
&gt; 
&gt; you&#39;ll get output similar to the attached versions.txt.  Can 
&gt; you take a look 
&gt; through the output you get, a look through versions.txt, and 
&gt; see if there 
&gt; are any obvious discrepencies.  In particular, Algorithm::Diff and 
&gt; Text::Diff are possible candidates.
&gt; 
&gt; Thanks for your efforts so far in trying to resolve this.
&gt; 
&gt; N
&gt; 
&gt; 
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/176045/60116/my_versions.txt">Download my_versions.txt</a><br />
<span class="downloadcontenttype">text/plain 3.9k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-176410" href="/Public/Bug/Display.html?id=17625#txn-176410">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;13&nbsp;12:03:32&nbsp;2006</span>
    <span class="description">nik [...] ngo.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #17625] Revision view seems to hang if binary files are involved</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 13 Mar 2006 17:02:59 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Web [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Nik Clayton &lt;nik [...] ngo.org.uk&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/176410/60364/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/60364">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">mikee@s2technologies.com via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I never reproduced the problem with this sample repository either - I guess
&gt; I should have tried first.  
</div>
Ah.  OK, that won&#39;t have told us much.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I did have a lower version of Algorithm::Diff.  I upgraded, but it hangs on
&gt; a particular revision in my main repository.  Do you know of any way I could
&gt; dump just the files involved in a particular revision from my repo?  I tried
&gt; svnadmin dump -r NUM, but it still seems to give me the whole enchilada,
&gt; which is over 5 gigs.
</div>
&#34;svnadmin help dump&#34; suggests that the &#34;-r&#34; comes *after* the repo path 
argument.  I recommend you get the revs before and after the affected 
revision too.  If it&#39;s rev 400 that&#39;s the problem then:

    svnadmin dump /path/to/repo -r 309:401 &gt; dump

should do it.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m attaching my versions file - there are a number of differences - let me
&gt; know if you think I need to correct some/all of the differences.
</div>
You&#39;re a few revs behind on SVN::Web.  I corrected some issues that led 
to large memory usage in 0.44, so you should update to at least that. 
0.46 was released a few days ago.

I&#39;d also be interested in whether you can reproduce the problem using 
svnweb-server.  Basically, run

     svnweb-server --root /path

Where &#34;/path&#34; is the full path to the directory that contains 
config.yaml.  Then connect to that webserver &#40;which runs on port 8080 by 
default&#41; and see if that reproduces the problem.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"> &gt; Looks like
&gt; we probably have different operating environments too - I run Apache and
&gt; perl &#40;ActiveState&#41; on windoze.  Also, I never could get mod-perl working, so
&gt; I run as CGI.
</div>
Perl on Windows is outside my experience I&#39;m afraid.  Still, see if the 
suggestions above help.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Oh, BTW, I&#39;d appreciate it if you could dispose of the repository that I
&gt; sent you -- I don&#39;t think these particular files are very sensitive, but
&gt; everything in our source base is proprietary &#40;strictly speaking&#41;.
</div>
Done.

N
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-176503" href="/Public/Bug/Display.html?id=17625#txn-176503">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;13&nbsp;15:39:17&nbsp;2006</span>
    <span class="description">mikee [...] s2technologies.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #17625] Revision view seems to hang if binary files are involved</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 13 Mar 2006 12:35:15 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-SVN-Web [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Mike Ellery&#34; &lt;mikee [...] s2technologies.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/176503/60455/smime.p7s">Download smime.p7s</a><br />
<span class="downloadcontenttype">application/x-pkcs7-signature 3k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/176503/60453/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/60453">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
I upgraded to the latest SVN::Web.  The problem still exists and I tried
running the standalone server &#40;as you suggest&#41; - it shows the same behavior.


The particular revision that I gives me trouble is #4818 in our repository.
I tried dumping 4717-4719, but it still wants to basically dump the entire
state of the repository at the starting revision range &#40;4717, in this case&#41;
-- so that results in an unwieldy multi-gigabyte file.

So, the best I could do was an incremental dump of 4818.  I don&#39;t know if
this is useful, but I&#39;m attaching it.  I&#39;m pretty sure the files involved
are those that I copied off to the mini repository that I originally sent
you, so maybe the incremental dump will give you some idea what might be the
problem.  There is at least one binary file involved &#40;the CHM file&#41;, but I
don&#39;t know if that matters.

Thanks,
Mike
 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -----Original Message-----
&gt; From: nik@ngo.org.uk via RT [mailto:bug-SVN-Web@rt.cpan.org] 
&gt; Sent: Monday, March 13, 2006 9:04 AM
&gt; To: mikee@s2technologies.com
&gt; Subject: Re: [rt.cpan.org #17625] Revision view seems to hang 
&gt; if binary files are involved
&gt; 
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=17625">http://rt.cpan.org/Ticket/Display.html?id=17625</a></span> &gt;
&gt; 
&gt; mikee@s2technologies.com via RT wrote:
<div class="message-stanza open">&gt; &gt; I never reproduced the problem with this sample repository 
</div>&gt; either - I guess
<div class="message-stanza open">&gt; &gt; I should have tried first.  
</div>&gt; 
&gt; Ah.  OK, that won&#39;t have told us much.
&gt; 
<div class="message-stanza open">&gt; &gt; I did have a lower version of Algorithm::Diff.  I upgraded, 
</div>&gt; but it hangs on
<div class="message-stanza open">&gt; &gt; a particular revision in my main repository.  Do you know 
</div>&gt; of any way I could
<div class="message-stanza open">&gt; &gt; dump just the files involved in a particular revision from 
</div>&gt; my repo?  I tried
<div class="message-stanza open">&gt; &gt; svnadmin dump -r NUM, but it still seems to give me the 
</div>&gt; whole enchilada,
<div class="message-stanza open">&gt; &gt; which is over 5 gigs.
</div>&gt; 
&gt; &#34;svnadmin help dump&#34; suggests that the &#34;-r&#34; comes *after* the 
&gt; repo path 
&gt; argument.  I recommend you get the revs before and after the affected 
&gt; revision too.  If it&#39;s rev 400 that&#39;s the problem then:
&gt; 
&gt;     svnadmin dump /path/to/repo -r 309:401 &gt; dump
&gt; 
&gt; should do it.
&gt; 
<div class="message-stanza open">&gt; &gt; I&#39;m attaching my versions file - there are a number of 
</div>&gt; differences - let me
<div class="message-stanza open">&gt; &gt; know if you think I need to correct some/all of the differences.
</div>&gt; 
&gt; You&#39;re a few revs behind on SVN::Web.  I corrected some 
&gt; issues that led 
&gt; to large memory usage in 0.44, so you should update to at least that. 
&gt; 0.46 was released a few days ago.
&gt; 
&gt; I&#39;d also be interested in whether you can reproduce the problem using 
&gt; svnweb-server.  Basically, run
&gt; 
&gt;      svnweb-server --root /path
&gt; 
&gt; Where &#34;/path&#34; is the full path to the directory that contains 
&gt; config.yaml.  Then connect to that webserver &#40;which runs on 
&gt; port 8080 by 
&gt; default&#41; and see if that reproduces the problem.
&gt; 
<div class="message-stanza open">&gt;  &gt; Looks like
</div><div class="message-stanza open">&gt; &gt; we probably have different operating environments too - I 
</div>&gt; run Apache and
<div class="message-stanza open">&gt; &gt; perl &#40;ActiveState&#41; on windoze.  Also, I never could get 
</div>&gt; mod-perl working, so
<div class="message-stanza open">&gt; &gt; I run as CGI.
</div>&gt; 
&gt; Perl on Windows is outside my experience I&#39;m afraid.  Still, 
&gt; see if the 
&gt; suggestions above help.
&gt; 
<div class="message-stanza open">&gt; &gt; Oh, BTW, I&#39;d appreciate it if you could dispose of the 
</div>&gt; repository that I
<div class="message-stanza open">&gt; &gt; sent you -- I don&#39;t think these particular files are very 
</div>&gt; sensitive, but
<div class="message-stanza open">&gt; &gt; everything in our source base is proprietary &#40;strictly speaking&#41;.
</div>&gt; 
&gt; Done.
&gt; 
&gt; N
&gt; 
&gt; 
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/176503/60454/svnweb.dump.gz">Download svnweb.dump.gz</a><br />
<span class="downloadcontenttype">application/x-gzip 3.2m</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-176540" href="/Public/Bug/Display.html?id=17625#txn-176540">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;13&nbsp;17:33:37&nbsp;2006</span>
    <span class="description">nik [...] ngo.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #17625] Revision view seems to hang if binary files are involved</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 13 Mar 2006 22:33:13 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Web [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Nik Clayton &lt;nik [...] ngo.org.uk&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/176540/60489/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/60489">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">mikee@s2technologies.com via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I upgraded to the latest SVN::Web.  The problem still exists and I tried
&gt; running the standalone server &#40;as you suggest&#41; - it shows the same behavior.
&gt; 
&gt; The particular revision that I gives me trouble is #4818 in our repository.
&gt; I tried dumping 4717-4719, but it still wants to basically dump the entire
&gt; state of the repository at the starting revision range &#40;4717, in this case&#41;
&gt; -- so that results in an unwieldy multi-gigabyte file.
</div>
The incremental dump won&#39;t, but I understand why you&#39;re having a problem 
with the dump.

You need to use &#34;svnadmin dump /path/to/repo -r 4817:4819&#34; to generate 
the dump file.

Then you want to send the output through svndumpfilter to extract just 
the file&#40;s&#41; that are interesting.  See &#34;svndumpfilter help include&#34; and 
&#34;svndumpfilter help exclude&#34; to see how to include/exclude paths from 
the dump.

Suppose it&#39;s just the files in /some/path in the repository that 
demonstrate this problem.  This should do the trick.

   svnadmin dump /path/to/repo -r 4817:1819 |
       svndumpfilter include /some/path &gt; repo.dump

Try that.  Then create a fresh repo, and load repo.dump in to it:

   svnadmin create new_repo
   svnadmin load new_repo &lt; repo.dump

Point an SVN::Web installation at &#39;new_repo&#39;, and see if that has the 
problem too.  If it does, send me repo.dump &#40;gzip&#39;d as necessary&#41; and we 
should be able to get somewhere.

N
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-176930" href="/Public/Bug/Display.html?id=17625#txn-176930">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;14&nbsp;17:28:51&nbsp;2006</span>
    <span class="description">mikee [...] s2technologies.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #17625] Revision view seems to hang if binary files are involved</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 14 Mar 2006 14:28:23 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-SVN-Web [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Mike Ellery&#34; &lt;mikee [...] s2technologies.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/176930/60703/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/60703">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
OK - thanks for the instructions.  I created a filtered dump, as you
suggest, but I&#39;m unable to load it - I get this message:

E:\&gt;svnadmin load e:\svn\test &lt; webrepo.dump
&lt;&lt;&lt; Started new transaction, based on original revision 4817
     * adding path : seaside/trunk/help ...svnadmin: File not found:
transaction &#39;0-1&#39;, path &#39;seaside/trunk/help&#39;


Any thoughts?  

You can obtain the dump here
<span class="clickylink"><a target="new" rel="nofollow" href="http://ftp.bluehost.com/?domain=ftp@s2technologies.com">http://ftp.bluehost.com/?domain=ftp@s2technologies.com</a></span> &#40;it&#39;s too large to
send as attachment&#41;.  If you know how to load it, maybe it will be useful to
you.  However, since I haven&#39;t been able
to load it, I can&#39;t confirm that the problem is reproduced by this dump.

Thanks,
Mike 



 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -----Original Message-----
&gt; From: nik@ngo.org.uk via RT [mailto:bug-SVN-Web@rt.cpan.org] 
&gt; Sent: Monday, March 13, 2006 2:34 PM
&gt; To: mikee@s2technologies.com
&gt; Subject: Re: [rt.cpan.org #17625] Revision view seems to hang 
&gt; if binary files are involved
&gt; 
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=17625">http://rt.cpan.org/Ticket/Display.html?id=17625</a></span> &gt;
&gt; 
&gt; mikee@s2technologies.com via RT wrote:
<div class="message-stanza open">&gt; &gt; I upgraded to the latest SVN::Web.  The problem still 
</div>&gt; exists and I tried
<div class="message-stanza open">&gt; &gt; running the standalone server &#40;as you suggest&#41; - it shows 
</div>&gt; the same behavior.
<div class="message-stanza open">&gt; &gt; 
&gt; &gt; The particular revision that I gives me trouble is #4818 in 
</div>&gt; our repository.
<div class="message-stanza open">&gt; &gt; I tried dumping 4717-4719, but it still wants to basically 
</div>&gt; dump the entire
<div class="message-stanza open">&gt; &gt; state of the repository at the starting revision range 
</div>&gt; &#40;4717, in this case&#41;
<div class="message-stanza open">&gt; &gt; -- so that results in an unwieldy multi-gigabyte file.
</div>&gt; 
&gt; The incremental dump won&#39;t, but I understand why you&#39;re 
&gt; having a problem 
&gt; with the dump.
&gt; 
&gt; You need to use &#34;svnadmin dump /path/to/repo -r 4817:4819&#34; to 
&gt; generate 
&gt; the dump file.
&gt; 
&gt; Then you want to send the output through svndumpfilter to 
&gt; extract just 
&gt; the file&#40;s&#41; that are interesting.  See &#34;svndumpfilter help 
&gt; include&#34; and 
&gt; &#34;svndumpfilter help exclude&#34; to see how to include/exclude paths from 
&gt; the dump.
&gt; 
&gt; Suppose it&#39;s just the files in /some/path in the repository that 
&gt; demonstrate this problem.  This should do the trick.
&gt; 
&gt;    svnadmin dump /path/to/repo -r 4817:1819 |
&gt;        svndumpfilter include /some/path &gt; repo.dump
&gt; 
&gt; Try that.  Then create a fresh repo, and load repo.dump in to it:
&gt; 
&gt;    svnadmin create new_repo
&gt;    svnadmin load new_repo &lt; repo.dump
&gt; 
&gt; Point an SVN::Web installation at &#39;new_repo&#39;, and see if that has the 
&gt; problem too.  If it does, send me repo.dump &#40;gzip&#39;d as 
&gt; necessary&#41; and we 
&gt; should be able to get somewhere.
&gt; 
&gt; N
&gt; 
&gt; 
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/176930/60704/smime.p7s">Download smime.p7s</a><br />
<span class="downloadcontenttype">application/x-pkcs7-signature 3k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-177047" href="/Public/Bug/Display.html?id=17625#txn-177047">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;15&nbsp;04:41:44&nbsp;2006</span>
    <span class="description">nik [...] ngo.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #17625] Revision view seems to hang if binary files are involved</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 15 Mar 2006 09:41:18 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Web [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Nik Clayton &lt;nik [...] ngo.org.uk&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/177047/60759/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/60759">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">mikee@s2technologies.com via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; OK - thanks for the instructions.  I created a filtered dump, as you
&gt; suggest, but I&#39;m unable to load it - I get this message:
&gt; 
&gt; E:\&gt;svnadmin load e:\svn\test &lt; webrepo.dump
&gt; &lt;&lt;&lt; Started new transaction, based on original revision 4817
&gt;      * adding path : seaside/trunk/help ...svnadmin: File not found:
&gt; transaction &#39;0-1&#39;, path &#39;seaside/trunk/help&#39;
&gt; 
&gt; Any thoughts?  
</div>
Yeah.  &#39;seaside/trunk&#39; doesn&#39;t exist in your test repo yet, so it&#39;s got 
nowhere to load it in to.  Try this &#40;assuming e:\svn\test is the path to 
your repo&#41;.

     mkdir wc                      # working copy
     cd wc
     svn checkout e:\svn\test
     cd test                       # Should be created by checkout
     svn mkdir seaside
     svn mkdir seaside\trunk
     svn commit -m &#39;Create parent directories&#39;

Then try the &#34;svnadmin load ...&#34; command.  I&#39;ve done that here, and it 
lets me reproduce the problem.

If you do that, and point SVN::Web at the repo you&#39;ll see that it&#39;s 
revision 3 that&#39;s got the problem.  This will possibly hang your browser 
and web server, so don&#39;t do that on a production server.

That makes sense:

rev 1 created the directories.

rev 2 loaded the files &#40;so all the commits are adds&#41;

rev 3 made changes

I did &#34;svn diff -r2:3&#34; to see what had changed, and, as well as some 
textual differences I was shown a large amount of binary data.  The 
total diff is 6.9MB.

Digging in to the diff, it seems to be because 
seaside/trunk/help/s2shelptour.chm doesn&#39;t have an svn:mime-type 
property set.  All the other .chm files have a svn:mime-type of 
application/octet-stream.  The revision and diff actions ignore files 
that have a type that doesn&#39;t match /^text\// &#40;if they have a type&#41;.

Subversion behaves similarly, documented at 
<span class="clickylink"><a target="new" rel="nofollow" href="http://svnbook.red-bean.com/nightly/en/svn.advanced.props.html">http://svnbook.red-bean.com/nightly/en/svn.advanced.props.html</a></span>.

Of course, with Subversion, if the command line client tries to do a 
diff of a binary file it just hangs your command line for a bit.  If 
SVN::Web tries to do it it hangs your web server.

Hmm.

There&#39;s no immediate fix for this.  What you can do is:

     svn propset svn:mime-type application/octet-stream s2shelptour.chm

and commit that.  It&#39;ll fix any future changes involving this file, but 
that&#39;s a versioned change, so it won&#39;t fix the problematic revision in 
your repo.

I can &#40;and will&#41; change SVN::Web&#39;s revision and diff actions to use an 
additional heuristic to decide if the file is binary or not, and skip 
the diff if they decide that it is.  That&#39;ll help you when I roll out 
the next release of SVN::Web, which should hopefully be in a few days time.

It won&#39;t help you if you use any other tools on the repo.

Going forward, you should use Subversion&#39;s automatic property setting 
feature to ensure the .chm files are always flagged as 
application/octet-stream.  See this documentation for more: 
<span class="clickylink"><a target="new" rel="nofollow" href="http://svnbook.red-bean.com/nightly/en/svn.advanced.props.html#svn.advanced.props.auto">http://svnbook.red-bean.com/nightly/en/svn.advanced.props.html#svn.advanced.props.auto</a></span>.

If you wanted to fix your repo, you would need to dump your repo, edit 
the dump file, and then load the repo again.

I would do this by:

1.  Find the revision in which s2shelptour.chm was added to the repo.
     Call this revision A.

2.  Dump all the revisions up to, but not including A.

     svnadmin dump -r 1:&#40;A-1&#41; /path/to/repo &gt; dumpfile.1

3.  Dump revision A

     svnadmin dump -r A /path/to/repo &gt; dumpfile.2

4.  Dump all the revisions after A

     svnadmin dump -r &#40;A+1&#41;:HEAD /path/to/repo &gt; dumpfile.3

5.  Edit dumpfile.2 by hand, and add the svn:mime-type property entry.

6.  Load the dumps in to a new repo, and make sure it works properly.

     svnadmin create new-repo
     svnadmin load new-repo &lt; dumpfile.1
     svnadmin load new-repo &lt; dumpfile.2
     svnadmin load new-repo &lt; dumpfile.3

Hope that helps.

N
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-177106" href="/Public/Bug/Display.html?id=17625#txn-177106">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;15&nbsp;09:17:30&nbsp;2006</span>
    <span class="description">mikee [...] s2technologies.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #17625] Revision view seems to hang if binary files are involved</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 15 Mar 2006 06:17:01 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-SVN-Web [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Mike Ellery&#34; &lt;mikee [...] s2technologies.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/177106/60804/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/60804">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Great - this has been very helpful.  Thanks for all the information.

-Mike 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -----Original Message-----
&gt; From: nik@ngo.org.uk via RT [mailto:bug-SVN-Web@rt.cpan.org] 
&gt; Sent: Wednesday, March 15, 2006 1:42 AM
&gt; To: mikee@s2technologies.com
&gt; Subject: Re: [rt.cpan.org #17625] Revision view seems to hang 
&gt; if binary files are involved
&gt; 
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=17625">http://rt.cpan.org/Ticket/Display.html?id=17625</a></span> &gt;
&gt; 
&gt; mikee@s2technologies.com via RT wrote:
<div class="message-stanza open">&gt; &gt; OK - thanks for the instructions.  I created a filtered dump, as you
&gt; &gt; suggest, but I&#39;m unable to load it - I get this message:
&gt; &gt; 
&gt; &gt; E:\&gt;svnadmin load e:\svn\test &lt; webrepo.dump
&gt; &gt; &lt;&lt;&lt; Started new transaction, based on original revision 4817
&gt; &gt;      * adding path : seaside/trunk/help ...svnadmin: File not found:
&gt; &gt; transaction &#39;0-1&#39;, path &#39;seaside/trunk/help&#39;
&gt; &gt; 
&gt; &gt; Any thoughts?  
</div>&gt; 
&gt; Yeah.  &#39;seaside/trunk&#39; doesn&#39;t exist in your test repo yet, 
&gt; so it&#39;s got 
&gt; nowhere to load it in to.  Try this &#40;assuming e:\svn\test is 
&gt; the path to 
&gt; your repo&#41;.
&gt; 
&gt;      mkdir wc                      # working copy
&gt;      cd wc
&gt;      svn checkout e:\svn\test
&gt;      cd test                       # Should be created by checkout
&gt;      svn mkdir seaside
&gt;      svn mkdir seaside\trunk
&gt;      svn commit -m &#39;Create parent directories&#39;
&gt; 
&gt; Then try the &#34;svnadmin load ...&#34; command.  I&#39;ve done that 
&gt; here, and it 
&gt; lets me reproduce the problem.
&gt; 
&gt; If you do that, and point SVN::Web at the repo you&#39;ll see that it&#39;s 
&gt; revision 3 that&#39;s got the problem.  This will possibly hang 
&gt; your browser 
&gt; and web server, so don&#39;t do that on a production server.
&gt; 
&gt; That makes sense:
&gt; 
&gt; rev 1 created the directories.
&gt; 
&gt; rev 2 loaded the files &#40;so all the commits are adds&#41;
&gt; 
&gt; rev 3 made changes
&gt; 
&gt; I did &#34;svn diff -r2:3&#34; to see what had changed, and, as well as some 
&gt; textual differences I was shown a large amount of binary data.  The 
&gt; total diff is 6.9MB.
&gt; 
&gt; Digging in to the diff, it seems to be because 
&gt; seaside/trunk/help/s2shelptour.chm doesn&#39;t have an svn:mime-type 
&gt; property set.  All the other .chm files have a svn:mime-type of 
&gt; application/octet-stream.  The revision and diff actions ignore files 
&gt; that have a type that doesn&#39;t match /^text\// &#40;if they have a type&#41;.
&gt; 
&gt; Subversion behaves similarly, documented at 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://svnbook.red-bean.com/nightly/en/svn.advanced.props.html">http://svnbook.red-bean.com/nightly/en/svn.advanced.props.html</a></span>.
&gt; 
&gt; Of course, with Subversion, if the command line client tries to do a 
&gt; diff of a binary file it just hangs your command line for a bit.  If 
&gt; SVN::Web tries to do it it hangs your web server.
&gt; 
&gt; Hmm.
&gt; 
&gt; There&#39;s no immediate fix for this.  What you can do is:
&gt; 
&gt;      svn propset svn:mime-type application/octet-stream 
&gt; s2shelptour.chm
&gt; 
&gt; and commit that.  It&#39;ll fix any future changes involving this 
&gt; file, but 
&gt; that&#39;s a versioned change, so it won&#39;t fix the problematic 
&gt; revision in 
&gt; your repo.
&gt; 
&gt; I can &#40;and will&#41; change SVN::Web&#39;s revision and diff actions 
&gt; to use an 
&gt; additional heuristic to decide if the file is binary or not, and skip 
&gt; the diff if they decide that it is.  That&#39;ll help you when I roll out 
&gt; the next release of SVN::Web, which should hopefully be in a 
&gt; few days time.
&gt; 
&gt; It won&#39;t help you if you use any other tools on the repo.
&gt; 
&gt; Going forward, you should use Subversion&#39;s automatic property setting 
&gt; feature to ensure the .chm files are always flagged as 
&gt; application/octet-stream.  See this documentation for more: 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://svnbook.red-bean.com/nightly/en/svn.advanced.props.html">http://svnbook.red-bean.com/nightly/en/svn.advanced.props.html</a></span>
&gt; #svn.advanced.props.auto.
&gt; 
&gt; If you wanted to fix your repo, you would need to dump your 
&gt; repo, edit 
&gt; the dump file, and then load the repo again.
&gt; 
&gt; I would do this by:
&gt; 
&gt; 1.  Find the revision in which s2shelptour.chm was added to the repo.
&gt;      Call this revision A.
&gt; 
&gt; 2.  Dump all the revisions up to, but not including A.
&gt; 
&gt;      svnadmin dump -r 1:&#40;A-1&#41; /path/to/repo &gt; dumpfile.1
&gt; 
&gt; 3.  Dump revision A
&gt; 
&gt;      svnadmin dump -r A /path/to/repo &gt; dumpfile.2
&gt; 
&gt; 4.  Dump all the revisions after A
&gt; 
&gt;      svnadmin dump -r &#40;A+1&#41;:HEAD /path/to/repo &gt; dumpfile.3
&gt; 
&gt; 5.  Edit dumpfile.2 by hand, and add the svn:mime-type property entry.
&gt; 
&gt; 6.  Load the dumps in to a new repo, and make sure it works properly.
&gt; 
&gt;      svnadmin create new-repo
&gt;      svnadmin load new-repo &lt; dumpfile.1
&gt;      svnadmin load new-repo &lt; dumpfile.2
&gt;      svnadmin load new-repo &lt; dumpfile.3
&gt; 
&gt; Hope that helps.
&gt; 
&gt; N
&gt; 
&gt; 
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/177106/60805/smime.p7s">Download smime.p7s</a><br />
<span class="downloadcontenttype">application/x-pkcs7-signature 3k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-210598" href="/Public/Bug/Display.html?id=17625#txn-210598">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;19&nbsp;06:30:02&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/210598/82183/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/82183">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Mar 15 04:41:44 2006, nik@ngo.org.uk wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; mikee@s2technologies.com via RT wrote:
<div class="message-stanza open">&gt; &gt; OK - thanks for the instructions.  I created a filtered dump, as 
</div></div>you
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; suggest, but I&#39;m unable to load it - I get this message:
&gt; &gt;
&gt; &gt; E:\&gt;svnadmin load e:\svn\test &lt; webrepo.dump
&gt; &gt; &lt;&lt;&lt; Started new transaction, based on original revision 4817
&gt; &gt;      * adding path : seaside/trunk/help ...svnadmin: File not 
</div></div>found:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; transaction &#39;0-1&#39;, path &#39;seaside/trunk/help&#39;
&gt; &gt;
&gt; &gt; Any thoughts?
</div>&gt; 
&gt; Yeah.  &#39;seaside/trunk&#39; doesn&#39;t exist in your test repo yet, so it&#39;s
&gt; got
&gt; nowhere to load it in to.  Try this &#40;assuming e:\svn\test is the path
&gt; to
&gt; your repo&#41;.
&gt; 
&gt;      mkdir wc                      # working copy
&gt;      cd wc
&gt;      svn checkout e:\svn\test
&gt;      cd test                       # Should be created by checkout
&gt;      svn mkdir seaside
&gt;      svn mkdir seaside\trunk
&gt;      svn commit -m &#39;Create parent directories&#39;
&gt; 
&gt; Then try the &#34;svnadmin load ...&#34; command.  I&#39;ve done that here, and 
</div>it
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; lets me reproduce the problem.
&gt; 
&gt; If you do that, and point SVN::Web at the repo you&#39;ll see that it&#39;s
&gt; revision 3 that&#39;s got the problem.  This will possibly hang your
&gt; browser
&gt; and web server, so don&#39;t do that on a production server.
&gt; 
&gt; That makes sense:
&gt; 
&gt; rev 1 created the directories.
&gt; 
&gt; rev 2 loaded the files &#40;so all the commits are adds&#41;
&gt; 
&gt; rev 3 made changes
&gt; 
&gt; I did &#34;svn diff -r2:3&#34; to see what had changed, and, as well as some
&gt; textual differences I was shown a large amount of binary data.  The
&gt; total diff is 6.9MB.
&gt; 
&gt; Digging in to the diff, it seems to be because
&gt; seaside/trunk/help/s2shelptour.chm doesn&#39;t have an svn:mime-type
&gt; property set.  All the other .chm files have a svn:mime-type of
&gt; application/octet-stream.  The revision and diff actions ignore files
&gt; that have a type that doesn&#39;t match /^text\// &#40;if they have a type&#41;.
&gt; 
&gt; Subversion behaves similarly, documented at
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://svnbook.red-bean.com/nightly/en/svn.advanced.props.html">http://svnbook.red-bean.com/nightly/en/svn.advanced.props.html</a></span>.
&gt; 
&gt; Of course, with Subversion, if the command line client tries to do a
&gt; diff of a binary file it just hangs your command line for a bit.  If
&gt; SVN::Web tries to do it it hangs your web server.
&gt; 
&gt; Hmm.
&gt; 
&gt; There&#39;s no immediate fix for this.  What you can do is:
&gt; 
&gt;      svn propset svn:mime-type application/octet-stream
&gt; s2shelptour.chm
&gt; 
&gt; and commit that.  It&#39;ll fix any future changes involving this file,
&gt; but
&gt; that&#39;s a versioned change, so it won&#39;t fix the problematic revision 
</div>in
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; your repo.
&gt; 
&gt; I can &#40;and will&#41; change SVN::Web&#39;s revision and diff actions to use 
</div>an
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; additional heuristic to decide if the file is binary or not, and skip
&gt; the diff if they decide that it is.  That&#39;ll help you when I roll out
&gt; the next release of SVN::Web, which should hopefully be in a few days
&gt; time.
&gt; 
&gt; It won&#39;t help you if you use any other tools on the repo.
&gt; 
&gt; Going forward, you should use Subversion&#39;s automatic property setting
&gt; feature to ensure the .chm files are always flagged as
&gt; application/octet-stream.  See this documentation for more:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://svnbook.red">http://svnbook.red</a></span>-
&gt; bean.com/nightly/en/svn.advanced.props.html#svn.advanced.props.auto.
&gt; 
&gt; If you wanted to fix your repo, you would need to dump your repo, 
</div>edit
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; the dump file, and then load the repo again.
&gt; 
&gt; I would do this by:
&gt; 
&gt; 1.  Find the revision in which s2shelptour.chm was added to the repo.
&gt;      Call this revision A.
&gt; 
&gt; 2.  Dump all the revisions up to, but not including A.
&gt; 
&gt;      svnadmin dump -r 1:&#40;A-1&#41; /path/to/repo &gt; dumpfile.1
&gt; 
&gt; 3.  Dump revision A
&gt; 
&gt;      svnadmin dump -r A /path/to/repo &gt; dumpfile.2
&gt; 
&gt; 4.  Dump all the revisions after A
&gt; 
&gt;      svnadmin dump -r &#40;A+1&#41;:HEAD /path/to/repo &gt; dumpfile.3
&gt; 
&gt; 5.  Edit dumpfile.2 by hand, and add the svn:mime-type property 
</div>entry.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; 6.  Load the dumps in to a new repo, and make sure it works properly.
&gt; 
&gt;      svnadmin create new-repo
&gt;      svnadmin load new-repo &lt; dumpfile.1
&gt;      svnadmin load new-repo &lt; dumpfile.2
&gt;      svnadmin load new-repo &lt; dumpfile.3
&gt; 
&gt; Hope that helps.
&gt; 
&gt; N
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-260366" href="/Public/Bug/Display.html?id=17625#txn-260366">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;09&nbsp;08:17:18&nbsp;2006</span>
    <span class="description">NIKC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/260366/113157/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/113157">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 141b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Mike,

Did this discussion resolve everything for you?  I&#39;d like to close out
the ticket, but I want to make sure everything&#39;s fine first.

N
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-260385" href="/Public/Bug/Display.html?id=17625#txn-260385">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;09&nbsp;11:51:44&nbsp;2006</span>
    <span class="description">mikee [...] s2technologies.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #17625] Revision view seems to hang if binary files are involved</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 09 Nov 2006 08:50:34 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SVN-Web [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike Ellery &lt;mikee [...] s2technologies.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/260385/113168/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/113168">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 273b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I believe it is resolved.

Thanks,
Mike

  via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=17625">http://rt.cpan.org/Ticket/Display.html?id=17625</a></span> &gt;
&gt; 
&gt; Mike,
&gt; 
&gt; Did this discussion resolve everything for you?  I&#39;d like to close out
&gt; the ticket, but I want to make sure everything&#39;s fine first.
&gt; 
&gt; N
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-315025" href="/Public/Bug/Display.html?id=17625#txn-315025">#</a>      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;29&nbsp;14:40:35&nbsp;2007</span>
    <span class="description">NIKC [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 1.56244</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
