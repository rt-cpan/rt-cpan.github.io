<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #102651 for GnuPG-Interface: GnuPG-interface together with gnupg 2.1+</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #102651 for GnuPG-Interface: GnuPG-interface together with gnupg 2.1+</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=GnuPG-Interface">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=GnuPG-Interface">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=GnuPG-Interface">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=GnuPG-Interface">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/GnuPG-Interface">GnuPG-Interface CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">102651</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=GnuPG-Interface">GnuPG-Interface</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dimstar [...] opensuse.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
CARNIL [...] cpan.org

<br />
dom [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-14866-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-14867-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




0001-Generalize-the-test-suite.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1668988/895680/0001-Generalize-the-test-suite.patch">
Wed Sep 14 13:50:52 2016 (4.8k) by dkg [...] fifthhorseman.net
</a>
</font></li>
</ul>


0002-subkey-validity-of-an-key-when-we-have-established-n.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1668988/895681/0002-subkey-validity-of-an-key-when-we-have-established-n.patch">
Wed Sep 14 13:50:52 2016 (1.2k) by dkg [...] fifthhorseman.net
</a>
</font></li>
</ul>


0003-ensure-that-test-covers-all-signatures.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1668988/895682/0003-ensure-that-test-covers-all-signatures.patch">
Wed Sep 14 13:50:52 2016 (1.4k) by dkg [...] fifthhorseman.net
</a>
</font></li>
</ul>


0004-add-gpg_is_modern-to-test-suite.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1668988/895683/0004-add-gpg_is_modern-to-test-suite.patch">
Wed Sep 14 13:50:52 2016 (1.5k) by dkg [...] fifthhorseman.net
</a>
</font></li>
</ul>


0005-Modern-GnuPG-2.1-reports-more-detail-about-secret-ke.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1668988/895684/0005-Modern-GnuPG-2.1-reports-more-detail-about-secret-ke.patch">
Wed Sep 14 13:50:52 2016 (5.2k) by dkg [...] fifthhorseman.net
</a>
</font></li>
</ul>


0006-test-suite-match-plaintext-output-across-versions-of.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1669007/895706/0006-test-suite-match-plaintext-output-across-versions-of.patch">
Wed Sep 14 14:49:39 2016 (3.3k) by dkg [...] fifthhorseman.net
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/1668988/895685/0006-test-suite-match-plaintext-output-across-versions-of.patch">
Wed Sep 14 13:50:52 2016 (3.2k) by dkg [...] fifthhorseman.net
</a>
</font></li>
</ul>


0007-fix-test_default_key_passphrase-when-passphrase-come.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1668988/895686/0007-fix-test_default_key_passphrase-when-passphrase-come.patch">
Wed Sep 14 13:50:52 2016 (1.1k) by dkg [...] fifthhorseman.net
</a>
</font></li>
</ul>


signature.asc<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1669007/895707/signature.asc">
Wed Sep 14 14:49:39 2016 (930b) by dkg [...] fifthhorseman.net
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/1471510/783461/signature.asc">
Mon Mar 09 10:29:56 2015 (181b) by dimstar [...] opensuse.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=102651">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1471510" href="/Public/Bug/Display.html?id=102651#txn-1471510">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;09&nbsp;10:29:56&nbsp;2015</span>
    <span class="description">dimstar [...] opensuse.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> GnuPG-interface together with gnupg 2.1+</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 09 Mar 2015 15:28:39 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-GnuPG-Interface [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dimstar / Dominique Leuenberger &lt;dimstar [...] opensuse.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1471510/783460/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/783460">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Good day,

It seems as if GnuP-Interface &#40;tested 0.52, so latest release&#41; does not
work nicely with gnup 2.1.1, as can currently be found in many
distributions.

make test gives me:
PERL_DL_NONLAZY=1 /usr/bin/perl &#34;-MExtUtils::Command::MM&#34;
&#34;-MTest::Harness&#34; &#34;-e&#34; &#34;undef *Test::Harness::Switches; test_harness&#40;0,
&#39;inc&#39;, &#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/*.t
t/clearsign.t .............. 
Failed 2/2 subtests 
t/decrypt.t ................ 
Failed 4/4 subtests 
t/detach_sign.t ............ 
Failed 2/2 subtests 
t/encrypt.t ................ ok
t/encrypt_symmetrically.t .. ok
t/export_keys.t ............ ok
t/Fingerprint.t ............ ok
t/get_public_keys.t ........ 
Failed 1/3 subtests 
t/get_secret_keys.t ........ 
Failed 2/2 subtests 
t/import_keys.t ............ ok
t/Interface.t .............. ok
t/list_public_keys.t ....... ok
t/list_secret_keys.t ....... 
Failed 1/4 subtests 
t/list_sigs.t .............. ok
gpg: signing failed: No pinentry
gpg: signing failed: No pinentry
t/passphrase_handling.t .... 
Failed 3/3 subtests 
t/sign.t ................... 
Failed 2/2 subtests 
t/sign_and_encrypt.t ....... 
Failed 2/2 subtests 
t/UserId.t ................. ok
t/verify.t ................. ok
t/wrap_call.t .............. ok

Test Summary Report
-------------------
t/clearsign.t            &#40;Wstat: 0 Tests: 2 Failed: 2&#41;
  Failed tests:  1-2
t/decrypt.t              &#40;Wstat: 0 Tests: 4 Failed: 4&#41;
  Failed tests:  1-4
t/detach_sign.t          &#40;Wstat: 0 Tests: 2 Failed: 2&#41;
  Failed tests:  1-2
t/get_public_keys.t      &#40;Wstat: 0 Tests: 3 Failed: 1&#41;
  Failed test:  3
t/get_secret_keys.t      &#40;Wstat: 0 Tests: 2 Failed: 2&#41;
  Failed tests:  1-2
t/list_secret_keys.t     &#40;Wstat: 0 Tests: 4 Failed: 1&#41;
  Failed test:  2
t/passphrase_handling.t  &#40;Wstat: 0 Tests: 3 Failed: 3&#41;
  Failed tests:  1-3
t/sign.t                 &#40;Wstat: 0 Tests: 2 Failed: 2&#41;
  Failed tests:  1-2
t/sign_and_encrypt.t     &#40;Wstat: 0 Tests: 2 Failed: 2&#41;
  Failed tests:  1-2
Files=20, Tests=52, 12 wallclock secs &#40; 0.26 usr  0.06 sys +  7.61 cusr
1.47 csys =  9.40 CPU&#41;
Result: FAIL
Failed 9/20 test programs. 19/52 subtests failed.
Makefile:846: recipe for target &#39;test_dynamic&#39; failed
make: *** [test_dynamic] Error 255
+ :
+ /usr/bin/make test
PERL_DL_NONLAZY=1 /usr/bin/perl &#34;-MExtUtils::Command::MM&#34;
&#34;-MTest::Harness&#34; &#34;-e&#34; &#34;undef *Test::Harness::Switches; test_harness&#40;0,
&#39;inc&#39;, &#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/*.t
t/clearsign.t .............. 
Failed 2/2 subtests 
t/decrypt.t ................ 
Failed 4/4 subtests 
t/detach_sign.t ............ 
Failed 2/2 subtests 
t/encrypt.t ................ ok
t/encrypt_symmetrically.t .. ok
t/export_keys.t ............ ok
t/Fingerprint.t ............ ok
t/get_public_keys.t ........ 
Failed 1/3 subtests 
t/get_secret_keys.t ........ 
Failed 2/2 subtests 
t/import_keys.t ............ ok
t/Interface.t .............. ok
t/list_public_keys.t ....... ok
t/list_secret_keys.t ....... 
Failed 1/4 subtests 
t/list_sigs.t .............. ok
gpg: signing failed: No pinentry
gpg: signing failed: No pinentry
t/passphrase_handling.t .... 
Failed 3/3 subtests 
t/sign.t ................... 
Failed 2/2 subtests 
t/sign_and_encrypt.t ....... 
Failed 2/2 subtests 
t/UserId.t ................. ok
t/verify.t ................. ok
t/wrap_call.t .............. ok

Test Summary Report
-------------------
t/clearsign.t            &#40;Wstat: 0 Tests: 2 Failed: 2&#41;
  Failed tests:  1-2
t/decrypt.t              &#40;Wstat: 0 Tests: 4 Failed: 4&#41;
  Failed tests:  1-4
t/detach_sign.t          &#40;Wstat: 0 Tests: 2 Failed: 2&#41;
  Failed tests:  1-2
t/get_public_keys.t      &#40;Wstat: 0 Tests: 3 Failed: 1&#41;
  Failed test:  3
t/get_secret_keys.t      &#40;Wstat: 0 Tests: 2 Failed: 2&#41;
  Failed tests:  1-2
t/list_secret_keys.t     &#40;Wstat: 0 Tests: 4 Failed: 1&#41;
  Failed test:  2
t/passphrase_handling.t  &#40;Wstat: 0 Tests: 3 Failed: 3&#41;
  Failed tests:  1-3
t/sign.t                 &#40;Wstat: 0 Tests: 2 Failed: 2&#41;
  Failed tests:  1-2
t/sign_and_encrypt.t     &#40;Wstat: 0 Tests: 2 Failed: 2&#41;
  Failed tests:  1-2
Files=20, Tests=52, 10 wallclock secs &#40; 0.25 usr  0.10 sys +  7.54 cusr
1.58 csys =  9.47 CPU&#41;
Result: FAIL
Failed 9/20 test programs. 19/52 subtests failed.
Makefile:846: recipe for target &#39;test_dynamic&#39; failed
make: *** [test_dynamic] Error 255

Would be great to get this sorted out... 

Cheers,
Dominique

-- 
Dimstar / Dominique Leuenberger &lt;dimstar@opensuse.org&gt;
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1471510/783461/signature.asc">Download signature.asc</a><br />
<span class="downloadcontenttype">application/pgp-signature 181b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1471691" href="/Public/Bug/Display.html?id=102651#txn-1471691">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;09&nbsp;18:17:30&nbsp;2015</span>
    <span class="description">jesse [...] fsck.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #102651] GnuPG-interface together with gnupg 2.1+</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 9 Mar 2015 15:17:19 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Dimstar / Dominique Leuenberger via RT &lt;bug-GnuPG-Interface [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jesse Vincent &lt;jesse [...] fsck.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1471691/783571/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/783571">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 5.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Indeed, GnuPG has...changed their commandline.
I&#39;d absolutely love patches to improve things.


On Mon, Mar 09, 2015 at 10:29:59AM -0400, Dimstar / Dominique Leuenberger via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Mon Mar 09 10:29:56 2015: Request 102651 was acted upon.
&gt; Transaction: Ticket created by dimstar@opensuse.org
&gt;        Queue: GnuPG-Interface
&gt;      Subject: GnuPG-interface together with gnupg 2.1+
&gt;    Broken in: &#40;no value&#41;
&gt;     Severity: &#40;no value&#41;
&gt;        Owner: Nobody
&gt;   Requestors: dimstar@opensuse.org
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=102651">https://rt.cpan.org/Ticket/Display.html?id=102651</a></span> &gt;
&gt; 
&gt; 
&gt; Good day,
&gt; 
&gt; It seems as if GnuP-Interface &#40;tested 0.52, so latest release&#41; does not
&gt; work nicely with gnup 2.1.1, as can currently be found in many
&gt; distributions.
&gt; 
&gt; make test gives me:
&gt; PERL_DL_NONLAZY=1 /usr/bin/perl &#34;-MExtUtils::Command::MM&#34;
&gt; &#34;-MTest::Harness&#34; &#34;-e&#34; &#34;undef *Test::Harness::Switches; test_harness&#40;0,
&gt; &#39;inc&#39;, &#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/*.t
&gt; t/clearsign.t .............. 
&gt; Failed 2/2 subtests 
&gt; t/decrypt.t ................ 
&gt; Failed 4/4 subtests 
&gt; t/detach_sign.t ............ 
&gt; Failed 2/2 subtests 
&gt; t/encrypt.t ................ ok
&gt; t/encrypt_symmetrically.t .. ok
&gt; t/export_keys.t ............ ok
&gt; t/Fingerprint.t ............ ok
&gt; t/get_public_keys.t ........ 
&gt; Failed 1/3 subtests 
&gt; t/get_secret_keys.t ........ 
&gt; Failed 2/2 subtests 
&gt; t/import_keys.t ............ ok
&gt; t/Interface.t .............. ok
&gt; t/list_public_keys.t ....... ok
&gt; t/list_secret_keys.t ....... 
&gt; Failed 1/4 subtests 
&gt; t/list_sigs.t .............. ok
&gt; gpg: signing failed: No pinentry
&gt; gpg: signing failed: No pinentry
&gt; t/passphrase_handling.t .... 
&gt; Failed 3/3 subtests 
&gt; t/sign.t ................... 
&gt; Failed 2/2 subtests 
&gt; t/sign_and_encrypt.t ....... 
&gt; Failed 2/2 subtests 
&gt; t/UserId.t ................. ok
&gt; t/verify.t ................. ok
&gt; t/wrap_call.t .............. ok
&gt; 
&gt; Test Summary Report
&gt; -------------------
&gt; t/clearsign.t            &#40;Wstat: 0 Tests: 2 Failed: 2&#41;
&gt;   Failed tests:  1-2
&gt; t/decrypt.t              &#40;Wstat: 0 Tests: 4 Failed: 4&#41;
&gt;   Failed tests:  1-4
&gt; t/detach_sign.t          &#40;Wstat: 0 Tests: 2 Failed: 2&#41;
&gt;   Failed tests:  1-2
&gt; t/get_public_keys.t      &#40;Wstat: 0 Tests: 3 Failed: 1&#41;
&gt;   Failed test:  3
&gt; t/get_secret_keys.t      &#40;Wstat: 0 Tests: 2 Failed: 2&#41;
&gt;   Failed tests:  1-2
&gt; t/list_secret_keys.t     &#40;Wstat: 0 Tests: 4 Failed: 1&#41;
&gt;   Failed test:  2
&gt; t/passphrase_handling.t  &#40;Wstat: 0 Tests: 3 Failed: 3&#41;
&gt;   Failed tests:  1-3
&gt; t/sign.t                 &#40;Wstat: 0 Tests: 2 Failed: 2&#41;
&gt;   Failed tests:  1-2
&gt; t/sign_and_encrypt.t     &#40;Wstat: 0 Tests: 2 Failed: 2&#41;
&gt;   Failed tests:  1-2
&gt; Files=20, Tests=52, 12 wallclock secs &#40; 0.26 usr  0.06 sys +  7.61 cusr
&gt; 1.47 csys =  9.40 CPU&#41;
&gt; Result: FAIL
&gt; Failed 9/20 test programs. 19/52 subtests failed.
&gt; Makefile:846: recipe for target &#39;test_dynamic&#39; failed
&gt; make: *** [test_dynamic] Error 255
&gt; + :
&gt; + /usr/bin/make test
&gt; PERL_DL_NONLAZY=1 /usr/bin/perl &#34;-MExtUtils::Command::MM&#34;
&gt; &#34;-MTest::Harness&#34; &#34;-e&#34; &#34;undef *Test::Harness::Switches; test_harness&#40;0,
&gt; &#39;inc&#39;, &#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/*.t
&gt; t/clearsign.t .............. 
&gt; Failed 2/2 subtests 
&gt; t/decrypt.t ................ 
&gt; Failed 4/4 subtests 
&gt; t/detach_sign.t ............ 
&gt; Failed 2/2 subtests 
&gt; t/encrypt.t ................ ok
&gt; t/encrypt_symmetrically.t .. ok
&gt; t/export_keys.t ............ ok
&gt; t/Fingerprint.t ............ ok
&gt; t/get_public_keys.t ........ 
&gt; Failed 1/3 subtests 
&gt; t/get_secret_keys.t ........ 
&gt; Failed 2/2 subtests 
&gt; t/import_keys.t ............ ok
&gt; t/Interface.t .............. ok
&gt; t/list_public_keys.t ....... ok
&gt; t/list_secret_keys.t ....... 
&gt; Failed 1/4 subtests 
&gt; t/list_sigs.t .............. ok
&gt; gpg: signing failed: No pinentry
&gt; gpg: signing failed: No pinentry
&gt; t/passphrase_handling.t .... 
&gt; Failed 3/3 subtests 
&gt; t/sign.t ................... 
&gt; Failed 2/2 subtests 
&gt; t/sign_and_encrypt.t ....... 
&gt; Failed 2/2 subtests 
&gt; t/UserId.t ................. ok
&gt; t/verify.t ................. ok
&gt; t/wrap_call.t .............. ok
&gt; 
&gt; Test Summary Report
&gt; -------------------
&gt; t/clearsign.t            &#40;Wstat: 0 Tests: 2 Failed: 2&#41;
&gt;   Failed tests:  1-2
&gt; t/decrypt.t              &#40;Wstat: 0 Tests: 4 Failed: 4&#41;
&gt;   Failed tests:  1-4
&gt; t/detach_sign.t          &#40;Wstat: 0 Tests: 2 Failed: 2&#41;
&gt;   Failed tests:  1-2
&gt; t/get_public_keys.t      &#40;Wstat: 0 Tests: 3 Failed: 1&#41;
&gt;   Failed test:  3
&gt; t/get_secret_keys.t      &#40;Wstat: 0 Tests: 2 Failed: 2&#41;
&gt;   Failed tests:  1-2
&gt; t/list_secret_keys.t     &#40;Wstat: 0 Tests: 4 Failed: 1&#41;
&gt;   Failed test:  2
&gt; t/passphrase_handling.t  &#40;Wstat: 0 Tests: 3 Failed: 3&#41;
&gt;   Failed tests:  1-3
&gt; t/sign.t                 &#40;Wstat: 0 Tests: 2 Failed: 2&#41;
&gt;   Failed tests:  1-2
&gt; t/sign_and_encrypt.t     &#40;Wstat: 0 Tests: 2 Failed: 2&#41;
&gt;   Failed tests:  1-2
&gt; Files=20, Tests=52, 10 wallclock secs &#40; 0.25 usr  0.10 sys +  7.54 cusr
&gt; 1.58 csys =  9.47 CPU&#41;
&gt; Result: FAIL
&gt; Failed 9/20 test programs. 19/52 subtests failed.
&gt; Makefile:846: recipe for target &#39;test_dynamic&#39; failed
&gt; make: *** [test_dynamic] Error 255
&gt; 
&gt; Would be great to get this sorted out... 
&gt; 
&gt; Cheers,
&gt; Dominique
&gt; 
&gt; -- 
&gt; Dimstar / Dominique Leuenberger &lt;dimstar@opensuse.org&gt;
&gt; 
</div>


-- 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1471692" href="/Public/Bug/Display.html?id=102651#txn-1471692">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;09&nbsp;18:17:30&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1658665" href="/Public/Bug/Display.html?id=102651#txn-1658665">#</a>      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;14&nbsp;00:57:51&nbsp;2016</span>
    <span class="description">CARNIL [...] cpan.org -  Cc CARNIL added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1660118" href="/Public/Bug/Display.html?id=102651#txn-1660118">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;19&nbsp;19:01:50&nbsp;2016</span>
    <span class="description">dom [...] cpan.org -  Cc DOM added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1668988" href="/Public/Bug/Display.html?id=102651#txn-1668988">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;14&nbsp;13:50:52&nbsp;2016</span>
    <span class="description">dkg [...] fifthhorseman.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Jesse Vincent &lt;jesse [...] fsck.com&gt;, 834281 [...] bugs.debian.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [rt.cpan.org #102651] patches to fix the GnuPG::Interface test suite to work with GnuPG 2.1</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 14 Sep 2016 13:26:40 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-GnuPG-Interface [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Daniel Kahn Gillmor &lt;dkg [...] fifthhorseman.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1668988/895679/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/895679">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Attached is a series of 7 patches that let the GnuPG::Interface test
suite work with GnuPG 2.1.

These patches can also be found on the improve-test-suite branch at
git://lair.fifthhorseman.net/~dkg/gnupg-interface &#40;commit ID
f5ca0742dd1f724de1765679b493d4cfb7ea216b&#41;.

If you want to try them out:

    git remote add dkg git://lair.fifthhorseman.net/~dkg/gnupg-interface
    git remote update dkg
    git checkout -b improve-test-suite dkg/improve-test-suite
    perl Makefile.PL
    make test

Feel free to merge them directly if you like &#39;em :&#41;

GnuPG 2.1 hasn&#39;t actually changed the interface to GnuPG very much:
there&#39;s a little bit of a change around expectations of where the
passphrase comes from and who needs to have access to it, but that&#39;s a
positive change that helps users to isolate which processes have access
to their secret key material

What has changed more significantly is the structure of the files in
GnuPG&#39;s homedir, which has never been part of GnuPG&#39;s publicly-declared
stable interface, and GnuPG::Interface&#39;s test/ directory sort of
implicitly assumed that it was.

The revised test suite now uses a temporary/throwaway GnuPG homedir,
which it seeds with the data from test/ , rather than assuming that
test/ can act as a pre-formed homedir in the first place.

You&#39;ll note that there&#39;s very little changed in the non-test-suite part
of GnuPG::Interface with this series.

   --dkg
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1668988/895680/0001-Generalize-the-test-suite.patch">Download 0001-Generalize-the-test-suite.patch</a><br />
<span class="downloadcontenttype">text/x-diff 4.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From d49813d8b82245b1d7b6c7541aa80ed92b249557 Mon Sep 17 00:00:00 2001
From: Daniel Kahn Gillmor &lt;dkg@fifthhorseman.net&gt;
Date: Tue, 13 Sep 2016 10:38:12 -0400
Subject: [PATCH 1/7] Generalize the test suite

The test suite currently assumes it knows something about the internal
state of GnuPG&#39;s homedir.

It&#39;s safer and less brittle to rely explicitly on the public interface
that GnuPG has committed to, such as --import-keys and --list-keys,
rather than assuming that certain files are in certain places in the
GnuPG homedir.

It&#39;s also better to create a fresh homedir and allow GnuPG to populate
it during the test suite, cleaning it up at the end, rather than hope
that GnuPG will leave a pre-existing homedir untouched.

With this change, many more of the tests pass when /usr/bin/gpg is
provided by GnuPG 2.1.
---
 .gitignore                 |  2 --
 t/000_setup.t              | 28 ++++++++++++++++++++++++++++
 t/MyTestSpecific.pm        |  2 +-
 t/zzz_cleanup.t            | 17 +++++++++++++++++
 test/fake-pinentry.pl      | 28 ++++++++++++++++++++++++++++
 test/{options =&gt; gpg.conf} |  0
 test/secret-keys/1.0.test  |  4 ++--
 7 files changed, 76 insertions&#40;+&#41;, 5 deletions&#40;-&#41;
 create mode 100644 t/000_setup.t
 create mode 100644 t/zzz_cleanup.t
 create mode 100755 test/fake-pinentry.pl
 rename test/{options =&gt; gpg.conf} &#40;100%&#41;

diff --git a/.gitignore b/.gitignore
index 3100061..44e438a 100644
--- a/.gitignore
+++ b/.gitignore
@@ -6,8 +6,6 @@
 /pm_to_blib
 *.tar.gz
 /test/*/*.out
-/test/random_seed
 /test/temp
-/test/trustdb.gpg
 /MYMETA.*
 /MANIFEST.SKIP.bak
diff --git a/t/000_setup.t b/t/000_setup.t
new file mode 100644
index 0000000..7f7f7b0
--- /dev/null
+++ b/t/000_setup.t
@@ -0,0 +1,28 @@
+#!/usr/bin/perl -w
+
+use strict;
+use English qw&#40; -no_match_vars &#41;;
+
+use lib &#39;./t&#39;;
+use MyTest;
+use MyTestSpecific;
+use Cwd;
+use File::Path qw &#40;make_path&#41;;
+use File::Copy;
+
+TEST
+{
+    make_path&#40;&#39;test/gnupghome&#39;, { mode =&gt; 0700 }&#41;;
+    my $agentconf = IO::File-&gt;new&#40; &#34;&gt; test/gnupghome/gpg-agent.conf&#34; &#41;;
+    $agentconf-&gt;write&#40;&#34;pinentry-program &#34; . getcwd&#40;&#41; . &#34;/test/fake-pinentry.pl\n&#34;&#41;;
+    $agentconf-&gt;close&#40;&#41;;
+    copy&#40;&#39;test/gpg.conf&#39;, &#39;test/gnupghome/gpg.conf&#39;&#41;;
+    reset_handles&#40;&#41;;
+
+    my $pid = $gnupg-&gt;import_keys&#40;command_args =&gt; [ &#39;test/pubring.gpg&#39;, &#39;test/secring.gpg&#39; ],
+                                  options =&gt; [ &#39;batch&#39;],
+                                  handles =&gt; $handles&#41;;
+    waitpid $pid, 0;
+
+    return $CHILD_ERROR == 0;
+};
diff --git a/t/MyTestSpecific.pm b/t/MyTestSpecific.pm
index 053b749..1af98ae 100644
--- a/t/MyTestSpecific.pm
+++ b/t/MyTestSpecific.pm
@@ -40,7 +40,7 @@ use vars qw&#40; @ISA           @EXPORT
 
 $gnupg = GnuPG::Interface-&gt;new&#40; passphrase =&gt; &#39;test&#39; &#41;;
 
-$gnupg-&gt;options-&gt;hash_init&#40; homedir              =&gt; &#39;test&#39;,
+$gnupg-&gt;options-&gt;hash_init&#40; homedir              =&gt; &#39;test/gnupghome&#39;,
                             armor                =&gt; 1,
                             meta_interactive     =&gt; 0,
                             meta_signing_key_id  =&gt; &#39;0xF950DA9C&#39;,
diff --git a/t/zzz_cleanup.t b/t/zzz_cleanup.t
new file mode 100644
index 0000000..5c03a72
--- /dev/null
+++ b/t/zzz_cleanup.t
@@ -0,0 +1,17 @@
+#!/usr/bin/perl -w
+
+use strict;
+use English qw&#40; -no_match_vars &#41;;
+
+use lib &#39;./t&#39;;
+use MyTest;
+use MyTestSpecific;
+use File::Path qw &#40;remove_tree&#41;;
+
+# this is actually no test, just cleanup.
+TEST
+{
+    my $err = [];
+    remove_tree&#40;&#39;test/gnupghome&#39;, {error =&gt; \$err}&#41;;
+    return ! @$err;
+};
diff --git a/test/fake-pinentry.pl b/test/fake-pinentry.pl
new file mode 100755
index 0000000..12d3611
--- /dev/null
+++ b/test/fake-pinentry.pl
@@ -0,0 +1,28 @@
+#!/usr/bin/perl -w
+# Use this for your test suites when a perl interpreter is available.
+#
+# The encrypted keys in your test suite that you expect to work must
+# be locked with a passphrase of &#34;test&#34;
+#
+# Author: Daniel Kahn Gillmor &lt;dkg@fifthhorseman.net&gt;
+#
+# License: This trivial work is hereby explicitly placed into the
+# public domain.  Anyone may reuse it, modify it, redistribute it for
+# any purpose.
+
+use strict;
+use warnings;
+
+# turn off buffering
+$| = 1;
+
+print &#34;OK This is only for test suites, and should never be used in production\n&#34;;
+while &#40;&lt;STDIN&gt;&#41; {
+  chomp;
+  next if &#40;/^$/&#41;;
+  next if &#40;/^#/&#41;;
+  print &#40;&#34;D test\n&#34;&#41; if &#40;/^getpin/i&#41;;
+  print &#34;OK\n&#34;;
+  exit if &#40;/^bye/i&#41;;
+}
+1;
diff --git a/test/options b/test/gpg.conf
similarity index 100%
rename from test/options
rename to test/gpg.conf
diff --git a/test/secret-keys/1.0.test b/test/secret-keys/1.0.test
index 5999484..129d472 100644
--- a/test/secret-keys/1.0.test
+++ b/test/secret-keys/1.0.test
@@ -1,5 +1,5 @@
-test/secring.gpg
-----------------
+test/gnupghome/secring.gpg
+--------------------------
 sec   1024D/F950DA9C 2000-02-06
 uid                  GnuPG test key &#40;for testing purposes only&#41;
 uid                  Foo Bar &#40;1&#41;
-- 
2.9.3

</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1668988/895681/0002-subkey-validity-of-an-key-when-we-have-established-n.patch">Download 0002-subkey-validity-of-an-key-when-we-have-established-n.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From aaf67ea6dec9a648153cae981c5f245c0ba3d1d4 Mon Sep 17 00:00:00 2001
From: Daniel Kahn Gillmor &lt;dkg@fifthhorseman.net&gt;
Date: Tue, 13 Sep 2016 11:35:31 -0400
Subject: [PATCH 2/7] subkey validity of an key when we have established no
 trust anchors

This apparently isn&#39;t tested by deep comparisons, though, so it was
never caught.
---
 t/get_public_keys.t | 2 +-
 t/get_secret_keys.t | 2 +-
 2 files changed, 2 insertions&#40;+&#41;, 2 deletions&#40;-&#41;

diff --git a/t/get_public_keys.t b/t/get_public_keys.t
index 53db021..73e320b 100644
--- a/t/get_public_keys.t
+++ b/t/get_public_keys.t
@@ -175,7 +175,7 @@ TEST
     ];
 
     my $subkey = GnuPG::SubKey-&gt;new
-      &#40; validity                 =&gt; &#39;u&#39;,
+      &#40; validity                 =&gt; &#39;-&#39;,
         length                   =&gt; 768,
         algo_num                 =&gt; 16,
         hex_id                   =&gt; &#39;ADB99D9C2E854A6B&#39;,
diff --git a/t/get_secret_keys.t b/t/get_secret_keys.t
index 3a1d99f..7bba083 100644
--- a/t/get_secret_keys.t
+++ b/t/get_secret_keys.t
@@ -48,7 +48,7 @@ TEST
 
 
     my $subkey = GnuPG::SubKey-&gt;new
-      &#40; validity                 =&gt; &#39;u&#39;,
+      &#40; validity                 =&gt; &#39;-&#39;,
         length                   =&gt; 768,
         algo_num                 =&gt; 16,
         hex_id                   =&gt; &#39;ADB99D9C2E854A6B&#39;,
-- 
2.9.3

</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1668988/895682/0003-ensure-that-test-covers-all-signatures.patch">Download 0003-ensure-that-test-covers-all-signatures.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From f055042f0aacd0037043e03305b9dca37316a078 Mon Sep 17 00:00:00 2001
From: Daniel Kahn Gillmor &lt;dkg@fifthhorseman.net&gt;
Date: Tue, 13 Sep 2016 11:39:04 -0400
Subject: [PATCH 3/7] ensure that test covers all signatures

The earlier test wasn&#39;t reporting on one of the known self-sigs for
the test key for some reason.

This change ensures that all known signatures are present.
---
 t/get_public_keys.t | 12 +++++++++++-
 1 file changed, 11 insertions&#40;+&#41;, 1 deletion&#40;-&#41;

diff --git a/t/get_public_keys.t b/t/get_public_keys.t
index 73e320b..9e96f7d 100644
--- a/t/get_public_keys.t
+++ b/t/get_public_keys.t
@@ -83,7 +83,17 @@ TEST
                             date_string =&gt; &#39;2000-02-06&#39;,
                             hex_id =&gt; &#39;53AE596EF950DA9C&#39;,
                             sig_class =&gt; 0x13,
-                            validity =&gt; &#39;!&#39;&#41;&#41;;
+                            validity =&gt; &#39;!&#39;&#41;,
+      GnuPG::Signature-&gt;new&#40;
+                            date =&gt; 1177086329,
+                            algo_num =&gt; 17,
+                            is_exportable =&gt; 1,
+                            user_id_string =&gt; &#39;GnuPG test key &#40;for testing purposes only&#41;&#39;,
+                            date_string =&gt; &#39;2007-04-20&#39;,
+                            hex_id =&gt; &#39;53AE596EF950DA9C&#39;,
+                            sig_class =&gt; 0x13,
+                            validity =&gt; &#39;!&#39;&#41;,
+                          &#41;;
 
     my $uid1 = GnuPG::UserId-&gt;new&#40; as_string =&gt;  &#39;Foo Bar &#40;1&#41;&#39;,
                                    validity =&gt; &#39;-&#39;&#41;;
-- 
2.9.3

</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1668988/895683/0004-add-gpg_is_modern-to-test-suite.patch">Download 0004-add-gpg_is_modern-to-test-suite.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From decf5614281405d837675e74fdb0b2e00d8cf8a7 Mon Sep 17 00:00:00 2001
From: Daniel Kahn Gillmor &lt;dkg@fifthhorseman.net&gt;
Date: Tue, 13 Sep 2016 14:31:38 -0400
Subject: [PATCH 4/7] add $gpg_is_modern to test suite

MyTestSpecific.pm now produces a new variable indicating whether it
the version of GnuPG we run against is from the &#34;Modern&#34; line of GnuPG
development &#40;2.1 or later&#41;.  This will be useful when comparing output
that we can&#39;t expect from earlier versions.
---
 t/MyTestSpecific.pm | 7 +++++--
 1 file changed, 5 insertions&#40;+&#41;, 2 deletions&#40;-&#41;

diff --git a/t/MyTestSpecific.pm b/t/MyTestSpecific.pm
index 1af98ae..a309698 100644
--- a/t/MyTestSpecific.pm
+++ b/t/MyTestSpecific.pm
@@ -29,17 +29,20 @@ use GnuPG::Handles;
 use vars qw&#40; @ISA           @EXPORT
              $stdin         $stdout           $stderr
              $gpg_program   $handles          $gnupg
-             %texts
+             %texts         $gpg_is_modern
            &#41;;
 
 @ISA    = qw&#40; Exporter &#41;;
 @EXPORT = qw&#40; stdin                  stdout          stderr
               gnupg_program handles  reset_handles
-              texts                  file_match
+              texts                  file_match      gpg_is_modern
             &#41;;
 
 $gnupg = GnuPG::Interface-&gt;new&#40; passphrase =&gt; &#39;test&#39; &#41;;
 
+my @version = split&#40;&#39;\.&#39;, $gnupg-&gt;version&#40;&#41;&#41;;
+$gpg_is_modern = &#40;$version[0] &gt; 2 || &#40;$version[0] == 2 &#38;&#38; $version[1] &gt;= 1&#41;&#41;;
+
 $gnupg-&gt;options-&gt;hash_init&#40; homedir              =&gt; &#39;test/gnupghome&#39;,
                             armor                =&gt; 1,
                             meta_interactive     =&gt; 0,
-- 
2.9.3

</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1668988/895684/0005-Modern-GnuPG-2.1-reports-more-detail-about-secret-ke.patch">Download 0005-Modern-GnuPG-2.1-reports-more-detail-about-secret-ke.patch</a><br />
<span class="downloadcontenttype">text/x-diff 5.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 4485328c396ad82f0df7833e766913d40d6a5d10 Mon Sep 17 00:00:00 2001
From: Daniel Kahn Gillmor &lt;dkg@fifthhorseman.net&gt;
Date: Tue, 13 Sep 2016 14:12:40 -0400
Subject: [PATCH 5/7] Modern GnuPG &#40;2.1&#41; reports more detail about secret keys

the GnuPG &#34;modern&#34; suite &#40;version 2.1 or later&#41; reports more detail
about secret keys than previous versions did.  In particular, it
reports stored ownertrust, public key data, and designated revokers
for secret keys.  Older versions only reported those attributes for
public keys.

This patch adjusts the test suite to ensure that our handmade key
matches the produced key when /usr/bin/gpg is supplied by the modern
suite.
---
 t/get_secret_keys.t | 66 +++++++++++++++++++++++++++++++++++++++++++----------
 1 file changed, 54 insertions&#40;+&#41;, 12 deletions&#40;-&#41;

diff --git a/t/get_secret_keys.t b/t/get_secret_keys.t
index 7bba083..c798cce 100644
--- a/t/get_secret_keys.t
+++ b/t/get_secret_keys.t
@@ -23,16 +23,34 @@ TEST
     return 0 unless @returned_keys == 1;
 
     $given_key = shift @returned_keys;
-
-    $handmade_key = GnuPG::PrimaryKey-&gt;new
-      &#40; length                 =&gt; 1024,
+    my $pubkey_data = [
+     Math::BigInt-&gt;from_hex&#40;&#39;0x&#39;.
+      &#39;88FCAAA5BCDCD52084D46143F44ED1715A339794641158DE03AA2092AFD3174E3DCA2CB7DF2DDC6FEDF7C3620F5A8BDAD06713E6153F8748DD76CB97305F30CBA8F8801DB47FAC11EED725F55672CB9BDAD629178A677CBB089B3E8AE0D9A9AD7741697A35F2868C62D25670994A92D810480173DC24263EEA0F103A43C0B64B&#39;&#41;,
+     Math::BigInt-&gt;from_hex&#40;&#39;0x&#39;.
+      &#39;8F2A3842C70FF17660CBB78C78FC93F534AB9A17&#39;&#41;,
+     Math::BigInt-&gt;from_hex&#40;&#39;0x&#39;.
+      &#39;83E348C2AA65F56DE84E8FDCE6DA7B0991B1C75EC8CA446FA85869A43350907BFF36BE512385E8E7E095578BB2138C04E318495873218286DE2B8C86F36EA670135434967AC798EBA28581F709F0C6B696EB512D3E561E381A06E4B5239BCC655015F9A926C74E4B859B26EAD604F208A556511A76A40EDCD9C38E6BD82CCCB4&#39;&#41;,
+     Math::BigInt-&gt;from_hex&#40;&#39;0x&#39;.
+      &#39;80DE04C85E30C9D62C13F90CFF927A84A5A59D0900B3533D4D6193FEF8C5DAEF9FF8A7D5F76B244FBC17644F50D524E0B19CD3A4B5FC2D78DAECA3FE58FA1C1A64E6C7B96C4EE618173543163A72EF954DFD593E84342699096E9CA76578AC1DE3D893BCCD0BF470CEF625FAF816A0F503EF75C18C6173E35C8675AF919E5704&#39;&#41;
+    ];
+
+
+    my $args = {
+        length                 =&gt; 1024,
         algo_num               =&gt; 17,
         hex_id                 =&gt; &#39;53AE596EF950DA9C&#39;,
         creation_date          =&gt; 949813093,
         creation_date_string   =&gt; &#39;2000-02-06&#39;,
-        owner_trust            =&gt; &#39;&#39;, # secret keys do not report ownertrust?
+        owner_trust            =&gt; &#39;-&#39;,
         usage_flags            =&gt; &#39;scaESCA&#39;,
-      &#41;;
+        pubkey_data            =&gt; $pubkey_data,
+    };
+    if &#40;!$gpg_is_modern&#41; {
+      # older versions don&#39;t report ownertrust or pubkey_data for secret keys:
+      delete $args-&gt;{pubkey_data};
+      $args-&gt;{owner_trust} = &#39;&#39;;
+    }
+    $handmade_key = GnuPG::PrimaryKey-&gt;new&#40;$args&#41;;
 
     $handmade_key-&gt;fingerprint
       &#40; GnuPG::Fingerprint-&gt;new&#40; as_hex_string =&gt;
@@ -42,20 +60,42 @@ TEST
 
     $handmade_key-&gt;push_user_ids&#40;
       GnuPG::UserId-&gt;new&#40; as_string =&gt; &#39;GnuPG test key &#40;for testing purposes only&#41;&#39;,
-                          validity =&gt; &#39;&#39;&#41;, # secret keys do not report uid validity?
+                          validity =&gt; $args-&gt;{owner_trust}&#41;,
       GnuPG::UserId-&gt;new&#40; as_string =&gt; &#39;Foo Bar &#40;1&#41;&#39;,
-                          validity =&gt; &#39;&#39;&#41;&#41;; # secret keys do not report uid validity?
-
-
-    my $subkey = GnuPG::SubKey-&gt;new
-      &#40; validity                 =&gt; &#39;-&#39;,
+                          validity =&gt; $args-&gt;{owner_trust}&#41;&#41;;
+
+    my $revoker = GnuPG::Revoker-&gt;new
+      &#40; algo_num       =&gt; 17,
+        class          =&gt; 0x80,
+        fingerprint    =&gt; GnuPG::Fingerprint-&gt;new&#40; as_hex_string =&gt;
+                                                   &#39;4F863BBBA8166F0A340F600356FFD10A260C4FA3&#39;&#41;,
+        &#41;;
+
+    my $subkey_pub_data = [
+     Math::BigInt-&gt;from_hex&#40;&#39;0x&#39;.
+      &#39;8831982DADC4C5D05CBB01D9EAF612131DDC9C24CEA7246557679423FB0BA42F74D10D8E7F5564F6A4FB8837F8DC4A46571C19B122E6DF4B443D15197A6A22688863D0685FADB6E402316DAA9B560D1F915475364580A67E6DF0A727778A5CF3&#39;&#41;,
+     Math::BigInt-&gt;from_hex&#40;&#39;0x&#39;.
+      &#39;6&#39;&#41;,
+     Math::BigInt-&gt;from_hex&#40;&#39;0x&#39;.
+      &#39;2F3850FF130C6AC9AA0962720E86539626FAA9B67B33A74DFC0DE843FF3E90E43E2F379EE0182D914FA539CCCF5C83A20DB3A7C45E365B8A2A092E799A3DFF4AD8274EB977BAAF5B1AFB2ACB8D6F92454F01682F555565E73E56793C46EF7C3E&#39;&#41;
+    ];
+
+    my $sub_args = {
+        validity                 =&gt; &#39;-&#39;,
         length                   =&gt; 768,
         algo_num                 =&gt; 16,
         hex_id                   =&gt; &#39;ADB99D9C2E854A6B&#39;,
         creation_date            =&gt; 949813119,
         creation_date_string     =&gt; &#39;2000-02-06&#39;,
         usage_flags              =&gt; &#39;e&#39;,
-      &#41;;
+        pubkey_data              =&gt; $subkey_pub_data,
+      };
+
+    if &#40;!$gpg_is_modern&#41; {
+      # older versions do not report pubkey data for secret keys
+      delete $sub_args-&gt;{pubkey_data};
+    }
+    my $subkey = GnuPG::SubKey-&gt;new&#40;$sub_args&#41;;
 
     $subkey-&gt;fingerprint
       &#40; GnuPG::Fingerprint-&gt;new&#40; as_hex_string =&gt;
@@ -64,6 +104,8 @@ TEST
       &#41;;
 
     $handmade_key-&gt;push_subkeys&#40; $subkey &#41;;
+    # older versions do not report designated revokers for secret keys
+    $handmade_key-&gt;push_revokers&#40; $revoker &#41; if &#40;$gpg_is_modern&#41;;
 
     $handmade_key-&gt;compare&#40; $given_key &#41;;
 };
-- 
2.9.3

</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1668988/895685/0006-test-suite-match-plaintext-output-across-versions-of.patch">Download 0006-test-suite-match-plaintext-output-across-versions-of.patch</a><br />
<span class="downloadcontenttype">text/x-diff 3.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 7a4a380fdec841d87627acdfaff6aae104b23d95 Mon Sep 17 00:00:00 2001
From: Daniel Kahn Gillmor &lt;dkg@fifthhorseman.net&gt;
Date: Tue, 13 Sep 2016 14:46:13 -0400
Subject: [PATCH 6/7] test suite:  match plaintext output across versions of
 GnuPG

The human-readable version of --list-keys is *not* expected to be
static over time or as the user&#39;s environment changes &#40;e.g. LANG or
LC_MESSAGES&#41;, so expecting it to be machine-parseable is probably a
mistake.

That said, some users might want to pull textual information about
specific keys to display directly to the user, so it&#39;s not a terrible
idea to have it in the test suite.

Modern GnuPG &#40;2.1 or later&#41; changes the default structure of the
human-readable output in a few significant ways:

 * it writes the path to the keyring as an absolute path, even if
   $GNUPGHOME is set to a non-absolute path.

 * it shows the calculated user id validity by default &#40;see
   show-uid-validity in gpg&#39;s --list-options&#41;.  &#40;note that this is a
   translated string, so that &#34;unknown&#34; &#40;in the default C locale&#41;
   becomes &#34;inconnue&#34; when LANG or LC_MESSAGES is set to fr_CH.UTF-8,
   for example.

 * it writes the key algorithm names differently &#40;e.g. rsa2048 instead
   of 2048R&#41;

 * it does not display the key ID at all by default

 * it displays the full fingerprint in compact form by default

This changeset fixes the test suite so that it can do a rough
verification of the human-readable text output by list_secret_keys in
the C locale in modern versions of GnuPG, while leaving it working for
older GnuPG suites.
---
 t/list_secret_keys.t           | 13 +++++++++++--
 test/secret-keys/1.modern.test |  8 ++++++++
 2 files changed, 19 insertions&#40;+&#41;, 2 deletions&#40;-&#41;
 create mode 100644 test/secret-keys/1.modern.test

diff --git a/t/list_secret_keys.t b/t/list_secret_keys.t
index 1fe9b7e..e64161c 100644
--- a/t/list_secret_keys.t
+++ b/t/list_secret_keys.t
@@ -16,13 +16,20 @@ TEST
 {
     reset_handles&#40;&#41;;
 
+    $ENV{LC_MESSAGES} = &#39;C&#39;;
     my $pid = $gnupg-&gt;list_secret_keys&#40; handles =&gt; $handles &#41;;
     close $stdin;
 
     $outfile = &#39;test/secret-keys/1.out&#39;;
     my $out = IO::File-&gt;new&#40; &#34;&gt; $outfile&#34; &#41;
       or die &#34;cannot open $outfile for writing: $ERRNO&#34;;
-    $out-&gt;print&#40; &lt;$stdout&gt; &#41;;
+    while &#40;&lt;$stdout&gt;&#41; {
+      if &#40;$gpg_is_modern &#38;&#38; /\/.*\/test\/gnupghome\/pubring.kbx$/&#41; {
+        $out-&gt;print&#40;&#34;test/gnupghome/pubring.kbx\n&#34;&#41;;
+      } else {
+        $out-&gt;print&#40; $_ &#41;;
+      }
+    }
     close $stdout;
     $out-&gt;close&#40;&#41;;
     waitpid $pid, 0;
@@ -33,7 +40,9 @@ TEST
 
 TEST
 {
-    my @files_to_test = &#40; &#39;test/secret-keys/1.0.test&#39; &#41;;
+    my $suffix = &#39;0&#39;;
+    $suffix = &#39;modern&#39; if &#40;$gpg_is_modern&#41;;
+    my @files_to_test = &#40; &#39;test/secret-keys/1.&#39;.$suffix.&#39;.test&#39; &#41;;
 
     return file_match&#40; $outfile, @files_to_test &#41;;
 };
diff --git a/test/secret-keys/1.modern.test b/test/secret-keys/1.modern.test
new file mode 100644
index 0000000..7ee9ba9
--- /dev/null
+++ b/test/secret-keys/1.modern.test
@@ -0,0 +1,8 @@
+test/gnupghome/pubring.kbx
+-------------------------------------------------------------
+sec   dsa1024 2000-02-06 [SCA]
+      93AFC4B1B0288A104996B44253AE596EF950DA9C
+uid           [ unknown] GnuPG test key &#40;for testing purposes only&#41;
+uid           [ unknown] Foo Bar &#40;1&#41;
+ssb   elg768 2000-02-06 [E]
+
-- 
2.9.3

</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1668988/895686/0007-fix-test_default_key_passphrase-when-passphrase-come.patch">Download 0007-fix-test_default_key_passphrase-when-passphrase-come.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From f5ca0742dd1f724de1765679b493d4cfb7ea216b Mon Sep 17 00:00:00 2001
From: Daniel Kahn Gillmor &lt;dkg@fifthhorseman.net&gt;
Date: Tue, 13 Sep 2016 15:22:27 -0400
Subject: [PATCH 7/7] fix test_default_key_passphrase when passphrase comes
 from agent

In the modern GnuPG suite, where the passphrase is always managed by
the agent, gpg itself doesn&#39;t emit the GOOD_PASSPHRASE status.
Instead, if signing is successful it emits plain old SIG_CREATED.

There are probably even better ways to test whether a given key is
unlocked in this case, but this is a straightforward baseline fix that
should get this part of the test suite to pass with all available
versions of GnuPG.
---
 lib/GnuPG/Interface.pm | 2 +-
 1 file changed, 1 insertion&#40;+&#41;, 1 deletion&#40;-&#41;

diff --git a/lib/GnuPG/Interface.pm b/lib/GnuPG/Interface.pm
index 83a4b1a..1f1e6d5 100644
--- a/lib/GnuPG/Interface.pm
+++ b/lib/GnuPG/Interface.pm
@@ -808,7 +808,7 @@ sub test_default_key_passphrase&#40;&#41; {
 
     # all we realy want to check is the status fh
     while &#40;&lt;$status&gt;&#41; {
-        if &#40;/^\[GNUPG:\]\s*GOOD_PASSPHRASE/&#41; {
+        if &#40;/^\[GNUPG:\]\s*&#40;GOOD_PASSPHRASE|SIG_CREATED&#41;/&#41; {
             waitpid $pid, 0;
             return 1;
         }
-- 
2.9.3

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1669007" href="/Public/Bug/Display.html?id=102651#txn-1669007">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;14&nbsp;14:49:39&nbsp;2016</span>
    <span class="description">dkg [...] fifthhorseman.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Jesse Vincent &lt;jesse [...] fsck.com&gt;, 834281 [...] bugs.debian.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #102651] patches to fix the GnuPG::Interface test suite to work with GnuPG 2.1</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 14 Sep 2016 14:49:19 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-GnuPG-Interface [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Daniel Kahn Gillmor &lt;dkg [...] fifthhorseman.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1669007/895705/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/895705">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 658b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed 2016-09-14 13:26:40 -0400, Daniel Kahn Gillmor wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Attached is a series of 7 patches that let the GnuPG::Interface test
&gt; suite work with GnuPG 2.1.
&gt;
&gt; These patches can also be found on the improve-test-suite branch at
&gt; git://lair.fifthhorseman.net/~dkg/gnupg-interface &#40;commit ID
&gt; f5ca0742dd1f724de1765679b493d4cfb7ea216b&#41;.
</div>
Sorry: i&#39;ve made minor corrections to patch 6 to avoid breakage when it
was built in a new location.  The newly-revised patch is attached.

I&#39;ve also force-pushed these changes to my improve-test-suite branch,
and the correct git commit ID is now:
d831296e0c18f0f9dba8e63193f5457792744f88.

Regards,

        --dkg
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1669007/895706/0006-test-suite-match-plaintext-output-across-versions-of.patch">Download 0006-test-suite-match-plaintext-output-across-versions-of.patch</a><br />
<span class="downloadcontenttype">text/x-diff 3.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 9e4f77faaca087de35101b5d414180aaad9a709f Mon Sep 17 00:00:00 2001
From: Daniel Kahn Gillmor &lt;dkg@fifthhorseman.net&gt;
Date: Tue, 13 Sep 2016 14:46:13 -0400
Subject: [PATCH 6/7] test suite:  match plaintext output across versions of
 GnuPG

The human-readable version of --list-keys is *not* expected to be
static over time or as the user&#39;s environment changes &#40;e.g. LANG or
LC_MESSAGES&#41;, so expecting it to be machine-parseable is probably a
mistake.

That said, some users might want to pull textual information about
specific keys to display directly to the user, so it&#39;s not a terrible
idea to have it in the test suite.

Modern GnuPG &#40;2.1 or later&#41; changes the default structure of the
human-readable output in a few significant ways:

 * it writes the path to the keyring as an absolute path, even if
   $GNUPGHOME is set to a non-absolute path.

 * it shows the calculated user id validity by default &#40;see
   show-uid-validity in gpg&#39;s --list-options&#41;.  &#40;note that this is a
   translated string, so that &#34;unknown&#34; &#40;in the default C locale&#41;
   becomes &#34;inconnue&#34; when LANG or LC_MESSAGES is set to fr_CH.UTF-8,
   for example.

 * it writes the key algorithm names differently &#40;e.g. rsa2048 instead
   of 2048R&#41;

 * it does not display the key ID at all by default

 * it displays the full fingerprint in compact form by default

This changeset fixes the test suite so that it can do a rough
verification of the human-readable text output by list_secret_keys in
the C locale in modern versions of GnuPG, while leaving it working for
older GnuPG suites.
---
 t/list_secret_keys.t           | 15 +++++++++++++--
 test/secret-keys/1.modern.test |  8 ++++++++
 2 files changed, 21 insertions&#40;+&#41;, 2 deletions&#40;-&#41;
 create mode 100644 test/secret-keys/1.modern.test

diff --git a/t/list_secret_keys.t b/t/list_secret_keys.t
index 1fe9b7e..51e3651 100644
--- a/t/list_secret_keys.t
+++ b/t/list_secret_keys.t
@@ -16,13 +16,22 @@ TEST
 {
     reset_handles&#40;&#41;;
 
+    $ENV{LC_MESSAGES} = &#39;C&#39;;
     my $pid = $gnupg-&gt;list_secret_keys&#40; handles =&gt; $handles &#41;;
     close $stdin;
 
     $outfile = &#39;test/secret-keys/1.out&#39;;
     my $out = IO::File-&gt;new&#40; &#34;&gt; $outfile&#34; &#41;
       or die &#34;cannot open $outfile for writing: $ERRNO&#34;;
-    $out-&gt;print&#40; &lt;$stdout&gt; &#41;;
+    while &#40;&lt;$stdout&gt;&#41; {
+      if &#40;$gpg_is_modern &#38;&#38; /^\/.*\/test\/gnupghome\/pubring.kbx$/&#41; {
+        $out-&gt;print&#40;&#34;test/gnupghome/pubring.kbx\n&#34;&#41;;
+      } elsif &#40;$gpg_is_modern &#38;&#38; /^--*$/&#41; {
+        $out-&gt;print&#40;&#34;--------------------------\n&#34;&#41;;
+      } else {
+        $out-&gt;print&#40; $_ &#41;;
+      }
+    }
     close $stdout;
     $out-&gt;close&#40;&#41;;
     waitpid $pid, 0;
@@ -33,7 +42,9 @@ TEST
 
 TEST
 {
-    my @files_to_test = &#40; &#39;test/secret-keys/1.0.test&#39; &#41;;
+    my $suffix = &#39;0&#39;;
+    $suffix = &#39;modern&#39; if &#40;$gpg_is_modern&#41;;
+    my @files_to_test = &#40; &#39;test/secret-keys/1.&#39;.$suffix.&#39;.test&#39; &#41;;
 
     return file_match&#40; $outfile, @files_to_test &#41;;
 };
diff --git a/test/secret-keys/1.modern.test b/test/secret-keys/1.modern.test
new file mode 100644
index 0000000..3e46407
--- /dev/null
+++ b/test/secret-keys/1.modern.test
@@ -0,0 +1,8 @@
+test/gnupghome/pubring.kbx
+--------------------------
+sec   dsa1024 2000-02-06 [SCA]
+      93AFC4B1B0288A104996B44253AE596EF950DA9C
+uid           [ unknown] GnuPG test key &#40;for testing purposes only&#41;
+uid           [ unknown] Foo Bar &#40;1&#41;
+ssb   elg768 2000-02-06 [E]
+
-- 
2.9.3

</div></div>
</div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1669007/895707/signature.asc">Download signature.asc</a><br />
<span class="downloadcontenttype">application/pgp-signature 930b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1676022" href="/Public/Bug/Display.html?id=102651#txn-1676022">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;11&nbsp;22:23:01&nbsp;2016</span>
    <span class="description">DKG [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1676022/899479/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/899479">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 396b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Mar 09 10:29:56 2015, dimstar@opensuse.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It seems as if GnuP-Interface &#40;tested 0.52, so latest release&#41; does not
&gt; work nicely with gnup 2.1.1, as can currently be found in many
&gt; distributions.
</div>

Please also see <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/bestpractical/gnupg-interface/pull/1">https://github.com/bestpractical/gnupg-interface/pull/1</a></span> which contains the patches pasted above, plus several more to make GnuPG::Interface work properly with 2.1.x.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1901270" href="/Public/Bug/Display.html?id=102651#txn-1901270">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;07&nbsp;06:33:49&nbsp;2020</span>
    <span class="description">dom [...] earth.li -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1901270/1018972/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1018972">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 152b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Noting &#40;to echo <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/bestpractical/gnupg-interface/pull/1#issuecomment-640168050&#41;">https://github.com/bestpractical/gnupg-interface/pull/1#issuecomment-640168050&#41;</a></span> that with the 1.00 release, this can possibly be closed?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1901402" href="/Public/Bug/Display.html?id=102651#txn-1901402">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;08&nbsp;08:35:45&nbsp;2020</span>
    <span class="description">BPS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1901402/1019016/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1019016">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 539b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Jun 07 06:33:49 2020, dom@earth.li wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Noting &#40;to echo <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/bestpractical/gnupg-">https://github.com/bestpractical/gnupg-</a></span>
&gt; interface/pull/1#issuecomment-640168050&#41; that with the 1.00 release,
&gt; this can possibly be closed?
</div>
This is correct. Version 1.00 of GnuPG::Interface has been released to CPAN and it now supports the new versions of GnuPG, currently 2.2. Versions 2.0 and 2.1, although still available in some packaging systems, are currently listed as end of life on the GnuPG site:

<span class="clickylink"><a target="new" rel="nofollow" href="https://gnupg.org/download/index.html">https://gnupg.org/download/index.html</a></span>

Resolving this ticket.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1901405" href="/Public/Bug/Display.html?id=102651#txn-1901405">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;08&nbsp;08:35:47&nbsp;2020</span>
    <span class="description">BPS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.832862</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
