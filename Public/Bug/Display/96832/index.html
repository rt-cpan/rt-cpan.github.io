<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #96832 for Parallel-ForkManager: Possible bug on Parallel ForkManager</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #96832 for Parallel-ForkManager: Possible bug on Parallel ForkManager</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Parallel-ForkManager/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Parallel-ForkManager/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Parallel-ForkManager/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Parallel-ForkManager/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/dluxhu/perl-parallel-forkmanager/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Parallel-ForkManager">Parallel-ForkManager CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">96832</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Parallel-ForkManager/Active/">Parallel-ForkManager</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">dlux [...] dlux.hu
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
gilles.xiberras [...] orange.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-24602-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-24603-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;30&nbsp;03:39:01&nbsp;2014</span>
    <span class="description">gilles.xiberras [...] orange.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Possible bug on Parallel ForkManager</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 30 Jun 2014 07:38:47 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Parallel-ForkManager [...] rt.cpan.org&#34; &lt;bug-Parallel-ForkManager [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;gilles.xiberras [...] orange.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello guys,

First of all I want to thank you for this magic library that allows me to use the performances of my hardware the best I can and reduces the processing time of my programs.!
Ok here is my problem ....

I use :
-On Windows 7 Profesionnal
-Active Perl 5.16.3 build 1603
-Parallel Fork Manager 1.06

I&#39;ve this kind of message : &#40;Program stopped !&#41;
Free to wrong pool 2c49f50 not 3882c0 at c:\perl64\site\lib\Parallel\ForkManager.pm line 513.

My initial PROGRAM :
use strict;
use Parallel::ForkManager;
use warnings;

my $dir_src_data_master_DBM = &#34;../../../DATABASES/MASTER/DBM/&#34;;

#open Hash table stored on the Hard disk
my %h_probe_matrix_gxi_original;
dbmopen&#40;%h_probe_matrix_gxi_original, &#34;${dir_src_data_master_DBM}PROBE_MATRIX_GXI&#34;, 0444&#41;;

my $MAX_PROCESSES = 10;                                  # nb process.
my $pm = Parallel::ForkManager-&gt;new &#40;$MAX_PROCESSES&#41;;

my $i;
for &#40;$i = 0 ; $i &lt; 100 ; $i++&#41;
{
    my $pid = $pm-&gt;start and next;
    print &#34;Hello\n&#34;;
    $pm-&gt;finish;
}

print &#34;End\n&#34;;

Description :
When You open a Hash table that has been stored on your hard drive and if you do not close it before launching the parallel process then you have the error message.
So I suppose that the fact that the Hash table still opened before running the parallel processes is the problem.


How to Solve the issue :
If you want to use this hash table .... You have to do something like that  &#40;associate the initial hash table to a new one  and close the initial one&#41;.
my %h_probe_matrix_gxi;
%h_probe_matrix_gxi = %h_probe_matrix_gxi_original;
dbmclose&#40;%h_probe_matrix_gxi_original&#41;;


PERFORMANCE ISSUE :
Loading the hash table as a global var ... degrades the performance drastically.

My Solution :
This does not look fine, as every child will allocate specific memory to load the hash table, however this solves the error message and the performance issue.


use strict;
use Parallel::ForkManager;
use warnings;

my $dir_src_data_master_DBM = &#34;../../../DATABASES/MASTER/DBM/&#34;;
my $MAX_PROCESSES = 10 ;
my $pm = Parallel::ForkManager-&gt;new &#40;$MAX_PROCESSES&#41;;

my $i;
for &#40;$i = 0 ; $i &lt; 100 ; $i++&#41;
{
    my $pid = $pm-&gt;start and next;
                my %h_probe_matrix_gxi_original;
                dbmopen&#40;%h_probe_matrix_gxi_original, &#34;${dir_src_data_master_DBM}PROBE_MATRIX_GXI&#34;, 0444&#41;;
                print &#34;Hello\n&#34;;
                dbmclose&#40;%h_probe_matrix_gxi_original&#41;;
    $pm-&gt;finish;
}

print &#34;End\n&#34;;


Do not hesitate to contact me should you require any additional elements.

Best regards Gilles.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">_________________________________________________________________________________________________________________________

Ce message et ses pieces jointes peuvent contenir des informations confidentielles ou privilegiees et ne doivent donc
pas etre diffuses, exploites ou copies sans autorisation. Si vous avez recu ce message par erreur, veuillez le signaler
a l&#39;expediteur et le detruire ainsi que les pieces jointes. Les messages electroniques etant susceptibles d&#39;alteration,
Orange decline toute responsabilite si ce message a ete altere, deforme ou falsifie. Merci.

This message and its attachments may contain confidential or privileged information that may be protected by law;
they should not be distributed, used or copied without authorisation.
If you have received this email in error, please notify the sender and delete this message and its attachments.
As emails may be altered, Orange is not liable for messages that have been modified, changed or falsified.
Thank you.
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;13&nbsp;13:19:29&nbsp;2014</span>
    <span class="description">dlux [...] dlux.hu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dear Gilles,

Thanks for the report. It looks like the dbm library does not support the fork&#40;&#41; operation on Windows. It is pretty much a standard thing and I don&#39;t see how we can solve it in P:FM. Can you maybe try to use another DBM library if there is any? Maybe one that is perl-only &#40;no C/C++&#41;?

Balázs

On Mon Jun 30 03:39:01 2014, gilles.xiberras@orange.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello guys,
&gt; 
&gt; First of all I want to thank you for this magic library that allows me
&gt; to use the performances of my hardware the best I can and reduces the
&gt; processing time of my programs.!
&gt; Ok here is my problem ....
&gt; 
&gt; I use :
&gt; -On Windows 7 Profesionnal
&gt; -Active Perl 5.16.3 build 1603
&gt; -Parallel Fork Manager 1.06
&gt; 
&gt; I&#39;ve this kind of message : &#40;Program stopped !&#41;
&gt; Free to wrong pool 2c49f50 not 3882c0 at
&gt; c:\perl64\site\lib\Parallel\ForkManager.pm line 513.
&gt; 
&gt; My initial PROGRAM :
&gt; use strict;
&gt; use Parallel::ForkManager;
&gt; use warnings;
&gt; 
&gt; my $dir_src_data_master_DBM = &#34;../../../DATABASES/MASTER/DBM/&#34;;
&gt; 
&gt; #open Hash table stored on the Hard disk
&gt; my %h_probe_matrix_gxi_original;
&gt; dbmopen&#40;%h_probe_matrix_gxi_original,
&gt; &#34;${dir_src_data_master_DBM}PROBE_MATRIX_GXI&#34;, 0444&#41;;
&gt; 
&gt; my $MAX_PROCESSES = 10;                                  # nb process.
&gt; my $pm = Parallel::ForkManager-&gt;new &#40;$MAX_PROCESSES&#41;;
&gt; 
&gt; my $i;
&gt; for &#40;$i = 0 ; $i &lt; 100 ; $i++&#41;
&gt; {
&gt;     my $pid = $pm-&gt;start and next;
&gt;     print &#34;Hello\n&#34;;
&gt;     $pm-&gt;finish;
&gt; }
&gt; 
&gt; print &#34;End\n&#34;;
&gt; 
&gt; Description :
&gt; When You open a Hash table that has been stored on your hard drive and
&gt; if you do not close it before launching the parallel process then you
&gt; have the error message.
&gt; So I suppose that the fact that the Hash table still opened before
&gt; running the parallel processes is the problem.
&gt; 
&gt; 
&gt; How to Solve the issue :
&gt; If you want to use this hash table .... You have to do something like
&gt; that  &#40;associate the initial hash table to a new one  and close the
&gt; initial one&#41;.
&gt; my %h_probe_matrix_gxi;
&gt; %h_probe_matrix_gxi = %h_probe_matrix_gxi_original;
&gt; dbmclose&#40;%h_probe_matrix_gxi_original&#41;;
&gt; 
&gt; 
&gt; PERFORMANCE ISSUE :
&gt; Loading the hash table as a global var ... degrades the performance
&gt; drastically.
&gt; 
&gt; My Solution :
&gt; This does not look fine, as every child will allocate specific memory
&gt; to load the hash table, however this solves the error message and the
&gt; performance issue.
&gt; 
&gt; 
&gt; use strict;
&gt; use Parallel::ForkManager;
&gt; use warnings;
&gt; 
&gt; my $dir_src_data_master_DBM = &#34;../../../DATABASES/MASTER/DBM/&#34;;
&gt; my $MAX_PROCESSES = 10 ;
&gt; my $pm = Parallel::ForkManager-&gt;new &#40;$MAX_PROCESSES&#41;;
&gt; 
&gt; my $i;
&gt; for &#40;$i = 0 ; $i &lt; 100 ; $i++&#41;
&gt; {
&gt;     my $pid = $pm-&gt;start and next;
&gt;                 my %h_probe_matrix_gxi_original;
&gt;                 dbmopen&#40;%h_probe_matrix_gxi_original,
&gt; &#34;${dir_src_data_master_DBM}PROBE_MATRIX_GXI&#34;, 0444&#41;;
&gt;                 print &#34;Hello\n&#34;;
&gt;                 dbmclose&#40;%h_probe_matrix_gxi_original&#41;;
&gt;     $pm-&gt;finish;
&gt; }
&gt; 
&gt; print &#34;End\n&#34;;
&gt; 
&gt; 
&gt; Do not hesitate to contact me should you require any additional
&gt; elements.
&gt; 
&gt; Best regards Gilles.
&gt; 
&gt; _________________________________________________________________________________________________________________________
&gt; 
&gt; Ce message et ses pieces jointes peuvent contenir des informations
&gt; confidentielles ou privilegiees et ne doivent donc
&gt; pas etre diffuses, exploites ou copies sans autorisation. Si vous avez
&gt; recu ce message par erreur, veuillez le signaler
&gt; a l&#39;expediteur et le detruire ainsi que les pieces jointes. Les
&gt; messages electroniques etant susceptibles d&#39;alteration,
&gt; Orange decline toute responsabilite si ce message a ete altere,
&gt; deforme ou falsifie. Merci.
&gt; 
&gt; This message and its attachments may contain confidential or
&gt; privileged information that may be protected by law;
&gt; they should not be distributed, used or copied without authorisation.
&gt; If you have received this email in error, please notify the sender and
&gt; delete this message and its attachments.
&gt; As emails may be altered, Orange is not liable for messages that have
&gt; been modified, changed or falsified.
&gt; Thank you.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;13&nbsp;13:19:30&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;13&nbsp;13:19:31&nbsp;2014</span>
    <span class="description">dlux [...] dlux.hu -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;13&nbsp;13:20:18&nbsp;2014</span>
    <span class="description">dlux [...] dlux.hu -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;20&nbsp;17:14:30&nbsp;2014</span>
    <span class="description">dlux [...] dlux.hu -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;20&nbsp;17:27:29&nbsp;2014</span>
    <span class="description">dlux [...] dlux.hu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Feel free to reopen it if you have other comments.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;20&nbsp;17:27:30&nbsp;2014</span>
    <span class="description">dlux [...] dlux.hu -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;28&nbsp;08:00:30&nbsp;2014</span>
    <span class="description">gilles.xiberras [...] orange.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #96832] Possible bug on Parallel ForkManager</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 28 Jul 2014 12:00:11 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Parallel-ForkManager [...] rt.cpan.org&#34; &lt;bug-Parallel-ForkManager [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;gilles.xiberras [...] orange.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks Blazs,

I&#39;ve a trick.... 
Open the DBM, and load it into a new hash table, then cloase the DBM... and it works !

Cheers Gilles.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Szabo, Balazs via RT [mailto:bug-Parallel-ForkManager@rt.cpan.org] 
Sent: Sunday, July 13, 2014 19:20
To: XIBERRAS Gilles SCE/G2S
Subject: [rt.cpan.org #96832] Possible bug on Parallel ForkManager

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=96832">https://rt.cpan.org/Ticket/Display.html?id=96832</a></span> &gt;

Dear Gilles,

Thanks for the report. It looks like the dbm library does not support the fork&#40;&#41; operation on Windows. It is pretty much a standard thing and I don&#39;t see how we can solve it in P:FM. Can you maybe try to use another DBM library if there is any? Maybe one that is perl-only &#40;no C/C++&#41;?

Balázs

On Mon Jun 30 03:39:01 2014, gilles.xiberras@orange.com wrote:
<div class="message-stanza open">&gt; Hello guys,
&gt; 
&gt; First of all I want to thank you for this magic library that allows me 
&gt; to use the performances of my hardware the best I can and reduces the 
&gt; processing time of my programs.!
&gt; Ok here is my problem ....
&gt; 
&gt; I use :
&gt; -On Windows 7 Profesionnal
&gt; -Active Perl 5.16.3 build 1603
&gt; -Parallel Fork Manager 1.06
&gt; 
&gt; I&#39;ve this kind of message : &#40;Program stopped !&#41; Free to wrong pool 
&gt; 2c49f50 not 3882c0 at c:\perl64\site\lib\Parallel\ForkManager.pm line 
&gt; 513.
&gt; 
&gt; My initial PROGRAM :
&gt; use strict;
&gt; use Parallel::ForkManager;
&gt; use warnings;
&gt; 
&gt; my $dir_src_data_master_DBM = &#34;../../../DATABASES/MASTER/DBM/&#34;;
&gt; 
&gt; #open Hash table stored on the Hard disk my 
&gt; %h_probe_matrix_gxi_original; dbmopen&#40;%h_probe_matrix_gxi_original,
&gt; &#34;${dir_src_data_master_DBM}PROBE_MATRIX_GXI&#34;, 0444&#41;;
&gt; 
&gt; my $MAX_PROCESSES = 10;                                  # nb process.
&gt; my $pm = Parallel::ForkManager-&gt;new &#40;$MAX_PROCESSES&#41;;
&gt; 
&gt; my $i;
&gt; for &#40;$i = 0 ; $i &lt; 100 ; $i++&#41;
&gt; {
&gt;     my $pid = $pm-&gt;start and next;
&gt;     print &#34;Hello\n&#34;;
&gt;     $pm-&gt;finish;
&gt; }
&gt; 
&gt; print &#34;End\n&#34;;
&gt; 
&gt; Description :
&gt; When You open a Hash table that has been stored on your hard drive and 
&gt; if you do not close it before launching the parallel process then you 
&gt; have the error message.
&gt; So I suppose that the fact that the Hash table still opened before 
&gt; running the parallel processes is the problem.
&gt; 
&gt; 
&gt; How to Solve the issue :
&gt; If you want to use this hash table .... You have to do something like 
&gt; that  &#40;associate the initial hash table to a new one  and close the 
&gt; initial one&#41;.
&gt; my %h_probe_matrix_gxi;
&gt; %h_probe_matrix_gxi = %h_probe_matrix_gxi_original; 
&gt; dbmclose&#40;%h_probe_matrix_gxi_original&#41;;
&gt; 
&gt; 
&gt; PERFORMANCE ISSUE :
&gt; Loading the hash table as a global var ... degrades the performance 
&gt; drastically.
&gt; 
&gt; My Solution :
&gt; This does not look fine, as every child will allocate specific memory 
&gt; to load the hash table, however this solves the error message and the 
&gt; performance issue.
&gt; 
&gt; 
&gt; use strict;
&gt; use Parallel::ForkManager;
&gt; use warnings;
&gt; 
&gt; my $dir_src_data_master_DBM = &#34;../../../DATABASES/MASTER/DBM/&#34;; my 
&gt; $MAX_PROCESSES = 10 ; my $pm = Parallel::ForkManager-&gt;new 
&gt; &#40;$MAX_PROCESSES&#41;;
&gt; 
&gt; my $i;
&gt; for &#40;$i = 0 ; $i &lt; 100 ; $i++&#41;
&gt; {
&gt;     my $pid = $pm-&gt;start and next;
&gt;                 my %h_probe_matrix_gxi_original;
&gt;                 dbmopen&#40;%h_probe_matrix_gxi_original,
&gt; &#34;${dir_src_data_master_DBM}PROBE_MATRIX_GXI&#34;, 0444&#41;;
&gt;                 print &#34;Hello\n&#34;;
&gt;                 dbmclose&#40;%h_probe_matrix_gxi_original&#41;;
&gt;     $pm-&gt;finish;
&gt; }
&gt; 
&gt; print &#34;End\n&#34;;
&gt; 
&gt; 
&gt; Do not hesitate to contact me should you require any additional 
&gt; elements.
&gt; 
&gt; Best regards Gilles.
&gt; 
&gt; ______________________________________________________________________
&gt; ___________________________________________________
&gt; 
&gt; Ce message et ses pieces jointes peuvent contenir des informations 
&gt; confidentielles ou privilegiees et ne doivent donc pas etre diffuses, 
&gt; exploites ou copies sans autorisation. Si vous avez recu ce message 
&gt; par erreur, veuillez le signaler a l&#39;expediteur et le detruire ainsi 
&gt; que les pieces jointes. Les messages electroniques etant susceptibles 
&gt; d&#39;alteration, Orange decline toute responsabilite si ce message a ete 
&gt; altere, deforme ou falsifie. Merci.
&gt; 
&gt; This message and its attachments may contain confidential or 
&gt; privileged information that may be protected by law; they should not 
&gt; be distributed, used or copied without authorisation.
&gt; If you have received this email in error, please notify the sender and 
&gt; delete this message and its attachments.
&gt; As emails may be altered, Orange is not liable for messages that have 
&gt; been modified, changed or falsified.
&gt; Thank you.
</div>



<div class="message-stanza open">_________________________________________________________________________________________________________________________

Ce message et ses pieces jointes peuvent contenir des informations confidentielles ou privilegiees et ne doivent donc
pas etre diffuses, exploites ou copies sans autorisation. Si vous avez recu ce message par erreur, veuillez le signaler
a l&#39;expediteur et le detruire ainsi que les pieces jointes. Les messages electroniques etant susceptibles d&#39;alteration,
Orange decline toute responsabilite si ce message a ete altere, deforme ou falsifie. Merci.

This message and its attachments may contain confidential or privileged information that may be protected by law;
they should not be distributed, used or copied without authorisation.
If you have received this email in error, please notify the sender and delete this message and its attachments.
As emails may be altered, Orange is not liable for messages that have been modified, changed or falsified.
Thank you.
</div></div></div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
