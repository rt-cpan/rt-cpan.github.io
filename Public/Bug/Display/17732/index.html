<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #17732 for CGI-Application-Plugin-HTDot: PATCH: bring load_tmpl&#40;&#41; up to date to match CGI::Application</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #17732 for CGI-Application-Plugin-HTDot: PATCH: bring load_tmpl&#40;&#41; up to date to match CGI::Application</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/CGI-Application-Plugin-HTDot/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/CGI-Application-Plugin-HTDot/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/CGI-Application-Plugin-HTDot/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/CGI-Application-Plugin-HTDot/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/CGI-Application-Plugin-HTDot">CGI-Application-Plugin-HTDot CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">17732</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/CGI-Application-Plugin-HTDot/Active/">CGI-Application-Plugin-HTDot</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
mark [...] summersault.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-5496-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.03    </td>
  </tr>
  <tr id="CF-5497-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;18&nbsp;17:50:56&nbsp;2006</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> PATCH: bring load_tmpl&#40;&#41; up to date to match CGI::Application</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The attached patch was previously submitted directly to the maintainer
in November. I&#39;m publishing it here now as official record, in case
other people are interested before an official release as made.

Primarily it brings the code up to date to be in sync with the current
load_tmpl&#40;&#41; functionality of CGI::Application. 

It also adds a default &#34;c&#34; parameter to correspond to the current
CGI::Application object. Since I developed the patch, I&#39;ve realized
there may be a problem with this syntax in persistent environments,
because a circular reference is created with the CGI::Application object
refering to itself. 

The system I noticed what that CGI::Session quit working properly
because the DESTROY {} method for those objects wasn&#39;t going out of
scope and being called when expected. 

So I /don&#39;t/ recommend adding that part of the patch just yet, although
I would really, really like to find a way to provide the same syntax. 

My personal workaround was leave the syntax in place, but always call
flush&#40;&#41; explicitly on the CGI::Session object. 

However, addressing the root issue would obviously be better!

  Mark
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> cap-htdot.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fri Nov 11 22:01:02 EST 2005  Mark Stosberg &lt;mark@summersault.com&gt;
  * Update load_tmpl to match C::A 4.04 and support default &#34;c&#34; object like TT plugin. 
diff -rN -u old-CGI-Application-Plugin-HTDot-0.03/Changes new-CGI-Application-Plugin-HTDot-0.03/Changes
--- old-CGI-Application-Plugin-HTDot-0.03/Changes	2005-11-11 22:02:40.000000000 -0500
+++ new-CGI-Application-Plugin-HTDot-0.03/Changes	2005-11-11 21:26:39.000000000 -0500
@@ -1,11 +1,15 @@
 Revision history for CGI-Application-Plugin-HTDot
 
+        - Update load_tmpl&#40;&#41; functionality to match how CGI::App 4.04 works &#40;Mark Stosberg&#41;
+        - Add &#34;c&#34; key to templates by default to allow access to template object. Thanks to
+          the TT plugin for the inspiration and documenation for this. &#40;Mark Stosberg&#41;.  
+
 0.03    2005/08/18
-        Added module dependencies to Build.PL.  Updated acknowledgements.
+        - Added module dependencies to Build.PL.  Updated acknowledgments.
 
 0.02    2005/08/16
-        First public version, released on an unsuspecting world.  Mwahaha! ;&#41;
+        - First public version, released on an unsuspecting world.  Mwahaha! ;&#41;
 
-0.01    Never released :&#40;
-        For my own testing purposes.
+0.01    Never released 
+        - For my own testing purposes.
 
diff -rN -u old-CGI-Application-Plugin-HTDot-0.03/lib/CGI/Application/Plugin/HTDot.pm new-CGI-Application-Plugin-HTDot-0.03/lib/CGI/Application/Plugin/HTDot.pm
--- old-CGI-Application-Plugin-HTDot-0.03/lib/CGI/Application/Plugin/HTDot.pm	2005-11-11 22:02:40.000000000 -0500
+++ new-CGI-Application-Plugin-HTDot-0.03/lib/CGI/Application/Plugin/HTDot.pm	2005-11-11 21:59:55.000000000 -0500
@@ -82,7 +82,7 @@
 	my $self = shift;
 	my &#40;$tmpl_file, @extra_params&#41; = @_;
 
-	# Add tmpl_path to path array if one is set, otherwise add a path arg
+	# add tmpl_path to path array if one is set, otherwise add a path arg
 	if &#40;my $tmpl_path = $self-&gt;tmpl_path&#41; {
 		my @tmpl_paths = &#40;ref $tmpl_path eq &#39;ARRAY&#39;&#41; ? @$tmpl_path : $tmpl_path;
 		my $found = 0;
diff -rN -u old-CGI-Application-Plugin-HTDot-0.03/t/01-load_tmpl.t new-CGI-Application-Plugin-HTDot-0.03/t/01-load_tmpl.t
--- old-CGI-Application-Plugin-HTDot-0.03/t/01-load_tmpl.t	2005-11-11 22:02:40.000000000 -0500
+++ new-CGI-Application-Plugin-HTDot-0.03/t/01-load_tmpl.t	2005-11-11 21:59:29.000000000 -0500
@@ -1,25 +1,28 @@
 #!perl -T
 
+package TestApp;
 use strict;
 use warnings;
-use Test::More tests =&gt; 4;
+use Test::More qw/no_plan/;
 use Test::Exception;
-
-BEGIN{ use_ok&#40;&#39;CGI::Application&#39;&#41;; }
-
-# bring in testing hierarchy
-use lib &#39;./test&#39;;
-use TestApp;
+use base &#40;&#34;CGI::Application::Plugin::HTDot&#34;, &#34;CGI::Application&#34;&#41;;
 
 $ENV{CGI_APP_RETURN_ONLY} = 1;
 
-LOAD_TMPL_TESTING:
-{
     my $app = TestApp-&gt;new&#40; TMPL_PATH =&gt; [ qw&#40;test/templates&#41; ]&#41;;
+    $app-&gt;param&#40;&#39;c_test&#39;,&#39;Working&#39;&#41;;
     ok&#40;my $tmpl = $app-&gt;load_tmpl&#40;&#39;test.tmpl&#39;&#41;, &#34;Created new page template&#34;&#41;;
     isa_ok&#40;$tmpl, &#34;HTML::Template::Pluggable&#34;&#41;;
 
+    {
+        $tmpl-&gt;param&#40;&#39;test&#39;,&#39;basic tmpl_var test&#39;&#41;;
+        like&#40;$tmpl-&gt;output,qr/basic tmpl_var test/, &#34;basic tmpl_var is working&#34;&#41;;
+    }
+
+    {
+        like&#40;$tmpl-&gt;output,qr/Working/, &#34;c dot notation is working&#34;&#41;;
+    }
+
     # Make sure setting a bad &lt;tmpl_var&gt; dies
     dies_ok { $tmpl-&gt;param&#40; invalid =&gt; &#34;BLAH&#34; &#41; } &#34;Died when setting invalid &lt;tmpl_var&gt;&#34;;
-}
 
diff -rN -u old-CGI-Application-Plugin-HTDot-0.03/test/TestApp.pm new-CGI-Application-Plugin-HTDot-0.03/test/TestApp.pm
--- old-CGI-Application-Plugin-HTDot-0.03/test/TestApp.pm	2005-11-11 22:02:40.000000000 -0500
+++ new-CGI-Application-Plugin-HTDot-0.03/test/TestApp.pm	1969-12-31 19:00:00.000000000 -0500
@@ -1,13 +0,0 @@
-package TestApp;
-
-use strict;
-
-#--------------------------------------------------
-# use CGI::Application;
-# use CGI::Application::Plugin::HTDot;
-# @TestApp::ISA = qw&#40;CGI::Application::Plugin::HTDot CGI::Application&#41;;
-#-------------------------------------------------- 
-
-use base &#40;&#34;CGI::Application::Plugin::HTDot&#34;, &#34;CGI::Application&#34;&#41;;
-1;
-
diff -rN -u old-CGI-Application-Plugin-HTDot-0.03/test/templates/test.tmpl new-CGI-Application-Plugin-HTDot-0.03/test/templates/test.tmpl
--- old-CGI-Application-Plugin-HTDot-0.03/test/templates/test.tmpl	2005-11-11 22:02:40.000000000 -0500
+++ new-CGI-Application-Plugin-HTDot-0.03/test/templates/test.tmpl	2005-11-11 21:33:24.000000000 -0500
@@ -1,2 +1,3 @@
 &lt;tmpl_var test&gt;
+&lt;tmpl_var c.param&#40;&#39;c_test&#39;&#41;&gt;
 

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;03&nbsp;19:37:02&nbsp;2007</span>
    <span class="description">cromedome [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is resolved in version 0.04 and beyond.  For whatever reason I 
never could get your patch to work my local revision, but the changes 
were easy enough to implement.

CAP::HTDot features now match stock CGI::Application &#40;and have tests 
to match&#41;.  The parameter c is now passed to all templates....
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;03&nbsp;19:37:06&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;03&nbsp;19:37:08&nbsp;2007</span>
    <span class="description">cromedome [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
