<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #69712 for Devel-Comments: labelled expression returning no values</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #69712 for Devel-Comments: labelled expression returning no values</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Devel-Comments/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Devel-Comments/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Devel-Comments/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Devel-Comments/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Devel-Comments">Devel-Comments CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">69712</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">3 hours (180 min)

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Devel-Comments/Active/">Devel-Comments</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">xiong [...] cpan.org
    (daily)

    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
user42 [...] zip.com.au

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-234254-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
v1.1.3    </td>
  </tr>
  <tr id="CF-234255-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
v1.1.4    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;22&nbsp;21:40:17&nbsp;2011</span>
    <span class="description">user42 [...] zip.com.au -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> labelled expression returning no values</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 23 Jul 2011 11:39:23 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Devel-Comments [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">With recent debian i386 perl 5.12.4 and Devel::Comments 1.1.3, a program

    use Devel::Comments;
    sub foo { return; }
    ### foo: foo&#40;&#41;

prints

    ### foo: ###      $VAR1 = [

where I hoped it would be a better indication that the expression gave a
list of no values.  Perhaps just an empty

    ### foo:
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;05&nbsp;03:40:45&nbsp;2011</span>
    <span class="description">xiong [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;05&nbsp;03:41:38&nbsp;2011</span>
    <span class="description">xiong [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;05&nbsp;03:42:09&nbsp;2011</span>
    <span class="description">xiong [...] cpan.org -  Severity Normal added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;05&nbsp;03:42:09&nbsp;2011</span>
    <span class="description">xiong [...] cpan.org -  Broken in v1.1.3 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;05&nbsp;04:41:26&nbsp;2011</span>
    <span class="description">xiong [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">90 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Kevin, 

I&#39;ve opened up the Devel::Comments project and created a test and bugfix 
branch for your bug. Yes, I&#39;m able to reproduce it. And the same bug is 
found when testing against &#34;Vanilla&#34; Smart::Comments. 

Realistically, this means I have to figure out just how Conway did his 
stuff; which has been the big issue all along. Or start doing it in a 
more organized, deterministic way; which has been the big plan all 
along. 

I agree that the current output is unacceptable. An empty string is 
reported as &#39;&#39;, an undefined variable is reported as &#39;undef&#39;, a zero 
value is reported as 0. I suggest the &#34;correct&#34; report for: 

    sub foo {return}

should be &#39;undef&#39;, also. 

I hope you don&#39;t think I&#39;m being bitchy about this. I&#39;m grateful that 
you brought up the bug; your report has given me much food for thought. 
I won&#39;t promise instant results but I am working on this. 

Thanks, 

Xiong Changnian
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 62-labeled.t</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/run/bin/perl

use lib qw{
          lib
       ../lib
    ../../lib
};

use Devel::Comments;
use Test::More &#39;no_plan&#39;;

close *STDERR;
my $STDERR = q{};
open *STDERR, &#39;&gt;&#39;, \$STDERR;

my $scalar  = 728;
my $empty   = &#39;&#39;;
my $zero    = 0;
my @array   = &#40;1..3&#41;;
my %hash    = &#40;&#39;a&#39;..&#39;d&#39;&#41;;


close *STDERR;
$STDERR = q{};
open *STDERR, &#39;&gt;&#39;, \$STDERR;

### scalar728: $scalar
### empty: $empty
### undef: $undef
### zero: $zero
sub foo { return; }
### foo: foo&#40;&#41;

my $expected = &lt;&lt;&#34;END_MESSAGES&#34;;

#\## scalar728: 728
#\## empty: &#39;&#39;
#\## undef: undef
#\## zero: 0

#\## foo:
END_MESSAGES

is $STDERR, $expected      =&gt; &#39;Labelled expressions work&#39;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;05&nbsp;20:00:35&nbsp;2011</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69712] labelled expression returning no values</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 06 Aug 2011 10:00:10 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Devel-Comments [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Xiong Changnian via RT&#34; &lt;bug-Devel-Comments@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Yes, I&#39;m able to reproduce it. And the same bug is 
&gt; found when testing against &#34;Vanilla&#34; Smart::Comments. 
</div>
Bug for bug compatibility :-&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Realistically, this means I have to figure out just how Conway did his 
&gt; stuff; which has been the big issue all along.
</div>
My suspicion is Data::Dumper doesn&#39;t enjoy an empty values list, or the
post-dump crunch, or something.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I agree that the current output is unacceptable. An empty string is 
&gt; reported as &#39;&#39;, an undefined variable is reported as &#39;undef&#39;, a zero 
&gt; value is reported as 0.
</div>
I like those, as it&#39;s good to distinguish undef from empty string, and
from a string &#34;undef&#34;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I suggest the &#34;correct&#34; report for: 
&gt;
&gt;     sub foo {return}
&gt;
&gt; should be &#39;undef&#39;, also. 
</div>
I think it should distinguish no-values from a single undef value --
assuming the expression is run in array context, which is what
Smart::Comments has done, and which is handy for a list of values or
list return from a function.

    ### blah: $x,$y,$z

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; bug
</div>
I opened a couple of tickets against Smart::Comments too.  Colon in
labelled expression would probably be top of my list

    <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=55641">https://rt.cpan.org/Ticket/Display.html?id=55641</a></span>

which I think Devel::Comments has inherited, eg.

use Devel::Comments;
{ package xx;
  sub foo { 123 }
}
### expr: 1 ? 2 : 3
### expr: xx::foo&#40;&#41;

prints

### expr: 1 ? 2 : 3
Undefined subroutine &#38;main::foo called at x.pl line 6.

I think the labelled epxression regexp is a bit greedy and goes to the
last colon, which means you can&#39;t use a ?: or a fully-qualified package
var or func.

Dunno if anyone would have been using colons in the label part, and
wanting them as part of the label.  I&#39;d think it more useful to have
qualified func names xx::foo&#40;&#41; than colons in the label ...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;06&nbsp;09:49:16&nbsp;2011</span>
    <span class="description">xiong [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">30 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Kevin, 

Thanks for reminding me: I *have* promised drop-in replacement behavior 
for v1.x.x; but I&#39;ve also promised to fix bugs raised against Vanilla; 
there is perhaps some inconsistency here. 

I&#39;ve told feature requestors to wait for v2.0.0. But *this* clearly is a 
bug. 

I smell it in the post-dump crunch spanning lines 1453-1456: 

1454:    $dumped =~ s/\$VAR1 = \[\n//;

To me, that looks very like the line written specifically to fix this 
very bug. Which it does not do. The culprit, I suspect, is: 

1436:    # Handle a prefix with no actual variable...
1437:    if &#40;$prefix &#38;&#38; !$defined_varref&#41; {
...
1442:        return 1;               # ...abort if not defined $varref
1443:    }

Having come so far, I might as well fix it, right? Let me see if I can 
saddle up the old hoss for one last ride. 

As far as a less-greedy colon-eater, well, I think I&#39;d have to call that 
a requested feature. Feel free to open a ticket on it but this opens the 
big can of worms: the immense FILTER call which does a single pass on 
the entire user code with multiple regexes. I did not like the way it 
was written in Vanilla and, having spent quite a bit of time fiddling 
with it, I still don&#39;t like it. 

Thanks, 

Xiong Changnian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;06&nbsp;09:53:48&nbsp;2011</span>
    <span class="description">xiong [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Let&#39;s try that again. 

Hi Kevin, 

Thanks for reminding me: I *have* promised drop-in replacement behavior 
for v1.x.x; but I&#39;ve also promised to fix bugs raised against Vanilla; 
there is perhaps some inconsistency here. 

I&#39;ve told feature requestors to wait for v2.0.0. But *this* clearly is a 
bug. 

I smell it in the post-dump crunch spanning lines 1453-1456: 

1454:    $dumped =~ s/\$VAR1 = \[\n//;

To me, that looks very like the line written specifically to fix this 
very bug. Which it does not do. The culprit, I suspect, is: 

1436:    # Handle a prefix with no actual variable...
1437:    if &#40;$prefix &#38;&#38; !$defined_varref&#41; {
...
1442:        return 1;               # ...abort if not defined $varref
1443:    }

Having come so far, I might as well fix it, right? Let me see if I can 
saddle up the old hoss for one last ride. 

As far as a less-greedy colon-eater, well, I think I&#39;d have to call that 
a requested feature. Feel free to open a ticket on it but this opens the 
big can of worms: the immense FILTER call which does a single pass on 
the entire user code with multiple regexes. I did not like the way it 
was written in Vanilla and, having spent quite a bit of time fiddling 
with it, I still don&#39;t like it. 

Thanks, 

Xiong Changnian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;06&nbsp;09:58:38&nbsp;2011</span>
    <span class="description">xiong [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza">Fourth attempt to reply with line breaks. <br>

<br>

Hi Kevin,

<pre>

Thanks for reminding me: I *have* promised drop-in replacement behavior 
for v1.x.x; but I've also promised to fix bugs raised against Vanilla; 
there is perhaps some inconsistency here. 

I've told feature requestors to wait for v2.0.0. But *this* clearly is a 
bug. 

I smell it in the post-dump crunch spanning lines 1453-1456: 

1454:    $dumped =~ s/\$VAR1 = \[\n//;

To me, that looks very like the line written specifically to fix this 
very bug. Which it does not do. The culprit, I suspect, is: 

1436:    # Handle a prefix with no actual variable...
1437:    if ($prefix &amp;&amp; !$defined_varref) {
...
1442:        return 1;               # ...abort if not defined $varref
1443:    }

Having come so far, I might as well fix it, right? Let me see if I can 
saddle up the old hoss for one last ride. 

As far as a less-greedy colon-eater, well, I think I'd have to call that 
a requested feature. Feel free to open a ticket on it but this opens the 
big can of worms: the immense FILTER call which does a single pass on 
the entire user code with multiple regexes. I did not like the way it 
was written in Vanilla and, having spent quite a bit of time fiddling 
with it, I still don't like it. 

Thanks, 

Xiong Changnian
</pre>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;07&nbsp;09:00:25&nbsp;2011</span>
    <span class="description">xiong [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">60 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Okay, Kevin, 

Please ignore my flailing around with RT. I have that figured out now. 
Sorry. 

I&#39;ve &#34;fixed&#34; your bug. Thinking it over, I decided to have D::C report: 

    ### foo: null

in your case. Your code: 

    sub foo { return; };

does indeed return an undefined value; for

    sub foo { return; };
    my $ding = defined foo;

I checked that $ding is false; your code does not merely return an empty 
string or whatnot. I checked this because, for some incomprehensible 
reason, Data::Dumper seems to make a distinction between your code and a 
simple undefined scalar:

    $VAR1 = [
              undef
            ];

Your code is reported as: 

    $VAR1 = [];

This is unique among the various empty, undef, and zero values I&#39;ve 
tried. I have no idea why or even how D::D is able to distinguish 
between this undefined value and that. In any case, it *does*; so I&#39;ve 
preserved that information and caused D::C to report &#39;null&#39;. 

As far as the fix itself is concerned, I was wrong and you were right; 
the difficulty was all in the post-D::D cleanup code. The section of 
code I quoted earlier does not test for an undefined *value* but for an 
undefined value parameter reference. {face palm}

Half of your bug was in the stuff that deleted the &#39;$VAR1&#39;, etc. 
placeholder; half was in the indent-outdent monkey business. I &#34;fixed&#34; 
this with a bag on the side of the kludge and I&#39;m pretty unhappy with my 
work. But it does resolve the issue and does not seem to have introduced 
new ones. 

Now, if I can just remember how my build system worked, I&#39;ll bump and 
release. 

Thanks, 

Xiong Changnian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;07&nbsp;17:49:24&nbsp;2011</span>
    <span class="description">xiong [...] cpan.org -  Fixed in v1.1.4 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;07&nbsp;17:49:24&nbsp;2011</span>
    <span class="description">xiong [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixed, released, ticket closed. Thanks Kevin!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;07&nbsp;17:49:24&nbsp;2011</span>
    <span class="description">xiong [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;09&nbsp;19:35:45&nbsp;2011</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69712] labelled expression returning no values</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 10 Aug 2011 09:34:57 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Devel-Comments [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Xiong Changnian via RT&#34; &lt;bug-Devel-Comments@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;
&gt; As far as a less-greedy colon-eater, well, I think I&#39;d have to call that 
&gt; a requested feature.
</div>
Well, it&#39;s a fairly bad misfeature as it stands ...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; the immense FILTER call which does a single pass on 
&gt; the entire user code with multiple regexes. I did not like the way it 
&gt; was written in Vanilla
</div>
It looks like it accumulated a few cases, and might be sensitive to the
order they&#39;re checked, but other than that it&#39;s not too bad.  The way
the last is an unlabelled expression is a bit worrying, as it might
potentially execute all sorts of typos, though changing that may be
incompatible.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;09&nbsp;19:35:53&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;11&nbsp;02:07:46&nbsp;2011</span>
    <span class="description">xiong [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Kevin, 

Would you please open a new ticket for the colon-eating issue? Unless the 
labelled expression bug is not fixed for you in v1.1.4, I&#39;d like to close 
*this* ticket. 

Thanks, 

Xiong
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;11&nbsp;02:07:47&nbsp;2011</span>
    <span class="description">xiong [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
