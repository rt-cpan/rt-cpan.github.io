<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #46807 for ExtUtils-MakeMaker: PREFIX? rpmbuild writes to wrong location</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #46807 for ExtUtils-MakeMaker: PREFIX? rpmbuild writes to wrong location</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/ExtUtils-MakeMaker/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/ExtUtils-MakeMaker/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/ExtUtils-MakeMaker/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/ExtUtils-MakeMaker/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/ExtUtils-MakeMaker">ExtUtils-MakeMaker CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">46807</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/ExtUtils-MakeMaker/Active/">ExtUtils-MakeMaker</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
admin [...] photoresearchers.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-12494-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
6.50</li>
<li>
6.52</li>
</ul>
    </td>
  </tr>
  <tr id="CF-12495-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;09&nbsp;14:44:04&nbsp;2009</span>
    <span class="description">admin [...] photoresearchers.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> PREFIX? rpmbuild writes to wrong location</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I had a RHEL3 box with an old version of ExtUtils::MakeMaker &#40;6.03&#41; that
I wanted to upgrade. However the newest version&#40;s&#41; 6.52 and 6.50 and
perhaps further back than that are dangerously incompatible with this
system due to the fact that the PREFIX is no longer being used properly
by rpmbuild. I tried to build an rpm from a source of SpamAssassin
&#40;spamassassin.apache.org&#41; using the newly upgraded version of
ExtUtils::MakeMaker and it started writing to the *live* install
directories rather than the destination in /var/tmp/.  This had worked
properly with the older version of ExtUtils::MakeMaker, so I know that
the problem lies with that upgrade, unless it&#39;s simply not backward
compatible with older spec files and I don&#39;t know where this would be
documented.

Notice where it goes wrong:

Executing&#40;%install&#41;: /bin/sh -e /var/tmp/rpm-tmp.41625
+ umask 022
+ cd /usr/src/redhat/BUILD
+ cd Mail-SpamAssassin-3.1.9
+ LANG=C
+ export LANG
+ unset DISPLAY
+ &#39;[&#39; /var/tmp/spamassassin-root &#39;!=&#39; / &#39;]&#39;
+ rm -rf /var/tmp/spamassassin-root
+ make prefix=/var/tmp/spamassassin-root/usr
exec_prefix=/var/tmp/spamassassin-root/usr
bindir=/var/tmp/spamassassin-root/usr/bin
sbindir=/var/tmp/spamassassin-root/usr/sbin
sysconfdir=/var/tmp/spamassassin-root/etc
datadir=/var/tmp/spamassassin-root/usr/share
includedir=/var/tmp/spamassassin-root/usr/include
libdir=/var/tmp/spamassassin-root/usr/lib
libexecdir=/var/tmp/spamassassin-root/usr/libexec
localstatedir=/var/tmp/spamassassin-root/var
sharedstatedir=/var/tmp/spamassassin-root/usr/com
mandir=/var/tmp/spamassassin-root/usr/share/man
infodir=/var/tmp/spamassassin-root/usr/share/info install
INSTALLMAN1DIR=/usr/share/man/man1 INSTALLMAN3DIR=/usr/share/man/man3
INSTALLSITEMAN1DIR=/usr/share/man/man1
INSTALLSITEMAN3DIR=/usr/share/man/man3
INSTALLVENDORMAN1DIR=/usr/share/man/man1
INSTALLVENDORMAN3DIR=/usr/share/man/man3
Installing ...&lt;snip&gt;
Appending installation info to
/var/tmp/spamassassin-root/usr/lib/perl5/5.8.0/i386-linux-thread-multi/perllocal.pod
/usr/bin/perl &#34;-MExtUtils::Command&#34; -e mkpath /etc/mail/spamassassin
&lt;snip&gt;
/usr/bin/perl &#34;-MExtUtils::Command&#34; -e mkpath /usr/share/spamassassin
/usr/bin/perl -e &#34;map unlink, &lt;/usr/share/spamassassin/*&gt;&#34;
/usr/bin/perl build/preprocessor -Mvars -DVERSION=&#34;3.001009&#34;
-DPREFIX=&#34;/usr&#34; -DDEF_RULES_DIR=&#34;/usr/share/spamassassin&#34;
-DLOCAL_RULES_DIR=&#34;/etc/mail/spamassassin&#34;
-DLOCAL_STATE_DIR=&#34;/var/lib/spamassassin&#34;
-DINSTALLSITELIB=&#34;/usr/lib/perl5/site_perl/5.8.0&#34; -DCONTACT_ADDRESS=&#34;the
administrator of that system&#34; -m644 -Irules -O/usr/share/spamassassin
10_misc.cf [...]
chmod 755 /usr/share/spamassassin
+ install -d /var/tmp/spamassassin-root//etc/rc.d/init.d
+ install -d /var/tmp/spamassassin-root//usr/include
+ install -m 0755 spamd/redhat-rc-script.sh
/var/tmp/spamassassin-root//etc/rc.d/init.d/spamassassin
+ /bin/mv spamd/README spamd/README.spamd
+ mkdir -p /var/tmp/spamassassin-root/etc/mail/spamassassin
&lt;snip&gt;
Processing files: perl-Mail-SpamAssassin-3.1.9-1
error: File not found: /var/tmp/spamassassin-root/usr/share/spamassassin

This is of course where the build dies.

When attempted with the older version of MakeMaker, it proceeded in a
similar manner but maintaining the correct PREFIX. This is the expected
behavior:

Executing&#40;%install&#41;: /bin/sh -e /var/tmp/rpm-tmp.27877
+ umask 022
+ cd /usr/src/redhat/BUILD
+ cd Mail-SpamAssassin-3.1.9
+ LANG=C
+ export LANG
+ unset DISPLAY
+ &#39;[&#39; /var/tmp/spamassassin-root &#39;!=&#39; / &#39;]&#39;
+ rm -rf /var/tmp/spamassassin-root
+ make prefix=/var/tmp/spamassassin-root/usr
exec_prefix=/var/tmp/spamassassin-root/usr
bindir=/var/tmp/spamassassin-root/usr/bin
sbindir=/var/tmp/spamassassin-root/usr/sbin
sysconfdir=/var/tmp/spamassassin-root/etc
datadir=/var/tmp/spamassassin-root/usr/share
includedir=/var/tmp/spamassassin-root/usr/include
libdir=/var/tmp/spamassassin-root/usr/lib
libexecdir=/var/tmp/spamassassin-root/usr/libexec
localstatedir=/var/tmp/spamassassin-root/var
sharedstatedir=/var/tmp/spamassassin-root/usr/com
mandir=/var/tmp/spamassassin-root/usr/share/man
infodir=/var/tmp/spamassassin-root/usr/share/info install
INSTALLMAN1DIR=/usr/share/man/man1 INSTALLMAN3DIR=/usr/share/man/man3
INSTALLSITEMAN1DIR=/usr/share/man/man1
INSTALLSITEMAN3DIR=/usr/share/man/man3
INSTALLVENDORMAN1DIR=/usr/share/man/man1
INSTALLVENDORMAN3DIR=/usr/share/man/man3
Installing ...&lt;snip&gt;
Writing
/var/tmp/spamassassin-root/usr/lib/perl5/site_perl/5.8.0/i386-linux-thread-multi/auto/Mail/SpamAssassin/.packlist
Appending installation info to
/var/tmp/spamassassin-root/usr/lib/perl5/5.8.0/i386-linux-thread-multi/perllocal.pod
/usr/bin/perl &#34;-MExtUtils::Command&#34; -e mkpath
/var/tmp/spamassassin-root/etc/mail/spamassassin
&lt;snip&gt;
/usr/bin/perl &#34;-MExtUtils::Command&#34; -e mkpath
/var/tmp/spamassassin-root/usr/share/spamassassin
/usr/bin/perl -e &#34;map unlink,
&lt;/var/tmp/spamassassin-root/usr/share/spamassassin/*&gt;&#34;
/usr/bin/perl build/preprocessor -Mvars -DVERSION=&#34;3.001009&#34;
-DPREFIX=&#34;/usr&#34; -DDEF_RULES_DIR=&#34;/usr/share/spamassassin&#34;
-DLOCAL_RULES_DIR=&#34;/etc/mail/spamassassin&#34;
-DLOCAL_STATE_DIR=&#34;/var/lib/spamassassin&#34;
-DINSTALLSITELIB=&#34;/usr/lib/perl5/site_perl/5.8.0&#34; -DCONTACT_ADDRESS=&#34;the
administrator of that system&#34; -m644 -Irules
-O/var/tmp/spamassassin-root/usr/share/spamassassin 10_misc.cf [...]
chmod 755 /var/tmp/spamassassin-root/usr/share/spamassassin
+ install -d /var/tmp/spamassassin-root//etc/rc.d/init.d
+ install -d /var/tmp/spamassassin-root//usr/include
+ install -m 0755 spamd/redhat-rc-script.sh
/var/tmp/spamassassin-root//etc/rc.d/init.d/spamassassin
+ /bin/mv spamd/README spamd/README.spamd
+ mkdir -p /var/tmp/spamassassin-root/etc/mail/spamassassin
&lt;snip&gt;
Processing files: spamassassin-3.1.9-1
Executing&#40;%doc&#41;: /bin/sh -e /var/tmp/rpm-tmp.31039
+ umask 022
+ cd /usr/src/redhat/BUILD
+ cd Mail-SpamAssassin-3.1.9
+ DOCDIR=/var/tmp/spamassassin-root/usr/share/doc/spamassassin-3.1.9
+ export DOCDIR
+ rm -rf /var/tmp/spamassassin-root/usr/share/doc/spamassassin-3.1.9
+ /bin/mkdir -p /var/tmp/spamassassin-root/usr/share/doc/spamassassin-3.1.9
+ cp -pr README Changes sample-nonspam.txt sample-spam.txt
spamd/README.spamd INSTALL BUGS LICENSE TRADEMARK USAGE sql UPGRADE
/var/tmp/spamassassin-root/usr/share/doc/spamassassin-3.1.9
+ exit 0

What is the version that introduced this change in behavior, and where
lies the fault? If there is an incompatibility it is not
well-documented. And it shouldn&#39;t be the case that newer versions of
MakeMaker would break rpmbuild in this manner.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;09&nbsp;15:27:41&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #46807] PREFIX? rpmbuild writes to wrong location</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 09 Jun 2009 12:27:20 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-ExtUtils-MakeMaker [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Administrator via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I had a RHEL3 box
</div>
Holy cats!


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; with an old version of ExtUtils::MakeMaker &#40;6.03&#41; that
&gt; I wanted to upgrade. However the newest version&#40;s&#41; 6.52 and 6.50 and
&gt; perhaps further back than that are dangerously incompatible with this
&gt; system due to the fact that the PREFIX is no longer being used properly
&gt; by rpmbuild. I tried to build an rpm from a source of SpamAssassin
&gt; &#40;spamassassin.apache.org&#41; using the newly upgraded version of
&gt; ExtUtils::MakeMaker and it started writing to the *live* install
&gt; directories rather than the destination in /var/tmp/.  This had worked
&gt; properly with the older version of ExtUtils::MakeMaker, so I know that
&gt; the problem lies with that upgrade, unless it&#39;s simply not backward
&gt; compatible with older spec files and I don&#39;t know where this would be
&gt; documented.
</div>
Nothing obvious has changed to break PREFIX.  But Spamassassin&#39;s Makefile.PL
is over a thousand lines long.  It is known to do some unspeakable things to
MakeMaker including using un/vaguely documented features.  This is going to be
fun to track down.

Also PREFIX is unpredictable &#40;by unfortunate design&#41; and it should be using
INSTALL_BASE when possible &#40;which acts like what everyone else calls
--prefix&#41;.  But that&#39;s another story.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Notice where it goes wrong:
</div>
Without knowing what got passed into MakeMaker there&#39;s no way of knowing what
went wrong or where.

If you would please attach the top level MakeMaker generated Makefile then we
can start tracking this down.  It should start with something like:

# This Makefile is for the Mail::SpamAssassin extension to perl.
#
# It was generated automatically by MakeMaker version
# 6.53_02 &#40;Revision: 65302&#41; from the contents of
# Makefile.PL. Don&#39;t edit this file, edit Makefile.PL instead.


-- 
ROCKS FALL! EVERYONE DIES!
        <span class="clickylink"><a target="new" rel="nofollow" href="http://www.somethingpositive.net/sp05032002.shtml">http://www.somethingpositive.net/sp05032002.shtml</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;09&nbsp;15:27:41&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;09&nbsp;17:33:59&nbsp;2009</span>
    <span class="description">admin [...] photoresearchers.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If you would please attach the top level MakeMaker
&gt; generated Makefile then we can start tracking this
&gt; down.  It should start with something like:
&gt; 
&gt; # This Makefile is for the Mail::SpamAssassin extension to perl.
&gt; #
&gt; # It was generated automatically by MakeMaker version
&gt; # 6.53_02 &#40;Revision: 65302&#41; from the contents of
&gt; # Makefile.PL. Don&#39;t edit this file, edit Makefile.PL instead.
</div>
Here is the Makefile generated with 6.50.  I can try it with 6.53_02 if
you&#39;d like, but my guess is that the cause of this problem will be
common to all the latest versions.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;09&nbsp;17:43:26&nbsp;2009</span>
    <span class="description">admin [...] photoresearchers.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Here is the Makefile generated with 6.50.
</div>
I&#39;m not that great at reading Makefiles, for what it&#39;s worth, but
comparing it to an older generated version, I think the problem stems
from the B_DATADIR variable &#40;and B_CONFDIR, B_LIBDIR, etc.&#41;.  In the old
version I_DATADIR is set to $&#40;INSTALLSITEDATA&#41; and B_DATADIR to
$&#40;DESTINSTALLSITEDATA&#41;.  With the newer versions of MakeMaker, I_DATADIR
is set the same way, but B_DATADIR is set to $&#40;I_DATADIR&#41; rather than
$&#40;DESTINSTALLSITEDATA&#41;.

I don&#39;t know what causes that to happen, but I think it gets closer to
the specific problem.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;09&nbsp;18:16:45&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #46807] PREFIX? rpmbuild writes to wrong location</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 09 Jun 2009 15:16:23 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-ExtUtils-MakeMaker [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Administrator via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: ExtUtils-MakeMaker
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=46807">https://rt.cpan.org/Ticket/Display.html?id=46807</a></span> &gt;
&gt; 
<div class="message-stanza open">&gt;&gt; If you would please attach the top level MakeMaker
&gt;&gt; generated Makefile then we can start tracking this
&gt;&gt; down.  It should start with something like:
&gt;&gt;
&gt;&gt; # This Makefile is for the Mail::SpamAssassin extension to perl.
&gt;&gt; #
&gt;&gt; # It was generated automatically by MakeMaker version
&gt;&gt; # 6.53_02 &#40;Revision: 65302&#41; from the contents of
&gt;&gt; # Makefile.PL. Don&#39;t edit this file, edit Makefile.PL instead.
</div>&gt; 
&gt; Here is the Makefile generated with 6.50.  I can try it with 6.53_02 if
&gt; you&#39;d like, but my guess is that the cause of this problem will be
&gt; common to all the latest versions.
</div>
Short version: Its a spamassassin bug.  I&#39;ll forward this on to them.

Long version:

An initial scan looks good.  Its setting PREFIX=/usr and a
DESTDIR=/var/tmp/spamassassin-root as it should.  This means its being built
to run from /usr but is actually being copied into
/var/tmp/spamassassin-root/usr.  This is how rpm normally builds packages.

Upon closer inspection of your error message, I don&#39;t think the problem lies
with MakeMaker:

Processing files: perl-Mail-SpamAssassin-3.1.9-1
error: File not found: /var/tmp/spamassassin-root/usr/share/spamassassin

Its trying to install into /var/tmp/spamassassin-root as it should, but
something did not create the necessary directories.

I suspect what&#39;s happened is something in Spamassassin is only looking at the
PREFIX and not the DESTDIR.  So special magic Spamassassin code which is doing
its own install is sticking stuff straight into PREFIX.

Here&#39;s the suspicious entry in their Makefile:

MM_HAS_DESTDIR = no
MM_HAS_GOOD_DESTDIR = yes
MM_KNOWS_DESTDIR = no
MM_NEEDS_DESTDIR = no

MakeMaker has a &#34;good&#34; DESTDIR but doesn&#39;t have it and doesn&#39;t know it?  Que?

The problem, as suspected, is Spamassassin mucking with MakeMaker guts which
have since changed, as they will.  Here it is in their Makefile.PL

# MakeMaker prior to 6.11 doesn&#39;t support DESTDIR which is needed for
# packaging with builddir!=destdir. See bug 2388.
$mm_knows_destdir    = $ExtUtils::MakeMaker::Recognized_Att_Keys{DESTDIR};
$mm_has_good_destdir = $mm_version &gt;= 6.11;
# Add DESTDIR hack only if it&#39;s requested &#40;and necessary&#41;
$mm_needs_destdir    = $opt{&#39;destdir&#39;} &#38;&#38; !$mm_has_good_destdir;
$mm_has_destdir      = $mm_knows_destdir || $mm_needs_destdir;
push&#40;@ATT_KEYS, &#39;DESTDIR&#39;&#41; if $mm_needs_destdir;

# Now make EU::MM understand our extended vars
foreach my $key &#40;@ATT_KEYS&#41; {
  $ExtUtils::MakeMaker::Recognized_Att_Keys{$key} = 1;
}

%ExtUtils::MakeMaker::Recognized_Att_Keys is a private MakeMaker variable.  It
happened to be declared as a global.  Now it is lexical and thus unreadable.
This change was made at the end of 2007 as part of 6.44.

There&#39;s supposed to be a warning about this, but the logic &#40;above&#41; is broken
and quite overcomplicated.  It should just check the MakeMaker version and
leave it at that.  Or just set configure_requires for a new version of
MakeMaker and not try to work around 12 years of bugs &#40;just 4 or 5 maybe&#41;.


-- 
THIS I COMMAND!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;09&nbsp;18:28:29&nbsp;2009</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Handed off to Spamassassin as
<span class="clickylink"><a target="new" rel="nofollow" href="https://issues.apache.org/SpamAssassin/show_bug.cgi?id=6131">https://issues.apache.org/SpamAssassin/show_bug.cgi?id=6131</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;09&nbsp;18:28:30&nbsp;2009</span>
    <span class="description">mschwern [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
