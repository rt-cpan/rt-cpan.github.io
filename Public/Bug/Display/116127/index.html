<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #116127 for Time-HiRes: t/utime.t fails on ext3</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #116127 for Time-HiRes: t/utime.t fails on ext3</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Time-HiRes/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Time-HiRes/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Time-HiRes/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Time-HiRes/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Time-HiRes">Time-HiRes CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">116127</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Time-HiRes/Active/">Time-HiRes</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
simcop2387 [...] simcop2387.info

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-33448-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-33449-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;13&nbsp;19:42:27&nbsp;2016</span>
    <span class="description">simcop2387 [...] simcop2387.info -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> t/utime.t fails on ext3</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 13 Jul 2016 16:42:15 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Time-HiRes [...] rt.cpan.org, jhi [...] iki.fi</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ryan Voots &lt;simcop2387 [...] simcop2387.info&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The tests for t/utime.t fail when using an older filesystem on linux.  I&#39;m
using ext3 on this system and it fails to record the fractional seconds.

dist/Time-HiRes/t/utime ........................................ #
Failed test &#39;atime set correctly&#39;
#   at t/utime.t line 35.
#          got: &#39;1&#39;
#     expected: &#39;1.111111111&#39;
#   Failed test &#39;mtime set correctly&#39;
#   at t/utime.t line 36.
#          got: &#39;2&#39;
#     expected: &#39;2.222222222&#39;
#   Failed test &#39;atime set correctly&#39;
#   at t/utime.t line 44.
#          got: &#39;1&#39;
#     expected: &#39;1.111111111&#39;
#   Failed test &#39;mtime set correctly&#39;
#   at t/utime.t line 45.
#          got: &#39;2&#39;
#     expected: &#39;2.222222222&#39;
#   Failed test &#39;File 1 atime set correctly&#39;
#   at t/utime.t line 55.
#          got: &#39;1&#39;
#     expected: &#39;1.111111111&#39;
#   Failed test &#39;File 1 mtime set correctly&#39;
#   at t/utime.t line 56.
#          got: &#39;2&#39;
#     expected: &#39;2.222222222&#39;
#   Failed test &#39;File 2 atime set correctly&#39;
#   at t/utime.t line 60.
#          got: &#39;1&#39;
#     expected: &#39;1.111111111&#39;
#   Failed test &#39;File 2 mtime set correctly&#39;
#   at t/utime.t line 61.
#          got: &#39;2&#39;
#     expected: &#39;2.222222222&#39;
#   Failed test &#39;File 1 atime set correctly&#39;
#   at t/utime.t line 75.
#     &#39;0.328052043914795&#39;
#         &lt;
#     &#39;0.1&#39;
#   Failed test &#39;File 1 mtime set correctly&#39;
#   at t/utime.t line 76.
#     &#39;0.328052043914795&#39;
#         &lt;
#     &#39;0.1&#39;
#   Failed test &#39;File 2 atime set correctly&#39;
#   at t/utime.t line 80.
#     &#39;0.328052043914795&#39;
#         &lt;
#     &#39;0.1&#39;
#   Failed test &#39;File 2 mtime set correctly&#39;
#   at t/utime.t line 81.
#     &#39;0.328052043914795&#39;
#         &lt;
#     &#39;0.1&#39;
# Looks like you failed 12 tests of 18.
FAILED at test 2
dist/XSLoader/t/XSLoader ....................................... ok
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;14&nbsp;03:27:54&nbsp;2016</span>
    <span class="description">JHI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">How does one detect that the filesystem is ext3?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;14&nbsp;03:27:55&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;14&nbsp;04:03:37&nbsp;2016</span>
    <span class="description">simcop2387 [...] simcop2387.info -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #116127] t/utime.t fails on ext3</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 14 Jul 2016 08:03:06 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Time-HiRes [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ryan Voots &lt;simcop2387 [...] simcop2387.info&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve been looking for a good way to do it, best way I&#39;ve found so far is
reading /proc/mounts and finding the mount point for where the test is
being run and checking it&#39;s type.  I also suspect &#40;but haven&#39;t tested yet&#41;
that a bunch of other filesystems are going to have similar problems.

On Thu, Jul 14, 2016, 12:28 AM Jarkko_Hietaniemi via RT &lt;
bug-Time-HiRes@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=116127">https://rt.cpan.org/Ticket/Display.html?id=116127</a></span> &gt;
&gt;
&gt; How does one detect that the filesystem is ext3?
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;14&nbsp;08:09:25&nbsp;2016</span>
    <span class="description">JHI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Yeah, for the general case some guesswork for the filesystem timestamp resolution might be useful. But if there is some more definite way of detecting particular filesystems, it would not hurt.

Can you do &#34;df $filename&#34; and get at the relevant more directly?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;15&nbsp;00:08:28&nbsp;2016</span>
    <span class="description">simcop2387 [...] simcop2387.info -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #116127] t/utime.t fails on ext3</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 14 Jul 2016 21:08:16 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Time-HiRes [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ryan Voots &lt;simcop2387 [...] simcop2387.info&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Looks like it&#39;ll give you the mount point to check, that combined with
/proc/mounts should let you detect the file system and only enable the test
on ones that support sub second times

root@simcop2387:~/letsencrypt-lighttpd# df /tmp/tmp.Ki6yC1AIFr
Filesystem     1K-blocks     Used Available Use% Mounted on
/dev/root       44990064 34542948   9984028  78% /

root@simcop2387:~/letsencrypt-lighttpd# cat /proc/mounts
/dev/root / ext3 rw,noatime,errors=remount-ro,barrier=0,data=writeback 0 0
devtmpfs /dev devtmpfs rw,relatime,size=1021656k,nr_inodes=255414,mode=755
0 0
...


On Thu, Jul 14, 2016 at 5:09 AM, Jarkko_Hietaniemi via RT &lt;
bug-Time-HiRes@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=116127">https://rt.cpan.org/Ticket/Display.html?id=116127</a></span> &gt;
&gt;
&gt; Yeah, for the general case some guesswork for the filesystem timestamp
&gt; resolution might be useful. But if there is some more definite way of
&gt; detecting particular filesystems, it would not hurt.
&gt;
&gt; Can you do &#34;df $filename&#34; and get at the relevant more directly?
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;15&nbsp;03:21:47&nbsp;2016</span>
    <span class="description">jhi [...] iki.fi -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #116127] t/utime.t fails on ext3</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 15 Jul 2016 10:21:28 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Time-HiRes [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jarkko Hietaniemi &lt;jhi [...] iki.fi&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Friday-201607-15 7:08, simcop2387@simcop2387.info via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Time-HiRes
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=116127">https://rt.cpan.org/Ticket/Display.html?id=116127</a></span> &gt;
&gt;
&gt; Looks like it&#39;ll give you the mount point to check, that combined with
&gt; /proc/mounts should let you detect the file system and only enable the test
&gt; on ones that support sub second times
&gt;
&gt; root@simcop2387:~/letsencrypt-lighttpd# df /tmp/tmp.Ki6yC1AIFr
&gt; Filesystem     1K-blocks     Used Available Use% Mounted on
&gt; /dev/root       44990064 34542948   9984028  78% /
&gt;
&gt; root@simcop2387:~/letsencrypt-lighttpd# cat /proc/mounts
&gt; /dev/root / ext3 rw,noatime,errors=remount-ro,barrier=0,data=writeback 0 0
&gt; devtmpfs /dev devtmpfs rw,relatime,size=1021656k,nr_inodes=255414,mode=755
&gt; 0 0
</div>
Could you try running this in your system:

perl -MFile::Temp=tempfile -wle &#39;my &#40;$fh, $fn&#41; = tempfile&#40;UNLINK=&gt;1&#41;; 
sub getfstype { my &#40;$fn&#41; = @_; open&#40;my $df, &#34;df $fn |&#34;&#41;; my @df = &lt;$df&gt;; 
my $dev = +&#40;split&#40;&#34; &#34;, $df[1]&#41;&#41;[0]; if &#40;open&#40;my $mounts, 
&#34;/proc/mounts&#34;&#41;&#41; { while &#40;&lt;$mounts&gt;&#41;{ my @m = split&#40;&#34; &#34;&#41;; if &#40;$m[0] eq 
$dev&#41; { return $m[2] } } } return } print getfstype&#40;$fn&#41;; &#39;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ...
&gt;
&gt;
&gt; On Thu, Jul 14, 2016 at 5:09 AM, Jarkko_Hietaniemi via RT &lt;
&gt; bug-Time-HiRes@rt.cpan.org&gt; wrote:
&gt;
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=116127">https://rt.cpan.org/Ticket/Display.html?id=116127</a></span> &gt;
&gt;&gt;
&gt;&gt; Yeah, for the general case some guesswork for the filesystem timestamp
&gt;&gt; resolution might be useful. But if there is some more definite way of
&gt;&gt; detecting particular filesystems, it would not hurt.
&gt;&gt;
&gt;&gt; Can you do &#34;df $filename&#34; and get at the relevant more directly?
&gt;&gt;
</div>&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;15&nbsp;16:42:29&nbsp;2016</span>
    <span class="description">simcop2387 [...] simcop2387.info -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #116127] t/utime.t fails on ext3</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 15 Jul 2016 13:42:10 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Time-HiRes [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ryan Voots &lt;simcop2387 [...] simcop2387.info&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Looks like it works as expected, on the ext3 system:

root@simcop2387:~/letsencrypt-lighttpd# perl -MFile::Temp=tempfile -wle &#39;my
&#40;$fh, $fn&#41; = tempfile&#40;UNLINK=&gt;1&#41;;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; sub getfstype { my &#40;$fn&#41; = @_; open&#40;my $df, &#34;df $fn |&#34;&#41;; my @df = &lt;$df&gt;;
&gt; my $dev = +&#40;split&#40;&#34; &#34;, $df[1]&#41;&#41;[0]; if &#40;open&#40;my $mounts,
&gt; &#34;/proc/mounts&#34;&#41;&#41; { while &#40;&lt;$mounts&gt;&#41;{ my @m = split&#40;&#34; &#34;&#41;; if &#40;$m[0] eq
&gt; $dev&#41; { return $m[2] } } } return } print getfstype&#40;$fn&#41;; &#39;
</div>ext3
root@simcop2387:~/letsencrypt-lighttpd#

on my more modern dev system:

# perl -MFile::Temp=tempfile -wle &#39;my &#40;$fh, $fn&#41; = tempfile&#40;UNLINK=&gt;1&#41;;
sub getfstype { my &#40;$fn&#41; = @_; open&#40;my $df, &#34;df $fn |&#34;&#41;; my @df = &lt;$df&gt;;
my $dev = +&#40;split&#40;&#34; &#34;, $df[1]&#41;&#41;[0]; if &#40;open&#40;my $mounts,
&#34;/proc/mounts&#34;&#41;&#41; { while &#40;&lt;$mounts&gt;&#41;{ my @m = split&#40;&#34; &#34;&#41;; if &#40;$m[0] eq
$dev&#41; { return $m[2] } } } return } print getfstype&#40;$fn&#41;; &#39;
ext4

On Fri, Jul 15, 2016 at 12:21 AM, jhi@iki.fi via RT &lt;
bug-Time-HiRes@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=116127">https://rt.cpan.org/Ticket/Display.html?id=116127</a></span> &gt;
&gt;
&gt; On Friday-201607-15 7:08, simcop2387@simcop2387.info via RT wrote:
<div class="message-stanza open">&gt; &gt;        Queue: Time-HiRes
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=116127">https://rt.cpan.org/Ticket/Display.html?id=116127</a></span> &gt;
&gt; &gt;
&gt; &gt; Looks like it&#39;ll give you the mount point to check, that combined with
&gt; &gt; /proc/mounts should let you detect the file system and only enable the
</div>&gt; test
<div class="message-stanza open">&gt; &gt; on ones that support sub second times
&gt; &gt;
&gt; &gt; root@simcop2387:~/letsencrypt-lighttpd# df /tmp/tmp.Ki6yC1AIFr
&gt; &gt; Filesystem     1K-blocks     Used Available Use% Mounted on
&gt; &gt; /dev/root       44990064 34542948   9984028  78% /
&gt; &gt;
&gt; &gt; root@simcop2387:~/letsencrypt-lighttpd# cat /proc/mounts
&gt; &gt; /dev/root / ext3 rw,noatime,errors=remount-ro,barrier=0,data=writeback 0
</div>&gt; 0
<div class="message-stanza open">&gt; &gt; devtmpfs /dev devtmpfs
</div>&gt; rw,relatime,size=1021656k,nr_inodes=255414,mode=755
<div class="message-stanza open">&gt; &gt; 0 0
</div>&gt;
&gt; Could you try running this in your system:
&gt;
&gt; perl -MFile::Temp=tempfile -wle &#39;my &#40;$fh, $fn&#41; = tempfile&#40;UNLINK=&gt;1&#41;;
&gt; sub getfstype { my &#40;$fn&#41; = @_; open&#40;my $df, &#34;df $fn |&#34;&#41;; my @df = &lt;$df&gt;;
&gt; my $dev = +&#40;split&#40;&#34; &#34;, $df[1]&#41;&#41;[0]; if &#40;open&#40;my $mounts,
&gt; &#34;/proc/mounts&#34;&#41;&#41; { while &#40;&lt;$mounts&gt;&#41;{ my @m = split&#40;&#34; &#34;&#41;; if &#40;$m[0] eq
&gt; $dev&#41; { return $m[2] } } } return } print getfstype&#40;$fn&#41;; &#39;
&gt;
<div class="message-stanza open">&gt; &gt; ...
&gt; &gt;
&gt; &gt;
&gt; &gt; On Thu, Jul 14, 2016 at 5:09 AM, Jarkko_Hietaniemi via RT &lt;
&gt; &gt; bug-Time-HiRes@rt.cpan.org&gt; wrote:
&gt; &gt;
<div class="message-stanza open">&gt; &gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=116127">https://rt.cpan.org/Ticket/Display.html?id=116127</a></span> &gt;
&gt; &gt;&gt;
&gt; &gt;&gt; Yeah, for the general case some guesswork for the filesystem timestamp
&gt; &gt;&gt; resolution might be useful. But if there is some more definite way of
&gt; &gt;&gt; detecting particular filesystems, it would not hurt.
&gt; &gt;&gt;
&gt; &gt;&gt; Can you do &#34;df $filename&#34; and get at the relevant more directly?
&gt; &gt;&gt;
</div>&gt; &gt;
&gt; &gt;
</div>&gt;
&gt;
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;24&nbsp;08:55:12&nbsp;2016</span>
    <span class="description">PERRAD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">As CPANTester using an ext2 filesystem, I reproduce this issue, see <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/dde2dfdc-3961-11e6-937e-a6475af59b17">http://www.cpantesters.org/cpan/report/dde2dfdc-3961-11e6-937e-a6475af59b17</a></span>

On Wed Jul 13 19:42:27 2016, simcop2387@simcop2387.info wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The tests for t/utime.t fail when using an older filesystem on linux.  I&#39;m
&gt; using ext3 on this system and it fails to record the fractional seconds.
&gt; 
&gt; dist/Time-HiRes/t/utime ........................................ #
&gt; Failed test &#39;atime set correctly&#39;
&gt; #   at t/utime.t line 35.
&gt; #          got: &#39;1&#39;
&gt; #     expected: &#39;1.111111111&#39;
&gt; #   Failed test &#39;mtime set correctly&#39;
&gt; #   at t/utime.t line 36.
&gt; #          got: &#39;2&#39;
&gt; #     expected: &#39;2.222222222&#39;
&gt; #   Failed test &#39;atime set correctly&#39;
&gt; #   at t/utime.t line 44.
&gt; #          got: &#39;1&#39;
&gt; #     expected: &#39;1.111111111&#39;
&gt; #   Failed test &#39;mtime set correctly&#39;
&gt; #   at t/utime.t line 45.
&gt; #          got: &#39;2&#39;
&gt; #     expected: &#39;2.222222222&#39;
&gt; #   Failed test &#39;File 1 atime set correctly&#39;
&gt; #   at t/utime.t line 55.
&gt; #          got: &#39;1&#39;
&gt; #     expected: &#39;1.111111111&#39;
&gt; #   Failed test &#39;File 1 mtime set correctly&#39;
&gt; #   at t/utime.t line 56.
&gt; #          got: &#39;2&#39;
&gt; #     expected: &#39;2.222222222&#39;
&gt; #   Failed test &#39;File 2 atime set correctly&#39;
&gt; #   at t/utime.t line 60.
&gt; #          got: &#39;1&#39;
&gt; #     expected: &#39;1.111111111&#39;
&gt; #   Failed test &#39;File 2 mtime set correctly&#39;
&gt; #   at t/utime.t line 61.
&gt; #          got: &#39;2&#39;
&gt; #     expected: &#39;2.222222222&#39;
&gt; #   Failed test &#39;File 1 atime set correctly&#39;
&gt; #   at t/utime.t line 75.
&gt; #     &#39;0.328052043914795&#39;
&gt; #         &lt;
&gt; #     &#39;0.1&#39;
&gt; #   Failed test &#39;File 1 mtime set correctly&#39;
&gt; #   at t/utime.t line 76.
&gt; #     &#39;0.328052043914795&#39;
&gt; #         &lt;
&gt; #     &#39;0.1&#39;
&gt; #   Failed test &#39;File 2 atime set correctly&#39;
&gt; #   at t/utime.t line 80.
&gt; #     &#39;0.328052043914795&#39;
&gt; #         &lt;
&gt; #     &#39;0.1&#39;
&gt; #   Failed test &#39;File 2 mtime set correctly&#39;
&gt; #   at t/utime.t line 81.
&gt; #     &#39;0.328052043914795&#39;
&gt; #         &lt;
&gt; #     &#39;0.1&#39;
&gt; # Looks like you failed 12 tests of 18.
&gt; FAILED at test 2
&gt; dist/XSLoader/t/XSLoader ....................................... ok
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;24&nbsp;20:16:26&nbsp;2016</span>
    <span class="description">JHI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Sep 24 08:55:12 2016, PERRAD wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As CPANTester using an ext2 filesystem, I reproduce this issue, see
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/dde2dfdc-3961-11e6-937e-">http://www.cpantesters.org/cpan/report/dde2dfdc-3961-11e6-937e-</a></span>
&gt; a6475af59b17
</div>
How about with Time-HiRes 1.9739?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;24&nbsp;21:17:59&nbsp;2016</span>
    <span class="description">simcop2387 [...] simcop2387.info -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #116127] t/utime.t fails on ext3</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 24 Sep 2016 18:17:38 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Time-HiRes [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ryan Voots &lt;simcop2387 [...] simcop2387.info&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">My original report was with 1.9739, here&#39;s the full build log.  there&#39;s
nothing in utime.t to skip the tests if the filesystem doesn&#39;t support
sub-second time stamps.

% cat build.log
cpanm &#40;App::cpanminus&#41; 1.7027 on perl 5.022000 built for x86_64-linux
Work directory is /home/ryan/.cpanm/work/1474765782.17422
You have make /usr/bin/make
You have LWP 6.13
You have /bin/tar: tar &#40;GNU tar&#41; 1.27.1
Copyright &#40;C&#41; 2013 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://gnu.org/licenses/gpl.html">http://gnu.org/licenses/gpl.html</a></span>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;.
</div>This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Written by John Gilmore and Jay Fenlason.
You have /usr/bin/unzip
Searching Time::HiRes on cpanmetadb ...
Unpacking Time-HiRes-1.9739.tar.gz
--&gt; Working on Time::HiRes
Fetching <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpan.org/authors/id/J/JH/JHI/Time-HiRes-1.9739.tar.gz">http://www.cpan.org/authors/id/J/JH/JHI/Time-HiRes-1.9739.tar.gz</a></span>
... OK
Time-HiRes-1.9739/
Time-HiRes-1.9739/Changes
Time-HiRes-1.9739/fallback/
Time-HiRes-1.9739/hints/
Time-HiRes-1.9739/HiRes.pm
Time-HiRes-1.9739/HiRes.xs
Time-HiRes-1.9739/Makefile.PL
Time-HiRes-1.9739/MANIFEST
Time-HiRes-1.9739/META.json
Time-HiRes-1.9739/META.yml
Time-HiRes-1.9739/ppport.h
Time-HiRes-1.9739/README
Time-HiRes-1.9739/t/
Time-HiRes-1.9739/TODO
Time-HiRes-1.9739/typemap
Time-HiRes-1.9739/t/alarm.t
Time-HiRes-1.9739/t/clock.t
Time-HiRes-1.9739/t/gettimeofday.t
Time-HiRes-1.9739/t/itimer.t
Time-HiRes-1.9739/t/nanosleep.t
Time-HiRes-1.9739/t/sleep.t
Time-HiRes-1.9739/t/stat.t
Time-HiRes-1.9739/t/time.t
Time-HiRes-1.9739/t/tv_interval.t
Time-HiRes-1.9739/t/ualarm.t
Time-HiRes-1.9739/t/usleep.t
Time-HiRes-1.9739/t/utime.t
Time-HiRes-1.9739/t/Watchdog.pm
Time-HiRes-1.9739/hints/aix.pl
Time-HiRes-1.9739/hints/dec_osf.pl
Time-HiRes-1.9739/hints/dynixptx.pl
Time-HiRes-1.9739/hints/irix.pl
Time-HiRes-1.9739/hints/linux.pl
Time-HiRes-1.9739/hints/sco.pl
Time-HiRes-1.9739/hints/solaris.pl
Time-HiRes-1.9739/hints/svr4.pl
Time-HiRes-1.9739/fallback/const-c.inc
Time-HiRes-1.9739/fallback/const-xs.inc
Entering Time-HiRes-1.9739
Checking configure dependencies from META.json
Checking if you have ExtUtils::MakeMaker 0 ... Yes &#40;7.04_01&#41;
Running Makefile.PL
Configuring Time-HiRes-1.9739 ... Configuring Time::HiRes...
Using hints hints/linux.pl...
Extra libraries: -lrt...
Have syscall&#40;&#41;... looking for syscall.h... found &lt;syscall.h&gt;.
Looking for gettimeofday&#40;&#41;... found.
Looking for setitimer&#40;&#41;... found.
Looking for getitimer&#40;&#41;... found.
You have interval timers &#40;both setitimer and getitimer&#41;.
Looking for ualarm&#40;&#41;... found.
Looking for usleep&#40;&#41;... found.
Looking for nanosleep&#40;&#41;... testing... found.
You can mix subsecond sleeps with signals, if you want to.
&#40;It&#39;s still not portable, though.&#41;
Looking for clock_gettime&#40;&#41;... found.
Looking for clock_getres&#40;&#41;... found.
Looking for clock_nanosleep&#40;&#41;... found.
Looking for clock&#40;&#41;... found.
Looking for futimens&#40;&#41;... found.
Looking for utimensat&#40;&#41;... found.
Looking for stat&#40;&#41; subsecond timestamps...
Trying struct stat st_atimespec.tv_nsec...NOT found.
Trying struct stat st_atimensec...NOT found.
Trying struct stat st_atime_n...NOT found.
Trying struct stat st_atim.tv_nsec...found.
Trying struct stat st_uatime...Processing hints file hints/linux.pl
NOT found.
You seem to have stat&#40;&#41; subsecond timestamps.
&#40;Your struct stat has them, but the filesystems must help.&#41;
Checking if your kit is complete...
Looks good
Generating a Unix-style Makefile
Writing Makefile for Time::HiRes
Writing MYMETA.yml and MYMETA.json
Now you may issue &#39;make&#39;.  Do not forget also &#39;make test&#39;.
Checking dependencies from MYMETA.json ...
Checking if you have Test::More 0 ... Yes &#40;1.001014&#41;
Checking if you have ExtUtils::MakeMaker 0 ... Yes &#40;7.04_01&#41;
Checking if you have Carp 0 ... Yes &#40;1.38&#41;
Checking if you have DynaLoader 0 ... Yes &#40;1.32&#41;
Checking if you have Config 0 ... Yes &#40;5.022000&#41;
Checking if you have strict 0 ... Yes &#40;1.09&#41;
Checking if you have Exporter 0 ... Yes &#40;5.72&#41;
OK
Building and testing Time-HiRes-1.9739 ... cp HiRes.pm
blib/lib/Time/HiRes.pm
Running Mkbootstrap for Time::HiRes &#40;&#41;
chmod 644 &#34;HiRes.bs&#34;
&#34;/home/ryan/perl5/perlbrew/perls/perl-5.22.0/bin/perl&#34;
&#34;/home/ryan/perl5/perlbrew/perls/perl-5.22.0/lib/5.22.0/ExtUtils/xsubpp&#34;
-typemap
&#34;/home/ryan/perl5/perlbrew/perls/perl-5.22.0/lib/5.22.0/ExtUtils/typemap&#34;
-typemap &#34;typemap&#34;  HiRes.xs &gt; HiRes.xsc &#38;&#38; mv HiRes.xsc HiRes.c
cc -c   -fwrapv -fno-strict-aliasing -pipe -fstack-protector
-I/usr/local/include -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64
-D_FORTIFY_SOURCE=2 -O2   -DVERSION=\&#34;1.9739\&#34; -DXS_VERSION=\&#34;1.9739\&#34;
-fPIC
&#34;-I/home/ryan/perl5/perlbrew/perls/perl-5.22.0/lib/5.22.0/x86_64-linux/CORE&#34;
-DTIME_HIRES_NANOSLEEP -DTIME_HIRES_CLOCK_GETTIME -DTIME_HIRES_CLOCK_GETRES
-DTIME_HIRES_CLOCK_NANOSLEEP -DTIME_HIRES_CLOCK -DHAS_FUTIMENS
-DHAS_UTIMENSAT -DTIME_HIRES_UTIME -DTIME_HIRES_STAT_XTIM
-DTIME_HIRES_STAT=4 -DATLEASTFIVEOHOHFIVE HiRes.c
rm -f blib/arch/auto/Time/HiRes/HiRes.so
LD_RUN_PATH=&#34;/lib/x86_64-linux-gnu&#34; cc  -shared -O2 -L/usr/local/lib
-fstack-protector HiRes.o  -o blib/arch/auto/Time/HiRes/HiRes.so   \
   -lrt         \

chmod 755 blib/arch/auto/Time/HiRes/HiRes.so
&#34;/home/ryan/perl5/perlbrew/perls/perl-5.22.0/bin/perl&#34;
-MExtUtils::Command::MM -e &#39;cp_nonempty&#39; -- HiRes.bs
blib/arch/auto/Time/HiRes/HiRes.bs 644
Manifying 1 pod document
Running Mkbootstrap for Time::HiRes &#40;&#41;
chmod 644 &#34;HiRes.bs&#34;
PERL_DL_NONLAZY=1 &#34;/home/ryan/perl5/perlbrew/perls/perl-5.22.0/bin/perl&#34;
&#34;-MExtUtils::Command::MM&#34; &#34;-MTest::Harness&#34; &#34;-e&#34; &#34;undef
*Test::Harness::Switches; test_harness&#40;0, &#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/*.t
t/alarm.t ......... ok
t/clock.t ......... ok
t/gettimeofday.t .. ok
t/itimer.t ........ ok
t/nanosleep.t ..... ok
t/sleep.t ......... ok
t/stat.t .......... ok
t/time.t .......... ok
t/tv_interval.t ... ok
t/ualarm.t ........ ok
t/usleep.t ........ ok

#   Failed test &#39;atime set correctly&#39;
#   at t/utime.t line 35.
#          got: &#39;1&#39;
#     expected: &#39;1.111111111&#39;

#   Failed test &#39;mtime set correctly&#39;
#   at t/utime.t line 36.
#          got: &#39;2&#39;
#     expected: &#39;2.222222222&#39;

#   Failed test &#39;atime set correctly&#39;
#   at t/utime.t line 44.
#          got: &#39;1&#39;
#     expected: &#39;1.111111111&#39;

#   Failed test &#39;mtime set correctly&#39;
#   at t/utime.t line 45.
#          got: &#39;2&#39;
#     expected: &#39;2.222222222&#39;

#   Failed test &#39;File 1 atime set correctly&#39;
#   at t/utime.t line 55.
#          got: &#39;1&#39;
#     expected: &#39;1.111111111&#39;

#   Failed test &#39;File 1 mtime set correctly&#39;
#   at t/utime.t line 56.
#          got: &#39;2&#39;
#     expected: &#39;2.222222222&#39;

#   Failed test &#39;File 2 atime set correctly&#39;
#   at t/utime.t line 60.
#          got: &#39;1&#39;
#     expected: &#39;1.111111111&#39;

#   Failed test &#39;File 2 mtime set correctly&#39;
#   at t/utime.t line 61.
#          got: &#39;2&#39;
#     expected: &#39;2.222222222&#39;

#   Failed test &#39;File 1 atime set correctly&#39;
#   at t/utime.t line 75.
#     &#39;0.439713954925537&#39;
#         &lt;
#     &#39;0.1&#39;

#   Failed test &#39;File 1 mtime set correctly&#39;
#   at t/utime.t line 76.
#     &#39;0.439713954925537&#39;
#         &lt;
#     &#39;0.1&#39;

#   Failed test &#39;File 2 atime set correctly&#39;
#   at t/utime.t line 80.
#     &#39;0.439713954925537&#39;
#         &lt;
#     &#39;0.1&#39;

#   Failed test &#39;File 2 mtime set correctly&#39;
#   at t/utime.t line 81.
#     &#39;0.439713954925537&#39;
#         &lt;
#     &#39;0.1&#39;
# Looks like you failed 12 tests of 18.
t/utime.t .........
Dubious, test returned 12 &#40;wstat 3072, 0xc00&#41;
Failed 12/18 subtests

Test Summary Report
-------------------
t/utime.t       &#40;Wstat: 3072 Tests: 18 Failed: 12&#41;
  Failed tests:  2-3, 5-6, 8-11, 13-16
  Non-zero exit status: 12
Files=12, Tests=113, 27 wallclock secs &#40; 0.10 usr  0.02 sys + 13.97 cusr
0.16 csys = 14.25 CPU&#41;
Result: FAIL
Failed 1/12 test programs. 12/113 subtests failed.
Makefile:1032: recipe for target &#39;test_dynamic&#39; failed
make: *** [test_dynamic] Error 12
! Installing Time::HiRes failed. See
/home/ryan/.cpanm/work/1474765782.17422/build.log for details. Retry with
--force to force install it.
FAIL

On Sat, Sep 24, 2016 at 5:16 PM, Jarkko_Hietaniemi via RT &lt;
bug-Time-HiRes@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=116127">https://rt.cpan.org/Ticket/Display.html?id=116127</a></span> &gt;
&gt;
&gt; On Sat Sep 24 08:55:12 2016, PERRAD wrote:
<div class="message-stanza open">&gt; &gt; As CPANTester using an ext2 filesystem, I reproduce this issue, see
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/dde2dfdc-3961-11e6-937e-">http://www.cpantesters.org/cpan/report/dde2dfdc-3961-11e6-937e-</a></span>
&gt; &gt; a6475af59b17
</div>&gt;
&gt; How about with Time-HiRes 1.9739?
&gt;
&gt;
&gt;
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;24&nbsp;21:45:08&nbsp;2016</span>
    <span class="description">JHI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Sep 24 21:17:59 2016, simcop2387@simcop2387.info wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; My original report was with 1.9739, here&#39;s the full build log.  there&#39;s
&gt; nothing in utime.t to skip the tests if the filesystem doesn&#39;t support
&gt; sub-second time stamps.
</div>
Right.  I had forgotten where this started.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;24&nbsp;22:16:00&nbsp;2016</span>
    <span class="description">JHI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">If you could try the attached patch?  It is against the Perl core &#40;because that&#39;s the primary source of Time-HiRes now&#41;, so e.g. &#34;git am&#34; is probably not going to work well, but manual patching with &#34;patch -p2 &lt; 0001-*.patch&#34; while in the Time-HiRes directory should work.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-Detect-ext3-ext2-they-do-not-have-hires-utime.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 2ab2080de68f5baf3a419b49154ffdfb68932ccc Mon Sep 17 00:00:00 2001
From: Jarkko Hietaniemi &lt;jhi@iki.fi&gt;
Date: Sat, 24 Sep 2016 22:01:59 -0400
Subject: [PATCH] Detect ext3/ext2, they do not have hires utime.

---
 dist/Time-HiRes/t/utime.t | 43 ++++++++++++++++++++++++++++++++++++++++---
 1 file changed, 40 insertions&#40;+&#41;, 3 deletions&#40;-&#41;

diff --git a/dist/Time-HiRes/t/utime.t b/dist/Time-HiRes/t/utime.t
index ede2e78..aaf1225 100644
--- a/dist/Time-HiRes/t/utime.t
+++ b/dist/Time-HiRes/t/utime.t
@@ -23,9 +23,46 @@ use File::Temp qw&#40; tempfile &#41;;
 
 use Config;
 
-# Cygwin timestamps have less precision.
-my $atime = $^O eq &#39;cygwin&#39; ? 1.1111111 : 1.111111111;
-my $mtime = $^O eq &#39;cygwin&#39; ? 2.2222222 : 2.222222222;
+# Hope initially for nanosecond accuracy.
+my $atime = 1.111111111;
+my $mtime = 2.222222222;
+
+if &#40;$^O eq &#39;cygwin&#39;&#41; {
+   # Cygwin timestamps have less precision.
+   $atime = 1.1111111;
+   $mtime = 2.2222222;
+} elsif &#40;$^O eq &#39;linux&#39; &#38;&#38; -e &#39;/proc/mounts&#39;&#41; {
+  # The linux might be wrong when ext3
+  # is available in other operating systems,
+  # but then we need other methods for detecting
+  # the filesystem type of the tempfiles.
+  my &#40;$fh, $fn&#41; = tempfile&#40;UNLINK =&gt; 1&#41;;
+  sub getfstype {
+    my &#40;$fn&#41; = @_;
+    my $cmd = &#34;df $fn&#34;;
+    open&#40;my $df, &#34;$cmd |&#34;&#41; or die &#34;$cmd: $!&#34;;
+     my @df = &lt;$df&gt;;  # Assume $df[0] is header line.
+     my $dev = +&#40;split&#40;&#34; &#34;, $df[1]&#41;&#41;[0];
+     open&#40;my $mounts, &#34;/proc/mounts&#34;&#41; or die &#34;/proc/mounts: $!&#34;;
+     while &#40;&lt;$mounts&gt;&#41; {
+       my @m = split&#40;&#34; &#34;&#41;;
+       if &#40;$m[0] eq $dev&#41; { return $m[2] }
+     }
+     return;
+  }
+  my $fstype = getfstype&#40;$fn&#41;;
+  unless &#40;defined $fstype&#41; {
+    warn &#34;Unknown fstype for $fn\n&#34;;
+  } else {
+    print &#34;# fstype = $fstype\n&#34;;
+    if &#40;$fstype eq &#39;ext3&#39; || $fstype eq &#39;ext2&#39;&#41; {
+      $atime = int&#40;$atime&#41;;
+      $mtime = int&#40;$mtime&#41;;
+    }
+  }
+}
+
+print &#34;# \$^O = $^O, atime = $atime, mtime = $mtime\n&#34;;
 
 print &#34;# utime \$fh\n&#34;;
 {
-- 
2.9.3

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;24&nbsp;22:27:01&nbsp;2016</span>
    <span class="description">simcop2387 [...] simcop2387.info -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #116127] t/utime.t fails on ext3</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 24 Sep 2016 19:26:44 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Time-HiRes [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ryan Voots &lt;simcop2387 [...] simcop2387.info&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Helps but there&#39;s still some issues, it looks like the other tests in there
are also expecting sub-second times, in particular it looks like the first
four failures here are happening because $got_atime, and $got_mtime are
both rounded up to 1, but $now is properly more precise.  Since all of
these tests seem to require the filesystem to support &lt;1 sec precision, i
think it would be best to skip the tests since while everything will
function, it won&#39;t ever pass on the case of ext2/ext3 &#40;i suspect other
older filesystems too but don&#39;t have an exhaustive list&#41;.

t/utime.t ......... 1/18
#   Failed test &#39;File 1 atime set correctly&#39;
#   at t/utime.t line 112.
#     &#39;0.955666065216064&#39;
#         &lt;
#     &#39;0.1&#39;

#   Failed test &#39;File 1 mtime set correctly&#39;
#   at t/utime.t line 113.
#     &#39;0.955666065216064&#39;
#         &lt;
#     &#39;0.1&#39;

#   Failed test &#39;File 2 atime set correctly&#39;
#   at t/utime.t line 117.
#     &#39;0.955666065216064&#39;
#         &lt;
#     &#39;0.1&#39;

#   Failed test &#39;File 2 mtime set correctly&#39;
#   at t/utime.t line 118.
#     &#39;0.955666065216064&#39;
#         &lt;
#     &#39;0.1&#39;

#   Failed test &#39;negative time error&#39;
#   at t/utime.t line 125.
#                   &#39;Time::HiRes::utime&#40;-4, 2&#41;: negative time not invented
yet at t/utime.t line 124.
# &#39;
#     doesn&#39;t match &#39;&#40;?^:::utime\&#40;-4, 2\.22222\&#41;: negative time not
invented yet&#41;&#39;

#   Failed test &#39;negative time error&#39;
#   at t/utime.t line 132.
#                   &#39;Time::HiRes::utime&#40;1, -4&#41;: negative time not invented
yet at t/utime.t line 131.
# &#39;
#     doesn&#39;t match &#39;&#40;?^:::utime\&#40;1.11111, -4\&#41;: negative time not invented
yet&#41;&#39;
# Looks like you failed 6 tests of 18.
t/utime.t ......... Dubious, test returned 6 &#40;wstat 1536, 0x600&#41;
Failed 6/18 subtests

Test Summary Report
-------------------
t/utime.t       &#40;Wstat: 1536 Tests: 18 Failed: 6&#41;
  Failed tests:  13-18
  Non-zero exit status: 6
Files=12, Tests=113, 26 wallclock secs &#40; 0.08 usr  0.03 sys + 14.18 cusr
0.12 csys = 14.41 CPU&#41;
Result: FAIL
Failed 1/12 test programs. 6/113 subtests failed.
Makefile:1032: recipe for target &#39;test_dynamic&#39; failed
make: *** [test_dynamic] Error 6


On Sat, Sep 24, 2016 at 7:16 PM, Jarkko_Hietaniemi via RT &lt;
bug-Time-HiRes@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=116127">https://rt.cpan.org/Ticket/Display.html?id=116127</a></span> &gt;
&gt;
&gt; If you could try the attached patch?  It is against the Perl core &#40;because
&gt; that&#39;s the primary source of Time-HiRes now&#41;, so e.g. &#34;git am&#34; is probably
&gt; not going to work well, but manual patching with &#34;patch -p2 &lt; 0001-*.patch&#34;
&gt; while in the Time-HiRes directory should work.
&gt;
&gt;
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;24&nbsp;22:45:10&nbsp;2016</span>
    <span class="description">JHI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hmm, okay. Thanks for testing.  Please try the try #2.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-Detect-ext3-ext2-they-do-not-have-hires-utime.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 361d755d54edbe0a5bae1406a34fd055562cd133 Mon Sep 17 00:00:00 2001
From: Jarkko Hietaniemi &lt;jhi@iki.fi&gt;
Date: Sat, 24 Sep 2016 22:01:59 -0400
Subject: [PATCH] Detect ext3/ext2, they do not have hires utime.

---
 dist/Time-HiRes/t/utime.t | 43 ++++++++++++++++++++++++++++++++++++++++---
 1 file changed, 40 insertions&#40;+&#41;, 3 deletions&#40;-&#41;

diff --git a/dist/Time-HiRes/t/utime.t b/dist/Time-HiRes/t/utime.t
index ede2e78..795252e 100644
--- a/dist/Time-HiRes/t/utime.t
+++ b/dist/Time-HiRes/t/utime.t
@@ -3,6 +3,7 @@ use strict;
 BEGIN {
     require Time::HiRes;
     require Test::More;
+    require File::Temp;
     unless&#40;&#38;Time::HiRes::d_hires_utime&#41; {
 	Test::More::plan&#40;skip_all =&gt; &#34;no hires_utime&#34;&#41;;
     }
@@ -15,6 +16,35 @@ BEGIN {
     if &#40;$^O eq &#39;gnukfreebsd&#39;&#41; {
 	Test::More::plan&#40;skip_all =&gt; &#34;futimens&#40;&#41; and utimensat&#40;&#41; not working in $^O&#34;&#41;;
     }
+    if &#40;$^O eq &#39;linux&#39; &#38;&#38; -e &#39;/proc/mounts&#39;&#41; {
+        # The linux might be wrong when ext3
+        # is available in other operating systems,
+        # but then we need other methods for detecting
+        # the filesystem type of the tempfiles.
+        my &#40;$fh, $fn&#41; = File::Temp::tempfile&#40;UNLINK =&gt; 1&#41;;
+        sub getfstype {
+            my &#40;$fn&#41; = @_;
+            my $cmd = &#34;df $fn&#34;;
+            open&#40;my $df, &#34;$cmd |&#34;&#41; or die &#34;$cmd: $!&#34;;
+             my @df = &lt;$df&gt;;  # Assume $df[0] is header line.
+             my $dev = +&#40;split&#40;&#34; &#34;, $df[1]&#41;&#41;[0];
+             open&#40;my $mounts, &#34;/proc/mounts&#34;&#41; or die &#34;/proc/mounts: $!&#34;;
+             while &#40;&lt;$mounts&gt;&#41; {
+                 my @m = split&#40;&#34; &#34;&#41;;
+                 if &#40;$m[0] eq $dev&#41; { return $m[2] }
+             }
+             return;
+          }
+          my $fstype = getfstype&#40;$fn&#41;;
+          unless &#40;defined $fstype&#41; {
+              warn &#34;Unknown fstype for $fn\n&#34;;
+          } else {
+              print &#34;# fstype = $fstype\n&#34;;
+              if &#40;$fstype eq &#39;ext3&#39; || $fstype eq &#39;ext2&#39;&#41; {
+                  Test::More::plan&#40;skip_all =&gt; &#34;fstype $fstype has no subsecond timestamps in $^O&#34;&#41;;
+            }
+        }
+    }
 }
 
 use Test::More tests =&gt; 18;
@@ -23,9 +53,16 @@ use File::Temp qw&#40; tempfile &#41;;
 
 use Config;
 
-# Cygwin timestamps have less precision.
-my $atime = $^O eq &#39;cygwin&#39; ? 1.1111111 : 1.111111111;
-my $mtime = $^O eq &#39;cygwin&#39; ? 2.2222222 : 2.222222222;
+# Hope initially for nanosecond accuracy.
+my $atime = 1.111111111;
+my $mtime = 2.222222222;
+
+if &#40;$^O eq &#39;cygwin&#39;&#41; {
+   # Cygwin timestamps have less precision.
+   $atime = 1.1111111;
+   $mtime = 2.2222222;
+}
+print &#34;# \$^O = $^O, atime = $atime, mtime = $mtime\n&#34;;
 
 print &#34;# utime \$fh\n&#34;;
 {
-- 
2.9.3

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;24&nbsp;23:17:00&nbsp;2016</span>
    <span class="description">simcop2387 [...] simcop2387.info -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #116127] t/utime.t fails on ext3</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 24 Sep 2016 20:16:44 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Time-HiRes [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ryan Voots &lt;simcop2387 [...] simcop2387.info&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Passes here,

-&gt; % make test
Running Mkbootstrap for Time::HiRes &#40;&#41;
chmod 644 &#34;HiRes.bs&#34;
PERL_DL_NONLAZY=1 &#34;/home/ryan/perl5/perlbrew/perls/perl-5.22.0/bin/perl&#34;
&#34;-MExtUtils::Command::MM&#34; &#34;-MTest::Harness&#34; &#34;-e&#34; &#34;undef
*Test::Harness::Switches; test_harness&#40;0, &#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/*.t
t/alarm.t ......... ok
t/clock.t ......... ok
t/gettimeofday.t .. ok
t/itimer.t ........ ok
t/nanosleep.t ..... ok
t/sleep.t ......... ok
t/stat.t .......... ok
t/time.t .......... ok
t/tv_interval.t ... ok
t/ualarm.t ........ ok
t/usleep.t ........ ok
t/utime.t ......... skipped: fstype ext3 has no subsecond timestamps in
linux
All tests successful.
Files=12, Tests=95, 26 wallclock secs &#40; 0.09 usr  0.02 sys + 14.18 cusr
0.14 csys = 14.43 CPU&#41;
Result: PASS


On Sat, Sep 24, 2016 at 7:45 PM, Jarkko_Hietaniemi via RT &lt;
bug-Time-HiRes@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=116127">https://rt.cpan.org/Ticket/Display.html?id=116127</a></span> &gt;
&gt;
&gt; Hmm, okay. Thanks for testing.  Please try the try #2.
&gt;
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;25&nbsp;18:40:57&nbsp;2016</span>
    <span class="description">JHI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Released Time-HiRes 1.9740.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;25&nbsp;19:12:59&nbsp;2016</span>
    <span class="description">simcop2387 [...] simcop2387.info -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #116127] t/utime.t fails on ext3</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 25 Sep 2016 16:12:48 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Time-HiRes [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ryan Voots &lt;simcop2387 [...] simcop2387.info&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Just tested it off cpan, works great

On Sun, Sep 25, 2016 at 3:40 PM, Jarkko_Hietaniemi via RT &lt;
bug-Time-HiRes@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=116127">https://rt.cpan.org/Ticket/Display.html?id=116127</a></span> &gt;
&gt;
&gt; Released Time-HiRes 1.9740.
&gt;
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;02&nbsp;03:17:17&nbsp;2016</span>
    <span class="description">PERRAD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Sep 25 18:40:57 2016, JHI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Released Time-HiRes 1.9740.
</div>
The version 1.9740 still fails on my box, see <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/1ecc29dc-84b6-11e6-be39-9d3809623efe">http://www.cpantesters.org/cpan/report/1ecc29dc-84b6-11e6-be39-9d3809623efe</a></span>

The reason is :
- tempfile&#40;&#41; with template gives a file in the current directory which is on ext2
- tempfile&#40;&#41; without template gives a file in /tmp which is on ext4

The attached patch solves this issue.

Francois
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-use-everywhere-tempfile-with-template.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">use everywhere tempfile&#40;&#41; with template

Signed-off-by: Francois Perrad &lt;francois.perrad@gadz.org&gt;

--- a/t/utime.t
+++ b/t/utime.t
@@ -21,7 +21,7 @@ BEGIN {
         # is available in other operating systems,
         # but then we need other methods for detecting
         # the filesystem type of the tempfiles.
-        my &#40;$fh, $fn&#41; = File::Temp::tempfile&#40;UNLINK =&gt; 1&#41;;
+        my &#40;$fh, $fn&#41; = File::Temp::tempfile&#40; &#34;Time-HiRes-utime-XXXXXXXXX&#34;, UNLINK =&gt; 1&#41;;
         sub getfstype {
             my &#40;$fn&#41; = @_;
             my $cmd = &#34;df $fn&#34;;
-- 

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;09&nbsp;16:54:27&nbsp;2016</span>
    <span class="description">jkeenan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Oct 02 03:17:17 2016, PERRAD wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sun Sep 25 18:40:57 2016, JHI wrote:
<div class="message-stanza open">&gt; &gt; Released Time-HiRes 1.9740.
</div>&gt; 
&gt; The version 1.9740 still fails on my box, see
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/1ecc29dc-84b6-11e6-be39-">http://www.cpantesters.org/cpan/report/1ecc29dc-84b6-11e6-be39-</a></span>
&gt; 9d3809623efe
&gt; 
&gt; The reason is :
&gt; - tempfile&#40;&#41; with template gives a file in the current directory which
&gt; is on ext2
&gt; - tempfile&#40;&#41; without template gives a file in /tmp which is on ext4
&gt; 
&gt; The attached patch solves this issue.
&gt; 
&gt; Francois
</div>
Offline, Jarkko asked me to take care of this patch, i.e., apply it to Perl 5 blead, as Time-HiRes is &#34;blead upstream.&#34;  I did so; see <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.git.perl.org/perl.git/commitdiff/91dca83e">http://perl5.git.perl.org/perl.git/commitdiff/91dca83e</a></span>.

François, could you verify that Perl 5 blead PASSes for you on your mixed-filesystem architecture?  If there are *still* problems with Time-HiRes, could you then open a bug ticket with &#39;perlbug&#39;?

I recommend that this ticket be closed.

Thank you very much.
Jim Keenan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;15&nbsp;05:57:22&nbsp;2016</span>
    <span class="description">PERRAD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Oct 09 16:54:27 2016, JKEENAN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sun Oct 02 03:17:17 2016, PERRAD wrote:
<div class="message-stanza open">&gt; &gt; On Sun Sep 25 18:40:57 2016, JHI wrote:
<div class="message-stanza open">&gt; &gt; &gt; Released Time-HiRes 1.9740.
</div>&gt; &gt;
&gt; &gt; The version 1.9740 still fails on my box, see
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/1ecc29dc-84b6-11e6-be39-">http://www.cpantesters.org/cpan/report/1ecc29dc-84b6-11e6-be39-</a></span>
&gt; &gt; 9d3809623efe
&gt; &gt;
&gt; &gt; The reason is :
&gt; &gt; - tempfile&#40;&#41; with template gives a file in the current directory
&gt; &gt; which
&gt; &gt; is on ext2
&gt; &gt; - tempfile&#40;&#41; without template gives a file in /tmp which is on ext4
&gt; &gt;
&gt; &gt; The attached patch solves this issue.
&gt; &gt;
&gt; &gt; Francois
</div>&gt; 
&gt; Offline, Jarkko asked me to take care of this patch, i.e., apply it to
&gt; Perl 5 blead, as Time-HiRes is &#34;blead upstream.&#34;  I did so; see
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.git.perl.org/perl.git/commitdiff/91dca83e">http://perl5.git.perl.org/perl.git/commitdiff/91dca83e</a></span>.
&gt; 
&gt; François, could you verify that Perl 5 blead PASSes for you on your
&gt; mixed-filesystem architecture?  If there are *still* problems with
&gt; Time-HiRes, could you then open a bug ticket with &#39;perlbug&#39;?
&gt; 
</div>
$ perlbrew install blead
dist/Time-HiRes/t/utime ........................................ skipped

So, it is OK.

François

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I recommend that this ticket be closed.
&gt; 
&gt; Thank you very much.
&gt; Jim Keenan
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;21&nbsp;09:22:10&nbsp;2017</span>
    <span class="description">CGPAN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I find this /proc/mounts and df magic a bit hacky and overengineered. You could instead touch a file twice with a subsecond sleep in between and check if you get subsecond stat&#40;&#41; results like this:


use Time::HiRes qw&#40;sleep stat&#41;;

sub have_subsecond_file_times {
  my @mtimes;
  for &#40;1..2&#41; {
    open my $f, &#39;&gt;&#39;, &#39;stattest&#39;;
    push @mtimes, &#40;stat $f&#41;[9];
    close $f;
    sleep .25 if $_ == 1;
  }
  my $delta = $mtimes[1] - $mtimes[0];
  return $delta &gt; 0 &#38;&#38; $delta &lt; 1;
}


This has the advantage that it doesn&#39;t depend on hard-coded assumptions on filesystem types and it works on systems other than Linux too.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;11&nbsp;09:14:35&nbsp;2018</span>
    <span class="description">jjnapiork [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">FWIW I still get this issue on any modern Perl, using Macosx Sierra.  Anything I can do to help?

John

On Fri Jul 21 09:22:10 2017, CGPAN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I find this /proc/mounts and df magic a bit hacky and overengineered.
&gt; You could instead touch a file twice with a subsecond sleep in between
&gt; and check if you get subsecond stat&#40;&#41; results like this:
&gt; 
&gt; 
&gt; use Time::HiRes qw&#40;sleep stat&#41;;
&gt; 
&gt; sub have_subsecond_file_times {
&gt;   my @mtimes;
&gt;   for &#40;1..2&#41; {
&gt;     open my $f, &#39;&gt;&#39;, &#39;stattest&#39;;
&gt;     push @mtimes, &#40;stat $f&#41;[9];
&gt;     close $f;
&gt;     sleep .25 if $_ == 1;
&gt;   }
&gt;   my $delta = $mtimes[1] - $mtimes[0];
&gt;   return $delta &gt; 0 &#38;&#38; $delta &lt; 1;
&gt; }
&gt; 
&gt; 
&gt; This has the advantage that it doesn&#39;t depend on hard-coded
&gt; assumptions on filesystem types and it works on systems other than
&gt; Linux too.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;11&nbsp;10:53:55&nbsp;2018</span>
    <span class="description">JHI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jan 11 09:14:35 2018, JJNAPIORK wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; FWIW I still get this issue on any modern Perl, using Macosx Sierra.
&gt; Anything I can do to help?
&gt; 
</div>
Including using the more recent releases of Time-HiRes from CPAN?  The newer releases should have fixed this problem.

The older releases Perl you can install to macosx obviously still have older releases of Time-HiRes.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;18&nbsp;02:50:47&nbsp;2018</span>
    <span class="description">JHI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jan 11 09:14:35 2018, JJNAPIORK wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; FWIW I still get this issue on any modern Perl, using Macosx Sierra.
&gt; Anything I can do to help?
</div>
Please tell us with which Perls and which Time-HiRes versions you have tested, and on which macosx filesystems?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; John
&gt; 
&gt; On Fri Jul 21 09:22:10 2017, CGPAN wrote:
<div class="message-stanza open">&gt; &gt; I find this /proc/mounts and df magic a bit hacky and overengineered.
&gt; &gt; You could instead touch a file twice with a subsecond sleep in
&gt; &gt; between
&gt; &gt; and check if you get subsecond stat&#40;&#41; results like this:
&gt; &gt;
&gt; &gt;
&gt; &gt; use Time::HiRes qw&#40;sleep stat&#41;;
&gt; &gt;
&gt; &gt; sub have_subsecond_file_times {
&gt; &gt;   my @mtimes;
&gt; &gt;   for &#40;1..2&#41; {
&gt; &gt;     open my $f, &#39;&gt;&#39;, &#39;stattest&#39;;
&gt; &gt;     push @mtimes, &#40;stat $f&#41;[9];
&gt; &gt;     close $f;
&gt; &gt;     sleep .25 if $_ == 1;
&gt; &gt;   }
&gt; &gt;   my $delta = $mtimes[1] - $mtimes[0];
&gt; &gt;   return $delta &gt; 0 &#38;&#38; $delta &lt; 1;
&gt; &gt; }
&gt; &gt;
&gt; &gt;
&gt; &gt; This has the advantage that it doesn&#39;t depend on hard-coded
&gt; &gt; assumptions on filesystem types and it works on systems other than
&gt; &gt; Linux too.
</div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;25&nbsp;13:19:27&nbsp;2018</span>
    <span class="description">joshr-cpan [...] joshr.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I just hit this building perl-5.26.2 on OSX 10.13.5.

Filesystem: Mac OS Extended &#40;Journaled&#41;

All tests pass except: 

# Looks like you failed 12 tests of 18.
../dist/Time-HiRes/t/utime.t .......................................
Dubious, test returned 12 &#40;wstat 3072, 0xc00&#41;
Failed 12/18 subtests
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;25&nbsp;14:26:42&nbsp;2018</span>
    <span class="description">joshr-cpan [...] joshr.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">update: 5.28.0 passes on the same system as the previous comment. 
Perhaps something needs to be backported?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;26&nbsp;12:17:42&nbsp;2018</span>
    <span class="description">jkeenan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jun 25 14:26:42 2018, JOSHR wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; update: 5.28.0 passes on the same system as the previous comment. 
&gt; Perhaps something needs to be backported?
</div>
The Time::HiRes distribution is now primarily maintained in the Perl 5 core distribution &#40;&#34;blead upstream&#34;&#41;.  For backporting to any perl-5.26.3 release, we need to have a ticket in the core distribution&#39;s issue tracker that we can link to the &#34;blockers for 5.26.3&#34; ticket.  Therefore, what I would ask you to do is the following:

1. Confirm that if you try to install the latest version available on CPAN &#40;<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/release/Time-HiRes&#41;">https://metacpan.org/release/Time-HiRes&#41;</a></span> against perl-5.26.2, it passes all its tests.  &#40;You don&#39;t actually have to install if you don&#39;t want to.  You could, e.g., say &#39;test Time::HiRes&#39; inside the &#39;cpan&#39; shell utility.&#41;

2. Assuming you get a PASS, please file a ticket via perlbug@perl.org with the following information:

a. &#39;perl -V&#39; information for your perl-5.26.2 installation.

b. For failing test, output of:

#####
cd t;./perl harness -v ../dist/Time-Hires/t/utime.t; cd -
#####

c. Link to *this* rt.cpan.org ticket.

d. Request to include in any perl-5.26.3 release.  &#40;I&#39;m not guaranteeing that there will be such a release; it&#39;s up to the maintenance pumpking.  But if you file such a ticket I will include it on the backport list.&#41;

Time::HiRes has moved on quite a bit since the release included in perl-5.26.2, so the backport may be tricky.

#####
$ corelist -a Time::HiRes | grep &#39;v5.26.2&#39;
  v5.26.2    1.9741 
#####

Thank you very much.
Jim Keenan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;10&nbsp;12:56:39&nbsp;2018</span>
    <span class="description">jkeenan [...] cpan.org -  Reference to perl ticket #133310 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
