<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #131661 for Keyword-Declare: Use of K::D::Arg for optional arguments breaks API and is not documented as such</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #131661 for Keyword-Declare: Use of K::D::Arg for optional arguments breaks API and is not documented as such</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Keyword-Declare/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Keyword-Declare/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Keyword-Declare/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Keyword-Declare/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Keyword-Declare">Keyword-Declare CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">131661</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Keyword-Declare/Active/">Keyword-Declare</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
CXW [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-260996-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.001015    </td>
  </tr>
  <tr id="CF-260997-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.001016    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;03&nbsp;22:38:18&nbsp;2020</span>
    <span class="description">CXW [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Use of K::D::Arg for optional arguments breaks API and is not
 documented as such</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Damian, thanks for this module, which I have been using in my own dists for a year or two.  I also greatly enjoyed your Inception conference-talk video. :&#41;

In v0.001015, my Test::OnlySome breaks: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=131643">https://rt.cpan.org/Ticket/Display.html?id=131643</a></span> &#40;thanks to ANDK for the report&#41;.  The keyword declaration is:

 keyword os&#40;String? $debug_var, Var? $opts_name, Num? $N,
            Block|Statement $controlled&#41;

&#40;e.g., to be used as `os ok&#40;1, &#34;this test passed &#40;if it was run&#41;&#34;&#41;`&#41;.

In &lt;= v0.001014, optional $debug_var, $opts_name, and $N are undef if the corresponding syntactic element is not present where the keyword is used.  However, in v0.001015, all three are K::D::Arg instances, thus defined, regardless of whether the element is present.  This contradicts the examples in the K::D POD, which still use `defined` to check whether an optional parameter is present.  &#40;E.g., <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/pod/release/DCONWAY/Keyword-Declare-0.001015/lib/Keyword/Declare.pm#DESCRIPTION">https://metacpan.org/pod/release/DCONWAY/Keyword-Declare-0.001015/lib/Keyword/Declare.pm#DESCRIPTION</a></span> &#41;.

- If you still intend `defined` to be usable to check whether an optional parameter is present, would you please not pass a K::D::Arg instance?
- If K::D::Arg is the desired API change even for this situation, would you please update the documentation to show how to check for presence of the argument?  If you wish, please feel free to use my current hack: <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/cxw42/Test-OnlySome/commit/1986bfb40f04e240f0c2645fd82126a9bb719c4e#diff-cbf0d9a93b7e8b6018777e7e108fbe18R521-R541">https://github.com/cxw42/Test-OnlySome/commit/1986bfb40f04e240f0c2645fd82126a9bb719c4e#diff-cbf0d9a93b7e8b6018777e7e108fbe18R521-R541</a></span> .  &#40;However, there&#39;s almost certainly a better way!&#41;

Thank you for considering this request!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;03&nbsp;22:38:43&nbsp;2020</span>
    <span class="description">CXW [...] cpan.org -  Reference to https://rt.cpan.org/Ticket/Display.html?id=131643 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;03&nbsp;22:39:10&nbsp;2020</span>
    <span class="description">CXW [...] cpan.org -  Reference by https://github.com/cxw42/Test-OnlySome/issues/15 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;03&nbsp;22:40:15&nbsp;2020</span>
    <span class="description">CXW [...] cpan.org -  Reference to ticket #131643 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links DeleteLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;03&nbsp;22:40:32&nbsp;2020</span>
    <span class="description">CXW [...] cpan.org -  Reference to https://rt.cpan.org/Ticket/Display.html?id=131643 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;04&nbsp;19:11:03&nbsp;2020</span>
    <span class="description">DCONWAY [...] cpan.org -  Status changed from &#39;new&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;04&nbsp;19:11:20&nbsp;2020</span>
    <span class="description">damian [...] conway.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #131661] Use of K::D::Arg for optional arguments breaks API and is not documented as such</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 5 Feb 2020 00:10:37 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Keyword-Declare [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Damian Conway &lt;damian [...] conway.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Christopher,

Thanks for the report.
I am sincerely sorry for having changed the API out from under you.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; - If K::D::Arg is the desired API change even for this situation,
&gt;   would you please update the documentation to show how to check for
&gt;   presence of the argument?
</div>
The API change was intentional &#40;and permanent&#41; so I have updated the
docs to show the correct way to test for a missing optional parameter.
In fact I added an entire subsection on that topic. That change has just
been uploaded to CPAN as Keyword::Declare version 0.001016.

The TLDR is that you should use length&#40;$optional_param&#41;
instead of defined&#40;$optional_param&#41; to check whether
an optional parameter was found.

Happily, using length&#40;&#41; instead of defined&#40;&#41; is backwards compatible
to previous &#40;i.e pre-K::D::Arg&#41; versions of K::D, so updating that
internal test within Test::OnlySome will not break your module for
those who are still using an older version of K::D.

Once again, I apologize for the breakage to your module,
and sincerely hope that this will be the last time that happens.

All the best,

Damian
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;14&nbsp;21:57:55&nbsp;2020</span>
    <span class="description">CXW [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Damian, 

No worries!  Thanks very much for your quick response.  I have modified Test::OnlySome to use length&#40;&#41; and it works fine.

If you&#39;re going to be in Houston for TPaRCiH, I&#39;ll thank you in person; either way, best regards!

Chris

On Tue Feb 04 19:11:20 2020, damian@conway.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Christopher,
&gt; 
&gt; Thanks for the report.
&gt; I am sincerely sorry for having changed the API out from under you.
&gt; 
&gt; 
<div class="message-stanza open">&gt; &gt; - If K::D::Arg is the desired API change even for this situation,
&gt; &gt;   would you please update the documentation to show how to check for
&gt; &gt;   presence of the argument?
</div>&gt; 
&gt; The API change was intentional &#40;and permanent&#41; so I have updated the
&gt; docs to show the correct way to test for a missing optional parameter.
&gt; In fact I added an entire subsection on that topic. That change has just
&gt; been uploaded to CPAN as Keyword::Declare version 0.001016.
&gt; 
&gt; The TLDR is that you should use length&#40;$optional_param&#41;
&gt; instead of defined&#40;$optional_param&#41; to check whether
&gt; an optional parameter was found.
&gt; 
&gt; Happily, using length&#40;&#41; instead of defined&#40;&#41; is backwards compatible
&gt; to previous &#40;i.e pre-K::D::Arg&#41; versions of K::D, so updating that
&gt; internal test within Test::OnlySome will not break your module for
&gt; those who are still using an older version of K::D.
&gt; 
&gt; Once again, I apologize for the breakage to your module,
&gt; and sincerely hope that this will be the last time that happens.
&gt; 
&gt; All the best,
&gt; 
&gt; Damian
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;14&nbsp;21:57:56&nbsp;2020</span>
    <span class="description">CXW [...] cpan.org -  Fixed in 0.001016 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;15&nbsp;00:14:21&nbsp;2020</span>
    <span class="description">damian [...] conway.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #131661] Use of K::D::Arg for optional arguments breaks API and is not documented as such</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 15 Feb 2020 05:13:34 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Keyword-Declare [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Damian Conway &lt;damian [...] conway.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Glad to have been able to sort it out, Chris.
Thanks again for the report.

Damian
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
