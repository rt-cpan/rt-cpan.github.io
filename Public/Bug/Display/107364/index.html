<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #107364 for UI-Dialog: Security problem: improper shell escaping in whiptail, cdialog and kdialog backends</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #107364 for UI-Dialog: Security problem: improper shell escaping in whiptail, cdialog and kdialog backends</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/UI-Dialog/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/UI-Dialog/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/UI-Dialog/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/UI-Dialog/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/UI-Dialog">UI-Dialog CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">107364</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/UI-Dialog/Active/">UI-Dialog</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">kevin [...] krinke.ca
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
matthijs [...] stdin.nl

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
CARNIL [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-34458-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-34459-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.13    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;27&nbsp;06:35:28&nbsp;2015</span>
    <span class="description">matthijs [...] stdin.nl -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Security problem: improper shell escaping in whiptail, cdialog and kdialog backends</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 27 Sep 2015 12:35:09 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-UI-Dialog [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Matthijs Kooijman &lt;matthijs [...] stdin.nl&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

it seems that the whiptail, cdialog and kdialog backends apply some
improper escaping in their shell commands, causing special characters
present in menu item titles to be interpreted by the shell. This
includes the backtick evaluation operator, so this constitutues a
security issue, allowing execution of arbitrary commands if an attacker
has control over the text displayed in a menu.

Here&#39;s a minimal script showing the problem:

        #!/usr/bin/perl
        use UI::Dialog;

        my $d = new UI::Dialog &#40; order =&gt; [&#34;whiptail&#34;], height =&gt; 20, listheight =&gt; 5, debug =&gt; 1&#41;;
        my @items = &#40;1, &#34;Running Debian `cat /etc/debian_version `&#34;&#41;;
        my $selected = $d-&gt;menu&#40; text =&gt; &#34;Correctly escaped `here`&#34;, list =&gt; \@items&#41;;

Which produces:

        Debug: /usr/bin/whiptail  --menu &#34;Correctly escaped \`here\`&#34; &#34;20&#34; &#34;65&#34; &#34;5&#34; &#34;1&#34; &#34;Running Debian \\`cat /etc/debian_version \\`&#34;
        ┌───────────────────────────────────────────────────────────────┐
        │ Correctly escaped `here`                                      │
        │                                                               │
        │                     1 Running Debian \8.0                     │

As you can see, the ` are escaped using \, but then the \ is
additionally escaped itself, voiding its use. Adding some debugging
output in the menu&#40;&#41; function in Backend/Whiptail.pm showed that this
line escapes the `:

    my $args = $self-&gt;_pre&#40;$caller,@_&#41;;

And this line then additionally escapes the \, breaking things:

    my $command = $self-&gt;_mk_cmnd&#40;&#34; --menu&#34;,@_&#41;;

This problem only occurs for the &#34;list&#34; option, not for the &#34;text&#34;
option. I suspect that plain strings work and strings in arrays break,
perhaps because _pre references arrays instead of copying them? I
haven&#39;t actually confirmed this, though.

What&#39;s interesting is that the zenity backend also uses shell commands,
but does not have this problem. Looking at its list&#40;&#41; function &#40;which is
called by menu&#40;&#41;&#41;, it is similar to Whiptail&#39;s menu&#40;&#41; but has:

    my $command = $self-&gt;_mk_cmnd&#40;&#34; --list&#34;,$args&#41;;

so it passes $args instead of @_. Applying the same change to Whiptail
also makes Whiptail work correctly, but my Perl-fu is not strong enough
to know why, or if this would be a solution.

I suspect that some other functions &#40;checklist&#40;&#41;, radiolist&#40;&#41;, perhaps
others&#41; will suffer from the same problem, but I have not tested this.

I would think this problem would need a CVE assigned and perhaps be
coordinated with the Linux distribution security teams. Let me know if
you want to do this, else I&#39;ll contact the Debian security team and ask
them to handle this.


Gr.

Matthijs
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;27&nbsp;12:15:25&nbsp;2015</span>
    <span class="description">kevin [...] krinke.ca -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello!
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; it seems that the whiptail, cdialog and kdialog backends apply some
&gt; improper escaping in their shell commands, causing special characters
&gt; present in menu item titles to be interpreted by the shell. This
&gt; includes the backtick evaluation operator, so this constitutues a
&gt; security issue, allowing execution of arbitrary commands if an
&gt; attacker
&gt; has control over the text displayed in a menu.
</div>
I&#39;ve been meaning to re-write the command construction routines to use
proper shell escaping consistently throughout the backends. Haven&#39;t
managed to find the time as of yet.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I would think this problem would need a CVE assigned and perhaps be
&gt; coordinated with the Linux distribution security teams. Let me know if
&gt; you want to do this, else I&#39;ll contact the Debian security team and
&gt; ask
&gt; them to handle this.
</div>
I&#39;m uncertain that this requires a CVE to be assigned because in order
for this to be exploitable, the attacker has to have write access to
the script in which case I&#39;d say they&#39;ve already compromised the box
via other means... unless of course you&#39;re using UI::Dialog in some
auth context? which would be strange and obviously not recommended at
all.

However, if you could bring this up with the various security teams and
get their take on how to proceed; I think that is the best course of
action.

In the meantime, I&#39;ll find time to put some honest efforts into the
re-write and follow up on this issue as I make headway over the course
of the next week.

My best,
-- 
Kevin C. Krinke &lt;kevin@krinke.ca&gt;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;27&nbsp;12:15:26&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;27&nbsp;12:28:45&nbsp;2015</span>
    <span class="description">matthijs [...] stdin.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #107364] Security problem: improper shell escaping in whiptail, cdialog and kdialog backends</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 27 Sep 2015 18:28:23 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;Kevin C. Krinke via RT&#34; &lt;bug-UI-Dialog [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Matthijs Kooijman &lt;matthijs [...] stdin.nl&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hey Kevin,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m uncertain that this requires a CVE to be assigned because in order
&gt; for this to be exploitable, the attacker has to have write access to
&gt; the script in which case I&#39;d say they&#39;ve already compromised the box
&gt; via other means... unless of course you&#39;re using UI::Dialog in some
&gt; auth context? which would be strange and obviously not recommended at
&gt; all.
</div>I have a script that parses URLs from an e-mail and uses UI::dialog to
prompt me to select one. This means that sending me a specially crafted
e-mail could cause execution of arbitrary commands on my system. More
generally it doesn&#39;t seem unreasonable to use UI::dialog to handle
untrusted user input, so I suspect there might be other scripts affected
in this way as well.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; However, if you could bring this up with the various security teams and
&gt; get their take on how to proceed; I think that is the best course of
&gt; action.
</div>I&#39;ll contact the Debian team, see what they think.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In the meantime, I&#39;ll find time to put some honest efforts into the
&gt; re-write and follow up on this issue as I make headway over the course
&gt; of the next week.
</div>Awesome, thanks!

Matthijs
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;08&nbsp;07:37:17&nbsp;2015</span>
    <span class="description">CARNIL [...] cpan.org -  Cc CARNIL added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;09&nbsp;04:54:13&nbsp;2015</span>
    <span class="description">kevin [...] krinke.ca -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hola Matthijs,

I&#39;ve made some progress and pushed the changes to a development branch on the github project for UI::Dialog[1]. If you could test this out to your satisfaction I&#39;d appreciate the second set of eyes before I push a CPAN release. Thanks!

[1] <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/kckrinke/UI-Dialog/tree/development">https://github.com/kckrinke/UI-Dialog/tree/development</a></span>

-- 
Kevin C. Krinke
kevin@krinke.ca
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;09&nbsp;16:11:53&nbsp;2015</span>
    <span class="description">CARNIL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> CVE-2008-7315 assigned</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">CVE-2008-7315 has been assigned for this issue, see <span class="clickylink"><a target="new" rel="nofollow" href="http://www.openwall.com/lists/oss-security/2015/10/08/6">http://www.openwall.com/lists/oss-security/2015/10/08/6</a></span>

Could you please reference it in the changes as well once there is a new fixing version?

Regards,
Salvatore
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;09&nbsp;16:13:02&nbsp;2015</span>
    <span class="description">CARNIL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Oct 09 16:11:53 2015, CARNIL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; CVE-2008-7315 has been assigned for this issue, see
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.openwall.com/lists/oss-security/2015/10/08/6">http://www.openwall.com/lists/oss-security/2015/10/08/6</a></span>
&gt; 
&gt; Could you please reference it in the changes as well once there is a
&gt; new fixing version?
</div>
Nevermind, I see it was already. Thanks a lot for that.

Regards,
Salvatore
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;12&nbsp;14:28:00&nbsp;2015</span>
    <span class="description">kevin [...] krinke.ca -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Oct 09 04:54:13 2015, KCK wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; [1] <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/kckrinke/UI-Dialog/tree/development">https://github.com/kckrinke/UI-Dialog/tree/development</a></span>
</div>
Not satisfied with my first hacktastic attempt at fixing the problem; I&#39;ve
gone and re-written the entire internal command preparation semantics and
arrived at what I believe is a truly consistent model for managing trusted
and untrusted input.

Regression testing is a manual process at this time and any/all help with
this development branch would be appreciated.

-- 
Kevin C. Krinke
kevin@krinke.ca
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;13&nbsp;05:45:48&nbsp;2015</span>
    <span class="description">matthijs [...] stdin.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> CARNIL [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #107364] Security problem: improper shell escaping in whiptail, cdialog and kdialog backends</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 13 Oct 2015 11:45:31 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;Kevin C. Krinke via RT&#34; &lt;bug-UI-Dialog [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Matthijs Kooijman &lt;matthijs [...] stdin.nl&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Kevin,

I just gave the test branch a whirl, and it seems it indeed fixes the
security issue. There&#39;s still two things I&#39;m wondering:

 - If I include $&#40;pwd&#41; in a menu item, it seems that the $ is *removed*
   from the displayed string. When I use `, it seems a normal quote &#39; is
   displayed instead. I guess that completely removing these potentially
   dangerous characters is safest, but this also limits the
   expressiveness of scripts. Was escaping these characters instead of
   removing them not possible?

 - Looking through the commits, it seems you added support to mark input
   as &#34;trusted&#34;, which I presume it will not be subjected to sanitizing
   / escaping. However, what&#39;s the actual usecase for this? If some
   script wants to include shell output inside a string, it can just run
   the shell itself and then pass the resulting value to UI::Dialog?
   Even more, I do not think all backends actually use shell commands,
   so embedding shell escapes wouldn&#39;t actually work with all backends?

   I haven&#39;t looked at the trusted input changes in much detail, since
   I&#39;m not familiar with the code, and a lot of whitespace changes
   clouded that diff.

Gr.

Matthijs
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;13&nbsp;19:59:41&nbsp;2015</span>
    <span class="description">kevin [...] krinke.ca -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #107364] Security problem: improper shell escaping in whiptail, cdialog and kdialog backends</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 13 Oct 2015 19:59:29 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-UI-Dialog [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Krinke &lt;kevin [...] krinke.ca&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Matthijs,

On Oct 13, 2015 5:46 AM, &#34;Matthijs Kooijman via RT&#34; &lt;
bug-UI-Dialog@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;        Queue: UI-Dialog
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107364">https://rt.cpan.org/Ticket/Display.html?id=107364</a></span> &gt;
&gt;
&gt; Hi Kevin,
&gt;
&gt; I just gave the test branch a whirl, and it seems it indeed fixes the
&gt; security issue. There&#39;s still two things I&#39;m wondering:
&gt;
&gt;  - If I include $&#40;pwd&#41; in a menu item, it seems that the $ is *removed*
&gt;    from the displayed string. When I use `, it seems a normal quote &#39; is
&gt;    displayed instead. I guess that completely removing these potentially
&gt;    dangerous characters is safest, but this also limits the
&gt;    expressiveness of scripts. Was escaping these characters instead of
&gt;    removing them not possible?
</div>
The escaping proved to be unreliable and I quickly hit corner cases where
you&#39;d see \&#39;s but the $&#40; got removed from the output by the shell, or
rather, $&#40; isn&#39;t a variable and was replaced with null space.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  - Looking through the commits, it seems you added support to mark input
&gt;    as &#34;trusted&#34;, which I presume it will not be subjected to sanitizing
&gt;    / escaping. However, what&#39;s the actual usecase for this? If some
&gt;    script wants to include shell output inside a string, it can just run
&gt;    the shell itself and then pass the resulting value to UI::Dialog?
&gt;    Even more, I do not think all backends actually use shell commands,
&gt;    so embedding shell escapes wouldn&#39;t actually work with all backends?
</div>
All backends use system&#40;&#41; with the exception of ASCII.

I personally have scripts that utilize sub-commands which I trust the input
from and so this feature makes sense to me. The default behaviour is the
safest possible while still allowing for the programmer to explicitly
enable the trust-input behavior.

Also, I would like to maintain as much backwards compatibility as possible,
otherwise there&#39;s a lot of things I&#39;d fundamentally change.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;    I haven&#39;t looked at the trusted input changes in much detail, since
&gt;    I&#39;m not familiar with the code, and a lot of whitespace changes
&gt;    clouded that diff.
</div>
There should be an option on github to ignore the whitespace when viewing
changes.

The general indentation over the years has somehow gotten mangled with tabs
and inconsistent spacing... figured I&#39;d cleanup as much of the code as I
can before putting things on back to maintenance only mode.

As a final note, I figured out a simple path to unit testing the problem.
Half of the backends are in compliance, others need work still. Just found
out Xdialog has been removed from debian completely and I can&#39;t even
compile it from source because libgtk1.2-dev doesn&#39;t exist in debian
either! *sighs* I&#39;m going to attempt porting Xdialog to Mate at some point.

My best,
Kevin
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;31&nbsp;13:01:43&nbsp;2016</span>
    <span class="description">kevin [...] krinke.ca -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Oct 13 19:59:41 2015, KCK wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Matthijs,
&gt; 
&gt; On Oct 13, 2015 5:46 AM, &#34;Matthijs Kooijman via RT&#34; &lt;
&gt; bug-UI-Dialog@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt; &gt;
&gt; &gt;        Queue: UI-Dialog
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107364">https://rt.cpan.org/Ticket/Display.html?id=107364</a></span> &gt;
&gt; &gt;
&gt; &gt; Hi Kevin,
&gt; &gt;
&gt; &gt; I just gave the test branch a whirl, and it seems it indeed fixes the
&gt; &gt; security issue. There&#39;s still two things I&#39;m wondering:
&gt; &gt;
&gt; &gt;  - If I include $&#40;pwd&#41; in a menu item, it seems that the $ is *removed*
&gt; &gt;    from the displayed string. When I use `, it seems a normal quote &#39; is
&gt; &gt;    displayed instead. I guess that completely removing these potentially
&gt; &gt;    dangerous characters is safest, but this also limits the
&gt; &gt;    expressiveness of scripts. Was escaping these characters instead of
&gt; &gt;    removing them not possible?
</div>&gt; 
&gt; The escaping proved to be unreliable and I quickly hit corner cases where
&gt; you&#39;d see \&#39;s but the $&#40; got removed from the output by the shell, or
&gt; rather, $&#40; isn&#39;t a variable and was replaced with null space.
&gt; 
<div class="message-stanza open">&gt; &gt;  - Looking through the commits, it seems you added support to mark input
&gt; &gt;    as &#34;trusted&#34;, which I presume it will not be subjected to sanitizing
&gt; &gt;    / escaping. However, what&#39;s the actual usecase for this? If some
&gt; &gt;    script wants to include shell output inside a string, it can just run
&gt; &gt;    the shell itself and then pass the resulting value to UI::Dialog?
&gt; &gt;    Even more, I do not think all backends actually use shell commands,
&gt; &gt;    so embedding shell escapes wouldn&#39;t actually work with all backends?
</div>&gt; 
&gt; All backends use system&#40;&#41; with the exception of ASCII.
&gt; 
&gt; I personally have scripts that utilize sub-commands which I trust the input
&gt; from and so this feature makes sense to me. The default behaviour is the
&gt; safest possible while still allowing for the programmer to explicitly
&gt; enable the trust-input behavior.
&gt; 
&gt; Also, I would like to maintain as much backwards compatibility as possible,
&gt; otherwise there&#39;s a lot of things I&#39;d fundamentally change.
&gt; 
<div class="message-stanza open">&gt; &gt;    I haven&#39;t looked at the trusted input changes in much detail, since
&gt; &gt;    I&#39;m not familiar with the code, and a lot of whitespace changes
&gt; &gt;    clouded that diff.
</div>&gt; 
&gt; There should be an option on github to ignore the whitespace when viewing
&gt; changes.
&gt; 
&gt; The general indentation over the years has somehow gotten mangled with tabs
&gt; and inconsistent spacing... figured I&#39;d cleanup as much of the code as I
&gt; can before putting things on back to maintenance only mode.
&gt; 
&gt; As a final note, I figured out a simple path to unit testing the problem.
&gt; Half of the backends are in compliance, others need work still. Just found
&gt; out Xdialog has been removed from debian completely and I can&#39;t even
&gt; compile it from source because libgtk1.2-dev doesn&#39;t exist in debian
&gt; either! *sighs* I&#39;m going to attempt porting Xdialog to Mate at some point.
&gt; 
&gt; My best,
&gt; Kevin
</div>

-- 
Kevin C. Krinke &lt;kevin@krinke.ca&gt;
GPG Key: <span class="clickylink"><a target="new" rel="nofollow" href="http://bit.ly/1eXz4W8">http://bit.ly/1eXz4W8</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;31&nbsp;13:01:45&nbsp;2016</span>
    <span class="description">kevin [...] krinke.ca -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;31&nbsp;13:01:45&nbsp;2016</span>
    <span class="description">kevin [...] krinke.ca -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;31&nbsp;13:01:45&nbsp;2016</span>
    <span class="description">kevin [...] krinke.ca -  Fixed in 1.13 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
