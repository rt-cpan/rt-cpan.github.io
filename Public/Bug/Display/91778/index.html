<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #91778 for MCE: Feature Request: Support for lazy arrays of input data</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #91778 for MCE: Feature Request: Support for lazy arrays of input data</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=MCE">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=MCE">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=MCE">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=MCE">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/marioroy/mce-perl/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/MCE">MCE CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">91778</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=MCE">MCE</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jeff [...] stratopan.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-246582-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-246583-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=91778">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1307140" href="/Public/Bug/Display.html?id=91778#txn-1307140">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;01&nbsp;03:35:34&nbsp;2014</span>
    <span class="description">jeff [...] stratopan.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Feature Request: Support for lazy arrays of input data</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 1 Jan 2014 00:35:18 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MCE [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jeffrey Ryan Thalhammer &lt;jeff [...] stratopan.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1307140/692659/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/692659">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 511b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve been using MCE as part of Stratopan.com and it has been wonderful.  Thanks so much for your great work!

To further optimize performance and memory consumption, I&#39;d like to pass MCE-&gt;process&#40;&#41; a lazy array that is filled only when each element is accessed &#40;such as Tie::Array::Lazy&#41;.

This currently won&#39;t work because MCE wants to know the total length of the input data array, but the length would be unknown for a lazy array.

Or perhaps I could tie the data to a filehandle instead?

Happy New Year!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1307150" href="/Public/Bug/Display.html?id=91778#txn-1307150">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;01&nbsp;04:29:17&nbsp;2014</span>
    <span class="description">marioeroy [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91778] Feature Request: Support for lazy arrays of input data</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 1 Jan 2014 04:29:07 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MCE [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mario Roy &lt;marioeroy [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1307150/692666/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/692666">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Jeffrey,

Yes, that&#39;s correct. MCE needs the length when processing data via the
input_data option or via the process method.

However, one can create a lazy array from the manager process. Workers can
call MCE-&gt;do&#40;&#39;callback_func&#39;, ...&#41; to retrieve values from the lazy array.
In this case, input_data is not specified and MCE-&gt;run&#40;0&#41; is used versus
MCE-&gt;process&#40;...&#41;.

The MCE-&gt;do&#40;...&#41; method is bi-directional.

my @list = MCE-&gt;do&#40;&#39;get_items&#39;, $optional_arg1, $optional_argN&#41;;
my $next = MCE-&gt;do&#40;&#39;get_next&#39;&#41;;


The MCE-&gt;do method can be called as often as needed. The worker will need
to know when to break out of a loop.

Define lazy array;

sub get_next {
   return item&#40;s&#41; from lazy array;
}

MCE-&gt;new&#40;
   ...
   user_func =&gt; sub {
      my &#40;$self&#41; = @_;
      while &#40;1&#41; {
         my $next = MCE-&gt;do&#40;&#39;get_next&#39;&#41;;
         last unless defined $next;
         ...
      }
   }
&#41;;

MCE-&gt;run&#40;0&#41;;


Regards,
Mario



On Wed, Jan 1, 2014 at 3:35 AM, Jeffrey Ryan Thalhammer via RT &lt;
bug-MCE@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Wed Jan 01 03:35:34 2014: Request 91778 was acted upon.
&gt; Transaction: Ticket created by jeff@stratopan.com
&gt;        Queue: MCE
&gt;      Subject: Feature Request: Support for lazy arrays of input data
&gt;    Broken in: &#40;no value&#41;
&gt;     Severity: &#40;no value&#41;
&gt;        Owner: Nobody
&gt;   Requestors: jeff@stratopan.com
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91778">https://rt.cpan.org/Ticket/Display.html?id=91778</a></span> &gt;
&gt;
&gt;
&gt; I&#39;ve been using MCE as part of Stratopan.com and it has been wonderful.
&gt;  Thanks so much for your great work!
&gt;
&gt; To further optimize performance and memory consumption, I&#39;d like to pass
&gt; MCE-&gt;process&#40;&#41; a lazy array that is filled only when each element is
&gt; accessed &#40;such as Tie::Array::Lazy&#41;.
&gt;
&gt; This currently won&#39;t work because MCE wants to know the total length of
&gt; the input data array, but the length would be unknown for a lazy array.
&gt;
&gt; Or perhaps I could tie the data to a filehandle instead?
&gt;
&gt; Happy New Year!
&gt;
&gt;
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1307150/692667/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/692667">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.9k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1307151" href="/Public/Bug/Display.html?id=91778#txn-1307151">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;01&nbsp;04:29:17&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1307161" href="/Public/Bug/Display.html?id=91778#txn-1307161">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;01&nbsp;05:03:43&nbsp;2014</span>
    <span class="description">marioeroy [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91778] Feature Request: Support for lazy arrays of input data</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 1 Jan 2014 05:03:33 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MCE [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mario Roy &lt;marioeroy [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1307161/692674/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/692674">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Saving this URL for review later on.
<span class="clickylink"><a target="new" rel="nofollow" href="http://stackoverflow.com/questions/109880/is-there-a-perl-solution-for-lazy-lists-this-side-of-perl-6">http://stackoverflow.com/questions/109880/is-there-a-perl-solution-for-lazy-lists-this-side-of-perl-6</a></span>

Perhaps, will enhance input_data or add a new input_iterator option. In the
meantime, MCE-do&#40;...&#41; can be used.

Not related, I&#39;m currently working on a script to wrap MCE around the grep,
egrep, fgrep, agrep and tre-agrep C binaries.

Will look into lazy-arrays and/or custom iterators afterwards.

Happy New Year,

-mario



On Wed, Jan 1, 2014 at 4:29 AM, Mario Roy via RT &lt;bug-MCE@rt.cpan.org&gt;wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: MCE
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91778">https://rt.cpan.org/Ticket/Display.html?id=91778</a></span> &gt;
&gt;
&gt; Hi Jeffrey,
&gt;
&gt; Yes, that&#39;s correct. MCE needs the length when processing data via the
&gt; input_data option or via the process method.
&gt;
&gt; However, one can create a lazy array from the manager process. Workers can
&gt; call MCE-&gt;do&#40;&#39;callback_func&#39;, ...&#41; to retrieve values from the lazy array.
&gt; In this case, input_data is not specified and MCE-&gt;run&#40;0&#41; is used versus
&gt; MCE-&gt;process&#40;...&#41;.
&gt;
&gt; The MCE-&gt;do&#40;...&#41; method is bi-directional.
&gt;
&gt; my @list = MCE-&gt;do&#40;&#39;get_items&#39;, $optional_arg1, $optional_argN&#41;;
&gt; my $next = MCE-&gt;do&#40;&#39;get_next&#39;&#41;;
&gt;
&gt;
&gt; The MCE-&gt;do method can be called as often as needed. The worker will need
&gt; to know when to break out of a loop.
&gt;
&gt; Define lazy array;
&gt;
&gt; sub get_next {
&gt;    return item&#40;s&#41; from lazy array;
&gt; }
&gt;
&gt; MCE-&gt;new&#40;
&gt;    ...
&gt;    user_func =&gt; sub {
&gt;       my &#40;$self&#41; = @_;
&gt;       while &#40;1&#41; {
&gt;          my $next = MCE-&gt;do&#40;&#39;get_next&#39;&#41;;
&gt;          last unless defined $next;
&gt;          ...
&gt;       }
&gt;    }
&gt; &#41;;
&gt;
&gt; MCE-&gt;run&#40;0&#41;;
&gt;
&gt;
&gt; Regards,
&gt; Mario
&gt;
&gt;
&gt;
&gt; On Wed, Jan 1, 2014 at 3:35 AM, Jeffrey Ryan Thalhammer via RT &lt;
&gt; bug-MCE@rt.cpan.org&gt; wrote:
&gt;
<div class="message-stanza open">&gt; &gt; Wed Jan 01 03:35:34 2014: Request 91778 was acted upon.
&gt; &gt; Transaction: Ticket created by jeff@stratopan.com
&gt; &gt;        Queue: MCE
&gt; &gt;      Subject: Feature Request: Support for lazy arrays of input data
&gt; &gt;    Broken in: &#40;no value&#41;
&gt; &gt;     Severity: &#40;no value&#41;
&gt; &gt;        Owner: Nobody
&gt; &gt;   Requestors: jeff@stratopan.com
&gt; &gt;       Status: new
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91778">https://rt.cpan.org/Ticket/Display.html?id=91778</a></span> &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; I&#39;ve been using MCE as part of Stratopan.com and it has been wonderful.
&gt; &gt;  Thanks so much for your great work!
&gt; &gt;
&gt; &gt; To further optimize performance and memory consumption, I&#39;d like to pass
&gt; &gt; MCE-&gt;process&#40;&#41; a lazy array that is filled only when each element is
&gt; &gt; accessed &#40;such as Tie::Array::Lazy&#41;.
&gt; &gt;
&gt; &gt; This currently won&#39;t work because MCE wants to know the total length of
&gt; &gt; the input data array, but the length would be unknown for a lazy array.
&gt; &gt;
&gt; &gt; Or perhaps I could tie the data to a filehandle instead?
&gt; &gt;
&gt; &gt; Happy New Year!
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt;
</div>&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1307161/692675/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/692675">with headers</a>
<br />
<span class="downloadcontenttype">text/html 3.9k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1310553" href="/Public/Bug/Display.html?id=91778#txn-1310553">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;10&nbsp;15:48:15&nbsp;2014</span>
    <span class="description">marioeroy [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91778] Feature Request: Support for lazy arrays of input data</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 10 Jan 2014 15:48:06 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MCE [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mario Roy &lt;marioeroy [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1310553/694583/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/694583">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Looking into this now. If feasible, will be included for the upcoming MCE
1.505 release.

Regards,
Mario


On Wed, Jan 1, 2014 at 5:03 AM, Mario Roy via RT &lt;bug-MCE@rt.cpan.org&gt;wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: MCE
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91778">https://rt.cpan.org/Ticket/Display.html?id=91778</a></span> &gt;
&gt;
&gt; Saving this URL for review later on.
&gt;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://stackoverflow.com/questions/109880/is-there-a-perl-solution-for-lazy-lists-this-side-of-perl-6">http://stackoverflow.com/questions/109880/is-there-a-perl-solution-for-lazy-lists-this-side-of-perl-6</a></span>
&gt;
&gt; Perhaps, will enhance input_data or add a new input_iterator option. In the
&gt; meantime, MCE-do&#40;...&#41; can be used.
&gt;
&gt; Not related, I&#39;m currently working on a script to wrap MCE around the grep,
&gt; egrep, fgrep, agrep and tre-agrep C binaries.
&gt;
&gt; Will look into lazy-arrays and/or custom iterators afterwards.
&gt;
&gt; Happy New Year,
&gt;
&gt; -mario
&gt;
&gt;
&gt;
&gt; On Wed, Jan 1, 2014 at 4:29 AM, Mario Roy via RT &lt;bug-MCE@rt.cpan.org
<div class="message-stanza open">&gt; &gt;wrote:
</div>&gt;
<div class="message-stanza open">&gt; &gt;        Queue: MCE
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91778">https://rt.cpan.org/Ticket/Display.html?id=91778</a></span> &gt;
&gt; &gt;
&gt; &gt; Hi Jeffrey,
&gt; &gt;
&gt; &gt; Yes, that&#39;s correct. MCE needs the length when processing data via the
&gt; &gt; input_data option or via the process method.
&gt; &gt;
&gt; &gt; However, one can create a lazy array from the manager process. Workers
</div>&gt; can
<div class="message-stanza open">&gt; &gt; call MCE-&gt;do&#40;&#39;callback_func&#39;, ...&#41; to retrieve values from the lazy
</div>&gt; array.
<div class="message-stanza open">&gt; &gt; In this case, input_data is not specified and MCE-&gt;run&#40;0&#41; is used versus
&gt; &gt; MCE-&gt;process&#40;...&#41;.
&gt; &gt;
&gt; &gt; The MCE-&gt;do&#40;...&#41; method is bi-directional.
&gt; &gt;
&gt; &gt; my @list = MCE-&gt;do&#40;&#39;get_items&#39;, $optional_arg1, $optional_argN&#41;;
&gt; &gt; my $next = MCE-&gt;do&#40;&#39;get_next&#39;&#41;;
&gt; &gt;
&gt; &gt;
&gt; &gt; The MCE-&gt;do method can be called as often as needed. The worker will need
&gt; &gt; to know when to break out of a loop.
&gt; &gt;
&gt; &gt; Define lazy array;
&gt; &gt;
&gt; &gt; sub get_next {
&gt; &gt;    return item&#40;s&#41; from lazy array;
&gt; &gt; }
&gt; &gt;
&gt; &gt; MCE-&gt;new&#40;
&gt; &gt;    ...
&gt; &gt;    user_func =&gt; sub {
&gt; &gt;       my &#40;$self&#41; = @_;
&gt; &gt;       while &#40;1&#41; {
&gt; &gt;          my $next = MCE-&gt;do&#40;&#39;get_next&#39;&#41;;
&gt; &gt;          last unless defined $next;
&gt; &gt;          ...
&gt; &gt;       }
&gt; &gt;    }
&gt; &gt; &#41;;
&gt; &gt;
&gt; &gt; MCE-&gt;run&#40;0&#41;;
&gt; &gt;
&gt; &gt;
&gt; &gt; Regards,
&gt; &gt; Mario
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; On Wed, Jan 1, 2014 at 3:35 AM, Jeffrey Ryan Thalhammer via RT &lt;
&gt; &gt; bug-MCE@rt.cpan.org&gt; wrote:
&gt; &gt;
<div class="message-stanza open">&gt; &gt; &gt; Wed Jan 01 03:35:34 2014: Request 91778 was acted upon.
&gt; &gt; &gt; Transaction: Ticket created by jeff@stratopan.com
&gt; &gt; &gt;        Queue: MCE
&gt; &gt; &gt;      Subject: Feature Request: Support for lazy arrays of input data
&gt; &gt; &gt;    Broken in: &#40;no value&#41;
&gt; &gt; &gt;     Severity: &#40;no value&#41;
&gt; &gt; &gt;        Owner: Nobody
&gt; &gt; &gt;   Requestors: jeff@stratopan.com
&gt; &gt; &gt;       Status: new
&gt; &gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91778">https://rt.cpan.org/Ticket/Display.html?id=91778</a></span> &gt;
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; I&#39;ve been using MCE as part of Stratopan.com and it has been wonderful.
&gt; &gt; &gt;  Thanks so much for your great work!
&gt; &gt; &gt;
&gt; &gt; &gt; To further optimize performance and memory consumption, I&#39;d like to
</div></div>&gt; pass
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; MCE-&gt;process&#40;&#41; a lazy array that is filled only when each element is
&gt; &gt; &gt; accessed &#40;such as Tie::Array::Lazy&#41;.
&gt; &gt; &gt;
&gt; &gt; &gt; This currently won&#39;t work because MCE wants to know the total length of
&gt; &gt; &gt; the input data array, but the length would be unknown for a lazy array.
&gt; &gt; &gt;
&gt; &gt; &gt; Or perhaps I could tie the data to a filehandle instead?
&gt; &gt; &gt;
&gt; &gt; &gt; Happy New Year!
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt;
</div>&gt; &gt;
&gt; &gt;
</div>&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1310553/694584/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/694584">with headers</a>
<br />
<span class="downloadcontenttype">text/html 4.7k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1311394" href="/Public/Bug/Display.html?id=91778#txn-1311394">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;13&nbsp;01:46:45&nbsp;2014</span>
    <span class="description">marioeroy [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91778] Feature Request: Support for lazy arrays of input data</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 13 Jan 2014 01:46:35 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MCE [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mario Roy &lt;marioeroy [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1311394/694965/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/694965">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 6.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Jeffrey,

Btw, I want to help you with the memory consumption aspect. Are workers
consuming a lot of memory or just the manager process or both? Are you
calling the spawn method before creating the array?

The upcoming MCE 1.505 will allow one to specify a code reference for
input_data. The lazy array may be declared inside the iterator closure
below &#40;was not sure if @a is needed after running MCE&#41;.

The code snippet below behaves similarly to other input_data types with
full support for chunk_size =&gt; 1 or greater, MCE-&gt;abort, MCE-&gt;next and
MCE-&gt;last.


use Tie::Array::Lazy;

use MCE;


tie my @a, &#39;Tie::Array::Lazy&#39;, [], sub {

   $_[0]-&gt;index;

};


sub _iterator {

   my $j = 0; my $max = 1000;


   return sub {

      my $i = $j; $j += MCE-&gt;chunk_size;


      return if $i &gt; $max;

      return $j &lt;= $max ? @a[$i .. $j - 1] : @a[$i .. $max];

   };

}


MCE-&gt;new&#40;

   max_workers =&gt; 4, chunk_size =&gt; 15, input_data =&gt; _iterator&#40;&#41;,


   user_func =&gt; sub {

      my &#40;$self, $chunk_ref, $chunk_id&#41; = @_;


      ## $_ = $chunk_ref-&gt;[0] when chunk_size =&gt; 1, otherwise $_ =
$chunk_ref

      ## MCE-&gt;print&#40;$_, &#34;\n&#34;&#41;;


      MCE-&gt;print&#40;&#34;$chunk_id: &#34;, join&#40;&#39; &#39;, @{ $chunk_ref }&#41;, &#34;\n&#34;&#41;;

   }


&#41;-&gt;run;




Will commit the update to MCE into SVN in the next couple of days.

In the meantime, the following can be done using MCE 1.504 &#40;chunk_size
being 1 by default&#41;. Length is used inside the while loop due to &#34;defined&#34;
not working -- will be fixed in 1.505 &#40;update to the do method to support
both &#34;&#34; and undef properly&#41;.


use Tie::Array::Lazy;

use MCE;


tie my @a, &#39;Tie::Array::Lazy&#39;, [], sub {

   $_[0]-&gt;index

};


{

   my $max = 1000; my $j = 0;


   sub _iterator {

      return if $j &gt; $max;

      return $a[$j++];

   }

}


my $mce = MCE-&gt;new&#40;

   max_workers =&gt; 4,

   user_func =&gt; sub {

      my &#40;$self&#41; = @_;

      while &#40;length &#40;my $next = MCE-&gt;do&#40;&#39;_iterator&#39;&#41;&#41;&#41; {

         MCE-&gt;print&#40;$next . &#34;\n&#34;&#41;;

      }

   }

&#41;-&gt;run;




Perhaps, you&#39;re wanting to chunk as well. Below works with MCE 1.504 while
waiting for 1.505 to be released soon.


use Tie::Array::Lazy;

use MCE;


tie my @a, &#39;Tie::Array::Lazy&#39;, [], sub {

   $_[0]-&gt;index

};


{

   my $max = 1000; my $chunk_size = 15; my $j = 0;


   sub _iterator {

      my $i = $j; $j += $chunk_size;

      return if $i &gt; $max;

      return &#40;$j &lt;= $max ? @a[$i .. $j - 1] : @a[$i .. $max]&#41;;

   }

}


MCE-&gt;new&#40;

   max_workers =&gt; 4,

   user_func =&gt; sub {

      my &#40;$self&#41; = @_;

      while &#40;my @next = MCE-&gt;do&#40;&#39;_iterator&#39;&#41;&#41; {

         MCE-&gt;print&#40;join&#40;&#39; &#39;, @next&#41;, &#34;\n&#34;&#41;;

      }

   }

&#41;-&gt;run;




Perhaps chunk_id is needed too.


use Tie::Array::Lazy;

use MCE;


tie my @a, &#39;Tie::Array::Lazy&#39;, [], sub {

   $_[0]-&gt;index

};


{

   my $max = 1000; my $chunk_size = 15; my $chunk_id = 0; my $j = 0;


   sub _iterator {

      my $i = $j; $j += $chunk_size;

      return if $i &gt; $max;

      return &#40;++$chunk_id, $j &lt;= $max ? @a[$i .. $j - 1] : @a[$i .. $max]&#41;;

   }

}


MCE-&gt;new&#40;

   max_workers =&gt; 4,

   user_func =&gt; sub {

      my &#40;$self&#41; = @_;

      while &#40;my &#40;$chunk_id, @next&#41; = MCE-&gt;do&#40;&#39;_iterator&#39;&#41;&#41; {

         MCE-&gt;print&#40;&#34;$chunk_id: &#34;, join&#40;&#39; &#39;, @next&#41;, &#34;\n&#34;&#41;;

      }

   }

&#41;-&gt;run;




Again, the MCE 1.505 release is coming soon.

Regards,
Mario



On Fri, Jan 10, 2014 at 3:48 PM, Mario Roy via RT &lt;bug-MCE@rt.cpan.org&gt;wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: MCE
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91778">https://rt.cpan.org/Ticket/Display.html?id=91778</a></span> &gt;
&gt;
&gt; Looking into this now. If feasible, will be included for the upcoming MCE
&gt; 1.505 release.
&gt;
&gt; Regards,
&gt; Mario
&gt;
&gt;
&gt; On Wed, Jan 1, 2014 at 5:03 AM, Mario Roy via RT &lt;bug-MCE@rt.cpan.org
<div class="message-stanza open">&gt; &gt;wrote:
</div>&gt;
<div class="message-stanza open">&gt; &gt;        Queue: MCE
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91778">https://rt.cpan.org/Ticket/Display.html?id=91778</a></span> &gt;
&gt; &gt;
&gt; &gt; Saving this URL for review later on.
&gt; &gt;
&gt; &gt;
</div>&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://stackoverflow.com/questions/109880/is-there-a-perl-solution-for-lazy-lists-this-side-of-perl-6">http://stackoverflow.com/questions/109880/is-there-a-perl-solution-for-lazy-lists-this-side-of-perl-6</a></span>
<div class="message-stanza open">&gt; &gt;
&gt; &gt; Perhaps, will enhance input_data or add a new input_iterator option. In
</div>&gt; the
<div class="message-stanza open">&gt; &gt; meantime, MCE-do&#40;...&#41; can be used.
&gt; &gt;
&gt; &gt; Not related, I&#39;m currently working on a script to wrap MCE around the
</div>&gt; grep,
<div class="message-stanza open">&gt; &gt; egrep, fgrep, agrep and tre-agrep C binaries.
&gt; &gt;
&gt; &gt; Will look into lazy-arrays and/or custom iterators afterwards.
&gt; &gt;
&gt; &gt; Happy New Year,
&gt; &gt;
&gt; &gt; -mario
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; On Wed, Jan 1, 2014 at 4:29 AM, Mario Roy via RT &lt;bug-MCE@rt.cpan.org
<div class="message-stanza open">&gt; &gt; &gt;wrote:
</div>&gt; &gt;
<div class="message-stanza open">&gt; &gt; &gt;        Queue: MCE
&gt; &gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91778">https://rt.cpan.org/Ticket/Display.html?id=91778</a></span> &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; Hi Jeffrey,
&gt; &gt; &gt;
&gt; &gt; &gt; Yes, that&#39;s correct. MCE needs the length when processing data via the
&gt; &gt; &gt; input_data option or via the process method.
&gt; &gt; &gt;
&gt; &gt; &gt; However, one can create a lazy array from the manager process. Workers
</div>&gt; &gt; can
<div class="message-stanza open">&gt; &gt; &gt; call MCE-&gt;do&#40;&#39;callback_func&#39;, ...&#41; to retrieve values from the lazy
</div>&gt; &gt; array.
<div class="message-stanza open">&gt; &gt; &gt; In this case, input_data is not specified and MCE-&gt;run&#40;0&#41; is used
</div></div>&gt; versus
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; MCE-&gt;process&#40;...&#41;.
&gt; &gt; &gt;
&gt; &gt; &gt; The MCE-&gt;do&#40;...&#41; method is bi-directional.
&gt; &gt; &gt;
&gt; &gt; &gt; my @list = MCE-&gt;do&#40;&#39;get_items&#39;, $optional_arg1, $optional_argN&#41;;
&gt; &gt; &gt; my $next = MCE-&gt;do&#40;&#39;get_next&#39;&#41;;
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; The MCE-&gt;do method can be called as often as needed. The worker will
</div></div>&gt; need
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; to know when to break out of a loop.
&gt; &gt; &gt;
&gt; &gt; &gt; Define lazy array;
&gt; &gt; &gt;
&gt; &gt; &gt; sub get_next {
&gt; &gt; &gt;    return item&#40;s&#41; from lazy array;
&gt; &gt; &gt; }
&gt; &gt; &gt;
&gt; &gt; &gt; MCE-&gt;new&#40;
&gt; &gt; &gt;    ...
&gt; &gt; &gt;    user_func =&gt; sub {
&gt; &gt; &gt;       my &#40;$self&#41; = @_;
&gt; &gt; &gt;       while &#40;1&#41; {
&gt; &gt; &gt;          my $next = MCE-&gt;do&#40;&#39;get_next&#39;&#41;;
&gt; &gt; &gt;          last unless defined $next;
&gt; &gt; &gt;          ...
&gt; &gt; &gt;       }
&gt; &gt; &gt;    }
&gt; &gt; &gt; &#41;;
&gt; &gt; &gt;
&gt; &gt; &gt; MCE-&gt;run&#40;0&#41;;
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; Regards,
&gt; &gt; &gt; Mario
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; On Wed, Jan 1, 2014 at 3:35 AM, Jeffrey Ryan Thalhammer via RT &lt;
&gt; &gt; &gt; bug-MCE@rt.cpan.org&gt; wrote:
&gt; &gt; &gt;
<div class="message-stanza open">&gt; &gt; &gt; &gt; Wed Jan 01 03:35:34 2014: Request 91778 was acted upon.
&gt; &gt; &gt; &gt; Transaction: Ticket created by jeff@stratopan.com
&gt; &gt; &gt; &gt;        Queue: MCE
&gt; &gt; &gt; &gt;      Subject: Feature Request: Support for lazy arrays of input data
&gt; &gt; &gt; &gt;    Broken in: &#40;no value&#41;
&gt; &gt; &gt; &gt;     Severity: &#40;no value&#41;
&gt; &gt; &gt; &gt;        Owner: Nobody
&gt; &gt; &gt; &gt;   Requestors: jeff@stratopan.com
&gt; &gt; &gt; &gt;       Status: new
&gt; &gt; &gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91778">https://rt.cpan.org/Ticket/Display.html?id=91778</a></span> &gt;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; I&#39;ve been using MCE as part of Stratopan.com and it has been
</div></div></div>&gt; wonderful.
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt;  Thanks so much for your great work!
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; To further optimize performance and memory consumption, I&#39;d like to
</div>&gt; &gt; pass
<div class="message-stanza open">&gt; &gt; &gt; &gt; MCE-&gt;process&#40;&#41; a lazy array that is filled only when each element is
&gt; &gt; &gt; &gt; accessed &#40;such as Tie::Array::Lazy&#41;.
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; This currently won&#39;t work because MCE wants to know the total length
</div></div>&gt; of
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt; the input data array, but the length would be unknown for a lazy
</div></div>&gt; array.
<div class="message-stanza open"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; Or perhaps I could tie the data to a filehandle instead?
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; Happy New Year!
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;
</div>&gt; &gt; &gt;
&gt; &gt; &gt;
</div>&gt; &gt;
&gt; &gt;
</div>&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1311394/694966/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/694966">with headers</a>
<br />
<span class="downloadcontenttype">text/html 22.9k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1311404" href="/Public/Bug/Display.html?id=91778#txn-1311404">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;13&nbsp;01:52:29&nbsp;2014</span>
    <span class="description">marioeroy [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91778] Feature Request: Support for lazy arrays of input data</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 13 Jan 2014 01:52:20 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MCE [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mario Roy &lt;marioeroy [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1311404/694974/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/694974">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 7.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I apologize for all the white-space in my previous email. It wasn&#39;t
like that when creating the reply. Going forward, I know to enable
&#34;plain text mode&#34; when replying to rt.cpan.org.

Best,
Mario


On Mon, Jan 13, 2014 at 1:46 AM, Mario Roy via RT &lt;bug-MCE@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: MCE
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91778">https://rt.cpan.org/Ticket/Display.html?id=91778</a></span> &gt;
&gt;
&gt; Hi Jeffrey,
&gt;
&gt; Btw, I want to help you with the memory consumption aspect. Are workers
&gt; consuming a lot of memory or just the manager process or both? Are you
&gt; calling the spawn method before creating the array?
&gt;
&gt; The upcoming MCE 1.505 will allow one to specify a code reference for
&gt; input_data. The lazy array may be declared inside the iterator closure
&gt; below &#40;was not sure if @a is needed after running MCE&#41;.
&gt;
&gt; The code snippet below behaves similarly to other input_data types with
&gt; full support for chunk_size =&gt; 1 or greater, MCE-&gt;abort, MCE-&gt;next and
&gt; MCE-&gt;last.
&gt;
&gt;
&gt; use Tie::Array::Lazy;
&gt;
&gt; use MCE;
&gt;
&gt;
&gt; tie my @a, &#39;Tie::Array::Lazy&#39;, [], sub {
&gt;
&gt;    $_[0]-&gt;index;
&gt;
&gt; };
&gt;
&gt;
&gt; sub _iterator {
&gt;
&gt;    my $j = 0; my $max = 1000;
&gt;
&gt;
&gt;    return sub {
&gt;
&gt;       my $i = $j; $j += MCE-&gt;chunk_size;
&gt;
&gt;
&gt;       return if $i &gt; $max;
&gt;
&gt;       return $j &lt;= $max ? @a[$i .. $j - 1] : @a[$i .. $max];
&gt;
&gt;    };
&gt;
&gt; }
&gt;
&gt;
&gt; MCE-&gt;new&#40;
&gt;
&gt;    max_workers =&gt; 4, chunk_size =&gt; 15, input_data =&gt; _iterator&#40;&#41;,
&gt;
&gt;
&gt;    user_func =&gt; sub {
&gt;
&gt;       my &#40;$self, $chunk_ref, $chunk_id&#41; = @_;
&gt;
&gt;
&gt;       ## $_ = $chunk_ref-&gt;[0] when chunk_size =&gt; 1, otherwise $_ =
&gt; $chunk_ref
&gt;
&gt;       ## MCE-&gt;print&#40;$_, &#34;\n&#34;&#41;;
&gt;
&gt;
&gt;       MCE-&gt;print&#40;&#34;$chunk_id: &#34;, join&#40;&#39; &#39;, @{ $chunk_ref }&#41;, &#34;\n&#34;&#41;;
&gt;
&gt;    }
&gt;
&gt;
&gt; &#41;-&gt;run;
&gt;
&gt;
&gt;
&gt;
&gt; Will commit the update to MCE into SVN in the next couple of days.
&gt;
&gt; In the meantime, the following can be done using MCE 1.504 &#40;chunk_size
&gt; being 1 by default&#41;. Length is used inside the while loop due to &#34;defined&#34;
&gt; not working -- will be fixed in 1.505 &#40;update to the do method to support
&gt; both &#34;&#34; and undef properly&#41;.
&gt;
&gt;
&gt; use Tie::Array::Lazy;
&gt;
&gt; use MCE;
&gt;
&gt;
&gt; tie my @a, &#39;Tie::Array::Lazy&#39;, [], sub {
&gt;
&gt;    $_[0]-&gt;index
&gt;
&gt; };
&gt;
&gt;
&gt; {
&gt;
&gt;    my $max = 1000; my $j = 0;
&gt;
&gt;
&gt;    sub _iterator {
&gt;
&gt;       return if $j &gt; $max;
&gt;
&gt;       return $a[$j++];
&gt;
&gt;    }
&gt;
&gt; }
&gt;
&gt;
&gt; my $mce = MCE-&gt;new&#40;
&gt;
&gt;    max_workers =&gt; 4,
&gt;
&gt;    user_func =&gt; sub {
&gt;
&gt;       my &#40;$self&#41; = @_;
&gt;
&gt;       while &#40;length &#40;my $next = MCE-&gt;do&#40;&#39;_iterator&#39;&#41;&#41;&#41; {
&gt;
&gt;          MCE-&gt;print&#40;$next . &#34;\n&#34;&#41;;
&gt;
&gt;       }
&gt;
&gt;    }
&gt;
&gt; &#41;-&gt;run;
&gt;
&gt;
&gt;
&gt;
&gt; Perhaps, you&#39;re wanting to chunk as well. Below works with MCE 1.504 while
&gt; waiting for 1.505 to be released soon.
&gt;
&gt;
&gt; use Tie::Array::Lazy;
&gt;
&gt; use MCE;
&gt;
&gt;
&gt; tie my @a, &#39;Tie::Array::Lazy&#39;, [], sub {
&gt;
&gt;    $_[0]-&gt;index
&gt;
&gt; };
&gt;
&gt;
&gt; {
&gt;
&gt;    my $max = 1000; my $chunk_size = 15; my $j = 0;
&gt;
&gt;
&gt;    sub _iterator {
&gt;
&gt;       my $i = $j; $j += $chunk_size;
&gt;
&gt;       return if $i &gt; $max;
&gt;
&gt;       return &#40;$j &lt;= $max ? @a[$i .. $j - 1] : @a[$i .. $max]&#41;;
&gt;
&gt;    }
&gt;
&gt; }
&gt;
&gt;
&gt; MCE-&gt;new&#40;
&gt;
&gt;    max_workers =&gt; 4,
&gt;
&gt;    user_func =&gt; sub {
&gt;
&gt;       my &#40;$self&#41; = @_;
&gt;
&gt;       while &#40;my @next = MCE-&gt;do&#40;&#39;_iterator&#39;&#41;&#41; {
&gt;
&gt;          MCE-&gt;print&#40;join&#40;&#39; &#39;, @next&#41;, &#34;\n&#34;&#41;;
&gt;
&gt;       }
&gt;
&gt;    }
&gt;
&gt; &#41;-&gt;run;
&gt;
&gt;
&gt;
&gt;
&gt; Perhaps chunk_id is needed too.
&gt;
&gt;
&gt; use Tie::Array::Lazy;
&gt;
&gt; use MCE;
&gt;
&gt;
&gt; tie my @a, &#39;Tie::Array::Lazy&#39;, [], sub {
&gt;
&gt;    $_[0]-&gt;index
&gt;
&gt; };
&gt;
&gt;
&gt; {
&gt;
&gt;    my $max = 1000; my $chunk_size = 15; my $chunk_id = 0; my $j = 0;
&gt;
&gt;
&gt;    sub _iterator {
&gt;
&gt;       my $i = $j; $j += $chunk_size;
&gt;
&gt;       return if $i &gt; $max;
&gt;
&gt;       return &#40;++$chunk_id, $j &lt;= $max ? @a[$i .. $j - 1] : @a[$i .. $max]&#41;;
&gt;
&gt;    }
&gt;
&gt; }
&gt;
&gt;
&gt; MCE-&gt;new&#40;
&gt;
&gt;    max_workers =&gt; 4,
&gt;
&gt;    user_func =&gt; sub {
&gt;
&gt;       my &#40;$self&#41; = @_;
&gt;
&gt;       while &#40;my &#40;$chunk_id, @next&#41; = MCE-&gt;do&#40;&#39;_iterator&#39;&#41;&#41; {
&gt;
&gt;          MCE-&gt;print&#40;&#34;$chunk_id: &#34;, join&#40;&#39; &#39;, @next&#41;, &#34;\n&#34;&#41;;
&gt;
&gt;       }
&gt;
&gt;    }
&gt;
&gt; &#41;-&gt;run;
&gt;
&gt;
&gt;
&gt;
&gt; Again, the MCE 1.505 release is coming soon.
&gt;
&gt; Regards,
&gt; Mario
&gt;
&gt;
&gt;
&gt; On Fri, Jan 10, 2014 at 3:48 PM, Mario Roy via RT &lt;bug-MCE@rt.cpan.org&gt;wrote:
&gt;
<div class="message-stanza open">&gt;&gt;        Queue: MCE
&gt;&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91778">https://rt.cpan.org/Ticket/Display.html?id=91778</a></span> &gt;
&gt;&gt;
&gt;&gt; Looking into this now. If feasible, will be included for the upcoming MCE
&gt;&gt; 1.505 release.
&gt;&gt;
&gt;&gt; Regards,
&gt;&gt; Mario
&gt;&gt;
&gt;&gt;
&gt;&gt; On Wed, Jan 1, 2014 at 5:03 AM, Mario Roy via RT &lt;bug-MCE@rt.cpan.org
<div class="message-stanza open">&gt;&gt; &gt;wrote:
</div>&gt;&gt;
<div class="message-stanza open">&gt;&gt; &gt;        Queue: MCE
&gt;&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91778">https://rt.cpan.org/Ticket/Display.html?id=91778</a></span> &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; Saving this URL for review later on.
&gt;&gt; &gt;
&gt;&gt; &gt;
</div>&gt;&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://stackoverflow.com/questions/109880/is-there-a-perl-solution-for-lazy-lists-this-side-of-perl-6">http://stackoverflow.com/questions/109880/is-there-a-perl-solution-for-lazy-lists-this-side-of-perl-6</a></span>
<div class="message-stanza open">&gt;&gt; &gt;
&gt;&gt; &gt; Perhaps, will enhance input_data or add a new input_iterator option. In
</div>&gt;&gt; the
<div class="message-stanza open">&gt;&gt; &gt; meantime, MCE-do&#40;...&#41; can be used.
&gt;&gt; &gt;
&gt;&gt; &gt; Not related, I&#39;m currently working on a script to wrap MCE around the
</div>&gt;&gt; grep,
<div class="message-stanza open">&gt;&gt; &gt; egrep, fgrep, agrep and tre-agrep C binaries.
&gt;&gt; &gt;
&gt;&gt; &gt; Will look into lazy-arrays and/or custom iterators afterwards.
&gt;&gt; &gt;
&gt;&gt; &gt; Happy New Year,
&gt;&gt; &gt;
&gt;&gt; &gt; -mario
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt;
&gt;&gt; &gt; On Wed, Jan 1, 2014 at 4:29 AM, Mario Roy via RT &lt;bug-MCE@rt.cpan.org
<div class="message-stanza open">&gt;&gt; &gt; &gt;wrote:
</div>&gt;&gt; &gt;
<div class="message-stanza open">&gt;&gt; &gt; &gt;        Queue: MCE
&gt;&gt; &gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91778">https://rt.cpan.org/Ticket/Display.html?id=91778</a></span> &gt;
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt; Hi Jeffrey,
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt; Yes, that&#39;s correct. MCE needs the length when processing data via the
&gt;&gt; &gt; &gt; input_data option or via the process method.
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt; However, one can create a lazy array from the manager process. Workers
</div>&gt;&gt; &gt; can
<div class="message-stanza open">&gt;&gt; &gt; &gt; call MCE-&gt;do&#40;&#39;callback_func&#39;, ...&#41; to retrieve values from the lazy
</div>&gt;&gt; &gt; array.
<div class="message-stanza open">&gt;&gt; &gt; &gt; In this case, input_data is not specified and MCE-&gt;run&#40;0&#41; is used
</div></div>&gt;&gt; versus
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt; &gt; &gt; MCE-&gt;process&#40;...&#41;.
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt; The MCE-&gt;do&#40;...&#41; method is bi-directional.
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt; my @list = MCE-&gt;do&#40;&#39;get_items&#39;, $optional_arg1, $optional_argN&#41;;
&gt;&gt; &gt; &gt; my $next = MCE-&gt;do&#40;&#39;get_next&#39;&#41;;
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt; The MCE-&gt;do method can be called as often as needed. The worker will
</div></div>&gt;&gt; need
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt; &gt; &gt; to know when to break out of a loop.
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt; Define lazy array;
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt; sub get_next {
&gt;&gt; &gt; &gt;    return item&#40;s&#41; from lazy array;
&gt;&gt; &gt; &gt; }
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt; MCE-&gt;new&#40;
&gt;&gt; &gt; &gt;    ...
&gt;&gt; &gt; &gt;    user_func =&gt; sub {
&gt;&gt; &gt; &gt;       my &#40;$self&#41; = @_;
&gt;&gt; &gt; &gt;       while &#40;1&#41; {
&gt;&gt; &gt; &gt;          my $next = MCE-&gt;do&#40;&#39;get_next&#39;&#41;;
&gt;&gt; &gt; &gt;          last unless defined $next;
&gt;&gt; &gt; &gt;          ...
&gt;&gt; &gt; &gt;       }
&gt;&gt; &gt; &gt;    }
&gt;&gt; &gt; &gt; &#41;;
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt; MCE-&gt;run&#40;0&#41;;
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt; Regards,
&gt;&gt; &gt; &gt; Mario
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt; On Wed, Jan 1, 2014 at 3:35 AM, Jeffrey Ryan Thalhammer via RT &lt;
&gt;&gt; &gt; &gt; bug-MCE@rt.cpan.org&gt; wrote:
&gt;&gt; &gt; &gt;
<div class="message-stanza open">&gt;&gt; &gt; &gt; &gt; Wed Jan 01 03:35:34 2014: Request 91778 was acted upon.
&gt;&gt; &gt; &gt; &gt; Transaction: Ticket created by jeff@stratopan.com
&gt;&gt; &gt; &gt; &gt;        Queue: MCE
&gt;&gt; &gt; &gt; &gt;      Subject: Feature Request: Support for lazy arrays of input data
&gt;&gt; &gt; &gt; &gt;    Broken in: &#40;no value&#41;
&gt;&gt; &gt; &gt; &gt;     Severity: &#40;no value&#41;
&gt;&gt; &gt; &gt; &gt;        Owner: Nobody
&gt;&gt; &gt; &gt; &gt;   Requestors: jeff@stratopan.com
&gt;&gt; &gt; &gt; &gt;       Status: new
&gt;&gt; &gt; &gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91778">https://rt.cpan.org/Ticket/Display.html?id=91778</a></span> &gt;
&gt;&gt; &gt; &gt; &gt;
&gt;&gt; &gt; &gt; &gt;
&gt;&gt; &gt; &gt; &gt; I&#39;ve been using MCE as part of Stratopan.com and it has been
</div></div></div>&gt;&gt; wonderful.
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt; &gt; &gt; &gt;  Thanks so much for your great work!
&gt;&gt; &gt; &gt; &gt;
&gt;&gt; &gt; &gt; &gt; To further optimize performance and memory consumption, I&#39;d like to
</div>&gt;&gt; &gt; pass
<div class="message-stanza open">&gt;&gt; &gt; &gt; &gt; MCE-&gt;process&#40;&#41; a lazy array that is filled only when each element is
&gt;&gt; &gt; &gt; &gt; accessed &#40;such as Tie::Array::Lazy&#41;.
&gt;&gt; &gt; &gt; &gt;
&gt;&gt; &gt; &gt; &gt; This currently won&#39;t work because MCE wants to know the total length
</div></div>&gt;&gt; of
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt; &gt; &gt; &gt; the input data array, but the length would be unknown for a lazy
</div></div>&gt;&gt; array.
<div class="message-stanza open"><div class="message-stanza open"><div class="message-stanza open">&gt;&gt; &gt; &gt; &gt;
&gt;&gt; &gt; &gt; &gt; Or perhaps I could tie the data to a filehandle instead?
&gt;&gt; &gt; &gt; &gt;
&gt;&gt; &gt; &gt; &gt; Happy New Year!
&gt;&gt; &gt; &gt; &gt;
&gt;&gt; &gt; &gt; &gt;
&gt;&gt; &gt; &gt; &gt;
&gt;&gt; &gt; &gt; &gt;
</div>&gt;&gt; &gt; &gt;
&gt;&gt; &gt; &gt;
</div>&gt;&gt; &gt;
&gt;&gt; &gt;
</div>&gt;&gt;
&gt;&gt;
</div>&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1311956" href="/Public/Bug/Display.html?id=91778#txn-1311956">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;13&nbsp;22:17:09&nbsp;2014</span>
    <span class="description">jeff [...] stratopan.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91778] Feature Request: Support for lazy arrays of input data</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 13 Jan 2014 19:17:00 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MCE [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jeffrey Thalhammer &lt;jeff [...] stratopan.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1311956/695293/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/695293">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 434b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I didn&#39;t quite follow your examples.  In my case, the chunk_size is always
1.  And I don&#39;t know the $max in advance &#40;because it is lazy&#41;.  So I&#39;d like
the manager to stop feeding workers when the iterator returns undef &#40;much
like when a filehandle reaches EOF&#41;.  But I can see how that may not be
desirable in other cases.

I&#39;ll look for the next release.  Perhaps it will be clear to me then.
 Thanks for being so responsive!

-Jeff
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1311956/695294/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/695294">with headers</a>
<br />
<span class="downloadcontenttype">text/html 638b</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1312028" href="/Public/Bug/Display.html?id=91778#txn-1312028">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;14&nbsp;01:19:40&nbsp;2014</span>
    <span class="description">marioeroy [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91778] Feature Request: Support for lazy arrays of input data</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 14 Jan 2014 01:19:32 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MCE [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mario Roy &lt;marioeroy [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1312028/695343/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/695343">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Jeff,

Thank you for your response. I have committed an update to MCE for the
feature request in SVN revision 423 &#40;main one&#41; and 424 &#40;small update
based on your last feedback&#41;. Here, undef is returned inside the code
block for the lazy array. I believe this is what you were after, now
that I understand better.

use Tie::Array::Lazy;
use MCE;

tie my @a, &#39;Tie::Array::Lazy&#39;, [], sub {
   my $i = $_[0]-&gt;index;
   return &#40;$i &lt; 10&#41; ? $i : undef;
};

sub make_iterator {
   my $i = 0; my $a_ref = shift;

   return sub {
      return $a_ref-&gt;[$i++];
   };
}

MCE-&gt;new&#40;
   max_workers =&gt; 4, input_data =&gt; make_iterator&#40;\@a&#41;,

   user_func =&gt; sub {
      my &#40;$self, $chunk_ref, $chunk_id&#41; = @_;
      MCE-&gt;print&#40;$_, &#34;\n&#34;&#41;;
   }

&#41;-&gt;run;

-- Output &#40;output order is not guaranteed, simply for demonstration&#41;

0
1
2
3
4
6
7
8
5
9


Regards,
Mario


On Mon, Jan 13, 2014 at 10:17 PM, Jeffrey Ryan Thalhammer via RT
&lt;bug-MCE@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: MCE
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91778">https://rt.cpan.org/Ticket/Display.html?id=91778</a></span> &gt;
&gt;
&gt; I didn&#39;t quite follow your examples.  In my case, the chunk_size is always
&gt; 1.  And I don&#39;t know the $max in advance &#40;because it is lazy&#41;.  So I&#39;d like
&gt; the manager to stop feeding workers when the iterator returns undef &#40;much
&gt; like when a filehandle reaches EOF&#41;.  But I can see how that may not be
&gt; desirable in other cases.
&gt;
&gt; I&#39;ll look for the next release.  Perhaps it will be clear to me then.
&gt;  Thanks for being so responsive!
&gt;
&gt; -Jeff
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1312031" href="/Public/Bug/Display.html?id=91778#txn-1312031">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;14&nbsp;01:58:00&nbsp;2014</span>
    <span class="description">jeff [...] stratopan.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91778] Feature Request: Support for lazy arrays of input data</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 13 Jan 2014 22:57:51 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MCE [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jeffrey Thalhammer &lt;jeff [...] stratopan.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1312031/695347/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/695347">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 124b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I *think* that is right.  Here&#39;s a more concrete example of what I&#39;m trying
to do:

<span class="clickylink"><a target="new" rel="nofollow" href="https://gist.github.com/thaljef/8414230">https://gist.github.com/thaljef/8414230</a></span>
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1312031/695348/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/695348">with headers</a>
<br />
<span class="downloadcontenttype">text/html 237b</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1312038" href="/Public/Bug/Display.html?id=91778#txn-1312038">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;14&nbsp;02:59:18&nbsp;2014</span>
    <span class="description">marioeroy [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91778] Feature Request: Support for lazy arrays of input data</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 14 Jan 2014 02:59:09 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MCE [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mario Roy &lt;marioeroy [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1312038/695355/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/695355">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Jeff,

That works quite well. Passing $iterator is all that&#39;s needed using
the latest MCE in svn r424. You may know this... Chunk size defaults
to 1 and $_ always contains the value when chunk_size is 1. Max
workers defaults to 1 as well.

use strict;
use warnings;

use Path::Iterator::Rule;
use MCE;

my $start_dir = shift or die &#34;Must specify a starting directory&#34;;
-d $start_dir or die &#34;$start_dir is not a directory or does not exist&#34;;

my $rule = Path::Iterator::Rule-&gt;new-&gt;file-&gt;name&#40; qr/[.]&#40;pm&#41;$/ &#41;;
my $iterator = $rule-&gt;iter&#40;$start_dir, {follow_symlinks =&gt; 0, depthfirst =&gt; 1}&#41;;

MCE-&gt;new&#40;
   max_workers =&gt; &#39;auto&#39;,
   input_data =&gt; $iterator,
   user_func =&gt; sub { print &#34;$_\n&#34; }
&#41;-&gt;run;


-- Output

$ ./mce-finder.pl ../.
.././lib/MCE/Core/Input/Generator.pm
.././lib/MCE/Core/Input/Handle.pm
.././lib/MCE/Core/Input/Iterator.pm
.././lib/MCE/Core/Input/Request.pm
.././lib/MCE/Core/Input/Sequence.pm
.././lib/MCE/Core/Manager.pm
.././lib/MCE/Core/Validation.pm
.././lib/MCE/Core/Worker.pm
.././lib/MCE/Flow.pm
.././lib/MCE/Grep.pm
.././lib/MCE/Loop.pm
.././lib/MCE/Map.pm
.././lib/MCE/Queue.pm
.././lib/MCE/Signal.pm
.././lib/MCE/Stream.pm
.././lib/MCE/Subs.pm
.././lib/MCE/Util.pm
.././lib/MCE.pm


This is really cool on being able to many-core an iterator like this.

Regards,
Mario


On Tue, Jan 14, 2014 at 1:58 AM, Jeffrey Ryan Thalhammer via RT
&lt;bug-MCE@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: MCE
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91778">https://rt.cpan.org/Ticket/Display.html?id=91778</a></span> &gt;
&gt;
&gt; I *think* that is right.  Here&#39;s a more concrete example of what I&#39;m trying
&gt; to do:
&gt;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://gist.github.com/thaljef/8414230">https://gist.github.com/thaljef/8414230</a></span>
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1312041" href="/Public/Bug/Display.html?id=91778#txn-1312041">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;14&nbsp;03:03:26&nbsp;2014</span>
    <span class="description">jeff [...] stratopan.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91778] Feature Request: Support for lazy arrays of input data</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 14 Jan 2014 00:03:18 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MCE [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jeffrey Thalhammer &lt;jeff [...] stratopan.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1312041/695359/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/695359">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 458b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, Jan 13, 2014 at 11:59 PM, Mario Roy via RT &lt;bug-MCE@rt.cpan.org&gt;wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;
&gt; That works quite well. Passing $iterator is all that&#39;s needed using
&gt; the latest MCE in svn r424. You may know this... Chunk size defaults
&gt; to 1 and $_ always contains the value when chunk_size is 1. Max
&gt; workers defaults to 1 as well.
</div>

That&#39;s great to hear!  I look forward to seeing the release.

I did not know that about the defaults.  Thanks for the protip!

-Jeff
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1312041/695360/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/695360">with headers</a>
<br />
<span class="downloadcontenttype">text/html 863b</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1312046" href="/Public/Bug/Display.html?id=91778#txn-1312046">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;14&nbsp;03:40:48&nbsp;2014</span>
    <span class="description">marioeroy [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91778] Feature Request: Support for lazy arrays of input data</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 14 Jan 2014 03:40:39 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MCE [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mario Roy &lt;marioeroy [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1312046/695364/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/695364">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ok, great. I added MCE-&gt;wid to the output just to see this in action.
Notice the many parallel workers.

MCE-&gt;new&#40;
   max_workers =&gt; &#39;auto&#39;,
   input_data =&gt; $iterator,
   user_func =&gt; sub { MCE-&gt;print&#40;MCE-&gt;wid, &#34;: $_\n&#34;&#41; }
&#41;-&gt;run;

-- Output

[mario@localhost examples]$ ./mce-finder.pl ../.
5: .././lib/MCE/Core/Input/Generator.pm
1: .././lib/MCE/Core/Input/Handle.pm
2: .././lib/MCE/Core/Input/Iterator.pm
3: .././lib/MCE/Core/Input/Request.pm
7: .././lib/MCE/Core/Manager.pm
8: .././lib/MCE/Core/Input/Sequence.pm
6: .././lib/MCE/Core/Validation.pm
4: .././lib/MCE/Core/Worker.pm
5: .././lib/MCE/Flow.pm
1: .././lib/MCE/Grep.pm
2: .././lib/MCE/Loop.pm
3: .././lib/MCE/Map.pm
7: .././lib/MCE/Queue.pm
8: .././lib/MCE/Signal.pm
6: .././lib/MCE/Stream.pm
4: .././lib/MCE/Subs.pm
5: .././lib/MCE/Util.pm
1: .././lib/MCE.pm

The MCE-&gt;print method &#40;there&#39;s also MCE-&gt;say and MCE-&gt;printf&#41; is
useful when wanting to serialize output from many workers. Otherwise,
it&#39;s possible that STDOUT may appear garbled when many workers are
writing simultaneously. MCE provides a chunking engine &#40;not needed
above&#41;, a many-core engine, and a serializing engine.

Therefore, if you ever need to serialize an action such as logging or
anything, you have the MCE-&gt;do&#40;&#39;callback&#39;&#41;,
MCE-&gt;sendto&#40;&#34;file:/path/to/log_file.log&#34;, $log_data&#41; and the output
methods MCE-&gt;say&#40;...&#41;, MCE-&gt;print&#40;...&#41;, and MCE-&gt;printf&#40;...&#41;.  All of
these can be called as many times as needed.  There is also
MCE-&gt;gather&#40;...&#41;, one specifies the gather option for where you want
the data to go to &#40;an array or a subroutine&#41;. The MCE::Loop pod doc
has a lot of usage on MCE-&gt;gather.

There are also the 5 models in MCE 1.5x. Below showing MCE::Loop. This
does the same thing as above with much less MCE code. The 5 models
configure max_workers =&gt; &#39;auto&#39; by default. However, we want 1 for
chunk_size and can be set on the same line when including the module.
Notice the mce_loop line. That&#39;s it.

use strict;
use warnings;

use Path::Iterator::Rule;
use MCE::Loop CHUNK_SIZE =&gt; 1;

my $start_dir = shift or die &#34;Must specify a starting directory&#34;;
-d $start_dir or die &#34;$start_dir is not a directory or does not exist&#34;;

my $rule = Path::Iterator::Rule-&gt;new-&gt;file-&gt;name&#40; qr/[.]&#40;pm&#41;$/ &#41;;
my $iterator = $rule-&gt;iter&#40;$start_dir, {follow_symlinks =&gt; 0, depthfirst =&gt; 1}&#41;;

mce_loop { MCE-&gt;print&#40;MCE-&gt;wid, &#34;: $_\n&#34;&#41; } $iterator;


Some folks prefer using the Core API while others enjoy using the new
models. It doesn&#39;t matter which folks use. MCE was created to help
folks maximize on all available cores.

Regards,
Mario
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1312049" href="/Public/Bug/Display.html?id=91778#txn-1312049">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;14&nbsp;03:59:58&nbsp;2014</span>
    <span class="description">marioeroy [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91778] Feature Request: Support for lazy arrays of input data</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 14 Jan 2014 03:59:49 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MCE [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mario Roy &lt;marioeroy [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1312049/695367/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/695367">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">For completeness and fairness to Tie::Array::Lazy &#40;the output did not
match previously&#41;. It needs the make_iterator function below.
Although, Tie::Array::Lazy isn&#39;t needed here, wanted to see this work.
Notice the $mce-&gt;process line below.

use MCE 1.505;
use Tie::Array::Lazy;
use Path::Iterator::Rule;

my $start_dir = shift or die &#34;Must specify a starting directory&#34;;
-d $start_dir or die &#34;$start_dir is not a directory or does not exist&#34;;

my $rule = Path::Iterator::Rule-&gt;new-&gt;file-&gt;name&#40; qr/[.]&#40;pm&#41;$/ &#41;;
my $iterator = $rule-&gt;iter&#40;$start_dir, {follow_symlinks =&gt; 0, depthfirst =&gt; 1}&#41;;
tie my @paths, &#39;Tie::Array::Lazy&#39;, [], sub {$iterator-&gt;&#40;&#41;};

sub make_iterator {
   my $i = 0; my $a_ref = shift;

   return sub {
      return $a_ref-&gt;[$i++];
   };
}

my $mce = MCE-&gt;new&#40; user_func =&gt; sub { print &#34;$_\n&#34; } &#41;;
$mce-&gt;process&#40;make_iterator&#40;\@paths&#41;&#41;;
$mce-&gt;shutdown;


It looks like MCE handles input iterators quite well. Will close off
the feature request. MCE 1.505 will be released this coming weekend.

Regards,
Mario


On Tue, Jan 14, 2014 at 3:40 AM, Mario Roy via RT &lt;bug-MCE@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: MCE
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91778">https://rt.cpan.org/Ticket/Display.html?id=91778</a></span> &gt;
&gt;
&gt; Ok, great. I added MCE-&gt;wid to the output just to see this in action.
&gt; Notice the many parallel workers.
&gt;
&gt; MCE-&gt;new&#40;
&gt;    max_workers =&gt; &#39;auto&#39;,
&gt;    input_data =&gt; $iterator,
&gt;    user_func =&gt; sub { MCE-&gt;print&#40;MCE-&gt;wid, &#34;: $_\n&#34;&#41; }
&gt; &#41;-&gt;run;
&gt;
&gt; -- Output
&gt;
&gt; [mario@localhost examples]$ ./mce-finder.pl ../.
&gt; 5: .././lib/MCE/Core/Input/Generator.pm
&gt; 1: .././lib/MCE/Core/Input/Handle.pm
&gt; 2: .././lib/MCE/Core/Input/Iterator.pm
&gt; 3: .././lib/MCE/Core/Input/Request.pm
&gt; 7: .././lib/MCE/Core/Manager.pm
&gt; 8: .././lib/MCE/Core/Input/Sequence.pm
&gt; 6: .././lib/MCE/Core/Validation.pm
&gt; 4: .././lib/MCE/Core/Worker.pm
&gt; 5: .././lib/MCE/Flow.pm
&gt; 1: .././lib/MCE/Grep.pm
&gt; 2: .././lib/MCE/Loop.pm
&gt; 3: .././lib/MCE/Map.pm
&gt; 7: .././lib/MCE/Queue.pm
&gt; 8: .././lib/MCE/Signal.pm
&gt; 6: .././lib/MCE/Stream.pm
&gt; 4: .././lib/MCE/Subs.pm
&gt; 5: .././lib/MCE/Util.pm
&gt; 1: .././lib/MCE.pm
&gt;
&gt; The MCE-&gt;print method &#40;there&#39;s also MCE-&gt;say and MCE-&gt;printf&#41; is
&gt; useful when wanting to serialize output from many workers. Otherwise,
&gt; it&#39;s possible that STDOUT may appear garbled when many workers are
&gt; writing simultaneously. MCE provides a chunking engine &#40;not needed
&gt; above&#41;, a many-core engine, and a serializing engine.
&gt;
&gt; Therefore, if you ever need to serialize an action such as logging or
&gt; anything, you have the MCE-&gt;do&#40;&#39;callback&#39;&#41;,
&gt; MCE-&gt;sendto&#40;&#34;file:/path/to/log_file.log&#34;, $log_data&#41; and the output
&gt; methods MCE-&gt;say&#40;...&#41;, MCE-&gt;print&#40;...&#41;, and MCE-&gt;printf&#40;...&#41;.  All of
&gt; these can be called as many times as needed.  There is also
&gt; MCE-&gt;gather&#40;...&#41;, one specifies the gather option for where you want
&gt; the data to go to &#40;an array or a subroutine&#41;. The MCE::Loop pod doc
&gt; has a lot of usage on MCE-&gt;gather.
&gt;
&gt; There are also the 5 models in MCE 1.5x. Below showing MCE::Loop. This
&gt; does the same thing as above with much less MCE code. The 5 models
&gt; configure max_workers =&gt; &#39;auto&#39; by default. However, we want 1 for
&gt; chunk_size and can be set on the same line when including the module.
&gt; Notice the mce_loop line. That&#39;s it.
&gt;
&gt; use strict;
&gt; use warnings;
&gt;
&gt; use Path::Iterator::Rule;
&gt; use MCE::Loop CHUNK_SIZE =&gt; 1;
&gt;
&gt; my $start_dir = shift or die &#34;Must specify a starting directory&#34;;
&gt; -d $start_dir or die &#34;$start_dir is not a directory or does not exist&#34;;
&gt;
&gt; my $rule = Path::Iterator::Rule-&gt;new-&gt;file-&gt;name&#40; qr/[.]&#40;pm&#41;$/ &#41;;
&gt; my $iterator = $rule-&gt;iter&#40;$start_dir, {follow_symlinks =&gt; 0, depthfirst =&gt; 1}&#41;;
&gt;
&gt; mce_loop { MCE-&gt;print&#40;MCE-&gt;wid, &#34;: $_\n&#34;&#41; } $iterator;
&gt;
&gt;
&gt; Some folks prefer using the Core API while others enjoy using the new
&gt; models. It doesn&#39;t matter which folks use. MCE was created to help
&gt; folks maximize on all available cores.
&gt;
&gt; Regards,
&gt; Mario
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1312439" href="/Public/Bug/Display.html?id=91778#txn-1312439">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;14&nbsp;17:58:08&nbsp;2014</span>
    <span class="description">marioeroy [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91778] Feature Request: Support for lazy arrays of input data</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 14 Jan 2014 17:58:00 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MCE [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mario Roy &lt;marioeroy [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1312439/695600/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/695600">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 348b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Jeff,

Thanks for your time. I do not believe that I would have succeeded
initially for the new input type &#40;support for iterator objects&#41;. I am
thankful for your time and therefore added you to the CREDITS file.

This work is complete. The svn r425 commit is entirely changes to the
documentation. It is clear now even to me :&#41;.

Regards,
Mario
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1312442" href="/Public/Bug/Display.html?id=91778#txn-1312442">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;14&nbsp;18:02:46&nbsp;2014</span>
    <span class="description">MARIOROY [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1312460" href="/Public/Bug/Display.html?id=91778#txn-1312460">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;14&nbsp;19:42:06&nbsp;2014</span>
    <span class="description">jeff [...] stratopan.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91778] Feature Request: Support for lazy arrays of input data</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 14 Jan 2014 16:41:56 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MCE [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jeffrey Thalhammer &lt;jeff [...] stratopan.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1312460/695616/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/695616">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 702b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Mario-

It has been my pleasure.  But you did all the work -- I was just a
provocateur!

I&#39;ll be happy to write a review of MCE on cpanratings.perl.org after I try
the new release.

-Jeff



On Tue, Jan 14, 2014 at 2:58 PM, Mario Roy via RT &lt;bug-MCE@rt.cpan.org&gt;wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91778">https://rt.cpan.org/Ticket/Display.html?id=91778</a></span> &gt;
&gt;
&gt; Hi Jeff,
&gt;
&gt; Thanks for your time. I do not believe that I would have succeeded
&gt; initially for the new input type &#40;support for iterator objects&#41;. I am
&gt; thankful for your time and therefore added you to the CREDITS file.
&gt;
&gt; This work is complete. The svn r425 commit is entirely changes to the
&gt; documentation. It is clear now even to me :&#41;.
&gt;
&gt; Regards,
&gt; Mario
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1312460/695617/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/695617">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.2k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1315410" href="/Public/Bug/Display.html?id=91778#txn-1315410">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;21&nbsp;05:14:54&nbsp;2014</span>
    <span class="description">marioeroy [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91778] Feature Request: Support for lazy arrays of input data</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 21 Jan 2014 05:14:42 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MCE [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mario Roy &lt;marioeroy [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1315410/697309/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/697309">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">MCE 1.505 has been released and includes support for an iterator
reference as input data.

<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/pod/release/MARIOROY/MCE-1.505/lib/MCE.pod">https://metacpan.org/pod/release/MARIOROY/MCE-1.505/lib/MCE.pod</a></span>

For a very fast file finder, one can utilize egrep&#39;s directory
recursion capabilities. MCE also supports a file handle &#40;pipe&#41; as
input data. The egrep binary under Linux supports --include=SPEC,
--exclude=SPEC, --exclude-from=SPEC, and --exclude-dir=SPEC. These
options may be specified multiple times. Egrep is not parsing the
entire file for the demonstration below, just the start of the first
line &#39;^&#39; and goes on to the next file.

Anyway, this is just another way if speed is important.

use MCE;

my $start_dir = shift
   or die &#34;Please specify a starting directory&#34;;

-d $start_dir
   or die &#34;cannot open &#39;$start_dir&#39;: No such file or directory&#34;;

my $mce = MCE-&gt;new&#40;
   max_workers =&gt; &#39;auto&#39;,
   user_func =&gt; sub { chomp; MCE-&gt;print&#40;MCE-&gt;wid, &#34;: $_\n&#34;&#41; }
&#41;-&gt;spawn;

open my $egrep_fh, &#39;-|&#39;, &#39;egrep&#39;, &#39;-lsr&#39;, &#39;--include=*.pm&#39;, &#39;^&#39;, $start_dir;

$mce-&gt;process&#40; $egrep_fh &#41;;

close $egrep_fh;


Best,
Mario
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 1.109931</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
