<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #42354 for IPC-Run: Windows shell hardcoded to obsoleted &#39;command.com&#39; &#40;t/run test 19 fails on XP x64&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #42354 for IPC-Run: Windows shell hardcoded to obsoleted &#39;command.com&#39; &#40;t/run test 19 fails on XP x64&#41;</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/IPC-Run/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/IPC-Run/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/IPC-Run/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/IPC-Run/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/IPC-Run">IPC-Run CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">42354</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/IPC-Run/Active/">IPC-Run</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
james.lick [...] jameslick.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-17362-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.82    </td>
  </tr>
  <tr id="CF-17363-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.83    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;13&nbsp;00:47:32&nbsp;2009</span>
    <span class="description">james.lick [...] jameslick.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Windows shell hardcoded to obsoleted &#39;command.com&#39; &#40;t/run test 19
 fails on XP x64&#41;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">t/run test 19 fails on XP x64 complaining that it can&#39;t find &#39;command&#39;.

This is because the Windows shell has changed from command.com to
cmd.exe. In earlier versions of XP 32-bit both were available, but in
the 64-bit version command.com has been removed. This probably also
applies to later versions of the OS. I haven&#39;t found authoritative
documentation on which versions of Windows no longer have command.com.

The problem occurs due to this code &#40;in 0.82 at line 1653 of lib/Run.pm&#41;:

      if &#40; Win32_MODE &#41; {
         @args = &#40; [ qw&#40; command /c &#41;, win32_parse_cmd_line $_[0] ] &#41;;
      }

If this is changed to:

      if &#40; Win32_MODE &#41; {
         @args = &#40; [ qw&#40; cmd /c &#41;, win32_parse_cmd_line $_[0] ] &#41;;
      }

Then the test will pass. However, this is not an acceptable patch
because it would break older OS which do not have cmd.exe. The OS
version needs to be checked before deciding whether to use command.com
or cmd.exe. With this change, all tests pass.

Without this change:

C:\Perl\bin\perl.exe &#34;-MExtUtils::Command::MM&#34; &#34;-e&#34; &#34;test_harness&#40;0,
&#39;blib\lib&#39;,
 &#39;blib\arch&#39;&#41;&#34; t/*.t
t/adopt............skipped
        all skipped: adopt not implemented yet
t/binmode..........ok
t/bogus............ok
        1/2 skipped: Can&#39;t really exec&#40;&#41; MSWin32
t/filter...........ok
t/harness..........ok
t/io...............ok
        9/14 skipped: MSWin32 does not allow select&#40;&#41; on non-sockets
t/kill_kill........skipped
        all skipped: Temporarily ignoring test failure on Win32
t/parallel.........ok
t/pty..............skipped
        all skipped: IO::Pty not installed
t/pump.............ok
t/run..............ok 1/266Command &#39;command&#39; not found in
C:\Perl\site\bin, C:\P
erl\bin, C:\Perl64\site\bin, C:\Perl64\bin, C:\WINDOWS\system32,
C:\WINDOWS, C:\
WINDOWS\System32\Wbem at t/run.t line 38
# Looks like you planned 266 tests but only ran 19.
# Looks like your test died just after 19.
t/run..............dubious
        Test returned status 255 &#40;wstat 65280, 0xff00&#41;
DIED. FAILED tests 20-266
        Failed 247/266 tests, 7.14% okay
t/signal...........skipped
        all skipped: Skipping on Win32
t/timeout..........ok
t/timer............ok
t/win32_compile....ok
Failed Test Stat Wstat Total Fail  Failed  List of Failed
-------------------------------------------------------------------------------
t/run.t      255 65280   266  494 185.71%  20-266
4 tests and 10 subtests skipped.
Failed 1/15 test scripts, 93.33% okay. 247/637 subtests failed, 61.22% okay.
dmake:  Error code 255, while making &#39;test_dynamic&#39;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;13&nbsp;01:05:13&nbsp;2009</span>
    <span class="description">james.lick [...] jameslick.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Some additional information gleaned from some investigation:

command.com is the only shell on Win9X based systems &#40;95/98/ME&#41;.

cmd.exe is available on all WinNT based systems &#40;NT/2K/XP/2K3/Vista/2K8&#41;.

command.com is also available on 32-bit WinNT based systems.
&#40;Unconfirmed claims it was removed in 32-bit XP SP2 and later.&#41;

command.com is a 16-bit application and is incapable of running and
therefore not included in 64-bit WinNT based systems. XP x64 confirmed,
probably applies to x64 versions of 2K3, Vista, 2K8.

Proposed solution: On Win9X systems use command.com. On WinNT systems
use cmd.exe.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;13&nbsp;01:05:18&nbsp;2009</span>
    <span class="description">james.lick [...] jameslick.com -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;13&nbsp;01:25:44&nbsp;2009</span>
    <span class="description">james.lick [...] jameslick.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> james.lick [...] jameslick.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Proposed fix:

Tested on XP x64. Needs testing on other platforms.

      if &#40; Win32_MODE &#41; {
         if&#40; &#40;&#40;Win32::GetOSVersion&#40;&#41;&#41;[4]&#41; &gt; 1 &#41; {
             @args = &#40; [ qw&#40; cmd /c &#41;, win32_parse_cmd_line $_[0] ] &#41;;
         }
         else {
             @args = &#40; [ qw&#40; command /c &#41;, win32_parse_cmd_line $_[0] ] &#41;;
         }
      }
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;25&nbsp;15:00:34&nbsp;2011</span>
    <span class="description">dolmen [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is fixed since 0.83 according to the Changelog.

-- 
Olivier Mengu√© - <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~dolmen/">http://search.cpan.org/~dolmen/</a></span> <span class="clickylink"><a target="new" rel="nofollow" href="http://github.com/dolmen/">http://github.com/dolmen/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;29&nbsp;08:48:12&nbsp;2011</span>
    <span class="description">TODDR [...] cpan.org -  Fixed in 0.83 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;29&nbsp;08:48:16&nbsp;2011</span>
    <span class="description">TODDR [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
