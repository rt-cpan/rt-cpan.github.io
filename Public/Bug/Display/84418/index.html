<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #84418 for WWW-Mechanize-FireFox: tab doesn&#39;t close when there are multiple windows</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #84418 for WWW-Mechanize-FireFox: tab doesn&#39;t close when there are multiple windows</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=WWW-Mechanize-FireFox">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=WWW-Mechanize-FireFox">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=WWW-Mechanize-FireFox">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=WWW-Mechanize-FireFox">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/WWW-Mechanize-FireFox">WWW-Mechanize-FireFox CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">84418</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=WWW-Mechanize-FireFox">WWW-Mechanize-FireFox</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
GYPARK [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-229924-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.71    </td>
  </tr>
  <tr id="CF-229925-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




rt84418.t<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1200935/634004/rt84418.t">
Thu Apr 11 15:42:08 2013 (2.6k) by corion [...] cpan.org
</a>
</font></li>
</ul>


tab_problem.png<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1198310/632564/tab_problem.png">
Thu Apr 04 01:26:47 2013 (407.9k) by GYPARK [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=84418">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1198310" href="/Public/Bug/Display.html?id=84418#txn-1198310">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;04&nbsp;01:26:47&nbsp;2013</span>
    <span class="description">GYPARK [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> tab doesn&#39;t close when there are multiple windows</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1198310/632563/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/632563">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 619b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

At first, thank you for your great module.
It is very helpful to me and I really love it.

I found a problem that tab doesn&#39;t close automatically
when the tab has opened in...other than the first window.

I&#39;m not good at English so I made a illustration and attached it.
I wish it would be helpful for you in reproducing the problem.
Firefox in my screenshot is Korean version but it would not matter, maybe.


And, I have no idea whether this is an issue of this module or of MozRepl.
If it is case of the latter, I&#39;m sorry for bothering you.

Would you please check it?


Thank you.
G.Y.Park from South Korea
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> tab_problem.png</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1198310/632564/tab_problem.png">Download tab_problem.png</a><br />
<span class="downloadcontenttype">image/png 407.9k</span>
</div>
<div class="messagebody">
<img alt="tab_problem.png" title="tab_problem.png" src="/Ticket/Attachment/1198310/632564/" /></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1198313" href="/Public/Bug/Display.html?id=84418#txn-1198313">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;04&nbsp;01:29:42&nbsp;2013</span>
    <span class="description">GYPARK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1198313/632567/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/632567">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 904b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I forgot reporting what my script was.

It was just a very simple script:

use WWW::Mechanize::Firefox;
my $fox = WWW::Mechanize::Firefox-&gt;new&#40;&#41;;
$fox-&gt;get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://google.com">http://google.com</a></span>&#39;&#41;;
exit;


G.Y.Park



On Thu Apr 04 01:26:47 2013, GYPARK wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello,
&gt; 
&gt; At first, thank you for your great module.
&gt; It is very helpful to me and I really love it.
&gt; 
&gt; I found a problem that tab doesn&#39;t close automatically
&gt; when the tab has opened in...other than the first window.
&gt; 
&gt; I&#39;m not good at English so I made a illustration and attached it.
&gt; I wish it would be helpful for you in reproducing the problem.
&gt; Firefox in my screenshot is Korean version but it would not matter, maybe.
&gt; 
&gt; 
&gt; And, I have no idea whether this is an issue of this module or of MozRepl.
&gt; If it is case of the latter, I&#39;m sorry for bothering you.
&gt; 
&gt; Would you please check it?
&gt; 
&gt; 
&gt; Thank you.
&gt; G.Y.Park from South Korea
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1198315" href="/Public/Bug/Display.html?id=84418#txn-1198315">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;04&nbsp;01:29:43&nbsp;2013</span>
    <span class="description">GYPARK [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1199739" href="/Public/Bug/Display.html?id=84418#txn-1199739">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;08&nbsp;13:01:57&nbsp;2013</span>
    <span class="description">corion [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #84418] tab doesn&#39;t close when there are multiple windows</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 08 Apr 2013 19:01:29 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-WWW-Mechanize-FireFox [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Max Maischein &lt;corion [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1199739/633375/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/633375">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello Geunyoung Park!

Actually, WWW::Mechanize::Firefox can remove the tab even from a 
different window, since about v 0.50 or so. The problem is that at the 
end of the script, Perl has already shut down the socket connection to 
Firefox, and so Perl cannot talk to Firefox anymore.

The workaround is to explicitly release Firefox before your program ends:

   perl -Ilib -MWWW::Mechanize::Firefox::DSL -e &#34;sleep 5; undef $mech&#34;

... or in your test program:

   use WWW::Mechanize::Firefox;
   my $fox= WWW::Mechanize::Firefox-&gt;new&#40;&#41;;
   $fox-&gt;get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://google.com">http://google.com</a></span>&#39;&#41;;
   undef $fox;
   exit;

-max

Am 04.04.2013 07:29, schrieb Geunyoung Park via RT:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: WWW-Mechanize-FireFox
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=84418">https://rt.cpan.org/Ticket/Display.html?id=84418</a></span> &gt;
&gt;
&gt; I forgot reporting what my script was.
&gt;
&gt; It was just a very simple script:
&gt;
&gt; use WWW::Mechanize::Firefox;
&gt; my $fox = WWW::Mechanize::Firefox-&gt;new&#40;&#41;;
&gt; $fox-&gt;get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://google.com">http://google.com</a></span>&#39;&#41;;
&gt; exit;
&gt;
&gt;
&gt; G.Y.Park
&gt;
&gt;
&gt;
&gt; On Thu Apr 04 01:26:47 2013, GYPARK wrote:
<div class="message-stanza open">&gt;&gt; Hello,
&gt;&gt;
&gt;&gt; At first, thank you for your great module.
&gt;&gt; It is very helpful to me and I really love it.
&gt;&gt;
&gt;&gt; I found a problem that tab doesn&#39;t close automatically
&gt;&gt; when the tab has opened in...other than the first window.
&gt;&gt;
&gt;&gt; I&#39;m not good at English so I made a illustration and attached it.
&gt;&gt; I wish it would be helpful for you in reproducing the problem.
&gt;&gt; Firefox in my screenshot is Korean version but it would not matter, maybe.
&gt;&gt;
&gt;&gt;
&gt;&gt; And, I have no idea whether this is an issue of this module or of MozRepl.
&gt;&gt; If it is case of the latter, I&#39;m sorry for bothering you.
&gt;&gt;
&gt;&gt; Would you please check it?
&gt;&gt;
&gt;&gt;
&gt;&gt; Thank you.
&gt;&gt; G.Y.Park from South Korea
</div>&gt;
&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1199986" href="/Public/Bug/Display.html?id=84418#txn-1199986">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;09&nbsp;02:34:14&nbsp;2013</span>
    <span class="description">GYPARK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1199986/633515/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/633515">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

Thank you for your reply.

I tried
undef $fox;
but it didn&#39;t work.

I inserted sleep&#40;&#41; before and after undef statement, but it also
didn&#39;t work.


Finally, I tried such code:

# close tab explicitly
$fox-&gt;application&#40;&#41;-&gt;closeTab&#40; $fox-&gt;tab&#40;&#41; &#41;;

This code worked well with one window &#40;or, running in first window of two&#41;
But when the script runs in the second window, that line resulted in an
error:

MozRepl::RemoteObject: NS_ERROR_FAILURE: Component returned failure code: 0x80004005 &#40;NS_ERROR_FAILURE&#41; [nsIWebProgress.removeProgressListener] at D:/strawberry/perl/site/lib/Firefox/Application/API40.pm line 159




G.Y.Park



On Mon Apr 08 13:01:57 2013, CORION wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello Geunyoung Park!
&gt; 
&gt; Actually, WWW::Mechanize::Firefox can remove the tab even from a
&gt; different window, since about v 0.50 or so. The problem is that at the
&gt; end of the script, Perl has already shut down the socket connection to
&gt; Firefox, and so Perl cannot talk to Firefox anymore.
&gt; 
&gt; The workaround is to explicitly release Firefox before your program
&gt; ends:
&gt; 
&gt;    perl -Ilib -MWWW::Mechanize::Firefox::DSL -e &#34;sleep 5; undef $mech&#34;
&gt; 
&gt; ... or in your test program:
&gt; 
&gt;    use WWW::Mechanize::Firefox;
&gt;    my $fox= WWW::Mechanize::Firefox-&gt;new&#40;&#41;;
&gt;    $fox-&gt;get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://google.com">http://google.com</a></span>&#39;&#41;;
&gt;    undef $fox;
&gt;    exit;
&gt; 
&gt; -max
&gt; 
&gt; Am 04.04.2013 07:29, schrieb Geunyoung Park via RT:
<div class="message-stanza open">&gt; &gt;         Queue: WWW-Mechanize-FireFox
&gt; &gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=84418">https://rt.cpan.org/Ticket/Display.html?id=84418</a></span> &gt;
&gt; &gt;
&gt; &gt; I forgot reporting what my script was.
&gt; &gt;
&gt; &gt; It was just a very simple script:
&gt; &gt;
&gt; &gt; use WWW::Mechanize::Firefox;
&gt; &gt; my $fox = WWW::Mechanize::Firefox-&gt;new&#40;&#41;;
&gt; &gt; $fox-&gt;get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://google.com">http://google.com</a></span>&#39;&#41;;
&gt; &gt; exit;
&gt; &gt;
&gt; &gt;
&gt; &gt; G.Y.Park
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; On Thu Apr 04 01:26:47 2013, GYPARK wrote:
<div class="message-stanza open">&gt; &gt;&gt; Hello,
&gt; &gt;&gt;
&gt; &gt;&gt; At first, thank you for your great module.
&gt; &gt;&gt; It is very helpful to me and I really love it.
&gt; &gt;&gt;
&gt; &gt;&gt; I found a problem that tab doesn&#39;t close automatically
&gt; &gt;&gt; when the tab has opened in...other than the first window.
&gt; &gt;&gt;
&gt; &gt;&gt; I&#39;m not good at English so I made a illustration and attached it.
&gt; &gt;&gt; I wish it would be helpful for you in reproducing the problem.
&gt; &gt;&gt; Firefox in my screenshot is Korean version but it would not matter,
</div></div>&gt; maybe.
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt; And, I have no idea whether this is an issue of this module or of
</div></div>&gt; MozRepl.
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; If it is case of the latter, I&#39;m sorry for bothering you.
&gt; &gt;&gt;
&gt; &gt;&gt; Would you please check it?
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt; Thank you.
&gt; &gt;&gt; G.Y.Park from South Korea
</div>&gt; &gt;
&gt; &gt;
&gt; &gt;
</div>&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1200650" href="/Public/Bug/Display.html?id=84418#txn-1200650">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;10&nbsp;16:15:33&nbsp;2013</span>
    <span class="description">corion [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #84418] tab doesn&#39;t close when there are multiple windows</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 10 Apr 2013 22:15:10 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-WWW-Mechanize-FireFox [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Max Maischein &lt;corion [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1200650/633875/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/633875">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello again,

thanks for finding out how to more easily reproduce the error. I was now 
able to always reproduce the error. With the following changed 
subroutine -&gt;closeTab&#40;&#41;, I always get a properly closed tab, no matter
which window is active at closing time:

sub closeTab {
     my &#40;$self,$tab,$repl&#41; = @_;
     $repl ||= $self-&gt;repl;
     my $close_tab = $repl-&gt;declare&#40;&lt;&lt;&#39;JS&#39;&#41;;
function&#40;tab&#41; {
           if&#40;tab.collapsed&#41; { return };
           var be = 
Components.classes[&#34;@mozilla.org/appshell/window-mediator;1&#34;]
                             .getService&#40;Components.interfaces.nsIWindowMediator&#41;
                             .getEnumerator&#40;&#34;navigator:browser&#34;&#41;;
          while &#40;be.hasMoreElements&#40;&#41;&#41; {
            var browserWin = be.getNext&#40;&#41;;
            var tabbrowser = browserWin.gBrowser;
            if&#40; tabbrowser &#41; {
              for&#40; var i=0; i&lt; tabbrowser.tabs.length; i++&#41; {
                  if&#40; tabbrowser.tabs.item&#40; i &#41; === tab &#41; {
                       tabbrowser.removeTab&#40;tab&#41;;
                       break;
                   };
               };
            };
           };
}
JS
     return $close_tab-&gt;&#40;$tab&#41;;
}

The changed version works for me on Firefox 20 and I&#39;m currently running 
the test suite for the other browser versions.

Can you please test whether this change also works for your cases? If 
so, I will release a new version.

-max


Am 09.04.2013 08:34, schrieb Geunyoung Park via RT:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: WWW-Mechanize-FireFox
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=84418">https://rt.cpan.org/Ticket/Display.html?id=84418</a></span> &gt;
&gt;
&gt; Hello,
&gt;
&gt; Thank you for your reply.
&gt;
&gt; I tried
&gt; undef $fox;
&gt; but it didn&#39;t work.
&gt;
&gt; I inserted sleep&#40;&#41; before and after undef statement, but it also
&gt; didn&#39;t work.
&gt;
&gt;
&gt; Finally, I tried such code:
&gt;
&gt; # close tab explicitly
&gt; $fox-&gt;application&#40;&#41;-&gt;closeTab&#40; $fox-&gt;tab&#40;&#41; &#41;;
&gt;
&gt; This code worked well with one window &#40;or, running in first window of two&#41;
&gt; But when the script runs in the second window, that line resulted in an
&gt; error:
&gt;
&gt; MozRepl::RemoteObject: NS_ERROR_FAILURE: Component returned failure code: 0x80004005 &#40;NS_ERROR_FAILURE&#41; [nsIWebProgress.removeProgressListener] at D:/strawberry/perl/site/lib/Firefox/Application/API40.pm line 159
&gt;
&gt;
&gt;
&gt;
&gt; G.Y.Park
&gt;
&gt;
&gt;
&gt; On Mon Apr 08 13:01:57 2013, CORION wrote:
<div class="message-stanza open">&gt;&gt; Hello Geunyoung Park!
&gt;&gt;
&gt;&gt; Actually, WWW::Mechanize::Firefox can remove the tab even from a
&gt;&gt; different window, since about v 0.50 or so. The problem is that at the
&gt;&gt; end of the script, Perl has already shut down the socket connection to
&gt;&gt; Firefox, and so Perl cannot talk to Firefox anymore.
&gt;&gt;
&gt;&gt; The workaround is to explicitly release Firefox before your program
&gt;&gt; ends:
&gt;&gt;
&gt;&gt;     perl -Ilib -MWWW::Mechanize::Firefox::DSL -e &#34;sleep 5; undef $mech&#34;
&gt;&gt;
&gt;&gt; ... or in your test program:
&gt;&gt;
&gt;&gt;     use WWW::Mechanize::Firefox;
&gt;&gt;     my $fox= WWW::Mechanize::Firefox-&gt;new&#40;&#41;;
&gt;&gt;     $fox-&gt;get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://google.com">http://google.com</a></span>&#39;&#41;;
&gt;&gt;     undef $fox;
&gt;&gt;     exit;
&gt;&gt;
&gt;&gt; -max
&gt;&gt;
&gt;&gt; Am 04.04.2013 07:29, schrieb Geunyoung Park via RT:
<div class="message-stanza open">&gt;&gt;&gt;          Queue: WWW-Mechanize-FireFox
&gt;&gt;&gt;    Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=84418">https://rt.cpan.org/Ticket/Display.html?id=84418</a></span> &gt;
&gt;&gt;&gt;
&gt;&gt;&gt; I forgot reporting what my script was.
&gt;&gt;&gt;
&gt;&gt;&gt; It was just a very simple script:
&gt;&gt;&gt;
&gt;&gt;&gt; use WWW::Mechanize::Firefox;
&gt;&gt;&gt; my $fox = WWW::Mechanize::Firefox-&gt;new&#40;&#41;;
&gt;&gt;&gt; $fox-&gt;get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://google.com">http://google.com</a></span>&#39;&#41;;
&gt;&gt;&gt; exit;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; G.Y.Park
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Thu Apr 04 01:26:47 2013, GYPARK wrote:
<div class="message-stanza open">&gt;&gt;&gt;&gt; Hello,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; At first, thank you for your great module.
&gt;&gt;&gt;&gt; It is very helpful to me and I really love it.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I found a problem that tab doesn&#39;t close automatically
&gt;&gt;&gt;&gt; when the tab has opened in...other than the first window.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I&#39;m not good at English so I made a illustration and attached it.
&gt;&gt;&gt;&gt; I wish it would be helpful for you in reproducing the problem.
&gt;&gt;&gt;&gt; Firefox in my screenshot is Korean version but it would not matter,
</div></div>&gt;&gt; maybe.
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; And, I have no idea whether this is an issue of this module or of
</div></div>&gt;&gt; MozRepl.
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt; If it is case of the latter, I&#39;m sorry for bothering you.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Would you please check it?
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Thank you.
&gt;&gt;&gt;&gt; G.Y.Park from South Korea
</div>&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
</div>&gt;&gt;
</div>&gt;
&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1200868" href="/Public/Bug/Display.html?id=84418#txn-1200868">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;11&nbsp;12:27:02&nbsp;2013</span>
    <span class="description">GYPARK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1200868/633976/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/633976">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

I&#39;m sorry my reply is late.


I modified API40.pm and changed closeTab&#40;&#41; as you&#39;d written.

I tested several times with various number of FF windows. &#40;up to five&#41;
&#40;My FF version is 20.0 and MozRepl extension is a patched version
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/milouse/mozrepl/commit/3504aa5b45f4b438bc0e7ef53019558c4bd8bc1c">https://github.com/milouse/mozrepl/commit/3504aa5b45f4b438bc0e7ef53019558c4bd8bc1c</a></span> &#41;


This code:
   # close tab explicitly
   $fox-&gt;application&#40;&#41;-&gt;closeTab&#40; $fox-&gt;tab&#40;&#41; &#41;;
worked very well in every time.
Every tab was closed correctly. :-&#41;


On the other hand,
   undef $fox;
or, to do nothing and exit&#40;&#41;,
these resulted in the problem as before.
&#40;sleep&#40;&#41; before exit&#40;&#41; didn&#39;t work&#41;


I wish my report to be helpful.

G.Y.Park



On Wed Apr 10 16:15:33 2013, CORION wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello again,
&gt; 
&gt; thanks for finding out how to more easily reproduce the error. I was
&gt;    now
&gt; able to always reproduce the error. With the following changed
&gt; subroutine -&gt;closeTab&#40;&#41;, I always get a properly closed tab, no matter
&gt; which window is active at closing time:
&gt; 
&gt; sub closeTab {
&gt;      my &#40;$self,$tab,$repl&#41; = @_;
&gt;      $repl ||= $self-&gt;repl;
&gt;      my $close_tab = $repl-&gt;declare&#40;&lt;&lt;&#39;JS&#39;&#41;;
&gt; function&#40;tab&#41; {
&gt;            if&#40;tab.collapsed&#41; { return };
&gt;            var be =
&gt; Components.classes[&#34;@mozilla.org/appshell/window-mediator;1&#34;]
&gt;                            .getService&#40;Components.interfaces.nsIWindowMediator&#41;
&gt;                            .getEnumerator&#40;&#34;navigator:browser&#34;&#41;;
&gt;         while &#40;be.hasMoreElements&#40;&#41;&#41; {
&gt;           var browserWin = be.getNext&#40;&#41;;
&gt;           var tabbrowser = browserWin.gBrowser;
&gt;           if&#40; tabbrowser &#41; {
&gt;             for&#40; var i=0; i&lt; tabbrowser.tabs.length; i++&#41; {
&gt;                 if&#40; tabbrowser.tabs.item&#40; i &#41; === tab &#41; {
&gt;                        tabbrowser.removeTab&#40;tab&#41;;
&gt;                        break;
&gt;                    };
&gt;                };
&gt;           };
&gt;            };
&gt; }
&gt; JS
&gt;      return $close_tab-&gt;&#40;$tab&#41;;
&gt; }
&gt; 
&gt; The changed version works for me on Firefox 20 and I&#39;m currently
&gt;    running
&gt; the test suite for the other browser versions.
&gt; 
&gt; Can you please test whether this change also works for your cases? If
&gt; so, I will release a new version.
&gt; 
&gt; -max
&gt; 
&gt; 
&gt; Am 09.04.2013 08:34, schrieb Geunyoung Park via RT:
<div class="message-stanza open">&gt; &gt;         Queue: WWW-Mechanize-FireFox
&gt; &gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=84418">https://rt.cpan.org/Ticket/Display.html?id=84418</a></span> &gt;
&gt; &gt;
&gt; &gt; Hello,
&gt; &gt;
&gt; &gt; Thank you for your reply.
&gt; &gt;
&gt; &gt; I tried
&gt; &gt; undef $fox;
&gt; &gt; but it didn&#39;t work.
&gt; &gt;
&gt; &gt; I inserted sleep&#40;&#41; before and after undef statement, but it also
&gt; &gt; didn&#39;t work.
&gt; &gt;
&gt; &gt;
&gt; &gt; Finally, I tried such code:
&gt; &gt;
&gt; &gt; # close tab explicitly
&gt; &gt; $fox-&gt;application&#40;&#41;-&gt;closeTab&#40; $fox-&gt;tab&#40;&#41; &#41;;
&gt; &gt;
&gt; &gt; This code worked well with one window &#40;or, running in first window
</div>&gt;    of two&#41;
<div class="message-stanza open">&gt; &gt; But when the script runs in the second window, that line resulted in
</div>&gt;    an
<div class="message-stanza open">&gt; &gt; error:
&gt; &gt;
&gt; &gt; MozRepl::RemoteObject: NS_ERROR_FAILURE: Component returned failure
</div>&gt;    code: 0x80004005 &#40;NS_ERROR_FAILURE&#41;
&gt;    [nsIWebProgress.removeProgressListener] at
&gt;    D:/strawberry/perl/site/lib/Firefox/Application/API40.pm line 159
<div class="message-stanza open">&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; G.Y.Park
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; On Mon Apr 08 13:01:57 2013, CORION wrote:
<div class="message-stanza open">&gt; &gt;&gt; Hello Geunyoung Park!
&gt; &gt;&gt;
&gt; &gt;&gt; Actually, WWW::Mechanize::Firefox can remove the tab even from a
&gt; &gt;&gt; different window, since about v 0.50 or so. The problem is that at
</div></div>&gt;    the
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; end of the script, Perl has already shut down the socket connection
</div></div>&gt;    to
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; Firefox, and so Perl cannot talk to Firefox anymore.
&gt; &gt;&gt;
&gt; &gt;&gt; The workaround is to explicitly release Firefox before your program
&gt; &gt;&gt; ends:
&gt; &gt;&gt;
&gt; &gt;&gt;     perl -Ilib -MWWW::Mechanize::Firefox::DSL -e &#34;sleep 5; undef
</div></div>&gt;    $mech&#34;
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt;
&gt; &gt;&gt; ... or in your test program:
&gt; &gt;&gt;
&gt; &gt;&gt;     use WWW::Mechanize::Firefox;
&gt; &gt;&gt;     my $fox= WWW::Mechanize::Firefox-&gt;new&#40;&#41;;
&gt; &gt;&gt;     $fox-&gt;get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://google.com">http://google.com</a></span>&#39;&#41;;
&gt; &gt;&gt;     undef $fox;
&gt; &gt;&gt;     exit;
&gt; &gt;&gt;
&gt; &gt;&gt; -max
&gt; &gt;&gt;
&gt; &gt;&gt; Am 04.04.2013 07:29, schrieb Geunyoung Park via RT:
<div class="message-stanza open">&gt; &gt;&gt;&gt;          Queue: WWW-Mechanize-FireFox
&gt; &gt;&gt;&gt;    Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=84418">https://rt.cpan.org/Ticket/Display.html?id=84418</a></span> &gt;
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; I forgot reporting what my script was.
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; It was just a very simple script:
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; use WWW::Mechanize::Firefox;
&gt; &gt;&gt;&gt; my $fox = WWW::Mechanize::Firefox-&gt;new&#40;&#41;;
&gt; &gt;&gt;&gt; $fox-&gt;get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://google.com">http://google.com</a></span>&#39;&#41;;
&gt; &gt;&gt;&gt; exit;
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; G.Y.Park
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; On Thu Apr 04 01:26:47 2013, GYPARK wrote:
<div class="message-stanza open">&gt; &gt;&gt;&gt;&gt; Hello,
&gt; &gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt; At first, thank you for your great module.
&gt; &gt;&gt;&gt;&gt; It is very helpful to me and I really love it.
&gt; &gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt; I found a problem that tab doesn&#39;t close automatically
&gt; &gt;&gt;&gt;&gt; when the tab has opened in...other than the first window.
&gt; &gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt; I&#39;m not good at English so I made a illustration and attached it.
&gt; &gt;&gt;&gt;&gt; I wish it would be helpful for you in reproducing the problem.
&gt; &gt;&gt;&gt;&gt; Firefox in my screenshot is Korean version but it would not
</div></div></div></div>&gt;    matter,
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; maybe.
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt; And, I have no idea whether this is an issue of this module or of
</div></div>&gt; &gt;&gt; MozRepl.
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt;&gt;&gt; If it is case of the latter, I&#39;m sorry for bothering you.
&gt; &gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt; Would you please check it?
&gt; &gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt; Thank you.
&gt; &gt;&gt;&gt;&gt; G.Y.Park from South Korea
</div>&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt;
</div>&gt; &gt;&gt;
</div>&gt; &gt;
&gt; &gt;
&gt; &gt;
</div>&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1200935" href="/Public/Bug/Display.html?id=84418#txn-1200935">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;11&nbsp;15:42:08&nbsp;2013</span>
    <span class="description">corion [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #84418] tab doesn&#39;t close when there are multiple windows</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 11 Apr 2013 21:41:39 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-WWW-Mechanize-FireFox [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Max Maischein &lt;corion [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1200935/634003/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/634003">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 7.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello again,

it&#39;s great if the changed closeTab&#40;&#41; works for you. If you also change 
the sub -&gt;autoclose_tab&#40;&#41; as below, it should all work. I&#39;ve attached my 
test case for the regression tests too. Without the changes, I get 2 
failed tests, and with the changes I get 6 passing tests. If you can 
reproduce the error before patching and the error goes away with the 
changes below, that would be fantastic.

Also thank you very much for the hint of the patched MozRepl. I have 
just upgraded to Firefox 20, with the changes from github. It seems 
there is a fresh release of the Mozrepl plugin at 
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/bard/mozrepl">https://github.com/bard/mozrepl</a></span> incorporating these changes.

-max

sub closeTab {
     my &#40;$self,$tab,$repl&#41; = @_;
     $repl ||= $self-&gt;repl;
     my $close_tab = $repl-&gt;declare&#40;&lt;&lt;&#39;JS&#39;&#41;;
function&#40;tab&#41; {
           if&#40;tab.collapsed&#41; { return };
           var be = 
Components.classes[&#34;@mozilla.org/appshell/window-mediator;1&#34;]
                             .getService&#40;Components.interfaces.nsIWindowMediator&#41;
                             .getEnumerator&#40;&#34;navigator:browser&#34;&#41;;
          while &#40;be.hasMoreElements&#40;&#41;&#41; {
            var browserWin = be.getNext&#40;&#41;;
            var tabbrowser = browserWin.gBrowser;
            if&#40; tabbrowser &#41; {
              for&#40; var i=0; i&lt; tabbrowser.tabs.length; i++&#41; {
                  if&#40; tabbrowser.tabs.item&#40; i &#41; === tab &#41; {
                       tabbrowser.removeTab&#40;tab&#41;;
                       break;
                   };
               };
            };
           };
}
JS
     return $close_tab-&gt;&#40;$tab&#41;;
}

sub autoclose_tab {
     my &#40;$self,$tab,$close&#41; = @_;
     $close = 1
         if&#40; 2 == @_ &#41;;
     my $release = join &#34;\n&#34;,
           # Find the window our tab lives in
           q&lt;if&#40;!self.collapsed&#41;{&gt;,
               q&lt;var be = 
Components.classes[&#34;@mozilla.org/appshell/window-mediator;1&#34;]&gt;,
 
q&lt;.getService&#40;Components.interfaces.nsIWindowMediator&#41;&gt;,
                                  q&lt;.getEnumerator&#40;&#34;navigator:browser&#34;&#41;;&gt;,
               q&lt;while &#40;be.hasMoreElements&#40;&#41;&#41; {&gt;,
                 q&lt;var browserWin = be.getNext&#40;&#41;;&gt;,
                 q&lt;var tabbrowser = browserWin.gBrowser;&gt;,
                 q&lt;if&#40; tabbrowser &#41; {&gt;,
                   q!for&#40; var i=0; i&lt; tabbrowser.tabs.length; i++&#41; {!,
                       q&lt;if&#40; tabbrowser.tabs.item&#40; i &#41; === self &#41; {&gt;,
                           q&lt;tabbrowser.removeTab&#40;self&#41;;&gt;,
                           q&lt;break;&gt;,
                       q&lt;};&gt;,
                   q&lt;};&gt;,
                 q&lt;};&gt;,
               q&lt;};&gt;,
         q&lt;};&gt;,
     ;
     if&#40; $close &#41; {
         $tab-&gt;__release_action&#40;$release&#41;;
     } else {
         $tab-&gt;__release_action&#40;&#39;&#39;&#41;;
     };
};


Am 11.04.2013 18:27, schrieb Geunyoung Park via RT:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: WWW-Mechanize-FireFox
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=84418">https://rt.cpan.org/Ticket/Display.html?id=84418</a></span> &gt;
&gt;
&gt; Hello,
&gt;
&gt; I&#39;m sorry my reply is late.
&gt;
&gt;
&gt; I modified API40.pm and changed closeTab&#40;&#41; as you&#39;d written.
&gt;
&gt; I tested several times with various number of FF windows. &#40;up to five&#41;
&gt; &#40;My FF version is 20.0 and MozRepl extension is a patched version
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/milouse/mozrepl/commit/3504aa5b45f4b438bc0e7ef53019558c4bd8bc1c">https://github.com/milouse/mozrepl/commit/3504aa5b45f4b438bc0e7ef53019558c4bd8bc1c</a></span> &#41;
&gt;
&gt;
&gt; This code:
&gt;     # close tab explicitly
&gt;     $fox-&gt;application&#40;&#41;-&gt;closeTab&#40; $fox-&gt;tab&#40;&#41; &#41;;
&gt; worked very well in every time.
&gt; Every tab was closed correctly. :-&#41;
&gt;
&gt;
&gt; On the other hand,
&gt;     undef $fox;
&gt; or, to do nothing and exit&#40;&#41;,
&gt; these resulted in the problem as before.
&gt; &#40;sleep&#40;&#41; before exit&#40;&#41; didn&#39;t work&#41;
&gt;
&gt;
&gt; I wish my report to be helpful.
&gt;
&gt; G.Y.Park
&gt;
&gt;
&gt;
&gt; On Wed Apr 10 16:15:33 2013, CORION wrote:
<div class="message-stanza open">&gt;&gt; Hello again,
&gt;&gt;
&gt;&gt; thanks for finding out how to more easily reproduce the error. I was
&gt;&gt;     now
&gt;&gt; able to always reproduce the error. With the following changed
&gt;&gt; subroutine -&gt;closeTab&#40;&#41;, I always get a properly closed tab, no matter
&gt;&gt; which window is active at closing time:
&gt;&gt;
&gt;&gt; sub closeTab {
&gt;&gt;       my &#40;$self,$tab,$repl&#41; = @_;
&gt;&gt;       $repl ||= $self-&gt;repl;
&gt;&gt;       my $close_tab = $repl-&gt;declare&#40;&lt;&lt;&#39;JS&#39;&#41;;
&gt;&gt; function&#40;tab&#41; {
&gt;&gt;             if&#40;tab.collapsed&#41; { return };
&gt;&gt;             var be =
&gt;&gt; Components.classes[&#34;@mozilla.org/appshell/window-mediator;1&#34;]
&gt;&gt;                           .getService&#40;Components.interfaces.nsIWindowMediator&#41;
&gt;&gt;                           .getEnumerator&#40;&#34;navigator:browser&#34;&#41;;
&gt;&gt;        while &#40;be.hasMoreElements&#40;&#41;&#41; {
&gt;&gt;          var browserWin = be.getNext&#40;&#41;;
&gt;&gt;          var tabbrowser = browserWin.gBrowser;
&gt;&gt;          if&#40; tabbrowser &#41; {
&gt;&gt;            for&#40; var i=0; i&lt; tabbrowser.tabs.length; i++&#41; {
&gt;&gt;                if&#40; tabbrowser.tabs.item&#40; i &#41; === tab &#41; {
&gt;&gt;                         tabbrowser.removeTab&#40;tab&#41;;
&gt;&gt;                         break;
&gt;&gt;                     };
&gt;&gt;                 };
&gt;&gt;          };
&gt;&gt;             };
&gt;&gt; }
&gt;&gt; JS
&gt;&gt;       return $close_tab-&gt;&#40;$tab&#41;;
&gt;&gt; }
&gt;&gt;
&gt;&gt; The changed version works for me on Firefox 20 and I&#39;m currently
&gt;&gt;     running
&gt;&gt; the test suite for the other browser versions.
&gt;&gt;
&gt;&gt; Can you please test whether this change also works for your cases? If
&gt;&gt; so, I will release a new version.
&gt;&gt;
&gt;&gt; -max
&gt;&gt;
&gt;&gt;
&gt;&gt; Am 09.04.2013 08:34, schrieb Geunyoung Park via RT:
<div class="message-stanza open">&gt;&gt;&gt;          Queue: WWW-Mechanize-FireFox
&gt;&gt;&gt;    Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=84418">https://rt.cpan.org/Ticket/Display.html?id=84418</a></span> &gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Hello,
&gt;&gt;&gt;
&gt;&gt;&gt; Thank you for your reply.
&gt;&gt;&gt;
&gt;&gt;&gt; I tried
&gt;&gt;&gt; undef $fox;
&gt;&gt;&gt; but it didn&#39;t work.
&gt;&gt;&gt;
&gt;&gt;&gt; I inserted sleep&#40;&#41; before and after undef statement, but it also
&gt;&gt;&gt; didn&#39;t work.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Finally, I tried such code:
&gt;&gt;&gt;
&gt;&gt;&gt; # close tab explicitly
&gt;&gt;&gt; $fox-&gt;application&#40;&#41;-&gt;closeTab&#40; $fox-&gt;tab&#40;&#41; &#41;;
&gt;&gt;&gt;
&gt;&gt;&gt; This code worked well with one window &#40;or, running in first window
</div>&gt;&gt;     of two&#41;
<div class="message-stanza open">&gt;&gt;&gt; But when the script runs in the second window, that line resulted in
</div>&gt;&gt;     an
<div class="message-stanza open">&gt;&gt;&gt; error:
&gt;&gt;&gt;
&gt;&gt;&gt; MozRepl::RemoteObject: NS_ERROR_FAILURE: Component returned failure
</div>&gt;&gt;     code: 0x80004005 &#40;NS_ERROR_FAILURE&#41;
&gt;&gt;     [nsIWebProgress.removeProgressListener] at
&gt;&gt;     D:/strawberry/perl/site/lib/Firefox/Application/API40.pm line 159
<div class="message-stanza open">&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; G.Y.Park
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Mon Apr 08 13:01:57 2013, CORION wrote:
<div class="message-stanza open">&gt;&gt;&gt;&gt; Hello Geunyoung Park!
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Actually, WWW::Mechanize::Firefox can remove the tab even from a
&gt;&gt;&gt;&gt; different window, since about v 0.50 or so. The problem is that at
</div></div>&gt;&gt;     the
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt; end of the script, Perl has already shut down the socket connection
</div></div>&gt;&gt;     to
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt; Firefox, and so Perl cannot talk to Firefox anymore.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; The workaround is to explicitly release Firefox before your program
&gt;&gt;&gt;&gt; ends:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;      perl -Ilib -MWWW::Mechanize::Firefox::DSL -e &#34;sleep 5; undef
</div></div>&gt;&gt;     $mech&#34;
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; ... or in your test program:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;      use WWW::Mechanize::Firefox;
&gt;&gt;&gt;&gt;      my $fox= WWW::Mechanize::Firefox-&gt;new&#40;&#41;;
&gt;&gt;&gt;&gt;      $fox-&gt;get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://google.com">http://google.com</a></span>&#39;&#41;;
&gt;&gt;&gt;&gt;      undef $fox;
&gt;&gt;&gt;&gt;      exit;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; -max
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Am 04.04.2013 07:29, schrieb Geunyoung Park via RT:
<div class="message-stanza open">&gt;&gt;&gt;&gt;&gt;           Queue: WWW-Mechanize-FireFox
&gt;&gt;&gt;&gt;&gt;     Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=84418">https://rt.cpan.org/Ticket/Display.html?id=84418</a></span> &gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; I forgot reporting what my script was.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; It was just a very simple script:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; use WWW::Mechanize::Firefox;
&gt;&gt;&gt;&gt;&gt; my $fox = WWW::Mechanize::Firefox-&gt;new&#40;&#41;;
&gt;&gt;&gt;&gt;&gt; $fox-&gt;get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://google.com">http://google.com</a></span>&#39;&#41;;
&gt;&gt;&gt;&gt;&gt; exit;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; G.Y.Park
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; On Thu Apr 04 01:26:47 2013, GYPARK wrote:
<div class="message-stanza open">&gt;&gt;&gt;&gt;&gt;&gt; Hello,
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; At first, thank you for your great module.
&gt;&gt;&gt;&gt;&gt;&gt; It is very helpful to me and I really love it.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; I found a problem that tab doesn&#39;t close automatically
&gt;&gt;&gt;&gt;&gt;&gt; when the tab has opened in...other than the first window.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; I&#39;m not good at English so I made a illustration and attached it.
&gt;&gt;&gt;&gt;&gt;&gt; I wish it would be helpful for you in reproducing the problem.
&gt;&gt;&gt;&gt;&gt;&gt; Firefox in my screenshot is Korean version but it would not
</div></div></div></div>&gt;&gt;     matter,
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt; maybe.
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; And, I have no idea whether this is an issue of this module or of
</div></div>&gt;&gt;&gt;&gt; MozRepl.
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt;&gt;&gt; If it is case of the latter, I&#39;m sorry for bothering you.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Would you please check it?
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Thank you.
&gt;&gt;&gt;&gt;&gt;&gt; G.Y.Park from South Korea
</div>&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
</div>&gt;&gt;&gt;&gt;
</div>&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
</div>&gt;&gt;
</div>&gt;
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1200935/634004/rt84418.t">Download rt84418.t</a><br />
<span class="downloadcontenttype">text/x-perl 2.6k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1201061" href="/Public/Bug/Display.html?id=84418#txn-1201061">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;11&nbsp;21:48:01&nbsp;2013</span>
    <span class="description">GYPARK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1201061/634086/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/634086">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 8.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,


I tried this new change and I couldn&#39;t find any case that
the error occurred again. :-&#41;

Now I don&#39;t need explicit closeTab&#40;&#41; nor undef&#40;&#41;.
My first simple script works very well with mutiple windows.
When the script exits, &#40;of course I don&#39;t need even exit&#40;&#41;&#41;
the tab closes perfectly.

Thank you very much for your effort.
and thanks again for this fantastic module.

G.Y.Park





On Thu Apr 11 15:42:08 2013, CORION wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello again,
&gt; 
&gt; it&#39;s great if the changed closeTab&#40;&#41; works for you. If you also change
&gt; the sub -&gt;autoclose_tab&#40;&#41; as below, it should all work. I&#39;ve attached
&gt; my
&gt; test case for the regression tests too. Without the changes, I get 2
&gt; failed tests, and with the changes I get 6 passing tests. If you can
&gt; reproduce the error before patching and the error goes away with the
&gt; changes below, that would be fantastic.
&gt; 
&gt; Also thank you very much for the hint of the patched MozRepl. I have
&gt; just upgraded to Firefox 20, with the changes from github. It seems
&gt; there is a fresh release of the Mozrepl plugin at
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/bard/mozrepl">https://github.com/bard/mozrepl</a></span> incorporating these changes.
&gt; 
&gt; -max
&gt; 
&gt; sub closeTab {
&gt;      my &#40;$self,$tab,$repl&#41; = @_;
&gt;      $repl ||= $self-&gt;repl;
&gt;      my $close_tab = $repl-&gt;declare&#40;&lt;&lt;&#39;JS&#39;&#41;;
&gt; function&#40;tab&#41; {
&gt;            if&#40;tab.collapsed&#41; { return };
&gt;            var be =
&gt; Components.classes[&#34;@mozilla.org/appshell/window-mediator;1&#34;]
&gt;                            .getService&#40;Components.interfaces.nsIWindowMediator&#41;
&gt;                            .getEnumerator&#40;&#34;navigator:browser&#34;&#41;;
&gt;         while &#40;be.hasMoreElements&#40;&#41;&#41; {
&gt;           var browserWin = be.getNext&#40;&#41;;
&gt;           var tabbrowser = browserWin.gBrowser;
&gt;           if&#40; tabbrowser &#41; {
&gt;             for&#40; var i=0; i&lt; tabbrowser.tabs.length; i++&#41; {
&gt;                 if&#40; tabbrowser.tabs.item&#40; i &#41; === tab &#41; {
&gt;                        tabbrowser.removeTab&#40;tab&#41;;
&gt;                        break;
&gt;                    };
&gt;                };
&gt;           };
&gt;            };
&gt; }
&gt; JS
&gt;      return $close_tab-&gt;&#40;$tab&#41;;
&gt; }
&gt; 
&gt; sub autoclose_tab {
&gt;      my &#40;$self,$tab,$close&#41; = @_;
&gt;      $close = 1
&gt;          if&#40; 2 == @_ &#41;;
&gt;      my $release = join &#34;\n&#34;,
&gt;            # Find the window our tab lives in
&gt;            q&lt;if&#40;!self.collapsed&#41;{&gt;,
&gt;                q&lt;var be =
&gt; Components.classes[&#34;@mozilla.org/appshell/window-mediator;1&#34;]&gt;,
&gt; 
&gt; q&lt;.getService&#40;Components.interfaces.nsIWindowMediator&#41;&gt;,
&gt;                                   q&lt;.getEnumerator&#40;&#34;navigator:browser&#34;&#41;;&gt;,
&gt;                q&lt;while &#40;be.hasMoreElements&#40;&#41;&#41; {&gt;,
&gt;                  q&lt;var browserWin = be.getNext&#40;&#41;;&gt;,
&gt;                  q&lt;var tabbrowser = browserWin.gBrowser;&gt;,
&gt;                  q&lt;if&#40; tabbrowser &#41; {&gt;,
&gt;                    q!for&#40; var i=0; i&lt; tabbrowser.tabs.length; i++&#41; {!,
&gt;                        q&lt;if&#40; tabbrowser.tabs.item&#40; i &#41; === self &#41; {&gt;,
&gt;                            q&lt;tabbrowser.removeTab&#40;self&#41;;&gt;,
&gt;                            q&lt;break;&gt;,
&gt;                        q&lt;};&gt;,
&gt;                    q&lt;};&gt;,
&gt;                  q&lt;};&gt;,
&gt;                q&lt;};&gt;,
&gt;          q&lt;};&gt;,
&gt;      ;
&gt;      if&#40; $close &#41; {
&gt;          $tab-&gt;__release_action&#40;$release&#41;;
&gt;      } else {
&gt;          $tab-&gt;__release_action&#40;&#39;&#39;&#41;;
&gt;      };
&gt; };
&gt; 
&gt; 
&gt; Am 11.04.2013 18:27, schrieb Geunyoung Park via RT:
<div class="message-stanza open">&gt; &gt;         Queue: WWW-Mechanize-FireFox
&gt; &gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=84418">https://rt.cpan.org/Ticket/Display.html?id=84418</a></span> &gt;
&gt; &gt;
&gt; &gt; Hello,
&gt; &gt;
&gt; &gt; I&#39;m sorry my reply is late.
&gt; &gt;
&gt; &gt;
&gt; &gt; I modified API40.pm and changed closeTab&#40;&#41; as you&#39;d written.
&gt; &gt;
&gt; &gt; I tested several times with various number of FF windows. &#40;up to
</div>&gt; five&#41;
<div class="message-stanza open">&gt; &gt; &#40;My FF version is 20.0 and MozRepl extension is a patched version
&gt; &gt;
</div>&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/milouse/mozrepl/commit/3504aa5b45f4b438bc0e7ef53019558c4bd8bc1c">https://github.com/milouse/mozrepl/commit/3504aa5b45f4b438bc0e7ef53019558c4bd8bc1c</a></span>
&gt; &#41;
<div class="message-stanza open">&gt; &gt;
&gt; &gt;
&gt; &gt; This code:
&gt; &gt;     # close tab explicitly
&gt; &gt;     $fox-&gt;application&#40;&#41;-&gt;closeTab&#40; $fox-&gt;tab&#40;&#41; &#41;;
&gt; &gt; worked very well in every time.
&gt; &gt; Every tab was closed correctly. :-&#41;
&gt; &gt;
&gt; &gt;
&gt; &gt; On the other hand,
&gt; &gt;     undef $fox;
&gt; &gt; or, to do nothing and exit&#40;&#41;,
&gt; &gt; these resulted in the problem as before.
&gt; &gt; &#40;sleep&#40;&#41; before exit&#40;&#41; didn&#39;t work&#41;
&gt; &gt;
&gt; &gt;
&gt; &gt; I wish my report to be helpful.
&gt; &gt;
&gt; &gt; G.Y.Park
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; On Wed Apr 10 16:15:33 2013, CORION wrote:
<div class="message-stanza open">&gt; &gt;&gt; Hello again,
&gt; &gt;&gt;
&gt; &gt;&gt; thanks for finding out how to more easily reproduce the error. I
</div></div>&gt; was
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt;     now
&gt; &gt;&gt; able to always reproduce the error. With the following changed
&gt; &gt;&gt; subroutine -&gt;closeTab&#40;&#41;, I always get a properly closed tab, no
</div></div>&gt; matter
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; which window is active at closing time:
&gt; &gt;&gt;
&gt; &gt;&gt; sub closeTab {
&gt; &gt;&gt;       my &#40;$self,$tab,$repl&#41; = @_;
&gt; &gt;&gt;       $repl ||= $self-&gt;repl;
&gt; &gt;&gt;       my $close_tab = $repl-&gt;declare&#40;&lt;&lt;&#39;JS&#39;&#41;;
&gt; &gt;&gt; function&#40;tab&#41; {
&gt; &gt;&gt;             if&#40;tab.collapsed&#41; { return };
&gt; &gt;&gt;             var be =
&gt; &gt;&gt; Components.classes[&#34;@mozilla.org/appshell/window-mediator;1&#34;]
&gt; &gt;&gt;
</div></div>&gt; .getService&#40;Components.interfaces.nsIWindowMediator&#41;
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt;                         .getEnumerator&#40;&#34;navigator:browser&#34;&#41;;
&gt; &gt;&gt;      while &#40;be.hasMoreElements&#40;&#41;&#41; {
&gt; &gt;&gt;        var browserWin = be.getNext&#40;&#41;;
&gt; &gt;&gt;        var tabbrowser = browserWin.gBrowser;
&gt; &gt;&gt;        if&#40; tabbrowser &#41; {
&gt; &gt;&gt;          for&#40; var i=0; i&lt; tabbrowser.tabs.length; i++&#41; {
&gt; &gt;&gt;              if&#40; tabbrowser.tabs.item&#40; i &#41; === tab &#41; {
&gt; &gt;&gt;                         tabbrowser.removeTab&#40;tab&#41;;
&gt; &gt;&gt;                         break;
&gt; &gt;&gt;                     };
&gt; &gt;&gt;                 };
&gt; &gt;&gt;        };
&gt; &gt;&gt;             };
&gt; &gt;&gt; }
&gt; &gt;&gt; JS
&gt; &gt;&gt;       return $close_tab-&gt;&#40;$tab&#41;;
&gt; &gt;&gt; }
&gt; &gt;&gt;
&gt; &gt;&gt; The changed version works for me on Firefox 20 and I&#39;m currently
&gt; &gt;&gt;     running
&gt; &gt;&gt; the test suite for the other browser versions.
&gt; &gt;&gt;
&gt; &gt;&gt; Can you please test whether this change also works for your cases?
</div></div>&gt; If
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; so, I will release a new version.
&gt; &gt;&gt;
&gt; &gt;&gt; -max
&gt; &gt;&gt;
&gt; &gt;&gt;
&gt; &gt;&gt; Am 09.04.2013 08:34, schrieb Geunyoung Park via RT:
<div class="message-stanza open">&gt; &gt;&gt;&gt;          Queue: WWW-Mechanize-FireFox
&gt; &gt;&gt;&gt;    Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=84418">https://rt.cpan.org/Ticket/Display.html?id=84418</a></span> &gt;
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; Hello,
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; Thank you for your reply.
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; I tried
&gt; &gt;&gt;&gt; undef $fox;
&gt; &gt;&gt;&gt; but it didn&#39;t work.
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; I inserted sleep&#40;&#41; before and after undef statement, but it also
&gt; &gt;&gt;&gt; didn&#39;t work.
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; Finally, I tried such code:
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; # close tab explicitly
&gt; &gt;&gt;&gt; $fox-&gt;application&#40;&#41;-&gt;closeTab&#40; $fox-&gt;tab&#40;&#41; &#41;;
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; This code worked well with one window &#40;or, running in first window
</div>&gt; &gt;&gt;     of two&#41;
<div class="message-stanza open">&gt; &gt;&gt;&gt; But when the script runs in the second window, that line resulted
</div></div></div>&gt; in
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt;     an
<div class="message-stanza open">&gt; &gt;&gt;&gt; error:
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; MozRepl::RemoteObject: NS_ERROR_FAILURE: Component returned
</div></div></div>&gt; failure
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt;     code: 0x80004005 &#40;NS_ERROR_FAILURE&#41;
&gt; &gt;&gt;     [nsIWebProgress.removeProgressListener] at
&gt; &gt;&gt;     D:/strawberry/perl/site/lib/Firefox/Application/API40.pm line
</div></div>&gt; 159
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; G.Y.Park
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; On Mon Apr 08 13:01:57 2013, CORION wrote:
<div class="message-stanza open">&gt; &gt;&gt;&gt;&gt; Hello Geunyoung Park!
&gt; &gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt; Actually, WWW::Mechanize::Firefox can remove the tab even from a
&gt; &gt;&gt;&gt;&gt; different window, since about v 0.50 or so. The problem is that
</div></div></div>&gt; at
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt;     the
<div class="message-stanza open">&gt; &gt;&gt;&gt;&gt; end of the script, Perl has already shut down the socket
</div></div></div>&gt; connection
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt;     to
<div class="message-stanza open">&gt; &gt;&gt;&gt;&gt; Firefox, and so Perl cannot talk to Firefox anymore.
&gt; &gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt; The workaround is to explicitly release Firefox before your
</div></div></div>&gt; program
<div class="message-stanza open"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt;&gt;&gt; ends:
&gt; &gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;      perl -Ilib -MWWW::Mechanize::Firefox::DSL -e &#34;sleep 5; undef
</div>&gt; &gt;&gt;     $mech&#34;
<div class="message-stanza open">&gt; &gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt; ... or in your test program:
&gt; &gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;      use WWW::Mechanize::Firefox;
&gt; &gt;&gt;&gt;&gt;      my $fox= WWW::Mechanize::Firefox-&gt;new&#40;&#41;;
&gt; &gt;&gt;&gt;&gt;      $fox-&gt;get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://google.com">http://google.com</a></span>&#39;&#41;;
&gt; &gt;&gt;&gt;&gt;      undef $fox;
&gt; &gt;&gt;&gt;&gt;      exit;
&gt; &gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt; -max
&gt; &gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt; Am 04.04.2013 07:29, schrieb Geunyoung Park via RT:
<div class="message-stanza open">&gt; &gt;&gt;&gt;&gt;&gt;           Queue: WWW-Mechanize-FireFox
&gt; &gt;&gt;&gt;&gt;&gt;     Ticket &lt;URL:
</div></div></div></div>&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=84418">https://rt.cpan.org/Ticket/Display.html?id=84418</a></span> &gt;
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;&gt; I forgot reporting what my script was.
&gt; &gt;&gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;&gt; It was just a very simple script:
&gt; &gt;&gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;&gt; use WWW::Mechanize::Firefox;
&gt; &gt;&gt;&gt;&gt;&gt; my $fox = WWW::Mechanize::Firefox-&gt;new&#40;&#41;;
&gt; &gt;&gt;&gt;&gt;&gt; $fox-&gt;get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://google.com">http://google.com</a></span>&#39;&#41;;
&gt; &gt;&gt;&gt;&gt;&gt; exit;
&gt; &gt;&gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;&gt; G.Y.Park
&gt; &gt;&gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;&gt; On Thu Apr 04 01:26:47 2013, GYPARK wrote:
<div class="message-stanza open">&gt; &gt;&gt;&gt;&gt;&gt;&gt; Hello,
&gt; &gt;&gt;&gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;&gt;&gt; At first, thank you for your great module.
&gt; &gt;&gt;&gt;&gt;&gt;&gt; It is very helpful to me and I really love it.
&gt; &gt;&gt;&gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;&gt;&gt; I found a problem that tab doesn&#39;t close automatically
&gt; &gt;&gt;&gt;&gt;&gt;&gt; when the tab has opened in...other than the first window.
&gt; &gt;&gt;&gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;&gt;&gt; I&#39;m not good at English so I made a illustration and attached
</div></div></div>&gt; it.
<div class="message-stanza open"><div class="message-stanza open"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt;&gt;&gt;&gt;&gt; I wish it would be helpful for you in reproducing the problem.
&gt; &gt;&gt;&gt;&gt;&gt;&gt; Firefox in my screenshot is Korean version but it would not
</div></div>&gt; &gt;&gt;     matter,
<div class="message-stanza open">&gt; &gt;&gt;&gt;&gt; maybe.
<div class="message-stanza open">&gt; &gt;&gt;&gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;&gt;&gt; And, I have no idea whether this is an issue of this module or
</div></div></div></div>&gt; of
<div class="message-stanza open"><div class="message-stanza open"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt;&gt;&gt; MozRepl.
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt;&gt;&gt;&gt;&gt; If it is case of the latter, I&#39;m sorry for bothering you.
&gt; &gt;&gt;&gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;&gt;&gt; Would you please check it?
&gt; &gt;&gt;&gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;&gt;&gt; Thank you.
&gt; &gt;&gt;&gt;&gt;&gt;&gt; G.Y.Park from South Korea
</div>&gt; &gt;&gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;&gt;
&gt; &gt;&gt;&gt;&gt;&gt;
</div>&gt; &gt;&gt;&gt;&gt;
</div>&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt;
</div>&gt; &gt;&gt;
</div>&gt; &gt;
&gt; &gt;
&gt; &gt;
</div>&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1201343" href="/Public/Bug/Display.html?id=84418#txn-1201343">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;12&nbsp;15:05:59&nbsp;2013</span>
    <span class="description">corion [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #84418] tab doesn&#39;t close when there are multiple windows</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 12 Apr 2013 21:05:28 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-WWW-Mechanize-FireFox [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Max Maischein &lt;corion [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1201343/634264/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/634264">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 9.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi again,

I&#39;ve just released v0.72 with this fix

Thanks again for reporting and testing!
-max

Am 12.04.2013 03:48, schrieb Geunyoung Park via RT:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: WWW-Mechanize-FireFox
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=84418">https://rt.cpan.org/Ticket/Display.html?id=84418</a></span> &gt;
&gt;
&gt; Hello,
&gt;
&gt;
&gt; I tried this new change and I couldn&#39;t find any case that
&gt; the error occurred again. :-&#41;
&gt;
&gt; Now I don&#39;t need explicit closeTab&#40;&#41; nor undef&#40;&#41;.
&gt; My first simple script works very well with mutiple windows.
&gt; When the script exits, &#40;of course I don&#39;t need even exit&#40;&#41;&#41;
&gt; the tab closes perfectly.
&gt;
&gt; Thank you very much for your effort.
&gt; and thanks again for this fantastic module.
&gt;
&gt; G.Y.Park
&gt;
&gt;
&gt;
&gt;
&gt;
&gt; On Thu Apr 11 15:42:08 2013, CORION wrote:
<div class="message-stanza open">&gt;&gt; Hello again,
&gt;&gt;
&gt;&gt; it&#39;s great if the changed closeTab&#40;&#41; works for you. If you also change
&gt;&gt; the sub -&gt;autoclose_tab&#40;&#41; as below, it should all work. I&#39;ve attached
&gt;&gt; my
&gt;&gt; test case for the regression tests too. Without the changes, I get 2
&gt;&gt; failed tests, and with the changes I get 6 passing tests. If you can
&gt;&gt; reproduce the error before patching and the error goes away with the
&gt;&gt; changes below, that would be fantastic.
&gt;&gt;
&gt;&gt; Also thank you very much for the hint of the patched MozRepl. I have
&gt;&gt; just upgraded to Firefox 20, with the changes from github. It seems
&gt;&gt; there is a fresh release of the Mozrepl plugin at
&gt;&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/bard/mozrepl">https://github.com/bard/mozrepl</a></span> incorporating these changes.
&gt;&gt;
&gt;&gt; -max
&gt;&gt;
&gt;&gt; sub closeTab {
&gt;&gt;       my &#40;$self,$tab,$repl&#41; = @_;
&gt;&gt;       $repl ||= $self-&gt;repl;
&gt;&gt;       my $close_tab = $repl-&gt;declare&#40;&lt;&lt;&#39;JS&#39;&#41;;
&gt;&gt; function&#40;tab&#41; {
&gt;&gt;             if&#40;tab.collapsed&#41; { return };
&gt;&gt;             var be =
&gt;&gt; Components.classes[&#34;@mozilla.org/appshell/window-mediator;1&#34;]
&gt;&gt;                           .getService&#40;Components.interfaces.nsIWindowMediator&#41;
&gt;&gt;                           .getEnumerator&#40;&#34;navigator:browser&#34;&#41;;
&gt;&gt;        while &#40;be.hasMoreElements&#40;&#41;&#41; {
&gt;&gt;          var browserWin = be.getNext&#40;&#41;;
&gt;&gt;          var tabbrowser = browserWin.gBrowser;
&gt;&gt;          if&#40; tabbrowser &#41; {
&gt;&gt;            for&#40; var i=0; i&lt; tabbrowser.tabs.length; i++&#41; {
&gt;&gt;                if&#40; tabbrowser.tabs.item&#40; i &#41; === tab &#41; {
&gt;&gt;                         tabbrowser.removeTab&#40;tab&#41;;
&gt;&gt;                         break;
&gt;&gt;                     };
&gt;&gt;                 };
&gt;&gt;          };
&gt;&gt;             };
&gt;&gt; }
&gt;&gt; JS
&gt;&gt;       return $close_tab-&gt;&#40;$tab&#41;;
&gt;&gt; }
&gt;&gt;
&gt;&gt; sub autoclose_tab {
&gt;&gt;       my &#40;$self,$tab,$close&#41; = @_;
&gt;&gt;       $close = 1
&gt;&gt;           if&#40; 2 == @_ &#41;;
&gt;&gt;       my $release = join &#34;\n&#34;,
&gt;&gt;             # Find the window our tab lives in
&gt;&gt;             q&lt;if&#40;!self.collapsed&#41;{&gt;,
&gt;&gt;                 q&lt;var be =
&gt;&gt; Components.classes[&#34;@mozilla.org/appshell/window-mediator;1&#34;]&gt;,
&gt;&gt;
&gt;&gt; q&lt;.getService&#40;Components.interfaces.nsIWindowMediator&#41;&gt;,
&gt;&gt;                                    q&lt;.getEnumerator&#40;&#34;navigator:browser&#34;&#41;;&gt;,
&gt;&gt;                 q&lt;while &#40;be.hasMoreElements&#40;&#41;&#41; {&gt;,
&gt;&gt;                   q&lt;var browserWin = be.getNext&#40;&#41;;&gt;,
&gt;&gt;                   q&lt;var tabbrowser = browserWin.gBrowser;&gt;,
&gt;&gt;                   q&lt;if&#40; tabbrowser &#41; {&gt;,
&gt;&gt;                     q!for&#40; var i=0; i&lt; tabbrowser.tabs.length; i++&#41; {!,
&gt;&gt;                         q&lt;if&#40; tabbrowser.tabs.item&#40; i &#41; === self &#41; {&gt;,
&gt;&gt;                             q&lt;tabbrowser.removeTab&#40;self&#41;;&gt;,
&gt;&gt;                             q&lt;break;&gt;,
&gt;&gt;                         q&lt;};&gt;,
&gt;&gt;                     q&lt;};&gt;,
&gt;&gt;                   q&lt;};&gt;,
&gt;&gt;                 q&lt;};&gt;,
&gt;&gt;           q&lt;};&gt;,
&gt;&gt;       ;
&gt;&gt;       if&#40; $close &#41; {
&gt;&gt;           $tab-&gt;__release_action&#40;$release&#41;;
&gt;&gt;       } else {
&gt;&gt;           $tab-&gt;__release_action&#40;&#39;&#39;&#41;;
&gt;&gt;       };
&gt;&gt; };
&gt;&gt;
&gt;&gt;
&gt;&gt; Am 11.04.2013 18:27, schrieb Geunyoung Park via RT:
<div class="message-stanza open">&gt;&gt;&gt;          Queue: WWW-Mechanize-FireFox
&gt;&gt;&gt;    Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=84418">https://rt.cpan.org/Ticket/Display.html?id=84418</a></span> &gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Hello,
&gt;&gt;&gt;
&gt;&gt;&gt; I&#39;m sorry my reply is late.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; I modified API40.pm and changed closeTab&#40;&#41; as you&#39;d written.
&gt;&gt;&gt;
&gt;&gt;&gt; I tested several times with various number of FF windows. &#40;up to
</div>&gt;&gt; five&#41;
<div class="message-stanza open">&gt;&gt;&gt; &#40;My FF version is 20.0 and MozRepl extension is a patched version
&gt;&gt;&gt;
</div>&gt;&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/milouse/mozrepl/commit/3504aa5b45f4b438bc0e7ef53019558c4bd8bc1c">https://github.com/milouse/mozrepl/commit/3504aa5b45f4b438bc0e7ef53019558c4bd8bc1c</a></span>
&gt;&gt; &#41;
<div class="message-stanza open">&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; This code:
&gt;&gt;&gt;      # close tab explicitly
&gt;&gt;&gt;      $fox-&gt;application&#40;&#41;-&gt;closeTab&#40; $fox-&gt;tab&#40;&#41; &#41;;
&gt;&gt;&gt; worked very well in every time.
&gt;&gt;&gt; Every tab was closed correctly. :-&#41;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On the other hand,
&gt;&gt;&gt;      undef $fox;
&gt;&gt;&gt; or, to do nothing and exit&#40;&#41;,
&gt;&gt;&gt; these resulted in the problem as before.
&gt;&gt;&gt; &#40;sleep&#40;&#41; before exit&#40;&#41; didn&#39;t work&#41;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; I wish my report to be helpful.
&gt;&gt;&gt;
&gt;&gt;&gt; G.Y.Park
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Wed Apr 10 16:15:33 2013, CORION wrote:
<div class="message-stanza open">&gt;&gt;&gt;&gt; Hello again,
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; thanks for finding out how to more easily reproduce the error. I
</div></div>&gt;&gt; was
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt;      now
&gt;&gt;&gt;&gt; able to always reproduce the error. With the following changed
&gt;&gt;&gt;&gt; subroutine -&gt;closeTab&#40;&#41;, I always get a properly closed tab, no
</div></div>&gt;&gt; matter
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt; which window is active at closing time:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; sub closeTab {
&gt;&gt;&gt;&gt;        my &#40;$self,$tab,$repl&#41; = @_;
&gt;&gt;&gt;&gt;        $repl ||= $self-&gt;repl;
&gt;&gt;&gt;&gt;        my $close_tab = $repl-&gt;declare&#40;&lt;&lt;&#39;JS&#39;&#41;;
&gt;&gt;&gt;&gt; function&#40;tab&#41; {
&gt;&gt;&gt;&gt;              if&#40;tab.collapsed&#41; { return };
&gt;&gt;&gt;&gt;              var be =
&gt;&gt;&gt;&gt; Components.classes[&#34;@mozilla.org/appshell/window-mediator;1&#34;]
&gt;&gt;&gt;&gt;
</div></div>&gt;&gt; .getService&#40;Components.interfaces.nsIWindowMediator&#41;
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt;                         .getEnumerator&#40;&#34;navigator:browser&#34;&#41;;
&gt;&gt;&gt;&gt;      while &#40;be.hasMoreElements&#40;&#41;&#41; {
&gt;&gt;&gt;&gt;        var browserWin = be.getNext&#40;&#41;;
&gt;&gt;&gt;&gt;        var tabbrowser = browserWin.gBrowser;
&gt;&gt;&gt;&gt;        if&#40; tabbrowser &#41; {
&gt;&gt;&gt;&gt;          for&#40; var i=0; i&lt; tabbrowser.tabs.length; i++&#41; {
&gt;&gt;&gt;&gt;              if&#40; tabbrowser.tabs.item&#40; i &#41; === tab &#41; {
&gt;&gt;&gt;&gt;                          tabbrowser.removeTab&#40;tab&#41;;
&gt;&gt;&gt;&gt;                          break;
&gt;&gt;&gt;&gt;                      };
&gt;&gt;&gt;&gt;                  };
&gt;&gt;&gt;&gt;        };
&gt;&gt;&gt;&gt;              };
&gt;&gt;&gt;&gt; }
&gt;&gt;&gt;&gt; JS
&gt;&gt;&gt;&gt;        return $close_tab-&gt;&#40;$tab&#41;;
&gt;&gt;&gt;&gt; }
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; The changed version works for me on Firefox 20 and I&#39;m currently
&gt;&gt;&gt;&gt;      running
&gt;&gt;&gt;&gt; the test suite for the other browser versions.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Can you please test whether this change also works for your cases?
</div></div>&gt;&gt; If
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt; so, I will release a new version.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; -max
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Am 09.04.2013 08:34, schrieb Geunyoung Park via RT:
<div class="message-stanza open">&gt;&gt;&gt;&gt;&gt;           Queue: WWW-Mechanize-FireFox
&gt;&gt;&gt;&gt;&gt;     Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=84418">https://rt.cpan.org/Ticket/Display.html?id=84418</a></span> &gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Hello,
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Thank you for your reply.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; I tried
&gt;&gt;&gt;&gt;&gt; undef $fox;
&gt;&gt;&gt;&gt;&gt; but it didn&#39;t work.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; I inserted sleep&#40;&#41; before and after undef statement, but it also
&gt;&gt;&gt;&gt;&gt; didn&#39;t work.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; Finally, I tried such code:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; # close tab explicitly
&gt;&gt;&gt;&gt;&gt; $fox-&gt;application&#40;&#41;-&gt;closeTab&#40; $fox-&gt;tab&#40;&#41; &#41;;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; This code worked well with one window &#40;or, running in first window
</div>&gt;&gt;&gt;&gt;      of two&#41;
<div class="message-stanza open">&gt;&gt;&gt;&gt;&gt; But when the script runs in the second window, that line resulted
</div></div></div>&gt;&gt; in
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt;      an
<div class="message-stanza open">&gt;&gt;&gt;&gt;&gt; error:
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; MozRepl::RemoteObject: NS_ERROR_FAILURE: Component returned
</div></div></div>&gt;&gt; failure
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt;      code: 0x80004005 &#40;NS_ERROR_FAILURE&#41;
&gt;&gt;&gt;&gt;      [nsIWebProgress.removeProgressListener] at
&gt;&gt;&gt;&gt;      D:/strawberry/perl/site/lib/Firefox/Application/API40.pm line
</div></div>&gt;&gt; 159
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; G.Y.Park
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; On Mon Apr 08 13:01:57 2013, CORION wrote:
<div class="message-stanza open">&gt;&gt;&gt;&gt;&gt;&gt; Hello Geunyoung Park!
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Actually, WWW::Mechanize::Firefox can remove the tab even from a
&gt;&gt;&gt;&gt;&gt;&gt; different window, since about v 0.50 or so. The problem is that
</div></div></div>&gt;&gt; at
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt;      the
<div class="message-stanza open">&gt;&gt;&gt;&gt;&gt;&gt; end of the script, Perl has already shut down the socket
</div></div></div>&gt;&gt; connection
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt;      to
<div class="message-stanza open">&gt;&gt;&gt;&gt;&gt;&gt; Firefox, and so Perl cannot talk to Firefox anymore.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; The workaround is to explicitly release Firefox before your
</div></div></div>&gt;&gt; program
<div class="message-stanza open"><div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt;&gt;&gt; ends:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;       perl -Ilib -MWWW::Mechanize::Firefox::DSL -e &#34;sleep 5; undef
</div>&gt;&gt;&gt;&gt;      $mech&#34;
<div class="message-stanza open">&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; ... or in your test program:
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;       use WWW::Mechanize::Firefox;
&gt;&gt;&gt;&gt;&gt;&gt;       my $fox= WWW::Mechanize::Firefox-&gt;new&#40;&#41;;
&gt;&gt;&gt;&gt;&gt;&gt;       $fox-&gt;get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://google.com">http://google.com</a></span>&#39;&#41;;
&gt;&gt;&gt;&gt;&gt;&gt;       undef $fox;
&gt;&gt;&gt;&gt;&gt;&gt;       exit;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; -max
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; Am 04.04.2013 07:29, schrieb Geunyoung Park via RT:
<div class="message-stanza open">&gt;&gt;&gt;&gt;&gt;&gt;&gt;            Queue: WWW-Mechanize-FireFox
&gt;&gt;&gt;&gt;&gt;&gt;&gt;      Ticket &lt;URL:
</div></div></div></div>&gt;&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=84418">https://rt.cpan.org/Ticket/Display.html?id=84418</a></span> &gt;
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; I forgot reporting what my script was.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; It was just a very simple script:
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; use WWW::Mechanize::Firefox;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; my $fox = WWW::Mechanize::Firefox-&gt;new&#40;&#41;;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; $fox-&gt;get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://google.com">http://google.com</a></span>&#39;&#41;;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; exit;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; G.Y.Park
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt; On Thu Apr 04 01:26:47 2013, GYPARK wrote:
<div class="message-stanza open">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Hello,
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; At first, thank you for your great module.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; It is very helpful to me and I really love it.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; I found a problem that tab doesn&#39;t close automatically
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; when the tab has opened in...other than the first window.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; I&#39;m not good at English so I made a illustration and attached
</div></div></div>&gt;&gt; it.
<div class="message-stanza open"><div class="message-stanza open"><div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; I wish it would be helpful for you in reproducing the problem.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Firefox in my screenshot is Korean version but it would not
</div></div>&gt;&gt;&gt;&gt;      matter,
<div class="message-stanza open">&gt;&gt;&gt;&gt;&gt;&gt; maybe.
<div class="message-stanza open">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; And, I have no idea whether this is an issue of this module or
</div></div></div></div>&gt;&gt; of
<div class="message-stanza open"><div class="message-stanza open"><div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt;&gt;&gt; MozRepl.
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; If it is case of the latter, I&#39;m sorry for bothering you.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Would you please check it?
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Thank you.
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; G.Y.Park from South Korea
</div>&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;
</div>&gt;&gt;&gt;&gt;&gt;&gt;
</div>&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
</div>&gt;&gt;&gt;&gt;
</div>&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
</div>&gt;&gt;
</div>&gt;
&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1201345" href="/Public/Bug/Display.html?id=84418#txn-1201345">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;12&nbsp;15:06:44&nbsp;2013</span>
    <span class="description">corion [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.737363</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
