<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #48770 for PAR-Packer: $0 is not working when PAR is used</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #48770 for PAR-Packer: $0 is not working when PAR is used</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/PAR-Packer/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/PAR-Packer/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/PAR-Packer/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/PAR-Packer/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/PAR-Packer">PAR-Packer CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">48770</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/PAR-Packer/Active/">PAR-Packer</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
mianrojas [...] hotmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-41710-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-41711-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;17&nbsp;10:11:04&nbsp;2009</span>
    <span class="description">mianrojas [...] hotmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> $0 is not working when PAR is used</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 17 Aug 2009 16:10:40 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-par [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Miguel Angel Rojas Gómez &lt;mianrojas [...] hotmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
      Hi all,

 

      It seems that $0 var is not processed properly inside PAR binaries:

I&#39;ve created just an small script in which you can see the behaviour I&#39;m talking about:

 

# cat test.pl
#!/usr/bin/perl

print &#34;\$0 : $0\n&#34;;
$0 = &#34;xxxxxxxxxxx 1 2 3 4&#34;;
print &#34;--\n&#34;;
system&#40;&#34;ps -ef | grep -v grep | grep $$&#34;&#41;;
print &#34;--\n&#34;;
print &#34;\$0 : $0\n&#34;;

exit 0;

# ./test.pl A B C
$0 : ./test.pl
--
root 2992 2806 0 16:53 pts/0 00:00:00 xxxxxxxxxxx 1 2 3 4 &lt;-- output is right. no issues.
--
$0 : xxxxxxxxxxx 1 2 3 4

 

     There is nothing wrong here as you can see. But if you &#34;PAR&#34; the script:

 

# pp -o test test.pl

 

# ./test A B C
$0 : ./test
--
root 3257 2984 0 13:23 pts/1 00:00:00 xxxxxx A B C &lt;-- See that!!!
--
$0 : xxxxxxxxxxx 1 2 3 4

 

     It seems that only the first 6 characters are included!!. It seems to be a bug.

 

     I&#39;m using perl version 5.10.0 for a Debian lenny distribution with standard packages. 

The behaviour of $0 has changed and PAR does not suppose to change the behaviour of the program so I consider this bug important.

 

      Let me know if you need further details.

 

      Thanks.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">_________________________________________________________________
¿Quieres los nuevos emoticonos en 3D? ¡Descárgatelos gratis!
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.vivelive.com/emoticonos3d/index2.html">http://www.vivelive.com/emoticonos3d/index2.html</a></span>
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;17&nbsp;15:12:38&nbsp;2009</span>
    <span class="description">schupp [...] argumentum.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #48770] $0 is not working when PAR is used</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 17 Aug 2009 21:12:19 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PAR [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Roderich Schupp &lt;schupp [...] argumentum.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">2009/8/17 Miguel Angel Rojas Gómez via RT &lt;bug-PAR@rt.cpan.org&gt;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;      It seems that $0 var is not processed properly inside PAR binaries:
</div>
It is. Your notion of &#34;properly&#34; is wrong :&#41;

From the Perl source &#40;perl.c&#41;:

        /* Set PL_origalen be the sum of the contiguous argv[]
         * elements plus the size of the env in case that it is
         * contiguous with the argv[].  This is used in mg.c:Perl_magic_set&#40;&#41;
         * as the maximum modifiable length of $0.  In the worst case
         * the area we are able to modify is limited to the size of
         * the original argv[0].  &#40;See below for &#39;contiguous&#39;, though.&#41;

Try the following script &#40;essentially your example&#41;:

print &#34;before \$0=$0\n&#34;;
$0 = &#34;12345678901234567890&#34;;
print &#34;after \$0=$0\n&#34;;
system qw&#40;ps -f&#41;, $$;

OK, run it:

$ perl foo.pl
before $0=foo.pl
after $0=12345678901234567890
UID        PID  PPID  C STIME TTY      STAT   TIME CMD
roderich 17517 28077  0 21:04 pts/3    S+     0:00 12345678901234567890

But this only works because most environments are large enough so that
the new value of $0 will fit in to the combined contiguous arg+env space.
If we shrink the environment to nothing it doesn&#39;t work anymore:

$  env - perl foo.pl
before $0=foo.pl
after $0=12345678901234567890
UID        PID  PPID  C STIME TTY      STAT   TIME CMD
roderich 17647 28077  0 21:06 pts/3    S+     0:00 12345678901

The same happens in a packed executable because it already manipulates
$0 &#40;and @ARGV and the environment&#41; before it even gets to execute
your script. Afterwards the &#34;combined contiguous&#34;
space has shrunk to the size of $0 itself and that&#39;s what you observe.

Sorry, no cake.

Cheers, Roderich
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;17&nbsp;15:12:39&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;18&nbsp;05:16:49&nbsp;2009</span>
    <span class="description">mianrojas [...] hotmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #48770] $0 is not working when PAR is used</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 18 Aug 2009 11:16:28 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-par [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Miguel Angel Rojas Gómez &lt;mianrojas [...] hotmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
     Hi Roderich,

     Thanks for your good explanation. It is really appreciated.

     When I packed my perl files, I discover the program didn&#39;t work as expected and
I had to dig down for not few days in order to discover $0 was not working properly.
As you have shown, you have gone one step further, it seems the issue is related with 
the shrink of the environment but I think this is something quite weird.

     The issue I see here is that there is a command &#40;not PAR&#39;ed &#41; that is working properly,
and then, when it is PAR&#39;ed, it has different behaviour, which this is something I see not acceptable.
I remember perlcc could change the behaviour of the program because it does not guarantee full
compliant, but I didn&#39;t read anything about it in PAR. Indeed, I think I see some references saying
use PAR if you do not want to see a weird behaviour in your program.

     PAR should not shrink the environment variable in a way the behaviour of the program
is changed &#40;!!&#41;. If it does that &#40;I&#39;m pretty sure there could be a good reason for it, but I am not
an expert&#41; it should not affect the specification of the program, as it seems it does.

     My point heres are 2 then:

Could this be fixed? 
If not, could it be a workaround in which this &#34;shrinking&#34; environment in the PAR files could be overcome and the behaviour of the programs are not changed?

    Thanks

            Miguel.

   

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">_________________________________________________________________
Internet Explorer 8 más sencillo y seguro ¡Descárgatelo gratis!
<span class="clickylink"><a target="new" rel="nofollow" href="http://events.es.msn.com/noticias/internet-explorer-8/">http://events.es.msn.com/noticias/internet-explorer-8/</a></span>
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;18&nbsp;07:58:53&nbsp;2009</span>
    <span class="description">RSCHUPP [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Aug 18 05:16:49 2009, mianrojas@hotmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As you have shown, you have gone one step further, it seems the issue
&gt; is related with
&gt; the shrink of the environment but I think this is something quite
&gt; weird.
</div>
It&#39;s not so weird if you know how most Unixes &#40;including Linux&#41;
implement the passing of arguments + environment to a program
&#40;i.e. across execve&#41; and how ps gets its information.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;      The issue I see here is that there is a command &#40;not PAR&#39;ed &#41;
&gt; that is working properly,
&gt; and then, when it is PAR&#39;ed, it has different behaviour, which this is
&gt; something I see not acceptable.
</div>
As I&#39;ve said before, your example &#34;works&#34; by accident
&#40;albeit chances are good that it works most of the time&#41;.
The perlvar man page explains that setting $0 and how this
is reflected in ps etc are highly OS dependent and the only
thing you could reasonably expect is up to the length of
the original $0 &#40;and that&#39;s what you observe&#41;.

In general, it is NOT reasonable to expect that a packed program
will behave absoolutely identical to the original script. PAR tries
hard and jumps thru several hoops to make some stupid constructs
magically work out of the box. But there are known cases, where
it doesn&#39;t work and you have to change your expectations and
your code.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;      My point heres are 2 then:
&gt; 
&gt; Could this be fixed?
&gt; If not, could it be a workaround in which this &#34;shrinking&#34; environment
&gt; in the PAR files could be overcome and the behaviour of the programs
&gt; are not changed?
</div>
It might be possible to rewrite the handling of argv and envp
in PAR::Packer &#40;actually it&#39;s parl as embedded in every 
packed executable&#41; so that the &#34;shrinking&#34; of the environment
can be avoided.

Patches welcome, the stuff is in myldr/*.c in the PAR::Packer source.
You might want to consult the Perl source &#40;mg.c and perl.c in
particular&#41; to study the contortions Perl has to go thru to 
implement the current behaviour.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;18&nbsp;09:16:24&nbsp;2009</span>
    <span class="description">mianrojas [...] hotmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #48770] $0 is not working when PAR is used</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 18 Aug 2009 15:16:02 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-par [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Miguel Angel Rojas Gómez &lt;mianrojas [...] hotmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
      Hi,

 

      Here are my comments:

 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In general, it is NOT reasonable to expect that a packed program
&gt; will behave absoolutely identical to the original script. PAR tries
&gt; hard and jumps thru several hoops to make some stupid constructs
&gt; magically work out of the box. But there are known cases, where
&gt; it doesn&#39;t work and you have to change your expectations and
&gt; your code.
</div>
 

     Ok, that would mean that PAR a perl file is not really useful if, as

you mentioned, because perl code behaviour would change. Unless you 

really know which functions/contructions are not affected. 

 

Is there a list in which we can take a look at? I think this is something

should be stated in the man pages and CPAN PAR web.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It might be possible to rewrite the handling of argv and envp
&gt; in PAR::Packer &#40;actually it&#39;s parl as embedded in every 
&gt; packed executable&#41; so that the &#34;shrinking&#34; of the environment
&gt; can be avoided.
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Patches welcome, the stuff is in myldr/*.c in the PAR::Packer source.
&gt; You might want to consult the Perl source &#40;mg.c and perl.c in
&gt; particular&#41; to study the contortions Perl has to go thru to 
&gt; implement the current behaviour.
</div>

      Thanks! I took a look into it and the behaviour seems as you mentioned.

But anyway, I think argv and envp behaviour should not be changed in a PAR

executable &#40;quite critical if you want to access these option in your code&#41;. 

Of course, it seems this is not something trivial but it is something is impacting 

perl coding, and if this is not fixed, it should be reflected somewhere.

 

      Miguel.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">_________________________________________________________________
Entérate de todas las noticias al instante ¡Suscríbete al servicio de Alertas MSN!
<span class="clickylink"><a target="new" rel="nofollow" href="http://especiales.es.msn.com/noticias/msninforma.aspx">http://especiales.es.msn.com/noticias/msninforma.aspx</a></span>
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;19&nbsp;07:37:25&nbsp;2009</span>
    <span class="description">nj88udd02 [...] sneakemail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #48770] $0 is not working when PAR is used</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 19 Aug 2009 13:37:04 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PAR [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Steffen Mueller &lt;nj88udd02 [...] sneakemail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Miguel,

Miguel Angel Rojas Gómez via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: PAR
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=48770">http://rt.cpan.org/Ticket/Display.html?id=48770</a></span> &gt;
<div class="message-stanza open">&gt;&gt; In general, it is NOT reasonable to expect that a packed program
&gt;&gt; will behave absoolutely identical to the original script. PAR tries
&gt;&gt; hard and jumps thru several hoops to make some stupid constructs
&gt;&gt; magically work out of the box. But there are known cases, where
&gt;&gt; it doesn&#39;t work and you have to change your expectations and
&gt;&gt; your code.
</div>&gt; 
&gt;  
&gt; 
&gt;      Ok, that would mean that PAR a perl file is not really useful if, as
&gt; you mentioned, because perl code behaviour would change. Unless you 
&gt; really know which functions/contructions are not affected. 
</div>
You&#39;re being a bit silly here. PAR&#39;s quite useful and employed for 
deployment of large applications to many tens of thousands of computers 
worldwide.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Is there a list in which we can take a look at? I think this is something
&gt; should be stated in the man pages and CPAN PAR web.
</div>
There&#39;s actually rather few issues. They generally crop up when your 
code adds assumptions about being able to access the files that a 
package was loaded from via the file system. OTOH, these things are 
rarely necessary and usually constitute a code stink anyway.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; Patches welcome, the stuff is in myldr/*.c in the PAR::Packer source.
&gt;&gt; You might want to consult the Perl source &#40;mg.c and perl.c in
&gt;&gt; particular&#41; to study the contortions Perl has to go thru to 
&gt;&gt; implement the current behaviour.
</div>&gt; 
&gt; 
&gt;       Thanks! I took a look into it and the behaviour seems as you mentioned.
&gt; But anyway, I think argv and envp behaviour should not be changed in a PAR
&gt; executable &#40;quite critical if you want to access these option in your code&#41;. 
&gt; 
&gt; Of course, it seems this is not something trivial but it is something is impacting 
&gt; perl coding, and if this is not fixed, it should be reflected somewhere.
</div>
Documentation patches welcome.

Cheers,
Steffen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;20&nbsp;06:04:01&nbsp;2009</span>
    <span class="description">mianrojas [...] hotmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #48770] $0 is not working when PAR is used</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 20 Aug 2009 12:03:39 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-par [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Miguel Angel Rojas Gómez &lt;mianrojas [...] hotmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; 
&gt; &gt; Ok, that would mean that PAR a perl file is not really useful if, as
&gt; &gt; you mentioned, because perl code behaviour would change. Unless you 
&gt; &gt; really know which functions/contructions are not affected. 
</div>&gt; 
&gt; You&#39;re being a bit silly here. PAR&#39;s quite useful and employed for 
&gt; deployment of large applications to many tens of thousands of computers 
&gt; worldwide.
</div>

     Please, respect others&#39; opinion as we respect yours ones. You do not need to

insult anybody. I also specify &#34;unless&#34;. If people is using PAR because they are not

impacted by the few issue around you mentioned, that&#39;s excellent!!. That would mean 

PAR is a very good and stable software. Which it does not mean it can not be improved.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Is there a list in which we can take a look at? I think this is something
&gt; &gt; should be stated in the man pages and CPAN PAR web.
</div>&gt; 
&gt; There&#39;s actually rather few issues. They generally crop up when your 
&gt; code adds assumptions about being able to access the files that a 
&gt; package was loaded from via the file system. OTOH, these things are 
&gt; rarely necessary and usually constitute a code stink anyway.
&gt; 
</div>
     As you stated, it seems there are a few issues. If perl code is not using this

construction, PAR will be perfect and it is a great application to deploy and to use.

What I&#39;m saying here is that perl is using for a lot of scripts by managing and parsing

other programs and modifying environment seems to be quite critical for this kind of scripts.

That&#39;s why I consider this bug as important. 

 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Documentation patches welcome.
</div> 

     Thanks for the offering. That&#39;s really the spirit of free code and that&#39;s why I opened this

bug. Unfortunally, I am not pretty sure I have the right skills to modify the source code because

I&#39;m not an expert on PAR source code.

 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Cheers,
&gt; Steffen
&gt; 
</div>

     Thanks for your feedback and quick response.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">_________________________________________________________________
Internet Explorer 8 más sencillo y seguro ¡Descárgatelo gratis!
<span class="clickylink"><a target="new" rel="nofollow" href="http://events.es.msn.com/noticias/internet-explorer-8/">http://events.es.msn.com/noticias/internet-explorer-8/</a></span>
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;20&nbsp;08:29:52&nbsp;2009</span>
    <span class="description">angelos [...] unix.gr -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> par [...] perl.org, jesse+par [...] bestpractical.com</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #48770] $0 is not working when PAR is used</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 20 Aug 2009 15:29:26 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PAR [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Angelos Karageorgiou &lt;angelos [...] unix.gr&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Miguel Angel Rojas Gómez via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt;      Please, respect others&#39; opinion as we respect yours ones. You do not need to
</div>
I do not think that &#34;Silly&#34; was in insult, so do not feel insulted. It 
was just a way to tell you that you are dallying too much into something 
that is a triviality at best. $0 is an OS specific issue that PAR has no 
control over , if you do not believe me find the source code to sendmail
and read the section where it changes its process name to show where the
connection to it is coming from. It would be very enlightening for your 
argument and the list&#39;s sake !
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;20&nbsp;08:37:38&nbsp;2009</span>
    <span class="description">smueller [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #48770] $0 is not working when PAR is used</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 20 Aug 2009 14:37:14 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PAR [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Steffen Mueller &lt;smueller [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

Angelos Karageorgiou via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Miguel Angel Rojas Gómez via RT wrote:
<div class="message-stanza open">&gt;&gt;      Please, respect others&#39; opinion as we respect yours ones. You do not need to
</div>&gt; 
&gt; I do not think that &#34;Silly&#34; was in insult, so do not feel insulted.
</div>
thanks for this clarification. Silly was certainly not intended as an 
insult of any kind.

Cheers,
Steffen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;20&nbsp;08:47:23&nbsp;2009</span>
    <span class="description">RSCHUPP [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Folks, may I humbly remind you that this a bug tracker, not a 
discussion forum. Please use the PAR mailing list &#40;par@perl.org&#41;
for the latter.

Thanx, Roderich
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;26&nbsp;09:38:36&nbsp;2009</span>
    <span class="description">smueller [...] cpan.org -  Severity Wishlist added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;26&nbsp;10:42:31&nbsp;2009</span>
    <span class="description">smueller [...] cpan.org -  Queue changed from PAR to PAR-Packer</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
