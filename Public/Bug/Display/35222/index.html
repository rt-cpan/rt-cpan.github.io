<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #35222 for Text-CSV_XS: Allowing parsing instead of error 2023.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #35222 for Text-CSV_XS: Allowing parsing instead of error 2023.</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Text-CSV_XS/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Text-CSV_XS/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Text-CSV_XS/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Text-CSV_XS/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Text-CSV_XS">Text-CSV_XS CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">35222</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Text-CSV_XS/Active/">Text-CSV_XS</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">HMBRAND [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
mlf-bitcard [...] shoebox.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-31868-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31869-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.45    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;19&nbsp;11:26:28&nbsp;2008</span>
    <span class="description">mlf-bitcard [...] shoebox.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Allowing parsing instead of error 2023.</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Currently, Text::CSV_XS errors on malformed quoting.  For example, the
input:

&#34;foo &#34;bar&#34; baz&#34;,quux

Will cause an error 2023 &#40;which, by the way, the documentation says
there is no repeatable test for, despite the test suite having a test
for it&#41;.

With a minor change &#40;patch attached&#41;, this row can be parsed as:

[&#39;foo &#34;bar&#34; baz&#39;, &#39;quux&#39;]

Granted, the original input is mangled, but it is still parseable.  The
change also allows similarly mangled CSV to be parsed in a predictable
manner.

The change does cause a few test suite failures, mostly for tests that
involve verifying that certain constructs fail to be parsed.  I would
have provided additional fixes for the test suite, but I wanted to get
an idea of how acceptable the patch is.

I can understand not wanting to accept mangled CSV, though it&#39;s hard to
pin down what&#39;s really mangled with such an unspecified format.  In that
case this change could be wrapped in an option check, say if
&#40;csv-&gt;allow_mangled_quotes&#41; { ... }.

I can also understand not wanting to clutter up the code with lots of
checks to handled CSV that probably shouldn&#39;t be handled in the first
place.  However, at this point in the code there would be an error
anyways, and parsing would stop, so it doesn&#39;t greatly affect
performance of the module as a whole.

So, I&#39;m perfectly willing to make additional changes.  I&#39;d just like
some direction before doing so.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 2023.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- CSV_XS.xs~orig	2008-04-15 22:51:24.000000000 -0800
+++ CSV_XS.xs	2008-04-19 07:12:02.000000000 -0800
@@ -876,7 +876,9 @@
 			    }
 			}
 #endif
-		    ERROR_INSIDE_QUOTES &#40;2023&#41;;
+
+                    CSV_PUT_SV&#40;sv, c&#41;;
+                    CSV_PUT_SV&#40;sv, c2&#41;;
 		    }
 		}
 	    else
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;19&nbsp;13:12:00&nbsp;2008</span>
    <span class="description">h.m.brand [...] xs4all.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35222] Allowing parsing instead of error 2023.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 19 Apr 2008 19:11:36 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-CSV_XS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;H.Merijn Brand&#34; &lt;h.m.brand [...] xs4all.nl&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, 19 Apr 2008 11:26:29 -0400, &#34;Michael Fowler via RT&#34;
&lt;bug-Text-CSV_XS@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Currently, Text::CSV_XS errors on malformed quoting.  For example, the
&gt; input:
&gt; 
&gt; &#34;foo &#34;bar&#34; baz&#34;,quux
&gt; 
&gt; Will cause an error 2023 &#40;which, by the way, the documentation says
&gt; there is no repeatable test for, despite the test suite having a test
&gt; for it&#41;.
</div>
Test for that was added in 0.42. I forgot to update the docs. Now done.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; With a minor change &#40;patch attached&#41;, this row can be parsed as:
&gt; 
&gt; [&#39;foo &#34;bar&#34; baz&#39;, &#39;quux&#39;]
</div>
I&#39;ll have a look if that can fall under the &#34;allow_loose_quots&#34;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Granted, the original input is mangled, but it is still parseable.  The
&gt; change also allows similarly mangled CSV to be parsed in a predictable
&gt; manner.
&gt; 
&gt; The change does cause a few test suite failures, mostly for tests that
&gt; involve verifying that certain constructs fail to be parsed.  I would
&gt; have provided additional fixes for the test suite, but I wanted to get
&gt; an idea of how acceptable the patch is.
</div>
Not in the way it is. Just accepting when there is an error is never
acceptable.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I can understand not wanting to accept mangled CSV, though it&#39;s hard to
&gt; pin down what&#39;s really mangled with such an unspecified format.  In that
&gt; case this change could be wrapped in an option check, say if
&gt; &#40;csv-&gt;allow_mangled_quotes&#41; { ... }.
</div>
This, as said, could fall under allow_loose_quotes.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I can also understand not wanting to clutter up the code with lots of
&gt; checks to handled CSV that probably shouldn&#39;t be handled in the first
&gt; place.  However, at this point in the code there would be an error
&gt; anyways, and parsing would stop, so it doesn&#39;t greatly affect
&gt; performance of the module as a whole.
</div>
That is also one of my main points of interest

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So, I&#39;m perfectly willing to make additional changes.  I&#39;d just like
&gt; some direction before doing so.
</div>
The problem with 2023 is that you don&#39;t know if it is a REAL error, like
in

                2023,&#34;,2008-04-05,&#34;Foo, Bar&#34;,\n

or something that could have been meant as correct, like

                &#34;foo&#39;s quote is &#34;, as said&#34;,1,0\n

&#40;try to tell me how that should be parsed without looking at the code&#41;
or as in your case

                &#34;foo &#34;bar&#34; baz&#34;,quux\n

-- 
H.Merijn Brand         Amsterdam Perl Mongers &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://amsterdam.pm.org/&#41;">http://amsterdam.pm.org/&#41;</a></span>
using &#38; porting perl 5.6.2, 5.8.x, 5.10.x  on HP-UX 10.20, 11.00, 11.11,
&#38; 11.23, SuSE 10.1 &#38; 10.2, AIX 5.2, and Cygwin.       <span class="clickylink"><a target="new" rel="nofollow" href="http://qa.perl.org">http://qa.perl.org</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://mirrors.develooper.com/hpux/">http://mirrors.develooper.com/hpux/</a></span>            <span class="clickylink"><a target="new" rel="nofollow" href="http://www.test-smoke.org">http://www.test-smoke.org</a></span>
                        <span class="clickylink"><a target="new" rel="nofollow" href="http://www.goldmark.org/jeff/stupid-disclaimers/">http://www.goldmark.org/jeff/stupid-disclaimers/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;19&nbsp;13:12:02&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;20&nbsp;17:08:08&nbsp;2008</span>
    <span class="description">mlf-bitcard [...] shoebox.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mlf-bitcard [...] shoebox.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Apr 19 13:12:00 2008, h.m.brand@xs4all.nl wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sat, 19 Apr 2008 11:26:29 -0400, &#34;Michael Fowler via RT&#34;
&gt; &lt;bug-Text-CSV_XS@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt; &gt; but I wanted to get an idea of how acceptable the patch is.
</div>&gt; 
&gt; Not in the way it is. Just accepting when there is an error is never
&gt; acceptable.
</div>
There should be some room for accepting invalid input and getting a
result that can be corrected.  As it is now parsing simply stops, and if
the user wants to recover a row they essentially have to manually parse
$csv-&gt;error_input and any followup data in the row.

The original input that spawned this was something along the lines of:

&#34;foo &#34;bar baz&#34; quux&#34;,something,something,&#34;Additional data\r\nwith
newlines\r\nand possibly other characters that require binary =&gt; 1&#34;

When Text::CSV_XS stops parsing the row it does so on the first line;
the rest remain in the input.  With the modification the row is actually
parsed as it was intended, though this will probably not always be the case.

I can think of no simple, automated way of correcting the input that
doesn&#39;t involve completely reinventing a CSV parser.  Piggy-backing this
error-correction on top of allow_loose_quotes is certainly an option,
but it seems to me this input is more severely mangled than the input
that allow_loose_quotes parses, and thus deserves a separate option.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; So, I&#39;m perfectly willing to make additional changes.  I&#39;d just like
&gt; &gt; some direction before doing so.
</div>&gt; 
&gt; The problem with 2023 is that you don&#39;t know if it is a REAL error, like
&gt; in
</div>
I would venture to say that anything the 2023 error catches is a real
error; it can also be a more ambiguous error than what I&#39;ve presented so
far.  For example, with a parser set to binary =&gt; 1:

something,&#34;foo &#34;bar\r\nbaz&#34; quux&#34;,something\r\n

This could either be taken as two rows, each with two columns, or one
row with four columns.  The intent is ambiguous, and normally this sort
of thing should result in an error, with the parser simply stopping. 
However, it can be useful to attempt to make sense of the input
regardless, and return back some result, that the user can recover.

In my opinion the simplest and most robust change would be to add a new
option, check that option where error 2023 is used; if that option is
set, attempt to correct, if not, error as normal.  The majority of CSV
parses would not be affected greatly, either in terms of performance, or
at all in terms of how the CSV is parsed.

Something a little more elaborate would involve doing the above, but
marking the row as &#34;dirty&#34; or ambiguous in some way.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;21&nbsp;02:27:34&nbsp;2008</span>
    <span class="description">h.m.brand [...] xs4all.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35222] Allowing parsing instead of error 2023.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 21 Apr 2008 08:27:14 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-CSV_XS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;H.Merijn Brand&#34; &lt;h.m.brand [...] xs4all.nl&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">As this optionally new allow_something flag would only trigger on 2023,
it will not likely influence performance much.  There will be a minimal
hit though, because it has to cache its value.

As the situation here, is clearly some serious error,  the name of this
new parameter should be very clear in that this is accepting bad input,
and possible results may be &#40;very&#41; broken.

Also note that, in the case you present, the error being hit depends on
the definition of escape_char. If I set that to undef, you will get

   # CSV_XS ERROR: 2011 - ECR - Characters after end of quoted field

even when allow_loose_quotes is on.  I seriously doubt if fixing adding
a new option will make you happy. If you want to continue after errors,
maybe you should use eval.

-- 
H.Merijn Brand         Amsterdam Perl Mongers &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://amsterdam.pm.org/&#41;">http://amsterdam.pm.org/&#41;</a></span>
using &#38; porting perl 5.6.2, 5.8.x, 5.10.x  on HP-UX 10.20, 11.00, 11.11,
&#38; 11.23, SuSE 10.1 &#38; 10.2, AIX 5.2, and Cygwin.       <span class="clickylink"><a target="new" rel="nofollow" href="http://qa.perl.org">http://qa.perl.org</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://mirrors.develooper.com/hpux/">http://mirrors.develooper.com/hpux/</a></span>            <span class="clickylink"><a target="new" rel="nofollow" href="http://www.test-smoke.org">http://www.test-smoke.org</a></span>
                        <span class="clickylink"><a target="new" rel="nofollow" href="http://www.goldmark.org/jeff/stupid-disclaimers/">http://www.goldmark.org/jeff/stupid-disclaimers/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;21&nbsp;18:39:27&nbsp;2008</span>
    <span class="description">HMBRAND [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Should work in 0.43 with this:

my $csv = Text::CSV_XS-&gt;new &#40;{ allow_loose_quotes =&gt; 1, escape_char =&gt; 
undef }&#41;;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;21&nbsp;18:39:29&nbsp;2008</span>
    <span class="description">HMBRAND [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;22&nbsp;00:02:27&nbsp;2008</span>
    <span class="description">mlf-bitcard [...] shoebox.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mlf-bitcard [...] shoebox.net</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Apr 21 02:27:34 2008, h.m.brand@xs4all.nl wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Also note that, in the case you present, the error being hit depends on
&gt; the definition of escape_char. If I set that to undef, you will get
&gt; 
&gt;    # CSV_XS ERROR: 2011 - ECR - Characters after end of quoted field
&gt; 
&gt; even when allow_loose_quotes is on.  I seriously doubt if fixing adding
&gt; a new option will make you happy. If you want to continue after errors,
&gt; maybe you should use eval.
&gt; 
</div>
When I talk about error recovery I meant being able to continue parsing
the badly formed CSV data.  There is no fatal exception involved.

Your escape_char fix &#40;mentioned in another email&#41; is certainly an
option, but I&#39;m afraid it doesn&#39;t really solve this situation.  The
problem is the CSV is otherwise well-formed, except for a few rows with
rogue quotes.  The other rows have escaped quotes in them, and it would
be preferable for that escaping to be handled properly.

I have attached a patch that adds an &#39;allow_bad_quoting&#39; option, along
with attendant tests and documentation &#40;it&#39;s a -p1 patch, I believe&#41;. 
It&#39;s what I was thinking of from the beginning, though I&#39;m thinking
there is a more general solution to the problem of error recovery so
that the entire input can be parsed even with various malformed
elements.  I&#39;ll have to put more thought into it.

To be quite honest, the patch doesn&#39;t solve any problems I&#39;m currently
having.  I do, however, very much like Text::CSV_XS; it is very fast and
robust.  I think my patch makes it a little more robust and flexible in
terms of parsing bad CSV, and would like to see it applied in some form.
 Please, let me know if there&#39;s anything more I can do.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -urN Text-CSV_XS-0.42~orig/CSV_XS.pm Text-CSV_XS-0.42/CSV_XS.pm
--- Text-CSV_XS-0.42~orig/CSV_XS.pm	2008-04-16 05:11:51.000000000 -0800
+++ Text-CSV_XS-0.42/CSV_XS.pm	2008-04-21 19:25:55.000000000 -0800
@@ -63,6 +63,7 @@
     allow_loose_quotes	=&gt; 0,
     allow_loose_escapes	=&gt; 0,
     allow_whitespace	=&gt; 0,
+    allow_bad_quoting   =&gt; 0,
     blank_is_undef	=&gt; 0,
     verbatim		=&gt; 0,
     types		=&gt; undef,
@@ -110,6 +111,7 @@
     allow_loose_escapes	=&gt;  7,
     allow_double_quoted	=&gt;  8,
     allow_whitespace	=&gt;  9,
+    allow_bad_quoting   =&gt; 24,
     blank_is_undef	=&gt; 10,
 
     eol			=&gt; 11,	# 11 .. 18
@@ -217,6 +219,13 @@
     $self-&gt;{allow_whitespace};
     } # allow_whitespace
 
+sub allow_bad_quoting
+{
+    my $self = shift;
+    @_ and $self-&gt;_set_attr &#40;&#34;allow_bad_quoting&#34;, shift&#41;;
+    $self-&gt;{allow_bad_quoting};
+    } # allow_bad_quoting
+
 sub blank_is_undef
 {
     my $self = shift;
@@ -724,6 +733,25 @@
 allow this format, we cannot help there are some vendors that make
 their applications spit out lines styled like this.
 
+=item allow_bad_quoting
+
+By default, C&lt;quote_char&gt; characters in a field are strictly parsed.  Any
+non-escaped quote character causes the parser to simply fail.  Turning this
+option on will allow the parser to attempt to correct by bumping past the
+offending quote character.  For example, normally:
+
+ 1,&#34;foo &#34;bar&#34; baz&#34;,42
+
+Would result in a parse error &#40;2023&#41;.  With allow_bad_quoting this will parse
+into three fields:
+
+ &#40;&#34;1&#34;, &#39;foo &#34;bar&#34; baz&#39;, &#34;42&#34;&#41;
+
+Keep in mind, this behaviour is fragile, and is to only be used as a last
+resort to recover from badly formed CSV.  If you use this option be very
+careful to verify the results you get are what you intended; if at all
+possible, correct the original CSV data and avoid this option.
+
 =item escape_char
 
 The character used for escaping certain characters inside quoted fields.
@@ -837,6 +865,7 @@
      allow_loose_quotes  =&gt; 0,
      allow_loose_escapes =&gt; 0,
      allow_whitespace    =&gt; 0,
+     allow_bad_quoting   =&gt; 0,
      blank_is_undef      =&gt; 0,
      verbatim            =&gt; 0,
      }&#41;;
diff -urN Text-CSV_XS-0.42~orig/CSV_XS.xs Text-CSV_XS-0.42/CSV_XS.xs
--- Text-CSV_XS-0.42~orig/CSV_XS.xs	2008-04-15 22:51:24.000000000 -0800
+++ Text-CSV_XS-0.42/CSV_XS.xs	2008-04-21 19:35:15.000000000 -0800
@@ -34,6 +34,7 @@
 #define CACHE_ID_allow_loose_escapes	7
 #define CACHE_ID_allow_double_quoted	8
 #define CACHE_ID_allow_whitespace	9
+#define CACHE_ID_allow_bad_quoting      24
 #define CACHE_ID_blank_is_undef		10
 #define CACHE_ID_eol			11
 #define CACHE_ID_eol_len		19
@@ -83,6 +84,7 @@
     byte	 allow_loose_escapes;
     byte	 allow_double_quoted;
     byte	 allow_whitespace;
+    byte         allow_bad_quoting;
 
     byte	 blank_is_undef;
     byte	 verbatim;
@@ -209,6 +211,7 @@
 	csv-&gt;allow_loose_escapes	= csv-&gt;cache[CACHE_ID_allow_loose_escapes];
 	csv-&gt;allow_double_quoted	= csv-&gt;cache[CACHE_ID_allow_double_quoted];
 	csv-&gt;allow_whitespace		= csv-&gt;cache[CACHE_ID_allow_whitespace	];
+        csv-&gt;allow_bad_quoting          = csv-&gt;cache[CACHE_ID_allow_bad_quoting ];
 	csv-&gt;blank_is_undef		= csv-&gt;cache[CACHE_ID_blank_is_undef	];
 	csv-&gt;verbatim			= csv-&gt;cache[CACHE_ID_verbatim		];
 #endif
@@ -286,6 +289,7 @@
 	csv-&gt;allow_loose_escapes	= bool_opt &#40;&#34;allow_loose_escapes&#34;&#41;;
 	csv-&gt;allow_double_quoted	= bool_opt &#40;&#34;allow_double_quoted&#34;&#41;;
 	csv-&gt;allow_whitespace		= bool_opt &#40;&#34;allow_whitespace&#34;&#41;;
+        csv-&gt;allow_bad_quoting          = bool_opt &#40;&#34;allow_bad_quoting&#34;&#41;;
 	csv-&gt;blank_is_undef		= bool_opt &#40;&#34;blank_is_undef&#34;&#41;;
 	csv-&gt;verbatim			= bool_opt &#40;&#34;verbatim&#34;&#41;;
 #endif
@@ -303,6 +307,7 @@
 	csv-&gt;cache[CACHE_ID_allow_loose_escapes]	= csv-&gt;allow_loose_escapes;
 	csv-&gt;cache[CACHE_ID_allow_double_quoted]	= csv-&gt;allow_double_quoted;
 	csv-&gt;cache[CACHE_ID_allow_whitespace]		= csv-&gt;allow_whitespace;
+        csv-&gt;cache[CACHE_ID_allow_bad_quoting]          = csv-&gt;allow_bad_quoting;
 	csv-&gt;cache[CACHE_ID_blank_is_undef]		= csv-&gt;blank_is_undef;
 	csv-&gt;cache[CACHE_ID_verbatim]			= csv-&gt;verbatim;
 #endif
@@ -875,9 +880,18 @@
 /* uncovered */		    goto restart;
 			    }
 			}
-#endif
-		    ERROR_INSIDE_QUOTES &#40;2023&#41;;
+
+                    if &#40;csv-&gt;allow_bad_quoting&#41; {
+                        CSV_PUT_SV&#40;sv, c&#41;;
+                        CSV_PUT_SV&#40;sv, c2&#41;;
+                        }
+                    else {
+                        ERROR_INSIDE_QUOTES &#40;2023&#41;;
+                        }
 		    }
+#else
+                ERROR_INSIDE_QUOTES &#40;2023&#41;;
+#endif
 		}
 	    else
 	    /* !waitingForField, !InsideQuotes */
Binary files Text-CSV_XS-0.42~orig/.CSV_XS.xs.swp and Text-CSV_XS-0.42/.CSV_XS.xs.swp differ
diff -urN Text-CSV_XS-0.42~orig/t/12_acc.t Text-CSV_XS-0.42/t/12_acc.t
--- Text-CSV_XS-0.42~orig/t/12_acc.t	2008-02-25 23:24:40.000000000 -0900
+++ Text-CSV_XS-0.42/t/12_acc.t	2008-04-21 19:51:40.000000000 -0800
@@ -3,7 +3,7 @@
 use strict;
 $^W = 1;	# use warnings core since 5.6
 
-use Test::More tests =&gt; 44;
+use Test::More tests =&gt; 46;
 
 BEGIN {
     use_ok &#34;Text::CSV_XS&#34;;
@@ -23,6 +23,7 @@
 is &#40;$csv-&gt;allow_loose_quotes,		0,		&#34;allow_loose_quotes&#34;&#41;;
 is &#40;$csv-&gt;allow_loose_escapes,		0,		&#34;allow_loose_escapes&#34;&#41;;
 is &#40;$csv-&gt;allow_whitespace,		0,		&#34;allow_whitespace&#34;&#41;;
+is &#40;$csv-&gt;allow_bad_quoting,            0,              &#34;allow_bad_quoting&#34;&#41;;
 is &#40;$csv-&gt;blank_is_undef,		0,		&#34;blank_is_undef&#34;&#41;;
 is &#40;$csv-&gt;verbatim,			0,		&#34;verbatim&#34;&#41;;
 
@@ -40,6 +41,7 @@
 is &#40;$csv-&gt;allow_loose_quotes &#40;1&#41;,	1,		&#34;allow_loose_quotes &#40;1&#41;&#34;&#41;;
 is &#40;$csv-&gt;allow_loose_escapes &#40;1&#41;,	1,		&#34;allow_loose_escapes &#40;1&#41;&#34;&#41;;
 is &#40;$csv-&gt;allow_whitespace &#40;1&#41;,		1,		&#34;allow_whitespace &#40;1&#41;&#34;&#41;;
+is &#40;$csv-&gt;allow_bad_quoting &#40;1&#41;,        1,              &#34;allow_bad_quoting &#40;1&#41;&#34;&#41;;
 is &#40;$csv-&gt;blank_is_undef &#40;1&#41;,		1,		&#34;blank_is_undef &#40;1&#41;&#34;&#41;;
 is &#40;$csv-&gt;verbatim &#40;1&#41;,			1,		&#34;verbatim &#40;1&#41;&#34;&#41;;
 is &#40;$csv-&gt;escape_char &#40;&#34;\\&#34;&#41;,		&#34;\\&#34;,		&#34;escape_char &#40;\\&#41;&#34;&#41;;
diff -urN Text-CSV_XS-0.42~orig/t/65_allow.t Text-CSV_XS-0.42/t/65_allow.t
--- Text-CSV_XS-0.42~orig/t/65_allow.t	2008-04-05 14:02:10.000000000 -0800
+++ Text-CSV_XS-0.42/t/65_allow.t	2008-04-21 19:49:25.000000000 -0800
@@ -4,7 +4,7 @@
 $^W = 1;
 
 #use Test::More &#34;no_plan&#34;;
- use Test::More tests =&gt; 803;
+ use Test::More tests =&gt; 828;
 
 BEGIN {
     use_ok &#34;Text::CSV_XS&#34;, &#40;&#41;;
@@ -153,6 +153,30 @@
 	}
     }
 
+ok &#40;1, &#34;Allow bad quoting&#34;&#41;;
+# Allow unescaped quotes inside a quoted field
+{   my @bad = &#40;
+	# valid, line
+	[ 1, 1, qq{foo,bar,&#34;quux&#34;,quux},				],
+	[ 2, 0, qq{rj,bs,&#34;r&#34;jb&#34;s&#34;,rjbs},				],
+	[ 3, 0, qq{&#34;some &#34;spaced&#34; quote data&#34;,2,3,4},			],
+        [ 4, 0, qq{&#34;a lone &#34; quote&#34;,foo,bar}                            ],
+	[ 5, 1, qq{and an,entirely,quoted,&#34;field&#34;},			],
+	[ 6, 1, qq{and then,&#34;one with &#34;&#34;quoted&#34;&#34; quotes&#34;,okay,?},	],
+	&#41;;
+
+    for &#40;@bad&#41; {
+	my &#40;$tst, $valid, $bad&#41; = @$_;
+	$csv = Text::CSV_XS-&gt;new &#40;&#41;;
+	ok &#40;$csv,			&#34;$tst - new &#40;alq =&gt; 0&#41;&#34;&#41;;
+	is &#40;$csv-&gt;parse &#40;$bad&#41;, $valid,	&#34;$tst - parse &#40;&#41; fail&#34;&#41;;
+
+	$csv-&gt;allow_bad_quoting &#40;1&#41;;
+	ok &#40;$csv-&gt;parse &#40;$bad&#41;,		&#34;$tst - parse &#40;&#41; pass&#34;&#41;;
+	ok &#40;my @f = $csv-&gt;fields,	&#34;$tst - fields&#34;&#41;;
+	}
+    }
+
 ok &#40;1, &#34;blank_is_undef&#34;&#41;;
 foreach my $conf &#40;
 	[ 0, 0, 0,	1, &#34;&#34;,    &#34; &#34;, &#39;&#34;&#34;&#39;, 2, &#34;&#34;,    &#34;&#34;,    &#34;&#34;	],
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;22&nbsp;00:02:35&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;23&nbsp;04:36:13&nbsp;2008</span>
    <span class="description">h.m.brand [...] xs4all.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35222] Allowing parsing instead of error 2023.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 23 Apr 2008 10:35:42 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-CSV_XS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;H.Merijn Brand&#34; &lt;h.m.brand [...] xs4all.nl&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, 22 Apr 2008 00:02:36 -0400, &#34;Michael Fowler via RT&#34;
&lt;bug-Text-CSV_XS@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; When I talk about error recovery I meant being able to continue parsing
&gt; the badly formed CSV data.  There is no fatal exception involved.
</div>
Text::CSV_XS does not die or croak when parsing. it returns a false
state from parse &#40;&#41; or getline &#40;&#41;. Text::CSV_XS also does not close the
handle of it&#39;s input, so there is nothing stopping you from doing the
right thing &#40;TM&#41; when running into problems. What was scanned is
available in $csv-&gt;error_input &#40;&#41;, and you could easily add the rest of
the line &#40;if available&#41; to that and use whatever method you like to
`fix&#39; or analyze that particular problem. the values returned by
$csv-&gt;error_diag &#40;&#41; might be of some help.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Your escape_char fix &#40;mentioned in another email&#41; is certainly an
&gt; option, but I&#39;m afraid it doesn&#39;t really solve this situation.
</div>
Why not? If that doesn&#39;t address the original problem you stated, your
line is probably beyond automatic parsing, and needs some human eyes to
detect the problem. Note again that in many cases, with the default
setting for quote_char and escape_char, there is no way to see if the
&#34; is meant as a quote or as an escape. That is why my suggested
solution addresses all the automatable problems only when these two
differ.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The problem is the CSV is otherwise well-formed, except for a few rows
&gt; with rogue quotes.  The other rows have escaped quotes in them, and it
&gt; would be preferable for that escaping to be handled properly.
&gt; 
&gt; I have attached a patch that adds an &#39;allow_bad_quoting&#39; option, along
&gt; with attendant tests and documentation &#40;it&#39;s a -p1 patch, I believe&#41;.
</div>
However I value your work, I won&#39;t go that way. Once the state is
beyond what I support now, I am in the opinion that it should be
handled by the parent.

If you expect bad lines, use some protection. However I promote the
getline &#40;&#41; calls over some personalized &#39;while &#40;&lt;&gt;&#41; {&#39; + &#39;parse &#40;&#41;&#39;,
going that way will provide you with all you need to `catch&#39; bad lines
and deal with those appropriately.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It&#39;s what I was thinking of from the beginning, though I&#39;m thinking
&gt; there is a more general solution to the problem of error recovery so
&gt; that the entire input can be parsed even with various malformed
&gt; elements.  I&#39;ll have to put more thought into it.
</div>
again, the bogus parsed line is available in $csv-&gt;error_input &#40;&#41;.
Though that part is not extensively tested &#40;I have no idea what happens
if those lines are very very long&#41;, it is a very good starting point.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; To be quite honest, the patch doesn&#39;t solve any problems I&#39;m currently
&gt; having.  I do, however, very much like Text::CSV_XS; it is very fast and
&gt; robust.
</div>
I like to keep it that way, and allowing anything that is not &#40;easy&#41;
controllable will put great pressure on the code.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think my patch makes it a little more robust and flexible in
&gt; terms of parsing bad CSV,
</div>
Flexible, yes, robust no.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; and would like to see it applied in some form.
&gt; Please, let me know if there&#39;s anything more I can do.
</div>
Sorry to disappoint you, but you have not convinced me. The more I
think about it, the less I like the idea. And if you notice the delay
in this reply, I think about it a lot lately.

-- 
H.Merijn Brand         Amsterdam Perl Mongers &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://amsterdam.pm.org/&#41;">http://amsterdam.pm.org/&#41;</a></span>
using &#38; porting perl 5.6.2, 5.8.x, 5.10.x  on HP-UX 10.20, 11.00, 11.11,
&#38; 11.23, SuSE 10.1 &#38; 10.2, AIX 5.2, and Cygwin.       <span class="clickylink"><a target="new" rel="nofollow" href="http://qa.perl.org">http://qa.perl.org</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://mirrors.develooper.com/hpux/">http://mirrors.develooper.com/hpux/</a></span>            <span class="clickylink"><a target="new" rel="nofollow" href="http://www.test-smoke.org">http://www.test-smoke.org</a></span>
                        <span class="clickylink"><a target="new" rel="nofollow" href="http://www.goldmark.org/jeff/stupid-disclaimers/">http://www.goldmark.org/jeff/stupid-disclaimers/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;23&nbsp;06:10:48&nbsp;2008</span>
    <span class="description">h.m.brand [...] xs4all.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35222] Allowing parsing instead of error 2023.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 23 Apr 2008 12:10:21 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-CSV_XS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;H.Merijn Brand&#34; &lt;h.m.brand [...] xs4all.nl&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, 23 Apr 2008 04:36:14 -0400, &#34;h.m.brand@xs4all.nl via RT&#34;
&lt;bug-Text-CSV_XS@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; It&#39;s what I was thinking of from the beginning, though I&#39;m thinking
&gt; &gt; there is a more general solution to the problem of error recovery so
&gt; &gt; that the entire input can be parsed even with various malformed
&gt; &gt; elements.  I&#39;ll have to put more thought into it.  
</div>&gt; 
&gt; again, the bogus parsed line is available in $csv-&gt;error_input &#40;&#41;.
&gt; Though that part is not extensively tested &#40;I have no idea what happens
&gt; if those lines are very very long&#41;, it is a very good starting point.
</div>
I just did some tests with long lines &#40;over 128k each&#41; and the complete
line is in the return value of $csv-&gt;error_input &#40;&#41;.

In the upcoming 0.44, I fixed the position in the 3rd return value of
$csv-&gt;error_diag &#40;&#41;. See examples/csv-check to see how to exactly
reproduce the point of failure.

I&#39;ve used that example script to check *all* the CSV files on my PC,
and indeed found some erroneous files. Oh joy!

As above tests prove that no information is lost at all, I&#39;m confident
in that this new option is not needed.

-- 
H.Merijn Brand         Amsterdam Perl Mongers &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://amsterdam.pm.org/&#41;">http://amsterdam.pm.org/&#41;</a></span>
using &#38; porting perl 5.6.2, 5.8.x, 5.10.x  on HP-UX 10.20, 11.00, 11.11,
&#38; 11.23, SuSE 10.1 &#38; 10.2, AIX 5.2, and Cygwin.       <span class="clickylink"><a target="new" rel="nofollow" href="http://qa.perl.org">http://qa.perl.org</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://mirrors.develooper.com/hpux/">http://mirrors.develooper.com/hpux/</a></span>            <span class="clickylink"><a target="new" rel="nofollow" href="http://www.test-smoke.org">http://www.test-smoke.org</a></span>
                        <span class="clickylink"><a target="new" rel="nofollow" href="http://www.goldmark.org/jeff/stupid-disclaimers/">http://www.goldmark.org/jeff/stupid-disclaimers/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;23&nbsp;06:27:45&nbsp;2008</span>
    <span class="description">mlf-bitcard [...] shoebox.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mlf-bitcard [...] shoebox.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Yes, I had considered using $csv-&gt;error_input to recover from the bad
input, but there was no reliable way of doing this.  The actual row in
the data file is difficult to reproduce reliably here, but here is a
more complete example:

&#34;Etablissements Delhaize Freres et Cie &#34;Le Lion&#34;
S.A.&#34;,&#34;DEG&#34;,&#34;$827.4&#34;,&#34;paragraph\r\nparagraph\r\nparagraph\r\n&#34;

The paragraphs were much longer, and could contain escaped quotes,
delimiters, etc.  Text::CSV_XS stops parsing on the first line, giving
an error_input value of:

&#39;&#34;Etablissements Delhaize Freres et Cie &#34;Le Lion&#34;
S.A.&#34;,&#34;DEG&#34;,&#34;$827.4&#34;,&#34;paragraph\r\n&#39;

At this point, I cannot programmatically determine where the parser is
in the text, how many further lines to read, how many lines have been
read, etc.  Text::CSV_XS is much more suited to determining when this
record ends; doing so myself would require essentially re-implementing a
CSV parser.

The other solution I had considered was to somehow &#34;push back&#34; the
error_input value, after correcting it, so that the parser would try to
parse it from the beginning.  This is certainly an option, but I
initially discarded it because it would involve getline&#40;&#41; checking first
a buffer to see if there was a push-back value, then attempting to read
the file.  This sounded like a bad solution because it would affect all
parses, on every getline&#40;&#41; call.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Your escape_char fix &#40;mentioned in another email&#41; is certainly an
&gt; &gt; option, but I&#39;m afraid it doesn&#39;t really solve this situation.
</div>&gt; 
&gt; Why not? If that doesn&#39;t address the original problem you stated, your
&gt; line is probably beyond automatic parsing, and needs some human eyes to
&gt; detect the problem.
</div>
It doesn&#39;t solve the situation because there are escaped quotes in the
input.  The patch I gave you causes the file to be parsed as the
original provider intended, so it is indeed possible to automatically
parse it.

It might help to have the original input file.  You can find it at
<span class="clickylink"><a target="new" rel="nofollow" href="http://p3m.org/code/Text-CSV_XS/symbols.csv">http://p3m.org/code/Text-CSV_XS/symbols.csv</a></span> .  The source is the NASDAQ
website, the original URL for this data is
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.nasdaq.com//asp/symbols.asp?exchange=N&#38;start=0">http://www.nasdaq.com//asp/symbols.asp?exchange=N&#38;start=0</a></span> .



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I like to keep it that way, and allowing anything that is not &#40;easy&#41;
&gt; controllable will put great pressure on the code.
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Flexible, yes, robust no.
</div>
The code is more robust for being able to handle erroneous input, and I
don&#39;t really understand what kind of pressure this puts on it.

If you don&#39;t like the changes, fine.  I&#39;m not particularly interested in
pursuing it any longer.  I think it would be beneficial to have a fast
CSV parser that is capable of dealing with poorly formed CSV in a
recoverable manner.  I think this is a step towards that goal.  If you
do not agree, or you do not wish to make it such a parser, that is your
prerogative; it is your code.

I will not bother you any longer with these ideas.  Good luck.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;23&nbsp;07:04:02&nbsp;2008</span>
    <span class="description">h.m.brand [...] xs4all.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35222] Allowing parsing instead of error 2023.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 23 Apr 2008 13:03:35 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-CSV_XS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;H.Merijn Brand&#34; &lt;h.m.brand [...] xs4all.nl&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, 23 Apr 2008 06:27:47 -0400, &#34;Michael Fowler via RT&#34;
&lt;bug-Text-CSV_XS@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Yes, I had considered using $csv-&gt;error_input to recover from the bad
&gt; input, but there was no reliable way of doing this. The actual row in
&gt; the data file is difficult to reproduce reliably here, but here is a
&gt; more complete example:
&gt; [snip]
&gt; At this point, I cannot programmatically determine where the parser is
&gt; in the text, how many further lines to read, how many lines have been
&gt; read, etc.
</div>
Neither can the parser of Text::CSV_XS, as it cannot tell if any EOL is
part of a quoted field or the separator to a new line.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Text::CSV_XS is much more suited to determining when this record ends;
&gt; doing so myself would require essentially re-implementing a CSV parser.
</div>
Or just continue after the error, hoping Text::CSV_XS&#39; parser will do
the right thing &#40;TM&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The other solution I had considered was to somehow &#34;push back&#34; the
&gt; error_input value, after correcting it, so that the parser would try to
&gt; parse it from the beginning.  This is certainly an option, but I
&gt; initially discarded it because it would involve getline&#40;&#41; checking first
&gt; a buffer to see if there was a push-back value, then attempting to read
&gt; the file.  This sounded like a bad solution because it would affect all
&gt; parses, on every getline &#40;&#41; call.
</div>
A modified parser could be something like this:
--8&lt;---
use strict;
use warnings;

use Text::CSV_XS;

my $csv = Text::CSV_XS-&gt;new &#40;{ binary =&gt; 1 }&#41;;

my $file = &#34;symbols.csv&#34;;
open my $fh, &#34;&lt;&#34;, $file or die &#34;$file: $!\n&#34;;

while &#40;1&#41; {
    my $row = $csv-&gt;getline &#40;$fh&#41;;

    unless &#40;$row&#41; {
        $csv-&gt;eof and last;

        my @diag = $csv-&gt;error_diag;
        print STDERR &#34;$file line $./$diag[2] - $diag[0] - $diag[1]\n&#34;;
        my $ep  = $diag[2] - 1; # diag[2] is 1-based
        my $err = $csv-&gt;error_input . &#34;         &#34;;
        substr $err, $ep + 1, 0, &#34;*&#34;;
        substr $err, $ep,     0, &#34;*&#34;;
        &#40;$err = substr $err, $ep - 5, 12&#41; =~ s/ +$//;
        print &#34;    |$err|\n&#34;;
        next;
        }

    # Data was fine, do something with $row
    }
--&gt;8---

If you pass me your real e-mail, I can sent you the formatted code, as
RT probably ruined the layout here.

If you want to parse the erroneous lines with other options, you just
create a second csv object with more lenient options, and pass it
$csv-&gt;error_input

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It might help to have the original input file.  You can find it at
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://p3m.org/code/Text-CSV_XS/symbols.csv">http://p3m.org/code/Text-CSV_XS/symbols.csv</a></span> .  The source is the NASDAQ
&gt; website, the original URL for this data is
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.nasdaq.com//asp/symbols.asp?exchange=N&#38;start=0">http://www.nasdaq.com//asp/symbols.asp?exchange=N&#38;start=0</a></span> .
</div>
Text-CSV_XS 155 &gt; perl -Iblib/{lib.arch} examples/csv-check symbols.csv
Cecked with Text::CSV_XS 0.43
symbols.csv line 10918/40 - 2023 - EIQ - QUO character not allowed
    | Cie *&#34;*Le L|
Exit 231

With the snippet from above:

Text-CSV_XS 158 &gt; perl -Iblib/{lib.arch} symbols.pl
symbols.csv line 10918/40 - 2023 - EIQ - QUO character not allowed
    | Cie *&#34;*Le L|
symbols.csv line 10932/43 - 2034 - EIF - Loose unescaped quote
    |re...*&#34;*&#34;htt|
symbols.csv line 22046/27 - 2023 - EIQ - QUO character not allowed
    |pany *&#34;*Vimp|
symbols.csv line 22058/85 - 2034 - EIF - Loose unescaped quote
    |re...*&#34;*&#34;htt|

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; I like to keep it that way, and allowing anything that is not &#40;easy&#41;
&gt; &gt; controllable will put great pressure on the code.
</div>&gt; 
<div class="message-stanza open">&gt; &gt; Flexible, yes, robust no.
</div>&gt; 
&gt; The code is more robust for being able to handle erroneous input, and I
&gt; don&#39;t really understand what kind of pressure this puts on it.
</div>
I hope to meet you in a YAPC::Europe event or something similar, so I
can guide you through the code and show you the pitfalls I hit myself
when trying to make the code maintainable. And even now, I guess many
other maintainers might argue that it is maintainable by now.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If you don&#39;t like the changes, fine.  I&#39;m not particularly interested in
&gt; pursuing it any longer.  I think it would be beneficial to have a fast
&gt; CSV parser that is capable of dealing with poorly formed CSV in a
&gt; recoverable manner.
</div>
So do I, but I think I already showed that it is already that way.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think this is a step towards that goal. If you do not agree, or you do
&gt; not wish to make it such a parser,
</div>
It already *is* such a parser, You just need to see how you can use
it&#39;s powers without modifying the internals

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; that is your prerogative; it is your code.
</div>
By now it is, but when I took over, there was a lot to fix.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I will not bother you any longer with these ideas.  Good luck.
</div>
Your tone strikes me as if I insulted you. That is not the case. I
value your thoughts and your input, but not the proposed fix. Please
tell me where or how my above approach fails to attack your problem.

-- 
H.Merijn Brand         Amsterdam Perl Mongers &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://amsterdam.pm.org/&#41;">http://amsterdam.pm.org/&#41;</a></span>
using &#38; porting perl 5.6.2, 5.8.x, 5.10.x  on HP-UX 10.20, 11.00, 11.11,
&#38; 11.23, SuSE 10.1 &#38; 10.2, AIX 5.2, and Cygwin.       <span class="clickylink"><a target="new" rel="nofollow" href="http://qa.perl.org">http://qa.perl.org</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://mirrors.develooper.com/hpux/">http://mirrors.develooper.com/hpux/</a></span>            <span class="clickylink"><a target="new" rel="nofollow" href="http://www.test-smoke.org">http://www.test-smoke.org</a></span>
                        <span class="clickylink"><a target="new" rel="nofollow" href="http://www.goldmark.org/jeff/stupid-disclaimers/">http://www.goldmark.org/jeff/stupid-disclaimers/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;23&nbsp;07:40:01&nbsp;2008</span>
    <span class="description">h.m.brand [...] xs4all.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35222] Allowing parsing instead of error 2023.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 23 Apr 2008 13:39:34 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-CSV_XS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;H.Merijn Brand&#34; &lt;h.m.brand [...] xs4all.nl&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, 23 Apr 2008 06:27:47 -0400, &#34;Michael Fowler via RT&#34;
&lt;bug-Text-CSV_XS@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It might help to have the original input file.  You can find it at
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://p3m.org/code/Text-CSV_XS/symbols.csv">http://p3m.org/code/Text-CSV_XS/symbols.csv</a></span> .  The source is the NASDAQ
&gt; website, the original URL for this data is
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.nasdaq.com//asp/symbols.asp?exchange=N&#38;start=0">http://www.nasdaq.com//asp/symbols.asp?exchange=N&#38;start=0</a></span> .
</div>
Get the latest snapshot here:
<span class="clickylink"><a target="new" rel="nofollow" href="http://repo.or.cz/w/Text-CSV_XS.git?a=snapshot;sf=tgz">http://repo.or.cz/w/Text-CSV_XS.git?a=snapshot;sf=tgz</a></span>

Get the parse script here:
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.xs4all.nl/~hmbrand/symbols.pl">http://www.xs4all.nl/~hmbrand/symbols.pl</a></span>

Run it:

Text-CSV_XS 181 &gt; perl -Iblib/{lib,arch} tmp/symbols.pl tmp/symbols.csv
Reading tmp/symbols.csv with Text::CSV_XS 0.44
tmp/symbols.csv line 10918/40 - 2023 - EIQ - QUO character not allowed
    | Cie *&#34;*Le L|
  Extending line with next chunk
  Extending line with next chunk
  Extending line with next chunk
  Extending line with next chunk
  Extending line with next chunk
  Extending line with next chunk
  Extending line with next chunk
  Extending line with next chunk
  Extending line with next chunk
  Extending line with next chunk
  Extending line with next chunk
  Extending line with next chunk
  Extending line with next chunk
  Extending line with next chunk
Accepted in allow mode ...
tmp/symbols.csv line 22046/27 - 2023 - EIQ - QUO character not allowed
    |pany *&#34;*Vimp|
  Extending line with next chunk
  Extending line with next chunk
  Extending line with next chunk
  Extending line with next chunk
  Extending line with next chunk
  Extending line with next chunk
  Extending line with next chunk
  Extending line with next chunk
  Extending line with next chunk
  Extending line with next chunk
  Extending line with next chunk
  Extending line with next chunk
Accepted in allow mode ...

--8&lt;--- symbols.pl
#!/pro/bin/perl

use strict;
use warnings;

use Text::CSV_XS;

my $csv = Text::CSV_XS-&gt;new &#40;{ binary             =&gt; 1 }&#41;;
my $csa = Text::CSV_XS-&gt;new &#40;{ binary             =&gt; 1,
                               allow_loose_quotes =&gt; 1,
                               escape_char        =&gt; undef,
                               }&#41;;

my $file = @ARGV ? shift : &#34;symbols.csv&#34;;
open my $fh, &#34;&lt;&#34;, $file or die &#34;$file: $!\n&#34;;

my %err_eol = map { $_ =&gt; 1 } 2010, 2027, 2031, 2032;

print STDERR &#34;Reading $file with Text::CSV_XS $Text::CSV_XS::VERSION\n&#34;;
while &#40;1&#41; {
    my $row = $csv-&gt;getline &#40;$fh&#41;;

    unless &#40;$row&#41; {
        $csv-&gt;eof and last;

        my @diag = $csv-&gt;error_diag;
        print STDERR &#34;$file line $./$diag[2] - $diag[0] - $diag[1]\n&#34;;
        my $ep  = $diag[2] - 1; # diag[2] is 1-based
        my $ein = $csv-&gt;error_input;
        my $err = $ein . &#34;         &#34;;
        substr $err, $ep + 1, 0, &#34;*&#34;;
        substr $err, $ep,     0, &#34;*&#34;;
        &#40;$err = substr $err, $ep - 5, 12&#41; =~ s/ +$//;
        print STDERR &#34;    |$err|\n&#34;;

        REPARSE: {
            if &#40;$row = $csa-&gt;parse &#40;$ein&#41;&#41; {
                print STDERR &#34;Accepted in allow mode ...\n&#34;;
                }
            else {
                my @diag = $csa-&gt;error_diag;
                if &#40;exists $err_eol{$diag[0]}&#41; {
                    print STDERR &#34;  Extending line with next chunk\n&#34;;
                    $ein .= scalar &lt;$fh&gt;;
                    goto REPARSE;
                    }
                print STDERR &#34;  Also could not parse it in allow mode\n&#34;;
                print STDERR &#34;  $./$diag[2] - $diag[0] - $diag[1]\n&#34;;
                print STDERR &#34;  Line skipped\n&#34;;
                next;
                }
            }
        }

    # Data was fine, do something with $row
    }
--&gt;8---

-- 
H.Merijn Brand         Amsterdam Perl Mongers &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://amsterdam.pm.org/&#41;">http://amsterdam.pm.org/&#41;</a></span>
using &#38; porting perl 5.6.2, 5.8.x, 5.10.x  on HP-UX 10.20, 11.00, 11.11,
&#38; 11.23, SuSE 10.1 &#38; 10.2, AIX 5.2, and Cygwin.       <span class="clickylink"><a target="new" rel="nofollow" href="http://qa.perl.org">http://qa.perl.org</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://mirrors.develooper.com/hpux/">http://mirrors.develooper.com/hpux/</a></span>            <span class="clickylink"><a target="new" rel="nofollow" href="http://www.test-smoke.org">http://www.test-smoke.org</a></span>
                        <span class="clickylink"><a target="new" rel="nofollow" href="http://www.goldmark.org/jeff/stupid-disclaimers/">http://www.goldmark.org/jeff/stupid-disclaimers/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;06&nbsp;18:15:16&nbsp;2008</span>
    <span class="description">HMBRAND [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Closed. No feedback on given solution.
I may assume that it worked.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;06&nbsp;18:15:19&nbsp;2008</span>
    <span class="description">HMBRAND [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Give odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;06&nbsp;18:15:22&nbsp;2008</span>
    <span class="description">HMBRAND [...] cpan.org -  Given to HMBRAND</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;02&nbsp;04:30:19&nbsp;2008</span>
    <span class="description">HMBRAND [...] cpan.org -  Fixed in 0.45 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
