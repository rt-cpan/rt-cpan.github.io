<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #41035 for HTML-Strip: segfault when parsing invalid multi-line HTML</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #41035 for HTML-Strip: segfault when parsing invalid multi-line HTML</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=HTML-Strip">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=HTML-Strip">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=HTML-Strip">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=HTML-Strip">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/HTML-Strip">HTML-Strip CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">41035</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=HTML-Strip">HTML-Strip</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
bitcard [...] larochelle.name

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-15966-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-15967-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
2.01    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




html_strip_crasher.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1068575/561895/html_strip_crasher.pl">
Tue Apr 17 09:48:23 2012 (200b) by tim [...] retout.co.uk
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/534563/268090/html_strip_crasher.pl">
Tue Nov 18 12:16:36 2008 (458b) by bitcard [...] larochelle.name
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=41035">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-534563" href="/Public/Bug/Display.html?id=41035#txn-534563">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;18&nbsp;12:16:36&nbsp;2008</span>
    <span class="description">bitcard [...] larochelle.name -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> segfault when parsing invalid multi-line HTML</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/534563/268087/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/268087">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Parsing the following 8 lines of invalid html by calling
HTML::Strip::parse&#40;&#41; on each line &#40;and not calling eof&#40;&#41;&#41; causes perl to
crash with &#34;free&#40;&#41;: invalid next size &#40;fast&#41;&#34;.  

LINES THAT CAUSE CRASH:
&lt;option value=&#34;&#34;&gt;123456 78912345 678901&lt;/option&gt;
&lt;/select&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;input type=&#34;hidden&#34; name=&#34;LPrice&#34; value=&#34;0&#34; /&gt;
&lt;li &gt;
&lt;div class=&#34;real_left&#34;&gt;
ABC. DEFGH:

Running the attached perl script demonstrates this bug. Output of the
crash is included below.

Note: Calling eof between lines does prevent the crash. However, this
bug is still significant because HTML files often come from untrusted
sources.  Furthermore, the documentation never states that the HTML must
be valid.  Finally, the result of the bug -- a crash of the perl process
-- is extremely catastrophic.

This bug has been verified on Ubuntu Linux machines for both Perl 5.8
and 5.10

drl@dev:~$ ./html_strip_crasher.pl 
*** glibc detected *** /usr/bin/perl: free&#40;&#41;: invalid next size &#40;fast&#41;:
0x086f7228 ***
======= Backtrace: =========
/lib/tls/i686/nosegneg/libc.so.6[0x99f495]
/lib/tls/i686/nosegneg/libc.so.6&#40;cfree+0x90&#41;[0x9a2f70]
/usr/local/lib/perl/5.8.8/auto/HTML/Strip/Strip.so&#40;XS_HTML__Strip_strip_html+0x40f&#41;[0x49055f]
/usr/bin/perl&#40;Perl_pp_entersub+0x313&#41;[0x80c22d3]
/usr/bin/perl&#40;Perl_runops_standard+0x1b&#41;[0x80c0cab]
/usr/bin/perl&#40;perl_run+0x2db&#41;[0x806727b]
/usr/bin/perl&#40;main+0x112&#41;[0x8063792]
/lib/tls/i686/nosegneg/libc.so.6&#40;__libc_start_main+0xe0&#41;[0x949450]
/usr/bin/perl[0x8063611]
======= Memory map: ========
00110000-0011a000 r-xp 00000000 08:01 639266     /lib/libgcc_s.so.1
0011a000-0011b000 rw-p 0000a000 08:01 639266     /lib/libgcc_s.so.1
00213000-0021c000 r-xp 00000000 08:01 639273    
/lib/tls/i686/nosegneg/libcrypt-2.7.so
0021c000-0021e000 rw-p 00008000 08:01 639273    
/lib/tls/i686/nosegneg/libcrypt-2.7.so
0021e000-00245000 rw-p 0021e000 00:00 0 
0048d000-00492000 r-xp 00000000 08:01 517558    
/usr/local/lib/perl/5.8.8/auto/HTML/Strip/Strip.so
00492000-00493000 rw-p 00004000 08:01 517558    
/usr/local/lib/perl/5.8.8/auto/HTML/Strip/Strip.so
006b6000-006d9000 r-xp 00000000 08:01 639282    
/lib/tls/i686/nosegneg/libm-2.7.so
006d9000-006db000 rw-p 00023000 08:01 639282    
/lib/tls/i686/nosegneg/libm-2.7.so
00898000-00899000 r-xp 00898000 00:00 0          [vdso]
00924000-0092e000 r-xp 00000000 08:01 444248    
/usr/lib/perl5/auto/HTML/Parser/Parser.so
0092e000-0092f000 rw-p 00009000 08:01 444248    
/usr/lib/perl5/auto/HTML/Parser/Parser.so
00933000-00a7f000 r-xp 00000000 08:01 639248    
/lib/tls/i686/nosegneg/libc-2.7.so
00a7f000-00a80000 r--p 0014c000 08:01 639248    
/lib/tls/i686/nosegneg/libc-2.7.so
00a80000-00a82000 rw-p 0014d000 08:01 639248    
/lib/tls/i686/nosegneg/libc-2.7.so
00a82000-00a85000 rw-p 00a82000 00:00 0 
00ae7000-00ae9000 r-xp 00000000 08:01 639280    
/lib/tls/i686/nosegneg/libdl-2.7.so
00ae9000-00aeb000 rw-p 00001000 08:01 639280    
/lib/tls/i686/nosegneg/libdl-2.7.so
00b73000-00b87000 r-xp 00000000 08:01 641518    
/lib/tls/i686/nosegneg/libpthread-2.7.so
00b87000-00b89000 rw-p 00013000 08:01 641518    
/lib/tls/i686/nosegneg/libpthread-2.7.so
00b89000-00b8b000 rw-p 00b89000 00:00 0 
00e8b000-00ea5000 r-xp 00000000 08:01 641487     /lib/ld-2.7.so
00ea5000-00ea7000 rw-p 00019000 08:01 641487     /lib/ld-2.7.so
08048000-0814d000 r-xp 00000000 08:01 443032     /usr/bin/perl
0814d000-08151000 rw-p 00104000 08:01 443032     /usr/bin/perl
08151000-08153000 rw-p 08151000 00:00 0 
086c6000-0878b000 rw-p 086c6000 00:00 0 
b7d00000-b7d21000 rw-p b7d00000 00:00 0 
b7d21000-b7e00000 ---p b7d21000 00:00 0 
b7e2b000-b7e4c000 rw-p b7e2b000 00:00 0 
b7e4c000-b7f82000 r--p 00000000 08:01 443652    
/usr/lib/locale/locale-archive
b7f82000-b7f84000 rw-p b7f82000 00:00 0 
b7f8b000-b7f8e000 rw-p b7f8b000 00:00 0 
bfd28000-bfd3d000 rw-p bfd28000 00:00 0          [stack]
Aborted
drl@dev:~$ 
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> html_strip_crasher.pl</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/534563/268090/html_strip_crasher.pl">Download html_strip_crasher.pl</a><br />
<span class="downloadcontenttype">text/x-perl 458b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl

use strict;

use HTML::Strip;

my @lines = &#40;
    &#39;&lt;option value=&#34;&#34;&gt;123456 78912345 678901&lt;/option&gt;&#39;,
    &#39;&lt;/select&gt;&#39;,
    &#39;&lt;/div&gt;&#39;,
    &#39;&lt;/li&gt;&#39;,
    &#39;&lt;input type=&#34;hidden&#34; name=&#34;LPrice&#34; value=&#34;0&#34; /&gt;&#39;,
    &#39;&lt;li &gt;&#39;,
    &#39;&lt;div class=&#34;real_left&#34;&gt;&#39;,
    &#39;ABC. DEFGH:&#39;
&#41;;

sub main {

    my $hs_loc = HTML::Strip-&gt;new&#40;&#41;;

    for &#40; my $i = 0 ; $i &lt; @lines ; $i++ &#41; {
        my $line = $lines[$i];

        $hs_loc-&gt;parse&#40;$line&#41;;
    }
}

main&#40;&#41;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1068575" href="/Public/Bug/Display.html?id=41035#txn-1068575">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;17&nbsp;09:48:23&nbsp;2012</span>
    <span class="description">tim [...] retout.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1068575/561894/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/561894">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 55b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve got the test case down to two lines; see attached.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> html_strip_crasher.pl</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1068575/561895/html_strip_crasher.pl">Download html_strip_crasher.pl</a><br />
<span class="downloadcontenttype">text/x-perl 200b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl

use strict;
use warnings;

use HTML::Strip;

my @lines = &#40;
    &#39;&lt;b&gt;1&lt;/b&gt;&lt;li&gt;&#39;,
    &#39;ABC. DEFGH:&#39;
&#41;;

my $hs = HTML::Strip-&gt;new&#40;&#41;;

for my $line &#40; @lines &#41; {
    $hs-&gt;parse&#40;$line&#41;;
}

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1068578" href="/Public/Bug/Display.html?id=41035#txn-1068578">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;17&nbsp;09:48:25&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1068822" href="/Public/Bug/Display.html?id=41035#txn-1068822">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;18&nbsp;04:48:16&nbsp;2012</span>
    <span class="description">tim [...] retout.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1068822/562033/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/562033">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 266b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Apr 17 09:48:23 2012, DIOCLES wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve got the test case down to two lines; see attached.
</div>
This was tested with the HTML::Strip &#40;1.06&#41; in Fedora 16, but neither
test case has crashed for me when I built HTML::Strip from source to
investigate further. :&#40;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1102561" href="/Public/Bug/Display.html?id=41035#txn-1102561">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;25&nbsp;10:06:05&nbsp;2012</span>
    <span class="description">michisteiner [...] verizon.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> michisteiner [...] verizon.net</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1102561/579693/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/579693">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 875b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Running also into this problem and debugging a bit i figured the &#40;or at
least one&#41; problem:

In Strip.xs the size of output buffer &#40;= clean&#41; is set via
  int size = strlen&#40;raw&#41; + 1;
to be the same as the input buffer &#40;= raw&#41;.  However, if the state
indicates in_tag, emit_spaces is true and the raw input does not have
anything which is removed/shrunk, then the output can get larger than
the input as there will be a space prepend!!

=&gt; counter-measures:
- without changing module, just adding ``emit_spaces =&gt; 0&#39;&#39; to new&#40;&#41; did
help for me.
- changing Strip.xs to change the line mentioned above to
    int size = strlen&#40;raw&#41; + 2;
  also seemed to work &#40;although i didn&#39;t go through all code in
strip_html to verify that there is only a single additional space which
can be added to output and there might not be other circumstances where
output could be larger than input.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1414328" href="/Public/Bug/Display.html?id=41035#txn-1414328">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;23&nbsp;12:40:02&nbsp;2014</span>
    <span class="description">KILINRAX [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1414328/750823/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/750823">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 118b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I can&#39;t replicate this bug - all of the test cases listed run fine for me.

I am using perl v5.14.2 on Ubuntu Precise.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1416497" href="/Public/Bug/Display.html?id=41035#txn-1416497">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;30&nbsp;06:56:06&nbsp;2014</span>
    <span class="description">KILINRAX [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> bitcard [...] larochelle.name, tim [...] retout.co.uk</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1416497/752024/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/752024">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 336b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Sep 23 12:40:02 2014, KILINRAX wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I can&#39;t replicate this bug - all of the test cases listed run fine for me.
&gt; 
&gt; I am using perl v5.14.2 on Ubuntu Precise.
</div>
Can one of you rerun the breaking test cases and determine if they&#39;re still an issue?

If they are I&#39;ll need to know more about your system/poerl version to proceed.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1435215" href="/Public/Bug/Display.html?id=41035#txn-1435215">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;20&nbsp;10:33:54&nbsp;2014</span>
    <span class="description">KILINRAX [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1435215/762947/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/762947">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 32b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Michi&#39;s patch applied in v2.01.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1435218" href="/Public/Bug/Display.html?id=41035#txn-1435218">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;20&nbsp;10:33:55&nbsp;2014</span>
    <span class="description">KILINRAX [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1435220" href="/Public/Bug/Display.html?id=41035#txn-1435220">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;20&nbsp;10:33:55&nbsp;2014</span>
    <span class="description">KILINRAX [...] cpan.org -  Fixed in 2.01 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.619468</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
