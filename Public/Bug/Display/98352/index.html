<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #98352 for DBD-Multi: Suggestions DBD-Multi</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #98352 for DBD-Multi: Suggestions DBD-Multi</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DBD-Multi/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DBD-Multi/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DBD-Multi/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DBD-Multi/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-Multi">DBD-Multi CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">98352</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DBD-Multi/Active/">DBD-Multi</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Dan [...] DWright.Org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
chrmet [...] web.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-38372-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-38373-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;27&nbsp;04:46:56&nbsp;2014</span>
    <span class="description">chrmet [...] web.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Suggestions DBD-Multi</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 27 Aug 2014 10:46:45 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-Multi [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Christian Metzger&#34; &lt;chrmet [...] web.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza"><div style="font-family: Verdana;font-size: 12.0px;"><div>
&nbsp;</div>

<div>Dear Ladies and Gentleman,</div>

<div>&nbsp;</div>

<div>we are using DBD-Multi 0.18 with Perl 5.12.3 on Linux (Rhel 5.5).</div>

<div>It fits our requirements very well.</div>

<div>We are able to write to every cluster node with MariaDB-Galera-server-5.5.37-1 for MySQL.</div>

<div>&nbsp;</div>

<div>I have these suggestions:</div>

<div>&nbsp;</div>

<div>A) Should behave like other DBD drivers if a connection could not be established</div>

<div>Return &quot;undef&quot; (or a false value)</div>

<div>Set &#36;DBI::err</div>

<div>Set &#36;DBI::errstr</div>

<div>&nbsp;</div>

<div>B) The module dies if a connction could not be established</div>

<div>I tried to catch this in my application with eval { -&gt;connect() }, but unfortunately</div>

<div>this does not work for me (script gets terminated).</div>

<div>So the module should work like A) and not &quot;die&quot;.</div>

<div>&nbsp;</div>

<div>&nbsp;</div>

<div>&nbsp;</div>

<div>&nbsp;</div>

<div>&nbsp;
<div>&nbsp;</div>

<div>
Kind regards,
Christian Metzger</div>
</div></div>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;28&nbsp;10:53:59&nbsp;2014</span>
    <span class="description">Dan [...] DWright.Org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Aug 27 04:46:56 2014, chrmet@web.de wrote:


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Dear Ladies and Gentleman, we are using DBD-Multi 0.18 with Perl
&gt; 5.12.3 on Linux &#40;Rhel 5.5&#41;.It fits our requirements very well.We are
&gt; able to write to every cluster node with
&gt; MariaDB-Galera-server-5.5.37-1 for MySQL. 
</div>
Hello!   I&#39;m glad to hear it is working well for you.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; A&#41; Should behave like other DBD drivers if a connection could not be
&gt; establishedReturn &#34;undef&#34; &#40;or a false value&#41;Set $DBI::errSet
&gt; $DBI::errstr 
</div>
The DBD::Multi object is just a container.   Creation of that container
never fails.   Until that changes, Multi should not return undef.

Multi is an object that holds multiple database handles for you.   Those
database handles may exist when you create the Mutli object, or they
might not even be created until they are needed.  

For example, if I specify a connection like this:

 DBI-&gt;connect&#40; &#39;dbi:Multi:&#39;, undef, undef, {
   dsns =&gt; [ 10 =&gt; [ ... ] # first db
             20 =&gt; [ ... ] # second db ] } &#41;;

The Multi object will not attempt to connect to the first DB until it
has been sent its first query.   Additionally, as long as the first DB
continues to work, the Multi object will never connect to second DB.

So, it would be impossible to always know at the time the Multi object
is constructed if the inner database handle connections will be
successful.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; B&#41; The module dies if a connction could not be establishedI tried to
&gt; catch this in my application with eval { -&gt;connect&#40;&#41; }, but
&gt; unfortunatelythis does not work for me &#40;script gets terminated&#41;.So the
&gt; module should work like A&#41; and not &#34;die&#34;.  Kind regards, Christian
&gt; Metzger
</div>
The code does call die&#40;&#41;:

367     die&#40;&#34;All data sources failed!&#34;&#41;;

You should be able to trap that with an eval {}.   Can you provide
sample code that demonstrates the problem?

I think a valid argument could be made here that Multi should only call
die in the case where RaiseError is turned on.  I would be willing to
look into making this change, if it would be helpful to you?

Regards,
-Dan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;28&nbsp;10:53:59&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;28&nbsp;13:46:06&nbsp;2014</span>
    <span class="description">Dan [...] DWright.Org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;28&nbsp;14:14:07&nbsp;2014</span>
    <span class="description">chrmet [...] web.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Aw: [rt.cpan.org #98352] Suggestions DBD-Multi</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 28 Aug 2014 20:13:55 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-Multi [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Christian Metzger&#34; &lt;chrmet [...] web.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza"><div style="font-family: Verdana;font-size: 12.0px;"><div>
&nbsp;</div>

<div>Hi Dan,</div>

<div>&nbsp;</div>

<div>I&#39;m very glad to get in contact with you.</div>

<div>I have looked at all other HA modules too, and yours is the best by far.</div>

<div>&nbsp;</div>

<div>Ad A)</div>

<div>Yes, I see your point (creation of connections is deferred, no connection is created in the connect method).</div>

<div>&nbsp;</div>

<div>Ad B)</div>

<div>I did change my code slightly and it is working now: It looks like the &quot;eval&quot; is fully working now.
But I don&#39;t really understand this, because my change was <span lang="en"><span>actually</span> <span>insignificant.</span></span></div>

<div>Yes, if &quot;die&quot; will be called only in the case where &quot;RaiseError&quot; is turned on, would be absolutely great:</div>

<div>I won&#39;t have to be afraid that the &quot;die&quot; might not be catched again.</div>

<div>This is very important for us because the applications must not crash at all.</div>

<div>&nbsp;</div>

<div>May I ask for something else?</div>

<div>I noticed that if not even one datasource could be connected, that there are many lines with</div>

<div>error messages (which is absolutely ok).</div>

<div>But in one/some of these lines is not only contained the userid but also the password.</div>

<div>This is not very well because we are publishing our logfiles.&nbsp;</div>

<div>&nbsp;</div>

<div>&nbsp;</div>

<div>&nbsp;</div>

<div>Kind regards,
Christian</div>

<div>&nbsp;
<div>&nbsp;
<div>
<div><b>Gesendet:</b>&nbsp;Donnerstag, 28. August 2014 um 16:53 Uhr
<b>Von:</b>&nbsp;&quot;Daniel J. Wright via RT&quot; &lt;bug-DBD-Multi@rt.cpan.org&gt;
<b>An:</b>&nbsp;chrmet@web.de
<b>Betreff:</b>&nbsp;[rt.cpan.org #98352] Suggestions DBD-Multi</div>

<div>&lt;URL: <a href="https://rt.cpan.org/Ticket/Display.html?id=98352" target="_blank"><span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=98352">https://rt.cpan.org/Ticket/Display.html?id=98352</a></span></a> &gt;

On Wed Aug 27 04:46:56 2014, chrmet@web.de wrote:


&gt; Dear Ladies and Gentleman, we are using DBD-Multi 0.18 with Perl
&gt; 5.12.3 on Linux (Rhel 5.5).It fits our requirements very well.We are
&gt; able to write to every cluster node with
&gt; MariaDB-Galera-server-5.5.37-1 for MySQL.

Hello! I&#39;m glad to hear it is working well for you.

&gt; A) Should behave like other DBD drivers if a connection could not be
&gt; establishedReturn &quot;undef&quot; (or a false value)Set &#36;DBI::errSet
&gt; &#36;DBI::errstr

The DBD::Multi object is just a container. Creation of that container
never fails. Until that changes, Multi should not return undef.

Multi is an object that holds multiple database handles for you. Those
database handles may exist when you create the Mutli object, or they
might not even be created until they are needed.

For example, if I specify a connection like this:

DBI-&gt;connect( &#39;dbi:Multi:&#39;, undef, undef, {
dsns =&gt; [ 10 =&gt; [ ... ] # first db
20 =&gt; [ ... ] # second db ] } );

The Multi object will not attempt to connect to the first DB until it
has been sent its first query. Additionally, as long as the first DB
continues to work, the Multi object will never connect to second DB.

So, it would be impossible to always know at the time the Multi object
is constructed if the inner database handle connections will be
successful.

&gt; B) The module dies if a connction could not be establishedI tried to
&gt; catch this in my application with eval { -&gt;connect() }, but
&gt; unfortunatelythis does not work for me (script gets terminated).So the
&gt; module should work like A) and not &quot;die&quot;. Kind regards, Christian
&gt; Metzger

The code does call die():

367 die(&quot;All data sources failed!&quot;);

You should be able to trap that with an eval {}. Can you provide
sample code that demonstrates the problem?

I think a valid argument could be made here that Multi should only call
die in the case where RaiseError is turned on. I would be willing to
look into making this change, if it would be helpful to you?

Regards,
-Dan
&nbsp;</div>
</div>
</div>
</div></div>


</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
