<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #44402 for Text-CSV_XS: Unexpected results parsing tab-separated spaces</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #44402 for Text-CSV_XS: Unexpected results parsing tab-separated spaces</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Text-CSV_XS/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Text-CSV_XS/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Text-CSV_XS/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Text-CSV_XS/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Text-CSV_XS">Text-CSV_XS CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">44402</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">20 min

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Text-CSV_XS/Active/">Text-CSV_XS</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
eric.roode.cpan [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31868-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.60    </td>
  </tr>
  <tr id="CF-31869-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.63    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;18&nbsp;14:07:13&nbsp;2009</span>
    <span class="description">eric.roode.cpan [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Unexpected results parsing tab-separated spaces</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Perhaps this issue is out-of-scope for Text::CSV_XS, because I am using
it to parse tab-separated data, and I do not know whether that is supported.

When parsing tab-separated data, and the input record contains fields
that consist entirely of spaces &#40;ascii 32&#41;, and allow_whitespace is
enabled, then Text::CSV_XS appears to remove not only the spaces but
also the adjacent tab characters, which has the effect of removing
actual fields from the data record.

Further, if the record ends with one or more spaces, then the parse
fails completely with the error &#34;EIF - Binary character in unquoted
field, binary off&#34;.

I have attached a sample program that provides eight simple test cases,
four with allow_whitespace on, four with it off.  I think it is
self-explanatory.

Thank you,

Eric J. Roode
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> csv_test.pl</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!perl

# Test case that demonstrates surprising Text::CSV_XS behavior.

use Text::CSV_XS;

my $csv  = Text::CSV_XS-&gt;new&#40;{
                              sep_char =&gt; &#34;\t&#34;,
                              allow_whitespace   =&gt; 0,
                             }&#41;;
my $rec1 = qq{One\t\tThree\t\t\tSix};
my $rec2 = qq{One\t    \tThree\t    \t  \tSix};
my $rec3 = qq{One\t    \tThree\t    \t  \t    };
my $rec4 = qq{   \t    \tThree\t    \t  \tSix};

print &#34;We expect 6 fields each time.\n&#34;;

# ---------------- Adjacent tabs, no allow_whitespace ----------------
if &#40;$csv-&gt;parse&#40;$rec1&#41;&#41;
{
    my @fields = $csv-&gt;fields;
    print &#39;There are &#39;, scalar&#40;@fields&#41;, &#34; fields in rec1\n&#34;;
}
else
{
    my $diag = $csv-&gt;error_diag;
    print &#34;Couldn&#39;t parse rec1: $diag\n&#34;;
}

# ---------------- Space-infested tabs, no allow_whitespace ----------------
if &#40;$csv-&gt;parse&#40;$rec2&#41;&#41;
{
    my @fields = $csv-&gt;fields;
    print &#39;There are &#39;, scalar&#40;@fields&#41;, &#34; fields in rec2\n&#34;;
}
else
{
    my $diag = $csv-&gt;error_diag;
    print &#34;Couldn&#39;t parse rec2: $diag\n&#34;;
}

# ---------------- Spaces at the end, no allow whitespace  ----------------
if &#40;$csv-&gt;parse&#40;$rec3&#41;&#41;
{
    my @fields = $csv-&gt;fields;
    print &#39;There are &#39;, scalar&#40;@fields&#41;, &#34; fields in rec3\n&#34;;
}
else
{
    my $diag = $csv-&gt;error_diag;
    print &#34;Couldn&#39;t parse rec3: $diag\n&#34;;
}

# ---------------- Spaces at the front, no allow whitespace  ----------------
if &#40;$csv-&gt;parse&#40;$rec4&#41;&#41;
{
    my @fields = $csv-&gt;fields;
    print &#39;There are &#39;, scalar&#40;@fields&#41;, &#34; fields in rec4\n&#34;;
}
else
{
    my $diag = $csv-&gt;error_diag;
    print &#34;Couldn&#39;t parse recf: $diag\n&#34;;
}


# Now allow whitespace
$csv  = Text::CSV_XS-&gt;new&#40;{
                           sep_char =&gt; &#34;\t&#34;,
                           allow_whitespace   =&gt; 1,
                          }&#41;;

# ---------------- Adjacent tabs, allow_whitespace ----------------
if &#40;$csv-&gt;parse&#40;$rec1&#41;&#41;
{
    my @fields = $csv-&gt;fields;
    print &#39;There are &#39;, scalar&#40;@fields&#41;, &#34; fields in rec1 &#40;allow_whitespace&#41;\n&#34;;
}
else
{
    my $diag = $csv-&gt;error_diag;
    print &#34;Couldn&#39;t parse rec1: $diag\n&#34;;
}

# ---------------- Space-infested tabs, allow_whitespace ----------------
if &#40;$csv-&gt;parse&#40;$rec2&#41;&#41;
{
    my @fields = $csv-&gt;fields;
    print &#39;There are &#39;, scalar&#40;@fields&#41;, &#34; fields in rec2 &#40;allow_whitespace&#41;\n&#34;;
}
else
{
    my $diag = $csv-&gt;error_diag;
    print &#34;Couldn&#39;t parse rec2: $diag\n&#34;;
}

# ---------------- Spaces at the end, allow whitespace  ----------------
if &#40;$csv-&gt;parse&#40;$rec3&#41;&#41;
{
    my @fields = $csv-&gt;fields;
    print &#39;There are &#39;, scalar&#40;@fields&#41;, &#34; fields in rec3 &#40;allow_whitespace&#41;\n&#34;;
}
else
{
    my $diag = $csv-&gt;error_diag;
    print &#34;Couldn&#39;t parse rec3: $diag\n&#34;;
}

# ---------------- Spaces at the front, allow whitespace  ----------------
if &#40;$csv-&gt;parse&#40;$rec4&#41;&#41;
{
    my @fields = $csv-&gt;fields;
    print &#39;There are &#39;, scalar&#40;@fields&#41;, &#34; fields in rec4\n&#34;;
}
else
{
    my $diag = $csv-&gt;error_diag;
    print &#34;Couldn&#39;t parse recf: $diag\n&#34;;
}

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;19&nbsp;03:49:38&nbsp;2009</span>
    <span class="description">h.m.brand [...] xs4all.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #44402] Unexpected results parsing tab-separated spaces</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 19 Mar 2009 08:49:13 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-CSV_XS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;H.Merijn Brand&#34; &lt;h.m.brand [...] xs4all.nl&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, 18 Mar 2009 14:07:14 -0400, &#34;Eric J. Roode via RT&#34;
&lt;bug-Text-CSV_XS@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Perhaps this issue is out-of-scope for Text::CSV_XS, because I am using
&gt; it to parse tab-separated data, and I do not know whether that is supported.
</div>
It should be, and I fixed it for 0.63.
Can you grab &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://repo.or.cz/w/Text-CSV_XS.git?a=snapshot;sf=tgz&#39;">http://repo.or.cz/w/Text-CSV_XS.git?a=snapshot;sf=tgz&#39;</a></span>
and see if that fixes your problem?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; When parsing tab-separated data, and the input record contains fields
&gt; that consist entirely of spaces &#40;ascii 32&#41;, and allow_whitespace is
&gt; enabled, then Text::CSV_XS appears to remove not only the spaces but
&gt; also the adjacent tab characters, which has the effect of removing
&gt; actual fields from the data record.
&gt; 
&gt; Further, if the record ends with one or more spaces, then the parse
&gt; fails completely with the error &#34;EIF - Binary character in unquoted
&gt; field, binary off&#34;.
&gt; 
&gt; I have attached a sample program that provides eight simple test cases,
&gt; four with allow_whitespace on, four with it off.  I think it is
&gt; self-explanatory.
</div>
Your bug report was self-explaining enough already. Better even, I
immediately knew where to fix this.

BTW Are you the same Eric that worked for PROCURA years ago?

-- 
H.Merijn Brand  <span class="clickylink"><a target="new" rel="nofollow" href="http://tux.nl">http://tux.nl</a></span>      Perl Monger  <span class="clickylink"><a target="new" rel="nofollow" href="http://amsterdam.pm.org/">http://amsterdam.pm.org/</a></span>
using &#38; porting perl 5.6.2, 5.8.x, 5.10.x, 5.11.x on HP-UX 10.20, 11.00,
11.11, 11.23, and 11.31, SuSE 10.1, 10.3, and 11.0, AIX 5.2, and Cygwin.
<span class="clickylink"><a target="new" rel="nofollow" href="http://mirrors.develooper.com/hpux/">http://mirrors.develooper.com/hpux/</a></span>           <span class="clickylink"><a target="new" rel="nofollow" href="http://www.test-smoke.org/">http://www.test-smoke.org/</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://qa.perl.org">http://qa.perl.org</a></span>      <span class="clickylink"><a target="new" rel="nofollow" href="http://www.goldmark.org/jeff/stupid-disclaimers/">http://www.goldmark.org/jeff/stupid-disclaimers/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;19&nbsp;03:49:39&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;19&nbsp;14:06:38&nbsp;2009</span>
    <span class="description">eric.roode.cpan [...] gmail.com -  Correspondence added</span>
    <span class="time-taken">15 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Mar 19 03:49:38 2009, h.m.brand@xs4all.nl wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; It should be, and I fixed it for 0.63.
&gt; Can you grab &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://repo.or.cz/w/Text-CSV_XS.git?a=snapshot;sf=tgz&#39;">http://repo.or.cz/w/Text-CSV_XS.git?a=snapshot;sf=tgz&#39;</a></span>
&gt; and see if that fixes your problem?
</div>
It partially solves the problem.  It now correctly parses fields that
contain only space characters at the start of a line, or in the middle
of a line &#40;e.g. surrounded by tabs&#41;, but still gives a parse error if
there is a spaces-only field at the end of a record.

For the test program attached earlier, all tests pass now except the
next-to-last one &#40;record 3 with allow-whitespace&#41;, which still gives
&#34;EIF - Binary character in unquoted field, binary off&#34;.

Could it be that after it removes spaces at the end of the line, the
string pointer has moved to one-character past the end of the string,
and is now at a \x00 byte &#40;or some garbage character&#41;?  Just a guess
&#40;not having looked at the source&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; BTW Are you the same Eric that worked for PROCURA years ago?
&gt; 
</div>
I&#39;m afraid not, sorry :-&#41;  I&#39;ve never heard of PROCURA.

-- Eric Roode
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;19&nbsp;14:53:44&nbsp;2009</span>
    <span class="description">h.m.brand [...] xs4all.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #44402] Unexpected results parsing tab-separated spaces</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 19 Mar 2009 19:53:19 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-CSV_XS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;H.Merijn Brand&#34; &lt;h.m.brand [...] xs4all.nl&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, 19 Mar 2009 14:06:39 -0400, &#34;Eric J. Roode via RT&#34;
&lt;bug-Text-CSV_XS@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Text-CSV_XS
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=44402">https://rt.cpan.org/Ticket/Display.html?id=44402</a></span> &gt;
&gt; 
&gt; On Thu Mar 19 03:49:38 2009, h.m.brand@xs4all.nl wrote:
<div class="message-stanza open">&gt; &gt; 
&gt; &gt; It should be, and I fixed it for 0.63.
&gt; &gt; Can you grab &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://repo.or.cz/w/Text-CSV_XS.git?a=snapshot;sf=tgz&#39;">http://repo.or.cz/w/Text-CSV_XS.git?a=snapshot;sf=tgz&#39;</a></span>
&gt; &gt; and see if that fixes your problem?
</div>&gt; 
&gt; It partially solves the problem.  It now correctly parses fields that
&gt; contain only space characters at the start of a line, or in the middle
&gt; of a line &#40;e.g. surrounded by tabs&#41;, but still gives a parse error if
&gt; there is a spaces-only field at the end of a record.
</div>
I&#39;ll have to dig for this. I tested it with $csv-&gt;getline &#40;&#41;, and not
with $csv-&gt;parse &#40;&#41;. The latter still fails on rec3.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; For the test program attached earlier, all tests pass now except the
&gt; next-to-last one &#40;record 3 with allow-whitespace&#41;, which still gives
&gt; &#34;EIF - Binary character in unquoted field, binary off&#34;.
</div>
Yes, but only in parse &#40;&#41;. I&#39;ll come back on this.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Could it be that after it removes spaces at the end of the line, the
&gt; string pointer has moved to one-character past the end of the string,
&gt; and is now at a \x00 byte &#40;or some garbage character&#41;?  Just a guess
&gt; &#40;not having looked at the source&#41;.
</div>
A much more effective test program doing both parse &#40;&#41; and getline &#40;&#41;:
--8&lt;code&gt;---
#!perl

# Test case that demonstrates surprising Text::CSV_XS behavior.

use strict;
use warnings;

use Text::CSV_XS;

my @rec = &#40;&#34;&#34;,
    qq{One\t\tThree\t\t\tSix},           # Adjacent tabs
    qq{One\t    \tThree\t    \t  \tSix}, # Space-infested tabs
    qq{One\t    \tThree\t    \t  \t   }, # Spaces at the end
    qq{   \t    \tThree\t    \t  \tSix}, # Spaces at the front
    &#41;;

print &#34;We expect 6 fields each time.\n&#34;;

foreach my $aw &#40;0, 1&#41; {
    my $csv  = Text::CSV_XS-&gt;new &#40;{
        sep_char         =&gt; &#34;\t&#34;,
        allow_whitespace =&gt; $aw,
        }&#41;;

    foreach my $r &#40;1..4&#41; {
        if &#40;$csv-&gt;parse &#40;$rec[$r]&#41;&#41; {
            my @fields = $csv-&gt;fields;
            print STDERR &#34;There are &#34;, scalar @fields, &#34; fields in rec$r &#40;$aw&#41;\n&#34;;
            }
        else {
            print STDERR &#34;# error in rec$r &#40;$aw&#41;\n&#34;;
            $csv-&gt;error_diag;
            }
        }
    }

# Now do the same with file/getline
open my $fh, &#34;&gt;&#34;, &#34;tmp/44402.csv&#34; or die &#34;Cannot write test file: $!\n&#34;;
print $fh &#34;$rec[1]\r\n$rec[2]\r\n$rec[3]\r\n$rec[4]\r\n&#34;;
close $fh;

foreach my $aw &#40;0, 1&#41; {
    open my $fh, &#34;&lt;&#34;, &#34;tmp/44402.csv&#34;;
    my $csv  = Text::CSV_XS-&gt;new &#40;{
        sep_char         =&gt; &#34;\t&#34;,
        allow_whitespace =&gt; $aw,
        }&#41;;

    foreach my $r &#40;1..4&#41; {
        if &#40;my $row = $csv-&gt;getline &#40;$fh&#41;&#41; {
            my @fields = @$row;
            print STDERR &#34;There are &#34;, scalar @fields, &#34; fields in rec$r &#40;$aw&#41;\n&#34;;
            }
        else {
            print STDERR &#34;# error in rec$r &#40;$aw&#41;\n&#34;;
            $csv-&gt;error_diag;
            }
        }
    }
--&lt;/code&gt;8---

-- 
H.Merijn Brand  <span class="clickylink"><a target="new" rel="nofollow" href="http://tux.nl">http://tux.nl</a></span>      Perl Monger  <span class="clickylink"><a target="new" rel="nofollow" href="http://amsterdam.pm.org/">http://amsterdam.pm.org/</a></span>
using &#38; porting perl 5.6.2, 5.8.x, 5.10.x, 5.11.x on HP-UX 10.20, 11.00,
11.11, 11.23, and 11.31, SuSE 10.1, 10.3, and 11.0, AIX 5.2, and Cygwin.
<span class="clickylink"><a target="new" rel="nofollow" href="http://mirrors.develooper.com/hpux/">http://mirrors.develooper.com/hpux/</a></span>           <span class="clickylink"><a target="new" rel="nofollow" href="http://www.test-smoke.org/">http://www.test-smoke.org/</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://qa.perl.org">http://qa.perl.org</a></span>      <span class="clickylink"><a target="new" rel="nofollow" href="http://www.goldmark.org/jeff/stupid-disclaimers/">http://www.goldmark.org/jeff/stupid-disclaimers/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;19&nbsp;17:21:36&nbsp;2009</span>
    <span class="description">h.m.brand [...] xs4all.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #44402] Unexpected results parsing tab-separated spaces</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 19 Mar 2009 22:21:21 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-CSV_XS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;H.Merijn Brand&#34; &lt;h.m.brand [...] xs4all.nl&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Fixed. Can you retry?
Grab &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://repo.or.cz/w/Text-CSV_XS.git?a=snapshot;sf=tgz&#39;">http://repo.or.cz/w/Text-CSV_XS.git?a=snapshot;sf=tgz&#39;</a></span>

-- 
H.Merijn Brand  <span class="clickylink"><a target="new" rel="nofollow" href="http://tux.nl">http://tux.nl</a></span>      Perl Monger  <span class="clickylink"><a target="new" rel="nofollow" href="http://amsterdam.pm.org/">http://amsterdam.pm.org/</a></span>
using &#38; porting perl 5.6.2, 5.8.x, 5.10.x, 5.11.x on HP-UX 10.20, 11.00,
11.11, 11.23, and 11.31, SuSE 10.1, 10.3, and 11.0, AIX 5.2, and Cygwin.
<span class="clickylink"><a target="new" rel="nofollow" href="http://mirrors.develooper.com/hpux/">http://mirrors.develooper.com/hpux/</a></span>           <span class="clickylink"><a target="new" rel="nofollow" href="http://www.test-smoke.org/">http://www.test-smoke.org/</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://qa.perl.org">http://qa.perl.org</a></span>      <span class="clickylink"><a target="new" rel="nofollow" href="http://www.goldmark.org/jeff/stupid-disclaimers/">http://www.goldmark.org/jeff/stupid-disclaimers/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;21&nbsp;08:52:38&nbsp;2009</span>
    <span class="description">HMBRAND [...] cpan.org -  Fixed in 0.63 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;21&nbsp;08:52:38&nbsp;2009</span>
    <span class="description">HMBRAND [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;21&nbsp;13:52:08&nbsp;2009</span>
    <span class="description">eric.roode.cpan [...] gmail.com -  Correspondence added</span>
    <span class="time-taken">5 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Mar 19 17:21:36 2009, h.m.brand@xs4all.nl wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Fixed. Can you retry?
&gt; Grab &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://repo.or.cz/w/Text-CSV_XS.git?a=snapshot;sf=tgz&#39;">http://repo.or.cz/w/Text-CSV_XS.git?a=snapshot;sf=tgz&#39;</a></span>
&gt; 
</div>

That works!  Great, thank you.  :-&#41;

--Eric
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;21&nbsp;13:52:09&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;21&nbsp;14:48:20&nbsp;2009</span>
    <span class="description">HMBRAND [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;May&nbsp;15&nbsp;08:49:27&nbsp;2009</span>
    <span class="description">HMBRAND [...] cpan.org -  Broken in 0.62 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
