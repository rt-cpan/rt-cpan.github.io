<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #29653 for Digest-MD5-File: Incorrect keys for dir_* under Win32</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #29653 for Digest-MD5-File: Incorrect keys for dir_* under Win32</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Digest-MD5-File/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Digest-MD5-File/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Digest-MD5-File/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Digest-MD5-File/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Digest-MD5-File">Digest-MD5-File CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">29653</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Digest-MD5-File/Active/">Digest-MD5-File</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jcasadonte [...] northbound-train.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-11516-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.05    </td>
  </tr>
  <tr id="CF-11517-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.06    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;28&nbsp;10:43:33&nbsp;2007</span>
    <span class="description">jcasadonte [...] northbound-train.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Incorrect keys for dir_* under Win32</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From the Digest::MD5::File documentation:

,----[ Digest::MD5::File ]
| DIR_* FUNCTIONS
|
| Returns a hashref whose keys are files relative to the given path and
| the values are the MD5 sum of the file or and empty string if a
| directory.
`----

The key point here being &#34;relative to the given path&#34;.  Under Linux, at
least, this works as expected.  Using the following small test script:

#!perl -w

use strict;

use Digest::MD5::File qq&#40;dir_md5_hex&#41;;
use FindBin;

my&#40;$root&#41; = shift || $FindBin::Bin;
print &#34;ROOT: &lt;$root&gt;\n&#34;;

my&#40;$md5byfile&#41; = dir_md5_hex&#40;$root&#41;;

print qq&#40;\$md5byfile:&#41;;
foreach my $key &#40;sort keys %$md5byfile&#41; {
        print  qq&#40;\t\$md5byfile-&gt;{&#39;$key&#39;}: &lt;$md5byfile-&gt;{$key}&gt;\n&#41;;
}


I receive the following output under linux:


[joe@baz bar]$ perl md5bug.pl Foo
ROOT: &lt;Foo&gt;
$md5byfile:     $md5byfile-&gt;{&#39;Bar.pm&#39;}: &lt;4cae3ce5437fc78c6733819af85c22f9&gt;
        $md5byfile-&gt;{&#39;Handler&#39;}: &lt;&gt;
        $md5byfile-&gt;{&#39;Handler/Base.pm&#39;}: &lt;a2570299d79d52f30141dcee3182ad06&gt;
        $md5byfile-&gt;{&#39;Handler/Database&#39;}: &lt;&gt;
        $md5byfile-&gt;{&#39;Handler/Database/Aix.pm&#39;}:
&lt;7e7527e165edc9f0bef407732e65ba52&gt;
        $md5byfile-&gt;{&#39;Handler/Database/Hpux.pm&#39;}:
&lt;9595364a5bf9add45a3fc24988863757&gt;


Under Win32, though, I receive the full path:

C:\&gt;perl r:/md5bug.pl r:/Foo
ROOT: &lt;r:/Foo&gt;
$md5byfile:     $md5byfile-&gt;{&#39;R:\Foo\Bar.pm&#39;}:
&lt;4cae3ce5437fc78c6733819af85c22f9&gt;
        $md5byfile-&gt;{&#39;R:\Foo\Handler&#39;}: &lt;&gt;
        $md5byfile-&gt;{&#39;R:\Foo\Handler\Base.pm&#39;}:
&lt;a2570299d79d52f30141dcee3182ad06&gt;
        $md5byfile-&gt;{&#39;R:\Foo\Handler\Database&#39;}: &lt;&gt;
        $md5byfile-&gt;{&#39;R:\Foo\Handler\Database\Aix.pm&#39;}:
&lt;7e7527e165edc9f0bef407732e65ba52&gt;
        $md5byfile-&gt;{&#39;R:\Foo\Handler\Database\Hpux.pm&#39;}:
&lt;9595364a5bf9add45a3fc24988863757&gt;


though only when the drive letter is specified as part of the root:


R:\&gt;perl md5bug.pl Foo
ROOT: &lt;Foo&gt;
$md5byfile:     $md5byfile-&gt;{&#39;\Bar.pm&#39;}: &lt;4cae3ce5437fc78c6733819af85c22f9&gt;
        $md5byfile-&gt;{&#39;\Handler&#39;}: &lt;&gt;
        $md5byfile-&gt;{&#39;\Handler\Base.pm&#39;}: &lt;a2570299d79d52f30141dcee3182ad06&gt;
        $md5byfile-&gt;{&#39;\Handler\Database&#39;}: &lt;&gt;
        $md5byfile-&gt;{&#39;\Handler\Database\Aix.pm&#39;}:
&lt;7e7527e165edc9f0bef407732e65ba52&gt;
        $md5byfile-&gt;{&#39;\Handler\Database\Hpux.pm&#39;}:
&lt;9595364a5bf9add45a3fc24988863757&gt;

It also uses backslashes for the directory separator, which is arguably
correct behavior, but annoying.

=======================

OS: WinXP Pro SP2

R:\&gt;perl -v

This is perl, v5.8.7 built for MSWin32-x86-multi-thread
&#40;with 14 registered patches, see perl -V for more detail&#41;

Copyright 1987-2005, Larry Wall

Binary build 815 [211909] provided by ActiveState <span class="clickylink"><a target="new" rel="nofollow" href="http://www.ActiveState.com">http://www.ActiveState.com</a></span>
ActiveState is a division of Sophos.
Built Nov  2 2005 08:44:52




[joe@baz bar]$ uname -a
Linux baz 2.6.9-42.0.2.ELsmp #1 SMP Thu Aug 17 18:00:32 EDT 2006 i686
i686 i386 GNU/Linux

[joe@baz bar]$ perl -v

This is perl, v5.8.5 built for i386-linux-thread-multi
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;29&nbsp;12:57:51&nbsp;2007</span>
    <span class="description">dmuey [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> DMUEY [...] cpan.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks, 

Could you send me the output of these commands from your windows box &#40;adjusting for 
actual paths of course&#41;?

multivac-2:~ dmuey$ ls test
1       2
multivac-2:~ dmuey$ perl -MData::Dumper -Mstrict -wle &#39;use Digest::MD5::File qw
&#40;dir_md5_hex&#41;;print Dumper dir_md5_hex&#40;&#34;test&#34;&#41;;&#39;
$VAR1 = {
          &#39;1&#39; =&gt; &#39;0bee89b07a248e27c83fc3d5951213c1&#39;,
          &#39;2&#39; =&gt; &#39;5b292c7c7fd3b118980cdbe425c26606&#39;
        };

multivac-2:~ dmuey$ perl -MData::Dumper -Mstrict -wle &#39;use Digest::MD5::File qw
&#40;dir_md5_hex&#41;;print Dumper dir_md5_hex&#40;&#34;/Users/dmuey/test&#34;&#41;;&#39;
$VAR1 = {
          &#39;1&#39; =&gt; &#39;0bee89b07a248e27c83fc3d5951213c1&#39;,
          &#39;2&#39; =&gt; &#39;5b292c7c7fd3b118980cdbe425c26606&#39;
        };

multivac-2:~ dmuey$ 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;29&nbsp;12:57:56&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;01&nbsp;15:17:23&nbsp;2007</span>
    <span class="description">jcasadonte [...] northbound-train.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> jcasadonte [...] northbound-train.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Sep 29 12:57:51 2007, DMUEY wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Could you send me the output of these commands from your windows box
&gt; &#40;adjusting for
&gt; actual paths of course&#41;?
</div>
C:\temp&gt;ls Digest-MD5-File-0.05
Changes      MANIFEST     Makefile.PL  t
File.pm      META.yml     README

C:\temp&gt;perl -MData::Dumper -Mstrict -wle &#34;use Digest::MD5::File
qw&#40;dir_md5_hex&#41;;print Dumper dir_md5_hex&#40;&#39;Digest-MD5-File-0.05&#39;&#41;;&#34;
$VAR1 = {
          &#39;\\File.pm&#39; =&gt; &#39;5d7841457387ad47bf033952c5e2fde7&#39;,
          &#39;\\Changes&#39; =&gt; &#39;d2003ddc44a2ec492a42080e561b1bb0&#39;,
          &#39;\\MANIFEST&#39; =&gt; &#39;5169dd7969c0a80650f514061d588c45&#39;,
          &#39;\\Makefile.PL&#39; =&gt; &#39;783eaec26b9d8439b975f943b86c7f00&#39;,
          &#39;\\t&#39; =&gt; &#39;&#39;,
          &#39;\\README&#39; =&gt; &#39;95075b9101ec1a34526188e4050213c2&#39;,
          &#39;\\META.yml&#39; =&gt; &#39;e3c799425617dc6e16fc8e1a1e199ff1&#39;,
          &#39;\\t\\1.t&#39; =&gt; &#39;8681363224414a42360a6b402d5558d4&#39;
        };


C:\temp&gt;perl -MData::Dumper -Mstrict -wle &#34;use Digest::MD5::File
qw&#40;dir_md5_hex&#41;;print Dumper dir_md5_hex&#40;&#39;c:/temp/Digest-MD5-File-0.05&#39;&#41;;&#34;
$VAR1 = {
          &#39;C:\\temp\\Digest-MD5-File-0.05\\MANIFEST&#39; =&gt;
&#39;5169dd7969c0a80650f514061d588c45&#39;,
          &#39;C:\\temp\\Digest-MD5-File-0.05\\README&#39; =&gt;
&#39;95075b9101ec1a34526188e4050213c2&#39;,
          &#39;C:\\temp\\Digest-MD5-File-0.05\\Changes&#39; =&gt;
&#39;d2003ddc44a2ec492a42080e561b1bb0&#39;,
          &#39;C:\\temp\\Digest-MD5-File-0.05\\File.pm&#39; =&gt;
&#39;5d7841457387ad47bf033952c5e2fde7&#39;,
          &#39;C:\\temp\\Digest-MD5-File-0.05\\t\\1.t&#39; =&gt;
&#39;8681363224414a42360a6b402d5558d4&#39;,
          &#39;C:\\temp\\Digest-MD5-File-0.05\\t&#39; =&gt; &#39;&#39;,
          &#39;C:\\temp\\Digest-MD5-File-0.05\\Makefile.PL&#39; =&gt;
&#39;783eaec26b9d8439b975f943b86c7f00&#39;,
          &#39;C:\\temp\\Digest-MD5-File-0.05\\META.yml&#39; =&gt;
&#39;e3c799425617dc6e16fc8e1a1e199ff1&#39;
        };


C:\temp&gt;perl -MData::Dumper -Mstrict -wle &#34;use Digest::MD5::File
qw&#40;dir_md5_hex&#41;;print Dumper dir_md5_hex&#40;&#39;c:\\temp\\Digest-MD5-File-0.05&#39;&#41;;&#34;
$VAR1 = {
          &#39;C:\\temp\\Digest-MD5-File-0.05\\MANIFEST&#39; =&gt;
&#39;5169dd7969c0a80650f514061d588c45&#39;,
          &#39;C:\\temp\\Digest-MD5-File-0.05\\README&#39; =&gt;
&#39;95075b9101ec1a34526188e4050213c2&#39;,
          &#39;C:\\temp\\Digest-MD5-File-0.05\\Changes&#39; =&gt;
&#39;d2003ddc44a2ec492a42080e561b1bb0&#39;,
          &#39;C:\\temp\\Digest-MD5-File-0.05\\File.pm&#39; =&gt;
&#39;5d7841457387ad47bf033952c5e2fde7&#39;,
          &#39;C:\\temp\\Digest-MD5-File-0.05\\t\\1.t&#39; =&gt;
&#39;8681363224414a42360a6b402d5558d4&#39;,
          &#39;C:\\temp\\Digest-MD5-File-0.05\\t&#39; =&gt; &#39;&#39;,
          &#39;C:\\temp\\Digest-MD5-File-0.05\\Makefile.PL&#39; =&gt;
&#39;783eaec26b9d8439b975f943b86c7f00&#39;,
          &#39;C:\\temp\\Digest-MD5-File-0.05\\META.yml&#39; =&gt;
&#39;e3c799425617dc6e16fc8e1a1e199ff1&#39;
        };


C:\temp&gt;



Thanks for the help!


joe
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;01&nbsp;20:21:23&nbsp;2007</span>
    <span class="description">webmaster [...] simplemood.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29653] Incorrect keys for dir_* under Win32 </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 1 Oct 2007 19:20:50 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Digest-MD5-File [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Daniel Muey &lt;webmaster [...] simplemood.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sat Sep 29 12:57:51 2007, DMUEY wrote:
&gt;
<div class="message-stanza open">&gt;&gt; Could you send me the output of these commands from your windows box
&gt;&gt; &#40;adjusting for
&gt;&gt; actual paths of course&#41;?
</div>&gt;
&gt; C:\temp&gt;ls Digest-MD5-File-0.05
&gt; Changes      MANIFEST     Makefile.PL  t
&gt; File.pm      META.yml     README
</div>
...

Thanks Joe, I&#39;ll look into it. Prolly some weirdness with Win32  
volumes + File::Spec + my lack of any Win32 boxes
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;01&nbsp;20:59:40&nbsp;2007</span>
    <span class="description">jcasadonte [...] northbound-train.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> jcasadonte [...] northbound-train.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Oct 01 20:21:23 2007, webmaster@simplemood.com wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks Joe, I&#39;ll look into it. Prolly some weirdness with Win32  
&gt; volumes + File::Spec + my lack of any Win32 boxes
</div>
I can delve into it as time permits, if you&#39;d like.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;24&nbsp;13:30:32&nbsp;2007</span>
    <span class="description">dmuey [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> DMUEY [...] cpan.org</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello Joe, 

Can you tell me if the attached file resolves the win32 issue?

Thanks!
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">package Digest::MD5::File;

use strict;
use warnings;
use Carp;
use Digest::MD5;
eval { require Encode; };
use LWP::UserAgent;

require Exporter;
our @ISA = qw&#40;Exporter Digest::MD5&#41;;
our @EXPORT_OK = qw&#40;dir_md5  dir_md5_hex  dir_md5_base64 
                    file_md5 file_md5_hex file_md5_base64 
                    url_md5  url_md5_hex  url_md5_base64&#41;;

our $BINMODE  = 1;
our $UTF8     = 0;
our $NOFATALS = 0;

sub import {
    my $me = shift;
    my %imp;

    @imp{ @_ } = &#40;&#41;;
    for&#40;@EXPORT_OK&#41; {
        delete $imp{$_} if exists&#40;$imp{$_}&#41;;
    }

    $BINMODE  = 0 if exists $imp{-nobin};
    $UTF8     = 1 if exists $imp{-utf8};
    $NOFATALS = 1 if exists $imp{-nofatals};

    for&#40;keys %imp&#41; { 
        s/^-//;
        $imp{$_}=&#39;&#39; unless $_ =~ m/^&#40;no&#41;?&#40;bin|utf8|fatals&#41;$/;
        push @EXPORT_OK, $_ unless $_ =~ m/^&#40;no&#41;?&#40;bin|utf8|fatals&#41;$/;
        delete $imp{&#34;-$_&#34;} if exists $imp{&#34;-$_&#34;};
    }

    $me-&gt;export_to_level&#40;1, $me, grep&#40;!/^-/, @_&#41;&#41;;
    Digest::MD5-&gt;import&#40;keys %imp&#41;;
}

our $VERSION = &#39;0.06&#39;;

my $getfh = sub {
    my $file = shift;

    croak &#34;$file: Does not exist&#34; if !-e $file &#38;&#38; !$NOFATALS;
    croak &#34;$file: Is a directory&#34; if -d $file &#38;&#38; !$NOFATALS;

    if&#40;-e $file &#38;&#38; !-d $file&#41; {
        open my &#40;$fh&#41;, $file or return;
        binmode $fh if $BINMODE;
        return $fh;
    } 
    else { return undef; }
};

my $getur = sub {
    my $res = LWP::UserAgent-&gt;new-&gt;get&#40;shift&#40;&#41;&#41;;
    return $res-&gt;is_success ? $res-&gt;content : undef;
};

sub Digest::MD5::adddir {
    my $md5  = shift;
    my $base = shift;
    for&#40; keys %{ _dir&#40;$base, undef, undef, 3&#41; }&#41; {
        next if !$_;
        my $file = File::Spec-&gt;catfile&#40;$base, $_&#41;;
        $md5-&gt;addpath&#40;$file&#41; or carp &#34;addpath $file failed: $!&#34; if !-d $file;
    }
    return 1;
}

sub _dir {
    my&#40;$dir, $hr, $base, $type, $cc&#41; = @_;
    require File::Spec;  # only load it if its needed

    $cc   = {} if ref $cc ne &#39;HASH&#39;; 
    $hr   = {} if ref $hr ne &#39;HASH&#39;;
    $base = $dir if !defined $base;
    $type = 0 if ! defined $type;

    my $_md5func = \&#38;file_md5;
    $_md5func    = \&#38;file_md5_hex    if $type eq &#39;1&#39;;
    $_md5func    = \&#38;file_md5_base64 if $type eq &#39;2&#39;;   

    opendir&#40;DIR, $dir&#41; or return;
    my @dircont = grep&#40; $_ ne &#39;.&#39; &#38;&#38; $_ ne &#39;..&#39;, readdir&#40;DIR&#41;&#41;;
    closedir DIR;

    for my $file&#40; @dircont &#41; {
        my $_dirver = File::Spec-&gt;catdir&#40;$dir, $file&#41;;
        my $full    = -d $_dirver ? $_dirver 
                                  : File::Spec-&gt;catfile&#40;$dir, $file&#41;;

        my $short = File::Spec-&gt;abs2rel&#40; $full, $base &#41;;
		
        if&#40;-l $full&#41; {
            my $target = readlink $full;
            $full      = $target if -d $target;
        }

        if&#40;exists $hr-&gt;{$full}&#41; {
            carp &#34;$full seen already, you may have circular links&#34;;
            $cc-&gt;{$full}++;
            croak &#34;$full is in a circular link, bailing out.&#34; 
                if $cc-&gt;{$full} &gt; 4;
        }

        if&#40;-d $full&#41; {
            $hr-&gt;{ $short } = &#39;&#39;;
            _dir&#40;$full, $hr, $base, $type, $cc&#41; or return;
        }
        else {
            $hr-&gt;{ $short } = &#39;&#39;;
            $hr-&gt;{ $short } = $_md5func-&gt;&#40; $full &#41; or return if $type ne &#39;3&#39;;
        } 
    }   
    return $hr;
}

sub dir_md5 {
    push @_, undef if @_ &lt; 3;
    push @_, undef if @_ &lt; 3;
    _dir&#40;@_, 0&#41;;
}

sub dir_md5_hex {
    push @_, undef if @_ &lt; 3;
    push @_, undef if @_ &lt; 3;
    _dir&#40;@_, 1&#41;;
}

sub dir_md5_base64 {
    push @_, undef if @_ &lt; 3;
    push @_, undef if @_ &lt; 3;
    _dir&#40;@_, 2&#41;;
}

sub file_md5 {
    my $fh         = $getfh-&gt;&#40;shift&#40;&#41;&#41; or return; 
    my &#40;$bn,$ut&#41;   = @_;
    local $BINMODE = $bn if defined $bn;
    local $UTF8    = $ut if defined $ut;
    my $md5 = Digest::MD5-&gt;new&#40;&#41;;
    while&#40;&lt;$fh&gt;&#41; {
	    $md5-&gt;add&#40; $UTF8 ? Encode::encode_utf8&#40;$_&#41; : $_ &#41;;
    }
    return $md5-&gt;digest;
}

sub file_md5_hex {
    my $fh         = $getfh-&gt;&#40;shift&#40;&#41;&#41; or return;
    my &#40;$bn,$ut&#41;   = @_;
    local $BINMODE = $bn if defined $bn;
    local $UTF8    = $ut if defined $ut;
    my $md5 = Digest::MD5-&gt;new&#40;&#41;;
    while&#40;&lt;$fh&gt;&#41; {
	    $md5-&gt;add&#40; $UTF8 ? Encode::encode_utf8&#40;$_&#41; : $_ &#41;;
    }
    return $md5-&gt;hexdigest;
} 

sub file_md5_base64 {
    my $fh         = $getfh-&gt;&#40;shift&#40;&#41;&#41; or return;
    my &#40;$bn,$ut&#41;   = @_;
    local $BINMODE = $bn if defined $bn;
    local $UTF8    = $ut if defined $ut;

    my $md5 = Digest::MD5-&gt;new&#40;&#41;;
    while&#40;&lt;$fh&gt;&#41; {
	    $md5-&gt;add&#40; $UTF8 ? Encode::encode_utf8&#40;$_&#41; : $_ &#41;;
    }
    return $md5-&gt;b64digest;
}

sub url_md5 {
    my $cn      = $getur-&gt;&#40;shift&#40;&#41;&#41; or return;
    my &#40;$ut&#41;    = shift;
    local $UTF8 = $ut if defined $ut;
    return Digest::MD5::md5&#40;$cn&#41; if !$UTF8;
    return Digest::MD5::md5&#40;Encode::encode_utf8&#40;$cn&#41;&#41;;
}

sub url_md5_hex {
    my $cn      = $getur-&gt;&#40;shift&#40;&#41;&#41; or return;
    my &#40;$ut&#41;    = shift;
    local $UTF8 = $ut if defined $ut;
    return Digest::MD5::md5_hex&#40;$cn&#41; if !$UTF8;
    return Digest::MD5::md5_hex&#40;Encode::encode_utf8&#40;$cn&#41;&#41;;
}

sub url_md5_base64 { 
    my $cn      = $getur-&gt;&#40;shift&#40;&#41;&#41; or return;
    my &#40;$ut&#41;    = shift;
    local $UTF8 = $ut if defined $ut;
    return Digest::MD5::md5_base64&#40;$cn&#41; if !$UTF8;
    return Digest::MD5::md5_base64&#40;Encode::encode_utf8&#40;$cn&#41;&#41;;
}

sub Digest::MD5::addpath {
    my $md5          = shift;
    my &#40;$fl,$bn,$ut&#41; = @_;
    local $BINMODE   = $bn if defined $bn;
    local $UTF8      = $ut if defined $ut;
    if&#40;ref $fl eq &#39;ARRAY&#39;&#41; {
        for&#40;@{ $fl }&#41; {
            $md5-&gt;addpath&#40;$_, $bn, $ut&#41; or return;
        }
    } 
    else {
        my $fh = $getfh-&gt;&#40;$fl&#41; or return;
        while&#40;&lt;$fh&gt;&#41; {
           !$UTF8 ? $md5-&gt;add&#40;$_&#41; : $md5-&gt;add&#40;Encode::encode_utf8&#40;$_&#41;&#41;;
        }
    }
    return 1;
}

sub Digest::MD5::addurl {
    my $md5     = shift;
    my $cn      = $getur-&gt;&#40;shift&#40;&#41;&#41; or return;
    my $ut      = shift;
    local $UTF8 = $ut if defined $ut;
    !$UTF8 ? $md5-&gt;add&#40;$cn&#41; : $md5-&gt;add&#40;Encode::encode_utf8&#40;$cn&#41;&#41;;
}

1;

__END__

=head1 NAME

Digest::MD5::File - Perl extension for getting MD5 sums for files and urls. 

=head1 SYNOPSIS

    use Digest::MD5::File qw&#40;dir_md5_hex file_md5_hex url_md5_hex&#41;;

    my $md5 = Digest::Md5-&gt;new;
    $md5-&gt;addpath&#40;&#39;/path/to/file&#39;&#41;;
    my $digest = $md5-&gt;hexdigest;

    my $digest = file_md5&#40;$file&#41;;
    my $digest = file_md5_hex&#40;$file&#41;;
    my $digest = file_md5_base64&#40;$file&#41;;

    my $md5 = Digest::Md5-&gt;new;
    $md5-&gt;addurl&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.tmbg.com/tour.html&#39;&#41;">http://www.tmbg.com/tour.html&#39;&#41;</a></span>;
    my $digest = $md5-&gt;hexdigest;

    my $digest = url_md5&#40;$url&#41;;
    my $digest = url_md5_hex&#40;$url&#41;;
    my $digest = url_md5_base64&#40;$url&#41;;
  
    my $md5 = Digest::Md5-&gt;new;
    $md5-&gt;adddir&#40;&#39;/directory&#39;&#41;;
    my $digest = $md5-&gt;hexdigest;

    my $dir_hashref = dir_md5&#40;$dir&#41;;    
    my $dir_hashref = dir_md5_hex&#40;$dir&#41;;    
    my $dir_hashref = dir_md5_base64&#40;$dir&#41;;

=head1 DESCRIPTION

  Get MD5 sums for files of a given path or content of a given url.

=head1 EXPORT

None by default.
You can export any file_* dir_*, or url_* function and anything L&lt;Digest::MD5&gt; can export.

   use Digest::MD5::File qw&#40;md5 md5_hex md5_base64&#41;; # 3 Digest::MD5 functions
   print md5_hex&#40;&#39;abc123&#39;&#41;, &#34;\n&#34;;
   print md5_base64&#40;&#39;abc123&#39;&#41;, &#34;\n&#34;;

=head1 OBJECT METHODS

=head2 addpath&#40;&#41;

    my $md5 = Digest::Md5-&gt;new;
    $md5-&gt;addpath&#40;&#39;/path/to/file.txt&#39;&#41; 
        or die &#34;file.txt is not where you said: $!&#34;;

or you can add multiple files by specifying an array ref of files:

    $md5-&gt;addpath&#40;\@files&#41;;

=head2 adddir&#40;&#41;
 
addpath&#40;&#41;s each file in a directory recursively. Follows the same rules as the dir_* functions.

    my $md5 = Digest::Md5-&gt;new;
    $md5-&gt;adddir&#40;&#39;/home/tmbg/&#39;&#41; 
        or die &#34;See warning above to see why I bailed: $!&#34;;

=head2 addurl&#40;&#41;

    my $md5 = Digest::Md5-&gt;new;
    $md5-&gt;addurl&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.tmbg.com/tour.html&#39;&#41;">http://www.tmbg.com/tour.html&#39;&#41;</a></span>
        or die &#34;They Must Be not on tour&#34;;

=head1 file_* functions

Get the digest in variouse formats of $file.
If file does not exist or is a directory it croaks &#40;See NOFATALS for more info&#41;

    my $digest = file_md5&#40;$file&#41; or warn &#34;$file failed: $!&#34;;
    my $digest = file_md5_hex&#40;$file&#41; or warn &#34;$file failed: $!&#34;;
    my $digest = file_md5_base64&#40;$file&#41; or warn &#34;$file failed: $!&#34;;

=head1 dir_* functions

Returns a hashref whose keys are files relative to the given path and the values are the MD5 sum of the file or and empty string if a directory.
It recurses through the entire depth of the directory.
Symlinks to files are just addpath&#40;&#41;d and symlinks to directories are followed.

    my $dir_hashref = dir_md5&#40;$dir&#41; or warn &#34;$dir failed: $!&#34;;
    my $dir_hashref = dir_md5_hex&#40;$dir&#41; or warn &#34;$dir failed: $!&#34;;
    my $dir_hashref = dir_md5_base64&#40;$dir&#41; or warn &#34;$dir failed: $!&#34;;

=head1 url_* functions

Get the digest in various formats of the content at $url &#40;Including, if $url points to directory, the directory listing content&#41;.
Returns undef if url fails &#40;IE if L&lt;LWP::UserAgent&gt;&#39;s $res-&gt;is_success is false&#41;

    my $digest = url_md5&#40;$url&#41; or warn &#34;$url failed&#34;; 
    my $digest = url_md5_hex&#40;$url&#41; or warn &#34;$url failed&#34;;
    my $digest = url_md5_base64&#40;$url&#41; or warn &#34;$url failed&#34;;

=head1 SPECIAL SETTINGS

=head2 BINMODE

By default files are opened in binmode. If you do not want to do this you can unset it a variety of ways:

    use Digest::MD5::File qw&#40;-nobin&#41;;

or

    $Digest::MD5::File::BINMODE = 0;

or at the function/method level by specifying its value as the second argument:

    $md5-&gt;addpath&#40;$file,0&#41;;

    my $digest = file_md5_hex&#40;$file,0&#41;;

=head2 UTF8

In some cases you may want to have your data utf8 encoded, you can do this the following ways:

    use Digest::MD5::File qw&#40;-utf8&#41;;

or

    $Digest::MD5::File::UTF8 = 1;

or at the function/method level by specifying its value as the third argument for files and second for urls:

    $md5-&gt;addpath&#40;$file,$binmode,1&#41;;

    my $digest = file_md5_hex&#40;$file,$binmode,1&#41;;

    $md5-&gt;addurl&#40;$url,1&#41;;

    url_md5_hex&#40;$url,1&#41;;

It use&#39;s L&lt;Encode&gt;&#39;s encode_utf8&#40;&#41; function to do the encoding. So if you do not have Encode &#40;pre 5.7.3&#41; this won&#39;t work :&#41;

=head2 NOFATALS

Instead of croaking it will return undef if you set NOFATALS to true.

You can do this two ways:

    $Digest::MD5::File::NOFATALS = 1;

or the -nofatals flag:

    use Digest::MD5::File qw&#40;-nofatals&#41;;

    my $digest = file_md5_hex&#40;$file&#41; or die &#34;$file failed&#34;;

$! is not set so its not really helpful if you die&#40;&#41;. 

=head1 SEE ALSO

L&lt;Digest::MD5&gt;, L&lt;Encode&gt;, L&lt;LWP::UserAgent&gt;

=head1 AUTHOR

Daniel Muey, L&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://drmuey.com/cpan_contact.pl">http://drmuey.com/cpan_contact.pl</a></span>&gt;

=head1 COPYRIGHT AND LICENSE

Copyright 2005 by Daniel Muey

This library is free software; you can redistribute it and/or modify
it under the same terms as Perl itself. 

=cut
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;24&nbsp;13:52:13&nbsp;2007</span>
    <span class="description">dmuey [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Shoudl be resolved in 0.06 &#40;just uploaded&#41; let me know how that works 
for you!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;29&nbsp;14:29:07&nbsp;2008</span>
    <span class="description">dmuey [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;29&nbsp;14:29:08&nbsp;2008</span>
    <span class="description">dmuey [...] cpan.org -  Fixed in 0.06 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
