<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #67149 for Test-Trap: Can&#39;t use an undefined value as an ARRAY reference at ... Test/Trap/Builder.pm line 97.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #67149 for Test-Trap: Can&#39;t use an undefined value as an ARRAY reference at ... Test/Trap/Builder.pm line 97.</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Test-Trap">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Test-Trap">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Test-Trap">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Test-Trap">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Test-Trap">Test-Trap CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">67149</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Test-Trap">Test-Trap</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">ebhanssen [...] allverden.no
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
gshank [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-40950-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-40951-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=67149">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-917812" href="/Public/Bug/Display.html?id=67149#txn-917812">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;01&nbsp;11:26:26&nbsp;2011</span>
    <span class="description">gshank [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Can&#39;t use an undefined value as an ARRAY reference at ...
 Test/Trap/Builder.pm line 97.</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/917812/476083/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/476083">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">When there are certain types of failures in my test cases, I get a
failure in Test::Trap instead. 

==============================
10_tests/unit/panel/06_noemail.pl
1..1
Can&#39;t use an undefined value as an ARRAY reference at
/home/intellisurvey/versions/6.4/isapps/lib/perl5/site_perl/5.12.3/Test/Trap/Builder.pm
line 97.
Can&#39;t use an undefined value as an ARRAY reference at
/home/intellisurvey/versions/6.4/isapps/lib/perl5/site_perl/5.12.3/Test/Trap/Builder.pm
line 97.
ok 1 - no total for addresses
==============================

If I modify line 97 to &#34;my @return = eval { @{$trap-&gt;return || []} };&#34;,
then I don&#39;t get the failure. I can reproduce easily, so I can provide
more information if you need it.

A piece of the debugger output follows.

==============================



  DB&lt;1&gt; x $trap                                                        
                                                                            
0  Test::Trap=HASH&#40;0xc662e20&#41;
   &#39; id &#39; =&gt; &#39;1301609166/32165/1&#39;
   &#39;die&#39; =&gt; &#39;Can\&#39;t locate IS/DataFile/Asciidelim.pm in @INC &#40;@INC
contains: /&lt;snip&gt;.pm line 36.
&#39;
   &#39;leaveby&#39; =&gt; &#39;die&#39;
   &#39;stderr&#39; =&gt; &#34;\e[31mCan&#39;t locate IS/DataFile/Asciidelim.pm in \@INC
&#40;\@INC contains: &lt;snip&gt;.pm line 36.\cJ\e[0m&#34;
   &#39;stdout&#39; =&gt; &#39;&#39;
   &#39;wantarray&#39; =&gt; 1
   &#39;warn&#39; =&gt; ARRAY&#40;0xbd86180&#41;
        empty array
  DB&lt;2&gt; n                                                              
                                                                            
Test::Trap::Builder::trap&#40;/home/intellisurvey/versions/6.4/isapps/lib/perl5/site_perl/5.12.3/Test/Trap/Builder.pm:98&#41;:
98:         my @return = eval { @{$trap-&gt;return || []} };
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-920762" href="/Public/Bug/Display.html?id=67149#txn-920762">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;08&nbsp;17:40:34&nbsp;2011</span>
    <span class="description">ebhanssen [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #67149] Can&#39;t use an undefined value as an ARRAY reference at ... Test/Trap/Builder.pm line 97.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 8 Apr 2011 23:40:24 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Trap [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Eirik Berg Hanssen &lt;ebhanssen [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/920762/477736/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/477736">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Apr 1, 2011 at 5:26 PM, Gerda Shank via RT &lt;
bug-Test-Trap@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 10_tests/unit/panel/06_noemail.pl
&gt; 1..1
&gt; Can&#39;t use an undefined value as an ARRAY reference at
&gt;
&gt; /home/intellisurvey/versions/6.4/isapps/lib/perl5/site_perl/5.12.3/Test/Trap/Builder.pm
&gt; line 97.
&gt; Can&#39;t use an undefined value as an ARRAY reference at
&gt;
&gt; /home/intellisurvey/versions/6.4/isapps/lib/perl5/site_perl/5.12.3/Test/Trap/Builder.pm
&gt; line 97.
&gt; ok 1 - no total for addresses
&gt; ==============================
&gt;
&gt; If I modify line 97 to &#34;my @return = eval { @{$trap-&gt;return || []} };&#34;,
&gt; then I don&#39;t get the failure. I can reproduce easily, so I can provide
&gt; more information if you need it.
&gt;
</div>
  That&#39;s kinda odd, isn&#39;t it?  Why doesn&#39;t the eval catch that exception?

  ... I assume this is not an April Fools prank? ;-&#41;

  Your modification makes sense, and I may well include it in my next
release &#40;a somewhat overdue collection of small fixes coming up&#41;, but I&#39;d
sure like to see code to reproduce it.  &#40;What are we talking – a &#34;__DIE__&#34;
handler?&#41;

  ... if nothing else, it is something I would like to have a regression
test for.


Eirik
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/920762/477737/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/477737">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.5k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-920765" href="/Public/Bug/Display.html?id=67149#txn-920765">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;08&nbsp;17:40:36&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-920766" href="/Public/Bug/Display.html?id=67149#txn-920766">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;08&nbsp;17:42:22&nbsp;2011</span>
    <span class="description">ebhanssen [...] allverden.no -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-921405" href="/Public/Bug/Display.html?id=67149#txn-921405">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;11&nbsp;10:10:19&nbsp;2011</span>
    <span class="description">gerda.shank [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #67149] Can&#39;t use an undefined value as an ARRAY reference at ... Test/Trap/Builder.pm line 97.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 11 Apr 2011 10:10:04 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Trap [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gerda Shank &lt;gerda.shank [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/921405/478087/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/478087">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 4/8/11 5:40 PM, ebhanssen via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;    That&#39;s kinda odd, isn&#39;t it?  Why doesn&#39;t the eval catch that exception?
&gt;
&gt;    ... I assume this is not an April Fools prank? ;-&#41;
&gt;
&gt;    Your modification makes sense, and I may well include it in my next
&gt; release &#40;a somewhat overdue collection of small fixes coming up&#41;, but I&#39;d
&gt; sure like to see code to reproduce it.  &#40;What are we talking – a &#34;__DIE__&#34;
&gt; handler?&#41;
</div>Yes, we do have a DIE handler during our tests:

         $SIG{__DIE__} = sub {
             if &#40; ref $_[0] and UNIVERSAL::can&#40; $_[0], &#39;tostring&#39; &#41; &#41; {
                 return $_[0]-&gt;tostring&#40;1&#41;;
             }
             return use_tracing&#40;&#41;
                 ? Carp::confess&#40; RED, @_, RESET &#41;
                 : print STDERR RED, @_, RESET;
             }
     }

&#40;use_tracing checks for a flag, which in these cases is not true, so the 
print STDERR thing happens&#41;.

It doesn&#39;t seem very sensible of the DIE handler to do a return of a 
&#39;print&#39; statement. I&#39;ll try to get that changed.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;    ... if nothing else, it is something I would like to have a regression
&gt; test for.
&gt;
&gt;
&gt; Eirik
&gt;
</div>The next couple of days will be kind of busy, but I could try to boil it 
down to a test case later this week...

Gerda
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-941742" href="/Public/Bug/Display.html?id=67149#txn-941742">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;02&nbsp;17:19:20&nbsp;2011</span>
    <span class="description">ebhanssen [...] allverden.no -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/941742/489628/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/489628">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Apr 11 10:10:19 2011, gerda.shank@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 4/8/11 5:40 PM, ebhanssen via RT wrote:
<div class="message-stanza open">&gt; &gt;    Your modification makes sense, and I may well include it in my next
&gt; &gt; release &#40;a somewhat overdue collection of small fixes coming up&#41;,
</div></div>but I&#39;d
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; sure like to see code to reproduce it.  &#40;What are we talking – a
</div></div>&#34;__DIE__&#34;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; handler?&#41;
</div>&gt; Yes, we do have a DIE handler during our tests:
&gt; 
&gt;          $SIG{__DIE__} = sub {
&gt;              if &#40; ref $_[0] and UNIVERSAL::can&#40; $_[0], &#39;tostring&#39; &#41; &#41; {
&gt;                  return $_[0]-&gt;tostring&#40;1&#41;;
&gt;              }
&gt;              return use_tracing&#40;&#41;
&gt;                  ? Carp::confess&#40; RED, @_, RESET &#41;
&gt;                  : print STDERR RED, @_, RESET;
&gt;              }
&gt;      }
</div>
  Ah yes; that would do it.

  Sorry I&#39;m late in replying.  Aside from having other things on my mind
lately, I have been wondering just how to deal with this.  Your
suggested patch handles this exact problem, but it fails to handle
problems arising when the return&#40;&#41; method is overridden, and something
inside it dies – while there is a noisy __DIE__ handler about.

  And that also points out to me that I&#39;ve been neglecting to document
that the trap object should respond to a return&#40;&#41; method call in the
first place.  A hole in the API, that is.

  Rather than calling arbitrary methods of the trap class from the
builder class, there should be an API so that the layer trapping the
return values &#40;or even something else&#41; could store them so that the
builder knows how to retrieve them.  I suppose.  But I&#39;m in doubt, and
I&#39;m not even sure why.  Need to sleep on it some more, I fear.

-- 
Eirik Berg Hanssen, ebhanssen@allverden.no
      Just this .sig then
              nothing more
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.402017</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
