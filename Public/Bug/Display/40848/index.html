<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #40848 for Moose: Inherited modified attributes destroy up-chain method-modifiers</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #40848 for Moose: Inherited modified attributes destroy up-chain method-modifiers</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Moose">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Moose">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Moose">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Moose">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Moose">Moose CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">40848</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Moose">Moose</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">stevan.little [...] gmail.com
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
megamic [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-38786-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.61    </td>
  </tr>
  <tr id="CF-38787-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=40848">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-531794" href="/Public/Bug/Display.html?id=40848#txn-531794">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;12&nbsp;02:15:39&nbsp;2008</span>
    <span class="description">megamic [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Inherited modified attributes destroy up-chain method-modifiers</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/531794/266477/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/266477">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I recently had had a need to use the &#39;has +$name&#39; syntax to modify the
ISA option of an inherited attribute. It turned out that in the base
class, I had used &#39;before&#39; to wrap an accessor. I noticed that when I
then called the accessor from an instance of my extended class, the
before routine was not being called.

The issue is obviously that the &#39;has +$name&#39; will re-install all the
accessors over again, effectively destroying any other methods that may
have been installed in their place from the base class, method-modifiers
such as before,after,etc. being prime examples. 

Note that this issue also affects MooseX::Attribute helpers, in that the
&#39;provides&#39; and &#39;curries&#39; handlers will re-install methods in the class,
again overwriting method modifiers from the base class. In fact, this is
really the situation I had experienced: I had &#39;provides&#39; install a
&#39;get_thing&#39; method on an attribute, which was wrapped by a &#39;before&#39;
method, and was subsequently destroyed by the extended class&#39; &#39;has&#39;
method re-installing all the &#39;provides&#39; methods.

I think this qualifies as a bug, as it is really unexpected behavior,
&#39;before&#39; methods are ordinarily carried through inheritance, and there
is nothing implicit in changing an attribute &#40;say &#39;required&#39;&#41; with &#39;has
+$name&#39; which would suggest that all your method modifying get destroyed.

The following code illustrates the problem:
package Foo;
use Moose;

has name =&gt; &#40;is =&gt; &#39;rw&#39;, isa =&gt; &#39;Str&#39;&#41;;

before name =&gt; sub { warn &#34;before\n&#34; };

1;

package Bar;
use Moose;

extends &#39;Foo&#39;;

has &#39;+name&#39; =&gt; &#40;required =&gt; 0&#41;;

1;

my $foo = new Foo;
my $bar = new Bar;

$foo-&gt;name&#40;&#39;bob&#39;&#41;; // This prints &#39;before&#39;...
$bar-&gt;name&#40;&#39;jim&#39;&#41;; // this doesnt.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-533209" href="/Public/Bug/Display.html?id=40848#txn-533209">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;14&nbsp;21:28:28&nbsp;2008</span>
    <span class="description">stevan.little [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/533209/267357/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/267357">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I do not consider this a bug, an annoyance maybe, but not a bug. 

As you figured out, the +name syntax copies the superclass attribute and then installs it in the local 
class, overriding everything that was inherited. Because of this, +name should not be considered to be 
so magical as to know what you may and may not inherit. It is sort of &#34;brute force&#34; in that sense.

My feeling is that the complexity of making it more magical and all the permutations of interactions that 
would result would be less intuitive and more difficult to work with and work around. As you discovered 
when you encountered this bug, what was actually happening was pretty obvious and simple, thus easier 
to work with and work around.

However, if you disagree with me, I am willing to discuss this in more detail, but please take it to the 
moose mailing list &#40;moose@perl.org&#41; so that the rest of the community can take part of it. 

Thanks,

- Stevan




On Wed Nov 12 02:15:39 2008, MEGAMIC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I recently had had a need to use the &#39;has +$name&#39; syntax to modify the
&gt; ISA option of an inherited attribute. It turned out that in the base
&gt; class, I had used &#39;before&#39; to wrap an accessor. I noticed that when I
&gt; then called the accessor from an instance of my extended class, the
&gt; before routine was not being called.
&gt; 
&gt; The issue is obviously that the &#39;has +$name&#39; will re-install all the
&gt; accessors over again, effectively destroying any other methods that may
&gt; have been installed in their place from the base class, method-modifiers
&gt; such as before,after,etc. being prime examples. 
&gt; 
&gt; Note that this issue also affects MooseX::Attribute helpers, in that the
&gt; &#39;provides&#39; and &#39;curries&#39; handlers will re-install methods in the class,
&gt; again overwriting method modifiers from the base class. In fact, this is
&gt; really the situation I had experienced: I had &#39;provides&#39; install a
&gt; &#39;get_thing&#39; method on an attribute, which was wrapped by a &#39;before&#39;
&gt; method, and was subsequently destroyed by the extended class&#39; &#39;has&#39;
&gt; method re-installing all the &#39;provides&#39; methods.
&gt; 
&gt; I think this qualifies as a bug, as it is really unexpected behavior,
&gt; &#39;before&#39; methods are ordinarily carried through inheritance, and there
&gt; is nothing implicit in changing an attribute &#40;say &#39;required&#39;&#41; with &#39;has
&gt; +$name&#39; which would suggest that all your method modifying get destroyed.
&gt; 
&gt; The following code illustrates the problem:
&gt; package Foo;
&gt; use Moose;
&gt; 
&gt; has name =&gt; &#40;is =&gt; &#39;rw&#39;, isa =&gt; &#39;Str&#39;&#41;;
&gt; 
&gt; before name =&gt; sub { warn &#34;before\n&#34; };
&gt; 
&gt; 1;
&gt; 
&gt; package Bar;
&gt; use Moose;
&gt; 
&gt; extends &#39;Foo&#39;;
&gt; 
&gt; has &#39;+name&#39; =&gt; &#40;required =&gt; 0&#41;;
&gt; 
&gt; 1;
&gt; 
&gt; my $foo = new Foo;
&gt; my $bar = new Bar;
&gt; 
&gt; $foo-&gt;name&#40;&#39;bob&#39;&#41;; // This prints &#39;before&#39;...
&gt; $bar-&gt;name&#40;&#39;jim&#39;&#41;; // this doesnt.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-533210" href="/Public/Bug/Display.html?id=40848#txn-533210">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;14&nbsp;21:28:32&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-533213" href="/Public/Bug/Display.html?id=40848#txn-533213">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;14&nbsp;21:28:33&nbsp;2008</span>
    <span class="description">stevan.little [...] gmail.com -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Give odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-533214" href="/Public/Bug/Display.html?id=40848#txn-533214">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;14&nbsp;21:28:35&nbsp;2008</span>
    <span class="description">stevan.little [...] gmail.com -  Given to STEVAN</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-533448" href="/Public/Bug/Display.html?id=40848#txn-533448">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;15&nbsp;15:31:57&nbsp;2008</span>
    <span class="description">megamic [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> moose [...] perl.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #40848] Inherited modified attributes destroy up-chain method-modifiers</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 15 Nov 2008 12:31:32 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Moose [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Michael Potter&#34; &lt;megamic [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/533448/267492/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/267492">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Nov 14, 2008 at 6:28 PM, Stevan Little via RT &lt;bug-Moose@rt.cpan.org
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; wrote:
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=40848">http://rt.cpan.org/Ticket/Display.html?id=40848</a></span> &gt;
&gt;
&gt; I do not consider this a bug, an annoyance maybe, but not a bug.
</div>

After looking a bit more deeply about how Moose handles attribute
inheritance, I tend to agree with you now. I was originally thinking the
&#39;has +&#39; notation modified the base class&#39;s attribute &#40;but in a way only
visible to the derived class&#41;, but now I realize it just creates a new
attribute in the derived class with options copied from the base class, and
everything that comes with that.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;
&gt; As you figured out, the +name syntax copies the superclass attribute and
&gt; then installs it in the local
&gt; class, overriding everything that was inherited. Because of this, +name
&gt; should not be considered to be
&gt; so magical as to know what you may and may not inherit. It is sort of
&gt; &#34;brute force&#34; in that sense.
</div>

Awww...I like magic!


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;
&gt; My feeling is that the complexity of making it more magical and all the
&gt; permutations of interactions that
&gt; would result would be less intuitive and more difficult to work with and
&gt; work around. As you discovered
&gt; when you encountered this bug, what was actually happening was pretty
&gt; obvious and simple, thus easier
&gt; to work with and work around.
</div>

Fine. I would love to know a straightforward work-around though, that does
not drastically alter class structures. Would it be to much to ask for an
option to &#39;has +&#39; that simply disables any accessor generation &#40;and
provides/curries methods&#41;, that is totally *use-at-own-risk* and would
assume all the appropriate methods were installed in the base class?


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;
&gt; However, if you disagree with me, I am willing to discuss this in more
&gt; detail, but please take it to the
&gt; moose mailing list &#40;moose@perl.org&#41; so that the rest of the community can
&gt; take part of it.
</div>

Ok I will CC my reply to this to the list.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;
&gt; Thanks,
&gt;
&gt; - Stevan
&gt;
&gt;
&gt;
&gt;
&gt; On Wed Nov 12 02:15:39 2008, MEGAMIC wrote:
<div class="message-stanza open">&gt; &gt; I recently had had a need to use the &#39;has +$name&#39; syntax to modify the
&gt; &gt; ISA option of an inherited attribute. It turned out that in the base
&gt; &gt; class, I had used &#39;before&#39; to wrap an accessor. I noticed that when I
&gt; &gt; then called the accessor from an instance of my extended class, the
&gt; &gt; before routine was not being called.
&gt; &gt;
&gt; &gt; The issue is obviously that the &#39;has +$name&#39; will re-install all the
&gt; &gt; accessors over again, effectively destroying any other methods that may
&gt; &gt; have been installed in their place from the base class, method-modifiers
&gt; &gt; such as before,after,etc. being prime examples.
&gt; &gt;
&gt; &gt; Note that this issue also affects MooseX::Attribute helpers, in that the
&gt; &gt; &#39;provides&#39; and &#39;curries&#39; handlers will re-install methods in the class,
&gt; &gt; again overwriting method modifiers from the base class. In fact, this is
&gt; &gt; really the situation I had experienced: I had &#39;provides&#39; install a
&gt; &gt; &#39;get_thing&#39; method on an attribute, which was wrapped by a &#39;before&#39;
&gt; &gt; method, and was subsequently destroyed by the extended class&#39; &#39;has&#39;
&gt; &gt; method re-installing all the &#39;provides&#39; methods.
&gt; &gt;
&gt; &gt; I think this qualifies as a bug, as it is really unexpected behavior,
&gt; &gt; &#39;before&#39; methods are ordinarily carried through inheritance, and there
&gt; &gt; is nothing implicit in changing an attribute &#40;say &#39;required&#39;&#41; with &#39;has
&gt; &gt; +$name&#39; which would suggest that all your method modifying get destroyed.
&gt; &gt;
&gt; &gt; The following code illustrates the problem:
&gt; &gt; package Foo;
&gt; &gt; use Moose;
&gt; &gt;
&gt; &gt; has name =&gt; &#40;is =&gt; &#39;rw&#39;, isa =&gt; &#39;Str&#39;&#41;;
&gt; &gt;
&gt; &gt; before name =&gt; sub { warn &#34;before\n&#34; };
&gt; &gt;
&gt; &gt; 1;
&gt; &gt;
&gt; &gt; package Bar;
&gt; &gt; use Moose;
&gt; &gt;
&gt; &gt; extends &#39;Foo&#39;;
&gt; &gt;
&gt; &gt; has &#39;+name&#39; =&gt; &#40;required =&gt; 0&#41;;
&gt; &gt;
&gt; &gt; 1;
&gt; &gt;
&gt; &gt; my $foo = new Foo;
&gt; &gt; my $bar = new Bar;
&gt; &gt;
&gt; &gt; $foo-&gt;name&#40;&#39;bob&#39;&#41;; // This prints &#39;before&#39;...
&gt; &gt; $bar-&gt;name&#40;&#39;jim&#39;&#41;; // this doesnt.
</div>&gt;
&gt;
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/533448/267493/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/267493">with headers</a>
<br />
<span class="downloadcontenttype">text/html 5.3k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-533449" href="/Public/Bug/Display.html?id=40848#txn-533449">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;15&nbsp;15:32:02&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-565169" href="/Public/Bug/Display.html?id=40848#txn-565169">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;09&nbsp;20:42:57&nbsp;2009</span>
    <span class="description">rt.cpan [...] sartak.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.398519</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
