<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #19564 for Test-HTTP-Server-Simple: Version 0.02 fails on ActivePerl 5.8.8 of Win32</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #19564 for Test-HTTP-Server-Simple: Version 0.02 fails on ActivePerl 5.8.8 of Win32</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Test-HTTP-Server-Simple">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Test-HTTP-Server-Simple">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Test-HTTP-Server-Simple">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Test-HTTP-Server-Simple">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Test-HTTP-Server-Simple">Test-HTTP-Server-Simple CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">19564</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Test-HTTP-Server-Simple">Test-HTTP-Server-Simple</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
agentzh [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-31450-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.02    </td>
  </tr>
  <tr id="CF-31451-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Simple.pm<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/282564/126883/Simple.pm">
Thu Jan 11 04:27:13 2007 (6.4k) by smueller [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=19564">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-200687" href="/Public/Bug/Display.html?id=19564#txn-200687">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;29&nbsp;04:01:28&nbsp;2006</span>
    <span class="description">agentzh [...] yahoo.cn -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Version 0.02 fails on ActivePerl 5.8.8 of Win32</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/200687/74835/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/74835">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Test::HTTP::Server::Simple 0.02 fails on ActivePerl 5.8.8 while the
older version &#40;0.01&#41; can pass all the tests there. The error messages I
got while I was trying to install the version 0.02 via the cpan utility
are as follows:

        D:\Perl\bin\perl.exe &#34;-MExtUtils::Command::MM&#34; &#34;-e&#34;
&#34;test_harness&#40;0, &#39;bl
ib\lib&#39;, &#39;blib\arch&#39;&#41;&#34; t/*.t
t/00.load.........ok 1/1# Testing Test::HTTP::Server::Simple 0.02
t/00.load.........ok
t/01.basic........No such signal: SIGUSR1 at
D:\Perl\cpan\build\Test-HTTP-Server
-Simple-0.02\blib\lib/Test/HTTP/Server/Simple.pm line 96, &lt;DATA&gt; line 16.
No such signal: SIGUSR1 at
D:\Perl\cpan\build\Test-HTTP-Server-Simple-0.02\blib\
lib/Test/HTTP/Server/Simple.pm line 96, &lt;DATA&gt; line 16.
No such signal: SIGUSR1 at t/01.basic.t line 9, &lt;DATA&gt; line 16.
No such signal: SIGUSR1 at
D:\Perl\cpan\build\Test-HTTP-Server-Simple-0.02\blib\
lib/Test/HTTP/Server/Simple.pm line 96, &lt;DATA&gt; line 16.
t/01.basic........ok 1/6No such signal: SIGUSR1 at
D:\Perl\cpan\build\Test-HTTP-
Server-Simple-0.02\blib\lib/Test/HTTP/Server/Simple.pm line 96, &lt;DATA&gt;
line 16.
No such signal: SIGUSR1 at t/01.basic.t line 15, &lt;DATA&gt; line 16.
No such signal: SIGUSR1 at
D:\Perl\cpan\build\Test-HTTP-Server-Simple-0.02\blib\
lib/Test/HTTP/Server/Simple.pm line 96, &lt;DATA&gt; line 16.
No such signal: SIGUSR1 at
D:\Perl\cpan\build\Test-HTTP-Server-Simple-0.02\blib\
lib/Test/HTTP/Server/Simple.pm line 96, &lt;DATA&gt; line 16.
No such signal: SIGUSR1 at t/01.basic.t line 19, &lt;DATA&gt; line 16.

#   Failed test &#39;start up correctly&#39;
#   in t/01.basic.t at line 21.
# STDOUT is:
# not ok 1 - beep
#
# not:
# ok 1 - beep
#
# as expected
# STDERR is:
# #   Failed test &#39;beep&#39;
t/01.basic........NOK 3# #   in t/01.basic.t at line 19.
# # HTTP::Server::Simple-&gt;background failed: Unrecognized signal name
&#34;USR1&#34; at
D:\Perl\cpan\build\Test-HTTP-Server-Simple-0.02\blib\lib/Test/HTTP/Server/Simple
.pm line 140, &lt;DATA&gt; line 16.
#
# not:
# # Waiting for child to start up...
#
# as expected

t/01.basic........NOK 4#   Failed test in t/01.basic.t at line 23.
#          got: undef
#     expected: &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://localhost:9583">http://localhost:9583</a></span>&#39;

t/01.basic........NOK 5#   Failed test &#39;start up correctly &#40;with default
message
&#41;&#39;
#   in t/01.basic.t at line 28.
# STDOUT is:
# not ok 1 - started server
#
# not:
# ok 1 - started server
#
# as expected
# STDERR is:
# #   Failed test &#39;started server&#39;
# #   in t/01.basic.t at line 26.
# # HTTP::Server::Simple-&gt;background failed: Unrecognized signal name
&#34;USR1&#34; at
D:\Perl\cpan\build\Test-HTTP-Server-Simple-0.02\blib\lib/Test/HTTP/Server/Simple
.pm line 140, &lt;DATA&gt; line 16.
#
# not:
# # Waiting for child to start up...
#
# as expected

t/01.basic........NOK 6#   Failed test in t/01.basic.t at line 30.
#          got: undef
#     expected: &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://localhost:9384">http://localhost:9384</a></span>&#39;
&#40;segfault here&#41;

Hopefully the author will fix this Win32 issue because Jifty currently
depends on this module. :&#41;

Cheers,
Agent
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-227849" href="/Public/Bug/Display.html?id=19564#txn-227849">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;27&nbsp;14:37:02&nbsp;2006</span>
    <span class="description">GLASSER [...] CPAN.ORG -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/227849/94817/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/94817">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 394b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon May 29 04:01:28 2006, AGENT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Test::HTTP::Server::Simple 0.02 fails on ActivePerl 5.8.8 while the
&gt; older version &#40;0.01&#41; can pass all the tests there.
</div>
That is correct. THHS uses signals which windows doesn&#39;t support.

I would like THHS to support Windows, but I&#39;m not an expert on their IPC
capabilities. I&#39;d be happy to accept any patches to fix this.


--dave
-- 
David Glasser
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-227850" href="/Public/Bug/Display.html?id=19564#txn-227850">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;27&nbsp;14:37:10&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-227853" href="/Public/Bug/Display.html?id=19564#txn-227853">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;27&nbsp;14:37:13&nbsp;2006</span>
    <span class="description">GLASSER [...] CPAN.ORG -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-227854" href="/Public/Bug/Display.html?id=19564#txn-227854">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;27&nbsp;14:37:54&nbsp;2006</span>
    <span class="description">GLASSER [...] CPAN.ORG -  Severity Critical changed to Wishlist</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-276154" href="/Public/Bug/Display.html?id=19564#txn-276154">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;14&nbsp;15:04:43&nbsp;2006</span>
    <span class="description">smueller [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/276154/123417/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/123417">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi dave,

I have some good and some bad news for you:

The good is that it&#39;s possible to make the child &#40;which is really a
thread in the main process&#41; signal the parent that it&#39;s ready without
resorting to &#40;POSIX&#41; signals. Here is some code that exhibits this:


use Win32::Event;
my $event = Win32::Event-&gt;new&#40;&#41;;

my $pid;
if &#40;$pid = fork&#41; {
        # child
        print &#34;$pid: Sleep some\n&#34;;
        sleep 3;
        print &#34;$pid: Done sleeping\n&#34;;
        $event-&gt;pulse&#40;&#41;;
        print &#34;$pid: Exiting.\n&#34;;
        exit;
}
else {
        # parent
        print &#34;$pid: Waiting on event\n&#34;;
        $event-&gt;wait&#40;&#41;;
        print &#34;$pid: Done waiting\n&#34;;
        exit;
}

The bad news is two-fold. First, if the child doesn&#39;t exit, the parent
won&#39;t either. If you replace the child&#39;s exit&#40;&#41; with a &#34;sleep 1 while
1;&#34;, then the parent will exit, but the program continues to run forever.
Second, there is, to my knowledge, no way to *safely* kill a child
&#34;process&#34;. Since this whole fork&#40;&#41; thing is implemented internally with
threads, using kill&#40;&#41; to send the child a KILL signal might make perl
dump core. Sometimes...

I don&#39;t know of workarounds for these two problems. They may exist, but
I&#39;m just another Linux user with some Win32 exposure.

Steffen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-276155" href="/Public/Bug/Display.html?id=19564#txn-276155">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;14&nbsp;15:05:07&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-276347" href="/Public/Bug/Display.html?id=19564#txn-276347">#</a>      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;15&nbsp;11:55:49&nbsp;2006</span>
    <span class="description">jesse [...] fsck.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #19564] Version 0.02 fails on ActivePerl 5.8.8 of Win32</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 15 Dec 2006 11:55:41 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-test-http-server-simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> jesse &lt;jesse [...] fsck.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/276347/123528/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/123528">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks! this sounds like...at least much more of a start than we had
before.


On Thu, Dec 14, 2006 at 03:05:08PM -0500, Steffen M?ller via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt;        Queue: Test-HTTP-Server-Simple
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=19564">http://rt.cpan.org/Ticket/Display.html?id=19564</a></span> &gt;
&gt; 
&gt; Hi dave,
&gt; 
&gt; I have some good and some bad news for you:
&gt; 
&gt; The good is that it&#39;s possible to make the child &#40;which is really a
&gt; thread in the main process&#41; signal the parent that it&#39;s ready without
&gt; resorting to &#40;POSIX&#41; signals. Here is some code that exhibits this:
&gt; 
&gt; 
&gt; use Win32::Event;
&gt; my $event = Win32::Event-&gt;new&#40;&#41;;
&gt; 
&gt; my $pid;
&gt; if &#40;$pid = fork&#41; {
&gt;       # child
&gt;       print &#34;$pid: Sleep some\n&#34;;
&gt;       sleep 3;
&gt;       print &#34;$pid: Done sleeping\n&#34;;
&gt;       $event-&gt;pulse&#40;&#41;;
&gt;       print &#34;$pid: Exiting.\n&#34;;
&gt;       exit;
&gt; }
&gt; else {
&gt;       # parent
&gt;       print &#34;$pid: Waiting on event\n&#34;;
&gt;       $event-&gt;wait&#40;&#41;;
&gt;       print &#34;$pid: Done waiting\n&#34;;
&gt;       exit;
&gt; }
&gt; 
&gt; The bad news is two-fold. First, if the child doesn&#39;t exit, the parent
&gt; won&#39;t either. If you replace the child&#39;s exit&#40;&#41; with a &#34;sleep 1 while
&gt; 1;&#34;, then the parent will exit, but the program continues to run forever.
&gt; Second, there is, to my knowledge, no way to *safely* kill a child
&gt; &#34;process&#34;. Since this whole fork&#40;&#41; thing is implemented internally with
&gt; threads, using kill&#40;&#41; to send the child a KILL signal might make perl
&gt; dump core. Sometimes...
&gt; 
&gt; I don&#39;t know of workarounds for these two problems. They may exist, but
&gt; I&#39;m just another Linux user with some Win32 exposure.
&gt; 
&gt; Steffen
&gt; 
</div>
-- 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-282564" href="/Public/Bug/Display.html?id=19564#txn-282564">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;11&nbsp;04:27:10&nbsp;2007</span>
    <span class="description">smueller [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/282564/126880/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/126880">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Dec 15 11:55:49 2006, jesse@fsck.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks! this sounds like...at least much more of a start than we had
&gt; before.
</div>
I got it to work! It&#39;s not great and uses hack after hack, but the
attached Test/HTTP/Server/Simple.pm passes its tests on win32.

I didn&#39;t document anything nor modified the comments according to what I
did. That&#39;s left for the maintainer ;&#41;

Also, I haven&#39;t tested whether my changes break other OS&#39;s.

There are at least three gotchas with this:
- On very, very slow computers, it might happen that one gets an &#34;all
subtests passed and the process returned status &#34;9&#34; thereafter. ==&gt; The
main process exited too quickly for the child thread to be reaped
completely -- or so.
- Using kill 9 on win32 to kill the children ==&gt; no Devel::Cover support.
- Also following from kill 9: if the test process is running lots of
server instances, this is a problem because the memory that was used by
the thread will not be reclaimed. Solution: Use separate test scripts if
you plan to run lots of server instances and fear they might end up
eating all memory.

I doubt it&#39;s possible to make this work much better on win32 without a
lot of effort.

Steffen
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/282564/126883/Simple.pm">Download Simple.pm</a><br />
<span class="downloadcontenttype">text/x-perl 6.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">package Test::HTTP::Server::Simple;

our $VERSION = &#39;0.03&#39;;

use warnings;
use strict;
use Carp;

use NEXT;

use Test::Builder;
my $Tester = Test::Builder-&gt;new;

use constant WIN32 =&gt; $^O =~ /win32/i;

my $Event; # used on win32 only
if &#40;WIN32&#41; {
    require Win32::Event;
    $Event = Win32::Event-&gt;new&#40;&#41;;
}

=head1 NAME

Test::HTTP::Server::Simple - Test::More functions for HTTP::Server::Simple


=head1 SYNOPSIS

    package My::WebServer;
    use base qw/Test::HTTP::Server::Simple HTTP::Server::Simple/;
    
    package main;
    use Test::More tests =&gt; 42;
    
    my $s = My::WebServer-&gt;new;

    my $url_root = $s-&gt;started_ok&#40;&#34;start up my web server&#41;;

    # connect to &#34;$url_root/cool/site&#34; and test with Test::WWW::Mechanize,
    # Test::HTML::Tidy, etc

  
=head1 DESCRIPTION

This mixin class provides methods to test an L&lt;HTTP::Server::Simple&gt;-based web
server.  Currently, it provides only one such method: C&lt;started_ok&gt;.

=over 4 

=item started_ok [$text]

C&lt;started_ok&gt; takes 
an optional test description.  The server needs to have been configured &#40;specifically,
its port needs to have been set&#41;, but it should not have been run or backgrounded.
C&lt;started_ok&gt; calls C&lt;background&gt; on the server, which forks it to run in the background.
L&lt;Test::HTTP::Server::Simple&gt; takes care of killing the server when your test script dies,
even if you kill your test script with an interrupt.  C&lt;started_ok&gt; returns the URL 
C&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://localhost">http://localhost</a></span>:$port&gt; which you can use to connect to your server.

Note that if the child process dies, or never gets around to listening for connections, this
just hangs.  &#40;This may be fixed in a future version.&#41;

Also, it probably won&#39;t work if you use a custom L&lt;Net::Server&gt; in your server.

=cut

my @CHILD_PIDS;

# If an interrupt kills perl, END blocks are not run.  This
# essentially converts interrupts &#40;like CTRL-C&#41; into a standard
# perl exit &#40;even if we&#39;re inside an eval {}&#41;.
$SIG{INT} = sub { warn &#34;INT:$$&#34;; exit };

END {
    if &#40;WIN32&#41; {
        # INT won&#39;t do since the server is doing a blocking read
        # which isn&#39;t interrupted by anything but KILL on win32.
        kill 9, $_ for @CHILD_PIDS;
        sleep 1;
        foreach &#40;@CHILD_PIDS&#41; {
            sleep 1 while kill 0, $_;
        }
    }
    else {
        kill &#39;USR1&#39;, @CHILD_PIDS if @CHILD_PIDS;
    }
} 

sub started_ok {
    my $self = shift;
    my $text   = shift;
    $text = &#39;started server&#39; unless defined $text;

    my $port = $self-&gt;port;
    my $pid;

    $self-&gt;{&#39;test_http_server_simple_parent_pid&#39;} = $$;

    my $child_loaded_yet = 0;

    # So this is a little complicated.  The following signal handler does two
    # ENTIRELY DIFFERENT things:
    #
    #  In the parent, it just sets $child_loaded_yet, which breaks out of the
    #  while loop below.  It&#39;s activated by the kid sending it a SIGUSR1 after
    #  it runs setup_listener
    #
    #  In the kid, it sets the variable, but that&#39;s basically pointless since
    #  the call to -&gt;background doesn&#39;t actually return in the kid.  But also,
    #  it exits.  And when you actually exit with &#39;exit&#39; &#40;as opposed to being
    #  killed by a signal&#41; END blocks get run.  Which means that you can use
    #  Devel::Cover to test the kid&#39;s coverage.  This one is activated by the
    #  parent&#39;s END block in this file.

    local %SIG;
    if &#40;not WIN32&#41; {
        $SIG{&#39;USR1&#39;} = sub { $child_loaded_yet = 1; exit unless $self-&gt;{&#39;test_http_server_simple_parent_pid&#39;} == $$ }
    }

    # XXX TODO FIXME should somehow not have the signal handler around in the
    # kid
    # Comment: How about if &#40;$pid&#41; { $SIG{&#39;USR1&#39;} = ... }?
    
    eval { $pid = $self-&gt;background; };

    if &#40;$@&#41; {
        my $error_text = $@;  # In case the next line changes it.
        $Tester-&gt;ok&#40;0, $text&#41;;
        $Tester-&gt;diag&#40;&#34;HTTP::Server::Simple-&gt;background failed: $error_text&#34;&#41;;
        return;
    }

    unless &#40;$pid =~ /^-?\d+$/&#41; {
        $Tester-&gt;ok&#40;0, $text&#41;;
        $Tester-&gt;diag&#40;&#34;HTTP::Server::Simple-&gt;background didn&#39;t return a valid PID&#34;&#41;;
        return;
    } 

    push @CHILD_PIDS, $pid;

    if &#40;WIN32&#41; {
        $Event-&gt;wait&#40;&#41;;
    }
    else {
        1 while not $child_loaded_yet;
    }

    $Tester-&gt;ok&#40;1, $text&#41;;

    return &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://localhost">http://localhost</a></span>:$port&#34;;
}

=begin private

=head2 setup_listener

We send a signal to the parent here.  We need to use NEXT because this is a mixin.

=end private

=cut

sub setup_listener {
    my $self = shift;
    $self-&gt;NEXT::setup_listener;
    if &#40;WIN32&#41; {
        $Event-&gt;pulse&#40;&#41;;
    }
    else {
        kill &#39;USR1&#39;, $self-&gt;{&#39;test_http_server_simple_parent_pid&#39;};
    }
} 

=back

=head1 DEPENDENCIES

L&lt;Test::Builder&gt;, L&lt;HTTP::Server::Simple&gt;, L&lt;NEXT&gt;.


=head1 INCOMPATIBILITIES

None reported.


=head1 BUGS AND LIMITATIONS

Installs an interrupt signal handler, which may override any that another part
of your program has installed.

Please report any bugs or feature requests to
C&lt;bug-test-http-server-simple@rt.cpan.org&gt;, or through the web interface at
L&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org">http://rt.cpan.org</a></span>&gt;.


=head1 AUTHOR

David Glasser  C&lt;&lt; &lt;glasser@bestpractical.com&gt; &gt;&gt;


=head1 LICENCE AND COPYRIGHT

Copyright &#40;c&#41; 2005, Best Practical Solutions, LLC.  All rights reserved.

This module is free software; you can redistribute it and/or
modify it under the same terms as Perl itself. See L&lt;perlartistic&gt;.


=head1 DISCLAIMER OF WARRANTY

BECAUSE THIS SOFTWARE IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY
FOR THE SOFTWARE, TO THE EXTENT PERMITTED BY APPLICABLE LAW. EXCEPT WHEN
OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES
PROVIDE THE SOFTWARE &#34;AS IS&#34; WITHOUT WARRANTY OF ANY KIND, EITHER
EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE
ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE SOFTWARE IS WITH
YOU. SHOULD THE SOFTWARE PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL
NECESSARY SERVICING, REPAIR, OR CORRECTION.

IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR
REDISTRIBUTE THE SOFTWARE AS PERMITTED BY THE ABOVE LICENCE, BE
LIABLE TO YOU FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL,
OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE
THE SOFTWARE &#40;INCLUDING BUT NOT LIMITED TO LOSS OF DATA OR DATA BEING
RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD PARTIES OR A
FAILURE OF THE SOFTWARE TO OPERATE WITH ANY OTHER SOFTWARE&#41;, EVEN IF
SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF
SUCH DAMAGES.

=cut

1;

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-282582" href="/Public/Bug/Display.html?id=19564#txn-282582">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;11&nbsp;06:18:21&nbsp;2007</span>
    <span class="description">agentzh [...] yahoo.cn -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> AGENT [...] cpan.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/282582/126893/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/126893">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jan 11 04:27:10 2007, SMUELLER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; I got it to work! It&#39;s not great and uses hack after hack, but the
&gt; attached Test/HTTP/Server/Simple.pm passes its tests on win32.
&gt; 
</div>
Yes, with this .pm file, all the tests of Test::HTTP::Server::Simple
0.03 pass on my WinXP machine. Thanks!

Unfortunately I still can&#39;t get Jifty&#39;s test suite working with this module:

t/08-client..............................ok 1/4DBD::SQLite::db prepare
failed: handle 2 is owned by thread 348b4 not current thread 391a6ec
&#40;handles can&#39;t be shared between threads and your driver may need a
CLONE method added&#41; at E:/Perl/site/lib/Jifty/DBI/Handle.pm line 445.

Changing the DBI driver to Pg doesn&#39;t help either. I&#39;m getting exactly
the same error message:

t/08-client....ok 3/4DBD::Pg::db prepare failed: handle 2 is owned by
thread 3483c not current thread 40f284c &#40;handles can&#39;t be shared between
threads and your driver may need a CLONE method added&#41; at
E:/Perl/site/lib/Jifty/DBI/Handle.pm line 445.

Maybe it&#39;s a problem on the Jifty::DBI side?

Cheers,
Agent
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-315598" href="/Public/Bug/Display.html?id=19564#txn-315598">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;30&nbsp;11:49:45&nbsp;2007</span>
    <span class="description">jesse+cpan [...] fsck.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/315598/143783/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/143783">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 49b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Patch from SMUELLER applied and released as 0.04.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-315601" href="/Public/Bug/Display.html?id=19564#txn-315601">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;30&nbsp;11:49:46&nbsp;2007</span>
    <span class="description">jesse+cpan [...] fsck.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.671651</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
