<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #89563 for Geo-ShapeFile: Shapes_In_Area Function is incorrect</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #89563 for Geo-ShapeFile: Shapes_In_Area Function is incorrect</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Geo-ShapeFile/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Geo-ShapeFile/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Geo-ShapeFile/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Geo-ShapeFile/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/shawnlaffan/Geo-ShapeFile/issues/">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Geo-ShapeFile">Geo-ShapeFile CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">89563</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Geo-ShapeFile/Active/">Geo-ShapeFile</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">SLAFFAN [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
daniel.smith [...] baesystems.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-14516-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-14517-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
2.54    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;16&nbsp;11:49:28&nbsp;2013</span>
    <span class="description">daniel.smith [...] baesystems.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Shapes_In_Area Function is incorrect</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 16 Oct 2013 15:49:09 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Geo-ShapeFile [...] rt.cpan.org&#34; &lt;bug-Geo-ShapeFile [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Smith, Daniel E &#40;UK&#41;&#34; &lt;daniel.smith [...] baesystems.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The Shapes in Area function misses out a LOT of overlapping shapes because of an erroneous check_in_area test
Here it the essential  part of check_in_area it stands:
my $lhit = self-&gt;between&#40;x1_min,$x2_min,$x2,max&#41;;
my $rhit = self-&gt;between&#40;x1_max,$x2_min,$x2,max&#41;;
my $thit = self-&gt;between&#40;y1_min,$y2_min,$y2,max&#41;;
my $bhit = self-&gt;between&#40;y1_max,$x2_min,$x2,max&#41;;
return &#40;#collision
&#40;$lhit &#38;&#38; $thit&#41; || &#40;$rhit &#38;&#38; $thit&#41; || &#40;$lhit &#38;&#38; $bhit&#41; || &#40;$rhit &#38;&#38; $bhit&#41;
&#41; || &#40; #containment
&#40;$lhit &#38;&#38; $thit&#41; || &#40;$rhit &#38;&#38; $thit&#41; || &#40;$lhit &#38;&#38; $bhit&#41; || &#40;$rhit &#38;&#38; $bhit&#41;
&#41;;

This is  does not return true if the two areas overlap on one side only, it only fires if at least one corner of each shape is within the other &#40;or one contains the other&#41;
For instance the areas {0,10,0,10} and {1,11,1,9}, which are obviously overlapping, are not detected by the algorithm because:
between&#40;x1_min,$x2_min,$x2,max&#41; FALSE
between&#40;x1_max,$x2_min,$x2,max&#41;  TRUE
between&#40;y1_min,$y2_min,$y2,max&#41; FALSE
between&#40;y1_max,$x2_min,$x2,max&#41; FALSE
Since only one of the tests is true the algorithm returns false because it needs at least two of the tests to fire.

A working algorithm only needs one line as follows:
return !&#40;$x1_min &gt; $x2_max or $x1_max &lt; $x2_min or $y1_min &gt; $y2_max or $y1_max &lt; $y2_min&#41;;

This has the beneficial side effect that it fires if A contains B AND if B contains A, as well as if they overlap
Therefore the call to check_in_area in &#34;shapes_in_area&#34; can be optimised from the current:
If &#40;$self-&gt;check_in_area&#40;@p,@area&#41; || $self-&gt;check_in_area&#40;@area,@p&#41;&#41; {

To

If &#40;$self-&gt;check_in_area&#40;@p,@area&#41;&#41; {

Hope that is clear, if not contact me for a patch.
Dan Smith
********************************************************************
This email and any attachments are confidential to the intended
recipient and may also be privileged. If you are not the intended
recipient please delete it from your system and notify the sender.
You should not copy it or use it for any purpose nor disclose or
distribute its contents to any other person.
********************************************************************
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;09&nbsp;03:19:22&nbsp;2014</span>
    <span class="description">SLAFFAN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello Dan,

Development for this module is now on github.  <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/shawnlaffan/Geo-ShapeFile">https://github.com/shawnlaffan/Geo-ShapeFile</a></span>

Are you able to submit a pull request with these changes, and ideally some tests or an update to the test suite?  


Thanks,
Shawn.
 


On Wed Oct 16 11:49:28 2013, daniel.smith@baesystems.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The Shapes in Area function misses out a LOT of overlapping shapes
&gt; because of an erroneous check_in_area test
&gt; Here it the essential  part of check_in_area it stands:
&gt; my $lhit = self-&gt;between&#40;x1_min,$x2_min,$x2,max&#41;;
&gt; my $rhit = self-&gt;between&#40;x1_max,$x2_min,$x2,max&#41;;
&gt; my $thit = self-&gt;between&#40;y1_min,$y2_min,$y2,max&#41;;
&gt; my $bhit = self-&gt;between&#40;y1_max,$x2_min,$x2,max&#41;;
&gt; return &#40;#collision
&gt; &#40;$lhit &#38;&#38; $thit&#41; || &#40;$rhit &#38;&#38; $thit&#41; || &#40;$lhit &#38;&#38; $bhit&#41; || &#40;$rhit &#38;&#38;
&gt; $bhit&#41;
&gt; &#41; || &#40; #containment
&gt; &#40;$lhit &#38;&#38; $thit&#41; || &#40;$rhit &#38;&#38; $thit&#41; || &#40;$lhit &#38;&#38; $bhit&#41; || &#40;$rhit &#38;&#38;
&gt; $bhit&#41;
&gt; &#41;;
&gt; 
&gt; This is  does not return true if the two areas overlap on one side
&gt; only, it only fires if at least one corner of each shape is within the
&gt; other &#40;or one contains the other&#41;
&gt; For instance the areas {0,10,0,10} and {1,11,1,9}, which are obviously
&gt; overlapping, are not detected by the algorithm because:
&gt; between&#40;x1_min,$x2_min,$x2,max&#41; FALSE
&gt; between&#40;x1_max,$x2_min,$x2,max&#41;  TRUE
&gt; between&#40;y1_min,$y2_min,$y2,max&#41; FALSE
&gt; between&#40;y1_max,$x2_min,$x2,max&#41; FALSE
&gt; Since only one of the tests is true the algorithm returns false
&gt; because it needs at least two of the tests to fire.
&gt; 
&gt; A working algorithm only needs one line as follows:
&gt; return !&#40;$x1_min &gt; $x2_max or $x1_max &lt; $x2_min or $y1_min &gt; $y2_max
&gt; or $y1_max &lt; $y2_min&#41;;
&gt; 
&gt; This has the beneficial side effect that it fires if A contains B AND
&gt; if B contains A, as well as if they overlap
&gt; Therefore the call to check_in_area in &#34;shapes_in_area&#34; can be
&gt; optimised from the current:
&gt; If &#40;$self-&gt;check_in_area&#40;@p,@area&#41; || $self-&gt;check_in_area&#40;@area,@p&#41;&#41;
&gt; {
&gt; 
&gt; To
&gt; 
&gt; If &#40;$self-&gt;check_in_area&#40;@p,@area&#41;&#41; {
&gt; 
&gt; Hope that is clear, if not contact me for a patch.
&gt; Dan Smith
&gt; ********************************************************************
&gt; This email and any attachments are confidential to the intended
&gt; recipient and may also be privileged. If you are not the intended
&gt; recipient please delete it from your system and notify the sender.
&gt; You should not copy it or use it for any purpose nor disclose or
&gt; distribute its contents to any other person.
&gt; ********************************************************************
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;09&nbsp;03:19:22&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;09&nbsp;03:19:24&nbsp;2014</span>
    <span class="description">SLAFFAN [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;10&nbsp;07:08:06&nbsp;2014</span>
    <span class="description">daniel.smith [...] baesystems.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 10 Feb 2014 12:07:53 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Geo-ShapeFile [...] rt.cpan.org&#34; &lt;bug-Geo-ShapeFile [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Smith, Daniel E &#40;UK&#41;&#34; &lt;daniel.smith [...] baesystems.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for getting back to me Shawn!
I may need a bit of hand holding
What I have here is a bugfixed version which I am using, I tested it as follows:

I downloaded a set of shapefiles which cover the whole of the earth &#40;openly available fom nasa&#41;
I tested the new shapefile routines by using them to pull out the shapes that overlap with a lat long box, and seeing that when I found the shapes in a box containing &#40;say&#41; the arabian gulf, or the uk, I could plot those shapes in an excel chart and the resultant map looked like the correct bits of the coastline.

This was good enough for my purposes, but probably not what you need because:

a&#41; The test data set is huge.
b&#41; The pass criteria is subjective

What we really need is a small set of simple polygons that definitely overlap with a box but were not detected by the old routines and are by the new one.

However I also do not really know what you mean by &#34;a pull request&#34;, or how to integrate my tests into the &#34;test suite&#34;.

Daniel Smith 
Radar Systems Engineer, Sampson
BAE Systems Maritime Services,
Newport Road,
Cowes,
Isle of Wight, PO31 8PF, UK
I: +44 &#40;0&#41; 198320 2937 
:: daniel.smith@baesystems.com / www.baesystems.com

BAE Systems Integrated System Technologies Limited  
Registered Office: Warwick House, PO Box 87, Farnborough Aerospace Centre, Farnborough, Hants, GU14 6YU, UK.
Registered in England &#38; Wales No: 3456325 

Please consider the environment before printing this email.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Shawn Laffan via RT [mailto:bug-Geo-ShapeFile@rt.cpan.org] 
Sent: 09 February 2014 08:19
To: Smith, Daniel E &#40;UK&#41;
Subject: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect

----------------------! WARNING ! ---------------------- This message originates from outside our organisation, either from an external partner or from the internet.
Consider carefully whether you should click on any links, open any attachments or reply.
Follow the &#39;Report Suspicious Emails&#39; link on IT matters for instructions on reporting suspicious email messages.
--------------------------------------------------------

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=89563">https://rt.cpan.org/Ticket/Display.html?id=89563</a></span> &gt;

Hello Dan,

Development for this module is now on github.  <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/shawnlaffan/Geo-ShapeFile">https://github.com/shawnlaffan/Geo-ShapeFile</a></span>

Are you able to submit a pull request with these changes, and ideally some tests or an update to the test suite?  


Thanks,
Shawn.
 


On Wed Oct 16 11:49:28 2013, daniel.smith@baesystems.com wrote:
<div class="message-stanza open">&gt; The Shapes in Area function misses out a LOT of overlapping shapes 
&gt; because of an erroneous check_in_area test Here it the essential  part 
&gt; of check_in_area it stands:
&gt; my $lhit = self-&gt;between&#40;x1_min,$x2_min,$x2,max&#41;;
&gt; my $rhit = self-&gt;between&#40;x1_max,$x2_min,$x2,max&#41;;
&gt; my $thit = self-&gt;between&#40;y1_min,$y2_min,$y2,max&#41;;
&gt; my $bhit = self-&gt;between&#40;y1_max,$x2_min,$x2,max&#41;;
&gt; return &#40;#collision
&gt; &#40;$lhit &#38;&#38; $thit&#41; || &#40;$rhit &#38;&#38; $thit&#41; || &#40;$lhit &#38;&#38; $bhit&#41; || &#40;$rhit &#38;&#38;
&gt; $bhit&#41;
&gt; &#41; || &#40; #containment
&gt; &#40;$lhit &#38;&#38; $thit&#41; || &#40;$rhit &#38;&#38; $thit&#41; || &#40;$lhit &#38;&#38; $bhit&#41; || &#40;$rhit &#38;&#38;
&gt; $bhit&#41;
&gt; &#41;;
&gt; 
&gt; This is  does not return true if the two areas overlap on one side 
&gt; only, it only fires if at least one corner of each shape is within the 
&gt; other &#40;or one contains the other&#41; For instance the areas {0,10,0,10} 
&gt; and {1,11,1,9}, which are obviously overlapping, are not detected by 
&gt; the algorithm because:
&gt; between&#40;x1_min,$x2_min,$x2,max&#41; FALSE
&gt; between&#40;x1_max,$x2_min,$x2,max&#41;  TRUE
&gt; between&#40;y1_min,$y2_min,$y2,max&#41; FALSE
&gt; between&#40;y1_max,$x2_min,$x2,max&#41; FALSE
&gt; Since only one of the tests is true the algorithm returns false 
&gt; because it needs at least two of the tests to fire.
&gt; 
&gt; A working algorithm only needs one line as follows:
&gt; return !&#40;$x1_min &gt; $x2_max or $x1_max &lt; $x2_min or $y1_min &gt; $y2_max 
&gt; or $y1_max &lt; $y2_min&#41;;
&gt; 
&gt; This has the beneficial side effect that it fires if A contains B AND 
&gt; if B contains A, as well as if they overlap Therefore the call to 
&gt; check_in_area in &#34;shapes_in_area&#34; can be optimised from the current:
&gt; If &#40;$self-&gt;check_in_area&#40;@p,@area&#41; || $self-&gt;check_in_area&#40;@area,@p&#41;&#41; 
&gt; {
&gt; 
&gt; To
&gt; 
&gt; If &#40;$self-&gt;check_in_area&#40;@p,@area&#41;&#41; {
&gt; 
&gt; Hope that is clear, if not contact me for a patch.
&gt; Dan Smith
&gt; ********************************************************************
&gt; This email and any attachments are confidential to the intended 
&gt; recipient and may also be privileged. If you are not the intended 
&gt; recipient please delete it from your system and notify the sender.
&gt; You should not copy it or use it for any purpose nor disclose or 
&gt; distribute its contents to any other person.
&gt; ********************************************************************
</div>


</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;10&nbsp;15:13:22&nbsp;2014</span>
    <span class="description">SLAFFAN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the response Daniel.

Could you send me the URL for the shapefiles?  And also send me a bounding box which did not work? That way I can replicate the issue on my machine.  

Don&#39;t worry about the pull request and test suite.  They&#39;re useful if you&#39;re able to edit the code and provide fixes via git &#40;see, for example, <span class="clickylink"><a target="new" rel="nofollow" href="https://help.github.com/articles/using-pull-requests">https://help.github.com/articles/using-pull-requests</a></span> &#41;.  

Regards,
Shawn.




On Mon Feb 10 07:08:06 2014, daniel.smith@baesystems.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks for getting back to me Shawn!
&gt; I may need a bit of hand holding
&gt; What I have here is a bugfixed version which I am using, I tested it
&gt; as follows:
&gt; 
&gt; I downloaded a set of shapefiles which cover the whole of the earth
&gt; &#40;openly available fom nasa&#41;
&gt; I tested the new shapefile routines by using them to pull out the
&gt; shapes that overlap with a lat long box, and seeing that when I found
&gt; the shapes in a box containing &#40;say&#41; the arabian gulf, or the uk, I
&gt; could plot those shapes in an excel chart and the resultant map looked
&gt; like the correct bits of the coastline.
&gt; 
&gt; This was good enough for my purposes, but probably not what you need
&gt; because:
&gt; 
&gt; a&#41; The test data set is huge.
&gt; b&#41; The pass criteria is subjective
&gt; 
&gt; What we really need is a small set of simple polygons that definitely
&gt; overlap with a box but were not detected by the old routines and are
&gt; by the new one.
&gt; 
&gt; However I also do not really know what you mean by &#34;a pull request&#34;,
&gt; or how to integrate my tests into the &#34;test suite&#34;.
&gt; 
&gt; Daniel Smith
&gt; Radar Systems Engineer, Sampson
&gt; BAE Systems Maritime Services,
&gt; Newport Road,
&gt; Cowes,
&gt; Isle of Wight, PO31 8PF, UK
&gt; I: +44 &#40;0&#41; 198320 2937
&gt; :: daniel.smith@baesystems.com / www.baesystems.com
&gt; 
&gt; BAE Systems Integrated System Technologies Limited
&gt; Registered Office: Warwick House, PO Box 87, Farnborough Aerospace
&gt; Centre, Farnborough, Hants, GU14 6YU, UK.
&gt; Registered in England &#38; Wales No: 3456325
&gt; 
&gt; Please consider the environment before printing this email.
&gt; 
&gt; -----Original Message-----
&gt;  From: Shawn Laffan via RT [mailto:bug-Geo-ShapeFile@rt.cpan.org]
&gt; Sent: 09 February 2014 08:19
&gt; To: Smith, Daniel E &#40;UK&#41;
&gt; Subject: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect
&gt; 
&gt; ----------------------! WARNING ! ---------------------- This message
&gt; originates from outside our organisation, either from an external
&gt; partner or from the internet.
&gt; Consider carefully whether you should click on any links, open any
&gt; attachments or reply.
&gt; Follow the &#39;Report Suspicious Emails&#39; link on IT matters for
&gt; instructions on reporting suspicious email messages.
&gt; --------------------------------------------------------
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=89563">https://rt.cpan.org/Ticket/Display.html?id=89563</a></span> &gt;
&gt; 
&gt; Hello Dan,
&gt; 
&gt; Development for this module is now on github.
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/shawnlaffan/Geo-ShapeFile">https://github.com/shawnlaffan/Geo-ShapeFile</a></span>
&gt; 
&gt; Are you able to submit a pull request with these changes, and ideally
&gt; some tests or an update to the test suite?
&gt; 
&gt; 
&gt; Thanks,
&gt; Shawn.
&gt; 
&gt; 
&gt; 
&gt; On Wed Oct 16 11:49:28 2013, daniel.smith@baesystems.com wrote:
<div class="message-stanza open">&gt; &gt; The Shapes in Area function misses out a LOT of overlapping shapes
&gt; &gt; because of an erroneous check_in_area test Here it the essential
&gt; &gt; part
&gt; &gt; of check_in_area it stands:
&gt; &gt; my $lhit = self-&gt;between&#40;x1_min,$x2_min,$x2,max&#41;;
&gt; &gt; my $rhit = self-&gt;between&#40;x1_max,$x2_min,$x2,max&#41;;
&gt; &gt; my $thit = self-&gt;between&#40;y1_min,$y2_min,$y2,max&#41;;
&gt; &gt; my $bhit = self-&gt;between&#40;y1_max,$x2_min,$x2,max&#41;;
&gt; &gt; return &#40;#collision
&gt; &gt; &#40;$lhit &#38;&#38; $thit&#41; || &#40;$rhit &#38;&#38; $thit&#41; || &#40;$lhit &#38;&#38; $bhit&#41; || &#40;$rhit &#38;&#38;
&gt; &gt; $bhit&#41;
&gt; &gt; &#41; || &#40; #containment
&gt; &gt; &#40;$lhit &#38;&#38; $thit&#41; || &#40;$rhit &#38;&#38; $thit&#41; || &#40;$lhit &#38;&#38; $bhit&#41; || &#40;$rhit &#38;&#38;
&gt; &gt; $bhit&#41;
&gt; &gt; &#41;;
&gt; &gt;
&gt; &gt; This is  does not return true if the two areas overlap on one side
&gt; &gt; only, it only fires if at least one corner of each shape is within
&gt; &gt; the
&gt; &gt; other &#40;or one contains the other&#41; For instance the areas {0,10,0,10}
&gt; &gt; and {1,11,1,9}, which are obviously overlapping, are not detected by
&gt; &gt; the algorithm because:
&gt; &gt; between&#40;x1_min,$x2_min,$x2,max&#41; FALSE
&gt; &gt; between&#40;x1_max,$x2_min,$x2,max&#41;  TRUE
&gt; &gt; between&#40;y1_min,$y2_min,$y2,max&#41; FALSE
&gt; &gt; between&#40;y1_max,$x2_min,$x2,max&#41; FALSE
&gt; &gt; Since only one of the tests is true the algorithm returns false
&gt; &gt; because it needs at least two of the tests to fire.
&gt; &gt;
&gt; &gt; A working algorithm only needs one line as follows:
&gt; &gt;  return !&#40;$x1_min &gt; $x2_max or $x1_max &lt; $x2_min or $y1_min &gt; $y2_max
&gt; &gt; or $y1_max &lt; $y2_min&#41;;
&gt; &gt;
&gt; &gt; This has the beneficial side effect that it fires if A contains B AND
&gt; &gt; if B contains A, as well as if they overlap Therefore the call to
&gt; &gt; check_in_area in &#34;shapes_in_area&#34; can be optimised from the current:
&gt; &gt; If &#40;$self-&gt;check_in_area&#40;@p,@area&#41; || $self-&gt;check_in_area&#40;@area,@p&#41;&#41;
&gt; &gt; {
&gt; &gt;
&gt; &gt; To
&gt; &gt;
&gt; &gt; If &#40;$self-&gt;check_in_area&#40;@p,@area&#41;&#41; {
&gt; &gt;
&gt; &gt; Hope that is clear, if not contact me for a patch.
&gt; &gt; Dan Smith
&gt; &gt; ********************************************************************
&gt; &gt; This email and any attachments are confidential to the intended
&gt; &gt; recipient and may also be privileged. If you are not the intended
&gt; &gt; recipient please delete it from your system and notify the sender.
&gt; &gt; You should not copy it or use it for any purpose nor disclose or
&gt; &gt; distribute its contents to any other person.
&gt; &gt; ********************************************************************
</div>&gt; 
&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;10&nbsp;15:29:57&nbsp;2014</span>
    <span class="description">daniel.smith [...] baesystems.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 10 Feb 2014 20:29:45 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Geo-ShapeFile [...] rt.cpan.org&#34; &lt;bug-Geo-ShapeFile [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Smith, Daniel E &#40;UK&#41;&#34; &lt;Daniel.Smith [...] baesystems.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi
I will do that tomorrow, I am at work at the moment and going home soon
Do you have excel by the way, if so I can send you an excel 2010 &#40;or 2003 if you like&#41; analysis of what goes wrong

In my original ticket, I mentioned shapes {0,10,0,10} and {1,11,1,9},:
If you make one of those into a shape, and the other into a bounding box, you will see that the existing code says they do not overlap, but my improved code says they do overlap. If you draw them they obviously overlap too.



Daniel Smith 
Radar Systems Engineer, Sampson
BAE Systems Maritime Services,
Newport Road,
Cowes,
Isle of Wight, PO31 8PF, UK
I: +44 &#40;0&#41; 198320 2937 
:: daniel.smith@baesystems.com / www.baesystems.com

BAE Systems Integrated System Technologies Limited  
Registered Office: Warwick House, PO Box 87, Farnborough Aerospace Centre, Farnborough, Hants, GU14 6YU, UK.
Registered in England &#38; Wales No: 3456325 

Please consider the environment before printing this email.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Shawn Laffan via RT [mailto:bug-Geo-ShapeFile@rt.cpan.org] 
Sent: 10 February 2014 20:13
To: Smith, Daniel E &#40;UK&#41;
Subject: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect

----------------------! WARNING ! ---------------------- This message originates from outside our organisation, either from an external partner or from the internet.
Consider carefully whether you should click on any links, open any attachments or reply.
Follow the &#39;Report Suspicious Emails&#39; link on IT matters for instructions on reporting suspicious email messages.
--------------------------------------------------------

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=89563">https://rt.cpan.org/Ticket/Display.html?id=89563</a></span> &gt;

Thanks for the response Daniel.

Could you send me the URL for the shapefiles?  And also send me a bounding box which did not work? That way I can replicate the issue on my machine.  

Don&#39;t worry about the pull request and test suite.  They&#39;re useful if you&#39;re able to edit the code and provide fixes via git &#40;see, for example, <span class="clickylink"><a target="new" rel="nofollow" href="https://help.github.com/articles/using-pull-requests">https://help.github.com/articles/using-pull-requests</a></span> &#41;.  

Regards,
Shawn.




On Mon Feb 10 07:08:06 2014, daniel.smith@baesystems.com wrote:
<div class="message-stanza open">&gt; Thanks for getting back to me Shawn!
&gt; I may need a bit of hand holding
&gt; What I have here is a bugfixed version which I am using, I tested it 
&gt; as follows:
&gt; 
&gt; I downloaded a set of shapefiles which cover the whole of the earth 
&gt; &#40;openly available fom nasa&#41; I tested the new shapefile routines by 
&gt; using them to pull out the shapes that overlap with a lat long box, 
&gt; and seeing that when I found the shapes in a box containing &#40;say&#41; the 
&gt; arabian gulf, or the uk, I could plot those shapes in an excel chart 
&gt; and the resultant map looked like the correct bits of the coastline.
&gt; 
&gt; This was good enough for my purposes, but probably not what you need
&gt; because:
&gt; 
&gt; a&#41; The test data set is huge.
&gt; b&#41; The pass criteria is subjective
&gt; 
&gt; What we really need is a small set of simple polygons that definitely 
&gt; overlap with a box but were not detected by the old routines and are 
&gt; by the new one.
&gt; 
&gt; However I also do not really know what you mean by &#34;a pull request&#34;, 
&gt; or how to integrate my tests into the &#34;test suite&#34;.
&gt; 
&gt; Daniel Smith
&gt; Radar Systems Engineer, Sampson
&gt; BAE Systems Maritime Services,
&gt; Newport Road,
&gt; Cowes,
&gt; Isle of Wight, PO31 8PF, UK
&gt; I: +44 &#40;0&#41; 198320 2937
&gt; :: daniel.smith@baesystems.com / www.baesystems.com
&gt; 
&gt; BAE Systems Integrated System Technologies Limited Registered Office: 
&gt; Warwick House, PO Box 87, Farnborough Aerospace Centre, Farnborough, 
&gt; Hants, GU14 6YU, UK.
&gt; Registered in England &#38; Wales No: 3456325
&gt; 
&gt; P Please consider the environment before printing this email.
&gt; 
&gt; -----Original Message-----
&gt;  From: Shawn Laffan via RT [mailto:bug-Geo-ShapeFile@rt.cpan.org]
&gt; Sent: 09 February 2014 08:19
&gt; To: Smith, Daniel E &#40;UK&#41;
&gt; Subject: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect
&gt; 
&gt; ----------------------! WARNING ! ---------------------- This message 
&gt; originates from outside our organisation, either from an external 
&gt; partner or from the internet.
&gt; Consider carefully whether you should click on any links, open any 
&gt; attachments or reply.
&gt; Follow the &#39;Report Suspicious Emails&#39; link on IT matters for 
&gt; instructions on reporting suspicious email messages.
&gt; --------------------------------------------------------
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=89563">https://rt.cpan.org/Ticket/Display.html?id=89563</a></span> &gt;
&gt; 
&gt; Hello Dan,
&gt; 
&gt; Development for this module is now on github.
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/shawnlaffan/Geo-ShapeFile">https://github.com/shawnlaffan/Geo-ShapeFile</a></span>
&gt; 
&gt; Are you able to submit a pull request with these changes, and ideally 
&gt; some tests or an update to the test suite?
&gt; 
&gt; 
&gt; Thanks,
&gt; Shawn.
&gt; 
&gt; 
&gt; 
&gt; On Wed Oct 16 11:49:28 2013, daniel.smith@baesystems.com wrote:
<div class="message-stanza open">&gt; &gt; The Shapes in Area function misses out a LOT of overlapping shapes 
&gt; &gt; because of an erroneous check_in_area test Here it the essential 
&gt; &gt; part of check_in_area it stands:
&gt; &gt; my $lhit = self-&gt;between&#40;x1_min,$x2_min,$x2,max&#41;;
&gt; &gt; my $rhit = self-&gt;between&#40;x1_max,$x2_min,$x2,max&#41;;
&gt; &gt; my $thit = self-&gt;between&#40;y1_min,$y2_min,$y2,max&#41;;
&gt; &gt; my $bhit = self-&gt;between&#40;y1_max,$x2_min,$x2,max&#41;;
&gt; &gt; return &#40;#collision
&gt; &gt; &#40;$lhit &#38;&#38; $thit&#41; || &#40;$rhit &#38;&#38; $thit&#41; || &#40;$lhit &#38;&#38; $bhit&#41; || &#40;$rhit 
&gt; &gt; &#38;&#38;
&gt; &gt; $bhit&#41;
&gt; &gt; &#41; || &#40; #containment
&gt; &gt; &#40;$lhit &#38;&#38; $thit&#41; || &#40;$rhit &#38;&#38; $thit&#41; || &#40;$lhit &#38;&#38; $bhit&#41; || &#40;$rhit 
&gt; &gt; &#38;&#38;
&gt; &gt; $bhit&#41;
&gt; &gt; &#41;;
&gt; &gt;
&gt; &gt; This is  does not return true if the two areas overlap on one side 
&gt; &gt; only, it only fires if at least one corner of each shape is within 
&gt; &gt; the other &#40;or one contains the other&#41; For instance the areas 
&gt; &gt; {0,10,0,10} and {1,11,1,9}, which are obviously overlapping, are not 
&gt; &gt; detected by the algorithm because:
&gt; &gt; between&#40;x1_min,$x2_min,$x2,max&#41; FALSE
&gt; &gt; between&#40;x1_max,$x2_min,$x2,max&#41;  TRUE
&gt; &gt; between&#40;y1_min,$y2_min,$y2,max&#41; FALSE
&gt; &gt; between&#40;y1_max,$x2_min,$x2,max&#41; FALSE Since only one of the tests is 
&gt; &gt; true the algorithm returns false because it needs at least two of 
&gt; &gt; the tests to fire.
&gt; &gt;
&gt; &gt; A working algorithm only needs one line as follows:
&gt; &gt;  return !&#40;$x1_min &gt; $x2_max or $x1_max &lt; $x2_min or $y1_min &gt; 
&gt; &gt; $y2_max or $y1_max &lt; $y2_min&#41;;
&gt; &gt;
&gt; &gt; This has the beneficial side effect that it fires if A contains B 
&gt; &gt; AND if B contains A, as well as if they overlap Therefore the call 
&gt; &gt; to check_in_area in &#34;shapes_in_area&#34; can be optimised from the current:
&gt; &gt; If &#40;$self-&gt;check_in_area&#40;@p,@area&#41; || 
&gt; &gt; $self-&gt;check_in_area&#40;@area,@p&#41;&#41; {
&gt; &gt;
&gt; &gt; To
&gt; &gt;
&gt; &gt; If &#40;$self-&gt;check_in_area&#40;@p,@area&#41;&#41; {
&gt; &gt;
&gt; &gt; Hope that is clear, if not contact me for a patch.
&gt; &gt; Dan Smith
&gt; &gt; ********************************************************************
&gt; &gt; This email and any attachments are confidential to the intended 
&gt; &gt; recipient and may also be privileged. If you are not the intended 
&gt; &gt; recipient please delete it from your system and notify the sender.
&gt; &gt; You should not copy it or use it for any purpose nor disclose or 
&gt; &gt; distribute its contents to any other person.
&gt; &gt; ********************************************************************
</div>&gt; 
&gt; 
&gt; 
</div>


</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;10&nbsp;15:39:19&nbsp;2014</span>
    <span class="description">SLAFFAN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I do have excel &#40;2010 and 2013&#41;, so please send it. 

The coords you sent should also server for debugging.  I&#39;ll give them a go.  

Regards,
Shawn. 


On Mon Feb 10 15:29:57 2014, daniel.smith@baesystems.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi
&gt; I will do that tomorrow, I am at work at the moment and going home
&gt; soon
&gt; Do you have excel by the way, if so I can send you an excel 2010 &#40;or
&gt; 2003 if you like&#41; analysis of what goes wrong
&gt; 
&gt; In my original ticket, I mentioned shapes {0,10,0,10} and {1,11,1,9},:
&gt; If you make one of those into a shape, and the other into a bounding
&gt; box, you will see that the existing code says they do not overlap, but
&gt; my improved code says they do overlap. If you draw them they obviously
&gt; overlap too.
&gt; 
&gt; 
&gt; 
&gt; Daniel Smith
&gt; Radar Systems Engineer, Sampson
&gt; BAE Systems Maritime Services,
&gt; Newport Road,
&gt; Cowes,
&gt; Isle of Wight, PO31 8PF, UK
&gt; I: +44 &#40;0&#41; 198320 2937
&gt; :: daniel.smith@baesystems.com / www.baesystems.com
&gt; 
&gt; BAE Systems Integrated System Technologies Limited
&gt; Registered Office: Warwick House, PO Box 87, Farnborough Aerospace
&gt; Centre, Farnborough, Hants, GU14 6YU, UK.
&gt; Registered in England &#38; Wales No: 3456325
&gt; 
&gt; Please consider the environment before printing this email.
&gt; 
&gt; 
&gt; -----Original Message-----
&gt;  From: Shawn Laffan via RT [mailto:bug-Geo-ShapeFile@rt.cpan.org]
&gt; Sent: 10 February 2014 20:13
&gt; To: Smith, Daniel E &#40;UK&#41;
&gt; Subject: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect
&gt; 
&gt; ----------------------! WARNING ! ---------------------- This message
&gt; originates from outside our organisation, either from an external
&gt; partner or from the internet.
&gt; Consider carefully whether you should click on any links, open any
&gt; attachments or reply.
&gt; Follow the &#39;Report Suspicious Emails&#39; link on IT matters for
&gt; instructions on reporting suspicious email messages.
&gt; --------------------------------------------------------
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=89563">https://rt.cpan.org/Ticket/Display.html?id=89563</a></span> &gt;
&gt; 
&gt; Thanks for the response Daniel.
&gt; 
&gt; Could you send me the URL for the shapefiles?  And also send me a
&gt; bounding box which did not work? That way I can replicate the issue on
&gt; my machine.
&gt; 
&gt; Don&#39;t worry about the pull request and test suite.  They&#39;re useful if
&gt; you&#39;re able to edit the code and provide fixes via git &#40;see, for
&gt; example, <span class="clickylink"><a target="new" rel="nofollow" href="https://help.github.com/articles/using-pull-requests">https://help.github.com/articles/using-pull-requests</a></span> &#41;.
&gt; 
&gt; Regards,
&gt; Shawn.
&gt; 
&gt; 
&gt; 
&gt; 
&gt; On Mon Feb 10 07:08:06 2014, daniel.smith@baesystems.com wrote:
<div class="message-stanza open">&gt; &gt; Thanks for getting back to me Shawn!
&gt; &gt; I may need a bit of hand holding
&gt; &gt;  What I have here is a bugfixed version which I am using, I tested it
&gt; &gt; as follows:
&gt; &gt;
&gt; &gt; I downloaded a set of shapefiles which cover the whole of the earth
&gt; &gt; &#40;openly available fom nasa&#41; I tested the new shapefile routines by
&gt; &gt; using them to pull out the shapes that overlap with a lat long box,
&gt; &gt; and seeing that when I found the shapes in a box containing &#40;say&#41; the
&gt; &gt; arabian gulf, or the uk, I could plot those shapes in an excel chart
&gt; &gt; and the resultant map looked like the correct bits of the coastline.
&gt; &gt;
&gt; &gt; This was good enough for my purposes, but probably not what you need
&gt; &gt; because:
&gt; &gt;
&gt; &gt; a&#41; The test data set is huge.
&gt; &gt; b&#41; The pass criteria is subjective
&gt; &gt;
&gt; &gt; What we really need is a small set of simple polygons that definitely
&gt; &gt; overlap with a box but were not detected by the old routines and are
&gt; &gt; by the new one.
&gt; &gt;
&gt; &gt; However I also do not really know what you mean by &#34;a pull request&#34;,
&gt; &gt; or how to integrate my tests into the &#34;test suite&#34;.
&gt; &gt;
&gt; &gt; Daniel Smith
&gt; &gt; Radar Systems Engineer, Sampson
&gt; &gt; BAE Systems Maritime Services,
&gt; &gt; Newport Road,
&gt; &gt; Cowes,
&gt; &gt; Isle of Wight, PO31 8PF, UK
&gt; &gt; I: +44 &#40;0&#41; 198320 2937
&gt; &gt; :: daniel.smith@baesystems.com / www.baesystems.com
&gt; &gt;
&gt; &gt; BAE Systems Integrated System Technologies Limited Registered Office:
&gt; &gt; Warwick House, PO Box 87, Farnborough Aerospace Centre, Farnborough,
&gt; &gt; Hants, GU14 6YU, UK.
&gt; &gt; Registered in England &#38; Wales No: 3456325
&gt; &gt;
&gt; &gt; P Please consider the environment before printing this email.
&gt; &gt;
&gt; &gt; -----Original Message-----
&gt; &gt;  From: Shawn Laffan via RT [mailto:bug-Geo-ShapeFile@rt.cpan.org]
&gt; &gt; Sent: 09 February 2014 08:19
&gt; &gt; To: Smith, Daniel E &#40;UK&#41;
&gt; &gt; Subject: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect
&gt; &gt;
&gt; &gt; ----------------------! WARNING ! ---------------------- This message
&gt; &gt; originates from outside our organisation, either from an external
&gt; &gt; partner or from the internet.
&gt; &gt; Consider carefully whether you should click on any links, open any
&gt; &gt; attachments or reply.
&gt; &gt; Follow the &#39;Report Suspicious Emails&#39; link on IT matters for
&gt; &gt; instructions on reporting suspicious email messages.
&gt; &gt; --------------------------------------------------------
&gt; &gt;
&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=89563">https://rt.cpan.org/Ticket/Display.html?id=89563</a></span> &gt;
&gt; &gt;
&gt; &gt; Hello Dan,
&gt; &gt;
&gt; &gt; Development for this module is now on github.
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/shawnlaffan/Geo-ShapeFile">https://github.com/shawnlaffan/Geo-ShapeFile</a></span>
&gt; &gt;
&gt; &gt; Are you able to submit a pull request with these changes, and ideally
&gt; &gt; some tests or an update to the test suite?
&gt; &gt;
&gt; &gt;
&gt; &gt; Thanks,
&gt; &gt; Shawn.
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; On Wed Oct 16 11:49:28 2013, daniel.smith@baesystems.com wrote:
<div class="message-stanza open">&gt; &gt; &gt; The Shapes in Area function misses out a LOT of overlapping shapes
&gt; &gt; &gt; because of an erroneous check_in_area test Here it the essential
&gt; &gt; &gt; part of check_in_area it stands:
&gt; &gt; &gt; my $lhit = self-&gt;between&#40;x1_min,$x2_min,$x2,max&#41;;
&gt; &gt; &gt; my $rhit = self-&gt;between&#40;x1_max,$x2_min,$x2,max&#41;;
&gt; &gt; &gt; my $thit = self-&gt;between&#40;y1_min,$y2_min,$y2,max&#41;;
&gt; &gt; &gt; my $bhit = self-&gt;between&#40;y1_max,$x2_min,$x2,max&#41;;
&gt; &gt; &gt; return &#40;#collision
&gt; &gt; &gt; &#40;$lhit &#38;&#38; $thit&#41; || &#40;$rhit &#38;&#38; $thit&#41; || &#40;$lhit &#38;&#38; $bhit&#41; || &#40;$rhit
&gt; &gt; &gt; &#38;&#38;
&gt; &gt; &gt; $bhit&#41;
&gt; &gt; &gt; &#41; || &#40; #containment
&gt; &gt; &gt; &#40;$lhit &#38;&#38; $thit&#41; || &#40;$rhit &#38;&#38; $thit&#41; || &#40;$lhit &#38;&#38; $bhit&#41; || &#40;$rhit
&gt; &gt; &gt; &#38;&#38;
&gt; &gt; &gt; $bhit&#41;
&gt; &gt; &gt; &#41;;
&gt; &gt; &gt;
&gt; &gt; &gt; This is  does not return true if the two areas overlap on one side
&gt; &gt; &gt; only, it only fires if at least one corner of each shape is within
&gt; &gt; &gt; the other &#40;or one contains the other&#41; For instance the areas
&gt; &gt; &gt; {0,10,0,10} and {1,11,1,9}, which are obviously overlapping, are
&gt; &gt; &gt; not
&gt; &gt; &gt; detected by the algorithm because:
&gt; &gt; &gt; between&#40;x1_min,$x2_min,$x2,max&#41; FALSE
&gt; &gt; &gt; between&#40;x1_max,$x2_min,$x2,max&#41;  TRUE
&gt; &gt; &gt; between&#40;y1_min,$y2_min,$y2,max&#41; FALSE
&gt; &gt; &gt; between&#40;y1_max,$x2_min,$x2,max&#41; FALSE Since only one of the tests
&gt; &gt; &gt; is
&gt; &gt; &gt; true the algorithm returns false because it needs at least two of
&gt; &gt; &gt; the tests to fire.
&gt; &gt; &gt;
&gt; &gt; &gt; A working algorithm only needs one line as follows:
&gt; &gt; &gt;   return !&#40;$x1_min &gt; $x2_max or $x1_max &lt; $x2_min or $y1_min &gt;
&gt; &gt; &gt; $y2_max or $y1_max &lt; $y2_min&#41;;
&gt; &gt; &gt;
&gt; &gt; &gt; This has the beneficial side effect that it fires if A contains B
&gt; &gt; &gt; AND if B contains A, as well as if they overlap Therefore the call
&gt; &gt; &gt; to check_in_area in &#34;shapes_in_area&#34; can be optimised from the
&gt; &gt; &gt; current:
&gt; &gt; &gt; If &#40;$self-&gt;check_in_area&#40;@p,@area&#41; ||
&gt; &gt; &gt; $self-&gt;check_in_area&#40;@area,@p&#41;&#41; {
&gt; &gt; &gt;
&gt; &gt; &gt; To
&gt; &gt; &gt;
&gt; &gt; &gt; If &#40;$self-&gt;check_in_area&#40;@p,@area&#41;&#41; {
&gt; &gt; &gt;
&gt; &gt; &gt; Hope that is clear, if not contact me for a patch.
&gt; &gt; &gt; Dan Smith
&gt; &gt; &gt; ********************************************************************
&gt; &gt; &gt; This email and any attachments are confidential to the intended
&gt; &gt; &gt; recipient and may also be privileged. If you are not the intended
&gt; &gt; &gt; recipient please delete it from your system and notify the sender.
&gt; &gt; &gt; You should not copy it or use it for any purpose nor disclose or
&gt; &gt; &gt; distribute its contents to any other person.
&gt; &gt; &gt; ********************************************************************
</div>&gt; &gt;
&gt; &gt;
&gt; &gt;
</div>&gt; 
&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;10&nbsp;16:43:26&nbsp;2014</span>
    <span class="description">SLAFFAN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Those coords turned out to be very useful. 

The between function is &#40;was&#41; returning false positives due to the use of the lower precedence &#34;and&#34;. This means the max check is skipped when the min check passes, and the function returns true. 

I have fixed the issue, and the code is on github.  It will be in the next release &#40;planned for today&#41;.

I&#39;ve listed the optimisation as its own issue on github &#40;I forgot about that in the last few posts&#41;.  <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/shawnlaffan/Geo-ShapeFile/issues/9">https://github.com/shawnlaffan/Geo-ShapeFile/issues/9</a></span>
 
I&#39;d also still appreciate the URL for the files, as I&#39;m always on the lookout for data and they might be useful for other projects I have.

Regards,
Shawn.


On Mon Feb 10 15:39:19 2014, SLAFFAN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I do have excel &#40;2010 and 2013&#41;, so please send it.
&gt; 
&gt; The coords you sent should also server for debugging.  I&#39;ll give them
&gt; a go.
&gt; 
&gt; Regards,
&gt;  Shawn.
&gt; 
&gt; 
&gt; On Mon Feb 10 15:29:57 2014, daniel.smith@baesystems.com wrote:
<div class="message-stanza open">&gt; &gt; Hi
&gt; &gt; I will do that tomorrow, I am at work at the moment and going home
&gt; &gt; soon
&gt; &gt; Do you have excel by the way, if so I can send you an excel 2010 &#40;or
&gt; &gt; 2003 if you like&#41; analysis of what goes wrong
&gt; &gt;
&gt; &gt; In my original ticket, I mentioned shapes {0,10,0,10} and
&gt; &gt; {1,11,1,9},:
&gt; &gt; If you make one of those into a shape, and the other into a bounding
&gt; &gt; box, you will see that the existing code says they do not overlap,
&gt; &gt; but
&gt; &gt; my improved code says they do overlap. If you draw them they
&gt; &gt; obviously
&gt; &gt; overlap too.
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; Daniel Smith
&gt; &gt; Radar Systems Engineer, Sampson
&gt; &gt; BAE Systems Maritime Services,
&gt; &gt; Newport Road,
&gt; &gt; Cowes,
&gt; &gt; Isle of Wight, PO31 8PF, UK
&gt; &gt; I: +44 &#40;0&#41; 198320 2937
&gt; &gt; :: daniel.smith@baesystems.com / www.baesystems.com
&gt; &gt;
&gt; &gt; BAE Systems Integrated System Technologies Limited
&gt; &gt; Registered Office: Warwick House, PO Box 87, Farnborough Aerospace
&gt; &gt; Centre, Farnborough, Hants, GU14 6YU, UK.
&gt; &gt; Registered in England &#38; Wales No: 3456325
&gt; &gt;
&gt; &gt; Please consider the environment before printing this email.
&gt; &gt;
&gt; &gt;
&gt; &gt; -----Original Message-----
&gt; &gt;  From: Shawn Laffan via RT [mailto:bug-Geo-ShapeFile@rt.cpan.org]
&gt; &gt; Sent: 10 February 2014 20:13
&gt; &gt; To: Smith, Daniel E &#40;UK&#41;
&gt; &gt; Subject: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect
&gt; &gt;
&gt; &gt; ----------------------! WARNING ! ---------------------- This message
&gt; &gt; originates from outside our organisation, either from an external
&gt; &gt; partner or from the internet.
&gt; &gt; Consider carefully whether you should click on any links, open any
&gt; &gt; attachments or reply.
&gt; &gt; Follow the &#39;Report Suspicious Emails&#39; link on IT matters for
&gt; &gt; instructions on reporting suspicious email messages.
&gt; &gt; --------------------------------------------------------
&gt; &gt;
&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=89563">https://rt.cpan.org/Ticket/Display.html?id=89563</a></span> &gt;
&gt; &gt;
&gt; &gt; Thanks for the response Daniel.
&gt; &gt;
&gt; &gt; Could you send me the URL for the shapefiles?  And also send me a
&gt; &gt; bounding box which did not work? That way I can replicate the issue
&gt; &gt; on
&gt; &gt; my machine.
&gt; &gt;
&gt; &gt; Don&#39;t worry about the pull request and test suite.  They&#39;re useful if
&gt; &gt; you&#39;re able to edit the code and provide fixes via git &#40;see, for
&gt; &gt; example, <span class="clickylink"><a target="new" rel="nofollow" href="https://help.github.com/articles/using-pull-requests">https://help.github.com/articles/using-pull-requests</a></span> &#41;.
&gt; &gt;
&gt; &gt; Regards,
&gt; &gt; Shawn.
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; On Mon Feb 10 07:08:06 2014, daniel.smith@baesystems.com wrote:
<div class="message-stanza open">&gt; &gt; &gt; Thanks for getting back to me Shawn!
&gt; &gt; &gt; I may need a bit of hand holding
&gt; &gt; &gt;  What I have here is a bugfixed version which I am using, I tested
&gt; &gt; &gt; it
&gt; &gt; &gt; as follows:
&gt; &gt; &gt;
&gt; &gt; &gt; I downloaded a set of shapefiles which cover the whole of the earth
&gt; &gt; &gt; &#40;openly available fom nasa&#41; I tested the new shapefile routines by
&gt; &gt; &gt; using them to pull out the shapes that overlap with a lat long box,
&gt; &gt; &gt; and seeing that when I found the shapes in a box containing &#40;say&#41;
&gt; &gt; &gt; the
&gt; &gt; &gt; arabian gulf, or the uk, I could plot those shapes in an excel
&gt; &gt; &gt; chart
&gt; &gt; &gt; and the resultant map looked like the correct bits of the
&gt; &gt; &gt; coastline.
&gt; &gt; &gt;
&gt; &gt; &gt; This was good enough for my purposes, but probably not what you
&gt; &gt; &gt; need
&gt; &gt; &gt; because:
&gt; &gt; &gt;
&gt; &gt; &gt; a&#41; The test data set is huge.
&gt; &gt; &gt; b&#41; The pass criteria is subjective
&gt; &gt; &gt;
&gt; &gt; &gt; What we really need is a small set of simple polygons that
&gt; &gt; &gt; definitely
&gt; &gt; &gt; overlap with a box but were not detected by the old routines and
&gt; &gt; &gt; are
&gt; &gt; &gt; by the new one.
&gt; &gt; &gt;
&gt; &gt; &gt; However I also do not really know what you mean by &#34;a pull
&gt; &gt; &gt; request&#34;,
&gt; &gt; &gt; or how to integrate my tests into the &#34;test suite&#34;.
&gt; &gt; &gt;
&gt; &gt; &gt; Daniel Smith
&gt; &gt; &gt; Radar Systems Engineer, Sampson
&gt; &gt; &gt; BAE Systems Maritime Services,
&gt; &gt; &gt; Newport Road,
&gt; &gt; &gt; Cowes,
&gt; &gt; &gt; Isle of Wight, PO31 8PF, UK
&gt; &gt; &gt; I: +44 &#40;0&#41; 198320 2937
&gt; &gt; &gt; :: daniel.smith@baesystems.com / www.baesystems.com
&gt; &gt; &gt;
&gt; &gt; &gt; BAE Systems Integrated System Technologies Limited Registered
&gt; &gt; &gt; Office:
&gt; &gt; &gt; Warwick House, PO Box 87, Farnborough Aerospace Centre,
&gt; &gt; &gt; Farnborough,
&gt; &gt; &gt; Hants, GU14 6YU, UK.
&gt; &gt; &gt; Registered in England &#38; Wales No: 3456325
&gt; &gt; &gt;
&gt; &gt; &gt; P Please consider the environment before printing this email.
&gt; &gt; &gt;
&gt; &gt; &gt; -----Original Message-----
&gt; &gt; &gt;  From: Shawn Laffan via RT [mailto:bug-Geo-ShapeFile@rt.cpan.org]
&gt; &gt; &gt; Sent: 09 February 2014 08:19
&gt; &gt; &gt; To: Smith, Daniel E &#40;UK&#41;
&gt; &gt; &gt; Subject: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect
&gt; &gt; &gt;
&gt; &gt; &gt; ----------------------! WARNING ! ---------------------- This
&gt; &gt; &gt; message
&gt; &gt; &gt; originates from outside our organisation, either from an external
&gt; &gt; &gt; partner or from the internet.
&gt; &gt; &gt; Consider carefully whether you should click on any links, open any
&gt; &gt; &gt; attachments or reply.
&gt; &gt; &gt; Follow the &#39;Report Suspicious Emails&#39; link on IT matters for
&gt; &gt; &gt; instructions on reporting suspicious email messages.
&gt; &gt; &gt; --------------------------------------------------------
&gt; &gt; &gt;
&gt; &gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=89563">https://rt.cpan.org/Ticket/Display.html?id=89563</a></span> &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; Hello Dan,
&gt; &gt; &gt;
&gt; &gt; &gt; Development for this module is now on github.
&gt; &gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/shawnlaffan/Geo-ShapeFile">https://github.com/shawnlaffan/Geo-ShapeFile</a></span>
&gt; &gt; &gt;
&gt; &gt; &gt; Are you able to submit a pull request with these changes, and
&gt; &gt; &gt; ideally
&gt; &gt; &gt; some tests or an update to the test suite?
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; Thanks,
&gt; &gt; &gt; Shawn.
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; On Wed Oct 16 11:49:28 2013, daniel.smith@baesystems.com wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; The Shapes in Area function misses out a LOT of overlapping
&gt; &gt; &gt; &gt; shapes
&gt; &gt; &gt; &gt; because of an erroneous check_in_area test Here it the essential
&gt; &gt; &gt; &gt; part of check_in_area it stands:
&gt; &gt; &gt; &gt; my $lhit = self-&gt;between&#40;x1_min,$x2_min,$x2,max&#41;;
&gt; &gt; &gt; &gt; my $rhit = self-&gt;between&#40;x1_max,$x2_min,$x2,max&#41;;
&gt; &gt; &gt; &gt; my $thit = self-&gt;between&#40;y1_min,$y2_min,$y2,max&#41;;
&gt; &gt; &gt; &gt; my $bhit = self-&gt;between&#40;y1_max,$x2_min,$x2,max&#41;;
&gt; &gt; &gt; &gt; return &#40;#collision
&gt; &gt; &gt; &gt; &#40;$lhit &#38;&#38; $thit&#41; || &#40;$rhit &#38;&#38; $thit&#41; || &#40;$lhit &#38;&#38; $bhit&#41; ||
&gt; &gt; &gt; &gt; &#40;$rhit
&gt; &gt; &gt; &gt; &#38;&#38;
&gt; &gt; &gt; &gt; $bhit&#41;
&gt; &gt; &gt; &gt; &#41; || &#40; #containment
&gt; &gt; &gt; &gt; &#40;$lhit &#38;&#38; $thit&#41; || &#40;$rhit &#38;&#38; $thit&#41; || &#40;$lhit &#38;&#38; $bhit&#41; ||
&gt; &gt; &gt; &gt; &#40;$rhit
&gt; &gt; &gt; &gt; &#38;&#38;
&gt; &gt; &gt; &gt; $bhit&#41;
&gt; &gt; &gt; &gt; &#41;;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; This is  does not return true if the two areas overlap on one
&gt; &gt; &gt; &gt; side
&gt; &gt; &gt; &gt; only, it only fires if at least one corner of each shape is
&gt; &gt; &gt; &gt; within
&gt; &gt; &gt; &gt; the other &#40;or one contains the other&#41; For instance the areas
&gt; &gt; &gt; &gt; {0,10,0,10} and {1,11,1,9}, which are obviously overlapping, are
&gt; &gt; &gt; &gt; not
&gt; &gt; &gt; &gt; detected by the algorithm because:
&gt; &gt; &gt; &gt; between&#40;x1_min,$x2_min,$x2,max&#41; FALSE
&gt; &gt; &gt; &gt; between&#40;x1_max,$x2_min,$x2,max&#41;  TRUE
&gt; &gt; &gt; &gt; between&#40;y1_min,$y2_min,$y2,max&#41; FALSE
&gt; &gt; &gt; &gt; between&#40;y1_max,$x2_min,$x2,max&#41; FALSE Since only one of the tests
&gt; &gt; &gt; &gt; is
&gt; &gt; &gt; &gt; true the algorithm returns false because it needs at least two of
&gt; &gt; &gt; &gt; the tests to fire.
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; A working algorithm only needs one line as follows:
&gt; &gt; &gt; &gt;   return !&#40;$x1_min &gt; $x2_max or $x1_max &lt; $x2_min or $y1_min &gt;
&gt; &gt; &gt; &gt; $y2_max or $y1_max &lt; $y2_min&#41;;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; This has the beneficial side effect that it fires if A contains B
&gt; &gt; &gt; &gt; AND if B contains A, as well as if they overlap Therefore the
&gt; &gt; &gt; &gt; call
&gt; &gt; &gt; &gt; to check_in_area in &#34;shapes_in_area&#34; can be optimised from the
&gt; &gt; &gt; &gt; current:
&gt; &gt; &gt; &gt; If &#40;$self-&gt;check_in_area&#40;@p,@area&#41; ||
&gt; &gt; &gt; &gt; $self-&gt;check_in_area&#40;@area,@p&#41;&#41; {
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; To
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; If &#40;$self-&gt;check_in_area&#40;@p,@area&#41;&#41; {
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; Hope that is clear, if not contact me for a patch.
&gt; &gt; &gt; &gt; Dan Smith
&gt; &gt; &gt; &gt; ********************************************************************
&gt; &gt; &gt; &gt; This email and any attachments are confidential to the intended
&gt; &gt; &gt; &gt; recipient and may also be privileged. If you are not the intended
&gt; &gt; &gt; &gt; recipient please delete it from your system and notify the
&gt; &gt; &gt; &gt; sender.
&gt; &gt; &gt; &gt; You should not copy it or use it for any purpose nor disclose or
&gt; &gt; &gt; &gt; distribute its contents to any other person.
&gt; &gt; &gt; &gt; ********************************************************************
</div>&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt;
</div>&gt; &gt;
&gt; &gt;
&gt; &gt;
</div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;11&nbsp;07:27:27&nbsp;2014</span>
    <span class="description">daniel.smith [...] baesystems.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 11 Feb 2014 12:24:38 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Geo-ShapeFile [...] rt.cpan.org&#34; &lt;bug-Geo-ShapeFile [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Smith, Daniel E &#40;UK&#41;&#34; &lt;daniel.smith [...] baesystems.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">OK!
The attached zip file contains my land map generator &#40;which outputs a .csv can be plotted in excel as a line chart to show a map&#41;, and my modified versions of geo files, which were based on geo 2.51
&#40;I couldn&#39;t find 2.51 any more on cpan, so my windiff comparison with the cpan version was not very useful &#40;as you have made so many useful changes!&#41; perhaps you have access to version 2.51 and can run a dif?&#41;

I downloaded geo 2.54 from cpan and have tried that out, it gives identical results, as is shown in the enclosed spreadsheet

The only measurable difference between geo 2.54 and mine is that with 2.54 the csv generation took  40 seconds, and with mine it took 35.

The difference is probably my mod to get_part in shape.pm, where I have made it use &#34;wantarray&#34; appropriately, so with my modified file I can say:

my $part_ptr = $shape-&gt;get_part&#40;$part&#41;;

Whereas with 2.54 I had to change that to
 
My $part_ptr = [&#40;$shape-&gt;get_part&#40;$part&#41;&#41;];

Which probably takes a bit longer as arrays have to be generated, sliced, and chucked around inside get_part

Perhaps you could release a 2.55 with all your changes &#40;which look very good&#41; plus a get_part that returns a pointer if wanted? This makes it similar to get_points etc.

Daniel Smith 
Radar Systems Engineer, Sampson
BAE Systems Maritime Services,
Newport Road,
Cowes,
Isle of Wight, PO31 8PF, UK
I: +44 &#40;0&#41; 198320 2937 
:: daniel.smith@baesystems.com / www.baesystems.com

BAE Systems Integrated System Technologies Limited  
Registered Office: Warwick House, PO Box 87, Farnborough Aerospace Centre, Farnborough, Hants, GU14 6YU, UK.
Registered in England &#38; Wales No: 3456325 

Please consider the environment before printing this email.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Shawn Laffan via RT [mailto:bug-Geo-ShapeFile@rt.cpan.org] 
Sent: 10 February 2014 20:39
To: Smith, Daniel E &#40;UK&#41;
Subject: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect

----------------------! WARNING ! ---------------------- This message originates from outside our organisation, either from an external partner or from the internet.
Consider carefully whether you should click on any links, open any attachments or reply.
Follow the &#39;Report Suspicious Emails&#39; link on IT matters for instructions on reporting suspicious email messages.
--------------------------------------------------------

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=89563">https://rt.cpan.org/Ticket/Display.html?id=89563</a></span> &gt;

I do have excel &#40;2010 and 2013&#41;, so please send it. 

The coords you sent should also server for debugging.  I&#39;ll give them a go.  

Regards,
Shawn. 


On Mon Feb 10 15:29:57 2014, daniel.smith@baesystems.com wrote:
<div class="message-stanza open">&gt; Hi
&gt; I will do that tomorrow, I am at work at the moment and going home 
&gt; soon Do you have excel by the way, if so I can send you an excel 2010 
&gt; &#40;or
&gt; 2003 if you like&#41; analysis of what goes wrong
&gt; 
&gt; In my original ticket, I mentioned shapes {0,10,0,10} and {1,11,1,9},:
&gt; If you make one of those into a shape, and the other into a bounding 
&gt; box, you will see that the existing code says they do not overlap, but 
&gt; my improved code says they do overlap. If you draw them they obviously 
&gt; overlap too.
&gt; 
&gt; 
&gt; 
&gt; Daniel Smith
&gt; Radar Systems Engineer, Sampson
&gt; BAE Systems Maritime Services,
&gt; Newport Road,
&gt; Cowes,
&gt; Isle of Wight, PO31 8PF, UK
&gt; I: +44 &#40;0&#41; 198320 2937
&gt; :: daniel.smith@baesystems.com / www.baesystems.com
&gt; 
&gt; BAE Systems Integrated System Technologies Limited Registered Office: 
&gt; Warwick House, PO Box 87, Farnborough Aerospace Centre, Farnborough, 
&gt; Hants, GU14 6YU, UK.
&gt; Registered in England &#38; Wales No: 3456325
&gt; 
&gt; P Please consider the environment before printing this email.
&gt; 
&gt; 
&gt; -----Original Message-----
&gt;  From: Shawn Laffan via RT [mailto:bug-Geo-ShapeFile@rt.cpan.org]
&gt; Sent: 10 February 2014 20:13
&gt; To: Smith, Daniel E &#40;UK&#41;
&gt; Subject: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect
&gt; 
&gt; ----------------------! WARNING ! ---------------------- This message 
&gt; originates from outside our organisation, either from an external 
&gt; partner or from the internet.
&gt; Consider carefully whether you should click on any links, open any 
&gt; attachments or reply.
&gt; Follow the &#39;Report Suspicious Emails&#39; link on IT matters for 
&gt; instructions on reporting suspicious email messages.
&gt; --------------------------------------------------------
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=89563">https://rt.cpan.org/Ticket/Display.html?id=89563</a></span> &gt;
&gt; 
&gt; Thanks for the response Daniel.
&gt; 
&gt; Could you send me the URL for the shapefiles?  And also send me a 
&gt; bounding box which did not work? That way I can replicate the issue on 
&gt; my machine.
&gt; 
&gt; Don&#39;t worry about the pull request and test suite.  They&#39;re useful if 
&gt; you&#39;re able to edit the code and provide fixes via git &#40;see, for 
&gt; example, <span class="clickylink"><a target="new" rel="nofollow" href="https://help.github.com/articles/using-pull-requests">https://help.github.com/articles/using-pull-requests</a></span> &#41;.
&gt; 
&gt; Regards,
&gt; Shawn.
&gt; 
&gt; 
&gt; 
&gt; 
&gt; On Mon Feb 10 07:08:06 2014, daniel.smith@baesystems.com wrote:
<div class="message-stanza open">&gt; &gt; Thanks for getting back to me Shawn!
&gt; &gt; I may need a bit of hand holding
&gt; &gt;  What I have here is a bugfixed version which I am using, I tested 
&gt; &gt; it as follows:
&gt; &gt;
&gt; &gt; I downloaded a set of shapefiles which cover the whole of the earth 
&gt; &gt; &#40;openly available fom nasa&#41; I tested the new shapefile routines by 
&gt; &gt; using them to pull out the shapes that overlap with a lat long box, 
&gt; &gt; and seeing that when I found the shapes in a box containing &#40;say&#41; 
&gt; &gt; the arabian gulf, or the uk, I could plot those shapes in an excel 
&gt; &gt; chart and the resultant map looked like the correct bits of the coastline.
&gt; &gt;
&gt; &gt; This was good enough for my purposes, but probably not what you need
&gt; &gt; because:
&gt; &gt;
&gt; &gt; a&#41; The test data set is huge.
&gt; &gt; b&#41; The pass criteria is subjective
&gt; &gt;
&gt; &gt; What we really need is a small set of simple polygons that 
&gt; &gt; definitely overlap with a box but were not detected by the old 
&gt; &gt; routines and are by the new one.
&gt; &gt;
&gt; &gt; However I also do not really know what you mean by &#34;a pull request&#34;, 
&gt; &gt; or how to integrate my tests into the &#34;test suite&#34;.
&gt; &gt;
&gt; &gt; Daniel Smith
&gt; &gt; Radar Systems Engineer, Sampson
&gt; &gt; BAE Systems Maritime Services,
&gt; &gt; Newport Road,
&gt; &gt; Cowes,
&gt; &gt; Isle of Wight, PO31 8PF, UK
&gt; &gt; I: +44 &#40;0&#41; 198320 2937
&gt; &gt; :: daniel.smith@baesystems.com / www.baesystems.com
&gt; &gt;
&gt; &gt; BAE Systems Integrated System Technologies Limited Registered Office:
&gt; &gt; Warwick House, PO Box 87, Farnborough Aerospace Centre, Farnborough, 
&gt; &gt; Hants, GU14 6YU, UK.
&gt; &gt; Registered in England &#38; Wales No: 3456325
&gt; &gt;
&gt; &gt; P Please consider the environment before printing this email.
&gt; &gt;
&gt; &gt; -----Original Message-----
&gt; &gt;  From: Shawn Laffan via RT [mailto:bug-Geo-ShapeFile@rt.cpan.org]
&gt; &gt; Sent: 09 February 2014 08:19
&gt; &gt; To: Smith, Daniel E &#40;UK&#41;
&gt; &gt; Subject: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect
&gt; &gt;
&gt; &gt; ----------------------! WARNING ! ---------------------- This 
&gt; &gt; message originates from outside our organisation, either from an 
&gt; &gt; external partner or from the internet.
&gt; &gt; Consider carefully whether you should click on any links, open any 
&gt; &gt; attachments or reply.
&gt; &gt; Follow the &#39;Report Suspicious Emails&#39; link on IT matters for 
&gt; &gt; instructions on reporting suspicious email messages.
&gt; &gt; --------------------------------------------------------
&gt; &gt;
&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=89563">https://rt.cpan.org/Ticket/Display.html?id=89563</a></span> &gt;
&gt; &gt;
&gt; &gt; Hello Dan,
&gt; &gt;
&gt; &gt; Development for this module is now on github.
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/shawnlaffan/Geo-ShapeFile">https://github.com/shawnlaffan/Geo-ShapeFile</a></span>
&gt; &gt;
&gt; &gt; Are you able to submit a pull request with these changes, and 
&gt; &gt; ideally some tests or an update to the test suite?
&gt; &gt;
&gt; &gt;
&gt; &gt; Thanks,
&gt; &gt; Shawn.
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; On Wed Oct 16 11:49:28 2013, daniel.smith@baesystems.com wrote:
<div class="message-stanza open">&gt; &gt; &gt; The Shapes in Area function misses out a LOT of overlapping shapes 
&gt; &gt; &gt; because of an erroneous check_in_area test Here it the essential 
&gt; &gt; &gt; part of check_in_area it stands:
&gt; &gt; &gt; my $lhit = self-&gt;between&#40;x1_min,$x2_min,$x2,max&#41;;
&gt; &gt; &gt; my $rhit = self-&gt;between&#40;x1_max,$x2_min,$x2,max&#41;;
&gt; &gt; &gt; my $thit = self-&gt;between&#40;y1_min,$y2_min,$y2,max&#41;;
&gt; &gt; &gt; my $bhit = self-&gt;between&#40;y1_max,$x2_min,$x2,max&#41;;
&gt; &gt; &gt; return &#40;#collision
&gt; &gt; &gt; &#40;$lhit &#38;&#38; $thit&#41; || &#40;$rhit &#38;&#38; $thit&#41; || &#40;$lhit &#38;&#38; $bhit&#41; || &#40;$rhit 
&gt; &gt; &gt; &#38;&#38;
&gt; &gt; &gt; $bhit&#41;
&gt; &gt; &gt; &#41; || &#40; #containment
&gt; &gt; &gt; &#40;$lhit &#38;&#38; $thit&#41; || &#40;$rhit &#38;&#38; $thit&#41; || &#40;$lhit &#38;&#38; $bhit&#41; || &#40;$rhit 
&gt; &gt; &gt; &#38;&#38;
&gt; &gt; &gt; $bhit&#41;
&gt; &gt; &gt; &#41;;
&gt; &gt; &gt;
&gt; &gt; &gt; This is  does not return true if the two areas overlap on one side 
&gt; &gt; &gt; only, it only fires if at least one corner of each shape is within 
&gt; &gt; &gt; the other &#40;or one contains the other&#41; For instance the areas 
&gt; &gt; &gt; {0,10,0,10} and {1,11,1,9}, which are obviously overlapping, are 
&gt; &gt; &gt; not detected by the algorithm because:
&gt; &gt; &gt; between&#40;x1_min,$x2_min,$x2,max&#41; FALSE
&gt; &gt; &gt; between&#40;x1_max,$x2_min,$x2,max&#41;  TRUE
&gt; &gt; &gt; between&#40;y1_min,$y2_min,$y2,max&#41; FALSE
&gt; &gt; &gt; between&#40;y1_max,$x2_min,$x2,max&#41; FALSE Since only one of the tests 
&gt; &gt; &gt; is true the algorithm returns false because it needs at least two 
&gt; &gt; &gt; of the tests to fire.
&gt; &gt; &gt;
&gt; &gt; &gt; A working algorithm only needs one line as follows:
&gt; &gt; &gt;   return !&#40;$x1_min &gt; $x2_max or $x1_max &lt; $x2_min or $y1_min &gt; 
&gt; &gt; &gt; $y2_max or $y1_max &lt; $y2_min&#41;;
&gt; &gt; &gt;
&gt; &gt; &gt; This has the beneficial side effect that it fires if A contains B 
&gt; &gt; &gt; AND if B contains A, as well as if they overlap Therefore the call 
&gt; &gt; &gt; to check_in_area in &#34;shapes_in_area&#34; can be optimised from the
&gt; &gt; &gt; current:
&gt; &gt; &gt; If &#40;$self-&gt;check_in_area&#40;@p,@area&#41; ||
&gt; &gt; &gt; $self-&gt;check_in_area&#40;@area,@p&#41;&#41; {
&gt; &gt; &gt;
&gt; &gt; &gt; To
&gt; &gt; &gt;
&gt; &gt; &gt; If &#40;$self-&gt;check_in_area&#40;@p,@area&#41;&#41; {
&gt; &gt; &gt;
&gt; &gt; &gt; Hope that is clear, if not contact me for a patch.
&gt; &gt; &gt; Dan Smith
&gt; &gt; &gt; ******************************************************************
&gt; &gt; &gt; ** This email and any attachments are confidential to the intended 
&gt; &gt; &gt; recipient and may also be privileged. If you are not the intended 
&gt; &gt; &gt; recipient please delete it from your system and notify the sender.
&gt; &gt; &gt; You should not copy it or use it for any purpose nor disclose or 
&gt; &gt; &gt; distribute its contents to any other person.
&gt; &gt; &gt; ******************************************************************
&gt; &gt; &gt; **
</div>&gt; &gt;
&gt; &gt;
&gt; &gt;
</div>&gt; 
&gt; 
&gt; 
</div>


</div></div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction other SystemError odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;11&nbsp;07:27:36&nbsp;2014</span>
    <span class="description">The RT System itself -  System error</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sending the previous mail has failed.  Please contact your admin, they can find more details in the logs.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;11&nbsp;07:53:04&nbsp;2014</span>
    <span class="description">daniel.smith [...] baesystems.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 11 Feb 2014 12:52:51 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Geo-ShapeFile [...] rt.cpan.org&#34; &lt;bug-Geo-ShapeFile [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Smith, Daniel E &#40;UK&#41;&#34; &lt;daniel.smith [...] baesystems.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi, I&#39;ve just read this
The files you need are &#40;it is mentioned in the readme in the previous zip too&#41; in:
<span class="clickylink"><a target="new" rel="nofollow" href="https://hiu.state.gov/data/data.aspx">https://hiu.state.gov/data/data.aspx</a></span>

To use my script with them you need to download the americas and europe world polygons &#40;top two links there&#41; and unzip them to a load of flat files in the binary_maps directory of my perl script, it looks at them by name

I hope all that works and my perl is not *too* dumb! Writing perl is certainly not my main job.

Daniel Smith 
Radar Systems Engineer, Sampson
BAE Systems Maritime Services,
Newport Road,
Cowes,
Isle of Wight, PO31 8PF, UK
I: +44 &#40;0&#41; 198320 2937 
:: daniel.smith@baesystems.com / www.baesystems.com

BAE Systems Integrated System Technologies Limited  
Registered Office: Warwick House, PO Box 87, Farnborough Aerospace Centre, Farnborough, Hants, GU14 6YU, UK.
Registered in England &#38; Wales No: 3456325 

Please consider the environment before printing this email.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Shawn Laffan via RT [mailto:bug-Geo-ShapeFile@rt.cpan.org] 
Sent: 10 February 2014 21:43
To: Smith, Daniel E &#40;UK&#41;
Subject: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect

----------------------! WARNING ! ---------------------- This message originates from outside our organisation, either from an external partner or from the internet.
Consider carefully whether you should click on any links, open any attachments or reply.
Follow the &#39;Report Suspicious Emails&#39; link on IT matters for instructions on reporting suspicious email messages.
--------------------------------------------------------

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=89563">https://rt.cpan.org/Ticket/Display.html?id=89563</a></span> &gt;

Those coords turned out to be very useful. 

The between function is &#40;was&#41; returning false positives due to the use of the lower precedence &#34;and&#34;. This means the max check is skipped when the min check passes, and the function returns true. 

I have fixed the issue, and the code is on github.  It will be in the next release &#40;planned for today&#41;.

I&#39;ve listed the optimisation as its own issue on github &#40;I forgot about that in the last few posts&#41;.  <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/shawnlaffan/Geo-ShapeFile/issues/9">https://github.com/shawnlaffan/Geo-ShapeFile/issues/9</a></span>
 
I&#39;d also still appreciate the URL for the files, as I&#39;m always on the lookout for data and they might be useful for other projects I have.

Regards,
Shawn.


On Mon Feb 10 15:39:19 2014, SLAFFAN wrote:
<div class="message-stanza open">&gt; I do have excel &#40;2010 and 2013&#41;, so please send it.
&gt; 
&gt; The coords you sent should also server for debugging.  I&#39;ll give them 
&gt; a go.
&gt; 
&gt; Regards,
&gt;  Shawn.
&gt; 
&gt; 
&gt; On Mon Feb 10 15:29:57 2014, daniel.smith@baesystems.com wrote:
<div class="message-stanza open">&gt; &gt; Hi
&gt; &gt; I will do that tomorrow, I am at work at the moment and going home 
&gt; &gt; soon Do you have excel by the way, if so I can send you an excel 
&gt; &gt; 2010 &#40;or
&gt; &gt; 2003 if you like&#41; analysis of what goes wrong
&gt; &gt;
&gt; &gt; In my original ticket, I mentioned shapes {0,10,0,10} and
&gt; &gt; {1,11,1,9},:
&gt; &gt; If you make one of those into a shape, and the other into a bounding 
&gt; &gt; box, you will see that the existing code says they do not overlap, 
&gt; &gt; but my improved code says they do overlap. If you draw them they 
&gt; &gt; obviously overlap too.
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; Daniel Smith
&gt; &gt; Radar Systems Engineer, Sampson
&gt; &gt; BAE Systems Maritime Services,
&gt; &gt; Newport Road,
&gt; &gt; Cowes,
&gt; &gt; Isle of Wight, PO31 8PF, UK
&gt; &gt; I: +44 &#40;0&#41; 198320 2937
&gt; &gt; :: daniel.smith@baesystems.com / www.baesystems.com
&gt; &gt;
&gt; &gt; BAE Systems Integrated System Technologies Limited Registered 
&gt; &gt; Office: Warwick House, PO Box 87, Farnborough Aerospace Centre, 
&gt; &gt; Farnborough, Hants, GU14 6YU, UK.
&gt; &gt; Registered in England &#38; Wales No: 3456325
&gt; &gt;
&gt; &gt; P Please consider the environment before printing this email.
&gt; &gt;
&gt; &gt;
&gt; &gt; -----Original Message-----
&gt; &gt;  From: Shawn Laffan via RT [mailto:bug-Geo-ShapeFile@rt.cpan.org]
&gt; &gt; Sent: 10 February 2014 20:13
&gt; &gt; To: Smith, Daniel E &#40;UK&#41;
&gt; &gt; Subject: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect
&gt; &gt;
&gt; &gt; ----------------------! WARNING ! ---------------------- This 
&gt; &gt; message originates from outside our organisation, either from an 
&gt; &gt; external partner or from the internet.
&gt; &gt; Consider carefully whether you should click on any links, open any 
&gt; &gt; attachments or reply.
&gt; &gt; Follow the &#39;Report Suspicious Emails&#39; link on IT matters for 
&gt; &gt; instructions on reporting suspicious email messages.
&gt; &gt; --------------------------------------------------------
&gt; &gt;
&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=89563">https://rt.cpan.org/Ticket/Display.html?id=89563</a></span> &gt;
&gt; &gt;
&gt; &gt; Thanks for the response Daniel.
&gt; &gt;
&gt; &gt; Could you send me the URL for the shapefiles?  And also send me a 
&gt; &gt; bounding box which did not work? That way I can replicate the issue 
&gt; &gt; on my machine.
&gt; &gt;
&gt; &gt; Don&#39;t worry about the pull request and test suite.  They&#39;re useful 
&gt; &gt; if you&#39;re able to edit the code and provide fixes via git &#40;see, for 
&gt; &gt; example, <span class="clickylink"><a target="new" rel="nofollow" href="https://help.github.com/articles/using-pull-requests">https://help.github.com/articles/using-pull-requests</a></span> &#41;.
&gt; &gt;
&gt; &gt; Regards,
&gt; &gt; Shawn.
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; On Mon Feb 10 07:08:06 2014, daniel.smith@baesystems.com wrote:
<div class="message-stanza open">&gt; &gt; &gt; Thanks for getting back to me Shawn!
&gt; &gt; &gt; I may need a bit of hand holding
&gt; &gt; &gt;  What I have here is a bugfixed version which I am using, I tested 
&gt; &gt; &gt; it as follows:
&gt; &gt; &gt;
&gt; &gt; &gt; I downloaded a set of shapefiles which cover the whole of the 
&gt; &gt; &gt; earth &#40;openly available fom nasa&#41; I tested the new shapefile 
&gt; &gt; &gt; routines by using them to pull out the shapes that overlap with a 
&gt; &gt; &gt; lat long box, and seeing that when I found the shapes in a box 
&gt; &gt; &gt; containing &#40;say&#41; the arabian gulf, or the uk, I could plot those 
&gt; &gt; &gt; shapes in an excel chart and the resultant map looked like the 
&gt; &gt; &gt; correct bits of the coastline.
&gt; &gt; &gt;
&gt; &gt; &gt; This was good enough for my purposes, but probably not what you 
&gt; &gt; &gt; need
&gt; &gt; &gt; because:
&gt; &gt; &gt;
&gt; &gt; &gt; a&#41; The test data set is huge.
&gt; &gt; &gt; b&#41; The pass criteria is subjective
&gt; &gt; &gt;
&gt; &gt; &gt; What we really need is a small set of simple polygons that 
&gt; &gt; &gt; definitely overlap with a box but were not detected by the old 
&gt; &gt; &gt; routines and are by the new one.
&gt; &gt; &gt;
&gt; &gt; &gt; However I also do not really know what you mean by &#34;a pull 
&gt; &gt; &gt; request&#34;, or how to integrate my tests into the &#34;test suite&#34;.
&gt; &gt; &gt;
&gt; &gt; &gt; Daniel Smith
&gt; &gt; &gt; Radar Systems Engineer, Sampson
&gt; &gt; &gt; BAE Systems Maritime Services,
&gt; &gt; &gt; Newport Road,
&gt; &gt; &gt; Cowes,
&gt; &gt; &gt; Isle of Wight, PO31 8PF, UK
&gt; &gt; &gt; I: +44 &#40;0&#41; 198320 2937
&gt; &gt; &gt; :: daniel.smith@baesystems.com / www.baesystems.com
&gt; &gt; &gt;
&gt; &gt; &gt; BAE Systems Integrated System Technologies Limited Registered
&gt; &gt; &gt; Office:
&gt; &gt; &gt; Warwick House, PO Box 87, Farnborough Aerospace Centre, 
&gt; &gt; &gt; Farnborough, Hants, GU14 6YU, UK.
&gt; &gt; &gt; Registered in England &#38; Wales No: 3456325
&gt; &gt; &gt;
&gt; &gt; &gt; P Please consider the environment before printing this email.
&gt; &gt; &gt;
&gt; &gt; &gt; -----Original Message-----
&gt; &gt; &gt;  From: Shawn Laffan via RT [mailto:bug-Geo-ShapeFile@rt.cpan.org]
&gt; &gt; &gt; Sent: 09 February 2014 08:19
&gt; &gt; &gt; To: Smith, Daniel E &#40;UK&#41;
&gt; &gt; &gt; Subject: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect
&gt; &gt; &gt;
&gt; &gt; &gt; ----------------------! WARNING ! ---------------------- This 
&gt; &gt; &gt; message originates from outside our organisation, either from an 
&gt; &gt; &gt; external partner or from the internet.
&gt; &gt; &gt; Consider carefully whether you should click on any links, open any 
&gt; &gt; &gt; attachments or reply.
&gt; &gt; &gt; Follow the &#39;Report Suspicious Emails&#39; link on IT matters for 
&gt; &gt; &gt; instructions on reporting suspicious email messages.
&gt; &gt; &gt; --------------------------------------------------------
&gt; &gt; &gt;
&gt; &gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=89563">https://rt.cpan.org/Ticket/Display.html?id=89563</a></span> &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; Hello Dan,
&gt; &gt; &gt;
&gt; &gt; &gt; Development for this module is now on github.
&gt; &gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/shawnlaffan/Geo-ShapeFile">https://github.com/shawnlaffan/Geo-ShapeFile</a></span>
&gt; &gt; &gt;
&gt; &gt; &gt; Are you able to submit a pull request with these changes, and 
&gt; &gt; &gt; ideally some tests or an update to the test suite?
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; Thanks,
&gt; &gt; &gt; Shawn.
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; On Wed Oct 16 11:49:28 2013, daniel.smith@baesystems.com wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; The Shapes in Area function misses out a LOT of overlapping 
&gt; &gt; &gt; &gt; shapes because of an erroneous check_in_area test Here it the 
&gt; &gt; &gt; &gt; essential part of check_in_area it stands:
&gt; &gt; &gt; &gt; my $lhit = self-&gt;between&#40;x1_min,$x2_min,$x2,max&#41;;
&gt; &gt; &gt; &gt; my $rhit = self-&gt;between&#40;x1_max,$x2_min,$x2,max&#41;;
&gt; &gt; &gt; &gt; my $thit = self-&gt;between&#40;y1_min,$y2_min,$y2,max&#41;;
&gt; &gt; &gt; &gt; my $bhit = self-&gt;between&#40;y1_max,$x2_min,$x2,max&#41;;
&gt; &gt; &gt; &gt; return &#40;#collision
&gt; &gt; &gt; &gt; &#40;$lhit &#38;&#38; $thit&#41; || &#40;$rhit &#38;&#38; $thit&#41; || &#40;$lhit &#38;&#38; $bhit&#41; || 
&gt; &gt; &gt; &gt; &#40;$rhit &#38;&#38;
&gt; &gt; &gt; &gt; $bhit&#41;
&gt; &gt; &gt; &gt; &#41; || &#40; #containment
&gt; &gt; &gt; &gt; &#40;$lhit &#38;&#38; $thit&#41; || &#40;$rhit &#38;&#38; $thit&#41; || &#40;$lhit &#38;&#38; $bhit&#41; || 
&gt; &gt; &gt; &gt; &#40;$rhit &#38;&#38;
&gt; &gt; &gt; &gt; $bhit&#41;
&gt; &gt; &gt; &gt; &#41;;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; This is  does not return true if the two areas overlap on one 
&gt; &gt; &gt; &gt; side only, it only fires if at least one corner of each shape is 
&gt; &gt; &gt; &gt; within the other &#40;or one contains the other&#41; For instance the 
&gt; &gt; &gt; &gt; areas {0,10,0,10} and {1,11,1,9}, which are obviously 
&gt; &gt; &gt; &gt; overlapping, are not detected by the algorithm because:
&gt; &gt; &gt; &gt; between&#40;x1_min,$x2_min,$x2,max&#41; FALSE
&gt; &gt; &gt; &gt; between&#40;x1_max,$x2_min,$x2,max&#41;  TRUE
&gt; &gt; &gt; &gt; between&#40;y1_min,$y2_min,$y2,max&#41; FALSE
&gt; &gt; &gt; &gt; between&#40;y1_max,$x2_min,$x2,max&#41; FALSE Since only one of the 
&gt; &gt; &gt; &gt; tests is true the algorithm returns false because it needs at 
&gt; &gt; &gt; &gt; least two of the tests to fire.
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; A working algorithm only needs one line as follows:
&gt; &gt; &gt; &gt;   return !&#40;$x1_min &gt; $x2_max or $x1_max &lt; $x2_min or $y1_min &gt; 
&gt; &gt; &gt; &gt; $y2_max or $y1_max &lt; $y2_min&#41;;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; This has the beneficial side effect that it fires if A contains 
&gt; &gt; &gt; &gt; B AND if B contains A, as well as if they overlap Therefore the 
&gt; &gt; &gt; &gt; call to check_in_area in &#34;shapes_in_area&#34; can be optimised from 
&gt; &gt; &gt; &gt; the
&gt; &gt; &gt; &gt; current:
&gt; &gt; &gt; &gt; If &#40;$self-&gt;check_in_area&#40;@p,@area&#41; ||
&gt; &gt; &gt; &gt; $self-&gt;check_in_area&#40;@area,@p&#41;&#41; {
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; To
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; If &#40;$self-&gt;check_in_area&#40;@p,@area&#41;&#41; {
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; Hope that is clear, if not contact me for a patch.
&gt; &gt; &gt; &gt; Dan Smith
&gt; &gt; &gt; &gt; ****************************************************************
&gt; &gt; &gt; &gt; **** This email and any attachments are confidential to the 
&gt; &gt; &gt; &gt; intended recipient and may also be privileged. If you are not 
&gt; &gt; &gt; &gt; the intended recipient please delete it from your system and 
&gt; &gt; &gt; &gt; notify the sender.
&gt; &gt; &gt; &gt; You should not copy it or use it for any purpose nor disclose or 
&gt; &gt; &gt; &gt; distribute its contents to any other person.
&gt; &gt; &gt; &gt; ****************************************************************
&gt; &gt; &gt; &gt; ****
</div>&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt;
</div>&gt; &gt;
&gt; &gt;
&gt; &gt;
</div></div>


********************************************************************
This email and any attachments are confidential to the intended
recipient and may also be privileged. If you are not the intended
recipient please delete it from your system and notify the sender.
You should not copy it or use it for any purpose nor disclose or
distribute its contents to any other person.
********************************************************************
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;11&nbsp;08:11:38&nbsp;2014</span>
    <span class="description">daniel.smith [...] baesystems.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 11 Feb 2014 13:11:19 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Geo-ShapeFile [...] rt.cpan.org&#34; &lt;bug-Geo-ShapeFile [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Smith, Daniel E &#40;UK&#41;&#34; &lt;daniel.smith [...] baesystems.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Yes, I agree with you about the between function not working, but I can&#39;t see any low precedence and in it, they all look like high precedence ones. maybe I fixed them and forgot about it. Personally I always use low precedence Boolean functions unless I really need  the high precedence ones, as they usually reduce the number of brackets needed and more often work the way you think they should.

I also think that the way it written with the between function made it hard to review and spot the bug.

By the way, the shapefile.pm I sent you has a slightly &#40;and unimportantly&#41; difference check_in_area, the method I suggested on cpan was:

!&#40;a  or b  or c or d&#41; 

When a, b, c and d are the tests eg &#34;s1_max &lt; s2_min&#34;

But when I did this to my own file I though it was a bit neater to change to the equivalent:
&#40;a&#39; and b&#39; and c&#39; and d&#39;&#41;

And reverse the tests to &#40;e.g&#41;

S1_max &gt;= s2_min
 
It can be done either way around of course, makes no practical difference 

Cheers


Daniel Smith 
Radar Systems Engineer, Sampson
BAE Systems Maritime Services,
Newport Road,
Cowes,
Isle of Wight, PO31 8PF, UK
I: +44 &#40;0&#41; 198320 2937 
:: daniel.smith@baesystems.com / www.baesystems.com

BAE Systems Integrated System Technologies Limited  
Registered Office: Warwick House, PO Box 87, Farnborough Aerospace Centre, Farnborough, Hants, GU14 6YU, UK.
Registered in England &#38; Wales No: 3456325 

Please consider the environment before printing this email.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Shawn Laffan via RT [mailto:bug-Geo-ShapeFile@rt.cpan.org] 
Sent: 10 February 2014 21:43
To: Smith, Daniel E &#40;UK&#41;
Subject: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect

----------------------! WARNING ! ---------------------- This message originates from outside our organisation, either from an external partner or from the internet.
Consider carefully whether you should click on any links, open any attachments or reply.
Follow the &#39;Report Suspicious Emails&#39; link on IT matters for instructions on reporting suspicious email messages.
--------------------------------------------------------

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=89563">https://rt.cpan.org/Ticket/Display.html?id=89563</a></span> &gt;

Those coords turned out to be very useful. 

The between function is &#40;was&#41; returning false positives due to the use of the lower precedence &#34;and&#34;. This means the max check is skipped when the min check passes, and the function returns true. 

I have fixed the issue, and the code is on github.  It will be in the next release &#40;planned for today&#41;.

I&#39;ve listed the optimisation as its own issue on github &#40;I forgot about that in the last few posts&#41;.  <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/shawnlaffan/Geo-ShapeFile/issues/9">https://github.com/shawnlaffan/Geo-ShapeFile/issues/9</a></span>
 
I&#39;d also still appreciate the URL for the files, as I&#39;m always on the lookout for data and they might be useful for other projects I have.

Regards,
Shawn.


On Mon Feb 10 15:39:19 2014, SLAFFAN wrote:
<div class="message-stanza open">&gt; I do have excel &#40;2010 and 2013&#41;, so please send it.
&gt; 
&gt; The coords you sent should also server for debugging.  I&#39;ll give them 
&gt; a go.
&gt; 
&gt; Regards,
&gt;  Shawn.
&gt; 
&gt; 
&gt; On Mon Feb 10 15:29:57 2014, daniel.smith@baesystems.com wrote:
<div class="message-stanza open">&gt; &gt; Hi
&gt; &gt; I will do that tomorrow, I am at work at the moment and going home 
&gt; &gt; soon Do you have excel by the way, if so I can send you an excel 
&gt; &gt; 2010 &#40;or
&gt; &gt; 2003 if you like&#41; analysis of what goes wrong
&gt; &gt;
&gt; &gt; In my original ticket, I mentioned shapes {0,10,0,10} and
&gt; &gt; {1,11,1,9},:
&gt; &gt; If you make one of those into a shape, and the other into a bounding 
&gt; &gt; box, you will see that the existing code says they do not overlap, 
&gt; &gt; but my improved code says they do overlap. If you draw them they 
&gt; &gt; obviously overlap too.
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; Daniel Smith
&gt; &gt; Radar Systems Engineer, Sampson
&gt; &gt; BAE Systems Maritime Services,
&gt; &gt; Newport Road,
&gt; &gt; Cowes,
&gt; &gt; Isle of Wight, PO31 8PF, UK
&gt; &gt; I: +44 &#40;0&#41; 198320 2937
&gt; &gt; :: daniel.smith@baesystems.com / www.baesystems.com
&gt; &gt;
&gt; &gt; BAE Systems Integrated System Technologies Limited Registered 
&gt; &gt; Office: Warwick House, PO Box 87, Farnborough Aerospace Centre, 
&gt; &gt; Farnborough, Hants, GU14 6YU, UK.
&gt; &gt; Registered in England &#38; Wales No: 3456325
&gt; &gt;
&gt; &gt; P Please consider the environment before printing this email.
&gt; &gt;
&gt; &gt;
&gt; &gt; -----Original Message-----
&gt; &gt;  From: Shawn Laffan via RT [mailto:bug-Geo-ShapeFile@rt.cpan.org]
&gt; &gt; Sent: 10 February 2014 20:13
&gt; &gt; To: Smith, Daniel E &#40;UK&#41;
&gt; &gt; Subject: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect
&gt; &gt;
&gt; &gt; ----------------------! WARNING ! ---------------------- This 
&gt; &gt; message originates from outside our organisation, either from an 
&gt; &gt; external partner or from the internet.
&gt; &gt; Consider carefully whether you should click on any links, open any 
&gt; &gt; attachments or reply.
&gt; &gt; Follow the &#39;Report Suspicious Emails&#39; link on IT matters for 
&gt; &gt; instructions on reporting suspicious email messages.
&gt; &gt; --------------------------------------------------------
&gt; &gt;
&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=89563">https://rt.cpan.org/Ticket/Display.html?id=89563</a></span> &gt;
&gt; &gt;
&gt; &gt; Thanks for the response Daniel.
&gt; &gt;
&gt; &gt; Could you send me the URL for the shapefiles?  And also send me a 
&gt; &gt; bounding box which did not work? That way I can replicate the issue 
&gt; &gt; on my machine.
&gt; &gt;
&gt; &gt; Don&#39;t worry about the pull request and test suite.  They&#39;re useful 
&gt; &gt; if you&#39;re able to edit the code and provide fixes via git &#40;see, for 
&gt; &gt; example, <span class="clickylink"><a target="new" rel="nofollow" href="https://help.github.com/articles/using-pull-requests">https://help.github.com/articles/using-pull-requests</a></span> &#41;.
&gt; &gt;
&gt; &gt; Regards,
&gt; &gt; Shawn.
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; On Mon Feb 10 07:08:06 2014, daniel.smith@baesystems.com wrote:
<div class="message-stanza open">&gt; &gt; &gt; Thanks for getting back to me Shawn!
&gt; &gt; &gt; I may need a bit of hand holding
&gt; &gt; &gt;  What I have here is a bugfixed version which I am using, I tested 
&gt; &gt; &gt; it as follows:
&gt; &gt; &gt;
&gt; &gt; &gt; I downloaded a set of shapefiles which cover the whole of the 
&gt; &gt; &gt; earth &#40;openly available fom nasa&#41; I tested the new shapefile 
&gt; &gt; &gt; routines by using them to pull out the shapes that overlap with a 
&gt; &gt; &gt; lat long box, and seeing that when I found the shapes in a box 
&gt; &gt; &gt; containing &#40;say&#41; the arabian gulf, or the uk, I could plot those 
&gt; &gt; &gt; shapes in an excel chart and the resultant map looked like the 
&gt; &gt; &gt; correct bits of the coastline.
&gt; &gt; &gt;
&gt; &gt; &gt; This was good enough for my purposes, but probably not what you 
&gt; &gt; &gt; need
&gt; &gt; &gt; because:
&gt; &gt; &gt;
&gt; &gt; &gt; a&#41; The test data set is huge.
&gt; &gt; &gt; b&#41; The pass criteria is subjective
&gt; &gt; &gt;
&gt; &gt; &gt; What we really need is a small set of simple polygons that 
&gt; &gt; &gt; definitely overlap with a box but were not detected by the old 
&gt; &gt; &gt; routines and are by the new one.
&gt; &gt; &gt;
&gt; &gt; &gt; However I also do not really know what you mean by &#34;a pull 
&gt; &gt; &gt; request&#34;, or how to integrate my tests into the &#34;test suite&#34;.
&gt; &gt; &gt;
&gt; &gt; &gt; Daniel Smith
&gt; &gt; &gt; Radar Systems Engineer, Sampson
&gt; &gt; &gt; BAE Systems Maritime Services,
&gt; &gt; &gt; Newport Road,
&gt; &gt; &gt; Cowes,
&gt; &gt; &gt; Isle of Wight, PO31 8PF, UK
&gt; &gt; &gt; I: +44 &#40;0&#41; 198320 2937
&gt; &gt; &gt; :: daniel.smith@baesystems.com / www.baesystems.com
&gt; &gt; &gt;
&gt; &gt; &gt; BAE Systems Integrated System Technologies Limited Registered
&gt; &gt; &gt; Office:
&gt; &gt; &gt; Warwick House, PO Box 87, Farnborough Aerospace Centre, 
&gt; &gt; &gt; Farnborough, Hants, GU14 6YU, UK.
&gt; &gt; &gt; Registered in England &#38; Wales No: 3456325
&gt; &gt; &gt;
&gt; &gt; &gt; P Please consider the environment before printing this email.
&gt; &gt; &gt;
&gt; &gt; &gt; -----Original Message-----
&gt; &gt; &gt;  From: Shawn Laffan via RT [mailto:bug-Geo-ShapeFile@rt.cpan.org]
&gt; &gt; &gt; Sent: 09 February 2014 08:19
&gt; &gt; &gt; To: Smith, Daniel E &#40;UK&#41;
&gt; &gt; &gt; Subject: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect
&gt; &gt; &gt;
&gt; &gt; &gt; ----------------------! WARNING ! ---------------------- This 
&gt; &gt; &gt; message originates from outside our organisation, either from an 
&gt; &gt; &gt; external partner or from the internet.
&gt; &gt; &gt; Consider carefully whether you should click on any links, open any 
&gt; &gt; &gt; attachments or reply.
&gt; &gt; &gt; Follow the &#39;Report Suspicious Emails&#39; link on IT matters for 
&gt; &gt; &gt; instructions on reporting suspicious email messages.
&gt; &gt; &gt; --------------------------------------------------------
&gt; &gt; &gt;
&gt; &gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=89563">https://rt.cpan.org/Ticket/Display.html?id=89563</a></span> &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; Hello Dan,
&gt; &gt; &gt;
&gt; &gt; &gt; Development for this module is now on github.
&gt; &gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/shawnlaffan/Geo-ShapeFile">https://github.com/shawnlaffan/Geo-ShapeFile</a></span>
&gt; &gt; &gt;
&gt; &gt; &gt; Are you able to submit a pull request with these changes, and 
&gt; &gt; &gt; ideally some tests or an update to the test suite?
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; Thanks,
&gt; &gt; &gt; Shawn.
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; On Wed Oct 16 11:49:28 2013, daniel.smith@baesystems.com wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; The Shapes in Area function misses out a LOT of overlapping 
&gt; &gt; &gt; &gt; shapes because of an erroneous check_in_area test Here it the 
&gt; &gt; &gt; &gt; essential part of check_in_area it stands:
&gt; &gt; &gt; &gt; my $lhit = self-&gt;between&#40;x1_min,$x2_min,$x2,max&#41;;
&gt; &gt; &gt; &gt; my $rhit = self-&gt;between&#40;x1_max,$x2_min,$x2,max&#41;;
&gt; &gt; &gt; &gt; my $thit = self-&gt;between&#40;y1_min,$y2_min,$y2,max&#41;;
&gt; &gt; &gt; &gt; my $bhit = self-&gt;between&#40;y1_max,$x2_min,$x2,max&#41;;
&gt; &gt; &gt; &gt; return &#40;#collision
&gt; &gt; &gt; &gt; &#40;$lhit &#38;&#38; $thit&#41; || &#40;$rhit &#38;&#38; $thit&#41; || &#40;$lhit &#38;&#38; $bhit&#41; || 
&gt; &gt; &gt; &gt; &#40;$rhit &#38;&#38;
&gt; &gt; &gt; &gt; $bhit&#41;
&gt; &gt; &gt; &gt; &#41; || &#40; #containment
&gt; &gt; &gt; &gt; &#40;$lhit &#38;&#38; $thit&#41; || &#40;$rhit &#38;&#38; $thit&#41; || &#40;$lhit &#38;&#38; $bhit&#41; || 
&gt; &gt; &gt; &gt; &#40;$rhit &#38;&#38;
&gt; &gt; &gt; &gt; $bhit&#41;
&gt; &gt; &gt; &gt; &#41;;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; This is  does not return true if the two areas overlap on one 
&gt; &gt; &gt; &gt; side only, it only fires if at least one corner of each shape is 
&gt; &gt; &gt; &gt; within the other &#40;or one contains the other&#41; For instance the 
&gt; &gt; &gt; &gt; areas {0,10,0,10} and {1,11,1,9}, which are obviously 
&gt; &gt; &gt; &gt; overlapping, are not detected by the algorithm because:
&gt; &gt; &gt; &gt; between&#40;x1_min,$x2_min,$x2,max&#41; FALSE
&gt; &gt; &gt; &gt; between&#40;x1_max,$x2_min,$x2,max&#41;  TRUE
&gt; &gt; &gt; &gt; between&#40;y1_min,$y2_min,$y2,max&#41; FALSE
&gt; &gt; &gt; &gt; between&#40;y1_max,$x2_min,$x2,max&#41; FALSE Since only one of the 
&gt; &gt; &gt; &gt; tests is true the algorithm returns false because it needs at 
&gt; &gt; &gt; &gt; least two of the tests to fire.
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; A working algorithm only needs one line as follows:
&gt; &gt; &gt; &gt;   return !&#40;$x1_min &gt; $x2_max or $x1_max &lt; $x2_min or $y1_min &gt; 
&gt; &gt; &gt; &gt; $y2_max or $y1_max &lt; $y2_min&#41;;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; This has the beneficial side effect that it fires if A contains 
&gt; &gt; &gt; &gt; B AND if B contains A, as well as if they overlap Therefore the 
&gt; &gt; &gt; &gt; call to check_in_area in &#34;shapes_in_area&#34; can be optimised from 
&gt; &gt; &gt; &gt; the
&gt; &gt; &gt; &gt; current:
&gt; &gt; &gt; &gt; If &#40;$self-&gt;check_in_area&#40;@p,@area&#41; ||
&gt; &gt; &gt; &gt; $self-&gt;check_in_area&#40;@area,@p&#41;&#41; {
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; To
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; If &#40;$self-&gt;check_in_area&#40;@p,@area&#41;&#41; {
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; Hope that is clear, if not contact me for a patch.
&gt; &gt; &gt; &gt; Dan Smith
&gt; &gt; &gt; &gt; ****************************************************************
&gt; &gt; &gt; &gt; **** This email and any attachments are confidential to the 
&gt; &gt; &gt; &gt; intended recipient and may also be privileged. If you are not 
&gt; &gt; &gt; &gt; the intended recipient please delete it from your system and 
&gt; &gt; &gt; &gt; notify the sender.
&gt; &gt; &gt; &gt; You should not copy it or use it for any purpose nor disclose or 
&gt; &gt; &gt; &gt; distribute its contents to any other person.
&gt; &gt; &gt; &gt; ****************************************************************
&gt; &gt; &gt; &gt; ****
</div>&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt;
</div>&gt; &gt;
&gt; &gt;
&gt; &gt;
</div></div>


********************************************************************
This email and any attachments are confidential to the intended
recipient and may also be privileged. If you are not the intended
recipient please delete it from your system and notify the sender.
You should not copy it or use it for any purpose nor disclose or
distribute its contents to any other person.
********************************************************************
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;11&nbsp;08:48:29&nbsp;2014</span>
    <span class="description">daniel.smith [...] baesystems.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 11 Feb 2014 13:48:11 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Geo-ShapeFile [...] rt.cpan.org&#34; &lt;bug-Geo-ShapeFile [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Smith, Daniel E &#40;UK&#41;&#34; &lt;daniel.smith [...] baesystems.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ok, by the way, I think that the dependencies in <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/shawnlaffan/Geo-ShapeFile">https://github.com/shawnlaffan/Geo-ShapeFile</a></span>
are missing parent.pm?

At least, I had to download parent.pm to get the new version working


Daniel Smith 
Radar Systems Engineer, Sampson
BAE Systems Maritime Services,
Newport Road,
Cowes,
Isle of Wight, PO31 8PF, UK
I: +44 &#40;0&#41; 198320 2937 
:: daniel.smith@baesystems.com / www.baesystems.com

BAE Systems Integrated System Technologies Limited  
Registered Office: Warwick House, PO Box 87, Farnborough Aerospace Centre, Farnborough, Hants, GU14 6YU, UK.
Registered in England &#38; Wales No: 3456325 

Please consider the environment before printing this email.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Shawn Laffan via RT [mailto:bug-Geo-ShapeFile@rt.cpan.org] 
Sent: 10 February 2014 21:43
To: Smith, Daniel E &#40;UK&#41;
Subject: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect

----------------------! WARNING ! ---------------------- This message originates from outside our organisation, either from an external partner or from the internet.
Consider carefully whether you should click on any links, open any attachments or reply.
Follow the &#39;Report Suspicious Emails&#39; link on IT matters for instructions on reporting suspicious email messages.
--------------------------------------------------------

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=89563">https://rt.cpan.org/Ticket/Display.html?id=89563</a></span> &gt;

Those coords turned out to be very useful. 

The between function is &#40;was&#41; returning false positives due to the use of the lower precedence &#34;and&#34;. This means the max check is skipped when the min check passes, and the function returns true. 

I have fixed the issue, and the code is on github.  It will be in the next release &#40;planned for today&#41;.

I&#39;ve listed the optimisation as its own issue on github &#40;I forgot about that in the last few posts&#41;.  <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/shawnlaffan/Geo-ShapeFile/issues/9">https://github.com/shawnlaffan/Geo-ShapeFile/issues/9</a></span>
 
I&#39;d also still appreciate the URL for the files, as I&#39;m always on the lookout for data and they might be useful for other projects I have.

Regards,
Shawn.


On Mon Feb 10 15:39:19 2014, SLAFFAN wrote:
<div class="message-stanza open">&gt; I do have excel &#40;2010 and 2013&#41;, so please send it.
&gt; 
&gt; The coords you sent should also server for debugging.  I&#39;ll give them 
&gt; a go.
&gt; 
&gt; Regards,
&gt;  Shawn.
&gt; 
&gt; 
&gt; On Mon Feb 10 15:29:57 2014, daniel.smith@baesystems.com wrote:
<div class="message-stanza open">&gt; &gt; Hi
&gt; &gt; I will do that tomorrow, I am at work at the moment and going home 
&gt; &gt; soon Do you have excel by the way, if so I can send you an excel 
&gt; &gt; 2010 &#40;or
&gt; &gt; 2003 if you like&#41; analysis of what goes wrong
&gt; &gt;
&gt; &gt; In my original ticket, I mentioned shapes {0,10,0,10} and
&gt; &gt; {1,11,1,9},:
&gt; &gt; If you make one of those into a shape, and the other into a bounding 
&gt; &gt; box, you will see that the existing code says they do not overlap, 
&gt; &gt; but my improved code says they do overlap. If you draw them they 
&gt; &gt; obviously overlap too.
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; Daniel Smith
&gt; &gt; Radar Systems Engineer, Sampson
&gt; &gt; BAE Systems Maritime Services,
&gt; &gt; Newport Road,
&gt; &gt; Cowes,
&gt; &gt; Isle of Wight, PO31 8PF, UK
&gt; &gt; I: +44 &#40;0&#41; 198320 2937
&gt; &gt; :: daniel.smith@baesystems.com / www.baesystems.com
&gt; &gt;
&gt; &gt; BAE Systems Integrated System Technologies Limited Registered 
&gt; &gt; Office: Warwick House, PO Box 87, Farnborough Aerospace Centre, 
&gt; &gt; Farnborough, Hants, GU14 6YU, UK.
&gt; &gt; Registered in England &#38; Wales No: 3456325
&gt; &gt;
&gt; &gt; P Please consider the environment before printing this email.
&gt; &gt;
&gt; &gt;
&gt; &gt; -----Original Message-----
&gt; &gt;  From: Shawn Laffan via RT [mailto:bug-Geo-ShapeFile@rt.cpan.org]
&gt; &gt; Sent: 10 February 2014 20:13
&gt; &gt; To: Smith, Daniel E &#40;UK&#41;
&gt; &gt; Subject: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect
&gt; &gt;
&gt; &gt; ----------------------! WARNING ! ---------------------- This 
&gt; &gt; message originates from outside our organisation, either from an 
&gt; &gt; external partner or from the internet.
&gt; &gt; Consider carefully whether you should click on any links, open any 
&gt; &gt; attachments or reply.
&gt; &gt; Follow the &#39;Report Suspicious Emails&#39; link on IT matters for 
&gt; &gt; instructions on reporting suspicious email messages.
&gt; &gt; --------------------------------------------------------
&gt; &gt;
&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=89563">https://rt.cpan.org/Ticket/Display.html?id=89563</a></span> &gt;
&gt; &gt;
&gt; &gt; Thanks for the response Daniel.
&gt; &gt;
&gt; &gt; Could you send me the URL for the shapefiles?  And also send me a 
&gt; &gt; bounding box which did not work? That way I can replicate the issue 
&gt; &gt; on my machine.
&gt; &gt;
&gt; &gt; Don&#39;t worry about the pull request and test suite.  They&#39;re useful 
&gt; &gt; if you&#39;re able to edit the code and provide fixes via git &#40;see, for 
&gt; &gt; example, <span class="clickylink"><a target="new" rel="nofollow" href="https://help.github.com/articles/using-pull-requests">https://help.github.com/articles/using-pull-requests</a></span> &#41;.
&gt; &gt;
&gt; &gt; Regards,
&gt; &gt; Shawn.
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; On Mon Feb 10 07:08:06 2014, daniel.smith@baesystems.com wrote:
<div class="message-stanza open">&gt; &gt; &gt; Thanks for getting back to me Shawn!
&gt; &gt; &gt; I may need a bit of hand holding
&gt; &gt; &gt;  What I have here is a bugfixed version which I am using, I tested 
&gt; &gt; &gt; it as follows:
&gt; &gt; &gt;
&gt; &gt; &gt; I downloaded a set of shapefiles which cover the whole of the 
&gt; &gt; &gt; earth &#40;openly available fom nasa&#41; I tested the new shapefile 
&gt; &gt; &gt; routines by using them to pull out the shapes that overlap with a 
&gt; &gt; &gt; lat long box, and seeing that when I found the shapes in a box 
&gt; &gt; &gt; containing &#40;say&#41; the arabian gulf, or the uk, I could plot those 
&gt; &gt; &gt; shapes in an excel chart and the resultant map looked like the 
&gt; &gt; &gt; correct bits of the coastline.
&gt; &gt; &gt;
&gt; &gt; &gt; This was good enough for my purposes, but probably not what you 
&gt; &gt; &gt; need
&gt; &gt; &gt; because:
&gt; &gt; &gt;
&gt; &gt; &gt; a&#41; The test data set is huge.
&gt; &gt; &gt; b&#41; The pass criteria is subjective
&gt; &gt; &gt;
&gt; &gt; &gt; What we really need is a small set of simple polygons that 
&gt; &gt; &gt; definitely overlap with a box but were not detected by the old 
&gt; &gt; &gt; routines and are by the new one.
&gt; &gt; &gt;
&gt; &gt; &gt; However I also do not really know what you mean by &#34;a pull 
&gt; &gt; &gt; request&#34;, or how to integrate my tests into the &#34;test suite&#34;.
&gt; &gt; &gt;
&gt; &gt; &gt; Daniel Smith
&gt; &gt; &gt; Radar Systems Engineer, Sampson
&gt; &gt; &gt; BAE Systems Maritime Services,
&gt; &gt; &gt; Newport Road,
&gt; &gt; &gt; Cowes,
&gt; &gt; &gt; Isle of Wight, PO31 8PF, UK
&gt; &gt; &gt; I: +44 &#40;0&#41; 198320 2937
&gt; &gt; &gt; :: daniel.smith@baesystems.com / www.baesystems.com
&gt; &gt; &gt;
&gt; &gt; &gt; BAE Systems Integrated System Technologies Limited Registered
&gt; &gt; &gt; Office:
&gt; &gt; &gt; Warwick House, PO Box 87, Farnborough Aerospace Centre, 
&gt; &gt; &gt; Farnborough, Hants, GU14 6YU, UK.
&gt; &gt; &gt; Registered in England &#38; Wales No: 3456325
&gt; &gt; &gt;
&gt; &gt; &gt; P Please consider the environment before printing this email.
&gt; &gt; &gt;
&gt; &gt; &gt; -----Original Message-----
&gt; &gt; &gt;  From: Shawn Laffan via RT [mailto:bug-Geo-ShapeFile@rt.cpan.org]
&gt; &gt; &gt; Sent: 09 February 2014 08:19
&gt; &gt; &gt; To: Smith, Daniel E &#40;UK&#41;
&gt; &gt; &gt; Subject: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect
&gt; &gt; &gt;
&gt; &gt; &gt; ----------------------! WARNING ! ---------------------- This 
&gt; &gt; &gt; message originates from outside our organisation, either from an 
&gt; &gt; &gt; external partner or from the internet.
&gt; &gt; &gt; Consider carefully whether you should click on any links, open any 
&gt; &gt; &gt; attachments or reply.
&gt; &gt; &gt; Follow the &#39;Report Suspicious Emails&#39; link on IT matters for 
&gt; &gt; &gt; instructions on reporting suspicious email messages.
&gt; &gt; &gt; --------------------------------------------------------
&gt; &gt; &gt;
&gt; &gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=89563">https://rt.cpan.org/Ticket/Display.html?id=89563</a></span> &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; Hello Dan,
&gt; &gt; &gt;
&gt; &gt; &gt; Development for this module is now on github.
&gt; &gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/shawnlaffan/Geo-ShapeFile">https://github.com/shawnlaffan/Geo-ShapeFile</a></span>
&gt; &gt; &gt;
&gt; &gt; &gt; Are you able to submit a pull request with these changes, and 
&gt; &gt; &gt; ideally some tests or an update to the test suite?
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; Thanks,
&gt; &gt; &gt; Shawn.
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; On Wed Oct 16 11:49:28 2013, daniel.smith@baesystems.com wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; The Shapes in Area function misses out a LOT of overlapping 
&gt; &gt; &gt; &gt; shapes because of an erroneous check_in_area test Here it the 
&gt; &gt; &gt; &gt; essential part of check_in_area it stands:
&gt; &gt; &gt; &gt; my $lhit = self-&gt;between&#40;x1_min,$x2_min,$x2,max&#41;;
&gt; &gt; &gt; &gt; my $rhit = self-&gt;between&#40;x1_max,$x2_min,$x2,max&#41;;
&gt; &gt; &gt; &gt; my $thit = self-&gt;between&#40;y1_min,$y2_min,$y2,max&#41;;
&gt; &gt; &gt; &gt; my $bhit = self-&gt;between&#40;y1_max,$x2_min,$x2,max&#41;;
&gt; &gt; &gt; &gt; return &#40;#collision
&gt; &gt; &gt; &gt; &#40;$lhit &#38;&#38; $thit&#41; || &#40;$rhit &#38;&#38; $thit&#41; || &#40;$lhit &#38;&#38; $bhit&#41; || 
&gt; &gt; &gt; &gt; &#40;$rhit &#38;&#38;
&gt; &gt; &gt; &gt; $bhit&#41;
&gt; &gt; &gt; &gt; &#41; || &#40; #containment
&gt; &gt; &gt; &gt; &#40;$lhit &#38;&#38; $thit&#41; || &#40;$rhit &#38;&#38; $thit&#41; || &#40;$lhit &#38;&#38; $bhit&#41; || 
&gt; &gt; &gt; &gt; &#40;$rhit &#38;&#38;
&gt; &gt; &gt; &gt; $bhit&#41;
&gt; &gt; &gt; &gt; &#41;;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; This is  does not return true if the two areas overlap on one 
&gt; &gt; &gt; &gt; side only, it only fires if at least one corner of each shape is 
&gt; &gt; &gt; &gt; within the other &#40;or one contains the other&#41; For instance the 
&gt; &gt; &gt; &gt; areas {0,10,0,10} and {1,11,1,9}, which are obviously 
&gt; &gt; &gt; &gt; overlapping, are not detected by the algorithm because:
&gt; &gt; &gt; &gt; between&#40;x1_min,$x2_min,$x2,max&#41; FALSE
&gt; &gt; &gt; &gt; between&#40;x1_max,$x2_min,$x2,max&#41;  TRUE
&gt; &gt; &gt; &gt; between&#40;y1_min,$y2_min,$y2,max&#41; FALSE
&gt; &gt; &gt; &gt; between&#40;y1_max,$x2_min,$x2,max&#41; FALSE Since only one of the 
&gt; &gt; &gt; &gt; tests is true the algorithm returns false because it needs at 
&gt; &gt; &gt; &gt; least two of the tests to fire.
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; A working algorithm only needs one line as follows:
&gt; &gt; &gt; &gt;   return !&#40;$x1_min &gt; $x2_max or $x1_max &lt; $x2_min or $y1_min &gt; 
&gt; &gt; &gt; &gt; $y2_max or $y1_max &lt; $y2_min&#41;;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; This has the beneficial side effect that it fires if A contains 
&gt; &gt; &gt; &gt; B AND if B contains A, as well as if they overlap Therefore the 
&gt; &gt; &gt; &gt; call to check_in_area in &#34;shapes_in_area&#34; can be optimised from 
&gt; &gt; &gt; &gt; the
&gt; &gt; &gt; &gt; current:
&gt; &gt; &gt; &gt; If &#40;$self-&gt;check_in_area&#40;@p,@area&#41; ||
&gt; &gt; &gt; &gt; $self-&gt;check_in_area&#40;@area,@p&#41;&#41; {
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; To
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; If &#40;$self-&gt;check_in_area&#40;@p,@area&#41;&#41; {
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; Hope that is clear, if not contact me for a patch.
&gt; &gt; &gt; &gt; Dan Smith
&gt; &gt; &gt; &gt; ****************************************************************
&gt; &gt; &gt; &gt; **** This email and any attachments are confidential to the 
&gt; &gt; &gt; &gt; intended recipient and may also be privileged. If you are not 
&gt; &gt; &gt; &gt; the intended recipient please delete it from your system and 
&gt; &gt; &gt; &gt; notify the sender.
&gt; &gt; &gt; &gt; You should not copy it or use it for any purpose nor disclose or 
&gt; &gt; &gt; &gt; distribute its contents to any other person.
&gt; &gt; &gt; &gt; ****************************************************************
&gt; &gt; &gt; &gt; ****
</div>&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt;
</div>&gt; &gt;
&gt; &gt;
&gt; &gt;
</div></div>


********************************************************************
This email and any attachments are confidential to the intended
recipient and may also be privileged. If you are not the intended
recipient please delete it from your system and notify the sender.
You should not copy it or use it for any purpose nor disclose or
distribute its contents to any other person.
********************************************************************
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;11&nbsp;09:43:22&nbsp;2014</span>
    <span class="description">daniel.smith [...] baesystems.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 11 Feb 2014 14:43:06 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Geo-ShapeFile [...] rt.cpan.org&#34; &lt;bug-Geo-ShapeFile [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Smith, Daniel E &#40;UK&#41;&#34; &lt;Daniel.Smith [...] baesystems.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have found what I think is the old code:

I don&#39;t think the problem was with the priority on &#34;and&#34;, I reckon &#40;I described it on cpan as well&#41; that the issue is with check_area

Basically this fires if:
a&#41; One or more of the corners of the first rectangle is in the second rectangle
b&#41; The first rectangle totally contains the second rectangle

however what creeps through its net, &#40;because the algorithm is totally flawed&#41; is the case where:

The side of the first rectangle passes through the second rectangle but none of the corners of the first rectangle are within the second rectangle

Its easy to come up with this, if you draw a big first rectangle, and a small second rectangle which overlap on one side

----------
|        -- |----------
|      |    |                |
|        -   |----------
----------
Daniel Smith 
Radar Systems Engineer, Sampson
BAE Systems Maritime Services,
Newport Road,
Cowes,
Isle of Wight, PO31 8PF, UK
I: +44 &#40;0&#41; 198320 2937 
:: daniel.smith@baesystems.com / www.baesystems.com

BAE Systems Integrated System Technologies Limited  
Registered Office: Warwick House, PO Box 87, Farnborough Aerospace Centre, Farnborough, Hants, GU14 6YU, UK.
Registered in England &#38; Wales No: 3456325 

Please consider the environment before printing this email.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Shawn Laffan via RT [mailto:bug-Geo-ShapeFile@rt.cpan.org] 
Sent: 10 February 2014 21:43
To: Smith, Daniel E &#40;UK&#41;
Subject: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect

----------------------! WARNING ! ---------------------- This message originates from outside our organisation, either from an external partner or from the internet.
Consider carefully whether you should click on any links, open any attachments or reply.
Follow the &#39;Report Suspicious Emails&#39; link on IT matters for instructions on reporting suspicious email messages.
--------------------------------------------------------

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=89563">https://rt.cpan.org/Ticket/Display.html?id=89563</a></span> &gt;

Those coords turned out to be very useful. 

The between function is &#40;was&#41; returning false positives due to the use of the lower precedence &#34;and&#34;. This means the max check is skipped when the min check passes, and the function returns true. 

I have fixed the issue, and the code is on github.  It will be in the next release &#40;planned for today&#41;.

I&#39;ve listed the optimisation as its own issue on github &#40;I forgot about that in the last few posts&#41;.  <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/shawnlaffan/Geo-ShapeFile/issues/9">https://github.com/shawnlaffan/Geo-ShapeFile/issues/9</a></span>
 
I&#39;d also still appreciate the URL for the files, as I&#39;m always on the lookout for data and they might be useful for other projects I have.

Regards,
Shawn.


On Mon Feb 10 15:39:19 2014, SLAFFAN wrote:
<div class="message-stanza open">&gt; I do have excel &#40;2010 and 2013&#41;, so please send it.
&gt; 
&gt; The coords you sent should also server for debugging.  I&#39;ll give them 
&gt; a go.
&gt; 
&gt; Regards,
&gt;  Shawn.
&gt; 
&gt; 
&gt; On Mon Feb 10 15:29:57 2014, daniel.smith@baesystems.com wrote:
<div class="message-stanza open">&gt; &gt; Hi
&gt; &gt; I will do that tomorrow, I am at work at the moment and going home 
&gt; &gt; soon Do you have excel by the way, if so I can send you an excel 
&gt; &gt; 2010 &#40;or
&gt; &gt; 2003 if you like&#41; analysis of what goes wrong
&gt; &gt;
&gt; &gt; In my original ticket, I mentioned shapes {0,10,0,10} and
&gt; &gt; {1,11,1,9},:
&gt; &gt; If you make one of those into a shape, and the other into a bounding 
&gt; &gt; box, you will see that the existing code says they do not overlap, 
&gt; &gt; but my improved code says they do overlap. If you draw them they 
&gt; &gt; obviously overlap too.
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; Daniel Smith
&gt; &gt; Radar Systems Engineer, Sampson
&gt; &gt; BAE Systems Maritime Services,
&gt; &gt; Newport Road,
&gt; &gt; Cowes,
&gt; &gt; Isle of Wight, PO31 8PF, UK
&gt; &gt; I: +44 &#40;0&#41; 198320 2937
&gt; &gt; :: daniel.smith@baesystems.com / www.baesystems.com
&gt; &gt;
&gt; &gt; BAE Systems Integrated System Technologies Limited Registered 
&gt; &gt; Office: Warwick House, PO Box 87, Farnborough Aerospace Centre, 
&gt; &gt; Farnborough, Hants, GU14 6YU, UK.
&gt; &gt; Registered in England &#38; Wales No: 3456325
&gt; &gt;
&gt; &gt; P Please consider the environment before printing this email.
&gt; &gt;
&gt; &gt;
&gt; &gt; -----Original Message-----
&gt; &gt;  From: Shawn Laffan via RT [mailto:bug-Geo-ShapeFile@rt.cpan.org]
&gt; &gt; Sent: 10 February 2014 20:13
&gt; &gt; To: Smith, Daniel E &#40;UK&#41;
&gt; &gt; Subject: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect
&gt; &gt;
&gt; &gt; ----------------------! WARNING ! ---------------------- This 
&gt; &gt; message originates from outside our organisation, either from an 
&gt; &gt; external partner or from the internet.
&gt; &gt; Consider carefully whether you should click on any links, open any 
&gt; &gt; attachments or reply.
&gt; &gt; Follow the &#39;Report Suspicious Emails&#39; link on IT matters for 
&gt; &gt; instructions on reporting suspicious email messages.
&gt; &gt; --------------------------------------------------------
&gt; &gt;
&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=89563">https://rt.cpan.org/Ticket/Display.html?id=89563</a></span> &gt;
&gt; &gt;
&gt; &gt; Thanks for the response Daniel.
&gt; &gt;
&gt; &gt; Could you send me the URL for the shapefiles?  And also send me a 
&gt; &gt; bounding box which did not work? That way I can replicate the issue 
&gt; &gt; on my machine.
&gt; &gt;
&gt; &gt; Don&#39;t worry about the pull request and test suite.  They&#39;re useful 
&gt; &gt; if you&#39;re able to edit the code and provide fixes via git &#40;see, for 
&gt; &gt; example, <span class="clickylink"><a target="new" rel="nofollow" href="https://help.github.com/articles/using-pull-requests">https://help.github.com/articles/using-pull-requests</a></span> &#41;.
&gt; &gt;
&gt; &gt; Regards,
&gt; &gt; Shawn.
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; On Mon Feb 10 07:08:06 2014, daniel.smith@baesystems.com wrote:
<div class="message-stanza open">&gt; &gt; &gt; Thanks for getting back to me Shawn!
&gt; &gt; &gt; I may need a bit of hand holding
&gt; &gt; &gt;  What I have here is a bugfixed version which I am using, I tested 
&gt; &gt; &gt; it as follows:
&gt; &gt; &gt;
&gt; &gt; &gt; I downloaded a set of shapefiles which cover the whole of the 
&gt; &gt; &gt; earth &#40;openly available fom nasa&#41; I tested the new shapefile 
&gt; &gt; &gt; routines by using them to pull out the shapes that overlap with a 
&gt; &gt; &gt; lat long box, and seeing that when I found the shapes in a box 
&gt; &gt; &gt; containing &#40;say&#41; the arabian gulf, or the uk, I could plot those 
&gt; &gt; &gt; shapes in an excel chart and the resultant map looked like the 
&gt; &gt; &gt; correct bits of the coastline.
&gt; &gt; &gt;
&gt; &gt; &gt; This was good enough for my purposes, but probably not what you 
&gt; &gt; &gt; need
&gt; &gt; &gt; because:
&gt; &gt; &gt;
&gt; &gt; &gt; a&#41; The test data set is huge.
&gt; &gt; &gt; b&#41; The pass criteria is subjective
&gt; &gt; &gt;
&gt; &gt; &gt; What we really need is a small set of simple polygons that 
&gt; &gt; &gt; definitely overlap with a box but were not detected by the old 
&gt; &gt; &gt; routines and are by the new one.
&gt; &gt; &gt;
&gt; &gt; &gt; However I also do not really know what you mean by &#34;a pull 
&gt; &gt; &gt; request&#34;, or how to integrate my tests into the &#34;test suite&#34;.
&gt; &gt; &gt;
&gt; &gt; &gt; Daniel Smith
&gt; &gt; &gt; Radar Systems Engineer, Sampson
&gt; &gt; &gt; BAE Systems Maritime Services,
&gt; &gt; &gt; Newport Road,
&gt; &gt; &gt; Cowes,
&gt; &gt; &gt; Isle of Wight, PO31 8PF, UK
&gt; &gt; &gt; I: +44 &#40;0&#41; 198320 2937
&gt; &gt; &gt; :: daniel.smith@baesystems.com / www.baesystems.com
&gt; &gt; &gt;
&gt; &gt; &gt; BAE Systems Integrated System Technologies Limited Registered
&gt; &gt; &gt; Office:
&gt; &gt; &gt; Warwick House, PO Box 87, Farnborough Aerospace Centre, 
&gt; &gt; &gt; Farnborough, Hants, GU14 6YU, UK.
&gt; &gt; &gt; Registered in England &#38; Wales No: 3456325
&gt; &gt; &gt;
&gt; &gt; &gt; P Please consider the environment before printing this email.
&gt; &gt; &gt;
&gt; &gt; &gt; -----Original Message-----
&gt; &gt; &gt;  From: Shawn Laffan via RT [mailto:bug-Geo-ShapeFile@rt.cpan.org]
&gt; &gt; &gt; Sent: 09 February 2014 08:19
&gt; &gt; &gt; To: Smith, Daniel E &#40;UK&#41;
&gt; &gt; &gt; Subject: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect
&gt; &gt; &gt;
&gt; &gt; &gt; ----------------------! WARNING ! ---------------------- This 
&gt; &gt; &gt; message originates from outside our organisation, either from an 
&gt; &gt; &gt; external partner or from the internet.
&gt; &gt; &gt; Consider carefully whether you should click on any links, open any 
&gt; &gt; &gt; attachments or reply.
&gt; &gt; &gt; Follow the &#39;Report Suspicious Emails&#39; link on IT matters for 
&gt; &gt; &gt; instructions on reporting suspicious email messages.
&gt; &gt; &gt; --------------------------------------------------------
&gt; &gt; &gt;
&gt; &gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=89563">https://rt.cpan.org/Ticket/Display.html?id=89563</a></span> &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; Hello Dan,
&gt; &gt; &gt;
&gt; &gt; &gt; Development for this module is now on github.
&gt; &gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/shawnlaffan/Geo-ShapeFile">https://github.com/shawnlaffan/Geo-ShapeFile</a></span>
&gt; &gt; &gt;
&gt; &gt; &gt; Are you able to submit a pull request with these changes, and 
&gt; &gt; &gt; ideally some tests or an update to the test suite?
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; Thanks,
&gt; &gt; &gt; Shawn.
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; On Wed Oct 16 11:49:28 2013, daniel.smith@baesystems.com wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; The Shapes in Area function misses out a LOT of overlapping 
&gt; &gt; &gt; &gt; shapes because of an erroneous check_in_area test Here it the 
&gt; &gt; &gt; &gt; essential part of check_in_area it stands:
&gt; &gt; &gt; &gt; my $lhit = self-&gt;between&#40;x1_min,$x2_min,$x2,max&#41;;
&gt; &gt; &gt; &gt; my $rhit = self-&gt;between&#40;x1_max,$x2_min,$x2,max&#41;;
&gt; &gt; &gt; &gt; my $thit = self-&gt;between&#40;y1_min,$y2_min,$y2,max&#41;;
&gt; &gt; &gt; &gt; my $bhit = self-&gt;between&#40;y1_max,$x2_min,$x2,max&#41;;
&gt; &gt; &gt; &gt; return &#40;#collision
&gt; &gt; &gt; &gt; &#40;$lhit &#38;&#38; $thit&#41; || &#40;$rhit &#38;&#38; $thit&#41; || &#40;$lhit &#38;&#38; $bhit&#41; || 
&gt; &gt; &gt; &gt; &#40;$rhit &#38;&#38;
&gt; &gt; &gt; &gt; $bhit&#41;
&gt; &gt; &gt; &gt; &#41; || &#40; #containment
&gt; &gt; &gt; &gt; &#40;$lhit &#38;&#38; $thit&#41; || &#40;$rhit &#38;&#38; $thit&#41; || &#40;$lhit &#38;&#38; $bhit&#41; || 
&gt; &gt; &gt; &gt; &#40;$rhit &#38;&#38;
&gt; &gt; &gt; &gt; $bhit&#41;
&gt; &gt; &gt; &gt; &#41;;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; This is  does not return true if the two areas overlap on one 
&gt; &gt; &gt; &gt; side only, it only fires if at least one corner of each shape is 
&gt; &gt; &gt; &gt; within the other &#40;or one contains the other&#41; For instance the 
&gt; &gt; &gt; &gt; areas {0,10,0,10} and {1,11,1,9}, which are obviously 
&gt; &gt; &gt; &gt; overlapping, are not detected by the algorithm because:
&gt; &gt; &gt; &gt; between&#40;x1_min,$x2_min,$x2,max&#41; FALSE
&gt; &gt; &gt; &gt; between&#40;x1_max,$x2_min,$x2,max&#41;  TRUE
&gt; &gt; &gt; &gt; between&#40;y1_min,$y2_min,$y2,max&#41; FALSE
&gt; &gt; &gt; &gt; between&#40;y1_max,$x2_min,$x2,max&#41; FALSE Since only one of the 
&gt; &gt; &gt; &gt; tests is true the algorithm returns false because it needs at 
&gt; &gt; &gt; &gt; least two of the tests to fire.
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; A working algorithm only needs one line as follows:
&gt; &gt; &gt; &gt;   return !&#40;$x1_min &gt; $x2_max or $x1_max &lt; $x2_min or $y1_min &gt; 
&gt; &gt; &gt; &gt; $y2_max or $y1_max &lt; $y2_min&#41;;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; This has the beneficial side effect that it fires if A contains 
&gt; &gt; &gt; &gt; B AND if B contains A, as well as if they overlap Therefore the 
&gt; &gt; &gt; &gt; call to check_in_area in &#34;shapes_in_area&#34; can be optimised from 
&gt; &gt; &gt; &gt; the
&gt; &gt; &gt; &gt; current:
&gt; &gt; &gt; &gt; If &#40;$self-&gt;check_in_area&#40;@p,@area&#41; ||
&gt; &gt; &gt; &gt; $self-&gt;check_in_area&#40;@area,@p&#41;&#41; {
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; To
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; If &#40;$self-&gt;check_in_area&#40;@p,@area&#41;&#41; {
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; Hope that is clear, if not contact me for a patch.
&gt; &gt; &gt; &gt; Dan Smith
&gt; &gt; &gt; &gt; ****************************************************************
&gt; &gt; &gt; &gt; **** This email and any attachments are confidential to the 
&gt; &gt; &gt; &gt; intended recipient and may also be privileged. If you are not 
&gt; &gt; &gt; &gt; the intended recipient please delete it from your system and 
&gt; &gt; &gt; &gt; notify the sender.
&gt; &gt; &gt; &gt; You should not copy it or use it for any purpose nor disclose or 
&gt; &gt; &gt; &gt; distribute its contents to any other person.
&gt; &gt; &gt; &gt; ****************************************************************
&gt; &gt; &gt; &gt; ****
</div>&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt;
</div>&gt; &gt;
&gt; &gt;
&gt; &gt;
</div></div>


********************************************************************
This email and any attachments are confidential to the intended
recipient and may also be privileged. If you are not the intended
recipient please delete it from your system and notify the sender.
You should not copy it or use it for any purpose nor disclose or
distribute its contents to any other person.
********************************************************************
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;11&nbsp;16:09:41&nbsp;2014</span>
    <span class="description">SLAFFAN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;12&nbsp;08:20:28&nbsp;2014</span>
    <span class="description">daniel.smith [...] baesystems.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 12 Feb 2014 13:20:06 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Geo-ShapeFile [...] rt.cpan.org&#34; &lt;bug-Geo-ShapeFile [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Smith, Daniel E &#40;UK&#41;&#34; &lt;Daniel.Smith [...] baesystems.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;12&nbsp;15:20:09&nbsp;2014</span>
    <span class="description">SLAFFAN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Good to hear it works. 

I&#39;ll mark this ticket as resolved.  

If you identify any more improvements then please open a new ticket via the github issue tracker.  <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/shawnlaffan/Geo-ShapeFile/issues/">https://github.com/shawnlaffan/Geo-ShapeFile/issues/</a></span>

If you want to keep on top of the changes then you can register to &#34;watch&#34; the changes in the github repo.  There is an option on the main page.  <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/shawnlaffan/Geo-ShapeFile">https://github.com/shawnlaffan/Geo-ShapeFile</a></span>


Regards,
Shawn.

On Wed Feb 12 08:20:28 2014, daniel.smith@baesystems.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Brilliant Shawn!
&gt; Your shapefile 2.54 does indeed work fine for me - as you can see from
&gt; the spreadsheet I sent
&gt; If you do some other efficiency related improvements I can easily
&gt; compare the time taken to generate a land map by two different
&gt; versions of the code
&gt; 
&gt; If you do want me to do that let me know, in either case - thanks for
&gt; your emails and I am very glad my input was useful
&gt; Cheers!
&gt; 
&gt; Daniel Smith
&gt; Radar Systems Engineer, Sampson
&gt; BAE Systems Maritime Services,
&gt; Newport Road,
&gt; Cowes,
&gt; Isle of Wight, PO31 8PF, UK
&gt; I: +44 &#40;0&#41; 198320 2937
&gt; :: daniel.smith@baesystems.com / www.baesystems.com
&gt; 
&gt; BAE Systems Integrated System Technologies Limited
&gt; Registered Office: Warwick House, PO Box 87, Farnborough Aerospace
&gt; Centre, Farnborough, Hants, GU14 6YU, UK.
&gt; Registered in England &#38; Wales No: 3456325
&gt; 
&gt; Please consider the environment before printing this email.
&gt; 
&gt; 
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;12&nbsp;15:20:10&nbsp;2014</span>
    <span class="description">SLAFFAN [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;12&nbsp;15:20:11&nbsp;2014</span>
    <span class="description">SLAFFAN [...] cpan.org -  Fixed in 2.54 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;13&nbsp;05:54:40&nbsp;2014</span>
    <span class="description">daniel.smith [...] baesystems.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 13 Feb 2014 10:54:27 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Geo-ShapeFile [...] rt.cpan.org&#34; &lt;bug-Geo-ShapeFile [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Smith, Daniel E &#40;UK&#41;&#34; &lt;Daniel.Smith [...] baesystems.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I don&#39;t have any more bugs!

I was thinking in an idle moment of how to write &#34;point is really in shape&#34; and a  &#34;shapes really do overlap&#34; procedures &#40;probably better names could be found&#41;, but they are additional algorithms rather than bugs, and are quite complex

The issue for point is in shape is that a point can be in the bounding box of a shape but not be inside the shape. The usual way to make this work is to draw a straight line from the point and see how many sides of the shape that line interects, if it intersects an odd number of sides &#40;and the shape is closed&#41; then the point is in the shape.

The issue for overlapping shapes is similar: The bounding boxes of two shapes MUST overlap if the shapes overlap, however sometimes the bounding boxes overlap if the shapes do not overlap. The fix here &#40;once the point really in shape procedure is working&#41; is to say that if two shapes overlap &#40;and they are closed polygons with straight sides&#41; then at least one of the points of one of the shapes must be inside the other shape.
 
What do you think? I don&#39;t know if you want to do any more work on it....


Daniel Smith 
Radar Systems Engineer, Sampson
BAE Systems Maritime Services,
Newport Road,
Cowes,
Isle of Wight, PO31 8PF, UK
I: +44 &#40;0&#41; 198320 2937 
:: daniel.smith@baesystems.com / www.baesystems.com

BAE Systems Integrated System Technologies Limited  
Registered Office: Warwick House, PO Box 87, Farnborough Aerospace Centre, Farnborough, Hants, GU14 6YU, UK.
Registered in England &#38; Wales No: 3456325 

Please consider the environment before printing this email.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Shawn Laffan via RT [mailto:bug-Geo-ShapeFile@rt.cpan.org] 
Sent: 12 February 2014 20:20
To: Smith, Daniel E &#40;UK&#41;
Subject: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect

----------------------! WARNING ! ---------------------- This message originates from outside our organisation, either from an external partner or from the internet.
Consider carefully whether you should click on any links, open any attachments or reply.
Follow the &#39;Report Suspicious Emails&#39; link on IT matters for instructions on reporting suspicious email messages.
--------------------------------------------------------

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=89563">https://rt.cpan.org/Ticket/Display.html?id=89563</a></span> &gt;

Good to hear it works. 

I&#39;ll mark this ticket as resolved.  

If you identify any more improvements then please open a new ticket via the github issue tracker.  <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/shawnlaffan/Geo-ShapeFile/issues/">https://github.com/shawnlaffan/Geo-ShapeFile/issues/</a></span>

If you want to keep on top of the changes then you can register to &#34;watch&#34; the changes in the github repo.  There is an option on the main page.  <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/shawnlaffan/Geo-ShapeFile">https://github.com/shawnlaffan/Geo-ShapeFile</a></span>


Regards,
Shawn.

On Wed Feb 12 08:20:28 2014, daniel.smith@baesystems.com wrote:
<div class="message-stanza open">&gt; Brilliant Shawn!
&gt; Your shapefile 2.54 does indeed work fine for me - as you can see from 
&gt; the spreadsheet I sent If you do some other efficiency related 
&gt; improvements I can easily compare the time taken to generate a land 
&gt; map by two different versions of the code
&gt; 
&gt; If you do want me to do that let me know, in either case - thanks for 
&gt; your emails and I am very glad my input was useful Cheers!
&gt; 
&gt; Daniel Smith
&gt; Radar Systems Engineer, Sampson
&gt; BAE Systems Maritime Services,
&gt; Newport Road,
&gt; Cowes,
&gt; Isle of Wight, PO31 8PF, UK
&gt; I: +44 &#40;0&#41; 198320 2937
&gt; :: daniel.smith@baesystems.com / www.baesystems.com
&gt; 
&gt; BAE Systems Integrated System Technologies Limited Registered Office: 
&gt; Warwick House, PO Box 87, Farnborough Aerospace Centre, Farnborough, 
&gt; Hants, GU14 6YU, UK.
&gt; Registered in England &#38; Wales No: 3456325
&gt; 
&gt; P Please consider the environment before printing this email.
&gt; 
&gt; 
&gt;
</div>********************************************************************
This email and any attachments are confidential to the intended
recipient and may also be privileged. If you are not the intended
recipient please delete it from your system and notify the sender.
You should not copy it or use it for any purpose nor disclose or
distribute its contents to any other person.
********************************************************************
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;13&nbsp;06:08:18&nbsp;2014</span>
    <span class="description">shawnlaffan [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 13 Feb 2014 22:08:07 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Geo-ShapeFile [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Shawn Laffan &lt;shawnlaffan [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Feel free to list them as new issues on the issue tracker.

There is already a function called contains_point in Geo::ShapeFile::Shape
which uses the winding number algorithm.  The shapes_in_area method should
be renamed to something like shapes_in_box or similar.

The shape overlap approach could iterate over the points in one shape
relative to the points in the other shape, but this needs to account for
non-intersection of vertices.


Regards,
Shawn.



On 13 February 2014 21:54, Smith, Daniel E via RT &lt;
bug-Geo-ShapeFile@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Geo-ShapeFile
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=89563">https://rt.cpan.org/Ticket/Display.html?id=89563</a></span> &gt;
&gt;
&gt; I don&#39;t have any more bugs!
&gt;
&gt; I was thinking in an idle moment of how to write &#34;point is really in
&gt; shape&#34; and a  &#34;shapes really do overlap&#34; procedures &#40;probably better names
&gt; could be found&#41;, but they are additional algorithms rather than bugs, and
&gt; are quite complex
&gt;
&gt; The issue for point is in shape is that a point can be in the bounding box
&gt; of a shape but not be inside the shape. The usual way to make this work is
&gt; to draw a straight line from the point and see how many sides of the shape
&gt; that line interects, if it intersects an odd number of sides &#40;and the shape
&gt; is closed&#41; then the point is in the shape.
&gt;
&gt; The issue for overlapping shapes is similar: The bounding boxes of two
&gt; shapes MUST overlap if the shapes overlap, however sometimes the bounding
&gt; boxes overlap if the shapes do not overlap. The fix here &#40;once the point
&gt; really in shape procedure is working&#41; is to say that if two shapes overlap
&gt; &#40;and they are closed polygons with straight sides&#41; then at least one of the
&gt; points of one of the shapes must be inside the other shape.
&gt;
&gt; What do you think? I don&#39;t know if you want to do any more work on it....
&gt;
&gt;
&gt; Daniel Smith
&gt; Radar Systems Engineer, Sampson
&gt; BAE Systems Maritime Services,
&gt; Newport Road,
&gt; Cowes,
&gt; Isle of Wight, PO31 8PF, UK
&gt; I: +44 &#40;0&#41; 198320 2937
&gt; :: daniel.smith@baesystems.com / www.baesystems.com
&gt;
&gt; BAE Systems Integrated System Technologies Limited
&gt; Registered Office: Warwick House, PO Box 87, Farnborough Aerospace Centre,
&gt; Farnborough, Hants, GU14 6YU, UK.
&gt; Registered in England &#38; Wales No: 3456325
&gt;
&gt; Please consider the environment before printing this email.
&gt;
&gt;
&gt; -----Original Message-----
&gt; From: Shawn Laffan via RT [mailto:bug-Geo-ShapeFile@rt.cpan.org]
&gt; Sent: 12 February 2014 20:20
&gt; To: Smith, Daniel E &#40;UK&#41;
&gt; Subject: [rt.cpan.org #89563] Shapes_In_Area Function is incorrect
&gt;
&gt; ----------------------! WARNING ! ---------------------- This message
&gt; originates from outside our organisation, either from an external partner
&gt; or from the internet.
&gt; Consider carefully whether you should click on any links, open any
&gt; attachments or reply.
&gt; Follow the &#39;Report Suspicious Emails&#39; link on IT matters for instructions
&gt; on reporting suspicious email messages.
&gt; --------------------------------------------------------
&gt;
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=89563">https://rt.cpan.org/Ticket/Display.html?id=89563</a></span> &gt;
&gt;
&gt; Good to hear it works.
&gt;
&gt; I&#39;ll mark this ticket as resolved.
&gt;
&gt; If you identify any more improvements then please open a new ticket via
&gt; the github issue tracker.
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/shawnlaffan/Geo-ShapeFile/issues/">https://github.com/shawnlaffan/Geo-ShapeFile/issues/</a></span>
&gt;
&gt; If you want to keep on top of the changes then you can register to &#34;watch&#34;
&gt; the changes in the github repo.  There is an option on the main page.
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/shawnlaffan/Geo-ShapeFile">https://github.com/shawnlaffan/Geo-ShapeFile</a></span>
&gt;
&gt;
&gt; Regards,
&gt; Shawn.
&gt;
&gt; On Wed Feb 12 08:20:28 2014, daniel.smith@baesystems.com wrote:
<div class="message-stanza open">&gt; &gt; Brilliant Shawn!
&gt; &gt; Your shapefile 2.54 does indeed work fine for me - as you can see from
&gt; &gt; the spreadsheet I sent If you do some other efficiency related
&gt; &gt; improvements I can easily compare the time taken to generate a land
&gt; &gt; map by two different versions of the code
&gt; &gt;
&gt; &gt; If you do want me to do that let me know, in either case - thanks for
&gt; &gt; your emails and I am very glad my input was useful Cheers!
&gt; &gt;
&gt; &gt; Daniel Smith
&gt; &gt; Radar Systems Engineer, Sampson
&gt; &gt; BAE Systems Maritime Services,
&gt; &gt; Newport Road,
&gt; &gt; Cowes,
&gt; &gt; Isle of Wight, PO31 8PF, UK
&gt; &gt; I: +44 &#40;0&#41; 198320 2937
&gt; &gt; :: daniel.smith@baesystems.com / www.baesystems.com
&gt; &gt;
&gt; &gt; BAE Systems Integrated System Technologies Limited Registered Office:
&gt; &gt; Warwick House, PO Box 87, Farnborough Aerospace Centre, Farnborough,
&gt; &gt; Hants, GU14 6YU, UK.
&gt; &gt; Registered in England &#38; Wales No: 3456325
&gt; &gt;
&gt; &gt; P Please consider the environment before printing this email.
&gt; &gt;
&gt; &gt;
&gt; &gt;
</div>&gt; ********************************************************************
&gt; This email and any attachments are confidential to the intended
&gt; recipient and may also be privileged. If you are not the intended
&gt; recipient please delete it from your system and notify the sender.
&gt; You should not copy it or use it for any purpose nor disclose or
&gt; distribute its contents to any other person.
&gt; ********************************************************************
&gt;
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
