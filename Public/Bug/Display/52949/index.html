<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #52949 for Spreadsheet-ParseExcel: ParseExcel missing some formatting info</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #52949 for Spreadsheet-ParseExcel: ParseExcel missing some formatting info</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Spreadsheet-ParseExcel/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Spreadsheet-ParseExcel/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Spreadsheet-ParseExcel/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Spreadsheet-ParseExcel/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="http://github.com/runrig/spreadsheet-parseexcel/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Spreadsheet-ParseExcel">Spreadsheet-ParseExcel CPAN distribution</a>.</p>


<h3>Maintainer&#40;s&#41;&#39; notes</h3>

<p><b>If you are reporting a bug in Spreadsheet::ParseExcel here are some pointers</b>
<p>
1) State the issues as clearly and as concisely as possible. A simple program or Excel test file (see below) will often explain the issue better than a lot of text.
<p>
2) Provide information on your system, version of perl and module versions. The following program will generate everything that is required. Put this information in your bug report.
<pre>
    #!/usr/bin/perl -w

    print "\n    Perl version   : $]";
    print "\n    OS name        : $^O";
    print "\n    Module versions: (not all are required)\n";

    my @modules = qw(
                      Spreadsheet::ParseExcel
                      Scalar::Util
                      Unicode::Map
                      Spreadsheet::WriteExcel
                      Parse::RecDescent
                      File::Temp
                      OLE::Storage_Lite
                      IO::Stringy
                    );

    for my $module (@modules) {
        my $version;
        eval "require $module";

        if (not $@) {
            $version = $module-&gt;VERSION;
            $version = '(unknown)' if not defined $version;
        }
        else {
            $version = '(not installed)';
        }

        printf "%21s%-24s\t%s\n", "", $module, $version;
    }

    __END__
</pre>
<p>
3) Upgrade to the latest version of Spreadsheet::ParseExcel (or at least test on a system with an upgraded version). The issue you are reporting may already have been fixed.
<p>
4) Create a small example program that demonstrates your problem. The program should be as small as possible. A few lines of codes are worth tens of lines of text when trying to describe a bug.
<p>
5) <b>Supply an Excel file that demonstrates the problem</b>. This is very important. If the file is big, or contains confidential information, try to reduce it down to the smallest Excel file that represents the issue. If you don't wish to post a file here then send it to me directly: jmcnamara@cpan.org
<p>
6) Say if the test file was created by Excel, OpenOffice, Gnumeric or something else. Say which version of that application you used.
<p>
7) If you are submitting a patch you should check with the maintainer whether the issue has already been patched or if a fix is in the works. Patches should be accompanied by test cases.
<p>
<b>Asking a question</b>
<p>
If you would like to ask a more general question there is the <a href="http://groups.google.com/group/spreadsheet-parseexcel">Spreadsheet::ParseExcel Google Group</a>.
<p></p>



<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">52949</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Spreadsheet-ParseExcel/Active/">Spreadsheet-ParseExcel</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
josh.ritter [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-29454-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-29455-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




4.0.xls<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/709350/365992/4.0.xls">
Mon Dec 21 15:14:32 2009 (11.5k) by josh.ritter [...] gmail.com
</a>
</font></li>
</ul>


parse01.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/709619/366136/parse01.pl">
Tue Dec 22 08:03:55 2009 (887b) by jmcnamara [...] cpan.org
</a>
</font></li>
</ul>


test.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/709350/365995/test.pl">
Mon Dec 21 15:14:32 2009 (214b) by josh.ritter [...] gmail.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;21&nbsp;15:14:32&nbsp;2009</span>
    <span class="description">josh.ritter [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> ParseExcel missing some formatting info</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Running the latest version of ParseExcel.

The attached file has some columns formated to &#39;0.00&#39;, and while warns
in _NewCell confirm that the FmtIdx for those cells is 2, the
$oBook-&gt;{FormatStr} does not contain that entry so the cell is created
empty.

I added a warn on line 542 of ParseExcel that looks like: 
warn $oBook-&gt;{Format}[$iF]-&gt;{FmtIdx};

To confirm that my number fields do have the correct formatting.  And
then ran the test.pl file attached.  So it seems like whatever setup is
filling the FormatStr is not catching that format.  

Taking the hash that exists in ParseExcel::FmtDefault called
%hFmtDefault and dumping that into FormatStr did make things work, but
that is obviously a poor solution.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 4.0.xls</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/709350/365992/4.0.xls">Download 4.0.xls</a><br />
<span class="downloadcontenttype">application/vnd.ms-excel 11.5k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> test.pl</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">use strict;
use warnings;

use Spreadsheet::ParseExcel;

my $parser = Spreadsheet::ParseExcel-&gt;new&#40;&#41;;

my $book = $parser-&gt;parse&#40;&#39;/home/jdr99/Dropbox/4.0.xls&#39;&#41;;
use Data::Dumper;
warn Dumper $book-&gt;{FormatStr};
1;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;21&nbsp;16:06:26&nbsp;2009</span>
    <span class="description">jmcnamara [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Dec 21 15:14:32 2009, josh.ritter wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Running the latest version of ParseExcel.
&gt; 
&gt; The attached file has some columns formated to &#39;0.00&#39;, and while warns
&gt; in _NewCell confirm that the FmtIdx for those cells is 2, the
&gt; $oBook-&gt;{FormatStr} does not contain that entry so the cell is created
&gt; empty.
</div>
Hi Josh,

Thanks for that. I&#39;ll look into to it and let you know.

John.
-- 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;21&nbsp;16:06:27&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;22&nbsp;08:02:16&nbsp;2009</span>
    <span class="description">jmcnamara [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Dec 21 15:14:32 2009, josh.ritter wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Running the latest version of ParseExcel.
&gt; 
&gt; The attached file has some columns formated to &#39;0.00&#39;, and while warns
&gt; in _NewCell confirm that the FmtIdx for those cells is 2, the
&gt; $oBook-&gt;{FormatStr} does not contain that entry so the cell is created
&gt; empty.
</div>
Hi,

Are you referring to the data in column L of the sheet &#34;Scores&#34;? I can
see that it is formatted to &#39;0.00&#39; so I am guessing that it is the
column in question.

When I run the following program &#40;with the latest version of ParseExcel&#41;:

#!/usr/bin/perl -w

use strict;
use Spreadsheet::ParseExcel;

my $parser   = Spreadsheet::ParseExcel-&gt;new&#40;&#41;;
my $workbook = $parser-&gt;parse&#40;&#39;4.0.xls&#39;&#41;;

if &#40; !defined $workbook &#41; {
    die $parser-&gt;error&#40;&#41;, &#34;.\n&#34;;
}

for my $worksheet &#40; $workbook-&gt;worksheets&#40;&#41; &#41; {

    print &#34;Worksheet name: &#34;, $worksheet-&gt;get_name&#40;&#41;, &#34;\n\n&#34;;

    my &#40; $row_min, $row_max &#41; = $worksheet-&gt;row_range&#40;&#41;;
    my &#40; $col_min, $col_max &#41; = $worksheet-&gt;col_range&#40;&#41;;

    for my $row &#40; $row_min .. $row_max &#41; {
        for my $col &#40; $col_min .. $col_max &#41; {

            my $cell = $worksheet-&gt;get_cell&#40; $row, $col &#41;;
            next unless $cell;

            print &#34;    Row, Col    = &#40;$row, $col&#41;\n&#34;;
            print &#34;    Value       = &#34;, $cell-&gt;value&#40;&#41;,       &#34;\n&#34;;
            print &#34;    Unformatted = &#34;, $cell-&gt;unformatted&#40;&#41;, &#34;\n&#34;;
            print &#34;\n&#34;;
        }
    }
}
__END__


I get the following &#40;shortened&#41; output for column L:

...
    Row, Col    = &#40;2, 11&#41;
    Value       = Quizzes3
    Unformatted = Quizzes3

...
    Row, Col    = &#40;5, 11&#41;
    Value       = 98.12
    Unformatted = 98.1234
...

    Row, Col    = &#40;6, 11&#41;
    Value       = 98.24
    Unformatted = 98.2445

So I&#39;m not seeing the issue. If that isn&#39;t what you meant let me know.

John.
-- 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;22&nbsp;08:03:55&nbsp;2009</span>
    <span class="description">jmcnamara [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
I&#39;ve attached the program because the formatting was lost above.

John.
-- 
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl -w

use strict;
use Spreadsheet::ParseExcel;

my $parser   = Spreadsheet::ParseExcel-&gt;new&#40;&#41;;
my $workbook = $parser-&gt;parse&#40;&#39;4.0.xls&#39;&#41;;

if &#40; !defined $workbook &#41; {
    die $parser-&gt;error&#40;&#41;, &#34;.\n&#34;;
}

for my $worksheet &#40; $workbook-&gt;worksheets&#40;&#41; &#41; {

    print &#34;Worksheet name: &#34;, $worksheet-&gt;get_name&#40;&#41;, &#34;\n\n&#34;;

    my &#40; $row_min, $row_max &#41; = $worksheet-&gt;row_range&#40;&#41;;
    my &#40; $col_min, $col_max &#41; = $worksheet-&gt;col_range&#40;&#41;;

    for my $row &#40; $row_min .. $row_max &#41; {
        for my $col &#40; $col_min .. $col_max &#41; {

            my $cell = $worksheet-&gt;get_cell&#40; $row, $col &#41;;
            next unless $cell;

            print &#34;    Row, Col    = &#40;$row, $col&#41;\n&#34;;
            print &#34;    Value       = &#34;, $cell-&gt;value&#40;&#41;,       &#34;\n&#34;;
            print &#34;    Unformatted = &#34;, $cell-&gt;unformatted&#40;&#41;, &#34;\n&#34;;
            print &#34;\n&#34;;
        }
    }
}</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;22&nbsp;17:40:53&nbsp;2009</span>
    <span class="description">josh.ritter [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52949] ParseExcel missing some formatting info</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 22 Dec 2009 14:40:34 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Spreadsheet-ParseExcel [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Josh Ritter &lt;josh.ritter [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">That is the data I am refering too.  I agree that your script does the
right thing.  The more I look at this, the more I am unsure where the
bug actually lies.  I am using Spreadsheet::Read &#40;which uses
Spreadsheet::ParseExcel&#41;

The problem is occurring because the workbook returned does not
contain all the numeric formats used in the file.  Looks like there is
a hash called &#39;FormatStr&#39; that maps a code to a format.
Spreadsheet::Read is trying to fetch that format after the file has
been parsed by accessing the FmtIdx in the
Spreadsheet::ParseExcel::Format.  Looking at the cells you pasted from
your script, the FmtIdx is 2, but when I try to fetch that format
string from the workbook it returns undef, instead of &#39;0.00&#39;.

Spreadsheet::Read may trying to fetch that improperly, but it looks
like the workbook returned from parse does not contain the definition
for that numeric format &#40;although each cell does contain the correct
values and correct formatidx within the format object&#41;.

If you feel like it is not a ParseExcel problem, I will be happy to
open a bug with Spreadsheet::Read. :&#41;




On Tue, Dec 22, 2009 at 5:02 AM, John McNamara via RT
&lt;bug-Spreadsheet-ParseExcel@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=52949">https://rt.cpan.org/Ticket/Display.html?id=52949</a></span> &gt;
&gt;
&gt; On Mon Dec 21 15:14:32 2009, josh.ritter wrote:
<div class="message-stanza open">&gt;&gt; Running the latest version of ParseExcel.
&gt;&gt;
&gt;&gt; The attached file has some columns formated to &#39;0.00&#39;, and while warns
&gt;&gt; in _NewCell confirm that the FmtIdx for those cells is 2, the
&gt;&gt; $oBook-&gt;{FormatStr} does not contain that entry so the cell is created
&gt;&gt; empty.
</div>&gt;
&gt; Hi,
&gt;
&gt; Are you referring to the data in column L of the sheet &#34;Scores&#34;? I can
&gt; see that it is formatted to &#39;0.00&#39; so I am guessing that it is the
&gt; column in question.
&gt;
&gt; When I run the following program &#40;with the latest version of ParseExcel&#41;:
&gt;
&gt; #!/usr/bin/perl -w
&gt;
&gt; use strict;
&gt; use Spreadsheet::ParseExcel;
&gt;
&gt; my $parser   = Spreadsheet::ParseExcel-&gt;new&#40;&#41;;
&gt; my $workbook = $parser-&gt;parse&#40;&#39;4.0.xls&#39;&#41;;
&gt;
&gt; if &#40; !defined $workbook &#41; {
&gt;    die $parser-&gt;error&#40;&#41;, &#34;.\n&#34;;
&gt; }
&gt;
&gt; for my $worksheet &#40; $workbook-&gt;worksheets&#40;&#41; &#41; {
&gt;
&gt;    print &#34;Worksheet name: &#34;, $worksheet-&gt;get_name&#40;&#41;, &#34;\n\n&#34;;
&gt;
&gt;    my &#40; $row_min, $row_max &#41; = $worksheet-&gt;row_range&#40;&#41;;
&gt;    my &#40; $col_min, $col_max &#41; = $worksheet-&gt;col_range&#40;&#41;;
&gt;
&gt;    for my $row &#40; $row_min .. $row_max &#41; {
&gt;        for my $col &#40; $col_min .. $col_max &#41; {
&gt;
&gt;            my $cell = $worksheet-&gt;get_cell&#40; $row, $col &#41;;
&gt;            next unless $cell;
&gt;
&gt;            print &#34;    Row, Col    = &#40;$row, $col&#41;\n&#34;;
&gt;            print &#34;    Value       = &#34;, $cell-&gt;value&#40;&#41;,       &#34;\n&#34;;
&gt;            print &#34;    Unformatted = &#34;, $cell-&gt;unformatted&#40;&#41;, &#34;\n&#34;;
&gt;            print &#34;\n&#34;;
&gt;        }
&gt;    }
&gt; }
&gt; __END__
&gt;
&gt;
&gt; I get the following &#40;shortened&#41; output for column L:
&gt;
&gt; ...
&gt;    Row, Col    = &#40;2, 11&#41;
&gt;    Value       = Quizzes3
&gt;    Unformatted = Quizzes3
&gt;
&gt; ...
&gt;    Row, Col    = &#40;5, 11&#41;
&gt;    Value       = 98.12
&gt;    Unformatted = 98.1234
&gt; ...
&gt;
&gt;    Row, Col    = &#40;6, 11&#41;
&gt;    Value       = 98.24
&gt;    Unformatted = 98.2445
&gt;
&gt; So I&#39;m not seeing the issue. If that isn&#39;t what you meant let me know.
&gt;
&gt; John.
&gt; --
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;23&nbsp;14:48:01&nbsp;2009</span>
    <span class="description">jmcnamara [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Dec 22 17:40:53 2009, josh.ritter wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; That is the data I am refering too.  I agree that your script does the
&gt; right thing.  The more I look at this, the more I am unsure where the
&gt; bug actually lies.  I am using Spreadsheet::Read &#40;which uses
&gt; Spreadsheet::ParseExcel&#41;
</div>
Hi Josh,

I don&#39;t think that this is a Spreadsheet::Read issue either. If I run the xlscat program that 
comes with Spreadsheet::Read I see the required 0.00 output:

$ xlscat 4.0.xls 
4.0|||||||||||||
Exported 12/16/2009  1:31 PM|||||||Category|Homework|Quizzes||||
Username|Last Name|First Name M.|Student 
Number|Section/Group|Status|Notes|Assignment|Homework 1|Quizzes 1|Quizzes 
2|Quizzes3|Total Score|Class Grade
|||||||Grading scale|Custom|Points|4.0 scale|Percentage|Percentage|Text
|||||||Points possible||12345||||
fournier|FOURNIER|JANICE||group!|Active||||||98.12||
jlaney|LANEY|JAMES W||dog with socks|Active|||B|||98.24||
drickngo|NGO|DERRICK T||derrick|Active|||C|||98.11||
charlon|PALACAY|CHARLON||dog with socks, char|Active|||A|||20.00||
jiranida|PHUWANARTNURAK|JIRANIDA||ammy|Active|||C|||||
dcwalker|WALKER|DANIEL CURTIS||dog with socks|Active|||C|||||
scumby|WASHINGTON|WILLIAM A||group!, dog with socks|Active|||B|||||
|||||||||||||
|||||||Mean||#DIV/0!|#DIV/0!||#DIV/0!|
|||||||Median||#NUM!|#NUM!||#NUM!|
|||||||Mode||#N/A!|#N/A!||#N/A!|
|||||||Min||0.00|0.00||0.00|
|||||||Max||0.00|0.00||0.00|
|||||||Std. Dev.||#DIV/0!|#DIV/0!||#DIV/0!|
    14 x     19

Can you provide a test program that demonstrates the issue?

John.
-- 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;04&nbsp;13:20:30&nbsp;2010</span>
    <span class="description">josh.ritter [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52949] ParseExcel missing some formatting info</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 4 Jan 2010 10:20:13 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Spreadsheet-ParseExcel [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Josh Ritter &lt;josh.ritter [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">It looks like spreadsheet::read does contain both the unformatted and
formatted versions of the number.  Although it seems arbitrary to me.
Each sheet hash has a cell hash, which does not always contain the
formatted cell values &#40;although it sometime seems, depending on what
version of excel the file was saved on&#41;.  The traditional excel labels
&#40;ie a13&#41; do contain the formatted version of each cell.

I will just use the traditional labels to extract the data I need.

Thanks for your help


Josh



On Wed, Dec 23, 2009 at 11:48 AM, John McNamara via RT
&lt;bug-Spreadsheet-ParseExcel@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=52949">https://rt.cpan.org/Ticket/Display.html?id=52949</a></span> &gt;
&gt;
&gt; On Tue Dec 22 17:40:53 2009, josh.ritter wrote:
<div class="message-stanza open">&gt;&gt; That is the data I am refering too.  I agree that your script does the
&gt;&gt; right thing.  The more I look at this, the more I am unsure where the
&gt;&gt; bug actually lies.  I am using Spreadsheet::Read &#40;which uses
&gt;&gt; Spreadsheet::ParseExcel&#41;
</div>&gt;
&gt; Hi Josh,
&gt;
&gt; I don&#39;t think that this is a Spreadsheet::Read issue either. If I run the xlscat program that
&gt; comes with Spreadsheet::Read I see the required 0.00 output:
&gt;
&gt; $ xlscat 4.0.xls
&gt; 4.0|||||||||||||
&gt; Exported 12/16/2009  1:31 PM|||||||Category|Homework|Quizzes||||
&gt; Username|Last Name|First Name M.|Student
&gt; Number|Section/Group|Status|Notes|Assignment|Homework 1|Quizzes 1|Quizzes
&gt; 2|Quizzes3|Total Score|Class Grade
&gt; |||||||Grading scale|Custom|Points|4.0 scale|Percentage|Percentage|Text
&gt; |||||||Points possible||12345||||
&gt; fournier|FOURNIER|JANICE||group!|Active||||||98.12||
&gt; jlaney|LANEY|JAMES W||dog with socks|Active|||B|||98.24||
&gt; drickngo|NGO|DERRICK T||derrick|Active|||C|||98.11||
&gt; charlon|PALACAY|CHARLON||dog with socks, char|Active|||A|||20.00||
&gt; jiranida|PHUWANARTNURAK|JIRANIDA||ammy|Active|||C|||||
&gt; dcwalker|WALKER|DANIEL CURTIS||dog with socks|Active|||C|||||
&gt; scumby|WASHINGTON|WILLIAM A||group!, dog with socks|Active|||B|||||
&gt; |||||||||||||
&gt; |||||||Mean||#DIV/0!|#DIV/0!||#DIV/0!|
&gt; |||||||Median||#NUM!|#NUM!||#NUM!|
&gt; |||||||Mode||#N/A!|#N/A!||#N/A!|
&gt; |||||||Min||0.00|0.00||0.00|
&gt; |||||||Max||0.00|0.00||0.00|
&gt; |||||||Std. Dev.||#DIV/0!|#DIV/0!||#DIV/0!|
&gt;    14 x     19
&gt;
&gt; Can you provide a test program that demonstrates the issue?
&gt;
&gt; John.
&gt; --
&gt;
&gt;
&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;04&nbsp;18:09:44&nbsp;2010</span>
    <span class="description">jmcnamara [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza">&nbsp;Hi Josh,<br>

<br>

In that case I will mark it as resolved.<br>

<br>

If you have any other issues let me know.<br>

<br>

John.<br>

--&nbsp;<br>

<br>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;04&nbsp;18:09:45&nbsp;2010</span>
    <span class="description">jmcnamara [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
