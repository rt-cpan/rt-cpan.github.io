<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #38742 for Apache-DBI: Apache::DBI rolling back transactions globally</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #38742 for Apache-DBI: Apache::DBI rolling back transactions globally</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Apache-DBI">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Apache-DBI">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Apache-DBI">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Apache-DBI">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Apache-DBI">Apache-DBI CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">38742</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Apache-DBI">Apache-DBI</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
earl [...] switchmanagement.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-1546-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-1547-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




apache_dbi_test<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/501477/248712/apache_dbi_test">
Tue Aug 26 19:29:18 2008 (2k) by earl [...] switchmanagement.com
</a>
</font></li>
</ul>


apache_test.sql<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/501477/248713/apache_test.sql">
Tue Aug 26 19:29:18 2008 (648b) by earl [...] switchmanagement.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=38742">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-501477" href="/Public/Bug/Display.html?id=38742#txn-501477">#</a>      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;26&nbsp;19:29:18&nbsp;2008</span>
    <span class="description">earl [...] switchmanagement.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Apache::DBI rolling back transactions globally</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 26 Aug 2008 16:28:51 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Apache-DBI [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Earl Ruby &lt;earl [...] switchmanagement.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/501477/248711/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/248711">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m having an odd problem under Apache::DBI v1.07 connecting to an 
Oracle database. This problem does not occur on older servers running 
Apache::DBI v0.94, and it does not occur if I remove &#34;PerlModule 
Apache::DBI&#34; from my Apache config.

The problem is that DBI-&gt;connect is returning the same connection 
multiple times to the same process. This means that if there is a 
transaction in progress on a connection, and a utility function gets 
called which opens it&#39;s &#34;own&#34; connection to the database, when the 
utility function disconnects it ends up rolling back the transaction for 
the other connection.

I&#39;ve attached a sample CGI script &#40;apache_dbi_test&#41; and an Oracle SQL 
script that creates the apache_test table &#40;apache_test.sql&#41; that 
demonstrates the problem. The main&#40;&#41; subroutine gets a connection, 
inserts a record into a table, then calls a utility function.

The utility function opens a connection to the database then 
disconnects. Apache::DBI rolls back any pending transactions on this 
connection due to the disconnect.

The main&#40;&#41; subroutine then selects the maximum record ID again using 
it&#39;s original connection, only the record is no longer there because the 
utility function rolled the transaction back.

The output under Apache::DBI v1.07 looks like this:

---------------------------------------------

Maximum ID is 108, conn=Apache::DBI::db=HASH&#40;0x80b1ac6c&#41;

utility_function conn=Apache::DBI::db=HASH&#40;0x80b1ac6c&#41;

Maximum ID is 83, conn=Apache::DBI::db=HASH&#40;0x80b1ac6c&#41;

The maximum record ID has changed, the connection was rolled back

---------------------------------------------

Under 0.94 it looks like this:

---------------------------------------------

Maximum ID is 109, conn=Apache::DBI::db=HASH&#40;0x9fb9a2c&#41;

utility_function conn=Apache::DBI::db=HASH&#40;0x9fb9a2c&#41;

Maximum ID is 109, conn=Apache::DBI::db=HASH&#40;0x9fb9a2c&#41;

The maximum record ID is the same, the connection was not rolled back

---------------------------------------------

I&#39;m thinking that for connection pooling to work, you&#39;d want to track 
which connections are currently active, and only return 
currently-inactive connections when a script requests a new connection. 
When disconnect is called you&#39;d return a connection to the inactive 
pool. I&#39;ve read through DBI.pm and it doesn&#39;t seem to be doing this, 
although I may not be understanding it correctly.

-- 
Earl C. Ruby III, Senior Systems Engineer / Developer
Switch Management
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/501477/248712/apache_dbi_test">Download apache_dbi_test</a><br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl

# A test of Apache::DBI connection pooling

use DBI;

use constant DB_USER =&gt; &#39;scott&#39;;
use constant DB_PASSWORD =&gt; &#39;tiger&#39;;
use constant DB_ATTRIBUTES =&gt; { RaiseError =&gt; 1, AutoCommit =&gt; 0, LongReadLen =&gt; 10000000 };

use constant CRLF =&gt; &#34;\x0d\x0a&#34;;

# Prototypes
sub main;
sub utility_function;
sub get_connection;

main;

sub main {

    print &#39;Content-Type: text/html&#39; . CRLF . CRLF;

    my $conn = get_connection;

    # Add a record to apache_test
    $conn-&gt;do&#40;&#34;insert into apache_test &#40;name&#41; values &#40;to_char&#40;sysdate, &#39;YYYY-MM-DD HH24:MI:SS&#39;&#41;&#41;&#34;&#41;;

    # Get the maximum ID from apache_test
    my $stmt = $conn-&gt;prepare&#40;&#34;select max&#40;id&#41; as max_id from apache_test&#34;&#41;;
    $stmt-&gt;execute;
    my $row = $stmt-&gt;fetchrow_hashref;
    print &#34;&lt;p&gt;Maximum ID is $row-&gt;{max_id}, conn=$conn\n&#34;;
    my $max_value = $row-&gt;{max_id};
    $stmt-&gt;finish;

    # Call a utility function
    utility_function;

    # Now see what the maximum ID value is using the same connection
    my $stmt2 = $conn-&gt;prepare&#40;&#34;select max&#40;id&#41; as max_id from apache_test&#34;&#41;;
    $stmt2-&gt;execute;
    my $row2 = $stmt2-&gt;fetchrow_hashref;
    print &#34;&lt;p&gt;Maximum ID is $row2-&gt;{max_id}, conn=$conn\n&#34;;

    if &#40;$max_value != $row2-&gt;{max_id}&#41; {
        print &#34;&lt;p&gt;&lt;b&gt;The maximum record ID has changed, the connection was rolled back&lt;/b&gt;\n&#34;;
    } else {
        print &#34;&lt;p&gt;The maximum record ID is the same, the connection was not rolled back\n&#34;;
    }
    $stmt2-&gt;finish;

    $conn-&gt;disconnect;

}

sub utility_function {

    # Should have no effect on other connections in other subs
    my $conn = get_connection;
    print &#34;&lt;p&gt;utility_function conn=$conn\n&#34;;
    $conn-&gt;disconnect;

}

sub get_connection {

    my $connect_string = &#39;dbi:Oracle:dev002.switchmanagement.com&#39;;
    my $conn = DBI-&gt;connect&#40;$connect_string, DB_USER, DB_PASSWORD, DB_ATTRIBUTES&#41;;

    # Set up a default date format that gives us full precision
    $conn-&gt;do&#40;&#34;alter session set nls_date_format = &#39;YYYYMMDDHH24MISS&#39;&#34;&#41;;

    # Return all hashref keys in lowercase
    $conn-&gt;{FetchHashKeyName} = &#39;NAME_lc&#39;;

    return $conn;
}

1;

</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/501477/248713/apache_test.sql">Download apache_test.sql</a><br />
<span class="downloadcontenttype">text/x-sql 648b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">-- Create an Oracle sequence and a table for apache_dbi_test CGI script

create sequence apache_test_seq MINVALUE 1 MAXVALUE 999999999999999999999999999 START WITH 1 INCREMENT BY 1 CACHE 20;

create table apache_test&#40;
	id number not null,
	name varchar2&#40;200&#41; null
&#41;
monitoring;

create or replace trigger apache_test_insert
before insert on apache_test
for each row
declare
	new_id integer;
begin
	select apache_test_seq.nextval into new_id from dual;
	:new.id := new_id;
end;
/

alter trigger apache_test_insert compile;

insert into apache_test &#40;name&#41; values &#40;&#39;Test record A&#39;&#41;;
insert into apache_test &#40;name&#41; values &#40;&#39;Test record B&#39;&#41;;

commit;


</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-506259" href="/Public/Bug/Display.html?id=38742#txn-506259">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;08&nbsp;19:14:05&nbsp;2008</span>
    <span class="description">earl [...] switchmanagement.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #38742] AutoReply: Apache::DBI rolling back transactions globally</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 08 Sep 2008 16:13:47 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Apache-DBI [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Earl Ruby &lt;earl [...] switchmanagement.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/506259/251687/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/251687">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I found a problem in DBI.pm v1.07. On line 275 in the 
reset_startup_state method the first thing the method does before 
handing out a connection is to rollback the connection globally. That 
means that all transactions currently in progress which use this 
connection will be rolled back. This is a bad idea.

In earlier versions of DBI.pm the handle would only be rolled back once, 
in PerlCleanupHandler, after all connections had disconnected. The 
entire reason why PerlCleanupHandler goes to great lengths to track when 
the last connection disconnects is to avoid this problem.

If you remove the &#34;Rollback current transaction if currently in one&#34; 
section the problem goes away.

The way that connection pooling is implemented is still flawed for 
applications that use transactions &#40;AutoCommit is off&#41;. Pooling should 
track whether a connection is currently active, and that connection 
should not be used by another process while it&#39;s active. A connection 
could be reused after the process disconnects, but reusing while a 
transaction is in progress violates transactional integrity. &#40;See 
<span class="clickylink"><a target="new" rel="nofollow" href="http://en.wikipedia.org/wiki/Connection_pool.&#41;">http://en.wikipedia.org/wiki/Connection_pool.&#41;</a></span>

Here is a diff showing the lines to remove:


# diff -ruN DBI.pm.1.07 DBI.pm.1.07-modified
--- DBI.pm.1.07 2008-08-26 20:56:44.000000000 +0000
+++ DBI.pm.1.07-modified        2008-09-08 23:03:48.000000000 +0000
@@ -272,11 +272,6 @@
  sub reset_startup_state {
      my $Idx = shift;

-    # Rollback current transaction if currently in one
-    $Connected{$Idx}-&gt;{Active}
-      and !$Connected{$Idx}-&gt;{AutoCommit}
-      and eval {$Connected{$Idx}-&gt;rollback};
-
      foreach my $key &#40;@attrs&#41; {
          $Connected{$Idx}-&gt;{$key} =
              $Connected{$Idx}-&gt;{private_Apache_DBI}{$key};
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-906315" href="/Public/Bug/Display.html?id=38742#txn-906315">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;03&nbsp;08:57:42&nbsp;2011</span>
    <span class="description">perrin [...] elem.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> perrin [...] elem.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/906315/470131/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/470131">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 813b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Earl,

I agree that reset_startup_state should not be called when handles are
given out.  It would make more sense to call that in cleanup after the
rollback.  If you&#39;d like to try making a patch, I can submit it to the
dev list.

I think you may be misunderstanding the purpose of Apache::DBI a little
bit.  It isn&#39;t intended to pool connections, but rather to keep
connections persistent.  It does this in a fairly magical way in order
to help with adapting existing CGI scripts.  It is possible to open a
non-persistent handle, or just get a different handle by varying the
connect&#40;&#41; parameters.  This has been discussed on the mod_perl list.

Since you aren&#39;t adapting a CGI script and you seem to need finer
control, you might consider switching to DBI-&gt;connect_cached&#40;&#41; in place
of Apache::DBI.

- Perrin
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-906318" href="/Public/Bug/Display.html?id=38742#txn-906318">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;03&nbsp;08:57:43&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.362749</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
