<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #103254 for Net-NTP: send: Cannot determine peer address at</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #103254 for Net-NTP: send: Cannot determine peer address at</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Net-NTP">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Net-NTP">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Net-NTP">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Net-NTP">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-NTP">Net-NTP CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">103254</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Net-NTP">Net-NTP</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">ABH [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
DJIBEL [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-22962-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.4    </td>
  </tr>
  <tr id="CF-22963-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




NTP.pm<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1495262/796451/NTP.pm">
Mon May 11 13:14:00 2015 (7.6k) by MNOONING [...] cpan.org
</a>
</font></li>
</ul>


NTP_mhn.pm<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1495262/796452/NTP_mhn.pm">
Mon May 11 13:14:00 2015 (6.9k) by MNOONING [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=103254">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1480774" href="/Public/Bug/Display.html?id=103254#txn-1480774">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;01&nbsp;16:26:08&nbsp;2015</span>
    <span class="description">DJIBEL [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> send: Cannot determine peer address at</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1480774/788820/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/788820">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dear,

I am using Strawberry Perl 5.20.2 on Windows 8.1, Windows 2008 R2... and Net::NTP 1.4.
I have always this message : send: Cannot determine peer address at E:/Strawberry/perl/site/lib/Net/NTP.pm line 163.

Program :
#!/usr/bin/perl
use strict;
use warnings;
use Net::NTP qw&#40;get_ntp_response&#41;;
my %response;
my %inner_result = &#40;&#41;;
my $ntp_time;
my @time_servers =
  qw &#40; pool.ntp.org 0.pool.ntp.org 1.pool.ntp.org north-america.pool.ntp.org 0.north-america.pool.ntp.org 1.north-america.pool.ntp.org 2.north-america.pool.ntp.org 3.north-america.pool.ntp.org time-a.timefreq.bldrdoc.gov time-c.timefreq.bldrdoc.gov utcnist.colorado.edu time.nist.gov nist1-sj.WiTime.net www.pool.ntp.org &#41;;
foreach my $time_server &#40;@time_servers&#41; {
        print&#40;&#34;Trying time server $time_server\n&#34;&#41;;
        %response = eval { get_ntp_response&#40; $time_server, 123 &#41; };
        if &#40;$@&#41; { print &#34;Time server $time_server did not work\n$@\n&#34;; }
        else {
                if &#40; !&#40; defined&#40; $response{&#34;Receive Timestamp&#34;} &#41; &#41; or $response{&#34;Receive Timestamp&#34;} eq &#34;&#34; &#41; {
                        say&#40;&#34;Receive Timestamp is bad.&#34;&#41;;
                }
                else {
                        $ntp_time = $response{&#34;Receive Timestamp&#34;};
                        $ntp_time =~ s/\..*//;
                }
        }
}

Result :
Trying time server pool.ntp.org
Time server pool.ntp.org did not work
send: Cannot determine peer address at E:/Strawberry/perl/site/lib/Net/NTP.pm line 163.

Trying time server 0.pool.ntp.org
Time server 0.pool.ntp.org did not work
send: Cannot determine peer address at E:/Strawberry/perl/site/lib/Net/NTP.pm line 163.

Trying time server 1.pool.ntp.org
Time server 1.pool.ntp.org did not work
send: Cannot determine peer address at E:/Strawberry/perl/site/lib/Net/NTP.pm line 163.

Trying time server north-america.pool.ntp.org
Time server north-america.pool.ntp.org did not work
send: Cannot determine peer address at E:/Strawberry/perl/site/lib/Net/NTP.pm line 163.

Trying time server 0.north-america.pool.ntp.org
Time server 0.north-america.pool.ntp.org did not work
send: Cannot determine peer address at E:/Strawberry/perl/site/lib/Net/NTP.pm line 163.

Trying time server 1.north-america.pool.ntp.org
Time server 1.north-america.pool.ntp.org did not work
send: Cannot determine peer address at E:/Strawberry/perl/site/lib/Net/NTP.pm line 163.

Trying time server 2.north-america.pool.ntp.org
Time server 2.north-america.pool.ntp.org did not work
send: Cannot determine peer address at E:/Strawberry/perl/site/lib/Net/NTP.pm line 163.

Trying time server 3.north-america.pool.ntp.org
Time server 3.north-america.pool.ntp.org did not work
send: Cannot determine peer address at E:/Strawberry/perl/site/lib/Net/NTP.pm line 163.

Trying time server time-a.timefreq.bldrdoc.gov
Time server time-a.timefreq.bldrdoc.gov did not work
send: Cannot determine peer address at E:/Strawberry/perl/site/lib/Net/NTP.pm line 163.

Trying time server time-c.timefreq.bldrdoc.gov
Time server time-c.timefreq.bldrdoc.gov did not work
send: Cannot determine peer address at E:/Strawberry/perl/site/lib/Net/NTP.pm line 163.

Trying time server utcnist.colorado.edu
Time server utcnist.colorado.edu did not work
send: Cannot determine peer address at E:/Strawberry/perl/site/lib/Net/NTP.pm line 163.

Trying time server time.nist.gov
Time server time.nist.gov did not work
send: Cannot determine peer address at E:/Strawberry/perl/site/lib/Net/NTP.pm line 163.

Trying time server nist1-sj.WiTime.net
Time server nist1-sj.WiTime.net did not work
send: Cannot determine peer address at E:/Strawberry/perl/site/lib/Net/NTP.pm line 163.

Trying time server www.pool.ntp.org
Time server www.pool.ntp.org did not work
send: Cannot determine peer address at E:/Strawberry/perl/site/lib/Net/NTP.pm line 163.

Best regards,
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1480883" href="/Public/Bug/Display.html?id=103254#txn-1480883">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;01&nbsp;21:33:58&nbsp;2015</span>
    <span class="description">ask [...] perl.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #103254] send: Cannot determine peer address at</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 1 Apr 2015 18:33:33 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-NTP [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ask Bjørn Hansen &lt;ask [...] perl.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1480883/788888/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/788888">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 54b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I don&#39;t know anything about Windows. Patches welcome.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1480884" href="/Public/Bug/Display.html?id=103254#txn-1480884">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;01&nbsp;21:33:58&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1480918" href="/Public/Bug/Display.html?id=103254#txn-1480918">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;02&nbsp;03:12:56&nbsp;2015</span>
    <span class="description">DJIBEL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1480918/788905/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/788905">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 292b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le Mer 01 Avr 2015 21:33:58, ask@perl.org a écrit :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I don&#39;t know anything about Windows. Patches welcome.
</div>

Dear,

I have test the same program on another Windows machine with ActivePerl &#40;5.20&#41; and the program works. Then, I suspect a problem with Strawberry Perl but I don&#39;t know why !
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1481042" href="/Public/Bug/Display.html?id=103254#txn-1481042">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;02&nbsp;13:08:34&nbsp;2015</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1481042/788976/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/788976">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 489b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2015-04-02 03:12:56, DJIBEL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Le Mer 01 Avr 2015 21:33:58, ask@perl.org a écrit :
<div class="message-stanza open">&gt; &gt; I don&#39;t know anything about Windows. Patches welcome.
</div>&gt; 
&gt; 
&gt; Dear,
&gt; 
&gt; I have test the same program on another Windows machine with
&gt; ActivePerl &#40;5.20&#41; and the program works. Then, I suspect a problem
&gt; with Strawberry Perl but I don&#39;t know why !
</div>
What about the optional IO::Socket::INET6 dependency? Maybe it&#39;s installed in one perl distribution but not in the other? Or versions differ?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1481079" href="/Public/Bug/Display.html?id=103254#txn-1481079">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;02&nbsp;15:31:18&nbsp;2015</span>
    <span class="description">DJIBEL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1481079/788995/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/788995">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 979b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le Jeu 02 Avr 2015 13:08:34, SREZIC a écrit :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2015-04-02 03:12:56, DJIBEL wrote:
<div class="message-stanza open">&gt; &gt; Le Mer 01 Avr 2015 21:33:58, ask@perl.org a écrit :
<div class="message-stanza open">&gt; &gt; &gt; I don&#39;t know anything about Windows. Patches welcome.
</div>&gt; &gt;
&gt; &gt;
&gt; &gt; Dear,
&gt; &gt;
&gt; &gt; I have test the same program on another Windows machine with
&gt; &gt; ActivePerl &#40;5.20&#41; and the program works. Then, I suspect a problem
&gt; &gt; with Strawberry Perl but I don&#39;t know why !
</div>&gt; 
&gt; What about the optional IO::Socket::INET6 dependency? Maybe it&#39;s
&gt; installed in one perl distribution but not in the other? Or versions
&gt; differ?
</div>
Dear,

On the machine with ActivePerl, I have installed IO::Socket::INET6 and Socket6 and now, I have the same error message. But On Strawberry Perl, if I uninstall theses modules, I don&#39;t have the error message but the programe doesn&#39;t give result :
Trying time server pool.ntp.org
Trying time server 0.pool.ntp.org
Trying time server 1.pool.ntp.org
Trying time server north-america.pool.ntp.org
...

Best Regards,
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1481103" href="/Public/Bug/Display.html?id=103254#txn-1481103">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;02&nbsp;16:33:06&nbsp;2015</span>
    <span class="description">DJIBEL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1481103/789010/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/789010">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le Jeu 02 Avr 2015 15:31:18, DJIBEL a écrit :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Le Jeu 02 Avr 2015 13:08:34, SREZIC a écrit :
<div class="message-stanza open">&gt; &gt; On 2015-04-02 03:12:56, DJIBEL wrote:
<div class="message-stanza open">&gt; &gt; &gt; Le Mer 01 Avr 2015 21:33:58, ask@perl.org a écrit :
<div class="message-stanza open">&gt; &gt; &gt; &gt; I don&#39;t know anything about Windows. Patches welcome.
</div>&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; Dear,
&gt; &gt; &gt;
&gt; &gt; &gt; I have test the same program on another Windows machine with
&gt; &gt; &gt; ActivePerl &#40;5.20&#41; and the program works. Then, I suspect a problem
&gt; &gt; &gt; with Strawberry Perl but I don&#39;t know why !
</div>&gt; &gt;
&gt; &gt; What about the optional IO::Socket::INET6 dependency? Maybe it&#39;s
&gt; &gt; installed in one perl distribution but not in the other? Or versions
&gt; &gt; differ?
</div>&gt; 
&gt; Dear,
&gt; 
&gt; On the machine with ActivePerl, I have installed IO::Socket::INET6 and
&gt; Socket6 and now, I have the same error message. But On Strawberry
&gt; Perl, if I uninstall theses modules, I don&#39;t have the error message
&gt; but the programe doesn&#39;t give result :
&gt; Trying time server pool.ntp.org
&gt; Trying time server 0.pool.ntp.org
&gt; Trying time server 1.pool.ntp.org
&gt; Trying time server north-america.pool.ntp.org
&gt; ...
&gt; 
&gt; Best Regards,
</div>
On Strawberry Perl Windows, You have to uninstall Socket6 and IO::Socket::INET6 and Net::NTP works.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1481105" href="/Public/Bug/Display.html?id=103254#txn-1481105">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;02&nbsp;16:58:49&nbsp;2015</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1481105/789012/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/789012">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2015-04-02 15:31:18, DJIBEL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Le Jeu 02 Avr 2015 13:08:34, SREZIC a écrit :
<div class="message-stanza open">&gt; &gt; On 2015-04-02 03:12:56, DJIBEL wrote:
<div class="message-stanza open">&gt; &gt; &gt; Le Mer 01 Avr 2015 21:33:58, ask@perl.org a écrit :
<div class="message-stanza open">&gt; &gt; &gt; &gt; I don&#39;t know anything about Windows. Patches welcome.
</div>&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; Dear,
&gt; &gt; &gt;
&gt; &gt; &gt; I have test the same program on another Windows machine with
&gt; &gt; &gt; ActivePerl &#40;5.20&#41; and the program works. Then, I suspect a problem
&gt; &gt; &gt; with Strawberry Perl but I don&#39;t know why !
</div>&gt; &gt;
&gt; &gt; What about the optional IO::Socket::INET6 dependency? Maybe it&#39;s
&gt; &gt; installed in one perl distribution but not in the other? Or versions
&gt; &gt; differ?
</div>&gt; 
&gt; Dear,
&gt; 
&gt; On the machine with ActivePerl, I have installed IO::Socket::INET6 and
&gt; Socket6 and now, I have the same error message. But On Strawberry
&gt; Perl, if I uninstall theses modules, I don&#39;t have the error message
&gt; but the programe doesn&#39;t give result :
&gt; Trying time server pool.ntp.org
&gt; Trying time server 0.pool.ntp.org
&gt; Trying time server 1.pool.ntp.org
&gt; Trying time server north-america.pool.ntp.org
&gt; ...
</div>
Maybe it has also something to do with IO::Socket::IP vs. IO::Socket::INET? Once it was possible to replace the old INET module by the new IP module &#40;e.g. via Acme::Override::INET&#41;. Maybe the Strawberry people did this?

Another debugging aid: use something like Module::PrintUsed to see what modules and versions are in use in the script run in ActivePerl and StrawberryPerl.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1481196" href="/Public/Bug/Display.html?id=103254#txn-1481196">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;03&nbsp;04:54:39&nbsp;2015</span>
    <span class="description">DJIBEL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1481196/789071/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/789071">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 7.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le Jeu 02 Avr 2015 16:58:49, SREZIC a écrit :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2015-04-02 15:31:18, DJIBEL wrote:
<div class="message-stanza open">&gt; &gt; Le Jeu 02 Avr 2015 13:08:34, SREZIC a écrit :
<div class="message-stanza open">&gt; &gt; &gt; On 2015-04-02 03:12:56, DJIBEL wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; Le Mer 01 Avr 2015 21:33:58, ask@perl.org a écrit :
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; I don&#39;t know anything about Windows. Patches welcome.
</div>&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; Dear,
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; I have test the same program on another Windows machine with
&gt; &gt; &gt; &gt; ActivePerl &#40;5.20&#41; and the program works. Then, I suspect a
&gt; &gt; &gt; &gt; problem
&gt; &gt; &gt; &gt; with Strawberry Perl but I don&#39;t know why !
</div>&gt; &gt; &gt;
&gt; &gt; &gt; What about the optional IO::Socket::INET6 dependency? Maybe it&#39;s
&gt; &gt; &gt; installed in one perl distribution but not in the other? Or
&gt; &gt; &gt; versions
&gt; &gt; &gt; differ?
</div>&gt; &gt;
&gt; &gt; Dear,
&gt; &gt;
&gt; &gt; On the machine with ActivePerl, I have installed IO::Socket::INET6
&gt; &gt; and
&gt; &gt; Socket6 and now, I have the same error message. But On Strawberry
&gt; &gt; Perl, if I uninstall theses modules, I don&#39;t have the error message
&gt; &gt; but the programe doesn&#39;t give result :
&gt; &gt; Trying time server pool.ntp.org
&gt; &gt; Trying time server 0.pool.ntp.org
&gt; &gt; Trying time server 1.pool.ntp.org
&gt; &gt; Trying time server north-america.pool.ntp.org
&gt; &gt; ...
</div>&gt; 
&gt; Maybe it has also something to do with IO::Socket::IP vs.
&gt; IO::Socket::INET? Once it was possible to replace the old INET module
&gt; by the new IP module &#40;e.g. via Acme::Override::INET&#41;. Maybe the
&gt; Strawberry people did this?
&gt; 
&gt; Another debugging aid: use something like Module::PrintUsed to see
&gt; what modules and versions are in use in the script run in ActivePerl
&gt; and StrawberryPerl.
</div>
Dear,

I have made some tests. 
That is the program :

#!/usr/bin/perl
use strict;
use warnings;
use Net::NTP qw&#40;get_ntp_response&#41;;
use Module::PrintUsed;

my %response;
my %inner_result = &#40;&#41;;
my $ntp_time;
my @time_servers = qw &#40; pool.ntp.org 0.pool.ntp.org 1.pool.ntp.org north-america.pool.ntp.org  &#41;;
foreach my $time_server &#40;@time_servers&#41; {
        print&#40;&#34;Trying time server $time_server\n&#34;&#41;;
        %response = eval { get_ntp_response&#40; $time_server, 123 &#41; };
        if &#40;$@&#41; { print &#34;Time server $time_server did not work\n$@\n&#34;; }
        else {
                if &#40; !&#40; defined&#40; $response{&#34;Receive Timestamp&#34;} &#41; &#41; or $response{&#34;Receive Timestamp&#34;} eq &#34;&#34; &#41; {
                        say&#40;&#34;Receive Timestamp is bad.&#34;&#41;;
                }
                else {
                        $ntp_time = $response{&#34;Receive Timestamp&#34;};
                        $ntp_time =~ s/\..*//;
                        print &#34;$ntp_time\n&#34;;
                }
        }
}
print Module::PrintUsed::FormattedModulesList&#40;&#41;;

======
Strawberry Perl 5.20.2 64 bits - Windows 8.1.

Trying time server pool.ntp.org
Time server pool.ntp.org did not work
send: Cannot determine peer address at C:/Strawberry/perl/site/lib/Net/NTP.pm line 163.

Trying time server 0.pool.ntp.org
Time server 0.pool.ntp.org did not work
send: Cannot determine peer address at C:/Strawberry/perl/site/lib/Net/NTP.pm line 163.

Trying time server 1.pool.ntp.org
Time server 1.pool.ntp.org did not work
send: Cannot determine peer address at C:/Strawberry/perl/site/lib/Net/NTP.pm line 163.

Trying time server north-america.pool.ntp.org
Time server north-america.pool.ntp.org did not work
send: Cannot determine peer address at C:/Strawberry/perl/site/lib/Net/NTP.pm line 163.


Modules used by net-ntp.pl:
 - Carp                      1.3301   C:/Strawberry/perl/lib/Carp.pm
 - Config                    5.020002 C:/Strawberry/perl/lib/Config.pm
 - DynaLoader                1.25     C:/Strawberry/perl/lib/DynaLoader.pm
 - Errno                     1.2005   C:/Strawberry/perl/lib/Errno.pm
 - Exporter                  5.71     C:/Strawberry/perl/lib/Exporter.pm
 - Exporter::Heavy           5.71     C:/Strawberry/perl/lib/Exporter/Heavy.pm
 - IO                        1.31     C:/Strawberry/perl/lib/IO.pm
 - IO::Handle                1.35     C:/Strawberry/perl/lib/IO/Handle.pm
 - IO::Socket                1.38     C:/Strawberry/perl/lib/IO/Socket.pm
 - IO::Socket::INET          1.35     C:/Strawberry/perl/lib/IO/Socket/INET.pm
 - IO::Socket::INET6         2.72     C:/Strawberry/perl/vendor/lib/IO/Socket/INET6.pm
 - IO::Socket::UNIX          1.26     C:/Strawberry/perl/lib/IO/Socket/UNIX.pm
 - Module::PrintUsed         0.06     C:/Strawberry/perl/site/lib/Module/PrintUsed.pm
 - Net::NTP                  1.4      C:/Strawberry/perl/site/lib/Net/NTP.pm
 - SelectSaver               1.02     C:/Strawberry/perl/lib/SelectSaver.pm
 - Socket                    2.018    C:/Strawberry/perl/lib/Socket.pm
 - Socket6                   0.25     C:/Strawberry/perl/vendor/lib/Socket6.pm
 - Symbol                    1.07     C:/Strawberry/perl/lib/Symbol.pm
 - Time::HiRes               1.9726   C:/Strawberry/perl/lib/Time/HiRes.pm
 - XSLoader                  0.17     C:/Strawberry/perl/lib/XSLoader.pm
 - base                      2.22     C:/Strawberry/perl/lib/base.pm
 - constant                  1.31     C:/Strawberry/perl/lib/constant.pm
 - strict                    1.08     C:/Strawberry/perl/lib/strict.pm
 - vars                      1.03     C:/Strawberry/perl/lib/vars.pm
 - warnings                  1.23     C:/Strawberry/perl/lib/warnings.pm
 - warnings::register        1.03     C:/Strawberry/perl/lib/warnings/register.pm

======
ActivePerl 5.20.1 64 bits - Windows 2008 R2.

Trying time server pool.ntp.org
1428050791
Trying time server 0.pool.ntp.org
1428050791
Trying time server 1.pool.ntp.org
1428050791
Trying time server north-america.pool.ntp.org
1428050791

Modules used by net-ntp.pl:
 - ActivePerl::Config                 C:/Perl/lib/ActivePerl/Config.pm
 - C:::Perl::site::lib::sitecustomize.pl          C:/Perl/site/lib/sitecustomize
.pl
 - Carp                      1.3301   C:/Perl/lib/Carp.pm
 - Config                    5.020001 C:/Perl/lib/Config.pm
 - Config_git.pl                      C:/Perl/lib/Config_git.pl
 - Config_heavy.pl                    C:/Perl/lib/Config_heavy.pl
 - DynaLoader                1.25     C:/Perl/lib/DynaLoader.pm
 - Errno                     1.2003   C:/Perl/lib/Errno.pm
 - Exporter                  5.71     C:/Perl/lib/Exporter.pm
 - Exporter::Heavy           5.71     C:/Perl/lib/Exporter/Heavy.pm
 - IO                        1.31     C:/Perl/lib/IO.pm
 - IO::Handle                1.35     C:/Perl/lib/IO/Handle.pm
 - IO::Socket                1.37     C:/Perl/lib/IO/Socket.pm
 - IO::Socket::INET          1.35     C:/Perl/lib/IO/Socket/INET.pm
 - IO::Socket::UNIX          1.26     C:/Perl/lib/IO/Socket/UNIX.pm
 - List::Util                1.39     C:/Perl/lib/List/Util.pm
 - Module::PrintUsed         0.06     C:/Perl/site/lib/Module/PrintUsed.pm
 - Net::NTP                  1.4      C:/Perl/site/lib/Net/NTP.pm
 - Scalar::Util              1.39     C:/Perl/lib/Scalar/Util.pm
 - SelectSaver               1.02     C:/Perl/lib/SelectSaver.pm
 - Socket                    2.015    C:/Perl/lib/Socket.pm
 - Symbol                    1.07     C:/Perl/lib/Symbol.pm
 - Time::HiRes               1.9726   C:/Perl/lib/Time/HiRes.pm
 - XSLoader                  0.17     C:/Perl/lib/XSLoader.pm
 - constant                  1.31     C:/Perl/lib/constant.pm
 - strict                    1.08     C:/Perl/lib/strict.pm
 - vars                      1.03     C:/Perl/lib/vars.pm
 - warnings                  1.23     C:/Perl/lib/warnings.pm
 - warnings::register        1.03     C:/Perl/lib/warnings/register.pm


We can see that in Strawberry Perl, we have IO::Socket::INET6, Socket6 and IO::Socket &#40;1.38&#41;, Socket &#40;2.018&#41;
In ActivePerl, we don&#39;t have IO::Socket::INET6 and Socket6. We have IO::Socket &#40;1.35&#41;, Socket &#40;2.015&#41;

Best Regards,
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1481198" href="/Public/Bug/Display.html?id=103254#txn-1481198">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;03&nbsp;05:27:18&nbsp;2015</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1481198/789073/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/789073">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2015-04-03 04:54:39, DJIBEL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Le Jeu 02 Avr 2015 16:58:49, SREZIC a écrit :
<div class="message-stanza open">&gt; &gt; On 2015-04-02 15:31:18, DJIBEL wrote:
<div class="message-stanza open">&gt; &gt; &gt; Le Jeu 02 Avr 2015 13:08:34, SREZIC a écrit :
<div class="message-stanza open">&gt; &gt; &gt; &gt; On 2015-04-02 03:12:56, DJIBEL wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; Le Mer 01 Avr 2015 21:33:58, ask@perl.org a écrit :
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; &gt; I don&#39;t know anything about Windows. Patches welcome.
</div>&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; Dear,
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; I have test the same program on another Windows machine with
&gt; &gt; &gt; &gt; &gt; ActivePerl &#40;5.20&#41; and the program works. Then, I suspect a
&gt; &gt; &gt; &gt; &gt; problem
&gt; &gt; &gt; &gt; &gt; with Strawberry Perl but I don&#39;t know why !
</div>&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; What about the optional IO::Socket::INET6 dependency? Maybe it&#39;s
&gt; &gt; &gt; &gt; installed in one perl distribution but not in the other? Or
&gt; &gt; &gt; &gt; versions
&gt; &gt; &gt; &gt; differ?
</div>&gt; &gt; &gt;
&gt; &gt; &gt; Dear,
&gt; &gt; &gt;
&gt; &gt; &gt; On the machine with ActivePerl, I have installed IO::Socket::INET6
&gt; &gt; &gt; and
&gt; &gt; &gt; Socket6 and now, I have the same error message. But On Strawberry
&gt; &gt; &gt; Perl, if I uninstall theses modules, I don&#39;t have the error message
&gt; &gt; &gt; but the programe doesn&#39;t give result :
&gt; &gt; &gt; Trying time server pool.ntp.org
&gt; &gt; &gt; Trying time server 0.pool.ntp.org
&gt; &gt; &gt; Trying time server 1.pool.ntp.org
&gt; &gt; &gt; Trying time server north-america.pool.ntp.org
&gt; &gt; &gt; ...
</div>&gt; &gt;
&gt; &gt; Maybe it has also something to do with IO::Socket::IP vs.
&gt; &gt; IO::Socket::INET? Once it was possible to replace the old INET module
&gt; &gt; by the new IP module &#40;e.g. via Acme::Override::INET&#41;. Maybe the
&gt; &gt; Strawberry people did this?
&gt; &gt;
&gt; &gt; Another debugging aid: use something like Module::PrintUsed to see
&gt; &gt; what modules and versions are in use in the script run in ActivePerl
&gt; &gt; and StrawberryPerl.
</div>&gt; 
&gt; Dear,
&gt; 
&gt; I have made some tests.
&gt; That is the program :
&gt; 
&gt; #!/usr/bin/perl
&gt; use strict;
&gt; use warnings;
&gt; use Net::NTP qw&#40;get_ntp_response&#41;;
&gt; use Module::PrintUsed;
&gt; 
&gt; my %response;
&gt; my %inner_result = &#40;&#41;;
&gt; my $ntp_time;
&gt; my @time_servers = qw &#40; pool.ntp.org 0.pool.ntp.org 1.pool.ntp.org
&gt; north-america.pool.ntp.org  &#41;;
&gt; foreach my $time_server &#40;@time_servers&#41; {
&gt;         print&#40;&#34;Trying time server $time_server\n&#34;&#41;;
&gt;         %response = eval { get_ntp_response&#40; $time_server, 123 &#41; };
&gt;         if &#40;$@&#41; { print &#34;Time server $time_server did not work\n$@\n&#34;;
&gt; }
&gt;         else {
&gt;                 if &#40; !&#40; defined&#40; $response{&#34;Receive Timestamp&#34;} &#41; &#41; or
&gt; $response{&#34;Receive Timestamp&#34;} eq &#34;&#34; &#41; {
&gt;                         say&#40;&#34;Receive Timestamp is bad.&#34;&#41;;
&gt;                 }
&gt;                 else {
&gt;                         $ntp_time = $response{&#34;Receive Timestamp&#34;};
&gt;                         $ntp_time =~ s/\..*//;
&gt;                         print &#34;$ntp_time\n&#34;;
&gt;                 }
&gt;         }
&gt; }
&gt; print Module::PrintUsed::FormattedModulesList&#40;&#41;;
&gt; 
&gt; ======
&gt; Strawberry Perl 5.20.2 64 bits - Windows 8.1.
&gt; 
&gt; Trying time server pool.ntp.org
&gt; Time server pool.ntp.org did not work
&gt; send: Cannot determine peer address at
&gt; C:/Strawberry/perl/site/lib/Net/NTP.pm line 163.
&gt; 
&gt; Trying time server 0.pool.ntp.org
&gt; Time server 0.pool.ntp.org did not work
&gt; send: Cannot determine peer address at
&gt; C:/Strawberry/perl/site/lib/Net/NTP.pm line 163.
&gt; 
&gt; Trying time server 1.pool.ntp.org
&gt; Time server 1.pool.ntp.org did not work
&gt; send: Cannot determine peer address at
&gt; C:/Strawberry/perl/site/lib/Net/NTP.pm line 163.
&gt; 
&gt; Trying time server north-america.pool.ntp.org
&gt; Time server north-america.pool.ntp.org did not work
&gt; send: Cannot determine peer address at
&gt; C:/Strawberry/perl/site/lib/Net/NTP.pm line 163.
&gt; 
&gt; 
&gt; Modules used by net-ntp.pl:
&gt;  - Carp                      1.3301   C:/Strawberry/perl/lib/Carp.pm
&gt;  - Config                    5.020002 C:/Strawberry/perl/lib/Config.pm
&gt;  - DynaLoader                1.25
&gt; C:/Strawberry/perl/lib/DynaLoader.pm
&gt;  - Errno                     1.2005   C:/Strawberry/perl/lib/Errno.pm
&gt;  - Exporter                  5.71
&gt; C:/Strawberry/perl/lib/Exporter.pm
&gt;  - Exporter::Heavy           5.71
&gt; C:/Strawberry/perl/lib/Exporter/Heavy.pm
&gt;  - IO                        1.31     C:/Strawberry/perl/lib/IO.pm
&gt;  - IO::Handle                1.35
&gt; C:/Strawberry/perl/lib/IO/Handle.pm
&gt;  - IO::Socket                1.38
&gt; C:/Strawberry/perl/lib/IO/Socket.pm
&gt;  - IO::Socket::INET          1.35
&gt; C:/Strawberry/perl/lib/IO/Socket/INET.pm
&gt;  - IO::Socket::INET6         2.72
&gt; C:/Strawberry/perl/vendor/lib/IO/Socket/INET6.pm
&gt;  - IO::Socket::UNIX          1.26
&gt; C:/Strawberry/perl/lib/IO/Socket/UNIX.pm
&gt;  - Module::PrintUsed         0.06
&gt; C:/Strawberry/perl/site/lib/Module/PrintUsed.pm
&gt;  - Net::NTP                  1.4
&gt; C:/Strawberry/perl/site/lib/Net/NTP.pm
&gt;  - SelectSaver               1.02
&gt; C:/Strawberry/perl/lib/SelectSaver.pm
&gt;  - Socket                    2.018    C:/Strawberry/perl/lib/Socket.pm
&gt;  - Socket6                   0.25
&gt; C:/Strawberry/perl/vendor/lib/Socket6.pm
&gt;  - Symbol                    1.07     C:/Strawberry/perl/lib/Symbol.pm
&gt;  - Time::HiRes               1.9726
&gt; C:/Strawberry/perl/lib/Time/HiRes.pm
&gt;  - XSLoader                  0.17
&gt; C:/Strawberry/perl/lib/XSLoader.pm
&gt;  - base                      2.22     C:/Strawberry/perl/lib/base.pm
&gt;  - constant                  1.31
&gt; C:/Strawberry/perl/lib/constant.pm
&gt;  - strict                    1.08     C:/Strawberry/perl/lib/strict.pm
&gt;  - vars                      1.03     C:/Strawberry/perl/lib/vars.pm
&gt;  - warnings                  1.23
&gt; C:/Strawberry/perl/lib/warnings.pm
&gt;  - warnings::register        1.03
&gt; C:/Strawberry/perl/lib/warnings/register.pm
&gt; 
&gt; ======
&gt; ActivePerl 5.20.1 64 bits - Windows 2008 R2.
&gt; 
&gt; Trying time server pool.ntp.org
&gt; 1428050791
&gt; Trying time server 0.pool.ntp.org
&gt; 1428050791
&gt; Trying time server 1.pool.ntp.org
&gt; 1428050791
&gt; Trying time server north-america.pool.ntp.org
&gt; 1428050791
&gt; 
&gt; Modules used by net-ntp.pl:
&gt;  - ActivePerl::Config                 C:/Perl/lib/ActivePerl/Config.pm
&gt;  - C:::Perl::site::lib::sitecustomize.pl
&gt; C:/Perl/site/lib/sitecustomize
&gt; .pl
&gt;  - Carp                      1.3301   C:/Perl/lib/Carp.pm
&gt;  - Config                    5.020001 C:/Perl/lib/Config.pm
&gt;  - Config_git.pl                      C:/Perl/lib/Config_git.pl
&gt;  - Config_heavy.pl                    C:/Perl/lib/Config_heavy.pl
&gt;  - DynaLoader                1.25     C:/Perl/lib/DynaLoader.pm
&gt;  - Errno                     1.2003   C:/Perl/lib/Errno.pm
&gt;  - Exporter                  5.71     C:/Perl/lib/Exporter.pm
&gt;  - Exporter::Heavy           5.71     C:/Perl/lib/Exporter/Heavy.pm
&gt;  - IO                        1.31     C:/Perl/lib/IO.pm
&gt;  - IO::Handle                1.35     C:/Perl/lib/IO/Handle.pm
&gt;  - IO::Socket                1.37     C:/Perl/lib/IO/Socket.pm
&gt;  - IO::Socket::INET          1.35     C:/Perl/lib/IO/Socket/INET.pm
&gt;  - IO::Socket::UNIX          1.26     C:/Perl/lib/IO/Socket/UNIX.pm
&gt;  - List::Util                1.39     C:/Perl/lib/List/Util.pm
&gt;  - Module::PrintUsed         0.06
&gt; C:/Perl/site/lib/Module/PrintUsed.pm
&gt;  - Net::NTP                  1.4      C:/Perl/site/lib/Net/NTP.pm
&gt;  - Scalar::Util              1.39     C:/Perl/lib/Scalar/Util.pm
&gt;  - SelectSaver               1.02     C:/Perl/lib/SelectSaver.pm
&gt;  - Socket                    2.015    C:/Perl/lib/Socket.pm
&gt;  - Symbol                    1.07     C:/Perl/lib/Symbol.pm
&gt;  - Time::HiRes               1.9726   C:/Perl/lib/Time/HiRes.pm
&gt;  - XSLoader                  0.17     C:/Perl/lib/XSLoader.pm
&gt;  - constant                  1.31     C:/Perl/lib/constant.pm
&gt;  - strict                    1.08     C:/Perl/lib/strict.pm
&gt;  - vars                      1.03     C:/Perl/lib/vars.pm
&gt;  - warnings                  1.23     C:/Perl/lib/warnings.pm
&gt;  - warnings::register        1.03     C:/Perl/lib/warnings/register.pm
&gt; 
&gt; 
&gt; We can see that in Strawberry Perl, we have IO::Socket::INET6, Socket6
&gt; and IO::Socket &#40;1.38&#41;, Socket &#40;2.018&#41;
&gt; In ActivePerl, we don&#39;t have IO::Socket::INET6 and Socket6. We have
&gt; IO::Socket &#40;1.35&#41;, Socket &#40;2.015&#41;
</div>
The state of IO::Socket is somewhat confusing. On CPAN there&#39;s only an ancient 1.31 available. corelist says that perl 5.20.1 should come with 1.37, but ActiveState ships only 1.35. Maybe they are aware of some incompatibilities?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1495262" href="/Public/Bug/Display.html?id=103254#txn-1495262">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;11&nbsp;13:14:00&nbsp;2015</span>
    <span class="description">MNOONING [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> ABH [...] cpan.org</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1495262/796450/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/796450">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 384b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have a file that works on Windows 7 64 bit, and another on Windows XP 32 bit.  I do not remember where I got the answers those number of years ago.  I will simply upload the Net::NTP files that work.

On Windows 7 64 bit, install Perl as usual, then install Net::NTP as usual, then copy the NTP_mhn.pm file to NTP.pm, overwriting the original.

My thanks to whoever gave me the fix.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> NTP.pm</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1495262/796451/NTP.pm">Download NTP.pm</a><br />
<span class="downloadcontenttype">text/x-perl 7.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">package Net::NTP;
use 5.008;
use strict;
use warnings;

use IO::Socket;
use constant HAVE_SOCKET_INET6 =&gt; eval { require IO::Socket::INET6 };
use Time::HiRes qw&#40;time&#41;;

require Exporter;

our @ISA = qw&#40;Exporter&#41;;

our @EXPORT = qw&#40;
  get_ntp_response
&#41;;

our $VERSION = &#39;1.4&#39;;

our $TIMEOUT = 5;

our %MODE = &#40;
    &#39;0&#39; =&gt; &#39;reserved&#39;,
    &#39;1&#39; =&gt; &#39;symmetric active&#39;,
    &#39;2&#39; =&gt; &#39;symmetric passive&#39;,
    &#39;3&#39; =&gt; &#39;client&#39;,
    &#39;4&#39; =&gt; &#39;server&#39;,
    &#39;5&#39; =&gt; &#39;broadcast&#39;,
    &#39;6&#39; =&gt; &#39;reserved for NTP control message&#39;,
    &#39;7&#39; =&gt; &#39;reserved for private use&#39;
&#41;;

our %STRATUM = &#40;
    &#39;0&#39; =&gt; &#39;unspecified or unavailable&#39;,
    &#39;1&#39; =&gt; &#39;primary reference &#40;e.g., radio clock&#41;&#39;,
&#41;;

for &#40;2 .. 15&#41; {
    $STRATUM{$_} = &#39;secondary reference &#40;via NTP or SNTP&#41;&#39;;
}

for &#40;16 .. 255&#41; {
    $STRATUM{$_} = &#39;reserved&#39;;
}

our %STRATUM_ONE_TEXT = &#40;
    &#39;LOCL&#39; =&gt;
      &#39;uncalibrated local clock used as a primary reference for a subnet without external means of synchronization&#39;,
    &#39;PPS&#39; =&gt;
      &#39;atomic clock or other pulse-per-second source individually calibrated to national standards&#39;,
    &#39;ACTS&#39; =&gt; &#39;NIST dialup modem service&#39;,
    &#39;USNO&#39; =&gt; &#39;USNO modem service&#39;,
    &#39;PTB&#39;  =&gt; &#39;PTB &#40;Germany&#41; modem service&#39;,
    &#39;TDF&#39;  =&gt; &#39;Allouis &#40;France&#41; Radio 164 kHz&#39;,
    &#39;DCF&#39;  =&gt; &#39;Mainflingen &#40;Germany&#41; Radio 77.5 kHz&#39;,
    &#39;MSF&#39;  =&gt; &#39;Rugby &#40;UK&#41; Radio 60 kHz&#39;,
    &#39;WWV&#39;  =&gt; &#39;Ft. Collins &#40;US&#41; Radio 2.5, 5, 10, 15, 20 MHz&#39;,
    &#39;WWVB&#39; =&gt; &#39;Boulder &#40;US&#41; Radio 60 kHz&#39;,
    &#39;WWVH&#39; =&gt; &#39;Kaui Hawaii &#40;US&#41; Radio 2.5, 5, 10, 15 MHz&#39;,
    &#39;CHU&#39;  =&gt; &#39;Ottawa &#40;Canada&#41; Radio 3330, 7335, 14670 kHz&#39;,
    &#39;LORC&#39; =&gt; &#39;LORAN-C radionavigation system&#39;,
    &#39;OMEG&#39; =&gt; &#39;OMEGA radionavigation system&#39;,
    &#39;GPS&#39;  =&gt; &#39;Global Positioning Service&#39;,
    &#39;GOES&#39; =&gt; &#39;Geostationary Orbit Environment Satellite&#39;,
&#41;;

our %LEAP_INDICATOR = &#40;
    &#39;0&#39; =&gt; &#39;no warning&#39;,
    &#39;1&#39; =&gt; &#39;last minute has 61 seconds&#39;,
    &#39;2&#39; =&gt; &#39;last minute has 59 seconds&#41;&#39;,
    &#39;3&#39; =&gt; &#39;alarm condition &#40;clock not synchronized&#41;&#39;
&#41;;

use constant NTP_ADJ =&gt; 2208988800;

my @ntp_packet_fields = &#40;
    &#39;Leap Indicator&#39;,
    &#39;Version Number&#39;,
    &#39;Mode&#39;,
    &#39;Stratum&#39;,
    &#39;Poll Interval&#39;,
    &#39;Precision&#39;,
    &#39;Root Delay&#39;,
    &#39;Root Dispersion&#39;,
    &#39;Reference Clock Identifier&#39;,
    &#39;Reference Timestamp&#39;,
    &#39;Originate Timestamp&#39;,
    &#39;Receive Timestamp&#39;,
    &#39;Transmit Timestamp&#39;,
&#41;;

my $frac2bin = sub {
    my $bin  = &#39;&#39;;
    my $frac = shift;
    while &#40;length&#40;$bin&#41; &lt; 32&#41; {
        $bin = $bin . int&#40;$frac * 2&#41;;
        $frac = &#40;$frac * 2&#41; - &#40;int&#40;$frac * 2&#41;&#41;;
    }
    return $bin;
};

my $bin2frac = sub {
    my @bin = split &#39;&#39;, shift;
    my $frac = 0;
    while &#40;@bin&#41; {
        $frac = &#40;$frac + pop @bin&#41; / 2;
    }
    return $frac;
};

my $percision = sub {
    my $number = shift;
    if &#40;$number &gt; 127&#41; {
        $number -= 255;
    }
    return sprintf&#40;&#34;%1.4e&#34;, 2**$number&#41;;
};

my $unpack_ip = sub {
    my $ip;
    my $stratum = shift;
    my $tmp_ip  = shift;
    if &#40;$stratum &lt; 2&#41; {
        $ip = unpack&#40;&#34;A4&#34;, pack&#40;&#34;H8&#34;, $tmp_ip&#41;&#41;;
    }
    else {
        $ip = sprintf&#40;&#34;%d.%d.%d.%d&#34;, unpack&#40;&#34;C4&#34;, pack&#40;&#34;H8&#34;, $tmp_ip&#41;&#41;&#41;;
    }
    return $ip;
};


sub get_ntp_response {

    my $host = shift || &#39;localhost&#39;;
    my $port = shift || &#39;ntp&#39;;

    my %args = &#40;
        Proto    =&gt; &#39;udp&#39;,
        PeerHost =&gt; $host,
        PeerPort =&gt; $port
    &#41;;
    my $sock;
    if &#40;HAVE_SOCKET_INET6&#41; {
        $sock = IO::Socket::INET6-&gt;new&#40;%args&#41;;
    }
    else {
        $sock = IO::Socket::INET-&gt;new&#40;%args&#41;;
    }
    die $@ unless $sock;

    my %tmp_pkt;
    my %packet;
    my $data;

    my $client_localtime      = time;
    my $client_adj_localtime  = $client_localtime + NTP_ADJ;
    my $client_frac_localtime = $frac2bin-&gt;&#40;$client_adj_localtime&#41;;

    my $ntp_msg =
      pack&#40;&#34;B8 C3 N10 B32&#34;, &#39;00011011&#39;, &#40;0&#41; x 12, int&#40;$client_adj_localtime&#41;, $client_frac_localtime&#41;;

    $sock-&gt;send&#40;$ntp_msg&#41;
      or die &#34;send&#40;&#41; failed: $!\n&#34;;

    eval {
        local $SIG{ALRM} = sub { die &#34;Net::NTP timed out getting NTP packet\n&#34;; };
        alarm&#40;$TIMEOUT&#41;;
        $sock-&gt;recv&#40;$data, 960&#41;
          or die &#34;recv&#40;&#41; failed: $!\n&#34;;
        alarm&#40;0&#41;;
    };
    alarm 0;

    my $client_recvtime = time;

    if &#40;my $err = $@&#41; {
        return if $err =~ m/^Net::NTP timed out/;
        die $err;
    }

    my @ntp_fields = qw/byte1 stratum poll precision/;
    push @ntp_fields, qw/delay delay_fb disp disp_fb ident/;
    push @ntp_fields, qw/ref_time ref_time_fb/;
    push @ntp_fields, qw/org_time org_time_fb/;
    push @ntp_fields, qw/recv_time recv_time_fb/;
    push @ntp_fields, qw/trans_time trans_time_fb/;

    @tmp_pkt{@ntp_fields} = unpack&#40;&#34;a C3   n B16 n B16 H8   N B32 N B32   N B32 N B32&#34;, $data&#41;;

    @packet{@ntp_packet_fields} = &#40;
        &#40;unpack&#40;&#34;C&#34;, $tmp_pkt{byte1} &#38; &#34;\xC0&#34;&#41; &gt;&gt; 6&#41;,
        &#40;unpack&#40;&#34;C&#34;, $tmp_pkt{byte1} &#38; &#34;\x38&#34;&#41; &gt;&gt; 3&#41;,
        &#40;unpack&#40;&#34;C&#34;, $tmp_pkt{byte1} &#38; &#34;\x07&#34;&#41;&#41;,
        $tmp_pkt{stratum},
        &#40;sprintf&#40;&#34;%0.4f&#34;, $tmp_pkt{poll}&#41;&#41;,
        $tmp_pkt{precision} - 255,
        &#40;$bin2frac-&gt;&#40;$tmp_pkt{delay_fb}&#41;&#41;,
        &#40;sprintf&#40;&#34;%0.4f&#34;, $tmp_pkt{disp}&#41;&#41;,
        $unpack_ip-&gt;&#40;$tmp_pkt{stratum}, $tmp_pkt{ident}&#41;,
        &#40;&#40;$tmp_pkt{ref_time}   += $bin2frac-&gt;&#40;$tmp_pkt{ref_time_fb}&#41;&#41;   -= NTP_ADJ&#41;,
        &#40;&#40;$tmp_pkt{org_time}   += $bin2frac-&gt;&#40;$tmp_pkt{org_time_fb}&#41;&#41;   -= NTP_ADJ&#41;,
        &#40;&#40;$tmp_pkt{recv_time}  += $bin2frac-&gt;&#40;$tmp_pkt{recv_time_fb}&#41;&#41;  -= NTP_ADJ&#41;,
        &#40;&#40;$tmp_pkt{trans_time} += $bin2frac-&gt;&#40;$tmp_pkt{trans_time_fb}&#41;&#41; -= NTP_ADJ&#41;
    &#41;;

    my $dest_org   = sprintf &#34;%0.5f&#34;, &#40;&#40;$client_recvtime - $client_localtime&#41;&#41;;
    my $recv_trans = sprintf &#34;%0.5f&#34;, &#40;$packet{&#39;Receive Timestamp&#39;} - $packet{&#39;Transmit Timestamp&#39;}&#41;;
    my $delay      = sprintf &#34;%0.5f&#34;, &#40;$dest_org + $recv_trans&#41;;

    my $recv_org   = $packet{&#39;Receive Timestamp&#39;} - $client_recvtime;
    my $trans_dest = $packet{&#39;Transmit Timestamp&#39;} - $client_localtime;
    my $offset     = &#40;$recv_org + $trans_dest&#41; / 2;

    # Calculated offset / delay
    $packet{Offset} = $offset;
    $packet{Delay}  = $delay;

    return %packet;
}


1;
__END__

=head1 NAME

Net::NTP - Perl extension for decoding NTP server responses

=head1 SYNOPSIS

  use Net::NTP qw&#40;get_ntp_response&#41;;
  my %response = get_ntp_response&#40;&#41;;

=head1 ABSTRACT

All this module does is send a packet to an NTP server and then decode
the packet recieved into it&#39;s respective parts - as outlined in
RFC1305 and RFC2030.

=head1 DESCRIPTION

This module exports a single method &#40;get_ntp_response&#41; and returns an
associative array based upon RFC1305 and RFC2030.  The response from
the server is &#34;humanized&#34; to a point that further processing of th
information recieved from the server can be manipulated.  For example:
timestamps are in epoch, so one could use the localtime function to
produce an even more &#34;human&#34; representation of the timestamp.

=head2 EXPORT

get_ntp_response&#40;&lt;server&gt;, &lt;port&gt;&#41;;

This module exports a single method - get_ntp_response.  It takes the
server as the first argument &#40;localhost is the default&#41; and port to
send/recieve the packets &#40;ntp or 123 bu default&#41;.  It returns an
associative array of the various parts of the packet as outlined in
RFC1305.  It &#34;normalizes&#34; or &#34;humanizes&#34; various parts of the packet.
For example: all the timestamps are in epoch, NOT hexidecimal.

=head1 SEE ALSO

perl, IO::Socket, RFC1305, RFC2030

=head1 AUTHOR

Now maintained by Ask BjÃ¸rn Hansen, E&lt;lt&gt;ask@develooper.com&lt;gt&gt;

Originally by James G. Willmore, E&lt;lt&gt;jwillmore &#40;at&#41; adelphia.net&lt;gt&gt;
or E&lt;lt&gt;owner &#40;at&#41; ljcomputing.net&lt;gt&gt;

Special thanks to Ralf D. Kloth E&lt;lt&gt;ralf &#40;at&#41; qrq.de&lt;gt&gt; for the code
to decode NTP packets.

=head1 COPYRIGHT AND LICENSE

Copyright 2009 by Ask BjÃ¸rn Hansen; 2004 by James G. Willmore

This library is free software; you can redistribute it and/or modify
it under the same terms as Perl itself. 

=cut
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> NTP_mhn.pm</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1495262/796452/NTP_mhn.pm">Download NTP_mhn.pm</a><br />
<span class="downloadcontenttype">text/x-perl 6.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">package Net::NTP;

use 5.006;
use strict;
use warnings;

require Exporter;

our @ISA = qw&#40;Exporter&#41;;

our @EXPORT = qw&#40;
  get_ntp_response
&#41;;

our $VERSION = &#39;1.3&#39;;

our $TIMEOUT = 60;

our %MODE = &#40;
    &#39;0&#39; =&gt; &#39;reserved&#39;,
    &#39;1&#39; =&gt; &#39;symmetric active&#39;,
    &#39;2&#39; =&gt; &#39;symmetric passive&#39;,
    &#39;3&#39; =&gt; &#39;client&#39;,
    &#39;4&#39; =&gt; &#39;server&#39;,
    &#39;5&#39; =&gt; &#39;broadcast&#39;,
    &#39;6&#39; =&gt; &#39;reserved for NTP control message&#39;,
    &#39;7&#39; =&gt; &#39;reserved for private use&#39;
&#41;;

our %STRATUM = &#40;
    &#39;0&#39; =&gt; &#39;unspecified or unavailable&#39;,
    &#39;1&#39; =&gt; &#39;primary reference &#40;e.g., radio clock&#41;&#39;,
&#41;;

for &#40;2 .. 15&#41; {
    $STRATUM{$_} = &#39;secondary reference &#40;via NTP or SNTP&#41;&#39;;
}

for &#40;16 .. 255&#41; {
    $STRATUM{$_} = &#39;reserved&#39;;
}

our %STRATUM_ONE_TEXT = &#40;
    &#39;LOCL&#39; =&gt;
      &#39;uncalibrated local clock used as a primary reference for a subnet without external means of synchronization&#39;,
    &#39;PPS&#39; =&gt;
      &#39;atomic clock or other pulse-per-second source individually calibrated to national standards&#39;,
    &#39;ACTS&#39; =&gt; &#39;NIST dialup modem service&#39;,
    &#39;USNO&#39; =&gt; &#39;USNO modem service&#39;,
    &#39;PTB&#39;  =&gt; &#39;PTB &#40;Germany&#41; modem service&#39;,
    &#39;TDF&#39;  =&gt; &#39;Allouis &#40;France&#41; Radio 164 kHz&#39;,
    &#39;DCF&#39;  =&gt; &#39;Mainflingen &#40;Germany&#41; Radio 77.5 kHz&#39;,
    &#39;MSF&#39;  =&gt; &#39;Rugby &#40;UK&#41; Radio 60 kHz&#39;,
    &#39;WWV&#39;  =&gt; &#39;Ft. Collins &#40;US&#41; Radio 2.5, 5, 10, 15, 20 MHz&#39;,
    &#39;WWVB&#39; =&gt; &#39;Boulder &#40;US&#41; Radio 60 kHz&#39;,
    &#39;WWVH&#39; =&gt; &#39;Kaui Hawaii &#40;US&#41; Radio 2.5, 5, 10, 15 MHz&#39;,
    &#39;CHU&#39;  =&gt; &#39;Ottawa &#40;Canada&#41; Radio 3330, 7335, 14670 kHz&#39;,
    &#39;LORC&#39; =&gt; &#39;LORAN-C radionavigation system&#39;,
    &#39;OMEG&#39; =&gt; &#39;OMEGA radionavigation system&#39;,
    &#39;GPS&#39;  =&gt; &#39;Global Positioning Service&#39;,
    &#39;GOES&#39; =&gt; &#39;Geostationary Orbit Environment Satellite&#39;,
&#41;;

our %LEAP_INDICATOR = &#40;
    &#39;0&#39; =&gt; &#39;no warning&#39;,
    &#39;1&#39; =&gt; &#39;last minute has 61 seconds&#39;,
    &#39;2&#39; =&gt; &#39;last minute has 59 seconds&#41;&#39;,
    &#39;3&#39; =&gt; &#39;alarm condition &#40;clock not synchronized&#41;&#39;
&#41;;

use constant NTP_ADJ =&gt; 2208988800;

my @ntp_packet_fields = &#40;
    &#39;Leap Indicator&#39;,
    &#39;Version Number&#39;,
    &#39;Mode&#39;,
    &#39;Stratum&#39;,
    &#39;Poll Interval&#39;,
    &#39;Precision&#39;,
    &#39;Root Delay&#39;,
    &#39;Root Dispersion&#39;,
    &#39;Reference Clock Identifier&#39;,
    &#39;Reference Timestamp&#39;,
    &#39;Originate Timestamp&#39;,
    &#39;Receive Timestamp&#39;,
    &#39;Transmit Timestamp&#39;,
&#41;;

my $frac2bin = sub {
    my $bin  = &#39;&#39;;
    my $frac = shift;
    while &#40;length&#40;$bin&#41; &lt; 32&#41; {
        $bin = $bin . int&#40;$frac * 2&#41;;
        $frac = &#40;$frac * 2&#41; - &#40;int&#40;$frac * 2&#41;&#41;;
    }
    return $bin;
};

my $bin2frac = sub {
    my @bin = split &#39;&#39;, shift;
    my $frac = 0;
    while &#40;@bin&#41; {
        $frac = &#40;$frac + pop @bin&#41; / 2;
    }
    return $frac;
};

my $percision = sub {
    my $number = shift;
    if &#40;$number &gt; 127&#41; {
        $number -= 255;
    }
    return sprintf&#40;&#34;%1.4e&#34;, 2**$number&#41;;
};

my $unpack_ip = sub {
    my $ip;
    my $stratum = shift;
    my $tmp_ip  = shift;
    if &#40;$stratum &lt; 2&#41; {
        $ip = unpack&#40;&#34;A4&#34;, pack&#40;&#34;H8&#34;, $tmp_ip&#41;&#41;;
    }
    else {
        $ip = sprintf&#40;&#34;%d.%d.%d.%d&#34;, unpack&#40;&#34;C4&#34;, pack&#40;&#34;H8&#34;, $tmp_ip&#41;&#41;&#41;;
    }
    return $ip;
};

sub get_ntp_response {
    use IO::Socket;
    use constant HAVE_SOCKET_INET6 =&gt; eval { require IO::Socket::INET6 };

    my $host = shift || &#39;localhost&#39;;
    my $port = shift || &#39;ntp&#39;;

    my %args = &#40;
        Proto    =&gt; &#39;udp&#39;,
        PeerHost =&gt; $host,
        PeerPort =&gt; $port
    &#41;;
    my $sock;
    # if &#40;HAVE_SOCKET_INET6&#41; {
    #     $sock = IO::Socket::INET6-&gt;new&#40;%args&#41;;
    # }
    # else {
        $sock = IO::Socket::INET-&gt;new&#40;%args&#41;;
 #   }
    die $@ unless $sock;

    my %tmp_pkt;
    my %packet;
    my $data;

    my $client_localtime      = time;
    my $client_adj_localtime  = $client_localtime + NTP_ADJ;
    my $client_frac_localtime = $frac2bin-&gt;&#40;$client_adj_localtime&#41;;

    my $ntp_msg =
      pack&#40;&#34;B8 C3 N10 B32&#34;, &#39;00011011&#39;, &#40;0&#41; x 12, int&#40;$client_localtime&#41;, $client_frac_localtime&#41;;

    $sock-&gt;send&#40;$ntp_msg&#41;
      or die &#34;send&#40;&#41; failed: $!\n&#34;;

    eval {
        local $SIG{ALRM} = sub { die &#34;Net::NTP timed out geting NTP packet\n&#34;; };
        alarm&#40;$TIMEOUT&#41;;
        $sock-&gt;recv&#40;$data, 960&#41;
          or die &#34;recv&#40;&#41; failed: $!\n&#34;;
        alarm&#40;0&#41;;
    };

    if &#40;$@&#41; {
        die &#34;$@&#34;;
    }

    my @ntp_fields = qw/byte1 stratum poll precision/;
    push @ntp_fields, qw/delay delay_fb disp disp_fb ident/;
    push @ntp_fields, qw/ref_time ref_time_fb/;
    push @ntp_fields, qw/org_time org_time_fb/;
    push @ntp_fields, qw/recv_time recv_time_fb/;
    push @ntp_fields, qw/trans_time trans_time_fb/;

    @tmp_pkt{@ntp_fields} = unpack&#40;&#34;a C3   n B16 n B16 H8   N B32 N B32   N B32 N B32&#34;, $data&#41;;

    @packet{@ntp_packet_fields} = &#40;
        &#40;unpack&#40;&#34;C&#34;, $tmp_pkt{byte1} &#38; &#34;\xC0&#34;&#41; &gt;&gt; 6&#41;,
        &#40;unpack&#40;&#34;C&#34;, $tmp_pkt{byte1} &#38; &#34;\x38&#34;&#41; &gt;&gt; 3&#41;,
        &#40;unpack&#40;&#34;C&#34;, $tmp_pkt{byte1} &#38; &#34;\x07&#34;&#41;&#41;,
        $tmp_pkt{stratum},
        &#40;sprintf&#40;&#34;%0.4f&#34;, $tmp_pkt{poll}&#41;&#41;,
        $tmp_pkt{precision} - 255,
        &#40;$bin2frac-&gt;&#40;$tmp_pkt{delay_fb}&#41;&#41;,
        &#40;sprintf&#40;&#34;%0.4f&#34;, $tmp_pkt{disp}&#41;&#41;,
        $unpack_ip-&gt;&#40;$tmp_pkt{stratum}, $tmp_pkt{ident}&#41;,
        &#40;&#40;$tmp_pkt{ref_time}   += $bin2frac-&gt;&#40;$tmp_pkt{ref_time_fb}&#41;&#41;   -= NTP_ADJ&#41;,
        &#40;&#40;$tmp_pkt{org_time}   += $bin2frac-&gt;&#40;$tmp_pkt{org_time_fb}&#41;&#41;&#41;,
        &#40;&#40;$tmp_pkt{recv_time}  += $bin2frac-&gt;&#40;$tmp_pkt{recv_time_fb}&#41;&#41;  -= NTP_ADJ&#41;,
        &#40;&#40;$tmp_pkt{trans_time} += $bin2frac-&gt;&#40;$tmp_pkt{trans_time_fb}&#41;&#41; -= NTP_ADJ&#41;
    &#41;;

    return %packet;
}


1;
__END__

=head1 NAME

Net::NTP - Perl extension for decoding NTP server responses

=head1 SYNOPSIS

  use Net::NTP qw&#40;get_ntp_response&#41;;
  my %response = get_ntp_response&#40;&#41;;

=head1 ABSTRACT

All this module does is send a packet to an NTP server and then decode
the packet recieved into it&#39;s respective parts - as outlined in
RFC1305 and RFC2030.

=head1 DESCRIPTION

This module exports a single method &#40;get_ntp_response&#41; and returns an
associative array based upon RFC1305 and RFC2030.  The response from
the server is &#34;humanized&#34; to a point that further processing of th
information recieved from the server can be manipulated.  For example:
timestamps are in epoch, so one could use the localtime function to
produce an even more &#34;human&#34; representation of the timestamp.

=head2 EXPORT

get_ntp_response&#40;&lt;server&gt;, &lt;port&gt;&#41;;

This module exports a single method - get_ntp_response.  It takes the
server as the first argument &#40;localhost is the default&#41; and port to
send/recieve the packets &#40;ntp or 123 bu default&#41;.  It returns an
associative array of the various parts of the packet as outlined in
RFC1305.  It &#34;normalizes&#34; or &#34;humanizes&#34; various parts of the packet.
For example: all the timestamps are in epoch, NOT hexidecimal.

=head1 SEE ALSO

perl, IO::Socket, RFC1305, RFC2030

=head1 AUTHOR

Now maintained by Ask BjÃ¸rn Hansen, E&lt;lt&gt;ask@develooper.com&lt;gt&gt;

Originally by James G. Willmore, E&lt;lt&gt;jwillmore &#40;at&#41; adelphia.net&lt;gt&gt;
or E&lt;lt&gt;owner &#40;at&#41; ljcomputing.net&lt;gt&gt;

Special thanks to Ralf D. Kloth E&lt;lt&gt;ralf &#40;at&#41; qrq.de&lt;gt&gt; for the code
to decode NTP packets.

=head1 COPYRIGHT AND LICENSE

Copyright 2009 by Ask BjÃ¸rn Hansen; 2004 by James G. Willmore

This library is free software; you can redistribute it and/or modify
it under the same terms as Perl itself. 

=cut
</div></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.676845</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
