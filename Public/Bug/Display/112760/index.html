<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #112760 for CHI-Driver-Redis: Key listing set is never cleaned</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #112760 for CHI-Driver-Redis: Key listing set is never cleaned</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/CHI-Driver-Redis/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/CHI-Driver-Redis/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/CHI-Driver-Redis/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/CHI-Driver-Redis/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/CHI-Driver-Redis">CHI-Driver-Redis CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">112760</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/CHI-Driver-Redis/Active/">CHI-Driver-Redis</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">ianburrell [...] gmail.com
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jsemaan [...] inverse.ca

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-229656-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-229657-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;07&nbsp;10:12:51&nbsp;2016</span>
    <span class="description">jsemaan [...] inverse.ca -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Key listing set is never cleaned</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 7 Mar 2016 10:12:44 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CHI-Driver-Redis [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Julien Semaan &lt;jsemaan [...] inverse.ca&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi all,

I am an engineer part of the PacketFence project 
&#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://packetfence.org">http://packetfence.org</a></span>&#41; and we have been using your driver actively for 
a few months.

We have discovered that there is a leak in the library that causes the 
key listing sets for a namespace to never be cleaned up.

When we look at the code, an expiry is placed on the key/value that is 
stored but there is no expiration mechanism in place for the entry that 
is added to the key listing set.

Here is the problematic part :

     $self-&gt;redis-&gt;sadd&#40;$self-&gt;prefix . &#39;chinamespaces&#39;, $self-&gt;namespace&#41;;
     $self-&gt;redis-&gt;sadd&#40;$ns, $skey&#41;;
     $self-&gt;redis-&gt;set&#40;$realkey, $data&#41;;

     if &#40;defined&#40;$expires_in&#41;&#41; {
         $self-&gt;redis-&gt;expire&#40;$realkey, $expires_in&#41;;
     }


Now, this causes major issues on our end since a lot of our keys are 
temporary so the key set grows rapidly and causes excessive memory usage.

Before we try to fix it on our side, we would like to know what you be 
the approach from your side to ensure the key listing doesn&#39;t leak.

Would using the SCAN method of redis be a good idea in your opinion ?
That has the downside of not having the usual redis guarantee of having 
the latest data since it is non-locking.

Cheers !

-- 
Julien Semaan
jsemaan@inverse.ca   ::  +1 &#40;866&#41; 353-6153 *155  ::www.inverse.ca
Inverse inc. :: Leaders behind SOGo &#40;www.sogo.nu&#41; and PacketFence &#40;www.packetfence.org&#41;
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;08&nbsp;13:38:37&nbsp;2016</span>
    <span class="description">ianburrell [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">It sounds like expiring members of set in Redis is a common problem. I found a few pages about different approaches:

<span class="clickylink"><a target="new" rel="nofollow" href="https://quickleft.com/blog/how-to-create-and-expire-list-items-in-redis/">https://quickleft.com/blog/how-to-create-and-expire-list-items-in-redis/</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/antirez/redis/issues/135">https://github.com/antirez/redis/issues/135</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="https://groups.google.com/forum/#!topic/redis-db/rXXMCLNkNSs">https://groups.google.com/forum/#!topic/redis-db/rXXMCLNkNSs</a></span>

The main suggested approach is to use sorted set with expiration time as score, ZRANGEBYSCORE to retrieve unexpired elements, and ZREMRANGEBYSCORE to expire elements.

It looks like there is a purge&#40;&#41; method in CHI for doing the expiration. Would it work for you to call purge&#40;&#41; regularly? We could implement a more efficient purge&#40;&#41; that handles the Redis keys expiring.

I wonder if it would be possible to set expiration on the set to the latest expiration time and then the set of keys will expire if all keys expire. But I&#39;m guessing that doesn&#39;t happen for you.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;08&nbsp;13:38:37&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;08&nbsp;13:38:39&nbsp;2016</span>
    <span class="description">ianburrell [...] gmail.com -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;08&nbsp;13:58:37&nbsp;2016</span>
    <span class="description">jsemaan [...] inverse.ca -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #112760] Key listing set is never cleaned</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 8 Mar 2016 13:58:23 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CHI-Driver-Redis [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Julien Semaan &lt;jsemaan [...] inverse.ca&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The scoring approach you define does seem like it will require a daemon 
maintaining this or will create latency on reads.

We used to use the purge method when we used the file store but it 
involves code paths that we do not want to maintain anymore since one of 
the reasons we moved to redis was the auto expiry of keys.

You are right that we never have all keys expiring so that cannot be 
used to expire the set on our side

I opened a PR that uses SCAN for listing earlier today : 
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/rentrak/chi-driver-redis/pull/7">https://github.com/rentrak/chi-driver-redis/pull/7</a></span>

It obviously has downsides that you may not want to have in the library, 
but in our case the leak problem is bigger than the downsides we have 
with this new strategy as we do not list keys often.

We are about to test this under a heavy load to comfort the design, but 
still as I said, we do not use listing extensively so we&#39;re a soft 
use-case for that change.

Regards,

On 03/08/2016 01:38 PM, Ian Burrell via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112760">https://rt.cpan.org/Ticket/Display.html?id=112760</a></span> &gt;
&gt;
&gt; It sounds like expiring members of set in Redis is a common problem. I found a few pages about different approaches:
&gt;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://quickleft.com/blog/how-to-create-and-expire-list-items-in-redis/">https://quickleft.com/blog/how-to-create-and-expire-list-items-in-redis/</a></span>
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/antirez/redis/issues/135">https://github.com/antirez/redis/issues/135</a></span>
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://groups.google.com/forum/#!topic/redis-db/rXXMCLNkNSs">https://groups.google.com/forum/#!topic/redis-db/rXXMCLNkNSs</a></span>
&gt;
&gt; The main suggested approach is to use sorted set with expiration time as score, ZRANGEBYSCORE to retrieve unexpired elements, and ZREMRANGEBYSCORE to expire elements.
&gt;
&gt; It looks like there is a purge&#40;&#41; method in CHI for doing the expiration. Would it work for you to call purge&#40;&#41; regularly? We could implement a more efficient purge&#40;&#41; that handles the Redis keys expiring.
&gt;
&gt; I wonder if it would be possible to set expiration on the set to the latest expiration time and then the set of keys will expire if all keys expire. But I&#39;m guessing that doesn&#39;t happen for you.
&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;31&nbsp;03:01:55&nbsp;2016</span>
    <span class="description">ATANCASIS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Ian,

I&#39;ve extended CHI::Driver::Redis and implemented the main approach of the fixes you&#39;ve mentioned on your previous message —by keeping inventory on a sorted set in contrast to a set as there would otherwise be no way to discern which keys have already expired.

For the meantime, I&#39;ve released this modification as a separate module under CHI::Driver::Redis::SortedSet &lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/pod/CHI::Driver::Redis::SortedSet">https://metacpan.org/pod/CHI::Driver::Redis::SortedSet</a></span>&gt; but would like to check if you&#39;d be interested to incorporate the modifications I&#39;ve made into your module so the community does not to have to deal with multiple drivers which would essentially be doing the same thing.

Some implementation notes BTW:

1. Upon calling store&#40;&#41;, instead of adding to a set to keep track of namespace members, the same key is added to a sorted set with the score set to either:
  a. IF key has a finite expiration — now + $expires_at
  b. ELSE — &#34;+inf&#34; &#40;as key will never expire&#41;

2. Likewise, when store&#40;&#41; gets called, &#34;cleanup&#34; of expired keys via ZREMRANGEBYSCORE is executed. This can be costly for sparsely-used namespaces with blasts in between as the number of expired entries can be huge. That said, I still would not imagine this would have huge costs as sorted sets are automatically &#34;house-kept&#34; with every usage.

3. chinamespaces is still left intact as a set &#40;and not migrated as a sorted set&#41; as this should not be a concern either way. However, if it did, the same strategy can be applied.

4. For existing Redis datasets pre-populated with entries using CHI::Driver::Redis, switching the driver to using the new one will fail &#40;albeit silently as one of the design goals of the original module&#41; as the namespace inventory list data type is now different. A transparent &#34;migration&#34; schema should not be too difficult to implement as it will only involve:
  a. check if TYPE &#34;&lt;ns&gt;&#34; eq &#34;zset&#34;, if it is, no-op &#40;i.e. bail-out&#41;
  b. foreach SMEMBERS, ZADD to &#34;&lt;ns_temp&gt;&#34;, with SCORE = now + TTL
  c. DEL &#34;&lt;ns&gt;&#34;
  d. RENAME &#34;&lt;ns_temp&gt;&#34; to &#34;&lt;ns&gt;&#34;

I hope this provides an outline of my thoughts. Looking forward to hearing from you.

Cheers,
Arnold

On Tue Mar 08 13:58:37 2016, jsemaan@inverse.ca wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The scoring approach you define does seem like it will require a
&gt; daemon
&gt; maintaining this or will create latency on reads.
&gt; 
&gt; We used to use the purge method when we used the file store but it
&gt; involves code paths that we do not want to maintain anymore since one
&gt; of
&gt; the reasons we moved to redis was the auto expiry of keys.
&gt; 
&gt; You are right that we never have all keys expiring so that cannot be
&gt; used to expire the set on our side
&gt; 
&gt; I opened a PR that uses SCAN for listing earlier today :
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/rentrak/chi-driver-redis/pull/7">https://github.com/rentrak/chi-driver-redis/pull/7</a></span>
&gt; 
&gt; It obviously has downsides that you may not want to have in the
&gt; library,
&gt; but in our case the leak problem is bigger than the downsides we have
&gt; with this new strategy as we do not list keys often.
&gt; 
&gt; We are about to test this under a heavy load to comfort the design,
&gt; but
&gt; still as I said, we do not use listing extensively so we&#39;re a soft
&gt; use-case for that change.
&gt; 
&gt; Regards,
&gt; 
&gt; On 03/08/2016 01:38 PM, Ian Burrell via RT wrote:
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112760">https://rt.cpan.org/Ticket/Display.html?id=112760</a></span> &gt;
&gt; &gt;
&gt; &gt; It sounds like expiring members of set in Redis is a common problem.
&gt; &gt; I found a few pages about different approaches:
&gt; &gt;
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://quickleft.com/blog/how-to-create-and-expire-list-items-in-">https://quickleft.com/blog/how-to-create-and-expire-list-items-in-</a></span>
&gt; &gt; redis/
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/antirez/redis/issues/135">https://github.com/antirez/redis/issues/135</a></span>
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://groups.google.com/forum/#!topic/redis-db/rXXMCLNkNSs">https://groups.google.com/forum/#!topic/redis-db/rXXMCLNkNSs</a></span>
&gt; &gt;
&gt; &gt; The main suggested approach is to use sorted set with expiration time
&gt; &gt; as score, ZRANGEBYSCORE to retrieve unexpired elements, and
&gt; &gt; ZREMRANGEBYSCORE to expire elements.
&gt; &gt;
&gt; &gt; It looks like there is a purge&#40;&#41; method in CHI for doing the
&gt; &gt; expiration. Would it work for you to call purge&#40;&#41; regularly? We could
&gt; &gt; implement a more efficient purge&#40;&#41; that handles the Redis keys
&gt; &gt; expiring.
&gt; &gt;
&gt; &gt; I wonder if it would be possible to set expiration on the set to the
&gt; &gt; latest expiration time and then the set of keys will expire if all
&gt; &gt; keys expire. But I&#39;m guessing that doesn&#39;t happen for you.
&gt; &gt;
&gt; &gt;
</div></div></div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
