<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #79947 for Perl-Tidy: Enhancement: Have &#34;cuddled-else&#34; logic applied to try/catch/finally blocks</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #79947 for Perl-Tidy: Enhancement: Have &#34;cuddled-else&#34; logic applied to try/catch/finally blocks</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Perl-Tidy/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Perl-Tidy/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Perl-Tidy/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Perl-Tidy/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Perl-Tidy">Perl-Tidy CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">79947</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Perl-Tidy/Active/">Perl-Tidy</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
rjray [...] blackperl.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-25260-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
20120714    </td>
  </tr>
  <tr id="CF-25261-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




t.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1124978/591830/t.pl">
Mon Oct 01 13:50:51 2012 (286b) by rjray [...] blackperl.com
</a>
</font></li>
</ul>


t.pl.tdy<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1124978/591829/t.pl.tdy">
Mon Oct 01 13:50:51 2012 (294b) by rjray [...] blackperl.com
</a>
</font></li>
</ul>


t.pl.tdy2<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1124978/591831/t.pl.tdy2">
Mon Oct 01 13:50:51 2012 (286b) by rjray [...] blackperl.com
</a>
</font></li>
</ul>


test.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1621610/868437/test.pl">
Thu Apr 28 03:44:02 2016 (363b) by http://mrakobes86reg.id.bk.ru/
</a>
</font></li>
</ul>


try.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1621607/868432/try.diff">
Thu Apr 28 03:43:30 2016 (1.4k) by http://mrakobes86reg.id.bk.ru/
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;01&nbsp;13:50:51&nbsp;2012</span>
    <span class="description">rjray [...] blackperl.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Enhancement: Have &#34;cuddled-else&#34; logic applied to try/catch/finally
 blocks</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Currently, try/catch/finally blocks are not recognized the way
if/elsif/else blocks are, and lead to inconsistent line-breaks when
--cuddled-else is set. It would be nice if they were cuddled as well.
See the attached files: first file &#40;t.pl&#41; is a short example with both an
if-block and a try-block. Second file &#40;t.pl.tdy&#41; is what it currently
looks like after perltidy. Third file &#40;t.pl.tdy2&#41; is what I think it
should look like.

This could be tricky, as there are competing exception-handling packages
on CPAN, some with slightly different syntax. Try::Tiny, for example,
does not take a class name after &#34;catch&#34;, and only offers
try/catch/finally. Error, in contrast, takes a class name after &#34;catch&#34;,
and offers try, catch, except, otherwise and finally.

Randy
-- 
Randy J. Ray
rjray@blackperl.com
randy.j.ray@gmail.com
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> t.pl.tdy</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1124978/591829/t.pl.tdy">Download t.pl.tdy</a><br />
<span class="downloadcontenttype">application/octet-stream 294b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> t.pl</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/env perl

use strict;
use warnings;

use Error qw&#40;:try&#41;;

sub foo {
    if &#40;1&#41; {
        do_something&#40;&#41;;
    } else {
        do_something_else&#40;&#41;;
    }

    try {
        something&#40;&#41;;
    } catch Error with {
        something_else&#40;&#41;;
    } finally {
        foo&#40;&#41;;
    }
}
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> t.pl.tdy2</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1124978/591831/t.pl.tdy2">Download t.pl.tdy2</a><br />
<span class="downloadcontenttype">application/octet-stream 286b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;02&nbsp;09:27:56&nbsp;2012</span>
    <span class="description">perltidy [...] users.sourceforge.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #79947] Enhancement: Have &#34;cuddled-else&#34; logic applied to try/catch/finally blocks</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 2 Oct 2012 06:27:37 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Perl-Tidy [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Steven Hancock &lt;perltidy [...] users.sourceforge.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Randy,
Thanks, I&#39;ll look at it.
Steve

On Mon, Oct 1, 2012 at 10:50 AM, Randy J Ray via RT &lt;
bug-Perl-Tidy@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Mon Oct 01 13:50:51 2012: Request 79947 was acted upon.
&gt; Transaction: Ticket created by RJRAY
&gt;        Queue: Perl-Tidy
&gt;      Subject: Enhancement: Have &#34;cuddled-else&#34; logic applied to
&gt; try/catch/finally
&gt;  blocks
&gt;    Broken in: 20120714
&gt;     Severity: Wishlist
&gt;        Owner: Nobody
&gt;   Requestors: rjray@blackperl.com
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=79947">https://rt.cpan.org/Ticket/Display.html?id=79947</a></span> &gt;
&gt;
&gt;
&gt; Currently, try/catch/finally blocks are not recognized the way
&gt; if/elsif/else blocks are, and lead to inconsistent line-breaks when
&gt; --cuddled-else is set. It would be nice if they were cuddled as well.
&gt; See the attached files: first file &#40;t.pl&#41; is a short example with both an
&gt; if-block and a try-block. Second file &#40;t.pl.tdy&#41; is what it currently
&gt; looks like after perltidy. Third file &#40;t.pl.tdy2&#41; is what I think it
&gt; should look like.
&gt;
&gt; This could be tricky, as there are competing exception-handling packages
&gt; on CPAN, some with slightly different syntax. Try::Tiny, for example,
&gt; does not take a class name after &#34;catch&#34;, and only offers
&gt; try/catch/finally. Error, in contrast, takes a class name after &#34;catch&#34;,
&gt; and offers try, catch, except, otherwise and finally.
&gt;
&gt; Randy
&gt; --
&gt; Randy J. Ray
&gt; rjray@blackperl.com
&gt; randy.j.ray@gmail.com
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;02&nbsp;09:27:57&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;24&nbsp;08:48:57&nbsp;2013</span>
    <span class="description">https://www.google.com/accounts/o8/id?id=AItOawmSSCjjx7I2uPMLoIeXvfQApVJLH31fZIs -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ulrik.mikaelsson [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Any progress on this?

AFAICT, the original example is a bit flawed.

Correct usage of the Error module is

try {
  do_some_stuff&#40;&#41;;
} catch IO::Error with {
  # Oh noes!
} finally {
  # Oh well
}; &lt;- semi-colon crucial or anything can happen

Perltidy seems to handle this correctly.

HOWEVER; The Error CPAN-module is no longer recommended, due to bugs in corner-cases. Recommended modules are now instead, for example TryCatch &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/perldoc?TryCatch&#41;">http://search.cpan.org/perldoc?TryCatch&#41;</a></span>

TryCatch does not expect the semi-colon and breaks with Perltidy.

On Tue Oct 02 09:27:56 2012, SHANCOCK wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Randy,
&gt; Thanks, I&#39;ll look at it.
&gt; Steve
&gt; 
&gt; On Mon, Oct 1, 2012 at 10:50 AM, Randy J Ray via RT &lt;
&gt; bug-Perl-Tidy@rt.cpan.org&gt; wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; Mon Oct 01 13:50:51 2012: Request 79947 was acted upon.
&gt; &gt; Transaction: Ticket created by RJRAY
&gt; &gt;        Queue: Perl-Tidy
&gt; &gt;      Subject: Enhancement: Have &#34;cuddled-else&#34; logic applied to
&gt; &gt; try/catch/finally
&gt; &gt;  blocks
&gt; &gt;    Broken in: 20120714
&gt; &gt;     Severity: Wishlist
&gt; &gt;        Owner: Nobody
&gt; &gt;   Requestors: rjray@blackperl.com
&gt; &gt;       Status: new
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=79947">https://rt.cpan.org/Ticket/Display.html?id=79947</a></span> &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; Currently, try/catch/finally blocks are not recognized the way
&gt; &gt; if/elsif/else blocks are, and lead to inconsistent line-breaks when
&gt; &gt; --cuddled-else is set. It would be nice if they were cuddled as well.
&gt; &gt; See the attached files: first file &#40;t.pl&#41; is a short example with both an
&gt; &gt; if-block and a try-block. Second file &#40;t.pl.tdy&#41; is what it currently
&gt; &gt; looks like after perltidy. Third file &#40;t.pl.tdy2&#41; is what I think it
&gt; &gt; should look like.
&gt; &gt;
&gt; &gt; This could be tricky, as there are competing exception-handling packages
&gt; &gt; on CPAN, some with slightly different syntax. Try::Tiny, for example,
&gt; &gt; does not take a class name after &#34;catch&#34;, and only offers
&gt; &gt; try/catch/finally. Error, in contrast, takes a class name after &#34;catch&#34;,
&gt; &gt; and offers try, catch, except, otherwise and finally.
&gt; &gt;
&gt; &gt; Randy
&gt; &gt; --
&gt; &gt; Randy J. Ray
&gt; &gt; rjray@blackperl.com
&gt; &gt; randy.j.ray@gmail.com
&gt; &gt;
</div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;23&nbsp;12:38:38&nbsp;2016</span>
    <span class="description">DRZIGMAN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Greetings,

I just bumped into this when using TryCatch and perltidy.

Sample Code Block:

try {
    croak &#34;An Error!&#34;;
}
catch &#40; $error &#41; {
    print STDERR $error . &#34;\n&#34;;
}

The error generated by perltidy was:
31:     syntax error at &#39;&#41; {&#39;, didn&#39;t see one of: case elsif for foreach given if switch unless until when while

I fixed this by making a minor change to %is_blocktype_with_paren in Perl/Tidy.pm &#40;version 20150815&#41;
Line 4110

Before:
@_ = qw&#40;if elsif unless while until for foreach switch case given when&#41;;

After:
@_ = qw&#40;if elsif unless while until for foreach switch case given when catch&#41;;

Hopefully this is something that can be included in the next update, I&#39;d welcome any feedback.

Thanks!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;23&nbsp;13:51:07&nbsp;2016</span>
    <span class="description">perltidy [...] users.sourceforge.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #79947] Enhancement: Have &#34;cuddled-else&#34; logic applied to try/catch/finally blocks</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 23 Feb 2016 10:50:55 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Perl-Tidy [...] rt.cpan.org&#34; &lt;bug-Perl-Tidy [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Steven Hancock &lt;perltidy [...] users.sourceforge.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks, it will be fixed in the next version.
Steve

On Tue, Feb 23, 2016 at 9:38 AM, Robert Stone via RT &lt;
bug-Perl-Tidy@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Perl-Tidy
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=79947">https://rt.cpan.org/Ticket/Display.html?id=79947</a></span> &gt;
&gt;
&gt; Greetings,
&gt;
&gt; I just bumped into this when using TryCatch and perltidy.
&gt;
&gt; Sample Code Block:
&gt;
&gt; try {
&gt;     croak &#34;An Error!&#34;;
&gt; }
&gt; catch &#40; $error &#41; {
&gt;     print STDERR $error . &#34;\n&#34;;
&gt; }
&gt;
&gt; The error generated by perltidy was:
&gt; 31:     syntax error at &#39;&#41; {&#39;, didn&#39;t see one of: case elsif for foreach
&gt; given if switch unless until when while
&gt;
&gt; I fixed this by making a minor change to %is_blocktype_with_paren in
&gt; Perl/Tidy.pm &#40;version 20150815&#41;
&gt; Line 4110
&gt;
&gt; Before:
&gt; @_ = qw&#40;if elsif unless while until for foreach switch case given when&#41;;
&gt;
&gt; After:
&gt; @_ = qw&#40;if elsif unless while until for foreach switch case given when
&gt; catch&#41;;
&gt;
&gt; Hopefully this is something that can be included in the next update, I&#39;d
&gt; welcome any feedback.
&gt;
&gt; Thanks!
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;27&nbsp;12:58:51&nbsp;2016</span>
    <span class="description">perltidy [...] users.sourceforge.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is fixed in version 20160301

On Tue Feb 23 13:51:07 2016, SHANCOCK wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks, it will be fixed in the next version.
&gt; Steve
&gt; 
&gt; On Tue, Feb 23, 2016 at 9:38 AM, Robert Stone via RT &lt;
&gt; bug-Perl-Tidy@rt.cpan.org&gt; wrote:
&gt; 
<div class="message-stanza open">&gt; &gt;        Queue: Perl-Tidy
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=79947">https://rt.cpan.org/Ticket/Display.html?id=79947</a></span> &gt;
</div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;28&nbsp;03:33:24&nbsp;2016</span>
    <span class="description">http://mrakobes86reg.id.bk.ru/ -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> qsimpleq</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">additional fixes:

add catch to default keywords for which space is introduced before an opening paren

add catch to block types may have text between the keyword and opening curly

Суб Фев 27 12:58:51 2016, SHANCOCK писал:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This is fixed in version 20160301
&gt; 
&gt; On Tue Feb 23 13:51:07 2016, SHANCOCK wrote:
<div class="message-stanza open">&gt; &gt; Thanks, it will be fixed in the next version.
&gt; &gt; Steve
&gt; &gt; 
&gt; &gt; On Tue, Feb 23, 2016 at 9:38 AM, Robert Stone via RT &lt;
&gt; &gt; bug-Perl-Tidy@rt.cpan.org&gt; wrote:
&gt; &gt; 
<div class="message-stanza open">&gt; &gt; &gt;        Queue: Perl-Tidy
&gt; &gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=79947">https://rt.cpan.org/Ticket/Display.html?id=79947</a></span> &gt;
</div></div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;28&nbsp;03:42:20&nbsp;2016</span>
    <span class="description">http://mrakobes86reg.id.bk.ru/ -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> qsimpleq</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">add files

Чтв Апр 28 03:33:24 2016, <span class="clickylink"><a target="new" rel="nofollow" href="http://mrakobes86reg.id.bk.ru/">http://mrakobes86reg.id.bk.ru/</a></span> писал:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; additional fixes:
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;28&nbsp;03:43:30&nbsp;2016</span>
    <span class="description">http://mrakobes86reg.id.bk.ru/ -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> qsimpleq</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> try.diff</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- Tidy.pm_old	2016-03-01 19:46:22.000000000 +0500
+++ Tidy.pm	2016-04-28 12:18:27.857379362 +0500
@@ -7718,7 +7718,7 @@
     # default keywords for which space is introduced before an opening paren
     # &#40;at present, including them messes up vertical alignment&#41;
     @_ = qw&#40;my local our and or err eq ne if else elsif until
-      unless while for foreach return switch case given when&#41;;
+      unless while for foreach return switch case given when catch&#41;;
     @space_after_keyword{@_} = &#40;1&#41; x scalar&#40;@_&#41;;
 
     # first remove any or all of these if desired
@@ -11773,7 +11773,7 @@
         # curly.  Note: &#39;else&#39; does not, but must be included to allow trailing
         # if/elsif text to be appended.
         # patch for SWITCH/CASE: added &#39;case&#39; and &#39;when&#39;
-        @_ = qw&#40;if elsif else unless while until for foreach case when&#41;;
+        @_ = qw&#40;if elsif else unless while until for foreach case when catch&#41;;
         @is_if_elsif_else_unless_while_until_for_foreach{@_} =
           &#40;1&#41; x scalar&#40;@_&#41;;
     }
@@ -30007,7 +30007,7 @@
     @_ =
       qw&#40; BEGIN END CHECK INIT AUTOLOAD DESTROY UNITCHECK continue if elsif else
       unless do while until eval for foreach map grep sort
-      switch case given when catch&#41;;
+      switch case given when catch try finally&#41;;
     @is_code_block_token{@_} = &#40;1&#41; x scalar&#40;@_&#41;;
 
     # I&#39;ll build the list of keywords incrementally
@@ -30236,6 +30236,8 @@
       when
       err
       say
+
+      catch
     &#41;;
 
     # patched above for SWITCH/CASE given/when err say
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;28&nbsp;03:44:02&nbsp;2016</span>
    <span class="description">http://mrakobes86reg.id.bk.ru/ -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> qsimpleq</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> test.pl</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/env perl

use strict;
use warnings;

use Error qw&#40;:try&#41;;

sub foo {
    if &#40;1&#41; {
        do_something&#40;&#41;;
    }
    else {
        do_something_else&#40;&#41;;
    }

    try { something&#40;&#41;; }
catch
 Error
 with {
 something_else&#40;&#41;; }
    finally { foo&#40;&#41;; 
};
}

try { croak &#34;An Error ёбаный стыд!&#34;; }
catch&#40;$error&#41; {    print STDERR $error . &#34;\n&#34;;};

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;08&nbsp;17:01:37&nbsp;2018</span>
    <span class="description">todd_richmond [...] hotmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> todd_richmond [...] hotmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I see some attempts made to add try/catch work, but the simplest test case is still failing with 20180101. I noticed a few places in the code that have special handling for else cudling that are not replicated for catch, but adding another case did not seem to help
Any progress on this?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;10&nbsp;10:21:39&nbsp;2018</span>
    <span class="description">s7078hancock [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #79947] Enhancement: Have &#34;cuddled-else&#34; logic applied to try/catch/finally blocks</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 10 Feb 2018 07:21:27 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Perl-Tidy [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Steven Hancock &lt;s7078hancock [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Todd,
I&#39;ve included all patches received, but this is has been low priority for a
couple of reasons.  One is that supporting a variety of syntaxes is an
open-ended problem, especially when function calls are made without args in
parens.  This can lead to an endless cycle of code patches unless great
care is taken in any implementation. Another is that modifying the existing
cuddled-else coding would be very difficult &#40;really almost impossible to do
without creating a bug&#41;.

However, I have been thinking that it may be possible to generalize the
recent &#39;weld&#39; option &#40;-wn&#41;.  This option, which causes nearby opening
container tokens and associated closing tokens to behave as one unit, might
be generalized to also &#34;weld&#34; selected closing and opening braces together
to achieve a cuddled-else format.  This feature works on top of perltidy,
so this avoids modifying the existing code.  It works by locating the
sections of code which should not be broken and passing this information to
the formatter.  It could be modified to also search for pairs of closing
and opening block braces and &#39;weld&#39; them together, so that they do not get
separated and thus become cuddled.

There would also need to be a flag specifying what block types should be
welded in this fashion.
So the idea would be to have two flags, one turning cuddling on and off,
and the other specifying the block types.  Specifying block types might be
done for example by giving a dash separated list, such as &#39;if-elsif-else&#39;
or &#39;try-catch-finally&#39; or in general
&#39;someword1-someword2-someword3-someword4&#39;;

This seems like a promising approach, but I need to do some research before
working on an implementation.
Steve

On Thu, Feb 8, 2018 at 2:01 PM, todd_richmond@hotmail.com via RT &lt;
bug-Perl-Tidy@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Perl-Tidy
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=79947">https://rt.cpan.org/Ticket/Display.html?id=79947</a></span> &gt;
&gt;
&gt; I see some attempts made to add try/catch work, but the simplest test case
&gt; is still failing with 20180101. I noticed a few places in the code that
&gt; have special handling for else cudling that are not replicated for catch,
&gt; but adding another case did not seem to help
&gt; Any progress on this?
&gt;
&gt;
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;18&nbsp;14:47:10&nbsp;2018</span>
    <span class="description">perltidy [...] users.sourceforge.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The -cb option in version 20180219 gives cuddled-else type formatting for try/catch/finally blocks
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;18&nbsp;14:47:11&nbsp;2018</span>
    <span class="description">perltidy [...] users.sourceforge.net -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
