<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #5275 for GDGraph: [PATCH] Independent number formats for dual axes graphs &#40;y1_number_format, y2_number_format&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #5275 for GDGraph: [PATCH] Independent number formats for dual axes graphs &#40;y1_number_format, y2_number_format&#41;</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/GDGraph/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/GDGraph/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/GDGraph/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/GDGraph/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/GDGraph">GDGraph CPAN distribution</a>.</p>


<h3>Maintainer&#40;s&#41;&#39; notes</h3>

<p>There are plenty of good ideas of what people can do published here on the queue. Turning a patch from the tracker into a pull request is not one of them. In order to get maintainers' attention way more quickier, PR should have at least a sample included. We know it's hard to test images generating software, but it doesn't mean we can not test numbers produced by intermediate algorithms used to generate these images, so either a test or a sample.</p>



<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">5275</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/GDGraph/Active/">GDGraph</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">bwarfield [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
andrewo [...] oriel.com.au

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-14346-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.43    </td>
  </tr>
  <tr id="CF-14347-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.4305    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;10&nbsp;01:17:31&nbsp;2004</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [PATCH] Independent number formats for dual axes graphs
    &#40;y1_number_format, y2_number_format&#41;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This patch implements independent number formats for graphs with, for example, two y axes. It applies to GDGraph-1.43.

Small code modifications were made to Graph/axestype.pm and Graph.pm, documentation was added to Graph.pm and a new sample19 was created &#40;based on sample14&#41; to test this. This meant minor changes to MANIFEST and samples/Makefile as well.

Tested under perl 5.6.1.
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -rNu --exclude debian GDGraph-1.43.orig/Graph/axestype.pm GDGraph-1.43/Graph/axestype.pm
--- GDGraph-1.43.orig/Graph/axestype.pm	Tue Jul  1 15:04:10 2003
+++ GDGraph-1.43/Graph/axestype.pm	Tue Feb 10 16:52:33 2004
@@ -124,6 +124,8 @@
 
     # Format of the numbers on the x and y axis
     y_number_format         =&gt; undef,
+    y1_number_format        =&gt; undef,       # CONTRIB Andrew OBrien
+    y2_number_format        =&gt; undef,       # CONTRIB Andrew OBrien
     x_number_format         =&gt; undef,       # CONTRIB Scott Prahl
 
     # and some attributes without default values
@@ -728,11 +730,11 @@
             
             $self-&gt;{y_values}[$axis][$t] = $label;
 
-            if &#40;defined $self-&gt;{y_number_format}&#41;
+	    if &#40;my &#40;$fmt&#41; = grep defined, map&#40;$self-&gt;{&#34;y${_}_number_format&#34;},&#39;&#39;,$axis&#41;&#41;
             {
-                $label = ref $self-&gt;{y_number_format} eq &#39;CODE&#39; ?
-                    &#38;{$self-&gt;{y_number_format}}&#40;$label&#41; :
-                    sprintf&#40;$self-&gt;{y_number_format}, $label&#41;;
+                $label = ref $fmt eq &#39;CODE&#39; ?
+                    $fmt-&gt;&#40;$label&#41; :
+                    sprintf&#40;$fmt, $label&#41;;
             }
             
             $self-&gt;{gdta_y_axis}-&gt;set_text&#40;$label&#41;;
diff -rNu --exclude debian GDGraph-1.43.orig/Graph.pm GDGraph-1.43/Graph.pm
--- GDGraph-1.43.orig/Graph.pm	Tue Jul  1 15:02:10 2003
+++ GDGraph-1.43/Graph.pm	Tue Feb 10 16:52:33 2004
@@ -967,6 +967,17 @@
 
 Default: undef.
 
+=item y1_number_format, y2_number_format
+
+As for I&lt;y_number_format&gt; these can be either a string, or a reference
+to a subroutine. These are used as fallback formats for graphs with
+two y-axes scales so that independent formats can be used.
+
+For compatibility purposes if I&lt;y_number_format&gt; is specified at all
+it will I&lt;always&gt; take precedence on both axes.
+
+Default: undef for both.
+
 =item x_label_skip, y_label_skip
 
 Print every I&lt;x_label_skip&gt;th number under the tick on the x axis, and
diff -rNu --exclude debian GDGraph-1.43.orig/MANIFEST GDGraph-1.43/MANIFEST
--- GDGraph-1.43.orig/MANIFEST	Thu Jun 19 16:31:19 2003
+++ GDGraph-1.43/MANIFEST	Tue Feb 10 17:08:51 2004
@@ -34,6 +34,7 @@
 samples/sample16.pl
 samples/sample17.pl
 samples/sample18.pl
+samples/sample19.pl
 samples/sample21.pl
 samples/sample22.pl
 samples/sample23.pl
diff -rNu --exclude debian GDGraph-1.43.orig/samples/Makefile GDGraph-1.43/samples/Makefile
--- GDGraph-1.43.orig/samples/Makefile	Fri Jun 20 13:05:37 2003
+++ GDGraph-1.43/samples/Makefile	Tue Feb 10 16:52:33 2004
@@ -24,9 +24,9 @@
 
 SAMPLES :=  \
     sample11 sample12 sample13 sample14 sample15 \
-    sample16 sample17 sample18 \
+    sample16 sample17 sample18 sample19 \
     sample11-h sample12-h sample13-h sample14-h sample15-h \
-    sample16-h sample17-h sample18-h \
+    sample16-h sample17-h sample18-h sample19-h \
     sample21 sample22 sample23 \
     sample31 \
     sample41 sample42\
diff -rNu --exclude debian GDGraph-1.43.orig/samples/sample19.pl GDGraph-1.43/samples/sample19.pl
--- GDGraph-1.43.orig/samples/sample19.pl	Thu Jan  1 10:00:00 1970
+++ GDGraph-1.43/samples/sample19.pl	Tue Feb 10 16:52:33 2004
@@ -0,0 +1,97 @@
+use strict;
+use GD::Graph::bars;
+use GD::Graph::hbars;
+use GD::Graph::Data;
+require &#39;save.pl&#39;;
+
+$GD::Graph::Error::Debug = 5;
+
+my $data = GD::Graph::Data-&gt;new&#40;
+[
+    [&#34;2004/2/1&#34;,&#34;2004/2/2&#34;,&#34;2004/2/3&#34;,&#34;2004/2/4&#34;,&#34;2004/2/5&#34;,&#34;2004/2/6&#34;,&#34;2004/2/7&#34;, &#34;2004/2/8&#34;, &#34;2004/2/9&#34;],
+    [  50000, 120000, 240000, 330000, 190000,  80000,  60000, 150000, 210000],
+    [1033101,2200100,5300300,6400400,3192192,1600600, 900900,3333333,4444444],
+]
+&#41; or die GD::Graph::Data-&gt;error;
+
+my $values = $data-&gt;copy&#40;&#41;;
+$values-&gt;set_y&#40;1, 7, undef&#41; or warn $data-&gt;error;
+$values-&gt;set_y&#40;2, 7, undef&#41; or warn $data-&gt;error;
+
+my @names = qw/sample19 sample19-h/;
+
+for my $my_graph &#40;GD::Graph::bars-&gt;new&#40;600,400&#41;,
+		  GD::Graph::hbars-&gt;new&#40;600,400&#41;&#41;
+{
+    my $name = shift @names;
+    print STDERR &#34;Processing $name\n&#34;;
+
+    $my_graph-&gt;set&#40; 
+	x_label             =&gt; &#39;Date&#39;,
+	y1_label            =&gt; &#39;Hits&#39;,
+	y2_label            =&gt; &#39;Megabytes&#39;,
+	title               =&gt; &#39;Using two axes with different formats&#39;,
+	#y1_max_value        =&gt; 40,
+	#y2_max_value        =&gt; 8,
+	y_tick_number       =&gt; 8,
+	y_label_skip        =&gt; 2,
+        #y_number_format     =&gt; &#39;%d&#39;, ### &lt;-- this will override y{1,2}_number_format
+	y1_number_format    =&gt; sub { # from perlfaq5
+	  local $_ = shift;
+	  1 while s/^&#40;[-+]?\d+&#41;&#40;\d{3}&#41;/$1,$2/;
+	  $_;
+	},
+	y2_number_format    =&gt; sub { my $v = shift; sprintf&#40;&#34;%.2f&#34;,$v/1024&#41; },
+	long_ticks          =&gt; 1,
+	two_axes            =&gt; 1,
+	legend_placement    =&gt; &#39;RT&#39;,
+	x_label_position    =&gt; 1/2,
+
+	bgclr		    =&gt; &#39;white&#39;,
+	fgclr               =&gt; &#39;white&#39;,
+	boxclr              =&gt; &#39;dblue&#39;,
+	accentclr           =&gt; &#39;dblue&#39;,
+	valuesclr           =&gt; &#39;#ffff77&#39;,
+	dclrs               =&gt; [qw&#40;lgreen lred&#41;],
+
+	bar_spacing         =&gt; 1,
+
+	logo                =&gt; &#39;logo.&#39; . GD::Graph-&gt;export_format,
+	logo_position       =&gt; &#39;BR&#39;,
+
+	transparent         =&gt; 0,
+
+	l_margin            =&gt; 10,
+	b_margin            =&gt; 10,
+	r_margin            =&gt; 10,
+	t_margin            =&gt; 10,
+
+	show_values         =&gt; 1,
+	values_format       =&gt; &#34;%4.1f&#34;,
+
+    &#41; or warn $my_graph-&gt;error;
+
+    if &#40;$name =~ /-h$/&#41;
+    {
+      $my_graph-&gt;set&#40;x_labels_vertical =&gt; 0, values_vertical =&gt; 0&#41;;
+      $my_graph-&gt;set_legend&#40;&#39;bottom axis&#39;, &#39;top axis&#39;&#41;;
+    }
+    else
+    {
+      $my_graph-&gt;set&#40;x_labels_vertical =&gt; 1, values_vertical =&gt; 1&#41;;
+      $my_graph-&gt;set_legend&#40;&#39;left axis&#39;, &#39;right axis&#39;&#41;;
+    }
+
+    my $font_spec = &#34;../Dustismo_Sans&#34;;
+
+    $my_graph-&gt;set_y_label_font&#40;$font_spec, 12&#41;;
+    $my_graph-&gt;set_x_label_font&#40;$font_spec, 12&#41;;
+    $my_graph-&gt;set_y_axis_font&#40;$font_spec, 10&#41;;
+    $my_graph-&gt;set_x_axis_font&#40;$font_spec, 10&#41;;
+    $my_graph-&gt;set_title_font&#40;$font_spec, 18&#41;;
+    $my_graph-&gt;set_legend_font&#40;$font_spec, 8&#41;;
+    $my_graph-&gt;set_values_font&#40;$font_spec, 8&#41;;
+
+    $my_graph-&gt;plot&#40;$data&#41; or die $my_graph-&gt;error;
+    save_chart&#40;$my_graph, $name&#41;;
+}
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;18&nbsp;22:44:15&nbsp;2005</span>
    <span class="description">bwarfield [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m working on getting all the accumulated patches on GD::Graph assembled in a useable 
release, and I&#39;m curious about this detail: why make the old value override the new one?  It 
seems more logical to me to have the new value fall back on the old one, but override it if 
both are present &#40;since you could know about the old but not the knew, but hardly vise-
versa&#41;.

[guest - Tue Feb 10 01:17:31 2004]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This patch implements independent number formats for graphs with, for
&gt;    example, two y axes. It applies to GDGraph-1.43.
&gt; 
&gt; Small code modifications were made to Graph/axestype.pm and Graph.pm,
&gt;    documentation was added to Graph.pm and a new sample19 was created
&gt;    &#40;based on sample14&#41; to test this. This meant minor changes to
&gt;    MANIFEST and samples/Makefile as well.
&gt; 
&gt; Tested under perl 5.6.1.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;10&nbsp;21:25:07&nbsp;2006</span>
    <span class="description">bwarfield [...] cpan.org -  Fixed in 1.4305 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;11&nbsp;18:27:28&nbsp;2006</span>
    <span class="description">bwarfield [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;11&nbsp;18:28:02&nbsp;2006</span>
    <span class="description">bwarfield [...] cpan.org -  Status changed from &#39;new&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
