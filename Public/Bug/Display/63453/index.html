<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #63453 for MediaWiki-DumpFile: categories&#40;&#41; does not work in MediaWiki::DumpFile::Compat</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #63453 for MediaWiki-DumpFile: categories&#40;&#41; does not work in MediaWiki::DumpFile::Compat</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=MediaWiki-DumpFile">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=MediaWiki-DumpFile">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=MediaWiki-DumpFile">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=MediaWiki-DumpFile">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/MediaWiki-DumpFile">MediaWiki-DumpFile CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">63453</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=MediaWiki-DumpFile">MediaWiki-DumpFile</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">triddle [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
Pascal [...] Rockford.Com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-231066-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.1.8    </td>
  </tr>
  <tr id="CF-231067-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




MediaWiki-DumpFile-0.1.9_01.tar.gz<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/863222/446942/MediaWiki-DumpFile-0.1.9_01.tar.gz">
Thu Dec 02 14:18:43 2010 (17.7k) by triddle [...] cpan.org
</a>
</font></li>
</ul>


MediaWiki-DumpFile-0.2.0_03.tar.gz<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/864037/447380/MediaWiki-DumpFile-0.2.0_03.tar.gz">
Sat Dec 04 18:21:53 2010 (37k) by triddle [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=63453">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-861739" href="/Public/Bug/Display.html?id=63453#txn-861739">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;29&nbsp;19:34:52&nbsp;2010</span>
    <span class="description">Pascal [...] Rockford.Com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> categories&#40;&#41; does not work in MediaWiki::DumpFile::Compat</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/861739/446039/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/446039">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 57b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">categories&#40;&#41; does not work in MediaWiki::DumpFile::Compat
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-861764" href="/Public/Bug/Display.html?id=63453#txn-861764">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;29&nbsp;20:24:22&nbsp;2010</span>
    <span class="description">triddle [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-861765" href="/Public/Bug/Display.html?id=63453#txn-861765">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;29&nbsp;20:27:34&nbsp;2010</span>
    <span class="description">triddle [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/861765/446061/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/446061">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 313b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">It&#39;s a missing scalar dereference - you can fix it by editing line 333 of 
MediaWiki/DumpFile/Compat.pm in your perl library directory and changing it from

        while&#40;$text =~ m/\[\[$anchor:\s*&#40;[^\]]+&#41;\]\]/gi&#41; {

to

        while&#40;$$text =~ m/\[\[$anchor:\s*&#40;[^\]]+&#41;\]\]/gi&#41; {

I&#39;ll get an update onto CPAN some time soon. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-861767" href="/Public/Bug/Display.html?id=63453#txn-861767">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;29&nbsp;20:27:35&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-862056" href="/Public/Bug/Display.html?id=63453#txn-862056">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;30&nbsp;12:42:08&nbsp;2010</span>
    <span class="description">Pascal [...] Rockford.Com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Pascal [...] Rockford.Com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/862056/446231/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/446231">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 493b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">First off, I would like to take this opportunity to thank you for
writing and releasing your various Perl modules.  You have obviously put
a lot of time and hard work into them and it is appreciated.

Good news is that change does fix the problem.  Bad news is this bug
appears to be why MediaWiki::DumpFile::Compat was so much faster than
Parse::MediaWikiDump.  With that bug fix in place Parse::MediaWikiDump
is actually faster than MediaWiki::DumpFile::Compat.  Not by much, about
8% or so.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-862058" href="/Public/Bug/Display.html?id=63453#txn-862058">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;30&nbsp;12:58:05&nbsp;2010</span>
    <span class="description">triddle [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/862058/446233/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/446233">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for spreading some love and filling me in. :-&#41; I decided to sacrifice speed on the 
MediaWiki::DumpFile SQL parser to make it configurable and easier to maintain for a large set 
of SQL formats. There was a contribution of a faster SQL parsing implementation for the 
whole suite, not just the backwards compatibility library, in another ticket

<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=53370">https://rt.cpan.org/Ticket/Display.html?id=53370</a></span>

but I never got around to testing and integrating it. You might try that and see if it winds up 
being faster. Reports and patches would gladly be accepted on that topic too. 

I&#39;ll leave this ticket open until I get the new version pushed out onto CPAN. 

Cheers and happy coding,

Tyler

On Tue Nov 30 12:42:08 2010, Pascal666 wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; First off, I would like to take this opportunity to thank you for
&gt; writing and releasing your various Perl modules.  You have obviously put
&gt; a lot of time and hard work into them and it is appreciated.
&gt; 
&gt; Good news is that change does fix the problem.  Bad news is this bug
&gt; appears to be why MediaWiki::DumpFile::Compat was so much faster than
&gt; Parse::MediaWikiDump.  With that bug fix in place Parse::MediaWikiDump
&gt; is actually faster than MediaWiki::DumpFile::Compat.  Not by much, about
&gt; 8% or so.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-862060" href="/Public/Bug/Display.html?id=63453#txn-862060">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;30&nbsp;12:58:06&nbsp;2010</span>
    <span class="description">triddle [...] cpan.org -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-862546" href="/Public/Bug/Display.html?id=63453#txn-862546">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;01&nbsp;13:45:09&nbsp;2010</span>
    <span class="description">triddle [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/862546/446518/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/446518">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 666b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I realized you were probably talking about the processing speed of the ::Pages class, not the 
SQL parser &#40;not sure where I got that from&#41;. You are seeing a speed reduction then in parsing 
the xml page dump archive? That&#39;s interesting and unexpected, all my tests indicated the 
opposite however I&#39;ve noticed that XML parsing is highly dependent on the structure of the 
document and especially the ratio of markup to non-markup in the document. This may account 
for the speed discrepancy you are seeing. 

Would you mind sharing the dataset and code that&#39;s showing this behavior? I&#39;m somewhat 
curious in how things are behaving in the real world.

Cheers,

Tyler
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-862548" href="/Public/Bug/Display.html?id=63453#txn-862548">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;01&nbsp;13:45:11&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;patched&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-862743" href="/Public/Bug/Display.html?id=63453#txn-862743">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;01&nbsp;21:35:25&nbsp;2010</span>
    <span class="description">Pascal [...] Rockford.Com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Pascal [...] Rockford.Com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/862743/446619/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/446619">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I use your modules on Fedora.  Some of the below may not make much sense
if you are not familiar with Linux.  I only use your modules with one
file from enwiki, just with different dates.  I start off with:

open&#40;my $in, &#39;-|&#39;, &#34;bzcat enwiki-$date-pages-articles.xml.bz2&#34;&#41; or die $!;
my $pages = Parse::MediaWikiDump-&gt;new-&gt;pages&#40;$in&#41;;

Since these dumps are huge &#40;6G compressed, 27G uncompressed&#41;, as you can
see I use bzcat to decompress them on the fly.  This has the side effect
of allowing me to use top to see performance differences because top
lists my program and bzcat separately.  When using Parse::MediaWikiDump
my program uses about 90% of the cpu and bzcat uses about 10%.  The
first time I tried MediaWiki::DumpFile::Compat my program used about 80%
and bzcat used about 20%.  Basically this means my program was
processing data at about twice the old speed.  Since the cpu used by
your modules is considered part of my program by top, and I changed
nothing else, this seemed to indicate your new module was about twice as
fast &#40;consistent with your posted benchmarks&#41;.

The problem came when I compared the output to the previous run under
your old module.  None of the category logic in my program appeared to
work.  Thus, this bug report.  After applying your patch and running
again, bzcat dropped back to about 10%.  To get more exact performance
comparisons I again use top, but I watch bzcat&#39;s cpu time until it hits
1 minute and then check the cpu time for my program.  Whichever version
of my program used less cpu time during bzcat&#39;s 1 minute of cpu time was
the most efficient.

Basically bzcat will use the same amount of cpu time everytime it
decompresses the same file.  Thus when bzcat has spent 1 minute
decompressing that file it will always be at the same place in the file.
 So if one version of my program has used 5 minutes of cpu time when
bzcat hits 1 minute and another version has used 10 minutes of cpu time
when bzcat has used 1 minute, the version that only used 5 minutes of
cpu time is twice as fast because it processed the same amount of data
in half the time.

Because categories&#40;&#41; returns undef instead of an empty array in the case
of no categories, one cannot simply do @{$page-&gt;categories}.  It is
first necessary to make sure $page-&gt;categories is not undef.  I
accomplished this with the code:

next unless defined $page-&gt;categories;
for $cat &#40;@{$page-&gt;categories}&#41; {

While fixing line 333 in Compat.pm I noticed that categories&#40;&#41; was not
caching the result, meaning this code actually causes all the code in
categories&#40;&#41; to execute twice.  Categories&#40;&#41; in Parse::MediaWikiDump
does actually cache the result.  This is what made
MediaWiki::DumpFile::Compat slower than Parse::MediaWikiDump.  After
changing my code to basically:

$cats = $page-&gt;categories;
next unless defined $cats;
for $cat &#40;@{$cats}&#41; {

MediaWiki::DumpFile::Compat pulled back in the lead speed wise, but only
by about 12%, nowhere near the 100% I had seen originally &#40;and your
benchmarks show&#41;.

I use four functions per page:

title&#40;&#41;
text&#40;&#41;
namespace&#40;&#41;
categories&#40;&#41;

Unless you use exactly these four functions when making your benchmarks,
you will not get the same results I do.  You don&#39;t say in your
benchmarks which functions you used, but only using title&#40;&#41; and text&#40;&#41;
would probably give you benchmarks that are most applicable to the
average user.  These are basically the absolute minimums and anything
else users can do in their own program &#40;as is required for your new API&#41;.

Hopefully something in there was what you were looking for or actually
helps in some way.  Always happy to help.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-862767" href="/Public/Bug/Display.html?id=63453#txn-862767">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;01&nbsp;23:15:32&nbsp;2010</span>
    <span class="description">Pascal [...] Rockford.Com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Pascal [...] Rockford.Com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/862767/446641/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/446641">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry, just reread your docs for MediaWiki::DumpFile and you do
basically say you used text&#40;&#41; and title&#40;&#41; for each page.

Also just reread my program.  Actually, I am only calling namespace&#40;&#41; on
all pages.  Right now I am only looking at pages in the main and
Category namespaces, so if the namespace doesn&#39;t match one of those two
I skip it.  If it does match, then I call the others.

I was considering reimplementing with MediaWiki::DumpFile::FastPages and
bringing namespace&#40;&#41; and categories&#40;&#41; internal, problem is I would need
namespaces_names&#40;&#41; or equivalent to implement namespace&#40;&#41; and
MediaWiki::DumpFile::FastPages does not implement that.  Not really sure
why, namespaces&#40;&#41; would just pull some data from the beginning of the
dump.  Storing that information at the beginning and making it available
later would not slow down the main loop.

I&#39;ll probably reimplement using MediaWiki::DumpFile::FastPages for the
main loop after using MediaWiki::DumpFile::Compat for namespaces_names&#40;&#41;.

I also noticed that your categories&#40;&#41; would probably be faster if you
compiled the regex during new&#40;&#41; and namespace&#40;&#41; may be faster if you
built a hash during new&#40;&#41; from namespaces_names&#40;&#41; and looked in there
for the text before the colon instead of walking nested arrays each time.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-862811" href="/Public/Bug/Display.html?id=63453#txn-862811">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;02&nbsp;00:51:34&nbsp;2010</span>
    <span class="description">Pascal [...] Rockford.Com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Pascal [...] Rockford.Com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/862811/446669/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/446669">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 538b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I should probably clarify that all percentages above are relative to my
program and are not a direct comparison between your modules.  For
example, if my code uses 75% of the cpu time and your module uses 25%,
an increase in speed of 12.5% on the overall program with no changes in
my code would indicate a 50% improvement in the performance of your module.

So although I can say which of your modules is fastest in the way I am
using them, none of the above should be interpreted as implying any of
your posted benchmarks are incorrect.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-863222" href="/Public/Bug/Display.html?id=63453#txn-863222">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;02&nbsp;14:18:43&nbsp;2010</span>
    <span class="description">triddle [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/863222/446941/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/446941">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you for all your feedback! Your comments about the missing features on ::FastPages 
got me thinking. FastPages started life as a bit of research I did on measuring the parsing 
performance of the XML parsers and parsing schemes on CPAN. Using the LibXML reader like 
::FastPages did was quick but very difficult to parse the whole document which is why it 
doesn&#39;t understand any of the metadata or other content in the article aside from titles and 
text. 

However as I found out last night this wasn&#39;t strictly needed - the base parsing package for 
::Pages has a wrapper around the LibXML reader interface and I was able to integrate 
::FastPages into ::Pages as an option. Now you can turn fast mode on and off in ::Pages as 
well as control each iteration to be fast or slow; fast mode also uses a duck typed stand-in to 
provide the same API for a page in fast or slow mode. 

A test version of MediaWiki::DumpFIle is attached - it fixes your original bug report, lack of 
caching in ::Compat, and integrates together ::FastPages and ::Pages

The categories method is still missing as is the namespaces names &#40;but now you do get the 
namespaces method available and fast parsing still&#41;. 

The reason that categories is missing from MediaWiki::DumpFile is because support for that 
feature is difficult to do right; difficult enough that I decided to not do the same incomplete 
implementation that Parse::MediaWikiDump had. It is easy enough to check for the category 
definitions in the article text however this is not the authoritative category association 
information. For one, a template may be included in the file which sets the category: the 
categories method has no knowledge of this and can&#39;t really have knowledge of it with out 
pre-processing the full dump files &#40;including templates&#41; or going to the SQL dumps.

This means there needs to be a way to pull context from the entire mediawiki instance - it 
can be recreated from the dump files but doing it right is a hassle. I have plans to create a 
class that can manage those operations, build up indexes and do some caching, but it&#39;s not 
here today. After your feedback I&#39;ve realized these missing features are probably slowing 
adoption of MediaWiki::DumpFile which is not a good thing. 

Thanks again for your feedback, it is sincerely appreciated! If you have any more thoughts or 
comments I&#39;d love to hear them. 
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> MediaWiki-DumpFile-0.1.9_01.tar.gz</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/863222/446942/MediaWiki-DumpFile-0.1.9_01.tar.gz">Download MediaWiki-DumpFile-0.1.9_01.tar.gz</a><br />
<span class="downloadcontenttype">application/x-gzip 17.7k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-864037" href="/Public/Bug/Display.html?id=63453#txn-864037">#</a>      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;04&nbsp;18:21:53&nbsp;2010</span>
    <span class="description">triddle [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/864037/447379/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/447379">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello again,

I&#39;d like to thank you one more time for your correspondence. It&#39;s helped put me into the 
frame of mind of someone using the software I&#39;ve created which has helped me to improve it. 
I&#39;ve incorporated nearly all of your ideas and suggestions plus the previous modification I 
made with a lot more polish of MediaWiki::DumpFile::Compat to produce 
MediaWiki::DumpFile version 0.2.0 which is out for some testing right now.

I&#39;ve attached a pre-release version to this ticket because it directly addresses the project you 
told me about. Unfortunately it may be too late to save you time if you&#39;ve already 
implemented the work-arounds you described but your use case was the direct inspiration 
for the modifications. 

Here&#39;s the changelog entries you&#39;ll be interested in:

  * Fast mode is here! ::Pages, ::FastPages, and ::Compat::Pages can 
    all be very fast by giving up support for everything besides
    titles and the text contents of the first entry in the dump file. 
  * Added the XML benchmarking suite I created to study XML processing speeds
    to distro; hopefully more people will be interested in the shootout. 
  * Ported over documentation from Parse::MediaWikiDump giving ::Compat
    full documentation in this module as well. 

The benchmark suite is what I used to measure the performance before and to generate the 
updated performance metrics in the new documentation. I&#39;m currently waiting for a run to 
finish measuring the performance of all modules on the english wikipedia and that will also 
go into the documentation when it&#39;s done and before 0.2.0 ships. 

Fast mode works great with the ::Compat libs now - just pass the fast_mode option as an 
option to the constructor of Parse::MediaWikiDump::Pages when using the new named 
parameters interface. Fast mode lets the compat Parse::MediaWikiDump::Pages class parse 
over 20 megs a second on even troublesome dumps - the English Wikipedia dumps should 
be much much faster, I predict closer to 40 meg/sec.

Feedback would be appreciated if you&#39;ve got any more otherwise I&#39;m going to close this ticket 
once I publish 0.2.0.

Cheers,

Tyler
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> MediaWiki-DumpFile-0.2.0_03.tar.gz</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/864037/447380/MediaWiki-DumpFile-0.2.0_03.tar.gz">Download MediaWiki-DumpFile-0.2.0_03.tar.gz</a><br />
<span class="downloadcontenttype">application/x-gzip 37k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-864300" href="/Public/Bug/Display.html?id=63453#txn-864300">#</a>      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;05&nbsp;14:14:55&nbsp;2010</span>
    <span class="description">triddle [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/864300/447497/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/447497">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 215b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I just got 0.2.0 of MediaWiki::DumpFile pushed out incorporating all the previously mentioned 
changes plus regex compilation in MediaWIki::DumpFile::Compat 

Thanks again for your bug report,

Cheers,

Tyler Riddle
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-864302" href="/Public/Bug/Display.html?id=63453#txn-864302">#</a>      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;05&nbsp;14:14:56&nbsp;2010</span>
    <span class="description">triddle [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.685616</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
