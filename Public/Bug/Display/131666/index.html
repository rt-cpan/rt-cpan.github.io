<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #131666 for Type-Tiny: Question: recursive container types</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #131666 for Type-Tiny: Question: recursive container types</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Type-Tiny">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Type-Tiny">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Type-Tiny">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Type-Tiny">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Type-Tiny">Type-Tiny CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">131666</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Type-Tiny">Type-Tiny</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
bpjonsson [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-249424-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-249425-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




test.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1883084/1010445/test.pl">
Tue Feb 04 10:15:58 2020 (1k) by perl [...] toby.ink
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=131666">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1883044" href="/Public/Bug/Display.html?id=131666#txn-1883044">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;04&nbsp;08:54:22&nbsp;2020</span>
    <span class="description">bpjonsson [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Question: recursive container types</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 4 Feb 2020 14:54:04 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Type-Tiny [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> BP Jonsson &lt;bpjonsson [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1883044/1010429/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1010429">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is a question rather than a bug, but I guess it could also be
construed as a feature request. Apologies if this could/should go over IRC,
but IRC is difficult because of my cerebral palsy; I keep hitting the wrong
keys at the wrong time...

I have a bit of a problem. I want to check for a hashref which may contain
scalars, arrayrefs or further hashrefs basically to any depth, but where
non-hashref, non-arrayref values must be strings or objects with overloaded
stringification, so I guess that I would need to define type constraints
for such arrays and hashes which nest themselves, presumably as weak
references. Is that at all possible with Type::Tiny? I suppose not, so is
there anything I can do short of traversing the whole data structure
&#34;manually&#34; at every turn?

As I said this should probably *not* be taken as a feature request although
I suppose that in principle you could check for recursive inclusions in
nested types like HashRef and make references weak as needed, but no need
to actually implement that at this time; I&#39;m rather looking for good
alternative strategies.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1883044/1010430/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1010430">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.2k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1883079" href="/Public/Bug/Display.html?id=131666#txn-1883079">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;04&nbsp;10:01:03&nbsp;2020</span>
    <span class="description">perl [...] toby.ink -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1883079/1010439/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1010439">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 733b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">That&#39;s a very good question. Basically what you&#39;re asking for is something like:

    MyHashRef := HashRef[ Str | MyHashRef ]

&#40;And yes, I know you also mentioned ArrayRefs and overloaded objects, but cutting it down to a simple example here.&#41;

This can&#39;t be done directly because MyHashRef isn&#39;t defined yet when the list of parameters is being passed to HashRef.

However, you can probably work around it using something like this:

    MyHashRef := HashRef[
      Str  |  HashRef-&gt;where&#40; &#39;MyApp::MyTypes::is_MyHashRef&#40;$_&#41;&#39; &#41;
    ];

I haven&#39;t actually tested this though. It&#39;s something I should probably document and test.

I believe this DOES work in MooseX::Types. One of the few advantages of having a central type registry.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1883080" href="/Public/Bug/Display.html?id=131666#txn-1883080">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;04&nbsp;10:01:04&nbsp;2020</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1883082" href="/Public/Bug/Display.html?id=131666#txn-1883082">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;04&nbsp;10:03:00&nbsp;2020</span>
    <span class="description">perl [...] toby.ink -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1883082/1010441/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1010441">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 187b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">To be clear, the is_MyHashRef&#40;&#41; function would be the one automatically created when you define the type MyHashRef in a type library, not a function you&#39;re expected to write for yourself.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1883084" href="/Public/Bug/Display.html?id=131666#txn-1883084">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;04&nbsp;10:15:58&nbsp;2020</span>
    <span class="description">perl [...] toby.ink -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1883084/1010444/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1010444">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 52b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Attached is a small script showing proof-of-concept.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> test.pl</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1883084/1010445/test.pl">Download test.pl</a><br />
<span class="downloadcontenttype">text/x-perl 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">use strict;
use warnings;
use Test::More;

BEGIN {
	package MyTypes;
	
	use Type::Library -base;
	use Types::Standard -types;
	
	__PACKAGE__-&gt;add_type&#40;
		name    =&gt; &#39;MyHashRef&#39;,
		parent  =&gt; HashRef[ Int | HashRef-&gt;where&#40;&#39;MyTypes::is_MyHashRef&#40;$_&#41;&#39;&#41; ],
	&#41;;
	
	$INC{&#39;MyTypes.pm&#39;} = __FILE__; # stop `use` from complaining
};

use MyTypes -types;

my %good1 = &#40; foo =&gt; 1, bar =&gt; 2 &#41;;
my %good2 = &#40; %good1, bat =&gt; {}, baz =&gt; { foo =&gt; 3 } &#41;;
my %good3 = &#40; %good2, quux =&gt; { quuux =&gt; { quuuux =&gt; 0, xyzzy =&gt; {} } } &#41;;

my %bad1 = &#40; %good1, bar =&gt; \1 &#41;;
my %bad2 = &#40; %good2, baz =&gt; { foo =&gt; \1 } &#41;;
my %bad3 = &#40; %good3, quux =&gt; { quuux =&gt; { quuuux =&gt; 0, xyzzy =&gt; \1 } } &#41;;

ok&#40; MyHashRef-&gt;can_be_inlined &#41;;

ok&#40; MyHashRef-&gt;check&#40; {} &#41; &#41;;
ok&#40; MyHashRef-&gt;check&#40; \%good1 &#41; &#41;;
ok&#40; MyHashRef-&gt;check&#40; \%good2 &#41; &#41;;
ok&#40; MyHashRef-&gt;check&#40; \%good3 &#41; &#41;;
ok&#40; ! MyHashRef-&gt;check&#40; \%bad1 &#41; &#41;;
ok&#40; ! MyHashRef-&gt;check&#40; \%bad2 &#41; &#41;;
ok&#40; ! MyHashRef-&gt;check&#40; \%bad3 &#41; &#41;;
ok&#40; ! MyHashRef-&gt;check&#40; undef &#41; &#41;;
ok&#40; ! MyHashRef-&gt;check&#40; \1 &#41; &#41;;

done_testing;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1883114" href="/Public/Bug/Display.html?id=131666#txn-1883114">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;04&nbsp;11:33:33&nbsp;2020</span>
    <span class="description">perl [...] toby.ink -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1883114/1010464/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1010464">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 909b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I know you said this wasn&#39;t a feature request, but it was actually pretty simple to add it as a feature:

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/tobyink/p5-type-tiny/compare/feature/reentrant-types">https://github.com/tobyink/p5-type-tiny/compare/feature/reentrant-types</a></span>

It will only work in type libraries; not if you&#39;re just defining types in lexical variables. This is because when the type recursively calls itself, it needs to be able to find itself, so it needs to look up the type by name from a package. &#40;If that makes sense?&#41;


You need to declare the type name ahead of the definition:

  use Type::Library -base, -declare =&gt; qw&#40; MyHashRef &#41;;

And then you can just define it in the type library like this:

  __PACKAGE__-&gt;add_type&#40;
    name    =&gt; MyHashRef,
    parent  =&gt; HashRef[ Int | MyHashRef ],
  &#41;;

If your needs are significantly more complex, then you&#39;re out of luck. &#40;No recursively defined coercions, for example.&#41;

I hope to include this in Type::Tiny 1.010 when it&#39;s released.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1883343" href="/Public/Bug/Display.html?id=131666#txn-1883343">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;05&nbsp;08:17:20&nbsp;2020</span>
    <span class="description">bpjonsson [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #131666] Question: recursive container types</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 5 Feb 2020 14:17:02 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Type-Tiny [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> BP Jonsson &lt;bpjonsson [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1883343/1010587/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1010587">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Wow that&#39;s wonderful! Prompt response indeed! Thanks a lot!

Will it be possible to do something like the &#40;probably incomplete&#41; example
below? If so I&#39;ll be all set.

``````perl
use Type::Library -declare =&gt; &#40;
  StringArray, StringHash &#41;;

__PACKAGE__-&gt;add_type&#40;
  name =&gt; StringArray,
  parent =&gt; ArrayRef-&gt;of&#40;
    StringLike | StringArray | StringHash
&#41;;

__PACKAGE__-&gt;add_type&#40;
  name =&gt; StringHash,
  parent =&gt; HashRef-&gt;of&#40;
    StringLike | StringHash | StringArray
&#41;;
``````

Den tis 4 feb. 2020 17:33Toby Inkster via RT &lt;bug-Type-Tiny@rt.cpan.org&gt;
skrev:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=131666">https://rt.cpan.org/Ticket/Display.html?id=131666</a></span> &gt;
&gt;
&gt; I know you said this wasn&#39;t a feature request, but it was actually pretty
&gt; simple to add it as a feature:
&gt;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/tobyink/p5-type-tiny/compare/feature/reentrant-types">https://github.com/tobyink/p5-type-tiny/compare/feature/reentrant-types</a></span>
&gt;
&gt; It will only work in type libraries; not if you&#39;re just defining types in
&gt; lexical variables. This is because when the type recursively calls itself,
&gt; it needs to be able to find itself, so it needs to look up the type by name
&gt; from a package. &#40;If that makes sense?&#41;
&gt;
&gt;
&gt; You need to declare the type name ahead of the definition:
&gt;
&gt;   use Type::Library -base, -declare =&gt; qw&#40; MyHashRef &#41;;
&gt;
&gt; And then you can just define it in the type library like this:
&gt;
&gt;   __PACKAGE__-&gt;add_type&#40;
&gt;     name    =&gt; MyHashRef,
&gt;     parent  =&gt; HashRef[ Int | MyHashRef ],
&gt;   &#41;;
&gt;
&gt; If your needs are significantly more complex, then you&#39;re out of luck. &#40;No
&gt; recursively defined coercions, for example.&#41;
&gt;
&gt; I hope to include this in Type::Tiny 1.010 when it&#39;s released.
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1883343/1010588/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1010588">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.5k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1883354" href="/Public/Bug/Display.html?id=131666#txn-1883354">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;05&nbsp;10:55:15&nbsp;2020</span>
    <span class="description">perl [...] toby.ink -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1883354/1010595/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1010595">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 218b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2020-02-05T13:17:20Z, bpjonsson@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Will it be possible to do something like the &#40;probably incomplete&#41;
&gt; example below? If so I&#39;ll be all set.
</div>
I believe that should work, though I haven&#39;t tested it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1883358" href="/Public/Bug/Display.html?id=131666#txn-1883358">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;05&nbsp;11:19:24&nbsp;2020</span>
    <span class="description">perl [...] toby.ink -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1883358/1010597/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1010597">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 227b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I added this as a test case:

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/tobyink/p5-type-tiny/commit/81cfbe0ea1f0fd68fc056474f1d3063792629e1e">https://github.com/tobyink/p5-type-tiny/commit/81cfbe0ea1f0fd68fc056474f1d3063792629e1e</a></span>

&#40;I used Str rather than StrLike, but there&#39;s nothing special about StrLike that would stop it also working.&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1883360" href="/Public/Bug/Display.html?id=131666#txn-1883360">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;05&nbsp;11:53:24&nbsp;2020</span>
    <span class="description">perl [...] toby.ink -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1883365" href="/Public/Bug/Display.html?id=131666#txn-1883365">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;05&nbsp;13:14:21&nbsp;2020</span>
    <span class="description">bpjonsson [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #131666] Question: recursive container types</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 5 Feb 2020 19:14:03 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Type-Tiny [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> BP Jonsson &lt;bpjonsson [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1883365/1010600/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1010600">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 461b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Great! Thanks again! I really appreciate the work you do, not just this.



Den ons 5 feb. 2020 17:19Toby Inkster via RT &lt;bug-Type-Tiny@rt.cpan.org&gt;
skrev:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=131666">https://rt.cpan.org/Ticket/Display.html?id=131666</a></span> &gt;
&gt;
&gt; I added this as a test case:
&gt;
&gt;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/tobyink/p5-type-tiny/commit/81cfbe0ea1f0fd68fc056474f1d3063792629e1e">https://github.com/tobyink/p5-type-tiny/commit/81cfbe0ea1f0fd68fc056474f1d3063792629e1e</a></span>
&gt;
&gt; &#40;I used Str rather than StrLike, but there&#39;s nothing special about StrLike
&gt; that would stop it also working.&#41;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1883365/1010601/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1010601">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1886031" href="/Public/Bug/Display.html?id=131666#txn-1886031">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;19&nbsp;15:40:38&nbsp;2020</span>
    <span class="description">perl [...] toby.ink -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1886031/1011810/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1011810">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 38b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Stable release 1.010000 includes this.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1886033" href="/Public/Bug/Display.html?id=131666#txn-1886033">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;19&nbsp;15:40:39&nbsp;2020</span>
    <span class="description">perl [...] toby.ink -  Status changed from &#39;patched&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.569855</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
