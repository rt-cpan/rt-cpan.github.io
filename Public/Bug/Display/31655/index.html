<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #31655 for Mail-IMAPClient: get_header</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #31655 for Mail-IMAPClient: get_header</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Mail-IMAPClient/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Mail-IMAPClient/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Mail-IMAPClient/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Mail-IMAPClient/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Mail-IMAPClient">Mail-IMAPClient CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">31655</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Mail-IMAPClient/Active/">Mail-IMAPClient</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
lonnieb [...] kcsrcpas.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-19960-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-19961-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Mail-IMAPClient-3.03.tar.gz<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/404793/197236/Mail-IMAPClient-3.03.tar.gz">
Wed Jan 02 08:19:26 2008 (163.4k) by solutions [...] overmeer.net
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;18&nbsp;12:03:30&nbsp;2007</span>
    <span class="description">lonnieb [...] kcsrcpas.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> get_header</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I just recently updated to Mail::IMAPClient 3.02 via yum.  I am on
centOS 5.  I have a script that was running before that doesn&#39;t seem to
be working properly anymore.  get_header&#40;&#41; seems to not be returning the
correct results.

my $messageId = $imap-&gt;get_header&#40;$msg, &#34;Message-Id&#34;&#41;;
returns Null

and

my $SpamStatus = $imap-&gt;get_header&#40;$msg, &#34;X-Spam-Status&#34;&#41;;
doesn&#39;t init $SpamStatus.

reverting back to 2.2.9 this will return the message id without changing
the code.  However $SpamStatus still does the same.  Maybe another
update broke this.  I seem to think I remember message_string&#40;$msg&#41; and
fetch&#40;$msg,&#39;RFC822&#39;&#41; returning the headers above &#34;Date:&#34; &#40;i.e. recieved,
X-Spam-Status&#41;, not sure about this part or if it is related to the issue.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;19&nbsp;03:38:43&nbsp;2007</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #31655] get_header</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 19 Dec 2007 09:38:21 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Lonnie Boudreaux via RT &lt;bug-Mail-IMAPClient [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Lonnie Boudreaux via RT &#40;bug-Mail-IMAPClient@rt.cpan.org&#41; [071218 17:03]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Tue Dec 18 12:03:30 2007: Request 31655 was acted upon.
&gt; Transaction: Ticket created by lonnieb
&gt;        Queue: Mail-IMAPClient
&gt;      Subject: get_header
&gt;    Broken in: &#40;no value&#41;
&gt;     Severity: Critical
&gt;        Owner: Nobody
&gt;   Requestors: lonnieb@kcsrcpas.com
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=31655">http://rt.cpan.org/Ticket/Display.html?id=31655</a></span> &gt;
&gt; 
&gt; I just recently updated to Mail::IMAPClient 3.02 via yum.  I am on
&gt; centOS 5.  I have a script that was running before that doesn&#39;t seem to
&gt; be working properly anymore.  get_header&#40;&#41; seems to not be returning the
&gt; correct results.
</div>
The weird thing is: a lot of people are using the module, and they do
not experience your problem.  So... let&#39;s try to find-out what is
happening.

Could you send me the debug trace &#40;initiate the module with &#34;Debug&#41;
and a dump of the header structure, for instance made via

   sub get_header
   {   my &#40;$self, $msg, $field&#41; = @_;
       my $headers = $self-&gt;parse_headers&#40;$msg, $field&#41;;
 + use Data::Dumper;
 + print Dumper $headers;
       $headers ? $headers-&gt;{$field}[0] : undef;
   }

Looking at the code, I suspect that there is a casing problem; try
  $imap-&gt;get_header&#40;&#39;message-id&#39;&#41;;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; reverting back to 2.2.9 this will return the message id without changing
&gt; the code.  However $SpamStatus still does the same.  Maybe another
&gt; update broke this.  I seem to think I remember message_string&#40;$msg&#41; and
&gt; fetch&#40;$msg,&#39;RFC822&#39;&#41; returning the headers above &#34;Date:&#34; &#40;i.e. recieved,
&gt; X-Spam-Status&#41;, not sure about this part or if it is related to the issue.
</div>
2.2.9 is 4 years old, so there is no &#34;other update&#34;.  If your last
remark is true, then both releases should result in the same.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;19&nbsp;03:38:45&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;19&nbsp;10:33:07&nbsp;2007</span>
    <span class="description">lonnieb [...] kcsrcpas.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #31655] get_header</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 19 Dec 2007 08:39:14 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-IMAPClient [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Lonnie Boudreaux &lt;lonnieb [...] kcsrcpas.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ok I will try to go back to 3.02 and do the debug sometime this week.  I 
have tested this again, updating only IMAPClient from 2.2.9 to 3.02 will 
break it again.  I have resolved the &#34;X-Spam-Status&#34; issue in 2.2.9 so 
that the script runs as it did pre update.  This ended up being a slight 
difference in the way amavisd wrote the header.  Not sure why it 
changed, but that is resolved now.  I have tried several variances on 
the case: all upper, all lower, and how it is in the the message, they 
all yield the same result.  My test script has it as all lowercase since 
the function description claims it is not case sensitive.

2.29 Output on Test script
&lt;47684440.5080104@kcsrcpas.com&gt;
No, score=-1.437 tagged_above=-150 required=3 tests=[ALL_TRUSTED=-1.44, 
AWL=0.003] autolearn=unavailable

3.02 Output on Test Script
Use of uninitialized value in concatenation &#40;.&#41; or string at ./lon2 line 32.

Use of uninitialized value in concatenation &#40;.&#41; or string at ./lon2 line 34.

lines 32 and 34 or the print statements for the headers

Mark Overmeer via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=31655">http://rt.cpan.org/Ticket/Display.html?id=31655</a></span> &gt;
&gt;
&gt; * Lonnie Boudreaux via RT &#40;bug-Mail-IMAPClient@rt.cpan.org&#41; [071218 17:03]:
&gt;   
<div class="message-stanza open">&gt;&gt; Tue Dec 18 12:03:30 2007: Request 31655 was acted upon.
&gt;&gt; Transaction: Ticket created by lonnieb
&gt;&gt;        Queue: Mail-IMAPClient
&gt;&gt;      Subject: get_header
&gt;&gt;    Broken in: &#40;no value&#41;
&gt;&gt;     Severity: Critical
&gt;&gt;        Owner: Nobody
&gt;&gt;   Requestors: lonnieb@kcsrcpas.com
&gt;&gt;       Status: new
&gt;&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=31655">http://rt.cpan.org/Ticket/Display.html?id=31655</a></span> &gt;
&gt;&gt;
&gt;&gt; I just recently updated to Mail::IMAPClient 3.02 via yum.  I am on
&gt;&gt; centOS 5.  I have a script that was running before that doesn&#39;t seem to
&gt;&gt; be working properly anymore.  get_header&#40;&#41; seems to not be returning the
&gt;&gt; correct results.
&gt;&gt;     
</div>&gt;
&gt; The weird thing is: a lot of people are using the module, and they do
&gt; not experience your problem.  So... let&#39;s try to find-out what is
&gt; happening.
&gt;
&gt; Could you send me the debug trace &#40;initiate the module with &#34;Debug&#41;
&gt; and a dump of the header structure, for instance made via
&gt;
&gt;    sub get_header
&gt;    {   my &#40;$self, $msg, $field&#41; = @_;
&gt;        my $headers = $self-&gt;parse_headers&#40;$msg, $field&#41;;
&gt;  + use Data::Dumper;
&gt;  + print Dumper $headers;
&gt;        $headers ? $headers-&gt;{$field}[0] : undef;
&gt;    }
&gt;
&gt; Looking at the code, I suspect that there is a casing problem; try
&gt;   $imap-&gt;get_header&#40;&#39;message-id&#39;&#41;;
&gt;
&gt;   
<div class="message-stanza open">&gt;&gt; reverting back to 2.2.9 this will return the message id without changing
&gt;&gt; the code.  However $SpamStatus still does the same.  Maybe another
&gt;&gt; update broke this.  I seem to think I remember message_string&#40;$msg&#41; and
&gt;&gt; fetch&#40;$msg,&#39;RFC822&#39;&#41; returning the headers above &#34;Date:&#34; &#40;i.e. recieved,
&gt;&gt; X-Spam-Status&#41;, not sure about this part or if it is related to the issue.
&gt;&gt;     
</div>&gt;
&gt; 2.2.9 is 4 years old, so there is no &#34;other update&#34;.  If your last
&gt; remark is true, then both releases should result in the same.
&gt;   
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;19&nbsp;11:41:48&nbsp;2007</span>
    <span class="description">gonullu [...] bluewin.ch -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> gonullu [...] bluewin.ch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello All,

My scripts have also stopped to work after my update &#40;2.2.9 to 3.02&#41;
on my mac osx 10.4.11. The &#34;body_string&#34; method is returning undef
&#40;because of a timeout&#41;. In the test you see that the body is fetched
&#40;till the &lt;END&gt; mark&#41; but the script stand there waiting...



Below you will see the output with the Debug flag turned on.

Using Mail::IMAPClient version 3.02 on perl 5.008008
Read: * OK [CAPABILITY IMAP4rev1 UIDPLUS CHILDREN NAMESPACE
THREAD=ORDEREDSUBJECT THREAD=REFERENCES SORT QUOTA IDLE AUTH=PLAIN ACL
ACL2=UNION] Courier-IMAP ready. Copyright 1998-2005 Double Precision,
Inc.  See COPYING for distribution information.
Sending: 1 LOGIN &#34;salih.gonullu@....h&#34; &#34;***********&#34;
Sent 49 bytes
Read: 1 OK LOGIN Ok.
Sending: 2 SELECT Inbox.test
Sent 21 bytes
Read: * FLAGS &#40;\Draft \Answered \Flagged \Deleted \Seen \Recent&#41;
  
      * OK [PERMANENTFLAGS &#40;\* \Draft \Answered \Flagged \Deleted
\Seen&#41;] Limited
  
      * 3 EXISTS
  
      * 0 RECENT
  
      * OK [UIDVALIDITY 1197991009] Ok
  
      * OK [MYRIGHTS &#34;acdilrsw&#34;] ACL
  
      2 OK [READ-WRITE] Ok
Sending: 3 UID SEARCH NOT DELETED
Sent 26 bytes
Read: * SEARCH 3
  
      3 OK SEARCH done.
Sending: 4 UID FETCH 3 BODY.PEEK[HEADER.FIELDS &#40;To Cc Subject&#41;]
Sent 56 bytes
LITERAL: received literal in line * 3 FETCH &#40;UID 3 BODY[HEADER.FIELDS
&#40;&#34;To&#34; &#34;Cc&#34; &#34;Subject&#34;&#41;] of length 68; attempting to retrieve from the 94
bytes in: To: Salih Goenuellue &lt;salih.gonullu@...h&gt;
  Subject: test123
  
  &#41;
  4 OK FETCH completed.
  &lt;END_OF_iBuffer&gt;
Read: * 3 FETCH &#40;UID 3 BODY[HEADER.FIELDS &#40;&#34;To&#34; &#34;Cc&#34; &#34;Subject&#34;&#41;]
      To: Salih Goenuellue &lt;salih.gonullu@...h&gt;
  Subject: test123
  
  
      &#41;
  
      4 OK FETCH completed.
Sending: 5 UID FETCH 3 BODY.PEEK[TEXT]
Sent 31 bytes
LITERAL: received literal in line * 3 FETCH &#40;UID 3 BODY[TEXT] of length
310; attempting to retrieve from the 0 bytes in: &lt;END_OF_iBuffer&gt;
Received ret=310 and buffer = 

  
  In this section, the Fourier technique used in section 1 is expanced to
  the 2-dimensional grid. This method sets up an integral for this
  resistance between any two nodes, and a solution is found for the
  resistance across the diagonal of a single square &#40;between nodes &#40;0,0&#41;
  and &#40;1,1&#41; in Figure 2.
  
  
  &lt;END&gt;
while processing LITERAL
ERROR: Tag 5: Timeout after 30 seconds waiting for data from server
ERROR: Timeout after 30 seconds during read from server
ERROR: Unable to parse server response from 5 UID FETCH 3 BODY.PEEK[TEXT]
Could not retrieve body at send-mails.pl line 252. &#40;the script died
because the body is undef&#41;

Thanks in advance
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;19&nbsp;16:36:53&nbsp;2007</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #31655] get_header</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 19 Dec 2007 22:36:30 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Gonullu via RT &lt;bug-Mail-IMAPClient [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Gonullu via RT &#40;bug-Mail-IMAPClient@rt.cpan.org&#41; [071219 16:41]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=31655">http://rt.cpan.org/Ticket/Display.html?id=31655</a></span> &gt;
&gt; 
&gt; Hello All,
&gt; 
&gt; My scripts have also stopped to work after my update &#40;2.2.9 to 3.02&#41;
&gt; on my mac osx 10.4.11. The &#34;body_string&#34; method is returning undef
&gt; &#40;because of a timeout&#41;. In the test you see that the body is fetched
&gt; &#40;till the &lt;END&gt; mark&#41; but the script stand there waiting...
</div>
Weird.

Apparently, we stay in the while
            while&#40;$expected_size &gt; length $litstring&#41;
where the &#34;debug&#34; says that we got everything.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; LITERAL: received literal in line * 3 FETCH &#40;UID 3 BODY[TEXT] of length
&gt; 310; attempting to retrieve from the 0 bytes in: &lt;END_OF_iBuffer&gt;
&gt; Received ret=310 and buffer = 
</div>
we received 310 out of 310!  ??  We should leave the loop.

Could you try

      $self-&gt;_debug&#40;&#34;Received ret=$ret and buffer = &#34; .
                   &#34;\n$litstring&lt;END&gt;\nwhile processing LITERAL&#34;&#41;;
   +  $self-&gt;_debug&#40;&#34;length litstring = &#34;, length $litstring&#41;;

to help me thinking...
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;21&nbsp;11:27:54&nbsp;2007</span>
    <span class="description">gonullu [...] bluewin.ch -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> gonullu [...] bluewin.ch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Apparently, we stay in the while
&gt;             while&#40;$expected_size &gt; length $litstring&#41;
&gt; where the &#34;debug&#34; says that we got everything.
</div>
It is not that while loop but I think it is the until that we stay in
I have put:

my $transno = $self-&gt;Transaction;           
+ $self-&gt;_debug&#40;&#34;in $transno entering until &#34;, Dumper $oBuffer&#41;;

and I see for transaction 5 2 times with $oBuffer is the following:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">------------------- output --------------------------------------


in 5 entering until $VAR1 = [];
LITERAL: received literal in line * 3 FETCH &#40;UID 3 BODY[TEXT] of length
310; attempting to retrieve from the 0 bytes in: &lt;END_OF_iBuffer&gt;
Received ret=310 and buffer = 

  
  In this section, the Fourier technique used in section 1 is expanced to
  the 2-dimensional grid. This method sets up an integral for this
  resistance between any two nodes, and a solution is found for the
  resistance across the diagonal of a single square &#40;between nodes &#40;0,0&#41;
  and &#40;1,1&#41; in Figure 2.
  
  


  &lt;END&gt;
while processing LITERAL
length litstring = 310
in 5 entering until $VAR1 = [
          [
            1,
            &#39;OUTPUT&#39;,
            &#39;* 3 FETCH &#40;UID 3 BODY[TEXT]&#39;
          ],
          [
            2,
            &#39;LITERAL&#39;,
            &#39;
  
  In this section, the Fourier technique used in section 1 is expanced to
  the 2-dimensional grid. This method sets up an integral for this
  resistance between any two nodes, and a solution is found for the
  resistance across the diagonal of a single square &#40;between nodes &#40;0,0&#41;
  and &#40;1,1&#41; in Figure 2.
  
  
  &#39;
          ]
        ];
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;24&nbsp;06:36:37&nbsp;2007</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #31655] get_header</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 24 Dec 2007 12:36:05 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Gonullu via RT &lt;bug-Mail-IMAPClient [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Gonullu via RT &#40;bug-Mail-IMAPClient@rt.cpan.org&#41; [071221 16:27]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Apparently, we stay in the while
&gt; &gt;             while&#40;$expected_size &gt; length $litstring&#41;
&gt; &gt; where the &#34;debug&#34; says that we got everything.
</div>&gt; 
&gt; It is not that while loop but I think it is the until that we stay in
&gt; I have put:
&gt; 
&gt; my $transno = $self-&gt;Transaction;           
&gt; + $self-&gt;_debug&#40;&#34;in $transno entering until &#34;, Dumper $oBuffer&#41;;
&gt; 
&gt; and I see for transaction 5 2 times with $oBuffer is the following:
</div>
I am still puzzled.  Is there any way that I can access your server
to reproduce the problems?
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;02&nbsp;08:19:25&nbsp;2008</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #31655] get_header</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 2 Jan 2008 14:18:55 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Gonullu via RT &lt;bug-Mail-IMAPClient [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Gonullu via RT &#40;bug-Mail-IMAPClient@rt.cpan.org&#41; [071221 16:27]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It is not that while loop but I think it is the until that we stay in
&gt; I have put:
&gt; 
&gt; my $transno = $self-&gt;Transaction;           
&gt; + $self-&gt;_debug&#40;&#34;in $transno entering until &#34;, Dumper $oBuffer&#41;;
&gt; 
&gt; and I see for transaction 5 2 times with $oBuffer is the following:
</div>
The until&#40;&#41; should run at least 3 times, because we still miss the
closing &#39;&#41;&#39; of the FETCH, and the trailing &#39;OK&#39;.  The latter line
is the reason we stay in the loop.

I have re-frased the _read_line a little, to make it even more
clear what happens.  But I really need your help to get to the
bottom of this...
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/404793/197236/Mail-IMAPClient-3.03.tar.gz">Download Mail-IMAPClient-3.03.tar.gz</a><br />
<span class="downloadcontenttype">application/x-gunzip 163.4k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;25&nbsp;03:34:46&nbsp;2008</span>
    <span class="description">MARKOV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The bug-report probably did hide the real cause for the problem from me.
 Gladly, <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=32398">http://rt.cpan.org/Ticket/Display.html?id=32398</a></span> came in, which
pointed my in the right direction.

I suspect that also your problems were caused by missing out on the UID
information which Windows Server 2003 hides in a very unusual place. So,
the header information was received, but stored under the message ID,
not the UID.

Please confirm that 3.04 is working for you
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;25&nbsp;15:54:41&nbsp;2008</span>
    <span class="description">lonnieb [...] kcsrcpas.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #31655] get_header</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 25 Jan 2008 14:54:20 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-IMAPClient [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Lonnie Boudreaux &lt;lonnieb [...] kcsrcpas.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry for the delay, I had some family issues to tend to.  I am 
personally not using any windows products in relation to this issue, but 
I will upgrade to the new version and test to see if this fixes the 
issues that I was having.  I will try to do this before COB today or on 
Monday.

Thanks

Mark Overmeer via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=31655">http://rt.cpan.org/Ticket/Display.html?id=31655</a></span> &gt;
&gt;
&gt; The bug-report probably did hide the real cause for the problem from me.
&gt;  Gladly, <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=32398">http://rt.cpan.org/Ticket/Display.html?id=32398</a></span> came in, which
&gt; pointed my in the right direction.
&gt;
&gt; I suspect that also your problems were caused by missing out on the UID
&gt; information which Windows Server 2003 hides in a very unusual place. So,
&gt; the header information was received, but stored under the message ID,
&gt; not the UID.
&gt;
&gt; Please confirm that 3.04 is working for you
&gt;
&gt;
&gt;
&gt;   
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;31&nbsp;13:31:39&nbsp;2008</span>
    <span class="description">lonnieb [...] kcsrcpas.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #31655] get_header</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 31 Jan 2008 09:55:58 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-IMAPClient [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Lonnie Boudreaux &lt;lonnieb [...] kcsrcpas.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">It seemed to fix the test script that I had written, but the main script 
where I noticed the problem still gives an error.  I am still trying to 
narrow down the case that it happens on to write another test script.  
Will post back.

Thanks
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;28&nbsp;03:27:54&nbsp;2008</span>
    <span class="description">MARKOV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Didn&#39;t get additional information after fixing the original problem, so
closing this ticket.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;28&nbsp;03:27:56&nbsp;2008</span>
    <span class="description">MARKOV [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;15&nbsp;04:23:55&nbsp;2008</span>
    <span class="description">gonullu [...] bluewin.ch -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> gonullu [...] bluewin.ch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry for the delay. I just continued to use 2.2.9

I am still having the problem:

I would like to add the following maybe it helps:

1. I have the problem in the body_string method
2. I am using SSL
3. The problem does not manifest itself on every call but *sometimes*
&#40;say 1/3 of the times&#41;

4. When I set Timeout =&gt; 0, it seems that it works... &#40;Timeout is 30s
per default&#41;

5. Here is the output with debug on

Sending: 5 UID FETCH 3 BODY.PEEK[TEXT]
Sent 31 bytes
LITERAL: received literal in line * 1 FETCH &#40;UID 3 BODY[TEXT] of length
310; attempting to retrieve from the 0 bytes in: &lt;END_OF_iBuffer&gt;
Received ret=310 and buffer = 

  
  In this section, the Fourier technique used in section 1 is expanced to
  the 2-dimensional grid. This method sets up an integral for this
  resistance between any two nodes, and a solution is found for the
  resistance across the diagonal of a single square &#40;between nodes &#40;0,0&#41;
  and &#40;1,1&#41; in Figure 2.
  
  
  &lt;END&gt;
while processing LITERAL
ERROR: Tag 5: Timeout after 30 seconds waiting for data from server
ERROR: Timeout after 30 seconds during read from server
ERROR: Unable to parse server response from 5 UID FETCH 3 BODY.PEEK[TEXT]
Could not retrieve body at imap-bug.pl line 260.






Thanks in advance


On Mon Apr 28 03:27:54 2008, MARKOV wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Didn&#39;t get additional information after fixing the original problem, so
&gt; closing this ticket.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;15&nbsp;04:23:57&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;16&nbsp;18:22:01&nbsp;2008</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #31655] get_header</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 17 May 2008 00:21:26 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Gonullu via RT &lt;bug-Mail-IMAPClient [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Gonullu via RT &#40;bug-Mail-IMAPClient@rt.cpan.org&#41; [080515 08:23]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=31655">http://rt.cpan.org/Ticket/Display.html?id=31655</a></span> &gt;
&gt; 
&gt; Sorry for the delay. I just continued to use 2.2.9
&gt; 
&gt; I am still having the problem:
&gt; I would like to add the following maybe it helps:
</div>
You have no idea how difficult debugging without access is...  It&#39;s
close to impossible to solve this, this way.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;22&nbsp;11:53:00&nbsp;2008</span>
    <span class="description">gonullu [...] bluewin.ch -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> gonullu [...] bluewin.ch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri May 16 18:22:01 2008, solutions@overmeer.net wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; You have no idea how difficult debugging without access is...  It&#39;s
&gt; close to impossible to solve this, this way.
</div>
Thanks for your help so far. I understand. It is not possible for me to
have you access the server.

I have the following findings:

in sub _read_line &#40;after the until at the beginning&#41; the first control
of timeout is relying on $self-&gt;{_select}-&gt;can_read returning a socket
which in my case &#40;IO::Socket::SSL&#41; is returning undef although that the
socket could be read. Replacing this with as it is done in another place
later:

my $rvec = 0;
vec&#40;$rvec, fileno&#40;$self-&gt;Socket&#41;, 1&#41; = 1;

unless&#40;CORE::select&#40;$rvec, undef, $rvec, $timeout&#41;&#41;
  {    $self-&gt;LastError&#40;&#34;Tag $transno: Timeout waiting for &#34;
                                 . &#34;literal data from server&#34;&#41;;
                             return undef;
  }

which should have the same effect works then okay.

I think it was already a problem in 2.2.9, but as the default value of
timeout was not set per default &#40;it is 30 sec now&#41;, this code was not
working at all

Regards,
  
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;23&nbsp;03:32:13&nbsp;2008</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #31655] get_header</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 23 May 2008 09:31:44 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Gonullu via RT &lt;bug-Mail-IMAPClient [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Gonullu via RT &#40;bug-Mail-IMAPClient@rt.cpan.org&#41; [080522 15:53]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have the following findings:
&gt; 
&gt; in sub _read_line &#40;after the until at the beginning&#41; the first control
&gt; of timeout is relying on $self-&gt;{_select}-&gt;can_read returning a socket
&gt; which in my case &#40;IO::Socket::SSL&#41; is returning undef although that the
&gt; socket could be read. Replacing this with as it is done in another place
&gt; later:
</div>
So, you mean:  &#40;around line 1300&#41;

    until&#40;@$oBuffer # there&#39;s stuff in output buffer:
      &#38;&#38; $oBuffer-&gt;[-1][TYPE] eq &#39;OUTPUT&#39; # that thing is an output line:
      &#38;&#38; $oBuffer-&gt;[-1][DATA] =~ /\r?\n$/ # the last thing there has cr-lf:
      &#38;&#38; !length $iBuffer                 # and the input buffer has been MT&#39;ed:    &#41;
    {   my $transno = $self-&gt;Transaction;

        if&#40;$timeout&#41;
 -      {   my @ready = $self-&gt;{_select}-&gt;can_read&#40;$timeout&#41;;
 -          unless&#40;@ready&#41;
 +      {   my $rvec = 0;
 +          vec&#40;$rvec, fileno&#40;$self-&gt;Socket&#41;, 1&#41; = 1;
 +          unless&#40;CORE::select&#40;$rvec, undef, $rvec, $timeout&#41;&#41;
            {   $self-&gt;LastError&#40;&#34;Tag $transno: Timeout after $timeout seconds&#34;
                    . &#34; waiting for data from server&#34;&#41;;

Internally, the can_read&#40;&#41; does

  sub can_read
  {
   my $vec = shift;
   my $timeout = shift;
   my $r = $vec-&gt;[VEC_BITS];

   defined&#40;$r&#41; &#38;&#38; &#40;select&#40;$r,undef,undef,$timeout&#41; &gt; 0&#41;
      ? handles&#40;$vec, $r&#41;
      : &#40;&#41;;
  }

Which probably all you do, is adding the error bits?
Do you get an error from the lower layers of SSL, for instance something
like &#34;connection not established &#40;yet&#41;&#34; ?  Just an idea.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;23&nbsp;10:11:04&nbsp;2008</span>
    <span class="description">gonullu [...] bluewin.ch -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> gonullu [...] bluewin.ch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri May 23 03:32:13 2008, Mark@Overmeer.net wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So, you mean:  &#40;around line 1300&#41;
&gt; 
&gt;     until&#40;@$oBuffer # there&#39;s stuff in output buffer:
&gt;       &#38;&#38; $oBuffer-&gt;[-1][TYPE] eq &#39;OUTPUT&#39; # that thing is an output
&gt; line:
&gt;       &#38;&#38; $oBuffer-&gt;[-1][DATA] =~ /\r?\n$/ # the last thing there has
&gt; cr-lf:
&gt;       &#38;&#38; !length $iBuffer                 # and the input buffer has
&gt; been MT&#39;ed:    &#41;
&gt;     {   my $transno = $self-&gt;Transaction;
&gt; 
&gt;         if&#40;$timeout&#41;
&gt;  -      {   my @ready = $self-&gt;{_select}-&gt;can_read&#40;$timeout&#41;;
&gt;  -          unless&#40;@ready&#41;
&gt;  +      {   my $rvec = 0;
&gt;  +          vec&#40;$rvec, fileno&#40;$self-&gt;Socket&#41;, 1&#41; = 1;
&gt;  +          unless&#40;CORE::select&#40;$rvec, undef, $rvec, $timeout&#41;&#41;
&gt;             {   $self-&gt;LastError&#40;&#34;Tag $transno: Timeout after $timeout
&gt; seconds&#34;
&gt;                     . &#34; waiting for data from server&#34;&#41;;
&gt; 
&gt; Internally, the can_read&#40;&#41; does
&gt; 
&gt;   sub can_read
&gt;   {
&gt;    my $vec = shift;
&gt;    my $timeout = shift;
&gt;    my $r = $vec-&gt;[VEC_BITS];
&gt; 
&gt;    defined&#40;$r&#41; &#38;&#38; &#40;select&#40;$r,undef,undef,$timeout&#41; &gt; 0&#41;
&gt;       ? handles&#40;$vec, $r&#41;
&gt;       : &#40;&#41;;
&gt;   }
&gt; 
&gt; Which probably all you do, is adding the error bits?
&gt; Do you get an error from the lower layers of SSL, for instance
&gt; something
&gt; like &#34;connection not established &#40;yet&#41;&#34; ?  Just an idea.
</div>
yes:

my $rvec = 0;
vec&#40;$rvec, fileno&#40;$self-&gt;Socket&#41;, 1&#41; = 1;
CORE::select&#40;$rvec, undef, undef, $timeout&#41; 

worked too the only difference is the initiation of $rvec.

Initiating as in &#40;per documentation the required way to initiate a bit
vector&#41;: 

$rvec = &#39;&#39;;


blocks and times out. Please not that this is used &#40;$rvec =0&#41;, later in
code around line 1336. It seems that this issue is not related to
Mail::IMAPClient but appreciate the help anyway...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;23&nbsp;13:37:35&nbsp;2008</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #31655] get_header</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 23 May 2008 17:06:56 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Gonullu via RT &lt;bug-Mail-IMAPClient [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Gonullu via RT &#40;bug-Mail-IMAPClient@rt.cpan.org&#41; [080523 14:11]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; $rvec = &#39;&#39;;
&gt; blocks and times out. Please not that this is used &#40;$rvec =0&#41;, later in
&gt; code around line 1336. It seems that this issue is not related to
&gt; Mail::IMAPClient but appreciate the help anyway...
</div>
Of course that times-out.
You are using SSL.  Are you passing the SSL socket with RawSocket
option?  I suspect that your IO::Select object is not initialized
correctly...  See the related parts in the man-page.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;26&nbsp;03:57:43&nbsp;2008</span>
    <span class="description">gonullu [...] bluewin.ch -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> gonullu [...] bluewin.ch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri May 23 13:37:35 2008, solutions@overmeer.net wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; * Gonullu via RT &#40;bug-Mail-IMAPClient@rt.cpan.org&#41; [080523 14:11]:
<div class="message-stanza open">&gt; &gt; $rvec = &#39;&#39;;
&gt; &gt; blocks and times out. Please not that this is used &#40;$rvec =0&#41;, later in
&gt; &gt; code around line 1336. It seems that this issue is not related to
&gt; &gt; Mail::IMAPClient but appreciate the help anyway...
</div>&gt; 
&gt; Of course that times-out.
&gt; You are using SSL.  Are you passing the SSL socket with RawSocket
&gt; option?  I suspect that your IO::Select object is not initialized
&gt; correctly...  See the related parts in the man-page.
</div>
Why should it ?
No but with Socket. The documentation don&#39;t say that RawSocket is the
only way to do SSL. Have I misunderstood?? This is how I am using it:

my $ssl= IO::Socket::SSL-&gt;new&#40;&#34;myserver.ch:993&#34;&#41;;
  die &#40;&#34;Error connecting - $@&#34;&#41; unless defined $ssl;
 
my $imap = Mail::IMAPClient-&gt;new&#40;
    User     =&gt; $user,
    Password =&gt;  $password,
    Debug    =&gt; 1,
    Peek     =&gt; 1,
    Socket   =&gt; $ssl,
    Timeout  =&gt; 60
   &#41; or die&#40;&#34;Could not connect to server&#34;&#41;; 

As I have said, setting Timeout to zero my program than works. 
With 2.2.9 I was explicitly calling -&gt;State etc... &#40;which what I have to
use with RawSocket I assume&#41;

Regards,
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;02&nbsp;04:29:12&nbsp;2008</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #31655] get_header</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 2 Jun 2008 10:28:55 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Gonullu via RT &lt;bug-Mail-IMAPClient [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Gonullu via RT &#40;bug-Mail-IMAPClient@rt.cpan.org&#41; [080526 07:57]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; my $imap = Mail::IMAPClient-&gt;new&#40;
&gt;     User     =&gt; $user,
&gt;     Password =&gt;  $password,
&gt;     Debug    =&gt; 1,
&gt;     Peek     =&gt; 1,
&gt;     Socket   =&gt; $ssl,
&gt;     Timeout  =&gt; 60
&gt;    &#41; or die&#40;&#34;Could not connect to server&#34;&#41;; 
&gt; 
&gt; As I have said, setting Timeout to zero my program than works. 
&gt; With 2.2.9 I was explicitly calling -&gt;State etc... &#40;which what I have to
&gt; use with RawSocket I assume&#41;
</div>
I am now quite sure that the problem is that the lower layers of
your socket implementation try to send you a message that something
is happening, which is not a client-side timeout.  Therefore, there
are no readable filehandles returned.

Your &#34;fix&#34; is working by accident.  The filehandle of the complaining
socket will be returned because you listen to the exception handles
as well.  But then the rest of the function continues accessing it,
not handling the exception.

So: the real fix must understand the reason for the exception or you
should find the cause of the exception in your system.  Your current
patch may break systems of other users, which prefer to be informed
about problem instead of ignoring them.

For further investigation, see system man-pages feof/ferror and Perl
function eof&#40;&#41;.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;02&nbsp;04:03:58&nbsp;2008</span>
    <span class="description">MARKOV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">if you are not investigating the problem any further, I cannot help you.
 So, unless there is some contuation I will close the ticket.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;01&nbsp;05:00:32&nbsp;2008</span>
    <span class="description">MARKOV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">As you are unwilling to help me any further, I close the ticket.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;01&nbsp;05:00:36&nbsp;2008</span>
    <span class="description">MARKOV [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
