<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #33196 for CPAN-Site: CPAN::Site::Index::cpan_index&#40;&#41; is registering packages that are not provided by a distro</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #33196 for CPAN-Site: CPAN::Site::Index::cpan_index&#40;&#41; is registering packages that are not provided by a distro</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/CPAN-Site/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/CPAN-Site/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/CPAN-Site/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/CPAN-Site/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/CPAN-Site">CPAN-Site CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">33196</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">1.5 hours (90 min)

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/CPAN-Site/Active/">CPAN-Site</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
matisse [...] spamcop.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-8220-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.17    </td>
  </tr>
  <tr id="CF-8221-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;12&nbsp;15:37:35&nbsp;2008</span>
    <span class="description">matisse [...] spamcop.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> CPAN::Site::Index::cpan_index&#40;&#41; is registering packages that are
 not provided by a distro</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">CPAN::Site::Index::cpan_index&#40;&#41; is incorrectly registering packages that
come from .pm files that are not actually &#34;provided&#34; by a distro.

Example:

  <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~marcel/Test-Compile-0.08/">http://search.cpan.org/~marcel/Test-Compile-0.08/</a></span>

contains the following:

 <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/src/MARCEL/Test-Compile-0.08/inc/Test/Pod/Coverage.pm">http://search.cpan.org/src/MARCEL/Test-Compile-0.08/inc/Test/Pod/Coverage.pm</a></span>

and that file contains these two lines:

   package Test::Pod::Coverage;
   our $VERSION = &#34;1.08&#34;;

this causes CPAN::Site::Index::cpan_index&#40;&#41; to register that package as
&#34;belonging&#34; to Test-Compile-0.08 which is not really true.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;12&nbsp;18:30:51&nbsp;2008</span>
    <span class="description">matisse [...] spamcop.net -  Correspondence added</span>
    <span class="time-taken">90 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I may have a patch for this - I need to get permission from $work to
post it first.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;12&nbsp;18:30:54&nbsp;2008</span>
    <span class="description">matisse [...] spamcop.net -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;12&nbsp;21:50:24&nbsp;2008</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33196] CPAN::Site::Index::cpan_index&#40;&#41; is registering packages that are not provided by a distro</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 12 Feb 2008 22:22:53 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Matisse Enzer via RT &lt;bug-CPAN-Site [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Matisse Enzer via RT &#40;bug-CPAN-Site@rt.cpan.org&#41; [080212 20:37]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Tue Feb 12 15:37:35 2008: Request 33196 was acted upon.
&gt; Transaction: Ticket created by MATISSE
&gt;        Queue: CPAN-Site
&gt;      Subject: CPAN::Site::Index::cpan_index&#40;&#41; is registering packages that are
&gt;  not provided by a distro
&gt; 
&gt; CPAN::Site::Index::cpan_index&#40;&#41; is incorrectly registering packages that
&gt; come from .pm files that are not actually &#34;provided&#34; by a distro.
&gt; 
&gt; Example:
&gt;   <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~marcel/Test-Compile-0.08/">http://search.cpan.org/~marcel/Test-Compile-0.08/</a></span>
&gt; 
&gt; contains the following:
&gt;  <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/src/MARCEL/Test-Compile-0.08/inc/Test/Pod/Coverage.pm">http://search.cpan.org/src/MARCEL/Test-Compile-0.08/inc/Test/Pod/Coverage.pm</a></span>
&gt; 
&gt; and that file contains these two lines:
&gt; 
&gt;    package Test::Pod::Coverage;
&gt;    our $VERSION = &#34;1.08&#34;;
</div>
cpan-site takes the official module index from the real CPAN, and
mergers this with the modules found in your local set-up.  From your
description, I do not get an indication that this Test-Compile module
is on you own system.

I know that the normal CPAN indexer is quite blunt as well: it does
detect that you try to reuse a package which is already used by someone
else, and gives an error upon it.  Even if you use .pm&#39;s in your tests.

So: is this a CPAN::Site problem?
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
drs Mark A.C.J. Overmeer                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;12&nbsp;23:03:28&nbsp;2008</span>
    <span class="description">matisse [...] spamcop.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Feb 12 21:50:24 2008, Mark@Overmeer.net wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; cpan-site takes the official module index from the real CPAN, and
&gt; mergers this with the modules found in your local set-up.  From your
&gt; description, I do not get an indication that this Test-Compile module
&gt; is on you own system.
</div>
My fault - Test-Compile is in fact in our local, mini-cpan, and we are
using CPAN::Site::Index to index that mini-cpan.

 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I know that the normal CPAN indexer is quite blunt as well: it does
&gt; detect that you try to reuse a package which is already used by
&gt; someone
&gt; else, and gives an error upon it.  Even if you use .pm&#39;s in your
&gt; tests.
</div>
I&#39;m guessing that the normal CPAN indexer has some way of ignoring .pm
files that are not in a lib/ directory or at the top-level of the distro
&#40;this is the approach my patch takes.&#41;

 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So: is this a CPAN::Site problem?
</div>
I think it&#39;s fair to change CPAN::Site to not index .pm files that are
not in the distros&#39; lib/ directory or at the top level of the distro -
does that seem reasonable?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;13&nbsp;03:20:19&nbsp;2008</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33196] CPAN::Site::Index::cpan_index&#40;&#41; is registering packages that are not provided by a distro</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 13 Feb 2008 09:19:54 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Matisse Enzer via RT &lt;bug-CPAN-Site [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Matisse Enzer via RT &#40;bug-CPAN-Site@rt.cpan.org&#41; [080213 04:03]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; My fault - Test-Compile is in fact in our local, mini-cpan, and we are
&gt; using CPAN::Site::Index to index that mini-cpan.
</div>ok.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m guessing that the normal CPAN indexer has some way of ignoring .pm
&gt; files that are not in a lib/ directory or at the top-level of the distro
&gt; &#40;this is the approach my patch takes.&#41;
</div>
It seems to be fixed, not too long ago.  I had some test packages
myself, which were index... but on the moment, they are not anymore.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; So: is this a CPAN::Site problem?
</div>&gt; 
&gt; I think it&#39;s fair to change CPAN::Site to not index .pm files that are
&gt; not in the distros&#39; lib/ directory or at the top level of the distro -
&gt; does that seem reasonable?
</div>
There is no rule where to put installed files in the directory tree, so
it is not that easy... although it is clear which directories to exclude.

For performance reasons, CPAN::Site is bluntly scanning the tar file
for lines which start with &#39;package&#39;.  Of course, a better implementation
is possible, which usually involve the slow unpacking of the tar...
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;19&nbsp;12:15:15&nbsp;2008</span>
    <span class="description">matisse [...] spamcop.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> matisse [...] spamcop.net</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I finally got approval this morning from $work to post the patch I made
&#40;attached to this comment.&#41;

We are using it at work and it fixes the problem.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- Index.pm.dist	2008-01-31 12:26:30.000000000 -0800
+++ Index.pm	2008-02-12 15:12:27.000000000 -0800
@@ -3,12 +3,11 @@
 # See the manual pages for details on the licensing terms.
 # Pod stripped from pm file by OODoc 1.03.
 
+package CPAN::Site::Index;
 use warnings;
 use strict;
 
-package CPAN::Site::Index;
-use vars &#39;$VERSION&#39;;
-$VERSION = &#39;0.17&#39;;
+our $VERSION = &#39;0.172&#39;;
 use base &#39;Exporter&#39;;
 our @EXPORT_OK = qw/cpan_index/;
 
@@ -125,8 +124,10 @@
 {  my &#40;$package, $version, $dist&#41; = @_;
    print &#34;reg&#40;@_&#41;\n&#34; if $debug;
 
+   my $registered_version = $findpkgs-&gt;{$package}[0] || &#39;&#39;;
+
    return if exists $findpkgs-&gt;{$package}
-          &#38;&#38; $findpkgs-&gt;{$package}[0] ge $version;
+          &#38;&#38; $registered_version ge $version;
 
    $findpkgs-&gt;{$package} = [ $version, $dist ];
 }
@@ -160,6 +161,8 @@
    my $in_buf    = &#39;&#39;;
    my $out_buf   = &#39;&#39;;
    my $readme_fh;
+   my $tarball_name = basename $dist;
+   my &#40;$dist_name&#41; = &#40; $tarball_name =~ / &#40;.*&#41; \.tar\.gz /x &#41;;
 
 BLOCK:
    while &#40;$fh-&gt;sysread&#40;$in_buf, 512&#41;&#41;
@@ -167,6 +170,12 @@
       if&#40;$in_buf =~ /^&#40;\S*?&#41;\0/&#41;
       {
           $file = $1;
+          if &#40; ! length $file &#41; {
+            next BLOCK;
+          }
+          if &#40; $file !~ /^$dist_name/ &#41; {
+            next BLOCK;
+          }
 
 # when the package contains non-text files, this produces garbage
 #         print &#34;file=$file\n&#34; if $debug &#38;&#38; length $file;
@@ -177,8 +186,7 @@
 #            my $outputfn = File::Spec-&gt;catfile&#40;$File::Find::dir, $readme_file&#41;;
 #            $outputfn =~ s/\bREADME$/\.readme/;
 
-             my $readmefn = basename $dist;
-             $readmefn =~ s/\.tar\.gz/\.readme/;
+             my $readmefn = $dist_name . &#39;.readme&#39;;
              my $outputfn = File::Spec-&gt;catfile&#40;$File::Find::dir, $readmefn&#41;;
              print &#34;README full path &#39;$outputfn&#39;\n&#34; if $debug;
 
@@ -206,6 +214,7 @@
       while &#40;$out_buf =~ s/^&#40;[^\n]*&#41;\n//&#41;
       {
          local $_ = $1;
+         local $VERSION;
          if&#40; m/^\s* package \s* &#40;&#40;\w+\:\:&#41;*\w+&#41; \s* ;/x &#41;
          {  $package = $1;
             print &#34;package=$package\n&#34; if $debug;
@@ -214,13 +223,41 @@
          {  $version = eval &#34;my \$v = $1&#34;;
             print &#34;version=$version\n&#34; if $debug;
 
-            register $package, $version, $dist
-                if $file &#38;&#38; $file =~ m/\.pm$/ &#38;&#38; $package;
+            if &#40; ok_to_register&#40;$package,$file&#41; &#41;
+            {
+              register $package, $version, $dist;
+            }
          }
       }
    }
 }
 
+sub ok_to_register&#40;$$&#41;
+{
+  my &#40;$package,$path&#41; = @_;
+
+  if &#40; ! $path &#41;
+  {
+    return;
+  }
+
+  if &#40; $path !~ m/\.pm$/ &#41;
+  {
+    return;
+  }
+
+  if &#40; ! $package &#41; {
+    return;
+  }
+
+  if &#40; ! path_is_in_lib_or_at_top_level&#40;$path&#41; &#41;
+  {
+    return;
+  }
+
+  return 1;
+}
+
 sub merge_core_cpan&#40;$$$&#41;
 {   my &#40;$cpan, $pkgs, $bigcpan_url&#41; = @_;
 
@@ -267,12 +304,12 @@
    my $module      = __PACKAGE__;
    $fh-&gt;print &#40;&lt;&lt;__HEADER&#41;;
 File:         02packages.details.txt
-URL:          file:$details
+URL:          file://$details
 Description:  Packages listed in CPAN and local repository
 Columns:      package name, version, path
 Intended-For: Standard CPAN with additional private resources
 Line-Count:   $lines
-Written-By:   $program with $module $VERSION &#40;$how&#41;
+Written-By:   $program with $module $CPAN::Site::Index::VERSION &#40;$how&#41;
 Last-Updated: $date
 
 __HEADER
@@ -376,4 +413,23 @@
    $ftp-&gt;close;
 }
 
+sub path_is_in_lib_or_at_top_level&#40;$&#41;
+{
+  my &#40;$path&#41; = @_;
+
+  my @path_parts = File::Spec-&gt;splitdir&#40;$path&#41;;
+  if &#40; ! defined $path_parts[0] &#41; {
+    warn &#34;no parts in &#39;$path&#39;&#34;;
+  }
+  my $second_thing_in_path = $path_parts[1] || &#39;&#39;;
+  if &#40; $second_thing_in_path eq &#39;lib&#39; &#41; {
+    # path is in lib directory
+    return 1;
+  }
+  if &#40; @path_parts == 2 &#41; {
+    # path is at top-level of distro
+    return 1;
+  }
+  return;
+}
 1;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;19&nbsp;12:25:54&nbsp;2008</span>
    <span class="description">matisse [...] spamcop.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I realize that you may want to use different rules for deciding what
package names to register. In the patch the new subroutine:

  ok_to_register&#40;&#41;

handles that logic, so that could be changed to use different rules, for
example, excluding files in the t/ directory.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;19&nbsp;17:50:22&nbsp;2008</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33196] CPAN::Site::Index::cpan_index&#40;&#41; is registering packages that are not provided by a distro</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 19 Feb 2008 23:50:00 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Matisse Enzer via RT &lt;bug-CPAN-Site [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Matisse Enzer via RT &#40;bug-CPAN-Site@rt.cpan.org&#41; [080219 17:15]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=33196">http://rt.cpan.org/Ticket/Display.html?id=33196</a></span> &gt;
&gt; We are using it at work and it fixes the problem.
</div>
+package CPAN::Site::Index;
 use warnings;
 use strict;
-package CPAN::Site::Index;

warnings and strict have file scope, so you can safely start a
file with it.

-use vars &#39;$VERSION&#39;;
-$VERSION = &#39;0.17&#39;;
+our $VERSION = &#39;0.172&#39;;

Is this change really needed?  local $VERSION also works for &#34;our&#34;,
isn&#39;t it?

I rewrote your logic into my coding-style.   It seems logical.
-- 
Thanks for your contribution! 

               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;19&nbsp;20:04:37&nbsp;2008</span>
    <span class="description">matisse [...] matisse.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33196] CPAN::Site::Index::cpan_index&#40;&#41; is registering packages that are not provided by a distro</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 19 Feb 2008 17:02:55 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CPAN-Site [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Matisse Enzer &lt;matisse [...] matisse.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On Feb 19, 2008, at 2:50 PM, Mark Overmeer via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; +package CPAN::Site::Index;
&gt; use warnings;
&gt; use strict;
&gt; -package CPAN::Site::Index;
&gt;
&gt; warnings and strict have file scope, so you can safely start a
&gt; file with it.
&gt;
&gt; -use vars &#39;$VERSION&#39;;
&gt; -$VERSION = &#39;0.17&#39;;
&gt; +our $VERSION = &#39;0.172&#39;;
&gt;
&gt; Is this change really needed?  local $VERSION also works for &#34;our&#34;,
&gt; isn&#39;t it?
</div>
&#34;our&#34; is different from &#34;local&#34; &#40;i&#39;m pretty sure you know that!&#41; - it  
declares the variable as a package variable, so in this case

   our $VERSION = &#39;0.111&#39;;

means:

    $CPAN::Site::Index::VERSION = &#39;0.111&#39;;

which is bit different from what &#39;use vars&#39; does.

One of the changes I made was this:

-Written-By:   $program with $module $VERSION &#40;$how&#41;
+Written-By:   $program with $module $CPAN::Site::Index::VERSION &#40;$how&#41;

the way I did it there is less chance of the wrong value being used  
for the version.

It&#39;s really not a big deal at all and i am not offended in any way if  
you ignore this part :-&#41;


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I rewrote your logic into my coding-style.   It seems logical.
</div>
No problem!  I tried to copy the coding style that was present but  
obviously I ended up introducing a different style and it is best to  
keep only one style per file!

-M

-------------------------------------------------------
Matisse Enzer &lt;matisse@matisse.net&gt;
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.matisse.net/">http://www.matisse.net/</a></span>  - <span class="clickylink"><a target="new" rel="nofollow" href="http://www.eigenstate.net/">http://www.eigenstate.net/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;20&nbsp;02:58:35&nbsp;2008</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33196] CPAN::Site::Index::cpan_index&#40;&#41; is registering packages that are not provided by a distro</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 20 Feb 2008 08:57:57 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Matisse Enzer via RT &lt;bug-CPAN-Site [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Matisse Enzer via RT &#40;bug-CPAN-Site@rt.cpan.org&#41; [080220 01:04]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; -use vars &#39;$VERSION&#39;;
&gt; &gt; -$VERSION = &#39;0.17&#39;;
&gt; &gt; +our $VERSION = &#39;0.172&#39;;
&gt; &gt;
&gt; &gt; Is this change really needed?  local $VERSION also works for &#34;our&#34;,
&gt; &gt; isn&#39;t it?
</div>&gt; 
&gt; &#34;our&#34; is different from &#34;local&#34; &#40;i&#39;m pretty sure you know that!&#41; - it  
&gt; declares the variable as a package variable, so in this case
&gt; 
&gt;    our $VERSION = &#39;0.111&#39;;
&gt; means:
&gt;     $CPAN::Site::Index::VERSION = &#39;0.111&#39;;
&gt; 
&gt; which is bit different from what &#39;use vars&#39; does.
</div>
AFAIK, there is a difference between &#34;our&#34; and &#34;use vars&#34;, which came
up last week by a posting on perl5-porters: the our declares a global
variable with file-scope, not package scope.  However, for processing,
there is no difference: it is just an as valid way of avoiding an
error by strictness... and nicer.

An additional &#34;problem&#34; is that the $VERSION is added by OODoc, when
the packages are processed to create the distribution man-pages and 
code.  I got fed-up maintaining those, so they are automatically
taken from the Makefile.PL

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; One of the changes I made was this:
&gt; -Written-By:   $program with $module $VERSION &#40;$how&#41;
&gt; +Written-By:   $program with $module $CPAN::Site::Index::VERSION &#40;$how&#41;
&gt; 
&gt; the way I did it there is less chance of the wrong value being used  
&gt; for the version.
</div>
Although at compile-time is determined which package is used to take
the $VERSION from, there are too many &#34;versions&#34; in the context and
therefore this clarifies the code.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;20&nbsp;11:53:14&nbsp;2008</span>
    <span class="description">matisse [...] matisse.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33196] CPAN::Site::Index::cpan_index&#40;&#41; is registering packages that are not provided by a distro</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 20 Feb 2008 08:52:18 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CPAN-Site [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Matisse Enzer &lt;matisse [...] matisse.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On Feb 19, 2008, at 11:58 PM, Mark Overmeer via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; AFAIK, there is a difference between &#34;our&#34; and &#34;use vars&#34;, which came
&gt; up last week by a posting on perl5-porters: the our declares a global
&gt; variable with file-scope, not package scope.
</div>

I believe this is incorrect - &#34;our&#34; declares in package-scope,  
&#34;my&#34;  &#40;and &#34;local&#34;&#41; are lexical.

Consider the following two small files:


#---- File ModuleA.pm -----
package Foo;
use strict;
use warnings;

our $A = &#39;hello from package &#39; . __PACKAGE__;

#-------------------------------------------------------------------------------
package Bar;
our $A = &#39;another hello from package &#39; . __PACKAGE__;
#-------------------------------------------------------------------------------
package Baz;
our $A = &#39;and a final hello from package &#39; . __PACKAGE__;
#-------------------------------------------------------------------------------
1;

#--- File test_our.pl ----
use strict;
use warnings;
use ModuleA;

print &#34;Foo: $Foo::A\n&#34;;
print &#34;Bar: $Bar::A\n&#34;;
print &#34;Baz: $Baz::A\n&#34;;

exit;
#--------

The run the command line:

      perl test_our.pl

and you get:

  Foo: hello from package Foo
  Bar: another hello from package Bar
  Baz: and a final hello from package Baz
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;20&nbsp;16:36:09&nbsp;2008</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33196] CPAN::Site::Index::cpan_index&#40;&#41; is registering packages that are not provided by a distro</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 20 Feb 2008 20:45:34 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Matisse Enzer via RT &lt;bug-CPAN-Site [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Matisse Enzer via RT &#40;bug-CPAN-Site@rt.cpan.org&#41; [080220 16:53]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I believe this is incorrect - &#34;our&#34; declares in package-scope,  
&gt; &#34;my&#34;  &#40;and &#34;local&#34;&#41; are lexical.
</div>
Exactly as I expect.
Try this:  :-&#41;

use strict;
use warnings;

package Foo;

our $A = &#39;hello from &#39;. __PACKAGE__;
my $C = &#39;1&#39;;

package Bar;
$A = &#39;final hello from package &#39; . __PACKAGE__;
$B = &#39;aap&#39;;  # comment this to get it to work, see effect our $A

package main;
print &#34;Foo: $Foo::A\n&#34;;
print &#34;Bar: $Bar::A\n&#34;;
print &#34;C=$C\n&#34;;

-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;20&nbsp;23:12:20&nbsp;2008</span>
    <span class="description">matisse [...] matisse.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33196] CPAN::Site::Index::cpan_index&#40;&#41; is registering packages that are not provided by a distro</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 20 Feb 2008 20:11:50 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CPAN-Site [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Matisse Enzer &lt;matisse [...] matisse.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On Feb 20, 2008, at 1:36 PM, Mark Overmeer via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Exactly as I expect.
&gt; Try this:  :-&#41;
&gt;
&gt; use strict;
&gt; use warnings;
&gt;
&gt; package Foo;
&gt;
&gt; our $A = &#39;hello from &#39;. __PACKAGE__;
&gt; my $C = &#39;1&#39;;
&gt;
&gt; package Bar;
&gt; $A = &#39;final hello from package &#39; . __PACKAGE__;
&gt; $B = &#39;aap&#39;;  # comment this to get it to work, see effect our $A
&gt;
&gt; package main;
&gt; print &#34;Foo: $Foo::A\n&#34;;
&gt; print &#34;Bar: $Bar::A\n&#34;;
&gt; print &#34;C=$C\n&#34;;
</div>
OK - I see what you mean - the line:

   $A = &#39;final hello from package &#39; . __PACKAGE__;

is using the same $A declared with &#39;our&#39; earlier, so you are right,  
the &#39;our&#39; doesn&#39;t change the lexical scope of $A, it simply puts it in  
the Foo:: namespace &#40;unlike $B which is not in the Bar:: namespace.&#41;


-------------------------------------------------------
Matisse Enzer &lt;matisse@matisse.net&gt;
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.matisse.net/">http://www.matisse.net/</a></span>  - <span class="clickylink"><a target="new" rel="nofollow" href="http://www.eigenstate.net/">http://www.eigenstate.net/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;19&nbsp;13:11:57&nbsp;2008</span>
    <span class="description">matisse [...] spamcop.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> matisse [...] spamcop.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Any idea when 0.18 will be released?
I want to demo our build system and would like to do it using an
&#34;official&#34; CPAN::Site distro instead of our local monkey-patched version.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;19&nbsp;13:38:32&nbsp;2008</span>
    <span class="description">MARKOV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">As you wish: I have just uploaded 0.18.  Hopefully without bugs, because
I didn&#39;t have the chance to use it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;19&nbsp;13:38:35&nbsp;2008</span>
    <span class="description">MARKOV [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;20&nbsp;11:06:49&nbsp;2008</span>
    <span class="description">matisse [...] spamcop.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> matisse [...] spamcop.net</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Mar 19 13:38:32 2008, MARKOV wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As you wish: I have just uploaded 0.18.  Hopefully without bugs, because
&gt; I didn&#39;t have the chance to use it.
</div>
Looks like a tiny bug snuck in.

Attached patch fixes it
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- /usr/local/CPAN/build/CPAN-Site-0.18-o0XBBH/lib/CPAN/Site/Index.pm	2008-03-19 10:35:45.000000000 -0700
+++ /Library/Perl/5.8.8/CPAN/Site/Index.pm	2008-03-20 08:00:27.000000000 -0700
@@ -194,7 +194,7 @@
 #            my $outputfn = File::Spec-&gt;catfile&#40;$File::Find::dir,$readme_file&#41;;
 #            $outputfn =~ s/\bREADME$/\.readme/;
 
-             my $readmefn = &#34;$distname.readme&#34;;
+             my $readmefn = &#34;$dist_name.readme&#34;;
              my $outputfn = File::Spec-&gt;catfile&#40;$File::Find::dir, $readmefn&#41;;
              print &#34;README full path &#39;$outputfn&#39;\n&#34; if $debug;

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;20&nbsp;11:06:53&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;21&nbsp;03:15:44&nbsp;2008</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33196] CPAN::Site::Index::cpan_index&#40;&#41; is registering packages that are not provided by a distro</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 21 Mar 2008 08:15:12 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Matisse Enzer via RT &lt;bug-CPAN-Site [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Matisse Enzer via RT &#40;bug-CPAN-Site@rt.cpan.org&#41; [080320 15:06]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt;        Queue: CPAN-Site
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=33196">http://rt.cpan.org/Ticket/Display.html?id=33196</a></span> &gt;
&gt; 
&gt; On Wed Mar 19 13:38:32 2008, MARKOV wrote:
<div class="message-stanza open">&gt; &gt; As you wish: I have just uploaded 0.18.  Hopefully without bugs, because
&gt; &gt; I didn&#39;t have the chance to use it.
</div>&gt; 
&gt; Looks like a tiny bug snuck in.
&gt; Attached patch fixes it
</div>
Released as 0.20
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;26&nbsp;09:51:47&nbsp;2008</span>
    <span class="description">MARKOV [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
