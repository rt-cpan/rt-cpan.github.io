<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #108908 for Net-DNS: Installing recent version gets shadowed by old version</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #108908 for Net-DNS: Installing recent version gets shadowed by old version</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-DNS/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-DNS/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-DNS/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-DNS/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-DNS">Net-DNS CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">108908</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-DNS/Active/">Net-DNS</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ether [...] cpan.org

<br />
KENTNL [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
DBOOK [...] cpan.org

<br />
ribasushi [...] leporine.io

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-22454-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.03    </td>
  </tr>
  <tr id="CF-22455-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;13&nbsp;22:48:52&nbsp;2015</span>
    <span class="description">KENTNL [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Installing recent version gets shadowed by old version</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza"><p>
	Somewhere between 0.83 and the current version, it appears the location Net::DNS installs to gets changed.</p>

<p>
	On version 0.83, it installs to &quot;${site}/${arch}/&lt;&gt;&quot; but on 1.03 it installs to &quot;${site}/&lt;&gt;&quot;</p>

<p>
	Which is unfortunate, because the former shadows the later, so even after upgrading, the upgraded version is not seen in @INC, only the older version.<br>

	<br>

	Fortunately, there is a cure.</p>

<p>
	Here&#39;s some code by HAARG++ <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/HAARG/Devel-GlobalDestruction-0.13/Makefile.PL#L75-88">https://metacpan.org/source/HAARG/Devel-GlobalDestruction-0.13/Makefile.PL#L75-88</a></span></p>

<p>
	That example code checks for an older version of itself, and if a version older than a certain age is found, it appends code to make to request the removal of the ${arch} version so that it doesn&#39;t get shadowed.<br>

	<br>

	This is not a blanket &quot;find and delete&quot;, but it only deletes the problem file from the arch directory corresponding to the install target.</p>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;08&nbsp;16:53:22&nbsp;2015</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Nov 13 22:48:52 2015, KENTNL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Somewhere between 0.83 and the current version, it appears the
&gt; location
&gt; Net::DNS installs to gets changed.
&gt; 
&gt; On version 0.83, it installs to &#34;${site}/${arch}/&lt;&gt;&#34; but on 1.03 it
&gt; installs to
&gt; &#34;${site}/&lt;&gt;&#34;
&gt; 
&gt; Which is unfortunate, because the former shadows the later, so even
&gt; after
&gt; upgrading, the upgraded version is not seen in @INC, only the older
&gt; version.
</div>
This is really a library management tool issue which arises because the compiled XS code has been removed in 1.00+. This fell into disuse long ago, but was retained until the principal version number changed, minimising the impact of the problem you describe.

It is not unreasonable to expect to perform a clean install when passing 1.00


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Fortunately, there is a cure.
&gt; 
&gt; Here&#39;s some code by HAARG++
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/HAARG/Devel-GlobalDestruction-">https://metacpan.org/source/HAARG/Devel-GlobalDestruction-</a></span>
&gt; 0.13/Makefile.PL#L75-88
&gt; 
&gt; That example code checks for an older version of itself, and if a
&gt; version older
&gt; than a certain age is found, it appends code to make to request the
&gt; removal of
&gt; the ${arch} version so that it doesn&#39;t get shadowed.
&gt; 
&gt; This is not a blanket &#34;find and delete&#34;, but it only deletes the
&gt; problem file
&gt; from the arch directory corresponding to the install target.
</div>
Attempting to compete with &#34;proper&#34; installation tools risks leaving a trail of wrecked libraries or other unintended consequences.  Better not to go there.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;08&nbsp;16:53:23&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;08&nbsp;17:06:45&nbsp;2015</span>
    <span class="description">KENTNL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza"><p>
	On 2015-12-09 10:53:22, rwfranks@acm.org wrote:<br>

	&gt; It is not unreasonable to expect to perform a clean install when<br>

	&gt; passing 1.00</p>

<p>
	I personally find &quot;You can&#39;t upgrade, you must install a fresh perl and start over&quot; very much within the grounds of unreasonable.</p>

<p>
	Reinstalling *thousands* of modules just because Net::DNS released an update is very much non-great.</p>

<p>
	I&#39;d imagine anybody presented with the choice between &quot;Just delete this file&quot; and &quot;Reinstall perl and &gt;1000 modules&quot; will choose the former.<br>

	<br>

	<br>

	&gt; Attempting to compete with &quot;proper&quot; installation tools risks leaving a<br>

	&gt; trail of wrecked libraries or other unintended consequences. Better<br>

	&gt; not to go there.<br>

	<br>

	It doesn&#39;t exactly &quot;compete&quot; with &quot;proper&quot; installation tools.</p>

<p>
	It literally just adds a rule to the makefile that nukes an older version from $TARGET_DIR</p>

<p>
	&quot;Proper&quot; installation tools are more likely to have a managed system where $TARGET_DIR is an empty directory which is then applied to the final system using file-management techniques, as well as having shadow-removal an inherent feature of their toolkit. ( Removing previous generation cleanly removes the unwanted file )</p>

<p>
	And its worth noting that this technique in use by Devel::GlobalDestruction very much should be taken under consideration, given the maintainers of that module are part of our toolchain hackers, and given that module is used by Moose and Moo, and given those Modules are presently replicated to *many* Linux distros with &quot;proper&quot; installer tools, I&#39;d imagine if it was a problem there we&#39;d have found it already.</p>

<p>
	Of course, I&#39;m all for measuring potential risks and making careful steps so that we don&#39;t make a bigger mess, but we have to know specifically what problems you&#39;re afraid will happen and then work out if they&#39;re really a problem or not.<br>

	<br>

	&nbsp;</p>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;14&nbsp;16:46:13&nbsp;2015</span>
    <span class="description">ether [...] cpan.org -  Requestor ETHER added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;17&nbsp;11:01:06&nbsp;2015</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Dec 08 17:06:45 2015, KENTNL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2015-12-09 10:53:22, rwfranks@acm.org wrote:
<div class="message-stanza open">&gt; &gt; It is not unreasonable to expect to perform a clean install when
&gt; &gt; passing 1.00
</div>&gt; 
&gt; I personally find &#34;You can&#39;t upgrade, you must install a fresh perl
&gt; and start
&gt; over&#34; very much within the grounds of unreasonable.
&gt; 
&gt; Reinstalling *thousands* of modules just because Net::DNS released an
&gt; update is
&gt; very much non-great.
&gt; 
&gt; I&#39;d imagine anybody presented with the choice between &#34;Just delete
&gt; this file&#34;
&gt; and &#34;Reinstall perl and &gt;1000 modules&#34; will choose the former.
&gt;
</div>
If &#34;just delete this file&#34; is what you need to do, just do that.

However, that is an entirely different proposition from possibly inflicting automated collateral damage on thousands of unsuspecting users.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It doesn&#39;t exactly &#34;compete&#34; with &#34;proper&#34; installation tools.
&gt; 
&gt; It literally just adds a rule to the makefile that nukes an older
&gt; version from $TARGET_DIR
</div>
Many times in my &#40;long&#41; career I have heard &#34;but it just ...&#34; which heralded some entirely avoidable catastrophe. 


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Of course, I&#39;m all for measuring potential risks and making careful
&gt; steps so
&gt; that we don&#39;t make a bigger mess, but we have to know specifically
&gt; what
&gt; problems you&#39;re afraid will happen and then work out if they&#39;re really
&gt; a
&gt; problem or not.
</div>
There are too many different tools and upgrade scenarios out there to guess what the possible problems may be.  Neither am I keen to jump into that particular snake pit.

There is, and needs to be, a clear separation of concerns between developer and installer.  The demarcation point is widely recognised to be the CPAN library.

The developer&#39;s mission is to produce a library component in the shape required for a clean install to work and pass all the installation tests.

The toolchain, with possible user intervention, takes responsibility for carrying that recipe into effect.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;17&nbsp;11:27:29&nbsp;2015</span>
    <span class="description">rt-cpan [...] trout.me.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Dec 17 11:01:06 2015, rwfranks@acm.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The toolchain, with possible user intervention, takes responsibility
&gt; for carrying that recipe into effect.
</div>
The toolchain has an option for this - UNINST=1 / --uninst=1 - but for various reasons many users choose not to set this.

What I would suggest is to detect that the currently installed Net::DNS is in an arch dir, and if UNINST=1 hasn&#39;t been passed, have Makefile.PL die with an informative error message that requires the user either to pass UNINST=1 or to promise that they&#39;ll fix it themselves by setting e.g. NET_DNS_INSTALL_ANYWAY=1 &#40;name made up on the spot, no particular recommendation implied&#41;

That will mean that clean installs will work exactly as they currently do, but a user about to descend into madness unexpectedly will get a chance to decide what they want to happen.

If you&#39;re willing to accept a patch for this but don&#39;t feel it&#39;s something you want to write yourself, I&#39;m sure we could find a volunteer to do so.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;17&nbsp;20:45:53&nbsp;2015</span>
    <span class="description">ribasushi [...] leporine.io -  Cc RIBASUSHI added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;30&nbsp;12:58:03&nbsp;2015</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Dec 17 11:27:29 2015, MSTROUT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; What I would suggest is to detect that the currently installed
&gt; Net::DNS is in an arch dir, and if UNINST=1 hasn&#39;t been passed, have
&gt; Makefile.PL die with an informative error message that requires the
&gt; user either to pass UNINST=1 or to promise that they&#39;ll fix it
&gt; themselves by setting e.g. NET_DNS_INSTALL_ANYWAY=1 &#40;name made up on
&gt; the spot, no particular recommendation implied&#41;
</div>
Adding a prominent warning message seems a reasonable suggestion.

 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; That will mean that clean installs will work exactly as they currently
&gt; do, but a user about to descend into madness unexpectedly will get a
&gt; chance to decide what they want to happen.
</div>
As they should

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; If you&#39;re willing to accept a patch for this but don&#39;t feel it&#39;s
&gt; something you want to write yourself, I&#39;m sure we could find a
&gt; volunteer to do so.
</div>
No real need to abort the installation process in this situation. Deleting the arch directory can be done afterwards.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;30&nbsp;16:31:43&nbsp;2015</span>
    <span class="description">KENTNL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza"><p>
	On 2015-12-31 06:58:03, rwfranks@acm.org wrote:<br>

	&gt; No real need to abort the installation process in this situation.<br>

	&gt; Deleting the arch directory can be done afterwards.<br>

	<br>

	If somebody depends on a minimum version of Net::DNS that is larger than the version which this transition occurred at, then everything in the subsequent dependency graph can be expected to fail in unpredictable ways which the people who declare those dependencies cannot solve.</p>

<p>
	&nbsp;</p>

<p>
	Which means you&#39;re not going to know about the problem, and the warning will get lost in the river of output, and your package that needs Net::DNS will fail, and you&#39;ll have to dig around diagnosing why.</p>

<p>
	&nbsp;</p>

<p>
	Which means the effort to produce a warning in such a case achieved nothing.<br>

	<br>

	&nbsp;</p>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;31&nbsp;08:05:30&nbsp;2015</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Dec 30 16:31:43 2015, KENTNL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2015-12-31 06:58:03, rwfranks@acm.org wrote:
<div class="message-stanza open">&gt; &gt; No real need to abort the installation process in this situation.
&gt; &gt; Deleting the arch directory can be done afterwards.
</div>&gt; 
&gt; If somebody depends on a minimum version of Net::DNS that is larger
&gt; than the
&gt; version which this transition occurred at, then everything in the
&gt; subsequent
&gt; dependency graph can be expected to fail in unpredictable ways which
&gt; the people
&gt; who declare those dependencies cannot solve.
&gt; 
&gt; Which means you&#39;re not going to know about the problem, and the
&gt; warning will
&gt; get lost in the river of output, and your package that needs Net::DNS
&gt; will
&gt; fail, and you&#39;ll have to dig around diagnosing why.
&gt; 
&gt; Which means the effort to produce a warning in such a case achieved
&gt; nothing.
</div>
So you are arguing for a fatal error at  perl Makefile.PL  time?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;24&nbsp;07:45:26&nbsp;2016</span>
    <span class="description">KENTNL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza"><p>
	On 2016-01-01 02:05:30, rwfranks@acm.org wrote:<br>

	&gt;<br>

	&gt; So you are arguing for a fatal error at perl Makefile.PL time?</p>

<p>
	&nbsp;</p>

<p>
	Yes. Given Net::DNS is not going correct the situation automatically, and installing Net::DNS will mislead any CPAN client about what has transpired such that future breakages are guaranteed, the only right thing to do is to fail in advance of that problem happening.</p>

<p>
	That is, treat a system with an existing old version of Net::DNS as a &quot;misconfigured&quot; and &quot;Unable to support this version of Net::DNS&quot; until that problem is remedied by other means.<br>

	<br>

	<br>

	&nbsp;</p>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;29&nbsp;15:05:25&nbsp;2016</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Jan 24 07:45:26 2016, KENTNL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2016-01-01 02:05:30, rwfranks@acm.org wrote:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; So you are arguing for a fatal error at perl Makefile.PL time?
</div>&gt; 
&gt; Yes. Given Net::DNS is not going correct the situation automatically,
&gt; and
&gt; installing Net::DNS will mislead any CPAN client about what has
&gt; transpired such
&gt; that future breakages are guaranteed, the only right thing to do is to
&gt; fail in
&gt; advance of that problem happening.
&gt; 
&gt; That is, treat a system with an existing old version of Net::DNS as a
&gt; &#34;misconfigured&#34; and &#34;Unable to support this version of Net::DNS&#34; until
&gt; that
&gt; problem is remedied by other means.
</div>
Although the motivation is different, the situation is similar to the behaviour when using the PREREQ_FATAL option.

The ExtUtils::MakeMaker documentation says:

 It is extremely rare to have to use &#34;PREREQ_FATAL&#34;. Its use by module
 authors is _strongly_discouraged_ and should never be used lightly.

I find myself strongly discouraged.


A prominent message has been added to Makefile.PL followed by a long sleep to ensure that it remains on screen long enough to be noticed.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;29&nbsp;22:58:59&nbsp;2016</span>
    <span class="description">KENTNL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza"><p>
	Its not really related to PREREQ_FATAL for a lot of reasons.</p>

<p>
	&nbsp;</p>

<p>
	1. You can&#39;t depend on yourself here, so you can&#39;t demand that a CPAN client does *not* have an older version of yourself. ( Actually, that might be viable, I just haven&#39;t heard of it being done before and the support is likely very scant )</p>

<p>
	2. Unlike&nbsp; PREREQS, you&#39;re not providing *any* mechanism by which the CPAN client can resolve it on its own.</p>

<p>
	I see it more like &quot;Your system can&#39;t support this because of a problem outside the scope of a CPAN Client&quot;, which is used extensively in everything that uses XS or external dependencies.</p>

<p>
	&nbsp;</p>

<p>
	For instance, if your library requires a binary in $PATH that can&#39;t be provided by CPAN, then an &quot;exit: N/A&quot;&nbsp; from Makefile.PL is appropriate.</p>

<p>
	If for instance, your library requires a linkable .so in the library paths, or a .h file in @INC paths, an early &quot;no, I cannot actually continue&quot; is appropriate from Makefile.PL ( signalled by an early exit</p>

<p>
	So here, you very much have the same &quot;this is a problem that will happen when you use a CPAN client and your CPAN client will do nothing to help you&quot; problem space.</p>

<p>
	Similarly, your approach of &quot;just warn and then continue&quot; with the bin/lib example cases would map to the tool installing anyway regardless of the lack of a `bin/` , and then later failing in confusing ways when something tried to use your module and it didn&#39;t work.</p>

<p>
	And in the lib case, you&#39;d be installing the pure-perl parts without any of the XS parts, and then again, the module would break when somebody attempted to use it, without it being obvious why, and you&#39;d be a long way from the problem when that happened.</p>

<p>
	Similarly, &quot;I&#39;ll install, but I won&#39;t actually be there and usable after I&#39;m installed for ways that a CPAN client can&#39;t help with, and I refuse to help with in any way&quot; is essentially a violation of the CPAN dependency contract.</p>

<p>
	If your module *cannot* be used, then it *should not* be able to be installed.</p>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;29&nbsp;23:11:14&nbsp;2016</span>
    <span class="description">KENTNL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza"><p>
	On 2016-01-30 09:05:25, rwfranks@acm.org wrote:<br>

	&gt;<br>

	&gt; A prominent message has been added to Makefile.PL followed by a long<br>

	&gt; sleep to ensure that it remains on screen long enough to be noticed.</p>

<p>
	&nbsp;</p>

<p>
	^ and this part may on its own have no effect, because when you&#39;re installing a lot of dependencies ( where one is an upgrade trigger ), you&#39;re likely to not see anything, regardless of how long you set the wait for for several reasons.</p>

<p>
	1. Some CPAN Clients will suppress all and any of that output *on purpose*, and then only renders output *on failure*</p>

<p>
	2. In a long install job, unless your &quot;wait&quot; is in the scale of &quot;several hours&quot;, the &quot;wait time&quot; will likely elapse while the person doing the install is away doing other things while they wait for all their other dependencies to be installed/updated.</p>

<p>
	&nbsp;</p>

<p>
	Your solution might be appropriate if you assume every single installer is hand-operated, and installs only one dependency at a time.</p>

<p>
	But this is useless for anything automated that does lots of installs in a single job, or does bulk, automated updates/installs ( such as automated smoke boxes ).</p>

<p>
	The warning solution will subsequently only improve one aspect of this, in that when, at then end of a very long install job, find something unrelated breaking the install job because its tests fail bizzarely&nbsp; with</p>

<p>
	&nbsp;&nbsp; &quot;required Net::DNS 1.0, this is version 0.98&quot;</p>

<p>
	Or similar, their first &quot;WTF?? Let me install that manually&quot; will make the problem apparent at that time.<br>

	<br>

	This means you&#39;re not actually making things &quot;better&quot; by not failing: anything that causes an update *will* be broken, it *will* not work.</p>

<p>
	All you&#39;re doing is delaying where it fails to a place its not useful.<br>

	<br>

	&nbsp;</p>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;01&nbsp;14:21:27&nbsp;2016</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2016-01-29 23:11:14, KENTNL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2016-01-30 09:05:25, rwfranks@acm.org wrote:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; A prominent message has been added to Makefile.PL followed by a long
&gt; &gt; sleep to ensure that it remains on screen long enough to be noticed.
</div>&gt; 
&gt; ^ and this part may on its own have no effect, because when you&#39;re
&gt; installing a
&gt; lot of dependencies &#40; where one is an upgrade trigger &#41;, you&#39;re likely
&gt; to not
&gt; see anything, regardless of how long you set the wait for for several
&gt; reasons.
&gt; 
&gt; 1. Some CPAN Clients will suppress all and any of that output *on
&gt; purpose*, and
&gt; then only renders output *on failure*
&gt; 
&gt; 2. In a long install job, unless your &#34;wait&#34; is in the scale of
&gt; &#34;several
&gt; hours&#34;, the &#34;wait time&#34; will likely elapse while the person doing the
&gt; install
&gt; is away doing other things while they wait for all their other
&gt; dependencies to
&gt; be installed/updated.
&gt; 
&gt; Your solution might be appropriate if you assume every single
&gt; installer is
&gt; hand-operated, and installs only one dependency at a time.
&gt; 
&gt; But this is useless for anything automated that does lots of installs
&gt; in a
&gt; single job, or does bulk, automated updates/installs &#40; such as
&gt; automated smoke
&gt; boxes &#41;.
&gt; 
&gt; The warning solution will subsequently only improve one aspect of
&gt; this, in that
&gt; when, at then end of a very long install job, find something unrelated
&gt; breaking
&gt; the install job because its tests fail bizzarely with
&gt; 
&gt; &#34;required Net::DNS 1.0, this is version 0.98&#34;
&gt; 
&gt; Or similar, their first &#34;WTF?? Let me install that manually&#34; will make
&gt; the
&gt; problem apparent at that time.
&gt; 
&gt; This means you&#39;re not actually making things &#34;better&#34; by not failing:
&gt; anything
&gt; that causes an update *will* be broken, it *will* not work.
&gt; 
&gt; All you&#39;re doing is delaying where it fails to a place its not useful.
</div>
I guess 1.04_01 implemented the fail, as my smoker machines just generated 27 fail reports.

Not sure what I &#40;and other CPAN Testers&#41; should do now. Most test machines are fully automated, so the operator will never see that manual intervention is required. So &#34;useless&#34; fail reports will be sent in the future all the time. Just skipping the failing test in tester environments is not right either. For semi-manually operated testing systems it would be possible to remove the existing Net::DNS installation, but should I wait for the next stable one --- I usually never install devel versions, just test them --- or should I make an exception now?

Also, the diagnostics message could be more helpful for the user. Maybe the contents of the .packlist could be printed, so the user knows what to delete. Or maybe there&#39;s an uninstall script somewhere in the CPAN. Or point the user to UNINST=1 &#40;but no, this would not help, as the uninstall would happen only during &#34;make install&#34;, and the fail would still happen in the &#34;make test&#34; phase&#41;.

Maybe the easiest solution is to stick somehow to the existing installation directory? Maybe put again a dummy XS into the distribution?

Regards,
    Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;01&nbsp;18:19:40&nbsp;2016</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #108908] Installing recent version gets shadowed by old version</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 1 Feb 2016 23:18:46 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-DNS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dick Franks &lt;rwfranks [...] acm.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Slaven,

Thanks for your take on this.

I am unable to see the test reports yet because it seems to take many hours
before they are posted on cpantesters.org, but it is clear from the log
view that the t/00-upgrade-compatibility.t test is unworkable.

It does surprise me that smokeboxes are not building the UUT in a clean
Perl environment populated only to the extent needed to satisfy the
declared module dependencies.

Dick



Dick Franks
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">________________________


On 1 February 2016 at 19:21, Slaven_Rezic via RT &lt;bug-Net-DNS@rt.cpan.org&gt;
wrote:

<div class="message-stanza open">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=108908">https://rt.cpan.org/Ticket/Display.html?id=108908</a></span> &gt;
&gt;
&gt; On 2016-01-29 23:11:14, KENTNL wrote:
<div class="message-stanza open">&gt; &gt; On 2016-01-30 09:05:25, rwfranks@acm.org wrote:
<div class="message-stanza open">&gt; &gt; &gt;
&gt; &gt; &gt; A prominent message has been added to Makefile.PL followed by a long
&gt; &gt; &gt; sleep to ensure that it remains on screen long enough to be noticed.
</div>&gt; &gt;
&gt; &gt; ^ and this part may on its own have no effect, because when you&#39;re
&gt; &gt; installing a
&gt; &gt; lot of dependencies &#40; where one is an upgrade trigger &#41;, you&#39;re likely
&gt; &gt; to not
&gt; &gt; see anything, regardless of how long you set the wait for for several
&gt; &gt; reasons.
&gt; &gt;
&gt; &gt; 1. Some CPAN Clients will suppress all and any of that output *on
&gt; &gt; purpose*, and
&gt; &gt; then only renders output *on failure*
&gt; &gt;
&gt; &gt; 2. In a long install job, unless your &#34;wait&#34; is in the scale of
&gt; &gt; &#34;several
&gt; &gt; hours&#34;, the &#34;wait time&#34; will likely elapse while the person doing the
&gt; &gt; install
&gt; &gt; is away doing other things while they wait for all their other
&gt; &gt; dependencies to
&gt; &gt; be installed/updated.
&gt; &gt;
&gt; &gt; Your solution might be appropriate if you assume every single
&gt; &gt; installer is
&gt; &gt; hand-operated, and installs only one dependency at a time.
&gt; &gt;
&gt; &gt; But this is useless for anything automated that does lots of installs
&gt; &gt; in a
&gt; &gt; single job, or does bulk, automated updates/installs &#40; such as
&gt; &gt; automated smoke
&gt; &gt; boxes &#41;.
&gt; &gt;
&gt; &gt; The warning solution will subsequently only improve one aspect of
&gt; &gt; this, in that
&gt; &gt; when, at then end of a very long install job, find something unrelated
&gt; &gt; breaking
&gt; &gt; the install job because its tests fail bizzarely with
&gt; &gt;
&gt; &gt; &#34;required Net::DNS 1.0, this is version 0.98&#34;
&gt; &gt;
&gt; &gt; Or similar, their first &#34;WTF?? Let me install that manually&#34; will make
&gt; &gt; the
&gt; &gt; problem apparent at that time.
&gt; &gt;
&gt; &gt; This means you&#39;re not actually making things &#34;better&#34; by not failing:
&gt; &gt; anything
&gt; &gt; that causes an update *will* be broken, it *will* not work.
&gt; &gt;
&gt; &gt; All you&#39;re doing is delaying where it fails to a place its not useful.
</div>&gt;
&gt; I guess 1.04_01 implemented the fail, as my smoker machines just generated
&gt; 27 fail reports.
&gt;
&gt; Not sure what I &#40;and other CPAN Testers&#41; should do now. Most test machines
&gt; are fully automated, so the operator will never see that manual
&gt; intervention is required. So &#34;useless&#34; fail reports will be sent in the
&gt; future all the time. Just skipping the failing test in tester environments
&gt; is not right either. For semi-manually operated testing systems it would be
&gt; possible to remove the existing Net::DNS installation, but should I wait
&gt; for the next stable one --- I usually never install devel versions, just
&gt; test them --- or should I make an exception now?
&gt;
&gt; Also, the diagnostics message could be more helpful for the user. Maybe
&gt; the contents of the .packlist could be printed, so the user knows what to
&gt; delete. Or maybe there&#39;s an uninstall script somewhere in the CPAN. Or
&gt; point the user to UNINST=1 &#40;but no, this would not help, as the uninstall
&gt; would happen only during &#34;make install&#34;, and the fail would still happen in
&gt; the &#34;make test&#34; phase&#41;.
&gt;
&gt; Maybe the easiest solution is to stick somehow to the existing
&gt; installation directory? Maybe put again a dummy XS into the distribution?
&gt;
&gt; Regards,
&gt;     Slaven
&gt;
</div></div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;01&nbsp;22:11:46&nbsp;2016</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2016-02-01 15:19:40, rwfranks@acm.org wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It does surprise me that smokeboxes are not building the UUT in a
&gt; clean
&gt; Perl environment populated only to the extent needed to satisfy the
&gt; declared module dependencies.
</div>
Some do, but many do not, since installing on top of previous installations is a fair scenario to test.

Personally, my &#34;smoker&#34; is just my main development machine, and I send cpantesters reports for everything I install or upgrade.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;02&nbsp;08:16:55&nbsp;2016</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Nov 13 22:48:52 2015, KENTNL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Somewhere between 0.83 and the current version, it appears the
&gt; location
&gt; Net::DNS installs to gets changed.
&gt; 
&gt; On version 0.83, it installs to &#34;${site}/${arch}/&lt;&gt;&#34; but on 1.03 it
&gt; installs to
&gt; &#34;${site}/&lt;&gt;&#34;
&gt; 
&gt; Which is unfortunate, because the former shadows the later, so even
&gt; after
&gt; upgrading, the upgraded version is not seen in @INC, only the older
&gt; version.
&gt; 
&gt; Fortunately, there is a cure.
&gt; 
&gt; Here&#39;s some code by HAARG++
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/HAARG/Devel-GlobalDestruction-">https://metacpan.org/source/HAARG/Devel-GlobalDestruction-</a></span>
&gt; 0.13/Makefile.PL#L75-88
&gt; 
&gt; That example code checks for an older version of itself, and if a
&gt; version older
&gt; than a certain age is found, it appends code to make to request the
&gt; removal of
&gt; the ${arch} version so that it doesn&#39;t get shadowed.
&gt; 
&gt; This is not a blanket &#34;find and delete&#34;, but it only deletes the
&gt; problem file
&gt; from the arch directory corresponding to the install target.
</div>
Now you have seen me get my fingers burnt, just imagine what would have happened if I had been foolish enough to follow this suggestion!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;02&nbsp;08:39:15&nbsp;2016</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jan 29 23:11:14 2016, KENTNL wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The warning solution will subsequently only improve one aspect of
&gt; this, in that
&gt; when, at then end of a very long install job, find something unrelated
&gt; breaking
&gt; the install job because its tests fail bizzarely with
&gt; 
&gt; &#34;required Net::DNS 1.0, this is version 0.98&#34;
&gt; 
&gt; Or similar, their first &#34;WTF?? Let me install that manually&#34; will make
&gt; the
&gt; problem apparent at that time.
</div>
Which is better than no indication at all.

The message now includes the location of the offending version.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;09&nbsp;05:22:42&nbsp;2016</span>
    <span class="description">NLNETLABS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;02&nbsp;19:56:38&nbsp;2016</span>
    <span class="description">DBOOK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Feb 02 08:16:55 2016, rwfranks@acm.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri Nov 13 22:48:52 2015, KENTNL wrote:
<div class="message-stanza open">&gt; &gt; Here&#39;s some code by HAARG++
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/HAARG/Devel-GlobalDestruction-">https://metacpan.org/source/HAARG/Devel-GlobalDestruction-</a></span>
&gt; &gt; 0.13/Makefile.PL#L75-88
&gt; &gt;
&gt; &gt; That example code checks for an older version of itself, and if a
&gt; &gt; version older
&gt; &gt; than a certain age is found, it appends code to make to request the
&gt; &gt; removal of
&gt; &gt; the ${arch} version so that it doesn&#39;t get shadowed.
&gt; &gt;
&gt; &gt; This is not a blanket &#34;find and delete&#34;, but it only deletes the
&gt; &gt; problem file
&gt; &gt; from the arch directory corresponding to the install target.
</div>&gt; 
&gt; Now you have seen me get my fingers burnt, just imagine what would
&gt; have happened if I had been foolish enough to follow this suggestion!
</div>
Both the automated testers and end users would have the older versions of Net::DNS properly cleaned up, and none of these would have failed.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;02&nbsp;20:27:11&nbsp;2016</span>
    <span class="description">lem [...] itverx.com.ve -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #108908] Installing recent version gets shadowed by old version</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 02 Nov 2016 17:26:48 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;Dan Book via RT&#34; &lt;bug-Net-DNS [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Luis Muñoz&#34; &lt;lem [...] itverx.com.ve&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2 Nov 2016, at 16:56, Dan Book via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-DNS
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=108908">https://rt.cpan.org/Ticket/Display.html?id=108908</a></span> &gt;
&gt;
&gt; On Tue Feb 02 08:16:55 2016, rwfranks@acm.org wrote:
<div class="message-stanza open">&gt;&gt; On Fri Nov 13 22:48:52 2015, KENTNL wrote:
<div class="message-stanza open">&gt;&gt;&gt; Here&#39;s some code by HAARG++
&gt;&gt;&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/HAARG/Devel-GlobalDestruction-">https://metacpan.org/source/HAARG/Devel-GlobalDestruction-</a></span>
&gt;&gt;&gt; 0.13/Makefile.PL#L75-88
&gt;&gt;&gt;
&gt;&gt;&gt; That example code checks for an older version of itself, and if a
&gt;&gt;&gt; version older
&gt;&gt;&gt; than a certain age is found, it appends code to make to request the
&gt;&gt;&gt; removal of
&gt;&gt;&gt; the ${arch} version so that it doesn&#39;t get shadowed.
&gt;&gt;&gt;
&gt;&gt;&gt; This is not a blanket &#34;find and delete&#34;, but it only deletes the
&gt;&gt;&gt; problem file
&gt;&gt;&gt; from the arch directory corresponding to the install target.
</div>&gt;&gt;
&gt;&gt; Now you have seen me get my fingers burnt, just imagine what would
&gt;&gt; have happened if I had been foolish enough to follow this suggestion!
</div>&gt;
&gt; Both the automated testers and end users would have the older versions 
&gt; of Net::DNS properly cleaned up, and none of these would have failed.
</div>
Covertly modifying the execution environment without knowledge and 
consent of the user is borderline hostile. Providing a prominent warning 
/ refusing to run are more acceptable responses IMO.

Best regards

-lem
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;02&nbsp;20:55:40&nbsp;2016</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is still a serious and unresolved issue; I created <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=118598">https://rt.cpan.org/Ticket/Display.html?id=118598</a></span> rather than reopening this, for cleaner history.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;02&nbsp;21:37:09&nbsp;2016</span>
    <span class="description">DBOOK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Nov 02 20:27:11 2016, lem@itverx.com.ve wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Covertly modifying the execution environment without knowledge and 
&gt; consent of the user is borderline hostile. Providing a prominent warning 
&gt; / refusing to run are more acceptable responses IMO.
&gt; 
&gt; Best regards
&gt; 
&gt; -lem
&gt; 
</div>
Bailing out of the installation would be acceptable. The current behavior to warn and wait 10 seconds is not.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;02&nbsp;21:40:54&nbsp;2016</span>
    <span class="description">DBOOK [...] cpan.org -  Cc DBOOK added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;03&nbsp;08:11:17&nbsp;2016</span>
    <span class="description">LEONT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Nov 02 20:27:11 2016, lem@itverx.com.ve wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2 Nov 2016, at 16:56, Dan Book via RT wrote:
&gt; 
<div class="message-stanza open">&gt; &gt;        Queue: Net-DNS
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=108908">https://rt.cpan.org/Ticket/Display.html?id=108908</a></span> &gt;
&gt; &gt;
&gt; &gt; On Tue Feb 02 08:16:55 2016, rwfranks@acm.org wrote:
<div class="message-stanza open">&gt; &gt;&gt; On Fri Nov 13 22:48:52 2015, KENTNL wrote:
<div class="message-stanza open">&gt; &gt;&gt;&gt; Here&#39;s some code by HAARG++
&gt; &gt;&gt;&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/HAARG/Devel-GlobalDestruction-">https://metacpan.org/source/HAARG/Devel-GlobalDestruction-</a></span>
&gt; &gt;&gt;&gt; 0.13/Makefile.PL#L75-88
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; That example code checks for an older version of itself, and if a
&gt; &gt;&gt;&gt; version older
&gt; &gt;&gt;&gt; than a certain age is found, it appends code to make to request the
&gt; &gt;&gt;&gt; removal of
&gt; &gt;&gt;&gt; the ${arch} version so that it doesn&#39;t get shadowed.
&gt; &gt;&gt;&gt;
&gt; &gt;&gt;&gt; This is not a blanket &#34;find and delete&#34;, but it only deletes the
&gt; &gt;&gt;&gt; problem file
&gt; &gt;&gt;&gt; from the arch directory corresponding to the install target.
</div>&gt; &gt;&gt;
&gt; &gt;&gt; Now you have seen me get my fingers burnt, just imagine what would
&gt; &gt;&gt; have happened if I had been foolish enough to follow this suggestion!
</div>&gt; &gt;
&gt; &gt; Both the automated testers and end users would have the older versions 
&gt; &gt; of Net::DNS properly cleaned up, and none of these would have failed.
</div>&gt; 
&gt; Covertly modifying the execution environment without knowledge and 
&gt; consent of the user is borderline hostile. Providing a prominent warning 
&gt; / refusing to run are more acceptable responses IMO.
&gt; 
&gt; Best regards
&gt; 
&gt; -lem
&gt; 
</div>
Such a warning is unlikely to be seen, either because there&#39;s too much output &#40;the default on CPAN.pm&#41; or because the output is hidden &#40;default on cpanm&#41;; rendering it moot.

I believe there is a third option available in this case though: force installing to arch instead of lib if an old version is installed. I don&#39;t think this has precedent &#40;and has the disadvantage of not being fatpack-compatible&#41;, but it shouldn&#39;t be all difficult to implement &#40;passing `INST_LIB=$&#40;INST_ARCHLIB&#41;` to the WriteMakefile&#41;.

Leon
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
