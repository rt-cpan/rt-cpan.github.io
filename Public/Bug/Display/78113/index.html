<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #78113 for MQSeries: Problems with MQSeries::Message::RFH2 </title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #78113 for MQSeries: Problems with MQSeries::Message::RFH2 </h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/MQSeries/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/MQSeries/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/MQSeries/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/MQSeries/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/MQSeries">MQSeries CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">78113</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/MQSeries/Active/">MQSeries</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
peter [...] pjsc.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-21972-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.33    </td>
  </tr>
  <tr id="CF-21973-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;29&nbsp;08:40:40&nbsp;2012</span>
    <span class="description">peter [...] pjsc.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Problems with MQSeries::Message::RFH2</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I tried to use RFH2 and found a coding problem and I think the resulting
message does not have the right format.

Coding problem:

sub PutConvert {
....
 substr&#40;$buffer, $offset, $data_length&#41; = $this-&gt;_writeString&#40;$data&#41;;
..

The method _writeString expects two values: string, length

The documented example does not work, because the Format header field is
per default undef, which is causing a problem in _writeString. I suggest
to change it to MQFMT_STRING as default.

The format issue:
This is based on my research in the MQ documentation. I may be wrong.

A message with a RFH2 header does consists of the RFH2 header and data.
The data is a normal. It can be unstructured, binary, anything.

The RFH2 header consists of the structure, as defined in the module, and
two fields right after the header:  NameValueLength and NameValueData.
&#40;See
<span class="clickylink"><a target="new" rel="nofollow" href="http://publib.boulder.ibm.com/infocenter/wmqv7/v7r0/index.jsp?topic=/com.ibm.mq.csqzak.doc/fr10120_.htm">http://publib.boulder.ibm.com/infocenter/wmqv7/v7r0/index.jsp?topic=/com.ibm.mq.csqzak.doc/fr10120_.htm</a></span>
for details&#41;. 

These pairs can be multiple.

So a message looks like this:

&lt;RFH2 struct&gt;&lt;NameValueLength&gt;&lt;NameValueData&gt;&lt;data&gt;

There is also the fact, that the field StrucLength is the length of the
structure plus the NameValueLength and NameValueData. 

There is an error in _setEndianess: the variable $class is missing,
reading the method value from @_. So the method does not work without it.

One of the most important things:

in the MQMD structure the Format has to be MQSeries::MQFMT_RF_HEADER_2.
My MQ Server and an Enterprise Bus MQ server did not recognize the
header without it.
Check it out, send a message to a queue and browse the queue with the MQ
Explorer. If the RFH2 header is shown as part of the message, MQ did not
recognize the header.
If MQ did, there is a section called &#34;Named Properties&#34; in the message
view, showing the key and value of NameValueData xml

Example: &lt;usr&gt;&lt;ServiceUri&gt;/test/uri&lt;/ServiceUri&gt;&lt;/usr&gt; .  This is shown
as  key ServiceUri   value /test/uri

I fixed the problems and added a automatic calculation of the structure
length field to the code. See attached RFH2.pm file.

Hope this helps

Peter Heuchert
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RFH2.pm</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#
# MQSeries::Message::RFH2 - RFH2 Message
#
# &#40;c&#41; 2004-2009 Morgan Stanley &#38; Co. Incorporated
# See ..../src/LICENSE for terms of distribution.
#
# $Id: RFH2.pm,v 33.4 2009/12/30 19:53:41 anbrown Exp $
#

package MQSeries::Message::RFH2;

use strict;
use Carp;

use MQSeries::Message;

our $VERSION = &#39;1.31&#39;;
our @ISA = qw&#40;MQSeries::Message&#41;;

#
# This describes the RFH2 structure.  We do this in perl to avoid XS
# code...
#
my @RFH_Struct =
  &#40;
   #    Name                    Method          Length  Default
   [ qw&#40;StrucId                 String          4       RFH     &#41; ],
   [ qw&#40;Version                 Number          4       2       &#41; ],
   [ qw&#40;StrucLength             Number          4       36      &#41; ],
   [ qw&#40;Encoding                Number          4&#41;,     MQSeries::MQENC_NATIVE ],
   [ qw&#40;CodedCharSetId          Number          4       -2      &#41; ],
   [ qw&#40;Format                  String          8&#41;,     MQSeries::MQFMT_STRING  ],
   [ qw&#40;Flags                   Number          4       0       &#41; ],
   [ qw&#40;NameValueCCSID          Number          4       1208    &#41; ],
&#41;;


#
# Constructor for an RFH2 message
#
# Hash with named parameters:
# - Data &#40;in a non-standard format&#41;
# - Header
# - Carp
#
sub new {
    my &#40;$proto, %args&#41; = @_;
    my $class = ref&#40;$proto&#41; || $proto;

    my $carp = $args{Carp} || \&#38;carp;
    die &#34;Invalid &#39;Carp&#39; parameter: not a code ref&#34;
      unless &#40;ref $carp eq &#39;CODE&#39;&#41;;

    # this is important, otherwise MQ does not recognize this as a message with RFH2 header
    $args{MsgDesc}{Format} = MQSeries::MQFMT_RF_HEADER_2;

    my $this = MQSeries::Message-&gt;new&#40;%args&#41; || return;

    #
    # Deal with optional &#39;Header&#39; parameter
    #
    if &#40; defined $args{Header}{NameValueData} &#41; {
      $args{Header}{NameValueData} = [ $args{Header}{NameValueData} ] unless ref&#40;$args{Header}{NameValueData}&#41;;
    } else  {
      $args{Header}{NameValueData} = [];
    }  

    $this-&gt;{Header} = $args{Header} || {};


    return bless $this, $class;
}


#
# Return header field / header hash reference
#
# One optional parameter: field name
#
sub Header {
    my &#40;$this, $field&#41; = @_;

    if &#40;defined $field&#41; {
        return $this-&gt;{Header}{$field}; # May be undef
    }
    return $this-&gt;{Header};
}

#
# add a NameValueData field to the header
# or return the the NameValueData field
#   in Array context all fields are returned
#   iN scalar context only the first one
#
sub NameValueData {
   my &#40; $this, $valuedata &#41; = @_;
   
   if &#40; defined $valuedata &#41; {
     die &#34;NameValueData must be a scalar&#34; if ref&#40;$valuedata&#41;;
     push @{$this-&gt;{Header}{NameValueData}}, $valuedata;
   }
   return wantarray ? @{$this-&gt;{Header}{NameValueData}} : $this-&gt;{Header}{NameValueData}[0];
}   

#
# Conversion routine on get: decode RFH into Header and Data
#
sub GetConvert {
    my &#40;$this, $buffer&#41; = @_;
    $this-&gt;_setEndianess&#40;&#41;;
    $this-&gt;{Buffer} = $buffer;

    my $offset = 0;

    foreach my $field &#40;@RFH_Struct&#41; {
        my &#40;$key, $method, $length, $dft&#41; = @$field;
        $method = &#34;_read$method&#34;;
        if &#40;$offset + $length &gt; length&#40;$buffer&#41;&#41; {
            $this-&gt;{Carp}-&gt;&#40;&#34;RFH field [$key] would read beyond buffer, stopping\n&#34;&#41;;
            $offset = length&#40;$buffer&#41;;
            last;
        }

        my $value = $this-&gt;$method&#40;$buffer, $offset, $length&#41;;
        #print &#34;Read key [$key] value [$value]\n&#34;;
        $this-&gt;{Header}{$key} = $value;
        $offset += $length;
    }

    # get the length of the header structure including NameValueData fields
    my $strucLength = $this-&gt;{Header}{StrucLength};

    while &#40; $offset &lt; $strucLength &#41; {
      #
      # The RFH data is returned as a data length plus a string.
      # multiple fields are possible
      #
      my $datalen = $this-&gt;_readNumber&#40;$buffer, $offset, 4&#41;;
      $offset += 4;
      $this-&gt;NameValueData&#40;$this-&gt;_readString&#40;$buffer, $offset, $datalen&#41;&#41;;
      $offset += $datalen;
    }  

    # data is behind the RFH2 structure
    return substr&#40;$buffer,$strucLength&#41;;
}


#
# Convert the data &#40;XML-like string&#41;, plus an RFH2 Header, into an MQ
# message.
#
sub PutConvert {
    my &#40;$this, $data&#41; = @_;

    my $header = $this-&gt;{Header};

    die &#34;RFH2 data must be string&#34; if &#40;ref $data&#41;;

    $this-&gt;_setEndianess&#40;&#41;;
    my $buffer = &#39;&#39;;
    my $offset = 0;

    #
    # The length of the value string  must be a multiple of four; round up
    # if required.
    #
    my $strucLength = 0;
    foreach my $data &#40; @{$header-&gt;{NameValueData}} &#41; {
      die &#34;RFH2 NameValueData must be an XML-like string&#34; unless $data &#38;&#38; ref&#40;$data&#41; eq &#34;&#34;;
      $strucLength += 4 * int&#40;&#40;length&#40;$data&#41; + 3&#41;/ 4&#41; + 4 ; # + 4 because of size of NameValueLength field
    }  

    #### structureLength is size of the structure + size of NameValueData fields
    foreach my $field &#40; @RFH_Struct &#41; {
       $strucLength += $field-&gt;[2];
    }

    $header-&gt;{StrucLength} = $strucLength;

    # 
    # create the structure
    #
    foreach my $field &#40;@RFH_Struct&#41; {
        my &#40;$key, $method, $length, $dft&#41; = @$field;
        $method = &#34;_write$method&#34;;
        my $value = &#40;defined $this-&gt;{Header}{$key} ?
                     $this-&gt;{Header}{$key} : $dft&#41;;
        substr&#40;$buffer, $offset, $length&#41; = $this-&gt;$method&#40;$value, $length&#41;;
        $offset += $length;
    }

    #
    # The length of the value string  must be a multiple of four; round up
    # if required.
    #
    foreach my $data &#40; @{$header-&gt;{NameValueData}} &#41; {
      my $namevalue_length = 4 * int&#40;&#40;length&#40;$data&#41; + 3&#41;/ 4&#41;;
      substr&#40;$buffer, $offset, 4&#41; = $this-&gt;_writeNumber&#40;$namevalue_length&#41;;
      $offset += 4;

      substr&#40;$buffer, $offset, $namevalue_length&#41; = $this-&gt;_writeString&#40;$data,$namevalue_length&#41;;
      $offset += $namevalue_length;
    }

    # Append the data to the end
    $buffer .= $data;

    return $buffer;
}


# ------------------------------------------------------------------------

#-
# The globals determine how to pack numbers &#40;big/little endian&#41;
#
my &#40;$packShort, $packNumber&#41;;

sub _readString {
    my $class = shift;
    my &#40;$data,$offset,$length&#41; = @_;
    return unpack&#40;&#34;A*&#34;, substr&#40;$data,$offset,$length&#41;&#41;;
}


sub _writeString {
    my $class = shift;
    my &#40;$string,$length&#41; = @_;
    return $string . &#40; &#34; &#34; x &#40; $length - length&#40;$string&#41; &#41; &#41;;
}


sub _readNumber {
    my $class = shift;
    my &#40;$data,$offset,$length&#41; = @_;
    return unpack&#40;$packNumber, substr&#40;$data,$offset,$length&#41;&#41;;
}


sub _writeNumber {
    my $class = shift;
    my &#40;$number&#41; = @_;
    return pack&#40;$packNumber, $number&#41;;
}


sub _readShort {
    my $class = shift;
    my &#40;$data,$offset,$length&#41; = @_;
    return unpack&#40;$packShort, substr&#40;$data,$offset,$length&#41;&#41;;
}


sub _writeShort {
    my $class = shift;
    my &#40;$number&#41; = @_;
    return pack&#40;$packShort, $number&#41;;
}


sub _readByte {
    my $class = shift;
    my &#40;$data,$offset,$length&#41; = @_;
    return substr&#40;$data,$offset,$length&#41;;
}


sub _writeByte {
    my $class = shift;
    my &#40;$string,$length&#41; = @_;
    if &#40; length&#40;$string&#41; &lt; $length &#41; {
        $string .= &#34;\0&#34; x &#40; $length - length&#40;$string&#41; &#41;;
    }
    return $string;
}


#
# This sub is used to determine if the platform we are running on is
# Big/Little endian.  If the client platform and server platform have
# different endian-ness, you can invoke it with:
#
# - 0: server is little-endian &#40;Linux/Intel, Windows NT&#41;
# - 1: server is big-endian &#40;Solaris/SPARC&#41;
#
sub _setEndianess {
    my &#40;$class,$big_endian&#41; = @_;

    if &#40;@_ == 1&#41; {
        return if &#40;defined $packShort&#41;;
        #
        # Implicit invocation - base on guess work
        #
        $big_endian = pack&#40;&#39;N&#39;, 1&#41; eq pack&#40;&#39;L&#39;, 1&#41;;
        #print STDERR &#34;Implicitly set format to &#34; . &#40;$big_endian ? &#34;big&#34; : &#34;little&#34;&#41; . &#34; endian\n&#34;;
    }

    if &#40;$big_endian&#41; {
        $packShort = &#34;n&#34;;
        $packNumber= &#34;N&#34;;
    } else {
        $packShort = &#34;v&#34;;
        $packNumber= &#34;V&#34;;
    }
}

1;


__END__

=head1 NAME

MQSeries::Message::RFH2 -- Class to send/receive RFH2 messages

=head1 SYNOPSIS

  use MQSeries::Message::RFH2;

  #
  # Create an RFH2 message with default settings
  #
  my $msg = MQSeries::Message::RFH2-&gt;new&#40;&#39;NameValueData&#39; =&gt; &#39;&lt;foo&gt;bar&lt;/foo&gt;&#39;, &#39;Data&#39; =&gt; &#39;message with mydata&#39;&#41;;


  #
  # Same while overriding the Flags and NameValue character set id
  #
  my $msg2 = MQSeries::Message::RFH2-&gt;
    new&#40;&#39;Header&#39; =&gt; { &#39;NameValueCCSID&#39; =&gt; 1200, # UCS-2
                      &#39;Flags&#39;          =&gt; 1,
		      &#39;NameValueData&#39; =&gt; &#39;&lt;foo&gt;bar&lt;/foo&gt;&#39;,
                    },
        &#39;Data&#39;   =&gt; $ucs2_data&#41;;

  # append another NameValueData Field
  $msg2-&gt;NameValueData&#40;&#39;&lt;test&gt;value&lt;/test&gt;&#39;&#41;;

  # Same with an array as NameValueData
  my $msg3 = MQSeries::Message::RFH2-&gt;new&#40;&#39;NameValueData&#39; =&gt; [&#39;&lt;foo&gt;bar&lt;/foo&gt;&#39;,&#39;&lt;test&gt;value&lt;/test&gt;&#39;], 
                                          &#39;Data&#39; =&gt; &#39;message with mydata&#39;&#41;;

  #
  # Get RFH2 data
  #
  my $qmgr_obj = MQSeries::QueueManager-&gt;new&#40;QueueManager =&gt; &#39;TEST.QM&#39;&#41;;
  my $queue = MQSeries::Queue-&gt;
    new&#40;QueueManager =&gt; $qmgr_obj,
        Queue        =&gt; &#39;RFH2.DATA.QUEUE&#39;,
        Mode         =&gt; &#39;input&#39;&#41;;
  my $msg = MQSeries::Message::RFH2-&gt;new&#40;&#41;;
  $queue-&gt;Get&#40;Message =&gt; $msg&#41;;
  my $data = $msg-&gt;Data&#40;&#41;;
  print &#34;Have name-value data &#39;$data&#39;\n&#34;;

=head1 DESCRIPTION

This is a simple subclass of MQSeries::Message which supports sending
and retrieving RFH2 messages.  This class is experimental, as it was
based on the documentation and a few sample messages; feedback as to
how well it works is welcome.

An RFH2 message contains an RFH2 header, followed by a data string
with structured name-value data, in XML format.

NOTE: In MQ v7, you may receive what appear to be messages in RFH2
format, when you&#39;re really getting a message with message properties.
If you&#39;re upgrading MQ v7, make sure you rebuild the module to get MQ
v7 support; and make sure to set the queue PropertyControl attribute
properly.

=head1 METHODS

=head2 NameValueData

Add another string as NameValueData to the header or return the 
stored NameValueData strings

# add a string
$msg-&gt;NameValueData&#40;&#39;&lt;test&gt;another value&lt;/test&gt;&#39;&#41;;

# return the first NameValueData string
my $s = $msg-&gt;NameValueData&#40;&#41;;

# return all NameValueStrings
my @s = $msg-&gt;NameValueData&#40;&#41;;


=head2 PutConvert, GetConvert

Neither of these methods are called by the users application, but are
used internally by MQSeries::Queue::Put&#40;&#41; and MQSeries::Queue::Get&#40;&#41;,
as well as MQSeries::QueueManager::Put1&#40;&#41;.

PutConvert&#40;&#41; encodes the data supplied by the programmer into RFH2 format.

GetConvert&#40;&#41; decodes the RFH2 header data and name-value pairs.
transaction name and body.

=head1 _setEndianess

An RFH2 message contains a number of numerical fields that are encoded
based on the endian-ness of the queue manager.  In most cases, that is
the same endian-ness as the client &#40;certainly if both run on the same
machine&#41;, and this module uses that as the default.

If you need to override the guess made by this module, then you can
invoke the C&lt;_setEndianess&gt; method with 0 if server is little-endian
&#40;Linux/Intel, Windows NT&#41; and 1 if server is big-endian
&#40;Solaris/SPARC&#41;.

For example, if you run on a Linux/Intel machine, but need to create a
message for a queue manager running on Solaris:

  MQSeries::Message::RFH2-&gt;_setEndianess&#40;1&#41;;
  my $message = MQSeries::Message::RFH2-&gt;
    new&#40;&#39;Data&#39; =&gt; &#39;&lt;foo&gt;bar&lt;/foo&gt;&#39;&#41;;

=head1 AUTHORS

Hildo Biersma, Tim Kimber

=head1 SEE ALSO

MQSeries&#40;3&#41;, MQSeries::QueueManager&#40;3&#41;, MQSeries::Queue&#40;3&#41;, MQSeries::Message&#40;3&#41;

=cut

</div></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
