<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #24180 for Net_SSLeay.pm: test suite drops a daemon running forever</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #24180 for Net_SSLeay.pm: test suite drops a daemon running forever</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net_SSLeay.pm/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net_SSLeay.pm/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net_SSLeay.pm/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net_SSLeay.pm/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net_SSLeay.pm">Net_SSLeay.pm CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">24180</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net_SSLeay.pm/Active/">Net_SSLeay.pm</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ANDK [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
imacat [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-23580-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-23581-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.30    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;02&nbsp;01:24:39&nbsp;2007</span>
    <span class="description">ANDK [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> test suite drops a daemon running forever</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From time to time I find a running process pair like this:

k        18692  0.0  0.0   2956  1328 pts/4    S+   Jan01   0:00 sh -c
/home/src/perl/repoperls/installed-perls/perl/prOxRQY/perl-5.8.0@29651/bin/perl
-Iblib/lib -Iblib/arch
-I/home/src/perl/repoperls/installed-perls/perl/prOxRQY/perl-5.8.0@29651/lib/5.9.5/i686-linux-64int
-I/home/src/perl/repoperls/installed-perls/perl/prOxRQY/perl-5.8.0@29651/lib/5.9.5
-I/home/src/perl/repoperls/installed-perls/perl/prOxRQY/perl-5.8.0@29651/lib/site_perl/5.9.5/i686-linux-64int
-I/home/src/perl/repoperls/installed-perls/perl/prOxRQY/perl-5.8.0@29651/lib/site_perl/5.9.5
-I. examples/sslecho.pl 1212 examples/cert.pem examples/key.pem
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&gt;sslecho.log 2&gt;&#38;1
</div>k        18693  0.0  0.5  10512  7812 pts/4    S+   Jan01   0:00
/home/src/perl/repoperls/installed-perls/perl/prOxRQY/perl-5.8.0@29651/bin/perl
-Iblib/lib -Iblib/arch
-I/home/src/perl/repoperls/installed-perls/perl/prOxRQY/perl-5.8.0@29651/lib/5.9.5/i686-linux-64int
-I/home/src/perl/repoperls/installed-perls/perl/prOxRQY/perl-5.8.0@29651/lib/5.9.5
-I/home/src/perl/repoperls/installed-perls/perl/prOxRQY/perl-5.8.0@29651/lib/site_perl/5.9.5/i686-linux-64int
-I/home/src/perl/repoperls/installed-perls/perl/prOxRQY/perl-5.8.0@29651/lib/site_perl/5.9.5
-I. examples/sslecho.pl 1212 examples/cert.pem examples/key.pem


and then I can find the CWD of the processes with lsof:

% lsof -p 18692
lsof: WARNING: can&#39;t stat&#40;&#41; ext3 file system /dev/.static/dev
      Output information may be incomplete.
COMMAND   PID USER   FD   TYPE DEVICE    SIZE     NODE NAME
sh      18692    k  cwd    DIR    9,1       0 11390681
/home/k/.cpan/build/Net_SSLeay.pm-1.30-KYd1Uh &#40;deleted&#41;



Apparently the daemon comes from Net_SSLeay-1.30.


Regards,
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;26&nbsp;06:19:55&nbsp;2007</span>
    <span class="description">imacat [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> imacat [...] cpan.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">    Confirmed on perl 5.8.8 Linux 2.6 x86_64.  It seems to be the server
raised at line 97 of test.pl.  It is not killed by the &#34;kill $pid&#34; at
line 134.  I cannot identify this issue further.  Maybe you can check if
kill successed.  You may refer to the attached console log.

    Also, this seems to cause CPANPLUS hang, waiting for its child to
die forever, if the user is running from CPANPLUS.  Because several
modules rely on Net_SSLeay.pm, they cannot be tested by CPAN testers for
this dependency.

    Please tell me if I could be of any help, or if you need any more
information.  Thank you.

imacat@rinse build/Net_SSLeay.pm-1.30 % make test
1..20
ok 1
...
ok 5tcp
        Spawning a SSL test server on port 1212, pid=4576...
ok 5
...
  All sites were successful!
ok 3
imacat@rinse build/Net_SSLeay.pm-1.30 % ps ax | grep perl
 4576 pts/0    S      0:00 sh -c /opt/perl/testers/bin/perl -Iblib/lib
-Iblib/arch -I/home/imacat/lib/perl5
-I/opt/perl/testers/lib/5.8.8/x86_64-linux-thread-multi-ld
-I/opt/perl/testers/lib/5.8.8
-I/opt/perl/testers/lib/site_perl/5.8.8/x86_64-linux-thread-multi-ld
-I/opt/perl/testers/lib/site_perl/5.8.8
-I/opt/perl/testers/lib/site_perl -I. examples/sslecho.pl 1212
examples/cert.pem examples/key.pem &gt;&gt;sslecho.log 2&gt;&#38;1
 4577 pts/0    S      0:00 /opt/perl/testers/bin/perl -Iblib/lib
-Iblib/arch -I/home/imacat/lib/perl5
-I/opt/perl/testers/lib/5.8.8/x86_64-linux-thread-multi-ld
-I/opt/perl/testers/lib/5.8.8
-I/opt/perl/testers/lib/site_perl/5.8.8/x86_64-linux-thread-multi-ld
-I/opt/perl/testers/lib/site_perl/5.8.8
-I/opt/perl/testers/lib/site_perl -I. examples/sslecho.pl 1212
examples/cert.pem examples/key.pem
imacat@rinse build/Net_SSLeay.pm-1.30 %
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;26&nbsp;06:32:20&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;27&nbsp;16:23:30&nbsp;2007</span>
    <span class="description">imacat [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dear Florian Ragwitz,

    Hi.  This is imacat from Taiwan.  I have made more tests.  It seems
that this keep-running daemon is this &#34;SSL test server on port 1212&#34; in
test.pl line 98, and is the cause that CPANPLUS hangs waiting for.  Once
I kill it CPANPLUS returns.

    Further investigation reveals that: &#34;kill $pid&#34; is not working at
test.pl line 134.  According to the perlfunc&#40;1&#41; documentation

<span class="clickylink"><a target="new" rel="nofollow" href="http://perldoc.perl.org/functions/kill.html">http://perldoc.perl.org/functions/kill.html</a></span>

    It show that &#34;kill 15, $pid&#34; should be used instead of &#34;kill $pid&#34;.
 You omitted the kill signal and Perl treats $pid as the signal with an
empty process ID list.  I have make some tests.  After changing &#34;kill
$pid&#34; to &#34;kill 15, $pid&#34; that daemon is killed, and CPANPLUS returns as
usual when tests finish.

    There seem to be still another daemon running, with a PID next to
that one.  I don&#39;t quite understand yet.

    I attached a simple patch that may solve this issue, in the hope
that it helps.  Please tell me if I could be of any help, or if you need
any more information.  Thank you.

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

diff -u -r Net_SSLeay.pm-1.30.orig/test.pl Net_SSLeay.pm-1.30/test.pl
- --- Net_SSLeay.pm-1.30.orig/test.pl   2005-12-01 10:20:34.000000000 +0800
+++ Net_SSLeay.pm-1.30/test.pl  2007-03-28 03:57:05.000000000 +0800
@@ -131,7 +131,7 @@
 print &#34;\t\t...took $secs secs &#40;&#34; . int&#40;$mb*1024/$secs&#41;. &#34; KB/s&#41;\n&#34; if
$trace;
 print &#38;test&#40;10, &#40;$res =~ /OK\s*$/&#41;&#41;;
 
- -kill $pid;  # We don&#39;t need that server any more
+kill 15, $pid;  # We don&#39;t need that server any more
 
 if &#40;$exe_path !~ /\.exe$/i&#41; {  # Not Windows where fork does not work
     $res = `$perl examples/cli-cert.pl $cert_pem $key_pem examples`;
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.7 &#40;GNU/Linux&#41;

iD8DBQFGCXcmi9gubzC5S1wRAvSiAJsFgLm/Cm5CyCsGqdhD7C5CY5r3pwCdFePd
OP+TVUtPMeo6l/lyMMuOhXk=
=i+fU
-----END PGP SIGNATURE-----
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;24&nbsp;15:06:51&nbsp;2007</span>
    <span class="description">ANDK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">because I find downloading of patches from RT.cpan.org more than
inconvenient I uploaded this patch to CPAN as

    ANDK/patches/Net_SSLeay.pm-1.30-IMACAT-01.patch.gz

Thanks, imacat, your patch works like a charm.

andreas
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;09&nbsp;13:16:41&nbsp;2008</span>
    <span class="description">imacat [...] cpan.org -  Cc IMACAT added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;14&nbsp;09:17:09&nbsp;2008</span>
    <span class="description">rafl [...] debian.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
