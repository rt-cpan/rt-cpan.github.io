<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #57188 for UUID-Tiny: Partial thread support</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #57188 for UUID-Tiny: Partial thread support</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=UUID-Tiny">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=UUID-Tiny">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=UUID-Tiny">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=UUID-Tiny">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/UUID-Tiny">UUID-Tiny CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">57188</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=UUID-Tiny">UUID-Tiny</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">CAUGUSTIN [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
mschwern [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-228248-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.03    </td>
  </tr>
  <tr id="CF-228249-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




0001-Choose-the-thread-safe-Digest-SHA-PurePerl-if-thread.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/772502/399892/0001-Choose-the-thread-safe-Digest-SHA-PurePerl-if-thread.patch">
Tue May 04 17:03:12 2010 (1.5k) by schwern [...] pobox.com
</a>
</font></li>
</ul>


0001-Make-UUID-Tiny-mostly-work-with-threads.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/772068/399652/0001-Make-UUID-Tiny-mostly-work-with-threads.patch">
Mon May 03 21:13:41 2010 (2.7k) by mschwern [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=57188">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-772068" href="/Public/Bug/Display.html?id=57188#txn-772068">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;03&nbsp;21:13:41&nbsp;2010</span>
    <span class="description">mschwern [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Partial thread support</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/772068/399651/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/399651">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 970b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">UUID::Tiny doesn&#39;t work with threads.  The main problem is you can&#39;t
call lock on an unshared variable, you have to declare it shared first.
 By default, anything not declared shared is copied per thread &#40;this is
far safer than the traditional threading model&#41;.

It might save a little bit of performance to not copy the Digest
objects, but its not necessary and sharing objects gets annoying,
especially XS ones.

$Last_Pid should not be shared across threads else if two threads fork
they&#39;ll clobber each other.

$Clk_Seq and $Last_Timestamp, I think, should be shared.  Otherwise each
thread would have its own $Clk_Seq and increment it in parallel
presumably winding up with the same value.

With the attached patch in place, threading works... sort of.  The
problem is Digest::SHA and Digest::SHA1 do not appear to be thread safe.
 Creating one of their objects causes a lot of malloc warnings, but the
basic test passes.  Digest::SHA::PurePerl has no such problem.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-Make-UUID-Tiny-mostly-work-with-threads.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/772068/399652/0001-Make-UUID-Tiny-mostly-work-with-threads.patch">Download 0001-Make-UUID-Tiny-mostly-work-with-threads.patch</a><br />
<span class="downloadcontenttype">text/x-diff 2.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 747483a74dba588cf3d9d0c5c88fbcab0b8886c7 Mon Sep 17 00:00:00 2001
From: Michael G. Schwern &lt;schwern@pobox.com&gt;
Date: Mon, 3 May 2010 18:11:35 -0700
Subject: [PATCH] Make UUID::Tiny mostly work with threads.

Digest::SHA and Digest::SHA1 have threading bugs.
---
 lib/UUID/Tiny.pm |   13 ++++---------
 t/threads.t      |   39 +++++++++++++++++++++++++++++++++++++++
 2 files changed, 43 insertions&#40;+&#41;, 9 deletions&#40;-&#41;
 create mode 100644 t/threads.t

diff --git a/lib/UUID/Tiny.pm b/lib/UUID/Tiny.pm
index 5a7623d..4954d0a 100644
--- a/lib/UUID/Tiny.pm
+++ b/lib/UUID/Tiny.pm
@@ -9,7 +9,7 @@ use MIME::Base64;
 use Time::HiRes;
 use POSIX;
 
-our $SHA1_CALCULATOR = undef;
+my $SHA1_CALCULATOR = undef;
 
 {
     # Check for availability of SHA-1 ...
@@ -22,7 +22,7 @@ our $SHA1_CALCULATOR = undef;
     };
 };
 
-our $MD5_CALCULATOR = Digest::MD5-&gt;new&#40;&#41;;
+my $MD5_CALCULATOR = Digest::MD5-&gt;new&#40;&#41;;
 
 
 # ToDo:
@@ -388,8 +388,6 @@ sub _create_v3_uuid {
     my $name    = shift;
     my $uuid    = &#39;&#39;;
 
-    lock $MD5_CALCULATOR;
-
     # Create digest in UUID ...
     $MD5_CALCULATOR-&gt;reset&#40;&#41;;
     $MD5_CALCULATOR-&gt;add&#40;$ns_uuid&#41;;
@@ -441,8 +439,6 @@ sub _create_v5_uuid {
             ;
     }
 
-    lock $SHA1_CALCULATOR;
-
     $SHA1_CALCULATOR-&gt;reset&#40;&#41;;
     $SHA1_CALCULATOR-&gt;add&#40;$ns_uuid&#41;;
 
@@ -681,7 +677,7 @@ sub equal_uuids {
 # Private functions ...
 #
 my $Last_Pid;
-my $Clk_Seq;
+my $Clk_Seq :shared;
 
 # There is a problem with $Clk_Seq and rand&#40;&#41; on forking a process using
 # UUID::Tiny, because the forked process would use the same basic $Clk_Seq and
@@ -690,7 +686,6 @@ my $Clk_Seq;
 # time before using $Clk_Seq or rand&#40;&#41; ...
 
 sub _init_globals {
-    lock $Last_Pid;
     lock $Clk_Seq;
 
     if &#40;!defined $Last_Pid || $Last_Pid != $$&#41; {
@@ -714,7 +709,7 @@ sub _init_globals {
     return;
 }
 
-my $Last_Timestamp;
+my $Last_Timestamp : shared;
 
 sub _get_clk_seq {
     my $ts = shift;
diff --git a/t/threads.t b/t/threads.t
new file mode 100644
index 0000000..139e3c5
--- /dev/null
+++ b/t/threads.t
@@ -0,0 +1,39 @@
+#!/usr/bin/perl
+
+use strict;
+use warnings;
+
+my $Have_Threads;
+BEGIN {
+    $Have_Threads = eval {
+        require threads;
+        require threads::shared;
+        threads::shared-&gt;import;
+        1;
+    };
+    require Test::More;
+    Test::More-&gt;import;
+}
+
+plan skip_all =&gt; &#34;Needs threads&#34; unless $Have_Threads;
+
+use UUID::Tiny qw&#40;:std&#41;;
+
+my $Num_Threads = 5;
+
+my %uuids : shared;
+$uuids{create_uuid_as_string&#40;UUID_V4&#41;}++;
+
+for&#40;1..$Num_Threads&#41; {
+    threads-&gt;create&#40;sub {
+        $uuids{create_uuid_as_string&#40;UUID_V4&#41;}++;
+    }&#41;;
+}
+
+note &#34;All threads started&#34;;
+$_-&gt;join for threads-&gt;list;
+note &#34;All threads joined&#34;;
+
+is keys %uuids, $Num_Threads + 1, &#34;All v4 uuids should be unique per thread&#34;;
+
+done_testing;
-- 
1.7.0.3

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-772148" href="/Public/Bug/Display.html?id=57188#txn-772148">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;04&nbsp;03:32:44&nbsp;2010</span>
    <span class="description">CAUGUSTIN [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-772355" href="/Public/Bug/Display.html?id=57188#txn-772355">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;04&nbsp;12:39:45&nbsp;2010</span>
    <span class="description">cma [...] snafu.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #57188] Partial thread support </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 4 May 2010 18:39:22 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-UUID-Tiny [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christian Augustin &lt;cma [...] snafu.de&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/772355/399812/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/399812">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for your support and the tips. I applied your patches, but I can&#39;t get the test running - I constantly get the following error message under Mac OS X 10.6.3 &#40;with varying numbers&#41;:

t/04-UUID-threads.t .. # All threads started
perl&#40;711,0x7fff70193be0&#41; malloc: *** error for object 0x1004e1420: pointer being freed was not allocated
*** set a breakpoint in malloc_error_break to debug

I changed &#34;note&#34; to &#34;diag&#34; to see were things go bad. Seems to be a problem when a thread is joined; when I commented the line &#40;I know, that&#39;s bad :-&#41;, I&#39;ve gotten different results ... I can&#39;t reproduce them now, but I eventually got only 5 instead of 6 UUIDs in the hash &#40;and I constantly get a message complaining that Perl exited with active threads, but I guessed something like that would happen :-&#41;.

I have no idea how to investigate in the error message above and how to do the debugging to see what&#39;s wrong. Poking around in the innards of Perl is beyond my horizon, so any help is appreciated.

Is there a specific project that made you look into UUID::Tiny, or just out of curiosity?

Kind regards
-- 
Christian Augustin


Am 04.05.2010 um 03:13 schrieb Michael G Schwern via RT:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Mon May 03 21:13:41 2010: Request 57188 was acted upon.
&gt; Transaction: Ticket created by MSCHWERN
&gt;       Queue: UUID-Tiny
&gt;     Subject: Partial thread support
&gt;   Broken in: 1.03
&gt;    Severity: Normal
&gt;       Owner: Nobody
&gt;  Requestors: mschwern@cpan.org
&gt;      Status: new
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=57188">https://rt.cpan.org/Ticket/Display.html?id=57188</a></span> &gt;
&gt; 
&gt; 
&gt; UUID::Tiny doesn&#39;t work with threads.  The main problem is you can&#39;t
&gt; call lock on an unshared variable, you have to declare it shared first.
&gt; By default, anything not declared shared is copied per thread &#40;this is
&gt; far safer than the traditional threading model&#41;.
&gt; 
&gt; It might save a little bit of performance to not copy the Digest
&gt; objects, but its not necessary and sharing objects gets annoying,
&gt; especially XS ones.
&gt; 
&gt; $Last_Pid should not be shared across threads else if two threads fork
&gt; they&#39;ll clobber each other.
&gt; 
&gt; $Clk_Seq and $Last_Timestamp, I think, should be shared.  Otherwise each
&gt; thread would have its own $Clk_Seq and increment it in parallel
&gt; presumably winding up with the same value.
&gt; 
&gt; With the attached patch in place, threading works... sort of.  The
&gt; problem is Digest::SHA and Digest::SHA1 do not appear to be thread safe.
&gt; Creating one of their objects causes a lot of malloc warnings, but the
&gt; basic test passes.  Digest::SHA::PurePerl has no such problem.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-772358" href="/Public/Bug/Display.html?id=57188#txn-772358">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;04&nbsp;12:39:46&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-772502" href="/Public/Bug/Display.html?id=57188#txn-772502">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;04&nbsp;17:03:12&nbsp;2010</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #57188] Partial thread support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 04 May 2010 14:02:21 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-UUID-Tiny [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/772502/399891/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/399891">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2010.5.4 9:39 AM, Christian Augustin via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks for your support and the tips. I applied your patches, but I can&#39;t get the test running - I constantly get the following error message under Mac OS X 10.6.3 &#40;with varying numbers&#41;:
&gt; 
&gt; t/04-UUID-threads.t .. # All threads started
&gt; perl&#40;711,0x7fff70193be0&#41; malloc: *** error for object 0x1004e1420: pointer being freed was not allocated
&gt; *** set a breakpoint in malloc_error_break to debug
</div>
Yes, that&#39;s the problem coming from Digest::SHA or Digest::SHA1 that I
mentioned.  The test demonstrates the problem.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I changed &#34;note&#34; to &#34;diag&#34; to see were things go bad. Seems to be a problem when a thread
&gt; is joined; when I commented the line &#40;I know, that&#39;s bad :-&#41;, I&#39;ve gotten
</div>different
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; results ... I can&#39;t reproduce them now, but I eventually got only 5 instead
</div>of 6 UUIDs
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; in the hash &#40;and I constantly get a message complaining that Perl exited
</div>with active threads,
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; but I guessed something like that would happen :-&#41;.
</div>
That&#39;s expected behavior.  If you don&#39;t wait for the threads to finish &#40;that&#39;s
what join does&#41; then the test might check the hash before the threads are done
populating it.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have no idea how to investigate in the error message above and how to do the debugging
&gt; to see what&#39;s wrong. Poking around in the innards of Perl is beyond my
</div>horizon, so any
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; help is appreciated.
</div>
I see two options.  First, hope that Digest::SHA1 fixes threading.  I&#39;ve
reported it.  <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=57189">https://rt.cpan.org/Ticket/Display.html?id=57189</a></span>

Or if UUID::Tiny sees that threads are loaded, it can use
Digest::SHA::PurePerl.  This should work so long as threads are turned on
before UUID::Tiny is loaded.  The attached patch implements that on top of my
last one.

There is an issue that Digest::MD5 throws some warnings during global
destruction.  I&#39;m not sure what that&#39;s about, you could just suppress it.  You
may want to decide how far down the rabbit hole you want to go with this.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Is there a specific project that made you look into UUID::Tiny, or just out of curiosity?
</div>
Object::ID needs a thread-safe UUID generator for its object_uuid&#40;&#41; method.
Data::UUID is not thread-safe.


-- 
31. Not allowed to let sock puppets take responsibility for any of my
    actions.
    -- The 213 Things Skippy Is No Longer Allowed To Do In The U.S. Army
           <span class="clickylink"><a target="new" rel="nofollow" href="http://skippyslist.com/list/">http://skippyslist.com/list/</a></span>
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/772502/399892/0001-Choose-the-thread-safe-Digest-SHA-PurePerl-if-thread.patch">Download 0001-Choose-the-thread-safe-Digest-SHA-PurePerl-if-thread.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1.5k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-772639" href="/Public/Bug/Display.html?id=57188#txn-772639">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;05&nbsp;01:43:26&nbsp;2010</span>
    <span class="description">cma [...] snafu.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #57188] Partial thread support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 5 May 2010 07:43:12 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-UUID-Tiny [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christian Augustin &lt;cma [...] snafu.de&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/772639/399969/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/399969">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Am 04.05.2010 um 23:03 schrieb Michael G Schwern via RT:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I see two options.  First, hope that Digest::SHA1 fixes threading.  I&#39;ve
&gt; reported it.  <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=57189">https://rt.cpan.org/Ticket/Display.html?id=57189</a></span>
&gt; 
&gt; Or if UUID::Tiny sees that threads are loaded, it can use
&gt; Digest::SHA::PurePerl.  This should work so long as threads are turned on
&gt; before UUID::Tiny is loaded.  The attached patch implements that on top of my
&gt; last one.
&gt; 
&gt; There is an issue that Digest::MD5 throws some warnings during global
&gt; destruction.  I&#39;m not sure what that&#39;s about, you could just suppress it.  You
&gt; may want to decide how far down the rabbit hole you want to go with this.
&gt; 
&gt; 
<div class="message-stanza open">&gt;&gt; Is there a specific project that made you look into UUID::Tiny, or just out of curiosity?
</div>&gt; 
&gt; Object::ID needs a thread-safe UUID generator for its object_uuid&#40;&#41; method.
&gt; Data::UUID is not thread-safe.
</div>
I see. Give me some time &#40;I&#39;m busy at the moment&#41; and I&#39;ll think about it. Perhaps we can find an appropriate solution.
-- 
Christian Augustin
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-772653" href="/Public/Bug/Display.html?id=57188#txn-772653">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;05&nbsp;02:11:37&nbsp;2010</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #57188] Partial thread support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 04 May 2010 23:11:23 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-UUID-Tiny [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/772653/399980/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/399980">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 873b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2010.5.4 10:43 PM, Christian Augustin via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt; Is there a specific project that made you look into UUID::Tiny, or just out of curiosity?
</div>&gt;&gt;
&gt;&gt; Object::ID needs a thread-safe UUID generator for its object_uuid&#40;&#41; method.
&gt;&gt; Data::UUID is not thread-safe.
</div>&gt; 
&gt; I see. Give me some time &#40;I&#39;m busy at the moment&#41; and I&#39;ll think about it.
&gt; Perhaps we can find an appropriate solution.
</div>
rafl is working on making the Digest modules thread safe.  Hopefully, if we
wait a few days, my second patch will not be necessary.

Also, Object::ID strictly doesn&#39;t *need* a thread-safe UUID generator.  It
would just be nice if using Object::ID didn&#39;t mean you couldn&#39;t use threads.
There&#39;s no urgency.


-- 
125. Two drink limit does not mean two kinds of drinks.
    -- The 213 Things Skippy Is No Longer Allowed To Do In The U.S. Army
           <span class="clickylink"><a target="new" rel="nofollow" href="http://skippyslist.com/list/">http://skippyslist.com/list/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-772676" href="/Public/Bug/Display.html?id=57188#txn-772676">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;05&nbsp;04:41:45&nbsp;2010</span>
    <span class="description">cma [...] snafu.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #57188] Partial thread support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 5 May 2010 10:41:29 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-UUID-Tiny [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christian Augustin &lt;cma [...] snafu.de&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/772676/400006/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/400006">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 729b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Am 05.05.2010 um 08:11 schrieb Michael G Schwern via RT:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; rafl is working on making the Digest modules thread safe.  Hopefully, if we
&gt; wait a few days, my second patch will not be necessary.
</div>
It would be necessary, because UUID::Tiny could be used on systems without the latest patches, so it should be able to cope with such situations.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Also, Object::ID strictly doesn&#39;t *need* a thread-safe UUID generator.  It
&gt; would just be nice if using Object::ID didn&#39;t mean you couldn&#39;t use threads.
&gt; There&#39;s no urgency.
</div>
Yes, that would be nice. Same with UUID::Tiny. So I have to think about the associated problems. I&#39;ll come back to you with some thoughts and proposals &#40;by end of this week, I think&#41;.
-- 
Christian Augustin
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-790550" href="/Public/Bug/Display.html?id=57188#txn-790550">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;14&nbsp;06:42:18&nbsp;2010</span>
    <span class="description">cma [...] snafu.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #57188] Partial thread support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 14 Jun 2010 12:42:04 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-UUID-Tiny [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christian Augustin &lt;cma [...] snafu.de&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/790550/409617/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/409617">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 323b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Is there a way to get information about when the used Digest modules become thread-safe and the respective version numbers? I would like to incorporate tests to explicitly decide when a Digest module can be used with threads and to provide some way of checking and error reporting with UUID::Tiny.

-- 
Christian Augustin
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-790905" href="/Public/Bug/Display.html?id=57188#txn-790905">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;14&nbsp;18:53:40&nbsp;2010</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/790905/409836/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/409836">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 407b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jun 14 06:42:18 2010, cma@snafu.de wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Is there a way to get information about when the used Digest modules
&gt;    become thread-safe and the respective version numbers? I would like
&gt;    to incorporate tests to explicitly decide when a Digest module can
&gt;    be used with threads and to provide some way of checking and error
&gt;    reporting with UUID::Tiny.
</div>
I&#39;d just read their change log files.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1251035" href="/Public/Bug/Display.html?id=57188#txn-1251035">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;19&nbsp;10:15:56&nbsp;2013</span>
    <span class="description">CAUGUSTIN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1251035/661968/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/661968">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 183b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Can&#39;t get this to work properly, this is far beyond me. Cancelled test coverage for threads too because I can&#39;t get rid of the errors.

So: No reliable thread support with UUID::Tiny!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1251037" href="/Public/Bug/Display.html?id=57188#txn-1251037">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;19&nbsp;10:15:57&nbsp;2013</span>
    <span class="description">CAUGUSTIN [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1289754" href="/Public/Bug/Display.html?id=57188#txn-1289754">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;19&nbsp;06:03:46&nbsp;2013</span>
    <span class="description">cpan [...] barely3am.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1289754/683398/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/683398">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 629b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Aug 19 10:15:56 2013, CAUGUSTIN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Can&#39;t get this to work properly, this is far beyond me. Cancelled test
&gt; coverage for threads too because I can&#39;t get rid of the errors.
&gt; 
&gt; So: No reliable thread support with UUID::Tiny!
</div>

i haven&#39;t digested all of this, nor what i&#39;m about to post, but what about stealing some ideas from:

<span class="clickylink"><a target="new" rel="nofollow" href="http://cpansearch.perl.org/src/JESSE/Prophet-0.71/lib/Prophet/TempUUIDTiny.pm">http://cpansearch.perl.org/src/JESSE/Prophet-0.71/lib/Prophet/TempUUIDTiny.pm</a></span>

they claim it&#39;s thread-safe, maybe there&#39;s a nugget or two of intel in there that we can use.

i&#39;m adding this to my TODO list to look through, since Tiny::UUID looks promising long term &#40;OSSP::uuid is hard&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1289755" href="/Public/Bug/Display.html?id=57188#txn-1289755">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;19&nbsp;06:03:46&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1289758" href="/Public/Bug/Display.html?id=57188#txn-1289758">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;19&nbsp;06:22:11&nbsp;2013</span>
    <span class="description">cma [...] snafu.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #57188] Partial thread support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 19 Nov 2013 12:21:54 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-UUID-Tiny [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christian Augustin &lt;cma [...] snafu.de&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1289758/683401/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/683401">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Wes,

I have to do a diff, but I think this is all incorporated in my current version of UUID::Tiny &#40;Jesse helped me to fix some problems, and this looks like an intermediate version&#41;.

The threading problem is in the Perl libraries &#40;Digest modules&#41;, not in UUID::Tiny itself. As far as I know, at least. But because UUID::Tiny uses those modules I can’t say that it will reliably work with threading. I’m not even able to do proper testing, threading is completely out of my realm of expertise and occurring errors are complete gobbledygook to me.

If I can have a solid solution *including* reliable test coverage I will have a look on it and gladly incorporate it into UUID::Tiny if I can get it to work. No luck so far.

Best
-- 
Christian Augustin






Am 2013-11-19 um 12:03 schrieb &#34;Wes Young via RT&#34; &lt;bug-UUID-Tiny@rt.cpan.org&gt;:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       Queue: UUID-Tiny
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=57188">https://rt.cpan.org/Ticket/Display.html?id=57188</a></span> &gt;
&gt; 
&gt; On Mon Aug 19 10:15:56 2013, CAUGUSTIN wrote:
<div class="message-stanza open">&gt;&gt; Can&#39;t get this to work properly, this is far beyond me. Cancelled test
&gt;&gt; coverage for threads too because I can&#39;t get rid of the errors.
&gt;&gt; 
&gt;&gt; So: No reliable thread support with UUID::Tiny!
</div>&gt; 
&gt; 
&gt; i haven&#39;t digested all of this, nor what i&#39;m about to post, but what about stealing some ideas from:
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://cpansearch.perl.org/src/JESSE/Prophet-0.71/lib/Prophet/TempUUIDTiny.pm">http://cpansearch.perl.org/src/JESSE/Prophet-0.71/lib/Prophet/TempUUIDTiny.pm</a></span>
&gt; 
&gt; they claim it&#39;s thread-safe, maybe there&#39;s a nugget or two of intel in there that we can use.
&gt; 
&gt; i&#39;m adding this to my TODO list to look through, since Tiny::UUID looks promising long term &#40;OSSP::uuid is hard&#41;.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1289908" href="/Public/Bug/Display.html?id=57188#txn-1289908">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;19&nbsp;09:30:31&nbsp;2013</span>
    <span class="description">cma [...] snafu.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #57188] Partial thread support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 19 Nov 2013 15:30:11 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-UUID-Tiny [...] rt.cpan.org&#34; &lt;bug-UUID-Tiny [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christian Augustin &lt;cma [...] snafu.de&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1289908/683472/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/683472">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">It could be that UUID::Tiny behaves well with threading if only used to generate time based and random UUIDs, because MD5/SHA1 and therefor the Digest modules are not used for those. I can’t tell.

Best
-- 
Christian Augustin


Am 19.11.2013 um 12:03 schrieb &#34;Wes Young via RT&#34; &lt;bug-UUID-Tiny@rt.cpan.org&gt;:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       Queue: UUID-Tiny
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=57188">https://rt.cpan.org/Ticket/Display.html?id=57188</a></span> &gt;
&gt; 
&gt; On Mon Aug 19 10:15:56 2013, CAUGUSTIN wrote:
<div class="message-stanza open">&gt;&gt; Can&#39;t get this to work properly, this is far beyond me. Cancelled test
&gt;&gt; coverage for threads too because I can&#39;t get rid of the errors.
&gt;&gt; 
&gt;&gt; So: No reliable thread support with UUID::Tiny!
</div>&gt; 
&gt; 
&gt; i haven&#39;t digested all of this, nor what i&#39;m about to post, but what about stealing some ideas from:
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://cpansearch.perl.org/src/JESSE/Prophet-0.71/lib/Prophet/TempUUIDTiny.pm">http://cpansearch.perl.org/src/JESSE/Prophet-0.71/lib/Prophet/TempUUIDTiny.pm</a></span>
&gt; 
&gt; they claim it&#39;s thread-safe, maybe there&#39;s a nugget or two of intel in there that we can use.
&gt; 
&gt; i&#39;m adding this to my TODO list to look through, since Tiny::UUID looks promising long term &#40;OSSP::uuid is hard&#41;.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1292522" href="/Public/Bug/Display.html?id=57188#txn-1292522">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;23&nbsp;15:52:42&nbsp;2013</span>
    <span class="description">cpan [...] barely3am.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1292522/684810/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/684810">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 496b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Nov 19 09:30:31 2013, cma@snafu.de wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It could be that UUID::Tiny behaves well with threading if only used
&gt; to generate time based and random UUIDs, because MD5/SHA1 and therefor
&gt; the Digest modules are not used for those. I can’t tell.
&gt; 
&gt; Best
</div>
lol, i just sat down to digest what i was looking at, and then realized you guys were cross-pollinating already. all i saw was the &#34;this should be thread safe&#34; but didn&#39;t rlz it was just your 1.01 ver of the mod :&#41;

my bad. thanks!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1292533" href="/Public/Bug/Display.html?id=57188#txn-1292533">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;23&nbsp;16:29:32&nbsp;2013</span>
    <span class="description">cpan [...] barely3am.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1292533/684816/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/684816">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 301b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">i&#39;m looking at the Digest::SHA history and i think you&#39;re probably right. however, i commented out the Digest::SHA/1 and just left the ::PurePerl version and it *appears* to test OK?

wanna double check me? seems too easy to be true here.. :&#41;

&#40;perl threading is fun once you wrap your head around it&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1292536" href="/Public/Bug/Display.html?id=57188#txn-1292536">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;23&nbsp;16:30:04&nbsp;2013</span>
    <span class="description">cpan [...] barely3am.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1292536/684819/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/684819">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 736b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/lib/UUID/Tiny.pm b/lib/UUID/Tiny.pm
index c3e38df..0a0931e 100644
--- a/lib/UUID/Tiny.pm
+++ b/lib/UUID/Tiny.pm
@@ -14,8 +14,8 @@ my $SHA1_CALCULATOR = undef;
 {
     # Check for availability of SHA-1 ...
     local $@; # don&#39;t leak an error condition
-    eval { require Digest::SHA;  $SHA1_CALCULATOR = Digest::SHA-&gt;new&#40;1&#41; } ||
-    eval { require Digest::SHA1; $SHA1_CALCULATOR = Digest::SHA1-&gt;new&#40;&#41; } ||
+    #eval { require Digest::SHA;  $SHA1_CALCULATOR = Digest::SHA-&gt;new&#40;1&#41; } ||
+    #eval { require Digest::SHA1; $SHA1_CALCULATOR = Digest::SHA1-&gt;new&#40;&#41; } ||
     eval {
         require Digest::SHA::PurePerl;
         $SHA1_CALCULATOR = Digest::SHA::PurePerl-&gt;new&#40;1&#41;
@@ -24,7 +24,6 @@ my $SHA1_CALCULATOR = undef;
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.955873</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
