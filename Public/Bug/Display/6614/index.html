<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #6614 for Clamd: Clamd fails to return errors in a meaningful way</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #6614 for Clamd: Clamd fails to return errors in a meaningful way</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Clamd/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Clamd/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Clamd/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Clamd/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Clamd">Clamd CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">6614</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Clamd/Active/">Clamd</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
cfaber [...] fpsn.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-6506-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.00    </td>
  </tr>
  <tr id="CF-6507-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;13&nbsp;16:08:42&nbsp;2004</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Clamd fails to return errors in a meaningful way</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I noticed while using the Clamd application in one of my scripts that it either warns or dies on error, and there is no meaningful way of returning error messages from the Clamd module it self.  The solution is to provide an error handler routine which can collect and return the error message it self.

Commonly this error handler routine is known as: errstr&#40;&#41; - which is the name I&#39;ve chosen to use.


I&#39;ve attached a patch which adds this functionality to the Clamd.pm library, Nothing else has been modified.
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- Clamd-1.04/lib/Clamd.pm	Thu Nov 21 07:51:45 2002
+++ Clamd-1.05/lib/Clamd.pm	Sun Jun 13 14:07:34 2004
@@ -6,7 +6,7 @@
 use File::Find qw&#40;find&#41;;
 use IO::Socket;
 
-$VERSION = &#39;1.04&#39;;
+$VERSION = &#39;1.05&#39;;
 
 =head1 NAME
 
@@ -219,14 +219,21 @@
         
         while &#40;my $result = $conn-&gt;getline&#41; {
             chomp&#40;$result&#41;;
-            if &#40;$result !~ /^&#40;.*&#41;: &#40;.*&#41;&#40;ERROR|FOUND|OK&#41;$/ and $options-&gt;{ShowWarnings}&#41; {
-                warn&#40;&#34;Unrecognised line from clamd: $result\n&#34;&#41;;
+            if &#40;$result !~ /^&#40;.*&#41;: &#40;.*&#41;&#40;ERROR|FOUND|OK&#41;$/&#41;{
+		if&#40;$options-&gt;{ShowWarnings}&#41;{
+	                warn&#40;&#34;Unrecognised line from clamd: $result\n&#34;&#41;;
+		} else {
+			$self-&gt;errstr&#40;&#34;Unrecognised line from clamd: $result&#34;&#41;;
+			return;
+		}
             }
             my &#40;$filename, $desc, $type&#41; = &#40;$1, $2, $3&#41;;
             if &#40;$type eq &#39;ERROR&#39; and $options-&gt;{RaiseError}&#41; {
                 die&#40;&#34;Error processing $filename: $desc&#34;&#41;;
-            }
-            elsif &#40;$type eq &#39;FOUND&#39;&#41; {
+            } elsif&#40;$type eq &#39;ERROR&#39;&#41;{
+		$self-&gt;errstr&#40;&#34;Error professing $filename: $desc&#34;&#41;;
+		return;
+            } elsif &#40;$type eq &#39;FOUND&#39;&#41; {
                 push @results, $filename, $desc;
             }
         }
@@ -273,6 +280,18 @@
     1 while &#40;&lt;$conn&gt;&#41;;
     $conn-&gt;close;
     return 1;
+}
+
+=head2 errstr&#40;&#41;
+
+Return the last error message.
+
+=cut
+
+sub errstr {
+ my &#40;$self, $err&#41; = @_;
+ $self-&gt;{&#39;.errstr&#39;} = $err if $err;
+ return $self-&gt;{&#39;.errstr&#39;};
 }
 
 sub _get_connection {
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;21&nbsp;03:05:17&nbsp;2004</span>
    <span class="description">matt [...] sergeant.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Matt Sergeant &lt;matt [...] sergeant.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #6614] Clamd fails to return errors in a meaningful way </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 21 Jun 2004 08:05:02 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Clamd [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-Cc:</td>
    <td class="message-header-value"> </td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 13 Jun 2004, at 21:08, Guest via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This message about Clamd was sent to you by guest &lt;&gt; via rt.cpan.org
&gt;
&gt; Full context and any attached attachments can be found at:
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=6614">https://rt.cpan.org/Ticket/Display.html?id=6614</a></span> &gt;
&gt;
&gt; Hi,
&gt;
&gt; I noticed while using the Clamd application in one of my scripts that 
&gt; it either warns or dies on error, and there is no meaningful way of 
&gt; returning error messages from the Clamd module it self.  The solution 
&gt; is to provide an error handler routine which can collect and return 
&gt; the error message it self.
&gt;
&gt; Commonly this error handler routine is known as: errstr&#40;&#41; - which is 
&gt; the name I&#39;ve chosen to use.
&gt;
&gt;
&gt; I&#39;ve attached a patch which adds this functionality to the Clamd.pm 
&gt; library, Nothing else has been modified.
</div>
Errors should be trapped by wrapping the call to clamd in eval {} &#40;see 
perldoc -f eval for details on the block form of eval&#41;. Warnings can 
usually be dealt with before you send things to clamd &#40;i.e. if the file 
is of zero size you get a warning back - but you can just skip scanning 
those&#41;.

Sorry, patch rejected.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
