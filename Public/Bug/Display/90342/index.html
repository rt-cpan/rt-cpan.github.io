<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #90342 for Mail-Box: Problem getting Content-Type and dispositionFilename.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #90342 for Mail-Box: Problem getting Content-Type and dispositionFilename.</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Mail-Box/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Mail-Box/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Mail-Box/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Mail-Box/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Mail-Box">Mail-Box CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">90342</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Mail-Box/Active/">Mail-Box</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
claus [...] soonr.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-19874-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-19875-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;13&nbsp;18:37:40&nbsp;2013</span>
    <span class="description">claus [...] soonr.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Problem getting Content-Type and dispositionFilename.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 14 Nov 2013 00:37:28 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-Box [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Claus Jeppesen &lt;claus [...] soonr.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Mail::Box maintainers,

I have an email with an attachment where $SUBJECT happens:
Relevant part of the email source is:


Content-Type: multipart/mixed;
boundary=Apple-Mail-F456E080-E1F2-4159-9A65-88BEAFDC5715
Content-Transfer-Encoding: 7bit
Subject: Very Long Name of a Document.doc
From: claus@soonr.com
Date: Wed, 13 Nov 2013 17:20:09 -0500
To: inbox@soonr.com
Mime-Version: 1.0 &#40;1.0&#41;
X-Mailer: iPhone Mail &#40;11B511&#41;

--Apple-Mail-F456E080-E1F2-4159-9A65-88BEAFDC5715
Content-Type: text/plain;
        charset=us-ascii
Content-Transfer-Encoding: 7bit




--Apple-Mail-F456E080-E1F2-4159-9A65-88BEAFDC5715
Content-Type: application/msword;
        name*0=&#34;Very Long Name of a Document.d&#34;;
        name*1=oc
Content-Disposition: attachment;
        filename*0=&#34;Very Long Name of a Document.d&#34;;
        filename*1=oc
Content-Transfer-Encoding: base64

0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAAFAAAAOAIAAAAAAAAA
...
...
...

--Apple-Mail-F456E080-E1F2-4159-9A65-88BEAFDC5715
Content-Type: text/plain;
        charset=us-ascii
Content-Transfer-Encoding: 7bit




Sent from my iPhone

--Apple-Mail-F456E080-E1F2-4159-9A65-88BEAFDC5715--





Upon recursing over the email - e.g.

foreach my $part &#40;$msg-&gt;parts&#40;&#39;RECURSE&#39;&#41;&#41; {
  print $part-&gt;body-&gt;type&#40;&#41;,&#34;\n&#34;;
  print $part-&gt;body-&gt;dispositionFilename,&#34;\n&#34;;
}

I get:

text/plain;     charset=us-ascii
Use of uninitialized value in print at ./test.perl line 210.

application/msword;     name*0=&#34;Very Long Name of a Document.d&#34;;
name*1=oc
Use of uninitialized value in print at ./test.perl line 210.

text/plain;     charset=us-ascii
Use of uninitialized value in print at ./test.perl line 210.



As far as I understand the syntax in the header implies that the filename*0
and filename*1
should be collapsed into

    filename=&#34;Very Long Name of a Document.doc&#34;

&#40;The same goes for the Content-Type&#41;.

Thanx,

Claus.

-- 

*Claus Jeppesen* | Director of Network Servicesclaus@soonr.com | www.soonr.com
c +45 6170 5901
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;13&nbsp;18:57:05&nbsp;2013</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90342] Problem getting Content-Type and dispositionFilename.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 14 Nov 2013 00:56:45 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Claus Jeppesen via RT &lt;bug-Mail-Box [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Claus Jeppesen via RT &#40;bug-Mail-Box@rt.cpan.org&#41; [131113 23:37]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Wed Nov 13 18:37:40 2013: Request 90342 was acted upon.
&gt; Transaction: Ticket created by claus@soonr.com
&gt;        Queue: Mail-Box
&gt;      Subject: Problem getting Content-Type and dispositionFilename.
&gt; 
&gt; Hi Mail::Box maintainers,
&gt; 
&gt; I have an email with an attachment where $SUBJECT happens:
&gt; Relevant part of the email source is:
&gt; 
&gt; --Apple-Mail-F456E080-E1F2-4159-9A65-88BEAFDC5715
&gt; Content-Type: application/msword;
&gt;         name*0=&#34;Very Long Name of a Document.d&#34;;
&gt;         name*1=oc
&gt; Content-Disposition: attachment;
&gt;         filename*0=&#34;Very Long Name of a Document.d&#34;;
&gt;         filename*1=oc
</div>
Those specially endoded fields are not supported when you use
&#34;$msg-&gt;get&#40;&#41;&#34; or &#34;$header-&gt;get&#40;&#41;&#34;, but it should work when you use the
&#34;study&#40;&#41;&#34; alternatives.  Then you get the Mail::Message::Field::Full
headers which are slower but complete in their implementation.

Can you try that?
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;13&nbsp;18:57:05&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;14&nbsp;03:28:18&nbsp;2013</span>
    <span class="description">claus [...] soonr.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90342] Problem getting Content-Type and dispositionFilename.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 14 Nov 2013 09:28:01 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-Box [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Claus Jeppesen &lt;claus [...] soonr.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Mark,

Thanx for your response !

If I change the code to

foreach my $part &#40;$msg-&gt;parts&#40;&#39;RECURSE&#39;&#41;&#41; {

  if &#40;defined&#40;$part-&gt;study&#40;&#39;Content-Disposition&#39;&#41;&#41;&#41; {
    print &#34;Content-Disposition :=
&#34;,$part-&gt;study&#40;&#39;Content-Disposition&#39;&#41;,&#34;\n&#34;;
    my $f = $part-&gt;study&#40;&#39;Content-Disposition&#39;&#41;;
    print &#34;Attribute filename := &#34;,$f-&gt;attribute&#40;&#39;filename&#39;&#41;,&#34;\n\n&#34;;
  }

}

I get this:

Content-Disposition := attachment;      filename*0=&#34;Very Long Name of a
Document.d&#34;;    filename*1=oc
Attribute filename := [continuation missing]oc

Thanx,

Claus.

P.S.

I&#39;m using this version:

package Mail::Box::Manager;
use vars &#39;$VERSION&#39;;
$VERSION = &#39;2.107&#39;;

The headers in the email are using TAB &#40;result from cat -tv&#41;:

--Apple-Mail-F456E080-E1F2-4159-9A65-88BEAFDC5715
Content-Type: application/msword;
^Iname*0=&#34;Very Long Name of a Document.d&#34;;
^Iname*1=oc
Content-Disposition: attachment;
^Ifilename*0=&#34;Very Long Name of a Document.d&#34;;
^Ifilename*1=oc
Content-Transfer-Encoding: base64




On Thu, Nov 14, 2013 at 12:57 AM, Mark Overmeer via RT &lt;
bug-Mail-Box@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt;
&gt; * Claus Jeppesen via RT &#40;bug-Mail-Box@rt.cpan.org&#41; [131113 23:37]:
<div class="message-stanza open">&gt; &gt; Wed Nov 13 18:37:40 2013: Request 90342 was acted upon.
&gt; &gt; Transaction: Ticket created by claus@soonr.com
&gt; &gt;        Queue: Mail-Box
&gt; &gt;      Subject: Problem getting Content-Type and dispositionFilename.
&gt; &gt;
&gt; &gt; Hi Mail::Box maintainers,
&gt; &gt;
&gt; &gt; I have an email with an attachment where $SUBJECT happens:
&gt; &gt; Relevant part of the email source is:
&gt; &gt;
&gt; &gt; --Apple-Mail-F456E080-E1F2-4159-9A65-88BEAFDC5715
&gt; &gt; Content-Type: application/msword;
&gt; &gt;         name*0=&#34;Very Long Name of a Document.d&#34;;
&gt; &gt;         name*1=oc
&gt; &gt; Content-Disposition: attachment;
&gt; &gt;         filename*0=&#34;Very Long Name of a Document.d&#34;;
&gt; &gt;         filename*1=oc
</div>&gt;
&gt; Those specially endoded fields are not supported when you use
&gt; &#34;$msg-&gt;get&#40;&#41;&#34; or &#34;$header-&gt;get&#40;&#41;&#34;, but it should work when you use the
&gt; &#34;study&#40;&#41;&#34; alternatives.  Then you get the Mail::Message::Field::Full
&gt; headers which are slower but complete in their implementation.
&gt;
&gt; Can you try that?
&gt; --
&gt; Regards,
&gt;                MarkOv
&gt;
&gt; ------------------------------------------------------------------------
&gt;        Mark Overmeer MSc                                MARKOV Solutions
&gt;        Mark@Overmeer.net                          solutions@overmeer.net
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
&gt;
&gt;
&gt;
</div>

-- 

*Claus Jeppesen* | Director of Network Servicesclaus@soonr.com | www.soonr.com
c +45 6170 5901
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;14&nbsp;04:01:51&nbsp;2013</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90342] Problem getting Content-Type and dispositionFilename.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 14 Nov 2013 09:56:40 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Claus Jeppesen via RT &lt;bug-Mail-Box [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Claus Jeppesen via RT &#40;bug-Mail-Box@rt.cpan.org&#41; [131114 08:28]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Mail-Box
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt; 
&gt;   if &#40;defined&#40;$part-&gt;study&#40;&#39;Content-Disposition&#39;&#41;&#41;&#41; {
&gt;     print &#34;Content-Disposition :=
&gt; &#34;,$part-&gt;study&#40;&#39;Content-Disposition&#39;&#41;,&#34;\n&#34;;
&gt;     my $f = $part-&gt;study&#40;&#39;Content-Disposition&#39;&#41;;
&gt;     print &#34;Attribute filename := &#34;,$f-&gt;attribute&#40;&#39;filename&#39;&#41;,&#34;\n\n&#34;;
&gt;   }
</div>
study&#40;&#41; is expensive:

   if&#40;my $cd = $part-&gt;study&#40;&#39;Content-Disposition&#39;&#41;&#41;
   {   print $f-&gt;attribute&#40;&#39;filename&#39;&#41;;
   }

But what should work is  &#40;see Mail::Message::Body::Encode&#41;

   my $fn = $message-&gt;body-&gt;dispositionFilename;

These attribute continuations are implemented but so rarely used that
it may very well show some new problems with the code when you use it.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;14&nbsp;04:15:52&nbsp;2013</span>
    <span class="description">claus [...] soonr.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90342] Problem getting Content-Type and dispositionFilename.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 14 Nov 2013 10:15:35 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-Box [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Claus Jeppesen &lt;claus [...] soonr.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Mark,

Unfortunately - if I in the loop over parts &#40;of $msg&#41; do:

if &#40;defined&#40;$part-&gt;study&#40;&#39;Content-Disposition&#39;&#41;&#41;&#41; {
  print &#34;Content-Disposition := &#34;,$part-&gt;study&#40;&#39;Content-Disposition&#39;&#41;,&#34;\n&#34;;
  my $f = $part-&gt;study&#40;&#39;Content-Disposition&#39;&#41;;
  print &#34;Attribute filename := &#34;,$f-&gt;attribute&#40;&#39;filename&#39;&#41;,&#34;\n&#34;;
}

if &#40;defined&#40;$msg-&gt;body-&gt;dispositionFilename&#41;&#41; {
  my $fn = $msg-&gt;body-&gt;dispositionFilename;
  print &#34;dispositionFilename := &#34;,$fn,&#34;\n\n&#34;;
} else {
  print &#34;dispositionFilename not defined\n\n&#34;;
}

I get:

dispositionFilename not defined

Content-Disposition := attachment;      filename*0=&#34;Very Long Name of a
Document.d&#34;;    filename*1=oc
Attribute filename := [continuation missing]oc
*dispositionFilename not defined*

dispositionFilename not defined

But in middle the filename SHOULD be defined.

Thanx,

Claus.




On Thu, Nov 14, 2013 at 10:01 AM, Mark Overmeer via RT &lt;
bug-Mail-Box@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt;
&gt; * Claus Jeppesen via RT &#40;bug-Mail-Box@rt.cpan.org&#41; [131114 08:28]:
<div class="message-stanza open">&gt; &gt;        Queue: Mail-Box
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt; &gt;
&gt; &gt;   if &#40;defined&#40;$part-&gt;study&#40;&#39;Content-Disposition&#39;&#41;&#41;&#41; {
&gt; &gt;     print &#34;Content-Disposition :=
&gt; &gt; &#34;,$part-&gt;study&#40;&#39;Content-Disposition&#39;&#41;,&#34;\n&#34;;
&gt; &gt;     my $f = $part-&gt;study&#40;&#39;Content-Disposition&#39;&#41;;
&gt; &gt;     print &#34;Attribute filename := &#34;,$f-&gt;attribute&#40;&#39;filename&#39;&#41;,&#34;\n\n&#34;;
&gt; &gt;   }
</div>&gt;
&gt; study&#40;&#41; is expensive:
&gt;
&gt;    if&#40;my $cd = $part-&gt;study&#40;&#39;Content-Disposition&#39;&#41;&#41;
&gt;    {   print $f-&gt;attribute&#40;&#39;filename&#39;&#41;;
&gt;    }
&gt;
&gt; But what should work is  &#40;see Mail::Message::Body::Encode&#41;
&gt;
&gt;    my $fn = $message-&gt;body-&gt;dispositionFilename;
&gt;
&gt; These attribute continuations are implemented but so rarely used that
&gt; it may very well show some new problems with the code when you use it.
&gt; --
&gt; Regards,
&gt;                MarkOv
&gt;
&gt; ------------------------------------------------------------------------
&gt;        Mark Overmeer MSc                                MARKOV Solutions
&gt;        Mark@Overmeer.net                          solutions@overmeer.net
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
&gt;
&gt;
&gt;
</div>

-- 

*Claus Jeppesen* | Director of Network Servicesclaus@soonr.com | www.soonr.com
c +45 6170 5901
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;14&nbsp;04:20:46&nbsp;2013</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90342] Problem getting Content-Type and dispositionFilename.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 14 Nov 2013 10:20:30 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Claus Jeppesen via RT &lt;bug-Mail-Box [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Claus Jeppesen via RT &#40;bug-Mail-Box@rt.cpan.org&#41; [131114 09:16]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Mail-Box
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt; 
&gt; if &#40;defined&#40;$msg-&gt;body-&gt;dispositionFilename&#41;&#41; {
&gt;   my $fn = $msg-&gt;body-&gt;dispositionFilename;
&gt;   print &#34;dispositionFilename := &#34;,$fn,&#34;\n\n&#34;;
&gt; } else {
&gt;   print &#34;dispositionFilename not defined\n\n&#34;;
&gt; }
&gt; 
&gt; I get:
&gt; 
&gt; dispositionFilename not defined
&gt; 
&gt; Content-Disposition := attachment;      filename*0=&#34;Very Long Name of a
&gt; Document.d&#34;;    filename*1=oc
&gt; Attribute filename := [continuation missing]oc
&gt; *dispositionFilename not defined*
&gt; 
&gt; dispositionFilename not defined
&gt; 
&gt; But in middle the filename SHOULD be defined.
</div>
Of course: in your case it is &#34;$part-&gt;body-&gt;dispositionFilename&#34;
My example was for single-part messages.
-- 
Regards,

               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
drs Mark A.C.J. Overmeer                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;05&nbsp;05:42:50&nbsp;2013</span>
    <span class="description">claus [...] soonr.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90342] Problem getting Content-Type and dispositionFilename.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 5 Dec 2013 11:42:38 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-Box [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Claus Jeppesen &lt;claus [...] soonr.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">One Possible solution is for Mail::Box to use &#34;MIME::EcoEncode::Param&#34; -
which can decode
those RFC2231 headers.
&#40;see
<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~murataya/MIME-EcoEncode-0.95/lib/MIME/EcoEncode/Param.pod">http://search.cpan.org/~murataya/MIME-EcoEncode-0.95/lib/MIME/EcoEncode/Param.pod</a></span>
&#41;.

Somewhat like this:

use Encode;
use Param;

$str=&#34;name*0*=ISO-8859-15&#39;&#39;R%FCckstellung%20DB%2C%20DZ%20u.%20KommSt%202001-2004;\n
name*1*=.xls&#34;;

&#40;$decoded, $param, $charset, $lang, $value&#41; = mime_deco_param&#40;$str&#41;;
print &#34;decoded :: $decoded\n&#34;;
print &#34;param   :: $param\n&#34;;
print &#34;charset :: $charset\n&#34;;
print &#34;lang    :: $lang\n&#34;;
print &#34;value   :: $value\n\n&#34;;

# Just because my linux is UTF8.
if &#40;$charset !~ /utf8/i&#41; {
  print Encode::encode_utf8&#40;$decoded&#41;,&#34;\n&#34;;
}

Thanx,

Claus.


On Thu, Nov 14, 2013 at 10:20 AM, Mark Overmeer via RT &lt;
bug-Mail-Box@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt;
&gt; * Claus Jeppesen via RT &#40;bug-Mail-Box@rt.cpan.org&#41; [131114 09:16]:
<div class="message-stanza open">&gt; &gt;        Queue: Mail-Box
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt; &gt;
&gt; &gt; if &#40;defined&#40;$msg-&gt;body-&gt;dispositionFilename&#41;&#41; {
&gt; &gt;   my $fn = $msg-&gt;body-&gt;dispositionFilename;
&gt; &gt;   print &#34;dispositionFilename := &#34;,$fn,&#34;\n\n&#34;;
&gt; &gt; } else {
&gt; &gt;   print &#34;dispositionFilename not defined\n\n&#34;;
&gt; &gt; }
&gt; &gt;
&gt; &gt; I get:
&gt; &gt;
&gt; &gt; dispositionFilename not defined
&gt; &gt;
&gt; &gt; Content-Disposition := attachment;      filename*0=&#34;Very Long Name of a
&gt; &gt; Document.d&#34;;    filename*1=oc
&gt; &gt; Attribute filename := [continuation missing]oc
&gt; &gt; *dispositionFilename not defined*
&gt; &gt;
&gt; &gt; dispositionFilename not defined
&gt; &gt;
&gt; &gt; But in middle the filename SHOULD be defined.
</div>&gt;
&gt; Of course: in your case it is &#34;$part-&gt;body-&gt;dispositionFilename&#34;
&gt; My example was for single-part messages.
&gt; --
&gt; Regards,
&gt;
&gt;                MarkOv
&gt;
&gt; ------------------------------------------------------------------------
&gt;        Mark Overmeer MSc                                MARKOV Solutions
&gt; drs Mark A.C.J. Overmeer                                MARKOV Solutions
&gt;        Mark@Overmeer.net                          solutions@overmeer.net
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
&gt;
&gt;
&gt;
</div>

-- 

*Claus Jeppesen* | Director of Network Servicesclaus@soonr.com | www.soonr.com
c +45 6170 5901
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;05&nbsp;05:47:50&nbsp;2013</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90342] Problem getting Content-Type and dispositionFilename.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 5 Dec 2013 11:47:32 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Claus Jeppesen via RT &lt;bug-Mail-Box [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Claus Jeppesen via RT &#40;bug-Mail-Box@rt.cpan.org&#41; [131205 10:43]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Mail-Box
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt; 
&gt; One Possible solution is for Mail::Box to use &#34;MIME::EcoEncode::Param&#34; -
&gt; which can decode those RFC2231 headers.
</div>
???

MailBox does fully support these headers, so why whould I need to
use an other module?   The only problem you had with my example
what to call it on the message part, not on the main message.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &gt; Of course: in your case it is &#34;$part-&gt;body-&gt;dispositionFilename&#34;
&gt; &gt; My example was for single-part messages.
</div>
&#40;Although the parsing on these headers is correct, there may still
be a problem with using that in dispositionFilename&#40;&#41; because I never
encountered such encoded filename in real life&#41;

               MarkOv
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;05&nbsp;05:53:58&nbsp;2013</span>
    <span class="description">claus [...] soonr.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90342] Problem getting Content-Type and dispositionFilename.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 5 Dec 2013 11:53:48 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-Box [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Claus Jeppesen &lt;claus [...] soonr.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">OK - let me see if I understand you point of view.

The passing of the email is done correctly according to RFC822 &#40;and
descendants&#41; - however
it&#39;s the responsibility of the consumer of the &#34;header-&gt;study&#34; output to
reconstruct the &#34;name&#34;
in a case where the headers look like:

Content-Type: application/msword;
 name*0=&#34;Very Long Name of a Document.d&#34;;
 name*1=oc

Thanx,

Claus.


On Thu, Dec 5, 2013 at 11:47 AM, Mark Overmeer via RT &lt;
bug-Mail-Box@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt;
&gt; * Claus Jeppesen via RT &#40;bug-Mail-Box@rt.cpan.org&#41; [131205 10:43]:
<div class="message-stanza open">&gt; &gt;        Queue: Mail-Box
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt; &gt;
&gt; &gt; One Possible solution is for Mail::Box to use &#34;MIME::EcoEncode::Param&#34; -
&gt; &gt; which can decode those RFC2231 headers.
</div>&gt;
&gt; ???
&gt;
&gt; MailBox does fully support these headers, so why whould I need to
&gt; use an other module?   The only problem you had with my example
&gt; what to call it on the message part, not on the main message.
&gt;
<div class="message-stanza open">&gt; &gt; &gt; Of course: in your case it is &#34;$part-&gt;body-&gt;dispositionFilename&#34;
&gt; &gt; &gt; My example was for single-part messages.
</div>&gt;
&gt; &#40;Although the parsing on these headers is correct, there may still
&gt; be a problem with using that in dispositionFilename&#40;&#41; because I never
&gt; encountered such encoded filename in real life&#41;
&gt;
&gt;                MarkOv
&gt;
&gt;
</div>

-- 

*Claus Jeppesen* | Director of Network Servicesclaus@soonr.com | www.soonr.com
c +45 6170 5901
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;05&nbsp;06:29:08&nbsp;2013</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90342] Problem getting Content-Type and dispositionFilename.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 5 Dec 2013 12:28:49 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Claus Jeppesen via RT &lt;bug-Mail-Box [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Claus Jeppesen via RT &#40;bug-Mail-Box@rt.cpan.org&#41; [131205 10:54]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Mail-Box
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt; 
&gt; The passing of the email is done correctly according to RFC822 &#40;and
&gt; descendants&#41; - however it&#39;s the responsibility of the consumer of the
&gt; &#34;header-&gt;study&#34; output to reconstruct the &#34;name&#34;
</div>
No, that is not my intention.  It should work &#34;out of the box&#34;

Long time ago that I looked at the code, and very busy on the moment...

Can you try this in lib/Mail/Message/Body/Encode.pm

 sub dispositionFilename&#40;;$&#41;
 {  my $self = shift;
    my $raw;

    my $field;
    if&#40;$field = $self-&gt;disposition&#41;
  - {   $raw  = $field-&gt;attribute&#40;&#39;filename&#39;&#41;
  + {   $field = $field-&gt;study;
  +     $raw  = $field-&gt;attribute&#40;&#39;filename&#39;&#41;
             || $field-&gt;attribute&#40;&#39;file&#39;&#41;
             || $field-&gt;attribute&#40;&#39;name&#39;&#41;;
    }

    if&#40;!defined $raw &#38;&#38; &#40;$field = $self-&gt;type&#41;&#41;
  - {   $raw  = $field-&gt;attribute&#40;&#39;filename&#39;&#41;
  + {   $field = $field-&gt;study;
  +     $raw  = $field-&gt;attribute&#40;&#39;filename&#39;&#41;
             || $field-&gt;attribute&#40;&#39;file&#39;&#41;

-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;05&nbsp;08:03:46&nbsp;2013</span>
    <span class="description">claus [...] soonr.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90342] Problem getting Content-Type and dispositionFilename.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 5 Dec 2013 14:03:25 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-Box [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Claus Jeppesen &lt;claus [...] soonr.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Yep - that helped !

If I have an email with:

Content-Disposition: inline;

filename*0*=ISO-8859-15&#39;&#39;R%FCckstellung%20DB%2C%20DZ%20u.%20KommSt%202001-;
        filename*1*=2004.xls

Then

if &#40;defined&#40;$part-&gt;study&#40;&#39;Content-Disposition&#39;&#41;&#41;&#41; {
  print &#34;Content-Disposition := &#34;,$part-&gt;study&#40;&#39;Content-Disposition&#39;&#41;,&#34;\n&#34;;
  my $f = $part-&gt;study&#40;&#39;Content-Disposition&#39;&#41;;
  print &#34;Attribute filename := &#34;,$f-&gt;attribute&#40;&#39;filename&#39;&#41;,&#34;\n&#34;;
}

if &#40;defined&#40;$part-&gt;body-&gt;dispositionFilename&#41;&#41; {
  my $fn = $part-&gt;body-&gt;dispositionFilename;
  print &#34;dispositionFilename := &#34;,$fn,&#34;\n\n&#34;;
}

Gives me the output:

Content-Disposition := inline;
filename=&#34;ISO-8859-15&#39;&#39;R%FCckstellung%20DB%2C%20DZ%20u.%20KommSt%202001-2004.xls&#34;
Attribute filename :=
ISO-8859-15&#39;&#39;R%FCckstellung%20DB%2C%20DZ%20u.%20KommSt%202001-2004.xls
dispositionFilename :=
ISO-8859-15&#39;&#39;R%FCckstellung%20DB%2C%20DZ%20u.%20KommSt%202001-2004.xls

Of course now we have to look at the dispositionFilename and get it
massaged into an UTF8 string &#40;or whatever target we need&#41; :&#41;

Thanx,

Claus.



On Thu, Dec 5, 2013 at 12:29 PM, Mark Overmeer via RT &lt;
bug-Mail-Box@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt;
&gt; * Claus Jeppesen via RT &#40;bug-Mail-Box@rt.cpan.org&#41; [131205 10:54]:
<div class="message-stanza open">&gt; &gt;        Queue: Mail-Box
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt; &gt;
&gt; &gt; The passing of the email is done correctly according to RFC822 &#40;and
&gt; &gt; descendants&#41; - however it&#39;s the responsibility of the consumer of the
&gt; &gt; &#34;header-&gt;study&#34; output to reconstruct the &#34;name&#34;
</div>&gt;
&gt; No, that is not my intention.  It should work &#34;out of the box&#34;
&gt;
&gt; Long time ago that I looked at the code, and very busy on the moment...
&gt;
&gt; Can you try this in lib/Mail/Message/Body/Encode.pm
&gt;
&gt;  sub dispositionFilename&#40;;$&#41;
&gt;  {  my $self = shift;
&gt;     my $raw;
&gt;
&gt;     my $field;
&gt;     if&#40;$field = $self-&gt;disposition&#41;
&gt;   - {   $raw  = $field-&gt;attribute&#40;&#39;filename&#39;&#41;
&gt;   + {   $field = $field-&gt;study;
&gt;   +     $raw  = $field-&gt;attribute&#40;&#39;filename&#39;&#41;
&gt;              || $field-&gt;attribute&#40;&#39;file&#39;&#41;
&gt;              || $field-&gt;attribute&#40;&#39;name&#39;&#41;;
&gt;     }
&gt;
&gt;     if&#40;!defined $raw &#38;&#38; &#40;$field = $self-&gt;type&#41;&#41;
&gt;   - {   $raw  = $field-&gt;attribute&#40;&#39;filename&#39;&#41;
&gt;   + {   $field = $field-&gt;study;
&gt;   +     $raw  = $field-&gt;attribute&#40;&#39;filename&#39;&#41;
&gt;              || $field-&gt;attribute&#40;&#39;file&#39;&#41;
&gt;
&gt; --
&gt; Regards,
&gt;                MarkOv
&gt;
&gt; ------------------------------------------------------------------------
&gt;        Mark Overmeer MSc                                MARKOV Solutions
&gt;        Mark@Overmeer.net                          solutions@overmeer.net
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
&gt;
&gt;
&gt;
</div>

-- 

*Claus Jeppesen* | Director of Network Servicesclaus@soonr.com | www.soonr.com
c +45 6170 5901
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;05&nbsp;09:54:33&nbsp;2013</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90342] Problem getting Content-Type and dispositionFilename.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 5 Dec 2013 15:54:20 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Claus Jeppesen via RT &lt;bug-Mail-Box [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Claus Jeppesen via RT &#40;bug-Mail-Box@rt.cpan.org&#41; [131205 13:03]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Mail-Box
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt; 
&gt; Yep - that helped !
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Content-Disposition := inline;
&gt; filename=&#34;ISO-8859-15&#39;&#39;R%FCckstellung%20DB%2C%20DZ%20u.%20KommSt%202001-2004.xls&#34;
</div>
The decoding of the %FC encoding should happen automatically as well.
It is tested in  tests/14fieldu/20attr.t

When I look at this:

    my $base;
    if&#40;!defined $raw || !length $raw&#41; {}
    elsif&#40;index&#40;$raw, &#39;?&#39;&#41; &gt;= 0&#41;
    {   eval &#39;require Mail::Message::Field::Full&#39;;
        $base = Mail::Message::Field::Full-&gt;decode&#40;$raw&#41;;
    }
    else
    {   $base = $raw;
    }

Probably we should always call decode&#40;&#41;.
Can you try
 -  elsif&#40;index&#40;$raw, &#39;?&#39;&#41; &gt;= 0&#41;
 -  {   eval &#39;require Mail::Message::Field::Full&#39;;
        $base = Mail::Message::Field::Full-&gt;decode&#40;$raw&#41;;
 -  else
 -  {   $base = $raw;
 -  }
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;06&nbsp;03:15:46&nbsp;2013</span>
    <span class="description">claus [...] soonr.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90342] Problem getting Content-Type and dispositionFilename.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 6 Dec 2013 09:15:34 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-Box [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Claus Jeppesen &lt;claus [...] soonr.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Unfortunately it looks like Mail::Message::Field::Full-&gt;decode&#40;&#41; cannot
take care of those
&#34;rfc2231&#34;  style encoded strings.

It looks to me like it can only handle rfc2047 style encoded strings via
the code snippet:

shift&#40;@encoded&#41; =~ /\=\?&#40;[^?\s]*&#41;\?&#40;[^?\s]*&#41;\?&#40;[^?]*&#41;\?\=/;

i.e. =?iso-8859-1?q?this=20is=20some=20text?= works ... but not
ISO-8859-15&#39;&#39;R%FCckstellung%20DB%2C%20DZ%20u.%20KommSt%202001-2004.xls

Thanx,

Claus.



On Thu, Dec 5, 2013 at 3:54 PM, Mark Overmeer via RT &lt;
bug-Mail-Box@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt;
&gt; * Claus Jeppesen via RT &#40;bug-Mail-Box@rt.cpan.org&#41; [131205 13:03]:
<div class="message-stanza open">&gt; &gt;        Queue: Mail-Box
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt; &gt;
&gt; &gt; Yep - that helped !
</div>&gt;
<div class="message-stanza open">&gt; &gt; Content-Disposition := inline;
&gt; &gt;
</div>&gt; filename=&#34;ISO-8859-15&#39;&#39;R%FCckstellung%20DB%2C%20DZ%20u.%20KommSt%202001-2004.xls&#34;
&gt;
&gt; The decoding of the %FC encoding should happen automatically as well.
&gt; It is tested in  tests/14fieldu/20attr.t
&gt;
&gt; When I look at this:
&gt;
&gt;     my $base;
&gt;     if&#40;!defined $raw || !length $raw&#41; {}
&gt;     elsif&#40;index&#40;$raw, &#39;?&#39;&#41; &gt;= 0&#41;
&gt;     {   eval &#39;require Mail::Message::Field::Full&#39;;
&gt;         $base = Mail::Message::Field::Full-&gt;decode&#40;$raw&#41;;
&gt;     }
&gt;     else
&gt;     {   $base = $raw;
&gt;     }
&gt;
&gt; Probably we should always call decode&#40;&#41;.
&gt; Can you try
&gt;  -  elsif&#40;index&#40;$raw, &#39;?&#39;&#41; &gt;= 0&#41;
&gt;  -  {   eval &#39;require Mail::Message::Field::Full&#39;;
&gt;         $base = Mail::Message::Field::Full-&gt;decode&#40;$raw&#41;;
&gt;  -  else
&gt;  -  {   $base = $raw;
&gt;  -  }
&gt; --
&gt; Regards,
&gt;                MarkOv
&gt;
&gt; ------------------------------------------------------------------------
&gt;        Mark Overmeer MSc                                MARKOV Solutions
&gt;        Mark@Overmeer.net                          solutions@overmeer.net
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
&gt;
&gt;
&gt;
</div>

-- 

*Claus Jeppesen* | Director of Network Servicesclaus@soonr.com | www.soonr.com
c +45 6170 5901
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;06&nbsp;04:27:57&nbsp;2013</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90342] Problem getting Content-Type and dispositionFilename.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 6 Dec 2013 10:27:42 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Claus Jeppesen via RT &lt;bug-Mail-Box [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Claus Jeppesen via RT &#40;bug-Mail-Box@rt.cpan.org&#41; [131206 08:15]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Mail-Box
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt; 
&gt; Unfortunately it looks like Mail::Message::Field::Full-&gt;decode&#40;&#41; cannot
&gt; take care of those &#34;rfc2231&#34;  style encoded strings.
</div>
Ah... I start to remember...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; i.e. =?iso-8859-1?q?this=20is=20some=20text?= works ... but not
&gt; ISO-8859-15&#39;&#39;R%FCckstellung%20DB%2C%20DZ%20u.%20KommSt%202001-2004.xls
</div>
The content of attribute fields need to be encoded with =???= and
the other parts of the mime lines with &#39;&#39;

But, I do not remember if I ever understood why there are two
different encodings.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;22&nbsp;11:38:04&nbsp;2014</span>
    <span class="description">https://www.google.com/accounts/o8/id?id=AItOawm_jIKbpgLwnIMuSXsD6UZv_dqlnUmwaqg -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> unknown.vagrant [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Some clients give name for part of filename with index or without index

------------------------
Content-Type: application/pdf;
 name=&#34;=?KOI8-R?Q?22=F2=C5=DA=C5=D2=D7_=D0=C9=D3=D8=CD=CF_-=F4=FA=2Epdf?=&#34;
Content-Transfer-Encoding: base64
Content-Disposition: attachment;
 filename*0*=koi8-r&#39;&#39;111%F2%C5%DA%C5%D2%D7%20%D0%C9%D3%D8%CD%CF%20%2D%F4%FA%2E;
 filename*1*=%70%64%66
------------------------

i have wrong filename in result because you dont have mechanism for understand this header.

I wrote an implementation, you can modify if you want

sub dispositionFilename&#40;;$&#41;
{   my $self = shift;
    my $raw;
    my $field;
    
        if &#40;$field = $self-&gt;disposition&#40;&#41;&#41; {
                use Data::Dumper;
                # Filename have more then one part - filename*
                # rfc6266 section-4.3
                # Warning!
                # Some clients give name for part of filename with index - filename*0*, filename*1* etc
                # See also <span class="clickylink"><a target="new" rel="nofollow" href="http://stackoverflow.com/questions/93551/how-to-encode-the-filename-parameter-of-content-disposition-header-in-http">http://stackoverflow.com/questions/93551/how-to-encode-the-filename-parameter-of-content-disposition-header-in-http</a></span>
                if &#40;$field =~ /filename\*/&#41; {
                        my @raws;
                        my $charset;
                        
                        # can be filename*0* + filename*1* or filename* + filename*0*
                        while&#40;$field =~ /filename\*\d{0,}\*?\=\s?&#40;[^\&#39;]*?&#39;?&#39;?[^?;]*&#41;/g&#41; {
                                push @raws, $1;
                        }
                        
                        # parts
                        foreach my $name &#40;@raws&#41; {
                                # decode url encoded data
                                $name =~ s/%&#40;[a-fA-F0-9][a-fA-F0-9]&#41;/pack&#40;&#34;C&#34;, hex&#40;$1&#41;&#41;/ge;
                                
                                # filename part have charset
                                if &#40;index&#40;$name, &#34;&#39;&#39;&#34;&#41; &gt; 0&#41; {
                                        $name =~ /&#40;[^\&#39;]+&#41;&#39;&#39;&#40;.+&#41;/;
                                        $charset = $1;
                                        $raw .= Encode::decode&#40;$charset, $2&#41;;
                                }
                                else {
                                        $raw .= $name;
                                }
                        }
                        
                        # For debug
                        #die&#40;Encode::encode&#40;&#39;cp866&#39;, $filename&#41;&#41;;
                }
                else {
                $field = $field-&gt;study if $field-&gt;can&#40;&#39;study&#39;&#41;;
                $raw   = $field-&gt;attribute&#40;&#39;filename&#39;&#41;;
                $raw      ||= $field-&gt;attribute&#40;&#39;file&#39;&#41;;
                $raw      ||= $field-&gt;attribute&#40;&#39;name&#39;&#41;;
                }
    }
        
    if&#40;!defined $raw &#38;&#38; &#40;$field = $self-&gt;type&#41;&#41;
    {   $field = $field-&gt;study if $field-&gt;can&#40;&#39;study&#39;&#41;;
        $raw   = $field-&gt;attribute&#40;&#39;filename&#39;&#41;
              || $field-&gt;attribute&#40;&#39;file&#39;&#41;
              || $field-&gt;attribute&#40;&#39;name&#39;&#41;;
    }

.... remainder unchanged ...
}
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;27&nbsp;16:54:52&nbsp;2014</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90342] Problem getting Content-Type and dispositionFilename.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 27 Aug 2014 22:54:38 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;<span class="clickylink"><a target="new" rel="nofollow" href="https://www.google.com/accounts/o8/id?id=AItOawm_jIKbpgLwnIMuSXsD6UZv_dqlnUmwaqg">https://www.google.com/accounts/o8/id?id=AItOawm_jIKbpgLwnIMuSXsD6UZv_dqlnUmwaqg</a></span> via RT&#34; &lt;bug-Mail-Box [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* <span class="clickylink"><a target="new" rel="nofollow" href="https://www.google.com/accounts/o8/id?id=AItOawm_jIKbpgLwnIMuSXsD6UZv_dqlnUmwaqg">https://www.google.com/accounts/o8/id?id=AItOawm_jIKbpgLwnIMuSXsD6UZv_dqlnUmwaqg</a></span> via RT &#40;bug-Mail-Box@rt.cpan.org&#41; [140822 15:38]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Mail-Box
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt; 
&gt; Some clients give name for part of filename with index or without index
&gt; i have wrong filename in result because you dont have mechanism for
&gt; understand this header.
</div>
lib/Mail/Message/Field/Attribute.pm implements this, tested in
tests/14fieldu/20attr.t  Why does my implementation not work in
your case?
-- 
Regards,

               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
drs Mark A.C.J. Overmeer                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;25&nbsp;15:37:02&nbsp;2015</span>
    <span class="description">claus [...] soonr.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90342] Problem getting Content-Type and dispositionFilename.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 25 Feb 2015 21:36:45 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-Box [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Claus Jeppesen &lt;claus [...] soonr.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Mark,

I can see that Mail/Message/Body/Encode.pm &#40;v2.117&#41; is using:

   - $field = $field-&gt;study if $field-&gt;can&#40;&#39;study&#39;&#41;

in &#34;sub dispositionFilename&#34;.

However - I still see that when emails come in with headers like:

Content-Disposition: inline;
        filename*0=&#34;Selling #1 &#40;signed&#41; - 11-13.p&#34;;
        filename*1=df

I get this back from dispositionFilename:

   - [continuation missing]df

&#34;continuation missing&#34; seems to come from:

   -
   - sub decode&#40;&#41; in Mail/Message/Field/Attribute.pm

Thanx,

Claus.



On Wed, Aug 27, 2014 at 10:54 PM, Mark Overmeer via RT &lt;
bug-Mail-Box@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt;
&gt; *
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://www.google.com/accounts/o8/id?id=AItOawm_jIKbpgLwnIMuSXsD6UZv_dqlnUmwaqg">https://www.google.com/accounts/o8/id?id=AItOawm_jIKbpgLwnIMuSXsD6UZv_dqlnUmwaqg</a></span>
&gt; via RT &#40;bug-Mail-Box@rt.cpan.org&#41; [140822 15:38]:
<div class="message-stanza open">&gt; &gt;        Queue: Mail-Box
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt; &gt;
&gt; &gt; Some clients give name for part of filename with index or without index
&gt; &gt; i have wrong filename in result because you dont have mechanism for
&gt; &gt; understand this header.
</div>&gt;
&gt; lib/Mail/Message/Field/Attribute.pm implements this, tested in
&gt; tests/14fieldu/20attr.t  Why does my implementation not work in
&gt; your case?
&gt; --
&gt; Regards,
&gt;
&gt;                MarkOv
&gt;
&gt; ------------------------------------------------------------------------
&gt;        Mark Overmeer MSc                                MARKOV Solutions
&gt; drs Mark A.C.J. Overmeer                                MARKOV Solutions
&gt;        Mark@Overmeer.net                          solutions@overmeer.net
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
&gt;
&gt;
&gt;
</div>

-- 

*Claus Jeppesen* | Director of Network Servicesclaus@soonr.com | www.soonr.com
c +45 6170 5901
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;26&nbsp;06:56:30&nbsp;2015</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90342] Problem getting Content-Type and dispositionFilename.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 26 Feb 2015 12:56:14 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Claus Jeppesen via RT &lt;bug-Mail-Box [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Claus Jeppesen via RT &#40;bug-Mail-Box@rt.cpan.org&#41; [150225 20:37]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Mail-Box
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt; 
&gt; However - I still see that when emails come in with headers like:
&gt; Content-Disposition: inline;
&gt;         filename*0=&#34;Selling #1 &#40;signed&#41; - 11-13.p&#34;;
&gt;         filename*1=df
&gt; 
&gt; I get this back from dispositionFilename:
&gt;    - [continuation missing]df
</div>
Fixed.  On the ::Field::Structured level, each field attribute was
processed separately.  So, these continuations were not merged into
one ::Field::Attribute object.

Now it works.  Just released 2.118 to CPAN.
-- 
thanks for the report,

               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;26&nbsp;07:46:55&nbsp;2015</span>
    <span class="description">claus [...] soonr.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90342] Problem getting Content-Type and dispositionFilename.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 26 Feb 2015 13:46:41 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-Box [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Claus Jeppesen &lt;claus [...] soonr.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Mark,

Thanx,

The collapse of the multiline filename is now working. However, there is
still the issue
of decoding the strings &#40;rfc 2231&#41; - e.g.

Content-Disposition: inline;

filename*0*=&#34;ISO-8859-15&#39;&#39;R%FCckstellung%20DB%2C%20DZ%20u.%20KommSt%202001-&#34;;
        filename*1*=&#34;2004.xls&#34;

Which with &#34;body-&gt;dispositionFilename&#34; gives us:

   - R�ckstellung DB, DZ u. KommSt 2001-2004.xls

But the correct decode &#40;German &#38;uuml;&#41; is:

   -  Rückstellung DB, DZ u. KommSt 2001-2004.xls

I think one can borrow inspiration from the implementation of &#34;sub
mime_deco_param {}&#34;
in
<span class="clickylink"><a target="new" rel="nofollow" href="http://cpansearch.perl.org/src/MURATAYA/MIME-EcoEncode-0.95/lib/MIME/EcoEncode/Param.pm">http://cpansearch.perl.org/src/MURATAYA/MIME-EcoEncode-0.95/lib/MIME/EcoEncode/Param.pm</a></span>
which also seems to take care of rfc 2047 style encoding.

Thanx,

Claus.

On Thu, Feb 26, 2015 at 12:56 PM, Mark Overmeer via RT &lt;
bug-Mail-Box@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt;
&gt; * Claus Jeppesen via RT &#40;bug-Mail-Box@rt.cpan.org&#41; [150225 20:37]:
<div class="message-stanza open">&gt; &gt;        Queue: Mail-Box
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt; &gt;
&gt; &gt; However - I still see that when emails come in with headers like:
&gt; &gt; Content-Disposition: inline;
&gt; &gt;         filename*0=&#34;Selling #1 &#40;signed&#41; - 11-13.p&#34;;
&gt; &gt;         filename*1=df
&gt; &gt;
&gt; &gt; I get this back from dispositionFilename:
&gt; &gt;    - [continuation missing]df
</div>&gt;
&gt; Fixed.  On the ::Field::Structured level, each field attribute was
&gt; processed separately.  So, these continuations were not merged into
&gt; one ::Field::Attribute object.
&gt;
&gt; Now it works.  Just released 2.118 to CPAN.
&gt; --
&gt; thanks for the report,
&gt;
&gt;                MarkOv
&gt;
&gt; ------------------------------------------------------------------------
&gt;        Mark Overmeer MSc                                MARKOV Solutions
&gt;        Mark@Overmeer.net                          solutions@overmeer.net
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
&gt;
&gt;
&gt;
</div>

-- 

*Claus Jeppesen* | Director of Network Servicesclaus@soonr.com | www.soonr.com
c +45 6170 5901
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;26&nbsp;08:03:55&nbsp;2015</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90342] Problem getting Content-Type and dispositionFilename.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 26 Feb 2015 14:03:36 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Claus Jeppesen via RT &lt;bug-Mail-Box [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Claus Jeppesen via RT &#40;bug-Mail-Box@rt.cpan.org&#41; [150226 12:47]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Mail-Box
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt; 
&gt; filename*0*=&#34;ISO-8859-15&#39;&#39;R%FCckstellung%20DB%2C%20DZ%20u.%20KommSt%202001-&#34;;
&gt;         filename*1*=&#34;2004.xls&#34;
&gt; 
&gt; Which with &#34;body-&gt;dispositionFilename&#34; gives us:
&gt;    - R�ckstellung DB, DZ u. KommSt 2001-2004.xls
</div>
I have added this to the test-script

  use utf8;
  my $h2 = Mail::Message::Field::Full-&gt;new&#40;&#39;Content-Disposition&#39; =&gt; q{inline;
filename*0*=&#34;ISO-8859-15&#39;&#39;R%FCckstellung%20DB%2C%20DZ%20u.%20KommSt%202001-&#34;;
        filename*1*=&#34;2004.xls&#34;}&#41;;
  is&#40;$h2-&gt;attribute&#40;&#39;filename&#39;&#41;, &#39;Rückstellung DB, DZ u. KommSt 2001-2004.xls&#39;&#41;;

... and that produces a success.  May have something to do which your
charset of stdout.  Or am I wrong?

You can see that I already support decoding, so why refer to that other
module?
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;26&nbsp;08:28:26&nbsp;2015</span>
    <span class="description">claus [...] soonr.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90342] Problem getting Content-Type and dispositionFilename.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 26 Feb 2015 14:28:16 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-Box [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Claus Jeppesen &lt;claus [...] soonr.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Mark,

Trying this:

my $dispositionFilename = $part-&gt;body-&gt;dispositionFilename;
print &#34;dispositionFilename :: &#34;,$dispositionFilename,&#34;\n&#34;;
print &#34;encoding ...........:: &#34;,encode&#40;&#34;utf8&#34;,$dispositionFilename&#41;,&#34;\n&#34;;

results in:

dispositionFilename :: R�ckstellung DB, DZ u. KommSt 2001-2004.xls
encoding ...........:: Rückstellung DB, DZ u. KommSt 2001-2004.xls

Using Centos6 , perl 5.10.1, and ENV has LC_CTYPE=en_US.UTF-8.
So there is something with utf8 &#40;adding &#34;use utf8;&#34; changes nothing&#41;,

Thanx,

Claus.

On Thu, Feb 26, 2015 at 2:03 PM, Mark Overmeer via RT &lt;
bug-Mail-Box@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt;
&gt; * Claus Jeppesen via RT &#40;bug-Mail-Box@rt.cpan.org&#41; [150226 12:47]:
<div class="message-stanza open">&gt; &gt;        Queue: Mail-Box
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt; &gt;
&gt; &gt;
</div>&gt; filename*0*=&#34;ISO-8859-15&#39;&#39;R%FCckstellung%20DB%2C%20DZ%20u.%20KommSt%202001-&#34;;
<div class="message-stanza open">&gt; &gt;         filename*1*=&#34;2004.xls&#34;
&gt; &gt;
&gt; &gt; Which with &#34;body-&gt;dispositionFilename&#34; gives us:
&gt; &gt;    - R�ckstellung DB, DZ u. KommSt 2001-2004.xls
</div>&gt;
&gt; I have added this to the test-script
&gt;
&gt;   use utf8;
&gt;   my $h2 = Mail::Message::Field::Full-&gt;new&#40;&#39;Content-Disposition&#39; =&gt;
&gt; q{inline;
&gt;
&gt; filename*0*=&#34;ISO-8859-15&#39;&#39;R%FCckstellung%20DB%2C%20DZ%20u.%20KommSt%202001-&#34;;
&gt;         filename*1*=&#34;2004.xls&#34;}&#41;;
&gt;   is&#40;$h2-&gt;attribute&#40;&#39;filename&#39;&#41;, &#39;Rückstellung DB, DZ u. KommSt
&gt; 2001-2004.xls&#39;&#41;;
&gt;
&gt; ... and that produces a success.  May have something to do which your
&gt; charset of stdout.  Or am I wrong?
&gt;
&gt; You can see that I already support decoding, so why refer to that other
&gt; module?
&gt; --
&gt; Regards,
&gt;                MarkOv
&gt;
&gt; ------------------------------------------------------------------------
&gt;        Mark Overmeer MSc                                MARKOV Solutions
&gt;        Mark@Overmeer.net                          solutions@overmeer.net
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
&gt;
&gt;
&gt;
</div>

-- 

*Claus Jeppesen* | Director of Network Servicesclaus@soonr.com | www.soonr.com
c +45 6170 5901
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;26&nbsp;09:19:32&nbsp;2015</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90342] Problem getting Content-Type and dispositionFilename.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 26 Feb 2015 15:19:17 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Claus Jeppesen via RT &lt;bug-Mail-Box [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Claus Jeppesen via RT &#40;bug-Mail-Box@rt.cpan.org&#41; [150226 13:28]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Mail-Box
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt; 
&gt; my $dispositionFilename = $part-&gt;body-&gt;dispositionFilename;
&gt; print &#34;dispositionFilename :: &#34;,$dispositionFilename,&#34;\n&#34;;
&gt; print &#34;encoding ...........:: &#34;,encode&#40;&#34;utf8&#34;,$dispositionFilename&#41;,&#34;\n&#34;;
</div>
Your source encoding is ISO-8859-15.  In recent versions of Encode, that
may lead to a string which does not have the utf8 flag on &#40;latin1&#41; When
you output latin1 to a utf8 terminal, you get an � on some characters.

When you explicitly encode it into utf8, and then output it to a
utf8 terminal, it will work.  This may help:

    use open OUT =&gt; &#39;:utf8&#39;;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So there is something with utf8 &#40;adding &#34;use utf8;&#34; changes nothing&#41;,
</div>
&#34;use utf8&#34; means that the perl source file is written in utf8, not
latin1.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;26&nbsp;09:40:21&nbsp;2015</span>
    <span class="description">claus [...] soonr.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #90342] Problem getting Content-Type and dispositionFilename.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 26 Feb 2015 15:40:10 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-Box [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Claus Jeppesen &lt;claus [...] soonr.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Mark,

Thanx for the hint - it&#39;s definitely a Perl meta-data issue !
The md5sum on the 2 variables are identical - but prints differently :&#41;

Claus.

On Thu, Feb 26, 2015 at 3:19 PM, Mark Overmeer via RT &lt;
bug-Mail-Box@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt;
&gt; * Claus Jeppesen via RT &#40;bug-Mail-Box@rt.cpan.org&#41; [150226 13:28]:
<div class="message-stanza open">&gt; &gt;        Queue: Mail-Box
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=90342">https://rt.cpan.org/Ticket/Display.html?id=90342</a></span> &gt;
&gt; &gt;
&gt; &gt; my $dispositionFilename = $part-&gt;body-&gt;dispositionFilename;
&gt; &gt; print &#34;dispositionFilename :: &#34;,$dispositionFilename,&#34;\n&#34;;
&gt; &gt; print &#34;encoding ...........:: &#34;,encode&#40;&#34;utf8&#34;,$dispositionFilename&#41;,&#34;\n&#34;;
</div>&gt;
&gt; Your source encoding is ISO-8859-15.  In recent versions of Encode, that
&gt; may lead to a string which does not have the utf8 flag on &#40;latin1&#41; When
&gt; you output latin1 to a utf8 terminal, you get an � on some characters.
&gt;
&gt; When you explicitly encode it into utf8, and then output it to a
&gt; utf8 terminal, it will work.  This may help:
&gt;
&gt;     use open OUT =&gt; &#39;:utf8&#39;;
&gt;
<div class="message-stanza open">&gt; &gt; So there is something with utf8 &#40;adding &#34;use utf8;&#34; changes nothing&#41;,
</div>&gt;
&gt; &#34;use utf8&#34; means that the perl source file is written in utf8, not
&gt; latin1.
&gt; --
&gt; Regards,
&gt;                MarkOv
&gt;
&gt; ------------------------------------------------------------------------
&gt;        Mark Overmeer MSc                                MARKOV Solutions
&gt;        Mark@Overmeer.net                          solutions@overmeer.net
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
&gt;
&gt;
&gt;
</div>

-- 

*Claus Jeppesen* | Director of Network Servicesclaus@soonr.com | www.soonr.com
c +45 6170 5901
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;17&nbsp;04:03:37&nbsp;2015</span>
    <span class="description">MARKOV [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
