<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #116795 for Net-SSLeay: OCSP broken in 1.75+ - patch included</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #116795 for Net-SSLeay: OCSP broken in 1.75+ - patch included</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Net-SSLeay">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Net-SSLeay">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Net-SSLeay">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Net-SSLeay">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-SSLeay">Net-SSLeay CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">116795</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Net-SSLeay">Net-SSLeay</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
Steffen_Ullrich [...] genua.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-44414-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
1.75</li>
<li>
1.76</li>
<li>
1.77</li>
</ul>
    </td>
  </tr>
  <tr id="CF-44415-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




patch.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1658327/890171/patch.txt">
Fri Aug 12 03:49:14 2016 (6.2k) by Steffen_Ullrich [...] genua.de
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/1658303/890154/patch.txt">
Fri Aug 12 02:02:04 2016 (4.1k) by Steffen_Ullrich [...] genua.de
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/1658070/889996/patch.txt">
Thu Aug 11 08:01:50 2016 (3.6k) by Steffen_Ullrich [...] genua.de
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/1658047/889981/patch.txt">
Thu Aug 11 06:04:28 2016 (3.3k) by Steffen_Ullrich [...] genua.de
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/1656940/889283/patch.txt">
Tue Aug 09 10:29:02 2016 (3.6k) by Steffen_Ullrich [...] genua.de
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=116795">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1656940" href="/Public/Bug/Display.html?id=116795#txn-1656940">#</a>      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;09&nbsp;10:29:02&nbsp;2016</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> OCSP broken in 1.75+ - patch included</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1656940/889282/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/889282">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 475b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

Due to code changes OCSP got broken in 1.75. Unfortunately the existing test showed no error because due to changed certificates for the external sites the test simply was skipped automatically.

Attached is a patch which makes OCSP work again. This also updates the patch to match the new certificates and additionally makes sure that the OCSP test will not skip subtests when the certificates change again, at least not if ENV RELEASE_TESTING is set.

Regards,
Steffen
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> patch.txt</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1656940/889283/patch.txt">Download patch.txt</a><br />
<span class="downloadcontenttype">text/plain 3.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: SSLeay.xs
===================================================================
--- SSLeay.xs	&#40;revision 477&#41;
+++ SSLeay.xs	&#40;working copy&#41;
@@ -6011,7 +6011,7 @@
 		X509 *issuer;
 		X509 *last = sk_X509_value&#40;chain,sk_X509_num&#40;chain&#41;-1&#41;;
 		if &#40; &#40;issuer = find_issuer&#40;last,store,chain&#41;&#41;&#41; {
-		    OCSP_basic_add1_cert&#40;bsr, X509_dup&#40;issuer&#41;&#41;;
+		    OCSP_basic_add1_cert&#40;bsr, issuer&#41;;
 		    TRACE&#40;1,&#34;run OCSP_basic_verify with issuer for last chain element&#34;&#41;;
 		    RETVAL = OCSP_basic_verify&#40;bsr, NULL, store, flags&#41;;
 		}
@@ -6058,11 +6058,8 @@
 		    goto end;
 		}
                 int first = OCSP_resp_find&#40;bsr, certid, -1&#41;; /* Find the first matching */
-		if &#40;first &gt;= 0&#41;
-		{
-		    sir = OCSP_resp_get0&#40;bsr,first&#41;;
-		    break;
-		}
+                if &#40;first &gt;= 0&#41;
+                    sir = OCSP_resp_get0&#40;bsr,first&#41;;
 	    }
 
 	    int status, revocationReason;   
@@ -6073,7 +6070,8 @@
 		status = OCSP_single_get0_status&#40;sir, &#38;revocationReason, &#38;revocationTime, &#38;thisupdate, &#38;nextupdate&#41;;
 #else
 		status = sir-&gt;certStatus-&gt;type;
-		revocationTime = sir-&gt;certStatus-&gt;value.revoked-&gt;revocationTime;
+		if &#40;status == V_OCSP_CERTSTATUS_REVOKED&#41;
+		    revocationTime = sir-&gt;certStatus-&gt;value.revoked-&gt;revocationTime;
 		thisupdate = sir-&gt;thisUpdate;
 		nextupdate = sir-&gt;nextUpdate;
 #endif
Index: t/external/ocsp.t
===================================================================
--- t/external/ocsp.t	&#40;revision 477&#41;
+++ t/external/ocsp.t	&#40;working copy&#41;
@@ -16,7 +16,7 @@
 	# this should give us OCSP stapling
 	host =&gt; &#39;www.live.com&#39;,
 	port =&gt; 443,
-	fingerprint =&gt; &#39;10c56ee9e2acaf2e77caeb7072bf6522dd7422b8&#39;,
+	fingerprint =&gt; &#39;0e37dc9b320d2526e93e360a26c824b202d1f3af&#39;,
 	ocsp_staple =&gt; 1,
 	expect_status =&gt; Net::SSLeay::V_OCSP_CERTSTATUS_GOOD&#40;&#41;,
     },
@@ -24,7 +24,7 @@
 	# no OCSP stapling yet
 	host =&gt; &#39;www.google.com&#39;,
 	port =&gt; 443,
-	fingerprint =&gt; &#39;007a5ab302f14446e2ea24d3a829de22ba1bf950&#39;,
+	fingerprint =&gt; &#39;89380c438a076d9d5fac228a8f680ff452487f30&#39;,
 	expect_status =&gt; Net::SSLeay::V_OCSP_CERTSTATUS_GOOD&#40;&#41;,
     },
     {
@@ -31,7 +31,7 @@
 	# this is revoked
 	host =&gt; &#39;revoked.grc.com&#39;,
 	port =&gt; 443,
-	fingerprint =&gt; &#39;34703c40093461ad3ce087e161c7b7f42abe770c&#39;,
+	fingerprint =&gt; &#39;310665f4c8e78db761c764e798dca66047341264&#39;,
 	expect_status =&gt; Net::SSLeay::V_OCSP_CERTSTATUS_REVOKED&#40;&#41;,
     },
 &#41;;
@@ -50,6 +50,12 @@
 
 TEST:
 
+sub skip_unless_release {
+    die &#34;this test should not be skipped for release - might need to fix test&#34; 
+	if $ENV{RELEASE_TESTING};
+    goto &#38;skip;
+}
+
 for my $test &#40;@tests&#41; {
     my $cleanup = __cleanup__-&gt;new;
     SKIP: {
@@ -61,7 +67,7 @@
 	    PeerPort =&gt; $test-&gt;{port},
 	    Timeout =&gt; $timeout,
 	&#41;;
-	skip &#34;TCP connect to $test-&gt;{host}:$test-&gt;{port} failed: $!&#34;,1
+	skip_unless_release &#34;TCP connect to $test-&gt;{host}:$test-&gt;{port} failed: $!&#34;,1
 	    if !$cl;
 	diag&#40;&#34;tcp connect to $test-&gt;{host}:$test-&gt;{port} ok&#34;&#41;;
 
@@ -103,7 +109,7 @@
 		select&#40;undef,$vec,undef,$to&#41;;
 	    }
 	}
-	skip &#34;SSL_connect with $test-&gt;{host}:$test-&gt;{port} failed: &#34;.
+	skip_unless_release &#34;SSL_connect with $test-&gt;{host}:$test-&gt;{port} failed: &#34;.
 	    Net::SSLeay::print_errs&#40;&#39;&#39;&#41;,1
 	    if $rv&lt;=0;
 	diag&#40;&#34;SSL_connect ok&#34;&#41;;
@@ -113,8 +119,8 @@
 	$cleanup-&gt;add&#40;sub { Net::SSLeay::X509_free&#40;$leaf_cert&#41; }&#41; if $leaf_cert;
 	my $fp = $leaf_cert
 	    &#38;&#38; unpack&#40;&#34;H*&#34;,Net::SSLeay::X509_digest&#40;$leaf_cert,$sha1&#41;&#41;;
-	skip &#34;could not get fingerprint&#34;,1 if !$fp;
-	skip &#34;bad fingerprint $fp for $test-&gt;{host}:$test-&gt;{port}&#34;,1
+	skip_unless_release &#34;could not get fingerprint&#34;,1 if !$fp;
+	skip_unless_release &#34;bad fingerprint $fp for $test-&gt;{host}:$test-&gt;{port}&#34;,1
 	    if $fp ne $test-&gt;{fingerprint};
 	diag&#40;&#34;fingerprint matches&#34;&#41;;
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1657128" href="/Public/Bug/Display.html?id=116795#txn-1657128">#</a>      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;09&nbsp;19:41:15&nbsp;2016</span>
    <span class="description">mikem [...] airspayce.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #116795] OCSP broken in 1.75+ - patch included</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 10 Aug 2016 09:40:55 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] airspayce.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1657128/889391/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/889391">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks Steffen,

I will apply this soon, but Im not sure this code in ocsp.t is helpful:

sub skip_unless_release {
    die &#34;this test should not be skipped for release - might need to fix test&#34; 
        if $ENV{RELEASE_TESTING};
    goto &#38;skip;
}

If you enable RELEASE_TESTING the test fail with:

t/external/ocsp.t ...................... # tcp connect to www.live.com:443 ok
# got stapled OCSP response
# SSL_connect ok
this test should not be skipped for release - might need to fix test at 
t/external/ocsp.t line 54.
# Looks like your test exited with 255 before it could output anything.
t/external/ocsp.t ...................... Dubious, test returned 255 &#40;wstat 
65280, 0xff00&#41;
Failed 3/3 subtests 


I dont think die ing is the right response. Perhaps you meant 

        return
          if $ENV{RELEASE_TESTING};

Cheers.

On Tuesday, August 09, 2016 10:29:04 AM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Tue Aug 09 10:29:02 2016: Request 116795 was acted upon.
&gt; Transaction: Ticket created by SULLR
&gt;        Queue: Net-SSLeay
&gt;      Subject: OCSP broken in 1.75+ - patch included
&gt;    Broken in: 1.75, 1.76, 1.77
&gt;     Severity: &#40;no value&#41;
&gt;        Owner: Nobody
&gt;   Requestors: Steffen_Ullrich@genua.de
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=116795">https://rt.cpan.org/Ticket/Display.html?id=116795</a></span> &gt;
&gt; 
&gt; 
&gt; Hi,
&gt; 
&gt; Due to code changes OCSP got broken in 1.75. Unfortunately the existing test
&gt; showed no error because due to changed certificates for the external sites
&gt; the test simply was skipped automatically.
&gt; 
&gt; Attached is a patch which makes OCSP work again. This also updates the patch
&gt; to match the new certificates and additionally makes sure that the OCSP
&gt; test will not skip subtests when the certificates change again, at least
&gt; not if ENV RELEASE_TESTING is set.
&gt; 
&gt; Regards,
&gt; Steffen
</div>
-- 
Mike McCauley           VK4AMM                   mikem@airspayce.com
Airspayce Pty Ltd 9 Bulbul Place Currumbin Waters QLD 4223 Australia   
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.airspayce.com">http://www.airspayce.com</a></span>
Phone +61 7 5598-7474
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1657129" href="/Public/Bug/Display.html?id=116795#txn-1657129">#</a>      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;09&nbsp;19:41:16&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1657218" href="/Public/Bug/Display.html?id=116795#txn-1657218">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;10&nbsp;01:44:33&nbsp;2016</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #116795] OCSP broken in 1.75+ - patch included</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 10 Aug 2016 07:44:12 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Mike McCauley via RT &lt;bug-Net-SSLeay [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Steffen Ullrich &lt;Steffen_Ullrich [...] genua.de&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1657218/889432/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/889432">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; I will apply this soon, but Im not sure this code in ocsp.t is helpful:
&gt; 
&gt; sub skip_unless_release {
&gt;     die &#34;this test should not be skipped for release - might need to fix test&#34; 
&gt; ...
&gt; I dont think die ing is the right response. Perhaps you meant 
&gt; 
&gt;       return
&gt;         if $ENV{RELEASE_TESTING};
</div>
The problem I&#39;ve tried to solve was that the OCSP test automatically got
skipped because the fingerprints of the certificates did not match anymore
and thus SSL interception was assumed &#40;which makes OCSP tests not possible&#41;.

The intention of the die&#40;&#41; was that the test should fail badly in this case
on RELEASE_TESTING so that one adjusts the fingerprints if needed. With the
return instead of the die it will simply assume that the fingerprints are
valid and continue. This might either result in that the test passes &#40;if
only the certificates got changed but the OCSP behavior stays&#41; or that the
tests fail &#40;if there is SSL interception or the OCSP behavior changed&#41;. 

I would rather see that the developer is forced to adapt the test to the new
certifcates, because otherwise the test gets automatically skipped for all
others not doing release tests because of the certificate mismatch. That&#39;s
why I&#39;ve opted for the die&#40;&#41;.

Regards,
Steffen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1657486" href="/Public/Bug/Display.html?id=116795#txn-1657486">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;10&nbsp;19:23:20&nbsp;2016</span>
    <span class="description">mikem [...] airspayce.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #116795] OCSP broken in 1.75+ - patch included</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 11 Aug 2016 09:23:03 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] airspayce.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1657486/889561/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/889561">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Steffen,

 
On Wednesday, August 10, 2016 01:44:34 AM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=116795">https://rt.cpan.org/Ticket/Display.html?id=116795</a></span> &gt;
&gt; 
<div class="message-stanza open">&gt; &gt; I will apply this soon, but Im not sure this code in ocsp.t is helpful:
&gt; &gt; 
&gt; &gt; sub skip_unless_release {
&gt; &gt; 
&gt; &gt;     die &#34;this test should not be skipped for release - might need to fix
&gt; &gt;     test&#34;
&gt; &gt; 
&gt; &gt; ...
&gt; &gt; I dont think die ing is the right response. Perhaps you meant
&gt; &gt; 
&gt; &gt;     return
&gt; &gt;     
&gt; &gt;       if $ENV{RELEASE_TESTING};
</div>&gt; 
&gt; The problem I&#39;ve tried to solve was that the OCSP test automatically got
&gt; skipped because the fingerprints of the certificates did not match anymore
&gt; and thus SSL interception was assumed &#40;which makes OCSP tests not possible&#41;.
&gt; 
&gt; The intention of the die&#40;&#41; was that the test should fail badly in this case
&gt; on RELEASE_TESTING so that one adjusts the fingerprints if needed. With the
&gt; return instead of the die it will simply assume that the fingerprints are
&gt; valid and continue. This might either result in that the test passes &#40;if
&gt; only the certificates got changed but the OCSP behavior stays&#41; or that the
&gt; tests fail &#40;if there is SSL interception or the OCSP behavior changed&#41;.
&gt; 
&gt; I would rather see that the developer is forced to adapt the test to the new
&gt; certifcates, because otherwise the test gets automatically skipped for all
&gt; others not doing release tests because of the certificate mismatch. That&#39;s
&gt; why I&#39;ve opted for the die&#40;&#41;.
</div>
Im not sure I understand.

If I &#39;make test&#39; with RELEASE_TESTING=1 then it dies with no further info, so 
how does one know whether the keys are correct and what to change them to?

When you say &#39;the developer is forced&#39;, I guess you mean me?

What exactly am I forced to do, and when?

Cheers.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Regards,
&gt; Steffen
</div>
-- 
Mike McCauley           VK4AMM                   mikem@airspayce.com
Airspayce Pty Ltd 9 Bulbul Place Currumbin Waters QLD 4223 Australia   
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.airspayce.com">http://www.airspayce.com</a></span>
Phone +61 7 5598-7474
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1658045" href="/Public/Bug/Display.html?id=116795#txn-1658045">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;11&nbsp;06:02:49&nbsp;2016</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1658045/889977/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/889977">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 764b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; When you say &#39;the developer is forced&#39;, I guess you mean me?
&gt; 
&gt; What exactly am I forced to do, and when?
</div>
I&#39;ve changed the test now that it does not die&#40;&#41; anymore.
Instead it will give information about the expected and the new fingerprint if the fingerprint match fails. I&#39;ve also added an additional test only if RELEASE_TESTING is set. This test will fail if subtests where skipped because the fingerprint of the certificate mismatched.  Since the diagnostics show the host, the old and the new fingerprint it should be possible for the developer &#40;i.e. you&#41; to quickly change the test so that it uses the new fingerprint of the certificate. And since this last test only runs if RELEASE_TESTING is set it will not affect normal testing.

Regards,
Steffen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1658047" href="/Public/Bug/Display.html?id=116795#txn-1658047">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;11&nbsp;06:04:28&nbsp;2016</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1658047/889980/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/889980">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 20b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">forgot the new patch
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> patch.txt</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1658047/889981/patch.txt">Download patch.txt</a><br />
<span class="downloadcontenttype">text/plain 3.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: SSLeay.xs
===================================================================
--- SSLeay.xs	&#40;revision 477&#41;
+++ SSLeay.xs	&#40;working copy&#41;
@@ -6011,7 +6011,7 @@
 		X509 *issuer;
 		X509 *last = sk_X509_value&#40;chain,sk_X509_num&#40;chain&#41;-1&#41;;
 		if &#40; &#40;issuer = find_issuer&#40;last,store,chain&#41;&#41;&#41; {
-		    OCSP_basic_add1_cert&#40;bsr, X509_dup&#40;issuer&#41;&#41;;
+		    OCSP_basic_add1_cert&#40;bsr, issuer&#41;;
 		    TRACE&#40;1,&#34;run OCSP_basic_verify with issuer for last chain element&#34;&#41;;
 		    RETVAL = OCSP_basic_verify&#40;bsr, NULL, store, flags&#41;;
 		}
@@ -6058,11 +6058,8 @@
 		    goto end;
 		}
                 int first = OCSP_resp_find&#40;bsr, certid, -1&#41;; /* Find the first matching */
-		if &#40;first &gt;= 0&#41;
-		{
-		    sir = OCSP_resp_get0&#40;bsr,first&#41;;
-		    break;
-		}
+                if &#40;first &gt;= 0&#41;
+                    sir = OCSP_resp_get0&#40;bsr,first&#41;;
 	    }
 
 	    int status, revocationReason;   
@@ -6073,7 +6070,8 @@
 		status = OCSP_single_get0_status&#40;sir, &#38;revocationReason, &#38;revocationTime, &#38;thisupdate, &#38;nextupdate&#41;;
 #else
 		status = sir-&gt;certStatus-&gt;type;
-		revocationTime = sir-&gt;certStatus-&gt;value.revoked-&gt;revocationTime;
+		if &#40;status == V_OCSP_CERTSTATUS_REVOKED&#41;
+		    revocationTime = sir-&gt;certStatus-&gt;value.revoked-&gt;revocationTime;
 		thisupdate = sir-&gt;thisUpdate;
 		nextupdate = sir-&gt;nextUpdate;
 #endif
Index: t/external/ocsp.t
===================================================================
--- t/external/ocsp.t	&#40;revision 477&#41;
+++ t/external/ocsp.t	&#40;working copy&#41;
@@ -16,7 +16,7 @@
 	# this should give us OCSP stapling
 	host =&gt; &#39;www.live.com&#39;,
 	port =&gt; 443,
-	fingerprint =&gt; &#39;10c56ee9e2acaf2e77caeb7072bf6522dd7422b8&#39;,
+	fingerprint =&gt; &#39;0e37dc9b320d2526e93e360a26c824b202d1f3af&#39;,
 	ocsp_staple =&gt; 1,
 	expect_status =&gt; Net::SSLeay::V_OCSP_CERTSTATUS_GOOD&#40;&#41;,
     },
@@ -24,7 +24,7 @@
 	# no OCSP stapling yet
 	host =&gt; &#39;www.google.com&#39;,
 	port =&gt; 443,
-	fingerprint =&gt; &#39;007a5ab302f14446e2ea24d3a829de22ba1bf950&#39;,
+	fingerprint =&gt; &#39;89380c438a076d9d5fac228a8f680ff452487f30&#39;,
 	expect_status =&gt; Net::SSLeay::V_OCSP_CERTSTATUS_GOOD&#40;&#41;,
     },
     {
@@ -31,12 +31,13 @@
 	# this is revoked
 	host =&gt; &#39;revoked.grc.com&#39;,
 	port =&gt; 443,
-	fingerprint =&gt; &#39;34703c40093461ad3ce087e161c7b7f42abe770c&#39;,
+	fingerprint =&gt; &#39;310665f4c8e78db761c764e798dca66047341264&#39;,
 	expect_status =&gt; Net::SSLeay::V_OCSP_CERTSTATUS_REVOKED&#40;&#41;,
     },
 &#41;;
 
-plan tests =&gt; 0+@tests;
+my $release_tests = $ENV{RELEASE_TESTING} &#38;&#38; 1;
+plan tests =&gt; $release_tests + @tests;
 
 
 my $timeout = 10; # used to TCP connect and SSL connect
@@ -50,6 +51,12 @@
 
 TEST:
 
+my $skipped = 0;
+sub skip_unless_release {
+    $skipped++ if $release_tests;
+    goto &#38;skip;
+}
+
 for my $test &#40;@tests&#41; {
     my $cleanup = __cleanup__-&gt;new;
     SKIP: {
@@ -114,8 +121,9 @@
 	my $fp = $leaf_cert
 	    &#38;&#38; unpack&#40;&#34;H*&#34;,Net::SSLeay::X509_digest&#40;$leaf_cert,$sha1&#41;&#41;;
 	skip &#34;could not get fingerprint&#34;,1 if !$fp;
-	skip &#34;bad fingerprint $fp for $test-&gt;{host}:$test-&gt;{port}&#34;,1
-	    if $fp ne $test-&gt;{fingerprint};
+	skip_unless_release&#40;
+	    &#34;bad fingerprint $fp for $test-&gt;{host}:$test-&gt;{port} - expected $test-&gt;{fingerprint}, got $fp&#34;,
+	    1&#41; if $fp ne $test-&gt;{fingerprint};
 	diag&#40;&#34;fingerprint matches&#34;&#41;;
 
 	if &#40; $test-&gt;{ocsp_staple} &#38;&#38; ! $stapled_response &#41; {
@@ -225,6 +233,8 @@
     }
 }
 
+is&#40;$skipped,0,&#34;skipped critical tests for release&#34;&#41; if $release_tests;
+
 {
     # cleanup stuff when going out of scope
     package __cleanup__;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1658059" href="/Public/Bug/Display.html?id=116795#txn-1658059">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;11&nbsp;07:04:14&nbsp;2016</span>
    <span class="description">mikem [...] airspayce.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #116795] OCSP broken in 1.75+ - patch included</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 11 Aug 2016 21:02:58 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] airspayce.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1658059/889988/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/889988">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Steffen,

thanks for the update, it looks better, but now when I run:

RELEASE_TESTING=1 make test

I get:

...

t/external/ocsp.t ...................... # tcp connect to www.live.com:443 ok
# got stapled OCSP response
# SSL_connect ok
t/external/ocsp.t ...................... 1/4 # tcp connect to 
www.google.com:443 ok
# got no stapled OCSP response
# SSL_connect ok
t/external/ocsp.t ...................... 2/4 # tcp connect to 
revoked.grc.com:443 ok
# got stapled OCSP response
# SSL_connect ok
# fingerprint matches
# status=1 as expected: nextUpd=Fri Aug 12 12:37:11 2016
# status=1 as expected: nextUpd=Mon Aug 15 10:58:41 2016
# status=0 as expected: nextUpd=Mon Aug 15 10:58:42 2016
t/external/ocsp.t ...................... 3/4 
#   Failed test &#39;skipped critical tests for release&#39;
#   at t/external/ocsp.t line 236.
#          got: &#39;2&#39;
#     expected: &#39;0&#39;
# Looks like you failed 1 test of 4.
t/external/ocsp.t ...................... Dubious, test returned 1 &#40;wstat 256, 
0x100&#41;

That doesnt look right?

Cheers.

On Thursday, August 11, 2016 06:02:50 AM Steffen Ullrich via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=116795">https://rt.cpan.org/Ticket/Display.html?id=116795</a></span> &gt;
&gt; 
<div class="message-stanza open">&gt; &gt; When you say &#39;the developer is forced&#39;, I guess you mean me?
&gt; &gt; 
&gt; &gt; What exactly am I forced to do, and when?
</div>&gt; 
&gt; I&#39;ve changed the test now that it does not die&#40;&#41; anymore.
&gt; Instead it will give information about the expected and the new fingerprint
&gt; if the fingerprint match fails. I&#39;ve also added an additional test only if
&gt; RELEASE_TESTING is set. This test will fail if subtests where skipped
&gt; because the fingerprint of the certificate mismatched.  Since the
&gt; diagnostics show the host, the old and the new fingerprint it should be
&gt; possible for the developer &#40;i.e. you&#41; to quickly change the test so that it
&gt; uses the new fingerprint of the certificate. And since this last test only
&gt; runs if RELEASE_TESTING is set it will not affect normal testing.
&gt; 
&gt; Regards,
&gt; Steffen
</div>
-- 
Mike McCauley           VK4AMM                   mikem@airspayce.com
Airspayce Pty Ltd 9 Bulbul Place Currumbin Waters QLD 4223 Australia   
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.airspayce.com">http://www.airspayce.com</a></span>
Phone +61 7 5598-7474
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1658070" href="/Public/Bug/Display.html?id=116795#txn-1658070">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;11&nbsp;08:01:50&nbsp;2016</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1658070/889995/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/889995">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 801b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Am Do 11. Aug 2016, 07:04:14, mikem@airspayce.com schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Steffen,
&gt; 
&gt; thanks for the update, it looks better, but now when I run:
&gt; 
&gt; RELEASE_TESTING=1 make test
</div>
I see, the output from &#39;make test&#39; does not include the reasons why tests got skipped. I&#39;ve tested before with perl -Mblib and there it showed up. I&#39;ve now adapted the test so that it uses diag&#40;&#41; and it looks like this shows up in &#39;make test&#39;. 

Apart from that it looks like that both live.com and google.com use different certificates in different parts of the world &#40;i.e. based on target IP address&#41; which made the test work for me but not for you :&#40;. I&#39;ve now switched to different hosts although it is hard to find a host which supports OCSP stapling.

Attached is a new patch, this time for the test only.

Regards,
Steffen
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> patch.txt</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1658070/889996/patch.txt">Download patch.txt</a><br />
<span class="downloadcontenttype">text/plain 3.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: SSLeay.xs
===================================================================
--- SSLeay.xs	&#40;revision 477&#41;
+++ SSLeay.xs	&#40;working copy&#41;
@@ -6011,7 +6011,7 @@
 		X509 *issuer;
 		X509 *last = sk_X509_value&#40;chain,sk_X509_num&#40;chain&#41;-1&#41;;
 		if &#40; &#40;issuer = find_issuer&#40;last,store,chain&#41;&#41;&#41; {
-		    OCSP_basic_add1_cert&#40;bsr, X509_dup&#40;issuer&#41;&#41;;
+		    OCSP_basic_add1_cert&#40;bsr, issuer&#41;;
 		    TRACE&#40;1,&#34;run OCSP_basic_verify with issuer for last chain element&#34;&#41;;
 		    RETVAL = OCSP_basic_verify&#40;bsr, NULL, store, flags&#41;;
 		}
@@ -6058,11 +6058,8 @@
 		    goto end;
 		}
                 int first = OCSP_resp_find&#40;bsr, certid, -1&#41;; /* Find the first matching */
-		if &#40;first &gt;= 0&#41;
-		{
-		    sir = OCSP_resp_get0&#40;bsr,first&#41;;
-		    break;
-		}
+                if &#40;first &gt;= 0&#41;
+                    sir = OCSP_resp_get0&#40;bsr,first&#41;;
 	    }
 
 	    int status, revocationReason;   
@@ -6073,7 +6070,8 @@
 		status = OCSP_single_get0_status&#40;sir, &#38;revocationReason, &#38;revocationTime, &#38;thisupdate, &#38;nextupdate&#41;;
 #else
 		status = sir-&gt;certStatus-&gt;type;
-		revocationTime = sir-&gt;certStatus-&gt;value.revoked-&gt;revocationTime;
+		if &#40;status == V_OCSP_CERTSTATUS_REVOKED&#41;
+		    revocationTime = sir-&gt;certStatus-&gt;value.revoked-&gt;revocationTime;
 		thisupdate = sir-&gt;thisUpdate;
 		nextupdate = sir-&gt;nextUpdate;
 #endif
Index: t/external/ocsp.t
===================================================================
--- t/external/ocsp.t	&#40;revision 477&#41;
+++ t/external/ocsp.t	&#40;working copy&#41;
@@ -14,17 +14,17 @@
 my @tests = &#40;
     {
 	# this should give us OCSP stapling
-	host =&gt; &#39;www.live.com&#39;,
+	host =&gt; &#39;www.microsoft.com&#39;,
 	port =&gt; 443,
-	fingerprint =&gt; &#39;10c56ee9e2acaf2e77caeb7072bf6522dd7422b8&#39;,
+	fingerprint =&gt; &#39;5f0b37e633840ca02468552ea3b1197e5e118f7b&#39;,
 	ocsp_staple =&gt; 1,
 	expect_status =&gt; Net::SSLeay::V_OCSP_CERTSTATUS_GOOD&#40;&#41;,
     },
     {
-	# no OCSP stapling yet
-	host =&gt; &#39;www.google.com&#39;,
+	# no OCSP stapling 
+	host =&gt; &#39;www.spiegel.de&#39;,
 	port =&gt; 443,
-	fingerprint =&gt; &#39;007a5ab302f14446e2ea24d3a829de22ba1bf950&#39;,
+	fingerprint =&gt; &#39;ad737048455485d8c817b7d0f7403553a7b9f65b&#39;,
 	expect_status =&gt; Net::SSLeay::V_OCSP_CERTSTATUS_GOOD&#40;&#41;,
     },
     {
@@ -31,12 +31,13 @@
 	# this is revoked
 	host =&gt; &#39;revoked.grc.com&#39;,
 	port =&gt; 443,
-	fingerprint =&gt; &#39;34703c40093461ad3ce087e161c7b7f42abe770c&#39;,
+	fingerprint =&gt; &#39;310665f4c8e78db761c764e798dca66047341264&#39;,
 	expect_status =&gt; Net::SSLeay::V_OCSP_CERTSTATUS_REVOKED&#40;&#41;,
     },
 &#41;;
 
-plan tests =&gt; 0+@tests;
+my $release_tests = $ENV{RELEASE_TESTING} ? 1:0;
+plan tests =&gt; $release_tests + @tests;
 
 
 my $timeout = 10; # used to TCP connect and SSL connect
@@ -50,6 +51,7 @@
 
 TEST:
 
+my @fp_mismatch;
 for my $test &#40;@tests&#41; {
     my $cleanup = __cleanup__-&gt;new;
     SKIP: {
@@ -114,8 +116,11 @@
 	my $fp = $leaf_cert
 	    &#38;&#38; unpack&#40;&#34;H*&#34;,Net::SSLeay::X509_digest&#40;$leaf_cert,$sha1&#41;&#41;;
 	skip &#34;could not get fingerprint&#34;,1 if !$fp;
-	skip &#34;bad fingerprint $fp for $test-&gt;{host}:$test-&gt;{port}&#34;,1
-	    if $fp ne $test-&gt;{fingerprint};
+	if &#40;$fp ne $test-&gt;{fingerprint}&#41; {
+	    push @fp_mismatch, [ $fp,$test ];
+	    skip&#40;&#34;bad fingerprint for $test-&gt;{host}:$test-&gt;{port} -&#34;.
+		&#34; expected $test-&gt;{fingerprint}, got $fp&#34;,1&#41; 
+	}
 	diag&#40;&#34;fingerprint matches&#34;&#41;;
 
 	if &#40; $test-&gt;{ocsp_staple} &#38;&#38; ! $stapled_response &#41; {
@@ -225,6 +230,19 @@
     }
 }
 
+if &#40;$release_tests&#41; {
+    if &#40;!@fp_mismatch&#41; {
+	pass&#40;&#34;all fingerprints matched&#34;&#41;;
+    } else {
+	for&#40;@fp_mismatch&#41; {
+	    my &#40;$fp,$test&#41; = @$_;
+	    diag&#40;&#34;fingerprint mismatch for $test-&gt;{host}:$test-&gt;{port} -&#34;.
+		&#34; expected $test-&gt;{fingerprint}, got $fp&#34;&#41; 
+	}
+	fail&#40;&#34;some fingerprints did not matched - please adjust test&#34;&#41;;
+    }
+}
+
 {
     # cleanup stuff when going out of scope
     package __cleanup__;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1658244" href="/Public/Bug/Display.html?id=116795#txn-1658244">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;11&nbsp;20:59:48&nbsp;2016</span>
    <span class="description">mikem [...] airspayce.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #116795] OCSP broken in 1.75+ - patch included</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 12 Aug 2016 10:59:35 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] airspayce.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1658244/890106/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/890106">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Steffen,

thanks, that works well with my builtin 1.0.1k-fips ,  libressl-2.4.1 and 
others, but with
openssl-1.1.0, openssl-1.0.2c, openssl-1.0.2a, openssl-1.0.2, openssl-1.0.1c 
and other &#40;without RELEASE_TESTING&#41; I get:

t/external/ocsp.t ...................... # tcp connect to 
www.microsoft.com:443 ok
# got stapled OCSP response
# SSL_connect ok
# fingerprint matches
t/external/ocsp.t ...................... 1/3 
#   Failed test &#39;failed to get OCSP_CERTIDs for cert /C=US/O=Symantec 
Corporation/OU=Symantec Trust Network/CN=Symantec Class 3 Secure Server CA - 
G4: cannot find issuer to certificate at t/external/ocsp.t line 141.
# &#39;
#   at t/external/ocsp.t line 142.
Label not found for &#34;next TEST&#34; at t/external/ocsp.t line 143.
# Looks like your test exited with 2 just after 1.
t/external/ocsp.t ...................... Dubious, test returned 2 &#40;wstat 512, 
0x200&#41;


That 
Label not found for &#34;next TEST&#34; 

is weird?

perl 5, version 20, subversion 1 &#40;v5.20.1&#41; built for i586-linux-thread-multi

Cheers.

On Thursday, August 11, 2016 08:01:51 AM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=116795">https://rt.cpan.org/Ticket/Display.html?id=116795</a></span> &gt;
&gt; 
&gt; Am Do 11. Aug 2016, 07:04:14, mikem@airspayce.com schrieb:
<div class="message-stanza open">&gt; &gt; Hi Steffen,
&gt; &gt; 
&gt; &gt; thanks for the update, it looks better, but now when I run:
&gt; &gt; 
&gt; &gt; RELEASE_TESTING=1 make test
</div>&gt; 
&gt; I see, the output from &#39;make test&#39; does not include the reasons why tests
&gt; got skipped. I&#39;ve tested before with perl -Mblib and there it showed up.
&gt; I&#39;ve now adapted the test so that it uses diag&#40;&#41; and it looks like this
&gt; shows up in &#39;make test&#39;.
&gt; 
&gt; Apart from that it looks like that both live.com and google.com use
&gt; different certificates in different parts of the world &#40;i.e. based on
&gt; target IP address&#41; which made the test work for me but not for you :&#40;. I&#39;ve
&gt; now switched to different hosts although it is hard to find a host which
&gt; supports OCSP stapling.
&gt; 
&gt; Attached is a new patch, this time for the test only.
&gt; 
&gt; Regards,
&gt; Steffen
</div>
-- 
Mike McCauley           VK4AMM                   mikem@airspayce.com
Airspayce Pty Ltd 9 Bulbul Place Currumbin Waters QLD 4223 Australia   
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.airspayce.com">http://www.airspayce.com</a></span>
Phone +61 7 5598-7474
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1658303" href="/Public/Bug/Display.html?id=116795#txn-1658303">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;12&nbsp;02:02:04&nbsp;2016</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1658303/890153/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/890153">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; thanks, that works well with my builtin 1.0.1k-fips ,  libressl-2.4.1
&gt; and
&gt; others, but with
&gt; openssl-1.1.0, openssl-1.0.2c, openssl-1.0.2a, openssl-1.0.2, openssl-
&gt; 1.0.1c
</div>
I&#39;ve tried with 1.0.2c, 1.1.0, 1.0.0d, 1.0.2g-fips &#40;ubuntu&#41; so there is at least
some overlap in the versions. Since it fails in OCSP_CERTIDs with &#34;cannot find
issuer to certificate&#34; it might be that you have different CA storage setup with
the different OpenSSL versions and that some of the CA storage don&#39;t contain the
necessary root certificate. This might happen if you have sometimes Mozilla::CA
installed and sometimes not, in which case it will use the default store.

On the other hand it has certificate validation enabled when connecting, i.e. in
case of missing root-CA it should have been skipped this test because the 
connection failed. Very strange indeed.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Label not found for &#34;next TEST&#34;
</div>
That happened because I&#39;ve inadvertently placed a variable declaration between
the label and the for loop and thus the label got not associated with the 
loop anymore. This is fixed within the attached patch.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> patch.txt</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1658303/890154/patch.txt">Download patch.txt</a><br />
<span class="downloadcontenttype">text/plain 4.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: SSLeay.xs
===================================================================
--- SSLeay.xs	&#40;revision 477&#41;
+++ SSLeay.xs	&#40;working copy&#41;
@@ -5916,7 +5916,7 @@
 	    if &#40;X509_check_issued&#40;cert,cert&#41; == X509_V_OK&#41;
 		croak&#40;&#34;no OCSP request for self-signed certificate&#34;&#41;;
 	    if &#40;!&#40;issuer = find_issuer&#40;cert,store,chain&#41;&#41;&#41;
-		croak&#40;&#34;cannot find issuer to certificate&#34;&#41;;
+		croak&#40;&#34;cannot find issuer certificate&#34;&#41;;
 	    if &#40;!&#40;id = OCSP_cert_to_id&#40;EVP_sha1&#40;&#41;,cert,issuer&#41;&#41;&#41;
 		croak&#40;&#34;out of memory for generating OCSO certid&#34;&#41;;
 	    if &#40;!&#40;len = i2d_OCSP_CERTID&#40;id,NULL&#41;&#41;&#41;
@@ -6011,7 +6011,7 @@
 		X509 *issuer;
 		X509 *last = sk_X509_value&#40;chain,sk_X509_num&#40;chain&#41;-1&#41;;
 		if &#40; &#40;issuer = find_issuer&#40;last,store,chain&#41;&#41;&#41; {
-		    OCSP_basic_add1_cert&#40;bsr, X509_dup&#40;issuer&#41;&#41;;
+		    OCSP_basic_add1_cert&#40;bsr, issuer&#41;;
 		    TRACE&#40;1,&#34;run OCSP_basic_verify with issuer for last chain element&#34;&#41;;
 		    RETVAL = OCSP_basic_verify&#40;bsr, NULL, store, flags&#41;;
 		}
@@ -6058,11 +6058,8 @@
 		    goto end;
 		}
                 int first = OCSP_resp_find&#40;bsr, certid, -1&#41;; /* Find the first matching */
-		if &#40;first &gt;= 0&#41;
-		{
-		    sir = OCSP_resp_get0&#40;bsr,first&#41;;
-		    break;
-		}
+                if &#40;first &gt;= 0&#41;
+                    sir = OCSP_resp_get0&#40;bsr,first&#41;;
 	    }
 
 	    int status, revocationReason;   
@@ -6073,7 +6070,8 @@
 		status = OCSP_single_get0_status&#40;sir, &#38;revocationReason, &#38;revocationTime, &#38;thisupdate, &#38;nextupdate&#41;;
 #else
 		status = sir-&gt;certStatus-&gt;type;
-		revocationTime = sir-&gt;certStatus-&gt;value.revoked-&gt;revocationTime;
+		if &#40;status == V_OCSP_CERTSTATUS_REVOKED&#41;
+		    revocationTime = sir-&gt;certStatus-&gt;value.revoked-&gt;revocationTime;
 		thisupdate = sir-&gt;thisUpdate;
 		nextupdate = sir-&gt;nextUpdate;
 #endif
Index: t/external/ocsp.t
===================================================================
--- t/external/ocsp.t	&#40;revision 477&#41;
+++ t/external/ocsp.t	&#40;working copy&#41;
@@ -14,17 +14,17 @@
 my @tests = &#40;
     {
 	# this should give us OCSP stapling
-	host =&gt; &#39;www.live.com&#39;,
+	host =&gt; &#39;www.microsoft.com&#39;,
 	port =&gt; 443,
-	fingerprint =&gt; &#39;10c56ee9e2acaf2e77caeb7072bf6522dd7422b8&#39;,
+	fingerprint =&gt; &#39;5f0b37e633840ca02468552ea3b1197e5e118f7b&#39;,
 	ocsp_staple =&gt; 1,
 	expect_status =&gt; Net::SSLeay::V_OCSP_CERTSTATUS_GOOD&#40;&#41;,
     },
     {
-	# no OCSP stapling yet
-	host =&gt; &#39;www.google.com&#39;,
+	# no OCSP stapling 
+	host =&gt; &#39;www.spiegel.de&#39;,
 	port =&gt; 443,
-	fingerprint =&gt; &#39;007a5ab302f14446e2ea24d3a829de22ba1bf950&#39;,
+	fingerprint =&gt; &#39;ad737048455485d8c817b7d0f7403553a7b9f65b&#39;,
 	expect_status =&gt; Net::SSLeay::V_OCSP_CERTSTATUS_GOOD&#40;&#41;,
     },
     {
@@ -31,12 +31,13 @@
 	# this is revoked
 	host =&gt; &#39;revoked.grc.com&#39;,
 	port =&gt; 443,
-	fingerprint =&gt; &#39;34703c40093461ad3ce087e161c7b7f42abe770c&#39;,
+	fingerprint =&gt; &#39;310665f4c8e78db761c764e798dca66047341264&#39;,
 	expect_status =&gt; Net::SSLeay::V_OCSP_CERTSTATUS_REVOKED&#40;&#41;,
     },
 &#41;;
 
-plan tests =&gt; 0+@tests;
+my $release_tests = $ENV{RELEASE_TESTING} ? 1:0;
+plan tests =&gt; $release_tests + @tests;
 
 
 my $timeout = 10; # used to TCP connect and SSL connect
@@ -48,8 +49,9 @@
 Net::SSLeay::SSLeay_add_ssl_algorithms&#40;&#41;;
 my $sha1 = Net::SSLeay::EVP_get_digestbyname&#40;&#39;sha1&#39;&#41;;
 
+
+my @fp_mismatch;
 TEST:
-
 for my $test &#40;@tests&#41; {
     my $cleanup = __cleanup__-&gt;new;
     SKIP: {
@@ -114,8 +116,11 @@
 	my $fp = $leaf_cert
 	    &#38;&#38; unpack&#40;&#34;H*&#34;,Net::SSLeay::X509_digest&#40;$leaf_cert,$sha1&#41;&#41;;
 	skip &#34;could not get fingerprint&#34;,1 if !$fp;
-	skip &#34;bad fingerprint $fp for $test-&gt;{host}:$test-&gt;{port}&#34;,1
-	    if $fp ne $test-&gt;{fingerprint};
+	if &#40;$fp ne $test-&gt;{fingerprint}&#41; {
+	    push @fp_mismatch, [ $fp,$test ];
+	    skip&#40;&#34;bad fingerprint for $test-&gt;{host}:$test-&gt;{port} -&#34;.
+		&#34; expected $test-&gt;{fingerprint}, got $fp&#34;,1&#41; 
+	}
 	diag&#40;&#34;fingerprint matches&#34;&#41;;
 
 	if &#40; $test-&gt;{ocsp_staple} &#38;&#38; ! $stapled_response &#41; {
@@ -225,6 +230,19 @@
     }
 }
 
+if &#40;$release_tests&#41; {
+    if &#40;!@fp_mismatch&#41; {
+	pass&#40;&#34;all fingerprints matched&#34;&#41;;
+    } else {
+	for&#40;@fp_mismatch&#41; {
+	    my &#40;$fp,$test&#41; = @$_;
+	    diag&#40;&#34;fingerprint mismatch for $test-&gt;{host}:$test-&gt;{port} -&#34;.
+		&#34; expected $test-&gt;{fingerprint}, got $fp&#34;&#41; 
+	}
+	fail&#40;&#34;some fingerprints did not matched - please adjust test&#34;&#41;;
+    }
+}
+
 {
     # cleanup stuff when going out of scope
     package __cleanup__;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1658310" href="/Public/Bug/Display.html?id=116795#txn-1658310">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;12&nbsp;02:34:54&nbsp;2016</span>
    <span class="description">mikem [...] airspayce.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #116795] OCSP broken in 1.75+ - patch included</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 12 Aug 2016 16:34:38 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] airspayce.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1658310/890160/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/890160">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Steffen,

Thanks.

Works fine with libressl-2.4.1 and my builtin OpenSSL 1.0.1k-fips

With openssl-1.1.0, openssl-1.0.2c etc I get:


t/external/ocsp.t ...................... # tcp connect to 
www.microsoft.com:443 ok
# got stapled OCSP response
# SSL_connect ok
# fingerprint matches
t/external/ocsp.t ...................... 1/3 
#   Failed test &#39;failed to get OCSP_CERTIDs for cert /C=US/O=Symantec 
Corporation/OU=Symantec Trust Network/CN=Symantec Class 3 Secure Server CA - 
G4: cannot find issuer certificate at t/external/ocsp.t line 141.
# &#39;
#   at t/external/ocsp.t line 142.
# tcp connect to www.spiegel.de:443 ok
# got no stapled OCSP response
# SSL_connect ok
# fingerprint matches
# no OCSP URI for cert /C=US/O=GeoTrust Inc./CN=GeoTrust Global CA
t/external/ocsp.t ...................... 2/3 
#   Failed test &#39;cannot verify response: &#39;
#   at t/external/ocsp.t line 224.
# tcp connect to revoked.grc.com:443 ok
# got stapled OCSP response
# SSL_connect ok
# fingerprint matches
t/external/ocsp.t ...................... 3/3 
#   Failed test &#39;failed to get OCSP_CERTIDs for cert /C=BE/O=GlobalSign nv-
sa/CN=GlobalSign Domain Validation CA - G2: cannot find issuer certificate at 
t/external/ocsp.t line 141.
# &#39;
#   at t/external/ocsp.t line 142.
# Looks like you failed 3 tests of 3.
t/external/ocsp.t ...................... Dubious, test returned 3 &#40;wstat 768, 
0x300&#41;

Cheers.

On Friday, August 12, 2016 02:02:06 AM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=116795">https://rt.cpan.org/Ticket/Display.html?id=116795</a></span> &gt;
&gt; 
<div class="message-stanza open">&gt; &gt; thanks, that works well with my builtin 1.0.1k-fips ,  libressl-2.4.1
&gt; &gt; and
&gt; &gt; others, but with
&gt; &gt; openssl-1.1.0, openssl-1.0.2c, openssl-1.0.2a, openssl-1.0.2, openssl-
&gt; &gt; 1.0.1c
</div>&gt; 
&gt; I&#39;ve tried with 1.0.2c, 1.1.0, 1.0.0d, 1.0.2g-fips &#40;ubuntu&#41; so there is at
&gt; least some overlap in the versions. Since it fails in OCSP_CERTIDs with
&gt; &#34;cannot find issuer to certificate&#34; it might be that you have different CA
&gt; storage setup with the different OpenSSL versions and that some of the CA
&gt; storage don&#39;t contain the necessary root certificate. This might happen if
&gt; you have sometimes Mozilla::CA installed and sometimes not, in which case
&gt; it will use the default store.
&gt; 
&gt; On the other hand it has certificate validation enabled when connecting,
&gt; i.e. in case of missing root-CA it should have been skipped this test
&gt; because the connection failed. Very strange indeed.
&gt; 
<div class="message-stanza open">&gt; &gt; Label not found for &#34;next TEST&#34;
</div>&gt; 
&gt; That happened because I&#39;ve inadvertently placed a variable declaration
&gt; between the label and the for loop and thus the label got not associated
&gt; with the loop anymore. This is fixed within the attached patch.
</div>
-- 
Mike McCauley           VK4AMM                   mikem@airspayce.com
Airspayce Pty Ltd 9 Bulbul Place Currumbin Waters QLD 4223 Australia   
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.airspayce.com">http://www.airspayce.com</a></span>
Phone +61 7 5598-7474
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1658327" href="/Public/Bug/Display.html?id=116795#txn-1658327">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;12&nbsp;03:49:14&nbsp;2016</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1658327/890170/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/890170">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; With openssl-1.1.0, openssl-1.0.2c etc I get:
&gt; ...
&gt; #   Failed test &#39;failed to get OCSP_CERTIDs for cert /C=US/O=Symantec
&gt; Corporation/OU=Symantec Trust Network/CN=Symantec Class 3 Secure
&gt; Server CA -
&gt; G4: cannot find issuer certificate at t/external/ocsp.t line 141.
</div>
This is hopefully solved now.
Inside the test I&#39;ve first created the context and the SSL object and then
added the features to the context I need. It looks like that some features
in the SSL object are taken from the linked context while other features
are copied from the context on creation of the SSL object and further
changes to the context will not affect the SSL object.

One of these copied features is the verification mode. Due to the order of
creation of SSL object and context the SSL object ended up with a mode
of VERIFY_NONE even if the context was set to VERIFY_PEER. And this caused
the SSL_connect to succeed even though the certificate chain could not be
verified against trusted CA. And because of the missing root CA the 
OCSP_CERTID failed to get the issue certificate.

This is now fixed by first creating and fully setting up the context before
creating the SSL object. This will probably mean that with your openssl-1.1.0
etc setups the test will be skipped because the SSL connections fail with 
&#34;certificate verify failed&#34;. To fix this you might need to install Mozilla::CA
in your test environment since it looks like that it cannot find the needed
root CA.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> patch.txt</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1658327/890171/patch.txt">Download patch.txt</a><br />
<span class="downloadcontenttype">text/plain 6.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: SSLeay.xs
===================================================================
--- SSLeay.xs	&#40;revision 477&#41;
+++ SSLeay.xs	&#40;working copy&#41;
@@ -5916,7 +5916,7 @@
 	    if &#40;X509_check_issued&#40;cert,cert&#41; == X509_V_OK&#41;
 		croak&#40;&#34;no OCSP request for self-signed certificate&#34;&#41;;
 	    if &#40;!&#40;issuer = find_issuer&#40;cert,store,chain&#41;&#41;&#41;
-		croak&#40;&#34;cannot find issuer to certificate&#34;&#41;;
+		croak&#40;&#34;cannot find issuer certificate&#34;&#41;;
 	    if &#40;!&#40;id = OCSP_cert_to_id&#40;EVP_sha1&#40;&#41;,cert,issuer&#41;&#41;&#41;
 		croak&#40;&#34;out of memory for generating OCSO certid&#34;&#41;;
 	    if &#40;!&#40;len = i2d_OCSP_CERTID&#40;id,NULL&#41;&#41;&#41;
@@ -6011,7 +6011,7 @@
 		X509 *issuer;
 		X509 *last = sk_X509_value&#40;chain,sk_X509_num&#40;chain&#41;-1&#41;;
 		if &#40; &#40;issuer = find_issuer&#40;last,store,chain&#41;&#41;&#41; {
-		    OCSP_basic_add1_cert&#40;bsr, X509_dup&#40;issuer&#41;&#41;;
+		    OCSP_basic_add1_cert&#40;bsr, issuer&#41;;
 		    TRACE&#40;1,&#34;run OCSP_basic_verify with issuer for last chain element&#34;&#41;;
 		    RETVAL = OCSP_basic_verify&#40;bsr, NULL, store, flags&#41;;
 		}
@@ -6058,11 +6058,8 @@
 		    goto end;
 		}
                 int first = OCSP_resp_find&#40;bsr, certid, -1&#41;; /* Find the first matching */
-		if &#40;first &gt;= 0&#41;
-		{
-		    sir = OCSP_resp_get0&#40;bsr,first&#41;;
-		    break;
-		}
+                if &#40;first &gt;= 0&#41;
+                    sir = OCSP_resp_get0&#40;bsr,first&#41;;
 	    }
 
 	    int status, revocationReason;   
@@ -6073,7 +6070,8 @@
 		status = OCSP_single_get0_status&#40;sir, &#38;revocationReason, &#38;revocationTime, &#38;thisupdate, &#38;nextupdate&#41;;
 #else
 		status = sir-&gt;certStatus-&gt;type;
-		revocationTime = sir-&gt;certStatus-&gt;value.revoked-&gt;revocationTime;
+		if &#40;status == V_OCSP_CERTSTATUS_REVOKED&#41;
+		    revocationTime = sir-&gt;certStatus-&gt;value.revoked-&gt;revocationTime;
 		thisupdate = sir-&gt;thisUpdate;
 		nextupdate = sir-&gt;nextUpdate;
 #endif
Index: t/external/ocsp.t
===================================================================
--- t/external/ocsp.t	&#40;revision 477&#41;
+++ t/external/ocsp.t	&#40;working copy&#41;
@@ -14,17 +14,17 @@
 my @tests = &#40;
     {
 	# this should give us OCSP stapling
-	host =&gt; &#39;www.live.com&#39;,
+	host =&gt; &#39;www.microsoft.com&#39;,
 	port =&gt; 443,
-	fingerprint =&gt; &#39;10c56ee9e2acaf2e77caeb7072bf6522dd7422b8&#39;,
+	fingerprint =&gt; &#39;5f0b37e633840ca02468552ea3b1197e5e118f7b&#39;,
 	ocsp_staple =&gt; 1,
 	expect_status =&gt; Net::SSLeay::V_OCSP_CERTSTATUS_GOOD&#40;&#41;,
     },
     {
-	# no OCSP stapling yet
-	host =&gt; &#39;www.google.com&#39;,
+	# no OCSP stapling 
+	host =&gt; &#39;www.heise.de&#39;,
 	port =&gt; 443,
-	fingerprint =&gt; &#39;007a5ab302f14446e2ea24d3a829de22ba1bf950&#39;,
+	fingerprint =&gt; &#39;36a7d7bfc59db65c040bccd291ae563d9ef7bafc&#39;,
 	expect_status =&gt; Net::SSLeay::V_OCSP_CERTSTATUS_GOOD&#40;&#41;,
     },
     {
@@ -31,12 +31,13 @@
 	# this is revoked
 	host =&gt; &#39;revoked.grc.com&#39;,
 	port =&gt; 443,
-	fingerprint =&gt; &#39;34703c40093461ad3ce087e161c7b7f42abe770c&#39;,
+	fingerprint =&gt; &#39;310665f4c8e78db761c764e798dca66047341264&#39;,
 	expect_status =&gt; Net::SSLeay::V_OCSP_CERTSTATUS_REVOKED&#40;&#41;,
     },
 &#41;;
 
-plan tests =&gt; 0+@tests;
+my $release_tests = $ENV{RELEASE_TESTING} ? 1:0;
+plan tests =&gt; $release_tests + @tests;
 
 
 my $timeout = 10; # used to TCP connect and SSL connect
@@ -48,8 +49,9 @@
 Net::SSLeay::SSLeay_add_ssl_algorithms&#40;&#41;;
 my $sha1 = Net::SSLeay::EVP_get_digestbyname&#40;&#39;sha1&#39;&#41;;
 
+
+my @fp_mismatch;
 TEST:
-
 for my $test &#40;@tests&#41; {
     my $cleanup = __cleanup__-&gt;new;
     SKIP: {
@@ -66,7 +68,6 @@
 	diag&#40;&#34;tcp connect to $test-&gt;{host}:$test-&gt;{port} ok&#34;&#41;;
 
 	my $ctx = Net::SSLeay::CTX_new&#40;&#41; or die &#34;failed to create CTX&#34;;
-	my $ssl = Net::SSLeay::new&#40;$ctx&#41; or die &#34;failed to create SSL&#34;;
 
 	# enable verification with hopefully usable CAs
 	Net::SSLeay::CTX_set_default_verify_paths&#40;$ctx&#41;;
@@ -75,10 +76,8 @@
 	    if eval { require Mozilla::CA };
 	Net::SSLeay::CTX_set_verify&#40;$ctx,Net::SSLeay::VERIFY_PEER&#40;&#41;,undef&#41;;
 
-	# setup TLS extension and callback to catch stapled OCSP response
+	# setup TLS extension callback to catch stapled OCSP response
 	my $stapled_response;
-	Net::SSLeay::set_tlsext_status_type&#40;$ssl,
-	    Net::SSLeay::TLSEXT_STATUSTYPE_ocsp&#40;&#41;&#41;;
 	Net::SSLeay::CTX_set_tlsext_status_cb&#40;$ctx,sub {
 	    my &#40;$ssl,$resp&#41; = @_;
 	    diag&#40;&#34;got &#34;.&#40;$resp ? &#39;&#39;:&#39;no &#39;&#41;.&#34;stapled OCSP response&#34;&#41;;
@@ -87,11 +86,21 @@
 	    return 1;
 	}&#41;;
 
+	# create SSL object only after we have the context fully done since
+	# some parts of the context &#40;like verification mode&#41; will be copied
+	# to the SSL object and thus later changes to the CTX don&#39;t affect
+	# the SSL object
+	my $ssl = Net::SSLeay::new&#40;$ctx&#41; or die &#34;failed to create SSL&#34;;
+
+	# setup TLS extension to request stapled OCSP response
+	Net::SSLeay::set_tlsext_status_type&#40;$ssl,
+	    Net::SSLeay::TLSEXT_STATUSTYPE_ocsp&#40;&#41;&#41;;
+
 	# non-blocking SSL_connect with timeout
 	$cl-&gt;blocking&#40;0&#41;;
 	Net::SSLeay::set_fd&#40;$ssl,fileno&#40;$cl&#41;&#41;;
 	my $end = time&#40;&#41; + $timeout;
-	my $rv;
+	my &#40;$rv,@err&#41;;
 	while &#40;&#40;$rv = Net::SSLeay::connect&#40;$ssl&#41;&#41; &lt; 0&#41; {
 	    my $to = $end-time&#40;&#41;;
 	    $to&lt;=0 and last;
@@ -101,10 +110,14 @@
 		select&#40;$vec,undef,undef,$to&#41;;
 	    } elsif &#40; $err == Net::SSLeay::ERROR_WANT_WRITE&#40;&#41;&#41; {
 		select&#40;undef,$vec,undef,$to&#41;;
+	    } else {
+		while &#40; my $err = Net::SSLeay::ERR_get_error&#40;&#41;&#41; {
+		    push @err, Net::SSLeay::ERR_error_string&#40;$err&#41;;
+		}
+		last
 	    }
 	}
-	skip &#34;SSL_connect with $test-&gt;{host}:$test-&gt;{port} failed: &#34;.
-	    Net::SSLeay::print_errs&#40;&#39;&#39;&#41;,1
+	skip &#34;SSL_connect with $test-&gt;{host}:$test-&gt;{port} failed: @err&#34;,1
 	    if $rv&lt;=0;
 	diag&#40;&#34;SSL_connect ok&#34;&#41;;
 
@@ -114,8 +127,11 @@
 	my $fp = $leaf_cert
 	    &#38;&#38; unpack&#40;&#34;H*&#34;,Net::SSLeay::X509_digest&#40;$leaf_cert,$sha1&#41;&#41;;
 	skip &#34;could not get fingerprint&#34;,1 if !$fp;
-	skip &#34;bad fingerprint $fp for $test-&gt;{host}:$test-&gt;{port}&#34;,1
-	    if $fp ne $test-&gt;{fingerprint};
+	if &#40;$fp ne $test-&gt;{fingerprint}&#41; {
+	    push @fp_mismatch, [ $fp,$test ];
+	    skip&#40;&#34;bad fingerprint for $test-&gt;{host}:$test-&gt;{port} -&#34;.
+		&#34; expected $test-&gt;{fingerprint}, got $fp&#34;,1&#41; 
+	}
 	diag&#40;&#34;fingerprint matches&#34;&#41;;
 
 	if &#40; $test-&gt;{ocsp_staple} &#38;&#38; ! $stapled_response &#41; {
@@ -225,6 +241,19 @@
     }
 }
 
+if &#40;$release_tests&#41; {
+    if &#40;!@fp_mismatch&#41; {
+	pass&#40;&#34;all fingerprints matched&#34;&#41;;
+    } else {
+	for&#40;@fp_mismatch&#41; {
+	    my &#40;$fp,$test&#41; = @$_;
+	    diag&#40;&#34;fingerprint mismatch for $test-&gt;{host}:$test-&gt;{port} -&#34;.
+		&#34; expected $test-&gt;{fingerprint}, got $fp&#34;&#41; 
+	}
+	fail&#40;&#34;some fingerprints did not matched - please adjust test&#34;&#41;;
+    }
+}
+
 {
     # cleanup stuff when going out of scope
     package __cleanup__;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1658476" href="/Public/Bug/Display.html?id=116795#txn-1658476">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;12&nbsp;19:54:38&nbsp;2016</span>
    <span class="description">mikem [...] airspayce.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #116795] OCSP broken in 1.75+ - patch included</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 13 Aug 2016 09:54:22 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] airspayce.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1658476/890238/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/890238">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Steffen,

Thanks

Tests OK with:
openssl-1.1.0
libressl-2.4.1
openssl-1.0.2c
openssl-1.0.2a
openssl-1.0.2
openssl-1.0.1c
openssl-1.0.1
openssl-1.0.0d
openssl-1.0.0
openssl-0.9.8i+extension

I have committed to SVN. If you report that SVN tests OK for you I will 
release a new version to CPAN.

Cheers.


On Friday, August 12, 2016 03:49:16 AM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=116795">https://rt.cpan.org/Ticket/Display.html?id=116795</a></span> &gt;
&gt; 
<div class="message-stanza open">&gt; &gt; With openssl-1.1.0, openssl-1.0.2c etc I get:
&gt; &gt; ...
&gt; &gt; #   Failed test &#39;failed to get OCSP_CERTIDs for cert /C=US/O=Symantec
&gt; &gt; Corporation/OU=Symantec Trust Network/CN=Symantec Class 3 Secure
&gt; &gt; Server CA -
&gt; &gt; G4: cannot find issuer certificate at t/external/ocsp.t line 141.
</div>&gt; 
&gt; This is hopefully solved now.
&gt; Inside the test I&#39;ve first created the context and the SSL object and then
&gt; added the features to the context I need. It looks like that some features
&gt; in the SSL object are taken from the linked context while other features
&gt; are copied from the context on creation of the SSL object and further
&gt; changes to the context will not affect the SSL object.
&gt; 
&gt; One of these copied features is the verification mode. Due to the order of
&gt; creation of SSL object and context the SSL object ended up with a mode
&gt; of VERIFY_NONE even if the context was set to VERIFY_PEER. And this caused
&gt; the SSL_connect to succeed even though the certificate chain could not be
&gt; verified against trusted CA. And because of the missing root CA the
&gt; OCSP_CERTID failed to get the issue certificate.
&gt; 
&gt; This is now fixed by first creating and fully setting up the context before
&gt; creating the SSL object. This will probably mean that with your
&gt; openssl-1.1.0 etc setups the test will be skipped because the SSL
&gt; connections fail with &#34;certificate verify failed&#34;. To fix this you might
&gt; need to install Mozilla::CA in your test environment since it looks like
&gt; that it cannot find the needed root CA.
</div>
-- 
Mike McCauley           VK4AMM                   mikem@airspayce.com
Airspayce Pty Ltd 9 Bulbul Place Currumbin Waters QLD 4223 Australia   
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.airspayce.com">http://www.airspayce.com</a></span>
Phone +61 7 5598-7474
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1658506" href="/Public/Bug/Display.html?id=116795#txn-1658506">#</a>      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;13&nbsp;02:53:40&nbsp;2016</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #116795] OCSP broken in 1.75+ - patch included</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 13 Aug 2016 08:53:13 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Mike McCauley via RT &lt;bug-Net-SSLeay [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Steffen Ullrich &lt;Steffen_Ullrich [...] genua.de&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1658506/890247/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/890247">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 244b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have committed to SVN. If you report that SVN tests OK for you I will 
&gt; release a new version to CPAN.
</div>
Looks good to me.
I&#39;ve tested with various OpenSSL and Perl versions on Ubuntu and with
LibreSSL on OpenBSD 5.9

Tanks a lot,
Steffen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1658523" href="/Public/Bug/Display.html?id=116795#txn-1658523">#</a>      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;13&nbsp;04:42:55&nbsp;2016</span>
    <span class="description">mikem [...] airspayce.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #116795] OCSP broken in 1.75+ - patch included</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 13 Aug 2016 18:42:42 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] airspayce.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1658523/890255/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/890255">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 681b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks Steffen,

version 1.78 uploaded to CPAN.

Cheers.

On Saturday, August 13, 2016 02:53:42 AM Steffen Ullrich via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=116795">https://rt.cpan.org/Ticket/Display.html?id=116795</a></span> &gt;
&gt; 
<div class="message-stanza open">&gt; &gt; I have committed to SVN. If you report that SVN tests OK for you I will
&gt; &gt; release a new version to CPAN.
</div>&gt; 
&gt; Looks good to me.
&gt; I&#39;ve tested with various OpenSSL and Perl versions on Ubuntu and with
&gt; LibreSSL on OpenBSD 5.9
&gt; 
&gt; Tanks a lot,
&gt; Steffen
</div>
-- 
Mike McCauley           VK4AMM                   mikem@airspayce.com
Airspayce Pty Ltd 9 Bulbul Place Currumbin Waters QLD 4223 Australia   
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.airspayce.com">http://www.airspayce.com</a></span>
Phone +61 7 5598-7474
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1719546" href="/Public/Bug/Display.html?id=116795#txn-1719546">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;16&nbsp;14:23:40&nbsp;2017</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.94978</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
