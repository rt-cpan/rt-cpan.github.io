<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #111984 for Dist-Zilla-Plugin-Run: Need to run late, but before final packaging</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #111984 for Dist-Zilla-Plugin-Run: Need to run late, but before final packaging</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Dist-Zilla-Plugin-Run/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Dist-Zilla-Plugin-Run/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Dist-Zilla-Plugin-Run/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Dist-Zilla-Plugin-Run/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Dist-Zilla-Plugin-Run">Dist-Zilla-Plugin-Run CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">111984</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Dist-Zilla-Plugin-Run/Active/">Dist-Zilla-Plugin-Run</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">ether [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
tlhackque [...] yahoo.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-236074-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-236075-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.043    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;12&nbsp;13:34:11&nbsp;2016</span>
    <span class="description">tlhackque [...] yahoo.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Need to run late, but before final packaging</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I need to run some fixup on certain files late in the build process.

The &#40;one&#41; point I need is both before the .tar file is created and [CopyFilesFromBuild].

Can there be a [Run::BeforePackaging]?  I&#39;m not a Dist::Zilla expert, but I think this means making it a FileMunger.

In my case, I need it to run after [Pod::Weaver] to inspect what it did &#38; move some output to a non-pod file, which is packaged and [CopyFilesFromBuild] back to the top.

But there are other uses - e.g. to sign a file and package the signature.

[Run::somthing] would be a lot simpler than learning to write a custom plugin.


Thanks.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;12&nbsp;13:50:27&nbsp;2016</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">There is a &#39;BeforeArchive&#39; phase, which the [Run] plugin suite could certainly provide a hook into.  I don&#39;t quite understand what you&#39;re trying to do though, so this might not be the best place in your situation. It&#39;s run well after everything else, including &#39;AfterBuild&#39;. &#40;AfterBuild is even too late to modify file contents before they are written to disk.&#41;

To modify files in the build, that would be a FileMunger, yes... if you&#39;re creating new files in the build, you&#39;d need to insert something into the FileGatherer phase, which is even earlier than FileMunger.

Did you know about <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/pod/Dist::Zilla::Plugin::Signature">https://metacpan.org/pod/Dist::Zilla::Plugin::Signature</a></span> ?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;12&nbsp;13:50:27&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;12&nbsp;13:50:54&nbsp;2016</span>
    <span class="description">ether [...] cpan.org -  Severity Normal changed to Wishlist</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;12&nbsp;14:22:31&nbsp;2016</span>
    <span class="description">tlhackque [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Feb 12 13:50:27 2016, ETHER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There is a &#39;BeforeArchive&#39; phase, which the [Run] plugin suite could
&gt; certainly provide a hook into.  I don&#39;t quite understand what you&#39;re
&gt; trying to do though, so this might not be the best place in your
&gt; situation. It&#39;s run well after everything else, including
&gt; &#39;AfterBuild&#39;. &#40;AfterBuild is even too late to modify file contents
&gt; before they are written to disk.&#41;
&gt; 
&gt; To modify files in the build, that would be a FileMunger, yes... if
&gt; you&#39;re creating new files in the build, you&#39;d need to insert something
&gt; into the FileGatherer phase, which is even earlier than FileMunger.
&gt; 
&gt; Did you know about
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/pod/Dist::Zilla::Plugin::Signature">https://metacpan.org/pod/Dist::Zilla::Plugin::Signature</a></span> ?
</div>
Thanks for the quick response!

Obviously, I don&#39;t understand Dist::Zilla&#39;s internals.  I&#39;ll try to clarify what I need to do.

Today&#39;s use case is fairly simple.

Pod::Weaver generates POD based on the build, e.g. a section for where bug reports go, the Version, copyright, Author.

I want to place that into the README, which pod2readme should extract from the woven pod.  Currently, it can&#39;t.  So I have to maintain that separately.

The README needs to end up in the archive.

The README is also [CopyFromBuild] to the root so it is visible to GitHub.

RunBeforeBuild is too soon to capture the woven pod.

I thought AfterBuild runs too late - but I may be wrong.

Yes, I even use Signature - that signs the distribution.  So the README has to be created before the distribution signature file is created.

There are some cases where one wants to sign a file created in the build.

For example, where the file will be sent to a third party after the distribution is unpacked.  Suppose I wanted to sign the created README with a differnt GPG key from that used by the distribution... &#40;I don&#39;t, but more realistic examples are complicated...&#41;

I do know there&#39;s a plugin for README from POD.  I&#39;m not sure it can be scheduled after pod::weaver.  But in any case, I have a local issue that requires the build to run a version of perl too old for that plugin.  So I currently [Run:BeforeBuild] perlbrew exec -with the right version.  And live with manually editing an include file before running the build.

Life sure does get complicated.... :-&#40;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;12&nbsp;15:31:29&nbsp;2016</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2016-02-12 11:22:31, tlhackque wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Pod::Weaver generates POD based on the build, e.g. a section for where
&gt; bug reports go, the Version, copyright, Author.
&gt; 
&gt; I want to place that into the README, which pod2readme should extract
&gt; from the woven pod.  Currently, it can&#39;t.  So I have to maintain that
&gt; separately.
</div>
Can you clarify why it cannot?

Also, <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/pod/Dist::Zilla::Plugin::ReadmeAnyFromPod">https://metacpan.org/pod/Dist::Zilla::Plugin::ReadmeAnyFromPod</a></span> exists -- I use it in my plugin bundle like this to create the file in the repository only:

    [ReadmeAnyFromPod]
    :version = 0.142180
    type = pod
    location = root
    phase = release

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The README needs to end up in the archive.
&gt; 
&gt; The README is also [CopyFromBuild] to the root so it is visible to
&gt; GitHub.
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; RunBeforeBuild is too soon to capture the woven pod.
</div>
Right.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I thought AfterBuild runs too late - but I may be wrong.
</div>
It is to get the file into the build -- since other plugins &#40;e.g. [Manifest]&#41; would want to know about that file&#39;s existence too.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I do know there&#39;s a plugin for README from POD.  I&#39;m not sure it can
&gt; be scheduled after pod::weaver.
</div>
Most definitely it can -- I use podweaver heavily in my normal distribution packaging process.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; But in any case, I have a local issue
&gt; that requires the build to run a version of perl too old for that
&gt; plugin.
</div>
Doh!  But I think ReadmeAnyFromPod works on 5.008 -- were you thinking of ReadmeFromPod?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;12&nbsp;16:00:19&nbsp;2016</span>
    <span class="description">tlhackque [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Feb 12 15:31:29 2016, ETHER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2016-02-12 11:22:31, tlhackque wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; Pod::Weaver generates POD based on the build, e.g. a section for
&gt; &gt; where
&gt; &gt; bug reports go, the Version, copyright, Author.
&gt; &gt;
&gt; &gt; I want to place that into the README, which pod2readme should extract
&gt; &gt; from the woven pod.  Currently, it can&#39;t.  So I have to maintain that
&gt; &gt; separately.
</div>&gt; 
&gt; Can you clarify why it cannot?
&gt; 
</div>
Because I can&#39;t [Run] it at the right time :-&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Also, <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/pod/Dist::Zilla::Plugin::ReadmeAnyFromPod">https://metacpan.org/pod/Dist::Zilla::Plugin::ReadmeAnyFromPod</a></span>
&gt; exists -- I use it in my plugin bundle like this to create the file in
&gt; the repository only:
&gt; 
&gt; [ReadmeAnyFromPod]
&gt; :version = 0.142180
&gt; type = pod
&gt; location = root
&gt; phase = release
&gt; 
<div class="message-stanza open">&gt; &gt; The README needs to end up in the archive.
&gt; &gt;
&gt; &gt; The README is also [CopyFromBuild] to the root so it is visible to
&gt; &gt; GitHub.
</div>&gt; 
<div class="message-stanza open">&gt; &gt; RunBeforeBuild is too soon to capture the woven pod.
</div>&gt; 
&gt; Right.
&gt; 
<div class="message-stanza open">&gt; &gt; I thought AfterBuild runs too late - but I may be wrong.
</div>&gt; 
&gt; It is to get the file into the build -- since other plugins &#40;e.g.
&gt; [Manifest]&#41; would want to know about that file&#39;s existence too.
&gt; 
<div class="message-stanza open">&gt; &gt; I do know there&#39;s a plugin for README from POD.  I&#39;m not sure it can
&gt; &gt; be scheduled after pod::weaver.
</div>&gt; 
&gt; Most definitely it can -- I use podweaver heavily in my normal
&gt; distribution packaging process.
&gt; 
<div class="message-stanza open">&gt; &gt; But in any case, I have a local issue
&gt; &gt; that requires the build to run a version of perl too old for that
&gt; &gt; plugin.
</div>&gt; 
&gt; Doh!  But I think ReadmeAnyFromPod works on 5.008 -- were you thinking
&gt; of ReadmeFromPod?
</div>
ReadMeAnyFromPod uses Pod::Readme.  Version 0.11 of PodReadme works with 5.008, but doesn&#39;t generate Markdown.  V1.1.2 generates markdown, but requires Perl 5.10.something; I run just the pod2readme in a perlbrew 5.22.1 sandbox.

The other challenge is that some content needs to go in the readme, but not the man pages.  Pod::Weaver doesn&#39;t understand =begin readme blocks, except to skip them.  So a fixup that handles the relocation is in order.  Something like podweaver, pod2readme -f pod =&gt; runscript&#40; move sections from woven pod to readme blocks &#41; =&gt; pod2text, pod2markdown.  Somewhat painful, but less so than the &#34;update copyrights&#34; sessions.

And so I&#39;m here :-&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;12&nbsp;16:29:28&nbsp;2016</span>
    <span class="description">tlhackque [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">By the way, the MANIFEST shouldn&#39;t be a tough constraint.

It&#39;s easy enough to touch README BeforeBuild, then fix-up later.

That way the MANIFEST has a placeholder.

The more restrictive timing problem is getting the right version into SIGNATURE.

Of course, I hope that the hook placement is useful to others.

Thanks for helping.  There would seem to be a fairly steep learning curve for Dist::Zilla internals.  
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;12&nbsp;16:53:37&nbsp;2016</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2016-02-12 13:29:28, tlhackque wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Because I can&#39;t [Run] it at the right time :-&#41;
</div>
Ah yes.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ReadMeAnyFromPod uses Pod::Readme.
</div>
Are you sure? I was able to install and test Dist::Zilla::Plugin::ReadmeAnyFromPod on a 5.8.8 system, and I don&#39;t see Pod::Readme in its &#40;immediate&#41; prereqs.

I&#39;m in the podlators group; if the 5.010 constraint is a trivial one I can see about getting that fixed up.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The other challenge is that some content needs to go in the readme, but not the man pages. Pod::Weaver doesn&#39;t understand =begin readme blocks, except to skip them. So a fixup that handles the relocation is in order. Something like podweaver, pod2readme -f pod =&gt; runscript&#40; move sections from woven pod to readme blocks &#41; =&gt; pod2text, pod2markdown. Somewhat painful, but less so than the &#34;update copyrights&#34; sessions.
</div>
This one sounds a bit more complicated...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks for helping.  There would seem to be a fairly steep learning
&gt; curve for Dist::Zilla internals.
</div>
Truer words were never spoken :&#41;

BTW, if you ever use irc, there&#39;s usually someone around on irc.perl.org in the #distzilla channel.  There may yet be a solution that I haven&#39;t yet fathomed :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;12&nbsp;18:17:37&nbsp;2016</span>
    <span class="description">tlhackque [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Feb 12 16:53:37 2016, ETHER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2016-02-12 13:29:28, tlhackque wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; Because I can&#39;t [Run] it at the right time :-&#41;
</div>&gt; 
&gt; Ah yes.
&gt; 
<div class="message-stanza open">&gt; &gt; ReadMeAnyFromPod uses Pod::Readme.
</div>&gt; 
&gt; Are you sure? I was able to install and test
&gt; Dist::Zilla::Plugin::ReadmeAnyFromPod on a 5.8.8 system, and I don&#39;t
&gt; see Pod::Readme in its &#40;immediate&#41; prereqs.
&gt; 
</div>Too many similar names.

Pod::Readme&#39;s pod2readme is what I&#39;ve been using, including it&#39;s syntax for including other files &#40;partially&#41; and conditional inclusion within POD blocks.   

I have module source files with POD that conditionally generates different content for README and module doc.   E.g. The module doc &#40;e.g. perldoc foo::bar&#41; doesn&#39;t need installation info &#40;it&#39;s obviously already installed&#41;, but the readme does.  The readme doesn&#39;t need method documentation, but the module doc does.  The text README gets an &#34;automagically generated by&#34; line, but the Markdown for GitHub doesn&#39;t want that.  But they share overview, description, recent changes and other significant sections.  There&#39;s more in common than different.

With everything in the module file, there&#39;s a much better chance of it staying current and in sync.  And Pod::Weaver deals with stuff across files.

Dist::Zilla::Plugin::ReadmeFromPod uses Pod::Readme.  So the conditional POD should work - if it would run under DistZilla under Perl 5.8.8.

I looked at Dist::Zilla::Plugin::ReadmeAnyFromPod  *Any*.  It seems to have no facility for selective inclusion.  But it&#39;s doc page includes:

 &#34;Dist::Zilla::Plugin::ReadmeFromPod - The base for this module&#34;

That&#39;s what made me think it relied on Pod::Readme.  Apparently &#34;base&#34; doesn&#39;t mean in the OO class sense... more in the &#39;you look like my grandfather, could we be related&#39; sense :-&#41;


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m in the podlators group; if the 5.010 constraint is a trivial one I
&gt; can see about getting that fixed up.
&gt; 
</div>
I didn&#39;t look at that, but I doubt it.

From the Pod::Readme Changes, it appears to be a complete rewrite.  The formerly simple module now relies on many other modules.  Maybe it&#39;s just // vs || and some regexps.  But there are a lot of modules go through.  The code MOOved on.  I installed into a fresh brew &#38; the list of dependent modules and their builds was endless.  &#40;As in ~ an hour on a fast machine.&#41;  I think we made a mistake in the 60s when K lines of code became a &#39;productivity&#39; metric.  But that boat sailed, and I digress.

v1.0.2 2014-10-13 22:18 BST
  - No changes since v1.0.1_08, just a version bump for a release.

  - See the full list of changes since v1.0.0 for more details.

  [Enhancements]
  - This is a complete rewrite, using modern Perl with Moo.

  - Added support for plugins, along with plugins to insert the module
    version, prerequisites and the latest changes.

  - Added the ability to generate a README in a variety of formats,
    such as POD, Markdown, HTML, RTF, etc.

  - Added command-line options to the pod2readme script, including the
    ability to specify the output format.

  - Switched to semantic versioning.

  - The documentation has been updated accordingly.

  [Incompatabilities]
  - Perl v5.10.1 is required.

  - This is no longer a subclass of a POD parser, although it has some
    wrapper methods for compatability with software known to use it.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; The other challenge is that some content needs to go in the readme,
&gt; &gt; but not the man pages. Pod::Weaver doesn&#39;t understand =begin readme
&gt; &gt; blocks, except to skip them. So a fixup that handles the relocation
&gt; &gt; is in order. Something like podweaver, pod2readme -f pod =&gt;
&gt; &gt; runscript&#40; move sections from woven pod to readme blocks &#41; =&gt;
&gt; &gt; pod2text, pod2markdown. Somewhat painful, but less so than the
&gt; &gt; &#34;update copyrights&#34; sessions.
</div>&gt; 
&gt; This one sounds a bit more complicated...
</div>
Yup.  But it&#39;s a trivial script.  Something like:

local $/; my $file = &lt;&gt;;
my&#40; $stuff &#41; = $file =~ /^&#40;=head1 AUTHORS\n.*?&#41;^=cut\n/ to pick up the block and$
$file =~ s/&#40;*.*&#41;^&#40;=end readme\n&#41;/$1$stuff$2/ms
print $file;

It&#39;s just getting to run the code in the right place...

Have I explained enough of the constraints for you to identify the right place for a hook?  Is this something you&#39;re willing to do?

I&#39;m open to other ideas, but so far this still seems like the least work for everyone...


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; Thanks for helping.  There would seem to be a fairly steep learning
&gt; &gt; curve for Dist::Zilla internals.
</div>&gt; 
&gt; Truer words were never spoken :&#41;
&gt; 
&gt; BTW, if you ever use irc, there&#39;s usually someone around on
&gt; irc.perl.org in the #distzilla channel.  There may yet be a solution
&gt; that I haven&#39;t yet fathomed :&#41;
</div>
I rarely use IRC.  

I suspect that if I were willing to invest in learning Dist::Zilla internals, it could be done with a plugin.  But that does seem like a lot of work - and a unique solution.  An Run:: hook would work for many other use cases.

I suppose I could ask the Dist::Zilla::Plugin::ReadmeAnyFromPod maintainer to add conditional inclusion.  It would be a good thing.  But more work.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;12&nbsp;18:57:49&nbsp;2016</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2016-02-12 15:17:37, tlhackque wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; I&#39;m in the podlators group; if the 5.010 constraint is a trivial one
&gt; &gt; I
&gt; &gt; can see about getting that fixed up.
&gt; &gt;
</div>&gt; 
&gt; I didn&#39;t look at that, but I doubt it.
&gt; 
&gt; From the Pod::Readme Changes, it appears to be a complete rewrite.
&gt; The formerly simple module now relies on many other modules.  Maybe
&gt; it&#39;s just // vs || and some regexps.
</div>
I took a quick look at the Pod-Readme repository and the only 5.10isms I could find was a lot of &#39;state&#39; variables -- but that can be patched with local lexicals like so:

-sub Indentation {
-    state $type = Type::Tiny-&gt;new&#40;
+{
+  my $type;
+  sub Indentation {
+    return $type if $type;
+    $type = Type::Tiny-&gt;new&#40;
  ...
-    return $type;
+  }
 }

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Have I explained enough of the constraints for you to identify the
&gt; right place for a hook?  Is this something you&#39;re willing to do?
&gt; I&#39;m open to other ideas, but so far this still seems like the least
&gt; work for everyone...
</div>
I can add a BeforeArchive plugin to [Run], but it would be pretty similar to
running during AfterBuild, and even that&#39;s probably too late.

But it&#39;s still a good idea to have one, so I&#39;ll see about doing that
tonight/this weekend.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I suppose I could ask the Dist::Zilla::Plugin::ReadmeAnyFromPod
&gt; maintainer to add conditional inclusion.  It would be a good thing.
&gt; But more work.
</div>
He&#39;s good people; he&#39;ll listen &#40;I&#39;ve arm-wrestled him into releasing patches in the past&#41; :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;13&nbsp;11:54:33&nbsp;2016</span>
    <span class="description">tlhackque [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Feb 12 18:57:49 2016, ETHER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2016-02-12 15:17:37, tlhackque wrote:
&gt; 
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; I&#39;m in the podlators group; if the 5.010 constraint is a trivial
&gt; &gt; &gt; one
&gt; &gt; &gt; I
&gt; &gt; &gt; can see about getting that fixed up.
&gt; &gt; &gt;
</div>&gt; &gt;
&gt; &gt; I didn&#39;t look at that, but I doubt it.
&gt; &gt;
&gt; &gt; From the Pod::Readme Changes, it appears to be a complete rewrite.
&gt; &gt; The formerly simple module now relies on many other modules.  Maybe
&gt; &gt; it&#39;s just // vs || and some regexps.
</div>&gt; 
&gt; I took a quick look at the Pod-Readme repository and the only 5.10isms
&gt; I could find was a lot of &#39;state&#39; variables -- but that can be patched
&gt; with local lexicals like so:
&gt; 
&gt; -sub Indentation {
&gt; -    state $type = Type::Tiny-&gt;new&#40;
&gt; +{
&gt; +  my $type;
&gt; +  sub Indentation {
&gt; +    return $type if $type;
&gt; +    $type = Type::Tiny-&gt;new&#40;
&gt;   ...
&gt; -    return $type;
&gt; +  }
&gt;  }
</div>
Ah, state.  Pod::Readme now uses MOO and a bunch of other modules, so you might be opening a larger project that first appears...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; Have I explained enough of the constraints for you to identify the
&gt; &gt; right place for a hook?  Is this something you&#39;re willing to do?
&gt; &gt; I&#39;m open to other ideas, but so far this still seems like the least
&gt; &gt; work for everyone...
</div>&gt; 
&gt; I can add a BeforeArchive plugin to [Run], but it would be pretty
&gt; similar to
&gt; running during AfterBuild, and even that&#39;s probably too late.
&gt; 
&gt; But it&#39;s still a good idea to have one, so I&#39;ll see about doing that
&gt; tonight/this weekend.
</div>
Thanks.

That would be good.  The point I need is after PodWeaver and before Signature.  
Careful placement in dist.ini is a reasonable constraint.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; I suppose I could ask the Dist::Zilla::Plugin::ReadmeAnyFromPod
&gt; &gt; maintainer to add conditional inclusion.  It would be a good thing.
&gt; &gt; But more work.
</div>&gt; 
&gt; He&#39;s good people; he&#39;ll listen &#40;I&#39;ve arm-wrestled him into releasing
&gt; patches in the past&#41; :&#41;
</div>

<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112004">https://rt.cpan.org/Ticket/Display.html?id=112004</a></span>

We&#39;ll see how he responds...

Thanks for all your time and support!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;14&nbsp;09:07:06&nbsp;2016</span>
    <span class="description">tlhackque [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Naive thought</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Feb 12 18:57:49 2016, ETHER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I can add a BeforeArchive plugin to [Run], but it would be pretty
&gt; similar to
&gt; running during AfterBuild, and even that&#39;s probably too late.
&gt; 
</div>I may not understand the complexities, but:

As Dist::Zilla::Plugin::ReadmeAnyFromPod  can be scheduled at the &#39;right&#39; time by dist.ini placement, can&#39;t a Run::During &#40;Or Run::Later, or?&#41; be scheduled the
same way?

You are clearly the expert, but I&#39;m a little curious...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;15&nbsp;16:59:33&nbsp;2016</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2016-02-14 06:07:06, tlhackque wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri Feb 12 18:57:49 2016, ETHER wrote:
<div class="message-stanza open">&gt; &gt; I can add a BeforeArchive plugin to [Run], but it would be pretty
&gt; &gt; similar to
&gt; &gt; running during AfterBuild, and even that&#39;s probably too late.
&gt; &gt;
</div>&gt; I may not understand the complexities, but:
&gt; 
&gt; As Dist::Zilla::Plugin::ReadmeAnyFromPod  can be scheduled at the
&gt; &#39;right&#39; time by dist.ini placement, can&#39;t a Run::During &#40;Or
&gt; Run::Later, or?&#41; be scheduled the
&gt; same way?
&gt; 
&gt; You are clearly the expert, but I&#39;m a little curious...
</div>
Yes, quite possibly, if you run at the right phase!

I&#39;ve created [Run::BeforeArchive] -- let me know how it goes.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;15&nbsp;16:59:35&nbsp;2016</span>
    <span class="description">ether [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;15&nbsp;16:59:35&nbsp;2016</span>
    <span class="description">ether [...] cpan.org -  Fixed in 0.043 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;17&nbsp;12:29:09&nbsp;2016</span>
    <span class="description">tlhackque [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [Run::BeforeArchive} results: working, but ugly w/ some issues</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Feb 15 16:59:33 2016, ETHER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2016-02-14 06:07:06, tlhackque wrote:
<div class="message-stanza open">&gt; &gt; On Fri Feb 12 18:57:49 2016, ETHER wrote:
<div class="message-stanza open">&gt; &gt; &gt; I can add a BeforeArchive plugin to [Run], but it would be pretty
&gt; &gt; &gt; similar to
&gt; &gt; &gt; running during AfterBuild, and even that&#39;s probably too late.
&gt; &gt; &gt;
</div>&gt; &gt; I may not understand the complexities, but:
&gt; &gt; 
&gt; &gt; As Dist::Zilla::Plugin::ReadmeAnyFromPod  can be scheduled at the
&gt; &gt; &#39;right&#39; time by dist.ini placement, can&#39;t a Run::During &#40;Or
&gt; &gt; Run::Later, or?&#41; be scheduled the
&gt; &gt; same way?
&gt; &gt; 
&gt; &gt; You are clearly the expert, but I&#39;m a little curious...
</div>&gt; 
&gt; Yes, quite possibly, if you run at the right phase!
&gt; 
&gt; I&#39;ve created [Run::BeforeArchive] -- let me know how it goes.
</div>
Many thanks for the new plugin.

You said: &#34;quite possibly, if you run at the right phase!&#34;.  But I don&#39;t think that the Run plugin lets me control the phase in which it executes my script :-&#41;

I have things working, but it&#39;s not pretty.

Here are the results of my exploration:

Setup:

[Run::BeforeBuild]
; MANIFEST needs to see output files.
; Delete existing to make sure what&#39;s left after build came from this build.
; This complicates things later because pod2readme uses mtime to avoid building.
run = rm -f README README.md; touch README README.md

...

[PodWeaver]
[Run::BeforeArchive]
run = sed -i -e&#39;/^=head1 AUTHOR/i=for readme start\n\n&#39; %d%plib%pMy%pModule.pm
; -F because of touch
run = ./runbrew -in %d pod2readme -F             lib%pMy%pModule.pm &#38;&#38; cp -p %d%pREADME .
run = ./runbrew -in %d pod2readme -F -f markdown lib%pMy%pModule.pm &#38;&#38; cp -p %d%pREADME.md .

...

[MetaYAML]
[MetaJSON]
[Manifest]
[CopyFilesFromBuild]
[Signature]

...

Good news:

1&#41; BeforeArchive runs after [PodWeaver]
2&#41; BeforeArchive runs before [Signature]

Non-ideal news:
1&#41; BeforeArchive runs after [Manifest], which causes a mismatch complaint
   and the files don&#39;t get archived.

   Touching README and README.md in [Run::BeforeBuild] works around this.
   But, pod2readme notes the READMEs are newer than the source file &#38;
   silently refuses to build them.  [and &#39;optimization&#39;&#41; So, -F is required.

   It would be simpler if one could do something to register files created
   by the script for the manifest.
   Perhaps:
       [Run::BeforeArchive]
         adds_file = README
         adds_file = README.md
   This could be a no-op if the named file already exists.

2&#41; BeforeArchive runs after [CopyFilesFromBuild]  Arguably, this is an
   issue with [CopyFilesFromBuild] - running too soon...

   I work-around that by copying my output as part of the command.

3&#41; %d is documented as &#39;not in &#34;BeforeBuild&#39;.  Using %d in before build
   should produce an error.  The current behavior is to ignore it, which
   means a command can access an unintended path.  E.g. %d%pfoo will access /foo.

4&#41; If I don&#39;t remove the build directory before building, there is no &#39;mismatch&#39;
   complaint.  This seems to indicate that dzil isn&#39;t emptying the build
   directory at the start of a build.  This seems like a bad thing, as
   it means that repeated builds can accumulate stale files.

Notes:

a&#41; Documentation nit:
     %v isn&#39;t available in [Run::BeforeBuild] as documented, because
     it comes from [VersionFromModule].  And [VersionFromModule] looks
     in the [empty] build directory.  Which isn&#39;t there yet.

Bottom line: I have something that works, but there&#39;s room for improvement.

Thanks again for making the progress possible.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;17&nbsp;12:29:11&nbsp;2016</span>
    <span class="description">tlhackque [...] yahoo.com -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;17&nbsp;12:29:11&nbsp;2016</span>
    <span class="description">tlhackque [...] yahoo.com -  Given to ETHER</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;17&nbsp;17:04:51&nbsp;2016</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2016-02-17 09:29:09, tlhackque wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Touching README and README.md in [Run::BeforeBuild] works around this.
&gt; But, pod2readme notes the READMEs are newer than the source file &#38;
&gt; silently refuses to build them.  [and &#39;optimization&#39;&#41; So, -F is
&gt; required.
&gt; 
&gt; It would be simpler if one could do something to register files
&gt; created
&gt; by the script for the manifest.
&gt; Perhaps:
&gt;     [Run::BeforeArchive]
&gt;       adds_file = README
&gt;       adds_file = README.md
&gt; This could be a no-op if the named file already exists.
</div>
That won&#39;t make any difference at all in the result. The file needs to be
added in the FileGatherer phase &#40;which is right after [Run::BeforeBuild]
runs&#41;, no matter who does it.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 2&#41; BeforeArchive runs after [CopyFilesFromBuild]  Arguably, this is an
&gt;    issue with [CopyFilesFromBuild] - running too soon...
</div>
Yes, [CopyFilesFromBuild] runs in the AfterBuild phase, which is before
BeforeArchive.

I would suggest using [CopyFilesFromRelease] instead, which will be late
enough.  You can also use [Git::Commit] at that time to commit the file to
your repository so you don&#39;t need to add a blank one again next time around.

But, if you run your command in the *build* directory, rather than in the
repository, the file will exist and you won&#39;t have to depend on
[CopyFilesFrom*] to bring the file to you.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I work-around that by copying my output as part of the command.
&gt; 
&gt; 3&#41; %d is documented as &#39;not in &#34;BeforeBuild&#39;.  Using %d in before
&gt; build
&gt;    should produce an error.  The current behavior is to ignore it,
&gt; which
&gt;    means a command can access an unintended path.  E.g. %d%pfoo will
&gt; access /foo.
</div>
What do you mean by ignore it? %d should evaluate to the empty string in
BeforeBuild.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 4&#41; If I don&#39;t remove the build directory before building, there is no
&gt; &#39;mismatch&#39;
&gt;    complaint.  This seems to indicate that dzil isn&#39;t emptying the
&gt; build
&gt;    directory at the start of a build.  This seems like a bad thing, as
&gt;    it means that repeated builds can accumulate stale files.
</div>
Yes, that sounds bad, and a worthy issue to file for Dist-Zilla.
&#40;Which I&#39;ve done here -- <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/rjbs/Dist-Zilla/issues/521&#41;">https://github.com/rjbs/Dist-Zilla/issues/521&#41;</a></span>

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; a&#41; Documentation nit:
&gt;      %v isn&#39;t available in [Run::BeforeBuild] as documented, because
&gt;      it comes from [VersionFromModule].  And [VersionFromModule] looks
&gt;      in the [empty] build directory.  Which isn&#39;t there yet.
</div>
%v asks for $zilla-&gt;version; it&#39;s the plugin&#39;s responsibility to provide that
as soon as it&#39;s able.  There&#39;s nothing that [Run::BeforeBuild] can do about
that, but it can be noted in the documentation.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;17&nbsp;18:33:07&nbsp;2016</span>
    <span class="description">tlhackque [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Feb 17 17:04:51 2016, ETHER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2016-02-17 09:29:09, tlhackque wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; Touching README and README.md in [Run::BeforeBuild] works around
&gt; &gt; this.
&gt; &gt; But, pod2readme notes the READMEs are newer than the source file &#38;
&gt; &gt; silently refuses to build them.  [and &#39;optimization&#39;&#41; So, -F is
&gt; &gt; required.
&gt; &gt;
&gt; &gt; It would be simpler if one could do something to register files
&gt; &gt; created
&gt; &gt; by the script for the manifest.
&gt; &gt; Perhaps:
&gt; &gt;     [Run::BeforeArchive]
&gt; &gt;       adds_file = README
&gt; &gt;       adds_file = README.md
&gt; &gt; This could be a no-op if the named file already exists.
</div>&gt; 
&gt; That won&#39;t make any difference at all in the result. The file needs to
&gt; be
&gt; added in the FileGatherer phase &#40;which is right after
&gt; [Run::BeforeBuild]
&gt; runs&#41;, no matter who does it.
</div>
Yes, but can&#39;t Run::BeforeArchive do that as a FileGatherer?  There doesn&#39;t seem to be an external way to say &#34;This file is going to exist, so look for it when you MANIFEST/sign/archive&#34;.  And it seems reasonable that one reason to run a script is to create a file... So specifying what it produces in the same place where it&#39;s told to run seems reasonable.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; 2&#41; BeforeArchive runs after [CopyFilesFromBuild]  Arguably, this is
&gt; &gt; an
&gt; &gt;    issue with [CopyFilesFromBuild] - running too soon...
</div>&gt; 
&gt; Yes, [CopyFilesFromBuild] runs in the AfterBuild phase, which is
&gt; before
&gt; BeforeArchive.
&gt; 
&gt; I would suggest using [CopyFilesFromRelease] instead, which will be
&gt; late
&gt; enough.  You can also use [Git::Commit] at that time to commit the
&gt; file to
&gt; your repository so you don&#39;t need to add a blank one again next time
&gt; around.
</div>
I think that CopyFilesFromRelease only runs if one does a release.  I like to check the README before exposing it.  So I&#39;ll do multiple trial builds, then a test.  Finally a TRIAL release to cpan.  And only then a release. 

So CopyFilesFromRelease is too late in the process. Sigh.

It&#39;s not obvious what the harm would be in CopyFilesFromBuild running later, unless the file it wants to copy is removed by cleanup between where it runs now and &#39;later&#39;.

I still make mistakes, but I do try to minimize how much they&#39;re exposed.

The README in the repo is always the last one released, so one can see what was packaged.  And also so when you open the project on GitHub, you see it as the &#34;home page&#34;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; But, if you run your command in the *build* directory, rather than in
&gt; the
&gt; repository, the file will exist and you won&#39;t have to depend on
&gt; [CopyFilesFrom*] to bring the file to you.
</div>
Actually, it&#39;s the other way around.

I do run the command in the build directory.  that&#39;s the -in %d to runbrew.

The dummy blank file is to satisfy Manifest.  I delete the old one so if something goes wrong, there&#39;s a zero length file, not some confusion from an old one.

The reason to copy it to the top level is because that&#39;s where the git repo is, so the latest README gets pushed to the remote repo - GitHub in this case - when I commit.

The build directories and tar files are all in .gitignore

If I were to build it in the top level, it wouldn&#39;t go in the kit, and I&#39;d have all the MANIFEST issues in spades.  Plus, the Pod::Weaver output is only in the distribution directory.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; I work-around that by copying my output as part of the command.
&gt; &gt;
&gt; &gt; 3&#41; %d is documented as &#39;not in &#34;BeforeBuild&#39;.  Using %d in before
&gt; &gt; build
&gt; &gt;    should produce an error.  The current behavior is to ignore it,
&gt; &gt; which
&gt; &gt;    means a command can access an unintended path.  E.g. %d%pfoo will
&gt; &gt; access /foo.
</div>&gt; 
&gt; What do you mean by ignore it? %d should evaluate to the empty string
&gt; in
&gt; BeforeBuild.
</div>
It does.  And that&#39;s the problem.  If you inadvertently use %d in BeforeBuild, it
evaluates to the empty string instead of throwing an error.  So, if you thought
%d%pfoo would go to &#40;or read from&#41; your distribution directory, well, it goes to the root directory &#40;/&#41; instead.

Clearly you can&#39;t do what was requested, so rather than a silent failure, an error seems in order.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; 4&#41; If I don&#39;t remove the build directory before building, there is no
&gt; &gt; &#39;mismatch&#39;
&gt; &gt;    complaint.  This seems to indicate that dzil isn&#39;t emptying the
&gt; &gt; build
&gt; &gt;    directory at the start of a build.  This seems like a bad thing,
&gt; &gt; as
&gt; &gt;    it means that repeated builds can accumulate stale files.
</div>&gt; 
&gt; Yes, that sounds bad, and a worthy issue to file for Dist-Zilla.
&gt; &#40;Which I&#39;ve done here -- <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/rjbs/Dist-">https://github.com/rjbs/Dist-</a></span>
&gt; Zilla/issues/521&#41;
</div>Thanks.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; a&#41; Documentation nit:
&gt; &gt;      %v isn&#39;t available in [Run::BeforeBuild] as documented, because
&gt; &gt;      it comes from [VersionFromModule].  And [VersionFromModule]
&gt; &gt; looks
&gt; &gt;      in the [empty] build directory.  Which isn&#39;t there yet.
</div>&gt; 
&gt; %v asks for $zilla-&gt;version; it&#39;s the plugin&#39;s responsibility to
&gt; provide that
&gt; as soon as it&#39;s able.  There&#39;s nothing that [Run::BeforeBuild] can do
&gt; about
&gt; that, but it can be noted in the documentation.
</div>
Agree.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;17&nbsp;19:33:00&nbsp;2016</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2016-02-17 15:33:07, tlhackque wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Yes, but can&#39;t Run::BeforeArchive do that as a FileGatherer?
</div>
[Run::BeforeArchive] runs at the BeforeArchive phase, not the FileGatherer
phase.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There
&gt; doesn&#39;t seem to be an external way to say &#34;This file is going to
&gt; exist, so look for it when you MANIFEST/sign/archive&#34;.
</div>
That&#39;s what FileGatherers are for.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; I would suggest using [CopyFilesFromRelease] instead, which will be
&gt; &gt; late
&gt; &gt; enough.  You can also use [Git::Commit] at that time to commit the
&gt; &gt; file to
&gt; &gt; your repository so you don&#39;t need to add a blank one again next time
&gt; &gt; around.
</div>&gt; 
&gt; I think that CopyFilesFromRelease only runs if one does a release.  I
&gt; like to check the README before exposing it.  So I&#39;ll do multiple
&gt; trial builds, then a test.  Finally a TRIAL release to cpan.  And only
&gt; then a release.
&gt; So CopyFilesFromRelease is too late in the process. Sigh.
</div>
Too late for what?  You don&#39;t need a plugin to copy a file for you so you can
inspect it. Just inspect it in the build directory!!

$ dzil build
$ less Foo-Bar-1.23/README

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It&#39;s not obvious what the harm would be in CopyFilesFromBuild running
&gt; later, unless the file it wants to copy is removed by cleanup between
&gt; where it runs now and &#39;later&#39;.
</div>
CopyFilesFromBuild runs at the AfterBuild phase. That&#39;s plenty late enough.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The README in the repo is always the last one released, so one can see
&gt; what was packaged.  And also so when you open the project on GitHub,
&gt; you see it as the &#34;home page&#34;.
</div>
Obviously.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt;
&gt; &gt; But, if you run your command in the *build* directory, rather than in
&gt; &gt; the
&gt; &gt; repository, the file will exist and you won&#39;t have to depend on
&gt; &gt; [CopyFilesFrom*] to bring the file to you.
</div>&gt; 
&gt; Actually, it&#39;s the other way around.
</div>
No. Re-read what I said.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The reason to copy it to the top level is because that&#39;s where the git
&gt; repo is, so the latest README gets pushed to the remote repo - GitHub
&gt; in this case - when I commit.
</div>
I fully understand that -- which is why I suggested using [Git::Commit] to
commit it to the repository for you so you don&#39;t have to manually run &#39;git
commit&#39; after releasing.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If I were to build it in the top level, it wouldn&#39;t go in the kit,
</div>
I never suggested doing that.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It does.  And that&#39;s the problem.  If you inadvertently use %d in
&gt; BeforeBuild, it
&gt; evaluates to the empty string instead of throwing an error.  So, if
&gt; you thought
&gt; %d%pfoo would go to &#40;or read from&#41; your distribution directory, well,
&gt; it goes to the root directory &#40;/&#41; instead.
</div>
Okay, a warning would be reasonable there, rather than silently providing &#39;&#39;.

I&#39;m closing this ticket now as [Run::BeforeArchive] has been provided, and I
don&#39;t think I can help you further.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;17&nbsp;19:33:02&nbsp;2016</span>
    <span class="description">ether [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
