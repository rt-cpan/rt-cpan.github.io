<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #53656 for Pango: ascent wrong when scale to a large double number.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #53656 for Pango: ascent wrong when scale to a large double number.</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Pango/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Pango/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Pango/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Pango/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Pango">Pango CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">53656</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Pango/Active/">Pango</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
cornelius [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-226488-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.221    </td>
  </tr>
  <tr id="CF-226489-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




pango-extents-scale-with-float.png<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/719484/371468/pango-extents-scale-with-float.png">
Wed Jan 13 11:52:07 2010 (95.3k) by cornelius [...] cpan.org
</a>
</font></li>
</ul>


pango-extents-scale-with-int.png<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/719484/371467/pango-extents-scale-with-int.png">
Wed Jan 13 11:52:07 2010 (94.5k) by cornelius [...] cpan.org
</a>
</font></li>
</ul>


scale21x21.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/726829/375389/scale21x21.pl">
Sat Jan 30 05:49:40 2010 (3.5k) by cornelius [...] cpan.org
</a>
</font></li>
</ul>


scale33.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/726829/375390/scale33.pl">
Sat Jan 30 05:49:40 2010 (3.5k) by cornelius [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;13&nbsp;11:52:07&nbsp;2010</span>
    <span class="description">cornelius [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> ascent wrong when scale to a large double number.</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">if i scale cairo context to a large double number:

my $dpi = 600;
$cr-&gt;scale&#40; 1 / 25.4 * $dpi, 1 / 25.4 * $dpi&#41;;

then the ink ascent doesnt touch the text. there is a space between ascent 
and font text.

and if i just scale to 3,3 , which is correct.

$cr-&gt;scale&#40; 3, 3&#41;;

the ink ascent is just beside the text.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> pango-extents-scale-with-int.png</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/719484/371467/pango-extents-scale-with-int.png">Download pango-extents-scale-with-int.png</a><br />
<span class="downloadcontenttype">image/png 94.5k</span>
</div>
<div class="messagebody">
<img alt="pango-extents-scale-with-int.png" title="pango-extents-scale-with-int.png" src="/Ticket/Attachment/719484/371467/" /></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> pango-extents-scale-with-float.png</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/719484/371468/pango-extents-scale-with-float.png">Download pango-extents-scale-with-float.png</a><br />
<span class="downloadcontenttype">image/png 95.3k</span>
</div>
<div class="messagebody">
<img alt="pango-extents-scale-with-float.png" title="pango-extents-scale-with-float.png" src="/Ticket/Attachment/719484/371468/" /></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;13&nbsp;13:55:15&nbsp;2010</span>
    <span class="description">kaffeetisch [...] gmx.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jan 13 11:52:07 2010, CORNELIUS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; if i scale cairo context to a large double number:
&gt; 
&gt; my $dpi = 600;
&gt; $cr-&gt;scale&#40; 1 / 25.4 * $dpi, 1 / 25.4 * $dpi&#41;;
&gt; 
&gt; then the ink ascent doesnt touch the text. there is a space between
</div>ascent 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; and font text.
&gt; 
&gt; and if i just scale to 3,3 , which is correct.
&gt; 
&gt; $cr-&gt;scale&#40; 3, 3&#41;;
&gt; 
&gt; the ink ascent is just beside the text.
</div>
I can&#39;t imagine that this is a bug in the Perl bindings.  If there&#39;s a
bug somewhere, maybe related to precision loss, then I guess it would be
in libcairo itself.

Can you post a small, self-contained example program that exhibits the bug?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;13&nbsp;13:55:17&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;30&nbsp;05:49:40&nbsp;2010</span>
    <span class="description">cornelius [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">sorry for late response

here is my test-case.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> scale21x21.pl</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/env perl
use utf8;
use warnings;
use strict;
use lib &#39;lib&#39;;
use Cairo;
use Pango;

use constant {
    text_offset =&gt; 20,
    width =&gt; 900,
    height =&gt; 2000 ,
};

sub draw_note;
sub draw_extents;

# take logical, ink &#40;pango::rectangle&#41;
sub ascent  { -$_[0]-&gt;{y} }

# take logical,ink  &#40;pango::rectangle&#41;
sub descent { $_[0]-&gt;{y} + $_[0]-&gt;{height} }

# GistID: 

my $surface = Cairo::ImageSurface-&gt;create &#40;&#39;argb32&#39;, width , height &#41;;
my $cr = Cairo::Context-&gt;create &#40;$surface&#41;;

$cr-&gt;scale&#40; 21 , 21&#41;;
$cr-&gt;translate&#40; 1 , 1 &#41;;
$cr-&gt;set_line_width&#40;0.1&#41;;
$cr-&gt;set_font_size&#40;2&#41;;

my @fonts = &#40;
    &#39;Folio Md BT&#39;,
    &#39;Souvenir Lt BT&#39;,
    &#39;News701 BT&#39;,
    &#39;News701 BT&#39;,
    &#39;Apple LiGothic&#39;,
    &#39;AR Roman1 Medium&#39;,
    &#39;AR Roman1 Heavy&#39;,
    &#39;AR RGothic1 Bold&#39;,
&#41;;

for my $fontname &#40; @fonts &#41; {
    my $layout = Pango::Cairo::create_layout &#40;$cr&#41;;
    $layout-&gt;set_text&#40;&#34;Orz&#34;&#41;;
    my $desc = Pango::FontDescription-&gt;from_string&#40;&#34;$fontname Normal 12&#34;&#41;;
    $desc-&gt;set_absolute_size&#40; 12 * Pango-&gt;scale&#40;&#41; &#41;;

    my $lang = Pango::Language-&gt;from_string&#40; &#39;en_US&#39; &#41;;
    $layout-&gt;set_font_description &#40;$desc&#41;;

    Pango::Cairo::show_layout&#40;$cr, $layout&#41;;
    draw_extents&#40; $cr, $layout, $desc, $lang &#41;;
    $cr-&gt;translate&#40; 0 , text_offset &#41;;
}

$cr-&gt;show_page&#40;&#41;;
$surface-&gt;write_to_png &#40;&#39;pango-extents-en.png&#39;&#41;;
system&#40;&#39;open&#39;,&#39;pango-extents-en.png&#39;&#41;;

sub draw_extents {
    my &#40; $cr, $layout, $desc, $lang &#41; = @_;
    my $layoutline = $layout-&gt;get_line&#40;0&#41;;
    my $fontmap = Pango::Cairo::FontMap-&gt;new_for_font_type&#40;&#39;ft&#39;&#41;;
    my $context = $fontmap-&gt;create_context&#40;&#41;;
    my $font    = $context-&gt;load_font&#40;$desc&#41;;
    Pango::Cairo::update_context&#40; $cr, $context &#41;;
    Pango::Cairo::update_layout&#40; $cr, $layout &#41;;
    my &#40; $ink, $logical &#41; = $layoutline-&gt;get_pixel_extents&#40;&#41;;
    my $metrics = $font-&gt;get_metrics&#40;$lang&#41;;
    my $ascent =  $metrics-&gt;get_ascent&#40;&#41; / Pango-&gt;scale;
    my $descent =  $metrics-&gt;get_descent&#40;&#41;/ Pango-&gt;scale;
    my $baseline_y = $layout-&gt;get_baseline&#40;&#41; / Pango-&gt;scale;

    # logical rectangle
    $cr-&gt;save;
    $cr-&gt;set_source_rgba&#40; 0, 0, 1 , 1 &#41;;
    
    $cr-&gt;rectangle&#40; $logical-&gt;{x} , $baseline_y - ascent&#40;$logical&#41; , 
                $logical-&gt;{width}, $logical-&gt;{height} &#41;;
    $cr-&gt;stroke;
    draw_note&#40; $cr, &#39;logical&#39;, 100 , 0 &#41;;
    $cr-&gt;restore;

    # ink rectangle
    $cr-&gt;save;
    $cr-&gt;set_source_rgba&#40; 0, 0, 0, 0.4 &#41;;
    $cr-&gt;rectangle&#40; $ink-&gt;{x} , $baseline_y - ascent&#40;$ink&#41; , $ink-&gt;{width}, $ink-&gt;{height} &#41;;
    $cr-&gt;stroke;
    draw_note&#40; $cr, &#39;ink&#39;, $ink-&gt;{x}, $baseline_y - ascent&#40;$ink&#41; &#41;;
    $cr-&gt;restore;

    # draw baseline
    $cr-&gt;save;
    $cr-&gt;set_source_rgba&#40; 1 , 0, 0 , 1 &#41;;
    $cr-&gt;move_to&#40; 0 , $baseline_y  &#41;;
    $cr-&gt;line_to&#40; $logical-&gt;{width} + 20 , $baseline_y &#41;;
    $cr-&gt;stroke;
    draw_note&#40;$cr, &#39;baseline&#39; , $logical-&gt;{width} + 2 , $baseline_y &#41;;
    $cr-&gt;restore;


    # draw descent line
    $cr-&gt;save;
    $cr-&gt;set_source_rgba&#40; 1 , 0, 0 , 0.5 &#41;;
    $cr-&gt;move_to&#40; 0 , $baseline_y + $descent &#41;;
    $cr-&gt;line_to&#40; $logical-&gt;{width} , $baseline_y + $descent &#41;;
    $cr-&gt;stroke;
    draw_note&#40;$cr, &#39;descent line&#39; , 0 , $baseline_y + $descent &#41;;
    $cr-&gt;restore;

    # draw ascent line
    $cr-&gt;save;
    $cr-&gt;set_source_rgba&#40; 1 , 0, 0 , 0.5 &#41;;
    $cr-&gt;move_to&#40; 0 , $baseline_y - $ascent &#41;;
    $cr-&gt;line_to&#40; $logical-&gt;{width} , $baseline_y - $ascent &#41;;
    $cr-&gt;stroke;
    draw_note&#40;$cr, &#39;ascent line&#39; , 0 , $baseline_y - $ascent &#41;;
    $cr-&gt;restore;
}


sub draw_note {
    my &#40; $cr, $text, $x, $y &#41; = @_;
    $cr-&gt;save;
    $cr-&gt;move_to&#40; $x, $y &#41;;
    $cr-&gt;show_text&#40;$text&#41;;
    $cr-&gt;stroke;
    $cr-&gt;restore;
}
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> scale33.pl</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/env perl
use utf8;
use warnings;
use strict;
use lib &#39;lib&#39;;
use Cairo;
use Pango;

use constant {
    text_offset =&gt; 80,
    width       =&gt; 900,
    height      =&gt; 2000,
};

sub draw_note;
sub draw_extents;

# take logical, ink &#40;pango::rectangle&#41;
sub ascent  { -$_[0]-&gt;{y} }

# take logical,ink  &#40;pango::rectangle&#41;
sub descent { $_[0]-&gt;{y} + $_[0]-&gt;{height} }

my $surface = Cairo::ImageSurface-&gt;create &#40;&#39;argb32&#39;, width , height &#41;;
my $cr = Cairo::Context-&gt;create &#40;$surface&#41;;
$cr-&gt;scale&#40; 3, 3&#41;;
$cr-&gt;translate&#40; 1 , 1 &#41;;
$cr-&gt;set_line_width&#40;0.1&#41;;
$cr-&gt;set_font_size&#40;5&#41;;

my @fonts = &#40;
    &#39;Folio Md BT&#39;,
    &#39;Souvenir Lt BT&#39;,
    &#39;News701 BT&#39;,
    &#39;News701 BT&#39;,
    &#39;Apple LiGothic&#39;,
    &#39;AR Roman1 Medium&#39;,
    &#39;AR Roman1 Heavy&#39;,
    &#39;AR RGothic1 Bold&#39;,
&#41;;

for my $fontname &#40; @fonts &#41; {
    my $layout = Pango::Cairo::create_layout &#40;$cr&#41;;
    # $layout-&gt;set_text&#40;&#34;orz123&#34;&#41;;
    $layout-&gt;set_text&#40;&#34;Orz&#34;&#41;;
    my $desc = Pango::FontDescription-&gt;from_string&#40;&#34;$fontname Normal 12&#34;&#41;;
    $desc-&gt;set_absolute_size&#40; 60 * Pango-&gt;scale&#40;&#41; &#41;;

    my $lang = Pango::Language-&gt;from_string&#40; &#39;en_US&#39; &#41;;
    $layout-&gt;set_font_description &#40;$desc&#41;;

    Pango::Cairo::show_layout&#40;$cr, $layout&#41;;
    draw_extents&#40; $cr, $layout, $desc, $lang &#41;;
    $cr-&gt;translate&#40; 0 , text_offset &#41;;
}

$cr-&gt;show_page&#40;&#41;;
$surface-&gt;write_to_png &#40;&#39;pango-extents-en.png&#39;&#41;;
system&#40;&#39;open&#39;,&#39;pango-extents-en.png&#39;&#41;;

sub draw_extents {
    my &#40; $cr, $layout, $desc, $lang &#41; = @_;
    my $layoutline = $layout-&gt;get_line&#40;0&#41;;
    my $fontmap = Pango::Cairo::FontMap-&gt;new_for_font_type&#40;&#39;ft&#39;&#41;;
    my $context = $fontmap-&gt;create_context&#40;&#41;;
    my $font    = $context-&gt;load_font&#40;$desc&#41;;
    Pango::Cairo::update_context&#40; $cr, $context &#41;;
    Pango::Cairo::update_layout&#40; $cr, $layout &#41;;
    my &#40; $ink, $logical &#41; = $layoutline-&gt;get_pixel_extents&#40;&#41;;
    my $metrics = $font-&gt;get_metrics&#40;$lang&#41;;
    my $ascent =  $metrics-&gt;get_ascent&#40;&#41; / Pango-&gt;scale;
    my $descent =  $metrics-&gt;get_descent&#40;&#41;/ Pango-&gt;scale;
    my $baseline_y = $layout-&gt;get_baseline&#40;&#41; / Pango-&gt;scale;

    # logical rectangle
    $cr-&gt;save;
    $cr-&gt;set_source_rgba&#40; 0, 0, 1 , 1 &#41;;
    
    $cr-&gt;rectangle&#40; $logical-&gt;{x} , $baseline_y - ascent&#40;$logical&#41; , 
                $logical-&gt;{width}, $logical-&gt;{height} &#41;;
    $cr-&gt;stroke;
    draw_note&#40; $cr, &#39;logical&#39;, 100 , 0 &#41;;
    $cr-&gt;restore;

    # ink rectangle
    $cr-&gt;save;
    $cr-&gt;set_source_rgba&#40; 0, 0, 0, 0.4 &#41;;
    $cr-&gt;rectangle&#40; $ink-&gt;{x} , $baseline_y - ascent&#40;$ink&#41; , $ink-&gt;{width}, $ink-&gt;{height} &#41;;
    $cr-&gt;stroke;
    draw_note&#40; $cr, &#39;ink&#39;, $ink-&gt;{x}, $baseline_y - ascent&#40;$ink&#41; &#41;;
    $cr-&gt;restore;

    # draw baseline
    $cr-&gt;save;
    $cr-&gt;set_source_rgba&#40; 1 , 0, 0 , 1 &#41;;
    $cr-&gt;move_to&#40; 0 , $baseline_y  &#41;;
    $cr-&gt;line_to&#40; $logical-&gt;{width} + 20 , $baseline_y &#41;;
    $cr-&gt;stroke;
    draw_note&#40;$cr, &#39;baseline&#39; , $logical-&gt;{width} + 2 , $baseline_y &#41;;
    $cr-&gt;restore;


    # draw descent line
    $cr-&gt;save;
    $cr-&gt;set_source_rgba&#40; 1 , 0, 0 , 0.5 &#41;;
    $cr-&gt;move_to&#40; 0 , $baseline_y + $descent &#41;;
    $cr-&gt;line_to&#40; $logical-&gt;{width} , $baseline_y + $descent &#41;;
    $cr-&gt;stroke;
    draw_note&#40;$cr, &#39;descent line&#39; , 0 , $baseline_y + $descent &#41;;
    $cr-&gt;restore;

    # draw ascent line
    $cr-&gt;save;
    $cr-&gt;set_source_rgba&#40; 1 , 0, 0 , 0.5 &#41;;
    $cr-&gt;move_to&#40; 0 , $baseline_y - $ascent &#41;;
    $cr-&gt;line_to&#40; $logical-&gt;{width} , $baseline_y - $ascent &#41;;
    $cr-&gt;stroke;
    draw_note&#40;$cr, &#39;ascent line&#39; , 0 , $baseline_y - $ascent &#41;;
    $cr-&gt;restore;
}

sub draw_note {
    my &#40; $cr, $text, $x, $y &#41; = @_;
    $cr-&gt;save;
    $cr-&gt;move_to&#40; $x, $y &#41;;
    $cr-&gt;show_text&#40;$text&#41;;
    $cr-&gt;stroke;
    $cr-&gt;restore;
}


</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;28&nbsp;07:20:22&nbsp;2010</span>
    <span class="description">kaffeetisch [...] gmx.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Jan 30 05:49:40 2010, CORNELIUS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; here is my test-case.
</div>
These programs are too long.  Please try to provide the *smallest*
program that exhibits the problem.  Don&#39;t draw unrelated stuff.  Also,
try to use fonts that are commonly available; I have none of the fonts
you use in your test.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;01&nbsp;15:58:18&nbsp;2010</span>
    <span class="description">kaffeetisch [...] gmx.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Feb 28 07:20:22 2010, TSCH wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; here is my test-case.
</div>&gt; 
&gt; These programs are too long.  Please try to provide the *smallest*
&gt; program that exhibits the problem.  Don&#39;t draw unrelated stuff.  Also,
&gt; try to use fonts that are commonly available; I have none of the fonts
&gt; you use in your test.
</div>
Just to clarify: I&#39;m asking for a smaller test case so that I&#39;m able to
tell whether the bug is in the bindings.

If you have problems reducing your test case, you could also try
describing your issue on the pango or cairo mailing lists:
&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://mail.gnome.org/mailman/listinfo/gtk-i18n-list">http://mail.gnome.org/mailman/listinfo/gtk-i18n-list</a></span>&gt; and
&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://lists.cairographics.org/cgi-bin/mailman/listinfo/cairo">http://lists.cairographics.org/cgi-bin/mailman/listinfo/cairo</a></span>&gt;.  Maybe
somebody there knows an answer right away.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
