<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #74170 for DBIx-Class-Schema-Loader: Data types not picked up for Sybase ASE 15.5</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #74170 for DBIx-Class-Schema-Loader: Data types not picked up for Sybase ASE 15.5</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DBIx-Class-Schema-Loader/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DBIx-Class-Schema-Loader/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DBIx-Class-Schema-Loader/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DBIx-Class-Schema-Loader/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBIx-Class-Schema-Loader">DBIx-Class-Schema-Loader CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">74170</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DBIx-Class-Schema-Loader/Active/">DBIx-Class-Schema-Loader</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
PCMANTZ [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-38270-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
0.07009</li>
<li>
0.07015</li>
</ul>
    </td>
  </tr>
  <tr id="CF-38271-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




sybase_common_test_scrubbed.out<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1026291/535385/sybase_common_test_scrubbed.out">
Mon Jan 23 14:35:55 2012 (166.8k) by PCMANTZ [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;19&nbsp;18:30:30&nbsp;2012</span>
    <span class="description">PCMANTZ [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Data types not picked up for Sybase ASE 15.5</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">A couple months ago, we migrated our server from 12.1 to 15.5, after
switching
our ORM from something hand-rolled to DBIx::Class.  Our workflow for schema
updates starts with making changes to the development environment, running
DBIC::S::L on the database, and committing the ensuing changes
&#40;including some
post-checksum massaging&#41; to our repository.  So far, this has kept our
ORM in
lock-step across all environments, and even allows us to use SQLite as a
testing database.

I noticed that after the upgrade, the DBIC::S::L component has been dropping
datatypes from our Result classes.  I cracked open DBIC:S:L:DBI:Sybase and
found the following query is being used to retrieve column information, and
created a test table:

---

create table foo &#40;
    id int identity,
    bar varchar&#40;20&#41;,
    baz datetime default getdate&#40;&#41;,
    constraint PK_foo
    primary key clustered &#40;id&#41;
&#41;

---

I then interpolated the requisite values from the query used in
_columns_info_for to see what I would get:

---

SELECT c.name name, bt.name base_type, ut.name user_type, cm.text deflt,
c.prec prec, c.scale scale, c.length len
FROM syscolumns c
JOIN sysobjects o ON c.id = o.id
LEFT JOIN systypes bt ON c.type     = bt.type 
LEFT JOIN systypes ut ON c.usertype = ut.usertype
LEFT JOIN syscomments cm
    ON cm.id = CASE WHEN c.cdefault = 0 THEN c.computedcol ELSE
c.cdefault END
WHERE o.name = &#39;foo&#39;
    AND o.uid = 1
    AND o.type IN &#40;&#39;U&#39;, &#39;V&#39;&#41;

---
name,name,name,text,prec,scale,length
baz,datetime,datetime,DEFAULT  getdate&#40;&#41;,,,8
---

&#40;NOTE: no renaming of columns here&#41;

This is troublesome!  It appears that this query is only returning
information
for columns that have a default value.  Not all of our columns have a
default
value, nor should it be expected.  This means that they don&#39;t get an
entry in
the syscolumns table, so this really mucks up our ability to generate a
schema.

As an experiment, I removed the join with syscomments to see what would get
returned:

--- 

SELECT c.name name, bt.name base_type, ut.name user_type, c.prec prec,
c.scale scale, c.length len
FROM syscolumns c
JOIN sysobjects o ON c.id = o.id
LEFT JOIN systypes bt ON c.type     = bt.type 
LEFT JOIN systypes ut ON c.usertype = ut.usertype
WHERE o.name = &#39;foo&#39;
    AND o.uid = 1
    AND o.type IN &#40;&#39;U&#39;, &#39;V&#39;&#41;

---
name,name,name,prec,scale,length
bar,sysname,varchar,,,20
bar,varchar,varchar,,,20
bar,nvarchar,varchar,,,20
bar,longsysname,varchar,,,20
id,int,int,,,4
baz,datetime,datetime,,,8
---

This is better, sort of.  It shows that the type information is
available for
all columns, but you don&#39;t get the default info, since it is stored in
syscomments.

I have a few questions regarding the operation here:

* Why is this query dropping the unmatching results on the left hand side of
  the query?  Isn&#39;t the point of a left join that the left information
is kept
  even when the right-hand information is missing?

* Has anyone tested/confirmed DBIC:S:L on Sybase ASE 15.5?  Is there any
further
  testing I can do?

* Are there any database configuration options regarding column comments
that
  users should be aware of?

* Would a two-pass approach &#40;data-type, then default values&#41; to
information be
  preferable?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;19&nbsp;18:56:13&nbsp;2012</span>
    <span class="description">rkitover [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #74170] Data types not picked up for Sybase ASE 15.5</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 19 Jan 2012 18:55:54 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class-Schema-Loader [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Rafael Kitover &lt;rkitover [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">

On Thursday, January 19, 2012 at 6:30 PM, Paul Custer Mantz via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thu Jan 19 18:30:30 2012: Request 74170 was acted upon.
&gt; Transaction: Ticket created by PCMANTZ
&gt; Queue: DBIx-Class-Schema-Loader
&gt; Subject: Data types not picked up for Sybase ASE 15.5
&gt; Broken in: 0.07009, 0.07015
&gt; Severity: Important
&gt; Owner: Nobody
&gt; Requestors: PCMANTZ@cpan.org &#40;mailto:PCMANTZ@cpan.org&#41;
&gt; Status: new
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=74170">https://rt.cpan.org/Ticket/Display.html?id=74170</a></span> &gt;
&gt; 
&gt; 
&gt; A couple months ago, we migrated our server from 12.1 to 15.5, after
&gt; switching
&gt; our ORM from something hand-rolled to DBIx::Class. Our workflow for schema
&gt; updates starts with making changes to the development environment, running
&gt; DBIC::S::L on the database, and committing the ensuing changes
&gt; &#40;including some
&gt; post-checksum massaging&#41; to our repository. So far, this has kept our
&gt; ORM in
&gt; lock-step across all environments, and even allows us to use SQLite as a
&gt; testing database.
&gt; 
&gt; I noticed that after the upgrade, the DBIC::S::L component has been dropping
&gt; datatypes from our Result classes. I cracked open DBIC:S:L:DBI:Sybase and
&gt; found the following query is being used to retrieve column information, and
&gt; created a test table:
&gt; 
</div>Apparently on my machine I have ASE 15.0, I didn&#39;t see this problem.

If you open up t/10_06sybase_common.t in the distribution you will see the data_type tests, not all of the columns in those tests have defaults.

Please run this test on your server and give me the output.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; ---
&gt; 
&gt; create table foo &#40;
&gt; id int identity,
&gt; bar varchar&#40;20&#41;,
&gt; baz datetime default getdate&#40;&#41;,
&gt; constraint PK_foo
&gt; primary key clustered &#40;id&#41;
&gt; &#41;
&gt; 
&gt; ---
&gt; 
&gt; I then interpolated the requisite values from the query used in
&gt; _columns_info_for to see what I would get:
&gt; 
&gt; ---
&gt; 
&gt; SELECT c.name &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://c.name">http://c.name</a></span>&#41; name, bt.name &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://bt.name">http://bt.name</a></span>&#41; base_type, ut.name &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://ut.name">http://ut.name</a></span>&#41; user_type, cm.text deflt,
&gt; c.prec prec, c.scale scale, c.length len
&gt; FROM syscolumns c
&gt; JOIN sysobjects o ON c.id = o.id
&gt; LEFT JOIN systypes bt ON c.type = bt.type 
&gt; LEFT JOIN systypes ut ON c.usertype = ut.usertype
&gt; LEFT JOIN syscomments cm
&gt; ON cm.id = CASE WHEN c.cdefault = 0 THEN c.computedcol ELSE
&gt; c.cdefault END
&gt; WHERE o.name &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://o.name">http://o.name</a></span>&#41; = &#39;foo&#39;
&gt; AND o.uid = 1
&gt; AND o.type IN &#40;&#39;U&#39;, &#39;V&#39;&#41;
&gt; 
&gt; ---
&gt; name,name,name,text,prec,scale,length
&gt; baz,datetime,datetime,DEFAULT getdate&#40;&#41;,,,8
&gt; ---
&gt; 
&gt; &#40;NOTE: no renaming of columns here&#41;
&gt; 
&gt; This is troublesome! It appears that this query is only returning
&gt; information
&gt; for columns that have a default value. Not all of our columns have a
&gt; default
&gt; value, nor should it be expected. This means that they don&#39;t get an
&gt; entry in
&gt; the syscolumns table, so this really mucks up our ability to generate a
&gt; schema.
&gt; 
&gt; As an experiment, I removed the join with syscomments to see what would get
&gt; returned:
&gt; 
&gt; --- 
&gt; 
&gt; SELECT c.name &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://c.name">http://c.name</a></span>&#41; name, bt.name &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://bt.name">http://bt.name</a></span>&#41; base_type, ut.name &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://ut.name">http://ut.name</a></span>&#41; user_type, c.prec prec,
&gt; c.scale scale, c.length len
&gt; FROM syscolumns c
&gt; JOIN sysobjects o ON c.id = o.id
&gt; LEFT JOIN systypes bt ON c.type = bt.type 
&gt; LEFT JOIN systypes ut ON c.usertype = ut.usertype
&gt; WHERE o.name &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://o.name">http://o.name</a></span>&#41; = &#39;foo&#39;
&gt; AND o.uid = 1
&gt; AND o.type IN &#40;&#39;U&#39;, &#39;V&#39;&#41;
&gt; 
&gt; ---
&gt; name,name,name,prec,scale,length
&gt; bar,sysname,varchar,,,20
&gt; bar,varchar,varchar,,,20
&gt; bar,nvarchar,varchar,,,20
&gt; bar,longsysname,varchar,,,20
&gt; id,int,int,,,4
&gt; baz,datetime,datetime,,,8
&gt; ---
&gt; 
&gt; This is better, sort of. It shows that the type information is
&gt; available for
&gt; all columns, but you don&#39;t get the default info, since it is stored in
&gt; syscomments.
&gt; 
&gt; I have a few questions regarding the operation here:
&gt; 
&gt; * Why is this query dropping the unmatching results on the left hand side of
&gt; the query? Isn&#39;t the point of a left join that the left information
&gt; is kept
&gt; even when the right-hand information is missing?
&gt; 
&gt; 
</div>
That&#39;s a question for your DBAs or some Sybase experts, I have no clue :&#41;

That is indeed the point of a LEFT JOIN.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; * Has anyone tested/confirmed DBIC:S:L on Sybase ASE 15.5? Is there any
&gt; further
&gt; testing I can do?
&gt; 
&gt; 
</div>
Please run the sybase common tests in t/10_06sybase_common.t and give me the output.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; * Are there any database configuration options regarding column comments
&gt; that
&gt; users should be aware of?
&gt; 
&gt; 
</div>
Don&#39;t think so, another question for DBAs. 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; * Would a two-pass approach &#40;data-type, then default values&#41; to
&gt; information be
&gt; preferable?
&gt; 
&gt; 
</div>
I personally could care less how many passes it takes, sl is already slow and I have no problems making it even slower if needed :&#41; 

If you can hack the code with a two-pass approach to get it to work for your server, send me the patch.

Use the git repo:

git clone git://git.shadowcat.co.uk/dbsrgits/DBIx-Class-Schema-Loader.git sl

if you send me a patch, also send me the full name, IRC nickname and email address you prefer to be listed in the attribution.

If you would prefer to have access to the repo to work on a branch, send your SSH public key and I will add you.

Good luck!
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;19&nbsp;18:56:16&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;23&nbsp;14:35:54&nbsp;2012</span>
    <span class="description">PCMANTZ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> rkitover [...] cpan.org</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here is the output of the test script, including stdout messages. 
You&#39;ll notice that data_type is just not being picked up, and the
failing tests 237-277 confirm it.

The following is the version number of the database I tested against:

Adaptive Server Enterprise/15.5/EBF 18657 SMP ESD#4/P/Sun_svr4/OS
5.8/asear155/2545/64-bit/FBO/Thu Jun 16 10:29:40 2011

I&#39;ll see what I can do about a two-pass solution to this; as it seems
that there is a query being issued for each individual column anyway.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> sybase_common_test_scrubbed.out</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1026291/535385/sybase_common_test_scrubbed.out">Download sybase_common_test_scrubbed.out</a><br />
<span class="downloadcontenttype">application/octet-stream 166.8k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;23&nbsp;15:02:58&nbsp;2012</span>
    <span class="description">rkitover [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #74170] Data types not picked up for Sybase ASE 15.5</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 23 Jan 2012 15:02:43 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class-Schema-Loader [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Rafael Kitover &lt;rkitover [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">

On Monday, January 23, 2012 at 2:35 PM, Paul Custer Mantz via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Queue: DBIx-Class-Schema-Loader
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=74170">https://rt.cpan.org/Ticket/Display.html?id=74170</a></span> &gt;
&gt; 
&gt; Here is the output of the test script, including stdout messages. 
&gt; You&#39;ll notice that data_type is just not being picked up, and the
&gt; failing tests 237-277 confirm it.
&gt; 
&gt; The following is the version number of the database I tested against:
&gt; 
&gt; Adaptive Server Enterprise/15.5/EBF 18657 SMP ESD#4/P/Sun_svr4/OS
&gt; 5.8/asear155/2545/64-bit/FBO/Thu Jun 16 10:29:40 2011
&gt; 
&gt; I&#39;ll see what I can do about a two-pass solution to this; as it seems
&gt; that there is a query being issued for each individual column anyway.
&gt; 
&gt; 
&gt; Attachments: 
&gt; - sybase_common_test_scrubbed.out
&gt; 
</div>
Apparently I have 12.5: 

        DBMS_VER
SQL Server/12.5/P/Generic/OS/1/OPT/Sat Jun 30 00:01:37 PDT 2001



I will update my copy of ASE on my linux laptop over the next few days.

If you want to do any optimizations while you&#39;re in the _columns_info_for code fixing this, feel free, although I don&#39;t think it makes a huge amount of difference. Selects on system tables are pretty fast.

I&#39;m working on an Oracle issue right now, will wait until I fix that and your patch and then do a new release.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;27&nbsp;16:02:54&nbsp;2012</span>
    <span class="description">PCMANTZ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">While I&#39;m working on this, is there any reason that the
&#39;inflate_datetime&#39; is being set?  The Sybase &#38; MSSQL drivers are the
only ones that set it.  Seems like it should be taken out.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;27&nbsp;18:01:11&nbsp;2012</span>
    <span class="description">rkitover [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jan 27 16:02:54 2012, PCMANTZ wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; While I&#39;m working on this, is there any reason that the
&gt; &#39;inflate_datetime&#39; is being set?  The Sybase &#38; MSSQL drivers are the
&gt; only ones that set it.  Seems like it should be taken out.
</div>
It is set to 0 for timestamp, because timestamp in Sybase is not a 
datetime type.

This is to tell InflateColumn::DateTime to not try to inflate 
timestamps as datetimes.

Please do not take it out.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;27&nbsp;18:03:43&nbsp;2012</span>
    <span class="description">PCMANTZ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/pcmantz/dbic-sl/tree/sybase_ase_15.5">https://github.com/pcmantz/dbic-sl/tree/sybase_ase_15.5</a></span>

Here&#39;s a branch of my work to get DBIC:S:L:DBI:Sybase to work with
Sybase 15.5.  All the tests pass, and I&#39;ve used it to regenerate my schema.

I&#39;ve also removed the inflate_datetime field setting in the commit on
that branch.

If you still have a Sybase 12.4 installation around, I would appreciate
it if you could test this.  I haven&#39;t done so yet myself, and I don&#39;t
know if I&#39;ll have that opportunity.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;27&nbsp;23:13:51&nbsp;2012</span>
    <span class="description">rkitover [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">When did ASE 15 come out? I just installed ASE on my windows box a few 
months ago and sp_server_info is showing 12.5...

How are you reading the server version?

If you do an sp_server_info in the row that says DBMS_VER, what does it 
say for you?

I&#39;m going to leave the ASE on my linux box alone and upgrade the ASE on 
my windows box to the 15.7 they have out now so I can test both.

Thanks for the branch, going to play with it over the next few days.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;28&nbsp;16:04:11&nbsp;2012</span>
    <span class="description">rkitover [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">So on my linux box, select @@version shows:

        Adaptive Server Enterprise/15.0.3/EBF 16555 ESD#1/P/Linux 
Intel/Linux 2.6.9-42.ELsmp i686/as
e1503/2680/32-bit/FBO/Thu Mar  5 04:50:21 2009

On my windows box, select @@version shows:

        Adaptive Server Enterprise/15.5/EBF 18158 SMP 
ESD#2/P/X64/Windows Server/asear155/2514/64-bi
t/OPT/Wed Aug 25 05:39:57 2010

and I am about to upgrade the windows box to 15.7.

Running the common tests on the 15.5 ASE on the windows box right now, 
but getting disconnects from the server in the middle of the tests for 
some reason...will investigate. IIRC when I ran them before, the 
data_type tests ran fine, I don&#39;t think this is specifically a version 
issue but I will verify shortly.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;28&nbsp;17:57:46&nbsp;2012</span>
    <span class="description">rkitover [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">So the new developer&#39;s versions of ASE do not allow setting &#39;number of 
user connections&#39; above 25. This breaks the sl common tests.

I&#39;ve tried both sp_configure and editing the .cfg to no effect.

I&#39;m going to work on reducing the number of active cursors in the 
common tests so it works with the 25 limit so I can test with my copy 
of the 15.5 developer edition.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;31&nbsp;01:38:09&nbsp;2012</span>
    <span class="description">PCMANTZ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jan 27 23:13:51 2012, RKITOVER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; When did ASE 15 come out? I just installed ASE on my windows box a few 
&gt; months ago and sp_server_info is showing 12.5...
&gt; 
</div>
According to wikipedia, it came out in 2005:

<span class="clickylink"><a target="new" rel="nofollow" href="http://en.wikipedia.org/wiki/Adaptive_Server_Enterprise">http://en.wikipedia.org/wiki/Adaptive_Server_Enterprise</a></span>

Though I can imagine that most shops were in no real hurry to upgrade,
so there hasn&#39;t been much demand for support.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; How are you reading the server version?
&gt; 
</div>
I was checking the database info using Squirrel SQL.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If you do an sp_server_info in the row that says DBMS_VER, what does it 
&gt; say for you?
&gt; 
</div>
I don&#39;t have access to this database anymore, though I can ask some
people that do to provide that info.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m going to leave the ASE on my linux box alone and upgrade the ASE on 
&gt; my windows box to the 15.7 they have out now so I can test both.
&gt; 
&gt; Thanks for the branch, going to play with it over the next few days.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;07&nbsp;14:46:02&nbsp;2012</span>
    <span class="description">rkitover [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I finally got a chance to test on a new version of ASE developer&#39;s 
edition. I used 15.7 which I believe was just released.

I had to reduce the number of active statements the common tests use, 
which turned out to be much simpler than I anticipated.

All tests pass using the existing code, including the data_type tests, 
except for the nchar/nvarchar types, because I used a utf8 encoding, but 
I fixed that &#40;new release coming shortly.&#41;

So I think the reason you were having this problem with your database 
was due to some sort of misconfiguration, or maybe 15.5 was just a bad 
version &#40;unlikely&#41; in any case, the existing code is fine.

Your fork changes ALOT of code, spread across a few commits, so I&#39;m not 
comfortable merging it as is, as there seems to be no reason to.

I&#39;d be more comfortable merging it if I knew the reason why it was 
needed, how this server is different from my 3 servers and that of the 
other users of this module who have not reported this problem, which 
would involve some more investigation. But you said you lost access to 
this server, so that may be difficult.

I don&#39;t want your work to get lost though, so I&#39;ll pull it into a branch 
and test it out with my servers, perhaps add a config option to enable 
it or something, if you&#39;re interested.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;08&nbsp;08:04:15&nbsp;2012</span>
    <span class="description">rkitover [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I looked over your code again and it seems harmless enough, and maybe 
there are other users with this weird problem, so I made some changes and 
merged it to master.

Will be releasing in a few minutes.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;08&nbsp;08:04:17&nbsp;2012</span>
    <span class="description">rkitover [...] cpan.org -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;08&nbsp;08:14:24&nbsp;2012</span>
    <span class="description">rkitover [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Also tested it on two of my ASE servers, the 15.0.3 and the 15.7, and it 
works perfectly!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;08&nbsp;08:14:27&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;patched&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;08&nbsp;08:26:55&nbsp;2012</span>
    <span class="description">rkitover [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Your branch is merged with some changes in 0.07022, closing this ticket.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;08&nbsp;08:27:46&nbsp;2012</span>
    <span class="description">rkitover [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
