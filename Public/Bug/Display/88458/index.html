<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #88458 for version: Put version.pm-specific code in its own file in the perl core</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #88458 for version: Put version.pm-specific code in its own file in the perl core</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/version/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/version/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/version/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/version/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/version">version CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">88458</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/version/Active/">version</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
&#39;spro^^*%*^6ut# [...] &#38;$%*c

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
BULKDD [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-34940-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-34941-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.9906    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;06&nbsp;01:18:12&nbsp;2013</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Put version.pm-specific code in its own file in the perl core</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Suggestion:

version.h &#40;or .c?&#41; in the core could contain:

/* DO NOT EDIT this file here.  This contains code for which the CPAN
  &#34;version&#34; distribution is upstream. */

#ifdef PERL_IN_UNIVERSAL_C
...
#endif

#ifdef PERL_IN_UTIL_C
...
#endif


And then util.c and universal.c could both contain:

#include &#34;version.h&#34;


Of course, there are endless variations to this &#40;which file goes where, what includes what, etc.&#41;.  But this could be a start.

I could go ahead and do that if you could tell me exactly which functions need to be moved.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;09&nbsp;20:54:13&nbsp;2013</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Sep 06 01:18:12 2013, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Suggestion:
&gt; 
&gt; version.h &#40;or .c?&#41; in the core could contain:
&gt; 
&gt; /* DO NOT EDIT this file here.  This contains code for which the CPAN
&gt;   &#34;version&#34; distribution is upstream. */
&gt; 
&gt; #ifdef PERL_IN_UNIVERSAL_C
&gt; ...
&gt; #endif
&gt; 
&gt; #ifdef PERL_IN_UTIL_C
&gt; ...
&gt; #endif
&gt; 
&gt; 
&gt; And then util.c and universal.c could both contain:
&gt; 
&gt; #include &#34;version.h&#34;
&gt; 
&gt; 
&gt; Of course, there are endless variations to this &#40;which file goes
&gt; where, what includes what, etc.&#41;.  But this could be a start.
&gt; 
&gt; I could go ahead and do that if you could tell me exactly which
&gt; functions need to be moved.
</div>
Just to let you, so we don’t duplicate efforts, I’m starting to work on this.

BTW, do you use git for the CPAN distribution?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;09&nbsp;20:54:13&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;10&nbsp;07:12:42&nbsp;2013</span>
    <span class="description">john.peacock [...] havurah-software.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #88458] Put version.pm-specific code in its own file in the perl core</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 10 Sep 2013 07:12:19 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-version [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Peacock &lt;john.peacock [...] havurah-software.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 09/09/2013 08:54 PM, Father Chrysostomos via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Just to let you, so we don’t duplicate efforts, I’m starting to work on this.
&gt;
&gt; BTW, do you use git for the CPAN distribution?
&gt;
</div>
ssh://hg@bitbucket.org/jpeacock/version/

All of the underlying version functions are in util.c &#40;or vutil/vutil.c 
in the CPAN distro&#41;.  All of the class/object methods are in universal.c 
&#40;vutil/vxs.xs&#41;.  I think that UNIVERSAL::VERSION is the only piece that 
&#34;needs&#34; to be in universal.c; the rest could be moved.

John
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;11&nbsp;16:35:14&nbsp;2013</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Sep 10 07:12:42 2013, john.peacock@havurah-software.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 09/09/2013 08:54 PM, Father Chrysostomos via RT wrote:
<div class="message-stanza open">&gt; &gt; Just to let you, so we don’t duplicate efforts, I’m starting to work
&gt; &gt; on this.
&gt; &gt;
&gt; &gt; BTW, do you use git for the CPAN distribution?
&gt; &gt;
</div>&gt; 
&gt; ssh://hg@bitbucket.org/jpeacock/version/
</div>
It won’t let me in without authentication.  So I worked from the CPAN distribution.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; All of the underlying version functions are in util.c &#40;or
&gt; vutil/vutil.c
&gt; in the CPAN distro&#41;.  All of the class/object methods are in
&gt; universal.c
&gt; &#40;vutil/vxs.xs&#41;.  I think that UNIVERSAL::VERSION is the only piece
&gt; that
&gt; &#34;needs&#34; to be in universal.c; the rest could be moved.
</div>
The attached file containing a patch series &#40;which you should be able to feed straight to git am&#41; moves the XS routines into a separate vxs.inc file.

You will see that I have pushed to perl.git’s sprout/version branch blead’s equivalent of these patches; parts of util.c have been moved to vutil.c and parts of universal.c to vxs.inc.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> open_AiGkwWYI.txt</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;11&nbsp;20:46:54&nbsp;2013</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Sep 11 16:35:14 2013, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Tue Sep 10 07:12:42 2013, john.peacock@havurah-software.org wrote:
<div class="message-stanza open">&gt; &gt; On 09/09/2013 08:54 PM, Father Chrysostomos via RT wrote:
<div class="message-stanza open">&gt; &gt; &gt; Just to let you, so we don’t duplicate efforts, I’m starting to
&gt; &gt; &gt; work
&gt; &gt; &gt; on this.
&gt; &gt; &gt;
&gt; &gt; &gt; BTW, do you use git for the CPAN distribution?
&gt; &gt; &gt;
</div>&gt; &gt;
&gt; &gt; ssh://hg@bitbucket.org/jpeacock/version/
</div>&gt; 
&gt; It won’t let me in without authentication.  So I worked from the CPAN
&gt; distribution.
&gt; 
<div class="message-stanza open">&gt; &gt;
&gt; &gt; All of the underlying version functions are in util.c &#40;or
&gt; &gt; vutil/vutil.c
&gt; &gt; in the CPAN distro&#41;.  All of the class/object methods are in
&gt; &gt; universal.c
&gt; &gt; &#40;vutil/vxs.xs&#41;.  I think that UNIVERSAL::VERSION is the only piece
&gt; &gt; that
&gt; &gt; &#34;needs&#34; to be in universal.c; the rest could be moved.
</div>&gt; 
&gt; The attached file containing a patch series &#40;which you should be able
&gt; to feed straight to git am&#41; moves the XS routines into a separate
&gt; vxs.inc file.
&gt; 
&gt; You will see that I have pushed to perl.git’s sprout/version branch
&gt; blead’s equivalent of these patches; parts of util.c have been moved
&gt; to vutil.c and parts of universal.c to vxs.inc.
</div>
I forgot to mention:

I tested it with these perls:

5.8.8
5.10.1
5.12.4
5.14.4
5.18.1
v5.19.3-365-g7b6e807

I don’t have anything earlier installed.

The patches include fixes for #88572 and #88495, too.

I await your go-ahead before I push the perl.git branch to blead.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;12&nbsp;16:00:22&nbsp;2013</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Sep 11 16:35:14 2013, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Tue Sep 10 07:12:42 2013, john.peacock@havurah-software.org wrote:
<div class="message-stanza open">&gt; &gt; On 09/09/2013 08:54 PM, Father Chrysostomos via RT wrote:
<div class="message-stanza open">&gt; &gt; &gt; Just to let you, so we don’t duplicate efforts, I’m starting to
&gt; &gt; &gt; work
&gt; &gt; &gt; on this.
&gt; &gt; &gt;
&gt; &gt; &gt; BTW, do you use git for the CPAN distribution?
&gt; &gt; &gt;
</div>&gt; &gt;
&gt; &gt; ssh://hg@bitbucket.org/jpeacock/version/
</div>&gt; 
&gt; It won’t let me in without authentication.  So I worked from the CPAN
&gt; distribution.
&gt; 
<div class="message-stanza open">&gt; &gt;
&gt; &gt; All of the underlying version functions are in util.c &#40;or
&gt; &gt; vutil/vutil.c
&gt; &gt; in the CPAN distro&#41;.  All of the class/object methods are in
&gt; &gt; universal.c
&gt; &gt; &#40;vutil/vxs.xs&#41;.  I think that UNIVERSAL::VERSION is the only piece
&gt; &gt; that
&gt; &gt; &#34;needs&#34; to be in universal.c; the rest could be moved.
</div>&gt; 
&gt; The attached file containing a patch series &#40;which you should be able
&gt; to feed straight to git am&#41; moves the XS routines into a separate
&gt; vxs.inc file.
&gt; 
&gt; You will see that I have pushed to perl.git’s sprout/version branch
&gt; blead’s equivalent of these patches; parts of util.c have been moved
&gt; to vutil.c and parts of universal.c to vxs.inc.
</div>
That diff accidentally included changes to vutil/Makefile.PL, which is generated, in addition to the changes in the main Makefile.PL that generate it.

Just omitting that hunk would work, but here is another patch sequence without that hunk, for your convenience.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> better patch.text</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;20&nbsp;07:30:24&nbsp;2013</span>
    <span class="description">jpeacock [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Sep 12 16:00:22 2013, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; That diff accidentally included changes to vutil/Makefile.PL, which is
&gt; generated, in addition to the changes in the main Makefile.PL that
&gt; generate it.
&gt; 
&gt; Just omitting that hunk would work, but here is another patch sequence
&gt; without that hunk, for your convenience.
</div>
I&#39;m getting test failures like this:

t/01base.t ........ 1/? Undefined subroutine &#38;version::vxs::new called at t/coretests.pm line 28.

with the &#34;better&#34; patch.  I&#39;ve been swamped &#40;Jewish high holiday season&#41; and had no time to look at it; maybe this weekend.

John
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;20&nbsp;15:55:44&nbsp;2013</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Sep 20 07:30:24 2013, JPEACOCK wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Sep 12 16:00:22 2013, SPROUT wrote:
<div class="message-stanza open">&gt; &gt; That diff accidentally included changes to vutil/Makefile.PL, which
&gt; &gt; is
&gt; &gt; generated, in addition to the changes in the main Makefile.PL that
&gt; &gt; generate it.
&gt; &gt;
&gt; &gt; Just omitting that hunk would work, but here is another patch
&gt; &gt; sequence
&gt; &gt; without that hunk, for your convenience.
</div>&gt; 
&gt; I&#39;m getting test failures like this:
&gt; 
&gt; t/01base.t ........ 1/? Undefined subroutine &#38;version::vxs::new called
&gt; at t/coretests.pm line 28.
&gt; 
&gt; with the &#34;better&#34; patch.  I&#39;ve been swamped &#40;Jewish high holiday
&gt; season&#41; and had no time to look at it; maybe this weekend.
</div>
That’s very strange.  I’m not seeing that at all.  What perl version are you using?  Maybe I accidentally omitted something from the patch.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;21&nbsp;07:49:03&nbsp;2013</span>
    <span class="description">jpeacock [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Sep 20 15:55:44 2013, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; That’s very strange.  I’m not seeing that at all.  What perl version
&gt; are you using?  Maybe I accidentally omitted something from the patch.
</div>
I don&#39;t know.  I just shared the bitbucket repo with you so you can fork that and then confirm that you have all of the pieces, rather than trying to figure out the right patch.  Just send me a pull request and I&#39;ll take care of it that way.  Sorry about sending you the &#34;private&#34; URL the first time... ;-&#41;

John
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;21&nbsp;13:58:02&nbsp;2013</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Sep 21 07:49:03 2013, JPEACOCK wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri Sep 20 15:55:44 2013, SPROUT wrote:
<div class="message-stanza open">&gt; &gt; That’s very strange.  I’m not seeing that at all.  What perl version
&gt; &gt; are you using?  Maybe I accidentally omitted something from the
&gt; &gt; patch.
</div>&gt; 
&gt; I don&#39;t know.  I just shared the bitbucket repo with you so you can
&gt; fork that and then confirm that you have all of the pieces, rather
&gt; than trying to figure out the right patch.  Just send me a pull
&gt; request and I&#39;ll take care of it that way.  Sorry about sending you
&gt; the &#34;private&#34; URL the first time... ;-&#41;
</div>
I have limited web access, being behind a filtering proxy, and bitbucket is not in the list I can get do.  I can put it a request to add that to the list of allowed domains, but it will be a few days at least.

In the mean time, I have tried applying my ‘better patch’ to a freshly-unpacked tarball from CPAN, and all tests pass.  So I can’t say what the problem is yet.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;22&nbsp;22:01:53&nbsp;2013</span>
    <span class="description">jpeacock [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Sep 21 13:58:02 2013, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In the mean time, I have tried applying my ‘better patch’ to a
&gt; freshly-unpacked tarball from CPAN, and all tests pass.  So I can’t
&gt; say what the problem is yet.
</div>
I did the same and get exactly the same errors with a wide variety of Perls:  5.15.1, 5.19.0, 5.19.1, perl-blead all fail the same way; 5.10.1 fails with a lot of other errors as well.  My guess is that the magic to replace the native version code is broken.  I&#39;ll take a closer look at it tomorrow morning and see if I can figure out what the problem is...

John
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;13&nbsp;21:57:17&nbsp;2013</span>
    <span class="description">jpeacock [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Sep 22 22:01:53 2013, JPEACOCK wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 5.10.1 fails with a lot of other errors as well.  My guess is that the
&gt; magic to replace the native version code is broken.
</div>
I&#39;m wondering if the Perl&#39;s you were using for your tests already had a non-core version.pm installed, because I cannot get it to work, no matter what I do.

In particular, it appears from my testing that the details[] array is not getting populated correctly, and hence the functions are not getting registered:

$ perl -I blib/lib/ -I blib/arch/ -wle &#34;use version::vxs; print version::vxs-&gt;new&#40;&#39;1.2.3&#39;&#41;&#34;
Can&#39;t locate object method &#34;new&#34; via package &#34;version::vxs&#34; at -e line 1.

If I add the following patch:

diff -r 35248c2474c9 vutil/vxs.xs
--- a/vutil/vxs.xs      Tue Oct 08 07:09:01 2013 -0400
+++ b/vutil/vxs.xs      Sun Oct 13 21:51:23 2013 -0400
@@ -43,6 +43,7 @@
         /* register the overloading &#40;type &#39;A&#39;&#41; magic */
         PL_amagic_generation++;
        do {
+           fprintf&#40;stderr,&#34;registering %s\n&#34;, xsub-&gt;name&#41;;
            newXS&#40;xsub-&gt;name, xsub-&gt;xsub, file&#41;;
        } while &#40;++xsub &lt; end&#41;;
     }

I see the wrong array elements:

registering UNIVERSAL::isa
registering UNIVERSAL::can
registering UNIVERSAL::DOES
registering UNIVERSAL::VERSION
registering version::&#40;&#41;
registering version::new
registering version::parse
registering version::&#40;&#34;&#34;
registering version::stringify
registering version::&#40;0+
registering version::numify
registering version::normal
registering version::&#40;cmp
registering version::&#40;&lt;=&gt;
registering version::vcmp
registering version::&#40;bool
registering version::boolean
registering version::&#40;nomethod
registering version::noop
registering version::is_alpha
registering version::qv
registering version::declare
registering version::is_qv
registering utf8::is_utf8
registering utf8::valid
registering utf8::encode
registering utf8::decode
registering utf8::upgrade
registering utf8::downgrade

In fact, if I make the following change:

diff -r 35248c2474c9 vutil/vxs.inc
--- a/vutil/vxs.inc     Tue Oct 08 07:09:01 2013 -0400
+++ b/vutil/vxs.inc     Sun Oct 13 21:51:20 2013 -0400
@@ -4,7 +4,7 @@
 #ifdef PERL_CORE
 #  define VXS_CLASS &#34;version&#34;
 #else
-#  define VXS_CLASS &#34;version::vxs&#34;
+#  define VXS_CLASS &#34;wrong::class&#34;
 #endif
 
 #ifdef VXS_XSUB_DETAILS

the output doesn&#39;t change at all &#40;which is clearly wrong&#41;.

I&#39;ve applied the patch series to the &#34;sprout&#34; branch in the bitbucket repo, but I have no idea where to go from here.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;14&nbsp;09:31:15&nbsp;2013</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Oct 13 21:57:17 2013, JPEACOCK wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sun Sep 22 22:01:53 2013, JPEACOCK wrote:
<div class="message-stanza open">&gt; &gt; 5.10.1 fails with a lot of other errors as well.  My guess is that
&gt; &gt; the
&gt; &gt; magic to replace the native version code is broken.
</div>&gt; 
&gt; I&#39;m wondering if the Perl&#39;s you were using for your tests already had
&gt; a non-core version.pm installed, because I cannot get it to work, no
&gt; matter what I do.
&gt; 
&gt; In particular, it appears from my testing that the details[] array is
&gt; not getting populated correctly, and hence the functions are not
&gt; getting registered:
&gt; 
&gt; $ perl -I blib/lib/ -I blib/arch/ -wle &#34;use version::vxs; print
&gt; version::vxs-&gt;new&#40;&#39;1.2.3&#39;&#41;&#34;
&gt; Can&#39;t locate object method &#34;new&#34; via package &#34;version::vxs&#34; at -e line
&gt; 1.
&gt; 
&gt; If I add the following patch:
&gt; 
&gt; diff -r 35248c2474c9 vutil/vxs.xs
&gt; --- a/vutil/vxs.xs      Tue Oct 08 07:09:01 2013 -0400
&gt; +++ b/vutil/vxs.xs      Sun Oct 13 21:51:23 2013 -0400
&gt; @@ -43,6 +43,7 @@
&gt;          /* register the overloading &#40;type &#39;A&#39;&#41; magic */
&gt;          PL_amagic_generation++;
&gt;         do {
&gt; +           fprintf&#40;stderr,&#34;registering %s\n&#34;, xsub-&gt;name&#41;;
&gt;             newXS&#40;xsub-&gt;name, xsub-&gt;xsub, file&#41;;
&gt;         } while &#40;++xsub &lt; end&#41;;
&gt;      }
&gt; 
&gt; I see the wrong array elements:
&gt; 
&gt; registering UNIVERSAL::isa
&gt; registering UNIVERSAL::can
&gt; registering UNIVERSAL::DOES
&gt; registering UNIVERSAL::VERSION
&gt; registering version::&#40;&#41;
&gt; registering version::new
&gt; registering version::parse
&gt; registering version::&#40;&#34;&#34;
&gt; registering version::stringify
&gt; registering version::&#40;0+
&gt; registering version::numify
&gt; registering version::normal
&gt; registering version::&#40;cmp
&gt; registering version::&#40;&lt;=&gt;
&gt; registering version::vcmp
&gt; registering version::&#40;bool
&gt; registering version::boolean
&gt; registering version::&#40;nomethod
&gt; registering version::noop
&gt; registering version::is_alpha
&gt; registering version::qv
&gt; registering version::declare
&gt; registering version::is_qv
&gt; registering utf8::is_utf8
&gt; registering utf8::valid
&gt; registering utf8::encode
&gt; registering utf8::decode
&gt; registering utf8::upgrade
&gt; registering utf8::downgrade
&gt; 
&gt; In fact, if I make the following change:
&gt; 
&gt; diff -r 35248c2474c9 vutil/vxs.inc
&gt; --- a/vutil/vxs.inc     Tue Oct 08 07:09:01 2013 -0400
&gt; +++ b/vutil/vxs.inc     Sun Oct 13 21:51:20 2013 -0400
&gt; @@ -4,7 +4,7 @@
&gt;  #ifdef PERL_CORE
&gt;  #  define VXS_CLASS &#34;version&#34;
&gt;  #else
&gt; -#  define VXS_CLASS &#34;version::vxs&#34;
&gt; +#  define VXS_CLASS &#34;wrong::class&#34;
&gt;  #endif
&gt; 
&gt; #ifdef VXS_XSUB_DETAILS
&gt; 
&gt; the output doesn&#39;t change at all &#40;which is clearly wrong&#41;.
&gt; 
&gt; I&#39;ve applied the patch series to the &#34;sprout&#34; branch in the bitbucket
&gt; repo, but I have no idea where to go from here.
</div>
Sorry I’ve not been able to finish this up.  Other things in real life have been getting in the way, and will continue for some time.

However, I suspect that the ‘const struct xsub_details details[]’ in vxs.xs needs to be made static, and possibly renamed to vdetails to avoid conflicting with the one in the perl core.  &#40;And then that one should also be made static; it probably should have been to begin with.&#41;  Does that work?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;22&nbsp;14:20:38&nbsp;2013</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Oct 14 09:31:15 2013, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sun Oct 13 21:57:17 2013, JPEACOCK wrote:
<div class="message-stanza open">&gt; &gt; On Sun Sep 22 22:01:53 2013, JPEACOCK wrote:
<div class="message-stanza open">&gt; &gt; &gt; 5.10.1 fails with a lot of other errors as well.  My guess is that
&gt; &gt; &gt; the
&gt; &gt; &gt; magic to replace the native version code is broken.
</div>&gt; &gt;
&gt; &gt; I&#39;m wondering if the Perl&#39;s you were using for your tests already had
&gt; &gt; a non-core version.pm installed, because I cannot get it to work, no
&gt; &gt; matter what I do.
&gt; &gt;
&gt; &gt; In particular, it appears from my testing that the details[] array is
&gt; &gt; not getting populated correctly, and hence the functions are not
&gt; &gt; getting registered:
&gt; &gt;
&gt; &gt; $ perl -I blib/lib/ -I blib/arch/ -wle &#34;use version::vxs; print
&gt; &gt; version::vxs-&gt;new&#40;&#39;1.2.3&#39;&#41;&#34;
&gt; &gt; Can&#39;t locate object method &#34;new&#34; via package &#34;version::vxs&#34; at -e
&gt; &gt; line
&gt; &gt; 1.
&gt; &gt;
&gt; &gt; If I add the following patch:
&gt; &gt;
&gt; &gt; diff -r 35248c2474c9 vutil/vxs.xs
&gt; &gt; --- a/vutil/vxs.xs      Tue Oct 08 07:09:01 2013 -0400
&gt; &gt; +++ b/vutil/vxs.xs      Sun Oct 13 21:51:23 2013 -0400
&gt; &gt; @@ -43,6 +43,7 @@
&gt; &gt;          /* register the overloading &#40;type &#39;A&#39;&#41; magic */
&gt; &gt;          PL_amagic_generation++;
&gt; &gt;         do {
&gt; &gt; +           fprintf&#40;stderr,&#34;registering %s\n&#34;, xsub-&gt;name&#41;;
&gt; &gt;             newXS&#40;xsub-&gt;name, xsub-&gt;xsub, file&#41;;
&gt; &gt;         } while &#40;++xsub &lt; end&#41;;
&gt; &gt;      }
&gt; &gt;
&gt; &gt; I see the wrong array elements:
&gt; &gt;
&gt; &gt; registering UNIVERSAL::isa
&gt; &gt; registering UNIVERSAL::can
&gt; &gt; registering UNIVERSAL::DOES
&gt; &gt; registering UNIVERSAL::VERSION
&gt; &gt; registering version::&#40;&#41;
&gt; &gt; registering version::new
&gt; &gt; registering version::parse
&gt; &gt; registering version::&#40;&#34;&#34;
&gt; &gt; registering version::stringify
&gt; &gt; registering version::&#40;0+
&gt; &gt; registering version::numify
&gt; &gt; registering version::normal
&gt; &gt; registering version::&#40;cmp
&gt; &gt; registering version::&#40;&lt;=&gt;
&gt; &gt; registering version::vcmp
&gt; &gt; registering version::&#40;bool
&gt; &gt; registering version::boolean
&gt; &gt; registering version::&#40;nomethod
&gt; &gt; registering version::noop
&gt; &gt; registering version::is_alpha
&gt; &gt; registering version::qv
&gt; &gt; registering version::declare
&gt; &gt; registering version::is_qv
&gt; &gt; registering utf8::is_utf8
&gt; &gt; registering utf8::valid
&gt; &gt; registering utf8::encode
&gt; &gt; registering utf8::decode
&gt; &gt; registering utf8::upgrade
&gt; &gt; registering utf8::downgrade
&gt; &gt;
&gt; &gt; In fact, if I make the following change:
&gt; &gt;
&gt; &gt; diff -r 35248c2474c9 vutil/vxs.inc
&gt; &gt; --- a/vutil/vxs.inc     Tue Oct 08 07:09:01 2013 -0400
&gt; &gt; +++ b/vutil/vxs.inc     Sun Oct 13 21:51:20 2013 -0400
&gt; &gt; @@ -4,7 +4,7 @@
&gt; &gt;  #ifdef PERL_CORE
&gt; &gt;  #  define VXS_CLASS &#34;version&#34;
&gt; &gt;  #else
&gt; &gt; -#  define VXS_CLASS &#34;version::vxs&#34;
&gt; &gt; +#  define VXS_CLASS &#34;wrong::class&#34;
&gt; &gt;  #endif
&gt; &gt;
&gt; &gt; #ifdef VXS_XSUB_DETAILS
&gt; &gt;
&gt; &gt; the output doesn&#39;t change at all &#40;which is clearly wrong&#41;.
&gt; &gt;
&gt; &gt; I&#39;ve applied the patch series to the &#34;sprout&#34; branch in the bitbucket
&gt; &gt; repo, but I have no idea where to go from here.
</div>&gt; 
&gt; Sorry I’ve not been able to finish this up.  Other things in real life
&gt; have been getting in the way, and will continue for some time.
&gt; 
&gt; However, I suspect that the ‘const struct xsub_details details[]’ in
&gt; vxs.xs needs to be made static, and possibly renamed to vdetails to
&gt; avoid conflicting with the one in the perl core.  &#40;And then that one
&gt; should also be made static; it probably should have been to begin
&gt; with.&#41;  Does that work?
</div>
Attached is a patch to make it static.  Does it work for you?

Sorry, no progress on the bitbucket front yet.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> make details static.txt</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 179a3d9c398fc0532800450a17689066ac387835 Mon Sep 17 00:00:00 2001
From: Father Chrysostomos &lt;sprout@cpan.org&gt;
Date: Tue, 22 Oct 2013 11:17:24 -0700
Subject: [PATCH] vxs.xs: Make details static

Otherwise it conflicts with the one perl defines in universal.c.

diff --git a/vutil/vxs.xs b/vutil/vxs.xs
index edd80ef..dc36d99 100644
--- a/vutil/vxs.xs
+++ b/vutil/vxs.xs
@@ -19,7 +19,7 @@ struct xsub_details {
     const char *proto; /* ignored */
 };
 
-const struct xsub_details details[] = {
+static const struct xsub_details details[] = {
 #define VXS_XSUB_DETAILS
 #include &#34;vxs.inc&#34;
 #undef VXS_XSUB_DETAILS
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;22&nbsp;21:46:34&nbsp;2013</span>
    <span class="description">jpeacock [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Oct 22 14:20:38 2013, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Attached is a patch to make it static.  Does it work for you?
</div>
I&#39;m sorry, I thought I had updated the ticket.  Either making details[] static or renaming it fixed that problem.  The deeper problem I just identified is that the XS functions have to be renamed so they don&#39;t conflict with the core code.  I&#39;m seeing a regression of the perl #112478 &#40;snprintf buffer overflow&#41; fix, but we are getting closer.

John
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;24&nbsp;20:58:43&nbsp;2013</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Oct 22 21:46:34 2013, JPEACOCK wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Tue Oct 22 14:20:38 2013, SPROUT wrote:
<div class="message-stanza open">&gt; &gt; Attached is a patch to make it static.  Does it work for you?
</div>&gt; 
&gt; I&#39;m sorry, I thought I had updated the ticket.  Either making
&gt; details[] static or renaming it fixed that problem.  The deeper
&gt; problem I just identified is that the XS functions have to be renamed
&gt; so they don&#39;t conflict with the core code.  I&#39;m seeing a regression of
&gt; the perl #112478 &#40;snprintf buffer overflow&#41; fix, but we are getting
&gt; closer.
</div>
Here is a patch for that.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Use VXS prefix.txt</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 7e237df84efb9949767ae4868098a9214f36bdeb Mon Sep 17 00:00:00 2001
From: Father Chrysostomos &lt;sprout@cpan.org&gt;
Date: Thu, 24 Oct 2013 17:56:22 -0700
Subject: [PATCH] Use VXS_ prefix for XSUB bodies in CPAN version
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

The names of the functions in core and in the CPAN version will con-
flict otherwise.

Since perl versions before 5.16.0 did not have XS_INTERNAL &#40;which
could solve this problem another way, making the functions static&#41;,
it’s easier just to use different names.

diff --git a/vutil/vxs.inc b/vutil/vxs.inc
index 1615f69..2552ce8 100644
--- a/vutil/vxs.inc
+++ b/vutil/vxs.inc
@@ -3,48 +3,51 @@
 
 #ifdef PERL_CORE
 #  define VXS_CLASS &#34;version&#34;
+#  define VXSp&#40;name&#41; XS_##name
 #else
 #  define VXS_CLASS &#34;version::vxs&#34;
+#  define VXSp&#40;name&#41; VXS_##name
 #endif
+#define VXS&#40;name&#41; XS&#40;VXSp&#40;name&#41;&#41;
 
 #ifdef VXS_XSUB_DETAILS
 #  ifdef PERL_CORE
     {&#34;UNIVERSAL::VERSION&#34;, XS_UNIVERSAL_VERSION, NULL},
 #  else
-    {VXS_CLASS &#34;::_VERSION&#34;, XS_UNIVERSAL_VERSION, NULL},
+    {VXS_CLASS &#34;::_VERSION&#34;, VXS_UNIVERSAL_VERSION, NULL},
 #  endif
-    {VXS_CLASS &#34;::&#40;&#41;&#34;, XS_version_noop, NULL},
-    {VXS_CLASS &#34;::new&#34;, XS_version_new, NULL},
-    {VXS_CLASS &#34;::parse&#34;, XS_version_new, NULL},
-    {VXS_CLASS &#34;::&#40;\&#34;\&#34;&#34;, XS_version_stringify, NULL},
-    {VXS_CLASS &#34;::stringify&#34;, XS_version_stringify, NULL},
-    {VXS_CLASS &#34;::&#40;0+&#34;, XS_version_numify, NULL},
-    {VXS_CLASS &#34;::numify&#34;, XS_version_numify, NULL},
-    {VXS_CLASS &#34;::normal&#34;, XS_version_normal, NULL},
-    {VXS_CLASS &#34;::&#40;cmp&#34;, XS_version_vcmp, NULL},
-    {VXS_CLASS &#34;::&#40;&lt;=&gt;&#34;, XS_version_vcmp, NULL},
+    {VXS_CLASS &#34;::&#40;&#41;&#34;, VXSp&#40;version_noop&#41;, NULL},
+    {VXS_CLASS &#34;::new&#34;, VXSp&#40;version_new&#41;, NULL},
+    {VXS_CLASS &#34;::parse&#34;, VXSp&#40;version_new&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;\&#34;\&#34;&#34;, VXSp&#40;version_stringify&#41;, NULL},
+    {VXS_CLASS &#34;::stringify&#34;, VXSp&#40;version_stringify&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;0+&#34;, VXSp&#40;version_numify&#41;, NULL},
+    {VXS_CLASS &#34;::numify&#34;, VXSp&#40;version_numify&#41;, NULL},
+    {VXS_CLASS &#34;::normal&#34;, VXSp&#40;version_normal&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;cmp&#34;, VXSp&#40;version_vcmp&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;&lt;=&gt;&#34;, VXSp&#40;version_vcmp&#41;, NULL},
 #  ifdef PERL_CORE
     {VXS_CLASS &#34;::vcmp&#34;, XS_version_vcmp, NULL},
 #  else
-    {VXS_CLASS &#34;::VCMP&#34;, XS_version_vcmp, NULL},
+    {VXS_CLASS &#34;::VCMP&#34;, VXS_version_vcmp, NULL},
 #  endif
-    {VXS_CLASS &#34;::&#40;bool&#34;, XS_version_boolean, NULL},
-    {VXS_CLASS &#34;::boolean&#34;, XS_version_boolean, NULL},
-    {VXS_CLASS &#34;::&#40;+&#34;, XS_version_noop, NULL},
-    {VXS_CLASS &#34;::&#40;-&#34;, XS_version_noop, NULL},
-    {VXS_CLASS &#34;::&#40;*&#34;, XS_version_noop, NULL},
-    {VXS_CLASS &#34;::&#40;/&#34;, XS_version_noop, NULL},
-    {VXS_CLASS &#34;::&#40;+=&#34;, XS_version_noop, NULL},
-    {VXS_CLASS &#34;::&#40;-=&#34;, XS_version_noop, NULL},
-    {VXS_CLASS &#34;::&#40;*=&#34;, XS_version_noop, NULL},
-    {VXS_CLASS &#34;::&#40;/=&#34;, XS_version_noop, NULL},
-    {VXS_CLASS &#34;::&#40;abs&#34;, XS_version_noop, NULL},
-    {VXS_CLASS &#34;::&#40;nomethod&#34;, XS_version_noop, NULL},
-    {VXS_CLASS &#34;::noop&#34;, XS_version_noop, NULL},
-    {VXS_CLASS &#34;::is_alpha&#34;, XS_version_is_alpha, NULL},
-    {VXS_CLASS &#34;::qv&#34;, XS_version_qv, NULL},
-    {VXS_CLASS &#34;::declare&#34;, XS_version_qv, NULL},
-    {VXS_CLASS &#34;::is_qv&#34;, XS_version_is_qv, NULL},
+    {VXS_CLASS &#34;::&#40;bool&#34;, VXSp&#40;version_boolean&#41;, NULL},
+    {VXS_CLASS &#34;::boolean&#34;, VXSp&#40;version_boolean&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;+&#34;, VXSp&#40;version_noop&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;-&#34;, VXSp&#40;version_noop&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;*&#34;, VXSp&#40;version_noop&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;/&#34;, VXSp&#40;version_noop&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;+=&#34;, VXSp&#40;version_noop&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;-=&#34;, VXSp&#40;version_noop&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;*=&#34;, VXSp&#40;version_noop&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;/=&#34;, VXSp&#40;version_noop&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;abs&#34;, VXSp&#40;version_noop&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;nomethod&#34;, VXSp&#40;version_noop&#41;, NULL},
+    {VXS_CLASS &#34;::noop&#34;, VXSp&#40;version_noop&#41;, NULL},
+    {VXS_CLASS &#34;::is_alpha&#34;, VXSp&#40;version_is_alpha&#41;, NULL},
+    {VXS_CLASS &#34;::qv&#34;, VXSp&#40;version_qv&#41;, NULL},
+    {VXS_CLASS &#34;::declare&#34;, VXSp&#40;version_qv&#41;, NULL},
+    {VXS_CLASS &#34;::is_qv&#34;, VXSp&#40;version_is_qv&#41;, NULL},
 #else
 
 #ifndef dVAR
@@ -64,7 +67,7 @@ typedef char HVNAME;
 #  define HEKf		&#34;s&#34;
 #endif
 
-XS&#40;XS_UNIVERSAL_VERSION&#41;
+VXS&#40;UNIVERSAL_VERSION&#41;
 {
     dVAR;
     dXSARGS;
@@ -165,7 +168,7 @@ XS&#40;XS_UNIVERSAL_VERSION&#41;
     XSRETURN&#40;1&#41;;
 }
 
-XS&#40;XS_version_new&#41;
+VXS&#40;version_new&#41;
 {
     dVAR;
     dXSARGS;
@@ -233,7 +236,7 @@ XS&#40;XS_version_new&#41;
 	    Perl_croak&#40;aTHX_ varname &#34; is not of type version&#34;&#41;;	\
     } STMT_END
 
-XS&#40;XS_version_stringify&#41;
+VXS&#40;version_stringify&#41;
 {
      dVAR;
      dXSARGS;
@@ -251,7 +254,7 @@ XS&#40;XS_version_stringify&#41;
      }
 }
 
-XS&#40;XS_version_numify&#41;
+VXS&#40;version_numify&#41;
 {
      dVAR;
      dXSARGS;
@@ -267,7 +270,7 @@ XS&#40;XS_version_numify&#41;
      }
 }
 
-XS&#40;XS_version_normal&#41;
+VXS&#40;version_normal&#41;
 {
      dVAR;
      dXSARGS;
@@ -285,7 +288,7 @@ XS&#40;XS_version_normal&#41;
      }
 }
 
-XS&#40;XS_version_vcmp&#41;
+VXS&#40;version_vcmp&#41;
 {
      dVAR;
      dXSARGS;
@@ -325,7 +328,7 @@ XS&#40;XS_version_vcmp&#41;
      }
 }
 
-XS&#40;XS_version_boolean&#41;
+VXS&#40;version_boolean&#41;
 {
     dVAR;
     dXSARGS;
@@ -348,7 +351,7 @@ XS&#40;XS_version_boolean&#41;
     }
 }
 
-XS&#40;XS_version_noop&#41;
+VXS&#40;version_noop&#41;
 {
     dVAR;
     dXSARGS;
@@ -361,7 +364,7 @@ XS&#40;XS_version_noop&#41;
     XSRETURN_EMPTY;
 }
 
-XS&#40;XS_version_is_alpha&#41;
+VXS&#40;version_is_alpha&#41;
 {
     dVAR;
     dXSARGS;
@@ -380,7 +383,7 @@ XS&#40;XS_version_is_alpha&#41;
     }
 }
 
-XS&#40;XS_version_qv&#41;
+VXS&#40;version_qv&#41;
 {
     dVAR;
     dXSARGS;
@@ -434,7 +437,7 @@ XS&#40;XS_version_qv&#41;
     return;
 }
 
-XS&#40;XS_version_is_qv&#41;
+VXS&#40;version_is_qv&#41;
 {
     dVAR;
     dXSARGS;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;25&nbsp;09:00:11&nbsp;2013</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here is another patch.  I just tried rebasing against blead and got test failures due to a thinko.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Fix thinko.text</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 458d29e1ef8961d040ea40cec2c06dc6b0f80d9c Mon Sep 17 00:00:00 2001
From: Father Chrysostomos &lt;sprout@cpan.org&gt;
Date: Fri, 25 Oct 2013 05:57:47 -0700
Subject: [PATCH] vxs.inc: Fix thinko

This was causing test failures after rebasing against blead.

diff --git a/vutil/vxs.inc b/vutil/vxs.inc
index 2552ce8..e63173b 100644
--- a/vutil/vxs.inc
+++ b/vutil/vxs.inc
@@ -374,7 +374,7 @@ VXS&#40;version_is_alpha&#41;
     {
 	SV *lobj;
 	VTYPECHECK&#40;lobj, ST&#40;0&#41;, &#34;lobj&#34;&#41;;
-	if &#40; hv_exists&#40;MUTABLE_HV&#40;SvRV&#40;lobj&#41;&#41;, &#34;alpha&#34;, 5 &#41; &#41;
+	if &#40; hv_exists&#40;MUTABLE_HV&#40;lobj&#41;, &#34;alpha&#34;, 5 &#41; &#41;
 	    XSRETURN_YES;
 	else
 	    XSRETURN_NO;
@@ -447,7 +447,7 @@ VXS&#40;version_is_qv&#41;
     {
 	SV *lobj;
 	VTYPECHECK&#40;lobj, ST&#40;0&#41;, &#34;lobj&#34;&#41;;
-	if &#40; hv_exists&#40;MUTABLE_HV&#40;SvRV&#40;lobj&#41;&#41;, &#34;qv&#34;, 2 &#41; &#41;
+	if &#40; hv_exists&#40;MUTABLE_HV&#40;lobj&#41;, &#34;qv&#34;, 2 &#41; &#41;
 	    XSRETURN_YES;
 	else
 	    XSRETURN_NO;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;25&nbsp;22:06:23&nbsp;2013</span>
    <span class="description">john.peacock [...] havurah-software.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #88458] Put version.pm-specific code in its own file in the perl core</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 25 Dec 2013 22:06:03 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-version [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Peacock &lt;john.peacock [...] havurah-software.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 10/25/2013 09:00 AM, Father Chrysostomos via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: version
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=88458">https://rt.cpan.org/Ticket/Display.html?id=88458</a></span> &gt;
&gt;
&gt; Here is another patch.  I just tried rebasing against blead and got test failures due to a thinko.
&gt;
</div>
Attached are two patches that apply to your branch that will bring 
bleadperl into sync with what will hopefully be released to CPAN soon. 
Note that vxs.inc is now vxs.in in the CPAN release, because I have to 
rename the functions for the CPAN release.  This isn&#39;t final, but should 
give you a good idea of the direction I&#39;m going in.

I&#39;m going to also post something to p5p, because I wound up making 
version::vpp a completely standalone module and I want that to be 
included in the core as well.  I did that so I could deprecate the XS 
code for all Perl releases prior to 5.10.0.

John
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;29&nbsp;09:18:15&nbsp;2013</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Dec 25 22:06:23 2013, john.peacock@havurah-software.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 10/25/2013 09:00 AM, Father Chrysostomos via RT wrote:
<div class="message-stanza open">&gt; &gt; Queue: version
&gt; &gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=88458">https://rt.cpan.org/Ticket/Display.html?id=88458</a></span> &gt;
&gt; &gt;
&gt; &gt; Here is another patch.  I just tried rebasing against blead and got
&gt; &gt; test failures due to a thinko.
&gt; &gt;
</div>&gt; 
&gt; Attached are two patches that apply to your branch that will bring
&gt; bleadperl into sync with what will hopefully be released to CPAN soon.
&gt; Note that vxs.inc is now vxs.in in the CPAN release, because I have to
&gt; rename the functions for the CPAN release.  This isn&#39;t final, but
&gt; should
&gt; give you a good idea of the direction I&#39;m going in.
</div>
Thank you.  I hope I am not too late, because I think this will be problematic:

        qx|perl -pe &#39;s/XS_version/XS_version__xs/g;
            s/XS_UNIVERSAL/XS_UNIVERSAL_xs/&#39; vutil/vxs.in &gt; vutil/vxs.inc|;

because Windows will need double quotes there.  Also, that command will use the system perl, rather than the one running Makefile.PL.  Alternatively, did you see the patch &#40;attached to this ticket&#41; that does it entirely with cpp macros?  &#40;It’s the one called ‘Use VXS prefix.txt’.&#41;

Anyway, since you say this isn’t final, should I wait, or should I go ahead and merge my branch to blead &#40;with your patches&#41;?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;29&nbsp;12:11:44&nbsp;2013</span>
    <span class="description">john.peacock [...] havurah-software.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #88458] Put version.pm-specific code in its own file in the perl core</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 29 Dec 2013 12:11:23 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-version [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Peacock &lt;john.peacock [...] havurah-software.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 12/29/2013 09:18 AM, Father Chrysostomos via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thank you.  I hope I am not too late, because I think this will be problematic:
&gt;
&gt;          qx|perl -pe &#39;s/XS_version/XS_version__xs/g;
&gt;           s/XS_UNIVERSAL/XS_UNIVERSAL_xs/&#39; vutil/vxs.in &gt; vutil/vxs.inc|;
&gt;
&gt; because Windows will need double quotes there.  Also, that command will use the system perl, rather than the one running Makefile.PL.  Alternatively, did you see the patch &#40;attached to this ticket&#41; that does it entirely with cpp macros?  &#40;It’s the one called ‘Use VXS prefix.txt’.&#41;
</div>
I did not see that patch.  I&#39;ll try that now.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Anyway, since you say this isn’t final, should I wait, or should I go ahead and merge my branch to blead &#40;with your patches&#41;?
&gt;
</div>
You should wait.  I&#39;m seeing some test failures when running tests in 
core Perl.  Specifically, the code in version.pm itself that decides 
whether to use vpp or vxs needs to go away completely when integrated 
into blead.  version::vxs does not exist in core &#40;and version::vpp is 
there but unused&#41;.

Thanks for your patience...

John
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;29&nbsp;12:33:22&nbsp;2013</span>
    <span class="description">jpeacock [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Two more patches to apply to your branch.  The only test failures I am seeing are in porting/* and hence are something that have to be resolved when you merge to blead.  I think this is everything apart from some discontinuties in the errors that version::vpp returns for some edge cases &#40;which I am happy to document and ignore&#41;.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0018-Apply-patch-from-Sprout-to-make-vxs.inc-better.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From dd17f8472bb45e438fb453aaca1e60741838e624 Mon Sep 17 00:00:00 2001
From: John Peacock &lt;jpeacock@cpan.org&gt;
Date: Sun, 29 Dec 2013 12:26:30 -0500
Subject: [PATCH 18/18] Apply patch from Sprout to make vxs.inc better

---
 cpan/version/lib/version.pm |  4 +--
 vxs.inc                     | 83 +++++++++++++++++++++++----------------------
 2 files changed, 45 insertions&#40;+&#41;, 42 deletions&#40;-&#41;

diff --git a/cpan/version/lib/version.pm b/cpan/version/lib/version.pm
index e6620c2..b21f1bd 100644
--- a/cpan/version/lib/version.pm
+++ b/cpan/version/lib/version.pm
@@ -4,13 +4,13 @@ package version;
 use 5.005_05;
 use strict;
 
-use vars qw&#40;@ISA $VERSION $CLASS $STRICT $LAX *declare *qv&#41;;
+use vars qw&#40;@ISA $VERSION $CLASS *declare *qv&#41;;
 
 $VERSION = 0.9905;
 $CLASS = &#39;version&#39;;
 
 # avoid using Exporter
-use version::regex;
+require version::regex;
 *version::is_lax = \&#38;version::regex::is_lax;
 *version::is_strict = \&#38;version::regex::is_strict;
 
diff --git a/vxs.inc b/vxs.inc
index 25918e6..cb894f2 100644
--- a/vxs.inc
+++ b/vxs.inc
@@ -3,48 +3,51 @@
 
 #ifdef PERL_CORE
 #  define VXS_CLASS &#34;version&#34;
+#  define VXSp&#40;name&#41; XS_##name
 #else
 #  define VXS_CLASS &#34;version::vxs&#34;
+#  define VXSp&#40;name&#41; VXS_##name
 #endif
+#define VXS&#40;name&#41; XS&#40;VXSp&#40;name&#41;&#41;
 
 #ifdef VXS_XSUB_DETAILS
 #  ifdef PERL_CORE
     {&#34;UNIVERSAL::VERSION&#34;, XS_UNIVERSAL_VERSION, NULL},
 #  else
-    {VXS_CLASS &#34;::_VERSION&#34;, XS_UNIVERSAL_VERSION, NULL},
+    {VXS_CLASS &#34;::_VERSION&#34;, VXS_UNIVERSAL_VERSION, NULL},
 #  endif
-    {VXS_CLASS &#34;::&#40;&#41;&#34;, XS_version_noop, NULL},
-    {VXS_CLASS &#34;::new&#34;, XS_version_new, NULL},
-    {VXS_CLASS &#34;::parse&#34;, XS_version_new, NULL},
-    {VXS_CLASS &#34;::&#40;\&#34;\&#34;&#34;, XS_version_stringify, NULL},
-    {VXS_CLASS &#34;::stringify&#34;, XS_version_stringify, NULL},
-    {VXS_CLASS &#34;::&#40;0+&#34;, XS_version_numify, NULL},
-    {VXS_CLASS &#34;::numify&#34;, XS_version_numify, NULL},
-    {VXS_CLASS &#34;::normal&#34;, XS_version_normal, NULL},
-    {VXS_CLASS &#34;::&#40;cmp&#34;, XS_version_vcmp, NULL},
-    {VXS_CLASS &#34;::&#40;&lt;=&gt;&#34;, XS_version_vcmp, NULL},
+    {VXS_CLASS &#34;::&#40;&#41;&#34;, VXSp&#40;version_noop&#41;, NULL},
+    {VXS_CLASS &#34;::new&#34;, VXSp&#40;version_new&#41;, NULL},
+    {VXS_CLASS &#34;::parse&#34;, VXSp&#40;version_new&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;\&#34;\&#34;&#34;, VXSp&#40;version_stringify&#41;, NULL},
+    {VXS_CLASS &#34;::stringify&#34;, VXSp&#40;version_stringify&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;0+&#34;, VXSp&#40;version_numify&#41;, NULL},
+    {VXS_CLASS &#34;::numify&#34;, VXSp&#40;version_numify&#41;, NULL},
+    {VXS_CLASS &#34;::normal&#34;, VXSp&#40;version_normal&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;cmp&#34;, VXSp&#40;version_vcmp&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;&lt;=&gt;&#34;, VXSp&#40;version_vcmp&#41;, NULL},
 #  ifdef PERL_CORE
     {VXS_CLASS &#34;::vcmp&#34;, XS_version_vcmp, NULL},
 #  else
-    {VXS_CLASS &#34;::VCMP&#34;, XS_version_vcmp, NULL},
+    {VXS_CLASS &#34;::VCMP&#34;, VXS_version_vcmp, NULL},
 #  endif
-    {VXS_CLASS &#34;::&#40;bool&#34;, XS_version_boolean, NULL},
-    {VXS_CLASS &#34;::boolean&#34;, XS_version_boolean, NULL},
-    {VXS_CLASS &#34;::&#40;+&#34;, XS_version_noop, NULL},
-    {VXS_CLASS &#34;::&#40;-&#34;, XS_version_noop, NULL},
-    {VXS_CLASS &#34;::&#40;*&#34;, XS_version_noop, NULL},
-    {VXS_CLASS &#34;::&#40;/&#34;, XS_version_noop, NULL},
-    {VXS_CLASS &#34;::&#40;+=&#34;, XS_version_noop, NULL},
-    {VXS_CLASS &#34;::&#40;-=&#34;, XS_version_noop, NULL},
-    {VXS_CLASS &#34;::&#40;*=&#34;, XS_version_noop, NULL},
-    {VXS_CLASS &#34;::&#40;/=&#34;, XS_version_noop, NULL},
-    {VXS_CLASS &#34;::&#40;abs&#34;, XS_version_noop, NULL},
-    {VXS_CLASS &#34;::&#40;nomethod&#34;, XS_version_noop, NULL},
-    {VXS_CLASS &#34;::noop&#34;, XS_version_noop, NULL},
-    {VXS_CLASS &#34;::is_alpha&#34;, XS_version_is_alpha, NULL},
-    {VXS_CLASS &#34;::qv&#34;, XS_version_qv, NULL},
-    {VXS_CLASS &#34;::declare&#34;, XS_version_qv, NULL},
-    {VXS_CLASS &#34;::is_qv&#34;, XS_version_is_qv, NULL},
+    {VXS_CLASS &#34;::&#40;bool&#34;, VXSp&#40;version_boolean&#41;, NULL},
+    {VXS_CLASS &#34;::boolean&#34;, VXSp&#40;version_boolean&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;+&#34;, VXSp&#40;version_noop&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;-&#34;, VXSp&#40;version_noop&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;*&#34;, VXSp&#40;version_noop&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;/&#34;, VXSp&#40;version_noop&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;+=&#34;, VXSp&#40;version_noop&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;-=&#34;, VXSp&#40;version_noop&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;*=&#34;, VXSp&#40;version_noop&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;/=&#34;, VXSp&#40;version_noop&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;abs&#34;, VXSp&#40;version_noop&#41;, NULL},
+    {VXS_CLASS &#34;::&#40;nomethod&#34;, VXSp&#40;version_noop&#41;, NULL},
+    {VXS_CLASS &#34;::noop&#34;, VXSp&#40;version_noop&#41;, NULL},
+    {VXS_CLASS &#34;::is_alpha&#34;, VXSp&#40;version_is_alpha&#41;, NULL},
+    {VXS_CLASS &#34;::qv&#34;, VXSp&#40;version_qv&#41;, NULL},
+    {VXS_CLASS &#34;::declare&#34;, VXSp&#40;version_qv&#41;, NULL},
+    {VXS_CLASS &#34;::is_qv&#34;, VXSp&#40;version_is_qv&#41;, NULL},
 #else
 
 #ifndef dVAR
@@ -64,7 +67,7 @@ typedef char HVNAME;
 #  define HEKf		&#34;s&#34;
 #endif
 
-XS&#40;XS_UNIVERSAL_VERSION&#41;
+VXS&#40;UNIVERSAL_VERSION&#41;
 {
     dVAR;
     dXSARGS;
@@ -165,7 +168,7 @@ XS&#40;XS_UNIVERSAL_VERSION&#41;
     XSRETURN&#40;1&#41;;
 }
 
-XS&#40;XS_version_new&#41;
+VXS&#40;version_new&#41;
 {
     dVAR;
     dXSARGS;
@@ -233,7 +236,7 @@ XS&#40;XS_version_new&#41;
 	    Perl_croak&#40;aTHX_ varname &#34; is not of type version&#34;&#41;;	\
     } STMT_END
 
-XS&#40;XS_version_stringify&#41;
+VXS&#40;version_stringify&#41;
 {
      dVAR;
      dXSARGS;
@@ -251,7 +254,7 @@ XS&#40;XS_version_stringify&#41;
      }
 }
 
-XS&#40;XS_version_numify&#41;
+VXS&#40;version_numify&#41;
 {
      dVAR;
      dXSARGS;
@@ -267,7 +270,7 @@ XS&#40;XS_version_numify&#41;
      }
 }
 
-XS&#40;XS_version_normal&#41;
+VXS&#40;version_normal&#41;
 {
      dVAR;
      dXSARGS;
@@ -285,7 +288,7 @@ XS&#40;XS_version_normal&#41;
      }
 }
 
-XS&#40;XS_version_vcmp&#41;
+VXS&#40;version_vcmp&#41;
 {
      dVAR;
      dXSARGS;
@@ -325,7 +328,7 @@ XS&#40;XS_version_vcmp&#41;
      }
 }
 
-XS&#40;XS_version_boolean&#41;
+VXS&#40;version_boolean&#41;
 {
     dVAR;
     dXSARGS;
@@ -348,7 +351,7 @@ XS&#40;XS_version_boolean&#41;
     }
 }
 
-XS&#40;XS_version_noop&#41;
+VXS&#40;version_noop&#41;
 {
     dVAR;
     dXSARGS;
@@ -361,7 +364,7 @@ XS&#40;XS_version_noop&#41;
     XSRETURN_EMPTY;
 }
 
-XS&#40;XS_version_is_alpha&#41;
+VXS&#40;version_is_alpha&#41;
 {
     dVAR;
     dXSARGS;
@@ -380,7 +383,7 @@ XS&#40;XS_version_is_alpha&#41;
     }
 }
 
-XS&#40;XS_version_qv&#41;
+VXS&#40;version_qv&#41;
 {
     dVAR;
     dXSARGS;
@@ -434,7 +437,7 @@ XS&#40;XS_version_qv&#41;
     return;
 }
 
-XS&#40;XS_version_is_qv&#41;
+VXS&#40;version_is_qv&#41;
 {
     dVAR;
     dXSARGS;
-- 
1.8.3.2

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;29&nbsp;12:35:24&nbsp;2013</span>
    <span class="description">jpeacock [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Missed this patch
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0017-Integrate-CPAN-release-of-version.pm-0.9905.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From a517ef51bd19bd5e6e33ce3e70f03bd8b349eed1 Mon Sep 17 00:00:00 2001
From: John Peacock &lt;jpeacock@cpan.org&gt;
Date: Sun, 29 Dec 2013 11:49:43 -0500
Subject: [PATCH 17/18] Integrate CPAN release of version.pm 0.9905

When adding the CPAN-distributed files for version.pm, it is necessary
to delete an entire block out of lib/version.pm, since that code is
only necessary with the CPAN release.  Within core Perl, there is no
version::vxs implementation class any more.
---
 MANIFEST                    |  6 +++++-
 cpan/version/lib/version.pm | 46 ++++-----------------------------------------
 2 files changed, 9 insertions&#40;+&#41;, 43 deletions&#40;-&#41;

diff --git a/MANIFEST b/MANIFEST
index 4806631..a5e53de 100644
--- a/MANIFEST
+++ b/MANIFEST
@@ -2741,7 +2741,10 @@ cpan/Unicode-Normalize/t/tie.t		Unicode::Normalize
 cpan/version/lib/version/Internals.pod	Description of the internals of version objects
 cpan/version/lib/version.pm		Support for version objects
 cpan/version/lib/version.pod		Documentation of the version module
-cpan/version/t/01base.t			Tests for version objects`
+cpan/version/lib/version/regex.pm	Regex for matching version objects
+cpan/version/lib/version/vpp.pm		Pure Perl implementation of XS code
+cpan/version/t/00impl-pp.t		Tests for version objects
+cpan/version/t/01base.t			Tests for version objects
 cpan/version/t/02derived.t		Tests for version objects
 cpan/version/t/03require.t		Tests for version objects
 cpan/version/t/04strict_lax.t		Tests for version objects
@@ -2749,6 +2752,7 @@ cpan/version/t/05sigdie.t		Tests for version objects
 cpan/version/t/06noop.t			Tests for version objects
 cpan/version/t/07locale.t		Tests for version objects
 cpan/version/t/08_corelist.t		Tests for version objects
+cpan/version/t/09_list_util.t		Tests for version objects
 cpan/version/t/coretests.pm		Tests for version objects
 cpan/Win32API-File/buffers.h	Win32API::File extension
 cpan/Win32API-File/cFile.h	Win32API::File extension
diff --git a/cpan/version/lib/version.pm b/cpan/version/lib/version.pm
index 7e548a8..e6620c2 100644
--- a/cpan/version/lib/version.pm
+++ b/cpan/version/lib/version.pm
@@ -9,48 +9,10 @@ use vars qw&#40;@ISA $VERSION $CLASS $STRICT $LAX *declare *qv&#41;;
 $VERSION = 0.9905;
 $CLASS = &#39;version&#39;;
 
-{
-    local $SIG{&#39;__DIE__&#39;};
-    eval &#34;use version::vxs $VERSION&#34;;
-    if &#40; $@ &#41; { # don&#39;t have the XS version installed
-	eval &#34;use version::vpp $VERSION&#34;; # don&#39;t tempt fate
-	die &#34;$@&#34; if &#40; $@ &#41;;
-	push @ISA, &#34;version::vpp&#34;;
-	local $^W;
-	*version::qv = \&#38;version::vpp::qv;
-	*version::declare = \&#38;version::vpp::declare;
-	*version::_VERSION = \&#38;version::vpp::_VERSION;
-	*version::vcmp = \&#38;version::vpp::vcmp;
-	*version::new = \&#38;version::vpp::new;
-	if &#40;$] &gt;= 5.009000&#41; {
-	    no strict &#39;refs&#39;;
-	    *version::stringify = \&#38;version::vpp::stringify;
-	    *{&#39;version::&#40;&#34;&#34;&#39;} = \&#38;version::vpp::stringify;
-	    *{&#39;version::&#40;&lt;=&gt;&#39;} = \&#38;version::vpp::vcmp;
-	    *version::parse = \&#38;version::vpp::parse;
-	}
-	*version::is_strict = \&#38;version::vpp::is_strict;
-	*version::is_lax = \&#38;version::vpp::is_lax;
-    }
-    else { # use XS module
-	push @ISA, &#34;version::vxs&#34;;
-	local $^W;
-	*version::declare = \&#38;version::vxs::declare;
-	*version::qv = \&#38;version::vxs::qv;
-	*version::_VERSION = \&#38;version::vxs::_VERSION;
-	*version::vcmp = \&#38;version::vxs::VCMP;
-	*version::new = \&#38;version::vxs::new;
-	if &#40;$] &gt;= 5.009000&#41; {
-	    no strict &#39;refs&#39;;
-	    *version::stringify = \&#38;version::vxs::stringify;
-	    *{&#39;version::&#40;&#34;&#34;&#39;} = \&#38;version::vxs::stringify;
-	    *{&#39;version::&#40;&lt;=&gt;&#39;} = \&#38;version::vxs::VCMP;
-	    *version::parse = \&#38;version::vxs::parse;
-	}
-	*version::is_strict = \&#38;version::vxs::is_strict;
-	*version::is_lax = \&#38;version::vxs::is_lax;
-    }
-}
+# avoid using Exporter
+use version::regex;
+*version::is_lax = \&#38;version::regex::is_lax;
+*version::is_strict = \&#38;version::regex::is_strict;
 
 sub import {
     no strict &#39;refs&#39;;
-- 
1.8.3.2

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;29&nbsp;13:00:11&nbsp;2013</span>
    <span class="description">john.peacock [...] havurah-software.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #88458] Put version.pm-specific code in its own file in the perl core</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 29 Dec 2013 12:59:59 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-version [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Peacock &lt;john.peacock [...] havurah-software.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 12/29/2013 12:11 PM, John Peacock via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; You should wait.  I&#39;m seeing some test failures when running tests in
&gt; core Perl.  Specifically, the code in version.pm itself that decides
&gt; whether to use vpp or vxs needs to go away completely when integrated
&gt; into blead.  version::vxs does not exist in core &#40;and version::vpp is
&gt; there but unused&#41;.
</div>
Seeing different core test failures, now related to version::_VERSION 
not existing....

grrr

John
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;29&nbsp;13:50:03&nbsp;2013</span>
    <span class="description">john.peacock [...] havurah-software.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #88458] Put version.pm-specific code in its own file in the perl core</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 29 Dec 2013 13:49:53 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-version [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Peacock &lt;john.peacock [...] havurah-software.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 12/29/2013 01:00 PM, John Peacock via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Seeing different core test failures, now related to version::_VERSION
&gt; not existing....
</div>
What made this so maddening to debug is that changing vxs.inc does not 
correctly rebuild Perl.  Both universal.c and util.c had to be touch&#39;d 
before any changes to vxs.inc were compiled.

One more patch, making sure that version::_VERSION is always exported 
attached.

John
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;29&nbsp;14:46:15&nbsp;2013</span>
    <span class="description">john.peacock [...] havurah-software.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #88458] Put version.pm-specific code in its own file in the perl core</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 29 Dec 2013 14:46:05 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-version [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Peacock &lt;john.peacock [...] havurah-software.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 12/29/2013 01:50 PM, John Peacock via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: version
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=88458">https://rt.cpan.org/Ticket/Display.html?id=88458</a></span> &gt;
&gt;
&gt; On 12/29/2013 01:00 PM, John Peacock via RT wrote:
<div class="message-stanza open">&gt;&gt; Seeing different core test failures, now related to version::_VERSION
&gt;&gt; not existing....
</div>&gt;
&gt; What made this so maddening to debug is that changing vxs.inc does not
&gt; correctly rebuild Perl.  Both universal.c and util.c had to be touch&#39;d
&gt; before any changes to vxs.inc were compiled.
&gt;
&gt; One more patch, making sure that version::_VERSION is always exported
&gt; attached.
&gt;
&gt; John
&gt;
</div>
Turns out we lost the protection from crazy people who try and pass in 
arrayref&#39;s instead of scalars to version-&gt;new&#40;&#41;.  Go figure.

Attached is an additional patch to handle that case.

John
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;02&nbsp;09:25:20&nbsp;2014</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Dec 29 14:46:15 2013, john.peacock@havurah-software.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 12/29/2013 01:50 PM, John Peacock via RT wrote:
<div class="message-stanza open">&gt; &gt;         Queue: version
&gt; &gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=88458">https://rt.cpan.org/Ticket/Display.html?id=88458</a></span> &gt;
&gt; &gt;
&gt; &gt; On 12/29/2013 01:00 PM, John Peacock via RT wrote:
<div class="message-stanza open">&gt; &gt;&gt; Seeing different core test failures, now related to version::_VERSION
&gt; &gt;&gt; not existing....
</div>&gt; &gt;
&gt; &gt; What made this so maddening to debug is that changing vxs.inc does not
&gt; &gt; correctly rebuild Perl.  Both universal.c and util.c had to be touch&#39;d
&gt; &gt; before any changes to vxs.inc were compiled.
&gt; &gt;
&gt; &gt; One more patch, making sure that version::_VERSION is always exported
&gt; &gt; attached.
&gt; &gt;
&gt; &gt; John
&gt; &gt;
</div>&gt; 
&gt; Turns out we lost the protection from crazy people who try and pass in 
&gt; arrayref&#39;s instead of scalars to version-&gt;new&#40;&#41;.  Go figure.
&gt; 
&gt; Attached is an additional patch to handle that case.
</div>
Thank you.  I have updated perl.git’s sprout/version branch.  I await a green light from you before merging it to blead.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;03&nbsp;14:58:49&nbsp;2014</span>
    <span class="description">john.peacock [...] havurah-software.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #88458] Put version.pm-specific code in its own file in the perl core</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 03 Jan 2014 14:58:35 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-version [...] rt.cpan.org, undisclosed-recipients:;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Peacock &lt;john.peacock [...] havurah-software.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 01/02/2014 09:25 AM, Father Chrysostomos via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Thank you.  I have updated perl.git’s sprout/version branch.  I await a green light from you before merging it to blead.
</div>
I think that if you have verified my assertion that all tests pass, then 
you can go ahead and merge it to blead.  I haven&#39;t had time to run 
regression tests on all of my edge-case Perl&#39;s, and there are probably 
going to be Makefile.PL and test changes to get it working all the way 
back to 5.005_06 &#40;pure Perl only&#41;, but the XS bits appear to be much 
improved.  I can always submit patches for those bits when I do the 
official CPAN release.

John
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;04&nbsp;08:24:53&nbsp;2014</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jan 03 14:58:49 2014, john.peacock@havurah-software.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 01/02/2014 09:25 AM, Father Chrysostomos via RT wrote:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; Thank you.  I have updated perl.git’s sprout/version branch.  I await
&gt; &gt; a green light from you before merging it to blead.
</div>&gt; 
&gt; I think that if you have verified my assertion that all tests pass,
&gt; then
&gt; you can go ahead and merge it to blead.  I haven&#39;t had time to run
&gt; regression tests on all of my edge-case Perl&#39;s, and there are probably
&gt; going to be Makefile.PL and test changes to get it working all the way
&gt; back to 5.005_06 &#40;pure Perl only&#41;, but the XS bits appear to be much
&gt; improved.  I can always submit patches for those bits when I do the
&gt; official CPAN release.
</div>
Thank you.  I have merged it as a76c354d5b.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;04&nbsp;13:12:13&nbsp;2014</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jan 03 14:58:49 2014, john.peacock@havurah-software.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 01/02/2014 09:25 AM, Father Chrysostomos via RT wrote:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; Thank you.  I have updated perl.git’s sprout/version branch.  I await
&gt; &gt; a green light from you before merging it to blead.
</div>&gt; 
&gt; I think that if you have verified my assertion that all tests pass,
&gt; then
&gt; you can go ahead and merge it to blead.  I haven&#39;t had time to run
&gt; regression tests on all of my edge-case Perl&#39;s, and there are probably
&gt; going to be Makefile.PL and test changes to get it working all the way
&gt; back to 5.005_06 &#40;pure Perl only&#41;, but the XS bits appear to be much
&gt; improved.  I can always submit patches for those bits when I do the
&gt; official CPAN release.
</div>
Wait! One more thing:

My changes broke C89 builds.  Karl Williamson fixed it in 39ced5adb3 by patching vxs.inc directly in the perl core.  I have attached it here.  Please include this, so that things stay in synch.

I am about to apply the patch you just sent to p5p.  Hopefully these are the last two things....
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Move code to after declarations.text</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 39ced5adb3b09f93e0263d0f679de4cb6d7c2dc9 Mon Sep 17 00:00:00 2001
From: Karl Williamson &lt;public@khwilliamson.com&gt;
Date: Sat, 4 Jan 2014 10:43:22 -0700
Subject: [PATCH] vxs.inc: Move code to after declarations

This macro, added in e1c774b6, is actual code, and needs to be
after the declarations, so that C89 compilers compile it.

diff --git a/vxs.inc b/vxs.inc
index e297c38..2e4f409 100644
--- a/vxs.inc
+++ b/vxs.inc
@@ -171,12 +171,13 @@ VXS&#40;version_new&#41;
 {
     dVAR;
     dXSARGS;
-    PERL_UNUSED_VAR&#40;cv&#41;;
     SV *vs = items ? ST&#40;1&#41; : &#38;PL_sv_undef;
     SV *rv;
     const char * classname = &#34;&#34;;
     STRLEN len;
     U32 flags = 0;
+    PERL_UNUSED_VAR&#40;cv&#41;;
+
     SP -= items;
 
     if &#40;items &gt; 3 || items == 0&#41;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;04&nbsp;15:57:23&nbsp;2014</span>
    <span class="description">BULKDD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Dec 25 22:06:23 2013, john.peacock@havurah-software.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m going to also post something to p5p, because I wound up making
&gt; version::vpp a completely standalone module and I want that to be
&gt; included in the core as well.  I did that so I could deprecate the XS
&gt; code for all Perl releases prior to 5.10.0.
&gt; 
&gt; John
</div>
Why is the XS code being deprecated for older Perls?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;04&nbsp;16:02:14&nbsp;2014</span>
    <span class="description">john.peacock [...] havurah-software.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #88458] Put version.pm-specific code in its own file in the perl core</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 04 Jan 2014 16:02:01 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-version [...] rt.cpan.org, undisclosed-recipients:;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Peacock &lt;john.peacock [...] havurah-software.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 01/04/2014 03:57 PM, Daniel Dragan via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Why is the XS code being deprecated for older Perls?
&gt;
</div>
Because supporting all of those older Perl&#39;s has made the XS code hard 
to maintain.  Now I don&#39;t need to have a crazy #ifdef maze &#40;and custom 
ppperl.h code as well&#41;.  The pure Perl code is feature-equivalent, 
albeit somewhat slower.

John
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;04&nbsp;18:00:08&nbsp;2014</span>
    <span class="description">BULKDD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Oct 22 14:20:38 2013, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Oct 14 09:31:15 2013, SPROUT wrote:
<div class="message-stanza open">&gt; &gt; Sorry I’ve not been able to finish this up.  Other things in real life
&gt; &gt; have been getting in the way, and will continue for some time.
&gt; &gt; 
&gt; &gt; However, I suspect that the ‘const struct xsub_details details[]’ in
&gt; &gt; vxs.xs needs to be made static, and possibly renamed to vdetails to
&gt; &gt; avoid conflicting with the one in the perl core.  &#40;And then that one
&gt; &gt; should also be made static; it probably should have been to begin
&gt; &gt; with.&#41;  Does that work?
</div>&gt; 
&gt; Attached is a patch to make it static.  Does it work for you?
&gt; 
&gt; Sorry, no progress on the bitbucket front yet.
</div>
Why does the version::vxs class exist? and why are there glob aliasing in version.pm, the first instance of it I tracked down to <span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/jpeacock/version/commits/32b1c7454fd278b68d969d66c52847b16ca9bb04#chg-lib/version.pm">https://bitbucket.org/jpeacock/version/commits/32b1c7454fd278b68d969d66c52847b16ca9bb04#chg-lib/version.pm</a></span> but there is no comment supporting why @ISA wont work. About <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=14417">https://rt.cpan.org/Ticket/Display.html?id=14417</a></span> , yes, Window&#39;s DLL loader matches by dll file name, directory excluded, to last DLL loaded with same name, but only if just a file name is passed to LoadLibrary or you are importing through import table &#40;an absolute path in import table importing is never done&#41;, Perl&#39;s Dynaloader uses an absolute path, atleast since 5.6.2
------------------------------------
  3555:         hModule = LoadLibraryExA&#40;PerlDir_mapA&#40;filename&#41;, NULL, LOAD_WITH_ALTERED_SEARCH_PATH&#41;;
------------------------------------
+       filename        0x0140f814 &#34;C:\p56\5.6.2\lib\MSWin32-x86\auto\Socket\Socket.dll&#34;        const char *
------------------------------------

the other version.dll on windows is &#34;C:\WINDOWS\system32\version.dll&#34; which contains an API for querying and manipulating version metadata from PE files.

Why doesn&#39;t the XS version just newXS&#40;&#41; under version:: directly?

Next, in <span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/jpeacock/version/commits/e42f0b6eee814521c70790d54006e6b30104bccd">https://bitbucket.org/jpeacock/version/commits/e42f0b6eee814521c70790d54006e6b30104bccd</a></span> AKA <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Attachment/1261703/668027/open_AiGkwWYI.txt">https://rt.cpan.org/Ticket/Attachment/1261703/668027/open_AiGkwWYI.txt</a></span> FC create VTYPECHECK macro, but that created a multiple eval problem due to ST&#40;&#41; &#40;arg val to VTYPECHECK&#41; macro being recalculated over and over between function calls instead of saving the SV* to a auto.

I&#39;ll probably add more problem as I continue to understand what happened to version in blead since it wasn&#39;t just splitting core version out into a easily replaceable file but other refactoring too all mixed together.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;04&nbsp;18:26:40&nbsp;2014</span>
    <span class="description">john.peacock [...] havurah-software.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #88458] Put version.pm-specific code in its own file in the perl core</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 04 Jan 2014 18:26:29 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-version [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Peacock &lt;john.peacock [...] havurah-software.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 01/04/2014 06:00 PM, Daniel Dragan via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Why does the version::vxs class exist? and why are there glob
&gt; aliasing in version.pm,
</div>
The version::vxs class exists as the implementation class for version on 
CPAN only; under Perl, the layers of macros that Sprout created cause 
that to vanish and there is only version:: class.  It exists as  an 
independent class on CPAN because it has to be able to be pluggable in 
the case where the pure Perl version::vpp replaces it.  If you look at 
the way that the CPAN version.pm works, you will see that there is a 
clear parallel for each of the implementation classes.  It also exists 
as an independent class because the CPAN release has to replace the core 
code with functions of different names with different implementations, 
but intercept the calls by replacing the global symbols.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; the first instance of it I tracked down to
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/jpeacock/version/commits/32b1c7454fd278b68d969d66c52847b16ca9bb04#chg-lib/version.pm">https://bitbucket.org/jpeacock/version/commits/32b1c7454fd278b68d969d66c52847b16ca9bb04#chg-lib/version.pm</a></span>
&gt; but there is no comment supporting why @ISA wont work. About
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=14417">https://rt.cpan.org/Ticket/Display.html?id=14417</a></span> , yes, Window&#39;s DLL
&gt; loader matches by dll file name, directory excluded, to last DLL
&gt; loaded with same name, but only if just a file name is passed to
&gt; LoadLibrary or you are importing through import table &#40;an absolute
&gt; path in import table importing is never done&#41;, Perl&#39;s Dynaloader uses
&gt; an absolute path, atleast since 5.6.2
</div>
I&#39;m not following any of this, however.  Is there a problem on Windows
and if so, can you open a different ticket with details?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ll probably add more problem as I continue to understand what
&gt; happened to version in blead since it wasn&#39;t just splitting core
&gt; version out into a easily replaceable file but other refactoring too
&gt; all mixed together.
</div>
Actually, there was remarkably little refactoring involved.  All of the
code in vutil.c used to be copied virtually verbatim to util.c.  All of
the code in vxs.inc started life as dynamically generated code from
vxs.xs that was plopped into universal.c.  Over time that generated code
drifted as changes were made in core, which is why Sprout undertook the
effort to split the code out.  Now there is a clear &#34;upstream&#34; and a way 
for me to easily port changes made in the core back to the CPAN release.

I can start removing the maze of #ifdef&#39;s in vutil.h, since I no
longer need to support any Perl prior to v5.10.0.  The XS code in 
vxs.inc that supports the version:: class itself can be rewritten as 
proper XS code, instead of the horrible mixture of generated and 
manually tweaked code.

John
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;04&nbsp;19:44:00&nbsp;2014</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Jan 04 18:26:40 2014, john.peacock@havurah-software.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I can start removing the maze of #ifdef&#39;s in vutil.h, since I no
&gt;  longer need to support any Perl prior to v5.10.0.  The XS code in
&gt;  vxs.inc that supports the version:: class itself can be rewritten as
&gt;  proper XS code, instead of the horrible mixture of generated and
&gt; manually tweaked code.
</div>
I am not sure about that last bit.  What universal.c #includes needs to
be written in C, not XS.  Were you thinking of some other way of
bootstrapping it?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;04&nbsp;19:56:27&nbsp;2014</span>
    <span class="description">john.peacock [...] havurah-software.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #88458] Put version.pm-specific code in its own file in the perl core</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 04 Jan 2014 19:56:18 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-version [...] rt.cpan.org, undisclosed-recipients:;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Peacock &lt;john.peacock [...] havurah-software.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 01/04/2014 07:44 PM, Father Chrysostomos via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I am not sure about that last bit.  What universal.c #includes needs to
&gt; be written in C, not XS.  Were you thinking of some other way of
&gt; bootstrapping it?
</div>
No, I meant rewritten as proper C, not as XS =&gt; C....

John
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;04&nbsp;20:53:05&nbsp;2014</span>
    <span class="description">BULKDD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Jan 04 18:26:40 2014, john.peacock@havurah-software.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 01/04/2014 06:00 PM, Daniel Dragan via RT wrote:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; Why does the version::vxs class exist? and why are there glob
&gt; &gt; aliasing in version.pm,
</div>&gt; 
&gt; The version::vxs class exists as the implementation class for version
&gt; on
&gt; CPAN only; under Perl, the layers of macros that Sprout created cause
&gt; that to vanish and there is only version:: class.  It exists as  an
&gt; independent class on CPAN because it has to be able to be pluggable in
&gt; the case where the pure Perl version::vpp replaces it.
</div>
So version::vxs is glob aliased to version::vpp if XS code couldn&#39;t be loaded? I didn&#39;t notice any code that did that. I know version:: is aliased to version::vpp or version::vxs, but don&#39;t see version::vpp or version::vxs being aliased to each other.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  If you look at
&gt; the way that the CPAN version.pm works, you will see that there is a
&gt; clear parallel for each of the implementation classes.  It also exists
&gt; as an independent class because the CPAN release has to replace the
&gt; core
&gt; code with functions of different names with different implementations,
&gt; but intercept the calls by replacing the global symbols.
&gt; 
</div>
You didn&#39;t answer why not overwrite the version:: directly from vpp.pm or vxs.inc? Its an extra stash HV and extra GVs for little gain of an API that isn&#39;t public. IIRC you mentioned somewhere you want to ship VPP as a separate CPAN distro.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; the first instance of it I tracked down to
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/jpeacock/version/commits/32b1c7454fd278b68d969d66c52847b16ca9bb04#chg-">https://bitbucket.org/jpeacock/version/commits/32b1c7454fd278b68d969d66c52847b16ca9bb04#chg-</a></span>
&gt; &gt; lib/version.pm
&gt; &gt; but there is no comment supporting why @ISA wont work. About
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=14417">https://rt.cpan.org/Ticket/Display.html?id=14417</a></span> , yes, Window&#39;s DLL
&gt; &gt; loader matches by dll file name, directory excluded, to last DLL
&gt; &gt; loaded with same name, but only if just a file name is passed to
&gt; &gt; LoadLibrary or you are importing through import table &#40;an absolute
&gt; &gt; path in import table importing is never done&#41;, Perl&#39;s Dynaloader uses
&gt; &gt; an absolute path, atleast since 5.6.2
</div>&gt; 
&gt; I&#39;m not following any of this, however.  Is there a problem on Windows
&gt; and if so, can you open a different ticket with details?
</div>
There is no problem, just bad design, there just isn&#39;t a reason for version::vxs class to exist, &#34;MODULE = version::vxs  PACKAGE = version&#34; would have fixed the problem. A different solution, I haven&#39;t tested &#40;I&#39;d try to reproduce the problem described in the ticket first&#41;, less efficient, is to require&#40;&#41; Win32:: inside version.pm before calling XSLoader or DynaLoader so MS&#39;s version.dll is loaded first and becomes the primary version.dll seen when an import of &#34;version.dll&#34; needs to be resolved after version&#39;s XS DLL loaded. For details, see  <span class="clickylink"><a target="new" rel="nofollow" href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms684179%28v=vs.85%29.aspx">http://msdn.microsoft.com/en-us/library/windows/desktop/ms684179%28v=vs.85%29.aspx</a></span> and start reading at Parameters -&gt; lpFileName [in] -&gt; Paragraph 4 &#40;&#34;If the string specifies a fully qualified path,&#34;&#41;.

The complaint in #14417 is the following scenario. foo.dll is a non-Perl dll, which import table links to string &#34;version.dll&#34;. foo.dll wont load if version.dll the XS dll is first dll with a file name of &#34;version.dll&#34; loaded into the process because version.dll the XS dll doesn&#39;t export the same functions as MS&#39;s version.dll which are &#40;dumped from WinXP SP3&#41;
----------------------------
          1    0 00001A40 GetFileVersionInfoA
          2    1 000019EF GetFileVersionInfoSizeA
          3    2 0000138C GetFileVersionInfoSizeW
          4    3 0000166F GetFileVersionInfoW
          5    4 000024CD VerFindFileA
          6    5 000033A8 VerFindFileW
          7    6 000026F7 VerInstallFileA
          8    7 00003756 VerInstallFileW
          9    8          VerLanguageNameA &#40;forwarded to KERNEL32.VerLanguageNam
eA&#41;
         10    9          VerLanguageNameW &#40;forwarded to KERNEL32.VerLanguageNam
eW&#41;
         11    A 000018AA VerQueryValueA
         12    B 00002958 VerQueryValueIndexA
         13    C 0000297F VerQueryValueIndexW
         14    D 00001805 VerQueryValueW
----------------------------
none of the above will be found in the import table of version.dll the XS dll so foo.dll won&#39;t load.

3rd solution, much more complicated solution is for version.dll the XS dll to have Win32 specific code to export all those MS subs, with the body of each function being a stub that calls a C non-const static function pointer, which was filled in DllMain &#40;called unsafe by MS&#41; or in BOOT:. The function pointers were GetProcAddr&#39;ed from a &#34;%windir%\System32\version.dll&#34; &#40;an absolute path&#41; so they are from the correct, MS, version.dll. When a non-Perl DLL imports &#34;version.dll&#34;, they get func * to XS version.dll, whose function calls the MS version.dll. I&#39;m not sure if version.dll got additional functions between Win2K, WinXP, and Win7. The choice what to do for unimplented MS version.dll funcs can be SEGV with NULL, or C std lib process exit, or rewriting the in-memory copy of the export table of XS version.dll.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; I&#39;ll probably add more problem as I continue to understand what
&gt; &gt; happened to version in blead since it wasn&#39;t just splitting core
&gt; &gt; version out into a easily replaceable file but other refactoring too
&gt; &gt; all mixed together.
</div>&gt; 
&gt; Actually, there was remarkably little refactoring involved.  
</div>
Nearly every line in xsub version_new was changed between pre-split blead version and the final merge blead.
---------------------------------------------------------------
@@ -118,55 +167,75 @@ XS&#40;XS_UNIVERSAL_VERSION&#41;
     XSRETURN&#40;1&#41;;
 }
 
-XS&#40;XS_version_new&#41;
+VXS&#40;version_new&#41;
 {
     dVAR;
     dXSARGS;
-    if &#40;items &gt; 3 || items &lt; 1&#41;
-       croak_xs_usage&#40;cv, &#34;class, version&#34;&#41;;
+    PERL_UNUSED_VAR&#40;cv&#41;;
+    SV *vs = items ? ST&#40;1&#41; : &#38;PL_sv_undef;
+    SV *rv;
+    const char * classname = &#34;&#34;;
+    STRLEN len;
+    U32 flags = 0;
     SP -= items;
-    {
-        SV *vs = ST&#40;1&#41;;
-       SV *rv;
-        STRLEN len;
-        const char *classname;
-        U32 flags;
-
-       /* Just in case this is something like a tied hash */
-       SvGETMAGIC&#40;vs&#41;;
-
-        if &#40; sv_isobject&#40;ST&#40;0&#41;&#41; &#41; { /* get the class if called as an object method */
-            const HV * stash = SvSTASH&#40;SvRV&#40;ST&#40;0&#41;&#41;&#41;;
-            classname = HvNAME&#40;stash&#41;;
-            len       = HvNAMELEN&#40;stash&#41;;
-            flags     = HvNAMEUTF8&#40;stash&#41; ? SVf_UTF8 : 0;
-        }
-        else {
-           classname = SvPV&#40;ST&#40;0&#41;, len&#41;;
-            flags     = SvUTF8&#40;ST&#40;0&#41;&#41;;
-        }
 
-       if &#40; items == 1 || ! SvOK&#40;vs&#41; &#41; { /* no param or explicit undef */
-           /* create empty object */
-           vs = sv_newmortal&#40;&#41;;
-           sv_setpvs&#40;vs, &#34;0&#34;&#41;;
-       }
-       else if &#40; items == 3 &#41; {
-           vs = sv_newmortal&#40;&#41;;
-           Perl_sv_setpvf&#40;aTHX_ vs,&#34;v%s&#34;,SvPV_nolen_const&#40;ST&#40;2&#41;&#41;&#41;;
-       }
+    if &#40;items &gt; 3 || items == 0&#41;
+        Perl_croak&#40;aTHX_ &#34;Usage: version::new&#40;class, version&#41;&#34;&#41;;
 
-       rv = new_version&#40;vs&#41;;
-       if &#40; strnNE&#40;classname,&#34;version&#34;, len&#41; &#41; /* inherited new&#40;&#41; */
-           sv_bless&#40;rv, gv_stashpvn&#40;classname, len, GV_ADD | flags&#41;&#41;;
+    /* Just in case this is something like a tied hash */
+    SvGETMAGIC&#40;vs&#41;;
 
-       mPUSHs&#40;rv&#41;;
-       PUTBACK;
-       return;
+    if &#40; items == 1 || ! SvOK&#40;vs&#41; &#41; { /* no param or explicit undef */
+        /* create empty object */
+        vs = sv_newmortal&#40;&#41;;
+        sv_setpvs&#40;vs,&#34;undef&#34;&#41;;
+    }
+    else if &#40;items == 3 &#41; {
+        vs = sv_newmortal&#40;&#41;;
+#if PERL_VERSION == 5
+        sv_setpvf&#40;vs,&#34;v%s&#34;,SvPV_nolen_const&#40;ST&#40;2&#41;&#41;&#41;;
+#else
+        Perl_sv_setpvf&#40;aTHX_ vs,&#34;v%s&#34;,SvPV_nolen_const&#40;ST&#40;2&#41;&#41;&#41;;
+#endif
+    }
+    if &#40; sv_isobject&#40;ST&#40;0&#41;&#41; &#41; {
+       /* get the class if called as an object method */
+       const HV * stash = SvSTASH&#40;SvRV&#40;ST&#40;0&#41;&#41;&#41;;
+       classname = HvNAME_get&#40;stash&#41;;
+       len       = HvNAMELEN_get&#40;stash&#41;;
+#ifdef HvNAMEUTF8
+       flags     = HvNAMEUTF8&#40;stash&#41; ? SVf_UTF8 : 0;
+#endif
+    }
+    else {
+       classname = SvPV&#40;ST&#40;0&#41;, len&#41;;
+       flags     = SvUTF8&#40;ST&#40;0&#41;&#41;;
     }
+
+    rv = NEW_VERSION&#40;vs&#41;;
+    if &#40; len != sizeof&#40;VXS_CLASS&#41;-1
+      || strcmp&#40;classname,VXS_CLASS&#41; != 0 &#41; /* inherited new&#40;&#41; */
+#if PERL_VERSION == 5
+        sv_bless&#40;rv, gv_stashpv&#40;&#40;char *&#41;classname, GV_ADD&#41;&#41;;
+#else
+        sv_bless&#40;rv, gv_stashpvn&#40;classname, len, GV_ADD | flags&#41;&#41;;
+#endif
+
+    mPUSHs&#40;rv&#41;;
+    PUTBACK;
+    return;
 }
----------------------------------------------------------------

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; All of
&gt; the
&gt; code in vutil.c used to be copied virtually verbatim to util.c.  All
&gt; of
&gt; the code in vxs.inc started life as dynamically generated code from
&gt; vxs.xs that was plopped into universal.c.  Over time that generated
&gt; code
&gt; drifted as changes were made in core, which is why Sprout undertook
&gt; the
&gt;  effort to split the code out.  Now there is a clear &#34;upstream&#34; and a
&gt; way
&gt; for me to easily port changes made in the core back to the CPAN
&gt; release.
&gt; 
</div>
This should have been done sooner or a no edit policy to util.c since I&#39;ve gotten commits into blead &#40;and I don&#39;t have a commit bit&#41; for version:: in util.c with no objections rather than it being copy paste from CPAN version::. Good it is finally done.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I can start removing the maze of #ifdef&#39;s in vutil.h, since I no
&gt;  longer need to support any Perl prior to v5.10.0.  
</div>
I personally don&#39;t find much difficulty supporting 5.6 and 5.8 with XS. If ppport.h doesn&#39;t have it, I cpan grep for the equivalent or copy it out of p5p core from when it was first introduced into blead.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The XS code in
&gt;  vxs.inc that supports the version:: class itself can be rewritten as
&gt;  proper XS code, instead of the horrible mixture of generated and
&gt; manually tweaked code.
</div>
If that is done, miniperl during the build process won&#39;t have any version:: to use since xsubpp won&#39;t work until it is Makefile.PL&#39;ed and make all&#39;ed by miniperl. hand written XS is more efficient than what xsubpp produces anyway.

Next issue, <span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/jpeacock/version/src/9f49d95d787c38ad5b6fcdab71f1ce7c95a1b3d3/vutil/vxs.inc?at=default#cl-158">https://bitbucket.org/jpeacock/version/src/9f49d95d787c38ad5b6fcdab71f1ce7c95a1b3d3/vutil/vxs.inc?at=default#cl-158</a></span>

Why does var ret exist?

added in <span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/jpeacock/version/commits/2a7768a85f8bd94e5a0648db79ac086fd51e4541">https://bitbucket.org/jpeacock/version/commits/2a7768a85f8bd94e5a0648db79ac086fd51e4541</a></span> seems to be obsolete in <span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/jpeacock/version/commits/d5c1282dfe131324776ad64f8a3fa2696d997dd1">https://bitbucket.org/jpeacock/version/commits/d5c1282dfe131324776ad64f8a3fa2696d997dd1</a></span> 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;04&nbsp;21:15:19&nbsp;2014</span>
    <span class="description">BULKDD [...] cpan.org -  Cc BULKDD added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;04&nbsp;22:17:44&nbsp;2014</span>
    <span class="description">john.peacock [...] havurah-software.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #88458] Put version.pm-specific code in its own file in the perl core</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 04 Jan 2014 22:17:33 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-version [...] rt.cpan.org, undisclosed-recipients:;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Peacock &lt;john.peacock [...] havurah-software.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 01/04/2014 08:53 PM, Daniel Dragan via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So version::vxs is glob aliased to version::vpp if XS code couldn&#39;t
&gt; be loaded? I didn&#39;t notice any code that did that. I know version::
&gt; is aliased to version::vpp or version::vxs, but don&#39;t see
&gt; version::vpp or version::vxs being aliased to each other.
</div>
I think we are talking past each other here.  version:vxs and 
version:vpp provide the same interface and version:: methods are aliased 
to the appropriate implementation class at load time.  It was much 
simpler to maintain that parallel construction for consistency then it 
was to have version:vxs export methods directly into the version:: 
namespace.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; You didn&#39;t answer why not overwrite the version:: directly from
&gt; vpp.pm or vxs.inc? Its an extra stash HV and extra GVs for little
&gt; gain of an API that isn&#39;t public. IIRC you mentioned somewhere you
&gt; want to ship VPP as a separate CPAN distro.
</div>
No, I&#39;m just saying version:vpp is now installed even if the version:vxs 
code is installed too.  It won&#39;t ever be an independent module.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt;
&gt;&gt; Actually, there was remarkably little refactoring involved.
</div></div>
I meant from the point of view of the CPAN release, which has always 
been considered the &#34;upstream&#34;.  What was in the core had drifted away 
from the CPAN release and this effort was to make that not happen any 
longer.  Any improvements that need to be made will happen in the CPAN 
release first, then go into core &#40;in the ideal case&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Why does var ret exist?
&gt;
&gt; added in
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/jpeacock/version/commits/2a7768a85f8bd94e5a0648db79ac086fd51e4541">https://bitbucket.org/jpeacock/version/commits/2a7768a85f8bd94e5a0648db79ac086fd51e4541</a></span>
&gt; seems to be obsolete in
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/jpeacock/version/commits/d5c1282dfe131324776ad64f8a3fa2696d997dd1">https://bitbucket.org/jpeacock/version/commits/d5c1282dfe131324776ad64f8a3fa2696d997dd1</a></span>
&gt;
</div>
That is an actual bug; there was an extensive discussion about what 
UNIVERSAL::VERSION should return and several patches went back and forth 
&#40;I won&#39;t find the thread, since the discussion was concluded 
successfully &#41;.  It appears that the patch to remove &#34;ret&#34; wasn&#39;t 
applied correctly to the CPAN code, so it snuck back in during the 
reconciliation.  I am going to open a new bug ticket on CPAN&#39;s RT to fix 
it there.

John
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;04&nbsp;22:18:42&nbsp;2014</span>
    <span class="description">BULKDD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">About
-------------------------------------------
SV * Perl_new_version2&#40;pTHX_ SV *ver&#41;;
SV * Perl_upg_version2&#40;pTHX_ SV *sv, bool qv&#41;;
SV * Perl_vstringify2&#40;pTHX_ SV *vs&#41;;
SV * Perl_vverify2&#40;pTHX_ SV *vs&#41;;
SV * Perl_vnumify2&#40;pTHX_ SV *vs&#41;;
SV * Perl_vnormal2&#40;pTHX_ SV *vs&#41;;
SV * Perl_vstringify2&#40;pTHX_ SV *vs&#41;;
int Perl_vcmp2&#40;pTHX_ SV *lsv, SV *rsv&#41;;
const char * Perl_prescan_version2&#40;pTHX_ const char *s, bool strict, const char** errstr, bool *sqv, int *ssaw_decimal, int *swidth, bool *salpha&#41;;
-------------------------------------------
In the current setup, if version is built as core, it winds up in libperl.so/perl5**.dll, with non-&#34;2&#34; functions being exposed to XS code, if version is built as CPAN, the &#34;2&#34; functions show up, and all XS code still calls the &#34;old&#34; version functions. Considered a vtable &#40;on Win32&#41; or extern&#39;ing them and LD_PRELOAD hooking on *nix so if you upgrade your version:: from cpan, XSUBs also call the new version:: in the process? What about a lazy XS loader that requires the full version binary at the first time it is used &#40; Win32:: used to be compiled core, like universal::, it was later moved to CPAN, with a lazy loader at <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.git.perl.org/perl.git/blob/HEAD:/ext/Win32CORE/Win32CORE.c">http://perl5.git.perl.org/perl.git/blob/HEAD:/ext/Win32CORE/Win32CORE.c</a></span> &#41;?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;04&nbsp;23:41:13&nbsp;2014</span>
    <span class="description">BULKDD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Jan 04 18:00:08 2014, BULKDD wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Next, in
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/jpeacock/version/commits/e42f0b6eee814521c70790d54006e6b30104bccd">https://bitbucket.org/jpeacock/version/commits/e42f0b6eee814521c70790d54006e6b30104bccd</a></span>
&gt; AKA
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Attachment/1261703/668027/open_AiGkwWYI.txt">https://rt.cpan.org/Ticket/Attachment/1261703/668027/open_AiGkwWYI.txt</a></span>
&gt; FC create VTYPECHECK macro, but that created a multiple eval problem
&gt; due to ST&#40;&#41; &#40;arg val to VTYPECHECK&#41; macro being recalculated over and
&gt; over between function calls instead of saving the SV* to a auto.
</div>
Related problem, <span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/jpeacock/version/src/9f49d95d787c38ad5b6fcdab71f1ce7c95a1b3d3/vutil/vutil.h?at=default#cl-86">https://bitbucket.org/jpeacock/version/src/9f49d95d787c38ad5b6fcdab71f1ce7c95a1b3d3/vutil/vutil.h?at=default#cl-86</a></span> &#34;#define ISA_CLASS_OBJ&#40;v,c&#41; &#40;sv_isobject&#40;v&#41; &#38;&#38; sv_derived_from&#40;v,c&#41;&#41;&#34; does an unnecessary strlen, use sv_derived_from_pvn.

<span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/jpeacock/version/src/9f49d95d787c38ad5b6fcdab71f1ce7c95a1b3d3/vutil/vutil.c?at=default#cl-487">https://bitbucket.org/jpeacock/version/src/9f49d95d787c38ad5b6fcdab71f1ce7c95a1b3d3/vutil/vutil.c?at=default#cl-487</a></span> keys &#34;width&#34; and &#34;original&#34; are redundantly fetched twice from the old version hv/sv in new_version.

<span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/jpeacock/version/src/9f49d95d787c38ad5b6fcdab71f1ce7c95a1b3d3/vutil/vutil.c?at=default#cl-503">https://bitbucket.org/jpeacock/version/src/9f49d95d787c38ad5b6fcdab71f1ce7c95a1b3d3/vutil/vutil.c?at=default#cl-503</a></span>
&#34;const I32 rev = SvIV&#40;*av_fetch&#40;sav, key, FALSE&#41;&#41;;&#34; av_fetch is called 3 times in this macro.

<span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/jpeacock/version/src/9f49d95d787c38ad5b6fcdab71f1ce7c95a1b3d3/vutil/vutil.c?at=default#cl-515">https://bitbucket.org/jpeacock/version/src/9f49d95d787c38ad5b6fcdab71f1ce7c95a1b3d3/vutil/vutil.c?at=default#cl-515</a></span>

-----------------------------------------------
            char * const version = savepvn&#40; &#40;const char*&#41;mg-&gt;mg_ptr, len&#41;;
            sv_setpvn&#40;rv,version,len&#41;;
            /* this is for consistency with the pure Perl class */
            if &#40; isDIGIT&#40;*version&#41; &#41;
                sv_insert&#40;rv, 0, 0, &#34;v&#34;, 1&#41;;
            Safefree&#40;version&#41;;
----------------------------------
Why was savepvn called? remove savepvn or use sv_usepvn_flags.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;05&nbsp;10:31:57&nbsp;2014</span>
    <span class="description">john.peacock [...] havurah-software.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #88458] Put version.pm-specific code in its own file in the perl core</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 05 Jan 2014 10:31:47 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-version [...] rt.cpan.org, undisclosed-recipients:;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Peacock &lt;john.peacock [...] havurah-software.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 01/04/2014 11:41 PM, Daniel Dragan via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Related problem,
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/jpeacock/version/src/9f49d95d787c38ad5b6fcdab71f1ce7c95a1b3d3/vutil/vutil.h?at=default#cl-86">https://bitbucket.org/jpeacock/version/src/9f49d95d787c38ad5b6fcdab71f1ce7c95a1b3d3/vutil/vutil.h?at=default#cl-86</a></span>
&gt; &#34;#define ISA_CLASS_OBJ&#40;v,c&#41; &#40;sv_isobject&#40;v&#41; &#38;&#38; sv_derived_from&#40;v,c&#41;&#41;&#34;
&gt; does an unnecessary strlen, use sv_derived_from_pvn.
</div>
That function is not documented in perlapi, so I was unaware of its 
existence.  DONE.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/jpeacock/version/src/9f49d95d787c38ad5b6fcdab71f1ce7c95a1b3d3/vutil/vutil.c?at=default#cl-487">https://bitbucket.org/jpeacock/version/src/9f49d95d787c38ad5b6fcdab71f1ce7c95a1b3d3/vutil/vutil.c?at=default#cl-487</a></span>
&gt; keys &#34;width&#34; and &#34;original&#34; are redundantly fetched twice from the
&gt; old version hv/sv in new_version.
</div>
In both cases, the first call is hv_exists and the second is hv_fetch. 
Are you suggesting I go straight to fetch &#40;into a temporary&#41;, then add 
to the new version?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/jpeacock/version/src/9f49d95d787c38ad5b6fcdab71f1ce7c95a1b3d3/vutil/vutil.c?at=default#cl-503">https://bitbucket.org/jpeacock/version/src/9f49d95d787c38ad5b6fcdab71f1ce7c95a1b3d3/vutil/vutil.c?at=default#cl-503</a></span>
&gt;
&gt;&#34;const I32 rev = SvIV&#40;*av_fetch&#40;sav, key, FALSE&#41;&#41;;&#34; av_fetch is called 3 
</div>times in this macro.

And?  I don&#39;t see anything in perlapi about copying an av so I have to 
iterate over every element and push it to the new copy.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/jpeacock/version/src/9f49d95d787c38ad5b6fcdab71f1ce7c95a1b3d3/vutil/vutil.c?at=default#cl-515">https://bitbucket.org/jpeacock/version/src/9f49d95d787c38ad5b6fcdab71f1ce7c95a1b3d3/vutil/vutil.c?at=default#cl-515</a></span>
&gt;
&gt;  ----------------------------------------------- char * const version
&gt; = savepvn&#40; &#40;const char*&#41;mg-&gt;mg_ptr, len&#41;; sv_setpvn&#40;rv,version,len&#41;;
&gt; /* this is for consistency with the pure Perl class */ if &#40;
&gt; isDIGIT&#40;*version&#41; &#41; sv_insert&#40;rv, 0, 0, &#34;v&#34;, 1&#41;; Safefree&#40;version&#41;;
&gt; ---------------------------------- Why was savepvn called? remove
&gt; savepvn or use sv_usepvn_flags.
&gt;
</div>
I&#39;m not clear what you are advocating here.  I need to be able to 
reference the original v-string twice: once to copy it into rv and once 
to potentially insert a leading &#39;v&#39; &#40;for consistency in the later 
parse&#41;.  Is sv_usepvn_flags&#40;&#41; that much faster for this usecase &#40;only 
bare v-strings&#41;?

John
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;05&nbsp;11:13:19&nbsp;2014</span>
    <span class="description">john.peacock [...] havurah-software.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #88458] Put version.pm-specific code in its own file in the perl core</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 05 Jan 2014 11:13:10 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-version [...] rt.cpan.org, undisclosed-recipients:;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Peacock &lt;john.peacock [...] havurah-software.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 01/04/2014 10:18 PM, Daniel Dragan via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; libperl.so/perl5**.dll, with non-&#34;2&#34; functions being exposed to XS
&gt; code, if version is built as CPAN, the &#34;2&#34; functions show up, and all
&gt; XS code still calls the &#34;old&#34; version functions.
</div>
Not all new code calls the old functions.  The macros in vutil.h:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; #  define SCAN_VERSION&#40;a,b,c&#41;   Perl_scan_version2&#40;aTHX_ a,b,c&#41;
&gt; #  define NEW_VERSION&#40;a&#41;        Perl_new_version2&#40;aTHX_ a&#41;
&gt; #  define UPG_VERSION&#40;a,b&#41;      Perl_upg_version2&#40;aTHX_ a, b&#41;
&gt; #  define VSTRINGIFY&#40;a&#41;         Perl_vstringify2&#40;aTHX_ a&#41;
&gt; #  define VVERIFY&#40;a&#41;            Perl_vverify2&#40;aTHX_ a&#41;
&gt; #  define VNUMIFY&#40;a&#41;            Perl_vnumify2&#40;aTHX_ a&#41;
&gt; #  define VNORMAL&#40;a&#41;            Perl_vnormal2&#40;aTHX_ a&#41;
&gt; #  define VCMP&#40;a,b&#41;             Perl_vcmp2&#40;aTHX_ a,b&#41;
&gt; #  define PRESCAN_VERSION&#40;a,b,c,d,e,f,g&#41; Perl_prescan_version2&#40;aTHX_ a,b,c,d,e,f,g&#41;
</div>
ensure that the replacement functions are called.  NOTE that not all 
replacement functions are required to be called, however.  The only 
functions that MUST be replaced in the XS code are:

   NEW_VERSION
   UPG_VERSION

and the C code from vutil.c additionally calls the replacements:

   UPG_VERSION
   PRESCAN_VERSION
   SCAN_VERSION

All of the other replacement methods have not changed &#40;yet&#41; and so the 
core code can be called freely and is completely equivalent to the CPAN 
release.

For clarity&#39;s sake, I supposed could go through and make all of the 
calls in vutil.c use the macros so that the &#34;*2&#34; functions would always 
be called by the CPAN code.  That wasn&#39;t practical until the codebases 
were unified.

John
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;05&nbsp;11:18:28&nbsp;2014</span>
    <span class="description">john.peacock [...] havurah-software.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #88458] Put version.pm-specific code in its own file in the perl core</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 05 Jan 2014 11:18:19 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-version [...] rt.cpan.org, undisclosed-recipients:;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Peacock &lt;john.peacock [...] havurah-software.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 01/05/2014 11:13 AM, John Peacock via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ensure that the replacement functions are called.  NOTE that not all
&gt; replacement functions are required to be called, however.  The only
&gt; functions that MUST be replaced in the XS code are:
&gt;
&gt;     NEW_VERSION
&gt;     UPG_VERSION
</div>
Ignore that; all the XS methods call the macro forms for all functions. 
  That should teach me not to answer from memory instead of reading the 
code.

John
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;05&nbsp;14:24:57&nbsp;2014</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Jan 05 10:31:57 2014, john.peacock@havurah-software.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 01/04/2014 11:41 PM, Daniel Dragan via RT wrote:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/jpeacock/version/src/9f49d95d787c38ad5b6fcdab71f1ce7c95a1b3d3/vutil/vutil.c?at=default#cl-">https://bitbucket.org/jpeacock/version/src/9f49d95d787c38ad5b6fcdab71f1ce7c95a1b3d3/vutil/vutil.c?at=default#cl-</a></span>
&gt; &gt; 503
&gt; &gt;
&gt; &gt; &#34;const I32 rev = SvIV&#40;*av_fetch&#40;sav, key, FALSE&#41;&#41;;&#34; av_fetch is
&gt; &gt; called 3
</div>&gt; times in this macro.
&gt; 
&gt; And?  I don&#39;t see anything in perlapi about copying an av so I have to
&gt; iterate over every element and push it to the new copy.
</div>
SvIV&#40;foo&#40;&#41;&#41; calls foo&#40;&#41; three times.  SvIVx&#40;foo&#40;&#41;&#41; calls it once.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt;
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://bitbucket.org/jpeacock/version/src/9f49d95d787c38ad5b6fcdab71f1ce7c95a1b3d3/vutil/vutil.c?at=default#cl-">https://bitbucket.org/jpeacock/version/src/9f49d95d787c38ad5b6fcdab71f1ce7c95a1b3d3/vutil/vutil.c?at=default#cl-</a></span>
&gt; &gt; 515
&gt; &gt;
&gt; &gt; ----------------------------------------------- char * const version
&gt; &gt; = savepvn&#40; &#40;const char*&#41;mg-&gt;mg_ptr, len&#41;; sv_setpvn&#40;rv,version,len&#41;;
&gt; &gt; /* this is for consistency with the pure Perl class */ if &#40;
&gt; &gt; isDIGIT&#40;*version&#41; &#41; sv_insert&#40;rv, 0, 0, &#34;v&#34;, 1&#41;; Safefree&#40;version&#41;;
&gt; &gt; ---------------------------------- Why was savepvn called? remove
&gt; &gt; savepvn or use sv_usepvn_flags.
&gt; &gt;
</div>&gt; 
&gt; I&#39;m not clear what you are advocating here.  I need to be able to
&gt; reference the original v-string twice: once to copy it into rv and
&gt; once
&gt; to potentially insert a leading &#39;v&#39; &#40;for consistency in the later
&gt; parse&#41;.  Is sv_usepvn_flags&#40;&#41; that much faster for this usecase &#40;only
&gt; bare v-strings&#41;?
</div>
The string buffer gets copied twice the way the code is currently written &#40;once by savepvn, once by sv_setpvn&#41;.  Either passing mg-&gt;mg_ptr directly to sv_setpvn &#40;avoiding savepvn&#41; or using sv_usepvn instead of sv_setpvn + Safefree would cause it to be copied just once.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;06&nbsp;02:19:37&nbsp;2014</span>
    <span class="description">BULKDD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Jan 05 11:13:19 2014, john.peacock@havurah-software.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 01/04/2014 10:18 PM, Daniel Dragan via RT wrote:
<div class="message-stanza open">&gt; &gt; libperl.so/perl5**.dll, with non-&#34;2&#34; functions being exposed to XS
&gt; &gt; code, if version is built as CPAN, the &#34;2&#34; functions show up, and all
&gt; &gt; XS code still calls the &#34;old&#34; version functions.
</div>&gt; 
&gt; Not all new code calls the old functions.  The macros in vutil.h:
</div>
I wasn&#39;t clear. If lets say Socket, the XS module, uses &#34;new_version&#34;, it will always link and use to the libperl.so/perl5**.dll version of new_version. If you load a newer CPAN version:: into the process, the CV version::new&#40;&#41; and CV version::vxs::new&#40;&#41; goes to the new version:: code and to the new C func Perl_new_version2, while the Socket&#39;s &#34;new_version&#34; still goes to the old built in core version:: &#40;AKA C func Perl_new_version&#41; in libperl.so. My proposal is, Socket&#39;s &#34;new_version&#34; being forwarded to Perl_new_version2 when a new CPAN version:: is loaded into the process. Socket is NOT recompiled in this scheme. This scheme probably requires support in p5p&#39;s interp for core&#39;d version:: to have a vtable that CPAN version:: can replace at runtime &#40;use/require time&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;13&nbsp;06:48:48&nbsp;2014</span>
    <span class="description">jpeacock [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixed in 0.9906
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;13&nbsp;06:48:49&nbsp;2014</span>
    <span class="description">jpeacock [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;13&nbsp;06:48:49&nbsp;2014</span>
    <span class="description">jpeacock [...] cpan.org -  Fixed in 0.9906 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
