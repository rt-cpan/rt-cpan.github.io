<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #42051 for Net-SSH-Perl: Net::SSH::Perl w/o Crypt::RSA is subject to infinite recursion w/perl 5.8 or earlier</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #42051 for Net-SSH-Perl: Net::SSH::Perl w/o Crypt::RSA is subject to infinite recursion w/perl 5.8 or earlier</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-SSH-Perl/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-SSH-Perl/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-SSH-Perl/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-SSH-Perl/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-SSH-Perl">Net-SSH-Perl CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">42051</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-SSH-Perl/Active/">Net-SSH-Perl</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jamie [...] audible.transient.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-23272-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.33    </td>
  </tr>
  <tr id="CF-23273-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;30&nbsp;18:54:06&nbsp;2008</span>
    <span class="description">jamie [...] audible.transient.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Net::SSH::Perl w/o Crypt::RSA is subject to infinite recursion
 w/perl 5.8 or earlier</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Net::SSH::Perl is fond of using the eval &#34;use
ModuleWhichMayNotBePresent;&#34; idiom, particularly when it comes to
detecting if RSA support is available or not, but with perl 5.8 and
earlier this idiom can have surprising and unintended consequences.  For
example, consider:

[8]snapdragon&lt;~/show/&gt;ls . A
.:
A  A.pm  t.pl

A:
B.pm
[9]snapdragon&lt;~/show/&gt;cat t.pl 
use A;

eval { A-&gt;x; };

print &#34;First attempt fails with: $@----\n&#34; if &#40;$@&#41;;

A-&gt;x;

[10]snapdragon&lt;~/show/&gt;cat A.pm 
package A;

use strict;
use warnings;

sub x {
    eval &#34;use A::B;&#34;;
    die &#34;eval use of A::B from A::x failed: $@&#34; if &#40;$@&#41;;
    print &#34;eval use of A::B from A::x did not fail\n&#34;;
    A::B-&gt;z;
}

sub z { print &#34;well hello there stranger!\n&#34;; }

1;
[11]snapdragon&lt;~/show/&gt;cat A/B.pm 
package A::B;

use strict;
use warnings;

use A;
use base &#39;A&#39;;
use ClassThatDoesNotExist;

sub z { print &#34;we&#39;ll never get this far\n&#34;; }

1;
[12]snapdragon&lt;~/show/&gt;perl -v

This is perl, v5.8.4 built for i386-linux-thread-multi

Copyright 1987-2004, Larry Wall

Perl may be copied only under the terms of either the Artistic License
or the
GNU General Public License, which may be found in the Perl 5 source kit.

Complete documentation for Perl, including FAQ lists, should be found on
this system using `man perl&#39; or `perldoc perl&#39;.  If you have access to the
Internet, point your browser at <span class="clickylink"><a target="new" rel="nofollow" href="http://www.perl.com/">http://www.perl.com/</a></span>, the Perl Home Page.

[13]snapdragon&lt;~/show/&gt;perl t.pl 
First attempt fails with: eval use of A::B from A::x failed: Can&#39;t
locate ClassThatDoesNotExist.pm in @INC &#40;@INC contains: /etc/perl
/usr/local/lib/perl/5.8.4 /usr/local/share/perl/5.8.4 /usr/lib/perl5
/usr/share/perl5 /usr/lib/perl/5.8 /usr/share/perl/5.8
/usr/local/lib/site_perl .&#41; at A/B.pm line 8.
BEGIN failed--compilation aborted at A/B.pm line 8.
Compilation failed in require at &#40;eval 1&#41; line 1.
BEGIN failed--compilation aborted at &#40;eval 1&#41; line 1.
----
eval use of A::B from A::x did not fail
well hello there stranger!


The second time A::x is called $@ is false, and because of the ordering
of the use base &#39;A&#39;; statement in B.pm, the z subroutine from A.pm is
inherited, but never overridden.  With perl 5.10, the situation has
improved and things don&#39;t get as out of hand:

[287]deadhour&lt;~/show/&gt;perl -v

This is perl, v5.10.0 built for i486-linux-gnu-thread-multi

Copyright 1987-2007, Larry Wall

Perl may be copied only under the terms of either the Artistic License
or the
GNU General Public License, which may be found in the Perl 5 source kit.

Complete documentation for Perl, including FAQ lists, should be found on
this system using &#34;man perl&#34; or &#34;perldoc perl&#34;.  If you have access to the
Internet, point your browser at <span class="clickylink"><a target="new" rel="nofollow" href="http://www.perl.org/">http://www.perl.org/</a></span>, the Perl Home Page.

[288]deadhour&lt;~/show/&gt;perl t.pl 
First attempt fails with: eval use of A::B from A::x failed: Can&#39;t
locate ClassThatDoesNotExist.pm in @INC &#40;@INC contains: /etc/perl
/usr/local/lib/perl/5.10.0 /usr/local/share/perl/5.10.0 /usr/lib/perl5
/usr/share/perl5 /usr/lib/perl/5.10 /usr/share/perl/5.10
/usr/local/lib/site_perl .&#41; at A/B.pm line 8.
BEGIN failed--compilation aborted at A/B.pm line 8.
Compilation failed in require at &#40;eval 1&#41; line 1.
BEGIN failed--compilation aborted at &#40;eval 1&#41; line 1.
----
eval use of A::B from A::x failed: Attempt to reload A/B.pm aborted.
Compilation failed in require at &#40;eval 3&#41; line 1.
BEGIN failed--compilation aborted at &#40;eval 3&#41; line 1.


So, what, you ask, does this have to do with Net::SSH::Perl?  Well, take
a look at Net::SSH::Perl::Key, specifically at the definition of the
read_private subroutine &#40;which happens to be done in a BEGIN block using
a method factory of sorts&#41;.  Now poke around in that module and notice
how many places the eval &#34;use $class;&#34; idiom is present.  Finally, take
a look at the Net::SSH::Perl::Key::RSA class paying special attention to
the order of use statements.  In the RSA class, use base qw&#40;
Net::SSH::Perl::Key &#41;; is placed before use Crypt::RSA; and this has the
unfortunate side-effect of letting the Net::SSH::Perl::Key::RSA inhert
Net::SSH::Perl::Key&#39;s read_private implementation, although the intent
is clearly that it should be overriden latter on...except if Crypt::RSA
isn&#39;t installed, that never happens.  This sets us up for the situation
where Net::SSH::Perl::Key&#39;s read_private is called from
Net::SSH::Perl::Key::RSA, which results in run-away recursion.

For that to happen we have to twice attempt to eval &#34;use
Net::SSH::Perl::Key::RSA;&#34; in a single session when Crypt::RSA hasn&#39;t
been installed, which unfortuately is all too possible to do accidently.
 A user with a RSA identity configured &#40;or both RSA and DSA identities
available&#41;, connecting to a host which attempts a ssh-rsa key exchange
will trigger just a situation.

I don&#39;t really have a suggestion for a better run-time class detection
idiom &#40;except to say it&#39;d probably work better with older perl versions
if the idiom was forced to evaluate once at compile time and have the
runtime logic refer to some global indicator, instead of expecting
repeated evals to do something they&#39;re not going to do&#41;.  At the very
least, in the Net::SSH::Perl::Key::RSA class, it&#39;d be a good idea to
move the &#34;use base qw&#40; Net::SSH::Perl::Key &#41;;&#34; statement until after the
use Crypt::RSA stuff so that if Crypt::RSA isn&#39;t installed, the hunk of
the Net::SSH::Perl::Key::RSA namespace that&#39;s left around doesn&#39;t have
anything nasty lurking in it.  This would defang the infinite recursion
case and instead stick the user with a &#34;Can&#39;t locate object method&#34;
error, which is easier on resource consumption.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
