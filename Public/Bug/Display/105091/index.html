<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #105091 for Sys-SigAction: t/nested.t segfaults on ARM</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #105091 for Sys-SigAction: t/nested.t segfaults on ARM</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Sys-SigAction">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Sys-SigAction">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Sys-SigAction">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Sys-SigAction">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Sys-SigAction">Sys-SigAction CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">105091</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Sys-SigAction">Sys-SigAction</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ppisar [...] redhat.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-30604-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.21    </td>
  </tr>
  <tr id="CF-30605-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




nested.t<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1660240/891193/nested.t">
Sat Aug 20 11:22:39 2016 (3.4k) by lab [...] lincolnbaxter.com.MAKE.ME.VALID
</a>
</font></li>
</ul>


signature.asc<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1652269/886606/signature.asc">
Mon Jul 25 04:58:36 2016 (213b) by ppisar [...] redhat.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=105091">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1505549" href="/Public/Bug/Display.html?id=105091#txn-1505549">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;08&nbsp;09:20:10&nbsp;2015</span>
    <span class="description">ppisar [...] redhat.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> t/nested.t segfaults on ARM</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1505549/802343/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/802343">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 138b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">t/nested.t tests segfaults for me on ARM platform with glibc and Linux:

# perl -Ilib t/nested.t 
1..4
level 3
level 2
Segmentation fault
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1505552" href="/Public/Bug/Display.html?id=105091#txn-1505552">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;08&nbsp;09:23:11&nbsp;2015</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ppisar [...] redhat.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1505552/802346/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/802346">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 325b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne Po 08.čen.2015 09:20:10, ppisar napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; t/nested.t tests segfaults for me on ARM platform with glibc and Linux:
&gt; 
&gt; # perl -Ilib t/nested.t 
&gt; 1..4
&gt; level 3
&gt; level 2
&gt; Segmentation fault
</div>
I forgot to write down versions:

perl-5.20.2
glibc-2.20 and 2.21.90
Linux-3.2.27 and something newer I cannot identify now.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1652200" href="/Public/Bug/Display.html?id=105091#txn-1652200">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;24&nbsp;18:01:11&nbsp;2016</span>
    <span class="description">lab [...] lincolnbaxter.com.MAKE.ME.VALID -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1652200/886570/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/886570">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 450b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jun 08 09:23:11 2015, ppisar wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Dne Po 08.čen.2015 09:20:10, ppisar napsal&#40;a&#41;:
<div class="message-stanza open">&gt; &gt; t/nested.t tests segfaults for me on ARM platform with glibc and Linux:
&gt; &gt; 
&gt; &gt; # perl -Ilib t/nested.t 
&gt; &gt; 1..4
&gt; &gt; level 3
&gt; &gt; level 2
&gt; &gt; Segmentation fault
</div>&gt; 
&gt; I forgot to write down versions:
&gt; 
&gt; perl-5.20.2
&gt; glibc-2.20 and 2.21.90
&gt; Linux-3.2.27 and something newer I cannot identify now.
</div>
Does this still seg fault on current versions of ARM
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1652201" href="/Public/Bug/Display.html?id=105091#txn-1652201">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;24&nbsp;18:01:12&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1652269" href="/Public/Bug/Display.html?id=105091#txn-1652269">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;25&nbsp;04:58:36&nbsp;2016</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #105091] t/nested.t segfaults on ARM</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 25 Jul 2016 10:58:23 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Lincoln A Baxter via RT &lt;bug-Sys-SigAction [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Petr Pisar &lt;ppisar [...] redhat.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1652269/886605/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/886605">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 171b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun, Jul 24, 2016 at 06:01:22PM -0400, Lincoln A Baxter via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Does this still seg fault on current versions of ARM
</div>
Yes. perl-5.24.0, glibc-2.23.90.

-- Petr
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1652269/886606/signature.asc">Download signature.asc</a><br />
<span class="downloadcontenttype">application/pgp-signature 213b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1660237" href="/Public/Bug/Display.html?id=105091#txn-1660237">#</a>      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;20&nbsp;11:01:19&nbsp;2016</span>
    <span class="description">lab [...] lincolnbaxter.com.MAKE.ME.VALID -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1660237/891188/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/891188">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jul 25 04:58:36 2016, ppisar wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sun, Jul 24, 2016 at 06:01:22PM -0400, Lincoln A Baxter via RT wrote:
<div class="message-stanza open">&gt; &gt; Does this still seg fault on current versions of ARM
</div>&gt; 
&gt; Yes. perl-5.24.0, glibc-2.23.90.
&gt; 
&gt; -- Petr
</div>
Hi Petr,

Can you show me the output of:
   
    perl -MConfig -e &#39;print $Config{archname} .&#34;\n&#34; ;&#39;

Also I have attached a rewritten nested.t that allows one to 
control both the depth of nesting and the number of iterations.
Can you run this first without arguments &#40;as in&#41;:

    perl -Ilib t/nested.t

On your platform &#40;if I guessed the archname string right&#41; is will default to a depth of 2 and 2 iterations.  Please show me the out if it segfaults.

Then can you run it with different depths set &#40;as in&#41;: 

    perl -Ilib t/nested.t 5 1 #depth of 5, 1 iteration
    perl -Ilib t/nested.t 5 1 #depth of 4, 1 iteration
    perl -Ilib t/nested.t 5 1 #depth of 3, 1 iteration
    perl -Ilib t/nested.t 5 1 #depth of 1, 1 iteration

Please show me the output of each test that segfaults, and know which tests succeed. I want to understand better what the limits are, so I can set the defaults in this rewritten test to appropriate values.

Because this works fine on all the POSIX &#40;unix&#41; platforms the smoke testers have tested on, the I suspect this is a problem with the underlying signal handling in perl on ARM platforms. Apparently there are no smoke testers using ARM.  So, if you want this port of perl fixed, you&#39;ll want to get a stack trace from the core file resulting from the segfault and file a bug against this perl port.

thanks,

Lincoln
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1660240" href="/Public/Bug/Display.html?id=105091#txn-1660240">#</a>      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;20&nbsp;11:22:39&nbsp;2016</span>
    <span class="description">lab [...] lincolnbaxter.com.MAKE.ME.VALID -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="messagebody">
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> nested.t</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1660240/891193/nested.t">Download nested.t</a><br />
<span class="downloadcontenttype">text/x-perl 3.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"># Before `make install&#39; is performed this script should be runnable with
# `make test&#39;. After `make install&#39; it should work as `perl filename.t&#39;

#########################

# change &#39;tests =&gt; 1&#39; to &#39;tests =&gt; last_test_to_print&#39;;

use Test::More; # tests =&gt; 5;
#BEGIN { use_ok&#40;&#39;Sys::SigAction&#39;&#41; };

use Sys::SigAction;
#########################

# Insert your test code below, the Test::More module is use&#40;&#41;ed here so read
# its man page &#40; perldoc Test::More &#41; for help writing this test script.

use strict;
#use warnings;

use Carp qw&#40; carp cluck croak confess &#41;;
use Data::Dumper;
use Sys::SigAction qw&#40; set_sig_handler &#41;;
use POSIX  &#39;:signal_h&#39; ;
use Config;

#plan is a follows:
#
#  A test that sets signal handlers in nested blocks, and tests that
#  at each level of nesting, the signal handler at the next level up
#  is still valid &#40;for the same signal&#41;.  The idea is that the scope of
#  the block prevents the next level up signal handle from being overwritten.
#
# NOTE: smoke testers on ARM find that this test fails with a perl segfault
# two levels up from the deepest level... :-&#40;
#global... should be good at the end...


my @levels = &#40; &#41;;
my $depth = $ARGV[0];
my $repetitions = $ARGV[1];
$repetitions = 2 if not defined $repetitions;

my $arch = $Config{&#39;archname&#39;} ;
print &#34;archname = $arch}\n&#34; ;
if &#40; $Config{&#39;archname&#39;} =~ m/arm/i &#41;
{
   if &#40; not defined $depth &#41; 
   {
      print qq&#40;

   NOTE:  &#39;arm&#39; found in \$Config{&#39;archname&#39;}
   
       Bug #  was filed against Sys::SigAction noting that
       this test causes a perl segfault &#40;apparently if the depth of
       nested invocations is greater than 2&#41;. Forcing depth to $depth
       on this platform.
       
           depth=$depth
       
       If this test is run manually, you can explicitly 
       set both the depth of nesting and the number of 
       repetitions of this test. 

       perl -Ilib t/nested.t 5 2 #depth=5 repetitions=2

       Because this works fine on all the POSIX &#40;unix&#41; platforms the smoke
       testers have tested on, the author suspect this is a problem with
       the underlying signal handling in perl on ARM platforms. Apparently
       there are no smoke testers using ARM.  So, if you want this port
       of perl fixed, you&#39;ll want to get a stack trace from the core file
       resulting from the segfault and file a bug against this perl port.

&#41;;
      $depth = 2
   }
}
else
{
   $depth = 5 if not defined $depth;
   $repetitions = 2 if not defined $repetitions;
}

plan tests =&gt; $depth*$repetitions;

#recurses until $level &gt; $depth
sub do_level
{
    my &#40; $level &#41; = @_;
    return if $level &gt; $depth;
    print &#34;entered do_level&#40; $level &#41;\n&#34; ;
    do_level&#40; $level+1 &#41;;
    eval {
       my $ctx = set_sig_handler&#40; SIGALRM ,sub { print &#34;in ALRM handler level $level\n&#34;; $levels[$level-1] = $level; } &#41;;
       kill ALRM =&gt; $$;
    };
    if &#40;$@&#41; { warn &#34;handler died at level $level: $@\n&#34;; }
}


sub do_test
{
   my &#40; $p &#41; = &#40; @_ &#41;;
   my $i = 0;
   print &#34;depth = $depth\n&#34; ;
   print &#34;initializing levels array to all 0 for every depth\n&#34; ;
   while &#40; $i &lt; $depth &#41; { push&#40; @levels, 0 &#41;; $i++; }

   do_level&#40; 1 &#41;;

   $i = 0;
   for &#40; $i = $depth-1; $i &gt; -1; $i-- &#41;
   {
      ok&#40; $levels[$i] ,&#34;pass $p: \$levels[$i] was set by the signal handler to $levels[$i]&#34; &#41;;
      print &#34;\$levels[$i] = &#34; .$levels[$i] . &#34;\n&#34; ;
   }
}
my $pass = 1;
while &#40; $pass &lt;= $repetitions &#41; {
   print &#34;starting pass $pass\n&#34; ;
   do_test&#40; $pass  &#41;;
   $pass++;
} 

exit;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1660250" href="/Public/Bug/Display.html?id=105091#txn-1660250">#</a>      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;20&nbsp;13:44:33&nbsp;2016</span>
    <span class="description">lab [...] lincolnbaxter.com.MAKE.ME.VALID -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1660250/891199/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/891199">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 495b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Aug 20 11:01:19 2016, LBAXTER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; perl -Ilib t/nested.t 5 1 #depth of 5, 1 iteration
&gt; perl -Ilib t/nested.t 5 1 #depth of 4, 1 iteration
&gt; perl -Ilib t/nested.t 5 1 #depth of 3, 1 iteration
&gt; perl -Ilib t/nested.t 5 1 #depth of 1, 1 iteration
&gt; 
</div>This should have been:
  perl -Ilib t/nested.t 5 1 #depth of 5, 1 iteration
  perl -Ilib t/nested.t 4 1 #depth of 4, 1 iteration
  perl -Ilib t/nested.t 3 1 #depth of 3, 1 iteration
  perl -Ilib t/nested.t 1 1 #depth of 1, 1 iteration
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1663698" href="/Public/Bug/Display.html?id=105091#txn-1663698">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;31&nbsp;03:54:04&nbsp;2016</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #105091] t/nested.t segfaults on ARM</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 31 Aug 2016 09:53:32 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Lincoln A Baxter via RT &lt;bug-Sys-SigAction [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Petr Pisar &lt;ppisar [...] redhat.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1663698/893026/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/893026">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, Aug 20, 2016 at 11:01:19AM -0400, Lincoln A Baxter via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Can you show me the output of:
&gt;    
&gt;     perl -MConfig -e &#39;print $Config{archname} .&#34;\n&#34; ;&#39;
&gt; 
</div>armv6j-linux

I have now Linux-4.4.11, gcc-5.4.0, glibc-2.22, perl-5.22.2 and
Sys-SigAction-0.22. The t/nested.t from Sys-SigAction-0.22 still segfaults.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Also I have attached a rewritten nested.t that allows one to 
&gt; control both the depth of nesting and the number of iterations.
&gt; Can you run this first without arguments &#40;as in&#41;:
&gt; 
&gt;     perl -Ilib t/nested.t
&gt; 
&gt; On your platform &#40;if I guessed the archname string right&#41; is will default to
&gt; a depth of 2 and 2 iterations.  Please show me the out if it segfaults.
&gt; 
&gt; Then can you run it with different depths set &#40;as in&#41;: 
&gt; 
&gt;     perl -Ilib t/nested.t 5 1 #depth of 5, 1 iteration
&gt;     perl -Ilib t/nested.t 5 1 #depth of 4, 1 iteration
&gt;     perl -Ilib t/nested.t 5 1 #depth of 3, 1 iteration
&gt;     perl -Ilib t/nested.t 5 1 #depth of 1, 1 iteration
&gt;
</div>None of them &#40;5 1, 4 1 etc.&#41; segfaults with the new t/nested.t. I tried
different depths and iterations.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Because this works fine on all the POSIX &#40;unix&#41; platforms the smoke testers
&gt; have tested on, the I suspect this is a problem with the underlying signal
&gt; handling in perl on ARM platforms.
</div>
I also suspect a bug in the perl.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So, if you want this port of perl fixed, you&#39;ll want to get
&gt; a stack trace from the core file resulting from the segfault and file a bug
&gt; against this perl port.
&gt; 
</div>The stack trace is unusable because after the crash, the debuger reports the
last two frames are identical so the stack is corrupted.

-- Petr
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1667323" href="/Public/Bug/Display.html?id=105091#txn-1667323">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;09&nbsp;23:12:13&nbsp;2016</span>
    <span class="description">lab [...] lincolnbaxter.com.MAKE.ME.VALID -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1667323/894853/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/894853">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks Petr!!!

On Wed Aug 31 03:54:04 2016, ppisar wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sat, Aug 20, 2016 at 11:01:19AM -0400, Lincoln A Baxter via RT
&gt; wrote:
<div class="message-stanza open">&gt; &gt; Can you show me the output of:
&gt; &gt;
&gt; &gt; perl -MConfig -e &#39;print $Config{archname} .&#34;\n&#34; ;&#39;
&gt; &gt;
</div>&gt; armv6j-linux
&gt; 
&gt; I have now Linux-4.4.11, gcc-5.4.0, glibc-2.22, perl-5.22.2 and
&gt; Sys-SigAction-0.22. The t/nested.t from Sys-SigAction-0.22 still
&gt; segfaults.
&gt; 
<div class="message-stanza open">&gt; &gt; Also I have attached a rewritten nested.t that allows one to
&gt; &gt; control both the depth of nesting and the number of iterations.
&gt; &gt; Can you run this first without arguments &#40;as in&#41;:
&gt; &gt;
&gt; &gt; perl -Ilib t/nested.t
&gt; &gt;
&gt; &gt; On your platform &#40;if I guessed the archname string right&#41; is will
&gt; &gt; default to
&gt; &gt; a depth of 2 and 2 iterations.  Please show me the out if it
&gt; &gt; segfaults.
&gt; &gt;
&gt; &gt; Then can you run it with different depths set &#40;as in&#41;:
&gt; &gt;
&gt; &gt; perl -Ilib t/nested.t 5 1 #depth of 5, 1 iteration
&gt; &gt; perl -Ilib t/nested.t 5 1 #depth of 4, 1 iteration
&gt; &gt; perl -Ilib t/nested.t 5 1 #depth of 3, 1 iteration
&gt; &gt; perl -Ilib t/nested.t 5 1 #depth of 1, 1 iteration
&gt; &gt;
</div>&gt; None of them &#40;5 1, 4 1 etc.&#41; segfaults with the new t/nested.t. I
&gt; tried
&gt; different depths and iterations.
</div>Wow... The main difference between the new nested.t and the old one, is that the testing in the new one is performed recursively in a do_test&#40;&#41; routine, where as in the original test, the nesting of signals was &#34;inline.&#34;  I wonder if the recursive call stack is providing enough  isolation of whatever is causing perl to crap the bed, so that it is no longer happening.

I&#39;m thinking that the original test was pretty contrived... how likely is it, that someone would do what is in the that test.  I could easily see one doing it serially at the same level of call, and I can see one doing what the new test does &#40;at differently levels of the call stack&#41;.  Now I&#39;m thinking, I should just replace the old test with the new, and not worry about it.  The original test might be so contrived a test that nobody is doing it, which is why the arm5 and now arm6 perl port remains broken this way. This tempts me to remove the trap of arm5tejl and see if the testers find a problem with the new test.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; So, if you want this port of perl fixed, you&#39;ll want to get
&gt; &gt; a stack trace from the core file resulting from the segfault and file
&gt; &gt; a bug
&gt; &gt; against this perl port.
&gt; &gt;
</div>&gt; The stack trace is unusable because after the crash, the debuger
&gt; reports the
&gt; last two frames are identical so the stack is corrupted.
</div>
*sigh*  

I think this confirms my supposition above that the new recursive nested.t is not getting a segfault because of stack isolation.  I guess I now know how I could built a test of this that could be submitted to the perl porter&#40;s&#41; for arm... I would just have insert inline the POSIX.pm code that sys-sigaction implements.  Given how twisted the original test code is, I&#39;m not sure it is worth it.  Though I suppose I could post a query on the the appropriate porters forum and see it there is interest in fixing it. 

Thanks for your help.  I&#39;ll probably release a new version of this with the new nested.t and close this bug. I&#39;ve some other minor changes I want to make, that I&#39;ll probably roll into a new version. The &#34;kwalitee&#34; folk are complaining about that fact that the module doesn&#39;t &#34;use warnings&#34;  It is in the code but commented out because warnings was only supported in perl 5.006 and later, and I had originally supported this module on perl 5.005.  I think I&#39;ll just desupport that now. &#40;That was 12 years ago&#41;. 

Lincoln
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1749521" href="/Public/Bug/Display.html?id=105091#txn-1749521">#</a>      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;23&nbsp;09:29:50&nbsp;2017</span>
    <span class="description">lab [...] lincolnbaxter.com.MAKE.ME.VALID -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1749521/941112/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/941112">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 127b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I never got around to closing this.  I changed that way nested.t was working.  See most recent message in the history.

Lincoln
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1749524" href="/Public/Bug/Display.html?id=105091#txn-1749524">#</a>      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;23&nbsp;09:29:51&nbsp;2017</span>
    <span class="description">lab [...] lincolnbaxter.com.MAKE.ME.VALID -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.61565</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
