<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #17092 for Error: Corner-case bug in Error.pm</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #17092 for Error: Corner-case bug in Error.pm</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Error">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Error">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Error">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Error">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Error">Error CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">17092</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Error">Error</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
leonerd [...] leonerd.org.uk

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-12246-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-12247-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




signature.asc<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/156224/47885/signature.asc">
Mon Jan 16 14:18:37 2006 (189b) by leonerd [...] leonerd.org.uk
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=17092">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-156224" href="/Public/Bug/Display.html?id=17092#txn-156224">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;16&nbsp;14:18:37&nbsp;2006</span>
    <span class="description">leonerd [...] leonerd.org.uk -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Corner-case bug in Error.pm</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 16 Jan 2006 19:17:47 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Error [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Paul LeoNerd Evans &lt;leonerd [...] leonerd.org.uk&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/156224/47884/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/47884">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have been fiddling with the Error.pm module for exception handling. I
have found a corner-case where the &#34;finally&#34; block does not get run.

Given as try / catch / finally blocks are anonymous subs, I find I have
to use something like the following workaround if I want to get the
containing function to return a value:

  sub test
  {
    my $ret;

    try {
      some&#40;&#41;; code&#40;&#41;; here&#40;&#41;;
    }
    catch Some::Exception with {
      $ret = ErrorCode;
      goto ABORT:
    };

    return undef;

    ABORT:
    return $ret;
  }

This works correctly. However, in the presence of a &#34;finally&#34; block, it
breaks. The non-local &#34;goto ABORT&#34; skips over the finally handler,
causing it not to be called. This has bad consequences if e.g. it
contains file unlocking code, for example.

I have found a solution to this, in other code I have which wraps
anonymous subrefs. This involves a special object class created just for
the purpose:

  package Cleanup::Handler;

  sub new
  {
    my $class = shift;
    my &#40; $code &#41; = @_;
    my $self = \$code;
    return bless $self, $class;
  }

  sub DESTROY
  {
    my $self = shift;
    my $code = $$self;
    $code-&gt;&#40;&#41;;
  }

  1;

  ...

  {
    my $cleanup = new Cleanup::Handler&#40; sub { unlock&#40;&#41; } &#41;;

    lock&#40;&#41;;

    eval { $othercoderef-&gt;&#40;&#41; };
  }

Now, even if the $othercoderef uses a non-local goto, the $cleanup
variable codes out of scope, gets garbage collected, and the DESTROY
handler is called. The unlock&#40;&#41; function still gets called.

Perhaps you would be able to work this sort of logic into the &#34;try&#34;
function in Error.pm? Or alternatively, I could take a look at the code
and provide a patch...

-- 
Paul &#34;LeoNerd&#34; Evans

leonerd@leonerd.org.uk
ICQ# 4135350       |  Registered Linux# 179460
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.leonerd.org.uk/">http://www.leonerd.org.uk/</a></span>
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/156224/47885/signature.asc">Download signature.asc</a><br />
<span class="downloadcontenttype">application/pgp-signature 189b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-181934" href="/Public/Bug/Display.html?id=17092#txn-181934">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;31&nbsp;04:30:40&nbsp;2006</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/181934/63777/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/63777">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jan 16 14:18:37 2006, leonerd@leonerd.org.uk wrote:  
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have been fiddling with the Error.pm module for exception  
</div>handling. I  
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; have found a corner-case where the &#34;finally&#34; block does not get run.  
&gt;   
&gt; Given as try / catch / finally blocks are anonymous subs, I find I  
</div>have  
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; to use something like the following workaround if I want to get the  
&gt; containing function to return a value:  
&gt;   
&gt;   sub test  
&gt;   {  
&gt;     my $ret;  
&gt;   
&gt;     try {  
&gt;       some&#40;&#41;; code&#40;&#41;; here&#40;&#41;;  
&gt;     }  
&gt;     catch Some::Exception with {  
&gt;       $ret = ErrorCode;  
&gt;       goto ABORT:  
&gt;     };  
&gt;   
&gt;     return undef;  
&gt;   
&gt;     ABORT:  
&gt;     return $ret;  
&gt;   }  
&gt;   
</div>  
What I normally do instead is: &#40;untested&#41;  
  
sub test  
{  
   my $ret = undef;  
   
   try {  
      some&#40;&#41;; code&#40;&#41;; here&#40;&#41;;  
    }  
    catch Some::Exception with {  
      $ret = ErrorCode;  
      goto ABORT:  
    };  
  
    return $ret;  
}  
  
And this will work with finally as well. So it might be an annoyance,  
but not one that is hard to overcome.  
  
At the moment, I&#39;ve started maintaining my own branch of Error.pm with  
bug-fixes here:  
  
svn://svn.berlios.de/web-cpan/Error.pm/trunk/  
  
If you&#39;re interested you can send me a patch that adds a test and 
fixes this issue. Note that at the moment, I&#39;m leaning towards not 
&#34;fixing&#34; this, but a reasonable patch might convince me otherwise. 
 
And don&#39;t goto&#39;s out of functions generate warnings with &#34;use 
warnings&#34;? 
 
Regards, 
 
      Shlomi Fish 
 
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This works correctly. However, in the presence of a &#34;finally&#34; block,  
</div>it  
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; breaks. The non-local &#34;goto ABORT&#34; skips over the finally handler,  
&gt; causing it not to be called. This has bad consequences if e.g. it  
&gt; contains file unlocking code, for example.  
&gt;   
&gt; I have found a solution to this, in other code I have which wraps  
&gt; anonymous subrefs. This involves a special object class created just  
</div>for  
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; the purpose:  
&gt;   
&gt;   package Cleanup::Handler;  
&gt;   
&gt;   sub new  
&gt;   {  
&gt;     my $class = shift;  
&gt;     my &#40; $code &#41; = @_;  
&gt;     my $self = \$code;  
&gt;     return bless $self, $class;  
&gt;   }  
&gt;   
&gt;   sub DESTROY  
&gt;   {  
&gt;     my $self = shift;  
&gt;     my $code = $$self;  
&gt;     $code-&gt;&#40;&#41;;  
&gt;   }  
&gt;   
&gt;   1;  
&gt;   
&gt;   ...  
&gt;   
&gt;   {  
&gt;     my $cleanup = new Cleanup::Handler&#40; sub { unlock&#40;&#41; } &#41;;  
&gt;   
&gt;     lock&#40;&#41;;  
&gt;   
&gt;     eval { $othercoderef-&gt;&#40;&#41; };  
&gt;   }  
&gt;   
&gt; Now, even if the $othercoderef uses a non-local goto, the $cleanup  
&gt; variable codes out of scope, gets garbage collected, and the DESTROY  
&gt; handler is called. The unlock&#40;&#41; function still gets called.  
&gt;   
&gt; Perhaps you would be able to work this sort of logic into the &#34;try&#34;  
&gt; function in Error.pm? Or alternatively, I could take a look at the  
</div>code  
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; and provide a patch...  
&gt;   
</div>  
  
  
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-181935" href="/Public/Bug/Display.html?id=17092#txn-181935">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;31&nbsp;04:30:43&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-182064" href="/Public/Bug/Display.html?id=17092#txn-182064">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;31&nbsp;09:10:58&nbsp;2006</span>
    <span class="description">leonerd [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #17092] Corner-case bug in Error.pm</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 31 Mar 2006 15:10:28 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Error [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Paul LeoNerd Evans &lt;leonerd [...] leonerd.org.uk&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/182064/63846/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/63846">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, 31 Mar 2006 04:30:45 -0500 &#40;EST&#41;
&#34; via RT&#34; &lt;bug-Error@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; sub test  
&gt; {  
&gt;    my $ret = undef;  
&gt;    
&gt;    try {  
&gt;       some&#40;&#41;; code&#40;&#41;; here&#40;&#41;;  
&gt;     }  
&gt;     catch Some::Exception with {  
&gt;       $ret = ErrorCode;  
&gt;       goto ABORT:  
&gt;     };  
&gt;   
&gt;     return $ret;  
&gt; }  
&gt;   
&gt; And this will work with finally as well. So it might be an annoyance,  
&gt; but not one that is hard to overcome.  
</div>
Ah, but now consider the following:

 sub test
 {
    my $ret = undef;
    try {
       flock&#40; $filehandle, LOCK_EX &#41;;
       code&#40;&#41;;
    }
    catch Some::Exception with {
       $ret = ErrorCode;
       goto ABORT;
    },
    finally {
       flock&#40; $filehandle, LOCK_UN &#41;;
    };

    return $ret;
 }

This finally block will not get run if an exception is thrown, because
the goto moves right over it. My cleanup-handler approach would solve
this.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; At the moment, I&#39;ve started maintaining my own branch of Error.pm with  
&gt; bug-fixes here:  
&gt;   
&gt; svn://svn.berlios.de/web-cpan/Error.pm/trunk/  
&gt;   
&gt; If you&#39;re interested you can send me a patch that adds a test and 
&gt; fixes this issue. Note that at the moment, I&#39;m leaning towards not 
&gt; &#34;fixing&#34; this, but a reasonable patch might convince me otherwise. 
&gt;  
&gt; And don&#39;t goto&#39;s out of functions generate warnings with &#34;use 
&gt; warnings&#34;? 
</div>
No. This isn&#39;t a goto out of the function. It&#39;s within the same function.
Well, it&#39;s from an inner closure, to its parent function. That is
allowed.

-- 
Paul &#34;LeoNerd&#34; Evans

leonerd@leonerd.org.uk
ICQ# 4135350       |  Registered Linux# 179460
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.leonerd.org.uk/">http://www.leonerd.org.uk/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-182593" href="/Public/Bug/Display.html?id=17092#txn-182593">#</a>      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;02&nbsp;07:28:46&nbsp;2006</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/182593/64072/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/64072">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Mar 31 09:10:58 2006, leonerd@leonerd.org.uk wrote: 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri, 31 Mar 2006 04:30:45 -0500 &#40;EST&#41; 
&gt; &#34; via RT&#34; &lt;bug-Error@rt.cpan.org&gt; wrote: 
&gt;  
<div class="message-stanza open">&gt; &gt; sub test   
&gt; &gt; {   
&gt; &gt;    my $ret = undef;   
&gt; &gt;     
&gt; &gt;    try {   
&gt; &gt;       some&#40;&#41;; code&#40;&#41;; here&#40;&#41;;   
&gt; &gt;     }   
&gt; &gt;     catch Some::Exception with {   
&gt; &gt;       $ret = ErrorCode;   
&gt; &gt;       goto ABORT:   
</div></div> 
I&#39;m sorry - the &#34;goto ABORT&#34; here was a typo. It should not be 
present. 
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt;     };   
&gt; &gt;    
&gt; &gt;     return $ret;   
&gt; &gt; }   
&gt; &gt;    
&gt; &gt; And this will work with finally as well. So it might be an 
</div></div>annoyance,   
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; but not one that is hard to overcome.   
</div>&gt;  
&gt; Ah, but now consider the following: 
&gt;  
&gt;  sub test 
&gt;  { 
&gt;     my $ret = undef; 
&gt;     try { 
&gt;        flock&#40; $filehandle, LOCK_EX &#41;; 
&gt;        code&#40;&#41;; 
&gt;     } 
&gt;     catch Some::Exception with { 
&gt;        $ret = ErrorCode; 
&gt;        goto ABORT; 
&gt;     }, 
&gt;     finally { 
&gt;        flock&#40; $filehandle, LOCK_UN &#41;; 
&gt;     }; 
&gt;  
&gt;     return $ret; 
&gt;  } 
&gt;  
&gt; This finally block will not get run if an exception is thrown, 
</div>because 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; the goto moves right over it. My cleanup-handler approach would 
</div>solve 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; this. 
&gt;  
</div> 
Yes, but why do you need the goto in the first place? Just assign the 
error code and then let the code drop to the finally. If you need a 
special case, just assign an error variable and then check for it 
after the finally. 
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; At the moment, I&#39;ve started maintaining my own branch of Error.pm 
</div></div>with   
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; bug-fixes here:   
&gt; &gt;    
&gt; &gt; svn://svn.berlios.de/web-cpan/Error.pm/trunk/   
&gt; &gt;    
&gt; &gt; If you&#39;re interested you can send me a patch that adds a test and  
&gt; &gt; fixes this issue. Note that at the moment, I&#39;m leaning towards not  
&gt; &gt; &#34;fixing&#34; this, but a reasonable patch might convince me otherwise.  
&gt; &gt;   
&gt; &gt; And don&#39;t goto&#39;s out of functions generate warnings with &#34;use  
&gt; &gt; warnings&#34;?  
</div>&gt;  
&gt; No. This isn&#39;t a goto out of the function. It&#39;s within the same 
</div>function. 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Well, it&#39;s from an inner closure, to its parent function. That is 
&gt; allowed. 
&gt;  
</div> 
I see. OK. 
 
Regards, 
 
 Shlomi Fish 
 
 
 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-216275" href="/Public/Bug/Display.html?id=17092#txn-216275">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;30&nbsp;05:01:05&nbsp;2006</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/216275/86736/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/86736">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 389b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi!

I talked with LeoNerd about it on the IRC, and he said he now agrees 
that fixing this issue the way he proposed may break existing code, 
and so the behaviour of the code should not be modified.

Like I said, I believe it&#39;s the expected behaviour.

So I&#39;m closing this bug and will soon release a new 0.XX version of 
Error.pm &#40;identical to the current version&#41; with no known bugs.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-216278" href="/Public/Bug/Display.html?id=17092#txn-216278">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;30&nbsp;05:01:09&nbsp;2006</span>
    <span class="description">SHLOMIF [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.453152</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
