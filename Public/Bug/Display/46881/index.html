<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #46881 for Search-QueryParser-SQL: INTs are being fuzzified</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #46881 for Search-QueryParser-SQL: INTs are being fuzzified</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Search-QueryParser-SQL/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Search-QueryParser-SQL/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Search-QueryParser-SQL/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Search-QueryParser-SQL/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Search-QueryParser-SQL">Search-QueryParser-SQL CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">46881</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Search-QueryParser-SQL/Active/">Search-QueryParser-SQL</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
maz [...] mlx.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-223680-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-223681-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;12&nbsp;05:20:57&nbsp;2009</span>
    <span class="description">maz [...] mlx.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> INTs are being fuzzified</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 12 Jun 2009 17:20:14 +0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Search-QueryParser-SQL [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Maslanik &lt;maz [...] mlx.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Adding the following to the _doctor_value sub is how I fixed it.

     my $value = $subQ-&gt;{value};

+    if&#40;$self-&gt;{_parser}-&gt;{_is_int}-&gt;{ $subQ-&gt;{field} }&#41; {
+        return $value;
+    }

John Maslanik
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;12&nbsp;10:24:43&nbsp;2009</span>
    <span class="description">peter [...] peknet.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #46881] INTs are being fuzzified</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 12 Jun 2009 09:24:23 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Search-QueryParser-SQL [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Karman &lt;peter [...] peknet.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">John Maslanik via RT wrote on 6/12/09 4:21 AM:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Fri Jun 12 05:20:57 2009: Request 46881 was acted upon.
&gt; Transaction: Ticket created by maz@mlx.net
&gt;        Queue: Search-QueryParser-SQL
&gt;      Subject: INTs are being fuzzified
&gt;    Broken in: &#40;no value&#41;
&gt;     Severity: &#40;no value&#41;
&gt;        Owner: Nobody
&gt;   Requestors: maz@mlx.net
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=46881">https://rt.cpan.org/Ticket/Display.html?id=46881</a></span> &gt;
&gt; 
&gt; 
&gt; Adding the following to the _doctor_value sub is how I fixed it.
&gt; 
&gt;      my $value = $subQ-&gt;{value};
&gt; 
&gt; +    if&#40;$self-&gt;{_parser}-&gt;{_is_int}-&gt;{ $subQ-&gt;{field} }&#41; {
&gt; +        return $value;
&gt; +    }
&gt; 
&gt; John Maslanik
&gt; 
&gt; 
</div>
Thanks. It was a little more complicated than that but definitely was on my todo
list. I just needed the push to get it done.

Please try svn trunk from here and confirm that it works for you and I&#39;ll
release a new version to CPAN.

<span class="clickylink"><a target="new" rel="nofollow" href="https://svn.msi.umn.edu/sw/perl/Search-QueryParser-SQL/trunk/">https://svn.msi.umn.edu/sw/perl/Search-QueryParser-SQL/trunk/</a></span>

-- 
Peter Karman  .  <span class="clickylink"><a target="new" rel="nofollow" href="http://peknet.com/">http://peknet.com/</a></span>  .  peter@peknet.com
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;12&nbsp;10:24:44&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;15&nbsp;08:52:28&nbsp;2009</span>
    <span class="description">maz [...] mlx.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #46881] INTs are being fuzzified</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 15 Jun 2009 20:52:03 +0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Search-QueryParser-SQL [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Maslanik &lt;maz [...] mlx.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Peter,

Thank you for the quick response.  I apologize for my delay.  I would  
be more than happy to test your changes, but I have hacked another  
feature into my copy.  I needed to have the ability to have aliases  
for field names.  For example, I use DBIx::Class and have a query that  
queries Inventory, InventoryXArtists and Artists tables.  If I had  
inventory_id in my field list, the query would fail because  
inventory_id is in both inventory and inventoryxartist tables.  So  
what I did was add an extra parameter to the constructor called  
&#34;aliases&#34; that consists of a hash of aliases.  &#40;i.e.  { &#39;inventory_id&#39;  
=&gt; &#39;me.inventory_id&#39;, &#39;name&#39; =&gt; &#39;artist.name&#39; }&#41;.  I then added code  
that in your column loop after the &#34;TODO better operator selection&#34;  
comment that checks aliases and renames columns if they exists.

I also want to add some type of call back functionality that handles  
things such as the following situation.

The inventory table can be queried looking for entries added in the  
last x days.  So when someone enters recent:30, the query needs to end  
up being, &#39;to_days&#40;now&#40;&#41;&#41; - to_days&#40;me.date_created&#41; &lt;= $recent&#39;.  Now  
that I&#39;m thinking about it, the aliases feature handles everything but  
changing the operator.

I would love to change columns to be something like:

$columns = {
        &#39;column_name&#39; =&gt; {
                &#39;type&#39; =&gt; &#39;int|char|etc&#34;,
                &#39;alias&#39; =&gt; &#39;name to use for sql query&#39;,
                &#39;op&#39; =&gt; &#39;name of op to force&#39;,
                &#39;callback&#39; =&gt; &#39;call to function that takes $column, $op, and $value  
and returns what&#39;s pushed on to buf&#39;
        }
}

unfortunately I think that would break backwards compatibility.

Maybe I could put something that loops through the columns hash,  
checking if the members are a string or a hash and convert them if  
needed.

What are your thoughts?  I&#39;m more than willing to do the code, all you  
have to do is review it and submit it.

Thanks,
John Maslanik





On Jun 12, 2009, at 10:24 PM, peter@peknet.com via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=46881">https://rt.cpan.org/Ticket/Display.html?id=46881</a></span> &gt;
&gt;
&gt; John Maslanik via RT wrote on 6/12/09 4:21 AM:
<div class="message-stanza open">&gt;&gt; Fri Jun 12 05:20:57 2009: Request 46881 was acted upon.
&gt;&gt; Transaction: Ticket created by maz@mlx.net
&gt;&gt;       Queue: Search-QueryParser-SQL
&gt;&gt;     Subject: INTs are being fuzzified
&gt;&gt;   Broken in: &#40;no value&#41;
&gt;&gt;    Severity: &#40;no value&#41;
&gt;&gt;       Owner: Nobody
&gt;&gt;  Requestors: maz@mlx.net
&gt;&gt;      Status: new
&gt;&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=46881">https://rt.cpan.org/Ticket/Display.html?id=46881</a></span> &gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; Adding the following to the _doctor_value sub is how I fixed it.
&gt;&gt;
&gt;&gt;     my $value = $subQ-&gt;{value};
&gt;&gt;
&gt;&gt; +    if&#40;$self-&gt;{_parser}-&gt;{_is_int}-&gt;{ $subQ-&gt;{field} }&#41; {
&gt;&gt; +        return $value;
&gt;&gt; +    }
&gt;&gt;
&gt;&gt; John Maslanik
&gt;&gt;
&gt;&gt;
</div>&gt;
&gt; Thanks. It was a little more complicated than that but definitely  
&gt; was on my todo
&gt; list. I just needed the push to get it done.
&gt;
&gt; Please try svn trunk from here and confirm that it works for you and  
&gt; I&#39;ll
&gt; release a new version to CPAN.
&gt;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://svn.msi.umn.edu/sw/perl/Search-QueryParser-SQL/trunk/">https://svn.msi.umn.edu/sw/perl/Search-QueryParser-SQL/trunk/</a></span>
&gt;
&gt; -- 
&gt; Peter Karman  .  <span class="clickylink"><a target="new" rel="nofollow" href="http://peknet.com/">http://peknet.com/</a></span>  .  peter@peknet.com
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;15&nbsp;21:19:38&nbsp;2009</span>
    <span class="description">peter [...] peknet.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #46881] INTs are being fuzzified</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 15 Jun 2009 20:19:16 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Search-QueryParser-SQL [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Karman &lt;peter [...] peknet.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">John Maslanik via RT wrote on 6/15/09 7:52 AM:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Search-QueryParser-SQL
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=46881">https://rt.cpan.org/Ticket/Display.html?id=46881</a></span> &gt;
&gt; 
&gt; Peter,
&gt; 
&gt; Thank you for the quick response.  I apologize for my delay.  I would  
&gt; be more than happy to test your changes, but I have hacked another  
&gt; feature into my copy.  I needed to have the ability to have aliases  
&gt; for field names.  For example, I use DBIx::Class and have a query that  
&gt; queries Inventory, InventoryXArtists and Artists tables.  If I had  
&gt; inventory_id in my field list, the query would fail because  
&gt; inventory_id is in both inventory and inventoryxartist tables.  So  
&gt; what I did was add an extra parameter to the constructor called  
&gt; &#34;aliases&#34; that consists of a hash of aliases.  &#40;i.e.  { &#39;inventory_id&#39;  
&gt; =&gt; &#39;me.inventory_id&#39;, &#39;name&#39; =&gt; &#39;artist.name&#39; }&#41;.  I then added code  
&gt; that in your column loop after the &#34;TODO better operator selection&#34;  
&gt; comment that checks aliases and renames columns if they exists.
&gt; 
&gt; I also want to add some type of call back functionality that handles  
&gt; things such as the following situation.
&gt; 
&gt; The inventory table can be queried looking for entries added in the  
&gt; last x days.  So when someone enters recent:30, the query needs to end  
&gt; up being, &#39;to_days&#40;now&#40;&#41;&#41; - to_days&#40;me.date_created&#41; &lt;= $recent&#39;.  Now  
&gt; that I&#39;m thinking about it, the aliases feature handles everything but  
&gt; changing the operator.
&gt; 
&gt; I would love to change columns to be something like:
&gt; 
&gt; $columns = {
&gt;       &#39;column_name&#39; =&gt; {
&gt;               &#39;type&#39; =&gt; &#39;int|char|etc&#34;,
&gt;               &#39;alias&#39; =&gt; &#39;name to use for sql query&#39;,
&gt;               &#39;op&#39; =&gt; &#39;name of op to force&#39;,
&gt;               &#39;callback&#39; =&gt; &#39;call to function that takes $column, $op, and $value  
&gt; and returns what&#39;s pushed on to buf&#39;
&gt;       }
&gt; }
&gt; 
&gt; unfortunately I think that would break backwards compatibility.
&gt; 
&gt; Maybe I could put something that loops through the columns hash,  
&gt; checking if the members are a string or a hash and convert them if  
&gt; needed.
&gt; 
&gt; What are your thoughts?  I&#39;m more than willing to do the code, all you  
&gt; have to do is review it and submit it.
&gt; 
</div>
column aliases, etc., sound fine, as long as current tests pass.

feel free to patch against svn trunk here:

<span class="clickylink"><a target="new" rel="nofollow" href="https://svn.msi.umn.edu/sw/perl/Search-QueryParser-SQL/trunk/">https://svn.msi.umn.edu/sw/perl/Search-QueryParser-SQL/trunk/</a></span>

be sure to include tests and docs for the new features.

-- 
Peter Karman  .  <span class="clickylink"><a target="new" rel="nofollow" href="http://peknet.com/">http://peknet.com/</a></span>  .  peter@peknet.com
gpg key: 37D2 DAA6 3A13 D415 4295  3A69 448F E556 374A 34D9
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;17&nbsp;02:21:19&nbsp;2009</span>
    <span class="description">maz [...] mlx.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #46881] INTs are being fuzzified</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 17 Jun 2009 14:20:50 +0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Search-QueryParser-SQL [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Maslanik &lt;maz [...] mlx.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Peter,

Attached or modified Query.pm and SQL.pm files.  They are modified  
from the cvs link below.  The following features and/or bug fixes are  
added.

1.  Added &#34;aliases&#34; option to the constructor.  If passed, column  
names will be transformed in accordance with the alias hash.
2.  Added int_op option to the constructor.  This sets what default  
operator to use for int fields.  There was also a bug where the int  
operator was set to GT, this is not valid for mysql.
3.  Made -keyword queries work.  This consists of setting &#34;NOT $like&#34;  
when the $prefix is &#39;-&#39; and joining sub queries with &#34;AND&#34; instead of  
OR when the $prefix is &#39;-&#39;, it also sets op to != for ints.
4.  In the unwind_subQ function, $like had padding added twice when  
doing the int check.

Let me know how it looks.

Thanks,
John Maslanik
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">



On Jun 16, 2009, at 9:19 AM, peter@peknet.com via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=46881">http://rt.cpan.org/Ticket/Display.html?id=46881</a></span> &gt;
&gt;
&gt; John Maslanik via RT wrote on 6/15/09 7:52 AM:
<div class="message-stanza open">&gt;&gt;       Queue: Search-QueryParser-SQL
&gt;&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=46881">https://rt.cpan.org/Ticket/Display.html?id=46881</a></span> &gt;
&gt;&gt;
&gt;&gt; Peter,
&gt;&gt;
&gt;&gt; Thank you for the quick response.  I apologize for my delay.  I would
&gt;&gt; be more than happy to test your changes, but I have hacked another
&gt;&gt; feature into my copy.  I needed to have the ability to have aliases
&gt;&gt; for field names.  For example, I use DBIx::Class and have a query  
&gt;&gt; that
&gt;&gt; queries Inventory, InventoryXArtists and Artists tables.  If I had
&gt;&gt; inventory_id in my field list, the query would fail because
&gt;&gt; inventory_id is in both inventory and inventoryxartist tables.  So
&gt;&gt; what I did was add an extra parameter to the constructor called
&gt;&gt; &#34;aliases&#34; that consists of a hash of aliases.  &#40;i.e.   
&gt;&gt; { &#39;inventory_id&#39;
&gt;&gt; =&gt; &#39;me.inventory_id&#39;, &#39;name&#39; =&gt; &#39;artist.name&#39; }&#41;.  I then added code
&gt;&gt; that in your column loop after the &#34;TODO better operator selection&#34;
&gt;&gt; comment that checks aliases and renames columns if they exists.
&gt;&gt;
&gt;&gt; I also want to add some type of call back functionality that handles
&gt;&gt; things such as the following situation.
&gt;&gt;
&gt;&gt; The inventory table can be queried looking for entries added in the
&gt;&gt; last x days.  So when someone enters recent:30, the query needs to  
&gt;&gt; end
&gt;&gt; up being, &#39;to_days&#40;now&#40;&#41;&#41; - to_days&#40;me.date_created&#41; &lt;= $recent&#39;.   
&gt;&gt; Now
&gt;&gt; that I&#39;m thinking about it, the aliases feature handles everything  
&gt;&gt; but
&gt;&gt; changing the operator.
&gt;&gt;
&gt;&gt; I would love to change columns to be something like:
&gt;&gt;
&gt;&gt; $columns = {
&gt;&gt;      &#39;column_name&#39; =&gt; {
&gt;&gt;              &#39;type&#39; =&gt; &#39;int|char|etc&#34;,
&gt;&gt;              &#39;alias&#39; =&gt; &#39;name to use for sql query&#39;,
&gt;&gt;              &#39;op&#39; =&gt; &#39;name of op to force&#39;,
&gt;&gt;              &#39;callback&#39; =&gt; &#39;call to function that takes $column, $op, and $value
&gt;&gt; and returns what&#39;s pushed on to buf&#39;
&gt;&gt;      }
&gt;&gt; }
&gt;&gt;
&gt;&gt; unfortunately I think that would break backwards compatibility.
&gt;&gt;
&gt;&gt; Maybe I could put something that loops through the columns hash,
&gt;&gt; checking if the members are a string or a hash and convert them if
&gt;&gt; needed.
&gt;&gt;
&gt;&gt; What are your thoughts?  I&#39;m more than willing to do the code, all  
&gt;&gt; you
&gt;&gt; have to do is review it and submit it.
&gt;&gt;
</div>&gt;
&gt; column aliases, etc., sound fine, as long as current tests pass.
&gt;
&gt; feel free to patch against svn trunk here:
&gt;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://svn.msi.umn.edu/sw/perl/Search-QueryParser-SQL/trunk/">https://svn.msi.umn.edu/sw/perl/Search-QueryParser-SQL/trunk/</a></span>
&gt;
&gt; be sure to include tests and docs for the new features.
&gt;
&gt; -- 
&gt; Peter Karman  .  <span class="clickylink"><a target="new" rel="nofollow" href="http://peknet.com/">http://peknet.com/</a></span>  .  peter@peknet.com
&gt; gpg key: 37D2 DAA6 3A13 D415 4295  3A69 448F E556 374A 34D9
&gt;
</div></div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;17&nbsp;21:57:19&nbsp;2009</span>
    <span class="description">peter [...] peknet.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #46881] INTs are being fuzzified</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 17 Jun 2009 20:56:59 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Search-QueryParser-SQL [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Karman &lt;peter [...] peknet.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">John Maslanik via RT wrote on 6/17/09 1:21 AM:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Search-QueryParser-SQL
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=46881">https://rt.cpan.org/Ticket/Display.html?id=46881</a></span> &gt;
&gt; 
&gt; Peter,
&gt; 
&gt; Attached or modified Query.pm and SQL.pm files.  They are modified  
&gt; from the cvs link below.  The following features and/or bug fixes are  
&gt; added.
&gt; 
&gt; 1.  Added &#34;aliases&#34; option to the constructor.  If passed, column  
&gt; names will be transformed in accordance with the alias hash.
&gt; 2.  Added int_op option to the constructor.  This sets what default  
&gt; operator to use for int fields.  There was also a bug where the int  
&gt; operator was set to GT, this is not valid for mysql.
&gt; 3.  Made -keyword queries work.  This consists of setting &#34;NOT $like&#34;  
&gt; when the $prefix is &#39;-&#39; and joining sub queries with &#34;AND&#34; instead of  
&gt; OR when the $prefix is &#39;-&#39;, it also sets op to != for ints.
&gt; 4.  In the unwind_subQ function, $like had padding added twice when  
&gt; doing the int check.
&gt; 
&gt; Let me know how it looks.
&gt; 
</div>
John,

Thanks for the patches.

First, those look like decent changes, but it&#39;s hard to tell without tests.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&gt; be sure to include tests and docs for the new features.
</div>
I didn&#39;t see those.

Second, those patches cause 4 existing tests to fail. Output below:

t/00-load.t ....... 1/1 # Testing Search::QueryParser::SQL 0.008
t/00-load.t ....... ok
t/01-parser.t ..... 1/30
#   Failed test &#39;query8 fuzzy int with wildcard string&#39;
#   at t/01-parser.t line 94.
#          got: &#39;bar&lt;=1&#39;
#     expected: &#39;bar&gt;=1&#39;

#   Failed test &#39;query8 fuzzy int no wildcard string&#39;
#   at t/01-parser.t line 98.
#          got: &#39;bar&lt;=1&#39;
#     expected: &#39;bar&gt;=1&#39;
# Looks like you failed 2 tests of 30.
t/01-parser.t ..... Dubious, test returned 2 &#40;wstat 512, 0x200&#41;
Failed 2/30 subtests
t/02-dbi.t ........ 1/29
#   Failed test &#39;parser4_query dbi-&gt;[0]&#39;
#   at t/02-dbi.t line 91.
#          got: &#39;foo ILIKE ? AND bar&lt;=? AND dt&lt;=?&#39;
#     expected: &#39;foo ILIKE ? AND bar&gt;=? AND dt&gt;=?&#39;
# Looks like you failed 1 test of 29.
t/02-dbi.t ........ Dubious, test returned 1 &#40;wstat 256, 0x100&#41;
Failed 1/29 subtests
t/03-orm.t ........ 1/23
#   Failed test &#39;parser4_query string&#39;
#   at t/03-orm.t line 183.
#     Structures begin differing at:
#          $got-&gt;[1][3]{ge} = Does not exist
#     $expected-&gt;[1][3]{ge} = &#39;123&#39;
# Looks like you failed 1 test of 23.
t/03-orm.t ........ Dubious, test returned 1 &#40;wstat 256, 0x100&#41;
Failed 1/23 subtests


pek
-- 
Peter Karman  .  <span class="clickylink"><a target="new" rel="nofollow" href="http://peknet.com/">http://peknet.com/</a></span>  .  peter@peknet.com
gpg key: 37D2 DAA6 3A13 D415 4295  3A69 448F E556 374A 34D9
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;23&nbsp;02:02:43&nbsp;2009</span>
    <span class="description">slagelwa [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks Peter for creating this module and John for your efforts to
enhance it.  I&#39;m stuck with the same new features you need.  I
downloaded and tried your patches, and found that all of the tests worked.  

 On Wed Jun 17 21:57:19 2009, peter@peknet.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; John Maslanik via RT wrote on 6/17/09 1:21 AM:
<div class="message-stanza open">&gt; &gt;        Queue: Search-QueryParser-SQL
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=46881">https://rt.cpan.org/Ticket/Display.html?id=46881</a></span> &gt;
&gt; &gt; 
&gt; &gt; Peter,
&gt; &gt; 
&gt; &gt; Attached or modified Query.pm and SQL.pm files.  They are modified  
&gt; &gt; from the cvs link below.  The following features and/or bug fixes are  
&gt; &gt; added.
&gt; &gt; 
&gt; &gt; 1.  Added &#34;aliases&#34; option to the constructor.  If passed, column  
&gt; &gt; names will be transformed in accordance with the alias hash.
&gt; &gt; 2.  Added int_op option to the constructor.  This sets what default  
&gt; &gt; operator to use for int fields.  There was also a bug where the int  
&gt; &gt; operator was set to GT, this is not valid for mysql.
&gt; &gt; 3.  Made -keyword queries work.  This consists of setting &#34;NOT $like&#34;  
&gt; &gt; when the $prefix is &#39;-&#39; and joining sub queries with &#34;AND&#34; instead of  
&gt; &gt; OR when the $prefix is &#39;-&#39;, it also sets op to != for ints.
&gt; &gt; 4.  In the unwind_subQ function, $like had padding added twice when  
&gt; &gt; doing the int check.
&gt; &gt; 
&gt; &gt; Let me know how it looks.
&gt; &gt; 
</div>&gt; 
&gt; John,
&gt; 
&gt; Thanks for the patches.
&gt; 
&gt; First, those look like decent changes, but it&#39;s hard to tell without
</div>tests.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt;&gt; be sure to include tests and docs for the new features.
</div>&gt; 
&gt; I didn&#39;t see those.
&gt; 
&gt; Second, those patches cause 4 existing tests to fail. Output below:
&gt; 
&gt; t/00-load.t ....... 1/1 # Testing Search::QueryParser::SQL 0.008
&gt; t/00-load.t ....... ok
&gt; t/01-parser.t ..... 1/30
&gt; #   Failed test &#39;query8 fuzzy int with wildcard string&#39;
&gt; #   at t/01-parser.t line 94.
&gt; #          got: &#39;bar&lt;=1&#39;
&gt; #     expected: &#39;bar&gt;=1&#39;
&gt; 
&gt; #   Failed test &#39;query8 fuzzy int no wildcard string&#39;
&gt; #   at t/01-parser.t line 98.
&gt; #          got: &#39;bar&lt;=1&#39;
&gt; #     expected: &#39;bar&gt;=1&#39;
&gt; # Looks like you failed 2 tests of 30.
&gt; t/01-parser.t ..... Dubious, test returned 2 &#40;wstat 512, 0x200&#41;
&gt; Failed 2/30 subtests
&gt; t/02-dbi.t ........ 1/29
&gt; #   Failed test &#39;parser4_query dbi-&gt;[0]&#39;
&gt; #   at t/02-dbi.t line 91.
&gt; #          got: &#39;foo ILIKE ? AND bar&lt;=? AND dt&lt;=?&#39;
&gt; #     expected: &#39;foo ILIKE ? AND bar&gt;=? AND dt&gt;=?&#39;
&gt; # Looks like you failed 1 test of 29.
&gt; t/02-dbi.t ........ Dubious, test returned 1 &#40;wstat 256, 0x100&#41;
&gt; Failed 1/29 subtests
&gt; t/03-orm.t ........ 1/23
&gt; #   Failed test &#39;parser4_query string&#39;
&gt; #   at t/03-orm.t line 183.
&gt; #     Structures begin differing at:
&gt; #          $got-&gt;[1][3]{ge} = Does not exist
&gt; #     $expected-&gt;[1][3]{ge} = &#39;123&#39;
&gt; # Looks like you failed 1 test of 23.
&gt; t/03-orm.t ........ Dubious, test returned 1 &#40;wstat 256, 0x100&#41;
&gt; Failed 1/23 subtests
&gt; 
&gt; 
&gt; pek
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;25&nbsp;23:21:08&nbsp;2009</span>
    <span class="description">peter [...] peknet.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #46881] INTs are being fuzzified</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 25 Jun 2009 22:20:48 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Search-QueryParser-SQL [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Karman &lt;peter [...] peknet.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Joe Slagel via RT wrote on 6/23/09 1:02 AM:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Search-QueryParser-SQL
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=46881">https://rt.cpan.org/Ticket/Display.html?id=46881</a></span> &gt;
&gt; 
&gt; Thanks Peter for creating this module and John for your efforts to
&gt; enhance it.  I&#39;m stuck with the same new features you need.  I
&gt; downloaded and tried your patches, and found that all of the tests worked.  
</div>
yes, John&#39;s patches will pass against the tests in the released CPAN version
0.007. But they do not pass the tests in svn trunk here:

<span class="clickylink"><a target="new" rel="nofollow" href="https://svn.msi.umn.edu/sw/perl/Search-QueryParser-SQL/trunk">https://svn.msi.umn.edu/sw/perl/Search-QueryParser-SQL/trunk</a></span>


-- 
Peter Karman  .  <span class="clickylink"><a target="new" rel="nofollow" href="http://peknet.com/">http://peknet.com/</a></span>  .  peter@peknet.com
gpg key: 37D2 DAA6 3A13 D415 4295  3A69 448F E556 374A 34D9
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;25&nbsp;23:25:46&nbsp;2009</span>
    <span class="description">maz [...] mlx.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #46881] INTs are being fuzzified</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 26 Jun 2009 11:25:19 +0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Search-QueryParser-SQL [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Maslanik &lt;maz [...] mlx.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">They don&#39;t pass the svn trunk because of a difference in the  
defaulting of the int operators  &#39;&lt;=&#39; vs &#39;&gt;=&#39;.  If you change the  
default to what the test expects, it will work.  As soon as I find  
some spare time, I&#39;ll write tests for the other new features.

John

On Jun 26, 2009, at 11:21 AM, peter@peknet.com via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=46881">http://rt.cpan.org/Ticket/Display.html?id=46881</a></span> &gt;
&gt;
&gt; Joe Slagel via RT wrote on 6/23/09 1:02 AM:
<div class="message-stanza open">&gt;&gt;       Queue: Search-QueryParser-SQL
&gt;&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=46881">https://rt.cpan.org/Ticket/Display.html?id=46881</a></span> &gt;
&gt;&gt;
&gt;&gt; Thanks Peter for creating this module and John for your efforts to
&gt;&gt; enhance it.  I&#39;m stuck with the same new features you need.  I
&gt;&gt; downloaded and tried your patches, and found that all of the tests  
&gt;&gt; worked.
</div>&gt;
&gt; yes, John&#39;s patches will pass against the tests in the released CPAN  
&gt; version
&gt; 0.007. But they do not pass the tests in svn trunk here:
&gt;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://svn.msi.umn.edu/sw/perl/Search-QueryParser-SQL/trunk">https://svn.msi.umn.edu/sw/perl/Search-QueryParser-SQL/trunk</a></span>
&gt;
&gt;
&gt; -- 
&gt; Peter Karman  .  <span class="clickylink"><a target="new" rel="nofollow" href="http://peknet.com/">http://peknet.com/</a></span>  .  peter@peknet.com
&gt; gpg key: 37D2 DAA6 3A13 D415 4295  3A69 448F E556 374A 34D9
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;25&nbsp;23:34:36&nbsp;2009</span>
    <span class="description">peter [...] peknet.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #46881] INTs are being fuzzified</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 25 Jun 2009 22:34:17 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Search-QueryParser-SQL [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Karman &lt;peter [...] peknet.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">John Maslanik via RT wrote on 6/25/09 10:25 PM:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Search-QueryParser-SQL
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=46881">http://rt.cpan.org/Ticket/Display.html?id=46881</a></span> &gt;
&gt; 
&gt; They don&#39;t pass the svn trunk because of a difference in the  
&gt; defaulting of the int operators  &#39;&lt;=&#39; vs &#39;&gt;=&#39;.  If you change the  
&gt; default to what the test expects, it will work.  As soon as I find  
&gt; some spare time, I&#39;ll write tests for the other new features.
&gt; 
</div>
ah, ok. I see that change with the int operator. Which brings up a good point.
My assumption was that a query like:

 1*

means:

 match 1 or 10 or 1nnnnnn

i.e., &gt;= 1

but your change means it will render as:

 &lt;= 1

which doesn&#39;t seem right to me. I.e.,

 match 1 or 0 or -6534.

I guess the wildcard in a numerical context is open to interpretation. Same
thing with dates. I assume that:

 2009-*

means:

 match any date in 2009

so should probably be expanded to:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"> &gt;= 2009-01-01 AND &lt;= 2009-12-31
</div>

So what should the behavior be? I&#39;m not saying that &gt;= is correct, but &lt;= seems
less correct.

-- 
Peter Karman  .  <span class="clickylink"><a target="new" rel="nofollow" href="http://peknet.com/">http://peknet.com/</a></span>  .  peter@peknet.com
gpg key: 37D2 DAA6 3A13 D415 4295  3A69 448F E556 374A 34D9
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;26&nbsp;02:31:15&nbsp;2009</span>
    <span class="description">maz [...] mlx.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #46881] INTs are being fuzzified</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 26 Jun 2009 14:30:46 +0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Search-QueryParser-SQL [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Maslanik &lt;maz [...] mlx.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Peter,

LOL.  My assumptions were based on thing like year_issued and price,  
with a default sort of ascending.  So if someone entered $100, the  
first in the list would be 100.  I figured everyone would have a  
difference of opinion as to what the default int operator should be,  
which is why I added the &#39;int_op&#39; option to the constructor.  Could  
also depend on the application.  I could imagine a status field  
rendered by a select box being &#39;=&#39; and not &lt; or &gt;.

John



On Jun 26, 2009, at 11:34 AM, peter@peknet.com via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=46881">https://rt.cpan.org/Ticket/Display.html?id=46881</a></span> &gt;
&gt;
&gt; John Maslanik via RT wrote on 6/25/09 10:25 PM:
<div class="message-stanza open">&gt;&gt;       Queue: Search-QueryParser-SQL
&gt;&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=46881">http://rt.cpan.org/Ticket/Display.html?id=46881</a></span> &gt;
&gt;&gt;
&gt;&gt; They don&#39;t pass the svn trunk because of a difference in the
&gt;&gt; defaulting of the int operators  &#39;&lt;=&#39; vs &#39;&gt;=&#39;.  If you change the
&gt;&gt; default to what the test expects, it will work.  As soon as I find
&gt;&gt; some spare time, I&#39;ll write tests for the other new features.
&gt;&gt;
</div>&gt;
&gt; ah, ok. I see that change with the int operator. Which brings up a  
&gt; good point.
&gt; My assumption was that a query like:
&gt;
&gt; 1*
&gt;
&gt; means:
&gt;
&gt; match 1 or 10 or 1nnnnnn
&gt;
&gt; i.e., &gt;= 1
&gt;
&gt; but your change means it will render as:
&gt;
&gt; &lt;= 1
&gt;
&gt; which doesn&#39;t seem right to me. I.e.,
&gt;
&gt; match 1 or 0 or -6534.
&gt;
&gt; I guess the wildcard in a numerical context is open to  
&gt; interpretation. Same
&gt; thing with dates. I assume that:
&gt;
&gt; 2009-*
&gt;
&gt; means:
&gt;
&gt; match any date in 2009
&gt;
&gt; so should probably be expanded to:
&gt;
<div class="message-stanza open">&gt;&gt; = 2009-01-01 AND &lt;= 2009-12-31
</div>&gt;
&gt;
&gt; So what should the behavior be? I&#39;m not saying that &gt;= is correct,  
&gt; but &lt;= seems
&gt; less correct.
&gt;
&gt; -- 
&gt; Peter Karman  .  <span class="clickylink"><a target="new" rel="nofollow" href="http://peknet.com/">http://peknet.com/</a></span>  .  peter@peknet.com
&gt; gpg key: 37D2 DAA6 3A13 D415 4295  3A69 448F E556 374A 34D9
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;26&nbsp;11:45:05&nbsp;2009</span>
    <span class="description">peter [...] peknet.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #46881] INTs are being fuzzified</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 26 Jun 2009 10:44:38 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Search-QueryParser-SQL [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Karman &lt;peter [...] peknet.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">John Maslanik via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Search-QueryParser-SQL
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=46881">https://rt.cpan.org/Ticket/Display.html?id=46881</a></span> &gt;
&gt; 
&gt; Peter,
&gt; 
&gt; LOL.  My assumptions were based on thing like year_issued and price,  
&gt; with a default sort of ascending.  So if someone entered $100, the  
&gt; first in the list would be 100.  I figured everyone would have a  
&gt; difference of opinion as to what the default int operator should be,  
&gt; which is why I added the &#39;int_op&#39; option to the constructor.  Could  
&gt; also depend on the application.  I could imagine a status field  
&gt; rendered by a select box being &#39;=&#39; and not &lt; or &gt;.
&gt; 
&gt;
</div>
Ah, ok. I see now where you&#39;re coming from.

Seems like each column should have a optional hashref of config, including:

  fuzzy_op
  fuzzy_not_op
  type

where if type is set and others are not, there are some sane defaults.

I&#39;ll try and refactor that direction this weekend.


-- 
Peter Karman  .  <span class="clickylink"><a target="new" rel="nofollow" href="http://peknet.com/">http://peknet.com/</a></span>  .  peter@peknet.com
gpg key: 37D2 DAA6 3A13 D415 4295  3A69 448F E556 374A 34D9
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;27&nbsp;16:17:01&nbsp;2009</span>
    <span class="description">peter [...] peknet.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #46881] INTs are being fuzzified</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 27 Jun 2009 15:16:41 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Search-QueryParser-SQL [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Karman &lt;peter [...] peknet.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">John Maslanik via RT wrote on 6/15/09 7:52 AM:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I would love to change columns to be something like:
&gt; 
&gt; $columns = {
&gt;       &#39;column_name&#39; =&gt; {
&gt;               &#39;type&#39; =&gt; &#39;int|char|etc&#34;,
&gt;               &#39;alias&#39; =&gt; &#39;name to use for sql query&#39;,
&gt;               &#39;op&#39; =&gt; &#39;name of op to force&#39;,
&gt;               &#39;callback&#39; =&gt; &#39;call to function that takes $column, $op, and $value  
&gt; and returns what&#39;s pushed on to buf&#39;
&gt;       }
&gt; }
</div>
I just checked in an implementation very similar to this.

Please try svn trunk and see if it works for you:

<span class="clickylink"><a target="new" rel="nofollow" href="https://svn.msi.umn.edu/sw/perl/Search-QueryParser-SQL/trunk/">https://svn.msi.umn.edu/sw/perl/Search-QueryParser-SQL/trunk/</a></span>

Trac changeset:

<span class="clickylink"><a target="new" rel="nofollow" href="https://trac.msi.umn.edu/trac/sw/changeset/539">https://trac.msi.umn.edu/trac/sw/changeset/539</a></span>

If the new API works for you, I&#39;ll upload to CPAN as 0.008.

Thanks.

-- 
Peter Karman  .  <span class="clickylink"><a target="new" rel="nofollow" href="http://peknet.com/">http://peknet.com/</a></span>  .  peter@peknet.com
gpg key: 37D2 DAA6 3A13 D415 4295  3A69 448F E556 374A 34D9
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;13&nbsp;13:25:30&nbsp;2009</span>
    <span class="description">peter [...] peknet.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #46881] INTs are being fuzzified</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 13 Jul 2009 12:24:54 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Search-QueryParser-SQL [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Karman &lt;peter [...] peknet.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">peter@peknet.com via RT wrote on 06/27/2009 03:17 PM:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Please try svn trunk and see if it works for you:
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://svn.msi.umn.edu/sw/perl/Search-QueryParser-SQL/trunk/">https://svn.msi.umn.edu/sw/perl/Search-QueryParser-SQL/trunk/</a></span>
</div>
Just tickling this rt ticket to see if you&#39;ve had a chance to test svn.


-- 
Peter Karman  .  <span class="clickylink"><a target="new" rel="nofollow" href="http://peknet.com/">http://peknet.com/</a></span>  .  peter@peknet.com
gpg key: 37D2 DAA6 3A13 D415 4295  3A69 448F E556 374A 34D9
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;19&nbsp;00:03:18&nbsp;2009</span>
    <span class="description">karman [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">no response. uploaded 0.008 to pause just now to let the cpantesters
smoke it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;19&nbsp;00:03:19&nbsp;2009</span>
    <span class="description">karman [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
