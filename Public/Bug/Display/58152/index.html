<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #58152 for Image-ExifTool: png tEXt vs iTXt</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #58152 for Image-ExifTool: png tEXt vs iTXt</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Image-ExifTool/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Image-ExifTool/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Image-ExifTool/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Image-ExifTool/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Image-ExifTool">Image-ExifTool CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">58152</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">3 hours (180 min)

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Image-ExifTool/Active/">Image-ExifTool</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">EXIFTOOL [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
user42 [...] zip.com.au

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-16626-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-16627-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
8.25    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;04&nbsp;19:30:30&nbsp;2010</span>
    <span class="description">user42 [...] zip.com.au -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> png tEXt vs iTXt</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 05 Jun 2010 09:30:10 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Image-ExifTool [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">In the ImageInfo&#40;&#41; from a png file, is it possible to tell when a tag
was an iTXt as opposed to a tEXt?

I hoped to see something about that in the pod of Image::ExifTool::PNG
perhaps.  I think it&#39;s fairly important since a tEXt is supposed to be
latin-1 whereas an iTXt is supposed to be utf-8, so you have to know
which it is to print or display the bytes correctly &#40;if the ImageInfo
always returns bytes&#41;.

iTXt is rather rare, but it&#39;d be good to be able to do the right thing
with it.  I suppose there&#39;s a language and translated tag name in it too
though I&#39;m not particularly interested in those.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;05&nbsp;07:16:56&nbsp;2010</span>
    <span class="description">EXIFTOOL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for pointing this out.  ExifTool should be doing this conversion for you.  I will add the 
ability to translate PNG encodings properly so you don&#39;t have to worry about this.  Also, I 
probably should be handling the PNG alternate languages properly &#40;as I am doing with XMP&#41;, 
but maybe it can wait until I actually see an example of this used in the wild. :&#41;

- Phil
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;05&nbsp;07:16:57&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Give even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;05&nbsp;07:16:57&nbsp;2010</span>
    <span class="description">EXIFTOOL [...] cpan.org -  Given to EXIFTOOL</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;05&nbsp;07:17:53&nbsp;2010</span>
    <span class="description">EXIFTOOL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for pointing this out.  ExifTool should be doing this conversion for you.  I will add the 
ability to translate PNG encodings properly so you don&#39;t have to worry about this.  Also, I 
probably should be handling the PNG alternate languages properly &#40;as I am doing with XMP&#41;, 
but maybe it can wait until I actually see an example of this used in the wild. :&#41;

- Phil
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;05&nbsp;07:21:40&nbsp;2010</span>
    <span class="description">EXIFTOOL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for pointing this out.  ExifTool should be doing this conversion for you.  I will add the 
ability to translate PNG encodings properly so you don&#39;t have to worry about this.  Also, I 
probably should be handling the PNG alternate languages properly &#40;as I am doing with XMP&#41;, 
but maybe it can wait until I actually see an example of this used in the wild. :&#41;

- Phil
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;07&nbsp;19:41:52&nbsp;2010</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #58152] png tEXt vs iTXt</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 08 Jun 2010 09:40:45 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Image-ExifTool [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Phil Harvey via RT&#34; &lt;bug-Image-ExifTool@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; ExifTool should be doing this conversion for you.
</div>
I saw the pod &#34;Notes:&#34; bit saying all returns are bytes.  I suppose if
there&#39;s a chance of bad encoding in the file that lets you see the raw
stuff.  Maybe a conversion would have to be an option to be upwardly
compatible.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I will add the ability to translate PNG encodings properly so you
&gt; don&#39;t have to worry about this.
</div>
For myself I just wanted to pick out the Title decoded to perl
wide-chars to display &#40;in a mail message as it happens&#41;.  For bad bytes
I would probably go for either escapes or substitutions
&#40;Encode::FB_PERLQQ perhaps&#41;, but maybe others would want an error throw
to not let bad inputs go unnoticed.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; XMP
</div>
I don&#39;t think I know anything about that. :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;08&nbsp;08:30:24&nbsp;2010</span>
    <span class="description">EXIFTOOL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">180 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jun 07 19:41:52 2010, user42@zip.com.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I saw the pod &#34;Notes:&#34; bit saying all returns are bytes. 
</div>
Yes.  All this means is that the utf8 flag will not be set on returned strings, even if they are UTF-8.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I suppose if
&gt; there&#39;s a chance of bad encoding in the file that lets you see the raw
&gt; stuff.  Maybe a conversion would have to be an option to be upwardly
&gt; compatible.
</div>
I agree that this isn&#39;t upwardly compatible, but in the past changes like this have solved more problems than they have 
caused because most people won&#39;t be handling the character encoding themselves.  And in this case, as you point out, 
the encoding can&#39;t be handled properly because you don&#39;t know if it is UTF-8 &#40;iTXt&#41; or Latin &#40;tEXt/zTXt&#41;.

I have gone ahead and made this change.  Also, while I was at it I added alternate language support.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; For myself I just wanted to pick out the Title decoded to perl
&gt; wide-chars to display &#40;in a mail message as it happens&#41;.  For bad bytes
&gt; I would probably go for either escapes or substitutions
&gt; &#40;Encode::FB_PERLQQ perhaps&#41;, but maybe others would want an error throw
&gt; to not let bad inputs go unnoticed.
</div>
ExifTool will convert bad characters to question marks without issuing a warning.

- Phil

P.S.  Sorry about the multiple copies of my last post.  That&#39;s what I get for using the web interface with an unreliable 
internet connection.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;09&nbsp;08:53:02&nbsp;2010</span>
    <span class="description">EXIFTOOL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have just released version 8.22 which should handle special PNG characters properly.

Also, I was wrong about what I said before regarding the warning.  A Warning tag &#40;&#34;Malformed 
UTF-8 character&#40;s&#41;&#34;&#41; is generated if ExifTool tries to convert bad UTF-8.  However, under normal 
conditions no conversion of UTF-8 is done since ExifTool&#39;s default character set is UTF-8.

- Phil
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;10&nbsp;20:14:28&nbsp;2010</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #58152] png tEXt vs iTXt</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 11 Jun 2010 10:13:28 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Image-ExifTool [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Phil Harvey via RT&#34; &lt;bug-Image-ExifTool@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; All this means is that the utf8 flag will not be set on returned
&gt; strings, even if they are UTF-8.
</div>
Ah, I didn&#39;t understand that.  I took the pod to mean the return was
bytes, raw and undecoded, straight from the image file&#39;s format.

You might make it clearer by saying the returns are byte strings of utf8
encoded characters recoded where necessary/appropriate/whatever from the
image file&#39;s native format.  Or where the format specifies an encoding,
or where the fields are characters, or whatnot ...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;11&nbsp;07:45:12&nbsp;2010</span>
    <span class="description">EXIFTOOL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I will try to make it clearer, but am struggling a bit
with the wording.  How is this?:

ExifTool returns all values as byte strings of encoded characters, not as
Perl character strings with wide characters.  For tags which are translated,
the encoding is set by the Charset option. See FAQ number 10 in
html/faq.html of the ExifTool distribution for more details about character
encodings.

- Phil
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;14&nbsp;20:09:35&nbsp;2010</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #58152] png tEXt vs iTXt</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 15 Jun 2010 10:08:26 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Image-ExifTool [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Phil Harvey via RT&#34; &lt;bug-Image-ExifTool@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; ExifTool returns all values as byte strings of encoded characters, not as
&gt; Perl character strings with wide characters.  For tags which are translated,
&gt; the encoding is set by the Charset option.
</div>
I didn&#39;t at first understand what &#34;translated&#34;.  Perhaps

    ExifTool returns all values as byte strings.  If the file format has
    a specified character encoding then strings are re-coded from that
    to UTF8 bytes, or to bytes of the requested Charset option.  If the
    format doesn&#39;t have a specified encoding then the bytes are directly
    from the file.  Perl wide characters are not used.

Is this true though?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; See FAQ number 10 in
&gt; html/faq.html of the ExifTool distribution for more details about character
&gt; encodings.
</div>
I wonder if some of that would go in the pod somewhere.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;15&nbsp;07:49:26&nbsp;2010</span>
    <span class="description">EXIFTOOL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the good suggestions.

On Mon Jun 14 20:09:35 2010, user42@zip.com.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Is this true though?
</div>
This is the way things are going, and the major metadata formats now
have this behaviour, but I haven&#39;t implemented this for all formats yet.
Originally, there was no re-coding of 8-bit character sets.  I want to
keep this section short, so maybe something like this:

&#34;ExifTool returns all values as byte strings.  Perl wide characters are not
used.  See CHARACTER ENCODINGS for details about the encodings.&#34;

And the CHARACTER ENCODINGS section will duplicate most of the
information in FAQ 10.

- Phil
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;15&nbsp;11:23:16&nbsp;2010</span>
    <span class="description">EXIFTOOL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">And here is POD source for the new section I am considering:

=head1 CHARACTER ENCODINGS

Certain meta information formats allow coded character sets other than plain
ASCII.  When reading, 8-bit encodings are passed straight through ExifTool
without re-coding unless specified otherwise below, and multi-byte encodings
are converted according to the L&lt;/Charset&gt; option &#40;&#39;UTF8&#39; by default&#41;.  When
writing, the inverse conversions are performed.  See the L&lt;/Charset&gt; option
for a list of valid character sets.

More specific details are given below about how character coding is handled
for EXIF, IPTC, XMP, PNG, ID3, PDF and MIE information:

=head2 EXIF

Most textual information in EXIF is stored in ASCII format, and ExifTool
does not convert these tags.  However it is not uncommon for applications to
write UTF-8 or other encodings where ASCII is expected, and ExifTool will
quite happily read/write any encoding without conversion.  For a few EXIF
tags &#40;UserComment, GPSProcessingMethod and GPSAreaInformation&#41; the stored
text may be encoded either in ASCII, Unicode &#40;UCS-2&#41; or JIS.  When reading
these tags, Unicode and JIS are converted to the character set specified by
the L&lt;/Charset&gt; option.  Other encodings are not converted.  When writing,
text is stored as ASCII unless the string contains special characters, in
which case it is converted from the specified character set and stored as
Unicode.  ExifTool writes Unicode in native EXIF byte ordering by default,
but this may be changed by setting the ExifUnicodeByteOrder tag.  The EXIF
&#34;XP&#34; tags &#40;XPTitle, XPComment, etc&#41; are always stored as little-endian
Unicode, and are read and written using the specified character set.

=head2 IPTC

The value of the IPTC:CodedCharacterSet tag determines how the internal IPTC
string values are interpreted.  If CodedCharacterSet exists and has a value
of &#39;UTF8&#39; &#40;or &#39;ESC % G&#39;&#41; then string values are assumed to be stored as
UTF-8, otherwise Windows Latin1 &#40;cp1252, &#39;Latin&#39;&#41; coding is assumed by
default, but this can be changed with the L&lt;/CharsetIPTC&gt; option.  When
reading, these strings are converted to the character set specified by the
L&lt;/Charset&gt; option.  When writing, the inverse conversions are performed. 
No conversion is done if the internal &#40;IPTC&#41; and external &#40;ExifTool&#41;
character sets are the same.  Note that ISO 2022 character set shifting is
not supported.  Instead, a warning is issued and the string is not converted
if an ISO 2022 shift code is found.  See L&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.iptc.org/IIM/">http://www.iptc.org/IIM/</a></span>&gt; for the
official IPTC specification.

=head2 XMP

Exiftool reads XMP encoded as UTF-8, UTF-16 or UTF-32, and converts them all
to UTF-8 internally.  Also, all XML character entity references and numeric
character references are converted.  When writing, ExifTool always encodes
XMP as UTF-8, converting the following 5 characters to XML character
references: E&lt;amp&gt; E&lt;lt&gt; E&lt;gt&gt; E&lt;39&gt; E&lt;quot&gt;.  By default no further
conversion is performed, however if the L&lt;/Charset&gt; option is other than
&#39;UTF8&#39; then text is converted to/from a specified character set when
reading/writing.

=head2 PNG

L&lt;PNG TextualData tags|Image::ExifTool::TagNames/&#34;PNG TextualData Tags&#34;&gt; are
stored as tEXt, zTXt and iTXt chunks in PNG images.  The tEXt and zTXt
chunks use ISO 8859-1 encoding, while iTXt uses UTF-8.  When reading,
ExifTool converts all PNG textual data to the character set specified by the
L&lt;/Charset&gt; option.  When writing, ExifTool generates a tEXt chunk &#40;or zTXt
with the L&lt;/Compress&gt; option&#41; if the text doesn&#39;t contain special characters
or if Latin encoding is specified; otherwise an iTXt chunk is used and the
text is converted from the specified character set and stored as UTF-8.

=head2 ID3

The ID3v1 specification officially supports only ISO 8859-1 encoding &#40;a
subset of Windows Latin1&#41;, although some applications may incorrectly use
other character sets.  By default ExifTool converts ID3v1 text from Latin to
the character set specified by the &lt;/Charset&gt; option.  However, the internal
ID3v1 charset may be specified with the L&lt;/CharsetID3&gt; option.  The encoding
for ID3v2 information is stored in the file, so ExifTool converts ID3v2 text
from this encoding to the character set specified by the L&lt;/Charset&gt; option.
ExifTool does not currently write ID3 information.

=head2 PDF

PDF text strings are stored in either PDFDocEncoding &#40;similar to Windows
Latin1&#41; or Unicode &#40;UCS-2&#41;.  When reading, ExifTool converts to the
character set specified by the L&lt;/Charset&gt; option.  When writing, ExifTool
encodes input text from the specified character set as Unicode only if the
string contains special characters, otherwise PDFDocEncoding is used.

=head2 MIE

MIE strings are stored as either UTF-8 or ISO 8859-1. When reading, UTF-8
strings are converted according to the L&lt;/Charset&gt; option, and ISO 8859-1
strings are never converted.  When writing, input strings are converted from
the specified character set to UTF-8.  The resulting strings are stored as
UTF-8 if they contain multi-byte UTF-8 character sequences, otherwise they
are stored as ISO 8859-1.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;15&nbsp;19:37:04&nbsp;2010</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #58152] png tEXt vs iTXt</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 16 Jun 2010 09:35:51 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Image-ExifTool [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Phil Harvey via RT&#34; &lt;bug-Image-ExifTool@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; And here is POD source for the new section I am considering:
</div>
Looks good.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; When reading, 8-bit encodings are passed straight through ExifTool
&gt; without re-coding unless specified otherwise below, and multi-byte encodings
&gt; are converted according to the L&lt;/Charset&gt; option &#40;&#39;UTF8&#39; by default&#41;.
</div>
I wonder if I still need to know whether conversion has been done,
ie. whether the string is in the requested Charset, or is raw and
perhaps unknown.  You&#39;d be tempted to have a Charset=&gt;&#39;wide&#39; or some
such for new enough perl to ask for wide returns for converted strings.

&#40;As I said first I&#39;m only looking to display a couple of strings in a
mail message.  The same would apply for getting non-ascii to display
nicely in say a gtk gui or whatnot.&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;16&nbsp;08:58:50&nbsp;2010</span>
    <span class="description">EXIFTOOL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jun 15 19:37:04 2010, user42@zip.com.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I wonder if I still need to know whether conversion has been done,
&gt; ie. whether the string is in the requested Charset, or is raw and
&gt; perhaps unknown.  You&#39;d be tempted to have a Charset=&gt;&#39;wide&#39; or some
&gt; such for new enough perl to ask for wide returns for converted
&gt; strings.
</div>
If you just treat all returned text as UTF-8 encoded &#40;with Charset set to the default of &#39;UTF8&#39;&#41;, 
you can&#39;t go far wrong.  There are some exceptions of course, but if you want to be really safe 
you can add your own test for valid UTF-8.  I really don&#39;t want to add something like a Wide 
setting as you suggest unless absolutely necessary.

- Phil
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;14&nbsp;08:01:58&nbsp;2010</span>
    <span class="description">EXIFTOOL [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;14&nbsp;08:01:58&nbsp;2010</span>
    <span class="description">EXIFTOOL [...] cpan.org -  Fixed in 8.25 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
