<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #40976 for ExtUtils-Install: New files installed without user-write permission</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #40976 for ExtUtils-Install: New files installed without user-write permission</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=ExtUtils-Install">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=ExtUtils-Install">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=ExtUtils-Install">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=ExtUtils-Install">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/ExtUtils-Install">ExtUtils-Install CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">40976</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=ExtUtils-Install">ExtUtils-Install</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
grousse [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-39112-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.52    </td>
  </tr>
  <tr id="CF-39113-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
2.16    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




0001-Preserve-write-permission-and-apply-umask.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1874061/1005992/0001-Preserve-write-permission-and-apply-umask.patch">
Thu Dec 05 12:38:37 2019 (3k) by ppisar [...] redhat.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=40976">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-533686" href="/Public/Bug/Display.html?id=40976#txn-533686">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;16&nbsp;13:41:21&nbsp;2008</span>
    <span class="description">grousse [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> New files installed without user-write permission</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/533686/267623/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/267623">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 911b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">All new files installed through ExtUtils::MakeMaker-generated makefiles
are installed without user-writable permission bit set. As a
consequence, all attempt to modify them during installation with a
non-privilegiated user &#40;typically, package building&#41; fails. PDL
installation is a good example:

couldn&#39;t open
/home/guillomovitch/cooker/perl-PDL/BUILDROOT/perl-PDL-2.4.4/usr/lib/perl5/vendor_perl/5.10.0/i386-linux-thread-multi/PDL/Index.pod
at Doc/scantree.pl line 44.

[guillomovitch@n2 perl-PDL]$ ll 
/home/guillomovitch/cooker/perl-PDL/BUILDROOT/perl-PDL-2.4.4/usr/lib/perl5/vendor_perl/5.10.0/i386-linux-thread-multi/PDL/Index.pod

-r--r--r-- 1 guillomovitch users 10763 2008-11-16 19:23
/home/guillomovitch/cooker/perl-PDL/BUILDROOT/perl-PDL-2.4.4/usr/lib/perl5/vendor_perl/5.10.0/i386-linux-thread-multi/PDL/Index.pod


Removing 1.52 version, so as to use perl-5.10 provided 1.44 version, fix
the issue.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-714509" href="/Public/Bug/Display.html?id=40976#txn-714509">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;03&nbsp;04:43:44&nbsp;2010</span>
    <span class="description">jquelin [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/714509/368754/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/368754">with headers</a>
<br />
<span class="downloadcontenttype">text/html 389b</span>
</div>
<div class="messagebody">
<div class="message-stanza">On Sun Nov 16 13:41:21 2008, GROUSSE wrote: <br>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; All new files installed through ExtUtils::MakeMaker-generated <br>

&gt; makefiles are installed without user-writable permission bit set.<br>
</div>[...]<br>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Removing 1.52 version, so as to use perl-5.10 provided 1.44 version, <br>

&gt; fix the issue. <br>
</div><br>

seems to be fixed with extutils::makemaker 1.54<br>

<br>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-714512" href="/Public/Bug/Display.html?id=40976#txn-714512">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;03&nbsp;04:43:45&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1434257" href="/Public/Bug/Display.html?id=40976#txn-1434257">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;17&nbsp;21:38:52&nbsp;2014</span>
    <span class="description">jkeenan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1434257/762397/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/762397">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 498b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Jan 03 04:43:44 2010, JQUELIN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sun Nov 16 13:41:21 2008, GROUSSE wrote:
<div class="message-stanza open">&gt; &gt; All new files installed through ExtUtils::MakeMaker-generated
&gt; &gt; makefiles are installed without user-writable permission bit set.
</div>&gt; [...]
<div class="message-stanza open">&gt; &gt; Removing 1.52 version, so as to use perl-5.10 provided 1.44 version,
&gt; &gt; fix the issue.
</div>&gt; 
&gt; seems to be fixed with extutils::makemaker 1.54
</div>

The original poster appears to have been satisfied.  This ticket should be closable.

Thank you very much.
Jim Keenan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1509819" href="/Public/Bug/Display.html?id=40976#txn-1509819">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;19&nbsp;07:48:43&nbsp;2015</span>
    <span class="description">MAT [...] cpan.fsck.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1509819/804979/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/804979">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 751b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le Dim 16 Nov 2008 13:41:21, GROUSSE a écrit :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; All new files installed through ExtUtils::MakeMaker-generated
&gt; makefiles
&gt; are installed without user-writable permission bit set. As a
&gt; consequence, all attempt to modify them during installation with a
&gt; non-privilegiated user &#40;typically, package building&#41; fails. PDL
&gt; installation is a good example:
</div>
I have the same problem, building a package as an unprivileged user, we end up with all files being installed a 444 or 555 &#40;say, for .so&#41;, and then, if we want to strip the .so, it fails because strip can&#39;t write to the file, because it&#39;s not writable.

Changing the line &#40;~812&#41; &#34;$mode = 0444 | &#40; $mode &#38; 0111 ? 0111 : 0 &#41;;&#34; to &#34;$mode = 0644 | &#40; $mode &#38; 0111 ? 0111 : 0 &#41;;&#34;

Fixes the problem.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1874044" href="/Public/Bug/Display.html?id=40976#txn-1874044">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;05&nbsp;10:47:07&nbsp;2019</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1874044/1005978/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1005978">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne Ne 16.lis.2008 13:41:21, GROUSSE napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; All new files installed through ExtUtils::MakeMaker-generated
&gt; makefiles
&gt; are installed without user-writable permission bit set.
</div>
ExtUtils::Install 2.14 POD reads:

        Copies each directory tree of %from_to to its corresponding value
        preserving timestamps and permissions.

Therefore the current behavior is not in line with the documentation.

The code currently does:

                $mode = 0444 | &#40; $mode &#38; 0111 ? 0111 : 0 &#41;;
                $mode = $mode | 0222
                    if $realtarget ne $targetfile;
                _chmod&#40; $mode, $targetfile, $verbose &#41;;

So it effectively changes permissions so that they are the same for an owner, a group, and the others. It also always enables read permissions and write permission at the &#40;$realtarget ne $targetfile&#41; condition.

I can image this mangling was done to work around CPAN distributions with wrong permission bit in the sources.

But this behavior should be documented.

Nevertheless the &#40;$realtarget ne $targetfile&#41; condition seems to be the cause of this bug report and should be resolved in the code.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1874058" href="/Public/Bug/Display.html?id=40976#txn-1874058">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;05&nbsp;12:37:47&nbsp;2019</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1874058/1005987/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1005987">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne Čt 05.pro.2019 10:47:07, ppisar napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; But this behavior should be documented.
&gt; 
&gt; Nevertheless the &#40;$realtarget ne $targetfile&#41; condition seems to be
&gt; the cause of this bug report and should be resolved in the code.
</div>
The condition is there probably as a workaround for postponed installation on system reboot needed on some operating systems &#40;Win32&#41;. So write permissions is not something that ExtUtils::Install wants to expose.

I believe that the behavior of not respecting original permissions was implemented as a measure for a case when a CPAN distribution is created with bogus permissions &#40;e.g. on Win32&#41; and then installed on a POSIX system by a root into a system-wide location. Nobody wants to have these files writable for everyone.

I implemented a fix &#40;attached&#41; that basically copies write permissions and then clamp all the permissions by applying umask. This way you can still get unexpected write permissions if the distribution is badly archived but you should not get on the risk if your umask &#40;a think you can control&#41; is sane. Alternatively one could force the owner write permission to deal with bogus distributions.

Then I executed tests and was surprised that they fail because they check, that installed files are no writable. That actually means that somebody wanted to disable all the write permissions. Unfortunately GIT history is too short.

It would be great if the maintainers spoke what do they think about this issue.

Is acceptable to start creating writeable files? Should the write permission always be granted or copy the original file permissions? Is applying umask a good meassure or is it an unacceptably fragile solution?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1874061" href="/Public/Bug/Display.html?id=40976#txn-1874061">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;05&nbsp;12:38:36&nbsp;2019</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1874061/1005991/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1005991">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 176b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne Čt 05.pro.2019 12:37:47, ppisar napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I implemented a fix &#40;attached&#41; that basically copies write permissions
&gt; and then clamp all the permissions by applying umask.
</div></div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-Preserve-write-permission-and-apply-umask.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1874061/1005992/0001-Preserve-write-permission-and-apply-umask.patch">Download 0001-Preserve-write-permission-and-apply-umask.patch</a><br />
<span class="downloadcontenttype">text/x-diff 3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 2f608cd791956604eabf8f7d7d98bf1d753c5774 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Petr=20P=C3=ADsa=C5=99?= &lt;ppisar@redhat.com&gt;
Date: Thu, 5 Dec 2019 17:21:29 +0100
Subject: [PATCH] Preserve write permission and apply umask
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Documentation read:

    Copies each directory tree of %from_to to its corresponding value
    preserving timestamps and permissions.

but the actual permissions were not preserved.

The behavior was that directories were created with 0755 permissions
and files with 0444. If the original file had any executable bit set,
all executable bits &#40;0111&#41; were set. Write permissions &#40;0222&#41; were set
only if the target file could not been overwritten &#40;probably as
a measure to allow later renaming a temporary installation location on
operating systems that prevents from overwriting opened files&#41;.

This behavior usually did the right thing. Especially when installing
files by a superuser into a location accessible for everyone &#40;e.g.
/usr/local&#41;.

But if the file is installed by a user for himself, he always lost
a permission for writing into that file. That&#39;s especially troublesome
when some postprocessing is needed. See
&lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=40976">https://rt.cpan.org/Ticket/Display.html?id=40976</a></span>&gt; for an example.

This patch documents the behavior, but copies all executable
bits. And then clamps all permissions by umask, if umask is supported.

CPAN RT#40976

Signed-off-by: Petr PÃ­saÅ &lt;ppisar@redhat.com&gt;
---
 lib/ExtUtils/Install.pm | 11 +++++++++--
 1 file changed, 9 insertions&#40;+&#41;, 2 deletions&#40;-&#41;

diff --git a/lib/ExtUtils/Install.pm b/lib/ExtUtils/Install.pm
index 047c007..29f7486 100644
--- a/lib/ExtUtils/Install.pm
+++ b/lib/ExtUtils/Install.pm
@@ -586,7 +586,12 @@ sub _chdir {
 
 
 Copies each directory tree of %from_to to its corresponding value
-preserving timestamps and permissions.
+preserving timestamps.
+
+Directories are created with 0755 permissions.  Files are created with read
+permissions for everyone, executable permissions for everyone if the file has
+at least one executable bit set, and write permissions are preserved. Then
+umask is applied to the permissions.
 
 There are two keys with a special meaning in the hash: &#34;read&#34; and
 &#34;write&#34;.  These contain packlist files.  After the copying is done,
@@ -717,6 +722,7 @@ sub install { #XXX OS-SPECIFIC
     my $tmpfile = install_rooted_file&#40;$pack{&#34;read&#34;}&#41;;
     $packlist-&gt;read&#40;$tmpfile&#41; if &#40;-f $tmpfile&#41;;
     my $cwd = cwd&#40;&#41;;
+    my $umask = umask&#40;&#41;;
     my @found_files;
     my %check_dirs;
     require File::Find;
@@ -825,7 +831,8 @@ sub install { #XXX OS-SPECIFIC
                 utime&#40;$atime,$mtime + Is_VMS,$targetfile&#41; unless $dry_run&gt;1;
 
 
-                $mode = 0444 | &#40; $mode &#38; 0111 ? 0111 : 0 &#41;;
+                $mode = 0444 | &#40; $mode &#38; 0222 &#41; | &#40; $mode &#38; 0111 ? 0111 : 0 &#41;;
+                $mode &#38;= ~$umask if defined $umask;
                 $mode = $mode | 0222
                     if $realtarget ne $targetfile;
                 _chmod&#40; $mode, $targetfile, $verbose &#41;;
-- 
2.21.0

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1904087" href="/Public/Bug/Display.html?id=40976#txn-1904087">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;01&nbsp;09:32:44&nbsp;2020</span>
    <span class="description">kloczko.tomasz [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1904087/1020313/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1020313">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 380b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Looks like still it is the issue with ExtUtils::Install.

When DSO module is installed it is stipped down write permission which is very annoing because it causes issue on rpm packages builds when rpm post installation cannot separate DSO debuginfo in package post installation.
I&#39;vce been tring patch atatched to the ticket but looks like it does not help on DSOs installation :/
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1904091" href="/Public/Bug/Display.html?id=40976#txn-1904091">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;01&nbsp;09:32:45&nbsp;2020</span>
    <span class="description">kloczko.tomasz [...] gmail.com -  Fixed in 2.16 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.563229</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
