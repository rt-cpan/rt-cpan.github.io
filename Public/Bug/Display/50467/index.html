<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #50467 for XML-RSS-Feed: Misbehaviour in XML::RSS::Feed, mixup in Headline id/guid</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #50467 for XML-RSS-Feed: Misbehaviour in XML::RSS::Feed, mixup in Headline id/guid</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/XML-RSS-Feed/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/XML-RSS-Feed/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/XML-RSS-Feed/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/XML-RSS-Feed/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/XML-RSS-Feed">XML-RSS-Feed CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">50467</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">10 min

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/XML-RSS-Feed/Active/">XML-RSS-Feed</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">jbisbee [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
sven.knispel [...] pobox.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
Dan [...] DWright.Org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-37506-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-37507-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
2.4    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;13&nbsp;19:18:58&nbsp;2009</span>
    <span class="description">sven.knispel [...] pobox.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Misbehaviour in XML::RSS::Feed, mixup in Headline id/guid</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 14 Oct 2009 01:18:28 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-RSS-Feed [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Sven Knispel &lt;sven.knispel [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dear Jeff,

after having spent the two last nights frying to find out about a
difference in behavior of XML::RSS::Feed on my pc and on a friend&#39;s I
finally had a breakthrough.
To sum it up: on version 2.212 everything is fine, on version 2.32 not
anymore.
Let me elaborate a little on &#34;everything&#34;. with the adapted example from
the POD:

    use XML::RSS::Feed;
    use LWP::Simple qw&#40;get&#41;;

    my $feed = XML::RSS::Feed-&gt;new&#40;
        url    =&gt; &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://feeds.wired.com/wired/index">http://feeds.wired.com/wired/index</a></span>&#34;,
        name   =&gt; &#34;Wired&#34;,
        delay  =&gt; 10,
        debug  =&gt; 1,
        tmpdir =&gt; &#34;.&#34;,
    &#41;;

    while &#40;1&#41; {
        $feed-&gt;parse&#40;get&#40;$feed-&gt;url&#41;&#41;;
        print $_-&gt;headline . &#34;\n&#34; for $feed-&gt;late_breaking_news;
        sleep&#40;$feed-&gt;delay&#41;;
    }

Ok, the expected behavior &#40;with V2.212&#41;:
- first run: it fetches whatever is in the feed &#40;30 items&#41;, and keeps
going in the loop with no new items.
- second run: after having retrieved the cached items there is no
breaking news so it goes on telling &#34;no headlines found&#34;.

And now the problem &#40;with 2.32&#41;:
- first run: it fetches whatever is in the feed &#40;30 items&#41;, and keeps
going in the loop with no new items.
- second run: after having retrieved the cached items it still sees
another 30 breaking news items and shows them again. At every run the
number of initialized headlines from the cache increases by 30.

After a few hours and lots of coffee I broke the problem down to the
Headlines. In the newer 2.32 version of headlines there is the concept
of guid that didn&#39;t exist in older version. I found that the &#34;faulty&#34;
code is in Headlines.pm in &#34;sub id&#34; on &#34;return $self-&gt;guid ||
$self-&gt;url;&#34;. For whatever reason $self-&gt;guid is not set prior to
caching or read from cache &#40;at least my assumption&#41;. Anyway, always
returning the URL solves the misbehavior.

And finally without modifying the code doing a
&#34;$feed-&gt;init_headlines_seen;&#34; in the calling program does also as
obviously it replaces the logic for setting/getting Headline id. The
program working for me is:
    use XML::RSS::Feed;
    use LWP::Simple qw&#40;get&#41;;

    my $feed = XML::RSS::Feed-&gt;new&#40;
        url    =&gt; &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://feeds.wired.com/wired/index">http://feeds.wired.com/wired/index</a></span>&#34;,
        name   =&gt; &#34;Wired&#34;,
        delay  =&gt; 10,
        debug  =&gt; 1,
        headline_as_id =&gt; 1, # &lt;-- avoids getting &#34;real&#34; headline it
        tmpdir =&gt; &#34;.&#34;,
    &#41;;

    while &#40;1&#41; {
        $feed-&gt;parse&#40;get&#40;$feed-&gt;url&#41;&#41;;
        print $_-&gt;headline . &#34;\n&#34; for $feed-&gt;late_breaking_news;
        sleep&#40;$feed-&gt;delay&#41;;
    }

Now I suspect &#34;sub _build_dump_structure&#34; to be candidate to store guid
together with url to solve the problem but I lack background on RSS so
please excuse me if I am completely wrong &#40;it would be nice to read your
opinion on this whole thing ;-&#41; &#41;.


Brgds

Sven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;31&nbsp;12:17:26&nbsp;2013</span>
    <span class="description">Dan [...] DWright.Org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

I&#39;m seeing a very similar issue when trying to use XML::RSS:Feed.   The problem I&#39;m seeing is that whenever you load headlines from the cache, they no longer contain the guid field.

This can be fixed with a one line change inside _build_dump_structure&#40;&#41;:

        push @{ $cached-&gt;{items} }, {
            headline    =&gt; $headline-&gt;headline,
            url         =&gt; $headline-&gt;url,
            description =&gt; $headline-&gt;description,
            first_seen  =&gt; $headline-&gt;first_seen_hires,
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;            guid        =&gt; $headline-&gt;guid,
</div>        };
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;31&nbsp;12:17:26&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;31&nbsp;12:18:16&nbsp;2013</span>
    <span class="description">Dan [...] DWright.Org -  Cc DWRIGHT added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;04&nbsp;13:33:18&nbsp;2013</span>
    <span class="description">jbisbee [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">10 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for taking time to report these issues.  Fixed

* add =encoding utf-8 to pod to fix RT issue #78918
* add guid to serialization so we can properly restore it
  to fix RT issue #50467
* Fix blantantly broken test
* Suppress warnings on deprecated methods during tests
* Fix pod coverage issues with Feed::Factory
* I wrote this code so long ago it makes me throw up in my mouth
  just a little bit :P


-- 
Jeff Bisbee / jbisbee@cpan.org
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;04&nbsp;13:33:19&nbsp;2013</span>
    <span class="description">jbisbee [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;04&nbsp;13:33:19&nbsp;2013</span>
    <span class="description">jbisbee [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;04&nbsp;13:33:19&nbsp;2013</span>
    <span class="description">jbisbee [...] cpan.org -  Fixed in 2.4 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
