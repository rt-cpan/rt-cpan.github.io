<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #15688 for SQL-Statement: Columns aliased with double quotes are a fatal error</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #15688 for SQL-Statement: Columns aliased with double quotes are a fatal error</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/SQL-Statement/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/SQL-Statement/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/SQL-Statement/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/SQL-Statement/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/SQL-Statement">SQL-Statement CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">15688</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/SQL-Statement/Active/">SQL-Statement</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">REHSACK [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
bwarfield [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-29588-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-29589-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;10&nbsp;17:34:16&nbsp;2005</span>
    <span class="description">bwarfield [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Columns aliased with double quotes are a fatal error</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The following statements produce parse errors in SQL::Parser 1.14:

select foo AS &#34;alias&#34;, bar as &#34;pseudonym&#34; from mystery_table;
select foo &#34;alias&#34;, bar &#34;pseudonym&#34; from mystery_table;

The attached patch fixes that, then fixes the things that the patch broke, then tests the thing that got fixed, and includes the modifications that were made to the tests to make it easier to tell what was breaking in the first place.  
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -ur SQL-Statement-1.14/lib/SQL/Parser.pm SQL-Statement-1.14-patched/lib/SQL/Parser.pm
--- SQL-Statement-1.14/lib/SQL/Parser.pm	2005-04-18 20:41:09.000000000 -0400
+++ SQL-Statement-1.14-patched/lib/SQL/Parser.pm	2005-11-09 22:08:17.000000000 -0500
@@ -1057,7 +1057,7 @@
 #	need better alias test here, since AS is a common
 #	keyword that might be used in a function
 #
-        my &#40;$fld, $alias&#41; = &#40;$col=~/^&#40;.+&#41;\s+AS\s+&#40;[A-Z]\w*&#41;$/i&#41;
+        my &#40;$fld, $alias&#41; = &#40;$col=~/^&#40;.+?&#41;\s+&#40;?:AS\s+&#41;?&#40;[A-Z]\w*|\?QI\d+\?&#41;$/i&#41;
                           ? &#40;$1, $2&#41;
                           : &#40;$col, undef&#41;;
         $col = $fld;
@@ -1100,7 +1100,11 @@
                     return undef unless $newcol = $self-&gt;COLUMN_NAME&#40;$col&#41;;
         	}
     	    }
-            $newalias = $self-&gt;COLUMN_NAME&#40;$alias||$newcol&#41;;
+            if &#40;!$alias and uc&#40;$col&#41; eq $newcol&#41; {
+                $newalias = $col;
+            } else {
+                $newalias = $self-&gt;COLUMN_NAME&#40;$alias||$newcol&#41;;
+            }
             $self-&gt;{struct}-&gt;{ORG_NAME}-&gt;{$newcol} = $newalias;
             $aliases{uc $newalias} = $newcol;
             push @newcols, $newcol;
@@ -1111,7 +1115,7 @@
             if &#40;!$self-&gt;{struct}-&gt;{col_obj}-&gt;{$newcol}&#41; {
                     $self-&gt;{struct}-&gt;{col_obj}-&gt;{uc $newcol}
                          = SQL::Statement::Util::Column-&gt;new&#40;
-                               uc $newcol,[],$alias
+                               uc $newcol,[],$newalias
                            &#41;;
 
 	    }
@@ -2241,7 +2245,7 @@
     my $orgcol = $col_name;
 
     if &#40;$col_name =~ /^\?QI&#40;\d+&#41;\?$/&#41; {
-        $col_name = $self-&gt;replace_quoted_ids&#40;$col_name&#41;;
+        $col_name = $self-&gt;{struct}{quoted_ids}[$1];
     }
     else {
         $col_name = uc $col_name unless $self-&gt;{struct}-&gt;{command} eq &#39;CREATE&#39;
diff -ur SQL-Statement-1.14/t/04names.t SQL-Statement-1.14-patched/t/04names.t
--- SQL-Statement-1.14/t/04names.t	2005-04-21 22:44:09.000000000 -0400
+++ SQL-Statement-1.14-patched/t/04names.t	2005-11-09 22:03:18.000000000 -0500
@@ -11,7 +11,7 @@
     plan skip_all =&gt; &#34;Tests require DBD::File =&gt; 0.33&#34;;
 }
 else {
-    plan tests =&gt; 2;
+    plan tests =&gt; 3;
 }
 use SQL::Statement; printf &#34;SQL::Statement v.%s\n&#34;, $SQL::Statement::VERSION;
 use vars qw&#40;$dbh $sth $DEBUG&#41;;
@@ -20,10 +20,13 @@
 $dbh-&gt;do&#40;$_&#41; for &lt;DATA&gt;;
 
 $sth = $dbh-&gt;prepare&#40;&#34;SELECT * FROM Prof&#34;&#41;;
-ok&#40; &#39;pid pname&#39; eq &#40;join&#39; &#39;,cols&#40;$sth&#41;&#41;,&#39;Column Names: select list = *&#39;&#41;;
+is&#40; &#40;join&#39; &#39;,cols&#40;$sth&#41;&#41;,&#39;pid pname&#39;,&#39;Column Names: select list = *&#39;&#41;;
 
 $sth = $dbh-&gt;prepare&#40;&#34;SELECT pname,pID FROM Prof&#34;&#41;;
-ok&#40; &#39;pname pID&#39; eq &#40;join&#39; &#39;,cols&#40;$sth&#41;&#41;,&#39;Column Names: select list = named&#39;&#41;;
+is&#40; &#40;join&#39; &#39;,cols&#40;$sth&#41;&#41;, &#39;pname pID&#39; ,&#39;Column Names: select list = named&#39;&#41;;
+
+$sth = $dbh-&gt;prepare&#40;&#39;SELECT pname &#34;ProfName&#34;, pId &#34;Magic#&#34; from prof&#39;&#41;;
+is&#40; &#40;join&#39; &#39;,cols&#40;$sth&#41;&#41;, &#39;ProfName Magic#&#39; ,&#39;Column Names: select list = aliased&#39;&#41;;
 
 sub cols {
     my&#40;$sth&#41;=@_;
diff -ur SQL-Statement-1.14/t/07case.t SQL-Statement-1.14-patched/t/07case.t
--- SQL-Statement-1.14/t/07case.t	2005-04-21 22:46:38.000000000 -0400
+++ SQL-Statement-1.14-patched/t/07case.t	2005-11-09 20:31:28.000000000 -0500
@@ -52,10 +52,10 @@
         $sth-&gt;execute;
         my $msg = sprintf &#34;imported table : %s&#34;, $query_case;
         my $col = $sth-&gt;{NAME}-&gt;[0];
-        ok&#40;$col eq &#39;col&#39;,$msg&#41; if $query_case eq &#39;lower&#39;;
-        ok&#40;$col eq &#39;COL&#39;,$msg&#41; if $query_case eq &#39;upper&#39;;
-        ok&#40;$col eq &#39;cOl&#39;,$msg&#41; if $query_case eq &#39;mixed&#39;;
-        ok&#40;$col eq &#39;col&#39;,$msg&#41; if $query_case eq &#39;asterisked&#39;;
+        is&#40;$col, &#39;col&#39;,$msg&#41; if $query_case eq &#39;lower&#39;;
+        is&#40;$col, &#39;COL&#39;,$msg&#41; if $query_case eq &#39;upper&#39;;
+        is&#40;$col, &#39;cOl&#39;,$msg&#41; if $query_case eq &#39;mixed&#39;;
+        is&#40;$col, &#39;col&#39;,$msg&#41; if $query_case eq &#39;asterisked&#39;;
         $sth-&gt;finish;
         $sth-&gt;{Active}=0;
     }
@@ -72,13 +72,13 @@
         $sth-&gt;execute;
         my $msg = sprintf &#34;%s/%s&#34;, $create_case, $query_case;
         my $col = $sth-&gt;{NAME}-&gt;[0];
-        ok&#40;$col eq &#39;col&#39;,$msg&#41; if $query_case eq &#39;lower&#39;;
-        ok&#40;$col eq &#39;COL&#39;,$msg&#41; if $query_case eq &#39;upper&#39;;
-        ok&#40;$col eq &#39;cOl&#39;,$msg&#41; if $query_case eq &#39;mixed&#39;;
+        is&#40;$col, &#39;col&#39;,$msg&#41; if $query_case eq &#39;lower&#39;;
+        is&#40;$col, &#39;COL&#39;,$msg&#41; if $query_case eq &#39;upper&#39;;
+        is&#40;$col, &#39;cOl&#39;,$msg&#41; if $query_case eq &#39;mixed&#39;;
         if &#40;$query_case eq &#39;asterisked&#39;&#41; {
-            ok&#40;$col eq &#39;col&#39;,$msg&#41; if $create_case eq &#39;lower&#39;;
-            ok&#40;$col eq &#39;COL&#39;,$msg&#41; if $create_case eq &#39;upper&#39;;
-            ok&#40;$col eq &#39;cOl&#39;,$msg&#41; if $create_case eq &#39;mixed&#39;;
+            is&#40;$col, &#39;col&#39;,$msg&#41; if $create_case eq &#39;lower&#39;;
+            is&#40;$col, &#39;COL&#39;,$msg&#41; if $create_case eq &#39;upper&#39;;
+            is&#40;$col, &#39;cOl&#39;,$msg&#41; if $create_case eq &#39;mixed&#39;;
 	}
         $sth-&gt;finish;
         $sth-&gt;{Active}=0;
@@ -120,7 +120,7 @@
     &#40;mu,ml,um,ul,lm,lu&#41;
 
 
-        ok&#40;$col eq &#39;COL&#39;,$msg&#41; if $query_case eq &#39;asterisked&#39;;
+        is&#40;$col, &#39;COL&#39;,$msg&#41; if $query_case eq &#39;asterisked&#39;;
 exit;
 my $tbl = &#39;case&#39;;
 $dbh-&gt;do&#40;&#34;CREATE TEMP TABLE $tbl &#40;lower INT&#41;&#34;&#41;;
@@ -147,18 +147,19 @@
 $sth=$dbh-&gt;prepare&#40;&#34;
     SELECT SUM&#40;sales&#41;, MAX&#40;sales&#41; FROM biz
 &#34;&#41;;
-ok&#40;&#39;2700~1000^&#39; eq query2str&#40;$sth&#41;,&#39;AGGREGATE FUNCTIONS WITHOUT GROUP BY&#39;&#41;;
+is&#40; query2str&#40;$sth&#41;, &#39;2700~1000^&#39;, &#39;AGGREGATE FUNCTIONS WITHOUT GROUP BY&#39;&#41;;
 
 $sth=$dbh-&gt;prepare&#40;&#34;
     SELECT region,SUM&#40;sales&#41;, MAX&#40;sales&#41; FROM biz GROUP BY region
 &#34;&#41;;
-ok&#40;&#39;West~2000~1000^East~700~700^&#39; eq query2str&#40;$sth&#41;,&#39;GROUP BY one column&#39;&#41;;
+is&#40; query2str&#40;$sth&#41;, &#39;West~2000~1000^East~700~700^&#39; ,&#39;GROUP BY one column&#39;&#41;;
 
 $sth=$dbh-&gt;prepare&#40;&#34;
     SELECT region,store,SUM&#40;sales&#41;, MAX&#40;sales&#41; FROM biz GROUP BY region,store
 &#34;&#41;;
-ok&#40;&#39;West~Los Angeles~1500~1000^West~San Diego~500~500^East~Boston~700~700^&#39;
- eq query2str&#40;$sth&#41;,&#39;GROUP BY several columns&#39;&#41;;
+is&#40;query2str&#40;$sth&#41;,
+   &#39;West~Los Angeles~1500~1000^West~San Diego~500~500^East~Boston~700~700^&#39;,
+   &#39;GROUP BY several columns&#39;&#41;;
 
 
 sub query2str {
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;23&nbsp;12:09:52&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Functions, too, of course...</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The attached additional patch makes function aliasing work, too, and
adds tests for function names &#40;aliased and not&#41; to t/04names.t.  Should
go in after the previous one, since they collide in a couple places.
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- t/04names.t~	Thu Nov 10 17:35:37 2005
+++ t/04names.t	Wed Nov 23 12:00:01 2005
@@ -11,7 +11,7 @@
     plan skip_all =&gt; &#34;Tests require DBD::File =&gt; 0.33&#34;;
 }
 else {
-    plan tests =&gt; 3;
+    plan tests =&gt; 5;
 }
 use SQL::Statement; printf &#34;SQL::Statement v.%s\n&#34;, $SQL::Statement::VERSION;
 use vars qw&#40;$dbh $sth $DEBUG&#41;;
@@ -27,6 +27,12 @@
 
 $sth = $dbh-&gt;prepare&#40;&#39;SELECT pname &#34;ProfName&#34;, pId &#34;Magic#&#34; from prof&#39;&#41;;
 is&#40; &#40;join&#39; &#39;,cols&#40;$sth&#41;&#41;, &#39;ProfName Magic#&#39; ,&#39;Column Names: select list = aliased&#39;&#41;;
+
+$sth = $dbh-&gt;prepare&#40;q{SELECT pid, concat&#40;pname, &#39; is #&#39;, pId &#41; from prof}&#41;;
+is&#40; &#40;join&#39; &#39;,cols&#40;$sth&#41;&#41;, &#39;pid CONCAT&#39; ,&#39;Column Names: select list with function&#39;&#41;;
+
+$sth = $dbh-&gt;prepare&#40;q{SELECT pid &#34;ID&#34;, concat&#40;pname, &#39; is #&#39;, pId &#41; &#34;explanation&#34;  from prof}&#41;;
+is&#40; &#40;join&#39; &#39;,cols&#40;$sth&#41;&#41;, &#39;ID explanation&#39; ,&#39;Column Names: select list with function = aliased&#39;&#41;;
 
 sub cols {
     my&#40;$sth&#41;=@_;
--- lib/SQL/Parser.pm~	Thu Nov 10 17:35:37 2005
+++ lib/SQL/Parser.pm	Wed Nov 23 11:53:21 2005
@@ -1051,7 +1051,7 @@
     my @col_list = $self-&gt;extract_column_list&#40;$col_str&#41;;
     return undef unless scalar @col_list;
 
-    my&#40;@newcols,$newcol,%aliases,$newalias&#41;;
+    my&#40;@newcols,%aliases&#41;;
     for my $col &#40;@col_list&#41; {
 #	DAA
 #	need better alias test here, since AS is a common
@@ -1061,6 +1061,7 @@
                           ? &#40;$1, $2&#41;
                           : &#40;$col, undef&#41;;
         $col = $fld;
+        my &#40;$newcol,$newalias&#41;;
         if &#40;$col =~ /^&#40;\S+&#41;\.\*$/&#41; {
         	my $table = $1;
         	my %is_table_alias = %{$self-&gt;{&#34;tmp&#34;}-&gt;{&#34;is_table_alias&#34;}};
@@ -1087,9 +1088,10 @@
 #                        unless defined $alias;
                     $alias ||= $func_obj-&gt;{name};
                     $newcol = uc $alias;
+                    $newalias = $self-&gt;COLUMN_NAME&#40;$alias&#41;;
                     $self-&gt;{struct}-&gt;{col_obj}-&gt;{$newcol}
                          = SQL::Statement::Util::Column-&gt;new&#40;
-                               uc $alias,[],$alias,$func_obj
+                               $newcol,[],$newalias,$func_obj
                            &#41;;
                 }
 
@@ -1102,7 +1104,7 @@
     	    }
             if &#40;!$alias and uc&#40;$col&#41; eq $newcol&#41; {
                 $newalias = $col;
-            } else {
+            } elsif &#40;!$newalias&#41; {
                 $newalias = $self-&gt;COLUMN_NAME&#40;$alias||$newcol&#41;;
             }
             $self-&gt;{struct}-&gt;{ORG_NAME}-&gt;{$newcol} = $newalias;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;23&nbsp;12:13:47&nbsp;2005</span>
    <span class="description">bwarfield [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Whoops</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">That was me, for the record.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;01&nbsp;17:29:13&nbsp;2009</span>
    <span class="description">REHSACK [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;01&nbsp;18:35:18&nbsp;2009</span>
    <span class="description">REHSACK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Patches applied - will become public with 1.16_02
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;01&nbsp;18:35:20&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;01&nbsp;18:35:20&nbsp;2009</span>
    <span class="description">REHSACK [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
