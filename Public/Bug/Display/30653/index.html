<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #30653 for ExtUtils-CBuilder: [PATCH] _do_link update for VMS</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #30653 for ExtUtils-CBuilder: [PATCH] _do_link update for VMS</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/ExtUtils-CBuilder/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/ExtUtils-CBuilder/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/ExtUtils-CBuilder/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/ExtUtils-CBuilder/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please email the <a href="mailto:perlbug@perl.org">preferred bug tracker</a> to report your issue.</div>
</p>
<p>
<div>Please visit the <a href="http://rt.perl.org/rt3/">preferred bug tracker</a> to report your issue.</div>
</p>
</div>


<div class="error">
  <div class="titlebox error " id="">
  <div class="titlebox-title">
    <span class="left">Queue is disabled</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--error----UXVldWUgaXMgZGlzYWJsZWQ_---0">


This queue is disabled and you may not create new tickets in it.  Disabled queues are usually because the distribution was merged with another or changed names.  Sometimes they are the end result of a bad autocreate from PAUSE data before anyone noticed.
    <hr class="clear" />
  </div>
</div>




</div>


<h3>Maintainer&#40;s&#41;&#39; notes</h3>

<p>ExtUtils::CBuilder is now maintained by the Perl 5 core.  Please report bugs via the 'perlbug' tool included with Perl and do not add new tickets here.</p>



<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">30653</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/ExtUtils-CBuilder/Active/">ExtUtils-CBuilder</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
cberry [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-12462-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-12463-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;11&nbsp;18:22:52&nbsp;2007</span>
    <span class="description">cberry [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [PATCH] _do_link update for VMS</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve checked the attached into blead as #32277.  I think we now do everything MakeMaker does 
in terms of linking external libraries, including the main perl dynamic library &#40;PERLSHR&#41; which is 
always separate from the perl executable on VMS.  We still have some work to do for static  
libraries supplied with or built as part of an extension.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> vms_cbuilder.patch.txt</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- lib/ExtUtils/CBuilder/Platform/VMS.pm;-0	Wed Oct 31 04:40:56 2007
+++ lib/ExtUtils/CBuilder/Platform/VMS.pm	Sat Nov 10 18:02:54 2007
@@ -4,9 +4,13 @@ use strict;
 use ExtUtils::CBuilder::Base;
 
 use vars qw&#40;$VERSION @ISA&#41;;
-$VERSION = &#39;0.21&#39;;
+$VERSION = &#39;0.22&#39;;
 @ISA = qw&#40;ExtUtils::CBuilder::Base&#41;;
 
+use File::Spec::Functions qw&#40;catfile catdir&#41;;
+
+# We do prelink, but don&#39;t want the parent to redo it.
+
 sub need_prelink { 0 }
 
 sub arg_defines {
@@ -49,18 +53,34 @@ sub _do_link {
   my $objects = delete $args{objects};
   $objects = [$objects] unless ref $objects;
   
-  # VMS has two option files, the external symbol, and to pull in PerlShr
   if &#40;$args{lddl}&#41; {
-    my @temp_files =
-      $self-&gt;prelink&#40;%args, dl_name =&gt; $args{module_name}&#41;;
 
-    $objects-&gt;[-1] .= &#39;,&#39;;
+    # prelink will call Mksymlists, which creates the extension-specific
+    # linker options file and populates it with the boot symbol.
+
+    my @temp_files = $self-&gt;prelink&#40;%args, dl_name =&gt; $args{module_name}&#41;;
+
+    # We now add the rest of what we need to the linker options file.  We
+    # should replicate the functionality of C&lt;ExtUtils::MM_VMS::dlsyms&gt;,
+    # but there is as yet no infrastructure for handling object libraries,
+    # so for now we depend on object files being listed individually on the 
+    # command line, which should work for simple cases.  We do bring in our
+    # own version of C&lt;ExtUtils::Liblist::Kid::ext&gt; so that any additional
+    # libraries &#40;including PERLSHR&#41; can be added to the options file.
+
+    my @optlibs = $self-&gt;_liblist_ext&#40; $args{&#39;libs&#39;} &#41;;
+
+    my $optfile = &#39;sys$disk:[]&#39; . $temp_files[0];
+    open my $opt_fh, &#39;&gt;&gt;&#39;, $optfile 
+        or die &#34;_do_link: Unable to open $optfile: $!&#34;;
+    for my $lib &#40;@optlibs&#41; {print $opt_fh &#34;$lib\n&#34; if length $lib }
+    close $opt_fh;
 
-    # If creating a loadable library, the link option file is needed.
-    push @$objects, &#39;sys$disk:[]&#39; . $temp_files[0] . &#39;/opt,&#39;;
+    $objects-&gt;[-1] .= &#39;,&#39;;
+    push @$objects, $optfile . &#39;/OPTIONS,&#39;;
 
-    # VMS always needs the option file for the Perl shared image.
-    push @$objects, $self-&gt;perl_inc&#40;&#41; . &#39;PerlShr.Opt/opt&#39;;
+    # This one not needed for DEC C, but leave for completeness.
+    push @$objects, $self-&gt;perl_inc&#40;&#41; . &#39;perlshr_attr.opt/OPTIONS&#39;;
   }
 
   return $self-&gt;SUPER::_do_link&#40;$type, %args, objects =&gt; $objects&#41;;
@@ -99,4 +119,176 @@ sub lib_file {
   return $dl_file;
 }
 
+# The following is reproduced almost verbatim from ExtUtils::Liblist::Kid::_vms_ext.
+# We can&#39;t just call that because it&#39;s tied up with the MakeMaker object hierarchy.
+
+sub _liblist_ext {
+  my&#40;$self, $potential_libs,$verbose,$give_libs&#41; = @_;
+  $verbose ||= 0;
+
+  my&#40;@crtls,$crtlstr&#41;;
+  @crtls = &#40; &#40;$self-&gt;{&#39;config&#39;}{&#39;ldflags&#39;} =~ m-/Debug-i ? $self-&gt;{&#39;config&#39;}{&#39;dbgprefix&#39;} : &#39;&#39;&#41;
+              . &#39;PerlShr/Share&#39; &#41;;
+  push&#40;@crtls, grep { not /\&#40;/ } split /\s+/, $self-&gt;{&#39;config&#39;}{&#39;perllibs&#39;}&#41;;
+  push&#40;@crtls, grep { not /\&#40;/ } split /\s+/, $self-&gt;{&#39;config&#39;}{&#39;libc&#39;}&#41;;
+  # In general, we pass through the basic libraries from %Config unchanged.
+  # The one exception is that if we&#39;re building in the Perl source tree, and
+  # a library spec could be resolved via a logical name, we go to some trouble
+  # to insure that the copy in the local tree is used, rather than one to
+  # which a system-wide logical may point.
+  if &#40;$self-&gt;perl_src&#41; {
+    my&#40;$lib,$locspec,$type&#41;;
+    foreach $lib &#40;@crtls&#41; { 
+      if &#40;&#40;$locspec,$type&#41; = $lib =~ m{^&#40;[\w\$-]+&#41;&#40;/\w+&#41;?} and $locspec =~ /perl/i&#41; {
+        if    &#40;lc $type eq &#39;/share&#39;&#41;   { $locspec .= $self-&gt;{&#39;config&#39;}{&#39;exe_ext&#39;}; }
+        elsif &#40;lc $type eq &#39;/library&#39;&#41; { $locspec .= $self-&gt;{&#39;config&#39;}{&#39;lib_ext&#39;}; }
+        else                           { $locspec .= $self-&gt;{&#39;config&#39;}{&#39;obj_ext&#39;}; }
+        $locspec = catfile&#40;$self-&gt;perl_src, $locspec&#41;;
+        $lib = &#34;$locspec$type&#34; if -e $locspec;
+      }
+    }
+  }
+  $crtlstr = @crtls ? join&#40;&#39; &#39;,@crtls&#41; : &#39;&#39;;
+
+  unless &#40;$potential_libs&#41; {
+    warn &#34;Result:\n\tEXTRALIBS: \n\tLDLOADLIBS: $crtlstr\n&#34; if $verbose;
+    return &#40;&#39;&#39;, &#39;&#39;, $crtlstr, &#39;&#39;, &#40;$give_libs ? [] : &#40;&#41;&#41;&#41;;
+  }
+
+  my&#40;@dirs,@libs,$dir,$lib,%found,@fndlibs,$ldlib&#41;;
+  my $cwd = cwd&#40;&#41;;
+  my&#40;$so,$lib_ext,$obj_ext&#41; = @{$self-&gt;{&#39;config&#39;}}{&#39;so&#39;,&#39;lib_ext&#39;,&#39;obj_ext&#39;};
+  # List of common Unix library names and their VMS equivalents
+  # &#40;VMS equivalent of &#39;&#39; indicates that the library is automatically
+  # searched by the linker, and should be skipped here.&#41;
+  my&#40;@flibs, %libs_seen&#41;;
+  my %libmap = &#40; &#39;m&#39; =&gt; &#39;&#39;, &#39;f77&#39; =&gt; &#39;&#39;, &#39;F77&#39; =&gt; &#39;&#39;, &#39;V77&#39; =&gt; &#39;&#39;, &#39;c&#39; =&gt; &#39;&#39;,
+                 &#39;malloc&#39; =&gt; &#39;&#39;, &#39;crypt&#39; =&gt; &#39;&#39;, &#39;resolv&#39; =&gt; &#39;&#39;, &#39;c_s&#39; =&gt; &#39;&#39;,
+                 &#39;socket&#39; =&gt; &#39;&#39;, &#39;X11&#39; =&gt; &#39;DECW$XLIBSHR&#39;,
+                 &#39;Xt&#39; =&gt; &#39;DECW$XTSHR&#39;, &#39;Xm&#39; =&gt; &#39;DECW$XMLIBSHR&#39;,
+                 &#39;Xmu&#39; =&gt; &#39;DECW$XMULIBSHR&#39;&#41;;
+  if &#40;$self-&gt;{&#39;config&#39;}{&#39;vms_cc_type&#39;} ne &#39;decc&#39;&#41; { $libmap{&#39;curses&#39;} = &#39;VAXCCURSE&#39;; }
+
+  warn &#34;Potential libraries are &#39;$potential_libs&#39;\n&#34; if $verbose;
+
+  # First, sort out directories and library names in the input
+  foreach $lib &#40;split &#39; &#39;,$potential_libs&#41; {
+    push&#40;@dirs,$1&#41;,   next if $lib =~ /^-L&#40;.*&#41;/;
+    push&#40;@dirs,$lib&#41;, next if $lib =~ /[:&gt;\]]$/;
+    push&#40;@dirs,$lib&#41;, next if -d $lib;
+    push&#40;@libs,$1&#41;,   next if $lib =~ /^-l&#40;.*&#41;/;
+    push&#40;@libs,$lib&#41;;
+  }
+  push&#40;@dirs,split&#40;&#39; &#39;,$self-&gt;{&#39;config&#39;}{&#39;libpth&#39;}&#41;&#41;;
+
+  # Now make sure we&#39;ve got VMS-syntax absolute directory specs
+  # &#40;We don&#39;t, however, check whether someone&#39;s hidden a relative
+  # path in a logical name.&#41;
+  foreach $dir &#40;@dirs&#41; {
+    unless &#40;-d $dir&#41; {
+      warn &#34;Skipping nonexistent Directory $dir\n&#34; if $verbose &gt; 1;
+      $dir = &#39;&#39;;
+      next;
+    }
+    warn &#34;Resolving directory $dir\n&#34; if $verbose;
+    if &#40;!File::Spec-&gt;file_name_is_absolute&#40;$dir&#41;&#41; { 
+        $dir = catdir&#40;$cwd,$dir&#41;; 
+    }
+  }
+  @dirs = grep { length&#40;$_&#41; } @dirs;
+  unshift&#40;@dirs,&#39;&#39;&#41;; # Check each $lib without additions first
+
+  LIB: foreach $lib &#40;@libs&#41; {
+    if &#40;exists $libmap{$lib}&#41; {
+      next unless length $libmap{$lib};
+      $lib = $libmap{$lib};
+    }
+
+    my&#40;@variants,$variant,$cand&#41;;
+    my&#40;$ctype&#41; = &#39;&#39;;
+
+    # If we don&#39;t have a file type, consider it a possibly abbreviated name and
+    # check for common variants.  We try these first to grab libraries before
+    # a like-named executable image &#40;e.g. -lperl resolves to perlshr.exe
+    # before perl.exe&#41;.
+    if &#40;$lib !~ /\.[^:&gt;\]]*$/&#41; {
+      push&#40;@variants,&#34;${lib}shr&#34;,&#34;${lib}rtl&#34;,&#34;${lib}lib&#34;&#41;;
+      push&#40;@variants,&#34;lib$lib&#34;&#41; if $lib !~ /[:&gt;\]]/;
+    }
+    push&#40;@variants,$lib&#41;;
+    warn &#34;Looking for $lib\n&#34; if $verbose;
+    foreach $variant &#40;@variants&#41; {
+      my&#40;$fullname, $name&#41;;
+
+      foreach $dir &#40;@dirs&#41; {
+        my&#40;$type&#41;;
+
+        $name = &#34;$dir$variant&#34;;
+        warn &#34;\tChecking $name\n&#34; if $verbose &gt; 2;
+        $fullname = VMS::Filespec::rmsexpand&#40;$name&#41;;
+        if &#40;defined $fullname and -f $fullname&#41; {
+          # It&#39;s got its own suffix, so we&#39;ll have to figure out the type
+          if    &#40;$fullname =~ /&#40;?:$so|exe&#41;$/i&#41;      { $type = &#39;SHR&#39;; }
+          elsif &#40;$fullname =~ /&#40;?:$lib_ext|olb&#41;$/i&#41; { $type = &#39;OLB&#39;; }
+          elsif &#40;$fullname =~ /&#40;?:$obj_ext|obj&#41;$/i&#41; {
+            warn &#34;Note &#40;probably harmless&#41;: &#34;
+                .&#34;Plain object file $fullname found in library list\n&#34;;
+            $type = &#39;OBJ&#39;;
+          }
+          else {
+            warn &#34;Note &#40;probably harmless&#41;: &#34;
+                .&#34;Unknown library type for $fullname; assuming shared\n&#34;;
+            $type = &#39;SHR&#39;;
+          }
+        }
+        elsif &#40;-f &#40;$fullname = VMS::Filespec::rmsexpand&#40;$name,$so&#41;&#41;      or
+               -f &#40;$fullname = VMS::Filespec::rmsexpand&#40;$name,&#39;.exe&#39;&#41;&#41;&#41;     {
+          $type = &#39;SHR&#39;;
+          $name = $fullname unless $fullname =~ /exe;?\d*$/i;
+        }
+        elsif &#40;not length&#40;$ctype&#41; and  # If we&#39;ve got a lib already, 
+                                       # don&#39;t bother
+               &#40; -f &#40;$fullname = VMS::Filespec::rmsexpand&#40;$name,$lib_ext&#41;&#41; or
+                 -f &#40;$fullname = VMS::Filespec::rmsexpand&#40;$name,&#39;.olb&#39;&#41;&#41;&#41;&#41;  {
+          $type = &#39;OLB&#39;;
+          $name = $fullname unless $fullname =~ /olb;?\d*$/i;
+        }
+        elsif &#40;not length&#40;$ctype&#41; and  # If we&#39;ve got a lib already, 
+                                       # don&#39;t bother
+               &#40; -f &#40;$fullname = VMS::Filespec::rmsexpand&#40;$name,$obj_ext&#41;&#41; or
+                 -f &#40;$fullname = VMS::Filespec::rmsexpand&#40;$name,&#39;.obj&#39;&#41;&#41;&#41;&#41;  {
+          warn &#34;Note &#40;probably harmless&#41;: &#34;
+		       .&#34;Plain object file $fullname found in library list\n&#34;;
+          $type = &#39;OBJ&#39;;
+          $name = $fullname unless $fullname =~ /obj;?\d*$/i;
+        }
+        if &#40;defined $type&#41; {
+          $ctype = $type; $cand = $name;
+          last if $ctype eq &#39;SHR&#39;;
+        }
+      }
+      if &#40;$ctype&#41; { 
+        # This has to precede any other CRTLs, so just make it first
+        if &#40;$cand eq &#39;VAXCCURSE&#39;&#41; { unshift @{$found{$ctype}}, $cand; }  
+        else                      { push    @{$found{$ctype}}, $cand; }
+        warn &#34;\tFound as $cand &#40;really $fullname&#41;, type $ctype\n&#34; 
+          if $verbose &gt; 1;
+	push @flibs, $name unless $libs_seen{$fullname}++;
+        next LIB;
+      }
+    }
+    warn &#34;Note &#40;probably harmless&#41;: &#34;
+		 .&#34;No library found for $lib\n&#34;;
+  }
+
+  push @fndlibs, @{$found{OBJ}}                      if exists $found{OBJ};
+  push @fndlibs, map { &#34;$_/Library&#34; } @{$found{OLB}} if exists $found{OLB};
+  push @fndlibs, map { &#34;$_/Share&#34;   } @{$found{SHR}} if exists $found{SHR};
+  $lib = join&#40;&#39; &#39;,@fndlibs&#41;;
+
+  $ldlib = $crtlstr ? &#34;$lib $crtlstr&#34; : $lib;
+  warn &#34;Result:\n\tEXTRALIBS: $lib\n\tLDLOADLIBS: $ldlib\n&#34; if $verbose;
+  wantarray ? &#40;$lib, &#39;&#39;, $ldlib, &#39;&#39;, &#40;$give_libs ? \@flibs : &#40;&#41;&#41;&#41; : $lib;
+}
+
 1;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;31&nbsp;12:03:20&nbsp;2008</span>
    <span class="description">cberry [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ping.  Any chance of getting this applied so it can get into the next release?  There have been 
two releases since I submitted it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;31&nbsp;12:03:24&nbsp;2008</span>
    <span class="description">cberry [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;15&nbsp;23:00:59&nbsp;2008</span>
    <span class="description">kwilliams [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry, I did apply this back in May but forgot to close this ticket or roll a release.  I&#39;ll do so now.

 -Ken
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;15&nbsp;23:01:02&nbsp;2008</span>
    <span class="description">kwilliams [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
