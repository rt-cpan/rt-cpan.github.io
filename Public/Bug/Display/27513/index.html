<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #27513 for Geo-WeatherNWS: Geo-WeatherNWS returns wrong &#40;?&#41; station code</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #27513 for Geo-WeatherNWS: Geo-WeatherNWS returns wrong &#40;?&#41; station code</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Geo-WeatherNWS/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Geo-WeatherNWS/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Geo-WeatherNWS/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Geo-WeatherNWS/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Geo-WeatherNWS">Geo-WeatherNWS CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">27513</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Geo-WeatherNWS/Active/">Geo-WeatherNWS</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">BOBERNST [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
info [...] gknw.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-14550-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-14551-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Geo-WeatherNWS-1.04.tar.gz<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/326468/149748/Geo-WeatherNWS-1.04.tar.gz">
Wed Jun 13 14:34:58 2007 (17.1k) by info [...] gknw.de
</a>
</font></li>
</ul>


WeatherNWS.pm.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/325663/149357/WeatherNWS.pm.diff">
Sat Jun 09 15:10:11 2007 (1k) by info [...] gknw.de
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;09&nbsp;15:10:11&nbsp;2007</span>
    <span class="description">info [...] gknw.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Geo-WeatherNWS returns wrong &#40;?&#41; station code</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 9 Jun 2007 19:18:25 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Geo-WeatherNWS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Guenter Knauf &lt;info [...] gknw.de&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Marc,
first thanks for your nice module!
When I was testing with it I came over a bunch of stations where a wrong code is returned;
this is because at the place where it gets set in WeatherNWS.pm is inside a loop, and if another 4-letter code appears in $Self-&gt;orbs then its set a second or third time, and is then not equal to the initial station code used for the lookup. This is bad because I would like to use the code inside the template to build up a link to the full report web site, and this then doesnt work.
Therefore I&#39;ve patched WeatherNWS.pm and introduced a new var &#39;station&#39; which returns the first occurence of the 4-letter code. I wasnt sure if you intended to populate the &#39;code&#39; var with the last 4-letter code, and so I&#39;ve just added &#39;station&#39; so we have both...
Also I&#39;ve addded a var &#39;time_sep&#39; which returns the time separated with a colon which I also find useful for usage inside the template.
Finally I&#39;ve fixed the URL to the ICAO lookup site since the old link seems not working.

Here&#39;s some samples to demonstrate the problem &#40;the site runs already the patched version!&#41;:
<span class="clickylink"><a target="new" rel="nofollow" href="http://svwe10.itex.at/perldemo/getweather.pl?station=yssy&#38;debug=1">http://svwe10.itex.at/perldemo/getweather.pl?station=yssy&#38;debug=1</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://svwe10.itex.at/perldemo/getweather.pl?station=lowg&#38;debug=1">http://svwe10.itex.at/perldemo/getweather.pl?station=lowg&#38;debug=1</a></span>
there you see that the &#39;code&#39; var differs from the &#39;station&#39; var, and can see with &#39;orbs&#39; why this happens. In addition you can here see another problem that the visibility is not present.
<span class="clickylink"><a target="new" rel="nofollow" href="http://svwe10.itex.at/perldemo/getweather.pl?station=cywg&#38;debug=1">http://svwe10.itex.at/perldemo/getweather.pl?station=cywg&#38;debug=1</a></span>
this one seems to work correctly - &#39;code&#39; and &#39;station&#39; are equal, and visibility is present.

Here&#39;s my patch:

--- WeatherNWS.pm.orig  Sun Feb 09 19:57:32 2003
+++ WeatherNWS.pm       Sat Jun 09 17:49:05 2007
@@ -268,6 +268,9 @@
                if &#40;&#40;$Line =~ /^&#40;[A-Z][A-Z][A-Z][A-Z]&#41;/&#41; &#38;&#38; &#40;$Line ne &#34;AUTO&#34;&#41;&#41;
                {
                        $Self-&gt;{code}=&#34;$Line&#34;;
+                       if &#40;!$Self-&gt;{station}&#41; {
+                               $Self-&gt;{station}=&#34;$Line&#34;;
+                       }
                }
 
 #------------------------------------------------------------------------------
@@ -278,6 +281,7 @@
                {
                        my $Timez=substr&#40;$Line,2,4&#41;;
                        $Self-&gt;{time}=&#34;$Timez&#34;;
+                       $Self-&gt;{time_sep}=substr&#40;$Timez,0,2&#41;.&#34;:&#34;.substr&#40;$Timez,2,2&#41;;
                        $Self-&gt;{day}=substr&#40;$Line,0,2&#41;;
                }
 
@@ -940,7 +944,7 @@
   you end up having to re-code your parsing program.  With the weather module,
   all you need is a four-letter station code to get the most recent weather
   observations.  If you do not know what the station code is for your area,
-  check the site at <span class="clickylink"><a target="new" rel="nofollow" href="http://205.156.54.206/oso/siteloc.shtml">http://205.156.54.206/oso/siteloc.shtml</a></span> to start your 
+  check the site at <span class="clickylink"><a target="new" rel="nofollow" href="https://pilotweb.nas.faa.gov/qryhtml/icao/">https://pilotweb.nas.faa.gov/qryhtml/icao/</a></span> to start your 
   search. 
 
   Since this module uses the NWS METAR Observations, you can get weather


since I didnt dig yet that deep into this topic I currently dont know if the visibility is fixable.

thanks, Guenter.
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- WeatherNWS.pm.orig	Sun Feb 09 19:57:32 2003
+++ WeatherNWS.pm	Sat Jun 09 17:49:05 2007
@@ -268,6 +268,9 @@
 		if &#40;&#40;$Line =~ /^&#40;[A-Z][A-Z][A-Z][A-Z]&#41;/&#41; &#38;&#38; &#40;$Line ne &#34;AUTO&#34;&#41;&#41;
 		{
 			$Self-&gt;{code}=&#34;$Line&#34;;
+			if &#40;!$Self-&gt;{station}&#41; {
+				$Self-&gt;{station}=&#34;$Line&#34;;
+			}
 		}
 
 #------------------------------------------------------------------------------
@@ -278,6 +281,7 @@
 		{
 			my $Timez=substr&#40;$Line,2,4&#41;;
 			$Self-&gt;{time}=&#34;$Timez&#34;;
+			$Self-&gt;{time_sep}=substr&#40;$Timez,0,2&#41;.&#34;:&#34;.substr&#40;$Timez,2,2&#41;;
 			$Self-&gt;{day}=substr&#40;$Line,0,2&#41;;
 		}
 
@@ -940,7 +944,7 @@
   you end up having to re-code your parsing program.  With the weather module,
   all you need is a four-letter station code to get the most recent weather
   observations.  If you do not know what the station code is for your area,
-  check the site at <span class="clickylink"><a target="new" rel="nofollow" href="http://205.156.54.206/oso/siteloc.shtml">http://205.156.54.206/oso/siteloc.shtml</a></span> to start your 
+  check the site at <span class="clickylink"><a target="new" rel="nofollow" href="https://pilotweb.nas.faa.gov/qryhtml/icao/">https://pilotweb.nas.faa.gov/qryhtml/icao/</a></span> to start your 
   search. 
 
   Since this module uses the NWS METAR Observations, you can get weather
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;12&nbsp;06:34:06&nbsp;2007</span>
    <span class="description">info [...] gknw.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [rt.cpan.org #27513] Geo-WeatherNWS returns wrong &#40;?&#41; station code</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 12 Jun 2007 12:26:58 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Geo-WeatherNWS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Guenter Knauf &lt;info [...] gknw.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Marc,
After some more testing with Geo-WeatherNWS I believe now that the problems with the code var I came over where a bunch of stations returned a wrong code was not intended; instead it seems to me that the regex was wrong since it also returned 5-character codes. In addition the regex didnt allow ICAO codes with numbers in it; so I changed now the regex to return only 4-character ICAO codes, and allow to have the last three also beeing numbers.

Here&#39;re the old some samples again which show now that the &#39;code&#39; and &#39;station&#39; vars are equal:
<span class="clickylink"><a target="new" rel="nofollow" href="http://svwe10.itex.at/perldemo/getweather.pl?station=yssy&#38;debug=1">http://svwe10.itex.at/perldemo/getweather.pl?station=yssy&#38;debug=1</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://svwe10.itex.at/perldemo/getweather.pl?station=lowg&#38;debug=1">http://svwe10.itex.at/perldemo/getweather.pl?station=lowg&#38;debug=1</a></span>
that&#39;re samples for ICAO codes containing numbers:
<span class="clickylink"><a target="new" rel="nofollow" href="http://svwe10.itex.at/perldemo/getweather.pl?station=k3a1&#38;debug=1">http://svwe10.itex.at/perldemo/getweather.pl?station=k3a1&#38;debug=1</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://svwe10.itex.at/perldemo/getweather.pl?station=k9f2&#38;debug=1">http://svwe10.itex.at/perldemo/getweather.pl?station=k9f2&#38;debug=1</a></span>

Here&#39;s my new patch which includes also the patch to correct the new servername &#40;#27515&#41;:

--- WeatherNWS.pm.orig  Mon Feb 10 03:57:32 2003
+++ WeatherNWS.pm       Mon Jun 11 02:33:28 2007
@@ -36,7 +36,7 @@
         my $Class=ref&#40;$Proto&#41; || $Proto;
         my $Self={};
 
-       $Self-&gt;{servername}=&#34;weather.noaa.gov&#34;;
+       $Self-&gt;{servername}=&#34;tgftp.nws.noaa.gov&#34;;
        $Self-&gt;{username}=&#34;anonymous&#34;;
        $Self-&gt;{password}=&#39;weather@cpan.org&#39;;
        $Self-&gt;{directory}=&#34;/data/observations/metar/stations&#34;;
@@ -265,9 +265,12 @@
        foreach $Line &#40;@Splitter&#41;
        {
 
-               if &#40;&#40;$Line =~ /^&#40;[A-Z][A-Z][A-Z][A-Z]&#41;/&#41; &#38;&#38; &#40;$Line ne &#34;AUTO&#34;&#41;&#41;
+               if &#40;&#40;$Line =~ /^&#40;[A-Z][A-Z0-9]{3}&#41;$/&#41; &#38;&#38; &#40;$Line ne &#34;AUTO&#34;&#41;&#41;
                {
                        $Self-&gt;{code}=&#34;$Line&#34;;
+                       if &#40;!$Self-&gt;{station}&#41; {
+                               $Self-&gt;{station}=&#34;$Line&#34;;
+                       }
                }
 
 #------------------------------------------------------------------------------
@@ -278,6 +281,7 @@
                {
                        my $Timez=substr&#40;$Line,2,4&#41;;
                        $Self-&gt;{time}=&#34;$Timez&#34;;
+                       $Self-&gt;{time_sep}=substr&#40;$Timez,0,2&#41;.&#34;:&#34;.substr&#40;$Timez,2,2&#41;;
                        $Self-&gt;{day}=substr&#40;$Line,0,2&#41;;
                }
 
@@ -940,7 +944,7 @@
   you end up having to re-code your parsing program.  With the weather module,
   all you need is a four-letter station code to get the most recent weather
   observations.  If you do not know what the station code is for your area,
-  check the site at <span class="clickylink"><a target="new" rel="nofollow" href="http://205.156.54.206/oso/siteloc.shtml">http://205.156.54.206/oso/siteloc.shtml</a></span> to start your 
+  check the site at <span class="clickylink"><a target="new" rel="nofollow" href="https://pilotweb.nas.faa.gov/qryhtml/icao/">https://pilotweb.nas.faa.gov/qryhtml/icao/</a></span> to start your 
   search. 
 
   Since this module uses the NWS METAR Observations, you can get weather

for the moment I have still the &#39;station&#39; var in, but I think now its probably not needed anymore;
will test some more, and check if &#39;code&#39; and &#39;station&#39; are now always equal.

thanks, Guenter.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;13&nbsp;14:34:57&nbsp;2007</span>
    <span class="description">info [...] gknw.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [rt.cpan.org #27513] Geo-WeatherNWS returns wrong &#40;?&#41; station code</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 13 Jun 2007 20:34:19 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Geo-WeatherNWS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Guenter Knauf &lt;info [...] gknw.de&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Marc,
I did some more hacking around, and changed / fixed some regex, and added now 7 new vars, and finally prepared for a new release which I want to propose:
- Fixed servername, fixed code var setting
- added full date to obs var for http request
- added vars windspeedkmh, windgustkmh,
  year, month, hour, minute, time_sep

Here are the old samples which show now that the &#39;code&#39; and &#39;station&#39; vars are equal:
<span class="clickylink"><a target="new" rel="nofollow" href="http://svwe10.itex.at/perldemo/getweather.pl?station=yssy&#38;debug=1">http://svwe10.itex.at/perldemo/getweather.pl?station=yssy&#38;debug=1</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://svwe10.itex.at/perldemo/getweather.pl?station=lowg&#38;debug=1">http://svwe10.itex.at/perldemo/getweather.pl?station=lowg&#38;debug=1</a></span>
that are samples for ICAO codes containing numbers:
<span class="clickylink"><a target="new" rel="nofollow" href="http://svwe10.itex.at/perldemo/getweather.pl?station=k3a1&#38;debug=1">http://svwe10.itex.at/perldemo/getweather.pl?station=k3a1&#38;debug=1</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://svwe10.itex.at/perldemo/getweather.pl?station=k9f2&#38;debug=1">http://svwe10.itex.at/perldemo/getweather.pl?station=k9f2&#38;debug=1</a></span>

Here&#39;s my latest patch which includes also the patch to correct the new servername &#40;#27515&#41;:

--- WeatherNWS.pm.orig  Mon Feb 10 03:57:32 2003
+++ WeatherNWS.pm       Wed Jun 13 17:19:14 2007
@@ -6,6 +6,9 @@
 #
 # Last Modified:  18 December 2001 - Prepared for CPAN - Marc Slagle
 #                24 February 2002 - Adding server/error code - Marc
+#                 13 June     2007 - Fixed servername, fixed code var setting
+#                                  - added vars year, month, hour, minute,
+#                                    time_sep, windspeedkmh, windgustkmh
 #
 #------------------------------------------------------------------------------
 
@@ -24,7 +27,7 @@
 # Version
 #------------------------------------------------------------------------------
 
-our $VERSION = &#39;1.03&#39;;
+our $VERSION = &#39;1.04&#39;;
 
 #------------------------------------------------------------------------------
 # Lets create a new self
@@ -36,7 +39,7 @@
         my $Class=ref&#40;$Proto&#41; || $Proto;
         my $Self={};
 
-       $Self-&gt;{servername}=&#34;weather.noaa.gov&#34;;
+       $Self-&gt;{servername}=&#34;tgftp.nws.noaa.gov&#34;;
        $Self-&gt;{username}=&#34;anonymous&#34;;
        $Self-&gt;{password}=&#39;weather@cpan.org&#39;;
        $Self-&gt;{directory}=&#34;/data/observations/metar/stations&#34;;
@@ -123,7 +126,7 @@
        {
                use LWP::UserAgent;
                my $Ua=LWP::UserAgent-&gt;new&#40;&#41;;
-               $Ua-&gt;agent&#40;&#34;Geo::WeatherNWS 1.03&#34;&#41;;
+               $Ua-&gt;agent&#40;&#34;Geo::WeatherNWS $VERSION&#34;&#41;;
 
                my $Req=HTTP::Request-&gt;new&#40;GET =&gt; &#34;$Self-&gt;{http}&#34;&#41;;
                $Req-&gt;content_type&#40;&#39;application/x-www-form-urlencoded&#39;&#41;;
@@ -134,9 +137,13 @@
                        my @Lines=split&#40;/\n/,$Res-&gt;content&#41;;
                        foreach my $Line &#40;@Lines&#41;
                        {
-                               if &#40;$Line =~ /^&#40;[A-Z][A-Z][A-Z][A-Z]&#41;/&#41;
+                               if &#40;$Line =~ /^&#40;[0-9]{4}\/[0-9]{2}\/[0-9]{2}&#41; [0-9]{2}:[0-9]{2}/&#41;
                                {
-                                       $Self-&gt;{obs}=$Line;
+                                       $Self-&gt;{obs}=&#34;$1 &#34;;
+                               }
+                               if &#40;$Line =~ /^[A-Z][A-Z0-9]{3} /&#41;
+                               {
+                                       $Self-&gt;{obs}.=$Line;
                                        last;
                                }
                        }
@@ -265,20 +272,34 @@
        foreach $Line &#40;@Splitter&#41;
        {
 
-               if &#40;&#40;$Line =~ /^&#40;[A-Z][A-Z][A-Z][A-Z]&#41;/&#41; &#38;&#38; &#40;$Line ne &#34;AUTO&#34;&#41;&#41;
+               if &#40;&#40;$Line =~ /^[A-Z][A-Z0-9]{3}$/&#41; &#38;&#38; &#40;$Line ne &#34;AUTO&#34;&#41;&#41;
                {
-                       $Self-&gt;{code}=&#34;$Line&#34;;
+                       if &#40;!$Self-&gt;{code}&#41; {
+                               $Self-&gt;{code}=&#34;$Line&#34;;
+                       }
                }
 
 #------------------------------------------------------------------------------
 #              Report Time
 #------------------------------------------------------------------------------
 
-               elsif &#40;$Line =~ /&#40;[0-9]Z&#41;$/&#41;
+               elsif &#40;$Line =~ /&#40;[0-9]{2}&#41;&#40;[0-9]{2}&#41;&#40;[0-9]{2}&#41;Z$/&#41;
+               {
+                       $Self-&gt;{day}=&#34;$1&#34;;
+                       $Self-&gt;{hour}=&#34;$2&#34;;
+                       $Self-&gt;{minute}=&#34;$3&#34;;
+                       $Self-&gt;{time}=&#34;$2$3&#34;;
+                       $Self-&gt;{time_sep}=&#34;$2:$3&#34;;
+               }
+
+#------------------------------------------------------------------------------
+#              Report Date
+#------------------------------------------------------------------------------
+
+               elsif &#40;$Line =~ /^&#40;[0-9]{4}&#41;\/&#40;[0-9]{2}&#41;\/&#40;[0-9]{2}&#41;$/&#41;
                {
-                       my $Timez=substr&#40;$Line,2,4&#41;;
-                       $Self-&gt;{time}=&#34;$Timez&#34;;
-                       $Self-&gt;{day}=substr&#40;$Line,0,2&#41;;
+                       $Self-&gt;{year}=&#34;$1&#34;;
+                       $Self-&gt;{month}=&#34;$2&#34;;
                }
 
 #------------------------------------------------------------------------------
@@ -362,13 +383,17 @@
                        }
 
                        my $MPH=int&#40;$Windspeedkts/0.868391&#41;;
+                       my $KMH=int&#40;$Windspeedkts*1.851984&#41;;
                        my $GMPH=int&#40;$Windgustkts/0.868391&#41;;
+                       my $GKMH=int&#40;$Windgustkts*1.851984&#41;;
 
                        $Self-&gt;{windspeedkts}=$Windspeedkts;
                        $Self-&gt;{windgustkts}=$Windgustkts;
                        $Self-&gt;{windspeedkts}=$Self-&gt;{windspeedkts}-0;
                        $Self-&gt;{windspeedmph}=$MPH;
+                       $Self-&gt;{windspeedkmh}=$KMH;
                        $Self-&gt;{windgustmph}=$GMPH;
+                       $Self-&gt;{windgustkmh}=$GKMH;
                        $Self-&gt;{winddirtext}=$Winddirtxt;
                        $Self-&gt;{winddir}=$Winddir;              
                        $Self-&gt;{winddir}=$Self-&gt;{winddir}-0;
@@ -902,6 +927,15 @@
 
 =head1 DESCRIPTION
 
+  New for version 1.04:  the regex was changed to enable also ICAO codes which
+  contain numbers. In addition the $Report{code} var now always gets set with
+  the first ICAO code returned; previous versions picked up codes at the end
+  of the ob line, and even 5-character codes which was wrong.
+  Added seven new vars: windspeedkmh, windgustkmh, year, month, hour, minute,
+  and time_sep which returns the time separated with a colon.
+  Also the returned obs from ftp and http request are now equal - with previous
+  version the full date was missing with http.
+
   New for version 1.03:  the getreporthttp call now calls the script on the 
   weather.noaa.gov site for those who cant FTP through firewalls.
 
@@ -940,7 +974,7 @@
   you end up having to re-code your parsing program.  With the weather module,
   all you need is a four-letter station code to get the most recent weather
   observations.  If you do not know what the station code is for your area,
-  check the site at <span class="clickylink"><a target="new" rel="nofollow" href="http://205.156.54.206/oso/siteloc.shtml">http://205.156.54.206/oso/siteloc.shtml</a></span> to start your 
+  check the site at <span class="clickylink"><a target="new" rel="nofollow" href="https://pilotweb.nas.faa.gov/qryhtml/icao/">https://pilotweb.nas.faa.gov/qryhtml/icao/</a></span> to start your 
   search. 
 
   Since this module uses the NWS METAR Observations, you can get weather
@@ -1006,10 +1040,12 @@
 
   These are the returned values specific to wind:
 
+  $Report-&gt;{windspeedkmh}         # Wind Speed &#40;in kmh&#41;
   $Report-&gt;{windspeedmph}         # Wind Speed &#40;in mph&#41;
   $Report-&gt;{windspeedkts}         # Wind Speed &#40;in kts&#41;
   $Report-&gt;{winddir}              # Wind Direction &#40;in degrees&#41;
   $Report-&gt;{winddirtext}          # Wind Direction &#40;text version&#41;
+  $Report-&gt;{windgustkmh}          # Wind Gusts &#40;kmh&#41;
   $Report-&gt;{windgustmph}          # Wind Gusts &#40;mph&#41;
   $Report-&gt;{windgustkts}          # Wind Gusts &#40;kts&#41;
 
attached a tar.gz archive which contains everything...

thanks, Guenter.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/326468/149748/Geo-WeatherNWS-1.04.tar.gz">Download Geo-WeatherNWS-1.04.tar.gz</a><br />
<span class="downloadcontenttype">application/octet-stream 17.1k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;27&nbsp;21:09:13&nbsp;2012</span>
    <span class="description">BOBERNST [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;27&nbsp;21:11:59&nbsp;2012</span>
    <span class="description">BOBERNST [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you for your detailed report and proposed solution. Please accept
my apology for this tardy response.

I believe version 1.05 should address your concerns - if not, please
submit a new ticket. &#40;I promise a faster response!&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;27&nbsp;21:12:00&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;27&nbsp;21:12:00&nbsp;2012</span>
    <span class="description">BOBERNST [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
