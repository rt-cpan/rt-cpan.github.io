<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #42148 for Test-Simple: exit.t update for VMS returning Unix status codes.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #42148 for Test-Simple: exit.t update for VMS returning Unix status codes.</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Test-Simple/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Test-Simple/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Test-Simple/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Test-Simple/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="http://github.com/Test-More/test-more/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Test-Simple">Test-Simple CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">42148</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Test-Simple/Active/">Test-Simple</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
wb8tyw [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-31590-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.86    </td>
  </tr>
  <tr id="CF-31591-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




test_simple_t_exit_t.gdiff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/550247/277088/test_simple_t_exit_t.gdiff">
Sun Jan 04 16:54:10 2009 (2.2k) by malmberg [...] Encompasserve.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;04&nbsp;16:54:10&nbsp;2009</span>
    <span class="description">malmberg [...] Encompasserve.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> exit.t update for VMS returning Unix status codes.</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fix exit.t to handle VMS returning Unix style exit codes.

Also move the calculation for $Perl outside of the loop.

On VMS, it was adding an addional &#39; -&#34;Mvmsish=hushed&#34; to the $Perl
command on each iteration of the loop.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> test_simple_t_exit_t.gdiff</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/550247/277088/test_simple_t_exit_t.gdiff">Download test_simple_t_exit_t.gdiff</a><br />
<span class="downloadcontenttype">application/octet-stream 2.2k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;02&nbsp;05:34:25&nbsp;2009</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Rather than add in more OS detection code, the test now just runs perl
-e &#34;exit $num&#34; in a loop to detect what&#39;s going to happen.  Please
double check.
<span class="clickylink"><a target="new" rel="nofollow" href="http://github.com/schwern/test-more/tarball/master">http://github.com/schwern/test-more/tarball/master</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;02&nbsp;05:34:26&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;02&nbsp;05:34:26&nbsp;2009</span>
    <span class="description">mschwern [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;02&nbsp;20:52:11&nbsp;2009</span>
    <span class="description">wb8tyw [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42148] exit.t update for VMS returning Unix status codes.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 02 Apr 2009 19:51:42 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Malmberg &lt;wb8tyw [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;02&nbsp;20:52:11&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;02&nbsp;21:04:13&nbsp;2009</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Apr 02 20:52:11 2009, wb8tyw@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Test Summary Report
&gt; -------------------
&gt; t/bad_plan.t                          &#40;Wstat: 1024 Tests: 0 Failed: 0&#41;
&gt;    Non-zero exit status: 4
&gt;    Parse errors: No plan found in TAP output
&gt; t/bail_out.t                          &#40;Wstat: 1024 Tests: 0 Failed: 0&#41;
&gt;    Non-zero exit status: 4
&gt;    Parse errors: No plan found in TAP output
</div>
What&#39;s all this?  Nobody&#39;s reported this before.  It sure didn&#39;t come
from the exit.t changes.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; EAGLE&gt; perl --version
</div>&gt; 
&gt; This is perl, v5.11.0 &#40;GitLive-blead-887-g0a8c518*&#41; built for 
&gt; VMS_AXP-ithread
</div>
Please try it again with 5.10, otherwise we have two moving targets and
you don&#39;t know which one is broken.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;02&nbsp;21:48:05&nbsp;2009</span>
    <span class="description">wb8tyw [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42148] exit.t update for VMS returning Unix status codes.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 02 Apr 2009 20:47:44 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Malmberg &lt;wb8tyw [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Michael G Schwern via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=42148">https://rt.cpan.org/Ticket/Display.html?id=42148</a></span> &gt;
&gt; 
&gt; On Thu Apr 02 20:52:11 2009, wb8tyw@gmail.com wrote:
&gt; 
<div class="message-stanza open">&gt;&gt;Test Summary Report
&gt;&gt;-------------------
&gt;&gt;t/bad_plan.t                          &#40;Wstat: 1024 Tests: 0 Failed: 0&#41;
&gt;&gt;   Non-zero exit status: 4
&gt;&gt;   Parse errors: No plan found in TAP output
&gt;&gt;t/bail_out.t                          &#40;Wstat: 1024 Tests: 0 Failed: 0&#41;
&gt;&gt;   Non-zero exit status: 4
&gt;&gt;   Parse errors: No plan found in TAP output
</div>&gt; 
&gt; 
&gt; What&#39;s all this?  Nobody&#39;s reported this before.  It sure didn&#39;t come
&gt; from the exit.t changes.
</div>
Found the cause, the environment variable PERL_CORE was set from running 
perl.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; 
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;EAGLE&gt; perl --version
</div>&gt;&gt;
&gt;&gt;This is perl, v5.11.0 &#40;GitLive-blead-887-g0a8c518*&#41; built for 
&gt;&gt;VMS_AXP-ithread
</div>&gt; 
&gt; 
&gt; Please try it again with 5.10, otherwise we have two moving targets and
&gt; you don&#39;t know which one is broken.
</div>
I actually do not have 5.10 installed on this system.

Re-running the test with VMS traditional exit codes has this summary:


Test Summary Report
-------------------
t/exit.t                              &#40;Wstat: 0 Tests: 14 Failed: 8&#41;
   Failed tests:
1-2, 4-5, 7-8, 10, 12
Files=90, Tests=676, 99 wallclock secs &#40; 6.46 usr +  0.00 sys =  6.46 CPU&#41;
Result: FAIL


Running it in the new UNIX compatibility mode:

All tests successful.
Files=90, Tests=676, 106 wallclock secs &#40; 6.17 usr +  0.00 sys =  6.17 CPU&#41;
Result: PASS

In the traditional mode, Perl on VMS exits with error code 4.  That is 
what caused the test failures.


In the new mode, Perl on VMS exits with both the correct VMS status code 
for the issue and the expected UNIX shell exit code.


Unfortunately for the sake of backwards compatibility, I can not make 
the new behavior the default.

-John
wb8tyw@gmail.com
Personal Opinion Only
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;02&nbsp;22:41:51&nbsp;2009</span>
    <span class="description">wb8tyw [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42148] exit.t update for VMS returning Unix status codes.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 02 Apr 2009 21:39:48 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Malmberg &lt;wb8tyw [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is the output of the failing tests in the default mode of VMS.

I am not sure how to fix this with out the test looking up to see what 
mode that VMS is in.

When VMS is in the new POSIX exit mode, all tests for this module pass.

#   Failed test &#39;death.plx exited with 4 &#40;expected 255&#41;&#39;
#   at t/exit.t line 90.
#          got: 4
#     expected: 0
%SYSTEM-F-ABORT, abort

#   Failed test &#39;too_few.plx exited with 4 &#40;expected 255&#41;&#39;
#   at t/exit.t line 90.
#          got: 4
#     expected: 0
%SYSTEM-F-ABORT, abort

#   Failed test &#39;too_few_fail.plx exited with 4 &#40;expected 2&#41;&#39;
#   at t/exit.t line 90.
#          got: 4
#     expected: 2
%SYSTEM-F-ABORT, abort

#   Failed test &#39;five_fail.plx exited with 4 &#40;expected 5&#41;&#39;
#   at t/exit.t line 90.
#          got: 4
#     expected: 0

#   Failed test &#39;death_with_handler.plx exited with 4 &#40;expected 255&#41;&#39;
#   at t/exit.t line 90.
#          got: 4
#     expected: 0
%SYSTEM-F-ABORT, abort

#   Failed test &#39;extras.plx exited with 4 &#40;expected 2&#41;&#39;
#   at t/exit.t line 90.
#          got: 4
#     expected: 2
%SYSTEM-F-ABORT, abort

#   Failed test &#39;two_fail.plx exited with 4 &#40;expected 2&#41;&#39;
#   at t/exit.t line 90.
#          got: 4
#     expected: 2

#   Failed test &#39;last_minute_death.plx exited with 4 &#40;expected 255&#41;&#39;
#   at t/exit.t line 90.
#          got: 4
#     expected: 0
%SYSTEM-F-ABORT, abort
t/exit.t ................................


Regards,
-John
Personal Opinion Only
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;03&nbsp;04:37:59&nbsp;2009</span>
    <span class="description">cpan [...] pjedwards.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Moving over from:

  <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=17298">https://rt.cpan.org/Ticket/Display.html?id=17298</a></span>

Executive summary:

  The code building up Exit_Map calls exit&#40;$n&#41;, while the
code in question sets $? in an END block, this behaviour
differs in the default mode on VMS.

Changes to fix:

Don&#39;t build up Exit_Map by calling exit&#40;$n&#41;.

&lt;&lt; for my $exit &#40;0..255&#41; {
&lt;&lt; my $wait = system&#40;qq[$Perl -e &#34;exit $exit&#34;]&#41;;
&lt;&lt; $Exit_Map{$exit} = exitstatus&#40;$wait&#41;;
&lt;&lt; }

Instead, build up the Exit_Map by setting $? in an END block:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&gt; for my $exit &#40;0,1,2,5,255&#41; {
&gt;&gt; my $q = &#40;$^O eq &#39;VMS&#39;&#41; ? q{&#34;} : q{&#39;};
&gt;&gt; my $cmd = $Perl . q[ -e ] . $q . q[use 
</div>English;END{$CHILD_ERROR=] . $exit . q[}] .$q;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&gt; my $wait = system&#40;$cmd&#41;;
&gt;&gt; my $os_exit = exitstatus&#40;$wait&#41;;
&gt;&gt; $Exit_Map{$exit} = $os_exit;
&gt;&gt; print &#34;# $^O exit=$exit wait=$wait os_exit=$os_exit\n&#34;;
&gt;&gt; }
</div>
I have not tested this on VMS with the new POSIX exit mode.

Also:

&lt;&lt; $TB-&gt;is_num&#40; $actual_exit, $Exit_Map{$exit_code}, 
&lt;&lt; &#34;$test_name exited with $actual_exit &#34;.
&lt;&lt; &#34;&#40;expected $exit_code&#41;&#34;&#41;;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&gt; $TB-&gt;is_num&#40; $actual_exit, $Exit_Map{$exit_code}, 
&gt;&gt; &#34;$test_name exited with $actual_exit &#34;.
&gt;&gt; &#34;&#40;expected &#34;.$Exit_Map{$exit_code}.&#34;&#41;&#34;&#41;;
</div>
Cheers
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;03&nbsp;07:20:57&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42148] exit.t update for VMS returning Unix status codes.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 03 Apr 2009 12:20:26 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">wb8tyw@gmail.com via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt; EAGLE&gt; perl --version
</div>&gt;&gt;&gt;
&gt;&gt;&gt; This is perl, v5.11.0 &#40;GitLive-blead-887-g0a8c518*&#41; built for 
&gt;&gt;&gt; VMS_AXP-ithread
</div>&gt;&gt;
&gt;&gt; Please try it again with 5.10, otherwise we have two moving targets and
&gt;&gt; you don&#39;t know which one is broken.
</div>&gt; 
&gt; I actually do not have 5.10 installed on this system.
</div>
Could you install 5.10 or dig up 5.8.8?  Sorry to push the point but any tests
done using an unstable perl, pass or fail, are suspect and cannot be relied upon.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This is the output of the failing tests in the default mode of VMS.
&gt;
&gt; I am not sure how to fix this with out the test looking up to see what 
&gt; mode that VMS is in.
&gt;
&gt; #   Failed test &#39;death.plx exited with 4 &#40;expected 255&#41;&#39;
&gt; #   at t/exit.t line 90.
&gt; #          got: 4
&gt; #     expected: 0
&gt; %SYSTEM-F-ABORT, abort
</div>
That&#39;s a problem with the %Exit_Map code if it&#39;s mapping exit 255 to 0.  Why
would system&#40;&#34;perl -e &#39;exit 255&#39;&#34;&#41; exit with 0 on VMS in default mode?  For
that matter, it seems exit 2 is coming out as 2 which is counter to previous
behavior.


Peter John Edwards said:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;   The code building up Exit_Map calls exit&#40;$n&#41;, while the
&gt; code in question sets $? in an END block, this behaviour
&gt; differs in the default mode on VMS.
</div>
This may be the crux of the whole problem.  I fear we&#39;re chasing two bugs.
Changing to using $? might have partially bypassed the Unix -&gt; VMS exit code
mapping that vmsperl does by default.  So if we test using $? we&#39;ll just be
enshrining that bug.

Just to be sure we don&#39;t have two bugs in concert, let&#39;s move the %Exit_Map
dynamic logic out of the picture.  Does 0.87_01 work on VMS in its default mode?

Sorry, this is a bit like debugging over telegraph.


-- 
Hating the web since 1994.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;03&nbsp;10:05:56&nbsp;2009</span>
    <span class="description">wb8tyw [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42148] exit.t update for VMS returning Unix status codes.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 03 Apr 2009 09:05:34 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Malmberg &lt;wb8tyw [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Michael G Schwern via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=42148">http://rt.cpan.org/Ticket/Display.html?id=42148</a></span> &gt;
&gt; 
&gt; wb8tyw@gmail.com via RT wrote:
<div class="message-stanza open"><div class="message-stanza open"><div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt; EAGLE&gt; perl --version
</div>&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; This is perl, v5.11.0 &#40;GitLive-blead-887-g0a8c518*&#41; built for 
&gt;&gt;&gt;&gt; VMS_AXP-ithread
</div>&gt;&gt;&gt; Please try it again with 5.10, otherwise we have two moving targets and
&gt;&gt;&gt; you don&#39;t know which one is broken.
</div>&gt;&gt; I actually do not have 5.10 installed on this system.
</div>&gt; 
&gt; Could you install 5.10 or dig up 5.8.8?  Sorry to push the point but any tests
&gt; done using an unstable perl, pass or fail, are suspect and cannot be relied upon.
</div>
Encompasserve.org is now back up.  It is a free access VMS system that 
Craig Berry installed 5.10 on.

I will upload the code there and test it either late this evening or 
tomorrow.

The new POSIX exit code support is not in 5.10.0.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; This is the output of the failing tests in the default mode of VMS.
&gt;&gt;
&gt;&gt; I am not sure how to fix this with out the test looking up to see what 
&gt;&gt; mode that VMS is in.
&gt;&gt;
&gt;&gt; #   Failed test &#39;death.plx exited with 4 &#40;expected 255&#41;&#39;
&gt;&gt; #   at t/exit.t line 90.
&gt;&gt; #          got: 4
&gt;&gt; #     expected: 0
&gt;&gt; %SYSTEM-F-ABORT, abort
</div>&gt; 
&gt; That&#39;s a problem with the %Exit_Map code if it&#39;s mapping exit 255 to 0.  Why
&gt; would system&#40;&#34;perl -e &#39;exit 255&#39;&#34;&#41; exit with 0 on VMS in default mode?  For
&gt; that matter, it seems exit 2 is coming out as 2 which is counter to previous
&gt; behavior.
&gt; 
&gt; 
&gt; Peter John Edwards said:
<div class="message-stanza open">&gt;&gt;   The code building up Exit_Map calls exit&#40;$n&#41;, while the
&gt;&gt; code in question sets $? in an END block, this behaviour
&gt;&gt; differs in the default mode on VMS.
</div>&gt; 
&gt; This may be the crux of the whole problem.  I fear we&#39;re chasing two bugs.
&gt; Changing to using $? might have partially bypassed the Unix -&gt; VMS exit code
&gt; mapping that vmsperl does by default.  So if we test using $? we&#39;ll just be
&gt; enshrining that bug.
&gt; 
&gt; Just to be sure we don&#39;t have two bugs in concert, let&#39;s move the %Exit_Map
&gt; dynamic logic out of the picture.  Does 0.87_01 work on VMS in its default mode?
&gt; 
&gt; Sorry, this is a bit like debugging over telegraph.
</div>
.87_01 works on VMS in the default mode on 5.11.0.

Regards,
-John
wb8tyw@gmail.com
Personal Opinion Only
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;03&nbsp;12:31:35&nbsp;2009</span>
    <span class="description">cpan [...] pjedwards.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&gt; Does 0.87_01 work on VMS in its default mode?
</div>
Yes, exit.t does.

perl -v
This is perl, v5.8.7 built for VMS_IA64

mmk test
...
t/eq_set................................
ok
t/exit..................................
%SYSTEM-F-ABORT, abort
%SYSTEM-F-ABORT, abort
%SYSTEM-F-ABORT, abort
%SYSTEM-F-ABORT, abort
%SYSTEM-F-ABORT, abort
%SYSTEM-F-ABORT, abort
ok
t/explain...............................
ok
...

Test Summary Report

-------------------
t/builder/reset                     &#40;Wstat: 512 Tests: 0 Failed: 0&#41;

  Non-zero exit status: 2

  Parse errors: No plan found in TAP output

t/died                              &#40;Wstat: 512 Tests: 3 Failed: 2&#41;

  Failed tests:
2-3

  Non-zero exit status: 2

Files=89, Tests=672
Result: FAIL
Failed 2/89 test programs. 2/672 subtests failed.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;03&nbsp;13:48:52&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42148] exit.t update for VMS returning Unix status codes.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 03 Apr 2009 18:48:19 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Peter John Edwards via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Test Summary Report
&gt; 
&gt; -------------------
&gt; t/builder/reset                     &#40;Wstat: 512 Tests: 0 Failed: 0&#41;
&gt; 
&gt;   Non-zero exit status: 2
&gt; 
&gt;   Parse errors: No plan found in TAP output
&gt; 
&gt; t/died                              &#40;Wstat: 512 Tests: 3 Failed: 2&#41;
&gt; 
&gt;   Failed tests:
&gt; 2-3
&gt; 
&gt;   Non-zero exit status: 2
</div>
Ok, what about this then?


-- 
I do have a cause though. It&#39;s obscenity. I&#39;m for it.
    - Tom Lehrer
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;04&nbsp;10:00:32&nbsp;2009</span>
    <span class="description">wb8tyw [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42148] exit.t update for VMS returning Unix status codes.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 04 Apr 2009 09:00:12 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Malmberg &lt;wb8tyw [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Michael G Schwern via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=42148">http://rt.cpan.org/Ticket/Display.html?id=42148</a></span> &gt;
&gt; 
&gt; wb8tyw@gmail.com via RT wrote:
&gt; 
<div class="message-stanza open"><div class="message-stanza open"><div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt;EAGLE&gt; perl --version
</div>&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;This is perl, v5.11.0 &#40;GitLive-blead-887-g0a8c518*&#41; built for 
&gt;&gt;&gt;&gt;VMS_AXP-ithread
</div>&gt;&gt;&gt;
&gt;&gt;&gt;Please try it again with 5.10, otherwise we have two moving targets and
&gt;&gt;&gt;you don&#39;t know which one is broken.
</div>&gt;&gt;
&gt;&gt;I actually do not have 5.10 installed on this system.
</div>&gt; 
&gt; 
&gt; Could you install 5.10 or dig up 5.8.8?  Sorry to push the point but any tests
&gt; done using an unstable perl, pass or fail, are suspect and cannot be relied upon.
</div>
This is on Perl 5.10 on encompasserve.org which anyone can get an 
non-privileged VMS shell account on.

$ perl --version

This is perl, v5.10.0 built for VMS_AXP

Copyright 1987-2007, Larry Wall
&lt;snip&gt;


$ mmk test
MCR eisner$lda1:[perl.perl-5_10_0]perl.exe &#34;-MExtUtils::Command::MM&#34; 
&#34;-e&#34; &#34;test_
harness&#40;0, &#39;[.blib.lib]&#39;, &#39;[.blib.arch]&#39;&#41;&#34; t/*.t t/*/*.t
&lt;passing tests snipped&gt;


t/exit..................................

#   Failed test &#39;death.plx exited with 4 &#40;expected 255&#41;&#39;
#   at t/exit.t line 89.
#          got: 4
#     expected: 0
%SYSTEM-F-ABORT, abort

#   Failed test &#39;too_few.plx exited with 4 &#40;expected 255&#41;&#39;
#   at t/exit.t line 89.
#          got: 4
#     expected: 0
%SYSTEM-F-ABORT, abort

#   Failed test &#39;too_few_fail.plx exited with 4 &#40;expected 2&#41;&#39;
#   at t/exit.t line 89.
#          got: 4
#     expected: 2
%SYSTEM-F-ABORT, abort

#   Failed test &#39;five_fail.plx exited with 4 &#40;expected 5&#41;&#39;
#   at t/exit.t line 89.
#          got: 4
#     expected: 0

#   Failed test &#39;death_with_handler.plx exited with 4 &#40;expected 255&#41;&#39;
#   at t/exit.t line 89.
#          got: 4
#     expected: 0
%SYSTEM-F-ABORT, abort

#   Failed test &#39;extras.plx exited with 4 &#40;expected 2&#41;&#39;
#   at t/exit.t line 89.
#          got: 4
#     expected: 2
%SYSTEM-F-ABORT, abort

#   Failed test &#39;two_fail.plx exited with 4 &#40;expected 2&#41;&#39;
#   at t/exit.t line 89.
#          got: 4
#     expected: 2

#   Failed test &#39;last_minute_death.plx exited with 4 &#40;expected 255&#41;&#39;
#   at t/exit.t line 89.
#          got: 4
#     expected: 0
%SYSTEM-F-ABORT, abort
FAILED tests 1-2, 4-5, 7-8, 10, 12
         Failed 8/14 tests, 42.86% okay


&lt;passing tests snipped&gt;
Failed Test Stat Wstat Total Fail  List of Failed
-------------------------------------------------------------------------------
t/exit.t                  14    8  1-2 4-5 7-8 10 12
8 tests and 10 subtests skipped.
Failed 1/90 test scripts. 8/670 subtests failed.
Files=90, Tests=670, 88 wallclock secs &#40; 0.00 cusr +  0.00 csys =  0.00 CPU&#41;
Failed 1/90 test programs. 8/670 subtests failed.
%SYSTEM-F-ABORT, abort
%MMK-F-ERRUPD, error status %X0000002C occurred when updating target 
TEST_DYNAMIC

Regards,
-John
wb8tyw@gmail.com
Personal Opinion Only
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;07&nbsp;11:46:52&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42148] exit.t update for VMS returning Unix status codes.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 07 Apr 2009 08:46:32 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">wb8tyw@gmail.com via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This is on Perl 5.10 on encompasserve.org which anyone can get an 
&gt; non-privileged VMS shell account on.
</div>
I&#39;ve got myself an account on there and I&#39;ll work this out, at least so far as
getting basic VMS working again.


-- 
But there&#39;s no sense crying over every mistake.
You just keep on trying till you run out of cake.
    -- Jonathan Coulton, &#34;Still Alive&#34;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;09&nbsp;22:28:11&nbsp;2009</span>
    <span class="description">wb8tyw [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42148] exit.t update for VMS returning Unix status codes.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 09 Apr 2009 21:27:41 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Malmberg &lt;wb8tyw [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Michael G Schwern via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=42148">https://rt.cpan.org/Ticket/Display.html?id=42148</a></span> &gt;
&gt; 
&gt; wb8tyw@gmail.com via RT wrote:
<div class="message-stanza open">&gt;&gt; This is on Perl 5.10 on encompasserve.org which anyone can get an 
&gt;&gt; non-privileged VMS shell account on.
</div>&gt; 
&gt; I&#39;ve got myself an account on there and I&#39;ll work this out, at least so far as
&gt; getting basic VMS working again.
</div>
To get to a file system that supports the names that GIT generates:

$ set default USR_ODS5:

Note that in Perl&#39;s default mode, it may not recognize or use all of 
those names.

To get at a bash shell, do the following:

$ @gnv$gnu:[lib]gnv_setup.com
$ bash

The gnv_setup.com procedure leaves a logical name BIN behind that this 
version of bash and make require.

These utilities are not exactly like Unix, and they are a bit old, but 
they should help a bit.

Regards,
-John
Personal Opinion Only
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;10&nbsp;13:25:22&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42148] exit.t update for VMS returning Unix status codes.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 10 Apr 2009 10:24:58 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">wb8tyw@gmail.com via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Test-Simple
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=42148">http://rt.cpan.org/Ticket/Display.html?id=42148</a></span> &gt;
&gt; 
&gt; Michael G Schwern via RT wrote:
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=42148">https://rt.cpan.org/Ticket/Display.html?id=42148</a></span> &gt;
&gt;&gt;
&gt;&gt; wb8tyw@gmail.com via RT wrote:
<div class="message-stanza open">&gt;&gt;&gt; This is on Perl 5.10 on encompasserve.org which anyone can get an 
&gt;&gt;&gt; non-privileged VMS shell account on.
</div>&gt;&gt; I&#39;ve got myself an account on there and I&#39;ll work this out, at least so far as
&gt;&gt; getting basic VMS working again.
</div>&gt; 
&gt; To get to a file system that supports the names that GIT generates:
&gt; 
&gt; $ set default USR_ODS5:
&gt; 
&gt; Note that in Perl&#39;s default mode, it may not recognize or use all of 
&gt; those names.
&gt; 
&gt; To get at a bash shell, do the following:
&gt; 
&gt; $ @gnv$gnu:[lib]gnv_setup.com
&gt; $ bash
&gt; 
&gt; The gnv_setup.com procedure leaves a logical name BIN behind that this 
&gt; version of bash and make require.
&gt; 
&gt; These utilities are not exactly like Unix, and they are a bit old, but 
&gt; they should help a bit.
</div>
Thanks for all that.  I&#39;m trying it out now.

Oh thank god, they have ssh.  But scp doesn&#39;t work.  I just get the login
MOTD, password query and then nothing.  Similar issue with sftp.  Any ideas?

FTP is also unhappy.

$ ftp ftp://schwern@encompasserve.org
Connected to encompasserve.org.
220 Eisner.Encompasserve.org MultiNet FTP Server Process V5.2&#40;16&#41; at Fri
10-Apr-2009 11:30AM-CDT
331 User name &#40;schwern&#41; ok. Password, please.
Password:
230 User SCHWERN logged into DISK_USER:[DECUSERVE_USER.SCHWERN] at Fri
10-Apr-2009 11:30AM-CDT, job 18137.
Remote system type is VMS.
200 Type I ok.
550 %%RMS-F-DIR, error in directory name:
221 QUIT command received. Goodbye.

HEY!  ncftp worked!  I&#39;ve got something... except it represents capitalized
letters as $E$ so I get fun things like.
$e$xt$u$tils-$m$ake$m$aker-6.50$5ntar$5ngz

I&#39;ll have to push tarballs around then. :/

Normalizing ssh/scp/rsync access would speed up development a lot.  If nothing
else then I can edit with emacs&#39;s remote filesystem emulation stuff.

But woo!  I got emacs ange-ftp working!  I have a remote editor.  Excellent.

A lot of stuff is broken.  To patching!


-- 
170. Not allowed to &#34;defect&#34; to OPFOR during training missions.
    -- The 213 Things Skippy Is No Longer Allowed To Do In The U.S. Army
           <span class="clickylink"><a target="new" rel="nofollow" href="http://skippyslist.com/list/">http://skippyslist.com/list/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;10&nbsp;20:42:59&nbsp;2009</span>
    <span class="description">wb8tyw [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42148] exit.t update for VMS returning Unix status codes.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 10 Apr 2009 19:42:43 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Malmberg &lt;wb8tyw [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Michael G Schwern via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=42148">https://rt.cpan.org/Ticket/Display.html?id=42148</a></span> &gt;
</div>
Forgot to mention that MMS may not work on ODS-5 disks, MMK needs to be 
used instead.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks for all that.  I&#39;m trying it out now.
&gt; 
&gt; Oh thank god, they have ssh.  But scp doesn&#39;t work.  I just get the login
&gt; MOTD, password query and then nothing.  Similar issue with sftp.  Any ideas?
&gt; 
&gt; FTP is also unhappy.
</div>
&lt;snip&gt;
That should work.  I will investigate this weekend as I FTP stuff up 
with out any issues.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; HEY!  ncftp worked!  I&#39;ve got something... except it represents capitalized
&gt; letters as $E$ so I get fun things like.
&gt; $e$xt$u$tils-$m$ake$m$aker-6.50$5ntar$5ngz
</div>
That is one of the encoding methods to make UNIX like filenames exist on 
the traditional VMS ODS-2 file system.  Each $ shifts the case of the 
following characters.

There are a few of them.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ll have to push tarballs around then. :/
&gt; 
&gt; Normalizing ssh/scp/rsync access would speed up development a lot.  If nothing
&gt; else then I can edit with emacs&#39;s remote filesystem emulation stuff.
&gt; 
&gt; But woo!  I got emacs ange-ftp working!  I have a remote editor.  Excellent.
&gt; 
&gt; A lot of stuff is broken.  To patching!
</div>
I may be able to get you an rsync client that I am still working on.  It 
mostly works, but under some conditions it will corrupt files it is 
receiving.

VIM should be present under GNV.

The $deas BIN command will remove the offending BIN logical that breaks 
Perl and other applications, but then you may need to $ DEFINE BIN 
GNV$GNU:[BIN] to get bash and make to work.

Tar is at 1.19 and both gzip and bzip2 are supported.

Regards,
-John
Personal Opinion Only
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;11&nbsp;15:38:26&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42148] exit.t update for VMS returning Unix status codes.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 11 Apr 2009 12:38:06 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Well, I&#39;ve figured it out.  For some reason loading Test::Builder changes the
behavior of the exit code handling.  I&#39;ve been testing it with exit 5.  Under
Test::Builder that becomes 4.  Without it&#39;s 0.

    perl -wle &#39;use Test::Builder;  exit 5&#39;

works different from

    perl -wle &#39;exit 5&#39;

on VMS.

I&#39;ve isolated it to this:

    # Exits with SS$ABORT wait 1024
    exit 5;

    END {
        $? = 5;
        return;
    }

There&#39;s something about assigning to $?.  Interestingly, this doesn&#39;t have an
effect:

    # Exits with 0
    exit 5;

    END {
        $? = $?;
        return;
    }

I suspect some magic attached to $? is getting lost, but Devel::Peek shows no
difference between the two.  I suspected the magic might be in exit&#40;&#41;, and
tried this:

    # Exits with 0
    exit 5;

    END {
        $? = 5;
        exit $?;
    }

and that seems to be it.

In the end, the shortest emulation is:

    END { $? = 5; }

Because that causes a &#34;%SYSTEM-F-ABORT&#34; I wouldn&#39;t be surprised if something
in vmsperl is actually freaking out.  Anyhow, it has the desired effect.

Unfortunately, now I get a string of &#34;%SYSTEM-F-ABORT, abort&#34; messages from
the test which I&#39;m having difficulty suppressing.  But at least it works.

Thoughts?


-- 
54. &#34;Napalm sticks to kids&#34; is *not* a motivational phrase.
    -- The 213 Things Skippy Is No Longer Allowed To Do In The U.S. Army
           <span class="clickylink"><a target="new" rel="nofollow" href="http://skippyslist.com/list/">http://skippyslist.com/list/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;11&nbsp;20:11:35&nbsp;2009</span>
    <span class="description">wb8tyw [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42148] exit.t update for VMS returning Unix status codes.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 11 Apr 2009 19:11:17 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Malmberg &lt;wb8tyw [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Michael G Schwern via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=42148">http://rt.cpan.org/Ticket/Display.html?id=42148</a></span> &gt;
&gt; 
&gt; Well, I&#39;ve figured it out.  For some reason loading Test::Builder changes the
&gt; behavior of the exit code handling.  I&#39;ve been testing it with exit 5.  Under
&gt; Test::Builder that becomes 4.  Without it&#39;s 0.
&gt; 
&gt;     perl -wle &#39;use Test::Builder;  exit 5&#39;
 &gt;
&gt; works different from
&gt; 
&gt;     perl -wle &#39;exit 5&#39;
</div>
This the results in the new POSIX mode of 5.11:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">EAGLE&gt; perl -wle &#34;use Test::Builder; exit 5&#34;
</div>
- VMS native status code:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">EAGLE&gt; show sym $status
</div>    $STATUS == &#34;%X0035A029&#34;

- How UNIX programs, including Bash and Perl will see the exit code:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">EAGLE&gt; write sys$output &#40;&#39;$status&#39; .and. %x07f8&#41; / 8
</div>5

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">EAGLE&gt; perl -wle &#34;exit 5&#34;
EAGLE&gt; show sym $status
</div>    $STATUS == &#34;%X0035A029&#34;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">EAGLE&gt; write sys$output &#40;&#39;$status&#39; .and. %x07f8&#41; / 8
</div>5


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; on VMS.
&gt; 
&gt; I&#39;ve isolated it to this:
&gt; 
&gt;     # Exits with SS$ABORT wait 1024
&gt;     exit 5;
&gt; 
&gt;     END {
&gt;         $? = 5;
&gt;         return;
&gt;     }
&gt; 
&gt; There&#39;s something about assigning to $?.  Interestingly, this doesn&#39;t have an
&gt; effect:
&gt; 
&gt;     # Exits with 0
&gt;     exit 5;
&gt; 
&gt;     END {
&gt;         $? = $?;
&gt;         return;
&gt;     }
&gt; 
&gt; I suspect some magic attached to $? is getting lost, but Devel::Peek shows no
&gt; difference between the two.  I suspected the magic might be in exit&#40;&#41;, and
&gt; tried this:
&gt; 
&gt;     # Exits with 0
&gt;     exit 5;
&gt; 
&gt;     END {
&gt;         $? = 5;
&gt;         exit $?;
&gt;     }
&gt; 
&gt; and that seems to be it.
&gt; 
&gt; In the end, the shortest emulation is:
&gt; 
&gt;     END { $? = 5; }
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">EAGLE&gt; perl -wle &#34;END { $? = 5; }&#34;
EAGLE&gt; show sym $status
</div>    $STATUS == &#34;%X0035A029&#34;

Which as above preserves the code of 5 for Unix programs.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Because that causes a &#34;%SYSTEM-F-ABORT&#34; I wouldn&#39;t be surprised if something
&gt; in vmsperl is actually freaking out.  Anyhow, it has the desired effect.
</div>
The traditional code in perl on VMS converts any error code to 
%SYSTEM-F-ABORT when Perl exits.  It is the expected behavior.

The DCL command to produce this error is $ EXIT 44.

On VMS, the exit code is signaled as an exception when it is an error, 
and when STDERR and STDOUT are separate, the exception is written out to 
both streams.

The POSIX behavior that can be optionally enabled on 5.11 &#40;blead&#41; is 
actually more correct for both VMS mode and UNIX mode.  Making it the 
default could break scripts that are calling Perl code though.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Unfortunately, now I get a string of &#34;%SYSTEM-F-ABORT, abort&#34; messages from
&gt; the test which I&#39;m having difficulty suppressing.  But at least it works.
</div>
The existing Test/Simple.t in blead-perl emits 12 %SYSTEM-F-ABORT 
messages.  The TEST.COM code on VMS appears to deal with them.


The perl 5.10 on Encompasserve does not have a complete implementation 
of the POSIX exit code handling that behaves both as a UNIX program 
expects, but also is correct for DCL and MMS handling.


Regards,
-John
wb8tyw@gmail.com
Personal Opinion Only
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;11&nbsp;21:07:32&nbsp;2009</span>
    <span class="description">wb8tyw [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42148] exit.t update for VMS returning Unix status codes.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 11 Apr 2009 20:07:14 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Malmberg &lt;wb8tyw [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Michael G Schwern via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; FTP is also unhappy.
&gt; 
&gt; $ ftp ftp://schwern@encompasserve.org
&gt; Connected to encompasserve.org.
&gt; 220 Eisner.Encompasserve.org MultiNet FTP Server Process V5.2&#40;16&#41; at Fri
&gt; 10-Apr-2009 11:30AM-CDT
&gt; 331 User name &#40;schwern&#41; ok. Password, please.
&gt; Password:
&gt; 230 User SCHWERN logged into DISK_USER:[DECUSERVE_USER.SCHWERN] at Fri
&gt; 10-Apr-2009 11:30AM-CDT, job 18137.
&gt; Remote system type is VMS.
&gt; 200 Type I ok.
&gt; 550 %%RMS-F-DIR, error in directory name:
&gt; 221 QUIT command received. Goodbye.
</div>
-bash-3.00$ ftp malmberg@encompasserve.org
ftp: malmberg@encompasserve.org: Name or service not known
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">ftp&gt; bye
</div>
The linux system I have access to does not recognize that syntax.

-bash-3.00$ ftp encompasserve.org
Connected to encompasserve.org &#40;67.53.90.116&#41;.
220 Eisner.Encompasserve.org MultiNet FTP Server Process V5.2&#40;16&#41; at Sat 
11-Apr-2009 7:45PM-CDT
Name &#40;encompasserve.org:jmalmberg&#41;: malmberg
331 User name &#40;malmberg&#41; ok. Password, please.
Password:
230 User MALMBERG logged into 
DISK_MODERATOR:[DECUSERVE_MODERATOR.MALMBERG] at Sat 11-Apr-2009 
7:46PM-CDT, job 33d19.
Remote system type is VMS.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">ftp&gt; dir
</div>227 Entering passive mode; use PORT &#40;67,53,90,116,10,43&#41;
150 List started.

It is working for me, so I am passing this information on to the system 
managers as something is obviously wrong.

Regards,
-John
wb8tyw@gmail.com
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;11&nbsp;21:44:52&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42148] exit.t update for VMS returning Unix status codes.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 11 Apr 2009 18:44:30 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">wb8tyw@gmail.com via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; Well, I&#39;ve figured it out.  For some reason loading Test::Builder changes the
&gt;&gt; behavior of the exit code handling.  I&#39;ve been testing it with exit 5.  Under
&gt;&gt; Test::Builder that becomes 4.  Without it&#39;s 0.
&gt;&gt;
&gt;&gt;     perl -wle &#39;use Test::Builder;  exit 5&#39;
</div><div class="message-stanza open">&gt;  &gt;
</div><div class="message-stanza open">&gt;&gt; works different from
&gt;&gt;
&gt;&gt;     perl -wle &#39;exit 5&#39;
</div>&gt; 
&gt; This the results in the new POSIX mode of 5.11:
</div>
Does the new t/exit.t work?


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; EAGLE&gt; perl -wle &#34;END { $? = 5; }&#34;
&gt; EAGLE&gt; show sym $status
</div>&gt;     $STATUS == &#34;%X0035A029&#34;
&gt; 
&gt; Which as above preserves the code of 5 for Unix programs.
&gt; 
<div class="message-stanza open">&gt;&gt; Because that causes a &#34;%SYSTEM-F-ABORT&#34; I wouldn&#39;t be surprised if something
&gt;&gt; in vmsperl is actually freaking out.  Anyhow, it has the desired effect.
</div>&gt; 
&gt; The traditional code in perl on VMS converts any error code to 
&gt; %SYSTEM-F-ABORT when Perl exits.  It is the expected behavior.
</div>
For the rest of this discussion, let&#39;s leave the new POSIX stuff out of it.
I&#39;m just trying to get exit.t working under normal conditions right now.

If it&#39;s the expected behavior, why are they different on 5.10?

$ perl -wle &#34;exit 5&#34;
$ show sym $status
  $STATUS == &#34;%X00000005&#34;

$ perl -wle &#34;END { $? = 5 }&#34;
%SYSTEM-F-ABORT, abort
$ show sym $status
  $STATUS == &#34;%X0000002C&#34;

$ perl -wle &#34;exit 6&#34;
%NONAME-?-NOMSG, Message number 00000006
$ show sym $status
  $STATUS == &#34;%X00000006&#34;

$ perl -wle &#34;END { $? = 6}&#34;
%SYSTEM-F-ABORT, abort
$ show sym $status
  $STATUS == &#34;%X0000002C&#34;

They&#39;re obviously not equivalent.

If the exit status is being preserved on the command line, it&#39;s not being
preserved through a system&#40;&#41; call like so:

$ cat exit_test
exit shift;

$ perl -wle &#34;system $^X, exit_test, 5; print $?&#34;
0
$ perl -wle &#34;system $^X, exit_test, 4; print $?&#34;
%NONAME-F-NOMSG, Message number 00000004
%NONAME-F-NOMSG, Message number 00000004
1024
$ perl -wle &#34;system $^X, exit_test, 3; print $?&#34;
0
$ perl -wle &#34;system $^X, exit_test, 2; print $?&#34;
%NONAME-E-NOMSG, Message number 00000002
%NONAME-E-NOMSG, Message number 00000002
512
$ perl -wle &#34;system $^X, exit_test, 1; print $?&#34;
%SYSTEM-F-ABORT, abort
%SYSTEM-F-ABORT, abort
1024

It feels like system&#40;&#41; is undoing the Unix exit&#40;&#41; emulation.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; Unfortunately, now I get a string of &#34;%SYSTEM-F-ABORT, abort&#34; messages from
&gt;&gt; the test which I&#39;m having difficulty suppressing.  But at least it works.
</div>&gt; 
&gt; The existing Test/Simple.t in blead-perl emits 12 %SYSTEM-F-ABORT 
&gt; messages.  The TEST.COM code on VMS appears to deal with them.
</div>
Test::Harness sure doesn&#39;t, the user gets a faceful of them.  And there&#39;s
going to be over 500 of them from exit.t.  This is unacceptable.


-- 
Whip me, beat me, make my code compatible with VMS!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;11&nbsp;21:48:13&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42148] exit.t update for VMS returning Unix status codes.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 11 Apr 2009 18:47:48 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">wb8tyw@gmail.com via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; FTP is also unhappy.
&gt;&gt;
&gt;&gt; $ ftp ftp://schwern@encompasserve.org
&gt;&gt; Connected to encompasserve.org.
&gt;&gt; 220 Eisner.Encompasserve.org MultiNet FTP Server Process V5.2&#40;16&#41; at Fri
&gt;&gt; 10-Apr-2009 11:30AM-CDT
&gt;&gt; 331 User name &#40;schwern&#41; ok. Password, please.
&gt;&gt; Password:
&gt;&gt; 230 User SCHWERN logged into DISK_USER:[DECUSERVE_USER.SCHWERN] at Fri
&gt;&gt; 10-Apr-2009 11:30AM-CDT, job 18137.
&gt;&gt; Remote system type is VMS.
&gt;&gt; 200 Type I ok.
&gt;&gt; 550 %%RMS-F-DIR, error in directory name:
&gt;&gt; 221 QUIT command received. Goodbye.
</div>&gt; 
&gt; -bash-3.00$ ftp malmberg@encompasserve.org
&gt; ftp: malmberg@encompasserve.org: Name or service not known
<div class="message-stanza open">&gt; ftp&gt; bye
</div>&gt; 
&gt; The linux system I have access to does not recognize that syntax.
</div>
Doing a plain &#34;ftp schwern@encompasserve.org&#34; worked.  ftp must have tried to
do something fancy when given an ftp URL.  Weird.

PS  That&#39;s OS X&#39;s ftp, so BSD-ish.


-- 
Alligator sandwich, and make it snappy!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;11&nbsp;23:10:34&nbsp;2009</span>
    <span class="description">wb8tyw [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42148] exit.t update for VMS returning Unix status codes.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 11 Apr 2009 22:10:12 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org, &#34;Craig A. Berry&#34; &lt;craigberry [...] mac.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Malmberg &lt;wb8tyw [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Michael G Schwern via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=42148">http://rt.cpan.org/Ticket/Display.html?id=42148</a></span> &gt;
&gt; 
&gt; wb8tyw@gmail.com via RT wrote:
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt; Well, I&#39;ve figured it out.  For some reason loading Test::Builder changes the
&gt;&gt;&gt; behavior of the exit code handling.  I&#39;ve been testing it with exit 5.  Under
&gt;&gt;&gt; Test::Builder that becomes 4.  Without it&#39;s 0.
&gt;&gt;&gt;
&gt;&gt;&gt;     perl -wle &#39;use Test::Builder;  exit 5&#39;
</div><div class="message-stanza open">&gt;&gt;  &gt;
</div><div class="message-stanza open">&gt;&gt;&gt; works different from
&gt;&gt;&gt;
&gt;&gt;&gt;     perl -wle &#39;exit 5&#39;
</div>&gt;&gt; This the results in the new POSIX mode of 5.11:
</div>&gt; 
&gt; Does the new t/exit.t work?
</div>
As I posted earlier, it worked in the new POSIX mode, not the VMS mode.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt; EAGLE&gt; perl -wle &#34;END { $? = 5; }&#34;
&gt;&gt; EAGLE&gt; show sym $status
</div>&gt;&gt;     $STATUS == &#34;%X0035A029&#34;
&gt;&gt;
&gt;&gt; Which as above preserves the code of 5 for Unix programs.
&gt;&gt;
<div class="message-stanza open">&gt;&gt;&gt; Because that causes a &#34;%SYSTEM-F-ABORT&#34; I wouldn&#39;t be surprised if something
&gt;&gt;&gt; in vmsperl is actually freaking out.  Anyhow, it has the desired effect.
</div>&gt;&gt; The traditional code in perl on VMS converts any error code to 
&gt;&gt; %SYSTEM-F-ABORT when Perl exits.  It is the expected behavior.
</div>&gt; 
&gt; For the rest of this discussion, let&#39;s leave the new POSIX stuff out of it.
&gt; I&#39;m just trying to get exit.t working under normal conditions right now.
&gt; 
&gt; If it&#39;s the expected behavior, why are they different on 5.10?
&gt; 
&gt; $ perl -wle &#34;exit 5&#34;
&gt; $ show sym $status
&gt;   $STATUS == &#34;%X00000005&#34;
</div>
Expected behavior, exit code is passed through to DCL.

Also an incorrect behavior if the exit code is a UNIX status, as does 
not map to a valid VMS status code.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; $ perl -wle &#34;END { $? = 5 }&#34;
&gt; %SYSTEM-F-ABORT, abort
&gt; $ show sym $status
&gt;   $STATUS == &#34;%X0000002C&#34;
</div>
An error status was set.  Traditionally these were translated to 0x2C on 
exit.  Again expected behavior.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; $ perl -wle &#34;exit 6&#34;
&gt; %NONAME-?-NOMSG, Message number 00000006
&gt; $ show sym $status
&gt;   $STATUS == &#34;%X00000006&#34;
</div>
Again expected behavior, exit code is passed through to DCL.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; $ perl -wle &#34;END { $? = 6}&#34;
&gt; %SYSTEM-F-ABORT, abort
&gt; $ show sym $status
&gt;   $STATUS == &#34;%X0000002C&#34;
</div>
And again, expected behavior, setting the error status caused the exit 
status of 0x2c to be set.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; They&#39;re obviously not equivalent.
</div>
No.  And when passed UNIX style values, they were not compliant with the 
VMS conventions for the status codes.

The algorithm for encoding UNIX status values into VMS status codes 
showed up in the VMS 7.x timeframe.  Perl on VMS is much older than 
that.  Unfortunately it also was not documented.  I have a bug filed to 
get that documented in the VMS C runtime library manual, but am no 
longer in a position to track the status of that bug.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If the exit status is being preserved on the command line, it&#39;s not being
&gt; preserved through a system&#40;&#41; call like so:
&gt; 
&gt; $ cat exit_test
&gt; exit shift;
&gt; 
&gt; $ perl -wle &#34;system $^X, exit_test, 5; print $?&#34;
&gt; 0
</div>
Traditional behavior, VMS exit codes that are odd are considered 
success.  The VMS success status is 1, which when passed back to perl is 
translated to 0.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; $ perl -wle &#34;system $^X, exit_test, 4; print $?&#34;
&gt; %NONAME-F-NOMSG, Message number 00000004
&gt; %NONAME-F-NOMSG, Message number 00000004
&gt; 1024
</div>
Exit code 4 is a failure status of Fatal severity.  It is also an 
undefined code for the system facilty.  This is passed through as an 
error status.

When I tried that, I am not getting the duplicate error mesages, only one.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; $ perl -wle &#34;system $^X, exit_test, 3; print $?&#34;
&gt; 0
</div>
You will see this for all odd values.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; $ perl -wle &#34;system $^X, exit_test, 2; print $?&#34;
&gt; %NONAME-E-NOMSG, Message number 00000002
&gt; %NONAME-E-NOMSG, Message number 00000002
&gt; 512
</div>
Even statuses are failures.  Status 2 is of Error severity, not as bad 
as a Fatal.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; $ perl -wle &#34;system $^X, exit_test, 1; print $?&#34;
&gt; %SYSTEM-F-ABORT, abort
&gt; %SYSTEM-F-ABORT, abort
&gt; 1024
</div>
And because traditionally VMS considers a UNIX exit status of 1 to be an 
error, it gets mapped to 0x2c externally and 4 internally.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It feels like system&#40;&#41; is undoing the Unix exit&#40;&#41; emulation.
</div>
It never was exactly correct on Perl on VMS in traditional mode, just a 
compromise to signal success or error.  But again, a correct but 
undocumented convention did not show up until many years after the 
behavior of Perl became expected on VMS.

We now have a more correct emulation, but backwards compatibility needs 
to be maintained.  I think it is SIGTERM that Perl is not trapping and 
mapping back to the correct encoded Unix status.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt; Unfortunately, now I get a string of &#34;%SYSTEM-F-ABORT, abort&#34; messages from
&gt;&gt;&gt; the test which I&#39;m having difficulty suppressing.  But at least it works.
</div>&gt;&gt; The existing Test/Simple.t in blead-perl emits 12 %SYSTEM-F-ABORT 
&gt;&gt; messages.  The TEST.COM code on VMS appears to deal with them.
</div>&gt; 
&gt; Test::Harness sure doesn&#39;t, the user gets a faceful of them.  And there&#39;s
&gt; going to be over 500 of them from exit.t.  This is unacceptable.
</div>
I am not sure how to suppress them.  VMS emits the error message when 
given the one liner used in the test with an even status.  Turning off 
requires sending multiple commands, each on their own line before the 
Perl command is executed, or capturing the stderr stream, and I have not 
been able to get that to work on the system&#40;&#41; call.

Craig or some one on the vmsperl list may have a better answer.

Also:
Encompasserve.org volunteers are investigating why scp is broken.  I do 
not have an eta on a fix.

Regards,
-John
wb8tyw@gmail.com
Personal Opinion Only
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;12&nbsp;08:59:29&nbsp;2009</span>
    <span class="description">craigberry [...] mac.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42148] exit.t update for VMS returning Unix status codes.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 12 Apr 2009 07:58:23 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> John Malmberg &lt;wb8tyw [...] gmail.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Craig A. Berry&#34; &lt;craigberry [...] mac.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On Apr 11, 2009, at 10:10 PM, John Malmberg wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Michael G Schwern via RT wrote:
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=42148">http://rt.cpan.org/Ticket/Display.html?id=42148</a></span> &gt;
&gt;&gt; wb8tyw@gmail.com via RT wrote:
<div class="message-stanza open">&gt;&gt;&gt;
</div></div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt; Unfortunately, now I get a string of &#34;%SYSTEM-F-ABORT, abort&#34;  
&gt;&gt;&gt;&gt; messages from
&gt;&gt;&gt;&gt; the test which I&#39;m having difficulty suppressing.  But at least  
&gt;&gt;&gt;&gt; it works.
</div>&gt;&gt;&gt; The existing Test/Simple.t in blead-perl emits 12 %SYSTEM-F-ABORT  
&gt;&gt;&gt; messages.  The TEST.COM code on VMS appears to deal with them.
</div>&gt;&gt; Test::Harness sure doesn&#39;t, the user gets a faceful of them.  And  
&gt;&gt; there&#39;s
&gt;&gt; going to be over 500 of them from exit.t.  This is unacceptable.
</div>&gt;
&gt; I am not sure how to suppress them.  VMS emits the error message  
&gt; when given the one liner used in the test with an even status.   
&gt; Turning off requires sending multiple commands, each on their own  
&gt; line before the Perl command is executed, or capturing the stderr  
&gt; stream, and I have not been able to get that to work on the system&#40;&#41;  
&gt; call.
&gt;
&gt; Craig or some one on the vmsperl list may have a better answer.
</div>

I don&#39;t know enough about the context to know if this is helpful, but  
there is a pragma to suppress messages.  And since it&#39;s Easter, here&#39;s  
a demonstration with an easter egg status code:

$ perl -wle &#34;exit 2928;&#34;
%SYSTEM-W-FISH, my hovercraft is full of eels
$ show symbol $status
   $STATUS == &#34;%X00000B70&#34;
$ perl -wle &#34;use vmsish &#39;hushed&#39;; exit 2928;&#34;
$ show symbol $status
   $STATUS == &#34;%X10000B70&#34;


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">________________________________________
Craig A. Berry
mailto:craigberry@mac.com

&#34;... getting out of a sonnet is much more
  difficult than getting in.&#34;
                  Brad Leithauser
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;12&nbsp;12:33:36&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42148] exit.t update for VMS returning Unix status codes.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 12 Apr 2009 09:33:19 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">craigberry@mac.com via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I don&#39;t know enough about the context to know if this is helpful, but  
&gt; there is a pragma to suppress messages.  And since it&#39;s Easter, here&#39;s  
&gt; a demonstration with an easter egg status code:
&gt; 
&gt; $ perl -wle &#34;exit 2928;&#34;
&gt; %SYSTEM-W-FISH, my hovercraft is full of eels
&gt; $ show symbol $status
&gt;    $STATUS == &#34;%X00000B70&#34;
</div>
HA!


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; $ perl -wle &#34;use vmsish &#39;hushed&#39;; exit 2928;&#34;
&gt; $ show symbol $status
&gt;    $STATUS == &#34;%X10000B70&#34;
</div>
We&#39;re already using hushed, but it appears to be part of the exit&#40;&#41; magic.

$ perl -e &#34;use vmsish qw&#40;hushed&#41;; exit 4&#34;
$ perl -e &#34;use vmsish qw&#40;hushed&#41;; END { $? = 4 }&#34;
%SYSTEM-F-ABORT, abort
$ perl -e &#34;use vmsish qw&#40;hushed&#41;; END { $? = 4; exit 4 }&#34;

Maybe I should look into going back to using exit&#40;&#41; in Test::Builder.  I
dropped it because of 5.5 and 5.6 issues.  Yet another reason to drop 5.6.


-- 
170. Not allowed to &#34;defect&#34; to OPFOR during training missions.
    -- The 213 Things Skippy Is No Longer Allowed To Do In The U.S. Army
           <span class="clickylink"><a target="new" rel="nofollow" href="http://skippyslist.com/list/">http://skippyslist.com/list/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;12&nbsp;13:15:55&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42148] exit.t update for VMS returning Unix status codes.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 12 Apr 2009 10:15:39 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">wb8tyw@gmail.com via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt; This the results in the new POSIX mode of 5.11:
</div>&gt;&gt; Does the new t/exit.t work?
</div>&gt; 
&gt; As I posted earlier, it worked in the new POSIX mode, not the VMS mode.
</div>
There&#39;s a new alpha out which works in VMS mode for me.  And new work is
always available on github.
<span class="clickylink"><a target="new" rel="nofollow" href="http://github.com/schwern/test-more/tree/master">http://github.com/schwern/test-more/tree/master</a></span>


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; For the rest of this discussion, let&#39;s leave the new POSIX stuff out of it.
&gt;&gt; I&#39;m just trying to get exit.t working under normal conditions right now.
&gt;&gt;
&gt;&gt; If it&#39;s the expected behavior, why are they different on 5.10?
&gt;&gt;
&gt;&gt; $ perl -wle &#34;exit 5&#34;
&gt;&gt; $ show sym $status
&gt;&gt;   $STATUS == &#34;%X00000005&#34;
</div>&gt; 
&gt; Expected behavior, exit code is passed through to DCL.
&gt; 
&gt; Also an incorrect behavior if the exit code is a UNIX status, as does 
&gt; not map to a valid VMS status code.
</div>
*snip*

Thanks for the details.  This all makes my head hurt.

Maybe instead of building up a full exit map the test can just check a handful
of giveaway values that we&#39;re in VMS exit mode.

Or I can throw up my hands in defeat and put in the VMS/POSIX detection code.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Also:
&gt; Encompasserve.org volunteers are investigating why scp is broken.  I do 
&gt; not have an eta on a fix.
</div>
Thanks for looking into that.


-- 
Stabbing you in the face for your own good.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;12&nbsp;23:09:50&nbsp;2009</span>
    <span class="description">wb8tyw [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42148] exit.t update for VMS returning Unix status codes.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 12 Apr 2009 22:09:32 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org, &#34;Craig A. Berry&#34; &lt;craigberry [...] mac.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Malmberg &lt;wb8tyw [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Michael G Schwern via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=42148">https://rt.cpan.org/Ticket/Display.html?id=42148</a></span> &gt;
&gt; 
&gt; wb8tyw@gmail.com via RT wrote:
<div class="message-stanza open"><div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt; This the results in the new POSIX mode of 5.11:
</div>&gt;&gt;&gt; Does the new t/exit.t work?
</div>&gt;&gt; As I posted earlier, it worked in the new POSIX mode, not the VMS mode.
</div>&gt; 
&gt; There&#39;s a new alpha out which works in VMS mode for me.  And new work is
&gt; always available on github.
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://github.com/schwern/test-more/tree/master">http://github.com/schwern/test-more/tree/master</a></span>
</div>
Is there an FTP address for this?  The Mozilla build I have on VMS is 
refusing to show the download dialog, and when I force it to the tarball 
URL, it is refusing to allow me to download the file.
I have not had time to build a local copy of Mozilla/Firefox to get 
these issues fixed.

I just tried it on Encompasserve.  It is still writing the 
%SYSTEM-F-ABORT messages to the console as it is running the MMK test.

Further testing shows vmsish hushed only affects exit calls, not $? 
assignments.

To suppress the messages on VMS, you need to add 0x10000000 to the value 
that you are going to assign to $?

If the value assigned to $? is over 255 in the new POSIX mode, it 
reverts to the traditional VMS behavior for backwards compatibility.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt; For the rest of this discussion, let&#39;s leave the new POSIX stuff out of it.
&gt;&gt;&gt; I&#39;m just trying to get exit.t working under normal conditions right now.
&gt;&gt;&gt;
&gt;&gt;&gt; If it&#39;s the expected behavior, why are they different on 5.10?
&gt;&gt;&gt;
&gt;&gt;&gt; $ perl -wle &#34;exit 5&#34;
&gt;&gt;&gt; $ show sym $status
&gt;&gt;&gt;   $STATUS == &#34;%X00000005&#34;
</div>&gt;&gt; Expected behavior, exit code is passed through to DCL.
&gt;&gt;
&gt;&gt; Also an incorrect behavior if the exit code is a UNIX status, as does 
&gt;&gt; not map to a valid VMS status code.
</div>&gt; 
&gt; *snip*
&gt; 
&gt; Thanks for the details.  This all makes my head hurt.
</div>
Then you do not want to look at the macros in perl.h that do the heavy 
lifting for this :-&#41;

The latest tar ball worked in the new POSIX mode.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Maybe instead of building up a full exit map the test can just check a handful
&gt; of giveaway values that we&#39;re in VMS exit mode.
</div>
In traditional mode:
   0 is success.
   1 is error.
   2 is error 512 for exit, and 1024 for $?.
   even numbers will be error = 1024.
   odd numbers are exit success and 1024 for $?.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Or I can throw up my hands in defeat and put in the VMS/POSIX detection code.
</div>
It is pretty easy to probe which mode the VMS exit code is in.  In the 
new POSIX exit mode you should get the same results as on UNIX instead 
of the traditional VMS results.

The VMS/POSIX detection code tells you what mode it is supposed to be 
in, that way test code can be sure of what mode things should be in.


Regards,
-John
wb8tyw@gmail.com
Personal Opinion Only
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;14&nbsp;00:46:01&nbsp;2009</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42148] exit.t update for VMS returning Unix status codes.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 13 Apr 2009 21:45:38 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">wb8tyw@gmail.com via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Test-Simple
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=42148">http://rt.cpan.org/Ticket/Display.html?id=42148</a></span> &gt;
&gt; 
&gt; Michael G Schwern via RT wrote:
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=42148">https://rt.cpan.org/Ticket/Display.html?id=42148</a></span> &gt;
&gt;&gt;
&gt;&gt; wb8tyw@gmail.com via RT wrote:
<div class="message-stanza open"><div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;&gt;&gt; This the results in the new POSIX mode of 5.11:
</div>&gt;&gt;&gt;&gt; Does the new t/exit.t work?
</div>&gt;&gt;&gt; As I posted earlier, it worked in the new POSIX mode, not the VMS mode.
</div>&gt;&gt; There&#39;s a new alpha out which works in VMS mode for me.  And new work is
&gt;&gt; always available on github.
&gt;&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://github.com/schwern/test-more/tree/master">http://github.com/schwern/test-more/tree/master</a></span>
</div>&gt; 
&gt; Is there an FTP address for this?
</div>
I highly doubt those archive files even exist until you ask for them.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The Mozilla build I have on VMS is 
&gt; refusing to show the download dialog, and when I force it to the tarball 
&gt; URL, it is refusing to allow me to download the file.
&gt; I have not had time to build a local copy of Mozilla/Firefox to get 
&gt; these issues fixed.
</div>
It will work in lynx, though the layout will be a disaster.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; To suppress the messages on VMS, you need to add 0x10000000 to the value 
&gt; that you are going to assign to $?
&gt; 
&gt; If the value assigned to $? is over 255 in the new POSIX mode, it 
&gt; reverts to the traditional VMS behavior for backwards compatibility.
</div>
Leaving us back at square one, it sounds.


-- 
I&#39;m pale as Formica, social skills stunted small. But I&#39;m accurate
like a pica, I know the capital of Nepal. I&#39;m the nemesis of error,
dreadful diction fears my skills, more inquisitive than Jim Lehrer,
snottier than Beverly Hills.
    -- I.L.O.P. Secret Rap  <span class="clickylink"><a target="new" rel="nofollow" href="http://goats.com/archive/020830.html">http://goats.com/archive/020830.html</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;28&nbsp;15:46:49&nbsp;2016</span>
    <span class="description">exodist7 [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Last I checked everything is working in vms as of the latest release. IF this is not correct please open a ticket on github with current issues.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;28&nbsp;15:57:57&nbsp;2016</span>
    <span class="description">exodist7 [...] gmail.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
