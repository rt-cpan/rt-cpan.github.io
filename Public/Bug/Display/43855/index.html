<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #43855 for Test-Weaken: suggest object contents callback</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #43855 for Test-Weaken: suggest object contents callback</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Test-Weaken">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Test-Weaken">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Test-Weaken">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Test-Weaken">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Test-Weaken">Test-Weaken CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">43855</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Test-Weaken">Test-Weaken</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">jkegl [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
user42 [...] zip.com.au

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-45720-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-45721-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
3.000000    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




contents-array.t<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/619888/315171/contents-array.t">
Tue Jun 16 20:00:31 2009 (499b) by user42 [...] zip.com.au
</a>
</font></li>
</ul>


contents.t<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/594209/301064/contents.t">
Wed Apr 22 18:08:52 2009 (1.7k) by user42 [...] zip.com.au
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/591619/299597/contents.t">
Wed Apr 15 20:33:38 2009 (1.8k) by user42 [...] zip.com.au
</a>
</font></li>
</ul>


ignore-obj2.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/619886/315166/ignore-obj2.pl">
Tue Jun 16 19:14:50 2009 (621b) by user42 [...] zip.com.au
</a>
</font></li>
</ul>


Weaken.pm.content.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/619888/315170/Weaken.pm.content.diff">
Tue Jun 16 20:00:31 2009 (943b) by user42 [...] zip.com.au
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=43855">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-573098" href="/Public/Bug/Display.html?id=43855#txn-573098">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;04&nbsp;19:31:25&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> suggest object contents callback</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 05 Mar 2009 11:30:52 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/573098/289231/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/289231">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">It&#39;d be good if Test::Weaken had a callback to fetch the contents of an
object.

In Gtk, sub-widgets or sub-objects aren&#39;t in fields of the object hash,
only in gtk&#39;s structs, which you have to pick out from get_property&#40;&#41;,
get_children&#40;&#41;, etc.  And I believe in the various &#34;inside-out&#34; class
schemes object property data is not in the object itself, but separate.
A callback would make it possible to traverse those things &#40;or the parts
one thinks may be subject to leaks&#41;.

I&#39;m not sure how it would look, maybe

    sub my_gtk_container_children {
      my &#40;$obj&#41; = @_;
      return $obj-&gt;isa&#40;&#39;Gtk2::Container&#39;&#41; &#38;&#38; $obj-&gt;get_children;
    }

    leaks &#40;{ constructor =&gt; ...,
             contents =&gt; \&#38;my_gtk_container_children }&#41;

You can get the same effect in the constructor by recursing into the
objects yourself and returning all the parts.  I&#39;ve been doing that for
gtk container children.  But leaks&#40;&#41; makes exactly such a recursive
traversal, if it could be told about extra contents/fields/properties in
the objects it visits.

As with the ignore option I can imagine multiple contents fetching funcs
intended for different classes.  So a way to pass different bits could
be good.

             contents =&gt; [\&#38;gtk_container_children,
                          \&#38;gobject_properties,
                          \&#38;inside_out_contents,

Fetching might often be a single method like get_children&#40;&#41; above, so a
shorthand giving a class and method could be handy,

             contents =&gt; [ [&#39;Gtk2::Container&#39;,&#39;get_children&#39;],
                           ...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-573668" href="/Public/Bug/Display.html?id=43855#txn-573668">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;05&nbsp;21:28:12&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-573669" href="/Public/Bug/Display.html?id=43855#txn-573669">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;05&nbsp;21:44:12&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/573669/289584/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/289584">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">If I understand this correctly, it&#39;s a request to extend Test::Weaken to
deal with the situation where data internal &#40;in Test::Weaken&#39;s sense of
&#34;internal&#34; -- having the same life expectancy&#41; to an object is not
reachable by following refs, hashes, arrays, etc. from the base object,
but requires certain object methods to be called.

Thus:

sub {
    my $base = new BaseObject;
    return [
         $base,
         $base-&gt;other_stuff_here&#40;&#41;,
         $base-&gt;and_there&#40;&#41;,
         $base-&gt;and_in_yet_another_place&#40;&#41;,
    ];
}

I think this requirement may be best answered by having the user create
a &#34;meta-constructor&#34; like the above to produce a pseudo-object whose
only purpose is to aggregate the object for Test::Weaken.  If I
understand you correctly, you&#39;ve discovered this method on your own and
are already doing that.

This situation is unlike the justification for destructor and ignore
options.  Those options make it possible to do things which could not be
done if they didn&#39;t exist.

Did I understand this correctly?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-573670" href="/Public/Bug/Display.html?id=43855#txn-573670">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;05&nbsp;21:44:12&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-573672" href="/Public/Bug/Display.html?id=43855#txn-573672">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;05&nbsp;21:57:11&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/573672/289586/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/289586">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 631b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Re-reading, I think the central issue might be this:  Can Test::Weaken&#39;s
object traversal logic be leveraged for the contents search, rather than
having to traverse the base object twice, once to assemble the object&#39;s
contents, and a second time to actually do the test?

I think the double traversal is the more straight-forward approach.  And
particularly if we get into all the overhead of callbacks and complex
possibilities, I think two straight-forward traversals will almost
always be more efficient.  I&#39;d certainly expect them to be easier on the
programmer, particularly if we are talking about the maintenance programmer.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-574099" href="/Public/Bug/Display.html?id=43855#txn-574099">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;06&nbsp;17:18:07&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43855] suggest object contents callback</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 07 Mar 2009 09:17:40 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/574099/289842/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/289842">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; If I understand you correctly, you&#39;ve discovered this method on your
&gt; own and are already doing that.
</div>
Yes, I got to this sort of thing ... just looking at container children,
not property values yet &#40;some of which I suspect persist, and the
occasional one of which may be a circular reference&#41;.

    sub container_children_recursively {
      my &#40;$widget&#41; = @_;
      if &#40;$widget-&gt;can&#40;&#39;get_children&#39;&#41;&#41; {
        return &#40;$widget,
                map { container_children_recursively&#40;$_&#41; } $widget-&gt;get_children&#41;;
      } else {
        return &#40;$widget&#41;;
      }
    }
    ...
    constructor =&gt; ... return [ $x, container_children_recursively&#40;$x&#41; ];

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Can Test::Weaken&#39;s object traversal logic be leveraged for the
&gt; contents search,
</div>
Yes.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; rather than
&gt; having to traverse the base object twice, once to assemble the object&#39;s
&gt; contents, and a second time to actually do the test?
</div>
leaks&#40;&#41; has two good things

  - it notices duplicates, which is vital for circularities, and
    important for not re-traversing a thing many times.
  - it looks into the builtin arrayrefs, hashrefs, maybe some anon
    coderefs in the future, etc

To get the full same effect in one&#39;s own constructor, with extra
&#39;contents&#39; worked in, I think you&#39;d end up with an almost complete copy
of the leaks&#40;&#41; code.  I believe it could be much easier to tell leaks&#40;&#41;
about extra visiting on a per-item basis.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-574513" href="/Public/Bug/Display.html?id=43855#txn-574513">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;07&nbsp;15:13:30&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/574513/290114/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/290114">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 757b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">You&#39;re convincing me on this one.  Also, my mind is being changed by
using Test::Weaken myself and discovering how convenient it is to write
no-op ignore callbacks &#40;that is, ignore callbacks which always return 1&#41;
for scanning and debugging purposes.

I&#39;m going to think more about this.  Once I take care of the ignore
option and get an official release out with that, I&#39;ll come up with an
interface design.

On Fri Mar 06 17:18:07 2009, user42@zip.com.au wrote:
coderefs in the future, etc
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; To get the full same effect in one&#39;s own constructor, with extra
&gt; &#39;contents&#39; worked in, I think you&#39;d end up with an almost complete
&gt; copy
&gt; of the leaks&#40;&#41; code.  I believe it could be much easier to tell
&gt; leaks&#40;&#41;
&gt; about extra visiting on a per-item basis.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-576126" href="/Public/Bug/Display.html?id=43855#txn-576126">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;11&nbsp;00:38:50&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/576126/291034/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/291034">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 136b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve just released 2.001_004 to CPAN.  It&#39;s a release candidate, and if
cpantesters blesses and all looks good, it will become 2.002000.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-576128" href="/Public/Bug/Display.html?id=43855#txn-576128">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;11&nbsp;00:40:04&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/576128/291036/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/291036">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 362b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Mar 11 00:38:50 2009, JKEGL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve just released 2.001_004 to CPAN.  It&#39;s a release candidate, and if
&gt; cpantesters blesses and all looks good, it will become 2.002000.
</div>
I really should have made this an update to the other ticket, since I&#39;m
still thinking out design issues on this one.  It&#39;s the other ticket
that will be addressed in 2.002000.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-578086" href="/Public/Bug/Display.html?id=43855#txn-578086">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;15&nbsp;21:49:54&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/578086/292120/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/292120">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here&#39;s some design notes:

I&#39;m thinking of adding to the plumbing interface, which now consists
only of new&#40;&#41; and test&#40;&#41; methods, a scan&#40;&#41; method.  The scan method
would allow ignore-style callbacks to be specified as arguments, and
these could be set up, for example, to discover the child sub-objects of
inside-out objects.  The scan method will be non-destructive, and will
not actually run a test --- it will provide the opportunity for a
preliminary pass over the test object.

This provides a very general interface.  For your purpose that interface
could be used with callbacks that add objects of interest to an array,
and then after the test of the main object, the objects in your array
could then also be tested using Test::Weaken or the module of your choice.

One complication I think I should mention:  The present ignore callback
is called both when an object is about to be tracked and when it is
about to be followed.  This means that for some objects it is called
twice, which if it&#39;s a simple test makes no difference.  &#40;The
documentation in 2.002000 has been updated to mention this.&#41;

For more complicated applications, like those the scan&#40;&#41; method would be
used for, the user may need to specify callbacks separately for when an
object is about to be tracked; and for the three separate situations
where array elements, hash elements and independent objects are about to
be followed.

I&#39;ll add the ability to specify these different callbacks separately to
leaks&#40;&#41; as well.  The &#39;ignore&#39; option will remain available to specify
all four at once with a single routine, but options will be added that
allow each of the four kinds of callback can be specified separately.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-578715" href="/Public/Bug/Display.html?id=43855#txn-578715">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;16&nbsp;20:31:03&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43855] suggest object contents callback</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 17 Mar 2009 11:30:26 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/578715/292438/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/292438">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; This provides a very general interface.  For your purpose that interface
&gt; could be used with callbacks that add objects of interest to an array,
&gt; and then after the test of the main object, the objects in your array
&gt; could then also be tested using Test::Weaken or the module of your choice.
</div>
Not sure.  Being lazy I think I&#39;d prefer leaks&#40;&#41; to do the work :-&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; One complication I think I should mention:  The present ignore callback
&gt; is called both when an object is about to be tracked and when it is
&gt; about to be followed.  This means that for some objects it is called
&gt; twice, which if it&#39;s a simple test makes no difference.
</div>
I suppose it&#39;s also called more than once if an object occurs more than
once in the searched tree.  I&#39;m sure only makes a difference if you&#39;re
abusing the ignore with something that has sloppy side effects.

I&#39;d suggest making no guarantees about what how often or in what order
ignore calls are made.  That&#39;d give flexibility in the implementation,
without outlawing abuse for secret nefarious purposes.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; three separate situations where array elements, hash elements and
&gt; independent objects are about to be followed.
</div>
For myself I haven&#39;t felt the need for such distinctions.

Actually I&#39;d look to the specific rather than the general, for instance
I had a go at ignoring Class::Singleton with

    sub ignore_singleton {
      my &#40;$obj&#41; = @_;
      my $class;
      return &#40;&#40;$class = Scalar::Util::blessed&#40;$obj&#41;&#41;
              &#38;&#38; $obj-&gt;isa&#40;&#39;Class::Singleton&#39;&#41;
              &#38;&#38; $class-&gt;has_instance
              &#38;&#38; $class-&gt;instance == $obj&#41;;
    }

&#40;which depends on Class::Singleton 1.4 for the has_instance&#40;&#41; method,
but that&#39;s ok&#41;.  If it were builtin you could maybe ask for it as
something like

    leaks &#40;{ ignore =&gt; [ &#39;Class::Singleton.instance&#39;,
                         \&#38;my_other_ignore,
                         ... ]

In fact I&#39;d be sorely tempted to have it ignored by default, and the
option be to un-ignore the builtin ignores ... if you see what I mean.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-579437" href="/Public/Bug/Display.html?id=43855#txn-579437">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;17&nbsp;21:35:49&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/579437/292822/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/292822">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 193b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I marked the other ticket resolved as of 2.002000.  I&#39;ll be moving over
the next few days, but I&#39;ll print out your email, read it over, and use
the opportunity to think my approach to this one.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-583226" href="/Public/Bug/Display.html?id=43855#txn-583226">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;25&nbsp;23:27:52&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/583226/294789/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/294789">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve reread our conversation here, which I was pleasantly suprised to
find is semi-coherent.  :-&#41;  Here&#39;s a new set of &#34;design notes&#34;:

1.&#41;  I want to avoid incorporating any smarts about particular classes
in Test::Weaken.  I also want to avoid incorporating much in the way of
knowledge about &#34;inside-out&#34; and other Perl OO philosophies, etc., given
the state of flux.  Later I may redecide, but for the moment I want just
to provide tools and let the user provide the knowledge about particular
classes and OO philosophies.

2.&#41;  I think your special &#39;contents&#39; syntax can be provided using
wrappers and constructors with minimal inconvenience, given the scan&#40;&#41;
method I outline below.

3.&#41;  The argument to the static scan&#40;&#41; method will be a test object &#40;NOT
a constructor closure&#41;, and callbacks.  scan&#40;&#41;&#39;s callbacks will be
called in list context, with the first element of the array being the
boolean which indicates whether to &#34;ignore&#34; the object, and the other
elements being added to a list which will be the return value of the
scan&#40;&#41; method.  The scan&#40;&#41; method will not alter the test object. 
scan&#40;&#41; is intended to be something that can conveniently be called
inside a constructor that is producing a meta-object.

4.&#41;  Optionally, I will let the user factor out the various situations
where the ignore callback is used, even though this didn&#39;t seem useful
for you.  I have to think someone will end up having to care whether
their callback is called zero, one or two times, and on what kinds of
object.  The unfactored callbacks will be kept -- I&#39;ll keep the ignore
option of the leaks&#40;&#41; method, and the scan&#40;&#41; method will also have an
&#39;ignore&#39; option.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-584105" href="/Public/Bug/Display.html?id=43855#txn-584105">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;28&nbsp;20:51:42&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43855] suggest object contents callback</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 29 Mar 2009 11:50:43 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/584105/295329/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/295329">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 926b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; scan&#40;&#41;&#39;s callbacks
</div>
Sounds a bit like hard work.  Leave it for now, maybe someone else will
have other ideas what they might want to do.  I still think some builtin
understanding of some of the most stable OOPery will end up helpful,
perhaps with hook code in those classes rather than Test::Weaken for
what things represent sub-components.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have to think someone will end up having to care whether
&gt; their callback is called zero, one or two times,
</div>
You&#39;d hope not :-&#41;.  Anything meant to be a predicate definitely
shouldn&#39;t; such code really ought to be side-effect free and call-order
independent.  But a callback perhaps designed to expose the traversal
Test::Weaken makes might be allowed to be tighter, like only once per
object, and parent object before child object &#40;though without specifying
depth-first or breadth-first&#41;, or something like that.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-584380" href="/Public/Bug/Display.html?id=43855#txn-584380">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;29&nbsp;23:36:11&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/584380/295454/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/295454">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 709b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sounds a bit like hard work.  Leave it for now, maybe someone else will
&gt; have other ideas what they might want to do.  I still think some builtin
&gt; understanding of some of the most stable OOPery will end up helpful
</div>
I&#39;m just not ready to jump into Perl OOPery at this point.  There are no
major obstacles to someone more expert and/or more opinionated on Perl
OOPery building something on top of Test::Weaken, and better them than me.

Perhaps with this I can close the ticket.  I may go ahead with some of
the things I&#39;ve discussed &#40;a scan&#40;&#41; method, and factored callbacks&#41; but
on a low priority.

I&#39;ll wait a few days before closing this ticket, just in case you want
to point out something I&#39;ve missed.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-587872" href="/Public/Bug/Display.html?id=43855#txn-587872">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;06&nbsp;18:57:41&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/587872/297513/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/297513">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 506b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Closing this ticket without changes to the module.  I don&#39;t want to &#40;at
least at this time&#41; embed any knowledge of specific classes or OO
philosophies into Test::Weaken.  I think those who want this can for the
time being achieve their end by creating wrappers and modules which use
Test::Weaken.

There was discussion of enhancements to Test::Weaken which might be
useful to wrappers and derived modules, but nothing was identified as
particularly urgent.

Ticket closed without any changes to the module.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-587874" href="/Public/Bug/Display.html?id=43855#txn-587874">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;06&nbsp;18:57:42&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-587890" href="/Public/Bug/Display.html?id=43855#txn-587890">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;06&nbsp;21:43:15&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43855] suggest object contents callback</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 07 Apr 2009 11:41:30 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/587890/297524/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/297524">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 813b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; specific classes
</div>
You don&#39;t have to start with specifics, but you should leave this ticket
open for per-object contents fetching &#40;where it started&#41;.  I would use
that now for gtk container children and selected sub-objects hiding in
properties.  Anyone with similar non-array/hash/scalar contents would no
doubt want the same.

Incidentally the &#34;inside-out&#34; style kinda arises in gtk too with its
&#34;boxed&#34; bits which are only a scalar ref as the object, so if you want
to hang extra data on a subclassed object you have to do it in a
separate table &#40;just a hash, it doesn&#39;t have to be full blown inside-out
class stuff&#41;.  Though the only bit like that I&#39;ve done so far has the
extra data semi-shared and so generally persisting beyond each object.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-587891" href="/Public/Bug/Display.html?id=43855#txn-587891">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;06&nbsp;21:43:16&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-589392" href="/Public/Bug/Display.html?id=43855#txn-589392">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;09&nbsp;20:28:29&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/589392/298364/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/298364">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">OK.  Can you create a test case for the contents option?  Again, no need
for fancy packaging -- I&#39;ll repackage it anyway.  And again, please, if
you can, no dependencies on non-core modules.

You are right, the contents option is pretty general and does not really
make assumptions about OO philosophy.  Also, the two kinds of argument
you suggest for the contents options, a code ref or a ref to an array of
code refs, both make sense and I&#39;d like to implement them both.  That
same starting note which suggests a &#39;contents&#39; option also mentions a
shorthand, which I don&#39;t want to implement at this point.

Re timing:  I&#39;ve a number of things underway, so I&#39;ll be a bit more slow
even then usual.  Since this was filed first, I plan to work on it
before the &#34;descend into tied&#40;&#41;&#34; ticket.  But since you seem to be the
main customer, I&#39;ll switch the priority if you wish.

I&#39;m marking this as &#34;stalled&#34; while waiting for the test case.

On Mon Apr 06 21:43:15 2009, user42@zip.com.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; specific classes
</div>&gt; 
&gt; You don&#39;t have to start with specifics, but you should leave this ticket
&gt; open for per-object contents fetching &#40;where it started&#41;.  I would use
&gt; that now for gtk container children and selected sub-objects hiding in
&gt; properties.  Anyone with similar non-array/hash/scalar contents would no
&gt; doubt want the same.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-589394" href="/Public/Bug/Display.html?id=43855#txn-589394">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;09&nbsp;20:28:50&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-590495" href="/Public/Bug/Display.html?id=43855#txn-590495">#</a>      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;12&nbsp;21:42:24&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43855] suggest object contents callback</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 13 Apr 2009 11:41:56 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/590495/298993/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/298993">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 731b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Can you create a test case for the contents option?
</div>
Yep.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; array of code refs,
</div>
Feel free to defer that, initially.  I think it&#39;d be good for combining,
but maybe there&#39;s a better way.  If you do it it could be together with
the same for an array of &#39;ignore&#39; funcs.  &#40;Though one would accumulate
the returns, the other be a short-circuit &#34;OR&#34;.&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#34;descend into tied&#40;&#41;&#34;
</div>
That one may be easier, and it&#39;s a core perl feature, if you wanted to
ponder it first.  The only slightly obscure bit seemed to me the
possibility of tied &#34;typeglob&#34; file handle thingies.  Either way it may
be as easy as pushing tied&#40;$$ref&#41; each time onto the pending objects to
inspect ...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-590496" href="/Public/Bug/Display.html?id=43855#txn-590496">#</a>      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;12&nbsp;21:42:25&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-591619" href="/Public/Bug/Display.html?id=43855#txn-591619">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;15&nbsp;20:33:38&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43855] suggest object contents callback</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 16 Apr 2009 10:32:53 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/591619/299596/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/299596">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 295b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I got to this for a &#34;contents&#34; option test file.  The idea would be for
the contents function to run in array context so it can return multiple
values.

In the &#34;moredata&#34; leak case it and its sub-array would make an
unfreed_count of 2, I think &#40;exercising recursion into the contents
returns&#41;.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/591619/299597/contents.t">Download contents.t</a><br />
<span class="downloadcontenttype">text/x-perl 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl


# MyObject has data hidden away from Test::Weaken&#39;s normal traversals, in
# this case separate %data and %moredata hashes like an &#34;inside-out&#34; object,
# or lik you sometimes have to do for extra data in a subclass, or even like
# kept only in C code structures.

package MyObject;
use strict;
use warnings;

my %data;
my %moredata;

sub new {
  my &#40;$class&#41; = @_;
  my $scalar = &#39;this is a myobject&#39;;
  my $self = bless \$scalar, $class;
  $data{$self+0} = [ &#39;extra data&#39; ];
  $moredata{$self+0} = [ &#39;more extra data&#39;, [ &#39;with a sub-array too&#39; ] ];
  return $self;
}
sub DESTROY {
  my &#40;$self&#41; = @_;
  delete $data{$self+0};
  delete $moredata{$self+0};
}
sub data {
  my &#40;$self&#41; = @_;
  return $data{$self+0};
}
sub moredata {
  my &#40;$self&#41; = @_;
  return $data{$self+0};
}

package main;
use strict;
use warnings;
use Test::Weaken;
use Test::More tests =&gt; 5;

sub myobject_contest_func {
  my &#40;$obj&#41; = @_;
  return $obj-&gt;data, $obj-&gt;moredata;
}

{
  my $test = Test::Weaken::leaks
    &#40;{ constructor =&gt; sub { return MyObject-&gt;new },
       contents =&gt; \&#38;myobject_contest_func
     }&#41;;
  is &#40;$test, undef, &#39;good weaken of MyObject&#39;&#41;;
}

{
  my $leak;
  my $test = Test::Weaken::leaks
    &#40;{ constructor =&gt; sub {
         my $obj = return MyObject-&gt;new;
         $leak = $obj-&gt;data;
         return $obj;
       },
       contents =&gt; \&#38;myobject_contest_func,
     }&#41;;
  ok &#40;$test, &#39;leaky &#34;data&#34; detection&#39;&#41;;
  is &#40;$test &#38;&#38; $test-&gt;unfreed_count, 1,
      &#39;one object leaked&#39;&#41;;
}

{
  my $leak;
  my $test = Test::Weaken::leaks
    &#40;{ constructor =&gt; sub {
         my $obj = return MyObject-&gt;new;
         $leak = $obj-&gt;moredata;
         return $obj;
       },
       contents =&gt; \&#38;myobject_contest_func,
     }&#41;;
  ok &#40;$test, &#39;leaky &#34;moredata&#34; detection&#39;&#41;;
  is &#40;$test &#38;&#38; $test-&gt;unfreed_count, 2,
      &#39;one object leaked&#39;&#41;;
}

exit 0;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-593416" href="/Public/Bug/Display.html?id=43855#txn-593416">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;21&nbsp;00:47:29&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/593416/300597/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/300597">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m at work on this one.  Some design notes:

1.&#41;  Objects followed and tracked because they are returned from a
contents&#40;&#41; call will be followed and tracked recursively.  That means,
for example, all objects followed because they were returned from a
contents&#40;&#41; callback will have the contents&#40;&#41; callback called on them. 
As usual, cycles will not be allowed to present a problem -- they will
be caught and cut short.

2.&#41;  Only *FOLLOWED* objects will have the contents&#40;&#41; callback called on
them.  This should present no surprises for objects which are both
tracked and followed; for objects which are ignored; and for objects
which are followed but not tracked.  Objects which are tracked but not
followed are a more interesting case.

Three kinds of objects are tracked but not followed: CODE, SCALAR and
VSTRING.  Since the return of the contents&#40;&#41; callback is in array
context, and CODE objects cannot occur in that context &#40;just references
to them&#41;, CODE objects are not relevant to this discussion.  That leaves
SCALAR and VSTRING objects.

I note the test case you submitted is a blessed scalar, and falls into
one of the categories of objects which won&#39;t have the contents&#40;&#41;
callback called on them because they are not usually followed.  Should I
call the contents&#40;&#41; callback on SCALAR&#39;s &#40;and VSTRING&#39;s&#41;?

I am open to persuasion on this point.  My original reasoning for not
following SCALAR&#39;s is that there is nothing to follow.  One could make
the argument that with the contents&#40;&#41; callback and tied scalars that
there now *IS* indeed something to follow.

Comments appreciated.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-594209" href="/Public/Bug/Display.html?id=43855#txn-594209">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;22&nbsp;18:08:52&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43855] suggest object contents callback</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 23 Apr 2009 08:07:46 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/594209/301063/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/301063">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 115b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; [contents.t]
</div>
I had a couple of stray &#34;return&#34;s which would prevent the supposed leaks
from leaking!
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/594209/301064/contents.t">Download contents.t</a><br />
<span class="downloadcontenttype">text/x-perl 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl


# MyObject has data hidden away from Test::Weaken&#39;s normal traversals, in
# this case separate %data and %moredata hashes like an &#34;inside-out&#34; object,
# or lik you sometimes have to do for extra data in a subclass, or even like
# kept only in C code structures.

package MyObject;
use strict;
use warnings;

my %data;
my %moredata;

sub new {
  my &#40;$class&#41; = @_;
  my $scalar = &#39;this is a myobject&#39;;
  my $self = bless \$scalar, $class;
  $data{$self+0} = [ &#39;extra data&#39; ];
  $moredata{$self+0} = [ &#39;more extra data&#39;, [ &#39;with a sub-array too&#39; ] ];
  return $self;
}
sub DESTROY {
  my &#40;$self&#41; = @_;
  delete $data{$self+0};
  delete $moredata{$self+0};
}
sub data {
  my &#40;$self&#41; = @_;
  return $data{$self+0};
}
sub moredata {
  my &#40;$self&#41; = @_;
  return $data{$self+0};
}

package main;
use strict;
use warnings;
use Test::Weaken;
use Test::More tests =&gt; 5;

sub myobject_contest_func {
  my &#40;$obj&#41; = @_;
  return $obj-&gt;data, $obj-&gt;moredata;
}

{
  my $test = Test::Weaken::leaks
    &#40;{ constructor =&gt; sub { return MyObject-&gt;new },
       contents =&gt; \&#38;myobject_contest_func
     }&#41;;
  is &#40;$test, undef, &#39;good weaken of MyObject&#39;&#41;;
}

{
  my $leak;
  my $test = Test::Weaken::leaks
    &#40;{ constructor =&gt; sub {
         my $obj = MyObject-&gt;new;
         $leak = $obj-&gt;data;
         return $obj;
       },
       contents =&gt; \&#38;myobject_contest_func,
     }&#41;;
  ok &#40;$test, &#39;leaky &#34;data&#34; detection&#39;&#41;;
  is &#40;$test &#38;&#38; $test-&gt;unfreed_count, 1,
      &#39;one object leaked&#39;&#41;;
}

{
  my $leak;
  my $test = Test::Weaken::leaks
    &#40;{ constructor =&gt; sub {
         my $obj = MyObject-&gt;new;
         $leak = $obj-&gt;moredata;
         return $obj;
       },
       contents =&gt; \&#38;myobject_contest_func,
     }&#41;;
  ok &#40;$test, &#39;leaky &#34;moredata&#34; detection&#39;&#41;;
  is &#40;$test &#38;&#38; $test-&gt;unfreed_count, 2,
      &#39;one object leaked&#39;&#41;;
}

exit 0;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-594230" href="/Public/Bug/Display.html?id=43855#txn-594230">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;22&nbsp;18:46:34&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43855] suggest object contents callback</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 23 Apr 2009 08:45:11 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/594230/301077/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/301077">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 851b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; for objects which are ignored;
</div>
So ignored objects don&#39;t get a contents call?  Yep that sounds right.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I note the test case you submitted is a blessed scalar, and falls into
&gt; one of the categories of objects which won&#39;t have the contents&#40;&#41;
&gt; callback called on them because they are not usually followed.
</div>
Oh.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Should I
&gt; call the contents&#40;&#41; callback on SCALAR&#39;s &#40;and VSTRING&#39;s&#41;?
</div>
Err, umm, yes I think so, if I understand the question! :&#41;

At any rate my sample is fairly typical of what I had in mind.  When a
class is only a blessed scalar there&#39;s of course no room to put extra
data inside it, so you have to do something external &#40;either for a
subclass, or for separate application level stuff perhaps&#41;.  The
contents call would let you expose that extra to Test::Weaken ...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-608296" href="/Public/Bug/Display.html?id=43855#txn-608296">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;20&nbsp;23:42:58&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/608296/308411/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/308411">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 73b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m at work on this.  I&#39;m now writing the docs for a developer&#39;s release.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-613639" href="/Public/Bug/Display.html?id=43855#txn-613639">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;02&nbsp;12:06:32&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/613639/311473/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/311473">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1012b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">As often, having to state things clearly for the documentation revealed
changes that need to be made.

The documentation states, and the code assumes, that elements of arrays
and values of hashes are ALWAYS freed with the array or hash. 
Therefore, elements need not be tracked.

This assumption is false.  The construct

   @second_refereneces = map { \$_ } @object

returns puts reference to every value of @array into @second_references.
These second references will survive the destruction of @object, and can
be copied, can themselves be referenced, etc., etc.

This is a bug, if an obscure one, and I will fix it before the next
release.  Because this changes the counts of unfreed objects, it can
affect code that examines the unfreed objects.  Examining the unfreed
objects is an useful technique for using Test::Weaken, and a user may be
doing this in non-throwaway code.  So this can be considered a serious
interface change.  Therefore the next official release will have a new
major release number.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-613793" href="/Public/Bug/Display.html?id=43855#txn-613793">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;02&nbsp;18:45:25&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43855] suggest object contents callback</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 03 Jun 2009 08:14:52 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/613793/311576/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/311576">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 555b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; As often, having to state things clearly for the documentation revealed
&gt; changes that need to be made.
</div>
It focuses the mind :-&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;    @second_refereneces = map { \$_ } @object
</div>
Evil!  I suppose it&#39;s also possible for an xsub to make a mistake with
its refs when iterating array elements, along similar lines.  Good to
catch either way.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; code that examines the unfreed objects.
</div>
Existing code ought to be fine with extra unfreed things.  If not it was
much too fragile to start with ...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-614681" href="/Public/Bug/Display.html?id=43855#txn-614681">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;05&nbsp;12:53:17&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/614681/312110/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/312110">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 211b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve put a developer&#39;s release on CPAN with the fix: 2.003_000

I don&#39;t know if this is the release candidate.  The documentation is
revised and up-to-date, but I want to reread before I consider it
final-draft.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-614683" href="/Public/Bug/Display.html?id=43855#txn-614683">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;05&nbsp;12:53:38&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Fixed in 2.003_000 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-614980" href="/Public/Bug/Display.html?id=43855#txn-614980">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;06&nbsp;19:53:32&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43855] suggest object contents callback</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 07 Jun 2009 09:51:56 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/614980/312301/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/312301">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; The documentation is revised and up-to-date,
</div>
I think the contents callback should be the same as the ignore one.
Ie. pass it the object itself, not a &#34;probe&#34; ref to a ref.  It&#39;ll make
life very hard if the two calls are different.

I don&#39;t think the proberef-to-ref would be wanted usually.  If it turns
out that it is then you can always add a pair of &#34;ignore_proberef&#34; and
&#34;contents_proberef&#34; callbacks later on, for subtle cases.

In the callback descriptions you could show the sample call, like

    &#38;$ignore &#40;$obj&#41;;

instead of describing it in words.  When skimming for a reminder etc
it&#39;s always easier to see a bit of almost-code than read a description.

You should consider giving equal billing to the postprocess-unfreed vs
ignore-callback; and to wrapper-array vs contents-callback.  After all,
&#34;there&#39;s more than one way to do it&#34; and personal preference or the
nature of the data structures may make each have equally good use.

In the bit about globs, I don&#39;t think it&#39;s true they&#39;re alway symbol
table entries.  I think the Symbol.pm module can make anonymous ones
these days, and maybe &#34;do { local *FOO }&#34; likewise, and probably &#34;my&#34;
style file handles &#40;other RT ticket&#41; similarly.  But maybe a perl expert
can confirm that.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-615191" href="/Public/Bug/Display.html?id=43855#txn-615191">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;07&nbsp;19:33:44&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/615191/312419/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/312419">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Actually the contents and ignore calls ARE orthogonal, it&#39;s just that
the code snippet for the contents call is wrong.

The error in the code snippet is a bug and I&#39;ll fix it in the next
release, which will have to be another developer&#39;s release.

Both arguments are and, I think, need to be proberefs.  Among the
reasons for passing proberefs:

1.  Allows for a safe copy of the actual argument to the callback while
still giving access to and preserving the actual data.

2.  For the ignore callback, the actual data can be anything, including
things like arrays and hashes which cannot be arguments -- they have to
be passed via a reference.

3.  I want the user by default one indirection away from anything in the
actual object.  I think this is needed in a language which
auto-strengthens weak references, autovivifies objects, etc.  Users who
enjoy life in the fast lane can get to the actual data with a single
dereference.  

Test::Weaken in its internals avoids manipulating the actual data
objects.  When it gets an object, it immediately creates a probe
reference and then deals with the data through that.

On Sat Jun 06 19:53:32 2009, user42@zip.com.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; The documentation is revised and up-to-date,
</div>&gt; 
&gt; I think the contents callback should be the same as the ignore one.
&gt; Ie. pass it the object itself, not a &#34;probe&#34; ref to a ref.  It&#39;ll make
&gt; life very hard if the two calls are different.
&gt; 
&gt; I don&#39;t think the proberef-to-ref would be wanted usually.  If it turns
&gt; out that it is then you can always add a pair of &#34;ignore_proberef&#34; and
&gt; &#34;contents_proberef&#34; callbacks later on, for subtle cases.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-615203" href="/Public/Bug/Display.html?id=43855#txn-615203">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;07&nbsp;20:45:30&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/615203/312424/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/312424">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Correction: it&#39;s the ignore snippet which is wrong and needs to be fixed.

On Sun Jun 07 19:33:44 2009, JKEGL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Actually the contents and ignore calls ARE orthogonal, it&#39;s just that
&gt; the code snippet for the contents call is wrong.
&gt; 
&gt; The error in the code snippet is a bug and I&#39;ll fix it in the next
&gt; release, which will have to be another developer&#39;s release.
&gt; 
&gt; Both arguments are and, I think, need to be proberefs.  Among the
&gt; reasons for passing proberefs:
&gt; 
&gt; 1.  Allows for a safe copy of the actual argument to the callback while
&gt; still giving access to and preserving the actual data.
&gt; 
&gt; 2.  For the ignore callback, the actual data can be anything, including
&gt; things like arrays and hashes which cannot be arguments -- they have to
&gt; be passed via a reference.
&gt; 
&gt; 3.  I want the user by default one indirection away from anything in the
&gt; actual object.  I think this is needed in a language which
&gt; auto-strengthens weak references, autovivifies objects, etc.  Users who
&gt; enjoy life in the fast lane can get to the actual data with a single
&gt; dereference.  
&gt; 
&gt; Test::Weaken in its internals avoids manipulating the actual data
&gt; objects.  When it gets an object, it immediately creates a probe
&gt; reference and then deals with the data through that.
&gt; 
&gt; On Sat Jun 06 19:53:32 2009, user42@zip.com.au wrote:
<div class="message-stanza open">&gt; &gt; &#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<div class="message-stanza open">&gt; &gt; &gt;
&gt; &gt; &gt; The documentation is revised and up-to-date,
</div>&gt; &gt; 
&gt; &gt; I think the contents callback should be the same as the ignore one.
&gt; &gt; Ie. pass it the object itself, not a &#34;probe&#34; ref to a ref.  It&#39;ll make
&gt; &gt; life very hard if the two calls are different.
&gt; &gt; 
&gt; &gt; I don&#39;t think the proberef-to-ref would be wanted usually.  If it turns
&gt; &gt; out that it is then you can always add a pair of &#34;ignore_proberef&#34; and
&gt; &gt; &#34;contents_proberef&#34; callbacks later on, for subtle cases.
</div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-615820" href="/Public/Bug/Display.html?id=43855#txn-615820">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;08&nbsp;21:59:10&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/615820/312778/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/312778">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 199b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve just uploaded 2.003_001, and the ignore snippet should be correct
in that.

On Sun Jun 07 20:45:30 2009, JKEGL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Correction: it&#39;s the ignore snippet which is wrong and needs to be fixed.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-615822" href="/Public/Bug/Display.html?id=43855#txn-615822">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;08&nbsp;22:05:15&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/615822/312780/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/312780">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 989b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Someday I may rethink how I document the postprocess-unfreed vs.
ignore-callback; and wrapper-array vs contents-callback.  Right now my
thinking is that

1.&#41;  Most important is how a hurried Test::Weaken newbie reads the docs.

2.&#41;  I assume he will &#40;as I do&#41;, when looking for features look first at
methods and options.

3.&#41;  That means he&#39;ll naturally tend to pick ignore-callback over
postprocess-unfreed and to pick the contents-callback over
wrapper-array.  I need to balance this and my deprecatory language does
this.

In particular, I feel if this errs, it does so in the direction of
safety.  I&#39;ve softened and shortened the deprecatory language over the
revs, but I&#39;m reluctant to drop it.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; You should consider giving equal billing to the postprocess-unfreed vs
&gt; ignore-callback; and to wrapper-array vs contents-callback.  After all,
&gt; &#34;there&#39;s more than one way to do it&#34; and personal preference or the
&gt; nature of the data structures may make each have equally good use.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-616489" href="/Public/Bug/Display.html?id=43855#txn-616489">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;09&nbsp;21:15:34&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43855] suggest object contents callback</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 10 Jun 2009 11:14:58 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/616489/313187/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/313187">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Correction: it&#39;s the ignore snippet which is wrong and needs to be fixed.
</div>
Really?  The t/ignore.t was working fine, and I&#39;ve been using its style.

The ignore ends up being called with both a ref-to-ref and the plain ref
does it?  For say a %self instance there&#39;s a call \%self which is a
proberef to it, but then also a \\%self which is a proberef to any
scalar reference found in the tree of things?

The first one, \%self is good for oopery, and matches what you&#39;ve
previously documented.  Does the second \\%self always arise?  Maybe
blessed scalars which are array elements don&#39;t have it.  &#40;Not that I&#39;d
be too worried, the first is the desired one from my point of view.&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 1.  Allows for a safe copy of the actual argument to the callback while
&gt; still giving access to and preserving the actual data.
</div>
I&#39;m still sure you&#39;re worrying far too much about that. :-&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 2.  For the ignore callback, the actual data can be anything, including
&gt; things like arrays and hashes which cannot be arguments -- they have to
&gt; be passed via a reference.
</div>
Err, yeah, I think that&#39;s what I&#39;ve been implicitly thinking when it
comes to the object ignoring I had in mind.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; auto-strengthens weak references,
</div>
That should be only when copying to a new scalar, shouldn&#39;t hurt
anything normally.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; autovivifies objects,
</div>
Might be some scope for trouble there, can&#39;t think of anything offhand.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-616493" href="/Public/Bug/Display.html?id=43855#txn-616493">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;09&nbsp;21:28:59&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43855] suggest object contents callback</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 10 Jun 2009 11:28:27 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/616493/313189/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/313189">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 684b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; 1.&#41;  Most important is how a hurried Test::Weaken newbie reads the docs.
</div>
Umm, no offence, but newbies might be helped by taking a chain-saw to
some of the jargon, and the length! :-&#41;


I have to confess I still find tracked, followed, persistent, proberef,
etc, a bit hard going.  The core idea is a good simple thing: look
recursively for anything not freed, and user can identify intentionally
global things.  If that might be expressed both precisely and concisely
...

Maybe a &#34;Gory Details&#34; section towards the end could split out
implementation notes and details on exactly what is recursed or checked
and why.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-616497" href="/Public/Bug/Display.html?id=43855#txn-616497">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;09&nbsp;21:51:29&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/616497/313193/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/313193">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 639b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jun 09 21:28:59 2009, user42@zip.com.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Maybe a &#34;Gory Details&#34; section towards the end could split out
&gt; implementation notes and details on exactly what is recursed or checked
&gt; and why.
</div>
This is a good idea, and in fact I&#39;ve already got an &#34;IMPLEMENTATION
SECTION&#34; toward the end where the gory details can go.

I tried to keep the intro to the &#34;DESCRIPTION&#34; jargon-free, emphasizing
the DWIM nature of the module.  I don&#39;t think the current rev gets
jargon-heavy before the &#34;Data Objects, Blessed Objects and Structures&#34;
section.

Re-reorganizing the document will, however, have to wait until after
this major release.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-616499" href="/Public/Bug/Display.html?id=43855#txn-616499">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;09&nbsp;21:57:31&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/616499/313195/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/313195">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 911b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jun 09 21:15:34 2009, user42@zip.com.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; Correction: it&#39;s the ignore snippet which is wrong and needs to be
</div></div>fixed.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Really?  The t/ignore.t was working fine, and I&#39;ve been using its style.
&gt; 
&gt; The ignore ends up being called with both a ref-to-ref and the plain ref
&gt; does it?
</div>
I think what was happening is that since the hash itself is an T::W data
object, and I always used proberefs, you were getting a proberef to hash
anyway as well as a proberef to ref to hash.  Instead of telling T::W to
ignore the ref to hash, you were telling it to ignore the hash.  This
amounted to the same thing in practice, so the error in programming the
ignore callback was not caught.

Similarly, my snippet was part of my test suite, but my test suite did
not catch the error.

I&#39;ll justify the use of proberefs in a separate message.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-616503" href="/Public/Bug/Display.html?id=43855#txn-616503">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;09&nbsp;22:21:55&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/616503/313199/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/313199">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 735b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Let me put aside the other, minor arguments in favor of the &#34;show
stopper&#34;:  Arrays and hashes have to be treated as data objects, not
just the references to them.

I can, in a way, blame this on you, Kevin, because originally I did
assume I could trade only in references, and not deal directly with the
hashes and arrays themselves.  You found this caused bugs.  Fixing those
bugs required me to rewrite the T::W internals to track not only refs to
arrays and hashes, but the arrays and hashes themselves.

The only way to pass arrays and hashes as arguments, is via references.
This forces the use of proberefs internally in T::W, in the ignore
callback, and in potential future callbacks &#40;which we&#39;d want to be
ortogonal with&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-616922" href="/Public/Bug/Display.html?id=43855#txn-616922">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;10&nbsp;17:39:49&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43855] suggest object contents callback</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 11 Jun 2009 07:39:10 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/616922/313426/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/313426">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 697b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; you were telling it to ignore the hash.
</div>
Ah, yep.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This
&gt; amounted to the same thing in practice, so the error in programming the
&gt; ignore callback was not caught.
</div>
Actually, I think it&#39;s not an error, but what I wanted!  The hash is the
permanent thing with a lifespan extending beyond the testing.

If there&#39;s a scalar containing a ref to that hash lurking in the tested
tree then I think I want that scalar to be gc-ed as normal.  That&#39;d be
the ref-to-ref case.  In fact I think it may be unusual to want a scalar
like that to hang around -- only its target.

So I suspect the code was right, maybe for the wrong reasons :-&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-619332" href="/Public/Bug/Display.html?id=43855#txn-619332">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;15&nbsp;21:37:39&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/619332/314833/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/314833">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 59b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve just uploaded 2.003_003, which is a release candidate.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-619886" href="/Public/Bug/Display.html?id=43855#txn-619886">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;16&nbsp;19:14:50&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43855] suggest object contents callback</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 17 Jun 2009 09:13:25 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/619886/315165/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/315165">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 616b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; I&#39;ve just uploaded 2.003_003, which is a release candidate.
</div>
I believe the sample ignore func in the docs is not right, that it has
the effect of ignoring the scalar which holds a reference to a MyGlobal
object &#40;hash, array, whatever&#41;.  This means it ignores the object too of
course, but I believe ignoring a leak of the scalar isn&#39;t the intention.

Sample program below with the documented one as &#34;newdoc_ignore&#40;&#41;&#34;.
Using it doesn&#39;t report $global_ref as leaked.  The &#34;orig_ignore&#40;&#41;&#34;
however does get that reported, and only @global_obj ignored.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/619886/315166/ignore-obj2.pl">Download ignore-obj2.pl</a><br />
<span class="downloadcontenttype">text/x-perl 621b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">use strict;
use warnings;
use Test::Weaken;
use Data::Dumper;

my @global_obj = &#40;&#39;foo&#39;&#41;;
bless \@global_obj, &#39;MyGlobal&#39;;
my $global_ref = \@global_obj;

sub newdoc_ignore {
  my &#40;$probe&#41; = @_;
  return unless Scalar::Util::reftype $probe eq &#39;REF&#39;;
  my $thing = ${$probe};
  return &#40; Scalar::Util::blessed&#40;$thing&#41; &#38;&#38; $thing-&gt;isa&#40;&#39;MyGlobal&#39;&#41; &#41;;
}

sub orig_ignore {
  my &#40;$ref&#41; = @_;
  return Scalar::Util::blessed&#40;$ref&#41; &#38;&#38; $ref-&gt;isa&#40;&#39;MyGlobal&#39;&#41;;
}

my $oops;
my $leaks = Test::Weaken::leaks
  &#40;{ constructor =&gt; sub {
       return [ \$global_ref ];
     },
     ignore =&gt; \&#38;newdoc_ignore,
   }
  &#41;;
print Dumper&#40;$leaks&#41;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-619888" href="/Public/Bug/Display.html?id=43855#txn-619888">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;16&nbsp;20:00:30&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43855] suggest object contents callback</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 17 Jun 2009 10:00:00 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/619888/315169/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/315169">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 782b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; I&#39;ve just uploaded 2.003_003, which is a release candidate.
</div>
The double indirection on the contents is not what I wanted please.  I&#39;d
like it to callback on the objects themselves, not merely on scalars in
the tree which refer to them -- per below.

As motivation, returning contents based on the scalars is a bit
wasteful, as it&#39;s quite likely several scalars will refer to the object,
but you only really want to report extra contents just once against the
object.

&#40;I suspect there may be something fishy in the code with objects which
are scalar refs, and I&#39;m pretty sure globs deserve callbacks so
filehandle objects can be equal citizens, but starting with arrays and
hashes will do what I&#39;m interested in.&#41;
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/619888/315170/Weaken.pm.content.diff">Download Weaken.pm.content.diff</a><br />
<span class="downloadcontenttype">text/x-diff 943b</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/619888/315171/contents-array.t">Download contents-array.t</a><br />
<span class="downloadcontenttype">text/x-perl 499b</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-619905" href="/Public/Bug/Display.html?id=43855#txn-619905">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;16&nbsp;21:22:46&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/619905/315179/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/315179">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have no problem with this change.

In previous discussion I think we may have confused two issues.

Issue 1: Do I always have to pass the objects via probe_refs.  As
justified above, the answer is yes.

Issue 2: Should the only objects passed to contents&#40;&#41; be refs, so that a
hash or array can only be accessed via a double indirection.  On this I
never had a hard and set opinion.

If looking into this doesn&#39;t produce some kind of complication, your
patch will be incorporated in the next release.  That will be another
developer&#39;s release.

On Tue Jun 16 20:00:30 2009, user42@zip.com.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; I&#39;ve just uploaded 2.003_003, which is a release candidate.
</div>&gt; 
&gt; The double indirection on the contents is not what I wanted please.  I&#39;d
&gt; like it to callback on the objects themselves, not merely on scalars in
&gt; the tree which refer to them -- per below.
&gt; 
&gt; As motivation, returning contents based on the scalars is a bit
&gt; wasteful, as it&#39;s quite likely several scalars will refer to the object,
&gt; but you only really want to report extra contents just once against the
&gt; object.
&gt; 
&gt; &#40;I suspect there may be something fishy in the code with objects which
&gt; are scalar refs, and I&#39;m pretty sure globs deserve callbacks so
&gt; filehandle objects can be equal citizens, but starting with arrays and
&gt; hashes will do what I&#39;m interested in.&#41;
&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-619927" href="/Public/Bug/Display.html?id=43855#txn-619927">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;16&nbsp;23:36:14&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/619927/315194/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/315194">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">1.&#41;  The behavior you describe for the sample ignore func is the
behavior I intended.

2.&#41;  The question remains, is that the best behavior to show in an
example?  Since at this point AFAIK you&#39;re T::W&#39;s biggest power user,
I&#39;ll defer to your judgement about what behavior serves best for an example.

But ...

Please justify why ignore the object itself, but catch leaks of the
scalar ref to it.  It&#39;s not that I&#39;ll need convincing, but other people
may ask me why the example shows what it does, and &#34;Dunno.  Ask Kevin.&#34;
will not sound good as an answer.  So I need to get the story down.

My guess is that it is something to do with the objects themselves being
persistent, while the data structure you are testing for leaks hold
references to those objects.  Therefore you want the objects ignored,
but are worried about leaks of refs to them.

On Tue Jun 16 19:14:50 2009, user42@zip.com.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; I&#39;ve just uploaded 2.003_003, which is a release candidate.
</div>&gt; 
&gt; I believe the sample ignore func in the docs is not right, that it has
&gt; the effect of ignoring the scalar which holds a reference to a MyGlobal
&gt; object &#40;hash, array, whatever&#41;.  This means it ignores the object too of
&gt; course, but I believe ignoring a leak of the scalar isn&#39;t the intention.
&gt; 
&gt; Sample program below with the documented one as &#34;newdoc_ignore&#40;&#41;&#34;.
&gt; Using it doesn&#39;t report $global_ref as leaked.  The &#34;orig_ignore&#40;&#41;&#34;
&gt; however does get that reported, and only @global_obj ignored.
&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-621718" href="/Public/Bug/Display.html?id=43855#txn-621718">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;19&nbsp;18:25:10&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43855] suggest object contents callback</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 20 Jun 2009 08:24:45 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/621718/316261/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/316261">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 888b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Therefore you want the objects ignored,
&gt; but are worried about leaks of refs to them.
</div>
Yes.  There may be 2 dozen scalars in the tree containing references
to the hash &#40;etc&#41;.  The hash persists, but the scalars should get
garbage collected.  &#40;The hash likely persists because there&#39;s yet
further scalars outside the tree referring to it, but they&#39;re of no
concern to testing destruction of the tree.&#41;

Ditto it&#39;s the hash which has extra contents associated with it,
rather than any of the scalars referring to it.  &#40;Oh, and I feel now
the contents callback should be made for all types of things, so for
instance even if there&#39;s no builtin descent into a glob or print
format thingie the callbacks allow user code to add some.  I believe
that may in fact simplify both the loop in the code and the
documentation of it.&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-622103" href="/Public/Bug/Display.html?id=43855#txn-622103">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;20&nbsp;12:14:21&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/622103/316476/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/316476">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 878b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jun 19 18:25:10 2009, user42@zip.com.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Oh, and I feel now
&gt; the contents callback should be made for all types of things, so for
&gt; instance even if there&#39;s no builtin descent into a glob or print
&gt; format thingie the callbacks allow user code to add some.  I believe
&gt; that may in fact simplify both the loop in the code and the
&gt; documentation of it.
</div>
This is an interesting idea.  Let me think about it.

My first intent was to have the contents callback be orthogonal with
following -- if an object is followed, a contents callback is called,
otherwise not.  But this of course does not allow it to be used as a way
for the user to extend following, and that is intriguing.  For example,
I don&#39;t think I can predict in general how GLOB&#39;s should be handled, but
a particular user with a particular application may have a very precise
idea of what he needs.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-622129" href="/Public/Bug/Display.html?id=43855#txn-622129">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;20&nbsp;12:58:35&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/622129/316488/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/316488">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 494b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I just uploaded 2.003_004.  I added 2 grafs to the description of
contents and ignore, on the idea that other users may get as confused
about callback-on-reference/callback-on-object distinction as we have.

Kevin, your latest suggestion about extending the contents callback to
all objects is not implemented in this release.  It does extend the
contents callback to arrays and hashes, as per the previous suggestion
and your patch.

There will probably need to be another developers&#39; release.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-622590" href="/Public/Bug/Display.html?id=43855#txn-622590">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;21&nbsp;20:05:32&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43855] suggest object contents callback</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 22 Jun 2009 10:05:15 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/622590/316776/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/316776">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 191b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; particular user with a particular application
</div>
Or experiment with a general descending rule that might later become
builtin.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-624553" href="/Public/Bug/Display.html?id=43855#txn-624553">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;25&nbsp;20:39:45&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/624553/317801/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/317801">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 530b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I just uploaded 2.003_005.  It has significant simplifications in the
internals, based on feedback from perlmonks.  On the negative side, that
means the internals have changed significantly.

The contents callback is called for data objects of all types.  As
described in the doc &#40;and as you&#39;ve suggested, Kevin&#41;, this can be used
to override the default behaviors.  For example, a user could add their
own code to look inside code objects.

This is a release candidate, though realistically, the docs may need a
final touchup.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-624558" href="/Public/Bug/Display.html?id=43855#txn-624558">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;25&nbsp;20:42:27&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Severity Wishlist added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-624582" href="/Public/Bug/Display.html?id=43855#txn-624582">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;25&nbsp;20:54:54&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Fixed in 2.003_000 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-627014" href="/Public/Bug/Display.html?id=43855#txn-627014">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;01&nbsp;22:17:06&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/627014/319128/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/319128">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 121b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I just uploaded 2.003_006. Quite a few documentation changes, but no
changes to the code.  This is a release candidate.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-628174" href="/Public/Bug/Display.html?id=43855#txn-628174">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;04&nbsp;16:21:24&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/628174/319762/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/319762">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 120b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I just uploaded 2.003_007. A few, last documentation touch-ups.  No
changes to the code.  This is a release candidate.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-630993" href="/Public/Bug/Display.html?id=43855#txn-630993">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;09&nbsp;21:57:48&nbsp;2009</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43855] suggest object contents callback</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 10 Jul 2009 11:57:20 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Weaken [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/630993/321297/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/321297">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 133b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jeffrey Kegler via RT&#34; &lt;bug-Test-Weaken@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; I just uploaded 2.003_007.
</div>
The 3.000 works for me ... so far :-&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-631315" href="/Public/Bug/Display.html?id=43855#txn-631315">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;10&nbsp;16:15:39&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/631315/321470/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/321470">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 17b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixed in 3.000000
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-631317" href="/Public/Bug/Display.html?id=43855#txn-631317">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;10&nbsp;16:15:43&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-631319" href="/Public/Bug/Display.html?id=43855#txn-631319">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;10&nbsp;16:16:07&nbsp;2009</span>
    <span class="description">jkegl [...] cpan.org -  Fixed in 3.000000 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 2.028006</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
