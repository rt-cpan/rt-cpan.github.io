<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #42149 for ExtUtils-Install: Add support for VMS in Unix or extended character set modes.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #42149 for ExtUtils-Install: Add support for VMS in Unix or extended character set modes.</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/ExtUtils-Install/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/ExtUtils-Install/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/ExtUtils-Install/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/ExtUtils-Install/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/ExtUtils-Install">ExtUtils-Install CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">42149</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/ExtUtils-Install/Active/">ExtUtils-Install</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
wb8tyw [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-39112-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.52    </td>
  </tr>
  <tr id="CF-39113-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;04&nbsp;17:09:16&nbsp;2009</span>
    <span class="description">malmberg [...] Encompasserve.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Add support for VMS in Unix or extended character set modes.</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This patch updates Install.pm and INST.t, INST_PREFIX.t to support VMS
in the Unix compatible mode and with extended character sets.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> extutils_install.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- /rsync_root/perl/lib/Extutils/install.pm	Wed Nov 12 13:52:11 2008
+++ lib/Extutils/install.pm	Sun Jan  4 16:02:34 2009
@@ -92,11 +92,34 @@
 =cut
 
 my $Is_VMS     = $^O eq &#39;VMS&#39;;
+my $Is_VMS_noefs = $Is_VMS;
 my $Is_MacPerl = $^O eq &#39;MacOS&#39;;
 my $Is_Win32   = $^O eq &#39;MSWin32&#39;;
 my $Is_cygwin  = $^O eq &#39;cygwin&#39;;
 my $CanMoveAtBoot = &#40;$Is_Win32 || $Is_cygwin&#41;;
 
+    if&#40; $Is_VMS &#41; {
+        my $vms_unix_rpt;
+        my $vms_efs;
+        my $vms_case;
+
+        if &#40;eval { local $SIG{__DIE__}; require VMS::Feature; }&#41; {
+            $vms_unix_rpt = VMS::Feature::current&#40;&#34;filename_unix_report&#34;&#41;;
+            $vms_efs = VMS::Feature::current&#40;&#34;efs_charset&#34;&#41;;
+            $vms_case = VMS::Feature::current&#40;&#34;efs_case_preserve&#34;&#41;;
+        } else {
+            my $unix_rpt = $ENV{&#39;DECC$FILENAME_UNIX_REPORT&#39;} || &#39;&#39;;
+            my $efs_charset = $ENV{&#39;DECC$EFS_CHARSET&#39;} || &#39;&#39;;
+            my $efs_case = $ENV{&#39;DECC$EFS_CASE_PRESERVE&#39;} || &#39;&#39;;
+            $vms_unix_rpt = $unix_rpt =~ /^[ET1]/i; 
+            $vms_efs = $efs_charset =~ /^[ET1]/i;
+            $vms_case = $efs_case =~ /^[ET1]/i;
+        }
+        $Is_VMS_noefs = 0 if &#40;$vms_efs&#41;; 
+    }
+
+
+
 # *note* CanMoveAtBoot is only incidentally the same condition as below
 # this needs not hold true in the future.
 my $Has_Win32API_File = &#40;$Is_Win32 || $Is_cygwin&#41;
@@ -405,7 +428,9 @@
     my $path=&#39;&#39;;
     my @make;
     while &#40;@dirs&#41; {
-        if &#40;$Is_VMS&#41; {
+        if &#40;$Is_VMS_noefs&#41; {
+            # There is a bug in catdir that is fixed when the EFS character
+            # set is enabled, which requires this VMS specific code.
             $dir = File::Spec-&gt;catdir&#40;$vol,@dirs&#41;;
         }
         else {
--- /rsync_root/perl/lib/Extutils/t/INST.t	Tue Jun 13 14:29:14 2006
+++ lib/Extutils/t/INST.t	Thu Dec 25 01:46:50 2008
@@ -24,6 +24,8 @@
 use TieOut;
 use Config;
 
+my $Is_VMS = $^O eq &#39;VMS&#39;;
+
 chdir &#39;t&#39;;
 
 perl_lib;
@@ -74,6 +76,7 @@
 my&#40;$perl_src, $mm_perl_src&#41;;
 if&#40; $ENV{PERL_CORE} &#41; {
     $perl_src = File::Spec-&gt;catdir&#40;$Updir, $Updir&#41;;
+    $perl_src = VMS::Filespec::vmsify&#40;$perl_src&#41; if $Is_VMS;
     $perl_src = File::Spec-&gt;canonpath&#40;$perl_src&#41;;
     $mm_perl_src = File::Spec-&gt;canonpath&#40;$mm-&gt;{PERL_SRC}&#41;;
 }
@@ -90,22 +93,28 @@
 
 
 # INST_*
+my $expect = File::Spec-&gt;catdir&#40;$Curdir, &#39;blib&#39;, &#39;arch&#39;&#41;;
+$expect = VMS::Filespec::vmspath&#40;$expect&#41; if $Is_VMS;
 is&#40; $mm-&gt;{INST_ARCHLIB}, 
     $mm-&gt;{PERL_CORE} ? $mm-&gt;{PERL_ARCHLIB}
-                     : File::Spec-&gt;catdir&#40;$Curdir, &#39;blib&#39;, &#39;arch&#39;&#41;,
-                                     &#39;INST_ARCHLIB&#39;&#41;;
-is&#40; $mm-&gt;{INST_BIN},     File::Spec-&gt;catdir&#40;$Curdir, &#39;blib&#39;, &#39;bin&#39;&#41;,
-                                     &#39;INST_BIN&#39; &#41;;
+                     : $expect,
+                          &#39;INST_ARCHLIB&#39;&#41;;
+$expect = File::Spec-&gt;catdir&#40;$Curdir, &#39;blib&#39;, &#39;bin&#39;&#41;;
+$expect = VMS::Filespec::vmspath&#40;$expect&#41; if $Is_VMS;
+is&#40; $mm-&gt;{INST_BIN}, $expect, &#39;INST_BIN&#39; &#41;;
 
 is&#40; keys %{$mm-&gt;{CHILDREN}}, 1 &#41;;
 my&#40;$child_pack&#41; = keys %{$mm-&gt;{CHILDREN}};
 my $c_mm = $mm-&gt;{CHILDREN}{$child_pack};
+$expect = File::Spec-&gt;catdir&#40;$Updir, &#39;blib&#39;, &#39;arch&#39;&#41;;
+$expect = VMS::Filespec::vmspath&#40;$expect&#41; if $Is_VMS;
 is&#40; $c_mm-&gt;{INST_ARCHLIB}, 
     $c_mm-&gt;{PERL_CORE} ? $c_mm-&gt;{PERL_ARCHLIB}
-                       : File::Spec-&gt;catdir&#40;$Updir, &#39;blib&#39;, &#39;arch&#39;&#41;,
-                                     &#39;CHILD INST_ARCHLIB&#39;&#41;;
-is&#40; $c_mm-&gt;{INST_BIN},     File::Spec-&gt;catdir&#40;$Updir, &#39;blib&#39;, &#39;bin&#39;&#41;,
-                                     &#39;CHILD INST_BIN&#39; &#41;;
+                       : $expect,
+                             &#39;CHILD INST_ARCHLIB&#39;&#41;;
+$expect = File::Spec-&gt;catdir&#40;$Updir, &#39;blib&#39;, &#39;bin&#39;&#41;;
+$expect = VMS::Filespec::vmspath&#40;$expect&#41; if $Is_VMS;
+is&#40; $c_mm-&gt;{INST_BIN}, $expect, &#39;CHILD INST_BIN&#39; &#41;;
 
 
 my $inst_lib = File::Spec-&gt;catdir&#40;$Curdir, &#39;blib&#39;, &#39;lib&#39;&#41;;
--- /rsync_root/perl/lib/Extutils/t/INST_PREFIX.t	Tue Jun 13 14:29:14 2006
+++ lib/Extutils/t/INST_PREFIX.t	Thu Dec 25 01:35:29 2008
@@ -103,6 +103,7 @@
 my&#40;$perl_src, $mm_perl_src&#41;;
 if&#40; $ENV{PERL_CORE} &#41; {
     $perl_src = File::Spec-&gt;catdir&#40;$Updir, $Updir&#41;;
+    $perl_src = VMS::Filespec::vmsify&#40;$perl_src&#41; if $Is_VMS;
     $perl_src = File::Spec-&gt;canonpath&#40;$perl_src&#41;;
     $mm_perl_src = File::Spec-&gt;canonpath&#40;$mm-&gt;{PERL_SRC}&#41;;
 }
@@ -153,6 +154,7 @@
     _set_config&#40;installman3dir =&gt; &#39;&#39;&#41;;
 
     my $wibble = File::Spec-&gt;catdir&#40;qw&#40;wibble and such&#41;&#41;;
+    $wibble = VMS::Filespec::vmspath&#40;$wibble&#41; if $Is_VMS;
     my $stdout = tie *STDOUT, &#39;TieOut&#39; or die;
     my $mm = WriteMakefile&#40;
                            NAME          =&gt; &#39;Big::Dummy&#39;,
@@ -187,7 +189,9 @@
                    INSTALLMAN3DIR=&gt; &#39;foo/bar/baz&#39;,
                   &#41;;
 
-    is&#40; $mm-&gt;{INSTALLVENDORMAN1DIR}, File::Spec-&gt;catdir&#40;&#39;foo&#39;,&#39;bar&#39;&#41;, 
+    my $expect = File::Spec-&gt;catdir&#40;&#39;foo&#39;,&#39;bar&#39;&#41;;
+    $expect = VMS::Filespec::vmspath&#40;$expect&#41; if $Is_VMS;
+    is&#40; $mm-&gt;{INSTALLVENDORMAN1DIR}, $expect, 
                       &#39;installvendorman1dir &#40;in %Config&#41; not modified&#39; &#41;;
     isnt&#40; $mm-&gt;{INSTALLVENDORMAN3DIR}, &#39;&#39;, 
                       &#39;installvendorman3dir &#40;not in %Config&#41; set&#39;  &#41;;
@@ -212,9 +216,14 @@
                            VERSION_FROM  =&gt; &#39;lib/Big/Dummy.pm&#39;,
                            PERL_CORE     =&gt; $ENV{PERL_CORE},
                           &#41;;
-
-    is&#40; $mm-&gt;{INSTALLMAN1DIR}, File::Spec-&gt;catdir&#40;&#39;foo&#39;, &#39;bar&#39;&#41; &#41;;
-    is&#40; $mm-&gt;{INSTALLMAN3DIR}, File::Spec-&gt;catdir&#40;&#39;foo&#39;, &#39;baz&#39;&#41; &#41;;
+    my $expect1 = File::Spec-&gt;catdir&#40;&#39;foo&#39;, &#39;bar&#39;&#41;;
+    my $expect2 = File::Spec-&gt;catdir&#40;&#39;foo&#39;, &#39;baz&#39;&#41;;
+    if &#40;$Is_VMS&#41; {
+        $expect1 = VMS::Filespec::vmspath&#40;$expect1&#41;;
+        $expect2 = VMS::Filespec::vmspath&#40;$expect2&#41;;
+    }
+    is&#40; $mm-&gt;{INSTALLMAN1DIR}, $expect1 &#41;;
+    is&#40; $mm-&gt;{INSTALLMAN3DIR}, $expect2 &#41;;
     SKIP: {
         skip &#34;VMS must expand macros in INSTALL* vars&#34;, 4 if $Is_VMS;
 
@@ -246,8 +255,14 @@
                            PERL_CORE     =&gt; $ENV{PERL_CORE},
                           &#41;;
 
-    is&#40; $mm-&gt;{INSTALLMAN1DIR}, File::Spec-&gt;catdir&#40;&#39;foo&#39;, &#39;bar&#39;&#41; &#41;;
-    is&#40; $mm-&gt;{INSTALLMAN3DIR}, File::Spec-&gt;catdir&#40;&#39;foo&#39;, &#39;baz&#39;&#41; &#41;;
+    my $expect1 = File::Spec-&gt;catdir&#40;&#39;foo&#39;, &#39;bar&#39;&#41;;
+    my $expect2 = File::Spec-&gt;catdir&#40;&#39;foo&#39;, &#39;baz&#39;&#41;;
+    if &#40;$Is_VMS&#41; {
+        $expect1 = VMS::Filespec::vmspath&#40;$expect1&#41;;
+        $expect2 = VMS::Filespec::vmspath&#40;$expect2&#41;;
+    }
+    is&#40; $mm-&gt;{INSTALLMAN1DIR}, $expect1 &#41;;
+    is&#40; $mm-&gt;{INSTALLMAN3DIR}, $expect2 &#41;;
     SKIP: {
         skip &#34;VMS must expand macros in INSTALL* vars&#34;, 2 if $Is_VMS;
         is&#40; $mm-&gt;{INSTALLSITEMAN1DIR},   &#39;$&#40;INSTALLMAN1DIR&#41;&#39; &#41;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;01&nbsp;14:06:02&nbsp;2009</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">What I&#39;m seeing in this patch is a whole lot of code that says I can no
longer trust the output of File::Spec on VMS and have to put in a lot of
special case code.

-    is&#40; $mm-&gt;{INSTALLVENDORMAN1DIR}, File::Spec-&gt;catdir&#40;&#39;foo&#39;,&#39;bar&#39;&#41;, 
+    my $expect = File::Spec-&gt;catdir&#40;&#39;foo&#39;,&#39;bar&#39;&#41;;
+    $expect = VMS::Filespec::vmspath&#40;$expect&#41; if $Is_VMS;
+    is&#40; $mm-&gt;{INSTALLVENDORMAN1DIR}, $expect, 
                       &#39;installvendorman1dir &#40;in %Config&#41; not modified&#39; &#41;;

This sucks.  I don&#39;t want to be sprinkling &#34;if $Is_VMS&#34; all over the
place.  There&#39;s got to be a better way to handle this.

My first thought is why isn&#39;t File::Spec taking care of this?

Also, what is this stuff even doing?  What&#39;s all this about?

+    if&#40; $Is_VMS &#41; {
+        my $vms_unix_rpt;
+        my $vms_efs;
+        my $vms_case;
+
+        if &#40;eval { local $SIG{__DIE__}; require VMS::Feature; }&#41; {
+            $vms_unix_rpt = VMS::Feature::current&#40;&#34;filename_unix_report&#34;&#41;;
+            $vms_efs = VMS::Feature::current&#40;&#34;efs_charset&#34;&#41;;
+            $vms_case = VMS::Feature::current&#40;&#34;efs_case_preserve&#34;&#41;;
+        } else {
+            my $unix_rpt = $ENV{&#39;DECC$FILENAME_UNIX_REPORT&#39;} || &#39;&#39;;
+            my $efs_charset = $ENV{&#39;DECC$EFS_CHARSET&#39;} || &#39;&#39;;
+            my $efs_case = $ENV{&#39;DECC$EFS_CASE_PRESERVE&#39;} || &#39;&#39;;
+            $vms_unix_rpt = $unix_rpt =~ /^[ET1]/i; 
+            $vms_efs = $efs_charset =~ /^[ET1]/i;
+            $vms_case = $efs_case =~ /^[ET1]/i;
+        }
+        $Is_VMS_noefs = 0 if &#40;$vms_efs&#41;; 
+    }

Why are $vms_case and $vms_unix_rpt being set?  Nothing uses them.  Why
do we have to go through all those hoops just to figure out if the
extended filesystem is in effect?  Why isn&#39;t this in a module somewhere?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;01&nbsp;14:06:03&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;01&nbsp;21:30:36&nbsp;2009</span>
    <span class="description">malmberg [...] Encompasserve.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42149] Add support for VMS in Unix or extended character set modes.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 01 Apr 2009 20:30:03 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-ExtUtils-Install [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;John E. Malmberg&#34; &lt;malmberg [...] Encompasserve.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Michael G Schwern via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=42149">https://rt.cpan.org/Ticket/Display.html?id=42149</a></span> &gt;
&gt; 
&gt; What I&#39;m seeing in this patch is a whole lot of code that says I can no
&gt; longer trust the output of File::Spec on VMS and have to put in a lot of
&gt; special case code.
&gt; 
&gt; -    is&#40; $mm-&gt;{INSTALLVENDORMAN1DIR}, File::Spec-&gt;catdir&#40;&#39;foo&#39;,&#39;bar&#39;&#41;, 
&gt; +    my $expect = File::Spec-&gt;catdir&#40;&#39;foo&#39;,&#39;bar&#39;&#41;;
&gt; +    $expect = VMS::Filespec::vmspath&#40;$expect&#41; if $Is_VMS;
&gt; +    is&#40; $mm-&gt;{INSTALLVENDORMAN1DIR}, $expect, 
&gt;                        &#39;installvendorman1dir &#40;in %Config&#41; not modified&#39; &#41;;
</div>
Most perl modules I have encountered have to have special case code to 
deal with File::Spec changing Unix file specifications to VMS format.

This module is one of the few that want Unix file specifications to turn 
into VMS, because it is writing a MMS file.

So the behavior now for File::Spec is that if the DECC$EFS_CHARSET 
feature is in affect that it will preserve the input format of the file 
specifications to the output.

Which means that more Perl modules written with for Unix will now just 
work on VMS when that feature is enabled.

A second feature DECC$FILENAME_UNIX_REPORT controls the output of 
routines that output file specifications with out knowing the the format 
of the input specifications.

The combination of these features set before running Perl increases the 
number of perl scripts that will just run on Perl with out needing any 
VMS specific changes.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This sucks.  I don&#39;t want to be sprinkling &#34;if $Is_VMS&#34; all over the
&gt; place.  There&#39;s got to be a better way to handle this.
&gt;
&gt; My first thought is why isn&#39;t File::Spec taking care of this?
</div>
File::Spec changing Unix file specifications to VMS is actually the 
cause of most portability problems that I have had to fix.  If it 
traditionally had not changed the file format to VMS from UNIX, a lot of 
VMS specific code could be removed Perl.

It is ironic that a feature introduced for portability actually made 
portability harder.

The need for VMS syntax format is actually more an issue of the MAKE 
program that VMS is using.  MMS and MMK need to have the filenames in 
VMS format.  GNU make on VMS will need it in UNIX format.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Also, what is this stuff even doing?  What&#39;s all this about?
&gt; 
&gt; +    if&#40; $Is_VMS &#41; {
&gt; +        my $vms_unix_rpt;
&gt; +        my $vms_efs;
&gt; +        my $vms_case;
&gt; +
&gt; +        if &#40;eval { local $SIG{__DIE__}; require VMS::Feature; }&#41; {
&gt; +            $vms_unix_rpt = VMS::Feature::current&#40;&#34;filename_unix_report&#34;&#41;;
&gt; +            $vms_efs = VMS::Feature::current&#40;&#34;efs_charset&#34;&#41;;
&gt; +            $vms_case = VMS::Feature::current&#40;&#34;efs_case_preserve&#34;&#41;;
&gt; +        } else {
&gt; +            my $unix_rpt = $ENV{&#39;DECC$FILENAME_UNIX_REPORT&#39;} || &#39;&#39;;
&gt; +            my $efs_charset = $ENV{&#39;DECC$EFS_CHARSET&#39;} || &#39;&#39;;
&gt; +            my $efs_case = $ENV{&#39;DECC$EFS_CASE_PRESERVE&#39;} || &#39;&#39;;
&gt; +            $vms_unix_rpt = $unix_rpt =~ /^[ET1]/i; 
&gt; +            $vms_efs = $efs_charset =~ /^[ET1]/i;
&gt; +            $vms_case = $efs_case =~ /^[ET1]/i;
&gt; +        }
&gt; +        $Is_VMS_noefs = 0 if &#40;$vms_efs&#41;; 
&gt; +    }
</div>
The eval first tries to see if the VMS::Feature module is present.  If 
it is, then it will be used to look up the feature as it will be the 
most reliable method.

If VMS::Feature is not present, then the logical name is looked up 
through the $ENV hash.  Not the best, but currently the only method that 
can be assumed available on all Perl.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Why are $vms_case and $vms_unix_rpt being set?  Nothing uses them.
</div>
They are left over from a commmon cut and paste.  They can be removed 
from this patch.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  Why
&gt; do we have to go through all those hoops just to figure out if the
&gt; extended filesystem is in effect?  Why isn&#39;t this in a module somewhere?
</div>
I plan to add the VMS::Feature module to support reading and setting the 
mode that VMS is in.

The extra hoops are in place so that dual life modules will work 
correctly with out the VMS::Feature module being present.

Regards,
-John
malmberg@encompasserve.org
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;02&nbsp;04:37:13&nbsp;2009</span>
    <span class="description">mschwern [...] cpan.org -  Reference by ticket #42151 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
