<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #84862 for Net-SFTP-Foreign: Appending newline character to downloaded file. </title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #84862 for Net-SFTP-Foreign: Appending newline character to downloaded file. </h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-SFTP-Foreign/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-SFTP-Foreign/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-SFTP-Foreign/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-SFTP-Foreign/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-SFTP-Foreign">Net-SFTP-Foreign CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">84862</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-SFTP-Foreign/Active/">Net-SFTP-Foreign</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
Thomas.Wadley [...] acxiom.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-23164-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-23165-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




image001.jpg<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1205474/636492/image001.jpg">
Thu Apr 25 19:53:19 2013 (2k) by Thomas.Wadley [...] acxiom.com
</a>
</font></li>
</ul>


image002.gif<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1205474/636493/image002.gif">
Thu Apr 25 19:53:19 2013 (1.3k) by Thomas.Wadley [...] acxiom.com
</a>
</font></li>
</ul>


image003.gif<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1205474/636494/image003.gif">
Thu Apr 25 19:53:19 2013 (1.3k) by Thomas.Wadley [...] acxiom.com
</a>
</font></li>
</ul>


image004.gif<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1205474/636495/image004.gif">
Thu Apr 25 19:53:19 2013 (1.4k) by Thomas.Wadley [...] acxiom.com
</a>
</font></li>
</ul>


image005.png<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1205474/636496/image005.png">
Thu Apr 25 19:53:19 2013 (690b) by Thomas.Wadley [...] acxiom.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;25&nbsp;19:53:19&nbsp;2013</span>
    <span class="description">Thomas.Wadley [...] acxiom.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Appending newline character to downloaded file. </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 25 Apr 2013 23:52:56 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Net-SFTP-Foreign [...] rt.cpan.org&#34; &lt;bug-Net-SFTP-Foreign [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Wadley Thomas - twadle &lt;Thomas.Wadley [...] acxiom.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m downloading a fixed flat file with no newlines in it, and the file saves with a newline appended.

Original size = 19679010
After download = 19679011

I&#39;ve tried changing loads of options, and haven&#39;t found anything that works.
$VERSION = &#39;1.62&#39;;

perl, v5.8.8 built for x86_64-linux-thread-multi
Linux ### 2.6.18-194.11.3.el5 #1 SMP Mon Aug 23 15:51:38 EDT 2010 x86_64 x86_64 x86_64 GNU/Linux


What gives?


Thomas Wadley
Associate Solutions Developer
[acxiom]

Acxiom Corporation
EML   thomas.wadley@acxiom.com&lt;mailto:thomas.wadley@acxiom.com&gt;
TEL    501.342.7818
301 E. Dave Ward Dr, Conway AR, 72032, USA
www.acxiom.com&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.acxiom.com/">http://www.acxiom.com/</a></span>&gt;

[Description: Friend Us on Facebook]&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.facebook.com/acxiomcorp">http://www.facebook.com/acxiomcorp</a></span>&gt;  [Description: Link Us on LinkedIn] &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.linkedin.com/groupRegistration?gid=2901735">http://www.linkedin.com/groupRegistration?gid=2901735</a></span>&gt;   [Description: Follow Us on Twitter] &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://twitter.com/acxiom">http://twitter.com/acxiom</a></span>&gt;

[Description: cid:image004.png@01CB84F1.26214350]

***************************************************************************
The information contained in this communication is confidential, is
intended only for the use of the recipient named above, and may be legally
privileged.

If the reader of this message is not the intended recipient, you are
hereby notified that any dissemination, distribution or copying of this
communication is strictly prohibited.

If you have received this communication in error, please resend this
communication to the sender and delete the original message or any copy
of it from your computer system.

Thank You.
****************************************************************************
</div></div>

<div class="messagebody">
</div>
</div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1205474/636492/image001.jpg">Download image001.jpg</a><br />
<span class="downloadcontenttype">image/jpeg 2k</span>
</div>
<div class="messagebody">
<img alt="image001.jpg" title="image001.jpg" src="/Ticket/Attachment/1205474/636492/" /></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1205474/636493/image002.gif">Download image002.gif</a><br />
<span class="downloadcontenttype">image/gif 1.3k</span>
</div>
<div class="messagebody">
<img alt="image002.gif" title="image002.gif" src="/Ticket/Attachment/1205474/636493/" /></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1205474/636494/image003.gif">Download image003.gif</a><br />
<span class="downloadcontenttype">image/gif 1.3k</span>
</div>
<div class="messagebody">
<img alt="image003.gif" title="image003.gif" src="/Ticket/Attachment/1205474/636494/" /></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1205474/636495/image004.gif">Download image004.gif</a><br />
<span class="downloadcontenttype">image/gif 1.4k</span>
</div>
<div class="messagebody">
<img alt="image004.gif" title="image004.gif" src="/Ticket/Attachment/1205474/636495/" /></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1205474/636496/image005.png">Download image005.png</a><br />
<span class="downloadcontenttype">image/png 690b</span>
</div>
<div class="messagebody">
<img alt="image005.png" title="image005.png" src="/Ticket/Attachment/1205474/636496/" /></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;26&nbsp;03:32:32&nbsp;2013</span>
    <span class="description">sfandino [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #84862] Appending newline character to downloaded file.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 26 Apr 2013 09:32:04 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SFTP-Foreign [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Salvador Fandiño &lt;sfandino [...] yahoo.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 04/26/2013 01:53 AM, Wadley Thomas - twadle via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thu Apr 25 19:53:19 2013: Request 84862 was acted upon.
&gt; Transaction: Ticket created by Thomas.Wadley@acxiom.com
&gt;         Queue: Net-SFTP-Foreign
&gt;       Subject: Appending newline character to downloaded file.
&gt;     Broken in: &#40;no value&#41;
&gt;      Severity: &#40;no value&#41;
&gt;         Owner: Nobody
&gt;    Requestors: Thomas.Wadley@acxiom.com
&gt;        Status: new
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=84862">https://rt.cpan.org/Ticket/Display.html?id=84862</a></span> &gt;
&gt;
&gt;
&gt; I&#39;m downloading a fixed flat file with no newlines in it, and the file saves with a newline appended.
&gt;
&gt; Original size = 19679010
&gt; After download = 19679011
&gt;
&gt; I&#39;ve tried changing loads of options, and haven&#39;t found anything that works.
&gt; $VERSION = &#39;1.62&#39;;
&gt;
&gt; perl, v5.8.8 built for x86_64-linux-thread-multi
&gt; Linux ### 2.6.18-194.11.3.el5 #1 SMP Mon Aug 23 15:51:38 EDT 2010 x86_64 x86_64 x86_64 GNU/Linux
&gt;
&gt;
&gt; What gives?
</div>
Without seeing your script source code is hard to tell.

Enable debugging on the module adding the following line at the beginning:

$Net::SFTP::Foreign::debug = -1;

Then show me the first and last thousand lines &#40;note that parts of the 
content of the transferred file will be included there, if it has 
sensible information you would like to replace it by a faked one&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;26&nbsp;03:32:32&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;26&nbsp;12:19:26&nbsp;2013</span>
    <span class="description">Thomas.Wadley [...] acxiom.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #84862] Appending newline character to downloaded file.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 26 Apr 2013 16:18:36 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Net-SFTP-Foreign [...] rt.cpan.org&#34; &lt;bug-Net-SFTP-Foreign [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Wadley Thomas - twadle &lt;Thomas.Wadley [...] acxiom.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;26&nbsp;13:28:59&nbsp;2013</span>
    <span class="description">sfandino [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #84862] Appending newline character to downloaded file.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 26 Apr 2013 19:27:46 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SFTP-Foreign [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Salvador Fandiño &lt;sfandino [...] yahoo.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 04/26/2013 06:19 PM, Wadley Thomas - twadle via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: Net-SFTP-Foreign
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=84862">https://rt.cpan.org/Ticket/Display.html?id=84862</a></span> &gt;
&gt;
&gt; The ftp module is tied into an automation agent, which spawns multiple ftp handles and forks, cycling through each one and downloading the detected files for multiple detect locations that have the same ftp site.
&gt;
&gt; Here&#39;s some snippets of the connection and download calls.
&gt;
&gt; $Net::SFTP::Foreign::debug = -1;
&gt;       
&gt;         $args{host}     = $host;
&gt;         $args{user}     = $login;
&gt;         $args{password} = $password unless &#40;$use_secure eq &#39;K&#39;&#41;;
&gt;         $args{port}     = defined&#40;$port&#41; ? $port : 22;
&gt;         $args{timeout}  = 300;
&gt;         $args{more}     = &#39;-v&#39;;
&gt;            $args{late_set_perm}   = 1;
&gt;            $args{block_size}      = 65536;
&gt;            $connection = Net::SFTP::Foreign-&gt;new&#40;%args&#41;;
&gt;         $connection-&gt;error
&gt;                  and connection_failure&#40;$detection_id
&gt;                                         ,$login_failure . &#34;[&#34; . $connection-&gt;error . &#34;]&#34;
&gt;                                         ,$dbh
&gt;                                         ,1
&gt;                                         ,undef
&gt;                                         ,$connection-&gt;status&#41;;
&gt;
&gt;
&gt; $ftp_handle-&gt;get&#40;$source_path
&gt;                               . &#34;/&#34;
&gt;                               . $filename
&gt;                               ,$download_staging_path
&gt;                               . &#34;/&#34;
&gt;                               . $renamed_file
&gt;                                  ,callback =&gt; $callback&#41;
&gt;                                or &#40;$ftp_handle-&gt;get&#40;$source_path
&gt;                                                    . &#34;/&#34;
&gt;                                                    . $filename
&gt;                                                    ,$download_staging_path
&gt;                                                    . &#34;/&#34;
&gt;                                                    . $renamed_file
&gt;                                                    ,callback =&gt; $callback&#41;
&gt;                                      or download_failure&#40;$filename
&gt;                                                    ,$download_staging_path
&gt;                                                    ,$renamed_file
&gt;                                                    ,\%det
&gt;                                                    ,$file_prelog_id
&gt;                                                    ,$dbh&#41;
&gt;                                    and next&#41;;
&gt; my callback hook..
&gt;
&gt;       
&gt; sub sftp_callback {
&gt;    my &#40;$sftp, $data, $offset, $size&#41; = @_;
&gt;
&gt;    my $gigabytes    = sprintf&#40;&#34;%.4f&#34;, $size/1024/1024/1024&#41;;
&gt;    my $block_size   = $sftp-&gt;{_block_size};
&gt;
&gt;    if &#40;$size eq 0&#41; {
&gt;      ## avoid division by zero
&gt;      $size = 1;
&gt;    }
&gt;    ## total full blocks
&gt;    my $total_blocks = int&#40;$size/$block_size&#41;;
&gt;
&gt;    if &#40;$offset eq 0&#41; {
&gt;      vprint &#40;&#34;Starting transfer of $gigabytes GB file&#34;&#41;;
&gt;      vprint &#40;&#34;Block Size = $block_size&#34; &#41;;
&gt;
&gt;    }
&gt;    my $dyn_percent= sprintf&#40;&#34;%.1f&#34;,$offset/$size&#41;;
&gt;
&gt;    my $print_flag  = undef;
&gt;
&gt;    my $calc_offset = int&#40;$total_blocks*$dyn_percent+.1&#41;*$block_size;
&gt;    $print_flag     = 1 if &#40;$offset eq $calc_offset&#41;;
&gt;
&gt;    if &#40;$offset eq $size || defined&#40;$print_flag&#41; &#41; {
&gt;      my $percent = sprintf&#40;&#34;%.4f&#34;,$offset / $size&#41;*100;
&gt;    
&gt;      vprint&#40;&#34;Transferred [$percent\%] -- [$offset bytes] &#34;&#41;;
&gt;
&gt;    }
&gt; }
</div>
I bet that $\ is being changed to &#34;\n&#34; from the vprint function being 
invoked from your callback and that, is interfering with 
Net::SFTP::Foreign get method which uses &#34;print&#34; to write the file 
chunks to the destination file under the hood.

If that is the case, use local to limit the scope of the $\ change to 
the vprint function. In example:

   sub vprint {
     local $\;
     ...

In any case, I am also going to add some defensive code around the 
callback invocations in Net::SFTP::Foreign to protect against this issue.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;26&nbsp;13:53:10&nbsp;2013</span>
    <span class="description">sfandino [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #84862] Appending newline character to downloaded file.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 26 Apr 2013 19:52:55 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SFTP-Foreign [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Salvador Fandiño &lt;sfandino [...] yahoo.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 04/26/2013 07:29 PM, Salvador \&#34;Fandiño\&#34; via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: Net-SFTP-Foreign
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=84862">https://rt.cpan.org/Ticket/Display.html?id=84862</a></span> &gt;
&gt;
&gt; On 04/26/2013 06:19 PM, Wadley Thomas - twadle via RT wrote:
<div class="message-stanza open">&gt;&gt;          Queue: Net-SFTP-Foreign
&gt;&gt;    Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=84862">https://rt.cpan.org/Ticket/Display.html?id=84862</a></span> &gt;
&gt;&gt;
&gt;&gt; The ftp module is tied into an automation agent, which spawns multiple ftp handles and forks, cycling through each one and downloading the detected files for multiple detect locations that have the same ftp site.
&gt;&gt;
&gt;&gt; Here&#39;s some snippets of the connection and download calls.
&gt;&gt;
&gt;&gt; $Net::SFTP::Foreign::debug = -1;
&gt;&gt;      
&gt;&gt;        $args{host}     = $host;
&gt;&gt;        $args{user}     = $login;
&gt;&gt;        $args{password} = $password unless &#40;$use_secure eq &#39;K&#39;&#41;;
&gt;&gt;        $args{port}     = defined&#40;$port&#41; ? $port : 22;
&gt;&gt;        $args{timeout}  = 300;
&gt;&gt;        $args{more}     = &#39;-v&#39;;
&gt;&gt;             $args{late_set_perm}   = 1;
&gt;&gt;             $args{block_size}      = 65536;
&gt;&gt;             $connection = Net::SFTP::Foreign-&gt;new&#40;%args&#41;;
&gt;&gt;        $connection-&gt;error
&gt;&gt;                 and connection_failure&#40;$detection_id
&gt;&gt;                                        ,$login_failure . &#34;[&#34; . $connection-&gt;error . &#34;]&#34;
&gt;&gt;                                        ,$dbh
&gt;&gt;                                        ,1
&gt;&gt;                                        ,undef
&gt;&gt;                                        ,$connection-&gt;status&#41;;
&gt;&gt;
&gt;&gt;
&gt;&gt; $ftp_handle-&gt;get&#40;$source_path
&gt;&gt;                                      . &#34;/&#34;
&gt;&gt;                                      . $filename
&gt;&gt;                                      ,$download_staging_path
&gt;&gt;                                      . &#34;/&#34;
&gt;&gt;                                      . $renamed_file
&gt;&gt;                                   ,callback =&gt; $callback&#41;
&gt;&gt;                                       or &#40;$ftp_handle-&gt;get&#40;$source_path
&gt;&gt;                                                           . &#34;/&#34;
&gt;&gt;                                                           . $filename
&gt;&gt;                                                           ,$download_staging_path
&gt;&gt;                                                           . &#34;/&#34;
&gt;&gt;                                                           . $renamed_file
&gt;&gt;                                                           ,callback =&gt; $callback&#41;
&gt;&gt;                                             or download_failure&#40;$filename
&gt;&gt;                                                           ,$download_staging_path
&gt;&gt;                                                           ,$renamed_file
&gt;&gt;                                                           ,\%det
&gt;&gt;                                                           ,$file_prelog_id
&gt;&gt;                                                           ,$dbh&#41;
&gt;&gt;                                           and next&#41;;
&gt;&gt; my callback hook..
&gt;&gt;
&gt;&gt;              
&gt;&gt; sub sftp_callback {
&gt;&gt;     my &#40;$sftp, $data, $offset, $size&#41; = @_;
&gt;&gt;
&gt;&gt;     my $gigabytes    = sprintf&#40;&#34;%.4f&#34;, $size/1024/1024/1024&#41;;
&gt;&gt;     my $block_size   = $sftp-&gt;{_block_size};
&gt;&gt;
&gt;&gt;     if &#40;$size eq 0&#41; {
&gt;&gt;       ## avoid division by zero
&gt;&gt;       $size = 1;
&gt;&gt;     }
&gt;&gt;     ## total full blocks
&gt;&gt;     my $total_blocks = int&#40;$size/$block_size&#41;;
&gt;&gt;
&gt;&gt;     if &#40;$offset eq 0&#41; {
&gt;&gt;       vprint &#40;&#34;Starting transfer of $gigabytes GB file&#34;&#41;;
&gt;&gt;       vprint &#40;&#34;Block Size = $block_size&#34; &#41;;
&gt;&gt;
&gt;&gt;     }
&gt;&gt;     my $dyn_percent= sprintf&#40;&#34;%.1f&#34;,$offset/$size&#41;;
&gt;&gt;
&gt;&gt;     my $print_flag  = undef;
&gt;&gt;
&gt;&gt;     my $calc_offset = int&#40;$total_blocks*$dyn_percent+.1&#41;*$block_size;
&gt;&gt;     $print_flag     = 1 if &#40;$offset eq $calc_offset&#41;;
&gt;&gt;
&gt;&gt;     if &#40;$offset eq $size || defined&#40;$print_flag&#41; &#41; {
&gt;&gt;       my $percent = sprintf&#40;&#34;%.4f&#34;,$offset / $size&#41;*100;
&gt;&gt;     
&gt;&gt;       vprint&#40;&#34;Transferred [$percent\%] -- [$offset bytes] &#34;&#41;;
&gt;&gt;
&gt;&gt;     }
&gt;&gt; }
</div>&gt; I bet that $\ is being changed to &#34;\n&#34; from the vprint function being
&gt; invoked from your callback and that, is interfering with
&gt; Net::SFTP::Foreign get method which uses &#34;print&#34; to write the file
&gt; chunks to the destination file under the hood.
&gt;
&gt; If that is the case, use local to limit the scope of the $\ change to
&gt; the vprint function. In example:
&gt;
&gt;     sub vprint {
&gt;       local $\;
&gt;       ...
&gt;
&gt; In any case, I am also going to add some defensive code around the
&gt; callback invocations in Net::SFTP::Foreign to protect against this issue.
</div>
I have just uploaded 1.76_01 to CPAN: 
<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/release/SALVA/Net-SFTP-Foreign-1.76_01">https://metacpan.org/release/SALVA/Net-SFTP-Foreign-1.76_01</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;24&nbsp;04:29:58&nbsp;2013</span>
    <span class="description">salva [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">No feedback from the reporter.

I am supposing the patch solved the problem and closing the ticket.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;24&nbsp;04:29:59&nbsp;2013</span>
    <span class="description">salva [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;24&nbsp;10:27:25&nbsp;2013</span>
    <span class="description">Thomas.Wadley [...] acxiom.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #84862] Resolved: Appending newline character to downloaded file.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 24 May 2013 14:26:59 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Net-SFTP-Foreign [...] rt.cpan.org&#34; &lt;bug-Net-SFTP-Foreign [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Wadley Thomas - twadle &lt;Thomas.Wadley [...] acxiom.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you!

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Salvador Fandino Garcia via RT [mailto:bug-Net-SFTP-Foreign@rt.cpan.org] 
Sent: Friday, May 24, 2013 3:30 AM
To: Wadley Thomas - twadle
Subject: [rt.cpan.org #84862] Resolved: Appending newline character to downloaded file.

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=84862">https://rt.cpan.org/Ticket/Display.html?id=84862</a></span> &gt;

According to our records, your request has been resolved. If you have any
further questions or concerns, please respond to this message.
***************************************************************************
The information contained in this communication is confidential, is
intended only for the use of the recipient named above, and may be legally
privileged.

If the reader of this message is not the intended recipient, you are
hereby notified that any dissemination, distribution or copying of this
communication is strictly prohibited.

If you have received this communication in error, please resend this
communication to the sender and delete the original message or any copy
of it from your computer system.

Thank You.
****************************************************************************
</div></div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
