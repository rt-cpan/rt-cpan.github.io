<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #88923 for DBIx-Class: Problem &#34;Result collapse not possible - selection from a has_many source redirected to the main&#34; after update 0.08196-3 =&gt; 0.08250-1</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #88923 for DBIx-Class: Problem &#34;Result collapse not possible - selection from a has_many source redirected to the main&#34; after update 0.08196-3 =&gt; 0.08250-1</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBIx-Class">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBIx-Class">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBIx-Class">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBIx-Class">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBIx-Class">DBIx-Class CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">88923</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBIx-Class">DBIx-Class</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
korjavin [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10410-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10411-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=88923">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1266474" href="/Public/Bug/Display.html?id=88923#txn-1266474">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;24&nbsp;00:58:58&nbsp;2013</span>
    <span class="description">korjavin [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Problem &#34;Result collapse not possible - selection from a has_many source redirected to the main&#34; after update 0.08196-3 =&gt; 0.08250-1</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 24 Sep 2013 10:58:42 +0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ivan Korjavin &lt;korjavin [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1266474/670568/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/670568">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Schema is:

CREATE TABLE providers &#40;
    pid integer primary key autoincrement,
    name varchar&#40;50&#41;,
&#41;;

CREATE TABLE orders &#40;
    oid integer primary key autoincrement,
    pid integer references providers &#40;pid&#41;,
&#41;;


CREATE TABLE orderstatus&#40;
    osid integer primary key autoincrement,
    oid integer references orders &#40;oid&#41;,
    regdt timestamp default current_timestamp
&#41;;


Code is:

my $order     = $schema-&gt;resultset&#40;&#39;Order&#39;&#41;;

my $r = $order-&gt;search&#40;
   {   &#39;orderstatuses.sid&#39;   =&gt; 1,
       &#39;orderstatuses.regdt&#39; =&gt; { &#39;&gt;=&#39;, $first }
    },
    { prefetch=&gt;&#39;pid&#39;,join =&gt; &#39;orderstatuses&#39;,&#39;+select&#39;=&gt;
&#39;orderstatuses.regdt&#39;, &#39;+as&#39; =&gt; &#39;regdt&#39;,  order_by =&gt; { -desc =&gt; &#39;me.oid&#39; }
}
&#41;;

DBIC_TRACE=1 show the query:

SELECT me.oid,  me.pid,  orderstatuses.regdt, pid.pid, pid.name
 FROM orders me LEFT JOIN orderstatus orderstatuses ON orderstatuses.oid =
me.oid LEFT JOIN providers pid ON pid.pid = me.pid WHERE &#40; &#40;
orderstatuses.regdt &gt;= ? AND orderstatuses.sid = ? &#41; &#41; ORDER BY me.oid DESC

Its works nice with libdbix-class-perl   = 0.08196-3 but
in libdbix-class-perl   = 0.08250-1

show the error:

Result collapse not possible - selection from a has_many source redirected
to the main object at /usr/share/perl5/DBIx/Class/Schema.pm line 1080.
DBIx::Class::Schema::throw_exception&#40;&#39;a::Model=HASH&#40;0x1931de0&#41;&#39;, &#39;Result
collapse not possible - selection from a has_many sour...&#39;&#41; called at
/usr/share/perl5/DBIx/Class/ResultSource.pm line 1952
DBIx::Class::ResultSource::throw_exception&#40;&#39;DBIx::Class::ResultSource::Table=HASH&#40;0x193b958&#41;&#39;,
&#39;Result collapse not possible - selection from a has_many sour...&#39;&#41; called
at /usr/share/perl5/DBIx/Class/ResultSet.pm line 3894
DBIx::Class::ResultSet::throw_exception&#40;&#39;DBIx::Class::ResultSet=HASH&#40;0x2d65f08&#41;&#39;,
&#39;Result collapse not possible - selection from a has_many sour...&#39;&#41; called
at /usr/share/perl5/DBIx/Class/ResultSet.pm line 1378
DBIx::Class::ResultSet::_construct_results&#40;&#39;DBIx::Class::ResultSet=HASH&#40;0x2d65f08&#41;&#39;&#41;
called at /usr/share/perl5/DBIx/Class/ResultSet.pm line 1259
DBIx::Class::ResultSet::next&#40;&#39;DBIx::Class::ResultSet=HASH&#40;0x2d65f08&#41;&#39;&#41;
called at lib/Report.pl line 27
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1266474/670569/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/670569">with headers</a>
<br />
<span class="downloadcontenttype">text/html 3.2k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1266526" href="/Public/Bug/Display.html?id=88923#txn-1266526">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;24&nbsp;05:23:12&nbsp;2013</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1266526/670590/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/670590">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Sep 24 00:58:58 2013, korjavin@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Code is:
&gt; 
&gt; my $order     = $schema-&gt;resultset&#40;&#39;Order&#39;&#41;;
&gt; 
&gt; my $r = $order-&gt;search&#40;
&gt;    {   &#39;orderstatuses.sid&#39;   =&gt; 1,
&gt;        &#39;orderstatuses.regdt&#39; =&gt; { &#39;&gt;=&#39;, $first }
&gt;     },
&gt;     { prefetch=&gt;&#39;pid&#39;,join =&gt; &#39;orderstatuses&#39;,&#39;+select&#39;=&gt;
&gt; &#39;orderstatuses.regdt&#39;, &#39;+as&#39; =&gt; &#39;regdt&#39;,  order_by =&gt; { -desc =&gt;
&gt; &#39;me.oid&#39; }
&gt; }
&gt; &#41;;
&gt; 
&gt; Its works nice with libdbix-class-perl   = 0.08196-3 but
&gt; in libdbix-class-perl   = 0.08250-1
&gt; 
&gt; show the error:
&gt; 
&gt; Result collapse not possible - selection from a has_many source
&gt; redirected
&gt; to the main object ...
</div>
Everything is correct. Under 0.08196 this was a silent bug. While your query may return *multiple* orderstatuses per order object, you are asking to take *one* value of regdt and assign it to the main order object. Before DBIC would ranomly use a value &#40;usually the first one that came off the cursor&#41;, but this was never correct to begin with. Now it throws an exception informing you that you are about to lose data.

You need to rewrite this particular query, it can not produce a sensible result as specified.

Let me know if this clarifies things or you still have some questions.

For the time being I will mark the ticket as rejected, since eerything is working by design.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1266527" href="/Public/Bug/Display.html?id=88923#txn-1266527">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;24&nbsp;05:23:14&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1266530" href="/Public/Bug/Display.html?id=88923#txn-1266530">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;24&nbsp;05:23:15&nbsp;2013</span>
    <span class="description">ribasushi [...] leporine.io -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1266531" href="/Public/Bug/Display.html?id=88923#txn-1266531">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;24&nbsp;05:29:50&nbsp;2013</span>
    <span class="description">korjavin [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #88923] Problem &#34;Result collapse not possible - selection from a has_many source redirected to the main&#34; after update 0.08196-3 =&gt; 0.08250-1</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 24 Sep 2013 15:29:36 +0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ivan Korjavin &lt;korjavin [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1266531/670594/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/670594">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 178b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you!!
Now I understood where is problem.
I was confused that tested code stops working after update.

Still don&#39;t know how to fix that query, but anyway  I got your point.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1266531/670595/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/670595">with headers</a>
<br />
<span class="downloadcontenttype">text/html 242b</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1266533" href="/Public/Bug/Display.html?id=88923#txn-1266533">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;24&nbsp;05:53:29&nbsp;2013</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #88923] Problem &#34;Result collapse not possible - selection from a has_many source redirected to the main&#34; after update 0.08196-3 =&gt; 0.08250-1</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 24 Sep 2013 09:53:09 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;korjavin [...] gmail.com via RT&#34; &lt;bug-DBIx-Class [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Rabbitson &lt;ribasushi [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1266533/670597/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/670597">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 708b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, Sep 24, 2013 at 05:29:52AM -0400, korjavin@gmail.com via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: DBIx-Class
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=88923">https://rt.cpan.org/Ticket/Display.html?id=88923</a></span> &gt;
&gt; 
&gt; Thank you!!
&gt; Now I understood where is problem.
&gt; I was confused that tested code stops working after update.
&gt; 
&gt; Still don&#39;t know how to fix that query, but anyway  I got your point.
</div>
What you most likely want is to prefetch orderstatuses in addition to 
pid, OR get an aggregate of regdt &#40;a MIN or a MAX&#41;. It all depends on 
what you are doing with this data afterwards.

What usually helps is to word the question in your spoken language, as 
opposed to Perl. Then all of a sudden things start making much more 
sense.

Cheers
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1266575" href="/Public/Bug/Display.html?id=88923#txn-1266575">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;24&nbsp;08:04:16&nbsp;2013</span>
    <span class="description">korjavin [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #88923] Problem &#34;Result collapse not possible - selection from a has_many source redirected to the main&#34; after update 0.08196-3 =&gt; 0.08250-1</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 24 Sep 2013 18:03:58 +0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ivan Korjavin &lt;korjavin [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1266575/670624/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/670624">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">My english, probably, worse then Perl, so I&#39;ll try the sql:

I want something like this:

select min&#40;os.regdt&#41;,o.oid,p.name from orders o inner join orderstatus os
on o.oid=os.oid left join providers p on p.pid=o.pid where os.sid=1 and
os.regdt&gt;&#39;...&#39; group by o.oid;




2013/9/24 Peter Rabbitson via RT &lt;bug-DBIx-Class@rt.cpan.org&gt;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=88923">https://rt.cpan.org/Ticket/Display.html?id=88923</a></span> &gt;
&gt;
&gt; On Tue, Sep 24, 2013 at 05:29:52AM -0400, korjavin@gmail.com via RT wrote:
<div class="message-stanza open">&gt; &gt;        Queue: DBIx-Class
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=88923">https://rt.cpan.org/Ticket/Display.html?id=88923</a></span> &gt;
&gt; &gt;
&gt; &gt; Thank you!!
&gt; &gt; Now I understood where is problem.
&gt; &gt; I was confused that tested code stops working after update.
&gt; &gt;
&gt; &gt; Still don&#39;t know how to fix that query, but anyway  I got your point.
</div>&gt;
&gt; What you most likely want is to prefetch orderstatuses in addition to
&gt; pid, OR get an aggregate of regdt &#40;a MIN or a MAX&#41;. It all depends on
&gt; what you are doing with this data afterwards.
&gt;
&gt; What usually helps is to word the question in your spoken language, as
&gt; opposed to Perl. Then all of a sudden things start making much more
&gt; sense.
&gt;
&gt; Cheers
&gt;
&gt;
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1266575/670625/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/670625">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.8k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1266577" href="/Public/Bug/Display.html?id=88923#txn-1266577">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;24&nbsp;08:29:22&nbsp;2013</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1266577/670627/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/670627">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 511b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Sep 24 08:04:16 2013, korjavin@gmail.com wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I want something like this:
&gt; 
&gt; select min&#40;os.regdt&#41;...
</div>
Then do so :&#41;

Instead of your original:

$order-&gt;search&#40; {...}, {
  order_by =&gt; { -desc =&gt; &#39;me.oid&#39; } },
  prefetch=&gt;&#39;pid&#39;,
  join =&gt; &#39;orderstatuses&#39;,
  &#39;+select&#39;=&gt; &#39;orderstatuses.regdt&#39;,
  &#39;+as&#39; =&gt; &#39;regdt&#39;,
}&#41;;

do

$order-&gt;search&#40; {...}, {
  order_by =&gt; { -desc =&gt; &#39;me.oid&#39; } },
  prefetch=&gt;&#39;pid&#39;,
  join =&gt; &#39;orderstatuses&#39;,
  &#39;+columns&#39; =&gt; { regdt =&gt; { min =&gt; &#39;orderstatuses.regdt&#39; } },
}&#41;;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1266580" href="/Public/Bug/Display.html?id=88923#txn-1266580">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;24&nbsp;08:42:56&nbsp;2013</span>
    <span class="description">korjavin [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #88923] Problem &#34;Result collapse not possible - selection from a has_many source redirected to the main&#34; after update 0.08196-3 =&gt; 0.08250-1</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 24 Sep 2013 18:42:39 +0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ivan Korjavin &lt;korjavin [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1266580/670631/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/670631">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 762b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Yeaah!!
This and group_by =&gt; &#39;me.oid &#39; , and it works perfect!

Thank you!



2013/9/24 Peter Rabbitson via RT &lt;bug-DBIx-Class@rt.cpan.org&gt;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=88923">https://rt.cpan.org/Ticket/Display.html?id=88923</a></span> &gt;
&gt;
&gt; On Tue Sep 24 08:04:16 2013, korjavin@gmail.com wrote:
&gt;
<div class="message-stanza open">&gt; &gt; I want something like this:
&gt; &gt;
&gt; &gt; select min&#40;os.regdt&#41;...
</div>&gt;
&gt; Then do so :&#41;
&gt;
&gt; Instead of your original:
&gt;
&gt; $order-&gt;search&#40; {...}, {
&gt;   order_by =&gt; { -desc =&gt; &#39;me.oid&#39; } },
&gt;   prefetch=&gt;&#39;pid&#39;,
&gt;   join =&gt; &#39;orderstatuses&#39;,
&gt;   &#39;+select&#39;=&gt; &#39;orderstatuses.regdt&#39;,
&gt;   &#39;+as&#39; =&gt; &#39;regdt&#39;,
&gt; }&#41;;
&gt;
&gt; do
&gt;
&gt; $order-&gt;search&#40; {...}, {
&gt;   order_by =&gt; { -desc =&gt; &#39;me.oid&#39; } },
&gt;   prefetch=&gt;&#39;pid&#39;,
&gt;   join =&gt; &#39;orderstatuses&#39;,
&gt;   &#39;+columns&#39; =&gt; { regdt =&gt; { min =&gt; &#39;orderstatuses.regdt&#39; } },
&gt; }&#41;;
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1266580/670632/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/670632">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.4k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.595658</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
