<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #112580 for Archive-Zip: Problem setting newline</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #112580 for Archive-Zip: Problem setting newline</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Archive-Zip/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Archive-Zip/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Archive-Zip/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Archive-Zip/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Archive-Zip">Archive-Zip CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">112580</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Archive-Zip/Active/">Archive-Zip</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
daniel.smith [...] baesystems.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-2540-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-2541-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




image013.jpg<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1602229/856883/image013.jpg">
Mon Feb 29 15:29:30 2016 (1k) by daniel.smith [...] baesystems.com
</a>
</font></li>
</ul>


image014.jpg<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1602229/856884/image014.jpg">
Mon Feb 29 15:29:30 2016 (1.1k) by daniel.smith [...] baesystems.com
</a>
</font></li>
</ul>


image015.jpg<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1602229/856885/image015.jpg">
Mon Feb 29 15:29:30 2016 (1.1k) by daniel.smith [...] baesystems.com
</a>
</font></li>
</ul>


image016.jpg<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1602229/856886/image016.jpg">
Mon Feb 29 15:29:30 2016 (1.2k) by daniel.smith [...] baesystems.com
</a>
</font></li>
</ul>


image017.jpg<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1602229/856887/image017.jpg">
Mon Feb 29 15:29:30 2016 (1.2k) by daniel.smith [...] baesystems.com
</a>
</font></li>
</ul>


image018.jpg<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1602229/856888/image018.jpg">
Mon Feb 29 15:29:30 2016 (1.2k) by daniel.smith [...] baesystems.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;29&nbsp;15:29:30&nbsp;2016</span>
    <span class="description">daniel.smith [...] baesystems.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Problem setting newline</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 29 Feb 2016 20:29:07 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Archive-Zip [...] rt.cpan.org&#34; &lt;bug-Archive-Zip [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Smith, Daniel E &#40;UK&#41;&#34; &lt;daniel.smith [...] baesystems.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi, I have a problem with archive.zip::MemberRead and a suggested solution

I have a perl program which reads zip files that may have unix or windows line ends, I determine these by looking at the first 10000 characters and counting each type of line end. Then I need to set this up in archive::zip &#40;because otherwise it assumes the newline is determinable by the host machine type&#41;

There is the handy method MemberRead::SetLineEnd&#40;$eol_character&#41; which my script then calls, this method sets this internal global variable $nl to the supplied character

However this does not change the behaviour of MemberRead  because the internal line recognising regexp is cached in $self-&gt;{sep_as_re} inside the function input_record_separator, and this function is not called when $nl changes.

As a workaround I call the method input_record_separator&#40;&#39;&#39;&#41; manually after setting $nl up, but this also does not work on windows because it assumes that TWO $nls comprise an input record separator in the line:
Return &#34;&#40;?:$nl&#41;{2,}&#34;;

Therefore, as well as calling two methods to get one thing done I have had to hack the input_record_separator function so the line says:
Return &#34;&#40;?:$nl&#41;&#34;;

I recommend that archive.zip::member read should determine the line end character correctly at startup by looking at the first N characters in the file via e.g.:

My $buffer;
$first_10000_chars = $fh-&gt;read&#40;$buffer,10000&#41;;
And then:
If &#40;$first_10000_chars =~ /\015\012/&#41; {
$self-&gt;{eol_char} = &#34;015\012&#34;; #its a pc file
}elsif&#40; $first_10000_chars =~ /\015/&#41; {
$self-&gt;{eol_char} = &#34;/\015/&#34;; #its a mac file
}elsif &#40;$first_10000_chars =~ /\012/&#41; {
               $self-&gt;{eol_char} = &#34;/\012/&#34;; #its a unix file
}

And then the stored regex should be corrected:

$self-&gt;{eol_regexp} = qr/$eol_char/;

Hope that makes sense!

By the way, I am sorry I have sent this to Archive-zip, but member_read itself seems to have a lot of unresolved bugs so I thought a response was unlikely.


Daniel Smith
Radar Systems Engineer, Sampson
BAE Systems Maritime Services,
Newport Road,
Cowes,
Isle of Wight, PO31 8PF, UK
*: +44 &#40;0&#41; 198320 2937
*: daniel.smith@baesystems.com&lt;mailto:daniel.smith@baesystems.com&gt; / www.baesystems.com&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.baesystems.com/">http://www.baesystems.com/</a></span>&gt;

BAE Systems Surface Ships Limited
Registered Office: Warwick House, PO Box 87, Farnborough Aerospace Centre,
Farnborough, Hampshire, GU14 6YU, UK
Registered in England &#38; Wales, Registration No: 06160534
Connect with BAE Systems:  [cid:image001.gif@01D0355E.1F422190] &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://baes.podbean.com/">http://baes.podbean.com/</a></span>&gt;  [cid:image002.png@01D0355E.1F422190] &lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://www.facebook.com/BAESystemsplc">https://www.facebook.com/BAESystemsplc</a></span>&gt;  [cid:image003.png@01D0355E.1F422190] &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://twitter.com/BAES_MARITIME">http://twitter.com/BAES_MARITIME</a></span>&gt;  [cid:image004.png@01D0355E.1F422190] &lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://www.linkedin.com/company/5087279?trk=tyah&#38;trkInfo=tarId:1421833059327,tas:bae%20systems%20mar,idx:2-1-2">https://www.linkedin.com/company/5087279?trk=tyah&#38;trkInfo=tarId:1421833059327,tas:bae%20systems%20mar,idx:2-1-2</a></span>&gt;  [cid:image005.png@01D0355E.1F422190] &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.youtube.com/user/BAESystemsplc">http://www.youtube.com/user/BAESystemsplc</a></span>&gt;  [cid:image006.png@01D0355E.1F422190] &lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://plus.google.com/110790584610874995971">https://plus.google.com/110790584610874995971</a></span>&gt;  www.baesystems.com&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.baesystems.com/">http://www.baesystems.com/</a></span>&gt;
****************************************************************************
BAE SYSTEMS PROPRIETARY

This email and any attachments are confidential to the intended
recipient and may also be privileged. If you are not the intended
recipient please delete it from your system and notify the sender.
You should not copy it or use it for any purpose nor disclose or
distribute its contents to any other person.
****************************************************************************
</div></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1602229/856883/image013.jpg">Download image013.jpg</a><br />
<span class="downloadcontenttype">image/jpeg 1k</span>
</div>
<div class="messagebody">
<img alt="image013.jpg" title="image013.jpg" src="/Ticket/Attachment/1602229/856883/" /></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1602229/856884/image014.jpg">Download image014.jpg</a><br />
<span class="downloadcontenttype">image/jpeg 1.1k</span>
</div>
<div class="messagebody">
<img alt="image014.jpg" title="image014.jpg" src="/Ticket/Attachment/1602229/856884/" /></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1602229/856885/image015.jpg">Download image015.jpg</a><br />
<span class="downloadcontenttype">image/jpeg 1.1k</span>
</div>
<div class="messagebody">
<img alt="image015.jpg" title="image015.jpg" src="/Ticket/Attachment/1602229/856885/" /></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1602229/856886/image016.jpg">Download image016.jpg</a><br />
<span class="downloadcontenttype">image/jpeg 1.2k</span>
</div>
<div class="messagebody">
<img alt="image016.jpg" title="image016.jpg" src="/Ticket/Attachment/1602229/856886/" /></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1602229/856887/image017.jpg">Download image017.jpg</a><br />
<span class="downloadcontenttype">image/jpeg 1.2k</span>
</div>
<div class="messagebody">
<img alt="image017.jpg" title="image017.jpg" src="/Ticket/Attachment/1602229/856887/" /></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1602229/856888/image018.jpg">Download image018.jpg</a><br />
<span class="downloadcontenttype">image/jpeg 1.2k</span>
</div>
<div class="messagebody">
<img alt="image018.jpg" title="image018.jpg" src="/Ticket/Attachment/1602229/856888/" /></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
