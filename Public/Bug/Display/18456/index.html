<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #18456 for libnet: New options request for Net::SMTP to complete a DSN and AUTH support</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #18456 for libnet: New options request for Net::SMTP to complete a DSN and AUTH support</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/libnet/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/libnet/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/libnet/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/libnet/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/libnet">libnet CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">18456</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/libnet/Active/">libnet</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
Mark.Martinec [...] ijs.si

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-18284-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.19    </td>
  </tr>
  <tr id="CF-18285-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;30&nbsp;20:18:35&nbsp;2006</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> New options request for Net::SMTP to complete a DSN and AUTH support</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is a rather straightforward feature request to Net::SMTP  
&#40;from the author of a content filter amavisd-new, which relies  
heavily on Net::SMTP&#41;.  
  
Now that Postfix supports DSN and amavisd-new 2.4.0 does supports it  
too, a missing link is an option for recipient&#40;&#41; to set ORCPT in the 
RCPT TO command. Seems like DSN support was intended to be there, but 
the implementation stopped just short of this goal by forgetting a 
need for ORCPT, required by RFC 3461.  
  
Similarly, the support for RFC 2554 &#40;AUTH&#41; fell one short step short  
of the goal, by forgetting an option AUTH=submitter to MAIL FROM.  
  
I&#39;m attaching a patch which adds these missing options. I would be  
very happy if at least ORCPT would see its light in a forseeable  
future, as without it I can not claim that amavisd-new fully supports  
DSN.  
  
While at it, the patch adds one more option, which is ENVID.  
It is functionally equivalent to the option Envelope, but it does  
not do xtext encoding itself, instead it relies on the caller to  
supply correctly encoded value. &#40;the same approach I used for ORCPT&#41;.  
The reason is that the original recipient should preferably be passed  
through mailers unchanged, respecting the original submitter&#39;s wishes  
of xtext encoding characters which MAY but NEED NOT be encoded, and  
respecting upper/lowercase characters choice for hex digits. The use 
of option Envelope makes impossible to respect submitter&#39;s will and 
unnecessarily modifies envelope of passing mail. 
  
I see there are a couple of small changes to libnet on the author&#39;s  
CVS site, so this might be a good opportunity for a smallish  
maintenance release &#40;and keep customers happy:&#41;  
  
Best regards &#40;too Graham in particular&#41;,  
  Mark  
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> SMTP.pm.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- SMTP.pm~	Wed Jun 30 15:56:11 2004
+++ SMTP.pm	Fri Mar 31 01:58:26 2006
@@ -17,5 +17,5 @@
 use Net::Config;
 
-$VERSION = &#34;2.29&#34;;
+$VERSION = &#34;2.30&#34;;
 
 @ISA = qw&#40;Net::Cmd IO::Socket::INET&#41;;
@@ -300,5 +300,5 @@
       }
 
-     if&#40;defined&#40;$v = delete $opt{Envelope}&#41;&#41;
+     if&#40;defined&#40;$v = delete $opt{Envelope}&#41;&#41;  # xtext-encode here
       {
        if&#40;exists $esmtp-&gt;{DSN}&#41;
@@ -313,4 +313,32 @@
       }
 
+     if&#40;defined&#40;$v = delete $opt{ENVID}&#41;&#41;
+      {
+       # expected to be in a format as required by RFC 3461, xtext-encoded
+       if&#40;exists $esmtp-&gt;{DSN}&#41;
+        {
+	 $opts .= &#34; ENVID=$v&#34;
+        }
+       else
+        {
+	 carp &#39;Net::SMTP::mail: DSN option not supported by host&#39;;
+        }
+      }
+
+     if&#40;defined&#40;$v = delete $opt{AUTH}&#41;&#41;
+      {
+       # expected to be in a format as required by RFC 2554,
+       # rfc2821-quoted and xtext-encoded, or &lt;&gt;
+       if&#40;exists $esmtp-&gt;{AUTH}&#41;
+        {
+	 $v = &#39;&lt;&gt;&#39;  if !defined&#40;$v&#41; || $v eq &#39;&#39;;
+	 $opts .= &#34; AUTH=$v&#34;
+        }
+       else
+        {
+	 carp &#39;Net::SMTP::mail: AUTH option not supported by host&#39;;
+        }
+      }
+
      if&#40;defined&#40;$v = delete $opt{XVERP}&#41;&#41;
       {
@@ -383,4 +411,17 @@
       }
 
+     if&#40;defined&#40;$v = delete $opt{ORCPT}&#41;&#41;
+      {
+       # expected to be in a format as required by RFC 3461, xtext-encoded 
+       if&#40;exists $esmtp-&gt;{DSN}&#41;
+        {
+	 $opts .= &#34; ORCPT=&#34; . $v;
+        }
+       else
+        {
+	 carp &#39;Net::SMTP::recipient: DSN option not supported by host&#39;;
+        }
+      }
+
      carp &#39;Net::SMTP::recipient: unknown option&#40;s&#41; &#39;
 		. join&#40;&#34; &#34;, keys %opt&#41;
@@ -709,6 +750,8 @@
  Bits        =&gt; &#34;7&#34; | &#34;8&#34; | &#34;binary&#34;
  Transaction =&gt; &lt;ADDRESS&gt;
- Envelope    =&gt; &lt;ENVID&gt;
+ Envelope    =&gt; &lt;ENVID&gt;     # xtext-encodes its argument
+ ENVID       =&gt; &lt;ENVID&gt;     # similar to Envelope, but expects argument encoded
  XVERP       =&gt; 1
+ AUTH        =&gt; &lt;submitter&gt; # encoded address according to RFC 2554
 
 The C&lt;Return&gt; and C&lt;Envelope&gt; parameters are used for DSN &#40;Delivery
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;09&nbsp;20:57:10&nbsp;2008</span>
    <span class="description">GBARR [...] CPAN.ORG -  Status changed from &#39;new&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
