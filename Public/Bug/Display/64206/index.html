<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #64206 for DBD-Oracle: Quoted table name breaks when rebinding LOBs</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #64206 for DBD-Oracle: Quoted table name breaks when rebinding LOBs</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DBD-Oracle/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DBD-Oracle/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DBD-Oracle/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DBD-Oracle/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/pythian/DBD-Oracle/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-Oracle">DBD-Oracle CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">64206</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DBD-Oracle/Active/">DBD-Oracle</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ARODLAND [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
ribasushi [...] leporine.io

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10192-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10193-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;24&nbsp;21:29:32&nbsp;2010</span>
    <span class="description">ARODLAND [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Quoted table name breaks when rebinding LOBs</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Running this code:

    my $sth = $dbh-&gt;prepare&#40;&#39;INSERT INTO &#34;bindtype_test&#34; &#40;&#34;id&#34;, &#34;blob&#34;&#41; 
VALUES &#40;?, ?&#41;&#39;&#41;;
    $sth-&gt;bind_param&#40;1, 3&#41;;
    $sth-&gt;bind_param&#40;2, &#39;abc&#39;, { ora_type =&gt; DBD::Oracle::ORA_BLOB&#40;&#41;, 
ora_field =&gt; &#39;blob&#39;} &#41;;
    $sth-&gt;execute;

gives this error:

    DBD::Oracle::st execute failed: ORA-01740: missing double quote in 
identifier
    ORA-01740: missing double quote in identifier &#40;DBD SUCCESS: 
OCIDescribeAny&#40;view&#41;/LOB refetch&#41; [for Statement &#34;INSERT INTO 
&#34;bindtype_test&#34; &#40;&#34;id&#34;, &#34;blob&#34;&#41; VALUES &#40;?, ?&#41;&#34; with ParamValues: :p1=3, 
:p2=&#39;abc&#39;] at ...

My interpretation on looking at the code is that init_lob_refetch calls 
find_ident_after to find the next thing after &#34;INSERT INTO&#34; to do 
introspection, and find_ident_after isn&#39;t handling quoted identifiers 
properly. Adding an additional debug print in init_lob_refetch to print 
tablename shows it as &#39;bindtype_test&#34;&#39; &#40;with trailing doublequote&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;24&nbsp;21:32:54&nbsp;2010</span>
    <span class="description">ribasushi [...] leporine.io -  Cc RIBASUSHI added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;25&nbsp;13:38:46&nbsp;2010</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Dec 24 21:29:32 2010, ARODLAND wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Running this code:
&gt; 
&gt;     my $sth = $dbh-&gt;prepare&#40;&#39;INSERT INTO &#34;bindtype_test&#34; &#40;&#34;id&#34;, &#34;blob&#34;&#41; 
&gt; VALUES &#40;?, ?&#41;&#39;&#41;;
&gt;     $sth-&gt;bind_param&#40;1, 3&#41;;
&gt;     $sth-&gt;bind_param&#40;2, &#39;abc&#39;, { ora_type =&gt; DBD::Oracle::ORA_BLOB&#40;&#41;, 
&gt; ora_field =&gt; &#39;blob&#39;} &#41;;
&gt;     $sth-&gt;execute;
&gt; 
&gt; gives this error:
&gt; 
&gt;     DBD::Oracle::st execute failed: ORA-01740: missing double quote in 
&gt; identifier
&gt;     ORA-01740: missing double quote in identifier &#40;DBD SUCCESS: 
&gt; OCIDescribeAny&#40;view&#41;/LOB refetch&#41; [for Statement &#34;INSERT INTO 
&gt; &#34;bindtype_test&#34; &#40;&#34;id&#34;, &#34;blob&#34;&#41; VALUES &#40;?, ?&#41;&#34; with ParamValues: :p1=3, 
&gt; :p2=&#39;abc&#39;] at ...
&gt; 
&gt; My interpretation on looking at the code is that init_lob_refetch calls 
&gt; find_ident_after to find the next thing after &#34;INSERT INTO&#34; to do 
&gt; introspection, and find_ident_after isn&#39;t handling quoted identifiers 
&gt; properly. Adding an additional debug print in init_lob_refetch to print 
&gt; tablename shows it as &#39;bindtype_test&#34;&#39; &#40;with trailing doublequote&#41;.
</div>
I didn&#39;t write the code at issue here and there are no comments in the
code to give us a clue if the code is supposed to maintain the quotes
around the table name or not. The following code is causing this:

char *
find_ident_after&#40;char *src, char *after, STRLEN *len, int copy&#41;
{

        int seen_key = 0;
        char *orig = src;
        char *p;
        while&#40;*src&#41;{
                if &#40;*src == &#39;\&#39;&#39;&#41; {
                        char delim = *src;
                        while&#40;*src &#38;&#38; *src != delim&#41; ++src;
                }
                else if &#40;*src == &#39;-&#39; &#38;&#38; src[1] == &#39;-&#39;&#41; {
                        while&#40;*src &#38;&#38; *src != &#39;\n&#39;&#41; ++src;
                }
                else if &#40;*src == &#39;/&#39; &#38;&#38; src[1] == &#39;*&#39;&#41; {
                        while&#40;*src &#38;&#38; !&#40;*src == &#39;*&#39; &#38;&#38; src[1]==&#39;/&#39;&#41;&#41; ++src;
                }
                else if &#40;isALPHA&#40;*src&#41;&#41; {
                        if &#40;seen_key&#41; {
      /* MJE the comparison with &#39;&#34;&#39; below includes your
       * trailing double quote */
                                char *start = src;
                                while&#40;*src &#38;&#38; &#40;isALNUM&#40;*src&#41; || *src==&#39;.&#39; || *src==&#39;$&#39; || *src==&#39;&#34;&#39;&#41;&#41;
                                        ++src;
                                *len = src - start;
                                if &#40;copy&#41; {
                                        p = &#40;char*&#41;alloc_via_sv&#40;*len, 0, 1&#41;;
                                        strncpy&#40;p, start, *len&#41;;
                                        p[*len] = &#39;\0&#39;;
                                        return p;
                                }
                                return start;
                        }
                        else if &#40;  toLOWER&#40;*src&#41;==toLOWER&#40;*after&#41;
                                        &#38;&#38; &#40;src==orig ? 1 : !isALPHA&#40;src[-1]&#41;&#41;&#41; {
                                p = after;
                                while&#40;*p &#38;&#38; *src &#38;&#38; toLOWER&#40;*p&#41;==toLOWER&#40;*src&#41;&#41;
                                        ++p, ++src;
                                if &#40;!*p&#41;
                                        seen_key = 1;
                        }
                        ++src;
                }
        else
                ++src;
        }
        return NULL;
}

Try deleting the

|| *src==&#39;&#34;&#39;

after my comment above. It&#39;s really down to whether the code is supposed
to deal with double quotes which I cannot see it can e.g.:

insert into &#34;fred&#34;.&#34;dave&#34; will do something similar and return fred&#34;.&#34;dave&#34;.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;25&nbsp;13:38:47&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;25&nbsp;14:25:15&nbsp;2010</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Test case from ribasushi:

use strict;
use warnings;

use DBI;

use Test::More;
use Test::Exception;

my $dbh = DBI-&gt;connect&#40;@ENV{map { &#34;DBICTEST_ORA_${_}&#34; }  qw/DSN USER
PASS/}, { AutoCommit =&gt; 1, RaiseError =&gt; 1 }&#41;;

$dbh-&gt;do&#40;&#39;DROP TABLE &#34;bindtype_test&#34;&#39;&#41;;
$dbh-&gt;do&#40;&#39;CREATE TABLE &#34;bindtype_test&#34; &#40;&#34;id&#34; integer NOT NULL, &#34;blob&#34;
blob NULL &#41;&#39;&#41;;

lives_ok {
  $dbh-&gt;prepare&#40;&#39;INSERT INTO &#34;bindtype_test&#34; &#40;&#34;id&#34;&#41; VALUES
&#40;?&#41;&#39;&#41;-&gt;execute&#40;1&#41;;
};

lives_ok {
  $dbh-&gt;prepare&#40;&#39;INSERT INTO &#34;bindtype_test&#34; &#40;&#34;id&#34;, &#34;blob&#34;&#41; VALUES &#40;?,
?&#41;&#39;&#41;-&gt;execute&#40;2, &#39;abc&#39;&#41;;
};

lives_ok {
  my $sth = $dbh-&gt;prepare&#40;&#39;INSERT INTO &#34;bindtype_test&#34; &#40;&#34;id&#34;, &#34;blob&#34;&#41;
VALUES &#40;?, ?&#41;&#39;&#41;;
  $sth-&gt;bind_param&#40;1, 3&#41;;
  $sth-&gt;bind_param&#40;2, &#39;abc&#39;, { ora_type =&gt; DBD::Oracle::ORA_BLOB&#40;&#41;,
ora_field =&gt; &#39;blob&#39;} &#41;;
  $sth-&gt;execute;
};

lives_ok {
  my $sth = $dbh-&gt;prepare&#40;&#39;INSERT INTO &#34;bindtype_test&#34; &#40;&#34;id&#34;, &#34;blob&#34;&#41;
VALUES &#40;?, ?&#41;&#39;&#41;;
  $sth-&gt;bind_param&#40;1, 4&#41;;
  $sth-&gt;bind_param&#40;2, &#39;abc&#39;, { ora_type =&gt; DBD::Oracle::ORA_BLOB&#40;&#41;,
ora_field =&gt; &#39;&#34;blob&#34;&#39;} &#41;;
  $sth-&gt;execute;
};



done_testing;




t/73oracle.t .. 
ok 1
ok 2
not ok 3
DBD::Oracle::st execute failed: ORA-01740: missing double quote in
identifier
ORA-01740: missing double quote in identifier &#40;DBD SUCCESS:
OCIDescribeAny&#40;view&#41;/LOB refetch&#41; [for Statement &#34;INSERT INTO
&#34;bindtype_test&#34; &#40;&#34;id&#34;, &#34;blob&#34;&#41; VALUES &#40;?, ?&#41;&#34; with ParamValues: :p1=3,
:p2=&#39;abc&#39;] at t/73oracle.t line 26.

#   Failed test at t/73oracle.t line 27.
# died: DBD::Oracle::st execute failed: ORA-01740: missing double quote
in identifier
# ORA-01740: missing double quote in identifier &#40;DBD SUCCESS:
OCIDescribeAny&#40;view&#41;/LOB refetch&#41; [for Statement &#34;INSERT INTO
&#34;bindtype_test&#34; &#40;&#34;id&#34;, &#34;blob&#34;&#41; VALUES &#40;?, ?&#41;&#34; with ParamValues: :p1=3,
:p2=&#39;abc&#39;] at t/73oracle.t line 26.
not ok 4
1..4
DBD::Oracle::st execute failed: ORA-01740: missing double quote in
identifier
ORA-01740: missing double quote in identifier &#40;DBD SUCCESS:
OCIDescribeAny&#40;view&#41;/LOB refetch&#41; [for Statement &#34;INSERT INTO
&#34;bindtype_test&#34; &#40;&#34;id&#34;, &#34;blob&#34;&#41; VALUES &#40;?, ?&#41;&#34; with ParamValues: :p1=4,
:p2=&#39;abc&#39;] at t/73oracle.t line 33.

#   Failed test at t/73oracle.t line 34.
# died: DBD::Oracle::st execute failed: ORA-01740: missing double quote
in identifier
# ORA-01740: missing double quote in identifier &#40;DBD SUCCESS:
OCIDescribeAny&#40;view&#41;/LOB refetch&#41; [for Statement &#34;INSERT INTO
&#34;bindtype_test&#34; &#40;&#34;id&#34;, &#34;blob&#34;&#41; VALUES &#40;?, ?&#41;&#34; with ParamValues: :p1=4,
:p2=&#39;abc&#39;] at t/73oracle.t line 33.
# Looks like you failed 2 tests of 4.
Dubious, test returned 2 &#40;wstat 512, 0x200&#41;
Failed 2/4 subtests 

Test Summary Report
-------------------
t/73oracle.t &#40;Wstat: 512 Tests: 4 Failed: 2&#41;
  Failed tests:  3-4
  Non-zero exit status: 2
Files=1, Tests=4,  1 wallclock secs &#40; 0.02 usr  0.01 sys +  0.32 cusr 
0.05 csys =  0.40 CPU&#41;
Result: FAIL

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;25&nbsp;16:39:03&nbsp;2010</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Dec 25 14:25:15 2010, MJEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Test case from ribasushi:
&gt; 
</div>&lt;Snipped test case&gt;

Interestingly when I use instant client 11.2 on Linux to Oracle 11 with
the test code above I get:

DBD::Oracle::st execute failed: ORA-01741: illegal zero-length identifier
ORA-01741: illegal zero-length identifier &#40;DBD SUCCESS:
OCIDescribeAny&#40;view&#41;/LOB
 refetch&#41; [for Statement &#34;INSERT INTO &#34;bindtype_test&#34; &#40;&#34;id&#34;, &#34;blob&#34;&#41;
VALUES &#40;?,
?&#41;&#34; with ParamValues: :p1=3, :p2=&#39;abc&#39;] at rt64206.pl line 28.

However, the table name still contains the trailing &#34;

Removing the trailing &#34; as I first suggested does not work:

DBD::Oracle::st execute failed: ORA-04043: object bindtype_test does not
exist &#40;
DBD SUCCESS: OCIDescribeAny&#40;view&#41;/LOB refetch&#41; [for Statement &#34;INSERT
INTO &#34;bind
type_test&#34; &#40;&#34;id&#34;, &#34;blob&#34;&#41; VALUES &#40;?, ?&#41;&#34; with ParamValues: :p1=3,
:p2=&#39;abc&#39;] at
rt64206.pl line 28.

so it obviously needs to keep the trailing quote but needs to pick up
the leading one too.

Changing the find_ident_after to:

                }
                else if &#40;isALPHA&#40;*src&#41; || &#40;*src == &#39;&#34;&#39;&#41;&#41; {
                        if &#40;seen_key&#41; {

gets the leading and trailing quote &#40;&#34;bindtype_test&#34;&#41; but for me leads to:

DBD::Oracle::st execute failed: ORA-00904: &#34;BLOB&#34;: invalid identifier
&#40;DBD ERROR
: error possibly near &lt;*&gt; indicator at char 12 in &#39;INSERT INTO
&lt;*&gt;&#34;bindtype_test
&#34; &#40;&#34;id&#34;, &#34;blob&#34;&#41; VALUES &#40;:p1, :p2&#41;&#39;&#41; [for Statement &#34;INSERT INTO
&#34;bindtype_test&#34;
 &#40;&#34;id&#34;, &#34;blob&#34;&#41; VALUES &#40;?, ?&#41;&#34; with ParamValues: :p1=3, :p2=&#39;abc&#39;] at
rt64206.pl
 line 28.

Rewriting the test code to avoid quoting on column names, renaming
column blob to ablob and using the change above runs through
successfully &#40;so long as you ignore the ora_field =&gt; &#39;&#34;blob&#34;&#39; which I
don&#39;t think would ever work, although I understand why it is in the test
code&#41;. So, an improvement but now quoting on column names is coming into it.

I suspect the column name issue is only with lobs and the column name
usage in ora_field. Oracle knows table &#34;bindtype_test&#34; means the table
with the exact name and case bindtype_test and with the change this
works. However, DBD::Oracle does not have the idea of maintaining case
in the ora_field value. Will need to look at how DBD::Oracle relates
ora_field to oracle.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;01&nbsp;06:31:34&nbsp;2011</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Addition to this ticket - it is now apparent that even *without*
specifying ora_field everything breaks anyway. Ideas? :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;22&nbsp;10:09:05&nbsp;2013</span>
    <span class="description">jonathan.stowe [...] db.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [rt.cpan.org #64206] Re: Quoted table name breaks when rebinding LOBs</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 22 Jul 2013 16:08:44 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;&#39;bug-DBD-Oracle [...] rt.cpan.org&#39;&#34; &lt;bug-DBD-Oracle [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jonathan Stowe &lt;jonathan.stowe [...] db.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Classification: Public
Hi,
Has anyone got any further with this?

It&#39;s manifesting itself with the default behaviour of DBIx::Class when writing to a LOB on Oracle,  we are seeing the
&#34;ORA-01741: illegal zero-length identifier &#40;DBD SUCCESS: OCIDescribeAny&#40;view&#41;/LOB refetch&#41;&#34; but that does seem to be consistent with how it is described as happening on the instance client.  &#40;with quote_names set to true anyway.&#41;

Thanks,

/J\



---
This e-mail may contain confidential and/or privileged information. If you are not the intended recipient &#40;or have received this e-mail in error&#41; please notify the sender immediately and delete this e-mail. Any unauthorized copying, disclosure or distribution of the material in this e-mail is strictly forbidden.

Please refer to <span class="clickylink"><a target="new" rel="nofollow" href="http://www.db.com/en/content/eu_disclosures.htm">http://www.db.com/en/content/eu_disclosures.htm</a></span> for additional EU corporate and regulatory disclosures.
</div></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;24&nbsp;15:39:53&nbsp;2013</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jul 22 10:09:05 2013, jonathan.stowe@db.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Classification: Public
&gt; Hi,
&gt; Has anyone got any further with this?
</div>
As I&#39;ve said before, I didn&#39;t write this code and there is nothing to indicate what it was supposed to do.

Quoting on column names seems simple but in reality it is a horrible issue.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It&#39;s manifesting itself with the default behaviour of DBIx::Class when
&gt;    writing to a LOB on Oracle,  we are seeing the
&gt; &#34;ORA-01741: illegal zero-length identifier &#40;DBD SUCCESS:
&gt;    OCIDescribeAny&#40;view&#41;/LOB refetch&#41;&#34; but that does seem to be
&gt;    consistent with how it is described as happening on the instance
&gt;    client.  &#40;with quote_names set to true anyway.&#41;
&gt; 
&gt; Thanks,
&gt; 
&gt; /J\
</div>
As far as I am aware this has only been reported wrt to DBIx::Class as no other code attempts to quote column names. DBIx::Class has its work cut out as DB engines tend to uppercase, lowercase or maintain case on unquoted column names depending on the database &#40;even ODBC has an attribute to see what the DB engine does&#41;.

I&#39;ve never used DBIx::Class.

I&#39;ve spent quite a bit of time on this in the past and not got much further since it is not clear what the existing code was intended to do and why DBIx::Class quotes column names.

You could try and persuade me this is worth looking at again but I&#39;m short of tuits right now and I&#39;d want some cooperation from Peter &#40;or whoever is coding DBIx::Class now, having seen Peter&#39;s recent blog post&#41;.

I&#39;m not trying to hide but this is a rather specific case it seems DBD::Oracle was never written to cope with.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;25&nbsp;02:33:42&nbsp;2013</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> ARODLAND [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #64206] Re: Quoted table name breaks when rebinding LOBs</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 25 Jul 2013 06:33:26 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;jonathan.stowe [...] db.com via RT&#34; &lt;bug-DBD-Oracle [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Rabbitson &lt;ribasushi [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, Jul 22, 2013 at 10:09:05AM -0400, jonathan.stowe@db.com via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=64206">https://rt.cpan.org/Ticket/Display.html?id=64206</a></span> &gt;
&gt; 
&gt; Classification: Public
&gt; Hi,
&gt; Has anyone got any further with this?
&gt; 
&gt; It&#39;s manifesting itself with the default behaviour of DBIx::Class when writing to a LOB on Oracle,  we are seeing the
</div>
Since fixing DBD::Oracle will prove very cumbersome, there was work done [1]
to use the native OCI calls &#40;$dbh-&gt;ora_lob_write&#41;. Unfortunately the 
work was... not of exceedingly high quality and the author never cared 
to clean up his act, even with the main set of problems clearly 
identified [2]. So for the time being this code lays in a branch ready 
for a white knight to take it further on.

Want to give it a stab &#40;note - not a walk in the pakr&#41;?

Cheers!

[1] <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/dbsrgits/dbix-class/commit/fcaccd73">https://github.com/dbsrgits/dbix-class/commit/fcaccd73</a></span>
[2] <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/dbsrgits/dbix-class/commit/2d1abdd3">https://github.com/dbsrgits/dbix-class/commit/2d1abdd3</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;25&nbsp;02:37:39&nbsp;2013</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> ARODLAND [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #64206] Quoted table name breaks when rebinding LOBs</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 25 Jul 2013 06:37:30 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Martin J Evans via RT &lt;bug-DBD-Oracle [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Rabbitson &lt;ribasushi [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, Jul 24, 2013 at 03:39:53PM -0400, Martin J Evans via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; DBIx::Class has its work cut out as DB engines tend to uppercase, 
&gt; lowercase or maintain case on unquoted column names depending on the 
&gt; database
</div>
Actually not really - when the user requests quoting we just quote. It 
is up to the user to ensure the column names in DBIC will make sense 
when quoted for that particular DBD.

And yes, we encourage quoting everything &#40;it&#39;s the sane thing to do&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; and I&#39;d want some cooperation from Peter &#40;or whoever is coding 
&gt; DBIx::Class now, having seen Peter&#39;s recent blog post&#41;.
</div>
I am still around for the time being ;&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;25&nbsp;14:28:20&nbsp;2013</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jul 25 02:33:42 2013, RIBASUSHI wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Since fixing DBD::Oracle will prove very cumbersome, there was work
&gt; done [1]
&gt;  to use the native OCI calls &#40;$dbh-&gt;ora_lob_write&#41;. Unfortunately the
&gt;  work was... not of exceedingly high quality and the author never
&gt; cared
&gt;  to clean up his act, even with the main set of problems clearly
&gt;  identified [2]. So for the time being this code lays in a branch
&gt; ready
&gt; for a white knight to take it further on.
&gt; 
&gt; Want to give it a stab &#40;note - not a walk in the pakr&#41;?
&gt; 
&gt; Cheers!
&gt; 
&gt; [1] <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/dbsrgits/dbix-class/commit/fcaccd73">https://github.com/dbsrgits/dbix-class/commit/fcaccd73</a></span>
&gt; [2] <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/dbsrgits/dbix-class/commit/2d1abdd3">https://github.com/dbsrgits/dbix-class/commit/2d1abdd3</a></span>
</div>
I left something on #dbi irc for you if you can catch up.

I&#39;m not &#34;white knight&#34; material right now and as I have never used DBIx::Class &#40;other than running its tests&#41; I&#39;ve no wish to scratch that itch.

I might be able to take another look at this rt but my fogged memory suggests quoted column names are going to be a PITA. DBD::Oracle was never written with that in mind and has next to no comments which help what code is written was meant to do.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;22&nbsp;14:38:25&nbsp;2019</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jul 25 14:28:20 2013, MJEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Jul 25 02:33:42 2013, RIBASUSHI wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; Since fixing DBD::Oracle will prove very cumbersome, there was work
&gt; &gt; done [1]
&gt; &gt;  to use the native OCI calls &#40;$dbh-&gt;ora_lob_write&#41;. Unfortunately the
&gt; &gt;  work was... not of exceedingly high quality and the author never
&gt; &gt; cared
&gt; &gt;  to clean up his act, even with the main set of problems clearly
&gt; &gt;  identified [2]. So for the time being this code lays in a branch
&gt; &gt; ready
&gt; &gt; for a white knight to take it further on.
&gt; &gt;
&gt; &gt; Want to give it a stab &#40;note - not a walk in the pakr&#41;?
&gt; &gt;
&gt; &gt; Cheers!
&gt; &gt;
&gt; &gt; [1] <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/dbsrgits/dbix-class/commit/fcaccd73">https://github.com/dbsrgits/dbix-class/commit/fcaccd73</a></span>
&gt; &gt; [2] <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/dbsrgits/dbix-class/commit/2d1abdd3">https://github.com/dbsrgits/dbix-class/commit/2d1abdd3</a></span>
</div>&gt; 
&gt; I left something on #dbi irc for you if you can catch up.
&gt; 
&gt; I&#39;m not &#34;white knight&#34; material right now and as I have never used
&gt; DBIx::Class &#40;other than running its tests&#41; I&#39;ve no wish to scratch
&gt; that itch.
&gt; 
&gt; I might be able to take another look at this rt but my fogged memory
&gt; suggests quoted column names are going to be a PITA. DBD::Oracle was
&gt; never written with that in mind and has next to no comments which help
&gt; what code is written was meant to do.
&gt; 
&gt; Martin
</div>
There is little to no chance of this being resolved as quoted table names are a WOP from a DBD perspective. Given that there are few contributors to DBD::Oracle these days and we&#39;ve moved to github &#40;and copying all this thread to github is a PITA&#41; I am going to close this issue. By all means open a github issue &#40;I can&#39;t stop you doing this&#41;. I am aware this might nark you you and I&#39;d understand why but if we are going to get some impetus going forward it is easier to concentrate on current issues and this one is VERY old.

Martin

-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;22&nbsp;14:38:26&nbsp;2019</span>
    <span class="description">bohica [...] ntlworld.com -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
