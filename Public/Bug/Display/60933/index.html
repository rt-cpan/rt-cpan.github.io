<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #60933 for CGI-Session: Support for cookie path and domain</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #60933 for CGI-Session: Support for cookie path and domain</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/CGI-Session/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/CGI-Session/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/CGI-Session/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/CGI-Session/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/CGI-Session">CGI-Session CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">60933</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/CGI-Session/Active/">CGI-Session</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
xavier.robin [...] bluewin.ch

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-5872-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-5873-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;01&nbsp;05:23:59&nbsp;2010</span>
    <span class="description">xavier.robin [...] bluewin.ch -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Support for cookie path and domain</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I need to configure the &#34;path&#34; of my session cookie. I&#39;m attaching a
patch to support it. The path defauts to / &#40;as currently&#41; but can be
redefined, as the name is.

I don&#39;t need it right now but support for the domain of the cookie is
also added in the patch.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Session.pm.diff</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- /usr/lib/perl5/site_perl/5.8.8/CGI/Session.pm.old  2010-08-31 16:46:48.000000000 +0200
+++ /usr/lib/perl5/site_perl/5.8.8/CGI/Session.pm  2010-09-01 10:47:27.000000000 +0200
@@ -9,6 +9,8 @@
 @CGI::Session::ISA      = qw&#40; CGI::Session::ErrorHandler &#41;;
 $CGI::Session::VERSION  = &#39;4.42&#39;;
 $CGI::Session::NAME     = &#39;CGISESSID&#39;;
+$CGI::Session::PATH     = &#39;/&#39;;
+$CGI::Session::DOMAIN     = undef;
 $CGI::Session::IP_MATCH = 0;

 sub STATUS_UNSET    &#40;&#41; { 1 &lt;&lt; 0 } # denotes session that&#39;s resetted
@@ -182,6 +184,34 @@
     return $CGI::Session::NAME;
 }

+sub path {
+    my $self = shift;
+
+    if &#40;ref $self&#41; {
+        unless &#40; @_ &#41; {
+            return $self-&gt;{_PATH} || $CGI::Session::PATH;
+        }
+        return $self-&gt;{_PATH} = $_[0];
+    }
+
+    $CGI::Session::PATH = $_[0] if @_;
+    return $CGI::Session::PATH;
+}
+
+sub domain {
+    my $self = shift;
+
+    if &#40;ref $self&#41; {
+        unless &#40; @_ &#41; {
+            return $self-&gt;{_DOMAIN} || $CGI::Session::DOMAIN;
+        }
+        return $self-&gt;{_DOMAIN} = $_[0];
+    }
+
+    $CGI::Session::DOMAIN = $_[0] if @_;
+    return $CGI::Session::DOMAIN;
+}
+

 sub dump {
     my $self = shift;
@@ -340,13 +370,28 @@
     my $cookie= undef;

     if &#40; $self-&gt;is_expired &#41; {
-        $cookie = $query-&gt;cookie&#40; -name=&gt;$self-&gt;name, -value=&gt;$self-&gt;id, -expires=&gt; &#39;-1d&#39;, @_ &#41;;
+        if &#40;defined $self-&gt;domain&#41; {
+            $cookie = $query-&gt;cookie&#40; -name=&gt;$self-&gt;name, -value=&gt;$self-&gt;id, -expires=&gt; &#39;-1d&#39;, -path=&gt;$self-&gt;path, -domain=&gt;$self-&gt;domain, @_ &#41;;
+        }
+        else {
+            $cookie = $query-&gt;cookie&#40; -name=&gt;$self-&gt;name, -value=&gt;$self-&gt;id, -expires=&gt; &#39;-1d&#39;, -path=&gt;$self-&gt;path, @_ &#41;;
+        }
     }
     elsif &#40; my $t = $self-&gt;expire &#41; {
-        $cookie = $query-&gt;cookie&#40; -name=&gt;$self-&gt;name, -value=&gt;$self-&gt;id, -expires=&gt; &#39;+&#39; . $t . &#39;s&#39;, @_ &#41;;
+        if &#40;defined $self-&gt;domain&#41; {
+            $cookie = $query-&gt;cookie&#40; -name=&gt;$self-&gt;name, -value=&gt;$self-&gt;id, -expires=&gt; &#39;+&#39; . $t . &#39;s&#39;, -path=&gt;$self-&gt;path, -domain=&gt;$self-&gt;domain, @_ &#41;;
+        }
+        else {
+            $cookie = $query-&gt;cookie&#40; -name=&gt;$self-&gt;name, -value=&gt;$self-&gt;id, -expires=&gt; &#39;+&#39; . $t . &#39;s&#39;, -path=&gt;$self-&gt;path, @_ &#41;;
+        }
     }
     else {
-        $cookie = $query-&gt;cookie&#40; -name=&gt;$self-&gt;name, -value=&gt;$self-&gt;id, @_ &#41;;
+        if &#40;defined $self-&gt;domain&#41; {
+            $cookie = $query-&gt;cookie&#40; -name=&gt;$self-&gt;name, -value=&gt;$self-&gt;id, -path=&gt;$self-&gt;path, -domain=&gt;$self-&gt;domain, @_ &#41;;
+        }
+        else {
+            $cookie = $query-&gt;cookie&#40; -name=&gt;$self-&gt;name, -value=&gt;$self-&gt;id, -path=&gt;$self-&gt;path, @_ &#41;;
+        }
     }
     return $cookie;
 }
@@ -1203,10 +1248,12 @@
 It will retrieve the name of the session cookie from C&lt;$session-&gt;name&#40;&#41;&gt; which defaults to C&lt;$CGI::Session::NAME&gt;. If you want to use a different name for your session cookie, do something like following before creating session object:

     CGI::Session-&gt;name&#40;&#34;MY_SID&#34;&#41;;
+    CGI::Session-&gt;path&#40;&#34;/my_path&#34;&#41;;
+    CGI::Session-&gt;path&#40;&#34;www.example.com&#34;&#41;;
     $session = CGI::Session-&gt;new&#40;undef, $cgi, \%attrs&#41;;

-Now, $session-&gt;header&#40;&#41; uses &#34;MY_SID&#34; as a name for the session cookie. For all additional options that can
-be passed, see the C&lt;header&#40;&#41;&gt; docs in L&lt;CGI&gt;.
+Now, $session-&gt;header&#40;&#41; uses &#34;MY_SID&#34; as a name for the session cookie, with &#34;/my_path&#34; as cookie path and &#34;www.example.com&#34; as domain.
+For all additional options that can be passed, see the C&lt;header&#40;&#41;&gt; docs in L&lt;CGI&gt;.

 =head2 query&#40;&#41;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;01&nbsp;09:13:08&nbsp;2010</span>
    <span class="description">mark [...] summersault.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #60933] Support for cookie path and domain</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 1 Sep 2010 09:12:53 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CGI-Session [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Stosberg &lt;mark [...] summersault.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I need to configure the &#34;path&#34; of my session cookie. I&#39;m attaching a
&gt; patch to support it. The path defauts to / &#40;as currently&#41; but can be
&gt; redefined, as the name is.
</div>
Hello Xavier,

Thanks for the feedback on CGI::Session, as well as the patch.

It&#39;s my opinion that CGI::Session should not do anything more with
cookie management.

It appears that your interest here is to set some easy defaults that are
used for all your cookies.  My suggestion for this to use a wrapper
layer, like the CGI::Application plugin that has a section for cookie
defaults:

<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~ceeshek/CGI-Application-Plugin-Session-1.03/lib/CGI/Application/Plugin/Session.pm#session_config">http://search.cpan.org/~ceeshek/CGI-Application-Plugin-Session-1.03/lib/CGI/Application/Plugin/Session.pm#session_config</a></span>

&#40; This is what I do myself to achieve the same goal. &#41; 

Or make your own tiny subclass that overrides the new, header&#40;&#41; or cookie
methods &#40;whichever you need&#41; so that your values are always set.

Just drop in your new method and call $self-&gt;SUPER::header&#40;&#41; &#40;or whatever&#41;
in your method, so that you only have add the small additional bits you
need, instead of rewriting a whole method.

In any case, I don&#39;t think we would add any more global variables in the
$CGI::Session:: name space. Those are no longer considered a best
practice.

I could be pursued otherwise if you wanted to discuss the topic on the
mailing list and gather support from some other users.

    Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;01&nbsp;09:13:10&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
