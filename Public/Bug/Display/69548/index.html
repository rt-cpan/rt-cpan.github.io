<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #69548 for DBIx-Class: Updating a table with a CLOB field causes SQL to take 40 seconds to execute</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #69548 for DBIx-Class: Updating a table with a CLOB field causes SQL to take 40 seconds to execute</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DBIx-Class/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DBIx-Class/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DBIx-Class/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DBIx-Class/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBIx-Class">DBIx-Class CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">69548</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DBIx-Class/Active/">DBIx-Class</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
gjtunley [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10410-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10411-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.08194    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;18&nbsp;10:21:07&nbsp;2011</span>
    <span class="description">gjtunley [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Updating a table with a CLOB field causes SQL to take 40 seconds to execute</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 18 Jul 2011 15:20:54 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gareth Tunley &lt;gjtunley [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I am trying to convert my code to use DBIx::Class instead of Class::DBI and
have hit the following issue.

I have a table defined in Oracle as follows:

CREATE TABLE transaction &#40;
    transaction_id        VARCHAR2&#40;50 BYTE&#41;,
    time_started        TIMESTAMP&#40;6&#41;,
    method_called        VARCHAR2&#40;50 BYTE&#41;,
    input_parameters    VARCHAR2&#40;4000 BYTE&#41;,
    return_value        CLOB,
    time_finished        TIMESTAMP&#40;6&#41;
&#41;;

ALTER TABLE transaction ADD CONSTRAINT pk_transaction PRIMARY KEY
&#40;transaction_id&#41;;
ALTER TABLE transaction ADD CONSTRAINT method_called_notnull CHECK
&#40;method_called IS NOT NULL&#41;;
ALTER TABLE transaction ADD CONSTRAINT transaction_time_notnull CHECK
&#40;time_started IS NOT NULL&#41;;

My code which inserts and selects rows works fine, but when I try to update
the table to populate the return_value and time_finished fields the SQL
executed takes over 40 seconds to run.

It only is affected when I do an update with the return_value column in the
update.

Here is the trace from DBIC_TRACE=1 &#40;annotated by me with the lines
beginning with #&#41;:

# Connect to database and set timestamp format
ALTER SESSION SET NLS_TIMESTAMP_FORMAT=&#39;DD/MM/YYYY HH24:MI:SS.FF&#39;:

# Check the transaction id doesn&#39;t already exist
SELECT me.transaction_id, me.time_started, me.method_called,
me.input_parameters, me.time_finished, me.return_value FROM transaction me
WHERE &#40; me.transaction_id = ? &#41; : &#39;10401-1310989565-79528&#39;

# Create the transaction record
BEGIN WORK
INSERT INTO transaction &#40; input_parameters, method_called, time_started,
transaction_id&#41; VALUES &#40; ?, ?, ?, ? &#41;: &#39;&lt;opt method=&#34;status&#34;
transactionid=&#34;10401-1310989565-79528&#34; /&gt;&#39;, &#39;System-&gt;status&#39;, &#39;18/07/2011
12:46:05.915440&#39;, &#39;10401-1310989565-79528&#39;
COMMIT

# ... do the actual work

# Find the transaction record to stop
SELECT me.transaction_id, me.time_started, me.method_called,
me.input_parameters, me.time_finished, me.return_value FROM transaction me
WHERE &#40; me.transaction_id = ? &#41; : &#39;10401-1310989565-79528&#39;

# Stop the transaction record
BEGIN WORK
UPDATE transaction SET return_value = ?, time_finished = ? WHERE &#40; &#40;
UTL_RAW.CAST_TO_VARCHAR2&#40;RAWTOHEX&#40;DBMS_LOB.SUBSTR&#40;transaction_id, 2000, 1&#41;&#41;&#41;
= ? &#41; &#41;: &#39;&lt;opt resultCode=&#34;200&#34; resultString=&#34;OK&#34;
transactionid=&#34;10401-1310989565-79528&#34; /&gt;&#39;, &#39;18/07/2011 12:46:05.947700&#39;,
&#39;10401-1310989565-79528&#39;
COMMIT

If I switch to updating the time_finished and return_value columns
separately then I see:

# Connect to database and set timestamp format
ALTER SESSION SET NLS_TIMESTAMP_FORMAT=&#39;DD/MM/YYYY HH24:MI:SS.FF&#39;:

# Check the transaction id doesn&#39;t already exist
SELECT me.transaction_id, me.time_started, me.method_called,
me.input_parameters, me.time_finished, me.return_value FROM transaction me
WHERE &#40; me.transaction_id = ? &#41; : &#39;8750-1310996465-76528&#39;

# Create the transaction record
BEGIN WORK
INSERT INTO transaction &#40; input_parameters, method_called, time_started,
transaction_id&#41; VALUES &#40; ?, ?, ?, ? &#41;: &#39;&lt;opt method=&#34;status&#34;
transactionid=&#34;8750-1310996465-76528&#34; /&gt;
&#39;, &#39;System-&gt;status&#39;, &#39;18/07/2011 14:41:05.962670&#39;, &#39;8750-1310996465-76528&#39;
COMMIT

# ... do the actual work

# Find the transaction record to stop
SELECT me.transaction_id, me.time_started, me.method_called,
me.input_parameters, me.time_finished, me.return_value FROM transaction me
WHERE &#40; me.transaction_id = ? &#41; : &#39;8750-1310996465-76528&#39;

# Set the time_finished - executes very quickly
BEGIN WORK
UPDATE transaction SET time_finished = ? WHERE &#40; transaction_id = ? &#41;:
&#39;18/07/2011 14:41:06.038030&#39;, &#39;8750-1310996465-76528&#39;
COMMIT

# Set the return_value - takes long time to execute
BEGIN WORK
UPDATE transaction SET return_value = ? WHERE &#40; &#40;
UTL_RAW.CAST_TO_VARCHAR2&#40;RAWTOHEX&#40;DBMS_LOB.SUBSTR&#40;transaction_id, 2000, 1&#41;&#41;&#41;
= ? &#41; &#41;: &#39;&lt;opt resultCode=&#34;200&#34; resultString=&#34;OK&#34;
transactionid=&#34;8750-1310996465-76528&#34; /&gt;&#39;, &#39;8750-1310996465-76528&#39;
COMMIT

Looking at the WHERE clause where the SQL takes a long time, it appears to
treating the transaction id as a LOB rather than the return_value column
which is the actual LOB value,

I am using Perl 5.14.0
DBIx::Class 0.08192
DBI 1.616
DBD::Oracle 1.28

Thanks

Gareth
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;18&nbsp;10:45:46&nbsp;2011</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69548] Updating a table with a CLOB field causes SQL to take 40 seconds to execute</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 18 Jul 2011 10:45:28 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Gareth Tunley via RT &lt;bug-DBIx-Class [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Rabbitson &lt;ribasushi [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, Jul 18, 2011 at 10:21:09AM -0400, Gareth Tunley via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Mon Jul 18 10:21:07 2011: Request 69548 was acted upon.
&gt; Transaction: Ticket created by gjtunley@gmail.com
&gt;        Queue: DBIx-Class
&gt;      Subject: Updating a table with a CLOB field causes SQL to take 40 seconds to execute
&gt;    Broken in: &#40;no value&#41;
&gt;     Severity: &#40;no value&#41;
&gt;        Owner: Nobody
&gt;   Requestors: gjtunley@gmail.com
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=69548">https://rt.cpan.org/Ticket/Display.html?id=69548</a></span> &gt;
&gt; 
&gt; 
&gt; Hi,
&gt; 
&gt; I am trying to convert my code to use DBIx::Class instead of Class::DBI and
&gt; have hit the following issue.
&gt; 
&gt; I have a table defined in Oracle as follows:
&gt; 
&gt; CREATE TABLE transaction &#40;
&gt;     transaction_id        VARCHAR2&#40;50 BYTE&#41;,
&gt;     time_started        TIMESTAMP&#40;6&#41;,
&gt;     method_called        VARCHAR2&#40;50 BYTE&#41;,
&gt;     input_parameters    VARCHAR2&#40;4000 BYTE&#41;,
&gt;     return_value        CLOB,
&gt;     time_finished        TIMESTAMP&#40;6&#41;
&gt; &#41;;
&gt; 
&gt; ALTER TABLE transaction ADD CONSTRAINT pk_transaction PRIMARY KEY
&gt; &#40;transaction_id&#41;;
&gt; ALTER TABLE transaction ADD CONSTRAINT method_called_notnull CHECK
&gt; &#40;method_called IS NOT NULL&#41;;
&gt; ALTER TABLE transaction ADD CONSTRAINT transaction_time_notnull CHECK
&gt; &#40;time_started IS NOT NULL&#41;;
&gt; 
&gt; My code which inserts and selects rows works fine, but when I try to update
&gt; the table to populate the return_value and time_finished fields the SQL
&gt; executed takes over 40 seconds to run.
&gt; 
&gt; ....
&gt; 
&gt; Looking at the WHERE clause where the SQL takes a long time, it appears to
&gt; treating the transaction id as a LOB rather than the return_value column
&gt; which is the actual LOB value,
&gt; 
&gt; I am using Perl 5.14.0
&gt; DBIx::Class 0.08192
&gt; DBI 1.616
&gt; DBD::Oracle 1.28
</div>
Please supply your Result class definition for the transaction table.

Cheers
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;18&nbsp;10:45:51&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;18&nbsp;10:47:06&nbsp;2011</span>
    <span class="description">gjtunley [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69548] Updating a table with a CLOB field causes SQL to take 40 seconds to execute</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 18 Jul 2011 15:46:52 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gareth Tunley &lt;gjtunley [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">package TransactionDBIx::Schema::Result::Transaction;

# Created by DBIx::Class::Schema::Loader
# DO NOT MODIFY THE FIRST PART OF THIS FILE

use strict;
use warnings;

use base &#39;DBIx::Class::Core&#39;;

=head1 NAME

TransactionDBIx::Schema::Result::Transaction

=cut

__PACKAGE__-&gt;table&#40;&#34;transaction&#34;&#41;;

=head1 ACCESSORS

=head2 transaction_id

  data_type: &#39;varchar2&#39;
  is_nullable: 0
  size: 50

=head2 time_started

  data_type: &#39;timestamp&#39;
  is_nullable: 0

=head2 method_called

  data_type: &#39;varchar2&#39;
  is_nullable: 0
  size: 50

=head2 input_parameters

  data_type: &#39;varchar2&#39;
  is_nullable: 1
  size: 4000

=head2 time_finished

  data_type: &#39;timestamp&#39;
  is_nullable: 1

=head2 return_value

  data_type: &#39;clob&#39;
  is_nullable: 1

=cut

__PACKAGE__-&gt;add_columns&#40;
  &#34;transaction_id&#34;,
  { data_type =&gt; &#34;varchar2&#34;, is_nullable =&gt; 0, size =&gt; 50 },
  &#34;time_started&#34;,
  { data_type =&gt; &#34;timestamp&#34;, is_nullable =&gt; 0 },
  &#34;method_called&#34;,
  { data_type =&gt; &#34;varchar2&#34;, is_nullable =&gt; 0, size =&gt; 50 },
  &#34;input_parameters&#34;,
  { data_type =&gt; &#34;varchar2&#34;, is_nullable =&gt; 1, size =&gt; 4000 },
  &#34;time_finished&#34;,
  { data_type =&gt; &#34;timestamp&#34;, is_nullable =&gt; 1 },
  &#34;return_value&#34;,
  { data_type =&gt; &#34;clob&#34;, is_nullable =&gt; 1 },
&#41;;
__PACKAGE__-&gt;set_primary_key&#40;&#34;transaction_id&#34;&#41;;


# Created by DBIx::Class::Schema::Loader v0.07010 @ 2011-07-16 23:08:00
# DO NOT MODIFY THIS OR ANYTHING ABOVE! md5sum:m7bpdyKU9UDpvSdQbhzrhw


# You can replace this text with custom code or comments, and it will be
preserved on regeneration

1;

Gareth

On 18 July 2011 15:45, Peter Rabbitson via RT &lt;bug-DBIx-Class@rt.cpan.org&gt;wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=69548">https://rt.cpan.org/Ticket/Display.html?id=69548</a></span> &gt;
&gt;
&gt; On Mon, Jul 18, 2011 at 10:21:09AM -0400, Gareth Tunley via RT wrote:
<div class="message-stanza open">&gt; &gt; Mon Jul 18 10:21:07 2011: Request 69548 was acted upon.
&gt; &gt; Transaction: Ticket created by gjtunley@gmail.com
&gt; &gt;        Queue: DBIx-Class
&gt; &gt;      Subject: Updating a table with a CLOB field causes SQL to take 40
</div>&gt; seconds to execute
<div class="message-stanza open">&gt; &gt;    Broken in: &#40;no value&#41;
&gt; &gt;     Severity: &#40;no value&#41;
&gt; &gt;        Owner: Nobody
&gt; &gt;   Requestors: gjtunley@gmail.com
&gt; &gt;       Status: new
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=69548">https://rt.cpan.org/Ticket/Display.html?id=69548</a></span> &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; Hi,
&gt; &gt;
&gt; &gt; I am trying to convert my code to use DBIx::Class instead of Class::DBI
</div>&gt; and
<div class="message-stanza open">&gt; &gt; have hit the following issue.
&gt; &gt;
&gt; &gt; I have a table defined in Oracle as follows:
&gt; &gt;
&gt; &gt; CREATE TABLE transaction &#40;
&gt; &gt;     transaction_id        VARCHAR2&#40;50 BYTE&#41;,
&gt; &gt;     time_started        TIMESTAMP&#40;6&#41;,
&gt; &gt;     method_called        VARCHAR2&#40;50 BYTE&#41;,
&gt; &gt;     input_parameters    VARCHAR2&#40;4000 BYTE&#41;,
&gt; &gt;     return_value        CLOB,
&gt; &gt;     time_finished        TIMESTAMP&#40;6&#41;
&gt; &gt; &#41;;
&gt; &gt;
&gt; &gt; ALTER TABLE transaction ADD CONSTRAINT pk_transaction PRIMARY KEY
&gt; &gt; &#40;transaction_id&#41;;
&gt; &gt; ALTER TABLE transaction ADD CONSTRAINT method_called_notnull CHECK
&gt; &gt; &#40;method_called IS NOT NULL&#41;;
&gt; &gt; ALTER TABLE transaction ADD CONSTRAINT transaction_time_notnull CHECK
&gt; &gt; &#40;time_started IS NOT NULL&#41;;
&gt; &gt;
&gt; &gt; My code which inserts and selects rows works fine, but when I try to
</div>&gt; update
<div class="message-stanza open">&gt; &gt; the table to populate the return_value and time_finished fields the SQL
&gt; &gt; executed takes over 40 seconds to run.
&gt; &gt;
&gt; &gt; ....
&gt; &gt;
&gt; &gt; Looking at the WHERE clause where the SQL takes a long time, it appears
</div>&gt; to
<div class="message-stanza open">&gt; &gt; treating the transaction id as a LOB rather than the return_value column
&gt; &gt; which is the actual LOB value,
&gt; &gt;
&gt; &gt; I am using Perl 5.14.0
&gt; &gt; DBIx::Class 0.08192
&gt; &gt; DBI 1.616
&gt; &gt; DBD::Oracle 1.28
</div>&gt;
&gt; Please supply your Result class definition for the transaction table.
&gt;
&gt; Cheers
&gt;
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;18&nbsp;11:04:53&nbsp;2011</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69548] Updating a table with a CLOB field causes SQL to take 40 seconds to execute</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 18 Jul 2011 11:04:37 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Gareth Tunley via RT &lt;bug-DBIx-Class [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Rabbitson &lt;ribasushi [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, Jul 18, 2011 at 10:21:09AM -0400, Gareth Tunley via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Mon Jul 18 10:21:07 2011: Request 69548 was acted upon.
&gt; Transaction: Ticket created by gjtunley@gmail.com
&gt;        Queue: DBIx-Class
&gt;      Subject: Updating a table with a CLOB field causes SQL to take 40 seconds to execute
&gt;    Broken in: &#40;no value&#41;
&gt;     Severity: &#40;no value&#41;
&gt;        Owner: Nobody
&gt;   Requestors: gjtunley@gmail.com
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=69548">https://rt.cpan.org/Ticket/Display.html?id=69548</a></span> &gt;
&gt; 
&gt; 
&gt; Hi,
&gt; 
&gt; I am trying to convert my code to use DBIx::Class instead of Class::DBI and
&gt; have hit the following issue.
&gt; 
&gt; I have a table defined in Oracle as follows:
&gt; 
&gt; CREATE TABLE transaction &#40;
&gt;     transaction_id        VARCHAR2&#40;50 BYTE&#41;,
&gt;     time_started        TIMESTAMP&#40;6&#41;,
&gt;     method_called        VARCHAR2&#40;50 BYTE&#41;,
&gt;     input_parameters    VARCHAR2&#40;4000 BYTE&#41;,
&gt;     return_value        CLOB,
&gt;     time_finished        TIMESTAMP&#40;6&#41;
&gt; &#41;;
&gt; 
&gt; ALTER TABLE transaction ADD CONSTRAINT pk_transaction PRIMARY KEY
&gt; &#40;transaction_id&#41;;
&gt; ALTER TABLE transaction ADD CONSTRAINT method_called_notnull CHECK
&gt; &#40;method_called IS NOT NULL&#41;;
&gt; ALTER TABLE transaction ADD CONSTRAINT transaction_time_notnull CHECK
&gt; &#40;time_started IS NOT NULL&#41;;
&gt; 
&gt; My code which inserts and selects rows works fine, but when I try to update
&gt; the table to populate the return_value and time_finished fields the SQL
&gt; executed takes over 40 seconds to run.
&gt; 
&gt; It only is affected when I do an update with the return_value column in the
&gt; update.
&gt; 
&gt; Here is the trace from DBIC_TRACE=1 &#40;annotated by me with the lines
&gt; beginning with #&#41;:
&gt; 
&gt; # Connect to database and set timestamp format
&gt; ALTER SESSION SET NLS_TIMESTAMP_FORMAT=&#39;DD/MM/YYYY HH24:MI:SS.FF&#39;:
&gt; 
&gt; # Check the transaction id doesn&#39;t already exist
&gt; SELECT me.transaction_id, me.time_started, me.method_called,
&gt; me.input_parameters, me.time_finished, me.return_value FROM transaction me
&gt; WHERE &#40; me.transaction_id = ? &#41; : &#39;10401-1310989565-79528&#39;
&gt; 
&gt; # Create the transaction record
&gt; BEGIN WORK
&gt; INSERT INTO transaction &#40; input_parameters, method_called, time_started,
&gt; transaction_id&#41; VALUES &#40; ?, ?, ?, ? &#41;: &#39;&lt;opt method=&#34;status&#34;
&gt; transactionid=&#34;10401-1310989565-79528&#34; /&gt;&#39;, &#39;System-&gt;status&#39;, &#39;18/07/2011
&gt; 12:46:05.915440&#39;, &#39;10401-1310989565-79528&#39;
&gt; COMMIT
&gt; 
&gt; # ... do the actual work
&gt; 
&gt; # Find the transaction record to stop
&gt; SELECT me.transaction_id, me.time_started, me.method_called,
&gt; me.input_parameters, me.time_finished, me.return_value FROM transaction me
&gt; WHERE &#40; me.transaction_id = ? &#41; : &#39;10401-1310989565-79528&#39;
&gt; 
&gt; # Stop the transaction record
&gt; BEGIN WORK
&gt; UPDATE transaction SET return_value = ?, time_finished = ? WHERE &#40; &#40;
&gt; UTL_RAW.CAST_TO_VARCHAR2&#40;RAWTOHEX&#40;DBMS_LOB.SUBSTR&#40;transaction_id, 2000, 1&#41;&#41;&#41;
&gt; = ? &#41; &#41;: &#39;&lt;opt resultCode=&#34;200&#34; resultString=&#34;OK&#34;
&gt; transactionid=&#34;10401-1310989565-79528&#34; /&gt;&#39;, &#39;18/07/2011 12:46:05.947700&#39;,
&gt; &#39;10401-1310989565-79528&#39;
&gt; COMMIT
</div>
^^ Also the exact DBIC update&#40;&#41; call that results in this &#40;note paraphrasing
is not sufficient&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;18&nbsp;11:21:08&nbsp;2011</span>
    <span class="description">rkitover [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Gareth,

I&#39;m not sure what&#39;s going on there, indeed it&#39;s doing the cast on the 
wrong column.

I&#39;d like to have a failing test, but that may be difficult to 
construct, so if you could make a small app with the DDL required in 
a .sql file and a small test script that demonstrates the problem, I 
would much appreciate it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;18&nbsp;12:31:01&nbsp;2011</span>
    <span class="description">rkitover [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Gareth,

I&#39;ve fixed the bug in the ora_lob_bug branch.

git://git.shadowcat.co.uk/dbsrgits/DBIx-Class.git

If the branch is gone that means we&#39;ve since merged to master.

Please try it out and let us know if it fixes your problem.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;18&nbsp;12:45:20&nbsp;2011</span>
    <span class="description">rkitover [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jul 18 12:31:01 2011, RKITOVER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Gareth,
&gt; 
&gt; I&#39;ve fixed the bug in the ora_lob_bug branch.
&gt; 
&gt; git://git.shadowcat.co.uk/dbsrgits/DBIx-Class.git
&gt; 
&gt; If the branch is gone that means we&#39;ve since merged to master.
&gt; 
&gt; Please try it out and let us know if it fixes your problem.
</div>
Sorry, branch is called people/caelum/ora_lob_bug, not ora_lob_bug, 
going to do a couple minor tweaks to it but should work.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;18&nbsp;15:24:21&nbsp;2011</span>
    <span class="description">gjtunley [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69548] Updating a table with a CLOB field causes SQL to take 40 seconds to execute</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 18 Jul 2011 20:24:09 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gareth Tunley &lt;gjtunley [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is the method which is doing the update:

sub _stopTransaction {
    my $self = shift;
    my $transactionid = shift;
    my $result = shift;

    # Get a log4perl instance
    my $log =
Log::Log4perl-&gt;get_logger&#40;$self-&gt;{_config}-&gt;{log4perl}-&gt;{logger}&#41;;

    # Get a connection to the database
    my $schema = $self-&gt;_getSchema&#40;$transactionid&#41;;

    # Find the record
    $transaction_record = $schema-&gt;resultset&#40;&#39;Transaction&#39;&#41;-&gt;find&#40;{
        transaction_id =&gt; $transactionid,
    }&#41;;

    # Mark the time finished, the response being returned to the caller
    $result = XMLout&#40;$result&#41;;
    chomp&#40;$result&#41;;

    $transaction_record-&gt;time_finished&#40;$self-&gt;_getCurrentTime&#40;&#41;&#41;;
    $transaction_record-&gt;return_value&#40;$result&#41;;

    my $error;

    # Commit the update to the database
    eval {
        $schema-&gt;txn_do&#40;sub{ $transaction_record-&gt;update; }&#41;;
    } or do {
        $error = $@;
    };

    # Did anything bad happen?
    if &#40;$error&#41; {
        # Yes - Log the fact that we have failed to commit and return the
fault
        $log-&gt;debug&#40;&#39;Failed to update the transaction record in the
database: &#39; . $error&#41;;
        $log-&gt;info&#40;&#34;$transactionid - FAIL: 1091 ERROR COMMITTING TRANSACTION
TO DATABASE\n&#34;&#41;;

        return&#40;{
            faultCode =&gt; 1091,
            faultString =&gt; &#39;FAIL: 1091 ERROR COMMITTING TRANSACTION TO
DATABASE&#39;,
            transactionid =&gt; $transactionid,
        }&#41;;
    }

    # Commit succeeded so log this and return
    $log-&gt;info&#40;&#34;$transactionid - Transaction request marked as
completed\n&#34;&#41;;

    return&#40;{
        resultCode =&gt; 200,
        resultString =&gt; &#39;OK&#39;,
        transactionid =&gt; $transactionid,
    }&#41;;
}


On 18 July 2011 16:04, Peter Rabbitson via RT &lt;bug-DBIx-Class@rt.cpan.org&gt;wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=69548">https://rt.cpan.org/Ticket/Display.html?id=69548</a></span> &gt;
&gt;
&gt; On Mon, Jul 18, 2011 at 10:21:09AM -0400, Gareth Tunley via RT wrote:
<div class="message-stanza open">&gt; &gt; Mon Jul 18 10:21:07 2011: Request 69548 was acted upon.
&gt; &gt; Transaction: Ticket created by gjtunley@gmail.com
&gt; &gt;        Queue: DBIx-Class
&gt; &gt;      Subject: Updating a table with a CLOB field causes SQL to take 40
</div>&gt; seconds to execute
<div class="message-stanza open">&gt; &gt;    Broken in: &#40;no value&#41;
&gt; &gt;     Severity: &#40;no value&#41;
&gt; &gt;        Owner: Nobody
&gt; &gt;   Requestors: gjtunley@gmail.com
&gt; &gt;       Status: new
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=69548">https://rt.cpan.org/Ticket/Display.html?id=69548</a></span> &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; Hi,
&gt; &gt;
&gt; &gt; I am trying to convert my code to use DBIx::Class instead of Class::DBI
</div>&gt; and
<div class="message-stanza open">&gt; &gt; have hit the following issue.
&gt; &gt;
&gt; &gt; I have a table defined in Oracle as follows:
&gt; &gt;
&gt; &gt; CREATE TABLE transaction &#40;
&gt; &gt;     transaction_id        VARCHAR2&#40;50 BYTE&#41;,
&gt; &gt;     time_started        TIMESTAMP&#40;6&#41;,
&gt; &gt;     method_called        VARCHAR2&#40;50 BYTE&#41;,
&gt; &gt;     input_parameters    VARCHAR2&#40;4000 BYTE&#41;,
&gt; &gt;     return_value        CLOB,
&gt; &gt;     time_finished        TIMESTAMP&#40;6&#41;
&gt; &gt; &#41;;
&gt; &gt;
&gt; &gt; ALTER TABLE transaction ADD CONSTRAINT pk_transaction PRIMARY KEY
&gt; &gt; &#40;transaction_id&#41;;
&gt; &gt; ALTER TABLE transaction ADD CONSTRAINT method_called_notnull CHECK
&gt; &gt; &#40;method_called IS NOT NULL&#41;;
&gt; &gt; ALTER TABLE transaction ADD CONSTRAINT transaction_time_notnull CHECK
&gt; &gt; &#40;time_started IS NOT NULL&#41;;
&gt; &gt;
&gt; &gt; My code which inserts and selects rows works fine, but when I try to
</div>&gt; update
<div class="message-stanza open">&gt; &gt; the table to populate the return_value and time_finished fields the SQL
&gt; &gt; executed takes over 40 seconds to run.
&gt; &gt;
&gt; &gt; It only is affected when I do an update with the return_value column in
</div>&gt; the
<div class="message-stanza open">&gt; &gt; update.
&gt; &gt;
&gt; &gt; Here is the trace from DBIC_TRACE=1 &#40;annotated by me with the lines
&gt; &gt; beginning with #&#41;:
&gt; &gt;
&gt; &gt; # Connect to database and set timestamp format
&gt; &gt; ALTER SESSION SET NLS_TIMESTAMP_FORMAT=&#39;DD/MM/YYYY HH24:MI:SS.FF&#39;:
&gt; &gt;
&gt; &gt; # Check the transaction id doesn&#39;t already exist
&gt; &gt; SELECT me.transaction_id, me.time_started, me.method_called,
&gt; &gt; me.input_parameters, me.time_finished, me.return_value FROM transaction
</div>&gt; me
<div class="message-stanza open">&gt; &gt; WHERE &#40; me.transaction_id = ? &#41; : &#39;10401-1310989565-79528&#39;
&gt; &gt;
&gt; &gt; # Create the transaction record
&gt; &gt; BEGIN WORK
&gt; &gt; INSERT INTO transaction &#40; input_parameters, method_called, time_started,
&gt; &gt; transaction_id&#41; VALUES &#40; ?, ?, ?, ? &#41;: &#39;&lt;opt method=&#34;status&#34;
&gt; &gt; transactionid=&#34;10401-1310989565-79528&#34; /&gt;&#39;, &#39;System-&gt;status&#39;, &#39;18/07/2011
&gt; &gt; 12:46:05.915440&#39;, &#39;10401-1310989565-79528&#39;
&gt; &gt; COMMIT
&gt; &gt;
&gt; &gt; # ... do the actual work
&gt; &gt;
&gt; &gt; # Find the transaction record to stop
&gt; &gt; SELECT me.transaction_id, me.time_started, me.method_called,
&gt; &gt; me.input_parameters, me.time_finished, me.return_value FROM transaction
</div>&gt; me
<div class="message-stanza open">&gt; &gt; WHERE &#40; me.transaction_id = ? &#41; : &#39;10401-1310989565-79528&#39;
&gt; &gt;
&gt; &gt; # Stop the transaction record
&gt; &gt; BEGIN WORK
&gt; &gt; UPDATE transaction SET return_value = ?, time_finished = ? WHERE &#40; &#40;
&gt; &gt; UTL_RAW.CAST_TO_VARCHAR2&#40;RAWTOHEX&#40;DBMS_LOB.SUBSTR&#40;transaction_id, 2000,
</div>&gt; 1&#41;&#41;&#41;
<div class="message-stanza open">&gt; &gt; = ? &#41; &#41;: &#39;&lt;opt resultCode=&#34;200&#34; resultString=&#34;OK&#34;
&gt; &gt; transactionid=&#34;10401-1310989565-79528&#34; /&gt;&#39;, &#39;18/07/2011 12:46:05.947700&#39;,
&gt; &gt; &#39;10401-1310989565-79528&#39;
&gt; &gt; COMMIT
</div>&gt;
&gt; ^^ Also the exact DBIC update&#40;&#41; call that results in this &#40;note
&gt; paraphrasing
&gt; is not sufficient&#41;
&gt;
&gt;
</div>

-- 
Gareth Tunley - gjtunley@gmail.com
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;18&nbsp;15:26:33&nbsp;2011</span>
    <span class="description">gjtunley [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69548] Updating a table with a CLOB field causes SQL to take 40 seconds to execute</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 18 Jul 2011 20:26:22 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gareth Tunley &lt;gjtunley [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">These are the helper methods called by the function sent in previous email:

sub _getCurrentTime {
    my $self = shift;

    # Set the timestamp format - used by DateTime::Format::Oracle
    local $ENV{NLS_TIMESTAMP_FORMAT} = &#39;DD/MM/YYYY HH24:MI:SS.FF&#39;;

    # Get the current time
    my $current_datetime = DateTime::HiRes-&gt;now&#40;&#41;;
    $current_datetime-&gt;set_time_zone&#40;&#39;Europe/London&#39;&#41;;

    # Return it as a string for use with Oracle
    return&#40;DateTime::Format::Oracle-&gt;format_timestamp&#40;$current_datetime&#41;&#41;;
}

sub _getSchema {
    my $self = shift;
    my $transactionid = shift;

    my $schema;

    # Get a log4perl instance
    my $log =
Log::Log4perl-&gt;get_logger&#40;$self-&gt;{_config}-&gt;{log4perl}-&gt;{logger}&#41;;

    # Do we have a connection to the database already
    if &#40;!$self-&gt;{schema}&#41; {
        # No - make a new connection
        $log-&gt;debug&#40;&#34;$transactionid - Making new database connection&#34;&#41;;

        $schema = TransactionDBIx::Schema-&gt;connect&#40;
            $self-&gt;{_config}-&gt;{transactiondb}-&gt;{dsn},
            $self-&gt;{_config}-&gt;{transactiondb}-&gt;{username},
            $self-&gt;{_config}-&gt;{transactiondb}-&gt;{password},
            {
                AutoCommit =&gt; 1,
                LongTruncOk =&gt; 1,
                LongReadLen =&gt; 524288,
            },
            {
                on_connect_do =&gt; &#34;ALTER SESSION SET
NLS_TIMESTAMP_FORMAT=&#39;DD/MM/YYYY HH24:MI:SS.FF&#39;&#34;,
            },
        &#41;;

        $self-&gt;{schema} = $schema;
    } else {
        # Yes - reuse existing connection
        $log-&gt;debug&#40;&#34;$transactionid - Reusing existing database
connection&#34;&#41;;
        $schema = $self-&gt;{schema};
    }

    # Return the schema object
    return&#40;$schema&#41;;
}


On 18 July 2011 16:04, Peter Rabbitson via RT &lt;bug-DBIx-Class@rt.cpan.org&gt;wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=69548">https://rt.cpan.org/Ticket/Display.html?id=69548</a></span> &gt;
&gt;
&gt; On Mon, Jul 18, 2011 at 10:21:09AM -0400, Gareth Tunley via RT wrote:
<div class="message-stanza open">&gt; &gt; Mon Jul 18 10:21:07 2011: Request 69548 was acted upon.
&gt; &gt; Transaction: Ticket created by gjtunley@gmail.com
&gt; &gt;        Queue: DBIx-Class
&gt; &gt;      Subject: Updating a table with a CLOB field causes SQL to take 40
</div>&gt; seconds to execute
<div class="message-stanza open">&gt; &gt;    Broken in: &#40;no value&#41;
&gt; &gt;     Severity: &#40;no value&#41;
&gt; &gt;        Owner: Nobody
&gt; &gt;   Requestors: gjtunley@gmail.com
&gt; &gt;       Status: new
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=69548">https://rt.cpan.org/Ticket/Display.html?id=69548</a></span> &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; Hi,
&gt; &gt;
&gt; &gt; I am trying to convert my code to use DBIx::Class instead of Class::DBI
</div>&gt; and
<div class="message-stanza open">&gt; &gt; have hit the following issue.
&gt; &gt;
&gt; &gt; I have a table defined in Oracle as follows:
&gt; &gt;
&gt; &gt; CREATE TABLE transaction &#40;
&gt; &gt;     transaction_id        VARCHAR2&#40;50 BYTE&#41;,
&gt; &gt;     time_started        TIMESTAMP&#40;6&#41;,
&gt; &gt;     method_called        VARCHAR2&#40;50 BYTE&#41;,
&gt; &gt;     input_parameters    VARCHAR2&#40;4000 BYTE&#41;,
&gt; &gt;     return_value        CLOB,
&gt; &gt;     time_finished        TIMESTAMP&#40;6&#41;
&gt; &gt; &#41;;
&gt; &gt;
&gt; &gt; ALTER TABLE transaction ADD CONSTRAINT pk_transaction PRIMARY KEY
&gt; &gt; &#40;transaction_id&#41;;
&gt; &gt; ALTER TABLE transaction ADD CONSTRAINT method_called_notnull CHECK
&gt; &gt; &#40;method_called IS NOT NULL&#41;;
&gt; &gt; ALTER TABLE transaction ADD CONSTRAINT transaction_time_notnull CHECK
&gt; &gt; &#40;time_started IS NOT NULL&#41;;
&gt; &gt;
&gt; &gt; My code which inserts and selects rows works fine, but when I try to
</div>&gt; update
<div class="message-stanza open">&gt; &gt; the table to populate the return_value and time_finished fields the SQL
&gt; &gt; executed takes over 40 seconds to run.
&gt; &gt;
&gt; &gt; It only is affected when I do an update with the return_value column in
</div>&gt; the
<div class="message-stanza open">&gt; &gt; update.
&gt; &gt;
&gt; &gt; Here is the trace from DBIC_TRACE=1 &#40;annotated by me with the lines
&gt; &gt; beginning with #&#41;:
&gt; &gt;
&gt; &gt; # Connect to database and set timestamp format
&gt; &gt; ALTER SESSION SET NLS_TIMESTAMP_FORMAT=&#39;DD/MM/YYYY HH24:MI:SS.FF&#39;:
&gt; &gt;
&gt; &gt; # Check the transaction id doesn&#39;t already exist
&gt; &gt; SELECT me.transaction_id, me.time_started, me.method_called,
&gt; &gt; me.input_parameters, me.time_finished, me.return_value FROM transaction
</div>&gt; me
<div class="message-stanza open">&gt; &gt; WHERE &#40; me.transaction_id = ? &#41; : &#39;10401-1310989565-79528&#39;
&gt; &gt;
&gt; &gt; # Create the transaction record
&gt; &gt; BEGIN WORK
&gt; &gt; INSERT INTO transaction &#40; input_parameters, method_called, time_started,
&gt; &gt; transaction_id&#41; VALUES &#40; ?, ?, ?, ? &#41;: &#39;&lt;opt method=&#34;status&#34;
&gt; &gt; transactionid=&#34;10401-1310989565-79528&#34; /&gt;&#39;, &#39;System-&gt;status&#39;, &#39;18/07/2011
&gt; &gt; 12:46:05.915440&#39;, &#39;10401-1310989565-79528&#39;
&gt; &gt; COMMIT
&gt; &gt;
&gt; &gt; # ... do the actual work
&gt; &gt;
&gt; &gt; # Find the transaction record to stop
&gt; &gt; SELECT me.transaction_id, me.time_started, me.method_called,
&gt; &gt; me.input_parameters, me.time_finished, me.return_value FROM transaction
</div>&gt; me
<div class="message-stanza open">&gt; &gt; WHERE &#40; me.transaction_id = ? &#41; : &#39;10401-1310989565-79528&#39;
&gt; &gt;
&gt; &gt; # Stop the transaction record
&gt; &gt; BEGIN WORK
&gt; &gt; UPDATE transaction SET return_value = ?, time_finished = ? WHERE &#40; &#40;
&gt; &gt; UTL_RAW.CAST_TO_VARCHAR2&#40;RAWTOHEX&#40;DBMS_LOB.SUBSTR&#40;transaction_id, 2000,
</div>&gt; 1&#41;&#41;&#41;
<div class="message-stanza open">&gt; &gt; = ? &#41; &#41;: &#39;&lt;opt resultCode=&#34;200&#34; resultString=&#34;OK&#34;
&gt; &gt; transactionid=&#34;10401-1310989565-79528&#34; /&gt;&#39;, &#39;18/07/2011 12:46:05.947700&#39;,
&gt; &gt; &#39;10401-1310989565-79528&#39;
&gt; &gt; COMMIT
</div>&gt;
&gt; ^^ Also the exact DBIC update&#40;&#41; call that results in this &#40;note
&gt; paraphrasing
&gt; is not sufficient&#41;
&gt;
&gt;
</div>

-- 
Gareth Tunley - gjtunley@gmail.com
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;18&nbsp;15:27:13&nbsp;2011</span>
    <span class="description">gjtunley [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69548] Updating a table with a CLOB field causes SQL to take 40 seconds to execute</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 18 Jul 2011 20:27:03 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gareth Tunley &lt;gjtunley [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sure I will try to do this tomorrow morning when I&#39;m back in the office.

Garetj

On 18 July 2011 16:21, Rafael Kitover via RT &lt;bug-DBIx-Class@rt.cpan.org&gt;wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=69548">https://rt.cpan.org/Ticket/Display.html?id=69548</a></span> &gt;
&gt;
&gt; Hi Gareth,
&gt;
&gt; I&#39;m not sure what&#39;s going on there, indeed it&#39;s doing the cast on the
&gt; wrong column.
&gt;
&gt; I&#39;d like to have a failing test, but that may be difficult to
&gt; construct, so if you could make a small app with the DDL required in
&gt; a .sql file and a small test script that demonstrates the problem, I
&gt; would much appreciate it.
&gt;
</div>


-- 
Gareth Tunley - gjtunley@gmail.com
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;18&nbsp;15:27:46&nbsp;2011</span>
    <span class="description">gjtunley [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69548] Updating a table with a CLOB field causes SQL to take 40 seconds to execute</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 18 Jul 2011 20:27:30 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gareth Tunley &lt;gjtunley [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">WOW that was fast - will give that a go tomorrow morning.

Thanks!

Gareth

On 18 July 2011 17:45, Rafael Kitover via RT &lt;bug-DBIx-Class@rt.cpan.org&gt;wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=69548">https://rt.cpan.org/Ticket/Display.html?id=69548</a></span> &gt;
&gt;
&gt; On Mon Jul 18 12:31:01 2011, RKITOVER wrote:
<div class="message-stanza open">&gt; &gt; Hi Gareth,
&gt; &gt;
&gt; &gt; I&#39;ve fixed the bug in the ora_lob_bug branch.
&gt; &gt;
&gt; &gt; git://git.shadowcat.co.uk/dbsrgits/DBIx-Class.git
&gt; &gt;
&gt; &gt; If the branch is gone that means we&#39;ve since merged to master.
&gt; &gt;
&gt; &gt; Please try it out and let us know if it fixes your problem.
</div>&gt;
&gt; Sorry, branch is called people/caelum/ora_lob_bug, not ora_lob_bug,
&gt; going to do a couple minor tweaks to it but should work.
&gt;
</div>


-- 
Gareth Tunley - gjtunley@gmail.com
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;19&nbsp;03:24:25&nbsp;2011</span>
    <span class="description">gjtunley [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69548] Updating a table with a CLOB field causes SQL to take 40 seconds to execute</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 19 Jul 2011 08:24:09 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gareth Tunley &lt;gjtunley [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Patch works perfectly.

Output from DBIC_TRACE:

# Connect to database and set timestamp format
ALTER SESSION SET NLS_TIMESTAMP_FORMAT=&#39;DD/MM/YYYY HH24:MI:SS.FF&#39;:

# Check transaction doesn&#39;t already exist in database
SELECT me.transaction_id, me.time_started, me.method_called,
me.input_parameters, me.time_finished, me.return_value FROM transaction me
WHERE &#40; me.transaction_id = ? &#41; : &#39;4830-1311060120-99557&#39;

# Insert it into the table
BEGIN WORK
INSERT INTO transaction &#40; input_parameters, method_called, time_started,
transaction_id&#41; VALUES &#40; ?, ?, ?, ? &#41;: &#39;&lt;opt method=&#34;status&#34;
transactionid=&#34;4830-1311060120-99557&#34; /&gt;&#39;, &#39;System-&gt;status&#39;, &#39;19/07/2011
08:22:01.325650&#39;, &#39;4830-1311060120-99557&#39;
COMMIT

# Do the work

# Retrieve the transaction record
SELECT me.transaction_id, me.time_started, me.method_called,
me.input_parameters, me.time_finished, me.return_value FROM transaction me
WHERE &#40; me.transaction_id = ? &#41; : &#39;4830-1311060120-99557&#39;

# Update with the result and commit
BEGIN WORK
UPDATE transaction SET return_value = ?, time_finished = ? WHERE &#40;
transaction_id = ? &#41;: &#39;&lt;opt resultCode=&#34;200&#34; resultString=&#34;OK&#34;
transactionid=&#34;4830-1311060120-99557&#34; /&gt;&#39;, &#39;19/07/2011 08:22:01.367730&#39;,
&#39;4830-1311060120-99557&#39;
COMMIT

Thanks!

Gareth

On 18 July 2011 17:45, Rafael Kitover via RT &lt;bug-DBIx-Class@rt.cpan.org&gt;wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=69548">https://rt.cpan.org/Ticket/Display.html?id=69548</a></span> &gt;
&gt;
&gt; On Mon Jul 18 12:31:01 2011, RKITOVER wrote:
<div class="message-stanza open">&gt; &gt; Hi Gareth,
&gt; &gt;
&gt; &gt; I&#39;ve fixed the bug in the ora_lob_bug branch.
&gt; &gt;
&gt; &gt; git://git.shadowcat.co.uk/dbsrgits/DBIx-Class.git
&gt; &gt;
&gt; &gt; If the branch is gone that means we&#39;ve since merged to master.
&gt; &gt;
&gt; &gt; Please try it out and let us know if it fixes your problem.
</div>&gt;
&gt; Sorry, branch is called people/caelum/ora_lob_bug, not ora_lob_bug,
&gt; going to do a couple minor tweaks to it but should work.
&gt;
</div>


-- 
Gareth Tunley - gjtunley@gmail.com
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;19&nbsp;07:57:09&nbsp;2011</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jul 19 03:24:25 2011, gjtunley@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Patch works perfectly.
&gt; 
</div>
Please test currnet master one more time &#40;not the branch&#41;. We changed
some of the  internal logic, but nothing should make a diff. to you.
This will ship as 0.08194 in about 15 minutes unless you say otherwise.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;19&nbsp;07:59:59&nbsp;2011</span>
    <span class="description">gjtunley [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69548] Updating a table with a CLOB field causes SQL to take 40 seconds to execute</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 19 Jul 2011 12:59:44 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gareth Tunley &lt;gjtunley [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Checking out now

On 19 July 2011 12:57, Peter Rabbitson via RT &lt;bug-DBIx-Class@rt.cpan.org&gt;wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=69548">https://rt.cpan.org/Ticket/Display.html?id=69548</a></span> &gt;
&gt;
&gt; On Tue Jul 19 03:24:25 2011, gjtunley@gmail.com wrote:
<div class="message-stanza open">&gt; &gt; Patch works perfectly.
&gt; &gt;
</div>&gt;
&gt; Please test currnet master one more time &#40;not the branch&#41;. We changed
&gt; some of the  internal logic, but nothing should make a diff. to you.
&gt; This will ship as 0.08194 in about 15 minutes unless you say otherwise.
&gt;
</div>


-- 
Gareth Tunley - gjtunley@gmail.com
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;19&nbsp;08:05:51&nbsp;2011</span>
    <span class="description">gjtunley [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69548] Updating a table with a CLOB field causes SQL to take 40 seconds to execute</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 19 Jul 2011 13:05:39 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gareth Tunley &lt;gjtunley [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Still appears to be working absolutely fine.

Thanks again.

Gareth

On 19 July 2011 12:59, Gareth Tunley &lt;gjtunley@gmail.com&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Checking out now
&gt;
&gt;
&gt; On 19 July 2011 12:57, Peter Rabbitson via RT &lt;bug-DBIx-Class@rt.cpan.org&gt;wrote:
&gt;
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=69548">https://rt.cpan.org/Ticket/Display.html?id=69548</a></span> &gt;
&gt;&gt;
&gt;&gt; On Tue Jul 19 03:24:25 2011, gjtunley@gmail.com wrote:
<div class="message-stanza open">&gt;&gt; &gt; Patch works perfectly.
&gt;&gt; &gt;
</div>&gt;&gt;
&gt;&gt; Please test currnet master one more time &#40;not the branch&#41;. We changed
&gt;&gt; some of the  internal logic, but nothing should make a diff. to you.
&gt;&gt; This will ship as 0.08194 in about 15 minutes unless you say otherwise.
&gt;&gt;
</div>&gt;
&gt;
&gt;
&gt; --
&gt; Gareth Tunley - gjtunley@gmail.com
&gt;
</div>


-- 
Gareth Tunley - gjtunley@gmail.com
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;19&nbsp;09:06:13&nbsp;2011</span>
    <span class="description">ribasushi [...] leporine.io -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;21&nbsp;06:24:56&nbsp;2011</span>
    <span class="description">ribasushi [...] leporine.io -  Status changed from &#39;patched&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;21&nbsp;06:24:56&nbsp;2011</span>
    <span class="description">ribasushi [...] leporine.io -  Fixed in 0.08194 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
