<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #60665 for Log-Log4perl: Not every file is properly recreated when a signal is received, with recreate_check_signal</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #60665 for Log-Log4perl: Not every file is properly recreated when a signal is received, with recreate_check_signal</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Log-Log4perl">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Log-Log4perl">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Log-Log4perl">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Log-Log4perl">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Log-Log4perl">Log-Log4perl CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">60665</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Log-Log4perl">Log-Log4perl</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ether [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-19484-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.29    </td>
  </tr>
  <tr id="CF-19485-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=60665">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-821491" href="/Public/Bug/Display.html?id=60665#txn-821491">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;23&nbsp;20:30:53&nbsp;2010</span>
    <span class="description">bitcard [...] froods.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Not every file is properly recreated when a signal is received,
 with recreate_check_signal</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/821491/425621/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/425621">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 569b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Log::Log4perl::Config::Watch is used to handle the appender config
&#39;recreate_check_signal&#39;, which sets up a signal handler to recreate a
file &#40;e.g. if it was rotated out&#41;.  However, it overwrites whatever
signal handler was there before. *Perl signal handlers are global* --
there is only one hash table to store them all.  Consequently, if there
is more than one file appender set up, only one of them will be
recreated on receipt of a signal.

I have fixed this issue &#40;with test cases&#41; in the &#39;signal_handling_bug&#39;
branch at <span class="clickylink"><a target="new" rel="nofollow" href="http://github.com/karenetheridge/log4perl">http://github.com/karenetheridge/log4perl</a></span>.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-822688" href="/Public/Bug/Display.html?id=60665#txn-822688">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;26&nbsp;00:45:16&nbsp;2010</span>
    <span class="description">MSCHILLI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/822688/426237/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/426237">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 368b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Karen,

thanks for the patch. It looks like this is indeed a problem but there&#39;s
an edge case where the solution won&#39;t work: $SIG{} entries can also be
set to strings like &#39;IGNORE&#39; or &#39;DEFAULT&#39; &#40;perldoc perlvar /SIG&#41;.

It&#39;d be easy to add a check/logic for that, but I wonder if there&#39;s a
cookbook recipe for handling multiple sig handlers in a cooperative way?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-822691" href="/Public/Bug/Display.html?id=60665#txn-822691">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;26&nbsp;00:45:16&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-822879" href="/Public/Bug/Display.html?id=60665#txn-822879">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;26&nbsp;12:06:35&nbsp;2010</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/822879/426350/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/426350">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 226b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Aug 26 00:45:16 2010, MSCHILLI wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It&#39;d be easy to add a check/logic for that, but I wonder if there&#39;s a
&gt; cookbook recipe for handling multiple sig handlers in a cooperative way?
</div>
Good point; I&#39;ll look into it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-824510" href="/Public/Bug/Display.html?id=60665#txn-824510">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;30&nbsp;13:37:24&nbsp;2010</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/824510/427139/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/427139">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Aug 25 21:45:16 2010, MSCHILLI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It&#39;d be easy to add a check/logic for that, but I wonder if there&#39;s a
&gt; cookbook recipe for handling multiple sig handlers in a cooperative way?
</div>
I&#39;ve done some inquiries and it appears that the only systems for
sharing signals like this are in big frameworks like AnyEvent or POE --
there is nothing if one doesn&#39;t make a lot of assumptions about the
environment Log::Log4perl is running in.

I&#39;ll keep looking around, but in the meantime I think the best we can do
is simply accommodate the cases where the signal handler is a string..
this is at least better than wiping out whatever handler&#40;s&#41; were there
before.

commit 12b902f163f8cad9ed869934d4282b8be62232e8
Author: Karen Etheridge &lt;ether@cpan.org&gt;
Date:   Fri Aug 27 11:46:31 2010 -0700

    don&#39;t attempt to call an old signal handler if it is a string like
&#34;IGNORE&#34; or &#34;DEFAULT&#34;.

diff --git a/lib/Log/Log4perl/Config/Watch.pm
b/lib/Log/Log4perl/Config/Watch.pm
index d8115e3..6ebb51f 100644
--- a/lib/Log/Log4perl/Config/Watch.pm
+++ b/lib/Log/Log4perl/Config/Watch.pm
@@ -35,7 +35,7 @@ sub new {
         $SIG{$self-&gt;{signal}} = sub {
             print &#34;Caught $self-&gt;{signal} signal\n&#34; if _INTERNAL_DEBUG;
             $self-&gt;force_next_check&#40;&#41;;
-            $old_sig_handler-&gt;&#40;@_&#41; if $old_sig_handler;
+            $old_sig_handler-&gt;&#40;@_&#41; if $old_sig_handler and ref
$old_sig_handler eq &#39;CODE&#39;;
         };
             # Reset the marker. The handler is going to modify it.
         $self-&gt;{signal_caught} = 0;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-824784" href="/Public/Bug/Display.html?id=60665#txn-824784">#</a>      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;31&nbsp;00:54:24&nbsp;2010</span>
    <span class="description">MSCHILLI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/824784/427276/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/427276">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 114b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Applied, thanks!

   
<span class="clickylink"><a target="new" rel="nofollow" href="http://github.com/mschilli/log4perl/commit/139c0d1619e5eb6cc8985f4b63e15cfb73248efe">http://github.com/mschilli/log4perl/commit/139c0d1619e5eb6cc8985f4b63e15cfb73248efe</a></span>

-- Mike
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-824787" href="/Public/Bug/Display.html?id=60665#txn-824787">#</a>      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;31&nbsp;00:54:27&nbsp;2010</span>
    <span class="description">MSCHILLI [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-842279" href="/Public/Bug/Display.html?id=60665#txn-842279">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;12&nbsp;17:08:05&nbsp;2010</span>
    <span class="description">RUZ_ADMIN -  Requestor ETHER added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people DelWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-842280" href="/Public/Bug/Display.html?id=60665#txn-842280">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;12&nbsp;17:08:05&nbsp;2010</span>
    <span class="description">RUZ_ADMIN -  Requestor bitcard@froods.org deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.432437</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
