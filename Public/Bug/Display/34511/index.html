<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #34511 for Net-DNS: provided hints overwritten</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #34511 for Net-DNS: provided hints overwritten</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Net-DNS">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Net-DNS">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Net-DNS">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Net-DNS">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-DNS">Net-DNS CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">34511</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Net-DNS">Net-DNS</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
MARKOV [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-22454-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-22455-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=34511">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-441057" href="/Public/Bug/Display.html?id=34511#txn-441057">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;28&nbsp;18:51:00&nbsp;2008</span>
    <span class="description">MARKOV [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> provided hints overwritten</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/441057/216111/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/216111">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 708b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">the ::Resolve::Recurse docs say

  $res-&gt;hints&#40;@ips&#41;;
  If no hints are passed, the default nameserver is asked for the hints.

However, the code does

  if &#40;!@hints &#38;&#38; $self-&gt;nameservers&#41; {
    $self-&gt;hints&#40;$self-&gt;nameservers&#41;;
  } else {
    $self-&gt;nameservers&#40;@hints&#41;;
  }

  $self-&gt;recurse&#40;1&#41;;
  my $packet=$self-&gt;query&#40;&#34;.&#34;, &#34;NS&#34;, &#34;IN&#34;&#41;;

If provided, the nameservers are set according to the hints, but the
routine is not terminated: there will still be a query for &#39;.&#39; which
overwrites the provided settings.  However, this will give a dangerous
recursion in the first part if the if &#40;which setting is not used&#41; 
Probably, it should just have been

  return $self-&gt;nameservers&#40;@hints&#41;
      if @hints;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Create even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-441064" href="/Public/Bug/Display.html?id=34511#txn-441064">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;28&nbsp;19:15:13&nbsp;2008</span>
    <span class="description">MARKOV [...] cpan.org - Ticket #34512:  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> No root IPs, still process continued</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/441064/216114/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/216114">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 660b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#40;still trying to figure-out why my root query does not return
IP-addresses, reporting weird things from ::Recurse&#41; 

sub hints&#40;&#41; ends like this:

  } else {
    warn &#34;Server [&#34;.&#40;$self-&gt;nameservers&#41;[0].&#34;] did not give answers&#34;;
  }

  # Disable recursion flag.


  return $self-&gt;nameservers&#40; map { @{ $_ } } values %{$self-&gt;{&#39;hints&#39;}}&#41;
 }

The comment is &#40;of course&#41; out-dated.  The warning is too weak: when no
hints where found, then the last call to &#34;nameservers&#34; will not set an
empty list, but ask for the current settings...

Also, it is very questionable whether
  &#40;$self-&gt;nameservers&#41;[0]
is really the responsible name-server answering on the &#39;.&#39; query.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-441197" href="/Public/Bug/Display.html?id=34511#txn-441197">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;29&nbsp;04:53:02&nbsp;2008</span>
    <span class="description">OLAF [...] cpan.org - Ticket #34512:  Merged into ticket #34511</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-441198" href="/Public/Bug/Display.html?id=34511#txn-441198">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;29&nbsp;04:53:02&nbsp;2008</span>
    <span class="description">OLAF [...] cpan.org -  Merged into ticket #34511</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-544958" href="/Public/Bug/Display.html?id=34511#txn-544958">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;17&nbsp;07:52:51&nbsp;2008</span>
    <span class="description">OLAF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/544958/274048/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/274048">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I am finally getting around to cleaning a bunch of bugs from the queue.

The problem that you encounter is there by design. The intention of the HINTS is to provide a 
list of root-servers. Since that data can be stale it is immediately refreshed by  authoritative 
data. In other words the hints are only there to provide a location where more authoritative 
data can be found.

If you want to force a certain nameserver to be used a better option is to use
$res-&gt;nameserver&#40;@list&#41;;


I did change the error message so it prints the IPs of all nameservers something like:
Servers [127.53.53.10 127.53.53.11 ] did not give answers at 
blib/lib/Net/DNS/Resolver/Recurse.pm line 86.



On Fri Mar 28 18:51:00 2008, MARKOV wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; the ::Resolve::Recurse docs say
&gt; 
&gt;   $res-&gt;hints&#40;@ips&#41;;
&gt;   If no hints are passed, the default nameserver is asked for the hints.
&gt; 
&gt; However, the code does
&gt; 
&gt;   if &#40;!@hints &#38;&#38; $self-&gt;nameservers&#41; {
&gt;     $self-&gt;hints&#40;$self-&gt;nameservers&#41;;
&gt;   } else {
&gt;     $self-&gt;nameservers&#40;@hints&#41;;
&gt;   }
&gt; 
&gt;   $self-&gt;recurse&#40;1&#41;;
&gt;   my $packet=$self-&gt;query&#40;&#34;.&#34;, &#34;NS&#34;, &#34;IN&#34;&#41;;
&gt; 
&gt; If provided, the nameservers are set according to the hints, but the
&gt; routine is not terminated: there will still be a query for &#39;.&#39; which
&gt; overwrites the provided settings.  However, this will give a dangerous
&gt; recursion in the first part if the if &#40;which setting is not used&#41; 
&gt; Probably, it should just have been
&gt; 
&gt;   return $self-&gt;nameservers&#40;@hints&#41;
&gt;       if @hints;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-544959" href="/Public/Bug/Display.html?id=34511#txn-544959">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;17&nbsp;07:52:52&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-544962" href="/Public/Bug/Display.html?id=34511#txn-544962">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;17&nbsp;07:52:53&nbsp;2008</span>
    <span class="description">OLAF [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-544964" href="/Public/Bug/Display.html?id=34511#txn-544964">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;17&nbsp;08:39:15&nbsp;2008</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #34511] provided hints overwritten</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 17 Dec 2008 14:39:01 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Olaf Kolkman via RT &lt;bug-Net-DNS [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/544964/274052/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/274052">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Olaf Kolkman via RT &#40;bug-Net-DNS@rt.cpan.org&#41; [081217 12:52]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=34511">https://rt.cpan.org/Ticket/Display.html?id=34511</a></span> &gt;
&gt; 
&gt; If you want to force a certain nameserver to be used a better option is to use
&gt; $res-&gt;nameserver&#40;@list&#41;;
</div>
The first part was a bug-report, which still needs to be addressed, I think.
The problem is that, if no hints are provided, but nameservers&#40;&#41; are set,
then the code after the block  &#40;starting with recurse&#40;1&#41;&#41; will be run
twice.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri Mar 28 18:51:00 2008, MARKOV wrote:
<div class="message-stanza open">&gt; &gt;   if &#40;!@hints &#38;&#38; $self-&gt;nameservers&#41; {
&gt; &gt;     $self-&gt;hints&#40;$self-&gt;nameservers&#41;;
&gt; &gt;   } else {
&gt; &gt;     $self-&gt;nameservers&#40;@hints&#41;;
&gt; &gt;   }
&gt; &gt; 
&gt; &gt;   $self-&gt;recurse&#40;1&#41;;
&gt; &gt;   my $packet=$self-&gt;query&#40;&#34;.&#34;, &#34;NS&#34;, &#34;IN&#34;&#41;;
</div></div>
So, probably the first five lines should be replaced by

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &gt;   return $self-&gt;nameservers&#40;@hints&#41;
&gt; &gt;       if @hints;
</div>
The second part of the bug-report &#40;about hints&#41; is answered sufficiently.
Thanks.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-544965" href="/Public/Bug/Display.html?id=34511#txn-544965">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;17&nbsp;08:39:16&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-545035" href="/Public/Bug/Display.html?id=34511#txn-545035">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;17&nbsp;09:59:16&nbsp;2008</span>
    <span class="description">OLAF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/545035/274097/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/274097">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Dec 17 08:39:15 2008, Mark@Overmeer.net wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; * Olaf Kolkman via RT &#40;bug-Net-DNS@rt.cpan.org&#41; [081217 12:52]:
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=34511">https://rt.cpan.org/Ticket/Display.html?id=34511</a></span> &gt;
&gt; &gt;
&gt; &gt; If you want to force a certain nameserver to be used a better option
</div>&gt; is to use
<div class="message-stanza open">&gt; &gt; $res-&gt;nameserver&#40;@list&#41;;
</div>&gt; 
&gt; The first part was a bug-report, which still needs to be addressed, I
&gt; think.
&gt; The problem is that, if no hints are provided, but nameservers&#40;&#41; are
&gt; set,
&gt; then the code after the block  &#40;starting with recurse&#40;1&#41;&#41; will be run
&gt; twice.
&gt; 
<div class="message-stanza open">&gt; &gt; On Fri Mar 28 18:51:00 2008, MARKOV wrote:
<div class="message-stanza open">&gt; &gt; &gt;   if &#40;!@hints &#38;&#38; $self-&gt;nameservers&#41; {
&gt; &gt; &gt;     $self-&gt;hints&#40;$self-&gt;nameservers&#41;;
&gt; &gt; &gt;   } else {
&gt; &gt; &gt;     $self-&gt;nameservers&#40;@hints&#41;;
&gt; &gt; &gt;   }
&gt; &gt; &gt;
&gt; &gt; &gt;   $self-&gt;recurse&#40;1&#41;;
&gt; &gt; &gt;   my $packet=$self-&gt;query&#40;&#34;.&#34;, &#34;NS&#34;, &#34;IN&#34;&#41;;
</div></div>&gt; 
&gt; So, probably the first five lines should be replaced by
&gt; 
<div class="message-stanza open">&gt; &gt; &gt;   return $self-&gt;nameservers&#40;@hints&#41;
&gt; &gt; &gt;       if @hints;
</div>&gt; 
</div>
That last suggestion does not really work as then the priming query would not happen.

Also the corner case where the nameservers are not set and the hints are not supplied does 
not work. In that case you need hardcoded servers.

I think this is the solution

Index: lib/Net/DNS/Resolver/Recurse.pm
=========================================================
==========
--- lib/Net/DNS/Resolver/Recurse.pm     &#40;revision 738&#41;
+++ lib/Net/DNS/Resolver/Recurse.pm     &#40;working copy&#41;
@@ -10,14 +10,40 @@
 $VERSION = &#40;qw$LastChangedRevision$&#41;[1];
 @ISA = qw&#40;Net::DNS::Resolver&#41;;
 
+
+my @hardcodedhints = qw &#40;
+198.41.0.4 
+192.58.128.30
+192.112.36.4
+202.12.27.33
+192.5.5.241
+128.63.2.53
+192.36.148.17
+192.33.4.12
+192.228.79.201
+199.7.83.42
+128.8.10.90
+193.0.14.129
+192.203.230.10
+2001:503:ba3e::2:30
+2001:500:2f::f
+2001:500:1::803f:235
+2001:503:c27::2:30
+2001:500:3::42
+2001:dc3::35
+&#41;;
+
 sub hints {
   my $self = shift;
   my @hints = @_;
   print &#34;;; hints&#40;@hints&#41;\n&#34; if $self-&gt;{&#39;debug&#39;};
-  if &#40;!@hints &#38;&#38; $self-&gt;nameservers&#41; {
-    $self-&gt;hints&#40;$self-&gt;nameservers&#41;;
+  
+  if &#40;!@hints &#38;&#38; !$self-&gt;nameservers&#41;{
+         return $self-&gt;hints&#40; @hardcodedhints &#41;
+  }elsif &#40;!@hints &#38;&#38; $self-&gt;nameservers&#41; {
+         return $self-&gt;hints&#40;$self-&gt;nameservers&#41;;
   } else {
-    $self-&gt;nameservers&#40;@hints&#41;;
+         $self-&gt;nameservers&#40;@hints&#41;;
   }
 
   print &#34;;; verifying &#40;root&#41; zone...\n&#34; if $self-&gt;{&#39;debug&#39;};
@@ -84,6 +110,9 @@
     }
   } else {
     warn &#34;Servers [&#34;. join &#34; &#34;,&#40;$self-&gt;nameservers&#41;,&#34;] did not give answers&#34;;
+    print &#34;;; Unsetting hints and nameservers, trying with hardcoded nameservers\n&#34; if  
$self-&gt;{&#39;debug&#39;};
+    print $self-&gt;nameservers&#40;[]&#41;;
+    return $self-&gt;hints&#40;&#41;;
   }
   
   # Disable recursion flag.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-545208" href="/Public/Bug/Display.html?id=34511#txn-545208">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;17&nbsp;17:54:06&nbsp;2008</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #34511] provided hints overwritten</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 17 Dec 2008 23:53:54 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Olaf Kolkman via RT &lt;bug-Net-DNS [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/545208/274194/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/274194">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 751b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Olaf Kolkman via RT &#40;bug-Net-DNS@rt.cpan.org&#41; [081217 14:59]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=34511">https://rt.cpan.org/Ticket/Display.html?id=34511</a></span> &gt;
&gt; -  if &#40;!@hints &#38;&#38; $self-&gt;nameservers&#41; {
&gt; -    $self-&gt;hints&#40;$self-&gt;nameservers&#41;;
&gt; +  
&gt; +  if &#40;!@hints &#38;&#38; !$self-&gt;nameservers&#41;{
&gt; +       return $self-&gt;hints&#40; @hardcodedhints &#41;
</div>
Yep, the &#34;return&#34; was exactly what was needed.  I cannot tell whether
the rest is needed... but the flow is logical.
-- 
Bedankt Olaf!
               MarkOv

------------------------------------------------------------------------
drs Mark A.C.J. Overmeer                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-545224" href="/Public/Bug/Display.html?id=34511#txn-545224">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;17&nbsp;18:21:38&nbsp;2008</span>
    <span class="description">OLAF [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.480758</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
