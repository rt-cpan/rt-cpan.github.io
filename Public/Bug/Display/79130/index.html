<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #79130 for Sys-SigAction: correct alarm handling is still mis-documented</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #79130 for Sys-SigAction: correct alarm handling is still mis-documented</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Sys-SigAction">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Sys-SigAction">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Sys-SigAction">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Sys-SigAction">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Sys-SigAction">Sys-SigAction CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">79130</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Sys-SigAction">Sys-SigAction</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">lab [...] lincolnbaxter.com.MAKE.ME.VALID
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
eponymousalias [...] yahoo.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-30604-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.15    </td>
  </tr>
  <tr id="CF-30605-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




alarm_test.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1111744/584627/alarm_test.pl">
Wed Aug 22 03:24:08 2012 (1.6k) by eponymousalias [...] yahoo.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=79130">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1111744" href="/Public/Bug/Display.html?id=79130#txn-1111744">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;22&nbsp;03:24:08&nbsp;2012</span>
    <span class="description">eponymousalias [...] yahoo.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> correct alarm handling is still mis-documented</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1111744/584626/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/584626">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The documentation for how to correctly handle alarms, protecting
against race conditions, is still incorrect in the Description
section of the CPAN page for this package &#40;reference bug
<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=50628">https://rt.cpan.org/Public/Bug/Display.html?id=50628</a></span> for the
original complaint, in an earlier release&#41;.  The second alarm&#40;0&#41;
call has to be placed within the outer eval{};, not after it, so
the local alarm handler is always still in play when the alarm
either goes off or is disabled.  &#40;And you&#39;re missing a semicolon
after the closing brace from the outer eval{};.&#41;

The attached alarm_test.pl script can be used to demonstrate the
race condition, by stretching out the region in which the failure
could occur so as to trigger the bug.  Read the comments in the
script, and try running it several times both with and without the
second call to alarm&#40;0&#41; commented out.  Observe the script failure
half the time, as caught and printed by the global alarm handler
whose usual absence would cause the script to die.

The actual code in the timeout_call&#40;&#41; routine seems to be
correctly implemented, always turning off the alarm while the
local alarm handler is still in play.  But the doc should be
upgraded to match, since users are likely to copy this pattern
into their own code without analyzing it too closely.

Also, in the Synopsis section of the doc, in the third code box,
there is no path through the code that would result in the alarm
still being active once the outer eval{}; is exited, so the
third alarm&#40;0&#41;; call is unnecessary.  That is to say, you cannot
get out of the outer eval{}; without the alarm either having
gone off while before it was disabled, in which case the third
alarm&#40;0&#41; won&#39;t do any good, or the alarm having been disabled by
the second alarm&#40;0&#41; call, the one within the outer eval{};, in
which case again the third alarm&#40;0&#41; is pointless.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> alarm_test.pl</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1111744/584627/alarm_test.pl">Download alarm_test.pl</a><br />
<span class="downloadcontenttype">text/x-perl 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl -w
$SIG{ALRM} = sub { die &#34;global timeout handler invoked&#34; };
sub sleep_or_die {
    if &#40;rand&#40;2&#41; &gt; 1&#41; {
	print &#34;before nap\n&#34;;
        sleep 4;
	print &#34;after nap\n&#34;;
    }
    else {
        die &#34;random death&#34;;
    }
}
eval {
    local $SIG{ALRM} = sub { die &#34;local timeout handler invoked&#34; };
    eval{
        alarm&#40;2&#41;;
	sleep_or_die&#40;&#41;;
	print &#34;before first alarm&#40;0&#41;\n&#34;;
	alarm&#40;0&#41;;
    };
    # This is where the second alarm&#40;0&#41; belongs, still within
    # the scope of the local SIGALRM handler, not outside of it.
    # Try running this program multiple times, both with and
    # without this alarm&#40;0&#41; in play.  Without it, if you get
    # a random death above, you will get the global timeout
    # handler called during the sleep below -- which means the
    # entire process would have died without that global handler,
    # which we have in place only for test/debug purposes here.
    # With this alarm&#40;0&#41; in play, a random death exits the inner
    # eval{} quickly without turning off the alarm, but this
    # next alarm&#40;0&#41; call does so while the local SIGALRM handler
    # is still in play, so the global handler is never in danger
    # of being called &#40;and the process won&#39;t die should it not
    # have such a handler in place&#41;.
    # alarm&#40;0&#41;;
    if &#40;$@&#41; {
	chomp $@;
	print &#34;inner eval exception:  $@\n&#34;
    }
};

# Lengthen this small processing window long enough to trigger
# the race condition if we got a random death above instead of
# sleeping then, and the second alarm&#40;0&#41; above is not in play.
print &#34;sleeping to widen the race-condition window\n&#34;;
sleep 4;

alarm &#40;0&#41;;
die &#34;outer eval exception:  $@&#34; if $@;
print &#34;still alive at the end\n&#34;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1238540" href="/Public/Bug/Display.html?id=79130#txn-1238540">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;21&nbsp;19:17:27&nbsp;2013</span>
    <span class="description">lab [...] lincolnbaxter.com.MAKE.ME.VALID -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1238540/654760/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/654760">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Aug 22 03:24:08 2012, eponymousalias@yahoo.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The documentation for how to correctly handle alarms, protecting
&gt; against race conditions, is still incorrect in the Description
&gt; section of the CPAN page for this package &#40;reference bug
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=50628">https://rt.cpan.org/Public/Bug/Display.html?id=50628</a></span> for the
&gt; original complaint, in an earlier release&#41;.  The second alarm&#40;0&#41;
&gt; call has to be placed within the outer eval{};, not after it, so
&gt; the local alarm handler is always still in play when the alarm
&gt; either goes off or is disabled.  &#40;And you&#39;re missing a semicolon
&gt; after the closing brace from the outer eval{};.&#41;
&gt; 
&gt; The attached alarm_test.pl script can be used to demonstrate the
&gt; race condition, by stretching out the region in which the failure
&gt; could occur so as to trigger the bug.  Read the comments in the
&gt; script, and try running it several times both with and without the
&gt; second call to alarm&#40;0&#41; commented out.  Observe the script failure
&gt; half the time, as caught and printed by the global alarm handler
&gt; whose usual absence would cause the script to die.
&gt; 
&gt; The actual code in the timeout_call&#40;&#41; routine seems to be
&gt; correctly implemented, always turning off the alarm while the
&gt; local alarm handler is still in play.  But the doc should be
&gt; upgraded to match, since users are likely to copy this pattern
&gt; into their own code without analyzing it too closely.
&gt; 
&gt; Also, in the Synopsis section of the doc, in the third code box,
&gt; there is no path through the code that would result in the alarm
&gt; still being active once the outer eval{}; is exited, so the
&gt; third alarm&#40;0&#41;; call is unnecessary.  That is to say, you cannot
&gt; get out of the outer eval{}; without the alarm either having
&gt; gone off while before it was disabled, in which case the third
&gt; alarm&#40;0&#41; won&#39;t do any good, or the alarm having been disabled by
&gt; the second alarm&#40;0&#41; call, the one within the outer eval{};, in
&gt; which case again the third alarm&#40;0&#41; is pointless.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1238541" href="/Public/Bug/Display.html?id=79130#txn-1238541">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;21&nbsp;19:17:28&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1238547" href="/Public/Bug/Display.html?id=79130#txn-1238547">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;21&nbsp;19:19:40&nbsp;2013</span>
    <span class="description">lab [...] lincolnbaxter.com.MAKE.ME.VALID -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1238547/654764/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/654764">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Aug 22 03:24:08 2012, eponymousalias@yahoo.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The documentation for how to correctly handle alarms, protecting
&gt; against race conditions, is still incorrect in the Description
&gt; section of the CPAN page for this package &#40;reference bug
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=50628">https://rt.cpan.org/Public/Bug/Display.html?id=50628</a></span> for the
&gt; original complaint, in an earlier release&#41;.  The second alarm&#40;0&#41;
&gt; call has to be placed within the outer eval{};, not after it, so
&gt; the local alarm handler is always still in play when the alarm
&gt; either goes off or is disabled.  &#40;And you&#39;re missing a semicolon
&gt; after the closing brace from the outer eval{};.&#41;
&gt; 
&gt; The attached alarm_test.pl script can be used to demonstrate the
&gt; race condition, by stretching out the region in which the failure
&gt; could occur so as to trigger the bug.  Read the comments in the
&gt; script, and try running it several times both with and without the
&gt; second call to alarm&#40;0&#41; commented out.  Observe the script failure
&gt; half the time, as caught and printed by the global alarm handler
&gt; whose usual absence would cause the script to die.
&gt; 
&gt; The actual code in the timeout_call&#40;&#41; routine seems to be
&gt; correctly implemented, always turning off the alarm while the
&gt; local alarm handler is still in play.  But the doc should be
&gt; upgraded to match, since users are likely to copy this pattern
&gt; into their own code without analyzing it too closely.
&gt; 
&gt; Also, in the Synopsis section of the doc, in the third code box,
&gt; there is no path through the code that would result in the alarm
&gt; still being active once the outer eval{}; is exited, so the
&gt; third alarm&#40;0&#41;; call is unnecessary.  That is to say, you cannot
&gt; get out of the outer eval{}; without the alarm either having
&gt; gone off while before it was disabled, in which case the third
&gt; alarm&#40;0&#41; won&#39;t do any good, or the alarm having been disabled by
&gt; the second alarm&#40;0&#41; call, the one within the outer eval{};, in
&gt; which case again the third alarm&#40;0&#41; is pointless.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1238549" href="/Public/Bug/Display.html?id=79130#txn-1238549">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;21&nbsp;19:19:40&nbsp;2013</span>
    <span class="description">lab [...] lincolnbaxter.com.MAKE.ME.VALID -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1239100" href="/Public/Bug/Display.html?id=79130#txn-1239100">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;22&nbsp;20:35:43&nbsp;2013</span>
    <span class="description">lab [...] lincolnbaxter.com.MAKE.ME.VALID -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1239100/655084/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/655084">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Jul 21 19:19:40 2013, LBAXTER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Aug 22 03:24:08 2012, eponymousalias@yahoo.com wrote:
<div class="message-stanza open">&gt; &gt; The documentation for how to correctly handle alarms, protecting
&gt; &gt; against race conditions, is still incorrect in the Description
&gt; &gt; section of the CPAN page for this package &#40;reference bug
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=50628">https://rt.cpan.org/Public/Bug/Display.html?id=50628</a></span> for the
&gt; &gt; original complaint, in an earlier release&#41;.  The second alarm&#40;0&#41;
&gt; &gt; call has to be placed within the outer eval{};, not after it, so
&gt; &gt; the local alarm handler is always still in play when the alarm
&gt; &gt; either goes off or is disabled.  &#40;And you&#39;re missing a semicolon
&gt; &gt; after the closing brace from the outer eval{};.&#41;
&gt; &gt; 
&gt; &gt; The attached alarm_test.pl script can be used to demonstrate the
&gt; &gt; race condition, by stretching out the region in which the failure
&gt; &gt; could occur so as to trigger the bug.  Read the comments in the
&gt; &gt; script, and try running it several times both with and without the
&gt; &gt; second call to alarm&#40;0&#41; commented out.  Observe the script failure
&gt; &gt; half the time, as caught and printed by the global alarm handler
&gt; &gt; whose usual absence would cause the script to die.
&gt; &gt; 
&gt; &gt; The actual code in the timeout_call&#40;&#41; routine seems to be
&gt; &gt; correctly implemented, always turning off the alarm while the
&gt; &gt; local alarm handler is still in play.  But the doc should be
&gt; &gt; upgraded to match, since users are likely to copy this pattern
&gt; &gt; into their own code without analyzing it too closely.
&gt; &gt; 
&gt; &gt; Also, in the Synopsis section of the doc, in the third code box,
&gt; &gt; there is no path through the code that would result in the alarm
&gt; &gt; still being active once the outer eval{}; is exited, so the
&gt; &gt; third alarm&#40;0&#41;; call is unnecessary.  That is to say, you cannot
&gt; &gt; get out of the outer eval{}; without the alarm either having
&gt; &gt; gone off while before it was disabled, in which case the third
&gt; &gt; alarm&#40;0&#41; won&#39;t do any good, or the alarm having been disabled by
&gt; &gt; the second alarm&#40;0&#41; call, the one within the outer eval{};, in
&gt; &gt; which case again the third alarm&#40;0&#41; is pointless.
</div>&gt; 
</div>
Found the mis-documentation, and it is fixed in version 0.17.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1239102" href="/Public/Bug/Display.html?id=79130#txn-1239102">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;22&nbsp;20:35:44&nbsp;2013</span>
    <span class="description">lab [...] lincolnbaxter.com.MAKE.ME.VALID -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.396636</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
