<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #104416 for DBD-ODBC: Problems using Impala ODBC library with Perl</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #104416 for DBD-ODBC: Problems using Impala ODBC library with Perl</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBD-ODBC">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBD-ODBC">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBD-ODBC">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBD-ODBC">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-ODBC">DBD-ODBC CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">104416</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBD-ODBC">DBD-ODBC</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
slagelwa [...] yahoo.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-10188-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.52    </td>
  </tr>
  <tr id="CF-10189-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




dbd.log<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1496564/797142/dbd.log">
Thu May 14 18:39:53 2015 (724b) by slagelwa [...] yahoo.com
</a>
</font></li>
</ul>


pass2_dbd.log<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1496796/797272/pass2_dbd.log">
Fri May 15 13:37:13 2015 (1.8k) by slagelwa [...] yahoo.com
</a>
</font></li>
</ul>


pass2_server.log<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1496796/797275/pass2_server.log">
Fri May 15 13:37:13 2015 (2.7k) by slagelwa [...] yahoo.com
</a>
</font></li>
</ul>


pass2_SimbaImpalaODBC_driver.log<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1496796/797273/pass2_SimbaImpalaODBC_driver.log">
Fri May 15 13:37:13 2015 (15.1k) by slagelwa [...] yahoo.com
</a>
</font></li>
</ul>


pass2_unixodbc.log<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1496796/797274/pass2_unixodbc.log">
Fri May 15 13:37:13 2015 (10.8k) by slagelwa [...] yahoo.com
</a>
</font></li>
</ul>


SimbaImpalaODBC_driver.log<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1496564/797143/SimbaImpalaODBC_driver.log">
Thu May 14 18:39:53 2015 (14k) by slagelwa [...] yahoo.com
</a>
</font></li>
</ul>


unixodbc.log<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1496564/797144/unixodbc.log">
Thu May 14 18:39:53 2015 (3.8k) by slagelwa [...] yahoo.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=104416">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1496005" href="/Public/Bug/Display.html?id=104416#txn-1496005">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;13&nbsp;18:47:13&nbsp;2015</span>
    <span class="description">slagelwa [...] yahoo.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Problems using Impala ODBC library with Perl</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1496005/796833/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/796833">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Considering that we have a bunch of scientists/programmers here that still use Perl and we&#39;re starting to use Cloudera CDH I thought I&#39;d try using DBD::ODBC with Impala&#39;s ODBC library.  Unfortunately I didn&#39;t get very far.  

First it didn&#39;t pick up the driver manager shared library properly.  I&#39;m using unixODBC &#40;64bit&#41; on CentOS and it defaulted to linking with -lodbc instead of -lodbc64.  Quick change of the Makefile and it compiled.

The next problem I encountered has to do with AutoCommit -- Impala doesn&#39;t support transactions and appears to be returning an error when SQLSetConnectAttr&#40;&#41;is called in post_connect&#40;&#41; to turn on AutoCommit.  There doesn&#39;t seem to be a way of avoiding this call and a Google search turned up two links with similar problems:

1&#41; A post on the impala-user Google Groups where a user was having a similar issue using an ETL tool, IBM datastage, which is also expecting to be able to set autocommit.

2&#41; A post on perlmonks about drivers not supporting autocommit and dbi requiring it. 

Commenting out the autocommit setting it then goes down in flames when it SQLGetInfo&#40;SQL_DRIVER_ODBC_VER&#41;, with tracing showing that the connection is closed.  Not sure where to take this next to try to get it working.

Anyhow I don&#39;t have a solution for this yet but I thought I&#39;d share.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1496089" href="/Public/Bug/Display.html?id=104416#txn-1496089">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;14&nbsp;06:01:18&nbsp;2015</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1496089/796875/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/796875">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed May 13 18:47:13 2015, JSLAGEL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Considering that we have a bunch of scientists/programmers here that
&gt; still use Perl and we&#39;re starting to use Cloudera CDH I thought I&#39;d
&gt; try using DBD::ODBC with Impala&#39;s ODBC library.  Unfortunately I
&gt; didn&#39;t get very far.
&gt; 
&gt; First it didn&#39;t pick up the driver manager shared library properly.
&gt; I&#39;m using unixODBC &#40;64bit&#41; on CentOS and it defaulted to linking with
&gt; -lodbc instead of -lodbc64.  Quick change of the Makefile and it
&gt; compiled.
&gt; 
&gt; The next problem I encountered has to do with AutoCommit -- Impala
&gt; doesn&#39;t support transactions and appears to be returning an error when
&gt; SQLSetConnectAttr&#40;&#41;is called in post_connect&#40;&#41; to turn on AutoCommit.
&gt; There doesn&#39;t seem to be a way of avoiding this call and a Google
&gt; search turned up two links with similar problems:
&gt; 
&gt; 1&#41; A post on the impala-user Google Groups where a user was having a
&gt; similar issue using an ETL tool, IBM datastage, which is also
&gt; expecting to be able to set autocommit.
&gt; 
&gt; 2&#41; A post on perlmonks about drivers not supporting autocommit and dbi
&gt; requiring it.
&gt; 
&gt; Commenting out the autocommit setting it then goes down in flames when
&gt; it SQLGetInfo&#40;SQL_DRIVER_ODBC_VER&#41;, with tracing showing that the
&gt; connection is closed.  Not sure where to take this next to try to get
&gt; it working.
&gt; 
&gt; Anyhow I don&#39;t have a solution for this yet but I thought I&#39;d share.
</div>
Assuming you&#39;ve got a recent DBI and DBD::ODBC could you set DBI_TRACE=DBD=x.log and export it. Then add the following to you odbcinst.ini file &#40;run odbcinst -j to locate it&#41;:

[ODBC]
Trace           = Yes
Tracefile               = /tmp/unixodbc.log

now run your script and post the x.log file and the unixodbc.log file.

Thanks

Martin


-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1496090" href="/Public/Bug/Display.html?id=104416#txn-1496090">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;14&nbsp;06:01:19&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1496564" href="/Public/Bug/Display.html?id=104416#txn-1496564">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;14&nbsp;18:39:53&nbsp;2015</span>
    <span class="description">slagelwa [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #104416] Problems using Impala ODBC library with Perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 14 May 2015 22:39:34 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-DBD-ODBC [...] rt.cpan.org&#34; &lt;bug-DBD-ODBC [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Joe S &lt;slagelwa [...] yahoo.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1496564/797140/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/797140">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks.Â  I captured the logs and in additional turned on impala loglevel tracing and included it.

     From: Martin J Evans via RT &lt;bug-DBD-ODBC@rt.cpan.org&gt;
 To: slagelwa@yahoo.com 
 Sent: Thursday, May 14, 2015 3:01 AM
 Subject: [rt.cpan.org #104416] Problems using Impala ODBC library with Perl
   
&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=104416">https://rt.cpan.org/Ticket/Display.html?id=104416</a></span> &gt;

On Wed May 13 18:47:13 2015, JSLAGEL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Considering that we have a bunch of scientists/programmers here that
&gt; still use Perl and we&#39;re starting to use Cloudera CDH I thought I&#39;d
&gt; try using DBD::ODBC with Impala&#39;s ODBC library.Â  Unfortunately I
&gt; didn&#39;t get very far.
&gt; 
&gt; First it didn&#39;t pick up the driver manager shared library properly.
&gt; I&#39;m using unixODBC &#40;64bit&#41; on CentOS and it defaulted to linking with
&gt; -lodbc instead of -lodbc64.Â  Quick change of the Makefile and it
&gt; compiled.
&gt; 
&gt; The next problem I encountered has to do with AutoCommit -- Impala
&gt; doesn&#39;t support transactions and appears to be returning an error when
&gt; SQLSetConnectAttr&#40;&#41;is called in post_connect&#40;&#41; to turn on AutoCommit.
&gt; There doesn&#39;t seem to be a way of avoiding this call and a Google
&gt; search turned up two links with similar problems:
&gt; 
&gt; 1&#41; A post on the impala-user Google Groups where a user was having a
&gt; similar issue using an ETL tool, IBM datastage, which is also
&gt; expecting to be able to set autocommit.
&gt; 
&gt; 2&#41; A post on perlmonks about drivers not supporting autocommit and dbi
&gt; requiring it.
&gt; 
&gt; Commenting out the autocommit setting it then goes down in flames when
&gt; it SQLGetInfo&#40;SQL_DRIVER_ODBC_VER&#41;, with tracing showing that the
&gt; connection is closed.Â  Not sure where to take this next to try to get
&gt; it working.
&gt; 
&gt; Anyhow I don&#39;t have a solution for this yet but I thought I&#39;d share.
</div>
Assuming you&#39;ve got a recent DBI and DBD::ODBC could you set DBI_TRACE=DBD=x.log and export it. Then add the following to you odbcinst.ini file &#40;run odbcinst -j to locate it&#41;:

[ODBC]
TraceÂ  Â  Â  Â  Â  = Yes
TracefileÂ  Â  Â  Â  Â  Â  Â  = /tmp/unixodbc.log

now run your script and post the x.log file and the unixodbc.log file.

Thanks

Martin


-- 
Martin J. Evans
Wetherby, UK


  
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1496564/797141/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/797141">with headers</a>
<br />
<span class="downloadcontenttype">text/html 3.5k</span>
</div>
<div class="messagebody">
</div>
</div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1496564/797142/dbd.log">Download dbd.log</a><br />
<span class="downloadcontenttype">invalid/octet-stream 724b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1496564/797143/SimbaImpalaODBC_driver.log">Download SimbaImpalaODBC_driver.log</a><br />
<span class="downloadcontenttype">invalid/octet-stream 14k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1496564/797144/unixodbc.log">Download unixodbc.log</a><br />
<span class="downloadcontenttype">invalid/octet-stream 3.8k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1496616" href="/Public/Bug/Display.html?id=104416#txn-1496616">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;15&nbsp;04:04:16&nbsp;2015</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1496616/797175/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/797175">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu May 14 18:39:53 2015, JSLAGEL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks.Â  I captured the logs and in additional turned on impala
&gt; loglevel tracing and included it.
</div>
There is not a lot I can do about the auto commit issue other than add a flag of some sort to say don&#39;t touch it.

The logs don&#39;t seem to tell me much, did they come from a stock DBD::ODBC as it still looks like it is trying to set autocommit and I thought you said you&#39;d commented that out.

The unixODBC log shows:

allocate an env handle
set ODBC 3
allocate a connection handle
successfully connect to DSN Cloudera64
call to get any connect diagnostics returned none
then a really suspicious:

[ODBC][24672][1431642910.716716][__handles.c][450]
                Exit:[SQL_SUCCESS]
                        Environment = 0x2f4d620

with no &#34;Entry&#34;.
set ODBC 3 on the env handle again
allocate a new connection handle
successfully connect to DSN Cloudera64
call to get any connection diagnostics returned none
then nothing!

The DBI log shows it errors attempting to turn autocommit on

I&#39;ll show the unixODBC log to Nick &#40;he wrote most of unixODBC&#41; when he gets in to work and see what he makes of it.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1496661" href="/Public/Bug/Display.html?id=104416#txn-1496661">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;15&nbsp;06:12:51&nbsp;2015</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1496661/797206/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/797206">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri May 15 04:04:16 2015, MJEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu May 14 18:39:53 2015, JSLAGEL wrote:
<div class="message-stanza open">&gt; &gt; Thanks.Â  I captured the logs and in additional turned on impala
&gt; &gt; loglevel tracing and included it.
</div>&gt; 
&gt; There is not a lot I can do about the auto commit issue other than add
&gt; a flag of some sort to say don&#39;t touch it.
&gt; 
&gt; The logs don&#39;t seem to tell me much, did they come from a stock
&gt; DBD::ODBC as it still looks like it is trying to set autocommit and I
&gt; thought you said you&#39;d commented that out.
&gt; 
&gt; The unixODBC log shows:
&gt; 
&gt; allocate an env handle
&gt; set ODBC 3
&gt; allocate a connection handle
&gt; successfully connect to DSN Cloudera64
&gt; call to get any connect diagnostics returned none
&gt; then a really suspicious:
&gt; 
&gt; [ODBC][24672][1431642910.716716][__handles.c][450]
&gt;                 Exit:[SQL_SUCCESS]
&gt;                         Environment = 0x2f4d620
</div>
I showed this to Nick and he said this is because the driver manager does not know if you want logging until you allocate an env handle so you get the exit but not the entry when allocating an env handle.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; with no &#34;Entry&#34;.
&gt; set ODBC 3 on the env handle again
&gt; allocate a new connection handle
&gt; successfully connect to DSN Cloudera64
&gt; call to get any connection diagnostics returned none
&gt; then nothing!
&gt; 
&gt; The DBI log shows it errors attempting to turn autocommit on
&gt; 
&gt; I&#39;ll show the unixODBC log to Nick &#40;he wrote most of unixODBC&#41; when he
&gt; gets in to work and see what he makes of it.
&gt; 
&gt; Martin
</div>
How did you disable the autocommit as the unixODBC log shows nothing about changing that attribute and there is not mention of any SQLGetInfo calls you mentioned but the DBI/DBD log suggests autocommit failed.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1496743" href="/Public/Bug/Display.html?id=104416#txn-1496743">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;15&nbsp;10:31:12&nbsp;2015</span>
    <span class="description">slagelwa [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #104416] Problems using Impala ODBC library with Perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 15 May 2015 14:30:56 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-DBD-ODBC [...] rt.cpan.org&#34; &lt;bug-DBD-ODBC [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Joe S &lt;slagelwa [...] yahoo.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1496743/797248/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/797248">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Many thanks for looking at this. For the logs I went with the latest stockÂ  DBI/DBD::ODBC instead of using the code where I had commented out the autocommit.Â  I&#39;ll regenerate the logs with the autocommit skipped.

 

     From: Martin J Evans via RT &lt;bug-DBD-ODBC@rt.cpan.org&gt;
 To: slagelwa@yahoo.com 
 Sent: Friday, May 15, 2015 3:12 AM
 Subject: [rt.cpan.org #104416] Problems using Impala ODBC library with Perl
   
&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=104416">https://rt.cpan.org/Ticket/Display.html?id=104416</a></span> &gt;

On Fri May 15 04:04:16 2015, MJEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu May 14 18:39:53 2015, JSLAGEL wrote:
<div class="message-stanza open">&gt; &gt; Thanks.Â  I captured the logs and in additional turned on impala
&gt; &gt; loglevel tracing and included it.
</div>&gt; 
&gt; There is not a lot I can do about the auto commit issue other than add
&gt; a flag of some sort to say don&#39;t touch it.
&gt; 
&gt; The logs don&#39;t seem to tell me much, did they come from a stock
&gt; DBD::ODBC as it still looks like it is trying to set autocommit and I
&gt; thought you said you&#39;d commented that out.
&gt; 
&gt; The unixODBC log shows:
&gt; 
&gt; allocate an env handle
&gt; set ODBC 3
&gt; allocate a connection handle
&gt; successfully connect to DSN Cloudera64
&gt; call to get any connect diagnostics returned none
&gt; then a really suspicious:
&gt; 
&gt; [ODBC][24672][1431642910.716716][__handles.c][450]
&gt;Â  Â  Â  Â  Â  Â  Â  Â  Exit:[SQL_SUCCESS]
&gt;Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Environment = 0x2f4d620
</div>
I showed this to Nick and he said this is because the driver manager does not know if you want logging until you allocate an env handle so you get the exit but not the entry when allocating an env handle.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; with no &#34;Entry&#34;.
&gt; set ODBC 3 on the env handle again
&gt; allocate a new connection handle
&gt; successfully connect to DSN Cloudera64
&gt; call to get any connection diagnostics returned none
&gt; then nothing!
&gt; 
&gt; The DBI log shows it errors attempting to turn autocommit on
&gt; 
&gt; I&#39;ll show the unixODBC log to Nick &#40;he wrote most of unixODBC&#41; when he
&gt; gets in to work and see what he makes of it.
&gt; 
&gt; Martin
</div>
How did you disable the autocommit as the unixODBC log shows nothing about changing that attribute and there is not mention of any SQLGetInfo calls you mentioned but the DBI/DBD log suggests autocommit failed.

Martin
-- 
Martin J. Evans
Wetherby, UK


  
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1496743/797249/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/797249">with headers</a>
<br />
<span class="downloadcontenttype">text/html 5k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1496748" href="/Public/Bug/Display.html?id=104416#txn-1496748">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;15&nbsp;11:11:54&nbsp;2015</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1496748/797254/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/797254">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 345b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri May 15 10:31:12 2015, JSLAGEL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Many thanks for looking at this. For the logs I went with the latest
&gt; stockÂ  DBI/DBD::ODBC instead of using the code where I had commented
&gt; out the autocommit.Â  I&#39;ll regenerate the logs with the autocommit
&gt; skipped.
</div>
Cheers, look forward to seeing them.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1496796" href="/Public/Bug/Display.html?id=104416#txn-1496796">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;15&nbsp;13:37:13&nbsp;2015</span>
    <span class="description">slagelwa [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #104416] Problems using Impala ODBC library with Perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 15 May 2015 17:36:55 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-DBD-ODBC [...] rt.cpan.org&#34; &lt;bug-DBD-ODBC [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Joe S &lt;slagelwa [...] yahoo.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1496796/797270/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/797270">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here&#39;s the next pass at the logs.Â Â  I commented out the call to SQLSetConnectAttr&#40;&#41; in the post_connect function of dbdimp.c.Â  The logs show that the subsequent SQLGetInfo&#40;&#41; calls all seem to fail.Â  I checked on the server side and I do see the connection come in and it executes a &#34;SHOW DATABASES&#34; &#40;I&#39;ve included this log too&#41;.Â  

Oh, I should also say I can connect using isql packaged with unixODBC64 and everything seems to function correctly.Â  

And lastly, I got pinged back on the impala-users mailing list and was told there&#39;s an option, EnableSimulatedTransactions=1, which should help with the AutoCommit.Â  Unfortunately that didn&#39;t seem to help the problem.Â  I&#39;m concerned that the driver log messages keep saying Invalid Connection handle on the subsequent SQLGetInfo&#40;&#41; calls...

-Joe

      From: Martin J Evans via RT &lt;bug-DBD-ODBC@rt.cpan.org&gt;
 To: slagelwa@yahoo.com 
 Sent: Friday, May 15, 2015 8:12 AM
 Subject: [rt.cpan.org #104416] Problems using Impala ODBC library with Perl
   
&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=104416">https://rt.cpan.org/Ticket/Display.html?id=104416</a></span> &gt;

On Fri May 15 10:31:12 2015, JSLAGEL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Many thanks for looking at this. For the logs I went with the latest
&gt; stockÂ  DBI/DBD::ODBC instead of using the code where I had commented
&gt; out the autocommit.Â  I&#39;ll regenerate the logs with the autocommit
&gt; skipped.
</div>
Cheers, look forward to seeing them.

Martin
-- 
Martin J. Evans
Wetherby, UK


  
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1496796/797271/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/797271">with headers</a>
<br />
<span class="downloadcontenttype">text/html 3.1k</span>
</div>
<div class="messagebody">
</div>
</div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1496796/797272/pass2_dbd.log">Download pass2_dbd.log</a><br />
<span class="downloadcontenttype">invalid/octet-stream 1.8k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1496796/797273/pass2_SimbaImpalaODBC_driver.log">Download pass2_SimbaImpalaODBC_driver.log</a><br />
<span class="downloadcontenttype">invalid/octet-stream 15.1k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1496796/797274/pass2_unixodbc.log">Download pass2_unixodbc.log</a><br />
<span class="downloadcontenttype">invalid/octet-stream 10.8k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1496796/797275/pass2_server.log">Download pass2_server.log</a><br />
<span class="downloadcontenttype">invalid/octet-stream 2.7k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1496923" href="/Public/Bug/Display.html?id=104416#txn-1496923">#</a>      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;16&nbsp;04:42:26&nbsp;2015</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1496923/797344/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/797344">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri May 15 13:37:13 2015, JSLAGEL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Here&#39;s the next pass at the logs.Â Â  I commented out the call to
&gt; SQLSetConnectAttr&#40;&#41; in the post_connect function of dbdimp.c.Â  The
&gt; logs show that the subsequent SQLGetInfo&#40;&#41; calls all seem to fail.Â  I
&gt; checked on the server side and I do see the connection come in and it
&gt; executes a &#34;SHOW DATABASES&#34; &#40;I&#39;ve included this log too&#41;.
</div>
These logs make little sense unless unixODBC is being bypassed and some calls are going straight to the driver - hence the invalid handles and the SQLError calls in the unixODBC log with no other calls logged.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Oh, I should also say I can connect using isql packaged with
&gt; unixODBC64 and everything seems to function correctly.
</div>
Firstly, isql opens an ODBC 2 connection and DBD::ODBC opens an ODBC 3 one.
Secondly, isql does not do anything other than allocate 2 handles and call SQLConnect.
I don&#39;t think it makes any SQLSetConnectAttr calls or SQLGetInfo calls at all.

DBD::ODBC moved to ODBC 3 probably more than 10 years ago. It is next to impossible to support ODBC 2 drivers now and still support ODBC 3 functionality in ODBC 3 drivers.
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; And lastly, I got pinged back on the impala-users mailing list and was
&gt; told there&#39;s an option, EnableSimulatedTransactions=1, which should
&gt; help with the AutoCommit.Â  Unfortunately that didn&#39;t seem to help the
&gt; problem.Â  I&#39;m concerned that the driver log messages keep saying
&gt; Invalid Connection handle on the subsequent SQLGetInfo&#40;&#41; calls...
&gt; 
&gt; -Joe
</div>
Can you try running a small connect script in Perl again &#40;with the autocommit still commented out&#41; but first set and export
PERL_DL_NONLAZY=1

I think what is happening is the dynamic linker is resolving SQLxxx symbols in libunixodbc.so until the ODBC driver is loaded and then SQLxxx symbols are pointing directly to the driver. unixODBC and your driver contain the same SQLxxx entry points and it is important the linker resolves them in unixodbc first.

I also note you have a non unicode build of DBD::ODBC but changing that right now might add to the complications.

I haven&#39;t got the driver you are using, does it say it supports ODBC 3? Can you point me at some documentation for the driver?

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1497562" href="/Public/Bug/Display.html?id=104416#txn-1497562">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;18&nbsp;17:22:48&nbsp;2015</span>
    <span class="description">slagelwa [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #104416] Problems using Impala ODBC library with Perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 18 May 2015 21:22:25 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-DBD-ODBC [...] rt.cpan.org&#34; &lt;bug-DBD-ODBC [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Joe S &lt;slagelwa [...] yahoo.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1497562/797674/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/797674">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Martin,
Using PERL_DL_NONLAZY=1.....works!Â Â  And with or without having the autocommit commented out.Â  So apparently that was a non-issue.Â  &#40;And for the record setting the Impala ODBC parameter EnableSimulatedTransactions=1 wasn&#39;t necessary&#41;.
The source for the ODBC drivers I&#39;m using is at:
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.cloudera.com/content/cloudera/en/downloads/connectors/impala/odbc/impala-odbc-v2-5-26.html">http://www.cloudera.com/content/cloudera/en/downloads/connectors/impala/odbc/impala-odbc-v2-5-26.html</a></span>
and according to its documentation it compiles with ODBC 3.80 along with unicode and 32/64 support.
As to the rest of our environment, we&#39;re testing on a 64bit CentOS 5 system.Â  We installed the 64bit versions for RHEL5 Impala drivers.Â  And instead of using the stock Perl where using Perl 5.14.2 built with the following options:
Â Â Â  config_args=&#39;-Dprefix=/tools&#39;
Â Â Â  hint=recommended, useposix=true, d_sigaction=define
Â Â Â  useithreads=define, usemultiplicity=define
Â Â Â  useperlio=define, d_sfio=undef, uselargefiles=define, usesocks=undef
Â Â Â  use64bitint=define, use64bitall=define, uselongd
For the ODBC manager we&#39;ve installed the stock CentOS 5 unixODBC64 and unixODBC64-devel, versions 2.2.14.Â  We then added a link /usr/lib64/libodbc.so =&gt; libodbc.so.2.0.0 as the CentOS rpms have a link /usr/lib64/libodbc64.so =&gt; libodbc.so.2.0.0, but not the former and DBD::ODBC wasn&#39;t picking up odbc64. LD_LIBRARY_PATH is left unassigned, and we edited the cloudera.impalaodbc.ini file to use DriverManagerEncoding=UTF-16 and ODBCInstLib=libodbcinst.so as suggested by the comments in the template.
Don&#39;t know if a description of our environment helps.

-Joe
 

     From: Martin J Evans via RT &lt;bug-DBD-ODBC@rt.cpan.org&gt;
 To: slagelwa@yahoo.com 
 Sent: Saturday, May 16, 2015 1:42 AM
 Subject: [rt.cpan.org #104416] Problems using Impala ODBC library with Perl
   
&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=104416">https://rt.cpan.org/Ticket/Display.html?id=104416</a></span> &gt;

On Fri May 15 13:37:13 2015, JSLAGEL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Here&#39;s the next pass at the logs.Â Â  I commented out the call to
&gt; SQLSetConnectAttr&#40;&#41; in the post_connect function of dbdimp.c.Â  The
&gt; logs show that the subsequent SQLGetInfo&#40;&#41; calls all seem to fail.Â  I
&gt; checked on the server side and I do see the connection come in and it
&gt; executes a &#34;SHOW DATABASES&#34; &#40;I&#39;ve included this log too&#41;.
</div>
These logs make little sense unless unixODBC is being bypassed and some calls are going straight to the driver - hence the invalid handles and the SQLError calls in the unixODBC log with no other calls logged.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Oh, I should also say I can connect using isql packaged with
&gt; unixODBC64 and everything seems to function correctly.
</div>
Firstly, isql opens an ODBC 2 connection and DBD::ODBC opens an ODBC 3 one.
Secondly, isql does not do anything other than allocate 2 handles and call SQLConnect.
I don&#39;t think it makes any SQLSetConnectAttr calls or SQLGetInfo calls at all.

DBD::ODBC moved to ODBC 3 probably more than 10 years ago. It is next to impossible to support ODBC 2 drivers now and still support ODBC 3 functionality in ODBC 3 drivers.
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; And lastly, I got pinged back on the impala-users mailing list and was
&gt; told there&#39;s an option, EnableSimulatedTransactions=1, which should
&gt; help with the AutoCommit.Â  Unfortunately that didn&#39;t seem to help the
&gt; problem.Â  I&#39;m concerned that the driver log messages keep saying
&gt; Invalid Connection handle on the subsequent SQLGetInfo&#40;&#41; calls...
&gt; 
&gt; -Joe
</div>
Can you try running a small connect script in Perl again &#40;with the autocommit still commented out&#41; but first set and export
PERL_DL_NONLAZY=1

I think what is happening is the dynamic linker is resolving SQLxxx symbols in libunixodbc.so until the ODBC driver is loaded and then SQLxxx symbols are pointing directly to the driver. unixODBC and your driver contain the same SQLxxx entry points and it is important the linker resolves them in unixodbc first.

I also note you have a non unicode build of DBD::ODBC but changing that right now might add to the complications.

I haven&#39;t got the driver you are using, does it say it supports ODBC 3? Can you point me at some documentation for the driver?

Martin
-- 
Martin J. Evans
Wetherby, UK


  
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1497562/797675/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/797675">with headers</a>
<br />
<span class="downloadcontenttype">text/html 9.2k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1497709" href="/Public/Bug/Display.html?id=104416#txn-1497709">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;19&nbsp;05:28:40&nbsp;2015</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1497709/797775/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/797775">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon May 18 17:22:48 2015, JSLAGEL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Martin,
&gt; Using PERL_DL_NONLAZY=1.....works!Â Â  And with or without having the
&gt; autocommit commented out.Â  So apparently that was a non-issue.Â  &#40;And
&gt; for the record setting the Impala ODBC parameter
&gt; EnableSimulatedTransactions=1 wasn&#39;t necessary&#41;.
</div>
That is good to hear. What I think it means if that something in the chain is linked with the dynamic linker set to resolve symbols when they are used rather than straight away. unixODBC loads the ODBC driver and I think there is an option &#40;something like RTLD_GROUP&#41; that needs adding to the call. I can probably find it if you need it.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The source for the ODBC drivers I&#39;m using is at:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cloudera.com/content/cloudera/en/downloads/connectors/impala/odbc/impala-">http://www.cloudera.com/content/cloudera/en/downloads/connectors/impala/odbc/impala-</a></span>
&gt; odbc-v2-5-26.html
&gt; and according to its documentation it compiles with ODBC 3.80 along
&gt; with unicode and 32/64 support.
</div>
That&#39;s good.

Bear in mind unicode in ODBC is a bit strange. To use unicode properly, you need to build DBD::ODBC with the -u switch. You can tell if your DBD::ODBC was compiled this way by checking <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/pod/DBD::ODBC#odbc_has_unicode">https://metacpan.org/pod/DBD::ODBC#odbc_has_unicode</a></span>

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As to the rest of our environment, we&#39;re testing on a 64bit CentOS 5
&gt; system.Â  We installed the 64bit versions for RHEL5 Impala drivers.Â 
&gt; And instead of using the stock Perl where using Perl 5.14.2 built with
&gt; the following options:
&gt; Â Â Â  config_args=&#39;-Dprefix=/tools&#39;
&gt; Â Â Â  hint=recommended, useposix=true, d_sigaction=define
&gt; Â Â Â  useithreads=define, usemultiplicity=define
&gt; Â Â Â  useperlio=define, d_sfio=undef, uselargefiles=define,
&gt; usesocks=undef
&gt; Â Â Â  use64bitint=define, use64bitall=define, uselongd
&gt; For the ODBC manager we&#39;ve installed the stock CentOS 5 unixODBC64 and
&gt; unixODBC64-devel, versions 2.2.14.Â  We then added a link
&gt; /usr/lib64/libodbc.so =&gt; libodbc.so.2.0.0 as the CentOS rpms have a
&gt; link /usr/lib64/libodbc64.so =&gt; libodbc.so.2.0.0, but not the former
&gt; and DBD::ODBC wasn&#39;t picking up odbc64.
</div>
Some day I need to get around to doing this automatically by testing odbc_config. Each distribution seems to do it slightly differently.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; LD_LIBRARY_PATH is left
&gt; unassigned, and we edited the cloudera.impalaodbc.ini file to use
&gt; DriverManagerEncoding=UTF-16 and ODBCInstLib=libodbcinst.so as
&gt; suggested by the comments in the template.
</div>
I&#39;m not sure whether that DriverManagerEncoding is going to do the right thing for you. I think you&#39;ll need to rebuild DBD::ODBC with -u switch or DBD::ODBC will look like an ANSI app to unixODBC.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Don&#39;t know if a description of our environment helps.
</div>
Yes, useful to know.

Do you mind if I close this RT now?

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1508190" href="/Public/Bug/Display.html?id=104416#txn-1508190">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;16&nbsp;08:51:11&nbsp;2015</span>
    <span class="description">bohica [...] ntlworld.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.981444</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
