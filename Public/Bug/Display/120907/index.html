<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #120907 for List-MoreUtils: ::XS :   &#39;ld&#39; used as if it was &#39;cc&#39; when LD is set in ENV</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #120907 for List-MoreUtils: ::XS :   &#39;ld&#39; used as if it was &#39;cc&#39; when LD is set in ENV</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/List-MoreUtils/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/List-MoreUtils/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/List-MoreUtils/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/List-MoreUtils/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/List-MoreUtils">List-MoreUtils CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">120907</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/List-MoreUtils/Active/">List-MoreUtils</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
KENTNL [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-19166-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-19167-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;03&nbsp;12:08:08&nbsp;2017</span>
    <span class="description">KENTNL [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> ::XS :   &#39;ld&#39; used as if it was &#39;cc&#39; when LD is set in ENV</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza"><p>
	Apologies if this is the wrong queue, metacpan bug tracking data points to this one still :)</p>

<p>
	When LD is set in ENV, something in configure eventually tries to pass CC args to it, which are invalid for LD, and then fails:<br>

	<br>

	A trivial reproduction is:<br>

	<br>

	LD=ld CC=cc perl Makefile.PL<br>

	Checking whether pureperl is required... no<br>

	Checking for cc... ld: unrecognised emulation mode: tune=native<br>

	Supported emulations: &lt;BIG LIST&gt;<br>

	<br>

	Can&#39;t produce loadable XS module at Makefile.PL line 44.<br>

	<br>

	This was reported to me by a user who has their stack configured for LLVM, which is much more strict about invalid ldflags:<br>

	&nbsp;</p>


<pre>
Checking whether pureperl is required... no
Checking for cc... /usr/bin/ld.lld: error: unknown argument: -pipe
/usr/bin/ld.lld: error: unknown argument: -fomit-frame-pointer
/usr/bin/ld.lld: error: unknown argument: -Wl,-O2
/usr/bin/ld.lld: error: unknown argument: -Wl,--as-needed

</pre>

<p>
	<br>

	--&nbsp;<br>

	- CPAN kentnl@cpan.org<br>

	- Gentoo Perl Maintainer kentnl@gentoo.org ( perl@gentoo.org )<br>

	&nbsp;</p>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;03&nbsp;12:22:00&nbsp;2017</span>
    <span class="description">REHSACK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Qualified user expected - see <span class="clickylink"><a target="new" rel="nofollow" href="http://www.gnu.org/software/autoconf/manual/autoconf.html">http://www.gnu.org/software/autoconf/manual/autoconf.html</a></span>.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;03&nbsp;12:22:01&nbsp;2017</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;03&nbsp;12:22:16&nbsp;2017</span>
    <span class="description">REHSACK [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;03&nbsp;12:51:18&nbsp;2017</span>
    <span class="description">KENTNL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza"><p>
	On 2017-04-04 04:22:00, REHSACK wrote:<br>

	&gt; Qualified user expected - see<br>

	&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.gnu.org/software/autoconf/manual/autoconf.html">http://www.gnu.org/software/autoconf/manual/autoconf.html</a></span>.<br>

	<br>

	Can you expand a little more? Perhaps point to a relevant section?</p>

<p>
	CC being pointed at a valid compiler, and LD being pointed at a valid linker , Its not clear to me how this is an error the user has made.<br>

	<br>

	It seems to me the problem is that something in your Perl stack tries to call LD with compile flags, but I don&#39;t know where to start looking.</p>

<p>
	LD should _not_ be called with compile flags.<br>

	<br>

	--&nbsp;<br>

	- CPAN kentnl@cpan.org<br>

	- Gentoo Perl Maintainer kentnl@gentoo.org ( perl@gentoo.org )<br>

	&nbsp;</p>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;03&nbsp;12:57:28&nbsp;2017</span>
    <span class="description">REHSACK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Apr 03 12:51:18 2017, KENTNL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2017-04-04 04:22:00, REHSACK wrote:
<div class="message-stanza open">&gt; &gt; Qualified user expected - see
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.gnu.org/software/autoconf/manual/autoconf.html">http://www.gnu.org/software/autoconf/manual/autoconf.html</a></span>.
</div>&gt; 
&gt; Can you expand a little more? Perhaps point to a relevant section?
</div>
For your particular issue, dunno.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; CC being pointed at a valid compiler, and LD being pointed at a valid
&gt; linker ,
&gt; Its not clear to me how this is an error the user has made.
</div>
When setting LD, you always have to set LDFLAGS, too.
Or trust the right LD is determined.

The particular issue comes up, when configure &#40;in this case, perl&#39;s configure which is used as source for flags to use to create same ABI&#41; determines linking should be done via cc &#40;very common these days&#41;, and thus linker executable is taken from CCLD and linker flags from CCLDFLAGS.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It seems to me the problem is that something in your Perl stack tries
&gt; to call LD with compile flags, but I don&#39;t know where to start looking.
</div>
In my? Seriously?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; LD should _not_ be called with compile flags.
</div>
Then be a good user and DON&#39;T CALL IT WITH COMPILE FLAGS.

Cheers,
Jens
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;03&nbsp;13:05:58&nbsp;2017</span>
    <span class="description">KENTNL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza"><p>
	On 2017-04-04 04:57:28, REHSACK wrote:<br>

	<br>

	&gt; Then be a good user and DON&#39;T CALL IT WITH COMPILE FLAGS.<br>

	<br>

	But that&#39;s entirely the point: I&#39;m not calling it with compile flags.<br>

	<br>

	This is, verbatim, what I can do to replicate the failure.</p>

<p>
	&nbsp;</p>

<p>
	&nbsp;cpanm --look List::MoreUtils::XS<br>

	--&gt; Working on List::MoreUtils::XS<br>

	Fetching <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpan.org/authors/id/R/RE/REHSACK/List-MoreUtils-XS-0.418.tar.gz">http://www.cpan.org/authors/id/R/RE/REHSACK/List-MoreUtils-XS-0.418.tar.gz</a></span> ... OK<br>

	Entering /home/kent/.cpanm/work/1491238831.381/List-MoreUtils-XS-0.418 with /bin/bash<br>

	kent@katipo2 ~/.cpanm/work/1491238831.381/List-MoreUtils-XS-0.418 $ LD=ld CC=cc perl Makefile.PL<br>

	Checking whether pureperl is required... no<br>

	Checking for cc... ld: unrecognised emulation mode: tune=native<br>

	<br>

	^ and then it dies.<br>

	<br>

	Is there any other information that I can give that would make it clearer why this is happening?<br>

	<br>

	Because &quot;The User&quot; here hasn&#39;t passed any CFLAGS that I&#39;m aware of.</p>

<p>
	If anyone has passed any wrong CFLAGS, it was likely me (somehow) in some part of normal perl build.<br>

	<br>

	But there&#39;s no CFLAGS being passed to LMU-XS here that I can see.<br>

	<br>

	--&nbsp;<br>

	- CPAN kentnl@cpan.org<br>

	- Gentoo Perl Maintainer kentnl@gentoo.org ( perl@gentoo.org )<br>

	&nbsp;</p>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;03&nbsp;13:12:42&nbsp;2017</span>
    <span class="description">REHSACK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Apr 03 13:05:58 2017, KENTNL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2017-04-04 04:57:28, REHSACK wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; Then be a good user and DON&#39;T CALL IT WITH COMPILE FLAGS.
</div>&gt; 
&gt; But that&#39;s entirely the point: I&#39;m not calling it with compile flags.
</div>
You do by omitting them. At the very moment Config::AutoConf relies on ExtUtils::CBuilder. I thought about implementing something better which can be used for makefile generation, either &#40;e.g. for improving Perl6 Toolchain - but there is a blocker in Perl6 tooling meanwhile which prevents me from jumping in and just for weird Perl5 Tooling I don&#39;t want to invest that much of time&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This is, verbatim, what I can do to replicate the failure.
&gt; 
&gt; cpanm --look List::MoreUtils::XS
</div>
It is very important, either set all or none tunable environment variables - or, of set particular ones, know what the tune.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; kent@katipo2 ~/.cpanm/work/1491238831.381/List-MoreUtils-XS-0.418 $ LD=ld CC=cc perl Makefile.PL
</div>
This is always an error, since a perl module must build must rely on perl build flags to create same ABI. Specifying LD without LDFLAGS causes $ENV{LD} runs with $Config{ldflags} - that&#39;s never a good idea, isn&#39;t it? Except for very particular cases.

Cheers,
Jens
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;03&nbsp;13:51:18&nbsp;2017</span>
    <span class="description">KENTNL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza"><p>
	On 2017-04-04 05:12:42, REHSACK wrote:<br>

	<br>

	&gt; This is always an error, since a perl module must build must rely on<br>

	&gt; perl build flags to create same ABI. Specifying LD without LDFLAGS<br>

	&gt; causes $ENV{LD} runs with $Config{ldflags} - that&#39;s never a good idea,<br>

	&gt; isn&#39;t it? Except for very particular cases.<br>

	<br>

	In this case, the user was specifying an explict LD when they compiled perl, in order to prevent Perl from compiling with the default, GNU&#39;s LD, because the user wants an LLVM stack.<br>

	<br>

	Which means they have the same value of LD in their environment that they used to build perl, when they build List::MoreUtils::XS<br>

	<br>

	I asked them to remove LD from their environment, and this leads LMU to pick a different LD<br>

	<br>

	/usr/lib/gcc/x86_64-pc-linux-gnu/6.3.0/../../../../x86_64-pc-linux-gnu/bin/ld<br>

	<br>

	Which for them, is the wrong LD , and gives them similar problems. (Sorry if I&#39;m vague, trying to extract data out of 3rd parties through 3rd paries is difficult )<br>

	<br>

	It seems to me that given the behaviour, and given how setting LD in ENV does the right thing for the rest of the operating system ( and indeed, normal autoconf handles it correctly on a regular basis ), that it might not be entirely wrong for their use case.<br>

	<br>

	So here, the combination of custom LD and $Config{ldflags}&nbsp; is right, *because* its the same conditions Perl Itself builds under.</p>

<p>
	Its only leaving LD UNset that introduces the &quot;wrong condition&quot;, if I understand correctly.<br>

	<br>

	However, the user I was helping has decided to resort to unsetting LD in environment, and then maintaining /usr/bin/ld as a symlink to the desired LD instead, as that seems to work better for LMU-XS ( after recompiling perl with it this way of course )</p>

<p>
	The only reason they didn&#39;t do that in the first place is every binutils update replaces that symlink and brings them back to using the GNU stack instead of the LLVM stack, which is wrong for them.<br>

	<br>

	<br>

	--&nbsp;<br>

	- CPAN kentnl@cpan.org<br>

	- Gentoo Perl Maintainer kentnl@gentoo.org ( perl@gentoo.org )<br>

	&nbsp;</p>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;03&nbsp;13:55:30&nbsp;2017</span>
    <span class="description">REHSACK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Apr 03 13:51:18 2017, KENTNL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2017-04-04 05:12:42, REHSACK wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; This is always an error, since a perl module must build must rely on
&gt; &gt; perl build flags to create same ABI. Specifying LD without LDFLAGS
&gt; &gt; causes $ENV{LD} runs with $Config{ldflags} - that&#39;s never a good
&gt; &gt; idea,
&gt; &gt; isn&#39;t it? Except for very particular cases.
</div>&gt; 
&gt; In this case, the user was specifying an explict LD when they compiled
&gt; perl, in
&gt; order to prevent Perl from compiling with the default, GNU&#39;s LD,
&gt; because the
&gt; user wants an LLVM stack.
&gt; 
&gt; Which means they have the same value of LD in their environment that
&gt; they used
&gt; to build perl, when they build List::MoreUtils::XS
&gt; 
&gt; I asked them to remove LD from their environment, and this leads LMU
&gt; to pick a
&gt; different LD
&gt; 
&gt; /usr/lib/gcc/x86_64-pc-linux-gnu/6.3.0/../../../../x86_64-pc-linux-
&gt; gnu/bin/ld
&gt; 
&gt; Which for them, is the wrong LD , and gives them similar problems.
&gt; &#40;Sorry if
&gt; I&#39;m vague, trying to extract data out of 3rd parties through 3rd
&gt; paries is
&gt; difficult &#41;
&gt; 
&gt; It seems to me that given the behaviour, and given how setting LD in
&gt; ENV does
&gt; the right thing for the rest of the operating system &#40; and indeed,
&gt; normal
&gt; autoconf handles it correctly on a regular basis &#41;, that it might not
&gt; be
&gt; entirely wrong for their use case.
&gt; 
&gt; So here, the combination of custom LD and $Config{ldflags} is right,
&gt; *because*
&gt; its the same conditions Perl Itself builds under.
&gt; 
&gt; Its only leaving LD UNset that introduces the &#34;wrong condition&#34;, if I
&gt; understand correctly.
&gt; 
&gt; However, the user I was helping has decided to resort to unsetting LD
&gt; in
&gt; environment, and then maintaining /usr/bin/ld as a symlink to the
&gt; desired LD
&gt; instead, as that seems to work better for LMU-XS &#40; after recompiling
&gt; perl with
&gt; it this way of course &#41;
&gt; 
&gt; The only reason they didn&#39;t do that in the first place is every
&gt; binutils update
&gt; replaces that symlink and brings them back to using the GNU stack
&gt; instead of
&gt; the LLVM stack, which is wrong for them.
</div>
In that case - which seems to be a very weird setup the user has, it should set LD to ${CCLD} - which is typically just &#39;cc&#39;.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
