<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #49549 for HTML-TagCloud: Patch to add a callback in order to generate custom &lt;a&gt; attributes</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #49549 for HTML-TagCloud: Patch to add a callback in order to generate custom &lt;a&gt; attributes</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/HTML-TagCloud/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/HTML-TagCloud/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/HTML-TagCloud/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/HTML-TagCloud/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/HTML-TagCloud">HTML-TagCloud CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">49549</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/HTML-TagCloud/Active/">HTML-TagCloud</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dland [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-16040-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-16041-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.34    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;09&nbsp;07:08:05&nbsp;2009</span>
    <span class="description">dland [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Patch to add a callback in order to generate custom &lt;a&gt; attributes</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello LÃ©on,

I love this module, but I wanted to add a title attribute to each &lt;a&gt;
element, so that a nice little popup would appear when you hover the
mouse over a link.

The following patch does just that.

The diff for TagCloud.pm is against 0.34.

The diff for t/simple.t is against 0.32. Sorry, I didn&#39;t have the latest
source around, this is what was lying in my CPAN build dir. But it
should be pretty simple to apply, it&#39;s just a single slab.

A word of warning: I transferred this from a Unix box to a Windows box
in order to upload the diffs, so they may have crappy line-endings.

Enjoy!
David
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> simple.t.diff</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- t/simple.t	Mon Aug 22 17:34:31 2005
+++ /home/david/perl/devel/t/simple.t	Wed Sep  9 12:56:25 2009
@@ -1,6 +1,6 @@
 #!perl
 use strict;
-use Test::More tests =&gt; 12;
+use Test::More tests =&gt; 13;
 use_ok&#40;&#39;HTML::TagCloud&#39;&#41;;
 
 my $cloud = HTML::TagCloud-&gt;new;
@@ -59,6 +59,32 @@
 &lt;span class=&#34;tagcloud3&#34;&gt;&lt;a href=&#34;b.html&#34;&gt;b&lt;/a&gt;&lt;/span&gt;
 &lt;span class=&#34;tagcloud3&#34;&gt;&lt;a href=&#34;c.html&#34;&gt;c&lt;/a&gt;&lt;/span&gt;
 &lt;/div&gt;}&#41;;
+
+my %tag2 = &#40;
+	foo =&gt; {n =&gt; 2, url =&gt; &#39;urlfoo&#39;},
+	bar =&gt; {n =&gt; 5, url =&gt; &#39;urlbar&#39;},
+	rat =&gt; {n =&gt; 7, url =&gt; &#39;urlrat&#39;},
+	one =&gt; {n =&gt; 1, url =&gt; &#39;urlonce&#39;},
+&#41;;
+$cloud = HTML::TagCloud-&gt;new&#40;
+	levels =&gt; 4,
+	anchor_callback =&gt; sub {
+		my $t = shift;
+		my $count = $tag2{$t-&gt;{name}}{n};
+		my $usage = $count == 1 ? &#39;used once&#39; : &#34;used $count times&#34;;
+		return qq{&lt;a href=&#34;$t-&gt;{url}&#34; title=&#34;$usage&#34;&gt;$t-&gt;{name}&lt;/a&gt;};
+	},
+&#41;;
+for my $t &#40;keys %tag2&#41; {
+	$cloud-&gt;add&#40; $t, $tag2{$t}{url}, $tag2{$t}{n} &#41;;
+}
+$html = $cloud-&gt;html;
+is&#40;$html, q{&lt;div id=&#34;htmltagcloud&#34;&gt;
+&lt;span class=&#34;tagcloud3&#34;&gt;&lt;a href=&#34;urlbar&#34; title=&#34;used 5 times&#34;&gt;bar&lt;/a&gt;&lt;/span&gt;
+&lt;span class=&#34;tagcloud1&#34;&gt;&lt;a href=&#34;urlfoo&#34; title=&#34;used 2 times&#34;&gt;foo&lt;/a&gt;&lt;/span&gt;
+&lt;span class=&#34;tagcloud0&#34;&gt;&lt;a href=&#34;urlonce&#34; title=&#34;used once&#34;&gt;one&lt;/a&gt;&lt;/span&gt;
+&lt;span class=&#34;tagcloud4&#34;&gt;&lt;a href=&#34;urlrat&#34; title=&#34;used 7 times&#34;&gt;rat&lt;/a&gt;&lt;/span&gt;
+&lt;/div&gt;}, &#39;with anchor_callback&#39;&#41;;
 
 sub tags {
   return {
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> TagCloud.pm.diff</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- HTML/TagCloud.pm	Tue Nov  7 22:05:17 2006
+++ /home/david/perl/devel/lib/HTML/TagCloud.pm	Wed Sep  9 13:00:41 2009
@@ -1,7 +1,7 @@
 package HTML::TagCloud;
 use strict;
 use warnings;
-our $VERSION = &#39;0.34&#39;;
+our $VERSION = &#39;0.35&#39;;
 
 sub new {
   my $class = shift;
@@ -82,8 +82,13 @@
     return &#34;&#34;;
   } elsif &#40;$ntags == 1&#41; {
     my $tag = $tags[0];
-    return qq{&lt;div id=&#34;htmltagcloud&#34;&gt;&lt;span class=&#34;tagcloud1&#34;&gt;&lt;a href=&#34;}.
-	$tag-&gt;{url}.qq{&#34;&gt;}.$tag-&gt;{name}.qq{&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;\n};
+    return qq{&lt;div id=&#34;htmltagcloud&#34;&gt;&lt;span class=&#34;tagcloud1&#34;&gt;}
+      . &#40;
+        &#40;exists $self-&gt;{anchor_callback} &#38;&#38; ref&#40;$self-&gt;{anchor_callback}&#41; eq &#39;CODE&#39;&#41;
+        ? $self-&gt;{anchor_callback}&#40;{url =&gt; $tag-&gt;{url}, name=&gt; $tag-&gt;{name}}&#41;
+        : qq{&lt;a href=&#34;$tag-&gt;{url}&#34;&gt;$tag-&gt;{name}&lt;/a&gt;}
+     &#41;
+     . qq{&lt;/span&gt;&lt;/div&gt;\n};
   }
 
 #  warn &#34;min $min - max $max &#40;$factor&#41;&#34;;
@@ -92,8 +97,13 @@
 
   my $html = &#34;&#34;;
   foreach my $tag &#40;@tags&#41; {
-    $html .=  qq{&lt;span class=&#34;tagcloud}.$tag-&gt;{level}.qq{&#34;&gt;&lt;a href=&#34;}.$tag-&gt;{url}.
-	      qq{&#34;&gt;}.$tag-&gt;{name}.qq{&lt;/a&gt;&lt;/span&gt;\n};
+    $html .=  qq{&lt;span class=&#34;tagcloud$tag-&gt;{level}&#34;&gt;}
+      . &#40;
+        &#40;exists $self-&gt;{anchor_callback} &#38;&#38; ref&#40;$self-&gt;{anchor_callback}&#41; eq &#39;CODE&#39;&#41;
+        ? $self-&gt;{anchor_callback}&#40;{url =&gt; $tag-&gt;{url}, name=&gt; $tag-&gt;{name}}&#41;
+        : qq{&lt;a href=&#34;$tag-&gt;{url}&#34;&gt;$tag-&gt;{name}&lt;/a&gt;}
+     &#41;
+     . qq{&lt;/span&gt;\n};
   }
   $html = qq{&lt;div id=&#34;htmltagcloud&#34;&gt;
 $html&lt;/div&gt;};
@@ -143,11 +153,37 @@
 
 =head2 new
 
-The constructor takes one optional argument:
+The constructor takes two optional arguments:
+
+B&lt;C&lt;levels&gt;&gt;
 
   my $cloud = HTML::TagCloud-&gt;new&#40;levels=&gt;10&#41;;
 
-if not provided, levels defaults to 24
+if not provided, levels defaults to 24.
+
+B&lt;C&lt;anchor_callback&gt;&gt;
+
+The second optional argument is a callback that may be used to
+construct the C&lt;&lt; &lt;a&gt; &gt;&gt; element, for instance, to add a C&lt;title&gt;
+attribute. The callback routine is passed a reference to a hash
+containing two keys, C&lt;name&gt;, the name of the tag, and C&lt;count&gt;,
+the count of this particular tag.
+
+  # assume the following variable is defined
+  my %tag = &#40;
+	foo =&gt; {n =&gt; 37, url =&gt; &#39;urlfoo&#39;},
+	bar =&gt; {n =&gt;  1, url =&gt; &#39;urlbar&#39;},
+  &#41;;
+
+  my $cloud = HTML::TagCloud-&gt;new&#40;
+    levels =&gt; 2,
+    anchor_callback =&gt; sub {
+        my $t = shift;
+        my $count = $tag{$t-&gt;{name}}{n};
+        my $usage = $count == 1 ? &#39;used once&#39; : &#34;used $count times&#34;;
+        return qq{&lt;a href=&#34;$t-&gt;{url}&#34; title=&#34;$usage&#34;&gt;$t-&gt;{name}&lt;/a&gt;};
+    },
+  &#41;;
 
 =head1 METHODS
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;15&nbsp;20:02:16&nbsp;2010</span>
    <span class="description">TONVOON [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">+1 to this technique of a callback!

I attach a patch to David&#39;s code, where a default anchor_callback, based on the existing anchor 
output, is used.

I&#39;ve also set some extra attributes that can be passed through to the tags hash, which makes 
extending this much easier than David&#39;s method of having an external hash data.

This is still backwards compatible with David&#39;s code though &#40;his tests still pass!&#41;, so I&#39;ve left his 
tests as is.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> HTML_TagCloud_anchor_callback.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -ur HTML-TagCloud-0.34.original/CHANGES HTML-TagCloud-0.34/CHANGES
--- HTML-TagCloud-0.34.original/CHANGES	2006-11-07 21:05:17.000000000 +0000
+++ HTML-TagCloud-0.34/CHANGES	2010-07-15 14:54:39.000000000 +0000
@@ -1,5 +1,9 @@
 CHANGES file for HTML::TagCloud:
 
+0.35 ???
+  - Added ability to define own anchor_callback and add additional data for each tag
+    to reference in anchor_callback &#40;David Landgren and Ton Voon - RT 49549&#41;
+
 0.34 Tue Nov  7 21:00:33 GMT 2006
   - Internet Explorer fix, which addresses issues with Japanese text
     &#40;thanks to Tatsuhiko Miyagawa&#41;
diff -ur HTML-TagCloud-0.34.original/lib/HTML/TagCloud.pm HTML-TagCloud-0.34/lib/HTML/TagCloud.pm
--- HTML-TagCloud-0.34.original/lib/HTML/TagCloud.pm	2006-11-07 21:05:17.000000000 +0000
+++ HTML-TagCloud-0.34/lib/HTML/TagCloud.pm	2010-07-15 14:52:49.000000000 +0000
@@ -1,7 +1,7 @@
 package HTML::TagCloud;
 use strict;
 use warnings;
-our $VERSION = &#39;0.34&#39;;
+our $VERSION = &#39;0.35&#39;;
 
 sub new {
   my $class = shift;
@@ -9,6 +9,7 @@
     counts =&gt; {},
     urls   =&gt; {},
     levels =&gt; 24,
+    anchor_callback =&gt; sub { my $tag = shift; qq{&lt;a href=&#34;$tag-&gt;{url}&#34;&gt;$tag-&gt;{name}&lt;/a&gt;} },
     @_
   };
   bless $self, $class;
@@ -16,9 +17,10 @@
 }
 
 sub add {
-  my&#40;$self, $tag, $url, $count&#41; = @_;
+  my&#40;$self, $tag, $url, $count, $hash&#41; = @_;
   $self-&gt;{counts}-&gt;{$tag} = $count;
   $self-&gt;{urls}-&gt;{$tag} = $url;
+  $self-&gt;{extras}-&gt;{$tag} = $hash || {};
 }
 
 sub css {
@@ -68,6 +70,7 @@
     $tag_item-&gt;{count} = $counts-&gt;{$tag};
     $tag_item-&gt;{url}   = $urls-&gt;{$tag};
     $tag_item-&gt;{level} = int&#40;&#40;log&#40;$tag_item-&gt;{count}&#41; - $min&#41; * $factor&#41;;
+    $tag_item = { %$tag_item, %{$self-&gt;{extras}-&gt;{$tag}} };
     push @tag_items,$tag_item;
   }
   return @tag_items;
@@ -82,8 +85,9 @@
     return &#34;&#34;;
   } elsif &#40;$ntags == 1&#41; {
     my $tag = $tags[0];
-    return qq{&lt;div id=&#34;htmltagcloud&#34;&gt;&lt;span class=&#34;tagcloud1&#34;&gt;&lt;a href=&#34;}.
-	$tag-&gt;{url}.qq{&#34;&gt;}.$tag-&gt;{name}.qq{&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;\n};
+    return qq{&lt;div id=&#34;htmltagcloud&#34;&gt;&lt;span class=&#34;tagcloud1&#34;&gt;}
+      . $self-&gt;{anchor_callback}&#40; $tag &#41;
+     . qq{&lt;/span&gt;&lt;/div&gt;\n};
   }
 
 #  warn &#34;min $min - max $max &#40;$factor&#41;&#34;;
@@ -92,8 +96,9 @@
 
   my $html = &#34;&#34;;
   foreach my $tag &#40;@tags&#41; {
-    $html .=  qq{&lt;span class=&#34;tagcloud}.$tag-&gt;{level}.qq{&#34;&gt;&lt;a href=&#34;}.$tag-&gt;{url}.
-	      qq{&#34;&gt;}.$tag-&gt;{name}.qq{&lt;/a&gt;&lt;/span&gt;\n};
+    $html .=  qq{&lt;span class=&#34;tagcloud$tag-&gt;{level}&#34;&gt;}
+      . $self-&gt;{anchor_callback}&#40; $tag &#41;
+     . qq{&lt;/span&gt;\n};
   }
   $html = qq{&lt;div id=&#34;htmltagcloud&#34;&gt;
 $html&lt;/div&gt;};
@@ -143,11 +148,33 @@
 
 =head2 new
 
-The constructor takes one optional argument:
+The constructor takes two optional arguments:
+
+B&lt;C&lt;levels&gt;&gt;
 
   my $cloud = HTML::TagCloud-&gt;new&#40;levels=&gt;10&#41;;
 
-if not provided, levels defaults to 24
+if not provided, levels defaults to 24.
+
+B&lt;C&lt;anchor_callback&gt;&gt;
+
+The second optional argument is a callback that may be used to
+construct the C&lt;&lt; &lt;a&gt; &gt;&gt; element, for instance, to add a C&lt;title&gt;
+attribute. The callback routine is passed a reference to the tag hash - 
+add any data you want to the tag via the 4th argument to the add&#40;&#41; method
+
+  my $cloud = HTML::TagCloud-&gt;new&#40;
+    levels =&gt; 2,
+    anchor_callback =&gt; sub {
+        my $t = shift;
+        my $count = $t-&gt;{count};
+        my $usage = $count == 1 ? &#39;used once&#39; : &#34;used $count times&#34;;
+        return qq{&lt;a href=&#34;$t-&gt;{url}&#34; title=&#34;$usage&#34; class=&#34;$t-&gt;{class}&#34;&gt;$t-&gt;{name}&lt;/a&gt;};
+    },
+  &#41;;
+
+  $cloud-&gt;add&#40; &#34;foo&#34;, &#34;urlfoo&#34;, 37, { class =&gt; &#34;red&#34; } &#41;;
+  $cloud-&gt;add&#40; &#34;bar&#34;, &#34;urlbar&#34;, 1,  { class =&gt; &#34;black&#34; } &#41;;
 
 =head1 METHODS
 
@@ -160,6 +187,11 @@
   $cloud-&gt;add&#40;$tag2, $url2, $count2&#41;;
   $cloud-&gt;add&#40;$tag3, $url3, $count3&#41;;
 
+You can pass in an optional 4th argument which is a hash ref of extra information. Eg:
+
+  $cloud-&gt;add&#40;$tag1, $url1, $count1, { title =&gt; &#34;Title&#34;, class =&gt; &#34;green&#34; }&#41;;
+
+This can be accessed from the anchor_callback to generate your own anchor tags.
 
 =head2 tags&#40;$limit&#41;
 
diff -ur HTML-TagCloud-0.34.original/t/simple.t HTML-TagCloud-0.34/t/simple.t
--- HTML-TagCloud-0.34.original/t/simple.t	2006-11-07 21:05:17.000000000 +0000
+++ HTML-TagCloud-0.34/t/simple.t	2010-07-15 14:44:04.000000000 +0000
@@ -1,6 +1,6 @@
 #!perl
 use strict;
-use Test::More tests =&gt; 12;
+use Test::More tests =&gt; 14;
 use_ok&#40;&#39;HTML::TagCloud&#39;&#41;;
 
 my $cloud = HTML::TagCloud-&gt;new;
@@ -60,6 +60,51 @@
 &lt;span class=&#34;tagcloud3&#34;&gt;&lt;a href=&#34;c.html&#34;&gt;c&lt;/a&gt;&lt;/span&gt;
 &lt;/div&gt;}&#41;;
 
+my %tag2 = &#40;
+	foo =&gt; {n =&gt; 2, url =&gt; &#39;urlfoo&#39;},
+	bar =&gt; {n =&gt; 5, url =&gt; &#39;urlbar&#39;},
+	rat =&gt; {n =&gt; 7, url =&gt; &#39;urlrat&#39;},
+	one =&gt; {n =&gt; 1, url =&gt; &#39;urlonce&#39;},
+&#41;;
+$cloud = HTML::TagCloud-&gt;new&#40;
+	levels =&gt; 4,
+	anchor_callback =&gt; sub {
+		my $t = shift;
+		my $count = $tag2{$t-&gt;{name}}{n};
+		my $usage = $count == 1 ? &#39;used once&#39; : &#34;used $count times&#34;;
+		return qq{&lt;a href=&#34;$t-&gt;{url}&#34; title=&#34;$usage&#34;&gt;$t-&gt;{name}&lt;/a&gt;};
+	},
+&#41;;
+for my $t &#40;keys %tag2&#41; {
+	$cloud-&gt;add&#40; $t, $tag2{$t}{url}, $tag2{$t}{n} &#41;;
+}
+$html = $cloud-&gt;html;
+is&#40;$html, q{&lt;div id=&#34;htmltagcloud&#34;&gt;
+&lt;span class=&#34;tagcloud3&#34;&gt;&lt;a href=&#34;urlbar&#34; title=&#34;used 5 times&#34;&gt;bar&lt;/a&gt;&lt;/span&gt;
+&lt;span class=&#34;tagcloud1&#34;&gt;&lt;a href=&#34;urlfoo&#34; title=&#34;used 2 times&#34;&gt;foo&lt;/a&gt;&lt;/span&gt;
+&lt;span class=&#34;tagcloud0&#34;&gt;&lt;a href=&#34;urlonce&#34; title=&#34;used once&#34;&gt;one&lt;/a&gt;&lt;/span&gt;
+&lt;span class=&#34;tagcloud4&#34;&gt;&lt;a href=&#34;urlrat&#34; title=&#34;used 7 times&#34;&gt;rat&lt;/a&gt;&lt;/span&gt;
+&lt;/div&gt;}, &#39;with anchor_callback&#39;&#41;;
+
+
+$cloud = HTML::TagCloud-&gt;new&#40;
+    levels =&gt; 4,
+    anchor_callback =&gt; sub {
+        my $t = shift;
+        return qq{&lt;a href=&#34;$t-&gt;{url}&#34; title=&#34;$t-&gt;{title}&#34; class=&#34;$t-&gt;{class}&#34;&gt;$t-&gt;{name}&lt;/a&gt;};
+    },
+&#41;;
+$cloud-&gt;add&#40; &#34;spiderman&#34;, &#34;/url/spiderman&#34;, 12, { title =&gt; &#34;Peter Parker&#34;, class =&gt; &#34;red&#34; } &#41;;
+$cloud-&gt;add&#40; &#34;batman&#34;, &#34;/url/batman&#34;, 5, { title =&gt; &#34;Caped Crusader&#34;, class =&gt; &#34;black&#34; } &#41;;
+$cloud-&gt;add&#40; &#34;wonderwoman&#34;, &#34;/url/wonderwoman&#34;, 9, { title =&gt; &#34;Princess Diana&#34;, class =&gt; &#34;yellow&#34; } &#41;;
+$html = $cloud-&gt;html;
+is&#40; $html, q{&lt;div id=&#34;htmltagcloud&#34;&gt;
+&lt;span class=&#34;tagcloud0&#34;&gt;&lt;a href=&#34;/url/batman&#34; title=&#34;Caped Crusader&#34; class=&#34;black&#34;&gt;batman&lt;/a&gt;&lt;/span&gt;
+&lt;span class=&#34;tagcloud2&#34;&gt;&lt;a href=&#34;/url/spiderman&#34; title=&#34;Peter Parker&#34; class=&#34;red&#34;&gt;spiderman&lt;/a&gt;&lt;/span&gt;
+&lt;span class=&#34;tagcloud2&#34;&gt;&lt;a href=&#34;/url/wonderwoman&#34; title=&#34;Princess Diana&#34; class=&#34;yellow&#34;&gt;wonderwoman&lt;/a&gt;&lt;/span&gt;
+&lt;/div&gt;}, &#34;with extra data anchor_callback&#34; &#41;;
+
+
 sub tags {
   return {
     &#39;laptop&#39;                 =&gt; 11,
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;15&nbsp;20:02:17&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;06&nbsp;05:33:39&nbsp;2011</span>
    <span class="description">dland [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jul 15 20:02:16 2010, TONVOON wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; +1 to this technique of a callback!
&gt; 
&gt; I attach a patch to David&#39;s code, where a default anchor_callback,
&gt; based on the existing anchor
&gt; output, is used.
&gt; 
&gt; I&#39;ve also set some extra attributes that can be passed through to the
&gt; tags hash, which makes
&gt; extending this much easier than David&#39;s method of having an external
&gt; hash data.
</div>
Nice!
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
