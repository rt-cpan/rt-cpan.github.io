<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #131336 for Validate-Simple: kinda slow</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #131336 for Validate-Simple: kinda slow</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Validate-Simple">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Validate-Simple">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Validate-Simple">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Validate-Simple">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Validate-Simple">Validate-Simple CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">131336</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Validate-Simple">Validate-Simple</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
perl [...] toby.ink

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Unimportant    </td>
  </tr>
  <tr id="CF-274390-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-274391-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
v0.3.0    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




vs.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1877318/1007417/vs.pl">
Thu Jan 02 07:34:11 2020 (2.3k) by perl [...] toby.ink
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=131336">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1877318" href="/Public/Bug/Display.html?id=131336#txn-1877318">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;02&nbsp;07:34:11&nbsp;2020</span>
    <span class="description">perl [...] toby.ink -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> kinda slow</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1877318/1007416/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1007416">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I used the attached script to compare the speed of Validate::Simple with Type::Tiny. My results were that Type::Tiny is about 37 times faster.

                  Rate Validate_Simple  Types_Standard
Validate_Simple 4.00/s              --            -97%
Types_Standard   154/s           3748%              --



Type::Tiny/Types::Standard is also a lot more concise to express the schema:

my $tt = Dict[
  username      =&gt; Str,
  first_name    =&gt; Str,
  last_name     =&gt; Optional[Str],
  age           =&gt; Optional[IntRange[18]],
  gender        =&gt; Optional[
                     Enum[qw/ mail femaile id_rather_not_to_say /]
                   ],
  tags          =&gt; Optional[ArrayRef[Str]],
  hobbies       =&gt; Optional[
                     ArrayRef[
                       Enum[qw/ hiking travelling surfing laziness /]
                     ]
                   ],
  score         =&gt; Optional[HashRef[PositiveOrZeroInt]],
  monthly_score =&gt; Optional[
                     HashRef[
                       HashRef[
                         ArrayRef-&gt;where&#40;&#39;@$_ &lt; 12&#39;&#41;
                       ]
                     ]
                   ]
];



The main advantage that Validate::Simple seems to offer is that Type::Tiny is geared towards giving a single result about whether the supplied data is valid or not as a whole, while Validate::Simple will drill down into the data to figure out why it&#39;s not valid, which might be more useful when, say, reporting errors from a form someone has filled out.

If there were a simple way to build a fast Type::Tiny object from Validate::Simple &#40;or vice versa, in fact&#41; then people could use the fast Type::Tiny check to check whether a data is valid or not, then fall back to Validate::Simple to report the errors if there are any.

Of course, in many situations, validation speed is not an issue, like if you&#39;re validating a smallish JSON structure you&#39;ve been posted via HTTP, then the network and HTTP stuff is probably your app&#39;s bottleneck, and not data validation.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> vs.pl</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1877318/1007417/vs.pl">Download vs.pl</a><br />
<span class="downloadcontenttype">text/x-perl 2.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">use strict;
use warnings;

use Validate::Simple;
 
my $specs = {
    username =&gt; {
        type     =&gt; &#39;string&#39;,
        required =&gt; 1,
    },
    first_name =&gt; {
        type     =&gt; &#39;string&#39;,
        required =&gt; 1,
    },
    last_name =&gt; {
        type =&gt; &#39;string&#39;,
    },
    age =&gt; {
        type =&gt; &#39;integer&#39;,
        gt   =&gt; 18,
    },
    gender =&gt; {
        type   =&gt; &#39;enum&#39;,
        values =&gt; [
            &#39;mail&#39;,
            &#39;femaile&#39;,
            &#39;id_rather_not_to_say&#39;,
        ],
    },
    tags =&gt; {
        type =&gt; &#39;array&#39;,
        of   =&gt; {
            type =&gt; &#39;string&#39;,
        },
    },
    hobbies =&gt; {
        type =&gt; &#39;array&#39;,
        of   =&gt; {
            type =&gt;&#39;enum&#39;,
            values =&gt; [ qw/hiking travelling surfing laziness/ ],
        }
    },
    score =&gt; {
        type =&gt; &#39;hash&#39;,
        of   =&gt; { type =&gt; &#39;non_negative_int&#39; },
    },
    monthly_score =&gt; {
        type =&gt; &#39;hash&#39;,
        of   =&gt; {
            type =&gt; &#39;hash&#39;,
            of   =&gt; {
                type     =&gt; &#39;array&#39;,
					 of       =&gt; { type =&gt; &#39;integer&#39; },
                callback =&gt; sub {
                    @{ $_[0] } &lt; 12;
                },
            }
        },
    }
};
 
my $vs = Validate::Simple-&gt;new&#40; $specs &#41;;

use Types::Standard -types;
use Types::Common::Numeric -types;
use Types::Common::String -types;

my $tt = Dict[
	username      =&gt; Str,
	first_name    =&gt; Str,
	last_name     =&gt; Optional[Str],
	age           =&gt; Optional[IntRange[18]],
	gender        =&gt; Optional[Enum[qw/ mail femaile id_rather_not_to_say /]],
	tags          =&gt; Optional[ArrayRef[Str]],
	hobbies       =&gt; Optional[ArrayRef[Enum[qw/ hiking travelling surfing laziness /]]],
	score         =&gt; Optional[HashRef[PositiveOrZeroInt]],
	monthly_score =&gt; Optional[HashRef[HashRef[ArrayRef-&gt;where&#40;&#39;@$_ &lt; 12&#39;&#41;]]]
];


use Test::More;

my $data = {
	username       =&gt; &#39;alice&#39;,
	first_name     =&gt; &#39;Alice&#39;,
	last_name      =&gt; &#39;Jones&#39;,
	age            =&gt; 21,
	tags           =&gt; [qw/ abc xyz /],
	hobbies        =&gt; [&#39;hiking&#39;],
	score          =&gt; { hiking =&gt; 45 },
	monthly_score  =&gt; { hiking =&gt; { &#39;2020&#39; =&gt; [ 8 ] } },
};

ok&#40; $vs-&gt;validate&#40;$data&#41; &#41;
	or diag explain&#40; [$vs-&gt;errors] &#41;;
ok&#40; $tt-&gt;check&#40;$data&#41; &#41;;

use Benchmark qw&#40;cmpthese&#41;;
cmpthese -3, {
	Validate_Simple =&gt; sub { $vs-&gt;validate&#40;$data&#41; for 1..1000 },
	Types_Standard  =&gt; sub { $tt-&gt;check&#40;$data&#41; for 1..1000 },
};


done_testing;

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1877408" href="/Public/Bug/Display.html?id=131336#txn-1877408">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;02&nbsp;22:43:00&nbsp;2020</span>
    <span class="description">ANDREIP [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1877408/1007461/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1007461">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 5.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jan 02 07:34:11 2020, TOBYINK wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I used the attached script to compare the speed of Validate::Simple
&gt; with Type::Tiny. My results were that Type::Tiny is about 37 times
&gt; faster.
&gt; 
&gt; Rate Validate_Simple  Types_Standard
&gt; Validate_Simple 4.00/s              --            -97%
&gt; Types_Standard   154/s           3748%              --
&gt; 
&gt; 
&gt; 
&gt; Type::Tiny/Types::Standard is also a lot more concise to express the
&gt; schema:
&gt; 
&gt; my $tt = Dict[
&gt;   username      =&gt; Str,
&gt;   first_name    =&gt; Str,
&gt;   last_name     =&gt; Optional[Str],
&gt;   age           =&gt; Optional[IntRange[18]],
&gt;   gender        =&gt; Optional[
&gt;                      Enum[qw/ mail femaile id_rather_not_to_say /]
&gt;                    ],
&gt;   tags          =&gt; Optional[ArrayRef[Str]],
&gt;   hobbies       =&gt; Optional[
&gt;                      ArrayRef[
&gt;                        Enum[qw/ hiking travelling surfing laziness /]
&gt;                      ]
&gt;                    ],
&gt;   score         =&gt; Optional[HashRef[PositiveOrZeroInt]],
&gt;   monthly_score =&gt; Optional[
&gt;                      HashRef[
&gt;                        HashRef[
&gt;                          ArrayRef-&gt;where&#40;&#39;@$_ &lt; 12&#39;&#41;
&gt;                        ]
&gt;                      ]
&gt;                    ]
&gt; ];
&gt; 
&gt; 
&gt; 
&gt; The main advantage that Validate::Simple seems to offer is that
&gt; Type::Tiny is geared towards giving a single result about whether the
&gt; supplied data is valid or not as a whole, while Validate::Simple will
&gt; drill down into the data to figure out why it&#39;s not valid, which might
&gt; be more useful when, say, reporting errors from a form someone has
&gt; filled out.
&gt; 
&gt; If there were a simple way to build a fast Type::Tiny object from
&gt; Validate::Simple &#40;or vice versa, in fact&#41; then people could use the
&gt; fast Type::Tiny check to check whether a data is valid or not, then
&gt; fall back to Validate::Simple to report the errors if there are any.
&gt; 
&gt; Of course, in many situations, validation speed is not an issue, like
&gt; if you&#39;re validating a smallish JSON structure you&#39;ve been posted via
&gt; HTTP, then the network and HTTP stuff is probably your app&#39;s
&gt; bottleneck, and not data validation.
</div>

Well, it is slow, because it uses Data::Types under the hood, which, in turn, uses regular expressions to validate numbers. I briefly looked inside Type::Tiny, and as far as I understand, it uses either XS, or some Moose magic. No surprise, VS is slower.

I want it to be faster, but as you mentioned, validation is not a bottleneck &#40;yet?&#41;, so it is not a priority.

Let me tell you how this module appeared.

I work on some REST API, and I need to validate input JSON, or query string params. At the beginning it was quite straight forward, and I started with a bunch of functions to validate single values. Then I realized, that client developers work much faster &#40;and ask much less questions&#41;, if they have a specification of expected structure in the response, so for each object I created a spec. The specs can be retrieved from the API by providing &#39;_desc&#39; as an object ID. Of course, they were JSON-like structured. While adding new requests and/or params, I noticed, that I can actually reuse the specs for client side developers to unify validation. This is how the very first versions of VS appeared. Then I started to report all issues in the request, and client side devs really loved that.

On the other hand, the objects returned by API also required some validation and modification. The very common issue was to return booleans. Another issue was about proper numeric values. Some clients can be too strict and will make a difference between &#39;{&#34;number&#34;:&#34;10&#34;}&#39; and &#39;{&#34;number&#34;:10}&#39;. I had to make sure that in resulting JSON certain fields had &#39;true|false&#39; values, and numbers were actual numbers, not strings with digits. And, of course, all required fields were there, and no unwanted fields.

So I have another module which uses similar specifications to validate output and cast values to proper types. Specs for responses have &#39;boolean&#39; type and have a &#39;description&#39; field. They also may have custom types. For example, if one needs to describe a team of devs, the structure would look like &#40;I&#39;m omitting verbose spec per field&#41;:

{
    id =&gt; &#39;positive_int&#39;,
    name =&gt; &#39;string&#39;,
    team_lead_id =&gt; &#39;positive_int&#39;,
    team_lead_name =&gt; &#39;string&#39;,
    devs =&gt; {
        type =&gt; &#39;array&#39;,
        of =&gt; &#39;developer&#39;,
    }
}

and then &#39;developer&#39; has its own spec:

{
    id =&gt; &#39;positive_int&#39;,
    first_name =&gt; &#39;string&#39;,
    last_name =&gt; &#39;string&#39;,
    skills =&gt; {
        type =&gt; &#39;array&#39;,
        of =&gt; &#39;skill&#39;,
    }
}

Skills, in turn, can be either &#39;enum&#39;, or another complex object with id, name, score, etc.

This also explains, why the specs are so ugly^Wverbose.

I extracted only the simplest part of validation to the VS module. I am going to add a bunch of features to it and then replace with it the mess I have in my API.

First off, I want to simplify specs. Like, instead of &#34;{ id =&gt; { type =&gt; &#39;positive_int&#39; } }&#34; it could simply be &#34;{ id =&gt; &#39;positive_int&#39; }&#34;, and instead of &#34;{ skills =&gt; { type =&gt; &#39;array&#39;, of =&gt; &#39;string&#39; } }&#34; it would be &#34;{ skills =&gt; &#39;array&lt;string&gt;&#39; }&#34;.

Second, I want to add type &#39;object&#39;. It&#39;s like a &#39;Dict&#39; in T:T. At the moment it&#39;s possible only by doing something like that: &#34;{ object =&gt; { type =&gt; &#39;hash&#39;, of =&gt; &#39;any&#39;, callback =&gt; $coderef } }&#34;.

I also want to have an ability to add types.

So, about the speed and transforming specs into Type::Tiny, or vice versa. In order to do that both structures must be isomorphic. With some callbacks, I believe, it&#39;s possible. Not sure, it will be fast enough.

On the other hand, now I am thinking about replacing Data::Types with Type::Tiny to validate primitive types as an intermediate step, before I have my own XS. :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1877409" href="/Public/Bug/Display.html?id=131336#txn-1877409">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;02&nbsp;22:43:00&nbsp;2020</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1878111" href="/Public/Bug/Display.html?id=131336#txn-1878111">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;07&nbsp;15:48:12&nbsp;2020</span>
    <span class="description">perl [...] toby.ink -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1878111/1007830/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1007830">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 268b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Type::Tiny doesn&#39;t require XS; its only non-core dependency is Exporter::Tiny &#40;which used to be bundled, but got split out&#41;. It will use Type::Tiny::XS if it&#39;s installed, and this can make some type checks faster.

It doesn&#39;t use Moose either, though Moose can use it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1893354" href="/Public/Bug/Display.html?id=131336#txn-1893354">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;13&nbsp;02:34:36&nbsp;2020</span>
    <span class="description">ANDREIP [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1893354/1015223/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1015223">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 109b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">It&#39;s much faster now. Will be even faster, when I replace Data::Types &#40;regexp-based&#41; with something XS-based.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1893356" href="/Public/Bug/Display.html?id=131336#txn-1893356">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;13&nbsp;02:34:37&nbsp;2020</span>
    <span class="description">ANDREIP [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1893358" href="/Public/Bug/Display.html?id=131336#txn-1893358">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;13&nbsp;02:34:38&nbsp;2020</span>
    <span class="description">ANDREIP [...] cpan.org -  Fixed in v0.3.0 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.383634</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
