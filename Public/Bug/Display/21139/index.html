<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #21139 for Module-Install: requires&#40;&#41; fails if the requirement has dependencies during non-CPAN install</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #21139 for Module-Install: requires&#40;&#41; fails if the requirement has dependencies during non-CPAN install</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Module-Install/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Module-Install/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Module-Install/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Module-Install/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Module-Install">Module-Install CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">21139</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Module-Install/Active/">Module-Install</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
mschwern [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-21632-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.63    </td>
  </tr>
  <tr id="CF-21633-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;22&nbsp;18:51:46&nbsp;2006</span>
    <span class="description">mschwern [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> requires&#40;&#41; fails if the requirement has dependencies.</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The attached Makefile.PL and output illustrates the problem.  When using
MI, if your dependencies have unresolved dependencies the build for the
dependency is considered a failure.  This does not occur when simply
installing the dependency under the CPAN shell.

In my environment I do not have File::Find::Rule nor Number::Compare
installed to trigger the bug.  I&#39;ve tried it also on Test::Dependencies
&#40;lacking it and File::Find::Rule&#41; and JSAN::Client &#40;lacking it and
HTML::Location&#41;.

I noticed this bug because I am unable to install anything which depends
on Test::Dependencies without first manually installing TD.  This
includes Class::Accessor::Named.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> mi_require_failure.txt</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">0 windhund ~/tmp/Foo-Bar$ perl Makefile.PL
include /Users/schwern/tmp/Foo-Bar/inc/Module/Install.pm
include inc/Module/Install/Metadata.pm
include inc/Module/Install/Base.pm
include inc/Module/Install/AutoInstall.pm
include inc/Module/Install/Include.pm
include inc/Module/AutoInstall.pm
*** Module::AutoInstall version 1.02
*** Checking for Perl dependencies...
[Core Features]
- File::Find::Rule ...missing.
==&gt; Auto-install the 1 mandatory module&#40;s&#41; from CPAN? [y] 
CPAN: File::HomeDir loaded ok
*** Dependencies will be installed the next time you type &#39;make&#39;.
    &#40;You may need to do that as the &#39;root&#39; user.&#41;
*** Module::AutoInstall configuration finished.
include inc/Module/Install/Makefile.pm
include inc/Module/Install/WriteAll.pm
Writing META.yml
include inc/Module/Install/Win32.pm
include inc/Module/Install/Can.pm
include inc/Module/Install/Fetch.pm
Warning: prerequisite File::Find::Rule 0 not found.
Writing Makefile for Foo::Bar
0 windhund ~/tmp/Foo-Bar$ sudo make
/usr/bin/perl &#34;-Iinc&#34; Makefile.PL --config= --installdeps=File::Find::Rule,0
include /Users/schwern/tmp/Foo-Bar/inc/Module/Install.pm
include inc/Module/Install/Metadata.pm
include inc/Module/Install/Base.pm
include inc/Module/Install/AutoInstall.pm
include inc/Module/Install/Include.pm
include inc/Module/AutoInstall.pm
*** Installing dependencies...
CPAN: File::HomeDir loaded ok
*** Installing File::Find::Rule...
CPAN: Storable loaded ok
Going to read /var/local/cpan_shell/Metadata
  Database was generated on Tue, 22 Aug 2006 02:32:34 GMT
Running install for module File::Find::Rule
Running make for R/RC/RCLAMP/File-Find-Rule-0.30.tar.gz
CPAN: Digest::SHA loaded ok
CPAN: Module::Signature loaded ok
WARNING: This key is not certified with a trusted signature!
Primary key fingerprint: 2E66 557A B97C 19C7 91AF  8E20 328D A867 450F 89EC
Signature for /var/local/cpan_shell/sources/authors/id/R/RC/RCLAMP/CHECKSUMS ok
CPAN: Compress::Zlib loaded ok
Checksum for /var/local/cpan_shell/sources/authors/id/R/RC/RCLAMP/File-Find-Rule-0.30.tar.gz ok
Scanning cache /var/local/cpan_shell/build for sizes
File-Find-Rule-0.30/
File-Find-Rule-0.30/t/
File-Find-Rule-0.30/t/lib/
File-Find-Rule-0.30/t/lib/File/
File-Find-Rule-0.30/t/lib/File/Find/
File-Find-Rule-0.30/t/lib/File/Find/Rule/
File-Find-Rule-0.30/t/lib/File/Find/Rule/Test/
File-Find-Rule-0.30/t/lib/File/Find/Rule/Test/ATeam.pm
File-Find-Rule-0.30/t/foobar
File-Find-Rule-0.30/t/File-Find-Rule.t
File-Find-Rule-0.30/t/findrule.t
File-Find-Rule-0.30/findrule
File-Find-Rule-0.30/META.yml
File-Find-Rule-0.30/lib/
File-Find-Rule-0.30/lib/File/
File-Find-Rule-0.30/lib/File/Find/
File-Find-Rule-0.30/lib/File/Find/Rule.pm
File-Find-Rule-0.30/lib/File/Find/Rule/
File-Find-Rule-0.30/lib/File/Find/Rule/Extending.pod
File-Find-Rule-0.30/lib/File/Find/Rule/Procedural.pod
File-Find-Rule-0.30/Changes
File-Find-Rule-0.30/MANIFEST
File-Find-Rule-0.30/README
File-Find-Rule-0.30/Makefile.PL
File-Find-Rule-0.30/Build.PL
Removing previously used /var/local/cpan_shell/build/File-Find-Rule-0.30
Package came without SIGNATURE

CPAN: Module::Build loaded ok

  CPAN.pm: Going to build R/RC/RCLAMP/File-Find-Rule-0.30.tar.gz

Checking whether your kit is complete...
Looks good

Checking prerequisites...
 - ERROR: Number::Compare is not installed

ERRORS/WARNINGS FOUND IN PREREQUISITES.  You may wish to install the versions
of the modules indicated above before proceeding with this installation

Creating new &#39;Build&#39; script for &#39;File-Find-Rule&#39; version &#39;0.30&#39;
CPAN: YAML loaded ok
---- Unsatisfied dependencies detected during [R/RC/RCLAMP/File-Find-Rule-0.30.tar.gz] -----
    Number::Compare
Running Build test
  Delayed until after prerequisites
Running Build install
  Delayed until after prerequisites
*** File::Find::Rule installation failed.
*** Module::AutoInstall installation finished.
0 windhund ~/tmp/Foo-Bar$ </div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Makefile.PL</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">use inc::Module::Install;

name		&#39;Foo-Bar&#39;;
version		123;
requires	&#39;File::Find::Rule&#39;;
license         &#39;perl&#39;;
auto_install&#40;&#41;;
&#38;WriteAll;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;22&nbsp;18:53:22&nbsp;2006</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">PS  CPAN shell 1.87  MakeMaker 6.30.  perl 5.8.6
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;22&nbsp;18:53:23&nbsp;2006</span>
    <span class="description">mschwern [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;22&nbsp;21:22:11&nbsp;2006</span>
    <span class="description">mschwern [...] cpan.org -  Subject changed from &#39;requires&#40;&#41; fails if the requirement has dependencies.&#39; to &#39;requires&#40;&#41; fails if the requirement has dependencies during non-CPAN install&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;22&nbsp;21:23:19&nbsp;2006</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The problem only occurs if the Makefile.PL is run from the command line.
 Otherwise AI allows the CPAN shell to do the installation and
everything runs fine.

PS  CPANPLUS is not installed.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;23&nbsp;01:26:16&nbsp;2006</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixed it.  The issue is that the CPAN.pm docs lie. 
CPAN::Shell-&gt;install&#40;$module&#41; is not the same as
CPAN::Shell-&gt;expand&#40;Module =&gt; $mod&#41;-&gt;install.  CPAN::Shell-&gt;install is
different from CPAN::Distribution-&gt;install.  See rt.cpan.org 21144.

The fix is to have AutoInstall use CPAN::Shell-&gt;install.

Jesse has given me commit rights on the modinstall openfoundry
repository so I&#39;m going to commit this.

--- lib/Module/AutoInstall.pm   &#40;revision 17334&#41;
+++ lib/Module/AutoInstall.pm   &#40;local&#41;
@@ -465,9 +465,9 @@
                 delete $INC{$inc};
             }
 
-            $obj-&gt;force&#40;&#39;install&#39;&#41; if $args{force};
-
-            my $rv = $obj-&gt;install || eval {
+            my $rv = $args{force} ? CPAN::Shell-&gt;force&#40; install =&gt; $pkg &#41;
+                                  : CPAN::Shell-&gt;install&#40;$pkg&#41;;
+            $rv ||= eval {
                 $CPAN::META-&gt;instance&#40; &#39;CPAN::Distribution&#39;,
$obj-&gt;cpan_file, &#41;
                   -&gt;{install}
                   if $CPAN::META;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;07&nbsp;01:57:36&nbsp;2010</span>
    <span class="description">ishigaki [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Closed as this patch has already been applied. Thanks.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;07&nbsp;01:57:39&nbsp;2010</span>
    <span class="description">ishigaki [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
