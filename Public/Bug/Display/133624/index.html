<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #133624 for Lyrics-Fetcher: PATCH to merge working fetcher modules + numerous fixes/updates</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #133624 for Lyrics-Fetcher: PATCH to merge working fetcher modules + numerous fixes/updates</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Lyrics-Fetcher/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Lyrics-Fetcher/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Lyrics-Fetcher/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Lyrics-Fetcher/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Lyrics-Fetcher">Lyrics-Fetcher CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">133624</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Lyrics-Fetcher/Active/">Lyrics-Fetcher</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">davidp [...] preshweb.co.uk
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
turnerjw784 [...] yahoo.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-19690-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.5.2    </td>
  </tr>
  <tr id="CF-19691-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.5.2    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;28&nbsp;23:01:25&nbsp;2020</span>
    <span class="description">turnerjw784 [...] yahoo.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> PATCH to merge working fetcher modules + numerous fixes/updates</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Greetings again, David,

        Since you merged my new/updated Lyrics::Fetcher modules &#40;it looks like you forgot to add Musixmatch to CPAN, btw&#41;, I&#39;ve had a chance to do a ton of real-world testing &#40;by merging them into my Fauxdacious media player&#39;s lyrics plugins and streaming radio stations through it&#41;.  Anyway, I&#39;ve found and fixed several issues, mostly involving correctly formatting exceptional artist and song titles.  One issue that you might notice is that I modified it to keep single blank lines &#40;for paragraphs&#41; between lyrics text &#40;but still merge multiple ones into a single one&#41;, and also use &#34;\r\n&#34; for M$-Windows systems and &#34;\n&#34; for Linux/Unix, etc.

        I&#39;ve also taken the liberty to merge the 3 known-working modules together into Lyrics::Fetcher and Cache, added an agent&#40;&#41; method, and cleaned up / unified the code, particularly the POD documentation &#40;I didn&#39;t change the content, just added the new stuff &#38; mostly formatting and trying to make the three modules look and read as similar as possible and follow your coding conventions&#41;.  I&#39;ve created a single tarball for Lyrics::Fetcher which will install it and the three working modules together in a single install for the user, and assigns the same version# to each &#40;in this case v1.00&#41;, and updated the README &#38; CHANGES files to reflect this.  Users should still be able to install and / or use the submodules independently, and you or I can add / merge new ones.  This is how my &#34;StreamFinder&#34; module works - it has a &#34;fetcher&#34; submodule for each currently supported streaming site bundled in and I have added and removed sites/submodules regularly as needed, but one can install it as one bundle, but can either use the main module or any one of the submodules as desired &#40;you can view / get it on CPAN&#41;.

        The reason for all this is is that I&#39;ve found it challenging to go search CPAN to locate &#38; determine which additional Lyrics::Fetcher-ish modules I need to install to get lyrics working, so in my instructions for installing and using Fauxdacious media player, I want to be able to tell my users that they simply need to install Lyrics::Fetcher in order for the Lyrics plugins to work for them without having to figure out which sites still work and which to install.  In my &#34;helper&#34; script that the plugins use, I have it seemlessly try each of the &#34;available&#34; fetchers in random order until lyrics are found or all &#40;currently 3&#41; fetchers are exhausted.  Also, if a user finds they need to change the user agent later on, either they &#40;or I - in my helper script&#41; can change it and it will apply to all the fetchers.

        Anyway, please review what I&#39;ve done and let me know what you think, any other ideas, suggestions, or fixes, or just want to use it for your next version. ;&#41;

        Also, you can close out the prev. bug# 
        If you&#39;re interested in how I&#39;m using this now in Fauxdacous, please see:  <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/wildstar84/fauxdacious-plugins/commit/f33d6b88ed52b302921d6ba6df4ff88a443ce3db">https://github.com/wildstar84/fauxdacious-plugins/commit/f33d6b88ed52b302921d6ba6df4ff88a443ce3db</a></span> where I mentioned you and Lyrics::Fetcher, <span class="clickylink"><a target="new" rel="nofollow" href="https://wildstar84.github.io/fauxdacious/FAQ.htm#37">https://wildstar84.github.io/fauxdacious/FAQ.htm#37</a></span> or the main site: <span class="clickylink"><a target="new" rel="nofollow" href="https://wildstar84.wordpress.com/fauxdacious/">https://wildstar84.wordpress.com/fauxdacious/</a></span>  Also see what led to this here!:  <span class="clickylink"><a target="new" rel="nofollow" href="https://redmine.audacious-media-player.org/boards/1/topics/2389">https://redmine.audacious-media-player.org/boards/1/topics/2389</a></span>  Oh, and here&#39;s my &#34;helper&#34; script that calls your modules from within the media player: <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/wildstar84/fauxdacious/blob/master/contrib/FauxdaciousLyricsHelper.pl">https://github.com/wildstar84/fauxdacious/blob/master/contrib/FauxdaciousLyricsHelper.pl</a></span>

        Thanks again for doing the heavy lifting creating this handy set of modules!

Jim Turner
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Lyrics-Fetcher-1.00.tar.gz</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;31&nbsp;14:11:06&nbsp;2020</span>
    <span class="description">turnerjw784 [...] yahoo.com -  Given to BIGPRESH</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people DelWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;31&nbsp;14:11:07&nbsp;2020</span>
    <span class="description">turnerjw784 [...] yahoo.com -  Requestor TURNERJW deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;31&nbsp;14:12:11&nbsp;2020</span>
    <span class="description">turnerjw784 [...] yahoo.com -  Requestor TURNERJW added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;01&nbsp;17:10:12&nbsp;2020</span>
    <span class="description">davidp [...] preshweb.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Hi Jim,

Many thanks for all your work!

I plan to find time to review this all this week.


On 2020-10-29 03:01:25, TURNERJW wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Since you merged my new/updated Lyrics::Fetcher modules &#40;it looks like
&gt; you forgot to add Musixmatch to CPAN, btw&#41;,
</div>
Yeah, I wanted to do a bit more testing first, but had a busy week - will get that out there soon.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve had a chance to do a
&gt; ton of real-world testing &#40;by merging them into my Fauxdacious media
&gt; player&#39;s lyrics plugins and streaming radio stations through it&#41;.
&gt; Anyway, I&#39;ve found and fixed several issues, mostly involving
&gt; correctly formatting exceptional artist and song titles.  One issue
&gt; that you might notice is that I modified it to keep single blank lines
&gt; &#40;for paragraphs&#41; between lyrics text &#40;but still merge multiple ones
&gt; into a single one&#41;, and also use &#34;\r\n&#34; for M$-Windows systems and
&gt; &#34;\n&#34; for Linux/Unix, etc.
</div>
Excellent!
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve also taken the liberty to merge the 3 known-working modules
&gt; together into Lyrics::Fetcher and Cache, [...]
&gt; I&#39;ve created  a single tarball for Lyrics::Fetcher which will 
&gt; install it and the three working modules together in a single
&gt; install for the user, 
</div>
I&#39;m not entirely convinced I want to bundle the fetcher modules with Lyrics::Fetcher - I&#39;d prefer each fetcher to remain its own CPAN distribution which can be updated independently, CI tested individually etc.  I do understand the convenience of being able to quickly install L::F and all the &#34;supported&#34; fetchers easily though.  What about if I added a Bundle::Lyrics::Fetcher which installs Lyrics::Fetcher and the Lyrics::Fetcher fetcher distributions which are known to work at that time?


Also, for future contributions, if you&#39;re not averse to GitHub, then pull requests on GitHub would be really handy: <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/bigpresh?tab=repositories&#38;q=lyrics">https://github.com/bigpresh?tab=repositories&#38;q=lyrics</a></span>

Of course, I&#39;m quite happy to accept patches via RT too if that works better for you!

Cheers

David P &#40;BIGPRESH
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;01&nbsp;17:10:13&nbsp;2020</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;02&nbsp;10:38:22&nbsp;2020</span>
    <span class="description">turnerjw784 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">If you want to create a Bundle:: module, that&#39;d work for me.  I just need a way to make installation simple for my users, most of whom will likely not be familiar with CPAN or Perl  &#40;I already compile the 2 existing Perl &#34;helper&#34; scripts this project uses into .exe binaries for the Windows version!&#41;.  From my project&#39;s point of view, fetching lyrics is a single function concept and isn&#39;t concerned with which lyrics site is sourced &#40;why I added a &#34;random&#34; option, and the agent&#40;&#41; function which can set the user-agent for all the submodules at once&#41;, similar to my &#34;StreamFinder&#34; module &#40;written for this same project&#41; is for fetching online radio stations, podcasts, and videos.

I&#39;m fine with using GitHub too &#40;My Fauxdacious project, etc. are also there&#41;.  I wasn&#39;t sure you were still updating it there though.  When I was touching up the POD documentation, I only found it referenced in the main L::F module itself, not the others &#40;you may want to copy &#38; adjust that part of the POD into the others&#41;.

I didn&#39;t actually change a whole lot, even though the diffs will look like I rewrote it all, mostly due to my attempts to line up the code format and POD docs between all the modules, so I could check myself by being able to diff the three site-specific modules against eachother to ensure I had everything in all of them and that they worked the same way and that the POD was all updated and consistant.

If you&#39;re a Linux user &#40;I&#39;m not going to rebuild the Windows binary untill all this is settled&#41;, feel free to grab and build the latest Fauxdacious from beta from Github, and try out the Lyric plugins and see how well this is working!

I only took a cursory look at the &#34;Cache&#34; module&#39;s code as I&#39;m not really sure what it&#39;s supposed to do &#40;I don&#39;t have it&#39;s prerequisites installed&#41;, so I didn&#39;t touch it.  I also considered the other sites you cover that I found on CPAN &#40;LyrDB, AstraWeb, and LyricsDownload&#41; to see if I could update them as well, but those sites appear to now also be defunct, so at this time, I only know of 3 that still work &#40;the ones I sent you&#41;.  As I&#39;ve found with StreamFinder, sites seem to come and go, change their HTML, and often deliberately make themselves hard or impossible to scrape &#40;javascript, CloudFlare, cookies, etc&#41;.

Thanks again!

Jim


 
On Sun Nov 01 17:10:12 2020, BIGPRESH wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Hi Jim,
&gt; 
&gt; Many thanks for all your work!
&gt; 
&gt; I plan to find time to review this all this week.
&gt; 
&gt; 
&gt; On 2020-10-29 03:01:25, TURNERJW wrote:
<div class="message-stanza open">&gt; &gt; Since you merged my new/updated Lyrics::Fetcher modules &#40;it looks
&gt; &gt; like
&gt; &gt; you forgot to add Musixmatch to CPAN, btw&#41;,
</div>&gt; 
&gt; Yeah, I wanted to do a bit more testing first, but had a busy week -
&gt; will get that out there soon.
&gt; 
<div class="message-stanza open">&gt; &gt; I&#39;ve had a chance to do a
&gt; &gt; ton of real-world testing &#40;by merging them into my Fauxdacious media
&gt; &gt; player&#39;s lyrics plugins and streaming radio stations through it&#41;.
&gt; &gt; Anyway, I&#39;ve found and fixed several issues, mostly involving
&gt; &gt; correctly formatting exceptional artist and song titles.  One issue
&gt; &gt; that you might notice is that I modified it to keep single blank
&gt; &gt; lines
&gt; &gt; &#40;for paragraphs&#41; between lyrics text &#40;but still merge multiple ones
&gt; &gt; into a single one&#41;, and also use &#34;\r\n&#34; for M$-Windows systems and
&gt; &gt; &#34;\n&#34; for Linux/Unix, etc.
</div>&gt; 
&gt; Excellent!
&gt; 
<div class="message-stanza open">&gt; &gt; I&#39;ve also taken the liberty to merge the 3 known-working modules
&gt; &gt; together into Lyrics::Fetcher and Cache, [...]
&gt; &gt;  I&#39;ve created  a single tarball for Lyrics::Fetcher which will
&gt; &gt; install it and the three working modules together in a single
&gt; &gt;  install for the user,
</div>&gt; 
&gt; I&#39;m not entirely convinced I want to bundle the fetcher modules with
&gt; Lyrics::Fetcher - I&#39;d prefer each fetcher to remain its own CPAN
&gt; distribution which can be updated independently, CI tested
&gt; individually etc.  I do understand the convenience of being able to
&gt; quickly install L::F and all the &#34;supported&#34; fetchers easily though.
&gt; What about if I added a Bundle::Lyrics::Fetcher which installs
&gt; Lyrics::Fetcher and the Lyrics::Fetcher fetcher distributions which
&gt; are known to work at that time?
&gt; 
&gt; 
&gt; Also, for future contributions, if you&#39;re not averse to GitHub, then
&gt; pull requests on GitHub would be really handy:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/bigpresh?tab=repositories&#38;q=lyrics">https://github.com/bigpresh?tab=repositories&#38;q=lyrics</a></span>
&gt; 
&gt; Of course, I&#39;m quite happy to accept patches via RT too if that works
&gt; better for you!
&gt; 
&gt; Cheers
&gt; 
&gt; David P &#40;BIGPRESH
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;02&nbsp;10:38:23&nbsp;2020</span>
    <span class="description">turnerjw784 [...] yahoo.com -  Fixed in 0.5.2 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;11&nbsp;11:00:08&nbsp;2020</span>
    <span class="description">davidp [...] preshweb.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Hi,

Just wanted to say I haven&#39;t forgotten this, just awaiting a moment to deal with it.

As soon as I can, I&#39;ll review your changes and get new releases out, and release a Bundle::Lyrics::Fetcher which installs the Lyrics::Fetcher core and the three known-to-work fetchers.

Cheers

Dave P &#40;BIGPRESH&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;11&nbsp;16:43:37&nbsp;2020</span>
    <span class="description">turnerjw784 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Good to here.  I got ANOTHER submodule &#40;lyrics site&#41; you can add to it as well &#40;ApiLyricsOph.pm - <span class="clickylink"><a target="new" rel="nofollow" href="https://api.lyrics.ovh">https://api.lyrics.ovh</a></span>...&#41; that&#39;s also working pretty well for me too! &#40;see attached&#41;

Jim


On Wed Nov 11 11:00:08 2020, BIGPRESH wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Hi,
&gt; 
&gt; Just wanted to say I haven&#39;t forgotten this, just awaiting a moment to
&gt; deal with it.
&gt; 
&gt; As soon as I can, I&#39;ll review your changes and get new releases out,
&gt; and release a Bundle::Lyrics::Fetcher which installs the
&gt; Lyrics::Fetcher core and the three known-to-work fetchers.
&gt; 
&gt; Cheers
&gt; 
&gt; Dave P &#40;BIGPRESH&#41;
</div></div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> ApiLyricsOph.pm</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">package Lyrics::Fetcher::ApiLyricsOph;

# $Id$

use 5.008000;
use strict;
use warnings;
use LWP::UserAgent;
use HTTP::Request;
use Carp;

my $haveLyricsFetcher = 0;
eval &#34;use Lyrics::Fetcher &#40;qw&#40;\$VERSION \$AGENT&#41;&#41;; \$haveLyricsFetcher = 1; 1&#34;;

our $VERSION = $haveLyricsFetcher
        ? $Lyrics::Fetcher::VERSION : &#39;1.00&#39;;

# the HTTP User-Agent we&#39;ll send:
our $AGENT = &#40;$haveLyricsFetcher &#38;&#38; defined $Lyrics::Fetcher::AGENT&#41;
        ? $Lyrics::Fetcher::AGENT
        : &#34;Mozilla/5.0 &#40;X11; Linux x86_64; rv:80.0&#41; Gecko/20100101 Firefox/80.0&#34;;

$Lyrics::Fetcher::Error = &#39;OK&#39;  unless &#40;$haveLyricsFetcher&#41;;

sub fetch {
    my $self = shift;
    my &#40;$artist, $song&#41; = @_;

    # reset the error var, change it if an error occurs.
    $Lyrics::Fetcher::Error = &#39;OK&#39;;

    unless &#40;$artist &#38;&#38; $song&#41; {
        carp&#40;$Lyrics::Fetcher::Error
                = &#39;fetch&#40;&#41; called without artist and song&#39;&#41;;
        return;
    }

    $artist =~ s#\s*\/.*$##;    #ONLY USE 1ST ARTIST, IF MORE THAN ONE!
    $artist =~ s/\s+/\%20/g;
    $artist =~ s/[^a-z0-9\%]//gi;

    $song   =~ s/\s+/\%20/g;
    $song   =~ s/[^a-z0-9\%]//gi;

    # Their URLs look like e.g.:
    # <span class="clickylink"><a target="new" rel="nofollow" href="https://api.lyrics.ovh/v1/Dire%20straits/heavy">https://api.lyrics.ovh/v1/Dire%20straits/heavy</a></span>%sfuel%s
    my $url = &#34;<span class="clickylink"><a target="new" rel="nofollow" href="https://api.lyrics.ovh/v1/$">https://api.lyrics.ovh/v1/$</a></span>{artist}/$song&#34;;

    my $ua = LWP::UserAgent-&gt;new&#40;
        ssl_opts =&gt; { verify_hostname =&gt; 0, },
    &#41;;
    $ua-&gt;timeout&#40;10&#41;;
    $ua-&gt;agent&#40;$AGENT&#41;;
    $ua-&gt;protocols_allowed&#40;[&#39;https&#39;]&#41;;
    $ua-&gt;cookie_jar&#40; {} &#41;;
    push @{ $ua-&gt;requests_redirectable }, &#39;GET&#39;;
    &#40;my $referer = $url&#41; =~ s{^&#40;\w+&#41;\:\/\/}{};
    my $protocol = $1;
    $referer =~ s{\/.+$}{\/};
    my $host = $referer;
    $host =~ s{\/$}{};
    $referer = $protocol . &#39;://&#39; . $referer;
    my $req = new HTTP::Request &#39;GET&#39; =&gt; $url;
    $req-&gt;header&#40;
        &#39;Accept&#39; =&gt;
            &#39;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&#39;,
        &#39;Accept-Language&#39;           =&gt; &#39;en-US,en;q=0.5&#39;,
        &#39;Accept-Encoding&#39;           =&gt; &#39;gzip, deflate&#39;,
        &#39;Connection&#39;                =&gt; &#39;keep-alive&#39;,
        &#39;Upgrade-insecure-requests&#39; =&gt; 1,
        &#39;Host&#39;                      =&gt; $host,
    &#41;;

    my $res = $ua-&gt;request&#40;$req&#41;;

    if &#40;$res-&gt;is_success&#41; {
        my $lyrics = _parse&#40;$res-&gt;decoded_content&#41;;
        return $lyrics;
    } else {
        if &#40;$res-&gt;status_line =~ /^404/&#41; {
            $Lyrics::Fetcher::Error = &#39;Lyrics not found&#39;;
            return;
        } else {
            carp&#40;$Lyrics::Fetcher::Error
                = &#34;Failed to retrieve $url &#40;&#34;.$res-&gt;status_line.&#39;&#41;&#39;&#41;;
            return;
        }
    }
}

# Allow user to specify a different user-agent:
sub agent {
    if &#40;defined $_[1]&#41; {
        $AGENT = $_[1];
    } else {
        return $AGENT;
    }
}

# Internal use only functions:

sub _parse {
    my $html = shift;

    if &#40;my &#40;$goodbit&#41; = $html =~
        m{\{\&#34;lyrics\&#34;\:\&#34;&#40;[^\&#34;]+&#41;\&#34;}msi&#41;
    {
        my $text = &#39;&#39;;
        # convert literal &#34;\&#34; followed by &#34;r&#34; or &#34;n&#34;, etc. to &#34;\r&#34; or &#34;\n&#34; characters respectively:
        eval &#34;\$text = \&#34;$goodbit\&#34;;&#34;;

        # fix apparent site bug where they use &#34;\n\n&#34; where they appear to mean &#34;\r\n&#34; &#40;excess double-lines&#41;:
        $text =~ s/\n\n/\n/gs;
        # normalize Windowsey \r\n sequences:
        $text =~ s/\r+//gs;
        # strip off pre &#38; post padding with spaces:
        $text =~ s/^ +//mg;
        $text =~ s/ +$//mg;
        # clear up repeated blank lines:
        $text =~ s/&#40;\R&#41;{2,}/\n\n/gs;
        # and remove any blank top lines:
        $text =~ s/^\R+//s;
        $text =~ s/\R\R+$/\n/s;
        $text .= &#34;\n&#34;  unless &#40;$text =~ /\n$/s&#41;;
        # now fix up for either Windows or Linux/Unix:
        $text =~ s/\R/\r\n/gs  if &#40;$^O =~ /Win/&#41;;

        return $text;
    } else {
        carp &#34;Failed to identify lyrics on result page&#34;;
        return;
    }

} # end of sub parse

1;

__END__

=head1 NAME

Lyrics::Fetcher::ApiLyricsOph - Get song lyrics from api.lyrics.ovh.

=head1 SYNOPSIS

    #!/usr/bin/perl

    use Lyrics::Fetcher;
    print Lyrics::Fetcher-&gt;fetch&#40;&#34;&lt;artist&gt;&#34;,&#34;&lt;song&gt;&#34;,&#34;ApiLyricsOph&#34;&#41;;

    # or, if you want to use this module directly without Lyrics::Fetcher&#39;s involvement:

    use Lyrics::Fetcher::ApiLyricsOph;
    print Lyrics::Fetcher::ApiLyricsOph-&gt;fetch&#40;&#34;&lt;artist&gt;&#34;, &#34;&lt;song&gt;&#34;&#41;;


=head1 DESCRIPTION

This module tries to get song lyrics from api.lyrics.ovh.  It&#39;s designed to
be called by Lyrics::Fetcher, but can be used directly if you&#39;d prefer.

=head1 INTERFACE

=over 4

=item fetch&#40;$artist, $title&#41;

Attempts to fetch the lyrics for the given artist and title from api.lyrics.ovh.

Returns lyrics as a string, or an empty string, if not found.

=item agent&#40;[$useragent_string]&#41;

Set the desired user-agent &#40;ie. browser name&#41; to pass to the lyrics sites -
some require you to look like a valid web browser in order to respond in order to
prevent their sites from being &#34;scraped&#34; by programs, such as this.  If not set,
the current default is:
&#34;Mozilla/5.0 &#40;X11; Linux x86_64; rv:80.0&#41; Gecko/20100101 Firefox/80.0&#34;

If no argument is passed, it returns the current user-agent string in effect.

=back

=head1 SPECIAL GLOBAL VARIABLES

=over 4

=item $Lyrics::Fetcher::Error

Returns a description of the last error that occurred when failing to fetch 
lyrics for various reasons, or &#34;OK&#34; if last operation successful.

=item $Lyrics::Fetcher::ApiLyricsOph::VERSION

The current version# of Lyrics::Fetcher::ApiLyricsOph

=back

=head1 BUGS

Probably.  If you find any, please let me know.  If api.lyrics.ovh change their
site much, this module may well stop working.  If you find any songs which
have lyrics listed on the api.lyrics.ovh site, but for which this module is
unable to fetch lyrics, please let me know also.  It seems that the HTML on
the lyrics pages isn&#39;t consistent, so it&#39;s entirely possible &#40;likely, in fact&#41;
that there are some pages which this script will not be able to parse.

Please report any bugs or feature requests to 
L&lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/NoAuth/ReportBug.html?Queue=Lyrics-Fetcher-ApiLyricsOph">https://rt.cpan.org/NoAuth/ReportBug.html?Queue=Lyrics-Fetcher-ApiLyricsOph</a></span>&gt;.  
I will be notified, and then you&#39;ll automatically be notified of progress on 
your bug as I make changes.

=head1 AUTHOR

David Precious C&lt;&lt; &lt;davidp@preshweb.co.uk&gt; &gt;&gt; &#40;CPAN Id: BIGPRESH&#41;

=head1 ACKNOWLEDGEMENTS

Original version contributed by Jim Turner in RT 133592.

=head1 COPYRIGHT AND LICENSE

Copyright &#40;C&#41; 2020 by David Precious

This library is free software; you can redistribute it and/or modify
it under the same terms as Perl itself, either Perl version 5.8.7 or,
at your option, any later version of Perl 5 you may have available.

Legal disclaimer: I have no connection with the owners of api.lyrics.ovh.
Lyrics fetched by this script may be copyrighted by the authors, it&#39;s up to 
you to determine whether this is the case, and if so, whether you are entitled 
to request/use those lyrics.  You will almost certainly not be allowed to use
the lyrics obtained for any commercial purposes.

=cut
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;11&nbsp;19:18:45&nbsp;2020</span>
    <span class="description">turnerjw784 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m going ahead and including a tarball of my test version &#40;now v1.01 beta&#41;, including the diffs between the first one I sent you before &#40;v1.00 beta&#41;.  It contains both the new ApiLyricsOvh.pm fetcher &#40;with the SPELLING ERROR &#40;ApiLyricsOph =&gt; ApiLyricsOvh&#41; FIXED!&#41; and some minor changes I&#39;ve had to make after much more extensive testing in Fauxdacious.  BTW, I did go ahead and build for M$-Windows &#40;with &#34;MY&#34; vsn. of L::F compiled into the Perl binaries for now - until you release your new &#34;bundle&#34;&#41; b/c I wanted to finally get this thang out!

If interested, you can get it here &#40;it&#39;s very easy to install&#41;!:  <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/wildstar84/fauxdacious-windows-easyinstaller">https://github.com/wildstar84/fauxdacious-windows-easyinstaller</a></span>  It also includes an uninstall option &#40;bin/uninst.exe&#41; so you can get rid of it if you don&#39;t want it after playing with it.

Thanks,

Jim


On Wed Nov 11 16:43:37 2020, TURNERJW wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Good to here.  I got ANOTHER submodule &#40;lyrics site&#41; you can add to it
&gt; as well &#40;ApiLyricsOph.pm - <span class="clickylink"><a target="new" rel="nofollow" href="https://api.lyrics.ovh">https://api.lyrics.ovh</a></span>...&#41; that&#39;s also
&gt; working pretty well for me too! &#40;see attached&#41;
&gt; 
&gt; Jim
&gt; 
&gt; 
&gt; On Wed Nov 11 11:00:08 2020, BIGPRESH wrote:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; Hi,
&gt; &gt;
&gt; &gt; Just wanted to say I haven&#39;t forgotten this, just awaiting a moment
&gt; &gt; to
&gt; &gt; deal with it.
&gt; &gt;
&gt; &gt; As soon as I can, I&#39;ll review your changes and get new releases out,
&gt; &gt; and release a Bundle::Lyrics::Fetcher which installs the
&gt; &gt; Lyrics::Fetcher core and the three known-to-work fetchers.
&gt; &gt;
&gt; &gt; Cheers
&gt; &gt;
&gt; &gt; Dave P &#40;BIGPRESH&#41;
</div></div></div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Lyrics-Fetcher-1.01.tar</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
