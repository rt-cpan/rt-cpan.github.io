<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #70695 for Git-FastExport: git-stitch-repo creates unnecessary branches when joining two repositories</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #70695 for Git-FastExport: git-stitch-repo creates unnecessary branches when joining two repositories</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Git-FastExport/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Git-FastExport/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Git-FastExport/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Git-FastExport/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Git-FastExport">Git-FastExport CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">70695</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Git-FastExport/Active/">Git-FastExport</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jamesblackburn [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-222690-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-222691-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;02&nbsp;07:20:23&nbsp;2011</span>
    <span class="description">jamesblackburn [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> git-stitch-repo creates unnecessary branches when joining two repositories</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 2 Sep 2011 12:20:14 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Git-FastExport [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> James Blackburn &lt;jamesblackburn [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I have a test case of two repositories which, when stitched appears to
have unnecessary / confusing branching.

Reproduction steps:

git clone git://github.com/jamesblackburn/org.eclipse.cdt.dsf.git
git clone git://github.com/jamesblackburn/org.eclipse.cdt.dsf.ui.git
mkdir stitched
cd stitched
git init
git-stitch-repo ../org.eclipse.cdt.dsf:dsf/org.eclipse.cdt.dsf
../org.eclipse.cdt.dsf.ui:dsf/org.eclipse.cdt.dsf.ui |git fast-import

If you look at these two repos with gitk --all, nearly all the commits
are on the mainline master branch.  There are a couple of side
branches which are tagged.
Importantly &#40;for me&#41; all the 3.X-X tags are on the master branch.

Having stitched the repo I end up with a more complicated history:
 - both masters are now on two different branches
 - the 3.X-X tags are on different branches
The result is I can&#39;t unify the tags / branches.

If you remove the side branches by removing the tags:
cd ../org.eclipse.cdt.dsf.ui/
for tag in `git tag -l v20*` ; do git tag -d $tag ; done
git tag -d CDT_6_0_0 CDT_6_0_2

cd ../org.eclipse.cdt.dsf/
for tag in `git tag -l v20*` ; do git tag -d $tag ; done
git tag -d CDT_6_0_0 CDT_6_0_2

Then restitching gives nicely linear history. &#40;I just noticed that
only the two tags: CDT_6_0_0 CDT_6_0_2 are needed to reproduce this
odd behaviour.&#41;

Any ideas on what might be the cause of this?
Cheers,
James
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;02&nbsp;07:27:09&nbsp;2011</span>
    <span class="description">jamesblackburn [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [rt.cpan.org #70695] AutoReply: git-stitch-repo creates unnecessary branches when joining two repositories</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 2 Sep 2011 12:27:01 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Git-FastExport [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> James Blackburn &lt;jamesblackburn [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Git-FastExport: 0.0.7 &#40;and master from github:
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/book/Git-FastExport&#41;">https://github.com/book/Git-FastExport&#41;</a></span>
Perl version: 5.8.8
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;02&nbsp;08:32:20&nbsp;2011</span>
    <span class="description">jamesblackburn [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #70695] AutoReply: git-stitch-repo creates unnecessary branches when joining two repositories</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 2 Sep 2011 13:32:13 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Git-FastExport [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> James Blackburn &lt;jamesblackburn [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This may just be user error...

Perhaps I should just ignore the tags / branches marked -N. I was just
confused by them appearing when otherwise the tags are re-joined in
the stitched repo.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;02&nbsp;09:45:57&nbsp;2011</span>
    <span class="description">jamesblackburn [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #70695] AutoReply: git-stitch-repo creates unnecessary branches when joining two repositories</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 2 Sep 2011 14:45:48 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Git-FastExport [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> James Blackburn &lt;jamesblackburn [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hmm I think it definitely is producing broken output. Having done the
steps above:

git diff --dirstat master master-A
   3.8% dsf/org.eclipse.cdt.dsf.ui/src/org/eclipse/cdt/dsf/debug/internal/ui/actions/
  21.7% dsf/org.eclipse.cdt.dsf.ui/src/org/eclipse/cdt/dsf/debug/internal/ui/disassembly/
   4.0% dsf/org.eclipse.cdt.dsf.ui/src/org/eclipse/cdt/dsf/debug/internal/ui/viewmodel/
   5.8% dsf/org.eclipse.cdt.dsf.ui/src/org/eclipse/cdt/dsf/debug/internal/ui/
   6.6% dsf/org.eclipse.cdt.dsf.ui/src/org/eclipse/cdt/dsf/debug/ui/viewmodel/breakpoints/
   3.5% dsf/org.eclipse.cdt.dsf.ui/src/org/eclipse/cdt/dsf/debug/ui/viewmodel/expression/
   4.4% dsf/org.eclipse.cdt.dsf.ui/src/org/eclipse/cdt/dsf/debug/ui/viewmodel/launch/
   5.4% dsf/org.eclipse.cdt.dsf.ui/src/org/eclipse/cdt/dsf/debug/ui/viewmodel/numberformat/
   3.2% dsf/org.eclipse.cdt.dsf.ui/src/org/eclipse/cdt/dsf/debug/ui/viewmodel/variable/
   4.7% dsf/org.eclipse.cdt.dsf.ui/src/org/eclipse/cdt/dsf/debug/ui/viewmodel/
   3.8% dsf/org.eclipse.cdt.dsf.ui/src/org/eclipse/cdt/dsf/debug/ui/
   4.0% dsf/org.eclipse.cdt.dsf.ui/src/org/eclipse/cdt/dsf/ui/viewmodel/update/
   4.9% dsf/org.eclipse.cdt.dsf.ui/src/org/eclipse/cdt/dsf/ui/viewmodel/
   7.4% dsf/org.eclipse.cdt.dsf/src/org/eclipse/cdt/dsf/concurrent/
   9.6% dsf/org.eclipse.cdt.dsf/src/org/eclipse/cdt/dsf/debug/service/
   3.7% dsf/org.eclipse.cdt.dsf/src/org/eclipse/cdt/dsf/

So master doesn&#39;t contain all the changes from org.eclipse.cdt.dsf.ui
and org.eclipse.cdt.dsf.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;06&nbsp;18:13:49&nbsp;2011</span>
    <span class="description">book [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Sep 02 09:45:57 2011, jamesblackburn@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hmm I think it definitely is producing broken output. Having done the
&gt; steps above:
&gt; 
</div>
Thanks for the very complete report.

I haven&#39;t found time yet to reproduce your steps, and it&#39;s been a
while since I coded this.

I will try to find some time, and make an opinion on the issue.

Thanks again,

-- BooK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;06&nbsp;18:13:49&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;19&nbsp;19:33:41&nbsp;2014</span>
    <span class="description">book [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Sep 06 18:13:49 2011, BOOK wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri Sep 02 09:45:57 2011, jamesblackburn@gmail.com wrote:
<div class="message-stanza open">&gt; &gt; Hmm I think it definitely is producing broken output. Having done the
&gt; &gt; steps above:
&gt; &gt; 
</div>&gt; 
&gt; Thanks for the very complete report.
&gt; 
&gt; I haven&#39;t found time yet to reproduce your steps, and it&#39;s been a
&gt; while since I coded this.
&gt; 
&gt; I will try to find some time, and make an opinion on the issue.
</div>
I finally took a little time to look at the issue.

The core of the issue is how git-stitch-repo selects where to
attach a commit. At some point it picks the &#34;wrong&#34; branch
&#40;i.e. not master&#41; on repo B to attach a commit from repo A&#39;s master.
After that, it is impossible to reconnect both histories.

Right now, the algorithm for attaching commits is very coarse-grained.
If there are several options, the current options are to pick
the &#40;chronologically&#41; first or last commit from the available options,
or to pick one at random.

Debugging your repositories with first and last, I get the wrong
answer both times, because sometimes the &#34;right&#34; commit is the
first, and sometimes it&#39;s the last. Given how little information
there is when making the decision, there&#39;s very little that can
be done with the current system[*].

In the last few days, I&#39;ve been exploring a way to improve the
decision-making. This might lead to a proper fix.


-- BooK

[*] Actually, you could pick the &#34;random&#34; selection algorithm and
    repeat until the result looks right, but the likelyhood of
    it making the right choice at every point is going to be
    smaller and smaller with the size of the repositories.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;02&nbsp;16:10:30&nbsp;2015</span>
    <span class="description">dag [...] cray.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [rt.cpan.org #70695]</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 2 Jun 2015 15:07:39 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Git-FastExport [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;dag [...] cray.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I know it has been a few years since this was looked at but I just ran
into this bug with some SVN repositories converted to git.  They are
huge repositories so a proper fix for this bug is essential.  I don&#39;t
mind if the stitch takes longer due to reading through the entire
histories of the individual repositories first.  It will still be faster
than writing my own tool.  :&#41;

Was any progress ever made on this?  If there&#39;s a prototype fix I&#39;d be
happy to test it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;04&nbsp;06:22:37&nbsp;2015</span>
    <span class="description">book [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #70695]</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 4 Jun 2015 12:22:17 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;dag [...] cray.com via RT&#34; &lt;bug-Git-FastExport [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Philippe Bruhat &#40;BooK&#41;&#34; &lt;book [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, Jun 02, 2015 at 04:10:31PM -0400, dag@cray.com via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Git-FastExport
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=70695">https://rt.cpan.org/Ticket/Display.html?id=70695</a></span> &gt;
&gt; 
&gt; I know it has been a few years since this was looked at but I just ran
&gt; into this bug with some SVN repositories converted to git.  They are
&gt; huge repositories so a proper fix for this bug is essential.  I don&#39;t
&gt; mind if the stitch takes longer due to reading through the entire
&gt; histories of the individual repositories first.  It will still be faster
&gt; than writing my own tool.  :&#41;
&gt; 
&gt; Was any progress ever made on this?  If there&#39;s a prototype fix I&#39;d be
&gt; happy to test it.
</div>
Not much progress. I had an idea on how to deal with this, but never went
through.

I&#39;m still interested in fixing this, so we could try to work on this
together. Are the SVN repositories public?

-- 
 Philippe Bruhat &#40;BooK&#41;

 The best of intentions must still have directions.
                                    &#40;Moral from Groo The Wanderer #95 &#40;Epic&#41;&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;04&nbsp;13:25:56&nbsp;2015</span>
    <span class="description">dag [...] cray.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [rt.cpan.org #70695]</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 4 Jun 2015 12:25:37 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Git-FastExport [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;dag [...] cray.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Unfortunately, no, the repositories are private and there is no hope of
making them accessible.  Hopefully fixing James&#39; conversion would help
with my conversion so I would start there if possible.

I would be happy to test things on our repositories if a candidate
bugfix appears.  I&#39;m not sure how much I could report back other than
&#34;it works&#34; or &#34;it doesn&#39;t work&#34; and possibly a general description of
what happens.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;04&nbsp;19:17:39&nbsp;2015</span>
    <span class="description">book [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #70695]</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 5 Jun 2015 01:17:27 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;dag [...] cray.com via RT&#34; &lt;bug-Git-FastExport [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Philippe Bruhat &#40;BooK&#41;&#34; &lt;book [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Jun 04, 2015 at 01:25:57PM -0400, dag@cray.com via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Unfortunately, no, the repositories are private and there is no hope of
&gt; making them accessible.  Hopefully fixing James&#39; conversion would help
&gt; with my conversion so I would start there if possible.
</div>
I was expecting that, given your email domain. ;-&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I would be happy to test things on our repositories if a candidate
&gt; bugfix appears.  I&#39;m not sure how much I could report back other than
&gt; &#34;it works&#34; or &#34;it doesn&#39;t work&#34; and possibly a general description of
&gt; what happens.
</div>
So, the issue is that when there&#39;s a branch in repo A and we need to
attach a commit from repo B &#40;assuming the commit from B is part of the
current &#34;master&#34; branch&#41;, the candidate from A is picked mostly at random.

I turns out that if the commit from B is on the master branch and the
commit selected from A is on a dead branch &#40;i.e. not merged into the
final &#34;master&#34; for A&#41;, we end up with the master from B diverging from
the master from A. Which is not the desired outcome.

At the moment, I use a 1-pass algorithm that reads the history from both
repositories as a stream, starting from the oldest commits. But to make
the right decision at those crossroads, one needs a global overview of
the project: which branches exist in both projects &#40;and will need to be
&#34;merged&#34; together&#41;, and which commits should be part of that global
history.

I guess the first step would be to build a small repository set for
which we can reproduce the issue. The example repositories I was given
are much too big for at-a-glance analysis.

In parallel, I need to work on the &#34;second pass&#34;, which needs to record
which branches each commit belongs to. This is only relevant for branches
which exist in both repositories.

-- 
 Philippe Bruhat &#40;BooK&#41;

 All of life is a series of trades. And the more you exchange, the less you
 have to show for it.             &#40;Moral from Groo The Wanderer #4 &#40;Pacific&#41;&#41;
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
