<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #62277 for OpenOffice-OODoc: getElement does not work</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #62277 for OpenOffice-OODoc: getElement does not work</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/OpenOffice-OODoc/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/OpenOffice-OODoc/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/OpenOffice-OODoc/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/OpenOffice-OODoc/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/OpenOffice-OODoc">OpenOffice-OODoc CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">62277</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/OpenOffice-OODoc/Active/">OpenOffice-OODoc</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
r.limanowski [...] nttcable.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-24242-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-24243-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;19&nbsp;11:19:01&nbsp;2010</span>
    <span class="description">r.limanowski [...] nttcable.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> getElement does not work</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 19 Oct 2010 17:18:45 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-OpenOffice-OODoc [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Richard Limanowski &lt;r.limanowski [...] nttcable.de&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

I discovered, that the functionality of OpenOffice::OODoc::XPath
changed between versions 2.223 and 2.237 in the sense, that
a call to getElemet&#40;&#41;, which returned a value in the earlier version
returns undef in the newer version.

Please find attached a small demo consisting of:
1. test.odt - small document containing macro library
2. test.pl - script to illustrate the problem
Call it like: perl -d test.pl test.od

I do not have much experience in using your library
and ran into problems while trying to move from debian etch
to squeeze.

The code aims at replacing/extending the library by a macro &#40;attached&#41;
allowing us to save back an OpenOffice-Document using vanila
apache with webdav module.

Reagrds,

--

Richard Limanowski
NTTCable GmbH
IT
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
&lt;!DOCTYPE script:module PUBLIC &#34;-//OpenOffice.org//DTD OfficeDocument 1.0//EN&#34; &#34;module.dtd&#34;&gt;
&lt;script:module xmlns:script=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://openoffice.org/2000/script">http://openoffice.org/2000/script</a></span>&#34; script:name=&#34;nttmacro&#34; script:language=&#34;StarBasic&#34;&gt;REM  *****  BASIC  *****

Sub NttOpenDocEvent
	SaveWebDAV
	DisableDesignMode
End Sub

Sub SaveWebDAV	
Dim oDoc
Dim Dummy&#40;&#41;

oDoc = ThisComponent
&#38;apos; If ! oDoc.hasLocation&#40;&#41; then
&#38;apos; MsgBox&#40;&#38;quot;This is a new file so Save it in the normal manner. Quitting.&#38;quot;&#41;
&#38;apos; End
&#38;apos;EndIf

odoc.storeAsURL&#40;&#38;quot;&lt;FILE_NAME&gt;&#38;quot;, Dummy&#40;&#41;&#41;
&#38;apos;odoc.storeAsURL&#40;&#38;quot;file:///tmp/test123456.odt&#38;quot;, Dummy&#40;&#41;&#41;

End Sub

sub DisableDesignMode
rem ----------------------------------------------------------------------
rem Disables the design mode for the current document, allowing the user
rem to fill out formulares without manual disabling this mode.
rem Created with macro recorder...
rem ----------------------------------------------------------------------
rem
rem ----------------------------------------------------------------------
rem define variables
dim document   as object
dim dispatcher as object
rem ----------------------------------------------------------------------
rem get access to the document
document   = ThisComponent.CurrentController.Frame
dispatcher = createUnoService&#40;&#38;quot;com.sun.star.frame.DispatchHelper&#38;quot;&#41;

rem ----------------------------------------------------------------------
dim args1&#40;0&#41; as new com.sun.star.beans.PropertyValue
args1&#40;0&#41;.Name = &#38;quot;SwitchControlDesignMode&#38;quot;
args1&#40;0&#41;.Value = false

dispatcher.executeDispatch&#40;document, &#38;quot;.uno:SwitchControlDesignMode&#38;quot;, &#38;quot;&#38;quot;, 0, args1&#40;&#41;&#41;

end sub

&lt;/script:module&gt;</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl -w
use strict;
use OpenOffice::OODoc;
use OpenOffice::OODoc::XPath;
use Data::Dumper;
my $file = shift;
my $ofile = ooFile&#40;$file&#41;;
my $basic = OpenOffice::OODoc::XPath-&gt;new&#40;
    member =&gt; &#39;Basic/script-lc.xml&#39;, 
    element =&gt; &#39;library:libraries&#39;,
    file =&gt; $ofile
    &#41;;
my $elem = $basic-&gt;getElement&#40;&#39;//library:libraries&#39;&#41;;
# this yields something when using
# our     $VERSION        = 2.223;
# use     XML::Twig       3.22;
#
# but undef when using 
# our     $VERSION        = &#39;2.237&#39;;
# use     XML::Twig       3.32;
# have to supply undocumented context parameter
$elem = $basic-&gt;getElement&#40;&#39;//library:libraries&#39;, 0, $basic-&gt;{&#39;xpath&#39;}&#41;;
print &#34;why?\n&#34;;
exit&#40;0&#41;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;20&nbsp;04:15:41&nbsp;2010</span>
    <span class="description">jmgdoc [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le Mar 19 Oct 2010 11:19:01, r.limanowski@nttcable.de a écrit :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello,
&gt; 
&gt; I discovered, that the functionality of OpenOffice::OODoc::XPath
&gt; changed between versions 2.223 and 2.237 in the sense, that
&gt; a call to getElemet&#40;&#41;, which returned a value in the earlier version
&gt; returns undef in the newer version.
</div>
Hello Richard,

The wrong behavior comes from a change in the default XPath search
context, that was the whole XML part in 2.223 and that is now the root
node. This change should be transparent for every regular element but,
unfortunately, your application uses getElement&#40;&#41; in order to get the
root node itself &#40;i.e. the library:libraries element&#41;. Yes, this limit
use case should have been documented and it&#39;s not &#40;mea culpa&#41;.

However, generally speaking, getRoot&#40;&#41; is more smart and efficient than
getElement&#40;&#41; if you want to get the root element of any document member;
using getRoot&#40;&#41; you don&#39;t have to specify the name of the element name. See
<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/dist/OpenOffice-OODoc/OODoc/XPath.pod#getRoot&#40;&#41;">http://search.cpan.org/dist/OpenOffice-OODoc/OODoc/XPath.pod#getRoot&#40;&#41;</a></span>

However, if for any reason you prefer getElement&#40;&#41;, you can switch it to
the old behavior. To do so in your example, you have to put a
$basic-&gt;currentContext&#40;$basic-&gt;{xpath}&#41; instruction somewhere before
getElement&#40;&#41;. But it&#39;s not my recommendation.

Thanks for your report
Please let me know through this bug tracker if the workaround above
works for you.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;20&nbsp;04:15:42&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;20&nbsp;04:36:48&nbsp;2010</span>
    <span class="description">jmgdoc [...] cpan.org -  Severity Normal added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;20&nbsp;07:09:02&nbsp;2010</span>
    <span class="description">r.limanowski [...] nttcable.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #62277] getElement does not work</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 20 Oct 2010 13:08:50 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-OpenOffice-OODoc [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Richard Limanowski &lt;r.limanowski [...] nttcable.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello Jean-Marie,

your suggested method works for me.

Thank you very much for your explanation and engagement!

Yours,
Richard Limanowski

Am 20.10.2010 10:15, schrieb Jean-Marie Gouarné via RT:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=62277">https://rt.cpan.org/Ticket/Display.html?id=62277</a></span>&gt;
&gt;
&gt; Le Mar 19 Oct 2010 11:19:01, r.limanowski@nttcable.de a écrit :
<div class="message-stanza open">&gt;&gt; Hello,
&gt;&gt;
&gt;&gt; I discovered, that the functionality of OpenOffice::OODoc::XPath
&gt;&gt; changed between versions 2.223 and 2.237 in the sense, that
&gt;&gt; a call to getElemet&#40;&#41;, which returned a value in the earlier version
&gt;&gt; returns undef in the newer version.
</div>&gt;
&gt; Hello Richard,
&gt;
&gt; The wrong behavior comes from a change in the default XPath search
&gt; context, that was the whole XML part in 2.223 and that is now the root
&gt; node. This change should be transparent for every regular element but,
&gt; unfortunately, your application uses getElement&#40;&#41; in order to get the
&gt; root node itself &#40;i.e. the library:libraries element&#41;. Yes, this limit
&gt; use case should have been documented and it&#39;s not &#40;mea culpa&#41;.
&gt;
&gt; However, generally speaking, getRoot&#40;&#41; is more smart and efficient than
&gt; getElement&#40;&#41; if you want to get the root element of any document member;
&gt; using getRoot&#40;&#41; you don&#39;t have to specify the name of the element name. See
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/dist/OpenOffice-OODoc/OODoc/XPath.pod#getRoot&#40;&#41;">http://search.cpan.org/dist/OpenOffice-OODoc/OODoc/XPath.pod#getRoot&#40;&#41;</a></span>
&gt;
&gt; However, if for any reason you prefer getElement&#40;&#41;, you can switch it to
&gt; the old behavior. To do so in your example, you have to put a
&gt; $basic-&gt;currentContext&#40;$basic-&gt;{xpath}&#41; instruction somewhere before
&gt; getElement&#40;&#41;. But it&#39;s not my recommendation.
&gt;
&gt; Thanks for your report
&gt; Please let me know through this bug tracker if the workaround above
&gt; works for you.
&gt;
&gt;
&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;20&nbsp;09:06:38&nbsp;2010</span>
    <span class="description">jmgdoc [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
