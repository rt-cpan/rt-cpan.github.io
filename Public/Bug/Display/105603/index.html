<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #105603 for Perl-Dist-Strawberry: Strawberry does not always resolve &#39;localhost&#39; correctly &#40;may be in LWP&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #105603 for Perl-Dist-Strawberry: Strawberry does not always resolve &#39;localhost&#39; correctly &#40;may be in LWP&#41;</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Perl-Dist-Strawberry">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Perl-Dist-Strawberry">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Perl-Dist-Strawberry">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Perl-Dist-Strawberry">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Perl-Dist-Strawberry">Perl-Dist-Strawberry CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">105603</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Perl-Dist-Strawberry">Perl-Dist-Strawberry</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
rjray [...] blackperl.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-40214-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-40215-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




socket-fail.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1513451/807045/socket-fail.pl">
Wed Jul 01 18:28:33 2015 (2.3k) by rjray [...] blackperl.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=105603">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1513451" href="/Public/Bug/Display.html?id=105603#txn-1513451">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;01&nbsp;18:28:33&nbsp;2015</span>
    <span class="description">rjray [...] blackperl.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Strawberry does not always resolve &#39;localhost&#39; correctly &#40;may be
 in LWP&#41;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1513451/807044/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/807044">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I recently got a bug report for my RPC-XML module, in which the user was trying to build/install on Windows with Strawberry Perl 5.20.2. After much poking and prodding, I finally realized that when I created a daemon with HTTP::Daemon, it was taking &#39;localhost&#39; and resolving it to 127.0.0.1. That is, I would create the object as:

$server = HTTP::Daemon-&gt;new&#40;LocalHost =&gt; &#39;localhost&#39;, LocalPort =&gt; 9000&#41;;

and then printing $server-&gt;url would give me:

<span class="clickylink"><a target="new" rel="nofollow" href="http://127.0.0.1:9000/">http://127.0.0.1:9000/</a></span>

The problem I was having came when creating a client to connect to that server. The client did NOT resolve localhost to 127.0.0.1, and instead failed to connect. I created the client with:

$client = LWP::UserAgent-&gt;new&#40;POST =&gt; &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://localhost:9000">http://localhost:9000</a></span>&#39;&#41;;

If, instead, I created the client as:

$client = LWP::UserAgent-&gt;new&#40;POST =&gt; $server-&gt;url&#41;;

it would work fine.

The attached file shows this. It is stripped down from what it would be if I were using RPC::XML classes instead, but it shows the problem. The series of lines from 28-30, and again from 38-40, create request objects. As configured in this file, you will see the failure. If you comment-out lines 30 and 40, and uncomment 28 and 38, the script will run without error.

&#40;If you instead uncomment lines 29 and 39, you&#39;ll see a different bug that I&#39;ll be reporting in a different RT ticket.&#41;

I cannot tell if this problem is due to something in the HTTP::Request library vs. HTTP::Daemon, or if it traces back to different networking syscalls being made in the different cases. I have not tried this on the 5.22.0.1 build yet.

Randy
-- 
Randy J. Ray
rjray@blackperl.com
randy.j.ray@gmail.com
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> socket-fail.pl</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1513451/807045/socket-fail.pl">Download socket-fail.pl</a><br />
<span class="downloadcontenttype">text/x-perl 2.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/env perl

use strict;
use warnings;

use LWP::UserAgent;
use HTTP::Daemon;
use HTTP::Request;
use HTTP::Response;
use HTTP::Status;

my $server = HTTP::Daemon-&gt;new&#40;
    ReuseAddr =&gt; 1,
    LocalHost =&gt; &#39;localhost&#39;,
    LocalPort =&gt; 9000,
    Listen    =&gt; 5
&#41;;
my $url = $server-&gt;url;

die &#34;Failed to create server object\n&#34; if &#40;! $server&#41;;

my $child = fork;
if &#40;! defined $child&#41; {
    die &#34;fork&#40;&#41; failed: $!\n&#34;;
} elsif &#40;$child&#41; {
    # Parent
    my $UA = LWP::UserAgent-&gt;new;
    #my $req = HTTP::Request-&gt;new&#40;HEAD =&gt; $url&#41;;
    #my $req = HTTP::Request-&gt;new&#40;HEAD =&gt; $server-&gt;url&#41;;
    my $req = HTTP::Request-&gt;new&#40;HEAD =&gt; &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://localhost:9000">http://localhost:9000</a></span>&#39;&#41;;
    print &#34;&gt;&gt;&gt; Sending HEAD request\n&#34;;
    my $res = $UA-&gt;request&#40;$req&#41;;
    print &#34;&gt;&gt;&gt; Headers from HEAD request:\n\t&#34;;
    printf &#34;%d %s\n\t&#34;, $res-&gt;code, $res-&gt;message;
    print $res-&gt;headers_as_string&#40;&#34;\n\t&#34;&#41;, &#34;\n&#34;;
    sleep 1;
    printf &#34;&gt;&gt;&gt; Creating POST request to %s\n&#34;, $url;
    #$req = HTTP::Request-&gt;new&#40;POST =&gt; $url&#41;;
    #$req = HTTP::Request-&gt;new&#40;POST =&gt; $server-&gt;url&#41;;
    $req = HTTP::Request-&gt;new&#40;POST =&gt; &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://localhost:9000">http://localhost:9000</a></span>&#39;&#41;;
    print &#34;&gt;&gt;&gt; Sending POST request\n&#34;;
    $res = $UA-&gt;request&#40;$req&#41;;
    print &#34;&gt;&gt;&gt; Full message from POST request:\n\t&#34;;
    print $res-&gt;as_string&#40;&#34;\n\t&#34;&#41;, &#34;\n&#34;;
} else {
    # Child
    $server-&gt;timeout&#40;1&#41;;
    while &#40;1&#41; {
        my $conn = $server-&gt;accept;
        printf &#34;&lt;&lt;&lt; Accept: %s\n&#34;, &#40;$conn || &#39;&#40;none&#41;&#39;&#41;;
        next if &#40;! $conn&#41;;

        my $req;
        while &#40;$conn and $req = $conn-&gt;get_request&#40;&#39;headers only&#39;&#41;&#41; {
            my $res = HTTP::Response-&gt;new;
            $res-&gt;code&#40;RC_OK&#41;;
            $res-&gt;message&#40;&#39;OK&#39;&#41;;
            $res-&gt;header&#40;Accept =&gt; &#39;text/xml&#39;&#41;;
            $res-&gt;content_type&#40;&#39;text/xml&#39;&#41;;

            if &#40;$req-&gt;method eq &#39;HEAD&#39;&#41; {
                print &#34;&lt;&lt;&lt; Sending HEAD response\n&#34;;
                $conn-&gt;send_response&#40;$res&#41;;
            } elsif &#40;$req-&gt;method eq &#39;POST&#39;&#41; {
                print &#34;&lt;&lt;&lt; Sending POST response\n&#34;;
                $res-&gt;content&#40;&#39;Success&#39;&#41;;
                $conn-&gt;send_response&#40;$res&#41;;
            }
        }

        my $eval_return = eval {
            local $SIG{PIPE} = sub { die &#34;&lt;&lt;&lt; server_loop: Caught SIGPIPE\n&#34;; };
            $conn-&gt;close;
            1;
        };
        if &#40;&#40;! $eval_return&#41; &#38;&#38; $@&#41;
        {
            warn &#34;&lt;&lt;&lt; Cannot close connection: $@\n&#34;;
        }

        undef $conn;
    }
}

kill &#39;KILL&#39;, $child;
exit;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1513454" href="/Public/Bug/Display.html?id=105603#txn-1513454">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;01&nbsp;18:32:36&nbsp;2015</span>
    <span class="description">rjray [...] blackperl.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1513454/807048/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/807048">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 318b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I forgot to mention this: I also tried my code and this attached example code with ActiveState Perl, also version 5.20.2. AS Perl did not exhibit any of the problems that Strawberry did; both the client and server did the proper resolving of localhost.

Randy
-- 
Randy J. Ray
rjray@blackperl.com
randy.j.ray@gmail.com
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1513602" href="/Public/Bug/Display.html?id=105603#txn-1513602">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;02&nbsp;04:30:08&nbsp;2015</span>
    <span class="description">kmx [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #105603] Strawberry does not always resolve &#39;localhost&#39; correctly &#40;may be  in LWP&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 02 Jul 2015 10:29:33 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Perl-Dist-Strawberry [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kmx &lt;kmx [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1513602/807138/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/807138">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1018b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Randy,

the localhost issue you are describing appears on a MS Windows box with 
both IPv4 + IPv6 &#40;unfortunately even if you do not have IPv6 connectivity 
your Windows box has very likely IPv6 &#34;somehow&#34; configured&#41;.

The thing is that with both IPv4 and IPv6 the resolution of name 
&#39;localhost&#39; is in most cases &#39;::1&#39; &#40;IPv6 loopback&#41; not &#39;127.0.0.1&#39;

The trouble in your case is IMO an inconsistency:
- daemon somehow resolves localhost to 127.0.0.1
- client in some other way resolves localhost to ::1
- and they are obviously not able to connect

Anyway I am not sure what exactly causes this situation but for example 
HTTP::Server::Simple &#40;not sure if it is involved in your case&#41; uses:

sub lookup_localhost {
     my $self = shift;
     my $local_sockaddr = getsockname&#40; $self-&gt;stdio_handle &#41;;
     my &#40; undef, $localiaddr &#41; = sockaddr_in&#40;$local_sockaddr&#41;;
     $self-&gt;host&#40; gethostbyaddr&#40; $localiaddr, AF_INET &#41; || &#34;localhost&#34;&#41;;
     $self-&gt;{&#39;local_addr&#39;} = inet_ntoa&#40;$localiaddr&#41; || &#34;127.0.0.1&#34;;
}

--
kmx
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1513603" href="/Public/Bug/Display.html?id=105603#txn-1513603">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;02&nbsp;04:30:08&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1513687" href="/Public/Bug/Display.html?id=105603#txn-1513687">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;02&nbsp;12:07:27&nbsp;2015</span>
    <span class="description">rjray [...] blackperl.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1513687/807183/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/807183">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 481b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">That&#39;s interesting, and it might explain why &#40;on rare occasion&#41; I&#39;ve seen this on non-MS platforms as well. But it doesn&#39;t explain why ActiveState Perl works correctly. Presumably, AS is using the same system-level libs to do name resolution?

I will try to see if I can distill this down further. I lack the tools and the know-how to debug a threaded application, so I&#39;ll try to split this into two smaller pieces.

Randy
-- 
Randy J. Ray
rjray@blackperl.com
randy.j.ray@gmail.com
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1514505" href="/Public/Bug/Display.html?id=105603#txn-1514505">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;05&nbsp;20:35:48&nbsp;2015</span>
    <span class="description">rjray [...] blackperl.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1514505/807617/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/807617">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I can confirm that IPv6 is at least part of the issue here. I modified the script to let me run the client and server separately, and thus I could step through the debugger without threading/forking issues. Here is what I have found. from running both the client side and server side through the debugger:

* The path of execution through LWP::UserAgent leads to IO::Socket::IP being used for the actual creation of the socket. The execution path for HTTP::Daemon does not.

* IO::Socket::IP uses getaddrinfo&#40;&#41; &#40;inside the _io_socket_ip__configure method&#41;, which returns two records for &#34;localhost&#34;: one for IPv6 and one for IPv4, in that order.

* HTTP::Daemon, by way of IO:Socket::INET::configure&#40;&#41;, simply passes the hostname to inet_aton&#40;&#41; to get the encoded address.

In HTTP::Daemon, it only ever tries to bind to the IPv4 address. In LWP::UserAgent, by way of IO::Socket::IP, it tries &#40;in order&#41; IPv6 and IPv4. However, why the IPv4 bind fails is a mystery. From my reading of the code, when IPv6 failed the IPv4 address should have been successful.

So, there appear to be two issues here, neither of which are in Strawberry Perl after all:

1. HTTP::Daemon, unlike LWP::UserAgent, is not using IO::Socket::IP as a means of transparently handling IPv6 as well as IPv4.
2. IO::Socket::IP is not correctly binding the IPv4 socket for an address after the IPv6 bind fails.

I will pursue these two issues with those distributions. You can mark this ticket closed, since it isn&#39;t a Strawberry issue after all.

Randy
-- 
Randy J. Ray
rjray@blackperl.com
randy.j.ray@gmail.com
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1514692" href="/Public/Bug/Display.html?id=105603#txn-1514692">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;06&nbsp;08:25:31&nbsp;2015</span>
    <span class="description">csjewell [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.429082</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
