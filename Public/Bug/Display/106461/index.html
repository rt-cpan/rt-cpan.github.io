<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #106461 for ExtUtils-MakeMaker: Miscorrect usage of &#34;:encoding&#34; pragma?</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #106461 for ExtUtils-MakeMaker: Miscorrect usage of &#34;:encoding&#34; pragma?</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/ExtUtils-MakeMaker/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/ExtUtils-MakeMaker/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/ExtUtils-MakeMaker/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/ExtUtils-MakeMaker/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/ExtUtils-MakeMaker">ExtUtils-MakeMaker CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">106461</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/ExtUtils-MakeMaker/Active/">ExtUtils-MakeMaker</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
vitaliy.tokarev [...] gmail.com

<br />
SREZIC [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
ribasushi [...] leporine.io

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Unimportant    </td>
  </tr>
  <tr id="CF-12494-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
7.04    </td>
  </tr>
  <tr id="CF-12495-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Dockerfile<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1687423/906061/Dockerfile">
Tue Nov 29 12:09:59 2016 (1.9k) by KES [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;14&nbsp;15:44:23&nbsp;2015</span>
    <span class="description">vitaliy.tokarev [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Miscorrect usage of &#34;:encoding&#34; pragma?</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

When installing some modules via CPAN I&#39;ve got next messages:

&#34;\x{00f6}&#34; does not map to ascii at /home/tvv/.stablestaticperl-5.22.0-1.001/perl/lib/ExtUtils/MakeMaker.pm line 1182.


Environment
===========

* GNU/Linux Debian 7.8
* Perl: staticperl + stableperl 5.22.0
* ExtUtils::MakeMaker 7.04 &#40;this bug affected versions up to 7.05_27 as I see&#41;
* locale
LANG=en_US.UTF-8
LANGUAGE=en_US.UTF-8
LC_CTYPE=&#34;en_US.UTF-8&#34;
LC_NUMERIC=&#34;en_US.UTF-8&#34;
LC_TIME=&#34;en_US.UTF-8&#34;
LC_COLLATE=&#34;en_US.UTF-8&#34;
LC_MONETARY=&#34;en_US.UTF-8&#34;
LC_MESSAGES=&#34;en_US.UTF-8&#34;
LC_PAPER=&#34;en_US.UTF-8&#34;
LC_NAME=&#34;en_US.UTF-8&#34;
LC_ADDRESS=&#34;en_US.UTF-8&#34;
LC_TELEPHONE=&#34;en_US.UTF-8&#34;
LC_MEASUREMENT=&#34;en_US.UTF-8&#34;
LC_IDENTIFICATION=&#34;en_US.UTF-8&#34;
LC_ALL=


How to test?
============

perl -MCPAN -e shell
test Module::Compile


Documentation &#34;perldoc open&#34; and &#34;perldoc encoding&#34; contains nothing about &#34;:encoding&#40;locale&#41;&#34;. Instead of it there are notes about usage of &#34;:locale&#34; pragma.

So, if I apply the patch below the warning message disappears:

--- /home/tvv/.stablestaticperl-5.22.0-1.001/perl/lib/ExtUtils/MakeMaker.pm.orig        2015-08-14 22:37:35.000000000 +0300
+++ /home/tvv/.stablestaticperl-5.22.0-1.001/perl/lib/ExtUtils/MakeMaker.pm     2015-08-14 22:37:48.000000000 +0300
@@ -1172,7 +1172,7 @@
     unlink&#40;$finalname, &#34;MakeMaker.tmp&#34;, $Is_VMS ? &#39;Descrip.MMS&#39; : &#40;&#41;&#41;;
     open&#40;my $fh,&#34;&gt;&#34;, &#34;MakeMaker.tmp&#34;&#41;
         or die &#34;Unable to open MakeMaker.tmp: $!&#34;;
-    binmode $fh, &#39;:encoding&#40;locale&#41;&#39; if $CAN_DECODE;
+    binmode $fh, &#39;:locale&#39; if $CAN_DECODE;

     for my $chunk &#40;@{$self-&gt;{RESULT}}&#41; {
         my $to_write = $chunk;


Is it a typo or am I wrong? Can you fix that?

Thanks!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;14&nbsp;16:41:22&nbsp;2015</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2015-08-14 12:44:23, gh0stwizard wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello,
&gt; 
&gt; When installing some modules via CPAN I&#39;ve got next messages:
&gt; 
&gt; &#34;\x{00f6}&#34; does not map to ascii at /home/tvv/.stablestaticperl-
&gt; 5.22.0-1.001/perl/lib/ExtUtils/MakeMaker.pm line 1182.
</div>
What distribution were you installing when this happened?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;14&nbsp;16:41:23&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;14&nbsp;17:40:45&nbsp;2015</span>
    <span class="description">LEONT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Aug 14 15:44:23 2015, gh0stwizard wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello,
&gt; 
&gt; When installing some modules via CPAN I&#39;ve got next messages:
&gt; 
&gt; &#34;\x{00f6}&#34; does not map to ascii at /home/tvv/.stablestaticperl-
&gt; 5.22.0-1.001/perl/lib/ExtUtils/MakeMaker.pm line 1182.
&gt; 
&gt; 
&gt; Environment
&gt; ===========
&gt; 
&gt; * GNU/Linux Debian 7.8
&gt; * Perl: staticperl + stableperl 5.22.0
&gt; * ExtUtils::MakeMaker 7.04 &#40;this bug affected versions up to 7.05_27
&gt; as I see&#41;
&gt; * locale
&gt; LANG=en_US.UTF-8
&gt; LANGUAGE=en_US.UTF-8
&gt; LC_CTYPE=&#34;en_US.UTF-8&#34;
&gt; LC_NUMERIC=&#34;en_US.UTF-8&#34;
&gt; LC_TIME=&#34;en_US.UTF-8&#34;
&gt; LC_COLLATE=&#34;en_US.UTF-8&#34;
&gt; LC_MONETARY=&#34;en_US.UTF-8&#34;
&gt; LC_MESSAGES=&#34;en_US.UTF-8&#34;
&gt; LC_PAPER=&#34;en_US.UTF-8&#34;
&gt; LC_NAME=&#34;en_US.UTF-8&#34;
&gt; LC_ADDRESS=&#34;en_US.UTF-8&#34;
&gt; LC_TELEPHONE=&#34;en_US.UTF-8&#34;
&gt; LC_MEASUREMENT=&#34;en_US.UTF-8&#34;
&gt; LC_IDENTIFICATION=&#34;en_US.UTF-8&#34;
&gt; LC_ALL=
&gt; 
&gt; 
&gt; How to test?
&gt; ============
&gt; 
&gt; perl -MCPAN -e shell
&gt; test Module::Compile
&gt; 
&gt; 
&gt; Documentation &#34;perldoc open&#34; and &#34;perldoc encoding&#34; contains nothing
&gt; about &#34;:encoding&#40;locale&#41;&#34;. Instead of it there are notes about usage
&gt; of &#34;:locale&#34; pragma.
&gt; 
&gt; So, if I apply the patch below the warning message disappears:
&gt; 
&gt; --- /home/tvv/.stablestaticperl-5.22.0-
&gt; 1.001/perl/lib/ExtUtils/MakeMaker.pm.orig        2015-08-14
&gt; 22:37:35.000000000 +0300
&gt; +++ /home/tvv/.stablestaticperl-5.22.0-
&gt; 1.001/perl/lib/ExtUtils/MakeMaker.pm     2015-08-14 22:37:48.000000000
&gt; +0300
&gt; @@ -1172,7 +1172,7 @@
&gt;      unlink&#40;$finalname, &#34;MakeMaker.tmp&#34;, $Is_VMS ? &#39;Descrip.MMS&#39; :
&gt; &#40;&#41;&#41;;
&gt;      open&#40;my $fh,&#34;&gt;&#34;, &#34;MakeMaker.tmp&#34;&#41;
&gt;          or die &#34;Unable to open MakeMaker.tmp: $!&#34;;
&gt; -    binmode $fh, &#39;:encoding&#40;locale&#41;&#39; if $CAN_DECODE;
&gt; +    binmode $fh, &#39;:locale&#39; if $CAN_DECODE;
&gt; 
&gt; for my $chunk &#40;@{$self-&gt;{RESULT}}&#41; {
&gt;     my $to_write = $chunk;
&gt; 
&gt; 
&gt; Is it a typo or am I wrong? Can you fix that?
&gt; 
&gt; Thanks!
</div>
The :locale from open.pm/encoding.pm is not a true PerlIO layer. And given the actual layer is unlikely to be installed, that succeeds because it actually fails to apply silently. This is certainly not the right fix.

It would be helpful to know if ExtUtils::MakeMaker::Locale loads without issues, and if so what it thinks the locale&#39;s encodings are. The error message suggests Encode::Locale is incorrectly picking it up as ASCII, EUMM::Locale should give the same answer &#40;this potential mismatch worries me a bit, and the fallback for this scenario only seems to take the latter into account&#41;.

Leon
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;15&nbsp;05:08:53&nbsp;2015</span>
    <span class="description">vitaliy.tokarev [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> vitaliy.tokarev [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Aug 14 17:40:45 2015, LEONT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri Aug 14 15:44:23 2015, gh0stwizard wrote:
<div class="message-stanza open">&gt; &gt; Hello,
&gt; &gt;
&gt; &gt; When installing some modules via CPAN I&#39;ve got next messages:
&gt; &gt;
&gt; &gt; &#34;\x{00f6}&#34; does not map to ascii at /home/tvv/.stablestaticperl-
&gt; &gt; 5.22.0-1.001/perl/lib/ExtUtils/MakeMaker.pm line 1182.
&gt; &gt;
&gt; &gt;
&gt; &gt; Environment
&gt; &gt; ===========
&gt; &gt;
&gt; &gt; * GNU/Linux Debian 7.8
&gt; &gt; * Perl: staticperl + stableperl 5.22.0
&gt; &gt; * ExtUtils::MakeMaker 7.04 &#40;this bug affected versions up to 7.05_27
&gt; &gt; as I see&#41;
&gt; &gt; * locale
&gt; &gt; LANG=en_US.UTF-8
&gt; &gt; LANGUAGE=en_US.UTF-8
&gt; &gt; LC_CTYPE=&#34;en_US.UTF-8&#34;
&gt; &gt; LC_NUMERIC=&#34;en_US.UTF-8&#34;
&gt; &gt; LC_TIME=&#34;en_US.UTF-8&#34;
&gt; &gt; LC_COLLATE=&#34;en_US.UTF-8&#34;
&gt; &gt; LC_MONETARY=&#34;en_US.UTF-8&#34;
&gt; &gt; LC_MESSAGES=&#34;en_US.UTF-8&#34;
&gt; &gt; LC_PAPER=&#34;en_US.UTF-8&#34;
&gt; &gt; LC_NAME=&#34;en_US.UTF-8&#34;
&gt; &gt; LC_ADDRESS=&#34;en_US.UTF-8&#34;
&gt; &gt; LC_TELEPHONE=&#34;en_US.UTF-8&#34;
&gt; &gt; LC_MEASUREMENT=&#34;en_US.UTF-8&#34;
&gt; &gt; LC_IDENTIFICATION=&#34;en_US.UTF-8&#34;
&gt; &gt; LC_ALL=
&gt; &gt;
&gt; &gt;
&gt; &gt; How to test?
&gt; &gt; ============
&gt; &gt;
&gt; &gt; perl -MCPAN -e shell
&gt; &gt; test Module::Compile
&gt; &gt;
&gt; &gt;
&gt; &gt; Documentation &#34;perldoc open&#34; and &#34;perldoc encoding&#34; contains nothing
&gt; &gt; about &#34;:encoding&#40;locale&#41;&#34;. Instead of it there are notes about usage
&gt; &gt; of &#34;:locale&#34; pragma.
&gt; &gt;
&gt; &gt; So, if I apply the patch below the warning message disappears:
&gt; &gt;
&gt; &gt; --- /home/tvv/.stablestaticperl-5.22.0-
&gt; &gt; 1.001/perl/lib/ExtUtils/MakeMaker.pm.orig        2015-08-14
&gt; &gt; 22:37:35.000000000 +0300
&gt; &gt; +++ /home/tvv/.stablestaticperl-5.22.0-
&gt; &gt; 1.001/perl/lib/ExtUtils/MakeMaker.pm     2015-08-14
&gt; &gt; 22:37:48.000000000
&gt; &gt; +0300
&gt; &gt; @@ -1172,7 +1172,7 @@
&gt; &gt;      unlink&#40;$finalname, &#34;MakeMaker.tmp&#34;, $Is_VMS ? &#39;Descrip.MMS&#39; :
&gt; &gt; &#40;&#41;&#41;;
&gt; &gt;      open&#40;my $fh,&#34;&gt;&#34;, &#34;MakeMaker.tmp&#34;&#41;
&gt; &gt;          or die &#34;Unable to open MakeMaker.tmp: $!&#34;;
&gt; &gt; -    binmode $fh, &#39;:encoding&#40;locale&#41;&#39; if $CAN_DECODE;
&gt; &gt; +    binmode $fh, &#39;:locale&#39; if $CAN_DECODE;
&gt; &gt;
&gt; &gt; for my $chunk &#40;@{$self-&gt;{RESULT}}&#41; {
&gt; &gt;     my $to_write = $chunk;
&gt; &gt;
&gt; &gt;
&gt; &gt; Is it a typo or am I wrong? Can you fix that?
&gt; &gt;
&gt; &gt; Thanks!
</div>&gt; 
&gt; The :locale from open.pm/encoding.pm is not a true PerlIO layer. And
&gt; given the actual layer is unlikely to be installed, that succeeds
&gt; because it actually fails to apply silently. This is certainly not the
&gt; right fix.
&gt; 
&gt; It would be helpful to know if ExtUtils::MakeMaker::Locale loads
&gt; without issues, and if so what it thinks the locale&#39;s encodings are.
&gt; The error message suggests Encode::Locale is incorrectly picking it up
&gt; as ASCII, EUMM::Locale should give the same answer &#40;this potential
&gt; mismatch worries me a bit, and the fallback for this scenario only
&gt; seems to take the latter into account&#41;.
&gt; 
&gt; Leon
</div>

I&#39;ve to modify MakeMaker.pm &#40;version 7.04&#41;, function &#34;sub flush&#34;:

 1168     my $finalname = $self-&gt;{MAKEFILE};
 1169     print &#34;Generating a $type $finalname\n&#34;;
 1170     print &#34;Writing $finalname for $self-&gt;{NAME}\n&#34;;
 1171
 1172     unlink&#40;$finalname, &#34;MakeMaker.tmp&#34;, $Is_VMS ? &#39;Descrip.MMS&#39; : &#40;&#41;&#41;;
 1173
 1174 warn &#34;&gt;&gt;&gt; CAN_DECODE = $CAN_DECODE\n&#34;;
 1175
 1176     open&#40;my $fh,&#34;&gt;&#34;, &#34;MakeMaker.tmp&#34;&#41;
 1177         or die &#34;Unable to open MakeMaker.tmp: $!&#34;;
 1178
 1179 if &#40; $CAN_DECODE &#41; {
 1180     my $mode = binmode $fh, &#39;:locale&#39;;
 1181     warn sprintf &#34;&gt;&gt;&gt; BINMODE = %s\n&#34;, $mode ? $mode : $!;
 1182 }
 1183
 1184     for my $chunk &#40;@{$self-&gt;{RESULT}}&#41; {

Testing on an installation the module &#34;Module::Compile&#34;. Futher investigation shows next things:

cpan[1]&gt; test Module::Compile
Reading &#39;/home/tvv/.stablestaticperl-5.22.0-1.001/cpan/Metadata&#39;
  Database was generated on Fri, 14 Aug 2015 11:41:02 GMT
Running test for module &#39;Module::Compile&#39;
Checksum for /home/tvv/.stablestaticperl-5.22.0-1.001/cpan/sources/authors/id/I/IN/INGY/Module-Compile-0.35.tar.gz ok
Scanning cache /home/tvv/.stablestaticperl-5.22.0-1.001/cpan/build for sizes
............................................................................DONE
tmp-2798 for tmp-2798: No such file or directory at /home/tvv/.stablestaticperl-5.22.0-1.001/perl/
lib/CPAN/Distribution.pm line 468.
Configuring I/IN/INGY/Module-Compile-0.35.tar.gz with Makefile.PL
Checking if your kit is complete...
Looks good
Generating a Unix-style Makefile
Writing Makefile for Module::Compile
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&gt;&gt; CAN_DECODE = 1
&gt;&gt;&gt; BINMODE = No such file or directory
</div>Writing MYMETA.yml and MYMETA.json
  INGY/Module-Compile-0.35.tar.gz
  /home/tvv/.stablestaticperl-5.22.0-1.001/perl/bin/perl Makefile.PL MAP_TARGET=perl -- OK
Running make for I/IN/INGY/Module-Compile-0.35.tar.gz
cp lib/Module/Optimize.pm blib/lib/Module/Optimize.pm
cp lib/Module/Compile.pod blib/lib/Module/Compile.pod
...


If I push back my changes to an original:

 1179 if &#40; $CAN_DECODE &#41; {
 1180     my $mode = binmode $fh, &#39;:encoding&#40;locale&#41;&#39;;
 1181     warn sprintf &#34;&gt;&gt;&gt; BINMODE = %s\n&#34;, $mode ? $mode : $!;
 1182 }

Then I got next output:

Configuring I/IN/INGY/Module-Compile-0.35.tar.gz with Makefile.PL
Checking if your kit is complete...
Looks good
Generating a Unix-style Makefile
Writing Makefile for Module::Compile
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&gt;&gt; CAN_DECODE = 1
&gt;&gt;&gt; BINMODE = 1
</div>&#34;\x{00f6}&#34; does not map to ascii at /home/tvv/.stablestaticperl-5.22.0-1.001/perl/lib/ExtUtils/Mak
eMaker.pm line 1189.
&#34;\x{00f6}&#34; does not map to ascii at /home/tvv/.stablestaticperl-5.22.0-1.001/perl/lib/ExtUtils/Mak
eMaker.pm line 1189.
&#34;\x{00f6}&#34; does not map to ascii at /home/tvv/.stablestaticperl-5.22.0-1.001/perl/lib/ExtUtils/Mak
eMaker.pm line 1189.
&#34;\x{00f6}&#34; does not map to ascii at /home/tvv/.stablestaticperl-5.22.0-1.001/perl/lib/ExtUtils/Mak
eMaker.pm line 1189.
Writing MYMETA.yml and MYMETA.json
  INGY/Module-Compile-0.35.tar.gz
  /home/tvv/.stablestaticperl-5.22.0-1.001/perl/bin/perl Makefile.PL MAP_TARGET=perl -- OK
Running make for I/IN/INGY/Module-Compile-0.35.tar.gz
...

So I was wrong and usage &#34;:encoding&#40;locale&#41;&#34; is correct.


Futher investigation. I have look into encoding.pm and run cpan shell with PERL_ENCODE_DEBUG=1 environemnt. And now I see where is problem:

...
Generating a Unix-style Makefile
Writing Makefile for Module::Compile
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&gt;&gt; CAN_DECODE = 1
</div>find_alias&#40;Encode, locale&#41;-&gt;name = ascii at /home/tvv/.stablestaticperl-5.22.0-1.001/perl/lib/Enco
de/Alias.pm line 75.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&gt;&gt; BINMODE = 1
</div>&#34;\x{00f6}&#34; does not map to ascii at /home/tvv/.stablestaticperl-5.22.0-1.001/perl/lib/ExtUtils/Mak
eMaker.pm line 1189.
...


Well, quick looking at Encode::* module&#40;s&#41; does not give any glue about what is &#34;locale&#34; encoding is.

From encoding.pm, I&#39;ve try this command:

perl -MI18N::Langinfo -le &#39;I18N::Langinfo-&gt;import&#40;qw&#40;langinfo CODESET&#41;&#41;; print langinfo&#40; CODESET&#40;&#41; &#41;;&#39;

and its returns &#34;UTF-8&#34;.

I&#39;ll try to investigate the problem futher.


Thanks!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;15&nbsp;05:36:17&nbsp;2015</span>
    <span class="description">vitaliy.tokarev [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> vitaliy.tokarev [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve look in EUMM/Locale.pm and I comment out the line 128:

use Data::Dump; ddx $ENCODING_LOCALE, $ENCODING_LOCALE_FS, $ENCODING_CONSOLE_IN, $ENCODING_CONSOLE_IN, $ENCODING_CONSOLE_OUT;

and I&#39;ve got next output:

# Locale.pm:128: &#40;
#   &#34;ANSI_X3.4-1968&#34;,
#   &#34;ANSI_X3.4-1968&#34;,
#   &#34;ANSI_X3.4-1968&#34;,
#   &#34;ANSI_X3.4-1968&#34;,
# &#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;15&nbsp;06:18:13&nbsp;2015</span>
    <span class="description">vitaliy.tokarev [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> vitaliy.tokarev [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Aug 15 05:36:17 2015, gh0stwizard wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve look in EUMM/Locale.pm and I comment out the line 128:
&gt; 
&gt; use Data::Dump; ddx $ENCODING_LOCALE, $ENCODING_LOCALE_FS,
&gt; $ENCODING_CONSOLE_IN, $ENCODING_CONSOLE_IN, $ENCODING_CONSOLE_OUT;
&gt; 
&gt; and I&#39;ve got next output:
&gt; 
&gt; # Locale.pm:128: &#40;
&gt; #   &#34;ANSI_X3.4-1968&#34;,
&gt; #   &#34;ANSI_X3.4-1968&#34;,
&gt; #   &#34;ANSI_X3.4-1968&#34;,
&gt; #   &#34;ANSI_X3.4-1968&#34;,
&gt; # &#41;
</div>
I&#39;ve found why I got this strange result. It was inside staticperl script which sets LC_ALL=C. In that case langinfo&#40; CODESET &#41; returns &#34;ANSI_X3.4-1968&#34;. I&#39;ve run &#34;~/staticperl cpan&#34; to open CPAN shell instead of &#34;perl -MCPAN -e shell&#34;.

As I see ExtUtils/MakeMaker.pm contains next lines:

   14 eval { ExtUtils::MakeMaker::Locale::reinit&#40;&#39;UTF-8&#39;&#41; }
   15   if $CAN_DECODE and $ExtUtils::MakeMaker::Locale::ENCODING_LOCALE eq &#39;US-ASCII&#39;;


Perhaps it should be expanded/changed?

Thanks!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;15&nbsp;07:31:37&nbsp;2015</span>
    <span class="description">fawaka [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #106461] Miscorrect usage of &#34;:encoding&#34; pragma?</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 15 Aug 2015 13:30:54 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-ExtUtils-MakeMaker [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Leon Timmermans &lt;fawaka [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, Aug 15, 2015 at 12:18 PM, Vitaliy Tokarev via RT &lt;
bug-ExtUtils-MakeMaker@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: ExtUtils-MakeMaker
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=106461">https://rt.cpan.org/Ticket/Display.html?id=106461</a></span> &gt;
&gt;
&gt; On Sat Aug 15 05:36:17 2015, gh0stwizard wrote:
<div class="message-stanza open">&gt; &gt; I&#39;ve look in EUMM/Locale.pm and I comment out the line 128:
&gt; &gt;
&gt; &gt; use Data::Dump; ddx $ENCODING_LOCALE, $ENCODING_LOCALE_FS,
&gt; &gt; $ENCODING_CONSOLE_IN, $ENCODING_CONSOLE_IN, $ENCODING_CONSOLE_OUT;
&gt; &gt;
&gt; &gt; and I&#39;ve got next output:
&gt; &gt;
&gt; &gt; # Locale.pm:128: &#40;
&gt; &gt; #   &#34;ANSI_X3.4-1968&#34;,
&gt; &gt; #   &#34;ANSI_X3.4-1968&#34;,
&gt; &gt; #   &#34;ANSI_X3.4-1968&#34;,
&gt; &gt; #   &#34;ANSI_X3.4-1968&#34;,
&gt; &gt; # &#41;
</div>&gt;
&gt; I&#39;ve found why I got this strange result. It was inside staticperl script
&gt; which sets LC_ALL=C. In that case langinfo&#40; CODESET &#41; returns
&gt; &#34;ANSI_X3.4-1968&#34;. I&#39;ve run &#34;~/staticperl cpan&#34; to open CPAN shell instead
&gt; of &#34;perl -MCPAN -e shell&#34;.
&gt;
</div>
That is unfortunate.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As I see ExtUtils/MakeMaker.pm contains next lines:
&gt;
&gt;    14 eval { ExtUtils::MakeMaker::Locale::reinit&#40;&#39;UTF-8&#39;&#41; }
&gt;    15   if $CAN_DECODE and $ExtUtils::MakeMaker::Locale::ENCODING_LOCALE
&gt; eq &#39;US-ASCII&#39;;
&gt;
&gt; Perhaps it should be expanded/changed?
&gt;
</div>
It&#39;s overriding ExtUtils::MakeMaker::Locale, but &#39;:encoding&#40;locale&#41;&#39; is
using Encode::Locale. I suspect the easiest solution is to use something
like &#34;:encoding&#40;$ExtUtils::MakeMaker::Locale::ENCODING_LOCALE&#41;&#34; instead.

Leon
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;02&nbsp;03:00:37&nbsp;2015</span>
    <span class="description">SREZIC [...] cpan.org -  Requestor SREZIC added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;03&nbsp;08:17:22&nbsp;2016</span>
    <span class="description">ntyni [...] iki.fi -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ntyni [...] iki.fi</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Aug 15 07:31:37 2015, fawaka@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sat, Aug 15, 2015 at 12:18 PM, Vitaliy Tokarev via RT &lt;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It&#39;s overriding ExtUtils::MakeMaker::Locale, but &#39;:encoding&#40;locale&#41;&#39; is
&gt; using Encode::Locale. I suspect the easiest solution is to use something
&gt; like &#34;:encoding&#40;$ExtUtils::MakeMaker::Locale::ENCODING_LOCALE&#41;&#34; instead.
</div>
As a data point, we&#39;re seeing this in Debian / 5.22.2 with the Vitacilina distribution, where it actually causes sporadic crashes when running Makefile.PL because of <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=65541">https://rt.cpan.org/Public/Bug/Display.html?id=65541</a></span> in Encode.

There are some debugger traces in <span class="clickylink"><a target="new" rel="nofollow" href="https://bugs.debian.org/835989">https://bugs.debian.org/835989</a></span> for the Encode side.

-- 
Niko Tyni
ntyni@debian.org
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;13&nbsp;02:36:41&nbsp;2016</span>
    <span class="description">ribasushi [...] leporine.io -  Cc RIBASUSHI added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;29&nbsp;12:09:59&nbsp;2016</span>
    <span class="description">KES [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have same errors trying to install modules into docker.

How to reproduce:
1. install docker
2. try to build image from attached Dockerfile
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Dockerfile</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1687423/906061/Dockerfile">Download Dockerfile</a><br />
<span class="downloadcontenttype">application/octet-stream 1.9k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
