<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #3305 for Class-DBI: has_many cause compilation error</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #3305 for Class-DBI: has_many cause compilation error</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Class-DBI">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Class-DBI">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Class-DBI">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Class-DBI">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Class-DBI">Class-DBI CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">3305</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Class-DBI">Class-DBI</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
martin [...] hybyte.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-6690-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.93    </td>
  </tr>
  <tr id="CF-6691-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Task.pm<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/169425/55035/Task.pm">
Wed Mar 01 10:16:20 2006 (1.7k) by Guest
</a>
</font></li>
</ul>


TaskHistory.pm<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/169425/55038/TaskHistory.pm">
Wed Mar 01 10:16:20 2006 (427b) by Guest
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=3305">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-86185" href="/Public/Bug/Display.html?id=3305#txn-86185">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;21&nbsp;07:46:01&nbsp;2003</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> has_many cause compilation error</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/86185/11221/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/11221">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 347b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Under the following conditions has_many give a compilation error &#40;object method _essential not found in Class:DBI::Querry line 114&#41;

to produce the error, create a file p1.pm

package p1;
use base &#39;Class::DBI&#39;;
p1-&gt;has_many&#40;&#39;m&#39; =&gt; &#39;main&#39;&#41;;
1;

then run the following line

perl -wle &#39; use p1; use base q/Class::DBI/; main-&gt;columns&#40;All =&gt; &#34;m&#34;&#41;; &#39;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-86186" href="/Public/Bug/Display.html?id=3305#txn-86186">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;22&nbsp;13:37:40&nbsp;2003</span>
    <span class="description">tony [...] kasei.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 22 Aug 2003 18:37:34 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tony Bowden &lt;tony [...] kasei.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Guest via RT &lt;bug-Class-DBI [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #3305] has_many cause compilation error</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-Cc:</td>
    <td class="message-header-value"> </td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/86186/11257/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/11257">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 690b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Aug 21, 2003 at 07:46:01AM -0400, Guest via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Under the following conditions has_many give a compilation error &#40;object method _essential not found in Class:DBI::Querry line 114&#41;
&gt; to produce the error, create a file p1.pm
&gt; package p1;
&gt; use base &#39;Class::DBI&#39;;
&gt; p1-&gt;has_many&#40;&#39;m&#39; =&gt; &#39;main&#39;&#41;;
&gt; 1;
&gt; then run the following line
&gt; perl -wle &#39; use p1; use base q/Class::DBI/; main-&gt;columns&#40;All =&gt; &#34;m&#34;&#41;; &#39;
</div>
I&#39;m not sure why this is a bug.

You&#39;re trying to link p1 with main, but main isn&#39;t a subclass of
Class::DBI, so of course it&#39;s not going to work ...

It could conceivably give a better error message, but I&#39;m assuming
there&#39;s a reason why you&#39;re reporting this?

Tony
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-86188" href="/Public/Bug/Display.html?id=3305#txn-86188">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;12&nbsp;06:02:43&nbsp;2003</span>
    <span class="description">TMTM [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/86188/11992/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/11992">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 335b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I can&#39;t see any simple way to fix this.

But, as the example you provided is so contrived, I&#39;m not really that
concerned about it.

I assume that this is just a cut down version for a bug report, and you
actually encountered this is real code? If there are likely
circumstances that trigger this I&#39;ll probably pay it more attention ...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-86189" href="/Public/Bug/Display.html?id=3305#txn-86189">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;26&nbsp;08:49:01&nbsp;2003</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/86189/13881/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/13881">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[tony@kasei.com - Fri Aug 22 13:37:40 2003]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu, Aug 21, 2003 at 07:46:01AM -0400, Guest via RT wrote:
<div class="message-stanza open">&gt; &gt; Under the following conditions has_many give a compilation error
</div>&gt; &#40;object method _essential not found in Class:DBI::Querry line 114&#41;
<div class="message-stanza open">&gt; &gt; to produce the error, create a file p1.pm
&gt; &gt; package p1;
&gt; &gt; use base &#39;Class::DBI&#39;;
&gt; &gt; p1-&gt;has_many&#40;&#39;m&#39; =&gt; &#39;main&#39;&#41;;
&gt; &gt; 1;
&gt; &gt; then run the following line
&gt; &gt; perl -wle &#39; use p1; use base q/Class::DBI/; main-&gt;columns&#40;All =&gt;
</div>&gt; &#34;m&#34;&#41;; &#39;
&gt; 
&gt; I&#39;m not sure why this is a bug.
&gt; 
&gt; You&#39;re trying to link p1 with main, but main isn&#39;t a subclass of
&gt; Class::DBI, so of course it&#39;s not going to work ...
&gt; 
&gt; It could conceivably give a better error message, but I&#39;m assuming
&gt; there&#39;s a reason why you&#39;re reporting this?
&gt; 
&gt; Tony
&gt; 
</div>

main is a subclass of Class::DBI.

the problem is the order of the declaration. main uses p1, before
declaring it base class. this causes the compilation to fail.

It does not need to be considered a bug. But in that case it should be
in the documentation. It needs specific care if there are circular
has_many references.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-86190" href="/Public/Bug/Display.html?id=3305#txn-86190">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;18&nbsp;05:41:00&nbsp;2005</span>
    <span class="description">TMTM [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/86190/36232/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/36232">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 177b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; main is a subclass of Class::DBI.
</div>
This is too contrived for my little brain. If you give an example that
uses classes other than &#39;main&#39; I&#39;ll look at it again.

Thanks,

Tony
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-86191" href="/Public/Bug/Display.html?id=3305#txn-86191">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;18&nbsp;06:16:43&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/86191/36238/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/36238">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[TMTM - Sat Jun 18 05:41:00 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; main is a subclass of Class::DBI.
</div>&gt; 
&gt; This is too contrived for my little brain. If you give an example that
&gt; uses classes other than &#39;main&#39; I&#39;ll look at it again.
</div>
## In file p1.pm
package p1;
use base &#39;Class::DBI&#39;;
p1-&gt;has_many&#40;&#39;m&#39; =&gt; &#39;p2&#39;&#41;;
1;

## In file p2.pm
package p2;
use p1; # or any other class that use p1
use base &#39;Class::DBI&#39;;
1;

## execute
perl -wle &#39; use p2; &#39;

Can&#39;t locate object method &#34;meta_info&#34; via package &#34;p2&#34; at
/usr/local/lib/perl5/site_perl/5.8.6/Class/DBI/Relationship/HasMany.pm
line 28.
Compilation failed in require at p2.pm line 2.
BEGIN failed--compilation aborted at p2.pm line 2.
Compilation failed in require at -e line 1.
BEGIN failed--compilation aborted at -e line 1.


At the time of reporting this bug, I had some packages with use
statements in the above order. I managed to resolv this.

At this time my programm broke, because Class::DBI had changed the way,
it was dealing with has_many.

I wouldnt consider this behavior itself a bug &#40;the *unanounced&#34; change
was an issue&#41;.

It might be worth mentioning in the manpage as a requirement:

A Class inheriting from Class::DBI, should declare that as early as
possible. It must declare this, before using any other class, that has a
has_* relationship with it
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-169425" href="/Public/Bug/Display.html?id=3305#txn-169425">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;01&nbsp;10:16:19&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/169425/55032/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/55032">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Jun 18 05:41:00 2005, TMTM wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; main is a subclass of Class::DBI.
</div>&gt; 
&gt; This is too contrived for my little brain. If you give an example that
&gt; uses classes other than &#39;main&#39; I&#39;ll look at it again.
</div>
I have a less contrived example that get&#39;s this error :

In my case I have several classes, but 1 fails to compile with 3.014,
but works fine in 0.9x.

I have 2 relevent classes - Task and TaskHistory..

TaskHistory has a Task on the TaskHistory task column
Task has many TaskHistory on the TaskHistory task column
Task has a last TaskHistory on the Task last_history column

When compiling with latest CDBI get the following error :
 can&#39;t load Schedule::Chronic::Distributed::Task: Can&#39;t locate object
method &#34;meta_info&#34; via package
&#34;Schedule::Chronic::Distributed::TaskHistory&#34; at
/usr/local/share/perl/5.8.4/Class/DBI/Relationship/HasMany.pm line 34.

I&#39;m guessing that the new has_many code doesn&#39;t like me having both a
has_a and a has_many from one class to another, which is rather
unhelpful, removing the extra has_a relationship isn&#39;t a particular
hardship in this case but it does show a limitation in the new code that
isn&#39;t documented.

Relevent files attached
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/169425/55035/Task.pm">Download Task.pm</a><br />
<span class="downloadcontenttype">text/x-perl 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">package Schedule::Chronic::Distributed::Task;

=head1 NAME

  Schedule::Chronic::Distributed::Task - Class representing Task within Schedule::Chronic::Distributed

=head1 SYNOPSIS

  use Schedule::Chronic::Distributed::Task;

=head1 DESCRIPTION

This class represents Tasks within the schedule, i.e. jobs that need doing, holding their state, arguments and
related date and historical data.

This class provides access to related data/classes such as the command, node, and a history of when the job
was run, due, and it&#39;s previous states and errors.

=cut

use strict;

use Time::Piece;
use Time::Seconds;

use base qw&#40;Schedule::Chronic::Distributed::DBI&#41;;

__PACKAGE__-&gt;table&#40;&#39;task&#39;&#41;;
__PACKAGE__-&gt;columns&#40;All =&gt; qw/id name command command_arguments priority created timeout
		     min_interval max_interval retry_interval schedule_type notify_address
		     current_status current_node current_due current_deadline
		     last_status last_due last_deadline last_run last_completed last_node last_history
		     description error/&#41;;
__PACKAGE__-&gt;columns&#40;Primary =&gt; &#39;id&#39;&#41;;
__PACKAGE__-&gt;columns&#40;TEMP =&gt; qw/constraint_objects wait/&#41;;

__PACKAGE__-&gt;has_many&#40;requirements =&gt; &#39;Schedule::Chronic::Distributed::TaskRequirement&#39;&#41;;
__PACKAGE__-&gt;has_many&#40;task_times =&gt; &#39;Schedule::Chronic::Distributed::TaskTimes&#39;&#41;;

__PACKAGE__-&gt;has_a&#40;current_node =&gt; &#39;Schedule::Chronic::Distributed::Node&#39;&#41;;
__PACKAGE__-&gt;has_a&#40;last_node =&gt; &#39;Schedule::Chronic::Distributed::Node&#39;&#41;;
__PACKAGE__-&gt;has_a&#40;command =&gt; &#39;Schedule::Chronic::Distributed::Command&#39;&#41;;
__PACKAGE__-&gt;has_a&#40;last_history =&gt; &#39;Schedule::Chronic::Distributed::TaskHistory&#39;&#41;;

__PACKAGE__-&gt;has_many&#40;history =&gt; &#39;Schedule::Chronic::Distributed::TaskHistory&#39;,{ order_by =&gt; &#39;started&#39; }&#41;;

# loads of code goes here

1;


</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/169425/55038/TaskHistory.pm">Download TaskHistory.pm</a><br />
<span class="downloadcontenttype">text/x-perl 427b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">package Schedule::Chronic::Distributed::TaskHistory;

use strict;

use Time::Piece;
use base qw&#40;Schedule::Chronic::Distributed::DBI&#41;;

__PACKAGE__-&gt;table&#40;&#39;task_history&#39;&#41;;
__PACKAGE__-&gt;columns&#40;All =&gt; qw/id task_name task command command_arguments status node priority error started finished due deadline/&#41;;
__PACKAGE__-&gt;columns&#40;Primary =&gt; &#39;id&#39;&#41;;

__PACKAGE__-&gt;has_a &#40;task =&gt; &#39;Schedule::Chronic::Distributed::Task&#39;&#41;;

# code

1;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-169426" href="/Public/Bug/Display.html?id=3305#txn-169426">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;01&nbsp;10:16:21&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-169429" href="/Public/Bug/Display.html?id=3305#txn-169429">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;01&nbsp;10:21:12&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/169429/55041/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/55041">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Mar 01 10:16:19 2006, guest wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sat Jun 18 05:41:00 2005, TMTM wrote:
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; main is a subclass of Class::DBI.
</div>&gt; &gt; 
&gt; &gt; This is too contrived for my little brain. If you give an example that
&gt; &gt; uses classes other than &#39;main&#39; I&#39;ll look at it again.
</div>&gt; 
&gt; I have a less contrived example that get&#39;s this error :
&gt; 
&gt; In my case I have several classes, but 1 fails to compile with 3.014,
&gt; but works fine in 0.9x.
&gt; 
&gt; I have 2 relevent classes - Task and TaskHistory..
&gt; 
&gt; TaskHistory has a Task on the TaskHistory task column
&gt; Task has many TaskHistory on the TaskHistory task column
&gt; Task has a last TaskHistory on the Task last_history column
&gt; 
&gt; When compiling with latest CDBI get the following error :
&gt;  can&#39;t load Schedule::Chronic::Distributed::Task: Can&#39;t locate object
&gt; method &#34;meta_info&#34; via package
&gt; &#34;Schedule::Chronic::Distributed::TaskHistory&#34; at
&gt; /usr/local/share/perl/5.8.4/Class/DBI/Relationship/HasMany.pm line 34.
&gt; 
&gt; I&#39;m guessing that the new has_many code doesn&#39;t like me having both a
&gt; has_a and a has_many from one class to another, which is rather
&gt; unhelpful, removing the extra has_a relationship isn&#39;t a particular
&gt; hardship in this case but it does show a limitation in the new code that
&gt; isn&#39;t documented.
&gt; 
</div>
Just to confirm that removing the last_history relationship solves the
problem - better than failing to compile, but not so good if I needed a
relationship like that.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-169455" href="/Public/Bug/Display.html?id=3305#txn-169455">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;01&nbsp;11:36:33&nbsp;2006</span>
    <span class="description">tony [...] kasei.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #3305] has_many cause compilation error</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 1 Mar 2006 16:36:06 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Guest via RT &lt;bug-Class-DBI [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tony Bowden &lt;tony [...] kasei.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/169455/55063/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/55063">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 547b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, Mar 01, 2006 at 10:16:21AM -0500, Guest via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m guessing that the new has_many code doesn&#39;t like me having both a
&gt; has_a and a has_many from one class to another
</div>
This shouldn&#39;t be the problem.

I can&#39;t see from glancing at your two packages where the problem might
lie, but if you could turn them into a standalone test with which I can
actually replicate the error, &#40;i.e not referencing classes which aren&#39;t
included, and ideally against an SQLite database&#41; then I should be able
to track it down and fix it.

Thanks,

Tony
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.695711</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
