<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #131696 for Text-CSV_XS: Ability to ignore trailing commas in header?</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #131696 for Text-CSV_XS: Ability to ignore trailing commas in header?</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Text-CSV_XS/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Text-CSV_XS/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Text-CSV_XS/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Text-CSV_XS/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Text-CSV_XS">Text-CSV_XS CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">131696</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Text-CSV_XS/Active/">Text-CSV_XS</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
violapiratejunky [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-31868-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31869-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;05&nbsp;15:20:55&nbsp;2020</span>
    <span class="description">violapiratejunky [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Ability to ignore trailing commas in header?</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I often get CSVs that have trailing commas in the header &#40;empty header fields&#41;. LibreOffice etc open this fine, but it causes this in Text::CSV_XS:

# CSV_XS ERROR: 1012 - INI - the header contains an empty field @ rec 1 pos 0

Is it possible that we could have an option to ignore trailing commas in the header &#40;and rows, if that applies&#41;. Right now I just open the file and remove any trailing commas from the first line before parsing it with Text::CSV_XS
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;10&nbsp;10:34:55&nbsp;2020</span>
    <span class="description">HMBRAND [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">As there are &#40;plenty&#41; of options already to do so, I&#39;d need to know how you open the file and what initialization you use to parse the header and the file.

A &#40;big&#41; danger in stripping empty header fields is that hashes cannot be filled, as those &#34;trailing&#34; header-less columns quite often *do* contain data that cannot be stored in hash-entries with no label/key

See <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/Tux/Text-CSV_XS/blob/master/doc/CSV_XS.md#getline_hr">https://github.com/Tux/Text-CSV_XS/blob/master/doc/CSV_XS.md#getline_hr</a></span>

See <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/Tux/Text-CSV_XS/blob/master/doc/CSV_XS.md#callbacks-1">https://github.com/Tux/Text-CSV_XS/blob/master/doc/CSV_XS.md#callbacks-1</a></span> for a bunch of possible solutions
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;10&nbsp;10:34:56&nbsp;2020</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;26&nbsp;22:57:08&nbsp;2020</span>
    <span class="description">violapiratejunky [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for pointing me to those solutions! I think using the error callback and ignoring the error code is probably the correct way to handle that. I guess there could be an option to do the callback I would write, but maybe that&#39;s too specific to warrant its own option, especially when you point out that often it can be a mistake since the columns really do contain data.

On Mon Feb 10 10:34:55 2020, HMBRAND wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As there are &#40;plenty&#41; of options already to do so, I&#39;d need to know
&gt; how you open the file and what initialization you use to parse the
&gt; header and the file.
&gt; 
&gt; A &#40;big&#41; danger in stripping empty header fields is that hashes cannot
&gt; be filled, as those &#34;trailing&#34; header-less columns quite often *do*
&gt; contain data that cannot be stored in hash-entries with no label/key
&gt; 
&gt; See <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/Tux/Text-">https://github.com/Tux/Text-</a></span>
&gt; CSV_XS/blob/master/doc/CSV_XS.md#getline_hr
&gt; 
&gt; See <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/Tux/Text-">https://github.com/Tux/Text-</a></span>
&gt; CSV_XS/blob/master/doc/CSV_XS.md#callbacks-1 for a bunch of possible
&gt; solutions
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;20&nbsp;10:42:36&nbsp;2020</span>
    <span class="description">HMBRAND [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;22&nbsp;12:52:24&nbsp;2020</span>
    <span class="description">violapiratejunky [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Actually, I&#39;m not sure that this works? I have this:

    my $rows = csv&#40;
        in =&gt; $fh,
        headers =&gt; &#39;auto&#39;,
        encoding =&gt; &#39;:encoding&#40;utf-8&#41;&#39;,
        auto_diag =&gt; 1,
        callbacks =&gt; {
            error =&gt; sub {
                my &#40;$err&#41; = @_;
                say &#34;I&#39;m IN HERE $err&#34;;
                if &#40;$err == 1012&#41; {
                    say &#34;Setting diag to 0&#34;;
                    Text::CSV_XS-&gt;SetDiag&#40;0&#41;;
                }

                return;
            },
        },
    &#41;;

I can see that the code does get in there, but I still get this error and my script stops:

INI - the header contains an empty field at /path/to/script.pl

On Sun Apr 26 22:57:08 2020, srchulo wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks for pointing me to those solutions! I think using the error
&gt; callback and ignoring the error code is probably the correct way to
&gt; handle that. I guess there could be an option to do the callback I
&gt; would write, but maybe that&#39;s too specific to warrant its own option,
&gt; especially when you point out that often it can be a mistake since the
&gt; columns really do contain data.
&gt; 
&gt; On Mon Feb 10 10:34:55 2020, HMBRAND wrote:
<div class="message-stanza open">&gt; &gt; As there are &#40;plenty&#41; of options already to do so, I&#39;d need to know
&gt; &gt; how you open the file and what initialization you use to parse the
&gt; &gt; header and the file.
&gt; &gt;
&gt; &gt; A &#40;big&#41; danger in stripping empty header fields is that hashes cannot
&gt; &gt; be filled, as those &#34;trailing&#34; header-less columns quite often *do*
&gt; &gt; contain data that cannot be stored in hash-entries with no label/key
&gt; &gt;
&gt; &gt; See <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/Tux/Text-">https://github.com/Tux/Text-</a></span>
&gt; &gt; CSV_XS/blob/master/doc/CSV_XS.md#getline_hr
&gt; &gt;
&gt; &gt; See <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/Tux/Text-">https://github.com/Tux/Text-</a></span>
&gt; &gt; CSV_XS/blob/master/doc/CSV_XS.md#callbacks-1 for a bunch of possible
&gt; &gt; solutions
</div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;23&nbsp;07:43:49&nbsp;2020</span>
    <span class="description">h.m.brand [...] xs4all.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #131696] Ability to ignore trailing commas in header?</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 23 May 2020 13:43:26 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-CSV_XS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;H.Merijn Brand&#34; &lt;h.m.brand [...] xs4all.nl&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, 22 May 2020 12:52:25 -0400, &#34;Adam Hopkins via RT&#34; &lt;bug-Text-CSV_XS@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Actually, I&#39;m not sure that this works? I have this:
&gt; 
&gt;     my $rows = csv&#40;
&gt;         in =&gt; $fh,
&gt;         headers =&gt; &#39;auto&#39;,
&gt;         encoding =&gt; &#39;:encoding&#40;utf-8&#41;&#39;,
&gt;         auto_diag =&gt; 1,
&gt;         callbacks =&gt; {
&gt;             error =&gt; sub {
&gt;                 my &#40;$err&#41; = @_;
&gt;                 say &#34;I&#39;m IN HERE $err&#34;;
&gt;                 if &#40;$err == 1012&#41; {
&gt;                     say &#34;Setting diag to 0&#34;;
&gt;                     Text::CSV_XS-&gt;SetDiag&#40;0&#41;;
&gt;                 }
&gt; 
&gt;                 return;
&gt;             },
&gt;         },
&gt;     &#41;;
&gt; 
&gt; I can see that the code does get in there, but I still get this error
&gt; and my script stops:
&gt; 
&gt; INI - the header contains an empty field at /path/to/script.pl
</div>
This is because the &#34;header&#34; method calls &#34;croak&#34;, as on these errors,
subsequent behavior is undefined and moving on is more dangerous than
trying to continue.  Ignoring this error is most likely to cause fail
later on.

What you want for the header is a munger, as described in the manual,
for &#34;db&#34;, that would be something like:

--8&lt;---
use Data::Peek;
use Text::CSV_XS qw&#40; csv &#41;;

my $no_col = &#34;nc000&#34;;
my $rows = csv &#40;
    in        =&gt; *DATA,
    encoding  =&gt; &#34;:encoding&#40;utf-8&#41;&#34;,
    bom       =&gt; 1,
    munge     =&gt; sub { lc &#40;s/\W+/_/gr =~ s/^_+//r&#41; || $no_col++ },
    auto_diag =&gt; 1,
    callbacks =&gt; {
        error =&gt; sub {
            my &#40;$err&#41; = @_;
            say &#34;I&#39;m IN HERE $err&#34;;
            if &#40;$err == 1012&#41; {
                say &#34;Setting diag to 0&#34;;
                Text::CSV_XS-&gt;SetDiag &#40;0&#41;;
                }
            return;
            },
        },
    &#41;;
DDumper $rows;
--&gt;8---

=&gt;

I&#39;m IN HERE 2012
[
    {   a                =&gt; &#39;1&#39;,
        b                =&gt; &#39;2&#39;,
        c                =&gt; &#39;3&#39;,
        nc000            =&gt; &#39;&#39;
        }
    ]

-- 
H.Merijn Brand  <span class="clickylink"><a target="new" rel="nofollow" href="http://tux.nl">http://tux.nl</a></span>   Perl Monger  <span class="clickylink"><a target="new" rel="nofollow" href="http://amsterdam.pm.org/">http://amsterdam.pm.org/</a></span>
using perl5.00307 .. 5.31      porting perl5 on HP-UX, AIX, and Linux
<span class="clickylink"><a target="new" rel="nofollow" href="https://useplaintext.email">https://useplaintext.email</a></span>  <span class="clickylink"><a target="new" rel="nofollow" href="https://tux.nl">https://tux.nl</a></span>  <span class="clickylink"><a target="new" rel="nofollow" href="http://www.test-smoke.org">http://www.test-smoke.org</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://qa.perl.org">http://qa.perl.org</a></span>   <span class="clickylink"><a target="new" rel="nofollow" href="http://www.goldmark.org/jeff/stupid-disclaimers/">http://www.goldmark.org/jeff/stupid-disclaimers/</a></span>
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
