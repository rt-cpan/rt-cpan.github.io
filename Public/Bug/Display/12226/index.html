<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #12226 for Plucene: Bug fix for terms that are the single character 0</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #12226 for Plucene: Bug fix for terms that are the single character 0</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Plucene">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Plucene">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Plucene">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Plucene">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Plucene">Plucene CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">12226</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Plucene">Plucene</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
mintywalker [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-25988-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.21    </td>
  </tr>
  <tr id="CF-25989-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




regress-05.t<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/158659/49078/regress-05.t">
Wed Jan 25 03:07:10 2006 (2.3k) by Guest
</a>
</font></li>
</ul>


zero_digit_patches.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/128984/33519/zero_digit_patches.txt">
Sun Apr 10 04:49:29 2005 (2.9k) by 
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=12226">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-128984" href="/Public/Bug/Display.html?id=12226#txn-128984">#</a>      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;10&nbsp;04:49:29&nbsp;2005</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Bug fix for terms that are the single character 0</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/128984/33518/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/33518">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 535b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
The single term 0 &#40;the digit zero&#41; causes problems when indexing.

To reproduce, try indexing using a WhiteSpaceAnalyzer the text

  &#34;a 0 is higher than . in ascii&#34;
  and/or
  &#34;a 0 causes problems with 0.0.0.0&#34;

The attached file has one patch each for

  lib/Plucene/Index/TermInfosWriter.pm
  lib/Plucene/Index/SegmentTermEnum.pm

A unit test &#40;t/regress-05.t&#41; is also included that tests for this problem.

For more details see the thread titled &#34;out-of-order term&#34; 
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.kasei.com/pipermail/plucene/2005-April/thread.html#345">http://www.kasei.com/pipermail/plucene/2005-April/thread.html#345</a></span>
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/128984/33519/zero_digit_patches.txt">Download zero_digit_patches.txt</a><br />
<span class="downloadcontenttype">text/text 2.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">===============================================================================

lib/Plucene/Index/TermInfosWriter.pm
131c131,132
&lt;	my $text = $term-&gt;text || &#34;&#34;;
---
&gt;	my $text = $term-&gt;text;
&gt;	if &#40;not defined&#40;$text&#41;&#41; { $text = &#39;&#39;; }

===============================================================================

lib/Plucene/Index/SegmentTermEnum.pm
136c136
&lt;	$self-&gt;{buffer} ||= &#34; &#34; x $length;
---
&gt;	if &#40;not defined&#40;$self-&gt;{buffer}&#41;&#41; { $self-&gt;{buffer} = &#34; &#34; x $length; }

===============================================================================

t/regress-05.t
#!/usr/bin/perl -w

=head1 NAME

regress-05.t

Check an index is created with the terms you expect.

Introduced for testing bugs in Plucene v 1.21 which had 
problems dealing with a term that was the single character
zero &#40;0&#41;.  

We create an index using various chunks of text, then test
that each term in the index matches what we are expecting.

=cut

use strict;
use warnings;
use Plucene::Document;
use Plucene::Document::Field;
use Plucene::Index::Writer;
use Plucene::Analysis::WhitespaceAnalyzer;
use Plucene::Search::IndexSearcher;
use File::Temp qw&#40;tempdir&#41;;
require Test::More;

$| = 0;
my $dir = tempdir&#40;CLEANUP =&gt; 1&#41;;

my @strings = &#40;
	&#39;a simple test that should pass&#39;,
	&#39;something lower than 0 in ascii is . &#40;aka a period&#41;&#39;,
	&#39;a test with a 0 and 0.0.0.0 terms&#39;,
&#41;;
Test::More-&gt;import&#40;tests =&gt; scalar&#40;@strings&#41;&#41;;

foreach &#40;@strings&#41; { &#38;test_build&#40;$_&#41;; }

sub test_build {
	my $string = shift;

	# Setup out index
	my $analyzer = Plucene::Analysis::WhitespaceAnalyzer-&gt;new&#40;&#41;;
	my $writer = Plucene::Index::Writer-&gt;new&#40;$dir, $analyzer, 1&#41;;
	my $doc = Plucene::Document-&gt;new;

	# Index the string and close the writer/index.
	$doc-&gt;add&#40;Plucene::Document::Field-&gt;Text&#40;&#34;content&#34;, $string&#41;&#41;;
	$writer-&gt;add_document&#40;$doc&#41;;
	$writer-&gt;optimize&#40;&#41;; # This invalidates $writer
	undef $writer; # Forces $writer-&gt;DESTROY&#40;&#41; to be called, merging segments

	# Read the index back in and compare each term
	my $searcher = Plucene::Search::IndexSearcher-&gt;new&#40; $dir &#41;;
	my $enum = $searcher-&gt;reader-&gt;terms&#40;&#41;;

	my @all = sort split&#40;/\s+/, $string&#41;;
	my @keys;
	for &#40;my $i = 0; $i &lt; scalar&#40;@all&#41;; $i++&#41; {
		if &#40; &#40;$i &gt; 0&#41; and &#40;$all[$i-1] eq $all[$i]&#41;&#41; { next; }
		push&#40;@keys, $all[$i]&#41;;
	}

	my &#40;$pos, $success&#41; = &#40;0,1&#41;;
	while&#40;$enum-&gt;next&#41; {
		if &#40;$enum-&gt;term-&gt;text ne $keys[$pos++]&#41; {
			$success = 0;
			last;
		}
	}
	if &#40;not $success&#41; {
		ok&#40;0, &#34;Term not matching expected result\n&#34; . 
			&#34;Expecting term &#39;&#34; . $keys[$pos - 1] . &#34;&#39; but got &#39;&#34; .
			$enum-&gt;term-&gt;text . &#34;&#39;\nwhile testing the string &#39;$string&#39;&#34;&#41;;
	} 
	elsif &#40;scalar&#40;@keys ne $pos&#41;&#41; {
		ok&#40;0, &#34;Not enough terms in the index\n&#34; . 
			&#34;Expecting &#34; . scalar&#40;@keys&#41; . &#34; but only found $pos\n&#34; . 
			&#34;while testing the string &#39;$string&#39;&#34;&#41;;
	}
	else { ok&#40;1&#41;; }
}

===============================================================================
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-128985" href="/Public/Bug/Display.html?id=12226#txn-128985">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;17&nbsp;06:35:24&nbsp;2005</span>
    <span class="description">TMTM [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/128985/37585/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/37585">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 503b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[guest - Sun Apr 10 04:49:29 2005]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The single term 0 &#40;the digit zero&#41; causes problems when indexing.
&gt; A unit test &#40;t/regress-05.t&#41; is also included that tests for this
&gt;    problem.
&gt; 
&gt; For more details see the thread titled &#34;out-of-order term&#34;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.kasei.com/pipermail/plucene/2005-April/thread.html#345">http://www.kasei.com/pipermail/plucene/2005-April/thread.html#345</a></span>
</div>
I&#39;m not really liking the test here - it seems a little too low level.
Can we not just have a test that indexes and searches, rather than
reading the index back in? 

Thanks,

Tony
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-158659" href="/Public/Bug/Display.html?id=12226#txn-158659">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;25&nbsp;03:07:10&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/158659/49075/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/49075">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 223b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Jul 17 06:35:24 2005, TMTM wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m not really liking the test here - it seems a little too low level.
&gt; Can we not just have a test that indexes and searches, rather than
&gt; reading the index back in? 
</div>
attached.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/158659/49078/regress-05.t">Download regress-05.t</a><br />
<span class="downloadcontenttype">text/x-perl 2.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl -w

=head1 NAME

regress-05.t

Check an index is created with the terms you expect.

Introduced for testing bugs in Plucene v 1.21 which had
problems dealing with a term that was the single character
zero &#40;0&#41;.

Also tests for a bug present up to 1.24 that causes
numeric terms to be incorrectly indexed.

We create an index using various chunks of text, then test
that we can search the index correctly for those terms.

=cut

use strict;
use warnings;
use Plucene::Document;
use Plucene::Document::Field;
use Plucene::Index::Writer;
use Plucene::Analysis::WhitespaceAnalyzer;
use Plucene::Search::IndexSearcher;
use Plucene::QueryParser;
use File::Temp qw&#40;tempdir&#41;;
require Test::More;

$| = 0;
my $dir = tempdir&#40;CLEANUP =&gt; 1&#41;;

my @strings = &#40;
	&#39;a simple test that should pass&#39;,
	&#39;something lower than 0 in ascii is . [aka a period]&#39;,
	&#39;a test with a 0 and 0.0.0.0 terms&#39;,
&#41;;
Test::More-&gt;import&#40;tests =&gt; scalar&#40;@strings&#41;&#41;;

foreach &#40;@strings&#41; { &#38;test_build&#40;$_&#41;; }

sub test_build {

	my $string = shift;

	# Setup our index
	my $analyzer = Plucene::Analysis::WhitespaceAnalyzer-&gt;new&#40;&#41;;
	my $writer = Plucene::Index::Writer-&gt;new&#40;$dir, $analyzer, 1&#41;;
	my $doc = Plucene::Document-&gt;new;

	# Index the string and close the writer/index.
	$doc-&gt;add&#40;Plucene::Document::Field-&gt;Text&#40;&#34;content&#34;, $string&#41;&#41;;
	$writer-&gt;add_document&#40;$doc&#41;;
	$writer-&gt;optimize&#40;&#41;; # This invalidates $writer
	undef $writer; # Forces $writer-&gt;DESTROY&#40;&#41; to be called, merging segments

	# Prepare to search on the index
	my $searcher = Plucene::Search::IndexSearcher-&gt;new&#40; $dir &#41;;
	my $parser   = Plucene::QueryParser-&gt;new&#40;{
		analyzer =&gt; Plucene::Analysis::WhitespaceAnalyzer-&gt;new&#40;&#41;,
		default  =&gt; &#39;content&#39;
	}&#41;;

	# Split the indexed term into words and check each exists in 
	# the index.
	my $hit = 0;
	my @terms = split&#40;/\s+/, $string&#41;;
	my @missed;
	foreach my $term &#40;@terms&#41; {
		#print&#40;&#34;-$term-\n&#34;&#41;;
		my $query = $parser-&gt;parse&#40;&#34;content:$term&#34;&#41;;
		my $hits = $searcher-&gt;search&#40;$query&#41;;
		if &#40;$hits-&gt;length&#40;&#41; &gt; 0&#41; { $hit++; }
		else { push&#40;@missed, $term&#41;; }
	}

	if &#40;$hit == scalar&#40;@terms&#41;&#41; { ok&#40;1&#41;; }
	else {
		my $msg = &#34;The following terms &#40;minus the quotes&#41; were either &#34; . 
		&#34;not indexed, or failed to be found when searched for:\n  &#34;;
		foreach my $missed &#40;@missed&#41; { $msg .= &#34;&#39;$missed&#39;,&#34;; }
		chop&#40;$msg&#41;;
		$msg .= &#34;\nwhile testing the string &#39;$string&#39;&#34;;
		ok&#40;0, $msg&#41;;
	}

} 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-158660" href="/Public/Bug/Display.html?id=12226#txn-158660">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;25&nbsp;03:07:11&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-169990" href="/Public/Bug/Display.html?id=12226#txn-169990">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;02&nbsp;17:50:11&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/169990/55380/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/55380">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 743b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have a similar problem with the WhitespaceAnalyzer when characters 
other than a-z or 0-9 are involved.

When using the default values 
for /usr/local/share/perl/5.8.4/Plucene/Analysis/WhitespaceTokenizer.pm

sub token_re { qr/\S+/ }

the indexing will fail with an error similar to:

Docs out of order &#40;44 &lt; 53&#41; 
at /usr/local/share/perl/5.8.4/Plucene/Index/SegmentMerger.pm line 149.

But when changing the token_re function into:

sub token_re { qr/[a-z\d]+/ }

which will only allow a-z and 0-9 the indexing has no problems what so 
ever &#40;at least I dont get the above error message&#41;.

This is using plucene 1.24 downloaded through cpan using

perl -MCPAN -e &#39;install Plucene&#39;

on a debian box running linux 2.6 kernel and perl 5.8.4.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-170060" href="/Public/Bug/Display.html?id=12226#txn-170060">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;03&nbsp;02:27:17&nbsp;2006</span>
    <span class="description">tony [...] kasei.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #12226] Bug fix for terms that are the single character 0</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 3 Mar 2006 07:26:56 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Guest via RT &lt;bug-plucene [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tony Bowden &lt;tony [...] kasei.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/170060/55424/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/55424">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 330b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Mar 02, 2006 at 05:50:12PM -0500, Guest via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; When using the default values 
&gt; for /usr/local/share/perl/5.8.4/Plucene/Analysis/WhitespaceTokenizer.pm
&gt; sub token_re { qr/\S+/ }
&gt; the indexing will fail with an error similar to:
&gt; Docs out of order &#40;44 &lt; 53&#41; 
</div>
Any chance of a test case for this?

Thanks,

Tony
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-170063" href="/Public/Bug/Display.html?id=12226#txn-170063">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;03&nbsp;03:39:40&nbsp;2006</span>
    <span class="description">mintywalker [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #12226] Bug fix for terms that are the single character 0</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 3 Mar 2006 08:39:27 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-plucene [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Minty &lt;mintywalker [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/170063/55427/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/55427">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 474b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">not me, but I&#39;ll email the guy and see if he can help :&#41;

On 3/3/06, Tony Bowden via RT &lt;bug-plucene@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu, Mar 02, 2006 at 05:50:12PM -0500, Guest via RT wrote:
<div class="message-stanza open">&gt; &gt; When using the default values
&gt; &gt; for /usr/local/share/perl/5.8.4/Plucene/Analysis/WhitespaceTokenizer.pm
&gt; &gt; sub token_re { qr/\S+/ }
&gt; &gt; the indexing will fail with an error similar to:
&gt; &gt; Docs out of order &#40;44 &lt; 53&#41;
</div>&gt;
&gt; Any chance of a test case for this?
&gt;
&gt; Thanks,
&gt;
&gt; Tony
&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-170171" href="/Public/Bug/Display.html?id=12226#txn-170171">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;03&nbsp;06:59:09&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Apachez</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/170171/55464/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/55464">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 607b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have emailed Minty a sample of data where the error occurs along 
with the script I use to send data from the database &#40;mysql&#41; into 
plucene.

During my more aggressive tests to collect data for the sample I 
received another error which might in more detail point to where the 
actual error can be located:

&#34;
Docs out of order &#40;44 &lt; 49&#41; 
at /usr/local/share/perl/5.8.4/Plucene/Index/SegmentMerger.pm line 149.
        &#40;in cleanup&#41; Can&#39;t call method &#34;seek&#34; on an undefined value 
at /usr/local/share/perl/5.8.4/Plucene/Index/TermInfosWriter.pm line 
146 during global destruction.
&#34;

Kind Regards
Apachez
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.515913</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
