<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #69350 for DBD-Oracle: Issue in 31lob.t for DBD::Oracle 1.28</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #69350 for DBD-Oracle: Issue in 31lob.t for DBD::Oracle 1.28</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DBD-Oracle/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DBD-Oracle/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DBD-Oracle/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DBD-Oracle/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/pythian/DBD-Oracle/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-Oracle">DBD-Oracle CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">69350</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DBD-Oracle/Active/">DBD-Oracle</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">champoux [...] pythian.com
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
wes [...] smellycat.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-10192-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10193-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;07&nbsp;20:34:27&nbsp;2011</span>
    <span class="description">wes [...] smellycat.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Wes Brown &lt;wes [...] smellycat.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Issue in 31lob.t for DBD::Oracle 1.28</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 7 Jul 2011 20:34:09 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-Oracle [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Wes Brown &lt;wes [...] smellycat.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">$ perl5 -v

This is perl 5, version 12, subversion 3 &#40;v5.12.3&#41; built for x86_64-linux-thread-multi

Very similar to ID: 69305

Ran the tests for DBD::Oracle 1.28 against Oracle Database 10g Enterprise
Edition Release 10.2.0.4.0 - 64bit Production on HP-UX from 
Oracle client Release 11.2.0.2.0 Production on RedHat AS 5.5 x86_64 and
saw some problems in 31lob.t.
Here are the issues:

[uuuuuuuu@xxxxxxxxx DBD-Oracle-1.28]$ prove -b -v  t/31lob.t
t/31lob.t ..
1..12
ok 1 - returned valid locator
ok 2 - inserted into BLOB successfully
ok 3 - got back what we put in
ok 4 - returned valid locator
ok 5 - returned valid locator
ok 6 - returned initialized locator
ok 7 - returned length
ok 8 - returned written value
not ok 9 - returned length via PL/SQL

#   Failed test &#39;returned length via PL/SQL&#39;
#   at t/31lob.t line 152.
#          got: undef
#     expected: &#39;40000&#39;
Errors in file :
OCI-21500: internal error code, arguments: [kghufree_06], [0x01E724258],
[0], [0], [0], [], [], []
Ð 4Ð 4Ð
4ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿm¤YÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÜV²+ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÜV²+ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÜV²+`o¤Y`o¤Y`o¤Y`o¤Y`o¤Y`o¤Y`o¤Y`o¤YErrors
in file :
OCI-21500: internal error code, arguments: [kghufree_06], [0x01E724258],
[0], [0], [0], [], [], []
Ð 4Ð 4Ð
4ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿo¤YÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÜV²+ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÜV²+ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÜV²+Pq¤YPq¤YPq¤YPq¤YPq¤YPq¤YPq¤YPq¤Y
Dubious, test returned 1 &#40;wstat 256, 0x100&#41;
Failed 4/12 subtests

Test Summary Report
-------------------
t/31lob.t &#40;Wstat: 256 Tests: 9 Failed: 1&#41;
  Failed test:  9
  Non-zero exit status: 1
  Parse errors: Bad plan.  You planned 12 tests but ran 9.
Files=1, Tests=9,  0 wallclock secs &#40; 0.03 usr  0.02 sys +  0.07 cusr
0.09 csys =  0.21 CPU&#41;
Result: FAIL

Wes
--- 
Wes Brown
ewb4@alumni.cwru.edu            wes@smellycat.com
<span class="clickylink"><a target="new" rel="nofollow" href="http://web.smellycat.com/wes/About.me.html">http://web.smellycat.com/wes/About.me.html</a></span>
KB8TGR
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;08&nbsp;09:47:55&nbsp;2011</span>
    <span class="description">champoux [...] pythian.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jul 07 20:34:27 2011, wes@smellycat.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; $ perl5 -v
&gt; 
&gt; This is perl 5, version 12, subversion 3 &#40;v5.12.3&#41; built for x86_64-
&gt;    linux-thread-multi
&gt; 
&gt; Very similar to ID: 69305
</div>
Yup, looks like it. 

If possible, can you try to run the tests against v1.28 of DBD::Oracle?
I&#39;m curious to see if that&#39;s a new bug, or it&#39;s something that has been
around and is bubbling up for 11g &#40;it should be the former, but getting
confirmation would be nice&#41;.

Thanks for the bug report!
`/anick
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;08&nbsp;09:47:56&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;08&nbsp;09:48:37&nbsp;2011</span>
    <span class="description">champoux [...] pythian.com -  Reference to ticket #69305 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;08&nbsp;23:12:00&nbsp;2011</span>
    <span class="description">wes [...] smellycat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Wes Brown &lt;wes [...] smellycat.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69350] Issue in 31lob.t for DBD::Oracle 1.28</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 8 Jul 2011 23:11:34 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Pythian Remote DBA via RT &lt;bug-DBD-Oracle [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Wes Brown &lt;wes [...] smellycat.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Jul 08, 2011 at 09:47:56AM -0400, Pythian Remote DBA via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=69350">https://rt.cpan.org/Ticket/Display.html?id=69350</a></span> &gt;
&gt; 
&gt; On Thu Jul 07 20:34:27 2011, wes@smellycat.com wrote:
<div class="message-stanza open">&gt; &gt; $ perl5 -v
&gt; &gt; 
&gt; &gt; This is perl 5, version 12, subversion 3 &#40;v5.12.3&#41; built for x86_64-
&gt; &gt;    linux-thread-multi
&gt; &gt; 
&gt; &gt; Very similar to ID: 69305
</div>&gt; 
&gt; Yup, looks like it. 
&gt; 
&gt; If possible, can you try to run the tests against v1.28 of DBD::Oracle?
&gt; I&#39;m curious to see if that&#39;s a new bug, or it&#39;s something that has been
&gt; around and is bubbling up for 11g &#40;it should be the former, but getting
&gt; confirmation would be nice&#41;.
&gt; 
&gt; Thanks for the bug report!
&gt; `/anick
</div>
I shall work with the correct folks to get access to one of our Oracle 11
databases as well as do the same build using our Oracle 11 Client install.
I will report the other three tests back so it can assist.

11.2 Client -&gt; 10.2 Database &#40;Done&#41;
10.2 Client -&gt; 10.2 Database
11.2 Client -&gt; 11.2 Database
10.2 Client -&gt; 11.2 Database

Thanks

Wes
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;11&nbsp;09:56:16&nbsp;2011</span>
    <span class="description">wes [...] smellycat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69350] Issue in 31lob.t for DBD::Oracle 1.28</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 11 Jul 2011 09:55:57 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Pythian Remote DBA via RT &lt;bug-DBD-Oracle [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Wes Brown &lt;wes [...] smellycat.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I shall work with the correct folks to get access to one of our Oracle 11
&gt; databases as well as do the same build using our Oracle 11 Client install.
&gt; I will report the other three tests back so it can assist.
&gt; 
&gt; 11.2 Client -&gt; 10.2 Database &#40;Done&#41;
&gt; 10.2 Client -&gt; 10.2 Database
&gt; 11.2 Client -&gt; 11.2 Database
&gt; 10.2 Client -&gt; 11.2 Database
&gt; 
&gt; Thanks
&gt; 
&gt; Wes
</div>
As requested, I have attached tests from Oracle 10 clients as well.  It
appears that those are working without issue.  Let me know how I can
assist in any further testing.  I will have access to both of these
databases for as long as necessary.

Wes


10.2 Client -&gt; 11.2 Database
Oracle 10.2.0.5.0 Client to Oracle Database 11g Enterprise Edition Release 11.2.0.2.0 - 64bit Production
$ prove -b -v  t/31lob.t
t/31lob.t ..
1..12
ok 1 - returned valid locator
ok 2 - inserted into BLOB successfully
ok 3 - got back what we put in
ok 4 - returned valid locator
ok 5 - returned valid locator
ok 6 - returned initialized locator
ok 7 - returned length
ok 8 - returned written value
ok 9 - returned length via PL/SQL
ok 10 - returned LOB as string
ok 11 - returned IN/OUT LOB as string
ok 12 # skip can&#39;t check num of temp lobs, no access to v$session
ok
All tests successful.
Files=1, Tests=12,  1 wallclock secs &#40; 0.03 usr  0.04 sys +  0.11 cusr  0.04 csys =  0.22 CPU&#41;
Result: PASS


11.2 Client -&gt; 11.2 Database
Oracle 11.2.0.2.0 Client to Oracle Database 11g Enterprise Edition Release 11.2.0.2.0 - 64bit Production
$ prove -b -v  t/31lob.t
t/31lob.t ..
1..12
ok 1 - returned valid locator
ok 2 - inserted into BLOB successfully
ok 3 - got back what we put in
ok 4 - returned valid locator
ok 5 - returned valid locator
ok 6 - returned initialized locator
ok 7 - returned length
ok 8 - returned written value
not ok 9 - returned length via PL/SQL

#   Failed test &#39;returned length via PL/SQL&#39;
#   at t/31lob.t line 152.
#          got: undef
#     expected: &#39;40000&#39;
Errors in file :
OCI-21500: internal error code, arguments: [kghufree_06], [0x0058F6258], [0], [0], [0], [], [], []
Ð 4Ð 4Ð 4ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿHÊjÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÜ&#38;®*ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÜ&#38;®*ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÜ&#38;®*àIÊjàIÊjàIÊjàIÊjàIÊjàIÊjàIÊjàIÊjErrors in file :
OCI-21500: internal error code, arguments: [kghufree_06], [0x0058F6258], [0], [0], [0], [], [], []
Ð 4Ð 4Ð 4ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÜ&#38;®*ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÜ&#38;®*ÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÿÜ&#38;®*ÐKÊjÐKÊjÐKÊjÐKÊjÐKÊjÐKÊjÐKÊjÐKÊj
Dubious, test returned 1 &#40;wstat 256, 0x100&#41;
Failed 4/12 subtests

Test Summary Report
-------------------
t/31lob.t &#40;Wstat: 256 Tests: 9 Failed: 1&#41;
  Failed test:  9
  Non-zero exit status: 1
  Parse errors: Bad plan.  You planned 12 tests but ran 9.
Files=1, Tests=9,  1 wallclock secs &#40; 0.03 usr  0.00 sys +  0.12 cusr  0.03 csys =  0.18 CPU&#41;
Result: FAIL

10.2 Client -&gt; 11.2 Database
Oracle 10.2.0.5.0 Client to Oracle Database 11g Enterprise Edition Release 11.2.0.2.0 - 64bit Production
$ prove -b -v  t/31lob.t
t/31lob.t ..
1..12
ok 1 - returned valid locator
ok 2 - inserted into BLOB successfully
ok 3 - got back what we put in
ok 4 - returned valid locator
ok 5 - returned valid locator
ok 6 - returned initialized locator
ok 7 - returned length
ok 8 - returned written value
ok 9 - returned length via PL/SQL
ok 10 - returned LOB as string
ok 11 - returned IN/OUT LOB as string
ok 12 # skip can&#39;t check num of temp lobs, no access to v$session
ok
All tests successful.
Files=1, Tests=12,  4 wallclock secs &#40; 0.04 usr  0.02 sys +  0.11 cusr  0.05 csys =  0.22 CPU&#41;
Result: PASS
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;12&nbsp;10:44:57&nbsp;2011</span>
    <span class="description">champoux [...] pythian.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69350] Issue in 31lob.t for DBD::Oracle 1.28</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 12 Jul 2011 10:44:45 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-Oracle [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Yanick Champoux &lt;champoux [...] pythian.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 07/11/11 09:56, Wes Brown via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As requested, I have attached tests from Oracle 10 clients as well.  It
&gt; appears that those are working without issue.  Let me know how I can
&gt; assist in any further testing.  I will have access to both of these
&gt; databases for as long as necessary.
</div>
     Many thanks.  That&#39;s going to be useful for the hunt of what looks
like an ugly cross-version problem. *put on OCI goggles and XS-diving 
gears*
This is going to be fun, I can feel it...

Joy,
`/anick
--
The best compliment you could give Pythian for our service is a referral.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;12&nbsp;10:45:18&nbsp;2011</span>
    <span class="description">champoux [...] pythian.com -  Severity Critical added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;13&nbsp;04:44:45&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Wes,

If you could run a failing example with ora_verbose set high &#40;6 I think&#41; 
and attach the output it might help someone identify the issue.

Just change 31lob.t so the connect call adds ora_verbose =&gt; 6 after that 
PrintError =&gt; 0 and rerun the test with prove -vb.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;13&nbsp;17:25:16&nbsp;2011</span>
    <span class="description">wes [...] smellycat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Wes Brown &lt;wes [...] smellycat.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69350] Issue in 31lob.t for DBD::Oracle 1.28</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 13 Jul 2011 17:24:46 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Martin J Evans via RT &lt;bug-DBD-Oracle [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Wes Brown &lt;wes [...] smellycat.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;27&nbsp;14:27:30&nbsp;2011</span>
    <span class="description">champoux [...] pythian.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hmmm... Darn. The 11.2g client/server combination is working on my machine:

$ prove -v -b t/00versions.t t/31lob.t 
t/00versions.t .. 
1..2
# OCI client library version: 11.2.0.1
ok 1
# database version: Oracle Database 11g Release 11.2.0.2.0 - 64bit
Production
ok 2
ok
t/31lob.t ....... 
1..12
ok 1 - returned valid locator
ok 2 - inserted into BLOB successfully
ok 3 - got back what we put in
ok 4 - returned valid locator
ok 5 - returned valid locator
ok 6 - returned initialized locator
ok 7 - returned length
ok 8 - returned written value
ok 9 - returned length via PL/SQL
ok 10 - returned LOB as string
ok 11 - returned IN/OUT LOB as string
ok 12 - no temp lobs left
ok
All tests successful.
Files=2, Tests=14,  2 wallclock secs &#40; 0.03 usr  0.01 sys +  0.14 cusr 
0.07 csys =  0.25 CPU&#41;                                   
Result: PASS
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;03&nbsp;13:12:07&nbsp;2011</span>
    <span class="description">wes [...] smellycat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69350] Issue in 31lob.t for DBD::Oracle 1.28</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 3 Aug 2011 13:11:52 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Pythian Remote DBA via RT &lt;bug-DBD-Oracle [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Wes Brown &lt;wes [...] smellycat.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, Jul 27, 2011 at 02:27:31PM -0400, Pythian Remote DBA via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=69350">https://rt.cpan.org/Ticket/Display.html?id=69350</a></span> &gt;
&gt; 
&gt; Hmmm... Darn. The 11.2g client/server combination is working on my machine:
&gt; 
&gt; $ prove -v -b t/00versions.t t/31lob.t 
&gt; t/00versions.t .. 
&gt; 1..2
&gt; # OCI client library version: 11.2.0.1
&gt; ok 1
&gt; # database version: Oracle Database 11g Release 11.2.0.2.0 - 64bit
&gt; Production
&gt; ok 2
&gt; ok
&gt; t/31lob.t ....... 
&gt; 1..12
&gt; ok 1 - returned valid locator
&gt; ok 2 - inserted into BLOB successfully
&gt; ok 3 - got back what we put in
&gt; ok 4 - returned valid locator
&gt; ok 5 - returned valid locator
&gt; ok 6 - returned initialized locator
&gt; ok 7 - returned length
&gt; ok 8 - returned written value
&gt; ok 9 - returned length via PL/SQL
&gt; ok 10 - returned LOB as string
&gt; ok 11 - returned IN/OUT LOB as string
&gt; ok 12 - no temp lobs left
&gt; ok
&gt; All tests successful.
&gt; Files=2, Tests=14,  2 wallclock secs &#40; 0.03 usr  0.01 sys +  0.14 cusr 
&gt; 0.07 csys =  0.25 CPU&#41;                                   
&gt; Result: PASS
</div>
Is it possible that it is something that crept in at Oracle Client version
11.2.0.2.x?  This is about the only thing that is different that I can see
from my less than expert point of observation.

Thanks

Wes
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;26&nbsp;15:34:02&nbsp;2011</span>
    <span class="description">champoux [...] pythian.com -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;26&nbsp;15:35:23&nbsp;2011</span>
    <span class="description">champoux [...] pythian.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Gwen was able to reproduce the problem, and confirmed that the issue is
not a new one for 1.29_1, but is present to all releases since 1.24. In
light of that, I&#39;m going ahead with the release of 1.30 &#40;and will try to
squash this bug for 1.32&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;03&nbsp;06:07:04&nbsp;2012</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Aug 26 15:35:23 2011, PYTHIAN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Gwen was able to reproduce the problem, and confirmed that the issue is
&gt; not a new one for 1.29_1, but is present to all releases since 1.24. In
&gt; light of that, I&#39;m going ahead with the release of 1.30 &#40;and will try to
&gt; squash this bug for 1.32&#41;.
</div>
I don&#39;t understand why 31lob.t now says:

plan skip_all =&gt; &#34;see RT#69350&#34;
    if ORA_OCI&#40;&#41; =~ /^11\.2\./;

I have 11.2 and if I uncomment the above the test runs fine.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;05&nbsp;13:17:51&nbsp;2012</span>
    <span class="description">champoux [...] pythian.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69350] Issue in 31lob.t for DBD::Oracle 1.28</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 05 Mar 2012 13:17:39 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-Oracle [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Yanick Champoux &lt;champoux [...] pythian.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 03/03/12 06:07, Martin J Evans via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I don&#39;t understand why 31lob.t now says:
&gt;
&gt; plan skip_all =&gt;  &#34;see RT#69350&#34;
&gt;      if ORA_OCI&#40;&#41; =~ /^11\.2\./;
&gt;
&gt; I have 11.2 and if I uncomment the above the test runs fine.
</div>
     Yes, if you look at the previous comments, some installations with 
11.2 do have successful test runs. It, however, appears that there are 
some instances that do die in the middle of the test file.

     It would be more logical to use a TODO wrapper in there instead of 
a skip_all, but the general idea is not to have random installations 
fail because of that test, until we can figure out what is the core problem.


`/anick

-- 
Yanick Champoux, Senior Perl Developer
The Pythian Group - love your data
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.pythian.com">http://www.pythian.com</a></span>


-- 
--
Pythian proud winner of Oracle North America Titan Award for Exadata 
Solution...watch the video on pythian.com
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;05&nbsp;14:03:00&nbsp;2012</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Mar 05 13:17:51 2012, PYTHIAN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 03/03/12 06:07, Martin J Evans via RT wrote:
<div class="message-stanza open">&gt; &gt; I don&#39;t understand why 31lob.t now says:
&gt; &gt;
&gt; &gt; plan skip_all =&gt;  &#34;see RT#69350&#34;
&gt; &gt;      if ORA_OCI&#40;&#41; =~ /^11\.2\./;
&gt; &gt;
&gt; &gt; I have 11.2 and if I uncomment the above the test runs fine.
</div>&gt; 
&gt;      Yes, if you look at the previous comments, some installations with 
&gt; 11.2 do have successful test runs. It, however, appears that there are 
&gt; some instances that do die in the middle of the test file.
&gt; 
&gt;      It would be more logical to use a TODO wrapper in there instead of 
&gt; a skip_all, but the general idea is not to have random installations 
&gt; fail because of that test, until we can figure out what is the core
</div>problem.

Wouldn&#39;t it make more sense to run the test whatever, as in fact, there
is a problem. If I had this issue with my 11.2 I&#39;d want to know I&#39;ve
probably got a issue with lobs rather than just skip it then find lobs
fail later in my code.

In DBD::ODBC there are a number of drivers I&#39;ve found with bugs and I&#39;ve
wrestled with whether to leave the test failing or to catch the failure
and issue a warning but not fail the test. Where there is a workaround
I&#39;ve always done the latter and where there isn&#39;t I always did the
former but then I got loads of people reporting a test error I already
knew about so I changed it to no fail and issue a warning.

I think it is better to run the test, catch the issue and warn the user
they could have problems with lobs. It is also more likely to lead to a
fix from Oracle as the issue looks like an oracle one. I would have
reported it to Oracle but as I&#39;ve never seen it myself I cannot do that.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;26&nbsp;14:12:11&nbsp;2012</span>
    <span class="description">mmusgrove [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">31lob.t fails for me with Perl 5.12.3 and Oracle 11.1.07. I&#39;m not sure
how long it&#39;s been failing &#40;presumably since 1.28 but I&#39;m not positive&#41;.

I&#39;ve attached the output of prove -vb t/31lob.t with ora_verbose =&gt; 6
&#40;sanitizied to remove db username/password&#41;.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 31lob failed.txt</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;24&nbsp;05:15:19&nbsp;2012</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Mar 26 14:12:11 2012, MMUSGROVE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 31lob.t fails for me with Perl 5.12.3 and Oracle 11.1.07. I&#39;m not sure
&gt; how long it&#39;s been failing &#40;presumably since 1.28 but I&#39;m not positive&#41;.
&gt; 
&gt; I&#39;ve attached the output of prove -vb t/31lob.t with ora_verbose =&gt; 6
&gt; &#40;sanitizied to remove db username/password&#41;.
&gt; 
</div>
I really don&#39;t know what to do with this RT. It is failing in
OCIDescriptorFree with an internal Oracle error and I cannot find that
error listed in Oracle bug fixes. I cannot personally report issues to
Oracle so I&#39;m stuck.

Changing to stalled for now.

I still think it would be best not to skip this test but run it and
capture the problem outputting a warning if found then at least the
people with this issue will know to avoid it.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;24&nbsp;05:15:44&nbsp;2012</span>
    <span class="description">bohica [...] ntlworld.com -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;24&nbsp;16:54:25&nbsp;2012</span>
    <span class="description">wes [...] smellycat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69350] Issue in 31lob.t for DBD::Oracle 1.28</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 24 Jun 2012 16:54:08 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Martin J Evans via RT &lt;bug-DBD-Oracle [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Wes Brown &lt;wes [...] smellycat.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun, Jun 24, 2012 at 05:15:26AM -0400, Martin J Evans via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=69350">https://rt.cpan.org/Ticket/Display.html?id=69350</a></span> &gt;
&gt; 
&gt; On Mon Mar 26 14:12:11 2012, MMUSGROVE wrote:
<div class="message-stanza open">&gt; &gt; 31lob.t fails for me with Perl 5.12.3 and Oracle 11.1.07. I&#39;m not sure
&gt; &gt; how long it&#39;s been failing &#40;presumably since 1.28 but I&#39;m not positive&#41;.
&gt; &gt; 
&gt; &gt; I&#39;ve attached the output of prove -vb t/31lob.t with ora_verbose =&gt; 6
&gt; &gt; &#40;sanitizied to remove db username/password&#41;.
&gt; &gt; 
</div>&gt; 
&gt; I really don&#39;t know what to do with this RT. It is failing in
&gt; OCIDescriptorFree with an internal Oracle error and I cannot find that
&gt; error listed in Oracle bug fixes. I cannot personally report issues to
&gt; Oracle so I&#39;m stuck.
&gt; 
&gt; Changing to stalled for now.
&gt; 
&gt; I still think it would be best not to skip this test but run it and
&gt; capture the problem outputting a warning if found then at least the
&gt; people with this issue will know to avoid it.
&gt; 
&gt; Martin
&gt; -- 
&gt; Martin J. Evans
&gt; Wetherby, UK
</div>
I am willing to attempt to report the bug to Oracle, but I am not sure how
exactly to go about that.  Let me know if that is something that should
be tried.  I think I can open this as something that is impacting the
business that I work for.  It just may be a challenge to get visibility to
this at the Oracle level.

Thanks

Wes
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;24&nbsp;16:54:26&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;25&nbsp;13:24:32&nbsp;2012</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Jun 24 16:54:25 2012, wes@smellycat.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sun, Jun 24, 2012 at 05:15:26AM -0400, Martin J Evans via RT wrote:
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=69350">https://rt.cpan.org/Ticket/Display.html?id=69350</a></span> &gt;
&gt; &gt; 
&gt; &gt; On Mon Mar 26 14:12:11 2012, MMUSGROVE wrote:
<div class="message-stanza open">&gt; &gt; &gt; 31lob.t fails for me with Perl 5.12.3 and Oracle 11.1.07. I&#39;m not sure
&gt; &gt; &gt; how long it&#39;s been failing &#40;presumably since 1.28 but I&#39;m not
</div></div></div>positive&#41;.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; 
&gt; &gt; &gt; I&#39;ve attached the output of prove -vb t/31lob.t with ora_verbose =&gt; 6
&gt; &gt; &gt; &#40;sanitizied to remove db username/password&#41;.
&gt; &gt; &gt; 
</div>&gt; &gt; 
&gt; &gt; I really don&#39;t know what to do with this RT. It is failing in
&gt; &gt; OCIDescriptorFree with an internal Oracle error and I cannot find that
&gt; &gt; error listed in Oracle bug fixes. I cannot personally report issues to
&gt; &gt; Oracle so I&#39;m stuck.
&gt; &gt; 
&gt; &gt; Changing to stalled for now.
&gt; &gt; 
&gt; &gt; I still think it would be best not to skip this test but run it and
&gt; &gt; capture the problem outputting a warning if found then at least the
&gt; &gt; people with this issue will know to avoid it.
&gt; &gt; 
&gt; &gt; Martin
&gt; &gt; -- 
&gt; &gt; Martin J. Evans
&gt; &gt; Wetherby, UK
</div>&gt; 
&gt; I am willing to attempt to report the bug to Oracle, but I am not sure how
&gt; exactly to go about that.  Let me know if that is something that should
&gt; be tried.  I think I can open this as something that is impacting the
&gt; business that I work for.  It just may be a challenge to get visibility to
&gt; this at the Oracle level.
&gt; 
&gt; Thanks
&gt; 
&gt; Wes
</div>
Thanks for coming back on this one Wes. To give some background, I&#39;m
trying very hard to clean up the RT queue. Had the issue you found been
one I could reproduce I might have had some chance but in any case it
ends on an Oracle internal error.

I cannot report this to Oracle as I don&#39;t personally have access to
Oracle support. What you do boils down to what matters to you as this is
only a test case and I would assume you do not hit the situation for
real. If you choose to report it I would imagine the script and the log
output &#40;you posted previously&#41; would be sufficient for Oracle &#40;along
with various versions etc&#41;.

As it appears you are the only one to hit this there seems little
greater good in getting it sorted. That leaves us with the dilemma of
what to do with the RT but that is our problem.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;25&nbsp;20:57:01&nbsp;2012</span>
    <span class="description">wes [...] smellycat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69350] Issue in 31lob.t for DBD::Oracle 1.28</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 25 Jun 2012 20:56:42 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Martin J Evans via RT &lt;bug-DBD-Oracle [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Wes Brown &lt;wes [...] smellycat.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, Jun 25, 2012 at 01:24:33PM -0400, Martin J Evans via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=69350">https://rt.cpan.org/Ticket/Display.html?id=69350</a></span> &gt;
&gt; 
&gt; On Sun Jun 24 16:54:25 2012, wes@smellycat.com wrote:
<div class="message-stanza open">&gt; &gt; On Sun, Jun 24, 2012 at 05:15:26AM -0400, Martin J Evans via RT wrote:
<div class="message-stanza open">&gt; &gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=69350">https://rt.cpan.org/Ticket/Display.html?id=69350</a></span> &gt;
&gt; &gt; &gt; 
&gt; &gt; &gt; On Mon Mar 26 14:12:11 2012, MMUSGROVE wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; 31lob.t fails for me with Perl 5.12.3 and Oracle 11.1.07. I&#39;m not sure
&gt; &gt; &gt; &gt; how long it&#39;s been failing &#40;presumably since 1.28 but I&#39;m not
</div></div></div>&gt; positive&#41;.
<div class="message-stanza open"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; I&#39;ve attached the output of prove -vb t/31lob.t with ora_verbose =&gt; 6
&gt; &gt; &gt; &gt; &#40;sanitizied to remove db username/password&#41;.
&gt; &gt; &gt; &gt; 
</div>&gt; &gt; &gt; 
&gt; &gt; &gt; I really don&#39;t know what to do with this RT. It is failing in
&gt; &gt; &gt; OCIDescriptorFree with an internal Oracle error and I cannot find that
&gt; &gt; &gt; error listed in Oracle bug fixes. I cannot personally report issues to
&gt; &gt; &gt; Oracle so I&#39;m stuck.
&gt; &gt; &gt; 
&gt; &gt; &gt; Changing to stalled for now.
&gt; &gt; &gt; 
&gt; &gt; &gt; I still think it would be best not to skip this test but run it and
&gt; &gt; &gt; capture the problem outputting a warning if found then at least the
&gt; &gt; &gt; people with this issue will know to avoid it.
&gt; &gt; &gt; 
&gt; &gt; &gt; Martin
&gt; &gt; &gt; -- 
&gt; &gt; &gt; Martin J. Evans
&gt; &gt; &gt; Wetherby, UK
</div>&gt; &gt; 
&gt; &gt; I am willing to attempt to report the bug to Oracle, but I am not sure how
&gt; &gt; exactly to go about that.  Let me know if that is something that should
&gt; &gt; be tried.  I think I can open this as something that is impacting the
&gt; &gt; business that I work for.  It just may be a challenge to get visibility to
&gt; &gt; this at the Oracle level.
&gt; &gt; 
&gt; &gt; Thanks
&gt; &gt; 
&gt; &gt; Wes
</div>&gt; 
&gt; Thanks for coming back on this one Wes. To give some background, I&#39;m
&gt; trying very hard to clean up the RT queue. Had the issue you found been
&gt; one I could reproduce I might have had some chance but in any case it
&gt; ends on an Oracle internal error.
&gt; 
&gt; I cannot report this to Oracle as I don&#39;t personally have access to
&gt; Oracle support. What you do boils down to what matters to you as this is
&gt; only a test case and I would assume you do not hit the situation for
&gt; real. If you choose to report it I would imagine the script and the log
&gt; output &#40;you posted previously&#41; would be sufficient for Oracle &#40;along
&gt; with various versions etc&#41;.
&gt; 
&gt; As it appears you are the only one to hit this there seems little
&gt; greater good in getting it sorted. That leaves us with the dilemma of
&gt; what to do with the RT but that is our problem.
&gt; 
&gt; Martin
&gt; -- 
&gt; Martin J. Evans
&gt; Wetherby, UK
</div>
I would like to do everything that I can to assist in helping you resolve
this test failure.  To be honest, the amount that I know about Oracle can
be captured in a small container.  I ran across this problem as part of
the tests run after the module build.

I do also seem to recall that someone was able to reproduce the problem,
but I know that you were not able to.  Might it have something to do with
permissions?  I asked our DBA to create the account I used to test with as
few permissions as possible.

As it has been some time since the first occurance of this, I would like
to try to rebuild things with the latest version of Oracle 11 as well as
the latest version of the DBD.  I do not believe that will occur this
month, but I can try to do that in July.

Might you be able to provide a code to English translation of the test
that was running and where you saw it blow up from the trace I was able to
provide?  I will also review this with my DBA to see if there is some
obscure permission that I need to have to do the operation that the system
is not happy about.

Thanks for your work on this DBD.  I can honestly say we use it every day
with our Oracle 10.x client connecting to databases as old as 8.1.7.

Wes
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;12&nbsp;13:31:33&nbsp;2012</span>
    <span class="description">mcdave [...] stanford.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mcdave [...] stanford.edu</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jun 25 13:24:32 2012, MJEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I cannot report this to Oracle as I don&#39;t personally have access to
&gt; Oracle support. What you do boils down to what matters to you as this is
&gt; only a test case and I would assume you do not hit the situation for
&gt; real. If you choose to report it I would imagine the script and the log
&gt; output &#40;you posted previously&#41; would be sufficient for Oracle &#40;along
&gt; with various versions etc&#41;.
&gt; 
&gt; As it appears you are the only one to hit this there seems little
&gt; greater good in getting it sorted. That leaves us with the dilemma of
&gt; what to do with the RT but that is our problem.
&gt; 
&gt; Martin
</div>
I came across this issue today while trying to set up a brand new
server.  It has Oracle Instantclient version 11.2, connecting back to an
Oracle 11.1.0.6.0 database.  I used DBD::Oracle version 1.36.  I edited
31lob.t to remove the &#34;skip&#34; statement and to add &#34;ora_verbose =&gt; 6&#34; as
recommended above.  I&#39;ve attached the results of &#34;prove -vb t/31lob.t&#34;
&#40;after editing out my ORACLE_USERID values&#41;.  

I can try filing a service ticket with Oracle and see what comes of that.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 31lob_tkt69350.txt</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;12&nbsp;13:42:20&nbsp;2012</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jul 12 13:31:33 2012, mcdave@stanford.edu wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Jun 25 13:24:32 2012, MJEVANS wrote:
<div class="message-stanza open">&gt; &gt; I cannot report this to Oracle as I don&#39;t personally have access to
&gt; &gt; Oracle support. What you do boils down to what matters to you as this is
&gt; &gt; only a test case and I would assume you do not hit the situation for
&gt; &gt; real. If you choose to report it I would imagine the script and the log
&gt; &gt; output &#40;you posted previously&#41; would be sufficient for Oracle &#40;along
&gt; &gt; with various versions etc&#41;.
&gt; &gt; 
&gt; &gt; As it appears you are the only one to hit this there seems little
&gt; &gt; greater good in getting it sorted. That leaves us with the dilemma of
&gt; &gt; what to do with the RT but that is our problem.
&gt; &gt; 
&gt; &gt; Martin
</div>&gt; 
&gt; I came across this issue today while trying to set up a brand new
&gt; server.  It has Oracle Instantclient version 11.2, connecting back to an
&gt; Oracle 11.1.0.6.0 database.  I used DBD::Oracle version 1.36.  I edited
&gt; 31lob.t to remove the &#34;skip&#34; statement and to add &#34;ora_verbose =&gt; 6&#34; as
&gt; recommended above.  I&#39;ve attached the results of &#34;prove -vb t/31lob.t&#34;
&gt; &#40;after editing out my ORACLE_USERID values&#41;.  
&gt; 
&gt; I can try filing a service ticket with Oracle and see what comes of that.
</div>
You log shows a similar result which is again an internal error. I&#39;m not
saying DBD::Oracle&#39;s use of OCI is flawless but whatever, I&#39;d not expect
an internal error. If you can file a ticket and you are happy to do so
I&#39;d be very interested in the outcome and I will help in whatever way I
can. You can use my CPAN email address mjevans@cpan.org and I can be
found on #dbi on irc.perl.org.

Thanks

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;17&nbsp;19:56:54&nbsp;2012</span>
    <span class="description">JDB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Just attaching a log from Win64 with OIC 11.2.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 31lob.log</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;13&nbsp;13:24:22&nbsp;2012</span>
    <span class="description">rmd+bcrd [...] sanger.ac.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rmd+bcrd [...] sanger.ac.uk</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jul 12 13:42:20 2012, MJEVANS wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; You log shows a similar result which is again an internal error. I&#39;m not
&gt; saying DBD::Oracle&#39;s use of OCI is flawless but whatever, I&#39;d not expect
&gt; an internal error. If you can file a ticket and you are happy to do so
&gt; I&#39;d be very interested in the outcome and I will help in whatever way I
&gt; can. You can use my CPAN email address mjevans@cpan.org and I can be
&gt; found on #dbi on irc.perl.org.
</div>
I just came across this bug while attempting to build DBD::Oracle
1.52, and may have found a solution.  The attached patch for t/31lob.t
fixes it for me.  I have tested it on various versions of perl, and
against both the full and instant 11.2 clients.

The trigger appears to be at line 127 in t/31lob.t, where reusing $sth
causes the LOB in $loc to be destroyed before it gets bound as input in
line 129.  This makes the test fail, and also seems to lead to a double
free later on when everything is being tidied up.  Using a new statement
handle for this query means $loc still contains a valid LOB, the test
works and the internal error goes away.

I have attached before and after log files for you to compare.

Rob.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;13&nbsp;13:39:33&nbsp;2012</span>
    <span class="description">rmd+bcrd [...] sanger.ac.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rmd+bcrd [...] sanger.ac.uk</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Nov 13 13:24:22 2012, rob1999 wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The attached patch for t/31lob.t ....
</div>
Grrr.  My attachments didn&#39;t.  I will try again, sorry.

Rob.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 31lob.t.patch.txt</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- DBD-Oracle-1.52/t/31lob.t	2012-10-19 16:41:17.000000000 +0100
+++ DBD-Oracle-1.52.patch/t/31lob.t	2012-11-12 13:35:56.000000000 +0000
@@ -124,10 +124,10 @@
         my $plsql_testcount = 4;
 
         $stmt = &#34;BEGIN ? := DBMS_LOB.GETLENGTH&#40; ? &#41;; END;&#34;;
-        $sth = $dbh-&gt;prepare&#40; $stmt, { ora_auto_lob =&gt; 0 } &#41;;
-        $sth-&gt;bind_param_inout&#40; 1, \$len, 16 &#41;;
-        $sth-&gt;bind_param&#40; 2, $loc, { ora_type =&gt; ORA_BLOB } &#41;;
-        $sth-&gt;execute;
+        my $sth2 = $dbh-&gt;prepare&#40; $stmt, { ora_auto_lob =&gt; 0 } &#41;;
+        $sth2-&gt;bind_param_inout&#40; 1, \$len, 16 &#41;;
+        $sth2-&gt;bind_param&#40; 2, $loc, { ora_type =&gt; ORA_BLOB } &#41;;
+        $sth2-&gt;execute;
 
         # ORA-00600: internal error code
         # ORA-00900: invalid SQL statement
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 31lob_patched.log</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 31lob_orig.log</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;15&nbsp;14:19:42&nbsp;2012</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Nov 13 13:24:22 2012, rob1999 wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Jul 12 13:42:20 2012, MJEVANS wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; You log shows a similar result which is again an internal error. I&#39;m not
&gt; &gt; saying DBD::Oracle&#39;s use of OCI is flawless but whatever, I&#39;d not expect
&gt; &gt; an internal error. If you can file a ticket and you are happy to do so
&gt; &gt; I&#39;d be very interested in the outcome and I will help in whatever way I
&gt; &gt; can. You can use my CPAN email address mjevans@cpan.org and I can be
&gt; &gt; found on #dbi on irc.perl.org.
</div>&gt; 
&gt; I just came across this bug while attempting to build DBD::Oracle
&gt; 1.52, and may have found a solution.  The attached patch for t/31lob.t
&gt; fixes it for me.  I have tested it on various versions of perl, and
&gt; against both the full and instant 11.2 clients.
&gt; 
&gt; The trigger appears to be at line 127 in t/31lob.t, where reusing $sth
&gt; causes the LOB in $loc to be destroyed before it gets bound as input in
&gt; line 129.  This makes the test fail, and also seems to lead to a double
&gt; free later on when everything is being tidied up.  Using a new statement
&gt; handle for this query means $loc still contains a valid LOB, the test
&gt; works and the internal error goes away.
&gt; 
&gt; I have attached before and after log files for you to compare.
&gt; 
&gt; Rob.
&gt; 
&gt; 
</div>Thanks Rob.

I&#39;ve never been able to reproduce this.

Your patch seems pretty straight forward but it would be nice to
understand what is happening. I&#39;ll take a look at it as soon as I can
and apply it once I understand what is going on.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;26&nbsp;14:13:54&nbsp;2012</span>
    <span class="description">champoux [...] pythian.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69350] Issue in 31lob.t for DBD::Oracle 1.28</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 26 Nov 2012 14:13:37 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-Oracle [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Yanick Champoux &lt;champoux [...] pythian.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 12-11-15 02:19 PM, Martin J Evans via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Your patch seems pretty straight forward but it would be nice to
&gt; understand what is happening. I&#39;ll take a look at it as soon as I can
&gt; and apply it once I understand what is going on.
</div>
     I&#39;ve committed an even simpler version of the patch to trunk. But 
yeah, it&#39;d still be nice to know why in this case the $lob is not 
surviving the deallocation of its parent $sth.

Cheers,
`/anick

-- 
Yanick Champoux, Senior Perl Developer
The Pythian Group - love your data
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.pythian.com">http://www.pythian.com</a></span>


-- 


--
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;27&nbsp;05:27:46&nbsp;2012</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Nov 26 14:13:54 2012, PYTHIAN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 12-11-15 02:19 PM, Martin J Evans via RT wrote:
<div class="message-stanza open">&gt; &gt; Your patch seems pretty straight forward but it would be nice to
&gt; &gt; understand what is happening. I&#39;ll take a look at it as soon as I can
&gt; &gt; and apply it once I understand what is going on.
</div>&gt; 
&gt;      I&#39;ve committed an even simpler version of the patch to trunk. But 
&gt; yeah, it&#39;d still be nice to know why in this case the $lob is not 
&gt; surviving the deallocation of its parent $sth.
&gt; 
&gt; Cheers,
&gt; `/anick
&gt; 
</div>
Yanick. Your change seemed to be:

Modified: dbd-oracle/trunk/t/31lob.t
==============================================================================
--- dbd-oracle/trunk/t/31lob.t  &#40;original&#41;
+++ dbd-oracle/trunk/t/31lob.t  Mon Nov 26 11:09:03 2012
@@ -123,8 +123,10 @@
     ## test calling PL/SQL with LOB placeholder
         my $plsql_testcount = 4;
 
-        $stmt = &#34;BEGIN ? := DBMS_LOB.GETLENGTH&#40; ? &#41;; END;&#34;;
-        $sth = $dbh-&gt;prepare&#40; $stmt, { ora_auto_lob =&gt; 0 } &#41;;
+        my $sth = $dbh-&gt;prepare&#40;
+            &#39;BEGIN ? := DBMS_LOB.GETLENGTH&#40; ? &#41;; END;&#39;,
+            { ora_auto_lob =&gt; 0 } 
+        &#41;;
         $sth-&gt;bind_param_inout&#40; 1, \$len, 16 &#41;;
         $sth-&gt;bind_param&#40; 2, $loc, { ora_type =&gt; ORA_BLOB } &#41;;
         $sth-&gt;execute;

I don&#39;t think this has the same result as Rob&#39;s patch.

Lines numbers after your patch:

The problem is that $loc is a lob locator associated with the statement
$sth created a line 94. By reassigning $sth to a new prepared statement
at line 126 the original $sth is thrown away and the $loc is no longer
valid. Rob&#39;s change got around that by ensuring the second statement was
a new scalar thus not destroying the original $sth with the lob locator.

Now that Rob has pointed this out it makes sense. I think his patch is a
proper fix.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;27&nbsp;10:52:46&nbsp;2012</span>
    <span class="description">champoux [...] pythian.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69350] Issue in 31lob.t for DBD::Oracle 1.28</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 27 Nov 2012 10:52:26 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-Oracle [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Yanick Champoux &lt;champoux [...] pythian.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 12-11-27 05:27 AM, Martin J Evans via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I don&#39;t think this has the same result as Rob&#39;s patch.
</div>
     I think it does. :-&#41;

     The patch doesn&#39;t reassign $sth, it creates a new lexical variable 
of the same name in the inner block that eclipses the original variable, 
but otherwise leaves it untouched.  Try it!

     my $foo = &#34;hello world&#34;;
     {
         my $foo = &#34;buh-bye&#34;;
     }
     print $foo;

-- 


--
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;27&nbsp;11:02:30&nbsp;2012</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Nov 27 10:52:46 2012, PYTHIAN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 12-11-27 05:27 AM, Martin J Evans via RT wrote:
<div class="message-stanza open">&gt; &gt; I don&#39;t think this has the same result as Rob&#39;s patch.
</div>&gt; 
&gt;      I think it does. :-&#41;
</div>
OOPs. Me having a bad day.

Sorry, I missed the &#34;my&#34;.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;27&nbsp;11:20:37&nbsp;2012</span>
    <span class="description">champoux [...] pythian.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69350] Issue in 31lob.t for DBD::Oracle 1.28</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 27 Nov 2012 11:20:24 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-Oracle [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Yanick Champoux &lt;champoux [...] pythian.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 12-11-27 11:02 AM, Martin J Evans via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt;&gt; &gt; &gt;I don&#39;t think this has the same result as Rob&#39;s patch.
</div><div class="message-stanza open">&gt;&gt; &gt;
&gt;&gt; &gt;      I think it does.:-&#41;
</div>&gt; OOPs. Me having a bad day.
&gt;
&gt; Sorry, I missed the &#34;my&#34;.
</div>
     Heh. No problem. It&#39;s still good to have a second pair of eyes, 
because God knows I also have my share of derping days. :-&#41;

Cheers,
`/anick

-- 


--
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;03&nbsp;16:49:22&nbsp;2013</span>
    <span class="description">champoux [...] pythian.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">deployed.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;03&nbsp;16:49:23&nbsp;2013</span>
    <span class="description">champoux [...] pythian.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
