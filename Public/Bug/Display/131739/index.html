<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #131739 for Mxpress-PDF: weird usage of parameterized class</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #131739 for Mxpress-PDF: weird usage of parameterized class</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Mxpress-PDF">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Mxpress-PDF">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Mxpress-PDF">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Mxpress-PDF">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Mxpress-PDF">Mxpress-PDF CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">131739</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Mxpress-PDF">Mxpress-PDF</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
perl [...] toby.ink

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Unimportant    </td>
  </tr>
  <tr id="CF-274720-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-274721-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




mxpress-pdf.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1884194/1011012/mxpress-pdf.patch">
Tue Feb 11 12:58:31 2020 (5.2k) by perl [...] toby.ink
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=131739">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1884194" href="/Public/Bug/Display.html?id=131739#txn-1884194">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;11&nbsp;12:58:31&nbsp;2020</span>
    <span class="description">perl [...] toby.ink -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> weird usage of parameterized class</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1884194/1011011/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1011011">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1024b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This seemed pretty cool so I had a look and noticed you were using a parameterized class a little strangely.

Like there shouldn&#39;t be any need to grab the spec and manually fiddle with it. I thought perhaps you were working around a limitation in MooX::Pression, so I tried reworking it to see if there was any way I could add a feature to make this kind of thing easier, but I can&#39;t find any such limitation.

Attached is a patch that moves the processing of @plugins into the parameterized class itself. I&#39;ve run the test suite and it appears to produce a visually similar PDF, but other than that I haven&#39;t verified it performs as expected because I&#39;m not 100% sure on what the $p method is SUPPOSED to do.

If I&#39;m misunderstanding what you were doing with the File class generator, please do clarify. I&#39;ve not used class generators much, so it would be interesting to explore more about how they could be used, and ensure MooX::Pression can cover these use cases without needing to hack the hashrefs being passed around.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> mxpress-pdf.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1884194/1011012/mxpress-pdf.patch">Download mxpress-pdf.patch</a><br />
<span class="downloadcontenttype">text/x-diff 5.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -urN Mxpress-PDF-0.02/lib/Mxpress/PDF.pm Mxpress-PDF-0.02-hacked/lib/Mxpress/PDF.pm
--- Mxpress-PDF-0.02/lib/Mxpress/PDF.pm	2020-02-11 15:27:59.000000000 +0000
+++ Mxpress-PDF-0.02-hacked/lib/Mxpress/PDF.pm	2020-02-11 17:53:13.707890888 +0000
@@ -5,19 +5,32 @@
 package Mxpress::PDF {
 	our $VERSION = &#39;0.02&#39;;
 	use MooX::Pression &#40;
-		version	=&gt; &#39;0.02&#39;,
+		version   =&gt; &#39;0.02&#39;,
 		authority =&gt; &#39;cpan:LNATION&#39;,
 	&#41;;
 	use Colouring::In;
 	use constant mm =&gt; 25.4 / 72;
 	use constant pt =&gt; 1;
-	class File &#40;&#41; {
+	class File &#40;HashRef $args&#41; {
+		my @plugins = &#40;qw/font boxed text title subtitle subsubtitle toc/, &#40;$args-&gt;{plugins} ? @{$args-&gt;{plugins}} : &#40;&#41;&#41;&#41;;
+		for my $p &#40;@plugins&#41; {
+			my $meth = sprintf&#40;&#39;_store_%s&#39;, $p&#41;;
+			has {$meth} &#40; type =&gt; Object &#41;;
+			method {$p} &#40;&#41; {
+				my $klass = $self-&gt;$meth;
+				if &#40;!$klass&#41; {
+					$klass = $class-&gt;FACTORY-&gt;$p&#40;$self, %{$args-&gt;{$p}}&#41;;
+					$self-&gt;$meth&#40;$klass&#41;;
+				}
+				return $klass;
+			}
+		}
 		has file_name &#40;type =&gt; Str, required =&gt; 1&#41;;
 		has pdf &#40;required =&gt; 1, type =&gt; Object&#41;;
 		has pages &#40;required =&gt; 1, type =&gt; ArrayRef&#41;;
 		has page &#40;type =&gt; Object&#41;;
 		has page_args &#40;type =&gt; HashRef&#41;;
-		has onsave_cbs &#40;type =&gt; ArrayRef&#41;;	
+		has onsave_cbs &#40;type =&gt; ArrayRef&#41;;
 		method add_page &#40;Map %args&#41; {
 			my $page = $self-&gt;FACTORY-&gt;page&#40;
 				$self-&gt;pdf,
@@ -29,7 +42,7 @@
 			push @{$self-&gt;pages}, $page;
 			$self-&gt;page&#40;$page&#41;;
 			$self-&gt;boxed-&gt;add&#40; fill_colour =&gt; $page-&gt;background &#41; if $page-&gt;background;
-			$self-&gt;page-&gt;set_position&#40;$page-&gt;parse_position&#40;[]&#41;&#41;;	
+			$self-&gt;page-&gt;set_position&#40;$page-&gt;parse_position&#40;[]&#41;&#41;;
 			$self;
 		}
 		method save {
@@ -60,7 +73,7 @@
 		has w &#40;type =&gt; Num&#41;;
 		has h &#40;type =&gt; Num&#41;;
 		factory page &#40;Object $pdf, Map %args&#41; {
-	 		my $page = $args{open} ? $pdf-&gt;openpage&#40;$args{num}&#41; : $pdf-&gt;page&#40;$args{num}&#41;;
+			my $page = $args{open} ? $pdf-&gt;openpage&#40;$args{num}&#41; : $pdf-&gt;page&#40;$args{num}&#41;;
 			$page-&gt;mediabox&#40;$args{page_size}&#41;;
 			my &#40;$blx, $bly, $trx, $try&#41; = $page-&gt;get_mediabox;
 			my $new_page = $class-&gt;new&#40;
@@ -252,7 +265,7 @@
 					while &#40;@paragraph and &#40;$line_width + &#40;scalar&#40;@line&#41; * $space_width&#41; + $width{$paragraph[0]}&#41; &lt; $lw&#41; {
 						$line_width += $width{$paragraph[0]};
 						push @line, shift&#40;@paragraph&#41;;
-					}	
+					}
 					my &#40;$wordspace, $align&#41;;
 					if &#40;$self-&gt;align eq &#39;fulljustify&#39; or $self-&gt;align eq &#39;justify&#39; and @paragraph&#41; {
 						if &#40;scalar&#40;@line&#41; == 1&#41; {
@@ -286,7 +299,7 @@
 						my $pad_end = $self-&gt;pad_end;
 						my $pad = sprintf &#40;&#34;%s%s&#34;,
 							$self-&gt;pad x int&#40;&#40;&#40;
-								&#40;&#40;&#40;&#40;$lw + $wordspace&#41; - $line_width&#41; - $text-&gt;advancewidth&#40;$self-&gt;pad . $pad_end&#41;&#41; - &#40;$self-&gt;padding/mm&#41;&#41; 
+								&#40;&#40;&#40;&#40;$lw + $wordspace&#41; - $line_width&#41; - $text-&gt;advancewidth&#40;$self-&gt;pad . $pad_end&#41;&#41; - &#40;$self-&gt;padding/mm&#41;&#41;
 							&#41; / $text-&gt;advancewidth&#40;$self-&gt;pad&#41;&#41;&#41;,
 							$pad_end
 						&#41;;
@@ -305,7 +318,7 @@
 				return $self-&gt;file;
 			}
 			method _set_indent &#40;Num $xpos, Num $w, Num $fl, Num $fp&#41; {
-	 			if &#40;$fl &#38;&#38; $self-&gt;first_line_indent&#41; {
+				if &#40;$fl &#38;&#38; $self-&gt;first_line_indent&#41; {
 					$xpos += $self-&gt;first_line_indent/mm;
 					$w -= $self-&gt;first_line_indent/mm;
 				} elsif &#40;$fp &#38;&#38; $self-&gt;first_paragraph_indent&#41; {
@@ -376,7 +389,7 @@
 					y =&gt; $y,
 					children =&gt; [],
 					level =&gt; $args{level} || 0,
-					title =&gt; $args{title}, 
+					title =&gt; $args{title},
 					file =&gt; $file,
 					page =&gt; $file-&gt;page,
 					outline =&gt; $new,
@@ -439,7 +452,7 @@
 				$self-&gt;file-&gt;subtitle-&gt;add&#40;$args{title} ? @{$args{title}} : &#39;Table of contents&#39;&#41;;
 				$self-&gt;toc_placeholder&#40;{
 					page =&gt; $self-&gt;file-&gt;page,
-	       				position =&gt; [$self-&gt;parse_position&#40;$args{position} || []&#41;]
+					position =&gt; [$self-&gt;parse_position&#40;$args{position} || []&#41;]
 				}&#41;;
 				$self-&gt;file-&gt;onsave&#40;&#39;toc&#39;, &#39;render&#39;, %args&#41;;
 				$self-&gt;file-&gt;add_page;
@@ -483,7 +496,7 @@
 				my $total_height = &#40;$self-&gt;count * $one_toc_link&#41; - $h;
 				while &#40;$total_height &gt; 0&#41; {
 					$args{page_offset}++;
-					$self-&gt;file-&gt;add_page&#40;num =&gt; $placeholder-&gt;{page}-&gt;num + $args{page_offset}&#41;;	
+					$self-&gt;file-&gt;add_page&#40;num =&gt; $placeholder-&gt;{page}-&gt;num + $args{page_offset}&#41;;
 					$total_height -= $self-&gt;file-&gt;page-&gt;h;
 				}
 				$self-&gt;file-&gt;page&#40;$placeholder-&gt;{page}&#41;;
@@ -494,36 +507,9 @@
 		}
 	}
 	class Factory {
-		use PDF::API2;
 		factory new_pdf &#40;Str $name, Map %args&#41; {
-			my @plugins = &#40;qw/font boxed text title subtitle subsubtitle toc/, &#40;$args{plugins} ? @{$args{plugins}} : &#40;&#41;&#41;&#41;;
-			my $spec = Mxpress::PDF::File-&gt;_generate_package_spec&#40;&#41;;
-			for my $p &#40;@plugins&#41; {
-				my $meth = sprintf&#40;&#39;_store_%s&#39;, $p&#41;;
-      				$spec-&gt;{has}-&gt;{$meth} = { type =&gt; Object };
-				$spec-&gt;{can}-&gt;{$p} = {
-					code =&gt; sub {
-						my $class = $_[0]-&gt;$meth;
-						if &#40;!$class&#41; {
-							$class = $factory-&gt;$p&#40;$_[0], %{$args{$p}}&#41;;
-							$_[0]-&gt;$meth&#40;$class&#41;
-						}
-						return $class;
-					}
-				};
-			}
-			return MooX::Press-&gt;generate_package&#40;
-				&#39;class&#39;,
-				&#34;Mxpress::PDF::File&#34;,
-				{
-					factory_package =&gt; $factory,
-					caller =&gt; $class,
-					prefix =&gt; $factory,
-					toolkit =&gt; &#39;Moo&#39;,
-					type_library =&gt; &#39;Mxpress::PDF::Types&#39;,
-				},
-				$spec
-			&#41;-&gt;new&#40;
+			require PDF::API2;
+			$factory-&gt;generate_file&#40; \%args &#41;-&gt;new&#40;
 				file_name =&gt; $name,
 				pages =&gt; [],
 				num =&gt; 0,
Binary files Mxpress-PDF-0.02/test.pdf and Mxpress-PDF-0.02-hacked/test.pdf differ
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1884307" href="/Public/Bug/Display.html?id=131739#txn-1884307">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;11&nbsp;19:36:31&nbsp;2020</span>
    <span class="description">thisusedtobeanemail [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #131739] weird usage of parameterized class</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 12 Feb 2020 07:36:12 +0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mxpress-PDF [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;LNATION .&#34; &lt;thisusedtobeanemail [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1884307/1011076/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1011076">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks! Will take a look in my evening but this looks to be my failure -

has {$meth} &#40; type =&gt; Object &#41;;



On Wed, Feb 12, 2020 at 12:58 AM Toby Inkster via RT &lt;
bug-Mxpress-PDF@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Tue Feb 11 12:58:31 2020: Request 131739 was acted upon.
&gt; Transaction: Ticket created by TOBYINK
&gt;        Queue: Mxpress-PDF
&gt;      Subject: weird usage of parameterized class
&gt;    Broken in: &#40;no value&#41;
&gt;     Severity: Unimportant
&gt;        Owner: Nobody
&gt;   Requestors: perl@toby.ink
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=131739">https://rt.cpan.org/Ticket/Display.html?id=131739</a></span> &gt;
&gt;
&gt;
&gt; This seemed pretty cool so I had a look and noticed you were using a
&gt; parameterized class a little strangely.
&gt;
&gt; Like there shouldn&#39;t be any need to grab the spec and manually fiddle with
&gt; it. I thought perhaps you were working around a limitation in
&gt; MooX::Pression, so I tried reworking it to see if there was any way I could
&gt; add a feature to make this kind of thing easier, but I can&#39;t find any such
&gt; limitation.
&gt;
&gt; Attached is a patch that moves the processing of @plugins into the
&gt; parameterized class itself. I&#39;ve run the test suite and it appears to
&gt; produce a visually similar PDF, but other than that I haven&#39;t verified it
&gt; performs as expected because I&#39;m not 100% sure on what the $p method is
&gt; SUPPOSED to do.
&gt;
&gt; If I&#39;m misunderstanding what you were doing with the File class generator,
&gt; please do clarify. I&#39;ve not used class generators much, so it would be
&gt; interesting to explore more about how they could be used, and ensure
&gt; MooX::Pression can cover these use cases without needing to hack the
&gt; hashrefs being passed around.
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1884307/1011077/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1011077">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.1k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1884308" href="/Public/Bug/Display.html?id=131739#txn-1884308">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;11&nbsp;19:36:32&nbsp;2020</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1884386" href="/Public/Bug/Display.html?id=131739#txn-1884386">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;12&nbsp;06:17:40&nbsp;2020</span>
    <span class="description">perl [...] toby.ink -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1884386/1011124/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1011124">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 756b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Allowing something like:

   has $xyz &#40; type =&gt; Object &#41;;

Would seem to make sense, but in the past, I treated `has $xyz` as a shortcut for something like:

   # Declares an attribute called &#34;xyz&#34; which is not allowed
   # to be a hashref or arrayref.
   #
   has xyz &#40; type =&gt; ~&#40;ArrayRef|HashRef&#41; &#41;;

I dropped support for that in an early release though. Ultimately if I do ever support `has $xyz` as a syntax again, it&#39;ll probably mean that each method in the class gets an implicit:

   \&#40;my $xyz&#41; = \&#40; $self-&gt;{xyz} &#41;;

So that within methods, you can just use the $xyz variable instead of having to call $self-&gt;xyz. But it&#39;s hard to make that work nicely with type constraints, coercions, triggers, etc, unless you use ties which will be very slow.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1884426" href="/Public/Bug/Display.html?id=131739#txn-1884426">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;12&nbsp;12:43:36&nbsp;2020</span>
    <span class="description">thisusedtobeanemail [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #131739] weird usage of parameterized class</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 13 Feb 2020 00:43:16 +0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mxpress-PDF [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;LNATION .&#34; &lt;thisusedtobeanemail [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1884426/1011145/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1011145">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I missed your release with PACKAGE_SPEC but I&#39;m okay with this way just
missed this {} syntax.

One thing with MooX::Pression the errors/warnings seem to have downgraded
since your re-write, line numbers seem to be redundant .

On Wed, Feb 12, 2020 at 6:17 PM Toby Inkster via RT &lt;
bug-Mxpress-PDF@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Mxpress-PDF
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=131739">https://rt.cpan.org/Ticket/Display.html?id=131739</a></span> &gt;
&gt;
&gt; Allowing something like:
&gt;
&gt;    has $xyz &#40; type =&gt; Object &#41;;
&gt;
&gt; Would seem to make sense, but in the past, I treated `has $xyz` as a
&gt; shortcut for something like:
&gt;
&gt;    # Declares an attribute called &#34;xyz&#34; which is not allowed
&gt;    # to be a hashref or arrayref.
&gt;    #
&gt;    has xyz &#40; type =&gt; ~&#40;ArrayRef|HashRef&#41; &#41;;
&gt;
&gt; I dropped support for that in an early release though. Ultimately if I do
&gt; ever support `has $xyz` as a syntax again, it&#39;ll probably mean that each
&gt; method in the class gets an implicit:
&gt;
&gt;    \&#40;my $xyz&#41; = \&#40; $self-&gt;{xyz} &#41;;
&gt;
&gt; So that within methods, you can just use the $xyz variable instead of
&gt; having to call $self-&gt;xyz. But it&#39;s hard to make that work nicely with type
&gt; constraints, coercions, triggers, etc, unless you use ties which will be
&gt; very slow.
&gt;
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1884426/1011146/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1011146">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.7k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1884451" href="/Public/Bug/Display.html?id=131739#txn-1884451">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;12&nbsp;13:22:09&nbsp;2020</span>
    <span class="description">perl [...] toby.ink -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1884451/1011158/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1011158">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 694b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Honestly, I haven&#39;t paid much attention to line numbers in error messages at all yet. It is certainly something it would be nice to get right.

The way Keyword::Simple works, you grab a bunch of code after the keyword, parse it to find out what you need to find out, remove it from Perl&#39;s compilation buffer, and inject your own code into the compilation buffer. I think it ought to be possible to check how many lines are in the code being removed, how many lines are in the code being inserted, and if they mismatch, insert some extra blank lines first. I might have a go at that soon. That won&#39;t be perfect; won&#39;t cover code which isn&#39;t physically in the file being parsed. But it&#39;s a start.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1884461" href="/Public/Bug/Display.html?id=131739#txn-1884461">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;12&nbsp;14:10:41&nbsp;2020</span>
    <span class="description">perl [...] toby.ink -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1884461/1011165/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1011165">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 141b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve pushed an improvement in line number reports to GitHub. Some might still be off by one or two, but it&#39;s overall a lot closer to correct.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1884554" href="/Public/Bug/Display.html?id=131739#txn-1884554">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;12&nbsp;20:38:57&nbsp;2020</span>
    <span class="description">thisusedtobeanemail [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #131739] weird usage of parameterized class</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 13 Feb 2020 08:38:38 +0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mxpress-PDF [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;LNATION .&#34; &lt;thisusedtobeanemail [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1884554/1011203/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1011203">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 355b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Awesome, thanks!

On Thu, Feb 13, 2020 at 2:10 AM Toby Inkster via RT &lt;
bug-Mxpress-PDF@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Mxpress-PDF
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=131739">https://rt.cpan.org/Ticket/Display.html?id=131739</a></span> &gt;
&gt;
&gt; I&#39;ve pushed an improvement in line number reports to GitHub. Some might
&gt; still be off by one or two, but it&#39;s overall a lot closer to correct.
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1884554/1011204/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1011204">with headers</a>
<br />
<span class="downloadcontenttype">text/html 767b</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1884913" href="/Public/Bug/Display.html?id=131739#txn-1884913">#</a>      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;14&nbsp;18:18:45&nbsp;2020</span>
    <span class="description">perl [...] toby.ink -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1884913/1011350/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1011350">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 99b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">FYI, I&#39;ve renamed MooX::Pression to Zydeco because I wanted something fun and memorable like Moops.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1885790" href="/Public/Bug/Display.html?id=131739#txn-1885790">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;18&nbsp;09:30:05&nbsp;2020</span>
    <span class="description">perl [...] toby.ink -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.581213</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
