<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #118823 for DBD-mysql: libdbd-mysql-perl: FTBFS on some architectures</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #118823 for DBD-mysql: libdbd-mysql-perl: FTBFS on some architectures</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBD-mysql">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBD-mysql">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBD-mysql">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBD-mysql">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-mysql">DBD-mysql CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">118823</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBD-mysql">DBD-mysql</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">MICHIELB [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
gregoa [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
pali [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10170-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10171-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




0001-Fix-integer-types-when-server-side-prepare-statement.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1684314/904272/0001-Fix-integer-types-when-server-side-prepare-statement.patch">
Fri Nov 18 11:21:27 2016 (7.8k) by pali [...] cpan.org
</a>
</font></li>
</ul>


0001-Use-MYSQL_TYPE_LONGLONG-64-bit-by-default.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1684193/904189/0001-Use-MYSQL_TYPE_LONGLONG-64-bit-by-default.patch">
Fri Nov 18 04:26:38 2016 (2.9k) by ntyni [...] debian.org
</a>
</font></li>
</ul>


signature.asc<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1684491/904385/signature.asc">
Sat Nov 19 16:01:34 2016 (963b) by gregoa [...] debian.org
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/1684102/904138/signature.asc">
Thu Nov 17 19:46:17 2016 (963b) by gregoa [...] debian.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=118823">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1684063" href="/Public/Bug/Display.html?id=118823#txn-1684063">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;17&nbsp;15:22:34&nbsp;2016</span>
    <span class="description">gregoa [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> gregoa [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> libdbd-mysql-perl: FTBFS on some architectures</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1684063/904113/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/904113">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 905b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">We have the following bug reported to the Debian package of DBD-mysql
&#40;<span class="clickylink"><a target="new" rel="nofollow" href="https://bugs.debian.org/844538&#41;">https://bugs.debian.org/844538&#41;</a></span>:

It doesn&#39;t seem to be a bug in the packaging, so you may want to take
a look. Thanks!

------8&lt;-----------8&lt;-----------8&lt;-----------8&lt;-----------8&lt;-----

Source: libdbd-mysql-perl
Version: 4.039-1
Severity: serious
Justification: FTBFS on some release architectures

Hi

libdbd-mysql-perl FTBFS on some architectures, namely mips and s390x
for the release architectures:

<span class="clickylink"><a target="new" rel="nofollow" href="https://buildd.debian.org/status/package.php?p=libdbd-mysql-perl">https://buildd.debian.org/status/package.php?p=libdbd-mysql-perl</a></span>

<span class="clickylink"><a target="new" rel="nofollow" href="https://buildd.debian.org/status/fetch.php?pkg=libdbd-mysql-perl&#38;arch=mips&#38;ver=4.039-1&#38;stamp=1479285659">https://buildd.debian.org/status/fetch.php?pkg=libdbd-mysql-perl&#38;arch=mips&#38;ver=4.039-1&#38;stamp=1479285659</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="https://buildd.debian.org/status/fetch.php?pkg=libdbd-mysql-perl&#38;arch=s390x&#38;ver=4.039-1&#38;stamp=1479285790">https://buildd.debian.org/status/fetch.php?pkg=libdbd-mysql-perl&#38;arch=s390x&#38;ver=4.039-1&#38;stamp=1479285790</a></span>

Regards,
Salvatore


------8&lt;-----------8&lt;-----------8&lt;-----------8&lt;-----------8&lt;-----


Thanks for considering,
  gregor herrmann,
  Debian Perl Group
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1684073" href="/Public/Bug/Display.html?id=118823#txn-1684073">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;17&nbsp;15:59:09&nbsp;2016</span>
    <span class="description">MICHIELB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1684073/904122/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/904122">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 918b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi there,

On Thu 17 Nov 2016 15:22:34, GREGOA wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; We have the following bug reported to the Debian package of DBD-mysql
&gt; &#40;<span class="clickylink"><a target="new" rel="nofollow" href="https://bugs.debian.org/844538&#41;">https://bugs.debian.org/844538&#41;</a></span>:
&gt; 
&gt; Source: libdbd-mysql-perl
&gt; Version: 4.039-1
&gt; Severity: serious
&gt; Justification: FTBFS on some release architectures
</div>
Sorry for the breakage!

Is there any *easy* way for me to spin up a MIPS instance on an x86 system? I tried once before and it was not a pleasant experience, mucking around with QEMU. I guess as Debian package maintainers, you&#39;d have some way to easily emulate these environments, right? It would make things much easier for us to test any patches and not cause breakage the next time around.

I even tried looking for buying a MIPS development board but while ARM boards are REALLY cheap, there aren&#39;t a lot of MIPS boards and I could not find one that ships to The Netherlands for &lt; $200.

Any advise would be welcome!
--
Michiel
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1684074" href="/Public/Bug/Display.html?id=118823#txn-1684074">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;17&nbsp;15:59:10&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1684102" href="/Public/Bug/Display.html?id=118823#txn-1684102">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;17&nbsp;19:46:17&nbsp;2016</span>
    <span class="description">gregoa [...] debian.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> debian-perl [...] lists.debian.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #118823] libdbd-mysql-perl: FTBFS on some architectures</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 18 Nov 2016 01:45:59 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Michiel Beijen via RT &lt;bug-DBD-mysql [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> gregor herrmann &lt;gregoa [...] debian.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1684102/904137/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/904137">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, 17 Nov 2016 15:59:15 -0500, Michiel Beijen via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=118823">https://rt.cpan.org/Ticket/Display.html?id=118823</a></span> &gt;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu 17 Nov 2016 15:22:34, GREGOA wrote:
<div class="message-stanza open">&gt; &gt; We have the following bug reported to the Debian package of DBD-mysql
&gt; &gt; &#40;<span class="clickylink"><a target="new" rel="nofollow" href="https://bugs.debian.org/844538&#41;">https://bugs.debian.org/844538&#41;</a></span>:
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Is there any *easy* way for me to spin up a MIPS instance on an x86
&gt; system? I tried once before and it was not a pleasant experience,
&gt; mucking around with QEMU. I guess as Debian package maintainers,
&gt; you&#39;d have some way to easily emulate these environments, right? It
&gt; would make things much easier for us to test any patches and not
&gt; cause breakage the next time around.
</div>
I&#39;m afraid I also only know about qemu for emulating mips systems on
x86. But we have access to porter boxes of all architectures, so I
could try a build with a patch.

But as <span class="clickylink"><a target="new" rel="nofollow" href="https://buildd.debian.org/status/package.php?p=libdbd-mysql-perl">https://buildd.debian.org/status/package.php?p=libdbd-mysql-perl</a></span>
shows this is not only about mips but about various architectures,
and the quick summary on IRC was &#34;looks like a big-endian issue&#34;.
Maybe this makes it easier?

There was also an offer of a Debian Perl member to try and check on a
powerpc machine of his &#40;where it also fails&#41;; cc&#39;ing our list for
further cooperation.
 
Thanks for attending to this issue so quickly!


Cheers,
gregor

-- 
 .&#39;&#39;`.  <span class="clickylink"><a target="new" rel="nofollow" href="https://info.comodo.priv.at/">https://info.comodo.priv.at/</a></span> - Debian Developer <span class="clickylink"><a target="new" rel="nofollow" href="https://www.debian.org">https://www.debian.org</a></span>
 : :&#39; : OpenPGP fingerprint D1E1 316E 93A7 60A8 104D  85FA BB3A 6801 8649 AA06
 `. `&#39;  Member of VIBE!AT &#38; SPI, fellow of the Free Software Foundation Europe
   `-   NP: Joan Baez: A hard rain&#39;s a-gonna fall
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1684102/904138/signature.asc">Download signature.asc</a><br />
<span class="downloadcontenttype">application/pgp-signature 963b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1684144" href="/Public/Bug/Display.html?id=118823#txn-1684144">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;18&nbsp;02:31:49&nbsp;2016</span>
    <span class="description">michiel.beijen [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #118823] libdbd-mysql-perl: FTBFS on some architectures</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 18 Nov 2016 08:31:20 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Michiel Beijen via RT &lt;bug-DBD-mysql [...] rt.cpan.org&gt;, debian-perl [...] lists.debian.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michiel Beijen &lt;michiel.beijen [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1684144/904166/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/904166">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 858b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

On Fri, Nov 18, 2016 at 1:45 AM, gregor herrmann &lt;gregoa@debian.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m afraid I also only know about qemu for emulating mips systems on
&gt; x86. But we have access to porter boxes of all architectures, so I
&gt; could try a build with a patch.
&gt;
&gt; But as <span class="clickylink"><a target="new" rel="nofollow" href="https://buildd.debian.org/status/package.php?p=libdbd-mysql-perl">https://buildd.debian.org/status/package.php?p=libdbd-mysql-perl</a></span>
&gt; shows this is not only about mips but about various architectures,
&gt; and the quick summary on IRC was &#34;looks like a big-endian issue&#34;.
&gt; Maybe this makes it easier?
</div>
Yeah, I know it&#39;s an endianness issue. But I also know emulating s390
is not a thing, and there is someone building a Power-based
raspberry-pi-like board but that has not launched and they ask lots of
money for it. So far it seems emulating MIPS on my Intel-based laptop
is the easiest way. I hope some of your packaging colleagues have some
tips!
--
Michiel
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1684148" href="/Public/Bug/Display.html?id=118823#txn-1684148">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;18&nbsp;02:54:41&nbsp;2016</span>
    <span class="description">dod [...] debian.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Michiel Beijen &lt;michiel.beijen [...] gmail.com&gt;, Michiel Beijen via RT &lt;bug-DBD-mysql [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #118823] libdbd-mysql-perl: FTBFS on some architectures</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 18 Nov 2016 08:54:19 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> debian-perl [...] lists.debian.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dominique Dumont &lt;dod [...] debian.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1684148/904169/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/904169">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 660b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Friday, 18 November 2016 08:31:20 CET Michiel Beijen wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So far it seems emulating MIPS on my Intel-based laptop
&gt; is the easiest way. I hope some of your packaging colleagues have some
&gt; tips!
</div>
You can create a mips chroot &#40;which uses qemu under the hood&#41; with 
debootstrap.

You can follow the installation instructions given there, using mips instead 
of arm64:

<span class="clickylink"><a target="new" rel="nofollow" href="https://wiki.debian.org/Arm64Qemu">https://wiki.debian.org/Arm64Qemu</a></span>

This setup was used to work on porting moarvm on mips.

Please get back to us if you face problems.

All the best

-- 
 <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/dod38fr/">https://github.com/dod38fr/</a></span>   -o- <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~ddumont/">http://search.cpan.org/~ddumont/</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://ddumont.wordpress.com/">http://ddumont.wordpress.com/</a></span>  -o-   irc: dod at irc.debian.org
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1684193" href="/Public/Bug/Display.html?id=118823#txn-1684193">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;18&nbsp;04:26:38&nbsp;2016</span>
    <span class="description">ntyni [...] debian.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #118823] libdbd-mysql-perl: FTBFS on some architectures</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 18 Nov 2016 11:26:19 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Michiel Beijen via RT &lt;bug-DBD-mysql [...] rt.cpan.org&gt;, debian-perl [...] lists.debian.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Niko Tyni &lt;ntyni [...] debian.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1684193/904188/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/904188">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Nov 18, 2016 at 01:45:59AM +0100, gregor herrmann wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; But as <span class="clickylink"><a target="new" rel="nofollow" href="https://buildd.debian.org/status/package.php?p=libdbd-mysql-perl">https://buildd.debian.org/status/package.php?p=libdbd-mysql-perl</a></span>
&gt; shows this is not only about mips but about various architectures,
&gt; and the quick summary on IRC was &#34;looks like a big-endian issue&#34;.
</div>
FWIW it goes away if I revert 97c8c22998e67e7c6cfe5635578e0464e9ac9513 
&#40;&#34;Add support for 64bit types when perl is compiled with 64bit support&#34;&#41;.

We&#39;re configuring Perl with -Duse64bitint on both 32-bit and 64-bit
platforms.

I think the 64-bit integer support is not quite working yet; even on
little-endian &#40;regular x86_64&#41;, if I test for them:

--- a/t/40server_prepare.t
+++ b/t/40server_prepare.t
@@ -59,11 +59,11 @@ ok&#40;$sth2 = $dbh-&gt;prepare&#40;&#39;INSERT INTO dbd_mysql_t40serverprepare2 VALUES &#40;?,?,?,
 ok&#40;$sth2-&gt;bind_param&#40;1, 101, DBI::SQL_INTEGER&#41;, &#34;binding int&#34;&#41;;
 ok&#40;$sth2-&gt;bind_param&#40;2, 102, DBI::SQL_SMALLINT&#41;, &#34;binding smallint&#34;&#41;;
 ok&#40;$sth2-&gt;bind_param&#40;3, 103, DBI::SQL_TINYINT&#41;, &#34;binding tinyint&#34;&#41;;
-ok&#40;$sth2-&gt;bind_param&#40;4, 104, DBI::SQL_INTEGER&#41;, &#34;binding bigint&#34;&#41;;
+ok&#40;$sth2-&gt;bind_param&#40;4, &#40;2&lt;&lt;32&#41;+4, DBI::SQL_INTEGER&#41;, &#34;binding bigint&#34;&#41;;
 
 ok&#40;$sth2-&gt;execute&#40;&#41;, &#34;inserting data&#34;&#41;;
 
-is_deeply&#40;$dbh-&gt;selectall_arrayref&#40;&#39;SELECT * FROM dbd_mysql_t40serverprepare2&#39;&#41;, [[101, 102, 103, 104]]&#41;;
+is_deeply&#40;$dbh-&gt;selectall_arrayref&#40;&#39;SELECT * FROM dbd_mysql_t40serverprepare2&#39;&#41;, [[101, 102, 103, &#40;2&lt;&lt;32&#41;+4]]&#41;;
 
 ok &#40;$dbh-&gt;do&#40;qq{DROP TABLE dbd_mysql_t40serverprepare2}&#41;, &#34;cleaning up&#34;&#41;;
 
I get

not ok 20
#   Failed test at t/40server_prepare.t line 66.
#     Structures begin differing at:
#          $got-&gt;[0][3] = &#39;4&#39;
#     $expected-&gt;[0][3] = &#39;8589934596&#39;

It looks like it&#39;s coercing 64-bit integers into 32-bit ones, which mostly
works for small integers on little endian, but zeros out the result on
big endian.

I gather MYSQL_TYPE_LONG is an int &#40;32-bit&#41; despite the name and it
seems to be the default everywhere in dbdimp.c. Blindly sprinkling
MYSQL_TYPE_LONGLONG in the code fixes it; see the attached patch. I&#39;ve
tested it on amd64 &#40;64-bit LE&#41;, s390x &#40;64-bit BE&#41;, armhf &#40;32-bit LE&#41;
and powerpc &#40;32-bit BE&#41;.

But maybe MYSQL_TYPE_LONGLONG should be limited to just SQL_BIGINTs?
Hope this helps a bit anyway.
-- 
Niko Tyni   ntyni@debian.org
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1684193/904189/0001-Use-MYSQL_TYPE_LONGLONG-64-bit-by-default.patch">Download 0001-Use-MYSQL_TYPE_LONGLONG-64-bit-by-default.patch</a><br />
<span class="downloadcontenttype">text/x-diff 2.9k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1684250" href="/Public/Bug/Display.html?id=118823#txn-1684250">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;18&nbsp;08:06:42&nbsp;2016</span>
    <span class="description">pali [...] cpan.org -  Cc PALI added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1684252" href="/Public/Bug/Display.html?id=118823#txn-1684252">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;18&nbsp;08:16:39&nbsp;2016</span>
    <span class="description">pali [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1684252/904229/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/904229">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Pia Nov 18 04:26:38 2016, ntyni@debian.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri, Nov 18, 2016 at 01:45:59AM +0100, gregor herrmann wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; But as <span class="clickylink"><a target="new" rel="nofollow" href="https://buildd.debian.org/status/package.php?p=libdbd-mysql-">https://buildd.debian.org/status/package.php?p=libdbd-mysql-</a></span>
&gt; &gt; perl
&gt; &gt; shows this is not only about mips but about various architectures,
&gt; &gt; and the quick summary on IRC was &#34;looks like a big-endian issue&#34;.
</div>&gt; 
&gt; FWIW it goes away if I revert 97c8c22998e67e7c6cfe5635578e0464e9ac9513
&gt; &#40;&#34;Add support for 64bit types when perl is compiled with 64bit
&gt; support&#34;&#41;.
&gt; 
&gt; We&#39;re configuring Perl with -Duse64bitint on both 32-bit and 64-bit
&gt; platforms.
&gt; 
&gt; I think the 64-bit integer support is not quite working yet; even on
&gt; little-endian &#40;regular x86_64&#41;, if I test for them:
&gt; 
&gt; --- a/t/40server_prepare.t
&gt; +++ b/t/40server_prepare.t
&gt; @@ -59,11 +59,11 @@ ok&#40;$sth2 = $dbh-&gt;prepare&#40;&#39;INSERT INTO
&gt; dbd_mysql_t40serverprepare2 VALUES &#40;?,?,?,
&gt;  ok&#40;$sth2-&gt;bind_param&#40;1, 101, DBI::SQL_INTEGER&#41;, &#34;binding int&#34;&#41;;
&gt;  ok&#40;$sth2-&gt;bind_param&#40;2, 102, DBI::SQL_SMALLINT&#41;, &#34;binding smallint&#34;&#41;;
&gt;  ok&#40;$sth2-&gt;bind_param&#40;3, 103, DBI::SQL_TINYINT&#41;, &#34;binding tinyint&#34;&#41;;
&gt; -ok&#40;$sth2-&gt;bind_param&#40;4, 104, DBI::SQL_INTEGER&#41;, &#34;binding bigint&#34;&#41;;
&gt; +ok&#40;$sth2-&gt;bind_param&#40;4, &#40;2&lt;&lt;32&#41;+4, DBI::SQL_INTEGER&#41;, &#34;binding
&gt; bigint&#34;&#41;;
&gt; 
&gt; ok&#40;$sth2-&gt;execute&#40;&#41;, &#34;inserting data&#34;&#41;;
&gt; 
&gt; -is_deeply&#40;$dbh-&gt;selectall_arrayref&#40;&#39;SELECT * FROM
&gt; dbd_mysql_t40serverprepare2&#39;&#41;, [[101, 102, 103, 104]]&#41;;
&gt; +is_deeply&#40;$dbh-&gt;selectall_arrayref&#40;&#39;SELECT * FROM
&gt; dbd_mysql_t40serverprepare2&#39;&#41;, [[101, 102, 103, &#40;2&lt;&lt;32&#41;+4]]&#41;;
&gt; 
&gt; ok &#40;$dbh-&gt;do&#40;qq{DROP TABLE dbd_mysql_t40serverprepare2}&#41;, &#34;cleaning
&gt; up&#34;&#41;;
&gt; 
&gt; I get
&gt; 
&gt; not ok 20
&gt; #   Failed test at t/40server_prepare.t line 66.
&gt; #     Structures begin differing at:
&gt; #          $got-&gt;[0][3] = &#39;4&#39;
&gt; #     $expected-&gt;[0][3] = &#39;8589934596&#39;
&gt; 
&gt; It looks like it&#39;s coercing 64-bit integers into 32-bit ones, which
&gt; mostly
&gt; works for small integers on little endian, but zeros out the result on
&gt; big endian.
&gt; 
&gt; I gather MYSQL_TYPE_LONG is an int &#40;32-bit&#41; despite the name and it
&gt; seems to be the default everywhere in dbdimp.c. Blindly sprinkling
&gt; MYSQL_TYPE_LONGLONG in the code fixes it; see the attached patch. I&#39;ve
&gt; tested it on amd64 &#40;64-bit LE&#41;, s390x &#40;64-bit BE&#41;, armhf &#40;32-bit LE&#41;
&gt; and powerpc &#40;32-bit BE&#41;.
&gt; 
&gt; But maybe MYSQL_TYPE_LONGLONG should be limited to just SQL_BIGINTs?
&gt; Hope this helps a bit anyway.
</div>
Your test scenario with &#40;2&lt;&lt;32&#41;+4 and SQL_INTEGER is expected. SQL_INTEGER type maps to MYSQL_TYPE_LONG which is 32bit integer in mysql server. So libmysqlclient.so will truncate your 64bit integer value &#40;2&lt;&lt;32&#41;+4 to 32bit and send it to mysql server. So returned value 4 is expected.

If you want to pass 64bit integer you need to use either SQL_BIGINT or SQL_VARCHAR.

Your test with 64bit type should looks like this:
$sth2-&gt;bind_param&#40;4, &#40;2&lt;&lt;32&#41;+4, DBI::SQL_BIGINT&#41;
Can you try it?

Also if you want to use 64bit integers in ODBC, you need to use type SQLBIGINT and not SQLINTEGER. So in my opinition this behaviour in mysql driver is correct.

Defaulting to MYSQL_TYPE_LONGLONG for all integer values is not a good idea.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1684276" href="/Public/Bug/Display.html?id=118823#txn-1684276">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;18&nbsp;09:31:34&nbsp;2016</span>
    <span class="description">pali [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1684276/904242/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/904242">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 646b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Pia Nov 18 08:16:39 2016, PALI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If you want to pass 64bit integer you need to use either SQL_BIGINT
</div>
There is big mess between perl types, DBI sql types and mysql types. Due to that SQL_BIGINT is broken too :-&#40;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Defaulting to MYSQL_TYPE_LONGLONG for all integer values is not a good
&gt; idea.
</div>
Looks like until conversion between perl/dbi/mysql types will be fixed there is no other way just default to 64bit MYSQL_TYPE_LONGLONG for perl&#39;s with 64bit scalars and MYSQL_TYPE_LONG for perl&#39;s with 32bit scalars.

Now I enabled test t/41int_min_max.t for prepared statements too and it is failing... Going to look at it and try to fix it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1684314" href="/Public/Bug/Display.html?id=118823#txn-1684314">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;18&nbsp;11:21:27&nbsp;2016</span>
    <span class="description">pali [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> debian-perl [...] lists.debian.org, debian-perl [...] lists.debian.org</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1684314/904271/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/904271">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 879b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Pia Nov 18 09:31:34 2016, PALI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Pia Nov 18 08:16:39 2016, PALI wrote:
<div class="message-stanza open">&gt; &gt; If you want to pass 64bit integer you need to use either SQL_BIGINT
</div>&gt; 
&gt; There is big mess between perl types, DBI sql types and mysql types.
&gt; Due to that SQL_BIGINT is broken too :-&#40;
&gt; 
<div class="message-stanza open">&gt; &gt; Defaulting to MYSQL_TYPE_LONGLONG for all integer values is not a
&gt; &gt; good
&gt; &gt; idea.
</div>&gt; 
&gt; Looks like until conversion between perl/dbi/mysql types will be fixed
&gt; there is no other way just default to 64bit MYSQL_TYPE_LONGLONG for
&gt; perl&#39;s with 64bit scalars and MYSQL_TYPE_LONG for perl&#39;s with 32bit
&gt; scalars.
&gt; 
&gt; Now I enabled test t/41int_min_max.t for prepared statements too and
&gt; it is failing... Going to look at it and try to fix it.
</div>
In attachment is a quick fix for types when mysql_server_prepare=1 is used. Please try this patch if it fix prepare statements also on big endian systems.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-Fix-integer-types-when-server-side-prepare-statement.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1684314/904272/0001-Fix-integer-types-when-server-side-prepare-statement.patch">Download 0001-Fix-integer-types-when-server-side-prepare-statement.patch</a><br />
<span class="downloadcontenttype">text/x-diff 7.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 602868738cdefda91d08eaa72705fe1023561d38 Mon Sep 17 00:00:00 2001
From: Pali &lt;pali@cpan.org&gt;
Date: Fri, 18 Nov 2016 17:18:27 +0100
Subject: [PATCH] Fix integer types when server side prepare statements are
 enabled

Fixed problems:

 * SQL_BIGINT was incorrectly handled as 32bit MYSQL_TYPE_LONG type instead
   64bit MYSQL_TYPE_LONGLONG which led to integer overflow/underflow

 * 32bit MYSQL_TYPE_LONG was used for perl&#39;s IV storage when IV was 64bit
   and 64bit MYSQL_TYPE_LONGLONG was used when IV was 32bit

 * All unsigned types were handled as signed, so all high positive values
   were treated as negative

 * Numeric conversions in perl which led to overflow/underflow was ignored
   even when mysql strict mode was enabled

 * Test t/41int_min_max.t was running only for normal non-prepared statements

 * Test t/40server_prepare.t used incorrect SQL type for big &#40;64bit&#41; integers
---
 dbdimp.c             |   31 +++++++++++++++++++++++++++----
 t/40server_prepare.t |    4 ++--
 t/41int_min_max.t    |    9 ++++++++-
 3 files changed, 37 insertions&#40;+&#41;, 7 deletions&#40;-&#41;

diff --git a/dbdimp.c b/dbdimp.c
index c1ef3ff..24f13f6 100644
--- a/dbdimp.c
+++ b/dbdimp.c
@@ -360,8 +360,10 @@ static enum enum_field_types mysql_to_perl_type&#40;enum enum_field_types type&#41;
   case MYSQL_TYPE_YEAR:
 #if IVSIZE &gt;= 8
   case MYSQL_TYPE_LONGLONG:
-#endif
+    enum_type= MYSQL_TYPE_LONGLONG;
+#else
     enum_type= MYSQL_TYPE_LONG;
+#endif
     break;
 
 #if MYSQL_VERSION_ID &gt; NEW_DATATYPE_VERSION
@@ -3508,7 +3510,7 @@ my_ulonglong mysql_st_internal_execute41&#40;
   {
     for &#40;i = mysql_stmt_field_count&#40;stmt&#41; - 1; i &gt;=0; --i&#41; {
         enum_type = mysql_to_perl_type&#40;stmt-&gt;fields[i].type&#41;;
-        if &#40;enum_type != MYSQL_TYPE_DOUBLE &#38;&#38; enum_type != MYSQL_TYPE_LONG &#38;&#38; enum_type != MYSQL_TYPE_BIT&#41;
+        if &#40;enum_type != MYSQL_TYPE_DOUBLE &#38;&#38; enum_type != MYSQL_TYPE_LONG &#38;&#38; enum_type != MYSQL_TYPE_LONGLONG &#38;&#38; enum_type != MYSQL_TYPE_BIT&#41;
         {
             /* mysql_stmt_store_result to update MYSQL_FIELD-&gt;max_length */
             my_bool on = 1;
@@ -3776,6 +3778,7 @@ int dbd_describe&#40;SV* sth, imp_sth_t* imp_sth&#41;
         break;
 
       case MYSQL_TYPE_LONG:
+      case MYSQL_TYPE_LONGLONG:
         buffer-&gt;buffer_length= sizeof&#40;fbh-&gt;ldata&#41;;
         buffer-&gt;buffer= &#40;char*&#41; &#38;fbh-&gt;ldata;
         buffer-&gt;is_unsigned= &#40;fields[i].flags &#38; UNSIGNED_FLAG&#41; ? 1 : 0;
@@ -4016,6 +4019,7 @@ process:
           break;
 
         case MYSQL_TYPE_LONG:
+        case MYSQL_TYPE_LONGLONG:
           if &#40;DBIc_TRACE_LEVEL&#40;imp_xxh&#41; &gt;= 2&#41;
             PerlIO_printf&#40;DBIc_LOGPIO&#40;imp_xxh&#41;, &#34;\t\tst_fetch int data %&#34;IVdf&#34;, unsigned? %d\n&#34;,
                           fbh-&gt;ldata, buffer-&gt;is_unsigned&#41;;
@@ -4178,6 +4182,7 @@ process:
           break;
 
         case MYSQL_TYPE_LONG:
+        case MYSQL_TYPE_LONGLONG:
           /* Coerce to integer and set scalar as UV resp. IV */
           if &#40;fields[i].flags &#38; UNSIGNED_FLAG&#41;
           {
@@ -4825,6 +4830,7 @@ int dbd_bind_ph&#40;SV *sth, imp_sth_t *imp_sth, SV *param, SV *value,
   STRLEN slen;
   char *buffer= NULL;
   int buffer_is_null= 0;
+  int buffer_is_unsigned= 0;
   int buffer_length= slen;
   unsigned int buffer_type= 0;
 #endif
@@ -4882,9 +4888,13 @@ int dbd_bind_ph&#40;SV *sth, imp_sth_t *imp_sth, SV *param, SV *value,
       case SQL_NUMERIC:
       case SQL_INTEGER:
       case SQL_SMALLINT:
-      case SQL_BIGINT:
       case SQL_TINYINT:
+#if IVSIZE &gt;= 8
+      case SQL_BIGINT:
+          buffer_type= MYSQL_TYPE_LONGLONG;
+#else
           buffer_type= MYSQL_TYPE_LONG;
+#endif
           break;
       case SQL_DOUBLE:
       case SQL_DECIMAL: 
@@ -4910,12 +4920,24 @@ int dbd_bind_ph&#40;SV *sth, imp_sth_t *imp_sth, SV *param, SV *value,
     if &#40;! buffer_is_null&#41; {
       switch&#40;buffer_type&#41; {
         case MYSQL_TYPE_LONG:
+        case MYSQL_TYPE_LONGLONG:
           /* INT */
           if &#40;!SvIOK&#40;imp_sth-&gt;params[idx].value&#41; &#38;&#38; DBIc_TRACE_LEVEL&#40;imp_xxh&#41; &gt;= 2&#41;
             PerlIO_printf&#40;DBIc_LOGPIO&#40;imp_xxh&#41;, &#34;\t\tTRY TO BIND AN INT NUMBER\n&#34;&#41;;
           buffer_length = sizeof imp_sth-&gt;fbind[idx].numeric_val.lval;
           imp_sth-&gt;fbind[idx].numeric_val.lval= SvIV&#40;imp_sth-&gt;params[idx].value&#41;;
           buffer=&#40;void*&#41;&#38;&#40;imp_sth-&gt;fbind[idx].numeric_val.lval&#41;;
+          if &#40;!SvIOK&#40;imp_sth-&gt;params[idx].value&#41;&#41;
+          {
+            if &#40;DBIc_TRACE_LEVEL&#40;imp_xxh&#41; &gt;= 2&#41;
+              PerlIO_printf&#40;DBIc_LOGPIO&#40;imp_xxh&#41;,
+                            &#34;   Conversion to INT NUMBER was not successful -&gt; &#39;%s&#39; --&gt; &#40;unsigned&#41; &#39;%&#34;UVuf&#34;&#39; / &#40;signed&#41; &#39;%&#34;IVdf&#34;&#39; &lt;- fallback to STRING\n&#34;,
+                            SvPV_nolen&#40;imp_sth-&gt;params[idx].value&#41;, imp_sth-&gt;fbind[idx].numeric_val.lval, imp_sth-&gt;fbind[idx].numeric_val.lval&#41;;
+            buffer_type = MYSQL_TYPE_STRING;
+            break;
+          }
+          if &#40;SvIsUV&#40;imp_sth-&gt;params[idx].value&#41;&#41;
+            buffer_is_unsigned= 1;
           if &#40;DBIc_TRACE_LEVEL&#40;imp_xxh&#41; &gt;= 2&#41;
             PerlIO_printf&#40;DBIc_LOGPIO&#40;imp_xxh&#41;,
                           &#34;   SCALAR type %&#34;IVdf&#34; -&gt;%&#34;IVdf&#34;&lt;- IS A INT NUMBER\n&#34;,
@@ -4970,7 +4992,7 @@ int dbd_bind_ph&#40;SV *sth, imp_sth_t *imp_sth, SV *param, SV *value,
     }
 
     /* Type of column was changed. Force to rebind */
-    if &#40;imp_sth-&gt;bind[idx].buffer_type != buffer_type&#41; {
+    if &#40;imp_sth-&gt;bind[idx].buffer_type != buffer_type || imp_sth-&gt;bind[idx].is_unsigned != buffer_is_unsigned&#41; {
       if &#40;DBIc_TRACE_LEVEL&#40;imp_xxh&#41; &gt;= 2&#41;
           PerlIO_printf&#40;DBIc_LOGPIO&#40;imp_xxh&#41;,
                         &#34;   FORCE REBIND: buffer type changed from %d to %d, sql-type=%&#34;IVdf&#34;\n&#34;,
@@ -4988,6 +5010,7 @@ int dbd_bind_ph&#40;SV *sth, imp_sth_t *imp_sth, SV *param, SV *value,
     imp_sth-&gt;bind[idx].buffer_type= buffer_type;
     imp_sth-&gt;bind[idx].buffer= buffer;
     imp_sth-&gt;bind[idx].buffer_length= buffer_length;
+    imp_sth-&gt;bind[idx].is_unsigned= buffer_is_unsigned;
 
     imp_sth-&gt;fbind[idx].length= buffer_length;
     imp_sth-&gt;fbind[idx].is_null= buffer_is_null;
diff --git a/t/40server_prepare.t b/t/40server_prepare.t
index 0542d91..78658b0 100644
--- a/t/40server_prepare.t
+++ b/t/40server_prepare.t
@@ -59,11 +59,11 @@ ok&#40;$sth2 = $dbh-&gt;prepare&#40;&#39;INSERT INTO dbd_mysql_t40serverprepare2 VALUES &#40;?,?,?,
 ok&#40;$sth2-&gt;bind_param&#40;1, 101, DBI::SQL_INTEGER&#41;, &#34;binding int&#34;&#41;;
 ok&#40;$sth2-&gt;bind_param&#40;2, 102, DBI::SQL_SMALLINT&#41;, &#34;binding smallint&#34;&#41;;
 ok&#40;$sth2-&gt;bind_param&#40;3, 103, DBI::SQL_TINYINT&#41;, &#34;binding tinyint&#34;&#41;;
-ok&#40;$sth2-&gt;bind_param&#40;4, 104, DBI::SQL_INTEGER&#41;, &#34;binding bigint&#34;&#41;;
+ok&#40;$sth2-&gt;bind_param&#40;4, &#39;8589934697&#39;, DBI::SQL_BIGINT&#41;, &#34;binding bigint&#34;&#41;;
 
 ok&#40;$sth2-&gt;execute&#40;&#41;, &#34;inserting data&#34;&#41;;
 
-is_deeply&#40;$dbh-&gt;selectall_arrayref&#40;&#39;SELECT * FROM dbd_mysql_t40serverprepare2&#39;&#41;, [[101, 102, 103, 104]]&#41;;
+is_deeply&#40;$dbh-&gt;selectall_arrayref&#40;&#39;SELECT * FROM dbd_mysql_t40serverprepare2&#39;&#41;, [[101, 102, 103, &#39;8589934697&#39;]]&#41;;
 
 ok &#40;$dbh-&gt;do&#40;qq{DROP TABLE dbd_mysql_t40serverprepare2}&#41;, &#34;cleaning up&#34;&#41;;
 
diff --git a/t/41int_min_max.t b/t/41int_min_max.t
index 547b7f5..355b00a 100644
--- a/t/41int_min_max.t
+++ b/t/41int_min_max.t
@@ -22,7 +22,7 @@ if &#40;!MinimumVersion&#40;$dbh, &#39;4.1&#39;&#41;&#41; {
         &#34;SKIP TEST: You must have MySQL version 4.1 and greater for this test to run&#34;;
 }
 # nostrict tests + strict tests + init/tear down commands
-plan tests =&gt; 19*8 + 17*8 + 4;
+plan tests =&gt; &#40;19*8 + 17*8 + 4&#41; * 2;
 
 my $table = &#39;dbd_mysql_t41minmax&#39;; # name of the table we will be using
 my $mode; # &#39;strict&#39; or &#39;nostrict&#39; corresponds to strict SQL mode
@@ -117,6 +117,12 @@ sub test_int_type &#40;$$$$&#41; {
     };
 }
 
+$dbh-&gt;disconnect;
+
+for my $mysql_server_prepare &#40;0, 1&#41; {
+$dbh= DBI-&gt;connect&#40;$test_dsn . &#39;;mysql_server_prepare=&#39; . $mysql_server_prepare, $test_user, $test_password,
+                      { RaiseError =&gt; 1, PrintError =&gt; 1, AutoCommit =&gt; 0 }&#41;;
+
 # Set strict SQL mode
 ok&#40;$dbh-&gt;do&#40;&#34;SET SQL_MODE=&#39;STRICT_ALL_TABLES&#39;&#34;&#41;,&#34;Enter strict SQL mode.&#34;&#41;;
 $mode = &#39;strict&#39;;
@@ -146,3 +152,4 @@ test_int_type&#40;DBI::SQL_BIGINT,   &#39;bigint unsigned&#39;,        0, 2**64-1&#41;;
 ok &#40;$dbh-&gt;do&#40;&#34;DROP TABLE $table&#34;&#41;&#41;;
 
 ok $dbh-&gt;disconnect;
+}
-- 
1.7.9.5

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1684444" href="/Public/Bug/Display.html?id=118823#txn-1684444">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;19&nbsp;12:36:31&nbsp;2016</span>
    <span class="description">ntyni [...] debian.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> debian-perl [...] lists.debian.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #118823] libdbd-mysql-perl: FTBFS on some architectures</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 19 Nov 2016 19:35:59 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Pali via RT &lt;bug-DBD-mysql [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Niko Tyni &lt;ntyni [...] debian.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1684444/904347/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/904347">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 472b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Nov 18, 2016 at 11:21:28AM -0500, Pali via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=118823">https://rt.cpan.org/Ticket/Display.html?id=118823</a></span> &gt;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In attachment is a quick fix for types when mysql_server_prepare=1 is used. Please try this patch if it fix prepare statements also on big endian systems.
</div>
Yes, that seems to work. Tested succesfully on amd64 &#40;64-bit LE&#41;, s390x
&#40;64-bit BE&#41;, armhf &#40;32-bit LE&#41; and powerpc &#40;32-bit BE&#41;

Many thanks for the quick fix!
-- 
Niko Tyni   ntyni@debian.org
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1684461" href="/Public/Bug/Display.html?id=118823#txn-1684461">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;19&nbsp;15:03:10&nbsp;2016</span>
    <span class="description">MICHIELB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1684461/904359/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/904359">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 164b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">It&#39;s fixed in <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/perl5-dbi/DBD-mysql/commit/b2dcab35a4575ef754aea583bbc0ec4a1a162dfe">https://github.com/perl5-dbi/DBD-mysql/commit/b2dcab35a4575ef754aea583bbc0ec4a1a162dfe</a></span> and released as version 4.040 which is on CPAN now.

--
Michiel
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1684464" href="/Public/Bug/Display.html?id=118823#txn-1684464">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;19&nbsp;15:03:11&nbsp;2016</span>
    <span class="description">MICHIELB [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1684466" href="/Public/Bug/Display.html?id=118823#txn-1684466">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;19&nbsp;15:03:11&nbsp;2016</span>
    <span class="description">MICHIELB [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1684491" href="/Public/Bug/Display.html?id=118823#txn-1684491">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;19&nbsp;16:01:34&nbsp;2016</span>
    <span class="description">gregoa [...] debian.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #118823] libdbd-mysql-perl: FTBFS on some architectures</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 19 Nov 2016 22:01:11 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Michiel Beijen via RT &lt;bug-DBD-mysql [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> gregor herrmann &lt;gregoa [...] debian.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1684491/904384/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/904384">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 743b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, 19 Nov 2016 15:03:11 -0500, Michiel Beijen via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=118823">https://rt.cpan.org/Ticket/Display.html?id=118823</a></span> &gt;
&gt; 
&gt; It&#39;s fixed in
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/perl5-dbi/DBD-mysql/commit/b2dcab35a4575ef754aea583bbc0ec4a1a162dfe">https://github.com/perl5-dbi/DBD-mysql/commit/b2dcab35a4575ef754aea583bbc0ec4a1a162dfe</a></span>
&gt; and released as version 4.040 which is on CPAN now.
</div>
Thanks!

Uploading to Debian/unstable right now.

Build results will show up soon at
<span class="clickylink"><a target="new" rel="nofollow" href="https://buildd.debian.org/status/package.php?p=libdbd-mysql-perl">https://buildd.debian.org/status/package.php?p=libdbd-mysql-perl</a></span>


Cheers,
gregor 

-- 
 .&#39;&#39;`.  <span class="clickylink"><a target="new" rel="nofollow" href="https://info.comodo.priv.at/">https://info.comodo.priv.at/</a></span> - Debian Developer <span class="clickylink"><a target="new" rel="nofollow" href="https://www.debian.org">https://www.debian.org</a></span>
 : :&#39; : OpenPGP fingerprint D1E1 316E 93A7 60A8 104D  85FA BB3A 6801 8649 AA06
 `. `&#39;  Member of VIBE!AT &#38; SPI, fellow of the Free Software Foundation Europe
   `-   NP: Funny van Dannen: MÃ¤dchenmusik
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1684491/904385/signature.asc">Download signature.asc</a><br />
<span class="downloadcontenttype">application/pgp-signature 963b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.702516</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
