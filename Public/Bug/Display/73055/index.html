<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #73055 for Email-Sender: Email::Sender::Simple and bcc header for VERSION = &#39;0.110001&#39;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #73055 for Email-Sender: Email::Sender::Simple and bcc header for VERSION = &#39;0.110001&#39;</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Email-Sender/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Email-Sender/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Email-Sender/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Email-Sender/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/rjbs/Email-Sender/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Email-Sender">Email-Sender CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">73055</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Email-Sender/Active/">Email-Sender</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
sfo [...] cargocult.ca

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-225082-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-225083-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;06&nbsp;13:36:01&nbsp;2011</span>
    <span class="description">sfo [...] cargocult.ca -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> sfo [...] cargocult.ca</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Email::Sender::Simple and bcc header for VERSION = &#39;0.110001&#39;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 6 Dec 2011 13:35:50 -0500 &#40;EST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Email-Sender [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Stephen Oberski&#34; &lt;sfo [...] cargocult.ca&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Email::Sender::Simple::VERSION = &#39;0.110001&#39;

====================================================================================
use Email::Sender::Simple qw&#40;sendmail&#41;;
use Email::Simple;
use Email::Simple::Creator;
use Email::MIME::Creator;
...
my $email = Email::MIME-&gt;create&#40;
        header_str =&gt; [
          Bcc      =&gt; join&#40;&#39;,&#39;, @{$recipient_list_r}&#41;, # hide the recipient list
          From    =&gt; $from,
          Subject =&gt; $subject,
        ],
        parts =&gt; [ @parts ],
    &#41;;
sendmail&#40;$email&#41;;
====================================================================================

This code snippet results in a &#34;no recipients&#34; message/exception from Email/Sender/Simple.pm.

I made this local change to Email/Sender/Simple.pm:

[root@ccc Sender]# pwd
/usr/lib/perl5/site_perl/5.8.8/Email/Sender
[root@ccc Sender]# uname -a
Linux ccc.cargocult.ca 2.6.18-238.9.1.el5 #1 SMP Tue Apr 12 18:10:13 EDT 2011 x86_64 x86_64 x86_64
GNU/Linux
[root@ccc Sender]# diff Simple.pm*
141c141
&lt;       qw&#40;to cc bcc&#41;;
---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       qw&#40;to cc&#41;;
</div>
That is I added bcc to the list to_addrs and that makes it work for me.

I can now send Emails with only a Bcc thus hiding the recipient list.

Thanks,

-- 
Stephen Oberski sfo@cargocult.ca
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;06&nbsp;14:14:31&nbsp;2011</span>
    <span class="description">rjbs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/rjbs/email-sender/wiki/Bcc">https://github.com/rjbs/email-sender/wiki/Bcc</a></span>

-- 
rjbs
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;06&nbsp;14:14:31&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;06&nbsp;14:14:31&nbsp;2011</span>
    <span class="description">rjbs [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;06&nbsp;15:07:56&nbsp;2011</span>
    <span class="description">sfo [...] cargocult.ca -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> sfo [...] cargocult.ca</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #73055] Email::Sender::Simple and bcc header for  VERSION = &#39;0.110001&#39;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 6 Dec 2011 15:07:46 -0500 &#40;EST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Email-Sender [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Stephen Oberski&#34; &lt;sfo [...] cargocult.ca&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Ricardo,

I have to disagree with the analysis of the bcc problem in the wiki.

The addresses in the Bcc header appear in the transport envelope, that is they appear in the SMTP
RCPT_TO list along with any addresses in the To and Cc headers but unlike the To and Cc headers
the Bcc addresses do not appear in the Email header.

There are no issues with sending such a message atomically and hiding the Bcc addresses from
recipients.

At the SMTP transport level we see:

...
MAIL_FROM: from
RCPT_TO: To #1
RCPT_TO: To #2
...
RCPT_TO: Cc #1
RCPT_TO: Cc #2
...
RCPT_TO: Bcc #1
RCPT_TO: Bcc #2
...

while in the Email header we will see:

From: from
To: to#1, to#2...
Cc: cc#1, cc#2...

But no Bcc header will appear in the Email header.

Thus the intent of the Bcc header is maintained.

There seems to be some confusion between the Email envelope &#40;i.e. the sendmail/SMTP transport
layer&#41; and the Email header.

The 2 are distinct and information in the envelope used to deliver Email does not have to appear
in the Email header.

As Email::Sender::Simple is implemented now it is not possible to hide the recipients even if one
were to follow the &#40;erroneous&#41; suggestion in the wiki to send &#34;one to to_rcpt and cc_rcpt, with no
Bcc header present; and another to the_boss only, with the Bcc header.&#34; as Email::Sender::Simple
does not pass Bcc addresses to the transport layer and in fact generates the &#34;no recipients&#34;
exception if only a Bcc header but no To or Cc header is specified.

So the suggestion in the wiki is wrong and it is not possible to send to undisclosed recipients
using Email::Sender::Simple whether or not To and/or Cc headers are present.

The fix I submitted does send the Email atomically to all To, Cc and Bcc recipients and it does
hide the Bcc recipients from all recipients.

Here is a Email header from a message sent to multiple Bcc recipients and no To or Cc recipients
using the modified Email::Sender::Simple that I sent the patch for:

Return-Path: &lt;cargocult_moc_support@cargocult.ca&gt;
Received: from ccc.cargocult.ca &#40;[unix socket]&#41;
     by ccc.cargocult.ca &#40;Cyrus v2.3.7-Invoca-RPM-2.3.7-12.el5_7.2&#41; with LMTPA;
     Tue, 06 Dec 2011 10:14:57 -0500
X-Sieve: CMU Sieve 2.3
Received: from cargocult.cargocult.ca &#40;d24-150-190-43.home.cgocable.net [24.150.190.43]&#41;
     by ccc.cargocult.ca &#40;8.13.8/8.13.8&#41; with ESMTP id pB6FEucr010588;
     Tue, 6 Dec 2011 10:14:56 -0500
Received: from cargocult.cargocult.ca &#40;cargocult.cargocult.ca [127.0.0.1]&#41;
     by cargocult.cargocult.ca &#40;8.13.8/8.13.8&#41; with ESMTP id pB6FEt61002398;
     Tue, 6 Dec 2011 10:14:55 -0500
Received: &#40;from sfo@localhost&#41;
     by cargocult.cargocult.ca &#40;8.13.8/8.13.8/Submit&#41; id pB6FEtoB002395;
     Tue, 6 Dec 2011 10:14:55 -0500
Message-Id: &lt;201112061514.pB6FEtoB002395@cargocult.cargocult.ca&gt;
X-Authentication-Warning: cargocult.cargocult.ca: sfo set sender to
cargocult_moc_support@cargocult.ca using -f
Bcc:
From: cargocult_moc_support@cargocult.ca
Subject: MOC - 2011/12/06
Date: Tue, 6 Dec 2011 10:14:55 -0500
MIME-Version: 1.0
Content-Type: multipart/mixed; boundary=&#34;1323184495.fD5E4C0.2388&#34;; charset=&#34;us-ascii&#34;

As you can see the Bcc: header is empty.

It probably shouldn&#39;t be there at all but given that I changed one line of code that&#39;s good enough
for me.

There is probably a better way of doing this but my preference is that I report the problems and
you fix them.

By the way, this Email has a To, Cc and Bcc recipients and it was forwarded to my transport layer
as a single/atomic message and the Bcc information is not disclosed to any other recipients.

Thanks,

-- 
Stephen Oberski sfo@cargocult.ca

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=73055">https://rt.cpan.org/Ticket/Display.html?id=73055</a></span> &gt;
&gt;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/rjbs/email-sender/wiki/Bcc">https://github.com/rjbs/email-sender/wiki/Bcc</a></span>
&gt;
&gt; --
&gt; rjbs
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;06&nbsp;15:07:57&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;06&nbsp;15:23:33&nbsp;2011</span>
    <span class="description">rjbs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; but unlike the To and Cc headers the Bcc addresses do not 
&gt; appear in the Email header. 
</div>
What transport is being used under the hood?  Sendmail?  If so, it is
removing the header for you.

Re-send using the SMTP transport, for example, and you will see the
header is left in place.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;06&nbsp;15:34:23&nbsp;2011</span>
    <span class="description">sfo [...] cargocult.ca -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> sfo [...] cargocult.ca</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #73055] Email::Sender::Simple and bcc header for  VERSION = &#39;0.110001&#39;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 6 Dec 2011 15:34:14 -0500 &#40;EST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Email-Sender [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Stephen Oberski&#34; &lt;sfo [...] cargocult.ca&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Ricardo,

I&#39;ll give that a try and report back.

I appreciate the fact that you developed and maintain the Email::Sender &#40;along with a large number
of others&#41; package so I hope I didn&#39;t come across to strongly in my previous message.

I&#39;m just looking to send my Emails to an undisclosed recipient list and my current problems with
Email::Sender are more than likely due to my ignorance.

Thanks,

-- 
Stephen Oberski sfo@cargocult.ca

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=73055">https://rt.cpan.org/Ticket/Display.html?id=73055</a></span> &gt;
&gt;
<div class="message-stanza open">&gt;&gt; but unlike the To and Cc headers the Bcc addresses do not
&gt;&gt; appear in the Email header.
</div>&gt;
&gt; What transport is being used under the hood?  Sendmail?  If so, it is
&gt; removing the header for you.
&gt;
&gt; Re-send using the SMTP transport, for example, and you will see the
&gt; header is left in place.
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;06&nbsp;18:25:51&nbsp;2011</span>
    <span class="description">sfo [...] cargocult.ca -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> bug-email-sender [...] rt.cpan.org, sfo [...] cargocult.ca</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #73055] Email::Sender::Simple and bcc header for   VERSION = &#39;0.110001&#39;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 6 Dec 2011 18:25:31 -0500 &#40;EST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> sfo [...] cargocult.ca</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Stephen Oberski&#34; &lt;sfo [...] cargocult.ca&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Ricardo,

Here is what I get when I use Email::Sender::Transport::SMTP:

==========================================================================================

    my $email = Email::MIME-&gt;create&#40;
        header_str =&gt; [
          Bcc      =&gt; join&#40;&#39;,&#39;, @{$recipient_list_r}&#41;, # hide the recipient list
          From    =&gt; $from,
          Subject =&gt; $subject,
        ],
        parts =&gt; [ @parts ],
    &#41;;

    my $transport = Email::Sender::Transport::SMTP-&gt;new&#40;&#41;;

    sendmail&#40;$email,  { transport =&gt; $transport }&#41;;
==========================================================================================

Here is a received Email header:

==========================================================================================
Return-Path: &lt;cargocult_moc_support@cargocult.ca&gt;
Received: from ccc.cargocult.ca &#40;[unix socket]&#41;
     by ccc.cargocult.ca &#40;Cyrus v2.3.7-Invoca-RPM-2.3.7-12.el5_7.2&#41; with LMTPA;
     Tue, 06 Dec 2011 18:11:40 -0500
X-Sieve: CMU Sieve 2.3
Received: from cargocult.cargocult.ca &#40;d24-150-190-43.home.cgocable.net [24.150.190.43]&#41;
     by ccc.cargocult.ca &#40;8.13.8/8.13.8&#41; with ESMTP id pB6NBd4b013782;
     Tue, 6 Dec 2011 18:11:39 -0500
Received: from localhost.localdomain &#40;cargocult.cargocult.ca [127.0.0.1]&#41;
     by cargocult.cargocult.ca &#40;8.13.8/8.13.8&#41; with ESMTP id pB6NBdB2005769;
     Tue, 6 Dec 2011 18:11:39 -0500
Message-Id: &lt;201112062311.pB6NBdB2005769@cargocult.cargocult.ca&gt;
Bcc:
From: cargocult_moc_support@cargocult.ca
Subject: MOC - 2011/12/06 - update #1
Date: Tue, 6 Dec 2011 18:11:39 -0500
MIME-Version: 1.0
Content-Type: multipart/mixed; boundary=&#34;1323213099.C02ffBb4.5723&#34;; charset=&#34;us-ascii&#34;
==========================================================================================

And here are the sendmail log entries for the outbound delivery, i.e. this was the SMTP server
that Email::Sender::Transport::SMTP connected to:


Dec  6 18:11:39 cargocult sendmail[5769]: pB6NBdB2005769:
from=&lt;cargocult_moc_support@cargocult.ca&gt;, size=85616, class=0, nrcpts=2,
msgid=&lt;201112062311.pB6NBdB2005769@cargocult.cargocult.ca&gt;, proto=ESMTP, daemon=MTA,
relay=cargocult.cargocult.ca [127.0.0.1]

Dec  6 18:11:40 cargocult sendmail[5771]: pB6NBdB2005769:
to=&lt;cargocultcorp@gmail.com&gt;,&lt;sfo@cargocult.ca&gt;, delay=00:00:01, xdelay=00:00:01, mailer=relay,
pri=235616, relay=ccc.cargocult.ca. [199.85.16.201], dsn=2.0.0, stat=Sent &#40;pB6NBd4b013782 Message
accepted for delivery&#41;

You can see that the Bcc header addresses &#40;&lt;cargocultcorp@gmail.com&gt;,&lt;sfo@cargocult.ca&gt;&#41; were
passed to the transport/envelope layer but did not appear in the Bcc: header above.

But there is still an empty Bcc: header in the Email.

Thoughts ?

-- 
Stephen Oberski sfo@cargocult.ca

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Ricardo,
&gt;
&gt; I&#39;ll give that a try and report back.
&gt;
&gt; I appreciate the fact that you developed and maintain the Email::Sender &#40;along with a large number
&gt; of others&#41; package so I hope I didn&#39;t come across to strongly in my previous message.
&gt;
&gt; I&#39;m just looking to send my Emails to an undisclosed recipient list and my current problems with
&gt; Email::Sender are more than likely due to my ignorance.
&gt;
&gt; Thanks,
&gt;
&gt; --
&gt; Stephen Oberski sfo@cargocult.ca
&gt;
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=73055">https://rt.cpan.org/Ticket/Display.html?id=73055</a></span> &gt;
&gt;&gt;
<div class="message-stanza open">&gt;&gt;&gt; but unlike the To and Cc headers the Bcc addresses do not
&gt;&gt;&gt; appear in the Email header.
</div>&gt;&gt;
&gt;&gt; What transport is being used under the hood?  Sendmail?  If so, it is
&gt;&gt; removing the header for you.
&gt;&gt;
&gt;&gt; Re-send using the SMTP transport, for example, and you will see the
&gt;&gt; header is left in place.
&gt;&gt;
</div>&gt;
&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;07&nbsp;09:14:10&nbsp;2011</span>
    <span class="description">rjbs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">What you are seeing is an implementation or configuration detail of an
SMTP server along the way.  Instead, look at the actual SMTP
conversation.  Here&#39;s an example one:

    &lt;&lt;&lt; 220 walrus.local ESMTP Postfix
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">    &gt;&gt;&gt; EHLO localhost.localdomain
</div>    &lt;&lt;&lt; 250-walrus.local
    &lt;&lt;&lt; 250-PIPELINING
    &lt;&lt;&lt; 250-SIZE 10485760
    &lt;&lt;&lt; 250-VRFY
    &lt;&lt;&lt; 250-ETRN
    &lt;&lt;&lt; 250-ENHANCEDSTATUSCODES
    &lt;&lt;&lt; 250-8BITMIME
    &lt;&lt;&lt; 250-DSN
    &lt;&lt;&lt; 250-BINARYMIME
    &lt;&lt;&lt; 250 CHUNKING
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">    &gt;&gt;&gt; MAIL FROM:&lt;rjbs@cpan.org&gt;
</div>    &lt;&lt;&lt; 250 2.1.0 Ok
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">    &gt;&gt;&gt; RCPT TO:&lt;rjbs@cpan.org&gt;
</div>    &lt;&lt;&lt; 250 2.1.5 Ok
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">    &gt;&gt;&gt; DATA
</div>    &lt;&lt;&lt; 354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">    &gt;&gt;&gt; To: rjbs@cpan.org
    &gt;&gt;&gt; Bcc: rjbs@cpan.org
    &gt;&gt;&gt; From: rjbs@cpan.org
    &gt;&gt;&gt; Subject: Test Bcc
    &gt;&gt;&gt; Date: Wed, 7 Dec 2011 09:09:23 -0500
    &gt;&gt;&gt; MIME-Version: 1.0
    &gt;&gt;&gt; 
    &gt;&gt;&gt; Test.
    &gt;&gt;&gt; .
</div>    &lt;&lt;&lt; 250 2.0.0 Ok: queued as 188012004939
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">    &gt;&gt;&gt; QUIT
</div>    &lt;&lt;&lt; 221 2.0.0 Bye

Note that the Bcc header *is* sent.  The fact that some SMTP servers &#40;or
MDAs&#41; will then strip it is unreliable, and not something
Email::Sender::Simple should take as given – especially because sendmail
and SMTP are not the only transports it might use.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;07&nbsp;10:18:08&nbsp;2011</span>
    <span class="description">sfo [...] cargocult.ca -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> sfo [...] cargocult.ca</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #73055] Email::Sender::Simple and bcc header for  VERSION = &#39;0.110001&#39;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 7 Dec 2011 10:17:59 -0500 &#40;EST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Email-Sender [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Stephen Oberski&#34; &lt;sfo [...] cargocult.ca&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Ricardo,

So I started my Email asking if there was a way to pass information directly to the transport
layer and of course there it was in the Email::Sender::Manual::QuickStart manual:

    my $email = Email::MIME-&gt;create&#40;
        header_str =&gt; [
          From    =&gt; $from,
          Subject =&gt; $subject,
        ],
        parts =&gt; [ @parts ],
    &#41;;

    # recipient list is passed to the transport but does not appear in the Email header
    sendmail&#40;$email,  { to =&gt; [ @{$recipient_list_r} ] }&#41;;

I&#39;ve blown away my nasty hack to Simple.pm and am now doing it the correct way.

Thanks for your patience.

-- 
Stephen Oberski sfo@cargocult.ca

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=73055">https://rt.cpan.org/Ticket/Display.html?id=73055</a></span> &gt;
&gt;
&gt; What you are seeing is an implementation or configuration detail of an
&gt; SMTP server along the way.  Instead, look at the actual SMTP
&gt; conversation.  Here&#39;s an example one:
&gt;
&gt;     &lt;&lt;&lt; 220 walrus.local ESMTP Postfix
<div class="message-stanza open">&gt;     &gt;&gt;&gt; EHLO localhost.localdomain
</div>&gt;     &lt;&lt;&lt; 250-walrus.local
&gt;     &lt;&lt;&lt; 250-PIPELINING
&gt;     &lt;&lt;&lt; 250-SIZE 10485760
&gt;     &lt;&lt;&lt; 250-VRFY
&gt;     &lt;&lt;&lt; 250-ETRN
&gt;     &lt;&lt;&lt; 250-ENHANCEDSTATUSCODES
&gt;     &lt;&lt;&lt; 250-8BITMIME
&gt;     &lt;&lt;&lt; 250-DSN
&gt;     &lt;&lt;&lt; 250-BINARYMIME
&gt;     &lt;&lt;&lt; 250 CHUNKING
<div class="message-stanza open">&gt;     &gt;&gt;&gt; MAIL FROM:&lt;rjbs@cpan.org&gt;
</div>&gt;     &lt;&lt;&lt; 250 2.1.0 Ok
<div class="message-stanza open">&gt;     &gt;&gt;&gt; RCPT TO:&lt;rjbs@cpan.org&gt;
</div>&gt;     &lt;&lt;&lt; 250 2.1.5 Ok
<div class="message-stanza open">&gt;     &gt;&gt;&gt; DATA
</div>&gt;     &lt;&lt;&lt; 354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;
<div class="message-stanza open">&gt;     &gt;&gt;&gt; To: rjbs@cpan.org
&gt;     &gt;&gt;&gt; Bcc: rjbs@cpan.org
&gt;     &gt;&gt;&gt; From: rjbs@cpan.org
&gt;     &gt;&gt;&gt; Subject: Test Bcc
&gt;     &gt;&gt;&gt; Date: Wed, 7 Dec 2011 09:09:23 -0500
&gt;     &gt;&gt;&gt; MIME-Version: 1.0
&gt;     &gt;&gt;&gt;
&gt;     &gt;&gt;&gt; Test.
&gt;     &gt;&gt;&gt; .
</div>&gt;     &lt;&lt;&lt; 250 2.0.0 Ok: queued as 188012004939
<div class="message-stanza open">&gt;     &gt;&gt;&gt; QUIT
</div>&gt;     &lt;&lt;&lt; 221 2.0.0 Bye
&gt;
&gt; Note that the Bcc header *is* sent.  The fact that some SMTP servers &#40;or
&gt; MDAs&#41; will then strip it is unreliable, and not something
&gt; Email::Sender::Simple should take as given âÂ especially because sendmail
&gt; and SMTP are not the only transports it might use.
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;07&nbsp;10:35:39&nbsp;2011</span>
    <span class="description">rjbs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m glad you see it as patience, because I&#39;ve felt shamefully impatient!
 It&#39;s... been a busy week. :-&#41;

Have fun hacking…

-- 
rjbs
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;07&nbsp;10:35:40&nbsp;2011</span>
    <span class="description">rjbs [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
