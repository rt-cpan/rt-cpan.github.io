<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #103833 for Parse-PMFile: What is the logic for flagging a dev release?</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #103833 for Parse-PMFile: What is the logic for flagging a dev release?</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Parse-PMFile">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Parse-PMFile">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Parse-PMFile">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Parse-PMFile">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Parse-PMFile">Parse-PMFile CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">103833</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Parse-PMFile">Parse-PMFile</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
olaf [...] wundersolutions.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-249708-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.36    </td>
  </tr>
  <tr id="CF-249709-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=103833">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1488103" href="/Public/Bug/Display.html?id=103833#txn-1488103">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;20&nbsp;05:11:40&nbsp;2015</span>
    <span class="description">olaf [...] wundersolutions.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> What is the logic for flagging a dev release?</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1488103/792493/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/792493">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 949b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

Thanks for all of your work on this.  :&#41;

I&#39;m a bit unclear as to what constitutes a dev release.

It appears that the only time that the version numbers are checked for underscores is at:

<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/ISHIGAKI/Parse-PMFile-0.36/lib/Parse/PMFile.pm#L44">https://metacpan.org/source/ISHIGAKI/Parse-PMFile-0.36/lib/Parse/PMFile.pm#L44</a></span>

This condition is never checked if there&#39;s a valid META file containing provides.  This means that if the META file contains a provides, it won&#39;t skip any versions with underscores, even if the provides actually does have the underscore.

Also, I wonder if it should parse anything at all if the entire version is flagged as TRIAL, like in this case <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/RIBASUSHI/DBIx-Class-0.082899_14/META.yml#L71">https://metacpan.org/source/RIBASUSHI/DBIx-Class-0.082899_14/META.yml#L71</a></span>

I just ran up against this while trying to write some tests for OrePAN2.  In some cases we want to index dev releases, but Parse::PMFile seems quite permissive, unless I misunderstand how it&#39;s supposed to work, which is entirely possible.  ;&#41;

Olaf
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1488130" href="/Public/Bug/Display.html?id=103833#txn-1488130">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;20&nbsp;07:19:01&nbsp;2015</span>
    <span class="description">ishigaki [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1488130/792509/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/792509">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Apr 20 18:11:40 2015, OALDERS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt; 
&gt; Thanks for all of your work on this.  :&#41;
&gt; 
&gt; I&#39;m a bit unclear as to what constitutes a dev release.
&gt; 
&gt; It appears that the only time that the version numbers are checked for
&gt; underscores is at:
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/ISHIGAKI/Parse-PMFile-">https://metacpan.org/source/ISHIGAKI/Parse-PMFile-</a></span>
&gt; 0.36/lib/Parse/PMFile.pm#L44
&gt; 
&gt; This condition is never checked if there&#39;s a valid META file
&gt; containing provides.  This means that if the META file contains a
&gt; provides, it won&#39;t skip any versions with underscores, even if the
&gt; provides actually does have the underscore.
&gt; 
&gt; Also, I wonder if it should parse anything at all if the entire
&gt; version is flagged as TRIAL, like in this case
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/RIBASUSHI/DBIx-Class-">https://metacpan.org/source/RIBASUSHI/DBIx-Class-</a></span>
&gt; 0.082899_14/META.yml#L71
&gt; 
&gt; I just ran up against this while trying to write some tests for
&gt; OrePAN2.  In some cases we want to index dev releases, but
&gt; Parse::PMFile seems quite permissive, unless I misunderstand how it&#39;s
&gt; supposed to work, which is entirely possible.  ;&#41;
&gt; 
&gt; Olaf
</div>
Hi.

As the name &#40;::PMFile&#41; suggests, this module is to parse and extract a VERSION in a specific .pm file. So, you can use this to look for versions in a distribution, but this doesn&#39;t know &#40;and care&#41; anything about a version of a distribution by itself -- namely, it doesn&#39;t care if a distribution has -TRIAL in its name, and it doesn&#39;t try to parse a .pm file if a given META file has a provides field &#40;it just trusts you&#39;ve done the right thing&#41;. Also, it doesn&#39;t respect file/directory fields in no_index in META though it does respect package/namespace fields &#40;because the formers are for a distribution, and the latters are relevant to each .pm file&#41;.

You might also want to look at Parse::LocalDistribution. Though it&#39;s not for an archived distribution &#40;so it doesn&#39;t still care about -TRIAL&#41;, it does treat versions in an extracted distribution more correctly -- or more predictable. 

Hope this helps.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1488131" href="/Public/Bug/Display.html?id=103833#txn-1488131">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;20&nbsp;07:19:02&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1488479" href="/Public/Bug/Display.html?id=103833#txn-1488479">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;21&nbsp;11:51:31&nbsp;2015</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1488479/792707/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/792707">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 335b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Just FYI -- I plan to add an is_trial interface to Module::Metadata &#34;at some point&#34; -- at least before MMD is added to PAUSE&#39;s code. It will understand _ versions as well as detect the common # TRIAL comment that appears in distributions that just set release_status in meta and use -TRIAL tarball names &#40;e.g. Dist::Zilla-based dists&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1489132" href="/Public/Bug/Display.html?id=103833#txn-1489132">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;22&nbsp;21:29:50&nbsp;2015</span>
    <span class="description">olaf [...] wundersolutions.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1489132/793047/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/793047">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Apr 20 07:19:01 2015, ISHIGAKI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Apr 20 18:11:40 2015, OALDERS wrote:
<div class="message-stanza open">&gt; &gt; Hi,
&gt; &gt;
&gt; &gt; Thanks for all of your work on this.  :&#41;
&gt; &gt;
&gt; &gt; I&#39;m a bit unclear as to what constitutes a dev release.
&gt; &gt;
&gt; &gt; It appears that the only time that the version numbers are checked
&gt; &gt; for
&gt; &gt; underscores is at:
&gt; &gt;
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/ISHIGAKI/Parse-PMFile-">https://metacpan.org/source/ISHIGAKI/Parse-PMFile-</a></span>
&gt; &gt; 0.36/lib/Parse/PMFile.pm#L44
&gt; &gt;
&gt; &gt; This condition is never checked if there&#39;s a valid META file
&gt; &gt; containing provides.  This means that if the META file contains a
&gt; &gt; provides, it won&#39;t skip any versions with underscores, even if the
&gt; &gt; provides actually does have the underscore.
&gt; &gt;
&gt; &gt; Also, I wonder if it should parse anything at all if the entire
&gt; &gt; version is flagged as TRIAL, like in this case
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/RIBASUSHI/DBIx-Class-">https://metacpan.org/source/RIBASUSHI/DBIx-Class-</a></span>
&gt; &gt; 0.082899_14/META.yml#L71
&gt; &gt;
&gt; &gt; I just ran up against this while trying to write some tests for
&gt; &gt; OrePAN2.  In some cases we want to index dev releases, but
&gt; &gt; Parse::PMFile seems quite permissive, unless I misunderstand how it&#39;s
&gt; &gt; supposed to work, which is entirely possible.  ;&#41;
&gt; &gt;
&gt; &gt; Olaf
</div>&gt; 
&gt; Hi.
&gt; 
&gt; As the name &#40;::PMFile&#41; suggests, this module is to parse and extract a
&gt; VERSION in a specific .pm file. So, you can use this to look for
&gt; versions in a distribution, but this doesn&#39;t know &#40;and care&#41; anything
&gt; about a version of a distribution by itself -- namely, it doesn&#39;t care
&gt; if a distribution has -TRIAL in its name, and it doesn&#39;t try to parse
&gt; a .pm file if a given META file has a provides field &#40;it just trusts
&gt; you&#39;ve done the right thing&#41;. Also, it doesn&#39;t respect file/directory
&gt; fields in no_index in META though it does respect package/namespace
&gt; fields &#40;because the formers are for a distribution, and the latters
&gt; are relevant to each .pm file&#41;.
&gt; 
&gt; You might also want to look at Parse::LocalDistribution. Though it&#39;s
&gt; not for an archived distribution &#40;so it doesn&#39;t still care about
&gt; -TRIAL&#41;, it does treat versions in an extracted distribution more
&gt; correctly -- or more predictable.
&gt; 
&gt; Hope this helps.
</div>
Thanks for this.  My use case is actually OrePAN2 which is using Parse::LocalDistribution.  &#40;Let&#39;s just take the -TRIAL bit off the table -- that&#39;s likely muddying the waters here&#41;.

The problem &#40;as I see it&#41; is the second case I&#39;ve described in this comment:

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/tokuhirom/OrePAN2/pull/36#issuecomment-95380071">https://github.com/tokuhirom/OrePAN2/pull/36#issuecomment-95380071</a></span>

If I index a file using Parse::LocalDistribution and don&#39;t explicitly allow dev releases, in the case of DBIx::Class I get a list of modules -- but just not DBIx::Class itself.  So, it seems to think that just the top level namespace contains the developer release.

The behaviour itself seems confusing to me.  I think we&#39;re going to work around this in OrePAN2 &#40;hopefully as I&#39;ve proposed&#41;.  Probably this could become somewhat clearer by having 1 standard way of declaring a dev release, but as it stands I&#39;m not sure how helpful the dev checking is in Parse::PMFile.  If it&#39;s checking for underscores in module versions, it could also do that when getting the names and versions via provides.

Anyway, I&#39;m not actually asking for a fix here because we&#39;ll work around it, but I at least wanted to point out that I think there are cases which aren&#39;t being caught.  :&#41;

BTW, I hope you had a good flight home from Berlin!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1489134" href="/Public/Bug/Display.html?id=103833#txn-1489134">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;22&nbsp;21:30:19&nbsp;2015</span>
    <span class="description">olaf [...] wundersolutions.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1489134/793049/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/793049">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 441b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Apr 21 11:51:31 2015, ETHER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Just FYI -- I plan to add an is_trial interface to Module::Metadata
&gt; &#34;at some point&#34; -- at least before MMD is added to PAUSE&#39;s code. It
&gt; will understand _ versions as well as detect the common # TRIAL
&gt; comment that appears in distributions that just set release_status in
&gt; meta and use -TRIAL tarball names &#40;e.g. Dist::Zilla-based dists&#41;.
</div>
Thanks, ETHER.  That will be a helpful addition.  :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1489160" href="/Public/Bug/Display.html?id=103833#txn-1489160">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;23&nbsp;01:41:12&nbsp;2015</span>
    <span class="description">ishigaki [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1489160/793056/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/793056">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 6.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Apr 23 10:29:50 2015, OALDERS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Apr 20 07:19:01 2015, ISHIGAKI wrote:
<div class="message-stanza open">&gt; &gt; On Mon Apr 20 18:11:40 2015, OALDERS wrote:
<div class="message-stanza open">&gt; &gt; &gt; Hi,
&gt; &gt; &gt;
&gt; &gt; &gt; Thanks for all of your work on this.  :&#41;
&gt; &gt; &gt;
&gt; &gt; &gt; I&#39;m a bit unclear as to what constitutes a dev release.
&gt; &gt; &gt;
&gt; &gt; &gt; It appears that the only time that the version numbers are checked
&gt; &gt; &gt; for
&gt; &gt; &gt; underscores is at:
&gt; &gt; &gt;
&gt; &gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/ISHIGAKI/Parse-PMFile-">https://metacpan.org/source/ISHIGAKI/Parse-PMFile-</a></span>
&gt; &gt; &gt; 0.36/lib/Parse/PMFile.pm#L44
&gt; &gt; &gt;
&gt; &gt; &gt; This condition is never checked if there&#39;s a valid META file
&gt; &gt; &gt; containing provides.  This means that if the META file contains a
&gt; &gt; &gt; provides, it won&#39;t skip any versions with underscores, even if the
&gt; &gt; &gt; provides actually does have the underscore.
&gt; &gt; &gt;
&gt; &gt; &gt; Also, I wonder if it should parse anything at all if the entire
&gt; &gt; &gt; version is flagged as TRIAL, like in this case
&gt; &gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/RIBASUSHI/DBIx-Class-">https://metacpan.org/source/RIBASUSHI/DBIx-Class-</a></span>
&gt; &gt; &gt; 0.082899_14/META.yml#L71
&gt; &gt; &gt;
&gt; &gt; &gt; I just ran up against this while trying to write some tests for
&gt; &gt; &gt; OrePAN2.  In some cases we want to index dev releases, but
&gt; &gt; &gt; Parse::PMFile seems quite permissive, unless I misunderstand how
&gt; &gt; &gt; it&#39;s
&gt; &gt; &gt; supposed to work, which is entirely possible.  ;&#41;
&gt; &gt; &gt;
&gt; &gt; &gt; Olaf
</div>&gt; &gt;
&gt; &gt; Hi.
&gt; &gt;
&gt; &gt; As the name &#40;::PMFile&#41; suggests, this module is to parse and extract
&gt; &gt; a
&gt; &gt; VERSION in a specific .pm file. So, you can use this to look for
&gt; &gt; versions in a distribution, but this doesn&#39;t know &#40;and care&#41; anything
&gt; &gt; about a version of a distribution by itself -- namely, it doesn&#39;t
&gt; &gt; care
&gt; &gt; if a distribution has -TRIAL in its name, and it doesn&#39;t try to parse
&gt; &gt; a .pm file if a given META file has a provides field &#40;it just trusts
&gt; &gt; you&#39;ve done the right thing&#41;. Also, it doesn&#39;t respect file/directory
&gt; &gt; fields in no_index in META though it does respect package/namespace
&gt; &gt; fields &#40;because the formers are for a distribution, and the latters
&gt; &gt; are relevant to each .pm file&#41;.
&gt; &gt;
&gt; &gt; You might also want to look at Parse::LocalDistribution. Though it&#39;s
&gt; &gt; not for an archived distribution &#40;so it doesn&#39;t still care about
&gt; &gt; -TRIAL&#41;, it does treat versions in an extracted distribution more
&gt; &gt; correctly -- or more predictable.
&gt; &gt;
&gt; &gt; Hope this helps.
</div>&gt; 
&gt; Thanks for this.  My use case is actually OrePAN2 which is using
&gt; Parse::LocalDistribution.  &#40;Let&#39;s just take the -TRIAL bit off the
&gt; table -- that&#39;s likely muddying the waters here&#41;.
&gt; 
&gt; The problem &#40;as I see it&#41; is the second case I&#39;ve described in this
&gt; comment:
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/tokuhirom/OrePAN2/pull/36#issuecomment-95380071">https://github.com/tokuhirom/OrePAN2/pull/36#issuecomment-95380071</a></span>
&gt; 
&gt; If I index a file using Parse::LocalDistribution and don&#39;t explicitly
&gt; allow dev releases, in the case of DBIx::Class I get a list of modules
&gt; -- but just not DBIx::Class itself.  So, it seems to think that just
&gt; the top level namespace contains the developer release.
&gt; 
&gt; The behaviour itself seems confusing to me.  I think we&#39;re going to
&gt; work around this in OrePAN2 &#40;hopefully as I&#39;ve proposed&#41;.  Probably
&gt; this could become somewhat clearer by having 1 standard way of
&gt; declaring a dev release, but as it stands I&#39;m not sure how helpful the
&gt; dev checking is in Parse::PMFile.  If it&#39;s checking for underscores in
&gt; module versions, it could also do that when getting the names and
&gt; versions via provides.
</div>
Well, I&#39;m not sure what actually confuses you, but let&#39;s see the code of PAUSE a bit.

First of all, PAUSE ignores developer releases and just skips without parsing anything in those releases.

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/andk/pause/blob/master/lib/PAUSE/dist.pm#L296">https://github.com/andk/pause/blob/master/lib/PAUSE/dist.pm#L296</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/andk/pause/blob/master/lib/PAUSE/mldistwatch.pm#L416">https://github.com/andk/pause/blob/master/lib/PAUSE/mldistwatch.pm#L416</a></span>

In other words, PAUSE assumes a distribution it actually parses is not a dev release. &#40;So do Parse::PMFile/LocalDistribution, unless you explicitly specify otherwise. If this is what confused you, or what you considered not covered, I should improve docs in Parse::PMFile/LocalDistribution and/or OrePAN.&#41;

Now let&#39;s consider PAUSE starts processing. It looks for a valid META data, and if it finds that, it trusts that data without further parsing. Otherwise, it tries to parse VERSIONs in files, and while parsing, it also ignores packages with a version that contains an underscore &#40;in a non-dev distribution, to get rid of dev versions from PAUSE indices entirely&#41;.

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/andk/pause/blob/master/lib/PAUSE/pmfile.pm#L279">https://github.com/andk/pause/blob/master/lib/PAUSE/pmfile.pm#L279</a></span>

In the case of DBIx-Class-0.082899_14 &#40;which doesn&#39;t have a &#34;provides&#34; field in its META files&#41;, if PAUSE didn&#39;t have the first dist version check &#40;or if you just pass that distribution to Parse::LocalDistribution without allowing dev versions&#41;, it would actually parse files and ignore the DBIx::Class package because its version contains an underscore &#40;not because it&#39;s a main module in the distribution which in fact is a developer release, etc&#41;, and also it would index SQL::Translator stuff because they have valid versions and PAUSE &#40;and Parse::LocalDistribution&#41; doesn&#39;t care if a package in a distribution has the same namespace as the main namespace or not, as long as the namespace is valid and the uploader has a proper permission for that.

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/andk/pause/blob/master/lib/PAUSE/pmfile.pm#L242">https://github.com/andk/pause/blob/master/lib/PAUSE/pmfile.pm#L242</a></span>

That being said, there are cases when we want to do something different from what PAUSE does. Thus Parse::PMFile/LocalDistribution have an option not to ignore dev versions.

To summarize,

1&#41; Pass a non-dev local distribution to Parse::LocalDistribution without allowing dev release -- ok, that should be &#40;almost&#41; the same as what PAUSE does.

2&#41; Pass a non-dev local distribution to Parse::LocalDistribution with allowing dev release -- probably ok, though if the distribution has a pmfile that has a underscored version &#40;which should be rare&#41;, it&#39;s also listed/indexed contrary to what PAUSE does.

3&#41; Pass a dev local distribution to Parse::LocalDistribution without allowing dev release -- bad assumption, confusing results where the main package &#40;and possibly other packages with the same version&#41; are not listed/indexed.

4&#41; Pass a dev local distribution to Parse::LocalDistribution with allowing dev release -- probably ok, everything should be listed/indexed including dev versions.

Have I made myself clear?


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Anyway, I&#39;m not actually asking for a fix here because we&#39;ll work
&gt; around it, but I at least wanted to point out that I think there are
&gt; cases which aren&#39;t being caught.  :&#41;
&gt; 
&gt; BTW, I hope you had a good flight home from Berlin!
</div>

BTW. Thanks, the flight was pretty good :&#41;
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.405058</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
