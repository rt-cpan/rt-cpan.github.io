<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #113635 for ExtUtils-HasCompiler: Fails tests on perls which *can* build XS</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #113635 for ExtUtils-HasCompiler: Fails tests on perls which *can* build XS</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/ExtUtils-HasCompiler/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/ExtUtils-HasCompiler/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/ExtUtils-HasCompiler/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/ExtUtils-HasCompiler/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/ExtUtils-HasCompiler">ExtUtils-HasCompiler CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">113635</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/ExtUtils-HasCompiler/Active/">ExtUtils-HasCompiler</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ribasushi [...] leporine.io

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-259874-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-259875-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.013    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;09&nbsp;22:47:50&nbsp;2016</span>
    <span class="description">ribasushi [...] leporine.io -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Fails tests on perls which *can* build XS</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Attaching a full session log, let me know if you need something extra.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> euhc_argh.txt</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">rabbit@Ahasver:~$ cpanm --look ExtUtils::HasCompiler
--&gt; Working on ExtUtils::HasCompiler
Fetching <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpan.org/authors/id/L/LE/LEONT/ExtUtils-HasCompiler-0.012.tar.gz">http://www.cpan.org/authors/id/L/LE/LEONT/ExtUtils-HasCompiler-0.012.tar.gz</a></span> ... OK
Entering /home/rabbit/.cpanm/work/1460256150.28104/ExtUtils-HasCompiler-0.012 with /bin/bash



rabbit@Ahasver:~/.cpanm/work/1460256150.28104/ExtUtils-HasCompiler-0.012$ perlbrew use 5.10.0



rabbit@Ahasver:~/.cpanm/work/1460256150.28104/ExtUtils-HasCompiler-0.012$ perl -V
Summary of my perl5 &#40;revision 5 version 10 subversion 0&#41; configuration:
  Platform:
    osname=linux, osvers=2.6.37-2-amd64, archname=x86_64-linux-thread-multi
    uname=&#39;linux ahasver 2.6.37-2-amd64 #1 smp sun feb 27 10:12:22 utc 2011 x86_64 gnulinux &#39;
    config_args=&#39;-de -Dprefix=/home/rabbit/perl5/perlbrew/perls/5.10.0 -Dusethreads&#39;
    hint=recommended, useposix=true, d_sigaction=define
    useithreads=define, usemultiplicity=define
    useperlio=define, d_sfio=undef, uselargefiles=define, usesocks=undef
    use64bitint=define, use64bitall=define, uselongdouble=undef
    usemymalloc=n, bincompat5005=undef
  Compiler:
    cc=&#39;cc&#39;, ccflags =&#39;-D_REENTRANT -D_GNU_SOURCE -fno-strict-aliasing -pipe -I/usr/local/include -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64&#39;,
    optimize=&#39;-O2&#39;,
    cppflags=&#39;-D_REENTRANT -D_GNU_SOURCE -fno-strict-aliasing -pipe -I/usr/local/include&#39;
    ccversion=&#39;&#39;, gccversion=&#39;4.4.5&#39;, gccosandvers=&#39;&#39;
    intsize=4, longsize=8, ptrsize=8, doublesize=8, byteorder=12345678
    d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=16
    ivtype=&#39;long&#39;, ivsize=8, nvtype=&#39;double&#39;, nvsize=8, Off_t=&#39;off_t&#39;, lseeksize=8
    alignbytes=8, prototype=define
  Linker and Libraries:
    ld=&#39;cc&#39;, ldflags =&#39; -L/usr/local/lib&#39;
    libpth=/usr/local/lib /lib/../lib /usr/lib/../lib /lib /usr/lib /lib64 /usr/lib64
    libs=-lnsl -lgdbm -ldb -ldl -lm -lcrypt -lutil -lpthread -lc -lgdbm_compat
    perllibs=-lnsl -ldl -lm -lcrypt -lutil -lpthread -lc -lgdbm_compat
    libc=/lib/libc-2.11.2.so, so=so, useshrplib=false, libperl=libperl.a
    gnulibc_version=&#39;2.11.2&#39;
  Dynamic Linking:
    dlsrc=dl_dlopen.xs, dlext=so, d_dlsymun=undef, ccdlflags=&#39;-Wl,-E&#39;
    cccdlflags=&#39;-fPIC&#39;, lddlflags=&#39;-shared -O2 -L/usr/local/lib&#39;


Characteristics of this binary &#40;from libperl&#41;: 
  Compile-time options: MULTIPLICITY PERL_DONT_CREATE_GVSV
                        PERL_IMPLICIT_CONTEXT PERL_MALLOC_WRAP USE_64_BIT_ALL
                        USE_64_BIT_INT USE_ITHREADS USE_LARGE_FILES
                        USE_PERLIO USE_REENTRANT_API
  Built under linux
  Compiled at Aug 23 2011 06:06:48
  %ENV:
    PERLBREW_BASHRC_VERSION=&#34;0.67&#34;
    PERLBREW_HOME=&#34;/home/rabbit/.perlbrew&#34;
    PERLBREW_MANPATH=&#34;/home/rabbit/perl5/perlbrew/perls/5.10.0/man&#34;
    PERLBREW_PATH=&#34;/home/rabbit/perl5/perlbrew/bin:/home/rabbit/perl5/perlbrew/perls/5.10.0/bin&#34;
    PERLBREW_PERL=&#34;5.10.0&#34;
    PERLBREW_ROOT=&#34;/home/rabbit/perl5/perlbrew&#34;
    PERLBREW_VERSION=&#34;0.67&#34;
    PERL_AUTOINSTALL_PREFER_CPAN=&#34;1&#34;
  @INC:
    /home/rabbit/perl5/perlbrew/perls/5.10.0/lib/5.10.0/x86_64-linux-thread-multi
    /home/rabbit/perl5/perlbrew/perls/5.10.0/lib/5.10.0
    /home/rabbit/perl5/perlbrew/perls/5.10.0/lib/site_perl/5.10.0/x86_64-linux-thread-multi
    /home/rabbit/perl5/perlbrew/perls/5.10.0/lib/site_perl/5.10.0
    .



rabbit@Ahasver:~/.cpanm/work/1460256150.28104/ExtUtils-HasCompiler-0.012$ perl Makefile.PL 
Checking if your kit is complete...
Looks good
Writing Makefile for ExtUtils::HasCompiler
Writing MYMETA.yml and MYMETA.json



rabbit@Ahasver:~/.cpanm/work/1460256150.28104/ExtUtils-HasCompiler-0.012$ make test
cp lib/ExtUtils/HasCompiler.pm blib/lib/ExtUtils/HasCompiler.pm
PERL_DL_NONLAZY=1 /home/rabbit/perl5/perlbrew/perls/5.10.0/bin/perl &#34;-MExtUtils::Command::MM&#34; &#34;-e&#34; &#34;test_harness&#40;0, &#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/*.t
t/compare.t .. /usr/bin/ld: cannot find -lgdbm_compat
collect2: error: ld returned 1 exit status
t/compare.t .. 1/1 
#   Failed test &#39;Have a C compiler if CBuilder agrees&#39;
#   at t/compare.t line 13.
#          got: undef
#     expected: &#39;1&#39;
# Couldn&#39;t execute cc -O2 /tmp/F6fhfMILE0/Fgf0phr0Ys.o -o /tmp/F6fhfMILE0/Fgf0phr0Ys.so -shared -O2 -L/usr/local/lib  -lnsl -ldl -lm -lcrypt -lutil -lpthread -lc -lgdbm_compat: Inappropriate ioctl for device at t/compare.t line 13.
# Looks like you failed 1 test of 1.
t/compare.t .. Dubious, test returned 1 &#40;wstat 256, 0x100&#41;
Failed 1/1 subtests 

Test Summary Report
-------------------
t/compare.t &#40;Wstat: 256 Tests: 1 Failed: 1&#41;
  Failed test:  1
  Non-zero exit status: 1
Files=1, Tests=1,  1 wallclock secs &#40; 0.02 usr  0.00 sys +  0.27 cusr  0.05 csys =  0.34 CPU&#41;
Result: FAIL
Failed 1/1 test programs. 1/1 subtests failed.
Makefile:851: recipe for target &#39;test_dynamic&#39; failed
make: *** [test_dynamic] Error 1




rabbit@Ahasver:~/.cpanm/work/1460256150.28104/ExtUtils-HasCompiler-0.012$ cpanm -v --reinstall Devel::GlobalDestruction::XS
cpanm &#40;App::cpanminus&#41; 1.7039 on perl 5.010000 built for x86_64-linux-thread-multi
Work directory is /home/rabbit/.cpanm/work/1460256291.28595
You have make /usr/bin/make
You have LWP 6.05
You have /bin/tar: tar &#40;GNU tar&#41; 1.27.1
Copyright &#40;C&#41; 2013 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://gnu.org/licenses/gpl.html">http://gnu.org/licenses/gpl.html</a></span>&gt;.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Written by John Gilmore and Jay Fenlason.
You have /usr/bin/unzip
Searching Devel::GlobalDestruction::XS &#40;&#41; on cpanmetadb ...
--&gt; Working on Devel::GlobalDestruction::XS
Fetching <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpan.org/authors/id/H/HA/HAARG/Devel-GlobalDestruction-XS-0.02.tar.gz">http://www.cpan.org/authors/id/H/HA/HAARG/Devel-GlobalDestruction-XS-0.02.tar.gz</a></span> ... OK
Unpacking Devel-GlobalDestruction-XS-0.02.tar.gz
Devel-GlobalDestruction-XS-0.02/
Devel-GlobalDestruction-XS-0.02/Changes
Devel-GlobalDestruction-XS-0.02/lib/
Devel-GlobalDestruction-XS-0.02/maint/
Devel-GlobalDestruction-XS-0.02/Makefile.PL
Devel-GlobalDestruction-XS-0.02/MANIFEST
Devel-GlobalDestruction-XS-0.02/META.json
Devel-GlobalDestruction-XS-0.02/META.yml
Devel-GlobalDestruction-XS-0.02/ppport.h
Devel-GlobalDestruction-XS-0.02/README
Devel-GlobalDestruction-XS-0.02/t/
Devel-GlobalDestruction-XS-0.02/XS.xs
Devel-GlobalDestruction-XS-0.02/xt/
Devel-GlobalDestruction-XS-0.02/xt/pod.t
Devel-GlobalDestruction-XS-0.02/t/01_basic.t
Devel-GlobalDestruction-XS-0.02/t/02_thread.t
Devel-GlobalDestruction-XS-0.02/t/03_minusc.t
Devel-GlobalDestruction-XS-0.02/t/04_phases.t
Devel-GlobalDestruction-XS-0.02/t/05_thread_clone.t
Devel-GlobalDestruction-XS-0.02/maint/Makefile.PL.include
Devel-GlobalDestruction-XS-0.02/lib/Devel/
Devel-GlobalDestruction-XS-0.02/lib/Devel/GlobalDestruction/
Devel-GlobalDestruction-XS-0.02/lib/Devel/GlobalDestruction/XS.pm
Entering Devel-GlobalDestruction-XS-0.02
Checking configure dependencies from META.json
Running Makefile.PL
Configuring Devel-GlobalDestruction-XS-0.02 ... Checking if your kit is complete...
Looks good
Writing Makefile for Devel::GlobalDestruction::XS
Writing MYMETA.yml and MYMETA.json
OK
Checking dependencies from MYMETA.json ...
Building and testing Devel-GlobalDestruction-XS-0.02 ... cp lib/Devel/GlobalDestruction/XS.pm blib/lib/Devel/GlobalDestruction/XS.pm
/home/rabbit/perl5/perlbrew/perls/5.10.0/bin/perl /home/rabbit/perl5/perlbrew/perls/5.10.0/lib/5.10.0/ExtUtils/xsubpp  -typemap /home/rabbit/perl5/perlbrew/perls/5.10.0/lib/5.10.0/ExtUtils/typemap  XS.xs &gt; XS.xsc &#38;&#38; mv XS.xsc XS.c
cc -c   -D_REENTRANT -D_GNU_SOURCE -fno-strict-aliasing -pipe -I/usr/local/include -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -O2   -DVERSION=\&#34;0.02\&#34; -DXS_VERSION=\&#34;0.02\&#34; -fPIC &#34;-I/home/rabbit/perl5/perlbrew/perls/5.10.0/lib/5.10.0/x86_64-linux-thread-multi/CORE&#34;   XS.c
Running Mkbootstrap for Devel::GlobalDestruction::XS &#40;&#41;
chmod 644 XS.bs
rm -f blib/arch/auto/Devel/GlobalDestruction/XS/XS.so
cc  -shared -O2 -L/usr/local/lib XS.o  -o blib/arch/auto/Devel/GlobalDestruction/XS/XS.so 	\
     	\
  
chmod 755 blib/arch/auto/Devel/GlobalDestruction/XS/XS.so
cp XS.bs blib/arch/auto/Devel/GlobalDestruction/XS/XS.bs
chmod 644 blib/arch/auto/Devel/GlobalDestruction/XS/XS.bs
Manifying blib/man3/Devel::GlobalDestruction::XS.3
PERL_DL_NONLAZY=1 /home/rabbit/perl5/perlbrew/perls/5.10.0/bin/perl &#34;-MExtUtils::Command::MM&#34; &#34;-e&#34; &#34;test_harness&#40;0, &#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/*.t
t/01_basic.t ......... ok   
t/02_thread.t ........ ok   
t/03_minusc.t ........ 1/3 t/03_minusc.t syntax OK
t/03_minusc.t ........ ok   
t/04_phases.t ........ ok     
t/05_thread_clone.t .. ok   
All tests successful.
Files=5, Tests=33,  0 wallclock secs &#40; 0.04 usr  0.01 sys +  0.06 cusr  0.00 csys =  0.11 CPU&#41;
Result: PASS
Files found in blib/arch: installing files in blib/lib into architecture dependent library tree
Installing /home/rabbit/perl5/perlbrew/perls/5.10.0/lib/site_perl/5.10.0/x86_64-linux-thread-multi/auto/Devel/GlobalDestruction/XS/XS.so
Installing /home/rabbit/perl5/perlbrew/perls/5.10.0/lib/site_perl/5.10.0/x86_64-linux-thread-multi/Devel/GlobalDestruction/XS.pm
Installing /home/rabbit/perl5/perlbrew/perls/5.10.0/man/man3/Devel::GlobalDestruction::XS.3
Appending installation info to /home/rabbit/perl5/perlbrew/perls/5.10.0/lib/5.10.0/x86_64-linux-thread-multi/perllocal.pod
OK
Successfully installed Devel-GlobalDestruction-XS-0.02 &#40;upgraded from 0.01&#41;
Installing /home/rabbit/perl5/perlbrew/perls/5.10.0/lib/site_perl/5.10.0/x86_64-linux-thread-multi/.meta/Devel-GlobalDestruction-XS-0.02/install.json
Installing /home/rabbit/perl5/perlbrew/perls/5.10.0/lib/site_perl/5.10.0/x86_64-linux-thread-multi/.meta/Devel-GlobalDestruction-XS-0.02/MYMETA.json
1 distribution installed
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;09&nbsp;22:55:49&nbsp;2016</span>
    <span class="description">ribasushi [...] leporine.io -  Dependency by ticket #113636 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;09&nbsp;22:55:49&nbsp;2016</span>
    <span class="description">ribasushi [...] leporine.io -  Dependency by ticket #113637 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;10&nbsp;04:43:29&nbsp;2016</span>
    <span class="description">haarg [...] haarg.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I haven&#39;t been able to reproduce this on the systems I have available.  What type of system have you seen this on?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;10&nbsp;04:43:29&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;10&nbsp;05:13:43&nbsp;2016</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Apr 10 10:43:29 2016, haarg wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I haven&#39;t been able to reproduce this on the systems I have available.
&gt; What type of system have you seen this on?
</div>

This is my day-to-day working box, from which I am writing this reply. Think &#34;perlbrew from ages ago, with the underlying OS moving ahead underneath it&#34;.

Investigated a bit more on a hunch: I had a libgdbm-dev at the time perl was built, but not anymore. Attached is a new &#40;smaller&#41; session log showcasing the problem.

Note - while I recognize the &#34;wtf&#34; moment in the entire thing, keep in mind that I didn&#39;t do anything special to arrive at this &#34;broken system&#34;: it&#39;s just how it came to be in the ~4 years since it was first installed. In other words - this is not an outlandish scenario.

As a bonus point EU::CB does not get tripped by this
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> euhc_argh2.txt</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">rabbit@Ahasver:~$ cpanm --look ExtUtils::HasCompiler
--&gt; Working on ExtUtils::HasCompiler
Fetching <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpan.org/authors/id/L/LE/LEONT/ExtUtils-HasCompiler-0.012.tar.gz">http://www.cpan.org/authors/id/L/LE/LEONT/ExtUtils-HasCompiler-0.012.tar.gz</a></span> ... OK
Entering /home/rabbit/.cpanm/work/1460279136.12370/ExtUtils-HasCompiler-0.012 with /bin/bash




rabbit@Ahasver:~/.cpanm/work/1460279136.12370/ExtUtils-HasCompiler-0.012$ perlbrew use 5.10.0




rabbit@Ahasver:~/.cpanm/work/1460279136.12370/ExtUtils-HasCompiler-0.012$ sudo apt-get install libgdbm-dev 
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following NEW packages will be installed:
  libgdbm-dev
0 upgraded, 1 newly installed, 0 to remove and 197 not upgraded.
Need to get 48.8 kB of archives.
After this operation, 167 kB of additional disk space will be used.
Get:1 <span class="clickylink"><a target="new" rel="nofollow" href="http://ftp.us.debian.org/debian/">http://ftp.us.debian.org/debian/</a></span> sid/main libgdbm-dev amd64 1.8.3-13.1 [48.8 kB]
Fetched 48.8 kB in 0s &#40;54.1 kB/s&#41;  
Selecting previously unselected package libgdbm-dev.
&#40;Reading database ... 114997 files and directories currently installed.&#41;
Preparing to unpack .../libgdbm-dev_1.8.3-13.1_amd64.deb ...
Unpacking libgdbm-dev &#40;1.8.3-13.1&#41; ...
Processing triggers for man-db &#40;2.7.0.2-5&#41; ...
Processing triggers for install-info &#40;5.2.0.dfsg.1-6&#41; ...
Setting up libgdbm-dev &#40;1.8.3-13.1&#41; ...




rabbit@Ahasver:~/.cpanm/work/1460279136.12370/ExtUtils-HasCompiler-0.012$ perl Makefile.PL 
Writing Makefile for ExtUtils::HasCompiler
Writing MYMETA.yml and MYMETA.json




rabbit@Ahasver:~/.cpanm/work/1460279136.12370/ExtUtils-HasCompiler-0.012$ make test
PERL_DL_NONLAZY=1 /home/rabbit/perl5/perlbrew/perls/5.16.2/bin/perl &#34;-MExtUtils::Command::MM&#34; &#34;-MTest::Harness&#34; &#34;-e&#34; &#34;undef *Test::Harness::Switches; test_harness&#40;0, &#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/*.t
t/compare.t .. ok   
All tests successful.
Files=1, Tests=1,  1 wallclock secs &#40; 0.02 usr  0.01 sys +  0.32 cusr  0.09 csys =  0.44 CPU&#41;
Result: PASS




rabbit@Ahasver:~/.cpanm/work/1460279136.12370/ExtUtils-HasCompiler-0.012$ sudo apt-get remove --purge libgdbm-dev
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following packages will be REMOVED:
  libgdbm-dev*
0 upgraded, 0 newly installed, 1 to remove and 197 not upgraded.
After this operation, 167 kB disk space will be freed.
Do you want to continue? [Y/n] 
&#40;Reading database ... 115046 files and directories currently installed.&#41;
Removing libgdbm-dev &#40;1.8.3-13.1&#41; ...
Processing triggers for man-db &#40;2.7.0.2-5&#41; ...
Processing triggers for install-info &#40;5.2.0.dfsg.1-6&#41; ...




rabbit@Ahasver:~/.cpanm/work/1460279136.12370/ExtUtils-HasCompiler-0.012$ make test
PERL_DL_NONLAZY=1 /home/rabbit/perl5/perlbrew/perls/5.16.2/bin/perl &#34;-MExtUtils::Command::MM&#34; &#34;-MTest::Harness&#34; &#34;-e&#34; &#34;undef *Test::Harness::Switches; test_harness&#40;0, &#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/*.t
t/compare.t .. ok   
All tests successful.
Files=1, Tests=1,  1 wallclock secs &#40; 0.03 usr  0.00 sys +  0.38 cusr  0.06 csys =  0.47 CPU&#41;
Result: PASS




rabbit@Ahasver:~/.cpanm/work/1460279136.12370/ExtUtils-HasCompiler-0.012$ perl Makefile.PL 
Writing Makefile for ExtUtils::HasCompiler
Writing MYMETA.yml and MYMETA.json




rabbit@Ahasver:~/.cpanm/work/1460279136.12370/ExtUtils-HasCompiler-0.012$ make test
Skip blib/lib/ExtUtils/HasCompiler.pm &#40;unchanged&#41;
PERL_DL_NONLAZY=1 /home/rabbit/perl5/perlbrew/perls/5.10.0/bin/perl &#34;-MExtUtils::Command::MM&#34; &#34;-e&#34; &#34;test_harness&#40;0, &#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/*.t
t/compare.t .. /usr/bin/ld: cannot find -lgdbm_compat
collect2: error: ld returned 1 exit status
t/compare.t .. 1/1 
#   Failed test &#39;Have a C compiler if CBuilder agrees&#39;
#   at t/compare.t line 13.
#          got: undef
#     expected: &#39;1&#39;
# Couldn&#39;t execute cc -O2 /tmp/BvdmvpOadT/XVVPN7vSw7.o -o /tmp/BvdmvpOadT/XVVPN7vSw7.so -shared -O2 -L/usr/local/lib  -lnsl -ldl -lm -lcrypt -lutil -lpthread -lc -lgdbm_compat: Inappropriate ioctl for device at t/compare.t line 13.
# Looks like you failed 1 test of 1.
t/compare.t .. Dubious, test returned 1 &#40;wstat 256, 0x100&#41;
Failed 1/1 subtests 

Test Summary Report
-------------------
t/compare.t &#40;Wstat: 256 Tests: 1 Failed: 1&#41;
  Failed test:  1
  Non-zero exit status: 1
Files=1, Tests=1,  1 wallclock secs &#40; 0.03 usr  0.00 sys +  0.26 cusr  0.04 csys =  0.33 CPU&#41;
Result: FAIL
Failed 1/1 test programs. 1/1 subtests failed.
Makefile:851: recipe for target &#39;test_dynamic&#39; failed
make: *** [test_dynamic] Error 1
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;10&nbsp;06:44:29&nbsp;2016</span>
    <span class="description">KENTNL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza"><p>
	Its worth mentioning that this sort of issue can happen every day on Gentoo.</p>

<p>
	It doesn&#39;t happen too frequently, but we see it in a few places.</p>

<p>
	1. End users are building their system perl with system dependencies</p>

<p>
	2. We try to manage things, but Perl has an &quot;automatically link new things even if they&#39;re not needed&quot; mechanic, which means in the event a user has a dependency, even though we didn&#39;t configure it to build with that dependency, Perl did anyway.</p>

<p>
	3. During linking, --as-needed removed the actual dependency from Perl itself, so perl itself doesn&#39;t link against the library, however, the library persists in %Config</p>

<p>
	4. Due to no referential integrity keeping the automatically depended library in the dependency graph, said library can be uninstalled by the package manager.</p>

<p>
	5. And then there are subsequent failures every time somebody tries to compile a thing using data in %Config that is now &quot;Stale&quot;, as link time has no way to know that the arguments specified from %Config can be assumed un-needed without actually attempting to link them.</p>

<p>
	This looks a *lot* like that sort of pattern.<br>

	<br>

	And as a general rule, &quot;Inherit arbitrary things from %Config&quot; may be what CPAN wants, but it is not what Gentoo wants ( or at least, our users want a more fine-detail level of configurability ), for this reason, and a few more.<br>

	<br>

	Unlike CPAN, Gentoo has the ability to define a collection of &quot;global&quot; choices, and those &quot;global&quot; choices are used when building Perl itself.</p>

<p>
	Then, when building Perl modules, the expected/desired behaviour is to consume the /current/ state of those &quot;global&quot; choices at build time of the individual package ( which, subject to needs, the user could have adjusted those global choices in a nuanced way relative to the specific package, eg: more aggressive optimisations, more detailed debugging symbols )</p>

<p>
	In contrast, Perl expects you to set all your compile flags when you build perl, and typically, if you wanted something different after that point you&#39;re kinda on your own.</p>

<p>
	We&#39;ve had it on our table to make this an option at our disposal, and we currently do have hacks in place to make this sort of behaviour available for specific requested packages, but we do need a more general solution to that problem, and &quot;not doing the wrong thing&quot; by default at the Perl toolchain level is the most logical place to address that.</p>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;10&nbsp;07:53:49&nbsp;2016</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #113635] AutoReply: Fails tests on perls which *can* build XS</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 10 Apr 2016 13:41:40 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-ExtUtils-HasCompiler [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Rabbitson &lt;ribasushi [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">An extra train of thoughts from elsewhere:

&lt;ribasushi&gt; it&#39;s the catch-22 of EU::HC - it is only useful on stuff 
that is XS-optional, so you are virtually never going to hear about 
&#34;false negatives&#34;
&lt;ribasushi&gt; people shrug and move on fixing the actual errors they 
encountered with other shit in their stack
&lt;ribasushi&gt; and bundling ensures the test of &#34;compare to EU::CB&#34; is 
never executed :/
&lt;ribasushi&gt; hmmm... I am wondering if this needs to be always checked at 
runtime and be fatal by default:

if&#40;
   !&lt;some shortcircuit envvar&gt;
     and
   time&#40;&#41; &lt; &#34;something end-of-2017ish&#34; # to auto-shutoff the check in 
bundles
     and
   !can_compile_loadable_object&#40;&#41;
     and
   &lt;has suitable EUCB &#40;0.26 IIRC&#41;&gt;
     and
   ExtUtils::CBuilder-&gt;new-&gt;have_compiler
&#41; {
   die &#34;EUCB and EUHC disagree: you may have stumbled into an EUHC bug! 
please file a bug at ..., set &lt;such and such var&gt; if you are in a pinch &#34;
}
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;11&nbsp;12:59:45&nbsp;2016</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Closing the ticket as the main issue &#40;the bundling exhiiting a false-negative&#41; is now resolved. Secondary issue worked on in <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=113686">https://rt.cpan.org/Ticket/Display.html?id=113686</a></span>.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;11&nbsp;12:59:45&nbsp;2016</span>
    <span class="description">ribasushi [...] leporine.io -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;11&nbsp;12:59:45&nbsp;2016</span>
    <span class="description">ribasushi [...] leporine.io -  Fixed in 0.013 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
