<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #46933 for Imager-Screenshot: screenshot&#40;left=&gt;....&#41; keeps crashing</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #46933 for Imager-Screenshot: screenshot&#40;left=&gt;....&#41; keeps crashing</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Imager-Screenshot/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Imager-Screenshot/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Imager-Screenshot/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Imager-Screenshot/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Imager-Screenshot">Imager-Screenshot CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">46933</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Imager-Screenshot/Active/">Imager-Screenshot</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
robert [...] spitzenpfeil.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-42030-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-42031-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;14&nbsp;06:26:39&nbsp;2009</span>
    <span class="description">robert [...] spitzenpfeil.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> screenshot&#40;left=&gt;....&#41; keeps crashing</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 14 Jun 2009 12:26:03 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Imager-Screenshot [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Robert Spitzenpfeil &lt;robert [...] spitzenpfeil.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I&#39;m using screenshot to rapidly capture a small section of my screen and
send it off to a display.
When it fails, this is what die&#40;&#34;error: $!&#34;&#41; spits out:

error: Resource temporarily unavailable at ./screen_video.pl line 66.

I&#39;m on opensuse 11.0 32bit

I&#39;ve attached my code. It would be nice if you could shed some light on
why or what interferes here.


Regards,

Robert
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl -W

use strict;
use Device::SerialPort;
use Time::HiRes qw&#40;sleep&#41;;

use Imager;
use Imager::Screenshot &#39;screenshot&#39;;

my $start_byte = &#34;\n&#34;; # 0x0A
my $stop_byte = &#34;\r&#34;;  # 0x0D
my $color_scaler = 8;  # image has 0-255 for each color, too much for the matrix board

my $port = &#34;/dev/ttyUSB0&#34;; # &lt;-- find right port !
my $link = Device::SerialPort-&gt;new&#40;$port&#41; || die&#40;&#34;could not open port: $port - $!&#34;&#41;; # &lt;-- match to right com port

$link-&gt;databits&#40;8&#41;;
$link-&gt;baudrate&#40;57600&#41;; # &lt;-- match to arduino settings
$link-&gt;parity&#40;&#34;none&#34;&#41;;
$link-&gt;stopbits&#40;1&#41;;
$| = 1; # buffers disabled
sleep 4; # wait until the arduino bootloader has timed out

my $row;
my $led;
my $red;
my $green;
my $blue;
my $alpha;
my @scanline;
my $img;
my $newimg;
my $line;
my @coords;
my $x;
my $y;
my $left;
my $right;
my $top;
my $bottom;

my $x_box_size = $ARGV[0] || 8;
my $y_box_size = $ARGV[1] || 8;

while &#40;1&#41; {

@coords = `xinput query-state Mouse[1]`; # you need to adapt this to your system. use &#34;xinput list&#34; to get all X11 devices
foreach $line &#40; @coords &#41; {
  $line =~ m/^.*valuator\[0\]\=&#40;\d{1,4}&#41;/;
  $x = $1;
  $line =~ m/^.*valuator\[1\]\=&#40;\d{1,4}&#41;/;
  $y = $1;
}

$left = $x-$x_box_size/2;
$top = $y-$y_box_size/2;
$right = $x+$x_box_size/2;
$bottom = $y+$y_box_size/2;

#print &#34;x: &#34;,$x,&#34;\n&#34;;
#print &#34;y: &#34;,$y,&#34;\n&#34;;
#print&#34;xbs: &#34;,$x_box_size,&#34;, ybs: &#34;,$y_box_size,&#34;\n&#34;;
#print $left,&#34;,&#34;,$top,&#34;,&#34;,$right,&#34;,&#34;,$bottom,&#34;\n&#34;;

while &#40; ! defined&#40;$img&#41; &#41; {
  $img = screenshot&#40;left=&gt;$left,right=&gt;$right,top=&gt;$top,bottom=&gt;$bottom&#41; || die&#40;&#34;error: $!&#34;&#41;; # on linux get the curser position using &#39;xinput query-state Mouse[1]&#39; or similar
  sleep&#40;0.020&#41;;    
}
$newimg = $img-&gt;scale&#40;xpixels=&gt;8, ypixels=&gt;8&#41;;
undef&#40;$img&#41;;

for &#40;$row = 0; $row &lt; 8; $row++&#41; {
  $link-&gt;write&#40;$start_byte&#41;;
  @scanline = $newimg-&gt;getscanline&#40;y=&gt;$row&#41;;
  for &#40;$led = 0; $led &lt; 8; $led++&#41; {
    &#40;$red,$green,$blue,$alpha&#41; = $scanline[$led]-&gt;rgba;
    $link-&gt;write&#40;pack&#40;&#34;C&#34;,$row&#41;&#41;;
    $link-&gt;write&#40;pack&#40;&#34;C&#34;,$led&#41;&#41;;
    $link-&gt;write&#40;pack&#40;&#34;C&#34;,$red/$color_scaler&#41;&#41;;
    $link-&gt;write&#40;pack&#40;&#34;C&#34;,$green/$color_scaler&#41;&#41;;
    $link-&gt;write&#40;pack&#40;&#34;C&#34;,$blue/$color_scaler&#41;&#41;;
    #print $row,$led,&#34;\n&#34;;
    #print unpack&#40;&#34;C&#34;,$image[$row*3*8+$led*3+0]&#41;,&#34;\n&#34;;
    #print unpack&#40;&#34;C&#34;,$image[$row*3*8+$led*3+1]&#41;,&#34;\n&#34;;
    #print unpack&#40;&#34;C&#34;,$image[$row*3*8+$led*3+2]&#41;,&#34;\n\n&#34;;
    sleep&#40;0.001&#41;;
  }
  $link-&gt;write&#40;$stop_byte&#41;;
  sleep&#40;0.001&#41;;
}

}
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;21&nbsp;06:48:29&nbsp;2009</span>
    <span class="description">TONYC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Jun 14 06:26:39 2009, robert@spitzenpfeil.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt; 
&gt; I&#39;m using screenshot to rapidly capture a small section of my screen and
&gt; send it off to a display.
&gt; When it fails, this is what die&#40;&#34;error: $!&#34;&#41; spits out:
&gt; 
&gt; error: Resource temporarily unavailable at ./screen_video.pl line 66.
&gt; 
&gt; I&#39;m on opensuse 11.0 32bit
&gt; 
&gt; I&#39;ve attached my code. It would be nice if you could shed some light on
&gt; why or what interferes here.
</div>
Sorry for not replying to this sooner, either rt.cpan.org didn&#39;t email
the ticket to me, or I managed to delete it without realizing.

To find the cause for failures of screenshot&#40;&#41; your best choice is to
display Imager-&gt;errstr, eg:

  $img = screenshot&#40;left =&gt; ...&#41; || die Imager-&gt;errstr

I adapted your code, removing the serial port and xinput code, having it
set $x and $y to random integers from 0 to 99.

In each case it died when $x or $y was less than 4, setting $left or
$top to a negative value.

As documented, a negative left or top is treated as relative to the
right or bottom edge of the window respectively.

For the case of a small $x this will mean $left becomes large &#40;near the
right edge of the screen&#41; while $right is small.  screenshot can&#39;t
return a zero or negative width image and fails with an error like:

x: 79
y: 37
&#40;75, 33, 83, 41&#41;
x: 2
y: 38
&#40;-2, 34, 6, 42&#41;
image would be empty at ../../screen_video2.pl line 69.

If you find you don&#39;t get the error above from Imager-&gt;errstr, please
let me know and I&#39;ll track it down further.

This does expose a documentation problem, as the behaviour on error
isn&#39;t documented.

Tony
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;21&nbsp;06:48:30&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;30&nbsp;21:21:09&nbsp;2009</span>
    <span class="description">robert [...] spitzenpfeil.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #46933] screenshot&#40;left=&gt;....&#41; keeps crashing</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 01 Dec 2009 03:21:33 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Imager-Screenshot [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Robert Spitzenpfeil &lt;robert [...] spitzenpfeil.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I was busy, so I didn&#39;t investigate an further until now.

Currently I can&#39;t really reproduce the error on my openSUSE 11.2 system.
Before it was 11.0. I can reproduce the barf when the snapshot would go
into negative values &#40;mouse curser at TOP / LEFT&#41;. A lot of things
around the X server have changed, so maybe that fixed it.

If I run into it again, I&#39;ll let you know. My LED matrix is now happily
displaying stuff under the mouse cursor.


Thanks,

Robert
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;16&nbsp;09:28:45&nbsp;2010</span>
    <span class="description">TONYC [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
