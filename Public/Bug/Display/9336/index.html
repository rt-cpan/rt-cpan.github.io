<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #9336 for DBD-Pg: Integer/datetime retrieval broken on sparc64</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #9336 for DBD-Pg: Integer/datetime retrieval broken on sparc64</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DBD-Pg/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DBD-Pg/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DBD-Pg/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DBD-Pg/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-Pg">DBD-Pg CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">9336</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DBD-Pg/Active/">DBD-Pg</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
rink [...] stack.nl

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-10200-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.32    </td>
  </tr>
  <tr id="CF-10201-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.40    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;02&nbsp;15:22:11&nbsp;2005</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Integer/datetime retrieval broken on sparc64</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Perl v5.8.5 built for sparc64-freebsd
DBI::Pg version 1.32 &#40;FreeBSD ports as of today, 02-Jan-2004&#41;
PostgreSQL version 7.4.6 &#40;FreeBSD ports as of today, 02-Jan-2004&#41;
OS: FreeBSD 5.3-STABLE/sparc64

My FreeBSD 5.3-STABLE/sparc64 machine &#40;A Sun Netra T1 105&#41; gives blank strings for all integer and timedate fields &#40;and probably more&#41;. This is due to an incorrect mixture of size_t and int, in quote.c and dbdimp.c.

Using the exact same versions of all software on a Pentium IV with FreeBSD 5.3-STABLE wields no problems. Using the Sun as server and the Pentium IV as client gives no problems.

Due to the 64 bit nature of the UltraSPARC family, casting from size_t to int and the other way around may wield incorrect values. The attached patch fixes the problems, and cleans quote.c to always use size_t for strings when needed.
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -ru DBD-Pg-1.32.org/dbdimp.c DBD-Pg-1.32/dbdimp.c
--- DBD-Pg-1.32.org/dbdimp.c	Sun Jan  2 20:01:43 2005
+++ DBD-Pg-1.32/dbdimp.c	Sun Jan  2 20:06:16 2005
@@ -986,7 +986,9 @@
 	int num_fields;
 	char *value;
 	char *p;
-	int i, pg_type, value_len, chopblanks, len;
+	int i, pg_type, chopblanks;
+	size_t value_len;
+	STRLEN len;
 	AV *av;
 	D_imp_dbh_from_sth;
 	
diff -ru DBD-Pg-1.32.org/quote.c DBD-Pg-1.32/quote.c
--- DBD-Pg-1.32.org/quote.c	Sun Jan  2 20:01:43 2005
+++ DBD-Pg-1.32/quote.c	Sun Jan  2 20:04:39 2005
@@ -9,7 +9,7 @@
 {
 	const char *source = from;
 	char	   *target = to;
-	unsigned int remaining = length;
+	unsigned size_t remaining = length;
 
 	while &#40;remaining &gt; 0&#41;
 	{
@@ -146,9 +146,9 @@
 unsigned char *
 PQunescapeBytea2&#40;const unsigned char *strtext, size_t *retbuflen&#41;
 {
-	size_t strtextlen, buflen;
+	size_t strtextlen, buflen, i, j;
 	unsigned char *buffer, *tmpbuf;
-	int i, j, byte;
+	int byte;
 
 	if &#40;strtext == NULL&#41; {
 		return NULL;
@@ -393,7 +393,7 @@
 {
 	char *result;
 	char *dest;
-	int max_len = 0, i;
+	size_t max_len = 0, i;
 
 	/* We are going to retun a quote_bytea&#40;&#41; for backwards compat but
 	   we warn first */
@@ -483,7 +483,7 @@
 void
 dequote_char&#40;string, retlen&#41;
 	char *string;
-	int *retlen;
+	size_t *retlen;
 {
 	/* TODO: chop_blanks if requested */
 	*retlen = strlen&#40;string&#41;;
@@ -493,7 +493,7 @@
 void
 dequote_varchar &#40;string, retlen&#41;
 	char *string;
-	int *retlen;
+	size_t *retlen;
 {
 	*retlen = strlen&#40;string&#41;;
 }
@@ -503,7 +503,7 @@
 void
 dequote_bytea&#40;string, retlen&#41;
 	char *string;
-	int *retlen;
+	size_t *retlen;
 {
 	char *s, *p;
 	int c1,c2,c3;
@@ -542,7 +542,7 @@
 void
 dequote_sql_binary &#40;string, retlen&#41;
 	char *string;
-	int *retlen;
+	size_t *retlen;
 {
 	/* We are going to retun a dequote_bytea&#40;&#41;, JIC */
 	warn&#40;&#34;Use of SQL_BINARY invalid in dequote&#40;&#41;&#34;&#41;;
@@ -556,7 +556,7 @@
 void
 dequote_bool &#40;string, retlen&#41;
 	char *string;
-	int *retlen;
+	size_t *retlen;
 {
 	switch&#40;*string&#41;{
 		case &#39;f&#39;: *string = &#39;0&#39;; break;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;23&nbsp;21:48:37&nbsp;2005</span>
    <span class="description">dbd-pg [...] perl.org -  Fixed in 1.40 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;23&nbsp;21:48:37&nbsp;2005</span>
    <span class="description">dbd-pg [...] perl.org -  Status changed from &#39;new&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
