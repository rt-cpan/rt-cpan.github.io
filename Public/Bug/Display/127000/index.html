<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #127000 for Moo: Attribute initialization vs Module loading</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #127000 for Moo: Attribute initialization vs Module loading</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Moo/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Moo/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Moo/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Moo/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Moo">Moo CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">127000</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Moo/Active/">Moo</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
valderrama [...] strato.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-235668-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-235669-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;30&nbsp;11:19:10&nbsp;2018</span>
    <span class="description">valderrama [...] strato.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Attribute initialization vs Module loading</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 30 Aug 2018 15:12:53 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Moo [...] rt.cpan.org&#34; &lt;bug-Moo [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Valderrama, Mario&#34; &lt;valderrama [...] strato.de&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,


I know this is probably not the best way to do this, but creating objects of subclasses from a function in the superclass

doesn&#39;t correctly initalize the attributes.

Say I have 3 files:


Foo.pm

    package Foo;

    use Moo;

    use FooBar;


    has foo =&gt; &#40;is =&gt; &#39;ro&#39;&#41;;


    sub make_foobar { FooBar-&gt;new&#40;@_&#41; }


    1;


FooBar.pm

    package FooBar;

    use Moo;


    extends &#39;Foo&#39;;


    has bar =&gt; &#40;is =&gt; &#39;ro&#39;&#41;;


    1;


main.pl

    #!/usr/bin/env perl

    use strict;

    use warnings;

    use 5.026;

    use lib &#39;.&#39;;

    use Foo;


    my $foobar = Foo::make_foobar&#40;foo =&gt; &#39;foo&#39;, bar =&gt; &#39;bar&#39;&#41;;

    say $foobar-&gt;foo&#40;&#41;;

    say $foobar-&gt;bar&#40;&#41;;


Invoking main.pl will yield the following:


    $ perl main.pl

    Use of uninitialized value in say at main.pl line 9.


    bar


This however can be fixed by either adding a &#39;use FooBar;&#39; before the &#39;use Foo;&#39; in main.pl or by using Moose instead of Moo in any of the two modules.

Making one of these changes will then result in:


    $ perl main.pl

    foo

    bar


I&#39;m using:

- Perl 5.26.0 &#40;installed with plenv&#41;

- Moo 2.003004

- Moose 2.2011 &#40;for reference&#41;

- Fedora 28 with Kernel 4.17.18-200.x86_64
</div></div>

<div class="messagebody">
</div>
</div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;04&nbsp;16:41:47&nbsp;2019</span>
    <span class="description">mshipper [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I am running into the same issue.
Attached is a sample proof.pl file.

If I use Moose in place of Moo, The issue does not happen.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> proof.pl</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/opt/apps/perl/perl5240/bin/perl

use Modern::Perl;

{
  my $t=new TestThree;

  print $t-&gt;attr_one,&#34;\n&#34;;
  print $t-&gt;attr_two,&#34;\n&#34;;
  print $t-&gt;attr_three,&#34;\n&#34;;
}

{
  my $t=new TestThree&#40;attr_one=&gt;3,attr_two=&gt;5,attr_three=&gt;6&#41;;

  print $t-&gt;attr_one,&#34;\n&#34;;
  print $t-&gt;attr_two,&#34;\n&#34;;
  print $t-&gt;attr_three,&#34;\n&#34;;
}

BEGIN {
package TestOne;

use Modern::Perl;
use Moo;

has attr_two=&gt;&#40;is=&gt;&#39;ro&#39;,default=&gt;2,lazy=&gt;1&#41;;

1;
package TestTwo;
use Modern::Perl;
use Moo;

has attr_one=&gt;&#40;is=&gt;&#39;ro&#39;,default=&gt;1,lazy=&gt;1&#41;;
1;

package TestFour;
use Modern::Perl;
use Moo;

has attr_three=&gt;&#40;is=&gt;&#39;ro&#39;,default=&gt;3,lazy=&gt;1&#41;;
1;

package TestThree;

use Modern::Perl;
use Moo;

extends qw&#40;TestOne TestTwo TestFour&#41;;
1;
}
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;04&nbsp;16:41:49&nbsp;2019</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;04&nbsp;16:41:50&nbsp;2019</span>
    <span class="description">mshipper [...] yahoo.com -  Fixed in 2.003006 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;04&nbsp;16:44:41&nbsp;2019</span>
    <span class="description">mshipper [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry didn&#39;t mean to say fixed in.
Its currently broken in version: 2.003006
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;05&nbsp;04:02:32&nbsp;2019</span>
    <span class="description">haarg [...] haarg.org -  Fixed in 2.003006 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;05&nbsp;09:52:56&nbsp;2019</span>
    <span class="description">haarg [...] haarg.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Aug 30 11:19:10 2018, valderrama@strato.de wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello,
&gt; 
&gt; 
&gt; I know this is probably not the best way to do this, but creating
&gt; objects of subclasses from a function in the superclass
&gt; 
&gt; doesn&#39;t correctly initalize the attributes.
&gt; 
&gt; Say I have 3 files:
&gt; 
&gt; 
&gt; Foo.pm
&gt; 
&gt; package Foo;
&gt; 
&gt; use Moo;
&gt; 
&gt; use FooBar;
&gt; 
&gt; 
&gt; has foo =&gt; &#40;is =&gt; &#39;ro&#39;&#41;;
&gt; 
&gt; 
&gt; sub make_foobar { FooBar-&gt;new&#40;@_&#41; }
&gt; 
&gt; 
&gt; 1;
&gt; 
&gt; 
&gt; FooBar.pm
&gt; 
&gt; package FooBar;
&gt; 
&gt; use Moo;
&gt; 
&gt; 
&gt; extends &#39;Foo&#39;;
&gt; 
&gt; 
&gt; has bar =&gt; &#40;is =&gt; &#39;ro&#39;&#41;;
&gt; 
&gt; 
&gt; 1;
&gt; 
&gt; 
&gt; main.pl
&gt; 
&gt; #!/usr/bin/env perl
&gt; 
&gt; use strict;
&gt; 
&gt; use warnings;
&gt; 
&gt; use 5.026;
&gt; 
&gt; use lib &#39;.&#39;;
&gt; 
&gt; use Foo;
&gt; 
&gt; 
&gt; my $foobar = Foo::make_foobar&#40;foo =&gt; &#39;foo&#39;, bar =&gt; &#39;bar&#39;&#41;;
&gt; 
&gt; say $foobar-&gt;foo&#40;&#41;;
&gt; 
&gt; say $foobar-&gt;bar&#40;&#41;;
&gt; 
&gt; 
&gt; Invoking main.pl will yield the following:
&gt; 
&gt; 
&gt; $ perl main.pl
&gt; 
&gt; Use of uninitialized value in say at main.pl line 9.
&gt; 
&gt; 
&gt; bar
&gt; 
&gt; 
&gt; This however can be fixed by either adding a &#39;use FooBar;&#39; before the
&gt; &#39;use Foo;&#39; in main.pl or by using Moose instead of Moo in any of the
&gt; two modules.
&gt; 
&gt; Making one of these changes will then result in:
&gt; 
&gt; 
&gt; $ perl main.pl
&gt; 
&gt; foo
&gt; 
&gt; bar
&gt; 
&gt; 
&gt; I&#39;m using:
&gt; 
&gt; - Perl 5.26.0 &#40;installed with plenv&#41;
&gt; 
&gt; - Moo 2.003004
&gt; 
&gt; - Moose 2.2011 &#40;for reference&#41;
&gt; 
&gt; - Fedora 28 with Kernel 4.17.18-200.x86_64
</div>
This code is creating a circular dependency between Foo and FooBar.  There are numerous ways this can cause problems, and this is one of them.  At the time that FooBar copies the attribute information from Foo, Foo hasn&#39;t added any attributes, so FooBar doesn&#39;t know about them.

It can be fixed by changing the loading order.  While generally having any circular dependencies is bad, if you really need to do it, remove the &#39;use FooBar;&#39; and add a line &#39;require FooBar;&#39; near the end of the file.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
