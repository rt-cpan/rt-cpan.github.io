<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #77722 for Catalyst-Manual: problems with end&#40;&#41; and auto&#40;&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #77722 for Catalyst-Manual: problems with end&#40;&#41; and auto&#40;&#41;</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Catalyst-Manual/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Catalyst-Manual/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Catalyst-Manual/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Catalyst-Manual/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Catalyst-Manual">Catalyst-Manual CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">77722</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Catalyst-Manual/Active/">Catalyst-Manual</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
john.deighan [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-41462-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
5.9002    </td>
  </tr>
  <tr id="CF-41463-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;08&nbsp;18:21:08&nbsp;2012</span>
    <span class="description">john.deighan [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> problems with end&#40;&#41; and auto&#40;&#41;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve run into 2 problems while going through the tutorial. They might
just be misunderstandings on my part, but I believe that both point to
needed improvements in the tutorial code. Both took me quite a bit of
time to discover the problem and solution.

The most recent was with an end&#40;&#41; action in Root.pm. Reading over the
tutorial, it stated that &#34;end&#34; was one of 5 &#34;special, private&#34; actions.
So, if it&#39;s a private action, I should be able to add the &#34;:Private&#34;
attribute, right? It already had &#34;:ActionClass&#40;&#39;RenderView&#39;&#41;&#34;, which I
left in place, but also added &#34;:Private&#34;. Unfortunately, that caused the
TT view to not be rendered, even though the &#39;template&#39; key was set in
the stash, and the output was completely empty.

The other problem, now that I think of it, happened when I tried to
follow a tutorial in one of the Catalyst books that I&#39;ve purchased, not
the online tutorial. I had an &#34;auto&#34; action which looked like this:

sub auto :Private { my&#40;$self, $c&#41; = @_;

push&#40;@{$c-&gt;stash-&gt;{matches}}, &#39;Root -&gt; auto&#39;&#41;;
}

Well, I believe that all functions should have a &#34;return&#34; statement.
It&#39;s in the &#34;Perl Best Practices&#34; book, but more importantly, I believe
in it. So, I added a final &#34;return;&#34;. Unfortunately, that caused the
entire response to be aborted - other actions should have been fired,
but they were not. It took me a long time to find out that if I removed
the &#34;return;&#34; &#40;or replaced it with &#34;return 1;&#34;&#41;, everything started
working again. Realizing that Perl does some things that I consider very
bad, like functions that don&#39;t appear to return any values really do
return values, and functions return the last expression evaluated even
though you never asked for anything to be returned, here is what I think
is happening:

1. the call to push&#40;&#41; returns something &#40;probably the thing being
pushed, but perhaps the resulting list - who knows&#41;

2. the call to auto&#40;&#41; then returns that as the function return value,
even though there is no explicit return statement.

3. if the call to auto returns a false value, the entire response is
aborted. I&#39;m sure that&#39;s documented somewhere, but I&#39;m working on a
beginner&#39;s tutorial.

Point is - if the example code always returned a value explicitly when a
return value is used in any way, newbies &#40;not a Perl newbie, but a
Catalyst newbie&#41; wouldn&#39;t make these kinds of mistakes and spend a lot
of time trying to track down what happened.

Of course, if I entered the example code exactly as it is in the
tutorial files, I wouldn&#39;t have had these problems either. But then, I
want to understand what&#39;s going on and would rather enter code that
meets my usual programming standards.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;08&nbsp;18:47:21&nbsp;2012</span>
    <span class="description">diment [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #77722] problems with end&#40;&#41; and auto&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 9 Jun 2012 08:47:05 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Catalyst-Manual [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kieren Diment &lt;diment [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">

On 09/06/2012, at 8:21 AM, John Deighan via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Fri Jun 08 18:21:08 2012: Request 77722 was acted upon.
&gt; Transaction: Ticket created by jdeighan
&gt;       Queue: Catalyst-Manual
&gt;     Subject: problems with end&#40;&#41; and auto&#40;&#41;
&gt;   Broken in: 5.9002
&gt;    Severity: Normal
&gt;       Owner: Nobody
&gt;  Requestors: john.deighan@gmail.com
&gt;      Status: new
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=77722">https://rt.cpan.org/Ticket/Display.html?id=77722</a></span> &gt;
&gt; 
&gt; 
&gt; I&#39;ve run into 2 problems while going through the tutorial. They might
&gt; just be misunderstandings on my part, but I believe that both point to
&gt; needed improvements in the tutorial code. Both took me quite a bit of
&gt; time to discover the problem and solution.
&gt; 
&gt; The most recent was with an end&#40;&#41; action in Root.pm. Reading over the
&gt; tutorial, it stated that &#34;end&#34; was one of 5 &#34;special, private&#34; actions.
&gt; So, if it&#39;s a private action, I should be able to add the &#34;:Private&#34;
&gt; attribute, right? It already had &#34;:ActionClass&#40;&#39;RenderView&#39;&#41;&#34;, which I
&gt; left in place, but also added &#34;:Private&#34;. Unfortunately, that caused the
&gt; TT view to not be rendered, even though the &#39;template&#39; key was set in
&gt; the stash, and the output was completely empty.
</div>
End used to be a :Private action, you&#39;re right.  These days it&#39;s almost like a private action except it also calls to the appropriate view unless otherwise told to do so &#40;in old catalysts you&#39;d have to do it explicitly&#41;.  This should probably be fixed.  Could you file a separate bug for this please &#40;this bug report is not very granular&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; The other problem, now that I think of it, happened when I tried to
&gt; follow a tutorial in one of the Catalyst books that I&#39;ve purchased, not
&gt; the online tutorial. I had an &#34;auto&#34; action which looked like this:
&gt; 
&gt; sub auto :Private { my&#40;$self, $c&#41; = @_;
&gt; 
&gt; push&#40;@{$c-&gt;stash-&gt;{matches}}, &#39;Root -&gt; auto&#39;&#41;;
&gt; }
&gt; 
</div>
Auto bails on the dispatch cycle if it returns undef.  Push returns the created array &#40;but is almost always called in void context&#41;.
All subs return the value from the last statement if there&#39;s no explicit return value. 
The purpose of the example in the book was to demonstrate the dispatch, I suppose at the time I thought that an explicit return value was an unnecessary distraction

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Well, I believe that all functions should have a &#34;return&#34; statement.
&gt; It&#39;s in the &#34;Perl Best Practices&#34; book, but more importantly, I believe
&gt; in it. So, I added a final &#34;return;&#34;.
</div>
A final &#39;return 1&#39; would have worked fine.  Did you try that? or even return &#40;push&#40;@{$c-&gt;stash-&gt;{matches}}, &#39;Root -&gt; auto&#39;&#41;&#41;;&#39;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Unfortunately, that caused the
&gt; entire response to be aborted - other actions should have been fired,
&gt; but they were not. It took me a long time to find out that if I removed
&gt; the &#34;return;&#34; &#40;or replaced it with &#34;return 1;&#34;&#41;, everything started
&gt; working again. Realizing that Perl does some things that I consider very
&gt; bad, like functions that don&#39;t appear to return any values really do
&gt; return values, and functions return the last expression evaluated even
&gt; though you never asked for anything to be returned, here is what I think
&gt; is happening:
&gt; 
&gt; 1. the call to push&#40;&#41; returns something &#40;probably the thing being
&gt; pushed, but perhaps the resulting list - who knows&#41;
</div>
The &#39;who knows&#39; here suggests that you should spend some time exploring in the perl debugger - with normal code and catalyst code.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; 2. the call to auto&#40;&#41; then returns that as the function return value,
&gt; even though there is no explicit return statement.
&gt; 
&gt; 3. if the call to auto returns a false value, the entire response is
&gt; aborted. I&#39;m sure that&#39;s documented somewhere, but I&#39;m working on a
&gt; beginner&#39;s tutorial.
</div>
It is.  It should be documented in the tutorial, if it isn&#39;t please identify the first mention of auto where it should be mentioned.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Point is - if the example code always returned a value explicitly when a
&gt; return value is used in any way, newbies &#40;not a Perl newbie, but a
&gt; Catalyst newbie&#41; wouldn&#39;t make these kinds of mistakes and spend a lot
&gt; of time trying to track down what happened.
&gt; 
</div>
You may be getting the book code and the tutorial code confused.  Of course it may be worth mentioning that implicit returns are possible, and while not encouraged sometimes make sense somewhere in the tutorial.  Identifying where this passage could be would be useful.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Of course, if I entered the example code exactly as it is in the
&gt; tutorial files, I wouldn&#39;t have had these problems either. But then, I
&gt; want to understand what&#39;s going on and would rather enter code that
&gt; meets my usual programming standards.
</div>
Yes, there was a design decision to avoid the explicit return in the dispatcher code chapter to avoid an unnecessary distraction.  In this instance I feel the lack of an explicit return was fine, but I usually try to avoid them.  Generally I will only use implicit returns for two line subs.  i.e:

sub something {
  my &#40;$self, @params};
  $self-&gt;do_something&#40;@params&#41;;
}

rather than: 

sub something {
  my &#40;$self, @params};
  return $self-&gt;do_something&#40;@params&#41;;
}
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;08&nbsp;18:47:24&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
