<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #99733 for Moo: Attribute name in the isa error message</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #99733 for Moo: Attribute name in the isa error message</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Moo/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Moo/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Moo/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Moo/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Moo">Moo CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">99733</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Moo/Active/">Moo</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ZDM [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-235668-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-235669-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;22&nbsp;12:55:52&nbsp;2014</span>
    <span class="description">ZDM [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Attribute name in the isa error message</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Is it possible to include attribute name into &#34;isa&#34; error message?

Sometime, if class has many attrs,  it&#39;s not simple to know which attribute doesn&#39;t pass validation.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;22&nbsp;18:01:43&nbsp;2014</span>
    <span class="description">ilmari [...] ilmari.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients:;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #99733] Attribute name in the isa error message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 23 Oct 2014 00:01:25 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Moo [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ilmari [...] ilmari.org &#40;Dagfinn Ilmari Mannsåker&#41;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Dmytro Zagashev via RT&#34; &lt;bug-Moo@rt.cpan.org&gt; writes:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Is it possible to include attribute name into &#34;isa&#34; error message?
&gt;
&gt; Sometime, if class has many attrs, it&#39;s not simple to know which
&gt; attribute doesn&#39;t pass validation.
</div>
Moo has done this since version 1.000000 &#40;released 2012-07-18&#41;:

$ perl -Moo -E &#39;has foo =&gt; is =&gt; ro =&gt; isa =&gt; sub { die &#34;bad\n&#34; };&#39; \
  -E &#39;say Moo-&gt;VERSION; Class-&gt;new&#40;foo=&gt; 42&#41;&#39;
1.006001
isa check for &#34;foo&#34; failed: bad

Which version are you using?

-- 
&#34;I use RMS as a guide in the same way that a boat captain would use
 a lighthouse.  It&#39;s good to know where it is, but you generally
 don&#39;t want to find yourself in the same spot.&#34; - Tollef Fog Heen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;22&nbsp;18:01:44&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;22&nbsp;18:55:00&nbsp;2014</span>
    <span class="description">dzagashev [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #99733] Attribute name in the isa error message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 23 Oct 2014 01:54:42 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Moo [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;dzagashev [...] gmail.com&#34; &lt;dzagashev [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Latest.

I use global __DIE__ handler.

Maybe this is the reason?

On 23.10.2014 1:01, &#40;Dagfinn Ilmari Mannsåker&#41; via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;
&gt; &#34;Dmytro Zagashev via RT&#34; &lt;bug-Moo@rt.cpan.org&gt; writes:
&gt;
<div class="message-stanza open">&gt;&gt; Is it possible to include attribute name into &#34;isa&#34; error message?
&gt;&gt;
&gt;&gt; Sometime, if class has many attrs, it&#39;s not simple to know which
&gt;&gt; attribute doesn&#39;t pass validation.
</div>&gt; Moo has done this since version 1.000000 &#40;released 2012-07-18&#41;:
&gt;
&gt; $ perl -Moo -E &#39;has foo =&gt; is =&gt; ro =&gt; isa =&gt; sub { die &#34;bad\n&#34; };&#39; \
&gt;   -E &#39;say Moo-&gt;VERSION; Class-&gt;new&#40;foo=&gt; 42&#41;&#39;
&gt; 1.006001
&gt; isa check for &#34;foo&#34; failed: bad
&gt;
&gt; Which version are you using?
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;22&nbsp;19:13:11&nbsp;2014</span>
    <span class="description">dzagashev [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #99733] Attribute name in the isa error message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 23 Oct 2014 02:12:52 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Moo [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;dzagashev [...] gmail.com&#34; &lt;dzagashev [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">It will be useful if Moo localize $SIG{__DIE__} in
Method::Generate::Accessor::_wrap_attr_exception.

This will guarantee, that prefix will be added to error message in any case.

On 23.10.2014 1:01, &#40;Dagfinn Ilmari Mannsåker&#41; via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;
&gt; &#34;Dmytro Zagashev via RT&#34; &lt;bug-Moo@rt.cpan.org&gt; writes:
&gt;
<div class="message-stanza open">&gt;&gt; Is it possible to include attribute name into &#34;isa&#34; error message?
&gt;&gt;
&gt;&gt; Sometime, if class has many attrs, it&#39;s not simple to know which
&gt;&gt; attribute doesn&#39;t pass validation.
</div>&gt; Moo has done this since version 1.000000 &#40;released 2012-07-18&#41;:
&gt;
&gt; $ perl -Moo -E &#39;has foo =&gt; is =&gt; ro =&gt; isa =&gt; sub { die &#34;bad\n&#34; };&#39; \
&gt;   -E &#39;say Moo-&gt;VERSION; Class-&gt;new&#40;foo=&gt; 42&#41;&#39;
&gt; 1.006001
&gt; isa check for &#34;foo&#34; failed: bad
&gt;
&gt; Which version are you using?
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;22&nbsp;20:13:02&nbsp;2014</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #99733] Attribute name in the isa error message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 22 Oct 2014 17:12:53 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;dzagashev [...] gmail.com via RT&#34; &lt;bug-Moo [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Karen Etheridge &lt;ether [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, Oct 22, 2014 at 07:13:12PM -0400, dzagashev@gmail.com via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Moo
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt; 
&gt; It will be useful if Moo localize $SIG{__DIE__} in
&gt; Method::Generate::Accessor::_wrap_attr_exception.
&gt; 
&gt; This will guarantee, that prefix will be added to error message in any case.
</div>
Moo doesn&#39;t use a __DIE__ handler -- it uses an eval to catch and modify
the exception before passing it upwards.  If you are seeing these
exceptions unmodified, that suggests your handler is not checking $^S,
which is a problem in your code.  See &#39;perldoc -f die&#39; and &#39;perldoc
perlvar&#39;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;22&nbsp;20:53:20&nbsp;2014</span>
    <span class="description">dzagashev [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #99733] Attribute name in the isa error message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 23 Oct 2014 03:53:01 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Moo [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;dzagashev [...] gmail.com&#34; &lt;dzagashev [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I check $^S in my die handler, but this is not the case.

The problem is that if global die handler used - code in your eval
&#40;after isa call&#41; never will be executed and has no chance to prepend
attribute information to error message.

Using of:

local $SIG{__DIE__} = undef;

at the beginning of eval will solve the problem and don&#39;t affect the
overall workflow.

On 23.10.2014 3:13, Karen Etheridge via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;
&gt; On Wed, Oct 22, 2014 at 07:13:12PM -0400, dzagashev@gmail.com via RT wrote:
<div class="message-stanza open">&gt;&gt;        Queue: Moo
&gt;&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;&gt;
&gt;&gt; It will be useful if Moo localize $SIG{__DIE__} in
&gt;&gt; Method::Generate::Accessor::_wrap_attr_exception.
&gt;&gt;
&gt;&gt; This will guarantee, that prefix will be added to error message in any case.
</div>&gt; Moo doesn&#39;t use a __DIE__ handler -- it uses an eval to catch and modify
&gt; the exception before passing it upwards.  If you are seeing these
&gt; exceptions unmodified, that suggests your handler is not checking $^S,
&gt; which is a problem in your code.  See &#39;perldoc -f die&#39; and &#39;perldoc
&gt; perlvar&#39;.
&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;23&nbsp;06:05:58&nbsp;2014</span>
    <span class="description">ilmari [...] ilmari.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients:;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #99733] Attribute name in the isa error message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 23 Oct 2014 12:05:43 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Moo [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ilmari [...] ilmari.org &#40;Dagfinn Ilmari Mannsåker&#41;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Seeing as we always rethrow the error &#40;thus triggering any $SIG{__DIE__}
handler then&#41;, this makes sense.

&#34;dzagashev@gmail.com via RT&#34; &lt;bug-Moo@rt.cpan.org&gt; writes:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Moo
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;
&gt; I check $^S in my die handler, but this is not the case.
&gt;
&gt; The problem is that if global die handler used - code in your eval
&gt; &#40;after isa call&#41; never will be executed and has no chance to prepend
&gt; attribute information to error message.
&gt;
&gt; Using of:
&gt;
&gt; local $SIG{__DIE__} = undef;
&gt;
&gt; at the beginning of eval will solve the problem and don&#39;t affect the
&gt; overall workflow.
&gt;
&gt; On 23.10.2014 3:13, Karen Etheridge via RT wrote:
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;&gt;
&gt;&gt; On Wed, Oct 22, 2014 at 07:13:12PM -0400, dzagashev@gmail.com via RT wrote:
<div class="message-stanza open">&gt;&gt;&gt;        Queue: Moo
&gt;&gt;&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;&gt;&gt;
&gt;&gt;&gt; It will be useful if Moo localize $SIG{__DIE__} in
&gt;&gt;&gt; Method::Generate::Accessor::_wrap_attr_exception.
&gt;&gt;&gt;
&gt;&gt;&gt; This will guarantee, that prefix will be added to error message in any case.
</div>&gt;&gt; Moo doesn&#39;t use a __DIE__ handler -- it uses an eval to catch and modify
&gt;&gt; the exception before passing it upwards.  If you are seeing these
&gt;&gt; exceptions unmodified, that suggests your handler is not checking $^S,
&gt;&gt; which is a problem in your code.  See &#39;perldoc -f die&#39; and &#39;perldoc
&gt;&gt; perlvar&#39;.
&gt;&gt;
&gt;&gt;
</div>&gt;
&gt;
&gt;
&gt;
</div>
-- 
&#34;I use RMS as a guide in the same way that a boat captain would use
 a lighthouse.  It&#39;s good to know where it is, but you generally
 don&#39;t want to find yourself in the same spot.&#34; - Tollef Fog Heen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;23&nbsp;06:26:23&nbsp;2014</span>
    <span class="description">dzagashev [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #99733] Attribute name in the isa error message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 23 Oct 2014 13:26:02 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Moo [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;dzagashev [...] gmail.com&#34; &lt;dzagashev [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Global handler can, for example, log error message and exit process.
And in current case global handler receive die message without att into.
Localizing __DIE__ is more versatile approach, and guarantee, that attr
info will be added in any case.

On 23.10.2014 13:06, &#40;Dagfinn Ilmari Mannsåker&#41; via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;
&gt; Seeing as we always rethrow the error &#40;thus triggering any $SIG{__DIE__}
&gt; handler then&#41;, this makes sense.
&gt;
&gt; &#34;dzagashev@gmail.com via RT&#34; &lt;bug-Moo@rt.cpan.org&gt; writes:
&gt;
<div class="message-stanza open">&gt;&gt;        Queue: Moo
&gt;&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;&gt;
&gt;&gt; I check $^S in my die handler, but this is not the case.
&gt;&gt;
&gt;&gt; The problem is that if global die handler used - code in your eval
&gt;&gt; &#40;after isa call&#41; never will be executed and has no chance to prepend
&gt;&gt; attribute information to error message.
&gt;&gt;
&gt;&gt; Using of:
&gt;&gt;
&gt;&gt; local $SIG{__DIE__} = undef;
&gt;&gt;
&gt;&gt; at the beginning of eval will solve the problem and don&#39;t affect the
&gt;&gt; overall workflow.
&gt;&gt;
&gt;&gt; On 23.10.2014 3:13, Karen Etheridge via RT wrote:
<div class="message-stanza open">&gt;&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;&gt;&gt;
&gt;&gt;&gt; On Wed, Oct 22, 2014 at 07:13:12PM -0400, dzagashev@gmail.com via RT wrote:
<div class="message-stanza open">&gt;&gt;&gt;&gt;        Queue: Moo
&gt;&gt;&gt;&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; It will be useful if Moo localize $SIG{__DIE__} in
&gt;&gt;&gt;&gt; Method::Generate::Accessor::_wrap_attr_exception.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; This will guarantee, that prefix will be added to error message in any case.
</div>&gt;&gt;&gt; Moo doesn&#39;t use a __DIE__ handler -- it uses an eval to catch and modify
&gt;&gt;&gt; the exception before passing it upwards.  If you are seeing these
&gt;&gt;&gt; exceptions unmodified, that suggests your handler is not checking $^S,
&gt;&gt;&gt; which is a problem in your code.  See &#39;perldoc -f die&#39; and &#39;perldoc
&gt;&gt;&gt; perlvar&#39;.
&gt;&gt;&gt;
&gt;&gt;&gt;
</div>&gt;&gt;
&gt;&gt;
&gt;&gt;
</div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;23&nbsp;07:30:04&nbsp;2014</span>
    <span class="description">ilmari [...] ilmari.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients:;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #99733] Attribute name in the isa error message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 23 Oct 2014 13:29:47 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Moo [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ilmari [...] ilmari.org &#40;Dagfinn Ilmari Mannsåker&#41;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve implemented this in a branch:

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/moose/Moo/pull/11">https://github.com/moose/Moo/pull/11</a></span>

As you can see from the tests, the global $SIG{__DIE__} handler still
gets called, but only once, with the final, wrapped exception.

&#34;dzagashev@gmail.com via RT&#34; &lt;bug-Moo@rt.cpan.org&gt; writes:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Moo
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;
&gt; Global handler can, for example, log error message and exit process.
&gt; And in current case global handler receive die message without att into.
&gt; Localizing __DIE__ is more versatile approach, and guarantee, that attr
&gt; info will be added in any case.
&gt;
&gt; On 23.10.2014 13:06, &#40;Dagfinn Ilmari Mannsåker&#41; via RT wrote:
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;&gt;
&gt;&gt; Seeing as we always rethrow the error &#40;thus triggering any $SIG{__DIE__}
&gt;&gt; handler then&#41;, this makes sense.
&gt;&gt;
&gt;&gt; &#34;dzagashev@gmail.com via RT&#34; &lt;bug-Moo@rt.cpan.org&gt; writes:
&gt;&gt;
<div class="message-stanza open">&gt;&gt;&gt;        Queue: Moo
&gt;&gt;&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;&gt;&gt;
&gt;&gt;&gt; I check $^S in my die handler, but this is not the case.
&gt;&gt;&gt;
&gt;&gt;&gt; The problem is that if global die handler used - code in your eval
&gt;&gt;&gt; &#40;after isa call&#41; never will be executed and has no chance to prepend
&gt;&gt;&gt; attribute information to error message.
&gt;&gt;&gt;
&gt;&gt;&gt; Using of:
&gt;&gt;&gt;
&gt;&gt;&gt; local $SIG{__DIE__} = undef;
&gt;&gt;&gt;
&gt;&gt;&gt; at the beginning of eval will solve the problem and don&#39;t affect the
&gt;&gt;&gt; overall workflow.
&gt;&gt;&gt;
&gt;&gt;&gt; On 23.10.2014 3:13, Karen Etheridge via RT wrote:
<div class="message-stanza open">&gt;&gt;&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On Wed, Oct 22, 2014 at 07:13:12PM -0400, dzagashev@gmail.com via RT wrote:
<div class="message-stanza open">&gt;&gt;&gt;&gt;&gt;        Queue: Moo
&gt;&gt;&gt;&gt;&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; It will be useful if Moo localize $SIG{__DIE__} in
&gt;&gt;&gt;&gt;&gt; Method::Generate::Accessor::_wrap_attr_exception.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; This will guarantee, that prefix will be added to error message in any case.
</div>&gt;&gt;&gt;&gt; Moo doesn&#39;t use a __DIE__ handler -- it uses an eval to catch and modify
&gt;&gt;&gt;&gt; the exception before passing it upwards.  If you are seeing these
&gt;&gt;&gt;&gt; exceptions unmodified, that suggests your handler is not checking $^S,
&gt;&gt;&gt;&gt; which is a problem in your code.  See &#39;perldoc -f die&#39; and &#39;perldoc
&gt;&gt;&gt;&gt; perlvar&#39;.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
</div>&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
</div></div>&gt;
&gt;
&gt;
&gt;
</div>
-- 
&#34;The surreality of the universe tends towards a maximum&#34; -- Skud&#39;s Law
&#34;Never formulate a law or axiom that you&#39;re not prepared to live with
 the consequences of.&#34;                              -- Skud&#39;s Meta-Law
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;23&nbsp;07:36:14&nbsp;2014</span>
    <span class="description">dzagashev [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #99733] Attribute name in the isa error message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 23 Oct 2014 14:34:15 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Moo [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;dzagashev [...] gmail.com&#34; &lt;dzagashev [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">That is what we need.

On 23.10.2014 14:30, &#40;Dagfinn Ilmari Mannsåker&#41; via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;
&gt; I&#39;ve implemented this in a branch:
&gt;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/moose/Moo/pull/11">https://github.com/moose/Moo/pull/11</a></span>
&gt;
&gt; As you can see from the tests, the global $SIG{__DIE__} handler still
&gt; gets called, but only once, with the final, wrapped exception.
&gt;
&gt; &#34;dzagashev@gmail.com via RT&#34; &lt;bug-Moo@rt.cpan.org&gt; writes:
&gt;
<div class="message-stanza open">&gt;&gt;        Queue: Moo
&gt;&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;&gt;
&gt;&gt; Global handler can, for example, log error message and exit process.
&gt;&gt; And in current case global handler receive die message without att into.
&gt;&gt; Localizing __DIE__ is more versatile approach, and guarantee, that attr
&gt;&gt; info will be added in any case.
&gt;&gt;
&gt;&gt; On 23.10.2014 13:06, &#40;Dagfinn Ilmari Mannsåker&#41; via RT wrote:
<div class="message-stanza open">&gt;&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Seeing as we always rethrow the error &#40;thus triggering any $SIG{__DIE__}
&gt;&gt;&gt; handler then&#41;, this makes sense.
&gt;&gt;&gt;
&gt;&gt;&gt; &#34;dzagashev@gmail.com via RT&#34; &lt;bug-Moo@rt.cpan.org&gt; writes:
&gt;&gt;&gt;
<div class="message-stanza open">&gt;&gt;&gt;&gt;        Queue: Moo
&gt;&gt;&gt;&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; I check $^S in my die handler, but this is not the case.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; The problem is that if global die handler used - code in your eval
&gt;&gt;&gt;&gt; &#40;after isa call&#41; never will be executed and has no chance to prepend
&gt;&gt;&gt;&gt; attribute information to error message.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Using of:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; local $SIG{__DIE__} = undef;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; at the beginning of eval will solve the problem and don&#39;t affect the
&gt;&gt;&gt;&gt; overall workflow.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; On 23.10.2014 3:13, Karen Etheridge via RT wrote:
<div class="message-stanza open">&gt;&gt;&gt;&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt; On Wed, Oct 22, 2014 at 07:13:12PM -0400, dzagashev@gmail.com via RT wrote:
<div class="message-stanza open">&gt;&gt;&gt;&gt;&gt;&gt;        Queue: Moo
&gt;&gt;&gt;&gt;&gt;&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; It will be useful if Moo localize $SIG{__DIE__} in
&gt;&gt;&gt;&gt;&gt;&gt; Method::Generate::Accessor::_wrap_attr_exception.
&gt;&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;&gt; This will guarantee, that prefix will be added to error message in any case.
</div>&gt;&gt;&gt;&gt;&gt; Moo doesn&#39;t use a __DIE__ handler -- it uses an eval to catch and modify
&gt;&gt;&gt;&gt;&gt; the exception before passing it upwards.  If you are seeing these
&gt;&gt;&gt;&gt;&gt; exceptions unmodified, that suggests your handler is not checking $^S,
&gt;&gt;&gt;&gt;&gt; which is a problem in your code.  See &#39;perldoc -f die&#39; and &#39;perldoc
&gt;&gt;&gt;&gt;&gt; perlvar&#39;.
&gt;&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;&gt;
</div>&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
</div></div>&gt;&gt;
&gt;&gt;
&gt;&gt;
</div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;24&nbsp;11:42:19&nbsp;2014</span>
    <span class="description">haarg [...] haarg.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">There are other uses of __DIE__ handlers that would be harmed by this change.  Having a __DIE__ handler that exits on any exception is pretty broken.  I don&#39;t see a good reason Moo should change its behavior here for a particular type of __DIE__ handler.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;24&nbsp;12:07:01&nbsp;2014</span>
    <span class="description">dzagashev [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #99733] Attribute name in the isa error message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 24 Oct 2014 19:06:39 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Moo [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;dzagashev [...] gmail.com&#34; &lt;dzagashev [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is more logical, that if Moo want to modify error message - he
should perform this modifications before message will be passed to any
other handlers.

On 24.10.2014 18:42, Graham Knop via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;
&gt; There are other uses of __DIE__ handlers that would be harmed by this change.  Having a __DIE__ handler that exits on any exception is pretty broken.  I don&#39;t see a good reason Moo should change its behavior here for a particular type of __DIE__ handler.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;24&nbsp;12:17:54&nbsp;2014</span>
    <span class="description">dzagashev [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #99733] Attribute name in the isa error message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 24 Oct 2014 19:17:33 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Moo [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;dzagashev [...] gmail.com&#34; &lt;dzagashev [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Usually __DIE__ handler used specifically for errors messages
processing, and it should retrieve fully qualified message.

On 24.10.2014 18:42, Graham Knop via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;
&gt; There are other uses of __DIE__ handlers that would be harmed by this change.  Having a __DIE__ handler that exits on any exception is pretty broken.  I don&#39;t see a good reason Moo should change its behavior here for a particular type of __DIE__ handler.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;24&nbsp;15:42:00&nbsp;2014</span>
    <span class="description">haarg [...] haarg.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Moo doesn&#39;t generate the error messages.

__DIE__ handlers always have to account for things like re-throwing or errors being caught.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;24&nbsp;18:32:11&nbsp;2014</span>
    <span class="description">dzagashev [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #99733] Attribute name in the isa error message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 25 Oct 2014 01:31:48 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Moo [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;dzagashev [...] gmail.com&#34; &lt;dzagashev [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m not saying that Moo generates errors messages.

__DIE__ handler handles errors and expects, that errors messages are
already fully qualified.

Or we should remember, that Moo can throw error twice, and for the first
time we should ignore this?

What the problem with local $SIG{__DIE__} in your case?

Can you describe it more specifically?

On 24.10.2014 22:42, Graham Knop via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;
&gt; Moo doesn&#39;t generate the error messages.
&gt;
&gt; __DIE__ handlers always have to account for things like re-throwing or errors being caught.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;28&nbsp;00:48:14&nbsp;2014</span>
    <span class="description">haarg [...] haarg.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Oct 24 18:32:11 2014, dzagashev@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m not saying that Moo generates errors messages.
&gt; 
&gt; __DIE__ handler handles errors and expects, that errors messages are
&gt; already fully qualified.
&gt; 
&gt; Or we should remember, that Moo can throw error twice, and for the
&gt; first
&gt; time we should ignore this?
&gt; 
&gt; What the problem with local $SIG{__DIE__} in your case?
&gt; 
&gt; Can you describe it more specifically?
&gt; 
&gt; On 24.10.2014 22:42, Graham Knop via RT wrote:
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt; &gt;
&gt; &gt; Moo doesn&#39;t generate the error messages.
&gt; &gt;
&gt; &gt; __DIE__ handlers always have to account for things like re-throwing
&gt; &gt; or errors being caught.
</div></div>
I have code that attaches stack traces to all exceptions when possible.  The only thing that really works for this is a __DIE__ hook.  And it is much less useful if it doesn&#39;t have access to the stack at the original location the error was triggered.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;28&nbsp;11:09:52&nbsp;2014</span>
    <span class="description">dzagashev [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #99733] Attribute name in the isa error message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 28 Oct 2014 17:09:33 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Moo [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;dzagashev [...] gmail.com&#34; &lt;dzagashev [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">My handler doing exactly the same.

We can call global handler manually and pass modified message, call
stack will be preserved:
   
eval {
        my $orig_die = $SIG{__DIE__};
       
        local $SIG{__DIE__} = sub {
            $orig_die-&gt;&#40; &#39;ATTRIBUTE_NAME_INFO&#39; . $_[0] &#41; if $orig_die;
        };

        ...;
};

On 28.10.2014 6:48, Graham Knop via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;
&gt; On Fri Oct 24 18:32:11 2014, dzagashev@gmail.com wrote:
<div class="message-stanza open">&gt;&gt; I&#39;m not saying that Moo generates errors messages.
&gt;&gt;
&gt;&gt; __DIE__ handler handles errors and expects, that errors messages are
&gt;&gt; already fully qualified.
&gt;&gt;
&gt;&gt; Or we should remember, that Moo can throw error twice, and for the
&gt;&gt; first
&gt;&gt; time we should ignore this?
&gt;&gt;
&gt;&gt; What the problem with local $SIG{__DIE__} in your case?
&gt;&gt;
&gt;&gt; Can you describe it more specifically?
&gt;&gt;
&gt;&gt; On 24.10.2014 22:42, Graham Knop via RT wrote:
<div class="message-stanza open">&gt;&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Moo doesn&#39;t generate the error messages.
&gt;&gt;&gt;
&gt;&gt;&gt; __DIE__ handlers always have to account for things like re-throwing
&gt;&gt;&gt; or errors being caught.
</div></div>&gt; I have code that attaches stack traces to all exceptions when possible.  The only thing that really works for this is a __DIE__ hook.  And it is much less useful if it doesn&#39;t have access to the stack at the original location the error was triggered.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;28&nbsp;11:54:25&nbsp;2014</span>
    <span class="description">haarg [...] haarg.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Not all exceptions that occur within an isa or coerce are exceptions that will be thrown outward.  They could be used for many different purposes.

There was already a previous bug report because we had been overriding __DIE__ and it was triggering in places it shouldn&#39;t have been.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;28&nbsp;12:09:32&nbsp;2014</span>
    <span class="description">dzagashev [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #99733] Attribute name in the isa error message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 28 Oct 2014 18:09:15 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Moo [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;dzagashev [...] gmail.com&#34; &lt;dzagashev [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Code, that I promote, simply duplicate standard perl functionality.

If there is parent die handler - it always will be called by perl before
exiting eval block.
Or it can be called manually from localized handler.

Conditions are  the same. I can&#39;t see any difference, which can affect
workflow.

On 28.10.2014 17:54, Graham Knop via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;
&gt; Not all exceptions that occur within an isa or coerce are exceptions that will be thrown outward.  They could be used for many different purposes.
&gt;
&gt; There was already a previous bug report because we had been overriding __DIE__ and it was triggering in places it shouldn&#39;t have been.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;28&nbsp;12:31:44&nbsp;2014</span>
    <span class="description">haarg [...] haarg.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Code inside the isa check may use exceptions for things other than to indicate an isa check failure.  Adding information about the attribute to an exception like this is an error.  The only exception that should have the attribute information added is one that reaches the isa check itself.  This can&#39;t be done with a __DIE__ handler.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;28&nbsp;13:19:57&nbsp;2014</span>
    <span class="description">dzagashev [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #99733] Attribute name in the isa error message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 28 Oct 2014 19:19:39 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Moo [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;dzagashev [...] gmail.com&#34; &lt;dzagashev [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">So, there is no working solution?

On 28.10.2014 18:31, Graham Knop via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99733">https://rt.cpan.org/Ticket/Display.html?id=99733</a></span> &gt;
&gt;
&gt; Code inside the isa check may use exceptions for things other than to indicate an isa check failure.  Adding information about the attribute to an exception like this is an error.  The only exception that should have the attribute information added is one that reaches the isa check itself.  This can&#39;t be done with a __DIE__ handler.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;17&nbsp;13:41:22&nbsp;2016</span>
    <span class="description">haarg [...] haarg.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I don&#39;t see any full solution for this.  __DIE__ handlers by nature have lots of pitfalls and we won&#39;t be able to satisfy all use cases.  Trying to wrap or bypass existing __DIE__ handlers in this case has more issues than I am comfortable with.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;May&nbsp;17&nbsp;13:41:40&nbsp;2016</span>
    <span class="description">haarg [...] haarg.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
