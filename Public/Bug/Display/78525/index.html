<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #78525 for IO-Socket-IP: Default AI_ADDRCONFIG flag in getaddrinfo</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #78525 for IO-Socket-IP: Default AI_ADDRCONFIG flag in getaddrinfo</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=IO-Socket-IP">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=IO-Socket-IP">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=IO-Socket-IP">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=IO-Socket-IP">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/IO-Socket-IP">IO-Socket-IP CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">78525</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=IO-Socket-IP">IO-Socket-IP</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
AVKHOZOV [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
avkhozov [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-234790-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.16    </td>
  </tr>
  <tr id="CF-234791-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.17    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




1.c<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1102292/579561/1.c">
Tue Jul 24 03:24:57 2012 (477b) by AVKHOZOV [...] cpan.org
</a>
</font></li>
</ul>


rt78525.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1102152/579492/rt78525.patch">
Mon Jul 23 14:30:43 2012 (1.6k) by leonerd-cpan [...] leonerd.org.uk
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=78525">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1101933" href="/Public/Bug/Display.html?id=78525#txn-1101933">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;23&nbsp;03:53:57&nbsp;2012</span>
    <span class="description">AVKHOZOV [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> avkhozov [...] gmail.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1101933/579355/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/579355">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello!

I&#39;m trying to create a listen socket for ipv6 with IO::Socket::IP in the following way:


and@google:~$ cat t.pl
#!/usr/bin/perl

use IO::Socket::IP;
IO::Socket::IP-&gt;new&#40;
        Family =&gt; AF_INET6,
        LocalHost =&gt; &#39;::1&#39;,
        LocalService =&gt; &#39;12345&#39;,
        Listen    =&gt; 1,
&#41; or die &#34;Cannot create socket - $@\n&#34;;

But I get the following error:

and@google:~$ perl t.pl 
Cannot create socket - Name or service not known
and@google:~$

I have been investigated this problem and found the source of a problem in getaddrinfo function in glibc. It returns an error if flag 
AI_ADDRCONFIG is set. I use the following test:


and@google:~$ cat 1.pl
#!/usr/bin/perl -w

use Socket;

my &#40;$err, @res&#41; = Socket::getaddrinfo&#40;&#39;::1&#39;, &#39;12345&#39;, {
        family =&gt; AF_INET6,
        protocol =&gt; Socket::IPPROTO_TCP,
        socktype =&gt; SOCK_STREAM,
        flags =&gt; Socket::AI_ADDRCONFIG&#40;&#41;
}&#41;;
warn $err if &#40;$err&#41;;
and@google:~$ perl 1.pl
Name or service not known at 1.pl line 11.
and@google:~$ 


If remove this flags, that is all work fine.


Some info about my library versions:


and@google:~$ perl -MSocket -le &#39;print $Socket::VERSION&#39;
2.002
and@google:~$ perl -MIO::Socket::IP -le &#39;print $IO::Socket::IP::VERSION&#39;
0.16
and@google:~$ perl -v

This is perl 5, version 12, subversion 4 &#40;v5.12.4&#41; built for x86_64-linux-gnu-thread-multi
&#40;with 45 registered patches, see perl -V for more detail&#41;
...
and@google:~$ apt-cache show libc6 | egrep -i &#34;^&#40;version|provides&#41;&#34;
Version: 2.13-20ubuntu5
Provides: glibc-2.13-1
Version: 2.13-20ubuntu5.1
Provides: glibc-2.13-1
and@google:~$ uname -a
Linux google 3.0.0-23-generic #38-Ubuntu SMP Fri Jul 6 14:43:30 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux
and@google:~$ 


May be do not use AI_ADDRCONFIG as a default flag while create a socket? &#40;$hints{flags} = &#40; $arg-&gt;{GetAddrInfoFlags} || 0 &#41; | $AI_ADDRCONFIG;&#41;
Very uncomfortable use PeerAddrInfo in new method.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1101937" href="/Public/Bug/Display.html?id=78525#txn-1101937">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;23&nbsp;03:58:09&nbsp;2012</span>
    <span class="description">AVKHOZOV [...] cpan.org -  Subject changed from &#40;no value&#41; to &#39;Default AI_ADDRCONFIG flag in getaddrinfo&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1102149" href="/Public/Bug/Display.html?id=78525#txn-1102149">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;23&nbsp;14:24:55&nbsp;2012</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1102149/579488/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/579488">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jul 23 03:53:57 2012, AVKHOZOV wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have been investigated this problem and found the source of a
&gt; problem in getaddrinfo function in glibc. It returns an error if flag
&gt; AI_ADDRCONFIG is set. I use the following test:
&gt; 
&gt; 
&gt; and@google:~$ cat 1.pl
&gt; #!/usr/bin/perl -w
&gt; 
&gt; use Socket;
&gt; 
&gt; my &#40;$err, @res&#41; = Socket::getaddrinfo&#40;&#39;::1&#39;, &#39;12345&#39;, {
&gt;       family =&gt; AF_INET6,
&gt;       protocol =&gt; Socket::IPPROTO_TCP,
&gt;       socktype =&gt; SOCK_STREAM,
&gt;       flags =&gt; Socket::AI_ADDRCONFIG&#40;&#41;
&gt; }&#41;;
&gt; warn $err if &#40;$err&#41;;
&gt; and@google:~$ perl 1.pl
&gt; Name or service not known at 1.pl line 11.
</div>
I&#39;m afraid I&#39;m not able to reproduce it from here:

$ cat 1.pl 
#!/usr/bin/perl -w

use Socket;

my &#40;$err, @res&#41; = Socket::getaddrinfo&#40;&#39;::1&#39;, &#39;12345&#39;, {
        family =&gt; AF_INET6,
        protocol =&gt; Socket::IPPROTO_TCP,
        socktype =&gt; SOCK_STREAM,
        flags =&gt; Socket::AI_ADDRCONFIG&#40;&#41;
}&#41;;
warn $err if &#40;$err&#41;;
use Data::Dump &#39;pp&#39;;
print &#39;@res=&#39;, pp&#40;@res&#41;, &#34;\n&#34;;

$ perl 1.pl 
@res={
  addr      =&gt; 
pack&#40;&#34;H*&#34;,&#34;0a003039000000000000000000000000000000000000000100000000&#34;&#41;,
  canonname =&gt; undef,
  family    =&gt; 10,
  protocol  =&gt; 6,
  socktype  =&gt; 1,
}


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; and@google:~$ perl -MSocket -le &#39;print $Socket::VERSION&#39;
&gt; 2.002
</div>
2.002

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; and@google:~$ perl -v
&gt; 
&gt; This is perl 5, version 12, subversion 4 &#40;v5.12.4&#41; built for x86_64-
&gt; linux-gnu-thread-multi
&gt; &#40;with 45 registered patches, see perl -V for more detail&#41;
&gt; ...
</div>
$ perl -v

This is perl 5, version 14, subversion 2 &#40;v5.14.2&#41; built for x86_64-
linux-gnu-thread-multi
&#40;with 61 registered patches, see perl -V for more detail&#41;
...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; and@google:~$ apt-cache show libc6 | egrep -i &#34;^&#40;version|provides&#41;&#34;
&gt; Version: 2.13-20ubuntu5
&gt; Provides: glibc-2.13-1
&gt; Version: 2.13-20ubuntu5.1
&gt; Provides: glibc-2.13-1
</div>
Ah; apt-cache only shows what is available, not what&#39;s installed. But 
for me this is:

$ dpkg -l libc6
...
ii  libc6:amd64                      2.13-33                          
Embedded GNU C Library: Shared libraries


I wonder though, what your IPv4 and IPv6 address lists look like. I 
have:

$ ip -4 addr
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue state UNKNOWN 
    inet 127.0.0.1/8 scope host lo
2: wired: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc pfifo_fast 
state UP qlen 1000
    inet 192.168.42.2/24 brd 192.168.42.255 scope global wired
    inet 81.187.167.226/28 scope global wired
    inet 81.187.167.235/32 scope global wired
    inet 225.0.0.1/24 scope global wired

$ ip -6 addr
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: wired: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qlen 1000
    inet6 2001:8b0:3f7::2/112 scope global 
       valid_lft forever preferred_lft forever
    inet6 fe80::52e5:49ff:fe55:a368/64 scope link 
       valid_lft forever preferred_lft forever


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; May be do not use AI_ADDRCONFIG as a default flag while create a
&gt; socket? &#40;$hints{flags} = &#40; $arg-&gt;{GetAddrInfoFlags} || 0 &#41; |
&gt; $AI_ADDRCONFIG;&#41;
</div>
Ahyes, perhaps that&#39;s a point - only add the flag if none supplied; but 
don&#39;t add it to the flags already given. I&#39;ll do that.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1102151" href="/Public/Bug/Display.html?id=78525#txn-1102151">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;23&nbsp;14:24:56&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1102152" href="/Public/Bug/Display.html?id=78525#txn-1102152">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;23&nbsp;14:30:43&nbsp;2012</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1102152/579491/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/579491">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 328b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jul 23 03:53:57 2012, AVKHOZOV wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; May be do not use AI_ADDRCONFIG as a default flag while create a
&gt; socket? &#40;$hints{flags} = &#40; $arg-&gt;{GetAddrInfoFlags} || 0 &#41; |
&gt; $AI_ADDRCONFIG;&#41;
</div>
See attached patch.

If you pass

  GetAddrInfoFlags =&gt; 0

explicitly, it won&#39;t set the AI_ADDRCONFIG flag any more.

-- 

Paul Evans
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> rt78525.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1102152/579492/rt78525.patch">Download rt78525.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">=== modified file &#39;lib/IO/Socket/IP.pm&#39;
--- lib/IO/Socket/IP.pm	2012-06-24 14:03:53 +0000
+++ lib/IO/Socket/IP.pm	2012-07-23 18:29:42 +0000
@@ -235,10 +235,12 @@
 
 =item GetAddrInfoFlags =&gt; INT
 
-More flags to pass to the C&lt;getaddrinfo&#40;&#41;&gt; function. These flags will be
-combined with C&lt;AI_ADDRCONFIG&gt;, and if the C&lt;Listen&gt; argument is given,
-C&lt;AI_PASSIVE&gt;. For more information see the documentation about
-C&lt;getaddrinfo&#40;&#41;&gt; in the L&lt;Socket&gt; module.
+More flags to pass to the C&lt;getaddrinfo&#40;&#41;&gt; function. If not supplied, a
+default of C&lt;AI_ADDRCONFIG&gt; will be used.
+
+These flags will be combined with C&lt;AI_PASSIVE&gt; if the C&lt;Listen&gt; argument is
+given. For more information see the documentation about C&lt;getaddrinfo&#40;&#41;&gt; in
+the L&lt;Socket&gt; module.
 
 =item Listen =&gt; INT
 
@@ -371,7 +373,12 @@
    my @localinfos;
    my @peerinfos;
 
-   $hints{flags} = &#40; $arg-&gt;{GetAddrInfoFlags} || 0 &#41; | $AI_ADDRCONFIG;
+   if&#40; defined $arg-&gt;{GetAddrInfoFlags} &#41; {
+      $hints{flags} = $arg-&gt;{GetAddrInfoFlags};
+   }
+   else {
+      $hints{flags} = $AI_ADDRCONFIG;
+   }
 
    if&#40; defined&#40; my $family = $arg-&gt;{Family} &#41; &#41; {
       $hints{family} = $family;

=== modified file &#39;t/17gai-flags.t&#39;
--- t/17gai-flags.t	2012-06-20 12:15:02 +0000
+++ t/17gai-flags.t	2012-07-23 18:29:42 +0000
@@ -55,7 +55,7 @@
 
    is_deeply&#40; \@gai_args,
               [ 
-                 [ undef, &#34;80&#34;, { flags =&gt; AI_PASSIVE|AI_NUMERICSERV|$AI_ADDRCONFIG, socktype =&gt; SOCK_STREAM, protocol =&gt; IPPROTO_TCP } ],
+                 [ undef, &#34;80&#34;, { flags =&gt; AI_PASSIVE|AI_NUMERICSERV, socktype =&gt; SOCK_STREAM, protocol =&gt; IPPROTO_TCP } ],
               ],
               &#39;@gai_args for LocalPort =&gt; &#34;80&#34;, GetAddrInfoFlags =&gt; AI_NUMERICSERV&#39; &#41;;
 }

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1102292" href="/Public/Bug/Display.html?id=78525#txn-1102292">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;24&nbsp;03:24:57&nbsp;2012</span>
    <span class="description">AVKHOZOV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> avkhozov [...] gmail.com</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1102292/579560/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/579560">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jul 23 14:30:43 2012, PEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; See attached patch.
&gt; 
&gt; If you pass
&gt; 
&gt;   GetAddrInfoFlags =&gt; 0
&gt; 
&gt; explicitly, it won&#39;t set the AI_ADDRCONFIG flag any more.
</div>

Yes, all work fine with this patch. Thanks! I will be wait for new release of IO::Socket::IP.


I continued to investigate the problem with next example:

$ cat 1.c
#include &lt;sys/types.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;netdb.h&gt;

int main&#40;&#41; {
        struct addrinfo hints;
        struct addrinfo *res;
        memset&#40;&#38;hints, 0, sizeof&#40;struct addrinfo&#41;&#41;;
        hints.ai_family = PF_INET6;
        hints.ai_socktype = SOCK_STREAM;
        hints.ai_flags = AI_ADDRCONFIG;
        hints.ai_protocol = 6;
        int ret = getaddrinfo&#40;&#34;::1&#34;, &#34;12345&#34;, &#38;hints, &#38;res&#41;;
        if &#40;ret != 0&#41; {
                fprintf&#40;stderr, &#34;getaddrinfo: %s\n&#34;, gai_strerror&#40;ret&#41;&#41;;
        }
        return 0;
}
$ 

and get the following results:

1&#41;
Ubutntu 12.04
$ dpkg -l libc6 | grep ii
ii  libc6                                  2.15-0ubuntu10                          Embedded GNU C Library: Shared 
libraries
$ uname -a
Linux x200 3.2.0-26-generic #41-Ubuntu SMP Thu Jun 14 17:49:24 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux
$ gcc -o 1 1.c &#38;&#38; ./1 
getaddrinfo: Name or service not known
$ ip -6 addr
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
3: wlan0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qlen 1000
    inet6 fe80::216:ebff:fe15:6d52/64 scope link tentative dadfailed 
       valid_lft forever preferred_lft forever
$

2&#41;
Ubuntu 11.10
$ dpkg -l libc6 | grep ii
ii  libc6                                  2.13-20ubuntu5.1                           Embedded GNU C Library: Shared 
libraries
$ uname -a
Linux google 3.0.0-23-generic #38-Ubuntu SMP Fri Jul 6 14:43:30 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux
$ gcc -o 1 1.c &#38;&#38; ./1
getaddrinfo: Name or service not known
$ ip -6 addr
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436Â 
Â  Â  inet6 ::1/128 scope hostÂ 
Â  Â  Â  Â valid_lft forever preferred_lft forever
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qlen 1000
Â  Â  inet6 fe80::e269:95ff:fe99:a961/64 scope linkÂ 
Â  Â  Â  Â valid_lft forever preferred_lft forever
$Â 

3&#41;
Debian 6.0.5

# dpkg -l libc6 | grep ii
ii  libc6                               2.11.3-3                     Embedded GNU C Library: Shared libraries
# uname -a
Linux debian 2.6.32-5-amd64 #1 SMP Sun May 6 04:00:17 UTC 2012 x86_64 GNU/Linux
# gcc -o 1 1.c &#38;&#38; ./1 
# ip -6 addr
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qlen 1000
    inet6 fe80::a00:27ff:feed:fc2e/64 scope link 
       valid_lft forever preferred_lft forever
# 


Found that the problem was not up to version glibc 2.11.3-3 and appeared after version 2.13-20.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 1.c</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1102292/579561/1.c">Download 1.c</a><br />
<span class="downloadcontenttype">text/x-csrc 477b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#include &lt;sys/types.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;netdb.h&gt;

int main&#40;&#41; {
	struct addrinfo hints;
	struct addrinfo *res;
	memset&#40;&#38;hints, 0, sizeof&#40;struct addrinfo&#41;&#41;;
	hints.ai_family = PF_INET6;
	hints.ai_socktype = SOCK_STREAM;
	hints.ai_flags = AI_ADDRCONFIG;
	hints.ai_protocol = 6;
	int ret = getaddrinfo&#40;&#34;::1&#34;, &#34;12345&#34;, &#38;hints, &#38;res&#41;;
	if &#40;ret != 0&#41; {
		fprintf&#40;stderr, &#34;getaddrinfo: %s\n&#34;, gai_strerror&#40;ret&#41;&#41;;
	}
	return 0;
}
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1148887" href="/Public/Bug/Display.html?id=78525#txn-1148887">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;29&nbsp;19:04:49&nbsp;2012</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1148887/604200/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/604200">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 77b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This was released in 0.17 but I forgot to update the ticket.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1148889" href="/Public/Bug/Display.html?id=78525#txn-1148889">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;29&nbsp;19:04:49&nbsp;2012</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1148891" href="/Public/Bug/Display.html?id=78525#txn-1148891">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;29&nbsp;19:04:58&nbsp;2012</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Fixed in 0.17 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.507348</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
