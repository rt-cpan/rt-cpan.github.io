<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #62617 for Parse-BBCode: Multiple XSS security issues</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #62617 for Parse-BBCode: Multiple XSS security issues</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Parse-BBCode/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Parse-BBCode/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Parse-BBCode/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Parse-BBCode/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Parse-BBCode">Parse-BBCode CPAN distribution</a>.</p>


<h3>Maintainer&#40;s&#41;&#39; notes</h3>

<p><p>If you have any wishes, feel free to create a ticket.</p>

<p>Plans:</p>

<p>I would like to add callbacks to the parser so that you can gather some information about specific tags and ideally can manipulate them during parsing.</p>

<p>But there are already enough informations to create a download link for code tags, for example. See example/code_download.pl.
</p>
<p>
Parse::BBCode is now hosted on github, so for bug reports also check
<a href="https://github.com/perlpunk/Parse-BBCode">https://github.com/perlpunk/Parse-BBCode</a>
</p></p>



<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">62617</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Parse-BBCode/Active/">Parse-BBCode</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">TINITA [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
sflex [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-222034-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
0.03</li>
<li>
0.04</li>
<li>
0.05</li>
<li>
0.06</li>
<li>
0.07</li>
<li>
0.08</li>
<li>
0.09</li>
<li>
0.10</li>
<li>
0.11</li>
</ul>
    </td>
  </tr>
  <tr id="CF-222035-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.12    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;01&nbsp;08:47:36&nbsp;2010</span>
    <span class="description">sflex [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Multiple XSS security issues</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The security you are using to stop JavaScript can be bypassed!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;16&nbsp;06:55:03&nbsp;2010</span>
    <span class="description">TINITA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Am Mo 01. Nov 2010, 08:47:36, SFLEX schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The security you are using to stop JavaScript can be bypassed!
</div>
sflex, you got so much help with your own module on perlmonks, you even 
copied my benchmark script into your package with a few changes without 
mentioning.

you think you are cool by creating bug reports without telling details?

you&#39;re rating your own module, seeking for help/advice on perlmonks 
regularly, but you haven&#39;t learned giving back to the community. you 
don&#39;t even care when a number of people is telling you that you 
shouldn&#39;t rate your own module.

and now you are telling me my module has bugs but don&#39;t tell me which.

you&#39;re such a great help, sflex!
community can be glad it has such a generous member.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;16&nbsp;06:55:04&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;16&nbsp;07:29:27&nbsp;2010</span>
    <span class="description">sflex [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Nov 16 06:55:03 2010, TINITA wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Am Mo 01. Nov 2010, 08:47:36, SFLEX schrieb:
<div class="message-stanza open">&gt; &gt; The security you are using to stop JavaScript can be bypassed!
</div>&gt; 
&gt; sflex, you got so much help with your own module on perlmonks, you 
</div>even 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; copied my benchmark script into your package with a few changes 
</div>without 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; mentioning.
&gt; 
&gt; you think you are cool by creating bug reports without telling 
</div>details?
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; you&#39;re rating your own module, seeking for help/advice on perlmonks 
&gt; regularly, but you haven&#39;t learned giving back to the community. you 
&gt; don&#39;t even care when a number of people is telling you that you 
&gt; shouldn&#39;t rate your own module.
&gt; 
&gt; and now you are telling me my module has bugs but don&#39;t tell me which.
&gt; 
&gt; you&#39;re such a great help, sflex!
&gt; community can be glad it has such a generous member.
</div>
It took you 16 days before you read this bug and I had to tell you at 
perlmonks to look at your modules bug report. So for 16 day&#39;s and more 
the full exploit could have been sitting here for every hacker to see 
and all your users of this module would be even more at risk. But since 
I was more thoughtful then you seem to think I am. i was just waiting 
for you to ask me &#34;how to do it&#34;.

Instead you rant about things that are unproductive and maybe in your 
mind will try to make me mad. If you remember my first post for Bench 
this BBcode at perlmonks I gave you credit for the bench code that some 
other monk helped you with but you want credit for it when I use it in 
my module&#39;s example folder.

You have already rated your own module because you lie in the file 
compare.html about other modules that you cant use to well or have a 
bias opinion of other modules like my AUBBC.

Like I said in Bench this BBcode, &#34;I would like to help the other 
bbcode authors of Perl.&#34; But after having to deal with you. You can 
stay under you little rock and dwell on the past. Your really good at 
that, trust me.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;16&nbsp;08:27:16&nbsp;2010</span>
    <span class="description">TINITA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">ok, so I take that as &#34;cannot deliver details&#34;.
no bug, no fix.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; You have already rated your own module because you lie in the file 
&gt; compare.html about other modules that you cant use to well or have a 
&gt; bias opinion of other modules like my AUBBC.
</div>
my comparison is as objective as possible and it says that anybody should 
feel free to correct anything in the comparison that seems wrong, and 
I&#39;ll have a look at it.

if you have any concrete objection to that comparison open a bug report 
and post details.

thank you very much for your patience and have fun with AUBBC.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;16&nbsp;08:27:38&nbsp;2010</span>
    <span class="description">TINITA [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;16&nbsp;17:46:13&nbsp;2010</span>
    <span class="description">sflex [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Nov 16 08:27:16 2010, TINITA wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ok, so I take that as &#34;cannot deliver details&#34;.
&gt; no bug, no fix.
&gt; 
<div class="message-stanza open">&gt; &gt; You have already rated your own module because you lie in the file 
&gt; &gt; compare.html about other modules that you cant use to well or have 
</div></div>a 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; bias opinion of other modules like my AUBBC.
</div>&gt; 
&gt; my comparison is as objective as possible and it says that anybody 
</div>should 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; feel free to correct anything in the comparison that seems wrong, and 
&gt; I&#39;ll have a look at it.
&gt; 
&gt; if you have any concrete objection to that comparison open a bug 
</div>report 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; and post details.
&gt; 
&gt; thank you very much for your patience and have fun with AUBBC.
</div>
You are not much of a CPAN author if your going to reject a security 
issue with your own program. Don&#39;t think you can delete this report 
because you actually do have a security hole and all I was waiting for 
was you to simply ask me to show you how its done. Instead I think I 
will wait for you to apologize to me before I show you how your module 
can be hacked and if you feel the want to reject this post, well....
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;16&nbsp;17:46:14&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;17&nbsp;06:45:27&nbsp;2010</span>
    <span class="description">TINITA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">If there is a bug, just show it.

Your behaviour on perlmonks was so disgusting that you have no right at 
all to demand an apology from me. What kind of world do you think you 
live in? A world where you are free to offend others, but others are 
required to apologize?

You had several chances to remove your cpanrating.
If you don&#39;t post the bug, I cannot fix it. Plain, simple. And if you 
don&#39;t want to post it, then leave me alone. I don&#39;t know why you are 
stalking me since that one posting on perlmonks where I said it&#39;s 
considered unpolite to rate your own module.

If you don&#39;t post it, then I believe that you are lying. What reason 
would you have to not post a bug?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;17&nbsp;06:48:41&nbsp;2010</span>
    <span class="description">TINITA [...] cpan.org -  Subject changed from &#39;Multiple XSS security issues&#39; to &#39;Multiple XSS security issues &#40;but I won&#39;t tell&#41;&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Give odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;17&nbsp;06:49:56&nbsp;2010</span>
    <span class="description">TINITA [...] cpan.org -  Given to TINITA</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;07&nbsp;09:36:08&nbsp;2011</span>
    <span class="description">sflex [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> It was to easy to find in the first place!</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This hack is so basic I cant believe you didn&#39;t come across it yourself.
Here is the hack below:
[img]jav&#38;#x09;ascript:alert&#40;String.fromCharCode&#40;88,83,83&#41;&#41;[/img]
[img]jav&#38;#x0D;ascript:alert&#40;String.fromCharCode&#40;88,83,83&#41;&#41;[/img]

[url=jav&#38;#x0D;ascript:alert&#40;String.fromCharCode&#40;88,83,83&#41;&#41;]Look what I 
can do![/url]
[url=jav&#38;#x09;ascript:alert&#40;String.fromCharCode&#40;88,83,83&#41;&#41;]Look what I 
can do![/url]

My suggested fix for this issue:
Changes to file &#39;lib/Parse/BBCode/HTML.pm&#39; File version &#39;0.04&#39;
Starts at about line 64

    # XSS Fix
    link =&gt; sub {
        my &#40;$p, $tag, $var&#41; = @_;
        $var = Parse::BBCode::escape_html&#40;$var&#41;;
        $var =~ m{\A\w+://|/}i
         ? return $var
         : return &#39;&#39;;
    },

This fix will now stop any JavaScript plus allow local linking like:
[img]/images/some.gif[/img]

For href&#39;s you need to specify a protocol like http, ftp for it to be 
valid.
This is why you do not want to use the same filter for the image tag 
and url tag. the image HTML element uses &#39;src&#39; and the url uses &#39;href&#39; 
these two attributes have different functions. For example image allows 
protocol:// and /local paths where href only allows protocol://
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> HTML.pm</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">package Parse::BBCode::HTML;
# %{link}A XSS fix, by N.K.A.
use strict;
use warnings;
use Data::Dumper;
use Carp qw&#40;croak carp&#41;;
use URI::Escape;
use base &#39;Exporter&#39;;
our @EXPORT_OK = qw/ &#38;defaults &#38;default_escapes &#38;optional /;

our $VERSION = &#39;0.04&#39;;
my $email_valid = 0;
eval {
    require
        Email::Valid;
};
$email_valid = 1 unless $@;

my %default_tags = &#40;
    &#39;b&#39;     =&gt; &#39;&lt;b&gt;%s&lt;/b&gt;&#39;,
    &#39;i&#39;     =&gt; &#39;&lt;i&gt;%s&lt;/i&gt;&#39;,
    &#39;u&#39;     =&gt; &#39;&lt;u&gt;%s&lt;/u&gt;&#39;,
    &#39;img&#39;   =&gt; &#39;&lt;img src=&#34;%{link}A&#34; alt=&#34;[%{html}s]&#34; title=&#34;%{html}s&#34;&gt;&#39;,
    &#39;url&#39;   =&gt; &#39;url:&lt;a href=&#34;%{link}A&#34; rel=&#34;nofollow&#34;&gt;%s&lt;/a&gt;&#39;,
    &#39;email&#39; =&gt; &#39;url:&lt;a href=&#34;mailto:%{email}A&#34;&gt;%s&lt;/a&gt;&#39;,
    &#39;size&#39;  =&gt; &#39;&lt;span style=&#34;font-size: %{num}a&#34;&gt;%s&lt;/span&gt;&#39;,
    &#39;color&#39; =&gt; &#39;&lt;span style=&#34;color: %{htmlcolor}a&#34;&gt;%s&lt;/span&gt;&#39;,
    &#39;list&#39;  =&gt; {
        parse =&gt; 1,
        class =&gt; &#39;block&#39;,
        code =&gt; sub {
            my &#40;$parser, $attr, $content, $attribute_fallback, $tag&#41; = @_;
            $$content =~ s/^\n+//;
            $$content =~ s/\n+\z//;
            return &#34;&lt;ul&gt;$$content&lt;/ul&gt;&#34;;
        },
    },
    &#39;*&#39; =&gt; {
        parse =&gt; 1,
        code =&gt; sub {
            my &#40;$parser, $attr, $content, $attribute_fallback, $tag&#41; = @_;
            $$content =~ s/\n+\z//;
            return &#34;&lt;li&gt;$$content&lt;/li&gt;&#34;,
        },
        close =&gt; 0,
        class =&gt; &#39;block&#39;,
    },
    &#39;quote&#39; =&gt; &#39;block:&lt;div class=&#34;bbcode_quote_header&#34;&gt;%{html}a:
&lt;div class=&#34;bbcode_quote_body&#34;&gt;%s&lt;/div&gt;&lt;/div&gt;&#39;,
    &#39;code&#39;  =&gt; &#39;block:&lt;div class=&#34;bbcode_code_header&#34;&gt;%{html}a:
&lt;div class=&#34;bbcode_code_body&#34;&gt;%{html}s&lt;/div&gt;&lt;/div&gt;&#39;,
    &#39;noparse&#39; =&gt; &#39;%{html}s&#39;,
&#41;;
my %optional_tags = &#40;
    &#39;html&#39; =&gt; &#39;%{noescape}s&#39;,
&#41;;

my %default_escapes = &#40;
    html =&gt; sub {
        Parse::BBCode::escape_html&#40;$_[2]&#41;,
    },
    uri =&gt; sub {
        uri_escape&#40;$_[2]&#41;,
    },
    link =&gt; sub {
        my &#40;$p, $tag, $var&#41; = @_;
        $var = Parse::BBCode::escape_html&#40;$var&#41;;
        $var =~ m{\A\w+://|/}i
         ? return $var
         : return &#39;&#39;;
    },
    email =&gt; $email_valid ? sub {
        my &#40;$p, $tag, $var&#41; = @_;
        # extracts the address part of the email or undef
        my $valid = Email::Valid-&gt;address&#40;$var&#41;;
        return $valid ? Parse::BBCode::escape_html&#40;$valid&#41; : &#39;&#39;;
    } : sub {
        my &#40;$p, $tag, $var&#41; = @_;
        $var = Parse::BBCode::escape_html&#40;$var&#41;;
    },
    htmlcolor =&gt; sub {
        $_[2] =~ m/^&#40;?:[a-z]+|#[0-9a-f]{6}&#41;\z/ ? $_[2] : &#39;inherit&#39;
    },
    num =&gt; sub {
        $_[2] =~ m/^[0-9]+\z/ ? $_[2] : 0;
    },
&#41;;


sub defaults {
    my &#40;$class, @keys&#41; = @_;
    return @keys
        ? &#40;map { $_ =&gt; $default_tags{$_} } grep { defined $default_tags{$_} } @keys&#41;
        : %default_tags;
}

sub default_escapes {
    my &#40;$class, @keys&#41; = @_;
    return @keys
        ? &#40;map { $_ =&gt; $default_escapes{$_} } grep  { defined $default_escapes{$_} } @keys&#41;
        : %default_escapes;
}

sub optional {
    my &#40;$class, @keys&#41; = @_;
    return @keys ? &#40;grep defined, @optional_tags{@keys}&#41; : %optional_tags;
}



1;

__END__

=pod

=head1 NAME

Parse::BBCode::HTML - Provides HTML defaults for Parse::BBCode

=head1 SYNOPSIS

    use Parse::BBCode;
    # my $p = Parse::BBCode-&gt;new&#40;&#41;;
    my $p = Parse::BBCode-&gt;new&#40;{
        tags =&gt; {
            Parse::BBCode::HTML-&gt;defaults,
            # add your own tags here if needed
        },
        escapes =&gt; {
            Parse::BBCode::HTML-&gt;default_escapes,
            # add your own escapes here if needed
        },
    }&#41;;
    my $code = &#39;some [b]b code[/b]&#39;;
    my $parsed = $p-&gt;render&#40;$code&#41;;

=head1 METHODS

=over 4

=item defaults

Returns a hash with default tags.

    b, i, u, img, url, email, size, color, list, *, quote, code

=item default_escapes

Returns a hash with escaping functions. These are:

    html, uri, link, email, htmlcolor, num

=item optional

Returns a hash of optional tags. These are:

    html

=back

=cut

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;10&nbsp;12:26:25&nbsp;2011</span>
    <span class="description">TINITA [...] cpan.org -  Subject changed from &#39;Multiple XSS security issues &#40;but I won&#39;t tell&#41;&#39; to &#39;Multiple XSS security issues&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;10&nbsp;12:26:40&nbsp;2011</span>
    <span class="description">TINITA [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;May&nbsp;10&nbsp;12:26:40&nbsp;2011</span>
    <span class="description">TINITA [...] cpan.org -  Fixed in 0.12 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
