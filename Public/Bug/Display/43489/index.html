<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #43489 for Pod-Simple: Verbatim Indents</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #43489 for Pod-Simple: Verbatim Indents</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Pod-Simple/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Pod-Simple/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Pod-Simple/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Pod-Simple/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/perl-pod/pod-simple/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Pod-Simple">Pod-Simple CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">43489</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Pod-Simple/Active/">Pod-Simple</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dwheeler [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-26176-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-26177-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;21&nbsp;01:22:30&nbsp;2009</span>
    <span class="description">dwheeler [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Verbatim Indents</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 20 Feb 2009 22:22:04 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-pod-simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Howdy,

I noticed that when I ran `perldoc -MPod::Simple::XHTML` on a script,  
verbatim blocks of code were incorrectly indented:

&lt;pre&gt;&lt;code&gt;    -- Start transaction and plan the tests.
     BEGIN;
     SELECT plan&#40;1&#41;;

     -- Run the tests.
     SELECT pass&#40; &#38;#39;My test passed, w00t!&#38;#39; &#41;;

     -- Finish the tests and clean up.
     SELECT * FROM finish&#40;&#41;;
     ROLLBACK;&lt;/code&gt;&lt;/pre&gt;

This is annoying, because, in HTML output at least, that space gets  
stuck in front of every single line. It seems to me that, unless  
someone is using VerbatimFormatted codes, every line of a verbatim  
block should have that extra spacing stripped out. The only reasonable  
way I can think of to determine how much white space should be  
stripped out is to base it off the number of spaces before the first  
line in a block.

The attached patch does this, and updates all the tests to reflect the  
change. I assume that anyone using VerbatimFormatted codes, however,  
knows what they&#39;re doing and can strip off such spacing themselves.

I looked in perlpod, and saw no mention of this, but it does seem to  
me to be the only sane way to handle this. What do you think?

Thanks,

David
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"></div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;29&nbsp;18:46:37&nbsp;2009</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Bump!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;19&nbsp;23:33:26&nbsp;2009</span>
    <span class="description">ARANDAL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The perlpod spec for a Verbatim paragraph is &#34;It should be reproduced
exactly...&#34; which means we can&#39;t automatically strip spaces for
everyone. And, relying on the first line of the code example as an
indicator of what to strip is a risky heuristic, someone might have
broken a larger code example over several blocks between explanation
paragraphs.

But, a feature to strip spaces from verbatim paragraphs can be added as
an option that&#39;s off by default. Since most code-bases use a consistent
indentation strategy, the option can specify how many spaces to remove,
something like:

  $new-&gt;strip_verbatim_indent&#40;4&#41;;

&#40;With sensible checks that it&#39;s actually spaces being stripped.&#41;

Allison
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;19&nbsp;23:33:27&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;20&nbsp;17:05:08&nbsp;2009</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43489] Verbatim Indents </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 20 Aug 2009 14:04:46 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Pod-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Aug 19, 2009, at 8:33 PM, ARANDAL via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The perlpod spec for a Verbatim paragraph is &#34;It should be reproduced
&gt; exactly...&#34; which means we can&#39;t automatically strip spaces for
&gt; everyone.
</div>
It&#39;s unfortunate that the spec forces one to use syntax without any  
semantics and then preserve that syntax as if it were semantic. :-&#40; Is  
Perl 6&#39;s Pod like this?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; And, relying on the first line of the code example as an
&gt; indicator of what to strip is a risky heuristic, someone might have
&gt; broken a larger code example over several blocks between explanation
&gt; paragraphs.
</div>
Yes, the code should preserve that number for consecutive verbatim  
blocks, I agree with you there.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; But, a feature to strip spaces from verbatim paragraphs can be added  
&gt; as
&gt; an option that&#39;s off by default. Since most code-bases use a  
&gt; consistent
&gt; indentation strategy, the option can specify how many spaces to  
&gt; remove,
&gt; something like:
&gt;
&gt;  $new-&gt;strip_verbatim_indent&#40;4&#41;;
&gt;
&gt; &#40;With sensible checks that it&#39;s actually spaces being stripped.&#41;
</div>
Hrm. Ever worked on a project with a bunch of developers? Although  
Bricolage evolved some style standards for documentation, the number  
of spaces to use before verbatim code wasn&#39;t one of them, and  
different developers seem to prefer different numbers. It&#39;s irritating.

I support the idea of having it off by default and enable-able, with  
the ability to specify what to strip off. I was thinking of telling it  
what to strip, so you could do:

     $new-&gt;strip_verbatim_indent&#40;&#39;    &#39;&#41;;

Or

     $new-&gt;strip_verbatim_indent&#40;&#34;\t&#34;&#41;;

For example. But I&#39;d also like to be able to support a heuristic. What  
if I also allow a code ref to be passed that can calculate the  
heuristic. It would be passed the verbatim text and would return the  
bit to strip off. So in addition to the above approaches, you could do  
this to re-create the first-line heuristic in userland:

     $new-&gt;strip_verbatim_indent&#40;sub {
         my $para = shift;
         &#40;my $spaces = $para-&gt;[2]&#41; =~ s/\S.*//;
         return $spaces;
     }&#41;;

Does that make sense to you? It could also perhaps do something to  
determine whether the verbatim blocks are successive, and therefore  
fallback on the previous return value. The only downside is that the  
first to elements of the `$para` argument are not the paragraph data.  
I could shift that stuff off, though, I guess, and shift it back on  
afterwards.

Thoughts?

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;20&nbsp;18:48:44&nbsp;2009</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I went ahead and implemented this. Patch attached. I think it covers all the cases. Notably, 
Pod::Simple already includes successively-indented blocks in single verbatim &#34;paragraphs&#34;, so 
the case where a heuristic is used already covers that case.

What do you think? The code is actually quite simple, most of the patch being tests and 
documentation.

Best,

David
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: t/strip_verbatim_indent.t
===================================================================
--- t/strip_verbatim_indent.t	&#40;revision 0&#41;
+++ t/strip_verbatim_indent.t	&#40;revision 0&#41;
@@ -0,0 +1,111 @@
+#!/usr/bin/perl -w
+
+# t/strip_verbatim_indent.t.t - check verabtim indent stripping feature
+
+BEGIN {
+    chdir &#39;t&#39; if -d &#39;t&#39;;
+}
+
+use strict;
+use lib &#39;../lib&#39;;
+#use Test::More tests =&gt; 71;
+use Test::More &#39;no_plan&#39;;
+
+use_ok&#40;&#39;Pod::Simple::XHTML&#39;&#41; or exit;
+use_ok&#40;&#39;Pod::Simple::XMLOutStream&#39;&#41; or exit;
+
+isa_ok my $parser = Pod::Simple::XHTML-&gt;new, &#39;Pod::Simple::XHTML&#39;;
+
+ok $parser-&gt;strip_verbatim_indent&#40;&#39; &#39;&#41;, &#39;Should be able to set striper to &#34; &#34;&#39;;
+ok $parser-&gt;strip_verbatim_indent&#40;&#39;    &#39;&#41;, &#39;Should be able to set striper to &#34;    &#34;&#39;;
+ok $parser-&gt;strip_verbatim_indent&#40;&#34;t&#34;&#41;, &#39;Should be able to set striper to &#34;\\t&#34;&#39;;
+ok $parser-&gt;strip_verbatim_indent&#40;sub { &#39; &#39; }&#41;, &#39;Should be able to set striper to coderef&#39;;
+
+for my $spec &#40;
+    [
+        &#34;\n=pod\n\n foo bar baz\n&#34;,
+        undef,
+        qq{&lt;Document&gt;&lt;Verbatim\nxml:space=&#34;preserve&#34;&gt; foo bar baz&lt;/Verbatim&gt;&lt;/Document&gt;},
+        &#34;&lt;pre&gt;&lt;code&gt; foo bar baz&lt;/code&gt;&lt;/pre&gt;\n\n&#34;,
+        &#39;undefined indent&#39;
+    ],
+    [
+        &#34;\n=pod\n\n foo bar baz\n&#34;,
+        &#39; &#39;,
+        qq{&lt;Document&gt;&lt;Verbatim\nxml:space=&#34;preserve&#34;&gt;foo bar baz&lt;/Verbatim&gt;&lt;/Document&gt;},
+        &#34;&lt;pre&gt;&lt;code&gt;foo bar baz&lt;/code&gt;&lt;/pre&gt;\n\n&#34;,
+        &#39;single space indent&#39;
+    ],
+    [
+        &#34;\n=pod\n\n foo bar baz\n&#34;,
+        &#39;  &#39;,
+        qq{&lt;Document&gt;&lt;Verbatim\nxml:space=&#34;preserve&#34;&gt; foo bar baz&lt;/Verbatim&gt;&lt;/Document&gt;},
+        &#34;&lt;pre&gt;&lt;code&gt; foo bar baz&lt;/code&gt;&lt;/pre&gt;\n\n&#34;,
+        &#39;too large indent&#39;
+    ],
+    [
+        &#34;\n=pod\n\n  foo bar baz\n&#34;,
+        &#39;  &#39;,
+        qq{&lt;Document&gt;&lt;Verbatim\nxml:space=&#34;preserve&#34;&gt;foo bar baz&lt;/Verbatim&gt;&lt;/Document&gt;},
+        &#34;&lt;pre&gt;&lt;code&gt;foo bar baz&lt;/code&gt;&lt;/pre&gt;\n\n&#34;,
+        &#39;double space indent&#39;
+    ],
+    [
+        &#34;\n=pod\n\n  foo bar baz\n&#34;,
+        sub { &#39;  &#39; },
+        qq{&lt;Document&gt;&lt;Verbatim\nxml:space=&#34;preserve&#34;&gt;foo bar baz&lt;/Verbatim&gt;&lt;/Document&gt;},
+        &#34;&lt;pre&gt;&lt;code&gt;foo bar baz&lt;/code&gt;&lt;/pre&gt;\n\n&#34;,
+        &#39;code ref stripper&#39;
+    ],
+    [
+        &#34;\n=pod\n\n foo bar\n\n baz blez\n&#34;,
+        &#39; &#39;,
+        qq{&lt;Document&gt;&lt;Verbatim\nxml:space=&#34;preserve&#34;&gt;foo bar\n\nbaz blez&lt;/Verbatim&gt;&lt;/Document&gt;},
+        &#34;&lt;pre&gt;&lt;code&gt;foo bar\n\nbaz blez&lt;/code&gt;&lt;/pre&gt;\n\n&#34;,
+        &#39;single space indent and empty line&#39;
+    ],
+    [
+        &#34;\n=pod\n\n foo bar\n\n baz blez\n&#34;,
+        sub { &#39; &#39; },
+        qq{&lt;Document&gt;&lt;Verbatim\nxml:space=&#34;preserve&#34;&gt;foo bar\n\nbaz blez&lt;/Verbatim&gt;&lt;/Document&gt;},
+        &#34;&lt;pre&gt;&lt;code&gt;foo bar\n\nbaz blez&lt;/code&gt;&lt;/pre&gt;\n\n&#34;,
+        &#39;code ref indent and empty line&#39;
+    ],
+    [
+        &#34;\n=pod\n\n foo bar\n\n baz blez\n&#34;,
+        sub { &#40;my $s = shift-&gt;[0]&#41; =~ s/\S.*//; $s },
+        qq{&lt;Document&gt;&lt;Verbatim\nxml:space=&#34;preserve&#34;&gt;foo bar\n\nbaz blez&lt;/Verbatim&gt;&lt;/Document&gt;},
+        &#34;&lt;pre&gt;&lt;code&gt;foo bar\n\nbaz blez&lt;/code&gt;&lt;/pre&gt;\n\n&#34;,
+        &#39;heuristic code ref indent&#39;
+    ],
+    [
+        &#34;\n=pod\n\n foo bar\n   baz blez\n&#34;,
+        sub { s/^\s+// for @{ $_[0] } },
+        qq{&lt;Document&gt;&lt;Verbatim\nxml:space=&#34;preserve&#34;&gt;foo bar\nbaz blez&lt;/Verbatim&gt;&lt;/Document&gt;},
+        &#34;&lt;pre&gt;&lt;code&gt;foo bar\nbaz blez&lt;/code&gt;&lt;/pre&gt;\n\n&#34;,
+        &#39;militant code ref&#39;
+    ],
+&#41; {
+    my &#40;$pod, $indent, $xml, $xhtml, $desc&#41; = @$spec;
+    # Test XML output.
+    ok my $p = Pod::Simple::XMLOutStream-&gt;new, &#34;Construct XML parser to test $desc&#34;;
+    $p-&gt;hide_line_numbers&#40;1&#41;;
+    my $output = &#39;&#39;;
+    $p-&gt;output_string&#40; \$output &#41;;
+    is $indent, $p-&gt;strip_verbatim_indent&#40;$indent&#41;,
+        &#39;Set stripper for XML to &#39; . &#40;defined $indent ? qq{&#34;$indent&#34;} : &#39;undef&#39;&#41;;
+    ok $p-&gt;parse_string_document&#40; $pod &#41;, &#34;Parse POD to XML for $desc&#34;;
+    is $output, $xml, &#34;Should have expected XML output for $desc&#34;;
+
+
+    # Test XHTML output.
+    ok $p = Pod::Simple::XHTML-&gt;new, &#34;Construct XHMTL parser to test $desc&#34;;
+    $p-&gt;html_header&#40;&#39;&#39;&#41;;
+    $p-&gt;html_footer&#40;&#39;&#39;&#41;;
+    $output = &#39;&#39;;
+    $p-&gt;output_string&#40; \$output &#41;;
+    is $indent, $p-&gt;strip_verbatim_indent&#40;$indent&#41;,
+        &#39;Set stripper for XHTML to &#39; . &#40;defined $indent ? qq{&#34;$indent&#34;} : &#39;undef&#39;&#41;;
+    ok $p-&gt;parse_string_document&#40; $pod &#41;, &#34;Parse POD to XHTML for $desc&#34;;
+    is $output, $xhtml, &#34;Should have expected XHTML output for $desc&#34;;
+}
Index: lib/Pod/Simple.pm
===================================================================
--- lib/Pod/Simple.pm	&#40;revision 370&#41;
+++ lib/Pod/Simple.pm	&#40;working copy&#41;
@@ -67,7 +67,7 @@
 
   &#39;hide_line_numbers&#39;, # For some dumping subclasses: whether to pointedly
                        # suppress the start_line attribute
-                      
+
   &#39;line_count&#39;,        # the current line number
   &#39;pod_para_count&#39;,    # count of pod paragraphs seen so far
 
@@ -87,6 +87,7 @@
                        #  text up into several events
 
   &#39;preserve_whitespace&#39;, # whether to try to keep whitespace as-is
+  &#39;strip_verbatim_indent&#39;, # What indent to strip from verbatim
 
  &#39;content_seen&#39;,      # whether we&#39;ve seen any real Pod content
  &#39;errors_seen&#39;,       # TODO: document.  whether we&#39;ve seen any errors &#40;fatal or not&#41;
@@ -98,7 +99,7 @@
  #Called like:
  # $code_handler-&gt;&#40;$line, $self-&gt;{&#39;line_count&#39;}, $self&#41; if $code_handler;
  #  $cut_handler-&gt;&#40;$line, $self-&gt;{&#39;line_count&#39;}, $self&#41; if $cut_handler;
-  
+
 &#41;;
 
 #@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
Index: lib/Pod/Simple/BlackBox.pm
===================================================================
--- lib/Pod/Simple/BlackBox.pm	&#40;revision 370&#41;
+++ lib/Pod/Simple/BlackBox.pm	&#40;working copy&#41;
@@ -1369,8 +1369,19 @@
   DEBUG and print &#34; giving verbatim treatment...\n&#34;;
 
   $para-&gt;[1]{&#39;xml:space&#39;} = &#39;preserve&#39;;
+
+  my $indent = $self-&gt;strip_verbatim_indent;
+  if &#40;$indent &#38;&#38; ref $indent eq &#39;CODE&#39;&#41; {
+      my @shifted = &#40;shift @{$para}, shift @{$para}&#41;;
+      $indent = $indent-&gt;&#40;$para&#41;;
+      unshift @{$para}, @shifted;
+  }
+
   for&#40;my $i = 2; $i &lt; @$para; $i++&#41; {
     foreach my $line &#40;$para-&gt;[$i]&#41; { # just for aliasing
+      # Strip indentation.
+      $line =~ s/^\E$indent// if $indent
+          &#38;&#38; !&#40;$self-&gt;{accept_codes} &#38;&#38; $self-&gt;{accept_codes}{VerbatimFormatted}&#41;;
       while&#40; $line =~
         # Sort of adapted from Text::Tabs -- yes, it&#39;s hardwired in that
         # tabs are at every EIGHTH column.  For portability, it has to be
Index: lib/Pod/Simple.pod
===================================================================
--- lib/Pod/Simple.pod	&#40;revision 370&#41;
+++ lib/Pod/Simple.pod	&#40;working copy&#41;
@@ -173,9 +173,52 @@
 This returns true if C&lt;$parser&gt; has read from a source, and come to the
 end of that source.
 
+=item C&lt;&lt; $parser-&gt;strip_verbatim_indent&#40; I&lt;SOMEVALUE&gt; &#41; &gt;&gt;
+
+The perlpod spec for a Verbatim paragraph is &#34;It should be reproduced
+exactly...&#34;, which means that the whitespace you&#39;ve used to indent your
+verbatim blocks will be preserved in the output. This can be annoying for
+outputs such as HTML, where that whitespace will remain in front of every
+line. It&#39;s an unfortunate case where syntax is turned into semantics.
+
+If the POD your parsing adheres to a consistent indentation policy, you can
+have such indentation stripped from the beginning of every line of your
+verbatim blocks. This method tells Pod::Simple what to strip. For two-space
+indents, you&#39;d use:
+
+  $parser-&gt;strip_verbatim_indent&#40;&#39;  &#39;&#41;;
+
+For tab indents, you&#39;d use a tab character:
+
+  $parser-&gt;strip_verbatim_indent&#40;&#34;\t&#34;&#41;;
+
+If the POD is inconsistent about the indentation of verbatim blocks, but you
+have figured out a heuristic to determine how much a particular verbatim block
+is indented, you can pass a code reference instead. The code reference will be
+executed with one argument, an array reference of all the lines in the
+verbatim block, and should return the value to be stripped from each line. For
+example, if you decide that you&#39;re fine to use the first line of the verbatim
+block to set the standard for indentation of the rest of the block, you can
+look at the first line and return the appropriate value, like so:
+
+  $new-&gt;strip_verbatim_indent&#40;sub {
+      my $lines = shift;
+      &#40;my $indent = $lines-&gt;[0]&#41; =~ s/\S.*//;
+      return $indent;
+  }&#41;;
+
+If you&#39;d rather treat each line individually, you can do that, too, by just
+transforming them in-place in the code reference and returning C&lt;undef&gt;. Say
+that you don&#39;t want I&lt;any&gt; lines indented. You can do something like this:
+
+  $new-&gt;strip_verbatim_indent&#40;sub {
+      my $lines = shift;
+      sub { s/^\s+// for @{ $lines },
+      return undef;
+  }&#41;;
+
 =back
 
-
 =head1 CAVEATS
 
 This is just a beta release -- there are a good number of things still
Index: ChangeLog
===================================================================
--- ChangeLog	&#40;revision 371&#41;
+++ ChangeLog	&#40;working copy&#41;
@@ -7,6 +7,7 @@
 	Add support for an index &#40;TOC&#41; in the XHTML output from David E.
 	Wheeler.
 
+	Add strip_verbatim_indent&#40;&#41; from David E. Wheeler.
 
 2009-07-16   Allison Randal &lt;allison@perl.org&gt;
 	* Release 3.08
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;22&nbsp;01:14:43&nbsp;2009</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Aug 20 18:48:44 2009, DWHEELER wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I went ahead and implemented this. Patch attached. I think it covers
&gt; all the cases.
</div>
Per IM discussion with Allison, I&#39;ve committed this change in r372.

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;26&nbsp;14:55:52&nbsp;2009</span>
    <span class="description">ARANDAL [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
