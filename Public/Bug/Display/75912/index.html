<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #75912 for devel-nytprof: disagrees with Apache2::SizeLimit</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #75912 for devel-nytprof: disagrees with Apache2::SizeLimit</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/devel-nytprof/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/devel-nytprof/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/devel-nytprof/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/devel-nytprof/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/timbunce/devel-nytprof/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/devel-nytprof">devel-nytprof CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">75912</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/devel-nytprof/Active/">devel-nytprof</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
zefram [...] fysh.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-221012-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-221013-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;20&nbsp;10:07:04&nbsp;2012</span>
    <span class="description">zefram [...] fysh.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> disagrees with Apache2::SizeLimit</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 20 Mar 2012 14:06:47 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Devel-NYTProf [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Zefram &lt;zefram [...] fysh.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m using Devel::NYTProf::Apache and I&#39;m finding that every Apache process
that&#39;s actually processed any requests &#40;and from which I therefore want
profiling data&#41; produces an nytprof.out file that the tools declare
to be truncated.  These processes are exiting via Apache2::SizeLimit,
and apparently that prevents the profiling data being written out.

Versions: Apache/2.2.16, mod_perl/2.0.5, Perl/v5.12.3, Devel::NYTProf
4.06.  It&#39;s a preforking Apache.  I have this in httpd.conf:

    PerlPassEnv NYTPROF
    PerlModule Devel::NYTProf::Apache

I start and stop Apache via apachectl.  For test purposes here I&#39;m making
a single HTTP request between start and stop.  I use an environment
variable along the lines of

    NYTPROF=stmts=0:endatexit=1:clock=2:addpid=1:file=/tmp/nytprof.t7.out

In the basic non-working case, after stopping Apache I have a set of
output files like this:

-rw-rw-r-- 1 root     root     1967588 Mar 20 13:33 /tmp/nytprof.t7.out.27171
-rw-rw-r-- 1 root     root     1966877 Mar 20 13:35 /tmp/nytprof.t7.out.27179
-rw-rw-r-- 1 www-data www-data    6332 Mar 20 13:34 /tmp/nytprof.t7.out.27187
-rw-rw-r-- 1 www-data www-data 1752545 Mar 20 13:35 /tmp/nytprof.t7.out.27188
-rw-rw-r-- 1 www-data www-data 1752552 Mar 20 13:35 /tmp/nytprof.t7.out.27189
-rw-rw-r-- 1 www-data www-data 1752543 Mar 20 13:35 /tmp/nytprof.t7.out.27190
-rw-rw-r-- 1 www-data www-data 1752545 Mar 20 13:35 /tmp/nytprof.t7.out.27191
-rw-rw-r-- 1 www-data www-data 1752542 Mar 20 13:35 /tmp/nytprof.t7.out.27192
-rw-rw-r-- 1 www-data www-data 1752544 Mar 20 13:35 /tmp/nytprof.t7.out.27193
-rw-rw-r-- 1 www-data www-data 1752548 Mar 20 13:35 /tmp/nytprof.t7.out.27194
-rw-rw-r-- 1 www-data www-data 1752544 Mar 20 13:35 /tmp/nytprof.t7.out.27195
-rw-rw-r-- 1 www-data www-data 1752549 Mar 20 13:35 /tmp/nytprof.t7.out.27196
-rw-rw-r-- 1 root     root     1966916 Mar 20 13:35 /tmp/nytprof.t7.out.27280
-rw-rw-r-- 1 www-data www-data 1752544 Mar 20 13:35 /tmp/nytprof.t7.out.27282

nytprofmerge says that the short file is truncated and the others are
all OK.  The short one is from the child process that handled the request,
and it exited due to size limit:

[Tue Mar 20 13:34:58 2012] &#40;27187&#41; Apache2::SizeLimit httpd process too big, exiting at SIZE=305048 KB SHARE=3796 KB UNSHARED=301252 REQUESTS=2 LIFETIME=0 seconds

Docs &#40;and Tim on IRC&#41; suggest that DB::finish_profile&#40;&#41; isn&#39;t getting
called.  I tried various ways of triggering it.  Adding my own END block
in a &lt;Perl&gt; section didn&#39;t work.  $NYTPROF additions for sigexit and
posix_exit didn&#39;t work.  Setting up a PerlChildExitHandler didn&#39;t work.
But a PerlChildCleanupHandler did work:

    &lt;Perl&gt;
        use Apache2::ServerUtil &#40;&#41;;
        use Apache2::Const qw&#40;-compile OK&#41;;
        Apache2::ServerUtil-&gt;server-&gt;push_handlers&#40;PerlCleanupHandler =&gt; sub {
            DB::finish_profile&#40;&#41;;
            return Apache2::Const::OK;
        }&#41;;
    &lt;/Perl&gt;

Of course, this fires after a single request, so each child process is
then only good for one request.  The result is a sane-looking set of
output files:

-rw-rw-r-- 1 root     root     1968031 Mar 20 13:26 /tmp/nytprof.t6.out.26859
-rw-rw-r-- 1 root     root     1967348 Mar 20 13:26 /tmp/nytprof.t6.out.26867
-rw-rw-r-- 1 www-data www-data 2151871 Mar 20 13:26 /tmp/nytprof.t6.out.26875
-rw-rw-r-- 1 www-data www-data 1752558 Mar 20 13:26 /tmp/nytprof.t6.out.26876
-rw-rw-r-- 1 www-data www-data 1752561 Mar 20 13:26 /tmp/nytprof.t6.out.26877
-rw-rw-r-- 1 www-data www-data 1752556 Mar 20 13:26 /tmp/nytprof.t6.out.26878
-rw-rw-r-- 1 www-data www-data 1752562 Mar 20 13:26 /tmp/nytprof.t6.out.26879
-rw-rw-r-- 1 www-data www-data 1752557 Mar 20 13:26 /tmp/nytprof.t6.out.26880
-rw-rw-r-- 1 www-data www-data 1752557 Mar 20 13:26 /tmp/nytprof.t6.out.26881
-rw-rw-r-- 1 www-data www-data 1752564 Mar 20 13:26 /tmp/nytprof.t6.out.26882
-rw-rw-r-- 1 www-data www-data 1752555 Mar 20 13:26 /tmp/nytprof.t6.out.26883
-rw-rw-r-- 1 www-data www-data 1752560 Mar 20 13:26 /tmp/nytprof.t6.out.26884
-rw-rw-r-- 1 www-data www-data 1752554 Mar 20 13:26 /tmp/nytprof.t6.out.26917
-rw-rw-r-- 1 root     root     1967463 Mar 20 13:26 /tmp/nytprof.t6.out.26928

nytprofmerge is happy about these files.

The most successful workaround turned out to be to comment out the
Apache2::SizeLimit configuration.  With this, and no END block or handler,
I get output files that nytprofmerge is happy with.

So apparently D:N:Apache is failing to intercept the mechanism that
Apache2::SizeLimit uses to trigger a child exit.  It&#39;s not doing anything
obviously unclean, like _exit&#40;&#41; &#40;which D:N would presumably have caught,
given the posix_exit option&#41;.  It&#39;s calling $r-&gt;child_terminate, supplied
by Apache2::RequestUtil, documented as &#34;Terminate the current worker
process as soon as the current request is over&#34;.  It seems a bug that
D:N:Apache wouldn&#39;t play nicely with that.

Stepping back a bit, I have a suggestion regarding saving profiling data.
You ought to save it more often, and specifically it ought to be possible
to save data without stopping collection of profiling data, and it ought
to be possible to save more than once in one process.  Each save probably
needs to go to a separate file.  That&#39;s not a problem, because you need
to merge output files anyway.

If that&#39;s possible, it gets a lot easier to work with Apache.  You can
set up a PerlCleanupHandler, running after each request, that saves
data without stopping profiling.  This means you can always pick up
data covering every request processed so far, regardless of the current
state of child processes.  You then lose very little if you fail to
trap child termination.  Processes can be killed uncleanly and you&#39;ve
still got profiling data from everything they did except what they were
working on at the time of killing.

The home-grown profiler that I previously used in this job, which I&#39;m
now trying to replace with D:N to avoid the overhead &#40;because I wrote it
in Perl&#41;, works this way.  I never got any truncated files &#40;it doesn&#39;t
start writing out a file until it&#39;s going to write the complete file&#41;.
I never lost significant amounts of data with it.

-zefram
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;20&nbsp;19:45:31&nbsp;2012</span>
    <span class="description">TIMB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Mar 20 10:07:04 2012, zefram@fysh.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; These processes are exiting via Apache2::SizeLimit, and apparently that prevents the profiling data being written out.
</div>
Great. I&#39;m glad you found the problem.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Docs &#40;and Tim on IRC&#41; suggest that DB::finish_profile&#40;&#41; isn&#39;t getting
&gt; called.  I tried various ways of triggering it.  Adding my own END
&gt; block
&gt; in a &lt;Perl&gt; section didn&#39;t work.  $NYTPROF additions for sigexit and
&gt; posix_exit didn&#39;t work.  Setting up a PerlChildExitHandler didn&#39;t
&gt; work.
&gt; But a PerlChildCleanupHandler did work:
&gt; 
&gt;     &lt;Perl&gt;
&gt;       use Apache2::ServerUtil &#40;&#41;;
&gt;       use Apache2::Const qw&#40;-compile OK&#41;;
&gt;       Apache2::ServerUtil-&gt;server-&gt;push_handlers&#40;PerlCleanupHandler =&gt; sub
&gt; {
&gt;           DB::finish_profile&#40;&#41;;
&gt;           return Apache2::Const::OK;
&gt;       }&#41;;
&gt;     &lt;/Perl&gt;
&gt; 
&gt; Of course, this fires after a single request, so each child process is
&gt; then only good for one request.
</div>
You said &#34;PerlChildCleanupHandler did work&#34; but the code you quote is using &#34;PerlCleanupHandler&#34;.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It&#39;s calling $r-&gt;child_terminate, supplied
&gt; by Apache2::RequestUtil, documented as &#34;Terminate the current worker
&gt; process as soon as the current request is over&#34;.  It seems a bug that
&gt; D:N:Apache wouldn&#39;t play nicely with that.
</div>
For now I&#39;m going to magically turn it into a feature by waving the documentation wand. Patches are welcome of course.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Stepping back a bit, I have a suggestion regarding saving profiling
&gt; data.
&gt; You ought to save it more often, and specifically it ought to be
&gt; possible
&gt; to save data without stopping collection of profiling data, and it
&gt; ought
&gt; to be possible to save more than once in one process.  Each save
&gt; probably
&gt; needs to go to a separate file.  That&#39;s not a problem, because you
&gt; need
&gt; to merge output files anyway.
</div>
It is possible, to some extent. See <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~timb/Devel-NYTProf/lib/Devel/NYTProf.pm#RUN-">http://search.cpan.org/~timb/Devel-NYTProf/lib/Devel/NYTProf.pm#RUN-</a></span>
TIME_CONTROL_OF_PROFILING

Tim.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;20&nbsp;19:45:32&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;22&nbsp;11:11:32&nbsp;2012</span>
    <span class="description">TIMB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve addressed this, at least partly, in r1413 with a warning if SizeLimit is detected and assorted 
changes to the docs.

I&#39;d appreciate some feedback on the code you previously quoted where you said 
&#34;PerlChildCleanupHandler did work&#34; but the code you quote is using &#34;PerlCleanupHandler&#34;. Does 
changing that to PerlChildCleanupHandler fix it?

I&#39;ll leave this ticket open as a reminder that I&#39;d like to add code to intercept the child_terminate&#40;&#41; 
function.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;20&nbsp;06:37:10&nbsp;2013</span>
    <span class="description">zefram [...] fysh.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75912] disagrees with Apache2::SizeLimit</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 20 Jun 2013 11:36:47 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Tim_Bunce via RT &lt;bug-devel-nytprof [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Zefram &lt;zefram [...] fysh.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Tim_Bunce via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;I&#39;ll leave this ticket open as a reminder that I&#39;d like to add code to intercept the child_terminate&#40;&#41; 
</div>
child_terminate is defined in mod_perl in a way that doesn&#39;t leave much
room for interception.  $r-&gt;child_terminate registers a cleanup handler;
when that handler is triggered &#40;during cleanup of the current request&#41; it
registers another cleanup handler; when *that* handler executes &#40;after all
the normal cleanup handlers&#41; it performs exit&#40;0&#41;.  You&#39;ll need atexit&#40;3&#41;
to intercept that.

-zefram
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;20&nbsp;06:48:03&nbsp;2013</span>
    <span class="description">zefram [...] fysh.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75912] disagrees with Apache2::SizeLimit</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 20 Jun 2013 11:47:43 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Tim_Bunce via RT &lt;bug-devel-nytprof [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Zefram &lt;zefram [...] fysh.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Tim_Bunce via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;On Tue Mar 20 10:07:04 2012, zefram@fysh.org wrote:
<div class="message-stanza open">&gt;&gt; You ought to save it more often, and specifically it ought to be possible
&gt;&gt; to save data without stopping collection of profiling data, and it ought
&gt;&gt; to be possible to save more than once in one process.
</div>&gt;
&gt;It is possible, to some extent. See <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~timb/Devel-NYTProf/lib/Devel/NYTProf.pm#RUN-">http://search.cpan.org/~timb/Devel-NYTProf/lib/Devel/NYTProf.pm#RUN-</a></span>
&gt;TIME_CONTROL_OF_PROFILING
</div>
That allows the collection of profiling data to be started and stopped
repeatedly.  It doesn&#39;t allow repeated *saving* of profiling data,
which is what&#39;s needed here.

-zefram
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;20&nbsp;07:26:25&nbsp;2013</span>
    <span class="description">zefram [...] fysh.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75912] disagrees with Apache2::SizeLimit</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 20 Jun 2013 12:26:02 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Tim_Bunce via RT &lt;bug-devel-nytprof [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Zefram &lt;zefram [...] fysh.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Attached patch implements optional hooking of libc&#39;s exit&#40;3&#41;.

-zefram
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;20&nbsp;11:24:34&nbsp;2013</span>
    <span class="description">TIMB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Patch applied. Thanks!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;20&nbsp;11:24:34&nbsp;2013</span>
    <span class="description">TIMB [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
