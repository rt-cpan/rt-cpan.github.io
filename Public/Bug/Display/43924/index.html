<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #43924 for Math-BigInt: Huge slowdown in blog&#40;x&#41; when x begins with 1</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #43924 for Math-BigInt: Huge slowdown in blog&#40;x&#41; when x begins with 1</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Math-BigInt">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Math-BigInt">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Math-BigInt">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Math-BigInt">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Math-BigInt">Math-BigInt CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">43924</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Math-BigInt">Math-BigInt</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
emazep [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-20500-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.89    </td>
  </tr>
  <tr id="CF-20501-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.999701    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




perl-V.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/574338/289996/perl-V.txt">
Sat Mar 07 06:11:27 2009 (2.6k) by emazep [...] gmail.com
</a>
</font></li>
</ul>


signature.asc<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/574363/290011/signature.asc">
Sat Mar 07 08:53:26 2009 (481b) by nospam-abuse [...] bloodgate.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=43924">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-574335" href="/Public/Bug/Display.html?id=43924#txn-574335">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;07&nbsp;06:08:02&nbsp;2009</span>
    <span class="description">emazep [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Huge slowdown in blog&#40;x&#41; when x begins with 1</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/574335/289989/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/289989">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">It seems that there is a huge slowdown in blog&#40;x&#41; whenever x is a number
beginning with 1.

Consider the following script:

---

use strict;
use warnings;

use Benchmark qw&#40;cmpthese&#41;;
use Math::BigFloat;

# $x is a big number beginning with 1
our $x  = Math::BigFloat-&gt;new&#40; &#39;1234567890&#39; x 20 &#41;;
# $x2 = $x * 2 &#40;$x2 begins with 2&#41;
our $x2 = $x-&gt;copy-&gt;bmul&#40;2&#41;;                        

cmpthese&#40; -10, {
    log_2x =&gt; sub { $x2-&gt;copy-&gt;blog },
    log_x  =&gt; sub { $x-&gt;copy-&gt;blog  }
}&#41;;

---

It prints out:

         Rate  log_x log_2x
log_x  1.14/s     --   -95%
log_2x 24.4/s  2038%     --

which shows that &#40;in this case&#41; calculating blog&#40;x&#41; takes more than *20
times* longer than calculating blog&#40;2*x&#41; &#40;this ratio tends to diverge
when the size of x increases&#41;.

Whatever the reason, this can easily be avoided at least by naively
implementing blog&#40;x&#41; by blog&#40;2*x&#41;-blog&#40;2&#41; when x is a number beginning
with 1 &#40;multiplying by 2 a number beginning with 1 always gives a number
beginning with a digit != 1&#41;.

Thank you for your great work,
Emanuele Zeppieri
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-574338" href="/Public/Bug/Display.html?id=43924#txn-574338">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;07&nbsp;06:11:27&nbsp;2009</span>
    <span class="description">emazep [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> perl-V.txt</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/574338/289996/perl-V.txt">Download perl-V.txt</a><br />
<span class="downloadcontenttype">text/plain 2.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Summary of my perl5 &#40;revision 5 version 10 subversion 0 patch 34065&#41; configuration:
  Platform:
    osname=cygwin, osvers=1.5.25&#40;0.15642&#41;, archname=cygwin-thread-multi-64int
    uname=&#39;cygwin_nt-5.1 reini 1.5.25&#40;0.15642&#41; 2008-06-12 19:34 i686 cygwin &#39;
    config_args=&#39;-de -Dmksymlinks -Dusethreads -Dmad=y -Dusedevel&#39;
    hint=recommended, useposix=true, d_sigaction=define
    useithreads=define, usemultiplicity=define
    useperlio=define, d_sfio=undef, uselargefiles=define, usesocks=undef
    use64bitint=define, use64bitall=undef, uselongdouble=undef
    usemymalloc=y, bincompat5005=undef
  Compiler:
    cc=&#39;gcc&#39;, ccflags =&#39;-DPERL_USE_SAFE_PUTENV -U__STRICT_ANSI__ -fno-strict-aliasing -pipe -I/usr/local/include&#39;,
    optimize=&#39;-O3&#39;,
    cppflags=&#39;-DPERL_USE_SAFE_PUTENV -U__STRICT_ANSI__ -fno-strict-aliasing -pipe -I/usr/local/include&#39;
    ccversion=&#39;&#39;, gccversion=&#39;3.4.4 &#40;cygming special, gdc 0.12, using dmd 0.125&#41;&#39;, gccosandvers=&#39;&#39;
    intsize=4, longsize=4, ptrsize=4, doublesize=8, byteorder=12345678
    d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=12
    ivtype=&#39;long long&#39;, ivsize=8, nvtype=&#39;double&#39;, nvsize=8, Off_t=&#39;off_t&#39;, lseeksize=8
    alignbytes=8, prototype=define
  Linker and Libraries:
    ld=&#39;g++&#39;, ldflags =&#39; -Wl,--enable-auto-import -Wl,--export-all-symbols -Wl,--stack,8388608 -Wl,--enable-auto-image-base -L/usr/local/lib&#39;
    libpth=/usr/local/lib /usr/lib /lib
    libs=-lgdbm -ldb -ldl -lcrypt -lgdbm_compat
    perllibs=-ldl -lcrypt
    libc=/usr/lib/libc.a, so=dll, useshrplib=true, libperl=libperl.a
    gnulibc_version=&#39;&#39;
  Dynamic Linking:
    dlsrc=dl_dlopen.xs, dlext=dll, d_dlsymun=undef, ccdlflags=&#39; &#39;
    cccdlflags=&#39; &#39;, lddlflags=&#39; --shared  -Wl,--enable-auto-import -Wl,--export-all-symbols -Wl,--stack,8388608 -Wl,--enable-auto-image-base -L/usr/local/lib&#39;


Characteristics of this binary &#40;from libperl&#41;: 
  Compile-time options: MULTIPLICITY MYMALLOC PERL_DONT_CREATE_GVSV
                        PERL_IMPLICIT_CONTEXT PERL_MAD PERL_MALLOC_WRAP
                        PERL_USE_SAFE_PUTENV USE_64_BIT_INT USE_ITHREADS
                        USE_LARGE_FILES USE_PERLIO USE_REENTRANT_API
  Locally applied patches:
	MAINT34065
	CYG11 no-bs
	CYG12 no archlib in otherlibdirs
	CYG14 Dynaloader
	CYG15 static-Win32CORE
	Bug#55162 File::Spec::case_tolerant performance
  Built under cygwin
  Compiled at Jun 30 2008 16:05:15
  %ENV:
    CYGWIN=&#34;&#34;
  @INC:
    /usr/lib/perl5/5.10/i686-cygwin
    /usr/lib/perl5/5.10
    /usr/lib/perl5/site_perl/5.10/i686-cygwin
    /usr/lib/perl5/site_perl/5.10
    /usr/lib/perl5/vendor_perl/5.10/i686-cygwin
    /usr/lib/perl5/vendor_perl/5.10
    /usr/lib/perl5/vendor_perl/5.10
    /usr/lib/perl5/site_perl/5.8
    /usr/lib/perl5/vendor_perl/5.8
    .
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-574363" href="/Public/Bug/Display.html?id=43924#txn-574363">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;07&nbsp;08:53:26&nbsp;2009</span>
    <span class="description">nospam-abuse [...] bloodgate.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43924] Huge slowdown in blog&#40;x&#41; when x begins with 1</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 7 Mar 2009 14:52:43 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Math-BigInt [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tels &lt;nospam-abuse [...] bloodgate.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/574363/290010/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/290010">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Saturday 07 March 2009 12:08:03 Emanuele Zeppieri via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sat Mar 07 06:08:02 2009: Request 43924 was acted upon.
&gt; Transaction: Ticket created by emazep
&gt;        Queue: Math-BigInt
&gt;      Subject: Huge slowdown in blog&#40;x&#41; when x begins with 1
&gt;    Broken in: 1.89
&gt;     Severity: Normal
&gt;        Owner: Nobody
&gt;   Requestors: emazep@gmail.com
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=43924">https://rt.cpan.org/Ticket/Display.html?id=43924</a></span> &gt;
&gt;
&gt;
&gt; It seems that there is a huge slowdown in blog&#40;x&#41; whenever x is a
&gt; number beginning with 1.
&gt;
&gt; Consider the following script:
&gt;
&gt; ---
&gt;
&gt; use strict;
&gt; use warnings;
&gt;
&gt; use Benchmark qw&#40;cmpthese&#41;;
&gt; use Math::BigFloat;
&gt;
&gt; # $x is a big number beginning with 1
&gt; our $x  = Math::BigFloat-&gt;new&#40; &#39;1234567890&#39; x 20 &#41;;
&gt; # $x2 = $x * 2 &#40;$x2 begins with 2&#41;
&gt; our $x2 = $x-&gt;copy-&gt;bmul&#40;2&#41;;
&gt;
&gt; cmpthese&#40; -10, {
&gt;     log_2x =&gt; sub { $x2-&gt;copy-&gt;blog },
&gt;     log_x  =&gt; sub { $x-&gt;copy-&gt;blog  }
&gt; }&#41;;
&gt;
&gt; ---
&gt;
&gt; It prints out:
&gt;
&gt;          Rate  log_x log_2x
&gt; log_x  1.14/s     --   -95%
&gt; log_2x 24.4/s  2038%     --
&gt;
&gt; which shows that &#40;in this case&#41; calculating blog&#40;x&#41; takes more than
&gt; *20 times* longer than calculating blog&#40;2*x&#41; &#40;this ratio tends to
&gt; diverge when the size of x increases&#41;.
&gt;
&gt; Whatever the reason, this can easily be avoided at least by naively
&gt; implementing blog&#40;x&#41; by blog&#40;2*x&#41;-blog&#40;2&#41; when x is a number
&gt; beginning with 1 &#40;multiplying by 2 a number beginning with 1 always
&gt; gives a number beginning with a digit != 1&#41;.
</div>
I haven&#39;t looked &#40;and I currently have almost zero time for Perl, 
sorry :&#40; but it might be a simple case of the code accidentily using 
BigIntegers internally when the number begins with 1, by not converting 
some small number to a scalar or so.

Thank you for your report!

Tels


-- 
 Signed on Sat Mar  7 14:51:51 2009 with key 0x93B84C15.
 Get one of my photo posters: <span class="clickylink"><a target="new" rel="nofollow" href="http://bloodgate.com/posters">http://bloodgate.com/posters</a></span>
 PGP key on <span class="clickylink"><a target="new" rel="nofollow" href="http://bloodgate.com/tels.asc">http://bloodgate.com/tels.asc</a></span> or per email.

 &#34;Now, admittedly, it&#39;s critical software. This is the &#39;let&#39;s go kill
 people&#39; software.&#34;

  -- Mark A. Welsh III
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/574363/290011/signature.asc">Download signature.asc</a><br />
<span class="downloadcontenttype">application/pgp-signature 481b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-574364" href="/Public/Bug/Display.html?id=43924#txn-574364">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;07&nbsp;08:53:27&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1097234" href="/Public/Bug/Display.html?id=43924#txn-1097234">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;09&nbsp;13:41:41&nbsp;2012</span>
    <span class="description">BBYRD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1097234/576855/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/576855">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 392b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Confirmed that this is still an issue:

use strict;
use warnings;
use Benchmark qw&#40;cmpthese&#41;;
use Math::BigFloat;
our $x  = Math::BigFloat-&gt;new&#40; &#39;1234567890&#39; x 20 &#41;;
our $x2 = Math::BigFloat-&gt;new&#40; &#39;2234567890&#39; x 20 &#41;;
cmpthese&#40; -10, { log_2x =&gt; sub { $x2-&gt;copy-&gt;blog }, log_x =&gt; sub {
$x-&gt;copy-&gt;blog } }&#41;; 

         Rate  log_x log_2x
log_x  1.18/s     --   -98%
log_2x 47.2/s  3914%     --
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1277952" href="/Public/Bug/Display.html?id=43924#txn-1277952">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;22&nbsp;15:19:42&nbsp;2013</span>
    <span class="description">DANAJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1277952/677063/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/677063">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 934b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This happens because _log_10 first moves the decimal place over &#40;so XYYYYYY.ZZZ becomes X.YYYYYYZZZ&#41; then we do a comparison of X &gt;= 2 right before the &#34;if $twos != 0&#34; loop.  If X &gt;= 2, we divide by two  *and round to $scale+4*.

So in the case of &#39;2234567890&#39; x 20, we have divided by two with rounding, so we send to _log:
 &#39;1.11728394511172839451117283945111728394511172839&#39;

In the case of &#39;1234567890&#39; x 20, we send:
 &#39;1.234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789&#39;

The former is much faster.  Adding the line:

  $x-&gt;bround&#40;$scale+4&#41;

on line ~1480 of BigFloat.pm, right after the while statements and before the &#39;if &#40;$twos != 0&#41;&#39; will speed up the first case in the benchmark by about 20x.

With that change, the test suite passes.  I&#39;m not sure if it is the *right* fix.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1278233" href="/Public/Bug/Display.html?id=43924#txn-1278233">#</a>      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;23&nbsp;13:56:26&nbsp;2013</span>
    <span class="description">nospam-abuse [...] bloodgate.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43924] Huge slowdown in blog&#40;x&#41; when x begins  with 1</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 23 Oct 2013 13:56:02 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Math-BigInt [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Tels&#34; &lt;nospam-abuse [...] bloodgate.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1278233/677225/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/677225">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On Tue, October 22, 2013 3:19 pm, Dana Jacobsen via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Math-BigInt
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=43924">https://rt.cpan.org/Ticket/Display.html?id=43924</a></span> &gt;
&gt;
&gt; This happens because _log_10 first moves the decimal place over &#40;so
&gt; XYYYYYY.ZZZ becomes X.YYYYYYZZZ&#41; then we do a comparison of X &gt;= 2 right
&gt; before the &#34;if $twos != 0&#34; loop.  If X &gt;= 2, we divide by two  *and round
&gt; to $scale+4*.
&gt;
&gt; So in the case of &#39;2234567890&#39; x 20, we have divided by two with rounding,
&gt; so we send to _log:
&gt;  &#39;1.11728394511172839451117283945111728394511172839&#39;
&gt;
&gt; In the case of &#39;1234567890&#39; x 20, we send:
&gt;  &#39;1.234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789&#39;
&gt;
&gt; The former is much faster.  Adding the line:
&gt;
&gt;   $x-&gt;bround&#40;$scale+4&#41;
&gt;
&gt; on line ~1480 of BigFloat.pm, right after the while statements and before
&gt; the &#39;if &#40;$twos != 0&#41;&#39; will speed up the first case in the benchmark by
&gt; about 20x.
&gt;
&gt; With that change, the test suite passes.  I&#39;m not sure if it is the
&gt; *right* fix.
</div>
IIRC the routine is asked to return a precision of scale, so it keeps
internally $scale + 4 &#40;to have enough digits to avoid rounding&#41;.

So rounding the input in both cases is the &#34;right&#34; thing todo, e.g. at
least it will have the same possible output inaccuraries in both cases.

Not rounding in one path was probably an oversight on my part, and the
testsuite wouldn&#39;t catch it if the final result is rounded to $scale
before output, unless the intermidiate rounding produces errors due to
accumulating them.

Hope this helps,

tels



-- 
<span class="clickylink"><a target="new" rel="nofollow" href="http://bloodgate.com/galleries/">http://bloodgate.com/galleries/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1371892" href="/Public/Bug/Display.html?id=43924#txn-1371892">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;04&nbsp;04:23:31&nbsp;2014</span>
    <span class="description">emazep [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #43924] Huge slowdown in blog&#40;x&#41; when x begins with 1</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 04 Jun 2014 10:23:19 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Math-BigInt [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Emanuele Zeppieri &lt;emazep [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1371892/728439/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/728439">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">To the maintainer: can we apply this fix please? Thanks!
-Emanuele

On 2013-10-22 21:19, Dana Jacobsen via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=43924">https://rt.cpan.org/Ticket/Display.html?id=43924</a></span> &gt;
&gt; 
&gt; This happens because _log_10 first moves the decimal place over &#40;so XYYYYYY.ZZZ becomes X.YYYYYYZZZ&#41; then we do a comparison of X &gt;= 2 right before the &#34;if $twos != 0&#34; loop.  If X &gt;= 2, we divide by two  *and round to $scale+4*.
&gt; 
&gt; So in the case of &#39;2234567890&#39; x 20, we have divided by two with rounding, so we send to _log:
&gt;  &#39;1.11728394511172839451117283945111728394511172839&#39;
&gt; 
&gt; In the case of &#39;1234567890&#39; x 20, we send:
&gt;  &#39;1.234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789&#39;
&gt; 
&gt; The former is much faster.  Adding the line:
&gt; 
&gt;   $x-&gt;bround&#40;$scale+4&#41;
&gt; 
&gt; on line ~1480 of BigFloat.pm, right after the while statements and before the &#39;if &#40;$twos != 0&#41;&#39; will speed up the first case in the benchmark by about 20x.
&gt; 
&gt; With that change, the test suite passes.  I&#39;m not sure if it is the *right* fix.
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1489701" href="/Public/Bug/Display.html?id=43924#txn-1489701">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;24&nbsp;09:49:52&nbsp;2015</span>
    <span class="description">peter.john.acklam [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1489701/793369/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/793369">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 66b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Patch submitted: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.perl.org/Ticket/Display.html?id=124382">https://rt.perl.org/Ticket/Display.html?id=124382</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1535400" href="/Public/Bug/Display.html?id=43924#txn-1535400">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;15&nbsp;07:17:47&nbsp;2015</span>
    <span class="description">peter.john.acklam [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1535400/819431/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819431">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 30b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixed in Math-BigInt-1.999701.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1535403" href="/Public/Bug/Display.html?id=43924#txn-1535403">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;15&nbsp;07:17:49&nbsp;2015</span>
    <span class="description">peter.john.acklam [...] gmail.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1535405" href="/Public/Bug/Display.html?id=43924#txn-1535405">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;15&nbsp;07:17:55&nbsp;2015</span>
    <span class="description">peter.john.acklam [...] gmail.com -  Fixed in 1.999701 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.633024</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
