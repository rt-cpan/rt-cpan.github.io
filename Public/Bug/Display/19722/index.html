<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #19722 for XML-Atom-SimpleFeed: Can&#39;t make it to work with international charsets</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #19722 for XML-Atom-SimpleFeed: Can&#39;t make it to work with international charsets</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/XML-Atom-SimpleFeed/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/XML-Atom-SimpleFeed/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/XML-Atom-SimpleFeed/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/XML-Atom-SimpleFeed/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="http://github.com/ap/XML-Atom-SimpleFeed/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/XML-Atom-SimpleFeed">XML-Atom-SimpleFeed CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">19722</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/XML-Atom-SimpleFeed/Active/">XML-Atom-SimpleFeed</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">ARISTOTLE [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
karjala [...] karjala.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-36954-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-36955-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;06&nbsp;00:56:21&nbsp;2006</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Can&#39;t make it to work with international charsets</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Encoding is &#34;us-ascii&#34;, and any international content I add appears
garbled in my RSS reader.

I think two things nned to be changed to fix the situation:
encoding=&#34;UTF-8&#34;, and not create &#38;#231;-type entities out of non-ascii
bytes.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;06&nbsp;20:56:44&nbsp;2006</span>
    <span class="description">pagaltzis [...] gmx.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #19722] Can&#39;t make it to work with international charsets</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 7 Jun 2006 02:56:30 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-Atom-SimpleFeed [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;A. Pagaltzis&#34; &lt;pagaltzis [...] gmx.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Subject: XML-Atom-SimpleFeed
&gt; Date: Tue, 06 Jun 2006 04:14:32 +0300
&gt; 
&gt; Is there a way to change the encoding of a feed to UTF-8? I&#39;m
&gt; asking because I have a greek feed, which I fill with unicode
&gt; data from a database, and your module creates a feed with
&gt; &#34;us-ascii&#34; and turns all the greek letters into &#38;#207; etc
&gt; entities, which makes the rss file unreadable when opening with
&gt; a text editor.
&gt; 
&gt; If there is no way to change the encoding, could you please
&gt; change the default encoding of your module to UTF-8, as UTF-8
&gt; is standard nowdays for XML?
&gt; 
&gt; Thank you.
&gt; 
&gt; - Alex
&gt; 
&gt; P.S. Another nice addition might be to produce tidy XML code,
&gt; with newlines and tabs.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;06&nbsp;20:56:45&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;06&nbsp;20:59:17&nbsp;2006</span>
    <span class="description">ARISTOTLE [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;06&nbsp;21:12:50&nbsp;2006</span>
    <span class="description">ARISTOTLE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jun 06 00:56:21 2006, guest wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Encoding is &#34;us-ascii&#34;, and any international content I add appears
&gt; garbled in my RSS reader.
</div>
Garbled? You mean the content displays incorrectly in an aggregator? If
so, then that would be a serious problem and I&#39;d like to ask for some
sample code that reproduces the problem. Or are you referring to the
same issue as in the other mail, ie. the source is merely unreadable,
though it gets decoded as it should by aggregators?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think two things nned to be changed to fix the situation:
&gt; encoding=&#34;UTF-8&#34;, and not create &#38;#231;-type entities out of non-ascii
&gt; bytes.
</div>
I didn&#39;t think about feeds with content in non-Latin-based scripts, that
is true. They would be unreadable when viewed as source.

My decision to output only &#34;us-ascii&#34; as encoding was based on the fact
that many servers are misconfigured and will produce wrong headers; it
is  also harder to handle things perfectly correctly on the Perl side,
making sure that non-ASCII / non-UTF8 strings are properly upgraded to
Unicode. Restricting output to ASCII seemed like the easiest way to
ensure minimum possible breakage.

I guess I&#39;ll have to think of a way to make it easy to get encodings
right... it&#39;s not as simple a question as it seems, because I want the
module to be somewhat robust about encodings even in the face of people
who don&#39;t know exactly what they are doing.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;06&nbsp;22:01:59&nbsp;2006</span>
    <span class="description">karjala [...] karjala.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #19722] Can&#39;t make it to work with international charsets</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 07 Jun 2006 05:00:26 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-Atom-SimpleFeed [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Alexander Karelas &lt;karjala [...] karjala.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I don&#39;t know much about the problems that occur when the servers are 
misconfigured.

But the way I found to solve this problem, is to change the module to 
act as follows:
- say UTF-8 instead of us-ascii
and
- don&#39;t encode the characters from \x80 onwards

And that&#39;s all.

I don&#39;t know if that helps at all...
- Alex


Aristotle Pagaltzis via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=19722">http://rt.cpan.org/Ticket/Display.html?id=19722</a></span> &gt;
&gt;
&gt; On Tue Jun 06 00:56:21 2006, guest wrote:
&gt;   
<div class="message-stanza open">&gt;&gt; Encoding is &#34;us-ascii&#34;, and any international content I add appears
&gt;&gt; garbled in my RSS reader.
&gt;&gt;     
</div>&gt;
&gt; Garbled? You mean the content displays incorrectly in an aggregator? If
&gt; so, then that would be a serious problem and I&#39;d like to ask for some
&gt; sample code that reproduces the problem. Or are you referring to the
&gt; same issue as in the other mail, ie. the source is merely unreadable,
&gt; though it gets decoded as it should by aggregators?
&gt;
&gt;   
<div class="message-stanza open">&gt;&gt; I think two things nned to be changed to fix the situation:
&gt;&gt; encoding=&#34;UTF-8&#34;, and not create &#38;#231;-type entities out of non-ascii
&gt;&gt; bytes.
&gt;&gt;     
</div>&gt;
&gt; I didn&#39;t think about feeds with content in non-Latin-based scripts, that
&gt; is true. They would be unreadable when viewed as source.
&gt;
&gt; My decision to output only &#34;us-ascii&#34; as encoding was based on the fact
&gt; that many servers are misconfigured and will produce wrong headers; it
&gt; is  also harder to handle things perfectly correctly on the Perl side,
&gt; making sure that non-ASCII / non-UTF8 strings are properly upgraded to
&gt; Unicode. Restricting output to ASCII seemed like the easiest way to
&gt; ensure minimum possible breakage.
&gt;
&gt; I guess I&#39;ll have to think of a way to make it easy to get encodings
&gt; right... it&#39;s not as simple a question as it seems, because I want the
&gt; module to be somewhat robust about encodings even in the face of people
&gt; who don&#39;t know exactly what they are doing.
&gt;
&gt;   
</div></div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;06&nbsp;22:35:54&nbsp;2006</span>
    <span class="description">ARISTOTLE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jun 06 22:01:59 2006, KARJALA wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I don&#39;t know if that helps at all...
</div>
I already know that much. And your suggestion will work in the simple
case that all input is consistently encoded and the output the string
correctly &#40;seems to be the case in your code&#41;. But I&#39;m not sure it&#39;s
enough to deal with more complex scenarios robustly: how do I react if
the caller gives me several non-Unicode strings in different encodings?
How do I *detect* it? Just encoding everything and capping output at
&#34;us-ascii&#34; at least ensures that the feed will always be well-formed XML
no matter what.

I will have to think about this. It&#39;s clearly going to be an issue for
others too; people publishing in Asian scripts f.ex. will very likely
need to use UTF-16. Hrmf.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;06&nbsp;23:16:20&nbsp;2006</span>
    <span class="description">karjala [...] karjala.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #19722] Can&#39;t make it to work with international charsets</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 07 Jun 2006 06:14:58 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-Atom-SimpleFeed [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Alexander Karelas &lt;karjala [...] karjala.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I don&#39;t know if it&#39;s possible to detect the encoding.

Maybe you could ask the user to provide during object creation:
&#40;1&#41; a optional global encoding for the feed &#40;which defaults to utf-8&#41;, and
&#40;2&#41; an optional encoding for each feed item &#40;which defaults to the 
global encoding&#41;,

and then have one of the ready modules in CPAN translate the items&#39; 
texts from encoding #2 to encoding #1.

That&#39;s the only solution I can come up with.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;08&nbsp;11:46:13&nbsp;2006</span>
    <span class="description">jrockway [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> JROCKWAY [...] cpan.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Unless you&#39;re working on this right now, I think I&#39;ll have a patch for
this problem soon.  What your module is doing is it&#39;s encoding the
individual octets of utf-8 characters as entities.  You can look at 

<span class="clickylink"><a target="new" rel="nofollow" href="http://blog.jrock.us/feeds/article/%E9%9B%BB%E8%BB%8A%E7%94%B7/xml">http://blog.jrock.us/feeds/article/%E9%9B%BB%E8%BB%8A%E7%94%B7/xml</a></span>

For an example of this.  All the Japanese comes out garbled because the
entities represent individual octets of the multi-byte character sequence.

My solution to this is to just set the encoding to utf-8 and dump the
raw octets that perl uses internally &#40;utf-8&#41;.  If you want, I could add
a charset config option and try to have Encode do a charset conversion
&#40;and throw an exception if it&#39;s not possible to represent the content in
memory in that charset&#41;.

Regards,
Jonathan Rockway

On Tue Jun 06 00:56:21 2006, guest wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Encoding is &#34;us-ascii&#34;, and any international content I add appears
&gt; garbled in my RSS reader.
&gt; 
&gt; I think two things nned to be changed to fix the situation:
&gt; encoding=&#34;UTF-8&#34;, and not create &#38;#231;-type entities out of non-ascii
&gt; bytes.
</div>
-- 
Jonathan Rockway &lt;jrockway@cpan.org&gt;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;08&nbsp;18:55:17&nbsp;2006</span>
    <span class="description">pagaltzis [...] gmx.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #19722] Can&#39;t make it to work with international charsets</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 9 Sep 2006 00:55:24 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Jonathan Rockway via RT &lt;bug-XML-Atom-SimpleFeed [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;A. Pagaltzis&#34; &lt;pagaltzis [...] gmx.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Jonathan,

* Jonathan Rockway via RT &lt;bug-XML-Atom-SimpleFeed@rt.cpan.org&gt; [2006-09-08 17:50]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; All the Japanese comes out garbled because the entities
&gt; represent individual octets of the multi-byte character
&gt; sequence.
&gt; 
&gt; My solution to this is to just set the encoding to utf-8 and
&gt; dump the raw octets that perl uses internally &#40;utf-8&#41;.
</div>
I suggest you mark the string as UTF-8 prior to passing it in.
Then X::A::SF will do the right thing without any further
adjustments.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If you want, I could add a charset config option and try to
&gt; have Encode do a charset conversion &#40;and throw an exception if
&gt; it&#39;s not possible to represent the content in memory in that
&gt; charset&#41;.
</div>
I have something like that already planned, but I’m still
thinking about it. I consciously chose to limit the output to
US-ASCII because then it doesn’t matter what the caller does with
the string: it will never be double-encoded in any form.

But obviously, for people whose language is sufficiently far
outside the US-ASCII charset, the result is an unreadable entity
forest, so I will need to provide some way to specify an encoding.

An issue with that is that with the current internal design, such
an option could only be set by the constructor. I am wondering
whether to enshrine this limitation in the API or to change the
design.

I know the encodings problem seems very simple to solve, but
there’s more to it than you’d think. I want to make the API as
transparent as possible WRT encodings, and that’s going to take
some thinking.

Regards,
-- 
Aristotle Pagaltzis // &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://plasmasturm.org/">http://plasmasturm.org/</a></span>&gt;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;11&nbsp;11:47:58&nbsp;2006</span>
    <span class="description">jrockway [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> JROCKWAY [...] cpan.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
You are absolutely right -- your module works fine.  I must not be
setting the utf8 flag somewhere -- OpenBSD has no concept of locales in
its C library, so I have to do everything myself.  Grumble, grumble. :&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; * Jonathan Rockway via RT &lt;bug-XML-Atom-SimpleFeed@rt.cpan.org&gt; [2006-
&gt; 09-08 17:50]:
<div class="message-stanza open">&gt; &gt; All the Japanese comes out garbled because the entities
&gt; &gt; represent individual octets of the multi-byte character
&gt; &gt; sequence.
&gt; &gt;
&gt; &gt; My solution to this is to just set the encoding to utf-8 and
&gt; &gt; dump the raw octets that perl uses internally &#40;utf-8&#41;.
</div></div>

-- 
Jonathan Rockway &lt;jrockway@cpan.org&gt;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;23&nbsp;12:05:02&nbsp;2009</span>
    <span class="description">daxim [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Attached documentation patch clarifies the findings about encoding, I
reused some wording from above. Therein I also advise to delegate output
transformation to specialised tools. Hopefully this is enough to close
this bug.


I wish to add my proverbial mustard to some other topics from this thread.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; how do I react if
&gt; the caller gives me several non-Unicode strings in different encodings?
</div>You cannot outsmart people who are such terminally confused. No one else
tries to. The documentation should make explicit that this module
accepts Text strings &#40;in perlunitut jargon&#41; and DTRT with them. If
someone wants to ignore that, then just let him: garbage in, garbage out.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; How do I *detect* it?
</div>»Oh, that way madness lies; let me shun that.« The best heuristic
unsurprisingly comes from NSUniversalDetector
&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.mozilla.org/projects/intl/detectorsrc.html">http://www.mozilla.org/projects/intl/detectorsrc.html</a></span>&gt;,
&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/dist/Encode-Detect/">http://search.cpan.org/dist/Encode-Detect/</a></span>&gt;, but IMO this has no place
in X::A::SF.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; people publishing in Asian scripts f.ex. will very likely
&gt; need to use UTF-16.
</div>No, my observation is that on the web, national encodings are the rule:
GB18030 &#40;often misdeclared as GB2312&#41;, Shift-JIS, Big5... Indic scripts
standardised on UTF-8 due to their late-comer status.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 0861c3e55de3a07829c793560554c655b8ea6b82 Mon Sep 17 00:00:00 2001
From: =?utf-8?q?Lars=20D=C9=AA=E1=B4=87=E1=B4=84=E1=B4=8B=E1=B4=8F=E1=B4=A1=20=E8=BF=AA=E6=8B=89=E6=96=AF?= &lt;daxim@cpan.org&gt;
Date: Tue, 23 Jun 2009 16:46:45 +0200
Subject: [PATCH] RT #19722: docs about how encoding is handled

---
 lib/XML/Atom/SimpleFeed.pm |    2 ++
 1 files changed, 2 insertions&#40;+&#41;, 0 deletions&#40;-&#41;

diff --git a/lib/XML/Atom/SimpleFeed.pm b/lib/XML/Atom/SimpleFeed.pm
index d401148..2c81def 100644
--- a/lib/XML/Atom/SimpleFeed.pm
+++ b/lib/XML/Atom/SimpleFeed.pm
@@ -700,6 +700,8 @@ The C&lt;source&gt; element is not and may never be supported.
 
 Nothing is done to ensure that text constructs with type C&lt;xhtml&gt; and entry contents using either that or an XML media type are well-formed. So far, this is by design. You should strongly consider using an XML writer if you want to include content with such types in your feed.
 
+The XML representation of the feed is encoded in C&lt;us-ascii&gt; only, characters outside this repertoire are encoded as decimal numeric character references, e.g. C&lt;&#38;#12345;&gt;. This makes output files robust against misconfigured webservers that produce wrong headers. As this module does not depend on an external XML writer, but uses a minimal serialiser internally, it also helps reduce its complexity. Encoding should not matter; feed consuming software will just do the right thing. But sometimes it is convenient to be able to read the XML source without the confusing entities. In that case, filter it through an external tool for pretty-printing, e.g. C&lt;xmllint --format --encode utf-8&gt;, or programmatically through an XML library, e.g. L&lt;XML::LibXML::Document/&#34;setEncoding&#34;&gt;.
+
 If you find bugs or you have feature requests, please report them to L&lt;mailto:bug-xml-atom-simplefeed@rt.cpan.org&gt;, or through the web interface at L&lt;<span class="clickylink"><a target="new" rel="nofollow" href="/">http://rt.cpan.org</a></span>&gt;.
 
 
-- 
1.6.3

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;23&nbsp;14:09:46&nbsp;2009</span>
    <span class="description">ARISTOTLE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Attached documentation patch clarifies the findings about
&gt; encoding, I reused some wording from above. Therein I also
&gt; advise to delegate output transformation to specialised tools.
&gt; Hopefully this is enough to close this bug.
</div>
Thanks. I’m not sure whether I want to apply this, though. Since
the time when this ticket was filed, I have learned quite a few
things and changed my position on others.

The plan is now to make the charset configurable. I have long
wanted to refactor the internals, as they currently produce
fragments of XML as you call methods, which are glued together
in the end. This approach makes the internals very inflexible.

As part of this, I have accepted the reality that there are no
good XML emitter modules on CPAN, and taken it upon myself to
write on, whose API closely follows HTML::Tiny.

Once that is done, SimpleFeed is due for a complete &#40;though
incremental&#41; overhaul. And at that time, this ticket will finally
be fully addressed.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; how do I react if the caller gives me several non-Unicode
&gt; &gt; strings in different encodings?
</div>&gt; 
&gt; You cannot outsmart people who are such terminally confused. No
&gt; one else tries to. The documentation should make explicit that
&gt; this module accepts Text strings &#40;in perlunitut jargon&#41; and
&gt; DTRT with them. If someone wants to ignore that, then just let
&gt; him: garbage in, garbage out.
</div>
Yes. I understand that now.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; How do I *detect* it?
</div>&gt; 
&gt; »Oh, that way madness lies; let me shun that.« The best
&gt; heuristic unsurprisingly comes from NSUniversalDetector
&gt; &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.mozilla.org/projects/intl/detectorsrc.html">http://www.mozilla.org/projects/intl/detectorsrc.html</a></span>&gt;,
&gt; &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/dist/Encode-Detect/">http://search.cpan.org/dist/Encode-Detect/</a></span>&gt;, but IMO this has
&gt; no place in X::A::SF.
</div>
Oh no. I was not trying to actually do something useful with
those strings; I was just wondering if it was possible to detect
such an error and throw an exception or something. But I have
since learned that strings in Perl are completely untyped – that
there isn’t even a distinction between text strings and octet
strings &#40;like a naïve understanding of the UTF8 flag suggests&#41;.
So it is in fact entirely impossible to determine the semantics
of a string by examining the string. Hence all I can do is as you
say: document that the module expects text strings for input and
produces an octet sequence as output.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; people publishing in Asian scripts f.ex. will very likely
&gt; &gt; need to use UTF-16.
</div>&gt; 
&gt; No, my observation is that on the web, national encodings are
&gt; the rule: GB18030 &#40;often misdeclared as GB2312&#41;, Shift-JIS,
&gt; Big5... Indic scripts standardised on UTF-8 due to their
&gt; late-comer status.
</div>
Aha. Well, I was not making an observation, really. The fact is
that XML parsers are not required to support any of those
national encodings &#40;not even Latin-1, I think&#41;; but they are
required to support the various UTF variants, so in that sense
UTF-16 is the conservative option.

Anyway, this doesn’t actually matter for any of the points at
hand.

What matters is that I finally have a plan for how I want to
proceed with the module.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;22&nbsp;08:41:33&nbsp;2015</span>
    <span class="description">ARISTOTLE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">It’s y’all’s lucky day: this is now *finally* fixed. Please find release 0.9000 on your local CPAN mirror once it’s there.

It only took 10 years!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;22&nbsp;08:41:40&nbsp;2015</span>
    <span class="description">ARISTOTLE [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
