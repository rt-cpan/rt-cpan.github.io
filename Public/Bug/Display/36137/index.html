<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #36137 for DBIx-Class: DBIx::Class::InflateColumn::DateTime timestamp with timezone</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #36137 for DBIx-Class: DBIx::Class::InflateColumn::DateTime timestamp with timezone</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DBIx-Class/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DBIx-Class/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DBIx-Class/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DBIx-Class/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBIx-Class">DBIx-Class CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">36137</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">8 hours (480 min)

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DBIx-Class/Active/">DBIx-Class</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jozef [...] kutej.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-10410-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.08010    </td>
  </tr>
  <tr id="CF-10411-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.08103    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;23&nbsp;11:56:00&nbsp;2008</span>
    <span class="description">jozef [...] kutej.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> DBIx::Class::InflateColumn::DateTime timestamp with timezone</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

would you mind to apply this patch &#40;attached&#41; that will allow usage of
parse_timestamp, parse_timestamptz, format_timestamp and
format_timestamptz? So that timestamp with timezone database column type
can be used.

Thank you,
Jozef.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> DBIx-Class-timestamptz.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -Naur DBIx-Class-0.08099_01/lib/DBIx/Class/InflateColumn/DateTime.pm DBIx-Class/lib/DBIx/Class/InflateColumn/DateTime.pm
--- DBIx-Class-0.08099_01/lib/DBIx/Class/InflateColumn/DateTime.pm	2008-01-20 14:29:20.000000000 +0100
+++ DBIx-Class/lib/DBIx/Class/InflateColumn/DateTime.pm	2008-05-23 17:36:09.000000000 +0200
@@ -30,6 +30,16 @@
     starts_when =&gt; { data_type =&gt; &#39;datetime&#39;, extra =&gt; { timezone =&gt; &#34;America/Chicago&#34; } }
   &#41;;
 
+data_type can be also &#39;timestamp&#39;, &#39;timestamptz&#39;:
+
+  __PACKAGE__-&gt;add_columns&#40;
+    starts_when =&gt; { data_type =&gt; &#39;timestamp&#39;, extra =&gt; { timezone =&gt; &#34;America/Chicago&#34; } }
+  &#41;;
+
+  __PACKAGE__-&gt;add_columns&#40;
+    starts_when =&gt; { data_type =&gt; &#39;timestamptz&#39; }
+  &#41;;
+
 =head1 DESCRIPTION
 
 This module figures out the type of DateTime::Format::* class to 
@@ -60,13 +70,13 @@
   $self-&gt;next::method&#40;$column, $info, @rest&#41;;
   return unless defined&#40;$info-&gt;{data_type}&#41;;
   my $type = lc&#40;$info-&gt;{data_type}&#41;;
-  $type = &#39;datetime&#39; if &#40;$type =~ /^timestamp/&#41;;
+#  $type = &#39;datetime&#39; if &#40;$type =~ /^timestamp/&#41;;
   my $timezone;
   if &#40; exists $info-&gt;{extra} and exists $info-&gt;{extra}{timezone} and defined $info-&gt;{extra}{timezone} &#41; {
     $timezone = $info-&gt;{extra}{timezone};
   }
 
-  if &#40;$type eq &#39;datetime&#39; || $type eq &#39;date&#39;&#41; {
+  if &#40;$type eq &#39;datetime&#39; || $type eq &#39;date&#39; || $type eq &#39;timestamp&#39; || $type eq &#39;timestamptz&#39;&#41; {
     my &#40;$parse, $format&#41; = &#40;&#34;parse_${type}&#34;, &#34;format_${type}&#34;&#41;;
     $self-&gt;inflate_column&#40;
       $column =&gt;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;28&nbsp;16:19:37&nbsp;2008</span>
    <span class="description">rt-cpan [...] trout.me.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri May 23 11:56:00 2008, JKUTEJ wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt; 
&gt; would you mind to apply this patch &#40;attached&#41; that will allow usage of
&gt; parse_timestamp, parse_timestamptz, format_timestamp and
&gt; format_timestamptz? So that timestamp with timezone database column type
&gt; can be used.
</div>
We&#39;ve had this patch or code almost identical submitted several times now.

As with every other submission, your patch has exactly zero tests.

Without tests, we are not applying the patch.

Ticket marked as &#39;rejected&#39;. Please write tests before submitting again;
if you&#39;re willing to try but aren&#39;t user how, please subscribe to
dbix-class@lists.scsys.co.uk and ask for help on there.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;28&nbsp;16:19:41&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;28&nbsp;16:19:43&nbsp;2008</span>
    <span class="description">rt-cpan [...] trout.me.uk -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;30&nbsp;09:56:01&nbsp;2008</span>
    <span class="description">jozef [...] kutej.net -  Correspondence added</span>
    <span class="time-taken">480 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> dbix-class [...] lists.scsys.co.uk</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

here is the 5 line patch with 235 lines of test code ;-&#41;

It works fine with Postgres and Oracle.

For Oracle tests to work I had to:

fix SQL::Translator::Producer::Oracle -
<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org//Ticket/Display.html?id=36300">http://rt.cpan.org//Ticket/Display.html?id=36300</a></span> +
<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org//Ticket/Display.html?id=36301">http://rt.cpan.org//Ticket/Display.html?id=36301</a></span>

But that was a problem of schema-&gt;deploy.

also DateTime::Format::Oracle not &#40;jet&#41; support timestamp with timezone,
but hopefully will soon - <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=36029">http://rt.cpan.org/Ticket/Display.html?id=36029</a></span>

Regards,
Jozef.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -Naur DBIx-Class.orig/lib/DBIx/Class/InflateColumn/DateTime.pm DBIx-Class/lib/DBIx/Class/InflateColumn/DateTime.pm
--- DBIx-Class.orig/lib/DBIx/Class/InflateColumn/DateTime.pm	2008-02-07 12:29:23.000000000 +0100
+++ DBIx-Class/lib/DBIx/Class/InflateColumn/DateTime.pm	2008-05-30 15:17:23.000000000 +0200
@@ -30,6 +30,16 @@
     starts_when =&gt; { data_type =&gt; &#39;datetime&#39;, extra =&gt; { timezone =&gt; &#34;America/Chicago&#34; } }
   &#41;;
 
+data_type can be also &#39;timestamp&#39;, &#39;timestamptz&#39;:
+
+  __PACKAGE__-&gt;add_columns&#40;
+    starts_when =&gt; { data_type =&gt; &#39;timestamp&#39;, extra =&gt; { timezone =&gt; &#34;America/Chicago&#34; } }
+  &#41;;
+
+  __PACKAGE__-&gt;add_columns&#40;
+    starts_when =&gt; { data_type =&gt; &#39;timestamptz&#39; }
+  &#41;;
+
 =head1 DESCRIPTION
 
 This module figures out the type of DateTime::Format::* class to 
@@ -60,13 +70,15 @@
   $self-&gt;next::method&#40;$column, $info, @rest&#41;;
   return unless defined&#40;$info-&gt;{data_type}&#41;;
   my $type = lc&#40;$info-&gt;{data_type}&#41;;
-  $type = &#39;datetime&#39; if &#40;$type =~ /^timestamp/&#41;;
+  $type = &#39;timestamptz&#39;
+      if $type eq &#39;timestamp with time zone&#39;;
+#  $type = &#39;datetime&#39; if &#40;$type =~ /^timestamp/&#41;;
   my $timezone;
   if &#40; exists $info-&gt;{extra} and exists $info-&gt;{extra}{timezone} and defined $info-&gt;{extra}{timezone} &#41; {
     $timezone = $info-&gt;{extra}{timezone};
   }
 
-  if &#40;$type eq &#39;datetime&#39; || $type eq &#39;date&#39;&#41; {
+  if &#40;$type eq &#39;datetime&#39; || $type eq &#39;date&#39; || $type eq &#39;timestamp&#39; || $type eq &#39;timestamptz&#39;&#41; {
     my &#40;$parse, $format&#41; = &#40;&#34;parse_${type}&#34;, &#34;format_${type}&#34;&#41;;
     $self-&gt;inflate_column&#40;
       $column =&gt;
diff -Naur DBIx-Class.orig/t/89inflate_datetime_timestamptz.t DBIx-Class/t/89inflate_datetime_timestamptz.t
--- DBIx-Class.orig/t/89inflate_datetime_timestamptz.t	1970-01-01 01:00:00.000000000 +0100
+++ DBIx-Class/t/89inflate_datetime_timestamptz.t	2008-05-30 15:24:12.000000000 +0200
@@ -0,0 +1,123 @@
+#!/usr/bin/perl
+
+use strict;
+use warnings;
+
+use Test::More;
+
+use FindBin qw&#40;$Bin&#41;;
+use lib &#34;$Bin/lib&#34;;
+
+BEGIN {
+    plan&#40;&#39;skip_all&#39; =&gt; &#39;please set $ENV{&#34;DBICTEST_DSN&#34;}, $ENV{&#34;DBICTEST_DBUSER&#34;}, $ENV{&#34;DBICTEST_DBPASS&#34;} to run the tests&#39;&#41;
+        if not $ENV{&#34;DBICTEST_DSN&#34;};    
+}
+
+#plan &#39;no_plan&#39;;
+plan &#39;tests&#39; =&gt; 14;
+
+exit main&#40;&#41;;
+
+sub main {
+    use_ok&#40; &#39;DBICTestTimestamp&#39; &#41; or exit;
+    
+    my $db = DBICTestTimestamp-&gt;connect&#40;
+        $ENV{&#34;DBICTEST_DSN&#34;},
+        $ENV{&#34;DBICTEST_DBUSER&#34;},
+        $ENV{&#34;DBICTEST_DBPASS&#34;},
+    &#41;;
+    
+    my $db_driver_name = $db-&gt;storage-&gt;dbh-&gt;{&#39;Driver&#39;}-&gt;{&#39;Name&#39;};
+    
+    # cleanup
+    eval {
+        $db-&gt;storage-&gt;dbh-&gt;do&#40;&#39;DROP TABLE timestamp_test&#39;&#41;;
+    };
+    $db-&gt;deploy;
+    
+    my $tst_rs = $db-&gt;resultset&#40;&#39;DBICTestTimestamp::TimestampTZ&#39;&#41;;
+    
+	my $ts = $tst_rs-&gt;create&#40;{
+	    &#39;timestamp_test_id&#39; =&gt; 1,
+	    &#39;ts&#39; =&gt; DateTime-&gt;now&#40;&#39;time_zone&#39; =&gt; &#39;UTC&#39;&#41;,
+	}&#41;;
+	ok&#40;$ts, &#39;create with ts&#39;&#41;;
+	
+	my $utc_hour = DateTime-&gt;now&#40;&#39;time_zone&#39; =&gt; &#39;UTC&#39;&#41;-&gt;hour;
+	diag&#40;&#39;now is &#39;.DateTime-&gt;now&#40;&#39;time_zone&#39; =&gt; &#39;UTC&#39;&#41;-&gt;strftime&#40;&#39;%a, %d %b %Y %H:%M:%S %z&#39;&#41;&#41;;
+	
+	# fetch the row back
+	my &#40;$ts2&#41; = $tst_rs-&gt;search&#40;{ &#39;timestamp_test_id&#39; =&gt; $ts-&gt;timestamp_test_id }&#41;;
+	
+	is&#40;$ts2-&gt;tstz, undef, &#39;NULL rows return undef&#39;&#41;;
+    isa_ok&#40;$ts2-&gt;ts, &#39;DateTime&#39;, &#39;not NULL DateTime object&#39;&#41;;
+    
+    cmp_ok&#40;
+        $ts2-&gt;ts-&gt;time_zone-&gt;name,
+        &#39;ne&#39;,
+        &#39;floating&#39;,
+        &#39;timezone should be set &#40;&#39;.$ts2-&gt;ts-&gt;time_zone-&gt;name.&#39;&#41;, no floating&#39;
+    &#41;;
+    
+    cmp_ok&#40;
+        $ts2-&gt;ts-&gt;hour,
+        &#39;!=&#39;,
+        $utc_hour,
+        &#39;hour should be in the timezone not UTC&#39;
+    &#41;;
+    
+    SKIP: {
+        skip &#39;datetime parser can not do parse_timestamptz&#39;, 4
+            if !$db-&gt;storage-&gt;datetime_parser-&gt;can&#40;&#39;parse_timestamptz&#39;&#41;;
+        
+        # insert row with timestamp and timezone
+    	my $tstz = $tst_rs-&gt;create&#40;{
+    	    &#39;timestamp_test_id&#39; =&gt; 2,
+    	    &#39;tstz&#39;   =&gt; DateTime-&gt;now-&gt;set_time_zone&#40;&#39;America/Chicago&#39;&#41;,
+    	}&#41;;
+    	ok&#40;$tstz, &#39;create with tstz&#39;&#41;;
+    	
+    	# fetch the row back
+    	my &#40;$tstz2&#41; = $tst_rs-&gt;search&#40;{ &#39;timestamp_test_id&#39; =&gt; $tstz-&gt;timestamp_test_id }&#41;;
+    	is&#40;$tstz2-&gt;ts, undef, &#39;NULL rows return undef&#39;&#41;;
+        isa_ok&#40;$tstz2-&gt;tstz, &#39;DateTime&#39;, &#39;not NULL DateTime object&#39;&#41;;
+        
+        if &#40;$db_driver_name eq &#39;Pg&#39;&#41; {
+            # When a timestamp with time zone value is output, it is always converted from UTC
+            # to the current timezone zone, and displayed as local time in that zone.
+            # <span class="clickylink"><a target="new" rel="nofollow" href="http://www.postgresql.org/docs/8.2/interactive/datatype-datetime.html">http://www.postgresql.org/docs/8.2/interactive/datatype-datetime.html</a></span>
+            cmp_ok&#40;
+                $tstz2-&gt;tstz-&gt;time_zone-&gt;name,
+                &#39;ne&#39;,
+                &#39;floating&#39;,
+                &#39;timezone should be set &#40;&#39;.$tstz2-&gt;tstz-&gt;time_zone-&gt;name.&#39;&#41;, no floating&#39;
+            &#41;;        
+        }
+        else {
+            is&#40;$tstz2-&gt;tstz-&gt;time_zone-&gt;name, &#39;-0500&#39;, &#39;time zone kept&#39;&#41;;
+        }
+    }
+    
+    # insert row with datetime
+	my $d = $tst_rs-&gt;create&#40;{
+	    &#39;timestamp_test_id&#39; =&gt; 3,
+	    &#39;d&#39; =&gt; DateTime-&gt;now,
+	}&#41;;
+	ok&#40;$d, &#39;create with date&#39;&#41;;
+	
+	# fetch the row back
+	my &#40;$d2&#41; = $tst_rs-&gt;search&#40;{ &#39;timestamp_test_id&#39; =&gt; $d-&gt;timestamp_test_id }&#41;;
+	
+	is&#40;$d2-&gt;tstz, undef, &#39;NULL rows return undef&#39;&#41;;
+    isa_ok&#40;$d2-&gt;d, &#39;DateTime&#39;, &#39;not NULL DateTime object&#39;&#41;;
+    
+    cmp_ok&#40;
+        $d2-&gt;d-&gt;time_zone-&gt;name,
+        &#39;ne&#39;,
+        &#39;floating&#39;,
+        &#39;timezone should be set &#40;&#39;.$d2-&gt;d-&gt;time_zone-&gt;name.&#39;&#41;, no floating&#39;
+    &#41;;
+
+	return 0;
+}
+
diff -Naur DBIx-Class.orig/t/lib/DBICTestTimestamp/TimestampTZ.pm DBIx-Class/t/lib/DBICTestTimestamp/TimestampTZ.pm
--- DBIx-Class.orig/t/lib/DBICTestTimestamp/TimestampTZ.pm	1970-01-01 01:00:00.000000000 +0100
+++ DBIx-Class/t/lib/DBICTestTimestamp/TimestampTZ.pm	2008-05-30 15:23:08.000000000 +0200
@@ -0,0 +1,55 @@
+package DBICTestTimestamp::TimestampTZ;
+
+=head1 NAME
+
+COIN::Curator::DBIC::Test::TimestampTest - testing table to play with timestamps
+
+=head1 SYNOPSIS
+
+=cut
+
+use strict;
+use warnings;
+
+use base qw/DBIx::Class/;
+
+=head1 DESCRIPTION
+
+=head2 table
+
+    timestamp_test
+
+=head2 columns
+
+    timestamp_test_id - PL
+    ts     =&gt; { data_type =&gt; &#39;datetime&#39;, extra =&gt; { timezone =&gt; &#39;Europe/Vienna&#39; }},
+    tstz   =&gt; { data_type =&gt; &#39;datetime&#39; },
+
+=cut
+
+__PACKAGE__-&gt;load_components&#40;qw/PK::Auto InflateColumn::DateTime ResultSetManager Core/&#41;;
+__PACKAGE__-&gt;table&#40;&#39;timestamp_test&#39;&#41;;
+__PACKAGE__-&gt;add_columns&#40;
+    timestamp_test_id =&gt; { data_type =&gt; &#39;int&#39; },
+    ts                =&gt; { data_type =&gt; &#39;timestamp&#39;, extra =&gt; { timezone =&gt; &#39;Europe/Vienna&#39; }, &#39;is_nullable&#39; =&gt; 1},
+    tstz              =&gt; { data_type =&gt; &#39;timestamp with time zone&#39;, &#39;is_nullable&#39; =&gt; 1 },
+    d                 =&gt; { data_type =&gt; &#39;datetime&#39;, extra =&gt; { timezone =&gt; &#39;Europe/Vienna&#39; }, &#39;is_nullable&#39; =&gt; 1},
+&#41;;
+__PACKAGE__-&gt;set_primary_key&#40;&#39;timestamp_test_id&#39;&#41;;
+
+
+=head1 METHODS
+
+=cut
+
+1;
+
+
+__END__
+
+=head1 AUTHOR
+
+Jozef Kutej
+
+=cut
+
diff -Naur DBIx-Class.orig/t/lib/DBICTestTimestamp.pm DBIx-Class/t/lib/DBICTestTimestamp.pm
--- DBIx-Class.orig/t/lib/DBICTestTimestamp.pm	1970-01-01 01:00:00.000000000 +0100
+++ DBIx-Class/t/lib/DBICTestTimestamp.pm	2008-05-30 15:23:08.000000000 +0200
@@ -0,0 +1,56 @@
+package DBICTestTimestamp;
+
+=head1 NAME
+
+DBICTestTimestamp - DBIC timestamp test schema
+
+=cut
+
+use strict;
+use warnings;
+
+our $VERSION = &#39;0.01&#39;;
+
+use base qw/DBIx::Class::Schema/;
+
+
+
+__PACKAGE__-&gt;load_classes&#40;qw{
+    TimestampTZ
+}&#41;;
+
+sub connect {
+    my $class = shift;
+    
+    my $self = $class-&gt;SUPER::connect&#40;@_&#41;;
+    
+    # set the date, timestamp and timestamp with timezone format for Oracle
+    if &#40;$self-&gt;storage-&gt;dbh-&gt;{&#39;Driver&#39;}-&gt;{&#39;Name&#39;} eq &#39;Oracle&#39;&#41; {
+        eval &#39;use DateTime::Format::Oracle;&#39;;
+        die &#39;need DateTime::Format::Oracle for Oracle timestamp tests - &#39;.$@ if $@;
+        
+        $self-&gt;storage-&gt;dbh-&gt;do&#40;
+            &#34;alter session set nls_date_format = &#39;&#34; 
+            .DateTime::Format::Oracle-&gt;nls_date_format
+            .&#34;&#39;&#34;
+        &#41;;
+        $self-&gt;storage-&gt;dbh-&gt;do&#40;
+            &#34;alter session set nls_timestamp_format = &#39;&#34; 
+            .DateTime::Format::Oracle-&gt;nls_timestamp_format
+            .&#34;&#39;&#34;
+        &#41;;
+        
+        # timestamptz not jet implemented in DateTime::Format::Oracle, hopefully in the future...
+        if &#40;DateTime::Format::Oracle-&gt;can&#40;&#39;nls_timestamp_tz_format&#39;&#41;&#41; {
+            $self-&gt;storage-&gt;dbh-&gt;do&#40;
+                &#34;alter session set nls_timestamp_tz_format = &#39;&#34; 
+                .DateTime::Format::Oracle-&gt;nls_timestamp_tz_format
+                .&#34;&#39;&#34;
+            &#41;;
+        }
+    }
+    
+    return $self;
+}
+
+1;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;30&nbsp;09:56:05&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;30&nbsp;09:56:32&nbsp;2008</span>
    <span class="description">dbix-class-owner [...] lists.scsys.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [rt.cpan.org #36137] DBIx::Class::InflateColumn::DateTime timestamp with timezone </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 30 May 2008 14:56:08 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-dbix-class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> dbix-class-owner [...] lists.scsys.co.uk</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">You are not allowed to post to this mailing list, and your message has
been automatically rejected.  If you think that your messages are
being rejected in error, contact the mailing list owner at
dbix-class-owner@lists.scsys.co.uk.
</div></div>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> dbix-class [...] lists.scsys.co.uk</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [rt.cpan.org #36137] DBIx::Class::InflateColumn::DateTime timestamp
	with timezone </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 30 May 2008 09:56:05 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Jozef Kutej via RT&#34; &lt;bug-DBIx-Class [...] rt.cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=36137">http://rt.cpan.org/Ticket/Display.html?id=36137</a></span> &gt;

Hi,

here is the 5 line patch with 235 lines of test code ;-&#41;

It works fine with Postgres and Oracle.

For Oracle tests to work I had to:

fix SQL::Translator::Producer::Oracle -
<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org//Ticket/Display.html?id=36300">http://rt.cpan.org//Ticket/Display.html?id=36300</a></span> +
<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org//Ticket/Display.html?id=36301">http://rt.cpan.org//Ticket/Display.html?id=36301</a></span>

But that was a problem of schema-&gt;deploy.

also DateTime::Format::Oracle not &#40;jet&#41; support timestamp with timezone,
but hopefully will soon - <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=36029">http://rt.cpan.org/Ticket/Display.html?id=36029</a></span>

Regards,
Jozef.
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -Naur DBIx-Class.orig/lib/DBIx/Class/InflateColumn/DateTime.pm DBIx-Class/lib/DBIx/Class/InflateColumn/DateTime.pm
--- DBIx-Class.orig/lib/DBIx/Class/InflateColumn/DateTime.pm	2008-02-07 12:29:23.000000000 +0100
+++ DBIx-Class/lib/DBIx/Class/InflateColumn/DateTime.pm	2008-05-30 15:17:23.000000000 +0200
@@ -30,6 +30,16 @@
     starts_when =&gt; { data_type =&gt; &#39;datetime&#39;, extra =&gt; { timezone =&gt; &#34;America/Chicago&#34; } }
   &#41;;
 
+data_type can be also &#39;timestamp&#39;, &#39;timestamptz&#39;:
+
+  __PACKAGE__-&gt;add_columns&#40;
+    starts_when =&gt; { data_type =&gt; &#39;timestamp&#39;, extra =&gt; { timezone =&gt; &#34;America/Chicago&#34; } }
+  &#41;;
+
+  __PACKAGE__-&gt;add_columns&#40;
+    starts_when =&gt; { data_type =&gt; &#39;timestamptz&#39; }
+  &#41;;
+
 =head1 DESCRIPTION
 
 This module figures out the type of DateTime::Format::* class to 
@@ -60,13 +70,15 @@
   $self-&gt;next::method&#40;$column, $info, @rest&#41;;
   return unless defined&#40;$info-&gt;{data_type}&#41;;
   my $type = lc&#40;$info-&gt;{data_type}&#41;;
-  $type = &#39;datetime&#39; if &#40;$type =~ /^timestamp/&#41;;
+  $type = &#39;timestamptz&#39;
+      if $type eq &#39;timestamp with time zone&#39;;
+#  $type = &#39;datetime&#39; if &#40;$type =~ /^timestamp/&#41;;
   my $timezone;
   if &#40; exists $info-&gt;{extra} and exists $info-&gt;{extra}{timezone} and defined $info-&gt;{extra}{timezone} &#41; {
     $timezone = $info-&gt;{extra}{timezone};
   }
 
-  if &#40;$type eq &#39;datetime&#39; || $type eq &#39;date&#39;&#41; {
+  if &#40;$type eq &#39;datetime&#39; || $type eq &#39;date&#39; || $type eq &#39;timestamp&#39; || $type eq &#39;timestamptz&#39;&#41; {
     my &#40;$parse, $format&#41; = &#40;&#34;parse_${type}&#34;, &#34;format_${type}&#34;&#41;;
     $self-&gt;inflate_column&#40;
       $column =&gt;
diff -Naur DBIx-Class.orig/t/89inflate_datetime_timestamptz.t DBIx-Class/t/89inflate_datetime_timestamptz.t
--- DBIx-Class.orig/t/89inflate_datetime_timestamptz.t	1970-01-01 01:00:00.000000000 +0100
+++ DBIx-Class/t/89inflate_datetime_timestamptz.t	2008-05-30 15:24:12.000000000 +0200
@@ -0,0 +1,123 @@
+#!/usr/bin/perl
+
+use strict;
+use warnings;
+
+use Test::More;
+
+use FindBin qw&#40;$Bin&#41;;
+use lib &#34;$Bin/lib&#34;;
+
+BEGIN {
+    plan&#40;&#39;skip_all&#39; =&gt; &#39;please set $ENV{&#34;DBICTEST_DSN&#34;}, $ENV{&#34;DBICTEST_DBUSER&#34;}, $ENV{&#34;DBICTEST_DBPASS&#34;} to run the tests&#39;&#41;
+        if not $ENV{&#34;DBICTEST_DSN&#34;};    
+}
+
+#plan &#39;no_plan&#39;;
+plan &#39;tests&#39; =&gt; 14;
+
+exit main&#40;&#41;;
+
+sub main {
+    use_ok&#40; &#39;DBICTestTimestamp&#39; &#41; or exit;
+    
+    my $db = DBICTestTimestamp-&gt;connect&#40;
+        $ENV{&#34;DBICTEST_DSN&#34;},
+        $ENV{&#34;DBICTEST_DBUSER&#34;},
+        $ENV{&#34;DBICTEST_DBPASS&#34;},
+    &#41;;
+    
+    my $db_driver_name = $db-&gt;storage-&gt;dbh-&gt;{&#39;Driver&#39;}-&gt;{&#39;Name&#39;};
+    
+    # cleanup
+    eval {
+        $db-&gt;storage-&gt;dbh-&gt;do&#40;&#39;DROP TABLE timestamp_test&#39;&#41;;
+    };
+    $db-&gt;deploy;
+    
+    my $tst_rs = $db-&gt;resultset&#40;&#39;DBICTestTimestamp::TimestampTZ&#39;&#41;;
+    
+	my $ts = $tst_rs-&gt;create&#40;{
+	    &#39;timestamp_test_id&#39; =&gt; 1,
+	    &#39;ts&#39; =&gt; DateTime-&gt;now&#40;&#39;time_zone&#39; =&gt; &#39;UTC&#39;&#41;,
+	}&#41;;
+	ok&#40;$ts, &#39;create with ts&#39;&#41;;
+	
+	my $utc_hour = DateTime-&gt;now&#40;&#39;time_zone&#39; =&gt; &#39;UTC&#39;&#41;-&gt;hour;
+	diag&#40;&#39;now is &#39;.DateTime-&gt;now&#40;&#39;time_zone&#39; =&gt; &#39;UTC&#39;&#41;-&gt;strftime&#40;&#39;%a, %d %b %Y %H:%M:%S %z&#39;&#41;&#41;;
+	
+	# fetch the row back
+	my &#40;$ts2&#41; = $tst_rs-&gt;search&#40;{ &#39;timestamp_test_id&#39; =&gt; $ts-&gt;timestamp_test_id }&#41;;
+	
+	is&#40;$ts2-&gt;tstz, undef, &#39;NULL rows return undef&#39;&#41;;
+    isa_ok&#40;$ts2-&gt;ts, &#39;DateTime&#39;, &#39;not NULL DateTime object&#39;&#41;;
+    
+    cmp_ok&#40;
+        $ts2-&gt;ts-&gt;time_zone-&gt;name,
+        &#39;ne&#39;,
+        &#39;floating&#39;,
+        &#39;timezone should be set &#40;&#39;.$ts2-&gt;ts-&gt;time_zone-&gt;name.&#39;&#41;, no floating&#39;
+    &#41;;
+    
+    cmp_ok&#40;
+        $ts2-&gt;ts-&gt;hour,
+        &#39;!=&#39;,
+        $utc_hour,
+        &#39;hour should be in the timezone not UTC&#39;
+    &#41;;
+    
+    SKIP: {
+        skip &#39;datetime parser can not do parse_timestamptz&#39;, 4
+            if !$db-&gt;storage-&gt;datetime_parser-&gt;can&#40;&#39;parse_timestamptz&#39;&#41;;
+        
+        # insert row with timestamp and timezone
+    	my $tstz = $tst_rs-&gt;create&#40;{
+    	    &#39;timestamp_test_id&#39; =&gt; 2,
+    	    &#39;tstz&#39;   =&gt; DateTime-&gt;now-&gt;set_time_zone&#40;&#39;America/Chicago&#39;&#41;,
+    	}&#41;;
+    	ok&#40;$tstz, &#39;create with tstz&#39;&#41;;
+    	
+    	# fetch the row back
+    	my &#40;$tstz2&#41; = $tst_rs-&gt;search&#40;{ &#39;timestamp_test_id&#39; =&gt; $tstz-&gt;timestamp_test_id }&#41;;
+    	is&#40;$tstz2-&gt;ts, undef, &#39;NULL rows return undef&#39;&#41;;
+        isa_ok&#40;$tstz2-&gt;tstz, &#39;DateTime&#39;, &#39;not NULL DateTime object&#39;&#41;;
+        
+        if &#40;$db_driver_name eq &#39;Pg&#39;&#41; {
+            # When a timestamp with time zone value is output, it is always converted from UTC
+            # to the current timezone zone, and displayed as local time in that zone.
+            # <span class="clickylink"><a target="new" rel="nofollow" href="http://www.postgresql.org/docs/8.2/interactive/datatype-datetime.html">http://www.postgresql.org/docs/8.2/interactive/datatype-datetime.html</a></span>
+            cmp_ok&#40;
+                $tstz2-&gt;tstz-&gt;time_zone-&gt;name,
+                &#39;ne&#39;,
+                &#39;floating&#39;,
+                &#39;timezone should be set &#40;&#39;.$tstz2-&gt;tstz-&gt;time_zone-&gt;name.&#39;&#41;, no floating&#39;
+            &#41;;        
+        }
+        else {
+            is&#40;$tstz2-&gt;tstz-&gt;time_zone-&gt;name, &#39;-0500&#39;, &#39;time zone kept&#39;&#41;;
+        }
+    }
+    
+    # insert row with datetime
+	my $d = $tst_rs-&gt;create&#40;{
+	    &#39;timestamp_test_id&#39; =&gt; 3,
+	    &#39;d&#39; =&gt; DateTime-&gt;now,
+	}&#41;;
+	ok&#40;$d, &#39;create with date&#39;&#41;;
+	
+	# fetch the row back
+	my &#40;$d2&#41; = $tst_rs-&gt;search&#40;{ &#39;timestamp_test_id&#39; =&gt; $d-&gt;timestamp_test_id }&#41;;
+	
+	is&#40;$d2-&gt;tstz, undef, &#39;NULL rows return undef&#39;&#41;;
+    isa_ok&#40;$d2-&gt;d, &#39;DateTime&#39;, &#39;not NULL DateTime object&#39;&#41;;
+    
+    cmp_ok&#40;
+        $d2-&gt;d-&gt;time_zone-&gt;name,
+        &#39;ne&#39;,
+        &#39;floating&#39;,
+        &#39;timezone should be set &#40;&#39;.$d2-&gt;d-&gt;time_zone-&gt;name.&#39;&#41;, no floating&#39;
+    &#41;;
+
+	return 0;
+}
+
diff -Naur DBIx-Class.orig/t/lib/DBICTestTimestamp/TimestampTZ.pm DBIx-Class/t/lib/DBICTestTimestamp/TimestampTZ.pm
--- DBIx-Class.orig/t/lib/DBICTestTimestamp/TimestampTZ.pm	1970-01-01 01:00:00.000000000 +0100
+++ DBIx-Class/t/lib/DBICTestTimestamp/TimestampTZ.pm	2008-05-30 15:23:08.000000000 +0200
@@ -0,0 +1,55 @@
+package DBICTestTimestamp::TimestampTZ;
+
+=head1 NAME
+
+COIN::Curator::DBIC::Test::TimestampTest - testing table to play with timestamps
+
+=head1 SYNOPSIS
+
+=cut
+
+use strict;
+use warnings;
+
+use base qw/DBIx::Class/;
+
+=head1 DESCRIPTION
+
+=head2 table
+
+    timestamp_test
+
+=head2 columns
+
+    timestamp_test_id - PL
+    ts     =&gt; { data_type =&gt; &#39;datetime&#39;, extra =&gt; { timezone =&gt; &#39;Europe/Vienna&#39; }},
+    tstz   =&gt; { data_type =&gt; &#39;datetime&#39; },
+
+=cut
+
+__PACKAGE__-&gt;load_components&#40;qw/PK::Auto InflateColumn::DateTime ResultSetManager Core/&#41;;
+__PACKAGE__-&gt;table&#40;&#39;timestamp_test&#39;&#41;;
+__PACKAGE__-&gt;add_columns&#40;
+    timestamp_test_id =&gt; { data_type =&gt; &#39;int&#39; },
+    ts                =&gt; { data_type =&gt; &#39;timestamp&#39;, extra =&gt; { timezone =&gt; &#39;Europe/Vienna&#39; }, &#39;is_nullable&#39; =&gt; 1},
+    tstz              =&gt; { data_type =&gt; &#39;timestamp with time zone&#39;, &#39;is_nullable&#39; =&gt; 1 },
+    d                 =&gt; { data_type =&gt; &#39;datetime&#39;, extra =&gt; { timezone =&gt; &#39;Europe/Vienna&#39; }, &#39;is_nullable&#39; =&gt; 1},
+&#41;;
+__PACKAGE__-&gt;set_primary_key&#40;&#39;timestamp_test_id&#39;&#41;;
+
+
+=head1 METHODS
+
+=cut
+
+1;
+
+
+__END__
+
+=head1 AUTHOR
+
+Jozef Kutej
+
+=cut
+
diff -Naur DBIx-Class.orig/t/lib/DBICTestTimestamp.pm DBIx-Class/t/lib/DBICTestTimestamp.pm
--- DBIx-Class.orig/t/lib/DBICTestTimestamp.pm	1970-01-01 01:00:00.000000000 +0100
+++ DBIx-Class/t/lib/DBICTestTimestamp.pm	2008-05-30 15:23:08.000000000 +0200
@@ -0,0 +1,56 @@
+package DBICTestTimestamp;
+
+=head1 NAME
+
+DBICTestTimestamp - DBIC timestamp test schema
+
+=cut
+
+use strict;
+use warnings;
+
+our $VERSION = &#39;0.01&#39;;
+
+use base qw/DBIx::Class::Schema/;
+
+
+
+__PACKAGE__-&gt;load_classes&#40;qw{
+    TimestampTZ
+}&#41;;
+
+sub connect {
+    my $class = shift;
+    
+    my $self = $class-&gt;SUPER::connect&#40;@_&#41;;
+    
+    # set the date, timestamp and timestamp with timezone format for Oracle
+    if &#40;$self-&gt;storage-&gt;dbh-&gt;{&#39;Driver&#39;}-&gt;{&#39;Name&#39;} eq &#39;Oracle&#39;&#41; {
+        eval &#39;use DateTime::Format::Oracle;&#39;;
+        die &#39;need DateTime::Format::Oracle for Oracle timestamp tests - &#39;.$@ if $@;
+        
+        $self-&gt;storage-&gt;dbh-&gt;do&#40;
+            &#34;alter session set nls_date_format = &#39;&#34; 
+            .DateTime::Format::Oracle-&gt;nls_date_format
+            .&#34;&#39;&#34;
+        &#41;;
+        $self-&gt;storage-&gt;dbh-&gt;do&#40;
+            &#34;alter session set nls_timestamp_format = &#39;&#34; 
+            .DateTime::Format::Oracle-&gt;nls_timestamp_format
+            .&#34;&#39;&#34;
+        &#41;;
+        
+        # timestamptz not jet implemented in DateTime::Format::Oracle, hopefully in the future...
+        if &#40;DateTime::Format::Oracle-&gt;can&#40;&#39;nls_timestamp_tz_format&#39;&#41;&#41; {
+            $self-&gt;storage-&gt;dbh-&gt;do&#40;
+                &#34;alter session set nls_timestamp_tz_format = &#39;&#34; 
+                .DateTime::Format::Oracle-&gt;nls_timestamp_tz_format
+                .&#34;&#39;&#34;
+            &#41;;
+        }
+    }
+    
+    return $self;
+}
+
+1;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;17&nbsp;16:19:22&nbsp;2008</span>
    <span class="description">oweng [...] pulse360.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> oweng [...] pulse360.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed May 28 16:19:37 2008, MSTROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri May 23 11:56:00 2008, JKUTEJ wrote:
<div class="message-stanza open">&gt; &gt; Hi,
&gt; &gt; 
&gt; &gt; would you mind to apply this patch &#40;attached&#41; that will allow usage of
&gt; &gt; parse_timestamp, parse_timestamptz, format_timestamp and
&gt; &gt; format_timestamptz? So that timestamp with timezone database column type
&gt; &gt; can be used.
</div>&gt; 
&gt; We&#39;ve had this patch or code almost identical submitted several times now.
&gt; 
&gt; As with every other submission, your patch has exactly zero tests.
&gt; 
&gt; Without tests, we are not applying the patch.
&gt; 
&gt; Ticket marked as &#39;rejected&#39;. Please write tests before submitting again;
&gt; if you&#39;re willing to try but aren&#39;t user how, please subscribe to
&gt; dbix-class@lists.scsys.co.uk and ask for help on there.
</div>
What needs to be done to get this patch accepted? The original author has written tests as 
you asked.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;24&nbsp;10:18:38&nbsp;2008</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Oct 17 16:19:22 2008, oweng wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed May 28 16:19:37 2008, MSTROUT wrote:
<div class="message-stanza open">&gt; &gt; On Fri May 23 11:56:00 2008, JKUTEJ wrote:
<div class="message-stanza open">&gt; &gt; &gt; Hi,
&gt; &gt; &gt;
&gt; &gt; &gt; would you mind to apply this patch &#40;attached&#41; that will allow
</div></div>&gt; usage of
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; parse_timestamp, parse_timestamptz, format_timestamp and
&gt; &gt; &gt; format_timestamptz? So that timestamp with timezone database
</div></div>&gt; column type
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; can be used.
</div>&gt; &gt;
&gt; &gt; We&#39;ve had this patch or code almost identical submitted several
</div>&gt; times now.
<div class="message-stanza open">&gt; &gt;
&gt; &gt; As with every other submission, your patch has exactly zero tests.
&gt; &gt;
&gt; &gt; Without tests, we are not applying the patch.
&gt; &gt;
&gt; &gt; Ticket marked as &#39;rejected&#39;. Please write tests before submitting
</div>&gt; again;
<div class="message-stanza open">&gt; &gt; if you&#39;re willing to try but aren&#39;t user how, please subscribe to
&gt; &gt; dbix-class@lists.scsys.co.uk and ask for help on there.
</div>&gt; 
&gt; What needs to be done to get this patch accepted? The original author
&gt; has written tests as
&gt; you asked.
</div>
The code in its current form is not acceptable as a core dbic module. In
order to work properly &#40;i.e. for IC::DT to use the correct DT::Parser&#41;
the proposed solution &#40;in the tests&#41; is to overload connect&#40;&#41; &#40;ugly&#41;.
Additionally the tests are completely out of line with the currently
available test framework &#40;it belongs in t/73oracle_inflate.t&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;03&nbsp;03:43:11&nbsp;2008</span>
    <span class="description">jozef [...] kutej.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">OK, I don&#39;t need it any more so feel free to forget about it. :-&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;03&nbsp;03:43:14&nbsp;2008</span>
    <span class="description">jozef [...] kutej.net -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;26&nbsp;03:20:01&nbsp;2009</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Re-opening as a proper timestamp support as merged into trunk &#40;code by a
different developer&#41;. Will be resolved by a release following shortly.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;26&nbsp;03:20:02&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;26&nbsp;16:25:01&nbsp;2009</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">DBIx::Class 0.08103 just released on CPAN fixes this RT.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;26&nbsp;16:25:03&nbsp;2009</span>
    <span class="description">ribasushi [...] leporine.io -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;May&nbsp;27&nbsp;01:04:29&nbsp;2009</span>
    <span class="description">ribasushi [...] leporine.io -  Fixed in 0.08103 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
