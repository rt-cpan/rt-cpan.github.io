<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #91798 for PPIx-Regexp: perl_version_introduced bug</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #91798 for PPIx-Regexp: perl_version_introduced bug</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/PPIx-Regexp/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/PPIx-Regexp/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/PPIx-Regexp/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/PPIx-Regexp/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please email the <a href="mailto:wyant@cpan.org">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/PPIx-Regexp">PPIx-Regexp CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">91798</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/PPIx-Regexp/Active/">PPIx-Regexp</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
monmon [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
lesamoureuses [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-229860-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.033    </td>
  </tr>
  <tr id="CF-229861-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.036    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;02&nbsp;12:45:33&nbsp;2014</span>
    <span class="description">monmon [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> lesamoureuses [...] gmail.com</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> perl_version_introduced bug</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Japanese Katakana &#34;ム&#34; is represented by octal code &#34;\343\203\240&#34;.
Using it and /x, perl_version_introduced value is not right. 


===
my $re = PPIx::Regexp-&gt;new&#40;&#34;qr/\343\203\240/x&#34;&#41;;
print $re-&gt;perl_version_introduced; #=&gt; 5.017009 # If it&#39;s PPIx-Regexp-0.032, the result is 5.005.
===


&#34;\343\203\240&#34; is represented by hexadecimal code &#34;\x{E3}\x{83}\x{A0}&#34;.
The last word &#34;\x{A0}&#34; is interpreted as Whitespace.


===
# use Data::Dumper
&#39;children&#39; =&gt; [
                bless&#40; {
                         &#39;content&#39; =&gt; &#39;
                       }, &#39;PPIx::Regexp::Token::Literal&#39; &#41;,
                bless&#40; {
                         &#39;content&#39; =&gt; &#39;�&#39;
                       }, &#39;PPIx::Regexp::Token::Literal&#39; &#41;,
                bless&#40; {
                         &#39;perl_version_introduced&#39; =&gt; &#39;5.017009&#39;,
                         &#39;content&#39; =&gt; &#39;�&#39;
                       }, &#39;PPIx::Regexp::Token::Whitespace&#39; &#41;
                                                        ],
===
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;03&nbsp;13:18:20&nbsp;2014</span>
    <span class="description">wyant [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jan 02 12:45:33 2014, MONMON wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Japanese Katakana &#34;ム&#34; is represented by octal code &#34;\343\203\240&#34;.
&gt;  Using it and /x, perl_version_introduced value is not right.
&gt; 
&gt; 
&gt; ===
&gt; my $re = PPIx::Regexp-&gt;new&#40;&#34;qr/\343\203\240/x&#34;&#41;;
&gt; print $re-&gt;perl_version_introduced; #=&gt; 5.017009 # If it&#39;s PPIx-
&gt; Regexp-0.032, the result is 5.005.
&gt; ===
&gt; 
&gt; 
&gt; &#34;\343\203\240&#34; is represented by hexadecimal code
&gt; &#34;\x{E3}\x{83}\x{A0}&#34;.
&gt; The last word &#34;\x{A0}&#34; is interpreted as Whitespace.
&gt; 
&gt; 
&gt; ===
&gt; # use Data::Dumper
&gt; &#39;children&#39; =&gt; [
&gt;                 bless&#40; {
&gt;                          &#39;content&#39; =&gt; &#39;
&gt;                        }, &#39;PPIx::Regexp::Token::Literal&#39; &#41;,
&gt;                 bless&#40; {
&gt;                          &#39;content&#39; =&gt; &#39;�&#39;
&gt;                        }, &#39;PPIx::Regexp::Token::Literal&#39; &#41;,
&gt;                 bless&#40; {
&gt;                          &#39;perl_version_introduced&#39; =&gt; &#39;5.017009&#39;,
&gt;                          &#39;content&#39; =&gt; &#39;�&#39;
&gt;                        }, &#39;PPIx::Regexp::Token::Whitespace&#39; &#41;
&gt;                                                         ],
&gt; ===
</div>

Thank you for your report. It seems to contain all sorts of interesting things.

The first is the perl_version_introduced thing. I believe the correct response is 5.005, because that is when &#39;qr{}&#39; was introduced. And that is the result produced by demonstration program eg/predump, which I rely on heavily for troubleshooting. But when I cut-and-paste your code into a stand-alone Perl script, I get 5.017009, just as you do, and it is far from obvious to me why.

The information that it worked correctly in 0.032 is valuable, because it means I can investigate based on the changes between the two versions.

The second thing is that it looks to me to be desirable for PPIx::Regexp to parse the content of the regexp as a single Unicode character, rather than as three escape sequences. I am not sure how to make that happen, since one of the requirements for the module is that it NOT eval&#40;&#41; strings. For the moment it will have to just go on the wish list.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;03&nbsp;13:18:21&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;04&nbsp;18:22:54&nbsp;2014</span>
    <span class="description">wyant [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">It took me a while to understand what was going on, but eventually I got it, I think.

The basic problem was that I should not have implemented the change described as &#34;Allow non-ASCII white space under /x.&#34; But I misunderstood what perl5179delta said was happening with non-ASCII white space.

Also, I was using \s to detect white space for the purpose of blessing tokens into PPIx::Regexp::Token::Whitespace rather than PPIx::Regexp::Token::Literal. But \s matches too much. In fact, in the code installed in version 0.033, it was the \s that was matching &#34;\240&#34;. So the \s has been replaced by an explicit character class. The contents of this class were verified both by the docs and by actually reading regcomp.c.

These changes are in version 0.036, which just went to PAUSE, and should be appearing on CPAN mirrors in a few hours. I will leave the RT ticket open for a week or so, and then close it if there are no further problems.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;04&nbsp;18:22:54&nbsp;2014</span>
    <span class="description">wyant [...] cpan.org -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;04&nbsp;20:22:52&nbsp;2014</span>
    <span class="description">monmon [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> lesamoureuses [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you so much for looking into this issue! It has been resolved!

On 2014-1月-04 土 18:22:54, WYANT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It took me a while to understand what was going on, but eventually I
&gt; got it, I think.
&gt; 
&gt; The basic problem was that I should not have implemented the change
&gt; described as &#34;Allow non-ASCII white space under /x.&#34; But I
&gt; misunderstood what perl5179delta said was happening with non-ASCII
&gt; white space.
&gt; 
&gt; Also, I was using \s to detect white space for the purpose of blessing
&gt; tokens into PPIx::Regexp::Token::Whitespace rather than
&gt; PPIx::Regexp::Token::Literal. But \s matches too much. In fact, in the
&gt; code installed in version 0.033, it was the \s that was matching
&gt; &#34;\240&#34;. So the \s has been replaced by an explicit character class.
&gt; The contents of this class were verified both by the docs and by
&gt; actually reading regcomp.c.
&gt; 
&gt; These changes are in version 0.036, which just went to PAUSE, and
&gt; should be appearing on CPAN mirrors in a few hours. I will leave the
&gt; RT ticket open for a week or so, and then close it if there are no
&gt; further problems.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;11&nbsp;18:29:15&nbsp;2014</span>
    <span class="description">wyant [...] cpan.org -  Status changed from &#39;patched&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;11&nbsp;18:29:16&nbsp;2014</span>
    <span class="description">wyant [...] cpan.org -  Fixed in 0.036 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;11&nbsp;18:29:16&nbsp;2014</span>
    <span class="description">wyant [...] cpan.org -  Fixed in 0.032 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
