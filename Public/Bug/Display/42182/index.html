<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #42182 for Mail-Box: Mail::Box::Maildir::Message information lossage</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #42182 for Mail-Box: Mail::Box::Maildir::Message information lossage</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Mail-Box">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Mail-Box">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Mail-Box">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Mail-Box">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Mail-Box">Mail-Box CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">42182</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Mail-Box">Mail-Box</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
wjhns117 [...] hardakers.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-19874-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.081    </td>
  </tr>
  <tr id="CF-19875-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




fix.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/550774/277380/fix.patch">
Tue Jan 06 12:20:09 2009 (1k) by wjhns117 [...] hardakers.net
</a>
</font></li>
</ul>


Mail-Box-2.087.tar.gz<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/554337/279436/Mail-Box-2.087.tar.gz">
Thu Jan 15 05:32:12 2009 (585.2k) by Mark [...] Overmeer.net
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=42182">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-550774" href="/Public/Bug/Display.html?id=42182#txn-550774">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;06&nbsp;12:20:09&nbsp;2009</span>
    <span class="description">wjhns117 [...] hardakers.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Mail::Box::Maildir::Message information lossage</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/550774/277377/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/277377">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The current maildir message module doesn&#39;t respect all the possible
flags in use by various applications.  Certain applications &#40;dovecot
being a prime example&#41; stores extra flags at the end in lower-case for
application specific purposes.  If you use Mail::Box utilities to open
maildir folders created by applications like dovecot then upon close it
renames the files and all the extra markings get lost &#40;which in my case,
is really really bad though fortunately they were mostly expiration
marks that I can at least recreate moderately easily&#41;.

The fix attached is actually to simply save and remember all lowercase
flags and then apply them later during save time.  &#40;I actually find it
odd that when I pass access =&gt; &#39;r&#39; to the top level Mail::Box manager it
renames the files in the first place, but that&#39;s a different issue&#41;.

Ideally, I actually think it would be safer to remember all unknown tags
not just the lower case ones.  But I wasn&#39;t sure how accepted that would
be &#40;and will cause performance loss because of the need to resort flags
later&#41;.  So the attached patch just deals with unknown lowercase flags.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> fix.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/550774/277380/fix.patch">Download fix.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- Message.pm	2008-12-11 03:05:40.000000000 -0800
+++ /users/hardaker/f/x/tmp/h/Mail-Box-2.081/lib/Mail/Box/Maildir/Message.pm	2009-01-06 09:02:35.000000000 -0800
@@ -24,10 +23,15 @@
     return $newname if defined $oldname &#38;&#38; $oldname eq $newname;
 
     my &#40;$id, $semantics, $flags&#41;
-     = $newname =~ m!&#40;.*?&#41;&#40;?:\:&#40;[12]&#41;\,&#40;[A-Z]*&#41;&#41;!
+     = $newname =~ m!&#40;.*?&#41;&#40;?:\:&#40;[12]&#41;\,&#40;[A-Za-z]*&#41;&#41;!
      ? &#40;$1, $2, $3&#41;
      : &#40;$newname, &#39;&#39;,&#39;&#39;&#41;;
 
+    # IMAP and other clients use lowercase flags to store application tags
+    &#40;$self-&gt;{&#39;lcflags&#39;}&#41; = &#40;$flags =~ m/&#40;[a-z]+&#41;/&#41;;
+    $self-&gt;{&#39;lcflags&#39;} ||= &#39;&#39;;  # avoid undef warnings later
+    $flags =~ s/[a-z]+//;
+
     my %flags;
     $flags{$_}++ foreach split //, $flags;
 
@@ -89,7 +93,8 @@
       . &#40;$labels-&gt;{passed}  ? &#39;P&#39; : &#39;&#39;&#41;
       . &#40;$labels-&gt;{replied} ? &#39;R&#39; : &#39;&#39;&#41;
       . &#40;$labels-&gt;{seen}    ? &#39;S&#39; : &#39;&#39;&#41;
-      . &#40;$labels-&gt;{deleted} ? &#39;T&#39; : &#39;&#39;&#41;;
+      . &#40;$labels-&gt;{deleted} ? &#39;T&#39; : &#39;&#39;&#41;
+      . $self-&gt;{&#39;lcflags&#39;};
 
     my $newset = $labels-&gt;{accepted} ? &#39;cur&#39; : &#39;new&#39;;
     if&#40;$set ne $newset&#41;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-551075" href="/Public/Bug/Display.html?id=42182#txn-551075">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;07&nbsp;03:24:20&nbsp;2009</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42182] Mail::Box::Maildir::Message information lossage</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 7 Jan 2009 09:23:27 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Wes Hardaker via RT &lt;bug-Mail-Box [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/551075/277581/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/277581">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Wes Hardaker via RT &#40;bug-Mail-Box@rt.cpan.org&#41; [090106 17:20]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Tue Jan 06 12:20:09 2009: Request 42182 was acted upon.
&gt; Transaction: Ticket created by HARDAKER
&gt;        Queue: Mail-Box
&gt;      Subject: Mail::Box::Maildir::Message information lossage
&gt; 
&gt; The current maildir message module doesn&#39;t respect all the possible
&gt; flags in use by various applications.
</div>
MailBox attempts to provide an abstract interface, hiding differences
in message storage between folder types as good as possible.  This means
that it interprets flags into conditions which can be tested with nicely
named methods or readable parameters:
   if&#40;$msg-&gt;deleted&#41;         # T flag
   if&#40;$msg-&gt;label&#40;&#39;seen&#39;&#41;    # all other flags

When you move a message from a Maildir folder into an Mbox folder, these
flags get automatically written in the other convension.

No-one ever told me that there are other flags for Maildir, so that is
the only reason the list is limited.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Ideally, I actually think it would be safer to remember all unknown tags
&gt; not just the lower case ones.  But I wasn&#39;t sure how accepted that would
&gt; be &#40;and will cause performance loss because of the need to resort flags
&gt; later&#41;.  So the attached patch just deals with unknown lowercase flags.
</div>
Just because I do not handle all flags I do not understand, I do get
extra information from you which helps me improve the module, so other
people.  Probably I should have produced a warning message when unknown
flags appear.  That would have saved you some work.

Could you compose a list of missing flags and a clear word for their
meaning is each case?  I&#39;ll add that for the next release.
Mbox additionally defines &#39;old&#39; &#40;folder has been opened, but the message
was not read&#41; and &#39;flagged&#39; &#40;something like &#39;selected&#39; to be involved in
some upcoming action&#41;.  MH adds &#39;current&#39;.

Maybe some of the flags need a hook with an existing method.  For
instance, $msg-&gt;reply&#40;&#41; will automatically set the &#39;replied&#39; flag on
the message.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-551076" href="/Public/Bug/Display.html?id=42182#txn-551076">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;07&nbsp;03:24:20&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-553389" href="/Public/Bug/Display.html?id=42182#txn-553389">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;13&nbsp;13:38:46&nbsp;2009</span>
    <span class="description">wjhns117 [...] hardakers.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/553389/278908/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/278908">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Grr...  send this via mail a week ago, but it took a week to bounce... 
Submitting this through the web-tracker instead.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&gt; The current maildir message module doesn&#39;t respect all the possible
&gt;&gt; flags in use by various applications.
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">MOv&gt; MailBox attempts to provide an abstract interface, hiding differences
MOv&gt; in message storage between folder types as good as possible.
</div>
I think that&#39;s the right approach wherever possible.  By the way, I
think it&#39;s a fantastic module so don&#39;t get me wrong about it because I&#39;m
reporting one issue...  I love the module!

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">MOv&gt; When you move a message from a Maildir folder into an Mbox folder,
</div>these
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">MOv&gt; flags get automatically written in the other convension.
</div>
Right, and I do think that&#39;s the right thing to do.  However, I do think
that holding on to unknown flags is probably a good idea too.  The user
would have to realize that transferring from one box type to another may
be lossy when unknown flags are being used &#40;and a simple statement to
that effect in the CAVEATS section would suffice&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">MOv&gt; No-one ever told me that there are other flags for Maildir, so that is
MOv&gt; the only reason the list is limited.
</div>
Well, maildir is interesting since it&#39;s not a &#34;standard&#34; in most ways.
I don&#39;t know its history, but it *feels* like a storage format that
started in one application and sort of grew into many more.  There are a
standard set of flags which are documented on various web pages &#40;for
example&#41; and coming up with that list isn&#39;t hard.  You&#39;re already
handling them all :-&#41;

What&#39;s interesting is that because there isn&#39;t a specification, it
doesn&#39;t really prevent applications from adding their own since there
isn&#39;t a statement anywhere saying &#34;don&#39;t do that&#34;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">MOv&gt; Probably I should have produced a warning message when unknown
MOv&gt; flags appear.  That would have saved you some work.
</div>
That would have been nice, but I need to save them completely.

I have a script that is simply scanning a bunch of mail boxes and
showing me the new messages in them.  I have about 70 incoming mail
nnmaildir in-boxes that are served by an imap server.  I don&#39;t want to
open them all to see that most of the messages aren&#39;t important, so I
have a script that uses your module and just summarizes them for me.
The script looks straight into the maildir folders themselves to avoid
the imap interface.

The problem was that when the script ran, it renamed all the files
dropping the extra flags that the imap server assigned to the message
files.  The imap server in question is &#34;dovecot&#34; which stores special
imap tags as lowercase maildir flags.  So a maildir message file may
have an &#34;a&#34; flag on it, and then there is another mapping file that
dovecot has in the top level maildir directory for the folder &#40;IE, the
one containing the &#34;cur&#34; and &#34;new&#34; ... folders&#41; called
&#34;dovecot-keywords&#34;.  In there we have something like:

  0 gnus-expire
  1 gnus-forward
  2 gnus-save

The 0 in this case is what is mapped to the maildir &#39;a&#39; flag.  Now, I
don&#39;t know *why* dovecot took this approach to do things but it did.
Probably for speed purposes as an imap client searching for the
&#39;gnus-expire&#39; tag can simply do a quick search for any files containing
the &#39;a&#39; flag.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">MOv&gt; Could you compose a list of missing flags and a clear word for their
MOv&gt; meaning is each case?  I&#39;ll add that for the next release.
</div>
The above shows that the lowercase flags are being used without a
specific meaning...  IE, they&#39;re application specific &#40;in my case
dovecot&#41;.  I have no idea if other applications are doing similar odd
things.

My suggestion is just that the perl module tries to keep them if it can
&#40;IE, it&#39;s not doing something through a lossy process like converting
from one box type to another&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-554337" href="/Public/Bug/Display.html?id=42182#txn-554337">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;15&nbsp;05:32:12&nbsp;2009</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42182] Mail::Box::Maildir::Message information lossage</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 15 Jan 2009 11:31:40 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Wes Hardaker via RT &lt;bug-Mail-Box [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/554337/279435/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/279435">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Wes Hardaker via RT &#40;bug-Mail-Box@rt.cpan.org&#41; [090113 18:38]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Mail-Box
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=42182">https://rt.cpan.org/Ticket/Display.html?id=42182</a></span> &gt;
&gt; 
<div class="message-stanza open">&gt;&gt;&gt; The current maildir message module doesn&#39;t respect all the possible
&gt;&gt;&gt; flags in use by various applications.
</div>&gt; 
<div class="message-stanza open">&gt; MOv&gt; MailBox attempts to provide an abstract interface, hiding differences
&gt; MOv&gt; in message storage between folder types as good as possible.
</div>&gt; 
&gt; I think that&#39;s the right approach wherever possible.  By the way, I
&gt; think it&#39;s a fantastic module so don&#39;t get me wrong about it because I&#39;m
&gt; reporting one issue...  I love the module!
</div>
I handle bug-reports &#40;for all my modules&#41; on daily basis... and am
always glad when I receive them: the best way to improve the quality
of the code.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; MOv&gt; When you move a message from a Maildir folder into an Mbox folder,
</div>&gt; these flags get automatically written in the other convension.
&gt; 
&gt; Right, and I do think that&#39;s the right thing to do.  However, I do think
&gt; that holding on to unknown flags is probably a good idea too.  The user
&gt; would have to realize that transferring from one box type to another may
&gt; be lossy when unknown flags are being used &#40;and a simple statement to
&gt; that effect in the CAVEATS section would suffice&#41;.
</div>
I have added a &#34;BE WARNED&#34; text to Mail::Box::Manager::moveMessage&#40;&#41;
and Mail::Box::addMessage&#40;&#41; which is the usual method where message
type coercions are made.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; MOv&gt; Probably I should have produced a warning message when unknown
&gt; MOv&gt; flags appear.  That would have saved you some work.
</div>&gt; 
&gt; My suggestion is just that the perl module tries to keep them if it can
&gt; &#40;IE, it&#39;s not doing something through a lossy process like converting
&gt; from one box type to another&#41;
</div>
You convinced me.  Please test the attached pre-release.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/554337/279436/Mail-Box-2.087.tar.gz">Download Mail-Box-2.087.tar.gz</a><br />
<span class="downloadcontenttype">application/x-gunzip 585.2k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-562804" href="/Public/Bug/Display.html?id=42182#txn-562804">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;03&nbsp;06:43:53&nbsp;2009</span>
    <span class="description">MARKOV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/562804/284216/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/284216">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 14b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">fixed in 2.087
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-562806" href="/Public/Bug/Display.html?id=42182#txn-562806">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;03&nbsp;06:43:53&nbsp;2009</span>
    <span class="description">MARKOV [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-562903" href="/Public/Bug/Display.html?id=42182#txn-562903">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;03&nbsp;10:11:23&nbsp;2009</span>
    <span class="description">wjhns117 [...] hardakers.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/562903/284278/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/284278">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 754b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Feb 03 06:43:53 2009, MARKOV wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; fixed in 2.087
</div>
So...  I appologize for the delay.  I&#39;ve been both sick &#40;for a month!&#41;
and away on a work trip.  I&#39;m just getting caught up again from all of that.

I was all set to write you a happy &#34;it&#39;s fixed&#34; note, but it turns out
that something is still wrong and I lost all the flags in a folder again
after checking out the most recent version.  I&#39;m not sure why, as
glancing at the code it looks like it should work.

Oh wait...  there it is.  You see that the flags it&#39;s picking are still
matching only the upper-case ones?  If you check my original patch, it
modifies the regex to add a-z to the [] match.

Yep.  I just made that change to the 2.087 code and it no longer drops
my lower case flags.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-562904" href="/Public/Bug/Display.html?id=42182#txn-562904">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;03&nbsp;10:11:25&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-613379" href="/Public/Bug/Display.html?id=42182#txn-613379">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;02&nbsp;05:29:58&nbsp;2009</span>
    <span class="description">MARKOV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/613379/311305/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/311305">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 45b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I am stupid &#40;and overloaded&#41;.  Fixed in 2.090
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-613381" href="/Public/Bug/Display.html?id=42182#txn-613381">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;02&nbsp;05:29:59&nbsp;2009</span>
    <span class="description">MARKOV [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.645887</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
