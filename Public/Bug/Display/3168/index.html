<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #3168 for Net-Server: bug with port declaration in config file</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #3168 for Net-Server: bug with port declaration in config file</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-Server/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-Server/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-Server/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-Server/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-Server">Net-Server CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">3168</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-Server/Active/">Net-Server</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
simonhf [...] web.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-23138-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.85    </td>
  </tr>
  <tr id="CF-23139-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;06&nbsp;06:50:33&nbsp;2003</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> bug with port declaration in config file</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">When specifying &#39;port = 20204&#39; in the config file and requesting a &#39;Net::Server::PreForkSimple&#39; then a &#39;Address already in use&#39; error is generated.

After adding some debug statements to &#39;Server.pm&#39; then the following appears in the log file:

process_args&#40;&#41;: log_level = 4
process_args&#40;&#41;: pid_file = mywebserver.pid
process_args&#40;&#41;: port = 20204 &#40;array&#41;
Becoming sub class of &#34;Net::Server::PreForkSimple&#34;
process_args&#40;&#41;
calling process_conf&#40;&#41;
calling process_args&#40;&#41;
process_args&#40;&#41;
process_args&#40;&#41;: max_servers = 5
process_args&#40;&#41;: max_requests = 1000
process_args&#40;&#41;: log_level = 4
process_args&#40;&#41;: pid_file = mywebserver.pid
process_args&#40;&#41;: port = 20204 &#40;array&#41;
pre_bind&#40;&#41;
2003/08/06-05:34:17 RPC::XML::Server &#40;type Net::Server::MultiType&#41; starting! pid&#40;4891&#41;
pre_bind&#40;&#41;: port: 20204
pre_bind&#40;&#41;: port: 20204
Binding to TCP port 20204 on host *
Binding to TCP port 20204 on host *
2003/08/06-05:34:17 Can&#39;t connect to TCP port 20204 on * [Address already in use]
  at line 86 in file /usr/lib/perl5/site_perl/5.8.0/Net/Server/Proto/TCP.pm
2003/08/06-05:34:17 Server closing!

It appears that the configuration file is digested twice &#40;why?&#41; and this results in two protocol objects using the same port... and the error.

How to fix this cleanly?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;07&nbsp;14:25:37&nbsp;2003</span>
    <span class="description">rob [...] roobik.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 7 Aug 2003 12:25:32 -0600 &#40;MDT&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Rob Brown &lt;rob [...] roobik.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Guest via RT &lt;bug-Net-Server [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #3168] bug with port declaration in config file </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-Cc:</td>
    <td class="message-header-value"> </td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have not been able to duplicate this error.
Can I have more details?  Your module code?
What commandline args?  Your config file?
I can&#39;t fix the bug if I can&#39;t see the bug myself.

--
Rob

On Wed, 6 Aug 2003, Guest via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; This message about Net-Server was sent to you by guest &lt;&gt; via rt.cpan.org
&gt; 
&gt; Full context and any attached attachments can be found at:
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=3168">https://rt.cpan.org/Ticket/Display.html?id=3168</a></span> &gt;
&gt; 
&gt; When specifying &#39;port = 20204&#39; in the config file and requesting a &#39;Net::Server::PreForkSimple&#39; then a &#39;Address already in use&#39; error is generated.
&gt; 
&gt; After adding some debug statements to &#39;Server.pm&#39; then the following appears in the log file:
&gt; 
&gt; process_args&#40;&#41;: log_level = 4
&gt; process_args&#40;&#41;: pid_file = mywebserver.pid
&gt; process_args&#40;&#41;: port = 20204 &#40;array&#41;
&gt; Becoming sub class of &#34;Net::Server::PreForkSimple&#34;
&gt; process_args&#40;&#41;
&gt; calling process_conf&#40;&#41;
&gt; calling process_args&#40;&#41;
&gt; process_args&#40;&#41;
&gt; process_args&#40;&#41;: max_servers = 5
&gt; process_args&#40;&#41;: max_requests = 1000
&gt; process_args&#40;&#41;: log_level = 4
&gt; process_args&#40;&#41;: pid_file = mywebserver.pid
&gt; process_args&#40;&#41;: port = 20204 &#40;array&#41;
&gt; pre_bind&#40;&#41;
&gt; 2003/08/06-05:34:17 RPC::XML::Server &#40;type Net::Server::MultiType&#41; starting! pid&#40;4891&#41;
&gt; pre_bind&#40;&#41;: port: 20204
&gt; pre_bind&#40;&#41;: port: 20204
&gt; Binding to TCP port 20204 on host *
&gt; Binding to TCP port 20204 on host *
&gt; 2003/08/06-05:34:17 Can&#39;t connect to TCP port 20204 on * [Address already in use]
&gt;   at line 86 in file /usr/lib/perl5/site_perl/5.8.0/Net/Server/Proto/TCP.pm
&gt; 2003/08/06-05:34:17 Server closing!
&gt; 
&gt; It appears that the configuration file is digested twice &#40;why?&#41; and this results in two protocol objects using the same port... and the error.
&gt; 
&gt; How to fix this cleanly?
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;08&nbsp;04:20:05&nbsp;2003</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Rob, please find attached a zip file containing
a short pl script and associated conf file.
Together they illustrate the problem. The output
of the script looks like this:

[net_server_bug]$ perl net_server_bug.pl
creating server object
Becoming sub class of &#34;Net::Server::PreForkSimple&#34;
2003/08/08-10:07:02 RPC::XML::Server &#40;type Net::Server::MultiType&#41; 
starting! pid&#40;20147&#41;
Binding to TCP port 12345 on host *
Binding to TCP port 12345 on host *
2003/08/08-10:07:02 Can&#39;t connect to TCP port 12345 on * [Address 
already in use]
  at line 86 in 
file /usr/lib/perl5/site_perl/5.8.0/Net/Server/Proto/TCP.pm
2003/08/08-10:07:02 Server closing!

As you&#39;ll see then it&#39;s the RPC::XML module that
actually creates Net::Server in MultiType mode.
In turn the conf file specifies PreForkSimple mode.

What seems to happen is that Net::Server reads the
conf file twice; once as it is initialized in
MultiType mode and once again for PreForkSimple mode.
This causes the port to be read twice and stored
twice in an internal array of Net::Server. Thus it
tries to bind to the port twice, and the error.

I work around this problem by removing the port
declaration from the conf file and putting it in
the pl script next to the conf parameter.

Hope this helps,
Simon

[rob@roobik.com - Thu Aug  7 14:25:37 2003]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have not been able to duplicate this error.
&gt; Can I have more details?  Your module code?
&gt; What commandline args?  Your config file?
&gt; I can&#39;t fix the bug if I can&#39;t see the bug myself.
&gt; 
&gt; --
&gt; Rob
</div></div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;21&nbsp;16:04:00&nbsp;2005</span>
    <span class="description">paul [...] seamons.com -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;23&nbsp;03:47:29&nbsp;2005</span>
    <span class="description">paul [...] seamons.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
