<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #48683 for PDF-API2: Cross-reference streams aren&#39;t supported &#40;formerly known as the &#34;Malformed xref in PDF file&#34; error&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #48683 for PDF-API2: Cross-reference streams aren&#39;t supported &#40;formerly known as the &#34;Malformed xref in PDF file&#34; error&#41;</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/PDF-API2/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/PDF-API2/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/PDF-API2/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/PDF-API2/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/PDF-API2">PDF-API2 CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">48683</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/PDF-API2/Active/">PDF-API2</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
cherdt [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-24958-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.73    </td>
  </tr>
  <tr id="CF-24959-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
2.026    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




HowToArgueEffectively.pdf<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/647428/331359/HowToArgueEffectively.pdf">
Thu Aug 13 10:31:27 2009 (14.9k) by cherdt [...] gmail.com
</a>
</font></li>
</ul>


PDF-API2-2.023-Predictor.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1492328/794724/PDF-API2-2.023-Predictor.patch">
Thu Apr 30 16:42:36 2015 (12.5k) by don.huettl [...] grantstreet.com
</a>
</font></li>
</ul>


PDF-API2-2.023-XRef-test.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1492328/794723/PDF-API2-2.023-XRef-test.patch">
Thu Apr 30 16:42:36 2015 (1.1k) by don.huettl [...] grantstreet.com
</a>
</font></li>
</ul>


PDF-API2-2.023-XRefStm.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1492328/794722/PDF-API2-2.023-XRefStm.patch">
Thu Apr 30 16:42:36 2015 (12k) by don.huettl [...] grantstreet.com
</a>
</font></li>
</ul>


PDF-API2-Predictor-pt2.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1495494/796580/PDF-API2-Predictor-pt2.patch">
Tue May 12 12:36:51 2015 (1.6k) by don.huettl [...] grantstreet.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;13&nbsp;10:31:27&nbsp;2009</span>
    <span class="description">cherdt [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> PDF-API2 throws error &#34;Malformed xref in PDF file&#34; for newer PDFs
 &#40;PDF v1.5+&#41;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Although PDF-API2 works well for older PDF formats &#40;1.4&#41;, newer PDF 
formats &#40;1.5, 1.6&#41; cause it to throw error an error message:
&#34;Malformed xref in PDF file  at [path to File.pm] line 1198&#34;

I can reproduce the error with the following Perl script:
use PDF::API2;
$pdf = PDF::API2-&gt;open&#40;$ARGV[0]&#41;;

The PDFs I am using were produced by Adobe Acrobat Pro 9 &#40;the attached is 
an example&#41;.

I saw the possibly related bug report submitted by abhinavk, but his fix 
did not work for me.

Environment: Perl v5.10.0 &#40;ActiveState&#41; on WinXP Pro 2002 SP3.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> HowToArgueEffectively.pdf</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/647428/331359/HowToArgueEffectively.pdf">Download HowToArgueEffectively.pdf</a><br />
<span class="downloadcontenttype">application/pdf 14.9k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;14&nbsp;12:42:10&nbsp;2009</span>
    <span class="description">cherdt [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [rt.cpan.org #48683]</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 14 Aug 2009 11:41:47 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PDF-API2 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Chris Herdt &lt;cherdt [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have since successfully used PDF::API2 to modify version 1.6 PDFs,
so I&#39;m not certain why the particular PDF in question produced the
error. Perhaps that file in particular has an unfriendly xref value,
which is apparently modified or removed when saved as an earlier PDF
version.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;24&nbsp;13:31:33&nbsp;2011</span>
    <span class="description">steve [...] deefs.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Aug 14 12:42:10 2009, cherdt wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have since successfully used PDF::API2 to modify version 1.6 PDFs,
&gt; so I&#39;m not certain why the particular PDF in question produced the
&gt; error. Perhaps that file in particular has an unfriendly xref value,
&gt; which is apparently modified or removed when saved as an earlier PDF
&gt; version.
</div>
Since PDF 1.5, the spec changed to allow xref information to be in
streams instead of tables.  This isn&#39;t supported by PDF::API2 &#40;though
I&#39;ll be very happy if someone beats me to fixing that and sends a patch!&#41;.

Acrobat 9 started using cross-reference streams by default, so this
error is more common with newer files.  PDF::API2 will work fine if you
generate a PDF in Acrobat 9 without using cross-reference streams,
however.  The easiest way to do this is to make it compatible with
Acrobat 5.0 and later when you save.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;24&nbsp;13:31:34&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;31&nbsp;06:26:15&nbsp;2012</span>
    <span class="description">pwomack [...] papermule.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> pwomack [...] papermule.co.uk</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Acrobat 9 started using cross-reference streams by default, so this
&gt; error is more common with newer files.  PDF::API2 will work fine if you
&gt; generate a PDF in Acrobat 9 without using cross-reference streams,
&gt; however.  The easiest way to do this is to make it compatible with
&gt; Acrobat 5.0 and later when you save.
</div>
With the passage of time, these are becoming more common.

I looked into adding the cross-reference stream myself, but it
is too complex to be a &#34;patch&#34;; it&#39;a a significant piece of implementation.

So can I just &#34;+1&#34; the importance of this.

 BugBear
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;20&nbsp;23:45:21&nbsp;2013</span>
    <span class="description">steve [...] deefs.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Version 2.020, just released, contains two updates relevant to this issue:

1&#41; If PDF::API2 encounters a cross-reference stream, it will now give a 
more appropriate error message rather than saying that the cross-reference 
table is malformed.

2&#41; The Known Issues section of the POD contains pointers to the PDF 
specification, which describes how both the old cross-reference table 
works and how the new cross-reference streams work.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;20&nbsp;23:47:50&nbsp;2013</span>
    <span class="description">steve [...] deefs.net -  Subject changed from &#39;PDF-API2 throws error &#34;Malformed xref in PDF file&#34; for newer PDFs &#40;PDF v1.5+&#41;&#39; to &#39;Cross-reference streams aren&#39;t supported &#40;formerly known as the &#34;Malformed xref in PDF file&#34; error&#41;&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;30&nbsp;16:42:36&nbsp;2015</span>
    <span class="description">don.huettl [...] grantstreet.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> don.huettl [...] grantstreet.com</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have attached three patches to implement read-only support for cross-reference streams and compressed objects.  Saving the results will still write a v1.4 document.

Patches should be applied in the following order:

PDF-API2-2.023-XRefStm.patch
PDF-API2-2.023-Predictor.patch
PDF-API2-2.023-XRef-test.patch

The unit test that I added needs the example document attached to this ticket to be saved as t/resources/HowToArgueEffectively.pdf.

If this is applied, please credit my employer, Grant Street Group &lt;gsg@cpan.org&gt;, in addition to myself.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> PDF-API2-2.023-XRefStm.patch</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> PDF-API2-2.023-XRef-test.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">commit c198a9745c7a
Author: Don Huettl &lt;don.huettl@grantstreet.com&gt;
Date:   Thu Mar 19 15:28:53 2015 -0400

    tests to validate cross-reference stream logic
    
    Adds a reference PDF document containing XRef streams, and the
    associated unit tests.

diff --git a/PDF-API2/t/resources/HowToArgueEffectively.pdf b/PDF-API2/t/resources/HowToArgueEffectively.pdf
new file mode 100644
index 000000000000..8bfd9482b940
Binary files /dev/null and b/PDF-API2/t/resources/HowToArgueEffectively.pdf differ
diff --git a/PDF-API2/t/xref.t b/PDF-API2/t/xref.t
new file mode 100644
index 000000000000..0280251f76b3
--- /dev/null
+++ b/PDF-API2/t/xref.t
@@ -0,0 +1,27 @@
+use Test::More tests =&gt; 2;
+
+use warnings;
+use strict;
+
+use PDF::API2;
+
+my $pdf = eval {
+    PDF::API2-&gt;open&#40;&#39;t/resources/HowToArgueEffectively.pdf&#39;&#41;;
+};
+
+isa_ok&#40;$pdf, &#39;PDF::API2&#39;, q{doc containing an XRef stream}&#41;;
+
+my $file = $pdf-&gt;{pdf};
+my $pass = 1;
+
+while &#40;my&#40;$id, $xref&#41; = each %{$file-&gt;{&#39; xref&#39;}}&#41; {
+    my $obj = $file-&gt;read_objnum&#40;$id, $xref-&gt;[1]&#41;;
+
+    unless &#40;ref&#40;$obj&#41;&#41; {
+        $pass = 0;
+        last;
+    }
+}
+
+ok&#40;$pass, &#39;all XRef entries point to an object&#39;&#41;;
+
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> PDF-API2-2.023-Predictor.patch</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;12&nbsp;12:36:51&nbsp;2015</span>
    <span class="description">don.huettl [...] grantstreet.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> don.huettl [...] grantstreet.com</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have one more patch that does a little clean-up, attached.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> PDF-API2-Predictor-pt2.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git PDF-API2/lib/PDF/API2/Basic/PDF/Filter/Predictor.pm PDF-API2/lib/PDF/API2/Basic/PDF/Filter/Predictor.pm
index 7d2c388dcfc0..813951d0f6fc 100644
--- PDF-API2/lib/PDF/API2/Basic/PDF/Filter/Predictor.pm
+++ PDF-API2/lib/PDF/API2/Basic/PDF/Filter/Predictor.pm
@@ -22,8 +22,7 @@ sub new {
 sub outfilt {
     my &#40;$self&#41; = @_;

-    warn &#39;The &#34;outfilt&#34; method is not implemented&#39;;
-    return;
+    die &#39;The &#34;outfilt&#34; method is not implemented&#39;;
 }

 sub infilt {
@@ -44,7 +43,7 @@ sub infilt {
     } elsif &#40;$predictor &gt;= 10 &#38;&#38; $predictor &lt;= 15&#41; {
         $self-&gt;_depredict_png;
     } else {
-        warn &#34;Invalid predictor: $predictor&#34;;
+        die &#34;Invalid predictor: $predictor&#34;;
     }

     return $obj-&gt;{&#39; stream&#39;};
@@ -133,7 +132,7 @@ sub _depredict_png {
 sub _depredict_tiff {
     my &#40;$self&#41; = @_;

-    warn &#34;The TIFF predictor logic has not been implemented&#34;;
+    die &#34;The TIFF predictor logic has not been implemented&#34;;
 }

 1;
diff --git PDF-API2/lib/PDF/API2/Resource/XObject/Image/PNG.pm PDF-API2/lib/PDF/API2/Resource/XObject/Image/PNG.pm
index bdf3356a9f8d..3fd5832cb675 100644
--- PDF-API2/lib/PDF/API2/Resource/XObject/Image/PNG.pm
+++ PDF-API2/lib/PDF/API2/Resource/XObject/Image/PNG.pm
@@ -8,6 +8,7 @@ use POSIX qw&#40;ceil&#41;;

 use IO::File;
 use PDF::API2::Util;
+use PDF::API2::Basic::PDF::Filter::Predictor;
 use PDF::API2::Basic::PDF::Utils;

 no warnings qw[ deprecated recursion uninitialized ];
@@ -31,7 +32,10 @@ sub new {
     open&#40;$fh,$file&#41;;
     binmode&#40;$fh&#41;;
     seek&#40;$fh,8,0&#41;;
+    $self-&gt;{Length}=PDFNum&#40;-s $file&#41;;
     $self-&gt;{&#39; stream&#39;}=&#39;&#39;;
+    $self-&gt;{&#39; streamloc&#39;}=0;
+    $self-&gt;{&#39; streamsrc&#39;}=$fh;
     $self-&gt;{&#39; nofilt&#39;}=1;
     while&#40;!eof&#40;$fh&#41;&#41; {
         read&#40;$fh,$buf,4&#41;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;24&nbsp;04:08:40&nbsp;2015</span>
    <span class="description">MELMOTHX [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve tried out the patch as found in the xref-streams branch on <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/ssimms/pdfapi2">https://github.com/ssimms/pdfapi2</a></span> but I get this failure with a PDF compiled by XeLaTeX:

Objind 1 does not exist at index 46 at lib/PDF/API2/Basic/PDF/File.pm line 710.

Pull request for the xref-streams branch issued at <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/ssimms/pdfapi2/pull/3">https://github.com/ssimms/pdfapi2/pull/3</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;24&nbsp;05:35:08&nbsp;2015</span>
    <span class="description">MELMOTHX [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Dec 24 04:08:40 2015, MELMOTHX wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve tried out the patch as found in the xref-streams branch on
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/ssimms/pdfapi2">https://github.com/ssimms/pdfapi2</a></span> but I get this failure with a PDF
&gt; compiled by XeLaTeX:
&gt; 
&gt; Objind 1 does not exist at index 46 at lib/PDF/API2/Basic/PDF/File.pm
&gt; line 710.
&gt; 
&gt; Pull request for the xref-streams branch issued at
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/ssimms/pdfapi2/pull/3">https://github.com/ssimms/pdfapi2/pull/3</a></span>
</div>
As stated in the third commit, trying it out against PDF::Cropmarks leads to some memory-hungry &#40;possibly endless&#41; recursion. I&#39;m way out of my deeps here, though. Anyway, I hope this helps.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;19&nbsp;16:43:42&nbsp;2016</span>
    <span class="description">steve [...] deefs.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve merged the xref-streams branch after making a few fixes, including compatibility for older versions of Perl and a fix for the issue that MELMOTHX discovered with object streams.

Many thanks!  This will be included in the upcoming 2.026 release.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;19&nbsp;16:43:43&nbsp;2016</span>
    <span class="description">steve [...] deefs.net -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;24&nbsp;16:41:09&nbsp;2016</span>
    <span class="description">steve [...] deefs.net -  Status changed from &#39;patched&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;24&nbsp;16:41:10&nbsp;2016</span>
    <span class="description">steve [...] deefs.net -  Fixed in 2.026 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
