<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #56469 for Finance-Quote: Follow-Up on Bug #49414: General currency rate exchange rate problem in 1.17</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #56469 for Finance-Quote: Follow-Up on Bug #49414: General currency rate exchange rate problem in 1.17</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Finance-Quote/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Finance-Quote/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Finance-Quote/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Finance-Quote/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Finance-Quote">Finance-Quote CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">56469</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">15 min

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Finance-Quote/Active/">Finance-Quote</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">eco [...] ecocode.net
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
Marc.Ellenrieder [...] gmx.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-13576-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-13577-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;10&nbsp;15:35:35&nbsp;2010</span>
    <span class="description">Marc.Ellenrieder [...] gmx.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Follow-Up on Bug #49414: General currency rate exchange rate problem in 1.17</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 10 Apr 2010 21:35:11 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Finance-Quote [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Marc M. Ellenrieder&#34; &lt;Marc.Ellenrieder [...] gmx.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Hi,

Bug #49414 seems to be a fairly common problem with exchange rates.  See the 
below example:

1&#41;
        perl currency-lookup.pl EUR RUB
        EUR-&gt;RUB = 39.269

2&#41;
        perl currency-lookup.pl RUB EUR
        RUB-&gt;EUR = 2.5407

The example 2 is correct only for 100 RUB = 2.5407 EUR.

The bug is present in Finance-Quote 1.17. After going through the source code 
of the Finance-Quote file Quote.pm I discovered, that this is a bug of the 
Yahoo page itself, since example 2&#41; calls 

        <span class="clickylink"><a target="new" rel="nofollow" href="http://uk.finance.yahoo.com/q?s=RUBEUR=X">http://uk.finance.yahoo.com/q?s=RUBEUR=X</a></span>

and Yahoo itself yields the above &#40;incorrect&#41; value. Unless someone finds the 
correct URL to get Yahoo to quote the right value, we are somehow lost.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;29&nbsp;05:22:16&nbsp;2010</span>
    <span class="description">Ciprian.Enache [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ciprian.Enache [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Apr 10 15:35:35 2010, Marc.Ellenrieder@gmx.de wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Hi,
&gt; 
&gt; Bug #49414 seems to be a fairly common problem with exchange rates.
&gt; See the
&gt; below example:
&gt; 
&gt; 1&#41;
&gt;       perl currency-lookup.pl EUR RUB
&gt;       EUR-&gt;RUB = 39.269
&gt; 
&gt; 2&#41;
&gt;       perl currency-lookup.pl RUB EUR
&gt;       RUB-&gt;EUR = 2.5407
&gt; 
&gt; The example 2 is correct only for 100 RUB = 2.5407 EUR.
&gt; 
&gt; The bug is present in Finance-Quote 1.17. After going through the
&gt; source code
&gt; of the Finance-Quote file Quote.pm I discovered, that this is a bug of
&gt; the
&gt; Yahoo page itself, since example 2&#41; calls
&gt; 
&gt;       <span class="clickylink"><a target="new" rel="nofollow" href="http://uk.finance.yahoo.com/q?s=RUBEUR=X">http://uk.finance.yahoo.com/q?s=RUBEUR=X</a></span>
&gt; 
&gt; and Yahoo itself yields the above &#40;incorrect&#41; value. Unless someone
&gt; finds the
&gt; correct URL to get Yahoo to quote the right value, we are somehow
&gt; lost.
</div>

This is also impacting other currencies such as the Indonesian Rupiah
and the Thai Baht.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;29&nbsp;05:22:16&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;16&nbsp;12:07:41&nbsp;2012</span>
    <span class="description">sbrabec [...] suse.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> sbrabec [...] suse.cz</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I reported the same problem with CZK/USD currency pair to Yahoo. The
problem was acknowledged by Yahoo on Thu, 05 Nov 2009 as
KMM87712558V70692L0KM, but not fixed until today. There is no was to fix
it in the Finance:Quote module. &#40;Unless somebody wants to parse the
graph using OCR.&#41;

<span class="clickylink"><a target="new" rel="nofollow" href="http://uk.finance.yahoo.com/q?s=CZKUSD=X">http://uk.finance.yahoo.com/q?s=CZKUSD=X</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;05&nbsp;16:39:36&nbsp;2012</span>
    <span class="description">mta [...] umich.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mta [...] umich.edu</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve attached a patch that works around this problem.  It queries two
Yahoo sites for exchange rates and compares the results.  If they are
off by a factor of 100 &#40;more or less&#41; it assumes that this problem
exists for the current currency pair and fixes it.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Quote.pm.diff</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- lib/Finance/Quote.pm	2009-10-05 13:39:57.000000000 -0400
+++ lib/Finance/Quote.pm	2010-09-02 01:03:48.000000000 -0400
@@ -41,9 +41,11 @@
 
 use vars qw/@ISA @EXPORT @EXPORT_OK @EXPORT_TAGS
             $VERSION $TIMEOUT %MODULES %METHODS $AUTOLOAD
-            $YAHOO_CURRENCY_URL $USE_EXPERIMENTAL_UA/;
+            $YAHOO_CURRENCY_URL $YAHOO_CURRENCY_QUOTES_URL
+            $USE_EXPERIMENTAL_UA/;
 
 $YAHOO_CURRENCY_URL = &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://uk.finance.yahoo.com/q?s=">http://uk.finance.yahoo.com/q?s=</a></span>&#34;;
+$YAHOO_CURRENCY_QUOTES_URL = &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://uk.finance.yahoo.com/d/quotes.csv?e=.csv&#38;f=l&#38;s=">http://uk.finance.yahoo.com/d/quotes.csv?e=.csv&#38;f=l&#38;s=</a></span>&#34;;
 
 @ISA    = qw/Exporter/;
 @EXPORT = &#40;&#41;;
@@ -238,36 +240,88 @@
 
   return $amount if &#40;$from eq $to&#41;; # Trivial case.
 
-  my $ua = $this-&gt;user_agent;
+  sub primary_url {
+      my &#40;$this,$from,$to&#41; = @_;
 
-  my $data = $ua-&gt;request&#40;GET &#34;${YAHOO_CURRENCY_URL}$from$to%3DX&#34;&#41;-&gt;content;
-  # The web page returns utf8 content which gives a warning when parsing $data
-  # in HTML::Parser
-  my $tb = HTML::TreeBuilder-&gt;new_from_content&#40;decode_utf8&#40;$data&#41;&#41;;
-
-  # Find the &lt;div&gt; with the data
-  my $div = $tb-&gt;look_down&#40;&#39;id&#39;,&#39;yfi_quote_summary_data&#39;&#41;;
-  # Make sure there&#39;s a &lt;div&gt; to parse.
-  return undef unless $div;
-
-  # The first &lt;b&gt; should contain the quote
-  my $rate_element=$div-&gt;look_down&#40;&#39;_tag&#39;,&#39;b&#39;&#41;;
-  # Make sure there&#39;s a &lt;b&gt; to parse.
-  return undef unless $rate_element;
-
-  my $exchange_rate=$rate_element-&gt;as_text;
-
-        $exchange_rate =~ s/,// ; # solve a bug when conversion rate
-                                  # involves thousands. yahoo inserts
-                                  # a comma when thousands occur
-
-  {
-    local $^W = 0;  # Avoid undef warnings.
-
-    # We force this to a number to avoid situations where
-    # we may have extra cruft, or no amount.
-    return undef unless &#40;$exchange_rate+0&#41;;
+      my $ua = $this-&gt;user_agent;
+
+      my $data = $ua-&gt;request&#40;GET &#34;${YAHOO_CURRENCY_URL}$from$to%3DX&#34;&#41;-&gt;content;
+      # The web page returns utf8 content which gives a warning when parsing $data
+      # in HTML::Parser
+      my $tb = HTML::TreeBuilder-&gt;new_from_content&#40;decode_utf8&#40;$data&#41;&#41;;
+
+      # Find the &lt;div&gt; with the data
+      my $div = $tb-&gt;look_down&#40;&#39;id&#39;,&#39;yfi_quote_summary_data&#39;&#41;;
+      # Make sure there&#39;s a &lt;div&gt; to parse.
+      return undef unless $div;
+
+      # The first &lt;b&gt; should contain the quote
+      my $rate_element=$div-&gt;look_down&#40;&#39;_tag&#39;,&#39;b&#39;&#41;;
+      # Make sure there&#39;s a &lt;b&gt; to parse.
+      return undef unless $rate_element;
+
+      my $exchange_rate=$rate_element-&gt;as_text;
+
+      $exchange_rate =~ s/,// ; # solve a bug when conversion rate
+                                # involves thousands. yahoo inserts
+                                # a comma when thousands occur
+      {
+        local $^W = 0;  # Avoid undef warnings.
+        return undef unless &#40;$exchange_rate+0&#41;;
+      }
+      return $exchange_rate * 1.0;
   }
+
+
+  sub secondary_url {
+      my &#40;$this,$from,$to&#41; = @_;
+      # Check against alternative URL as the original URL gives a rate
+      # multiplied by 100 for some currencies, for instance for NOKGBP=X
+      # &#40;compare with GBPNOK=X&#41;
+      # 
+      # The alternative &#34;CSV download&#34; URL does not have this problem
+      # and don&#39;t require any screenscrapingm but the resolution is
+      # lower, typically just 2 digits, so we should only use it if we
+      # find a large difference from the original exchange rate.
+      #
+      # See <span class="clickylink"><a target="new" rel="nofollow" href="http://www.gummy-stuff.org/Yahoo-data.htm">http://www.gummy-stuff.org/Yahoo-data.htm</a></span> for details about the
+      # fields for the f= parameter.
+      my $ua = $this-&gt;user_agent;
+      my $quotes_rate = $ua-&gt;request&#40;GET &#34;${YAHOO_CURRENCY_QUOTES_URL}$from$to%3DX&#34;&#41;-&gt;content;
+      { 
+          # Avoid undef warnings.
+          local $^W = 0;  
+          return undef unless &#40;$quotes_rate+0&#41;;
+      }
+      return $quotes_rate * 1.0;
+    }
+
+     my $primary_rate = primary_url&#40;$this, $from, $to&#41;;
+     my $secondary_rate = secondary_url&#40;$this, $from, $to&#41;;
+     my $exchange_rate = $primary_rate;
+
+     if &#40; $primary_rate &#38;&#38; $secondary_rate &#41; {
+        my $ratio = $primary_rate / $secondary_rate;
+        if &#40; $ratio &lt; 0.5 || $ratio &gt; 2 &#41; {
+          # Large difference, ignore $primary_rate 
+          # &#40;This seems to happen for NOK-&gt;GBP, DKK-&gt;USD&#41;
+          if &#40; $ratio &lt; 106 &#38;&#38; $ratio &gt; 94 &#41; {
+            # off by factor of 100, this is the typical error
+            $exchange_rate = $exchange_rate / 100;
+          }
+          else {
+            $exchange_rate = $secondary_rate;
+          }
+          # TODO: Work out the difference in scale &#40;typically 100&#41;
+          # and multiply the original $exchange_rate
+        }
+     } elsif &#40; !$primary_rate &#38;&#38; $secondary_rate &#41; {
+        # $primary rate failed, fall back to secondary
+        $exchange_rate = $secondary_rate;
+     } elsif &#40; ! $exchange_rate &#41; {
+        return undef;
+     }
+
   return &#40;$exchange_rate * $amount&#41;;
 }
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;05&nbsp;16:54:43&nbsp;2012</span>
    <span class="description">mta [...] umich.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mta [...] umich.edu</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Feb 05 16:39:36 2012, malexander wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve attached a patch that works around this problem.  It queries two
&gt; Yahoo sites for exchange rates and compares the results.  If they are
&gt; off by a factor of 100 &#40;more or less&#41; it assumes that this problem
&gt; exists for the current currency pair and fixes it.
</div>
This patch, by the way, comes from a message sent to the Finance::Quote
mailing list on April 26, 2010 by Stian Soiland-Reyes.  The message is
archived at
&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://sourceforge.net/mailarchive/forum.php?thread_name=j2l68db3ea71004261347lac34e2c6q5f6dd0ef978ee782%40mail.gmail.com&#38;forum_name=finance-quote-devel">http://sourceforge.net/mailarchive/forum.php?thread_name=j2l68db3ea71004261347lac34e2c6q5f6dd0ef978ee782%40mail.gmail.com&#38;forum_name=finance-quote-devel</a></span>&gt;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;01&nbsp;08:19:09&nbsp;2012</span>
    <span class="description">eco [...] ecocode.net -  Correspondence added</span>
    <span class="time-taken">15 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi

Thanks for the work !
We&#39;ve changed the currency routine and it seems now that Yahoo returns correct results.

I&#39;ve added 2 tests in currency.t to check for anomalies of this kind.

Tests added to the YahooApi2012 branch and will be merged into master later today.

Don&#39;t hesitate to reopen this bug if you get any other anomalies...

best
-- 
Erik
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;01&nbsp;08:19:10&nbsp;2012</span>
    <span class="description">eco [...] ecocode.net -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Give odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;01&nbsp;08:19:11&nbsp;2012</span>
    <span class="description">eco [...] ecocode.net -  Given to ecocode</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
