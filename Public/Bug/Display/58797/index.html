<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #58797 for Test-Harness: Re: Perl 5.12.1 build report</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #58797 for Test-Harness: Re: Perl 5.12.1 build report</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Test-Harness">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Test-Harness">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Test-Harness">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Test-Harness">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Test-Harness">Test-Harness CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">58797</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">deleted</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Test-Harness">Test-Harness</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
wb8tyw [...] qsl.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31430-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31431-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=58797">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-796424" href="/Public/Bug/Display.html?id=58797#txn-796424">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;24&nbsp;18:54:36&nbsp;2010</span>
    <span class="description">wb8tyw [...] qsl.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> &#34;Craig A. Berry&#34; &lt;craigberry [...] mac.com&gt;, vmsperl [...] perl.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: Perl 5.12.1 build report</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 24 Jun 2010 17:54:17 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Mark Berryman &lt;mark [...] theberrymans.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;John E. Malmberg&#34; &lt;wb8tyw [...] qsl.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/796424/412885/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/412885">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 6.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 6/24/2010 2:03 PM, Mark Berryman wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; On Jun 24, 2010, at 12:08 PM, Craig A. Berry wrote:
&gt;
<div class="message-stanza open">&gt;&gt;
<div class="message-stanza open">&gt;&gt;&gt; 4. Too many extensions like to use labels that differ only in
&gt;&gt;&gt; case  or reference external libraries that are built with
&gt;&gt;&gt; /names=&#40;as_is,short&#41;. By editing 3 include files in Perl, extern.h,
&gt;&gt;&gt; perl.h, and xsub.h in PERL_ROOT:[.LIB.VMS_arch.5_12_1.CORE], to set the
&gt;&gt;&gt; NAMES pragma to uppercase at the beginning of the file and restore it at
&gt;&gt;&gt; the end, I am able to modify the generated DESCRIP.MMS file of the
&gt;&gt;&gt; extension being built to include the names=&#40;as_is,short&#41; switch and
&gt;&gt;&gt; build the extension without difficulty. I believe this would be worth
&gt;&gt;&gt; doing as part of the standard installation. It would also be nice if
&gt;&gt;&gt; there were an option to add this switch into the generated DESCRIP.MMS
&gt;&gt;&gt; automatically.
</div>&gt;&gt;
&gt;&gt; You can get /NAMES=AS_IS by configuring the Perl build with:
&gt;&gt;
&gt;&gt; $ @configure -&#34;Dbe_case_sensitive=Y&#34; -&#34;des&#34;
</div></div>
Unfortunately pragma names are not standardized.  While they may end up 
meaning the same thing on different compilers, nothing enforces that, so
pragmas must be wrapped with a test for the compilers that they are 
known to be valid on that may be used for the compilation.  It gets 
messy fast.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; I tried this once. The build fails to even build miniperl. Here I
&gt; can  reproduce this fairly quickly...
&gt;
&gt; Link /NoTrace/NoMap/Trace/Exe=MINIPERL.EXE miniperlmain.obj, libperlmini.olb/Library/Include=globals  ,[]crtl.opt/Options
&gt; %ILINK-W-NOSUCHMOD, module GLOBALS not found
&gt;          in library USERS:[BERRYMAN.PERL-5_12_1]LIBPERLMINI.OLB;1
&gt; %ILINK-W-NUDFSYMS, 8 undefined symbols:
&gt; %ILINK-I-UDFSYM,        lib$find_image_symbol
&gt; %ILINK-I-UDFSYM,        lib$initialize
&gt; %ILINK-I-UDFSYM,        lib$rename_file
&gt; %ILINK-I-UDFSYM,        sys$filescan
&gt; %ILINK-I-UDFSYM,        sys$get_security
&gt; %ILINK-I-UDFSYM,        sys$getdviw
&gt; %ILINK-I-UDFSYM,        sys$set_security
&gt; %ILINK-I-UDFSYM,        sys$sigprc
</div>
Those undefined symbols should be easy to fix, they just need to be 
declared in upper case in the source file.  I am trying to remember if I 
submitted a patch to do that before.

Unfortunately the system header files for defining those routines is 
generated by a program that has not been updated to properly generate 
function prototypes from the source file it uses.  That is why I never 
use that file, and instead manually prototype the system services.  The 
proper prototypes make several common programming errors to be detected 
by the compiler.

&lt;snip&gt;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; All this does is tell MMS that, when processing a .C file into a
&gt; .OBJ  file, check to see if the filename is uppercase. If not, rename it so it
&gt; is. The syntax at COMPLETE_APPLICATION tells MMS to compare the module
&gt; in the library to the source and rebuild it if it has changed but it
&gt; only works if the module names in the library are all uppercase
&gt; &#40;otherwise it aborts with an &#34;action did not update target&#34; error&#41;.
&gt; Would this help make Perl any more independent of the type of build disk
&gt; being used?
</div>
We need a solution for building on ODS-5 that results in the files and 
directories having the same case as on a Unix system.  This stopped me 
from testing with Perl set for exact case filenames.

However, I have not found out how to get MMS to accept a lower case 
module name into a library.  It seems to be expecting the module name to 
be uppercase.  So putting in a rename in MMS files created on ODS-5 
volumes may be needed.  I thought that MMK did not have this issue.

I am currently using DEC MMS to build GNV bash and I ran into that 
issue.  The mkbuiltins utility is only creating lowercase filenames, and 
I do not plan to look at changing it.  I ended up setting the following 
rule:

# MMS requires that the generated name be in upper case to generate an
# upper case module name for the librarian.
.def.c
    @ mkbuiltins :== $prj_root:[]mkbuiltins.exe
    $ set def prj_root:[.builtins]
    $ source = f$parse&#40;&#34;$&#40;MMS$SOURCE&#41;&#34;,,,&#34;NAME&#34;&#41;
    $ source_u = f$edit&#40;source, &#34;UPCASE&#34;&#41;
    $ mkbuiltins &#34;-D&#34; ./builtins/ &#39;source&#39;.DEF
    $ if f$getsyi&#40;&#34;ARCH_TYPE&#34;&#41; .ne. 1 then set proc/parse_style=extended
    $ if f$getsyi&#40;&#34;ARCH_TYPE&#34;&#41; .ne. 1 then rename &#39;source&#39;.C &#39;source_u&#39;.C
    $ set def prj_root:[-]

So what ever we do to make it build, we will need to do something to 
make sure that all files and directories for running the self tests end 
up in the correct case on ODS-5 volumes.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; xsubpp should do its own name shortening, but that can cause
&gt;&gt; trouble  with external libraries. I&#39;d consider making /NAMES=&#40;AS_IS,SHORTENED&#41;
&gt;&gt; the default for 5.14.0, but need to give some thought to what will break.
</div>&gt;
&gt; xsubpp seems to shorten names declared in the XS file but it doesn&#39;t
&gt; seem to touch names that are simply references to something external. In
&gt; the list of extensions I gave, there are several instances where some
&gt; names are shortened and others are not. This is probably a good thing
&gt; because I don&#39;t know of anything else that uses the same shortening
&gt; algorithm used in Perl. By using /names=&#40;as_is,short&#41; in the extension
&gt; build process, the names shortened by xsubpp are ignored but the names
&gt; referencing the external library get shortened the same way they were
&gt; when the library was built.
</div>
The code that currently uses LIB$FIND_IMAGE_SYMBOL needs to be updated 
to do the following:

1. If the symbol is over 31 characters:
    a. Try loading it in exact case but CRC shortened the way the
       C compiler does.
    b. Try loading it in upper case but CRC shortened the way the
       C compiler does.
    c. Try loading it in exact case but truncated to 31 characters.
    d. Try loading it in upper case but truncated to 31 characters.
2. For symbols 31 characters or less, try looking for it in exact case
    first and then in all upper case.

The CRTL dlsym&#40;&#41; needs the same fix.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The difficulty with compatibility is why I suggested continuing to
&gt; build Perl as all uppercase but modifying the Perl include files to add
&gt; a names pragma. That way, it doesn&#39;t matter how the program referencing
&gt; Perl is being built, it still gets all of the Perl references in the
&gt; correct case. It also means that the MMS files built by makefile.pl when
&gt; building extensions could include /names=&#40;as_is,short&#41; by default. The
&gt; only remaining issue I know of then becomes whether you include a
&gt; statement like /define=&#34;boot_XML__Parser__Expat=BOOT_XML__PARSER__EXPAT&#34;
&gt; in the build file or handle it in the dlsym code.
</div>
Perl on VMS currently does not use dlsym&#40;&#41;.

This is something that should be looked at, as latest C compiler 
standard no longer allows compilers to truncate the symbols at 31 
characters as previous standards have, and programmers are being more 
verbose in their names.

Once I get GNV building and running properly on both VAX and Alpha, I 
will probably start looking at applying the lessons I learn from that on 
Perl.  But right now I do not have time to devote to keeping up to date 
with blead perl.

-John
wb8tyw@qsl.network
Personal Opinion Only
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-802316" href="/Public/Bug/Display.html?id=58797#txn-802316">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;10&nbsp;13:19:09&nbsp;2010</span>
    <span class="description">andy [...] hexten.net -  Ticket deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.196508</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
