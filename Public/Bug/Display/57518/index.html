<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #57518 for Imager: [PATCH] libtiff detection fails if using non-standard lib dir</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #57518 for Imager: [PATCH] libtiff detection fails if using non-standard lib dir</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Imager/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Imager/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Imager/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Imager/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Imager">Imager CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">57518</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Imager/Active/">Imager</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jrcd83 [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-16790-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-16791-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;15&nbsp;17:23:12&nbsp;2010</span>
    <span class="description">jrcd83 [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [PATCH] libtiff detection fails if using non-standard lib dir</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 15 May 2010 14:22:58 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Imager [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Justin Davis &lt;jrcd83 [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have installed my libtiff, libjpeg etc library in a non-standard
location.  This way I won&#39;t break my websites when I do system
upgrades, etc.  All the libraries are detected except libtiff, which
uses Devel::CheckLib.  Very funky stuff, but I found out it fails
because the compiled test &#40;C&#41; program won&#39;t run.  It won&#39;t run because
it can&#39;t find the libraries!  So I created a patch to set
LD_LIBRARY_PATH if we are running linux.  I don&#39;t know how to fix this
with other OSes.

I added a WARNING because Devel::CheckLib does not run the compiled
test file anymore, it seems.  If it still did I would submitted a bug
report to them instead.

I also used the 3-arg form of open, since you already have the file
path in a variable... and it&#39;s nicer looking.

diff --git a/Makefile.PL b/Makefile.PL
index 0b71b80..d71440b 100644
--- a/Makefile.PL
+++ b/Makefile.PL
@@ -1026,6 +1026,11 @@ sub postcheck_tiff {
     $lib = &#34;tiff&#34;;
   }

+  # Fix our non-standard lib paths for runtime as well.
+  local $ENV{&#39;LD_LIBRARY_PATH&#39;} = join q{:},
+      &#40; @{ $format-&gt;{libdir} }, &#40; $ENV{&#39;LD_LIBRARY_PATH&#39;} || qw// &#41;&#41;
+          if $^O eq &#39;linux&#39;;
+
   my $good =
     eval {
       assert_lib
@@ -1047,12 +1052,13 @@ sub postcheck_tiff {
     return 0;
   }
 FUNCTION
-       &#41;;
+       &#41;; # WARNING: Devel::CheckLib might not execute this in newer versions!
+       #          v0.699_002 only checks if it compiles and links properly.
       1;
     };

   unless &#40;$good &#38;&#38; -s $tiffver_name
-         &#38;&#38; open&#40;VERS, &#34;&lt; probe/tiffver.txt&#34;&#41;&#41; {
+         &#38;&#38; open&#40;VERS, &#39;&lt;&#39;, $tiffver_name&#41;&#41; {
     unlink $tiffver_name unless $KEEP_FILES;
     print &lt;&lt;EOS;
     **tiff: cannot determine libtiff version number
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;24&nbsp;06:00:17&nbsp;2010</span>
    <span class="description">TONYC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry for the delayed response.

On Sat May 15 17:23:12 2010, jrcd83@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have installed my libtiff, libjpeg etc library in a non-standard
&gt; location.  This way I won&#39;t break my websites when I do system
&gt; upgrades, etc.  All the libraries are detected except libtiff, which
&gt; uses Devel::CheckLib.  Very funky stuff, but I found out it fails
&gt; because the compiled test &#40;C&#41; program won&#39;t run.  It won&#39;t run because
&gt; it can&#39;t find the libraries!  So I created a patch to set
&gt; LD_LIBRARY_PATH if we are running linux.  I don&#39;t know how to fix this
&gt; with other OSes.
</div>
With your change, doesn&#39;t make test fail, since LD_LIBRARY_PATH isn&#39;t set?

I&#39;m inclined not to make this change - the configure &#40;Makefile.PL&#41;
environment should match the test environment.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I added a WARNING because Devel::CheckLib does not run the compiled
&gt; test file anymore, it seems.  If it still did I would submitted a bug
&gt; report to them instead.
</div>
I&#39;m confused by this - the Devel::CheckLib bundled with Imager is very
similar to the latest development release - both versions should be
running the compiled test program.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I also used the 3-arg form of open, since you already have the file
&gt; path in a variable... and it&#39;s nicer looking.
</div>
It is, I&#39;ve been thinking about dropping support for 5.005, but haven&#39;t
decided yet.

Tony
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;24&nbsp;06:00:29&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;24&nbsp;14:18:13&nbsp;2010</span>
    <span class="description">JUSTER [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks Tony for responding I don&#39;t mind the delay!

After finishing this email I decided I should preface it and let you know that I am sorry I 
should have filed this report with Devel::CheckLib.  You are indeed correct and 
Devel::CheckLib still runs the program it compiles.  If you are still curious I think I have given 
good reasons to patch in lieu of CheckLib accepting a patch.  I will also give an updated 
patch at the end.

&#40;I ended up posting this with the web interface because the email came back &#34;unsendable&#34;&#41;

On May 24, 2010, at 3:00 AM, TONYC via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; With your change, doesn&#39;t make test fail, since LD_LIBRARY_PATH isn&#39;t set?
</div>
make test does work without LD_LIBRARY_PATH... interesting!


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m inclined not to make this change - the configure &#40;Makefile.PL&#41;
&gt; environment should match the test environment.
</div>
I think you hit the nail on the head!  What we are doing is matching the Makefile.PL to the 
Makefile environment.  Your two paragraphs above made it click in my head.

I didn&#39;t know this before, but the rpath is stored inside Imager.so.  So the search path for my 
libraries is encoded into the file itself.  I found the rpath with:

find blib -name &#39;*.so&#39; -exec sh -c &#39;echo &#34;{}&#34; $&#40;readelf -d {} | grep RPATH&#41;&#39; \;

Imager.so is the only .so file in the blib with an rpath for some reason.

I read about the rpath on this webpage: <span class="clickylink"><a target="new" rel="nofollow" href="http://www.eyrie.org/~eagle/notes/rpath.html">http://www.eyrie.org/~eagle/notes/rpath.html</a></span> .  
According to it the rpath is compiled into the library if the LD_RUN_PATH environment 
variable is set.  The Makefile sets the LD_RUN_PATH environment variable at line 627 for my 
Makefile.

So you are right we are indeed trying to match Makefile.PL&#39;s runtime environment with the 
Makefile&#39;s.  The Makefile uses LD_RUN_PATH &#40;which turns into an rpath&#41; and we have to use 
LD_LIBRARY_PATH to match the runtime environment in Makefile.PL.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m confused by this - the Devel::CheckLib bundled with Imager is very
&gt; similar to the latest development release - both versions should be
&gt; running the compiled test program.
</div>
Ah you are right, I must have missed it in this line of Devel::CheckLib:

push @wrongresult, $lib if $rv == 0 &#38;&#38; -x $exefile &#38;&#38; system&#40;File::Spec-&gt;rel2abs&#40;$exefile&#41;&#41; 
!= 0; 

Not very comely, that... I&#39;m sorry though I feel silly now.  I should file a bug on 
Devel::CheckLib&#39;s RT I think.

By the way, thanks very much for Imager.  I switched some code from ImageMagick.  Your API 
is so much nicer.  Its easier to compile and use!

-Justin

Here is another patch with less junk if you want one.  local $ENV is inside the eval {} block 
now and I removed the bits you showed were unnecessary. open still uses the 2-arg form.  I 
would like to write a test for this but I am unsure how.

diff --git a/Makefile.PL b/Makefile.PL
index 0b71b80..f209761 100644
--- a/Makefile.PL
+++ b/Makefile.PL
@@ -1028,6 +1028,12 @@ sub postcheck_tiff {

  my $good =
    eval {
+      # Fix our non-standard lib paths for runtime as well.
+      local $ENV{&#39;LD_LIBRARY_PATH&#39;} =
+        join q{:}, &#40; @{ $format-&gt;{libdir} },
+                     &#40; $ENV{&#39;LD_LIBRARY_PATH&#39;} || qw// &#41;&#41;
+        if $^O eq &#39;linux&#39;;
+
      assert_lib
       &#40;
        debug =&gt; $VERBOSE,
@@ -1052,7 +1058,7 @@ FUNCTION
    };

  unless &#40;$good &#38;&#38; -s $tiffver_name
-         &#38;&#38; open&#40;VERS, &#34;&lt; probe/tiffver.txt&#34;&#41;&#41; {
+         &#38;&#38; open&#40;VERS, &#34;&lt; $tiffver_name&#34;&#41;&#41; {
    unlink $tiffver_name unless $KEEP_FILES;
    print &lt;&lt;EOS;
    **tiff: cannot determine libtiff version number
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;03&nbsp;09:51:22&nbsp;2010</span>
    <span class="description">TONYC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon May 24 14:18:13 2010, JUSTER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I read about the rpath on this webpage:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.eyrie.org/~eagle/notes/rpath.html">http://www.eyrie.org/~eagle/notes/rpath.html</a></span> .
&gt; According to it the rpath is compiled into the library if the
&gt; LD_RUN_PATH environment
&gt; variable is set.  The Makefile sets the LD_RUN_PATH environment
&gt; variable at line 627 for my
&gt; Makefile.
&gt; 
&gt; So you are right we are indeed trying to match Makefile.PL&#39;s runtime
&gt; environment with the
&gt; Makefile&#39;s.  The Makefile uses LD_RUN_PATH &#40;which turns into an rpath&#41;
&gt; and we have to use
&gt; LD_LIBRARY_PATH to match the runtime environment in Makefile.PL.
</div>
Sorry for the delay on this.

I&#39;ve modified Imager&#39;s Makefile.PL to populate LD_RUN_PATH when calling
assert_lib&#40;&#41; to match the Makefile environment.

If you have a chance, could you please try Imager from svn to see if it
solves the problem for you?

If you have svn:

  svn co <span class="clickylink"><a target="new" rel="nofollow" href="http://imager.perl.org/svn/trunk/Imager">http://imager.perl.org/svn/trunk/Imager</a></span>
  perl Makefile.PL # add options here, eg. --incpath, --libpath

&#40;please check or report the output here&#41;

  make test

If you don&#39;t have easy access to svn on the machine where the problem
occurred, please let me know and I&#39;ll make a dev release.

Thanks for reporting this problem.

Tony
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;11&nbsp;21:55:02&nbsp;2010</span>
    <span class="description">TONYC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat May 15 17:23:12 2010, jrcd83@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have installed my libtiff, libjpeg etc library in a non-standard
&gt; location.  This way I won&#39;t break my websites when I do system
&gt; upgrades, etc.  All the libraries are detected except libtiff, which
&gt; uses Devel::CheckLib.  Very funky stuff, but I found out it fails
&gt; because the compiled test &#40;C&#41; program won&#39;t run.  It won&#39;t run because
&gt; it can&#39;t find the libraries!  So I created a patch to set
&gt; LD_LIBRARY_PATH if we are running linux.  I don&#39;t know how to fix this
&gt; with other OSes.
</div>
This has been fixed in Imager 0.77, which now sets LD_RUN_PATH in the
same way the Makefile does.

Thank you for the report.

Tony
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;11&nbsp;21:55:03&nbsp;2010</span>
    <span class="description">TONYC [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;17&nbsp;21:26:21&nbsp;2010</span>
    <span class="description">jrcd83 [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #57518] [PATCH] libtiff detection fails if using non-standard lib dir</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 17 Aug 2010 18:26:10 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Imager [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Justin Davis &lt;jrcd83 [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks very much Tony! I tried the SVN checkout &#40;rev 1805&#41; and libtiff works perfect! I hate to say this but now libpng is no longer working...

Here is the relevant output when I run:
perl Makefile.PL --incpath $SSPATH/include --libpath $SSPATH/lib
&#40;$SSPATH is my website&#39;s prefix&#41;

PNG: Not found via pkg-config
PNG: includes found - libraries found
/home/juster/build/Imager/PNG/assertlibs9pNNdD7: error while loading shared libraries: libpng14.so.14: cannot open shared object file: No such file or directory
PNG: Test code failed: wrong result: &#39;png&#39;

I tried again, setting the PKG_CONFIG_PATH variable for pkg-config&#39;s benefit &#40;this is after I noticed the pkg-config message above&#41;:
PKG_CONFIG_PATH=$SSPATH/lib/pkgconfig perl Makefile.PL --incpath $SSPATH/include --libpath $SSPATH/lib
&#40;Woo that&#39;s a big-un!&#41;

I got slightly different output when using the above command:
PNG: Found via pkg-config libpng14
/home/juster/build/Imager/PNG/assertlibclcOhYhW: error while loading shared libraries: libpng14.so.14: cannot open shared object file: No such file or directory
PNG: Test code failed: wrong result: &#39;png14&#39;

I will dig into this more and get back to you, hopefully with a patch. I have only scanned the code. I did notice libpng&#39;s detection specification is commented out and is now different from the other libraries. Also the pkg-config message tells me you are using pkg-config now. I have no experience with pkg-config but it looks interesting.

Right now the old &#40;patched&#41; version of Imager for my website is working great. This could take me several weeks to get around to it. Unfortunately I have only a few days home that I must use to work on a different website. I&#39;m sorry for the delays in general and hope to get back to you soon.

Thanks,
Justin Davis
JUSTER@CPAN
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;17&nbsp;21:26:22&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;17&nbsp;21:34:37&nbsp;2010</span>
    <span class="description">jrcd83 [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #57518] [PATCH] libtiff detection fails if using non-standard lib dir</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 17 Aug 2010 18:34:27 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Imager [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Justin Davis &lt;jrcd83 [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m sorry I re-opened your ticket, I didn&#39;t know that happened automatically. Should I create a new one for this new libpng problem?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;18&nbsp;01:39:48&nbsp;2010</span>
    <span class="description">tony [...] develop-help.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #57518] [PATCH] libtiff detection fails if using non-standard lib dir</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 18 Aug 2010 15:39:37 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Justin Davis via RT &lt;bug-Imager [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tony Cook &lt;tony [...] develop-help.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, Aug 17, 2010 at 09:34:38PM -0400, Justin Davis via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Imager
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=57518">https://rt.cpan.org/Ticket/Display.html?id=57518</a></span> &gt;
&gt; 
&gt; I&#39;m sorry I re-opened your ticket, I didn&#39;t know that happened automatically. Should I create a new one for this new libpng problem?
</div>
A new ticket please.

Tony
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;19&nbsp;03:44:28&nbsp;2010</span>
    <span class="description">TONYC [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
