<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #45241 for version: Version.pm gives different results for comparisons under 5.8.9&#40;broken&#41; and 5.10.0</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #45241 for version: Version.pm gives different results for comparisons under 5.8.9&#40;broken&#41; and 5.10.0</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/version/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/version/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/version/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/version/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/version">version CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">45241</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/version/Active/">version</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
kane [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-34940-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.76    </td>
  </tr>
  <tr id="CF-34941-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;23&nbsp;07:57:15&nbsp;2009</span>
    <span class="description">kane [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Version.pm gives different results for comparisons under
 5.8.9&#40;broken&#41; and 5.10.0</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi John,

I found a rather alarming bug in version.pm. It seems comparisons
against big numbers &#40;picked an arbitrary one, did not check for the
lower bound&#41; produce broken results on 64bit on 5.8.9 &#40;and presumably
all of 5.8.x&#41;:

### first with perl5.8.9
$ ~/perl/5.8.9/bin/perl -Mversion -le&#39;print version-&gt;VERSION&#39;
0.76
$ ~/perl/5.8.9/bin/perl -Mversion -le&#39;print version-&gt;new&#40;qq[3.26]&#41; &lt;=
version-&gt;new&#40; ~0/1000 &#41;&#39;

### now with perl5.10.0
$ ~/perl/5.10.0/bin/perl -Mversion -le&#39;print version-&gt;VERSION&#39;
0.76
$ ~/perl/5.10.0/bin/perl -Mversion -le&#39;print version-&gt;new&#40;qq[3.26]&#41; &lt;=
version-&gt;new&#40; ~0/1000 &#41;&#39;
1

Here&#39;s the full perl -V for both perls used:


$ ~/perl/5.8.9/bin/perl -VSummary of my perl5 &#40;revision 5 version 8
subversion 9&#41; configuration:
  Platform:
    osname=solaris, osvers=2.11, archname=i86pc-solaris-64int
    uname=&#39;sunos open-solaris-noc 5.11 snv_95 i86pc i386 i86pc &#39;
    config_args=&#39;-Dcc=gcc -Dprefix=~/perl/5.8.9 -Duse64bitint -d&#39;
    hint=recommended, useposix=true, d_sigaction=define
    usethreads=undef use5005threads=undef useithreads=undef
usemultiplicity=undef
    useperlio=define d_sfio=undef uselargefiles=define usesocks=undef
    use64bitint=define use64bitall=undef uselongdouble=undef
    usemymalloc=n, bincompat5005=undef
  Compiler:
    cc=&#39;gcc&#39;, ccflags =&#39;-DPTR_IS_LONG -fno-strict-aliasing -pipe
-D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -DPERL_USE_SAFE_PUTENV&#39;,
    optimize=&#39;-O&#39;,
    cppflags=&#39;-DPTR_IS_LONG -fno-strict-aliasing -pipe&#39;
    ccversion=&#39;&#39;, gccversion=&#39;3.4.3 &#40;csl-sol210-3_4-20050802&#41;&#39;,
gccosandvers=&#39;solaris2.11&#39;
    intsize=4, longsize=4, ptrsize=4, doublesize=8, byteorder=12345678
    d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=12
    ivtype=&#39;long long&#39;, ivsize=8, nvtype=&#39;double&#39;, nvsize=8,
Off_t=&#39;off_t&#39;, lseeksize=8
    alignbytes=4, prototype=define
  Linker and Libraries:
    ld=&#39;gcc&#39;, ldflags =&#39; &#39;
    libpth=/usr/lib /usr/ccs/lib
    libs=-lsocket -lnsl -ldl -lm -lc
    perllibs=-lsocket -lnsl -ldl -lm -lc
    libc=/lib/libc.so, so=so, useshrplib=false, libperl=libperl.a
    gnulibc_version=&#39;&#39;
  Dynamic Linking:
    dlsrc=dl_dlopen.xs, dlext=so, d_dlsymun=undef, ccdlflags=&#39; &#39;
    cccdlflags=&#39;-fPIC&#39;, lddlflags=&#39;-G&#39;


Characteristics of this binary &#40;from libperl&#41;: 
  Compile-time options: PERL_MALLOC_WRAP PERL_USE_SAFE_PUTENV USE_64_BIT_INT
                        USE_FAST_STDIO USE_LARGE_FILES USE_PERLIO
  Built under solaris
  Compiled at Apr 23 2009 11:22:11
  %ENV:
    PERL5LIB=&#34;/export/home/jos/sources/perl/CPANPLUS-0.85_08/inc/bundle&#34;
    PERL5OPT=&#34;&#34;
  @INC:
    /export/home/jos/sources/perl/CPANPLUS-0.85_08/inc/bundle
    /export/home/jos/perl/5.8.9/lib/5.8.9/i86pc-solaris-64int
    /export/home/jos/perl/5.8.9/lib/5.8.9
    /export/home/jos/perl/5.8.9/lib/site_perl/5.8.9/i86pc-solaris-64int
    /export/home/jos/perl/5.8.9/lib/site_perl/5.8.9
    .
    
    
$ ~/perl/5.10.0/bin/perl -V
Summary of my perl5 &#40;revision 5 version 10 subversion 0&#41; configuration:
  Platform:
    osname=solaris, osvers=2.11, archname=i86pc-solaris-64int
    uname=&#39;sunos open-solaris-noc 5.11 snv_95 i86pc i386 i86pc &#39;
    config_args=&#39;-Dcc=gcc -Dprefix=~/perl/5.8.10 -Duse64bitint -d&#39;
    hint=recommended, useposix=true, d_sigaction=define
    useithreads=undef, usemultiplicity=undef
    useperlio=define, d_sfio=undef, uselargefiles=define, usesocks=undef
    use64bitint=define, use64bitall=undef, uselongdouble=undef
    usemymalloc=n, bincompat5005=undef
  Compiler:
    cc=&#39;gcc&#39;, ccflags =&#39;-DPTR_IS_LONG -fno-strict-aliasing -pipe
-D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -DPERL_USE_SAFE_PUTENV&#39;,
    optimize=&#39;-O&#39;,
    cppflags=&#39;-DPTR_IS_LONG -fno-strict-aliasing -pipe&#39;
    ccversion=&#39;&#39;, gccversion=&#39;3.4.3 &#40;csl-sol210-3_4-20050802&#41;&#39;,
gccosandvers=&#39;solaris2.11&#39;
    intsize=4, longsize=4, ptrsize=4, doublesize=8, byteorder=12345678
    d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=12
    ivtype=&#39;long long&#39;, ivsize=8, nvtype=&#39;double&#39;, nvsize=8,
Off_t=&#39;off_t&#39;, lseeksize=8
    alignbytes=4, prototype=define
  Linker and Libraries:
    ld=&#39;gcc&#39;, ldflags =&#39; &#39;
    libpth=/usr/lib /usr/ccs/lib
    libs=-lsocket -lnsl -ldl -lm -lc
    perllibs=-lsocket -lnsl -ldl -lm -lc
    libc=/lib/libc.so, so=so, useshrplib=false, libperl=libperl.a
    gnulibc_version=&#39;&#39;
  Dynamic Linking:
    dlsrc=dl_dlopen.xs, dlext=so, d_dlsymun=undef, ccdlflags=&#39; &#39;
    cccdlflags=&#39;-fPIC&#39;, lddlflags=&#39;-G&#39;


Characteristics of this binary &#40;from libperl&#41;: 
  Compile-time options: PERL_DONT_CREATE_GVSV PERL_MALLOC_WRAP
                        PERL_USE_SAFE_PUTENV USE_64_BIT_INT USE_LARGE_FILES
                        USE_PERLIO
  Built under solaris
  Compiled at Apr 23 2009 11:48:22
  %ENV:
    PERL5LIB=&#34;/export/home/jos/sources/perl/CPANPLUS-0.85_08/inc/bundle&#34;
    PERL5OPT=&#34;&#34;
  @INC:
    /export/home/jos/sources/perl/CPANPLUS-0.85_08/inc/bundle
    /export/home/jos/perl/5.8.10/lib/5.10.0/i86pc-solaris-64int
    /export/home/jos/perl/5.8.10/lib/5.10.0
    /export/home/jos/perl/5.8.10/lib/site_perl/5.10.0/i86pc-solaris-64int
    /export/home/jos/perl/5.8.10/lib/site_perl/5.10.0
    .
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;26&nbsp;16:29:53&nbsp;2009</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Apr 23 07:57:15 2009, KANE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi John,
&gt; 
&gt; I found a rather alarming bug in version.pm. It seems comparisons
&gt; against big numbers &#40;picked an arbitrary one, did not check for the
&gt; lower bound&#41; produce broken results on 64bit on 5.8.9 &#40;and presumably
&gt; all of 5.8.x&#41;:
&gt; 
&gt; ### first with perl5.8.9
&gt; $ ~/perl/5.8.9/bin/perl -Mversion -le&#39;print version-&gt;VERSION&#39;
&gt; 0.76
&gt; $ ~/perl/5.8.9/bin/perl -Mversion -le&#39;print version-&gt;new&#40;qq[3.26]&#41; &lt;=
&gt; version-&gt;new&#40; ~0/1000 &#41;&#39;
&gt; 
&gt; ### now with perl5.10.0
&gt; $ ~/perl/5.10.0/bin/perl -Mversion -le&#39;print version-&gt;VERSION&#39;
&gt; 0.76
&gt; $ ~/perl/5.10.0/bin/perl -Mversion -le&#39;print version-&gt;new&#40;qq[3.26]&#41; &lt;=
&gt; version-&gt;new&#40; ~0/1000 &#41;&#39;
&gt; 1
&gt; 
</div>
I cannot confirm this on a FreeBSD amd64 machine:

$ /usr/perl5.8.9@RC2/bin/perl -Mversion\ 99999                         
                                   
version version 99999 required--this is only version 0.76 .
$ /usr/perl5.8.9@RC2/bin/perl -Mversion -le&#39;print version-&gt;new&#40;qq[3.26]&#41;
&lt;= version-&gt;new&#40; ~0/1000 &#41;&#39;
1

$ /usr/perl5.8.9@RC2/bin/perl -V
Summary of my perl5 &#40;revision 5 version 8 subversion 9&#41; configuration:
  Platform:
    osname=freebsd, osvers=7.0-release, archname=amd64-freebsd
    uname=&#39;freebsd biokovo-amd64.herceg.de 7.0-release freebsd
7.0-release #0: sun feb 24 10:35:36 utc 2008
root@driscoll.cse.buffalo.edu:usrobjusrsrcsysgeneric amd64 &#39;
    config_args=&#39;-ds -e -Dprefix=/usr/perl5.8.9@RC2&#39;
    hint=recommended, useposix=true, d_sigaction=define
    usethreads=undef use5005threads=undef useithreads=undef
usemultiplicity=undef
    useperlio=define d_sfio=undef uselargefiles=define usesocks=undef
    use64bitint=define use64bitall=define uselongdouble=undef
    usemymalloc=n, bincompat5005=undef
  Compiler:
    cc=&#39;cc&#39;, ccflags =&#39;-DHAS_FPSETMASK -DHAS_FLOATINGPOINT_H
-fno-strict-aliasing -pipe -I/usr/local/include&#39;,
    optimize=&#39;-O&#39;,
    cppflags=&#39;-DHAS_FPSETMASK -DHAS_FLOATINGPOINT_H -fno-strict-aliasing
-pipe -I/usr/local/include&#39;
    ccversion=&#39;&#39;, gccversion=&#39;4.2.1 20070719  [FreeBSD]&#39;, gccosandvers=&#39;&#39;
    intsize=4, longsize=8, ptrsize=8, doublesize=8, byteorder=12345678
    d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=16
    ivtype=&#39;long&#39;, ivsize=8, nvtype=&#39;double&#39;, nvsize=8, Off_t=&#39;off_t&#39;,
lseeksize=8
    alignbytes=8, prototype=define
  Linker and Libraries:
    ld=&#39;cc&#39;, ldflags =&#39;-Wl,-E  -L/usr/local/lib&#39;
    libpth=/usr/lib /usr/local/lib
    libs=-lgdbm -lm -lcrypt -lutil -lc
    perllibs=-lm -lcrypt -lutil -lc
    libc=, so=so, useshrplib=false, libperl=libperl.a
    gnulibc_version=&#39;&#39;
  Dynamic Linking:
    dlsrc=dl_dlopen.xs, dlext=so, d_dlsymun=undef, ccdlflags=&#39; &#39;
    cccdlflags=&#39;-DPIC -fPIC&#39;, lddlflags=&#39;-shared  -L/usr/local/lib&#39;


Characteristics of this binary &#40;from libperl&#41;: 
  Compile-time options: PERL_MALLOC_WRAP USE_64_BIT_ALL USE_64_BIT_INT
                        USE_FAST_STDIO USE_LARGE_FILES USE_PERLIO
  Locally applied patches:
        RC2
  Built under freebsd
  Compiled at Dec  6 2008 22:18:54
  %ENV:
    PERL_HTML_DISPLAY_CLASS=&#34;HTML::Display::Mozilla&#34;
  @INC:
    /usr/perl5.8.9@RC2/lib/5.8.9/amd64-freebsd
    /usr/perl5.8.9@RC2/lib/5.8.9
    /usr/perl5.8.9@RC2/lib/site_perl/5.8.9/amd64-freebsd
    /usr/perl5.8.9@RC2/lib/site_perl/5.8.9
    .
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;26&nbsp;16:29:54&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;26&nbsp;21:29:10&nbsp;2009</span>
    <span class="description">john.peacock [...] havurah-software.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #45241] Version.pm gives different results for comparisons under 5.8.9&#40;broken&#41; and 5.10.0</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 26 Apr 2009 21:27:49 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-version [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Peacock &lt;john.peacock [...] havurah-software.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Jos Boumans via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I found a rather alarming bug in version.pm. It seems comparisons
&gt; against big numbers &#40;picked an arbitrary one, did not check for the
&gt; lower bound&#41; produce broken results on 64bit on 5.8.9 &#40;and presumably
&gt; all of 5.8.x&#41;:
</div>
I can&#39;t recreate with 64-bit Perl 5.8.8 &#40;Centos&#41;.  Can you do this:

$ perl5.8.8 -MDevel::Peek -e &#39;Dump&#40;~0/1000&#41;&#39;
SV = NV&#40;0x36ec8a8&#41; at 0x36c53d0
  REFCNT = 1
  FLAGS = &#40;PADBUSY,PADTMP,NOK,READONLY,pNOK&#41;
  NV = 1.84467440737096e+16

$ perl5.10.0 -MDevel::Peek -e &#39;Dump&#40;~0/1000&#41;&#39;
SV = NV&#40;0xb74d8b8&#41; at 0xb725e30
  REFCNT = 1
  FLAGS = &#40;PADTMP,NOK,READONLY,pNOK&#41;
  NV = 1.84467440737096e+16

on your box and show me the output?

In any case, I can&#39;t consider this to be a bug in version.pm; you are passing a
very large floating point number to code which immediately converts it to a PV
and parses it as a string.  It isn&#39;t surprising that you can come up with slight
variations to the FP notation.

version.pm is not a generic module: it is designed for precisely the purpose of
parsing module VERSION&#39;s in a sensible and consistent fashion; if you actually
want to use ~0/1000 as your module $VERSION &#40;which will be radically different
on 32 and 64-bit machines&#41;, then I feel sorry for your users... ;-&#41;

John
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;27&nbsp;04:24:30&nbsp;2009</span>
    <span class="description">kane [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #45241] Version.pm gives different results for comparisons under 5.8.9&#40;broken&#41; and 5.10.0</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 27 Apr 2009 10:24:01 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-version [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Jos I. Boumans&#34; &lt;kane [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On Apr 27, 2009, at 3:29 AM, John Peacock via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=45241">http://rt.cpan.org/Ticket/Display.html?id=45241</a></span> &gt;
&gt;
&gt; Jos Boumans via RT wrote:
<div class="message-stanza open">&gt;&gt; I found a rather alarming bug in version.pm. It seems comparisons
&gt;&gt; against big numbers &#40;picked an arbitrary one, did not check for the
&gt;&gt; lower bound&#41; produce broken results on 64bit on 5.8.9 &#40;and presumably
&gt;&gt; all of 5.8.x&#41;:
</div>&gt;
&gt; I can&#39;t recreate with 64-bit Perl 5.8.8 &#40;Centos&#41;.  Can you do this:
</div>
A bit of extra digging shows that it&#39;s the pure perl version that has
this problem. The XS version behaves correctly on both perl versions.

Please make sure you&#39;re testing this problem with version::vpp as the
backend.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; $ perl5.8.8 -MDevel::Peek -e &#39;Dump&#40;~0/1000&#41;&#39;
&gt; SV = NV&#40;0x36ec8a8&#41; at 0x36c53d0
&gt;   REFCNT = 1
&gt;   FLAGS = &#40;PADBUSY,PADTMP,NOK,READONLY,pNOK&#41;
&gt;   NV = 1.84467440737096e+16
&gt;
&gt; $ perl5.10.0 -MDevel::Peek -e &#39;Dump&#40;~0/1000&#41;&#39;
&gt; SV = NV&#40;0xb74d8b8&#41; at 0xb725e30
&gt;   REFCNT = 1
&gt;   FLAGS = &#40;PADTMP,NOK,READONLY,pNOK&#41;
&gt;   NV = 1.84467440737096e+16
&gt;
&gt; on your box and show me the output?
</div>
[jos@open-solaris-noc ~]$ ~/perl/5.10.0/bin/perl -MDevel::Peek -e  
&#39;Dump&#40;~0/1000&#41;&#39;
SV = NV&#40;0x81837f0&#41; at 0x816bd90
   REFCNT = 1
   FLAGS = &#40;NOK,READONLY,pNOK&#41;
   NV = 1.84467440737096e+16
[jos@open-solaris-noc ~]$ ~/perl/5.8.9/bin/perl -MDevel::Peek -e &#39;Dump 
&#40;~0/1000&#41;&#39;
SV = NV&#40;0x8155594&#41; at 0x813e218
   REFCNT = 1
   FLAGS = &#40;NOK,READONLY,pNOK&#41;
   NV = 1.84467440737096e+16

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In any case, I can&#39;t consider this to be a bug in version.pm; you  
&gt; are passing a
&gt; very large floating point number to code which immediately converts  
&gt; it to a PV
&gt; and parses it as a string.  It isn&#39;t surprising that you can come  
&gt; up with slight
&gt; variations to the FP notation.
</div>
I hope you&#39;re kidding. &#39;slight variations&#39; is a real understatement;  
in one case
a number is BIGGER than 3.26, in the other it&#39;s not.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; version.pm is not a generic module: it is designed for precisely  
&gt; the purpose of
&gt; parsing module VERSION&#39;s in a sensible and consistent fashion; if  
&gt; you actually
&gt; want to use ~0/1000 as your module $VERSION &#40;which will be  
&gt; radically different
&gt; on 32 and 64-bit machines&#41;, then I feel sorry for your users... ;-&#41;
</div>
As I said in the original bug report, i did not test for the lower  
bound, it
merely displays that on 5.8, version::vpp behaves DIFFERENTLY from  
version::vxs.
And *that* is the problem.

Additional research shows it only happens &#40;reproducably&#41; for some  
ranges of values:

$ ~/perl/5.8.9/bin/perl -I/tmp/version -Mversion -le&#39;$d=1; while&#40;$d&gt;0&#41; 
{print &#34;d=$d: &#34;, version-&gt;new&#40;&#34;2&#34;&#41; &lt;= version-&gt;new&#40; ~0/$d &#41;; $d&lt;&lt;=1}&#39;
d=1: 1
d=2: 1
d=4: 1
d=8: 1
d=16:
d=32: 1
d=64: 1
d=128:
d=256: 1
d=512: 1
d=1024:
d=2048: 1
d=4096: 1
d=8192: 1
d=16384:
d=32768: 1
d=65536: 1
d=131072: 1
d=262144: 1
d=524288: 1
d=1048576: 1
d=2097152: 1
d=4194304: 1
d=8388608: 1
d=16777216: 1
d=33554432: 1
d=67108864: 1
d=134217728: 1
d=268435456: 1
d=536870912: 1
d=1073741824: 1
d=2147483648: 1
d=4294967296: 1
d=8589934592: 1
d=17179869184: 1
d=34359738368: 1
d=68719476736: 1
d=137438953472: 1
d=274877906944: 1
d=549755813888: 1
d=1099511627776: 1
d=2199023255552: 1
d=4398046511104: 1
d=8796093022208: 1
d=17592186044416: 1
d=35184372088832: 1
d=70368744177664: 1
d=140737488355328: 1
d=281474976710656: 1
d=562949953421312: 1
d=1125899906842624: 1
d=2251799813685248: 1
d=4503599627370496: 1
d=9007199254740992: 1
d=18014398509481984: 1
d=36028797018963968: 1
d=72057594037927936: 1
d=144115188075855872: 1
d=288230376151711744: 1
d=576460752303423488: 1
d=1152921504606846976: 1
d=2305843009213693952: 1
d=4611686018427387904: 1
d=9223372036854775808: 1

The other tester machine that was affected by this problem:

   <span class="clickylink"><a target="new" rel="nofollow" href="http://www.nntp.perl.org/group/perl.cpan.testers/2009/04/">http://www.nntp.perl.org/group/perl.cpan.testers/2009/04/</a></span> 
msg3741982.html

The box I&#39;m testing this on is Jost Krieger&#39;s solaris smoker. He&#39;s  
been kind
enough to give out an account to me. I&#39;m sure if you ask him, he&#39;ll  
do the same
for you.

Cheers,

--

        Jos Boumans

        &#34;Whenever you find you are on the side of the majority,
        it is time to pause and reflect.&#34; - Mark Twain
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;27&nbsp;17:18:33&nbsp;2009</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Apr 27 04:24:30 2009, KANE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
</div>[...]
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Additional research shows it only happens &#40;reproducably&#41; for some  
&gt; ranges of values:
&gt; 
&gt; $ ~/perl/5.8.9/bin/perl -I/tmp/version -Mversion -le&#39;$d=1; while&#40;$d&gt;0&#41; 
&gt; {print &#34;d=$d: &#34;, version-&gt;new&#40;&#34;2&#34;&#41; &lt;= version-&gt;new&#40; ~0/$d &#41;; $d&lt;&lt;=1}&#39;
&gt; d=1: 1
&gt; d=2: 1
&gt; d=4: 1
&gt; d=8: 1
&gt; d=16:
&gt; d=32: 1
&gt; d=64: 1
&gt; d=128:
&gt; d=256: 1
&gt; d=512: 1
&gt; d=1024:
&gt; d=2048: 1
&gt; d=4096: 1
&gt; d=8192: 1
&gt; d=16384:
&gt; d=32768: 1
</div>...

You can see the pattern if you print out the value of the checked
versions: you see a failure if scientific notation is used and the
integer part of the mantissa is lower than 2:

d=1: 18446744073709551615
d=2: 9.22337203685478e+18
d=4: 4.61168601842739e+18
d=8: 2.30584300921369e+18
d=16: 1.15292150460685e+18
d=32: 5.76460752303423e+17
d=64: 2.88230376151712e+17
d=128: 1.44115188075856e+17
d=256: 7.20575940379279e+16
d=512: 3.6028797018964e+16
d=1024: 1.8014398509482e+16
d=2048: 9.00719925474099e+15
d=4096: 4.5035996273705e+15
d=8192: 2.25179981368525e+15
d=16384: 1.12589990684262e+15
d=32768: 562949953421312

That said, I would tend to just declare the semantics of version numbers
that large as undefined.

Regards,
    Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;27&nbsp;17:22:32&nbsp;2009</span>
    <span class="description">kane [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #45241] Version.pm gives different results for comparisons under 5.8.9&#40;broken&#41; and 5.10.0</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 27 Apr 2009 23:22:04 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-version [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Jos I. Boumans&#34; &lt;kane [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On Apr 27, 2009, at 11:18 PM, Slaven_Rezic via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=45241">https://rt.cpan.org/Ticket/Display.html?id=45241</a></span> &gt;
&gt;
&gt; On Mon Apr 27 04:24:30 2009, KANE wrote:
<div class="message-stanza open">&gt;&gt;
</div>&gt; [...]
<div class="message-stanza open">&gt;&gt; Additional research shows it only happens &#40;reproducably&#41; for some
&gt;&gt; ranges of values:
&gt;&gt;
&gt;&gt; $ ~/perl/5.8.9/bin/perl -I/tmp/version -Mversion -le&#39;$d=1; while 
&gt;&gt; &#40;$d&gt;0&#41;
&gt;&gt; {print &#34;d=$d: &#34;, version-&gt;new&#40;&#34;2&#34;&#41; &lt;= version-&gt;new&#40; ~0/$d &#41;; $d&lt;&lt;=1}&#39;
&gt;&gt; d=1: 1
&gt;&gt; d=2: 1
&gt;&gt; d=4: 1
&gt;&gt; d=8: 1
&gt;&gt; d=16:
&gt;&gt; d=32: 1
&gt;&gt; d=64: 1
&gt;&gt; d=128:
&gt;&gt; d=256: 1
&gt;&gt; d=512: 1
&gt;&gt; d=1024:
&gt;&gt; d=2048: 1
&gt;&gt; d=4096: 1
&gt;&gt; d=8192: 1
&gt;&gt; d=16384:
&gt;&gt; d=32768: 1
</div>&gt; ...
&gt;
&gt; You can see the pattern if you print out the value of the checked
&gt; versions: you see a failure if scientific notation is used and the
&gt; integer part of the mantissa is lower than 2:
&gt;
&gt; d=1: 18446744073709551615
&gt; d=2: 9.22337203685478e+18
&gt; d=4: 4.61168601842739e+18
&gt; d=8: 2.30584300921369e+18
&gt; d=16: 1.15292150460685e+18
&gt; d=32: 5.76460752303423e+17
&gt; d=64: 2.88230376151712e+17
&gt; d=128: 1.44115188075856e+17
&gt; d=256: 7.20575940379279e+16
&gt; d=512: 3.6028797018964e+16
&gt; d=1024: 1.8014398509482e+16
&gt; d=2048: 9.00719925474099e+15
&gt; d=4096: 4.5035996273705e+15
&gt; d=8192: 2.25179981368525e+15
&gt; d=16384: 1.12589990684262e+15
&gt; d=32768: 562949953421312
&gt;
&gt; That said, I would tend to just declare the semantics of version  
&gt; numbers
&gt; that large as undefined.
</div>
I can live with that; but i&#39;d like a version.pm that behaves the same  
in xs
and pure perl. Whatever that behaviour should be I&#39;m happy to leave  
to the
version.pm developers, but right now this can lead to strange  
behaviours.

Cheers,

--

        Jos Boumans

        &#34;Whenever you find you are on the side of the majority,
        it is time to pause and reflect.&#34; - Mark Twain
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;13&nbsp;16:15:44&nbsp;2009</span>
    <span class="description">jpeacock [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Apr 27 17:22:32 2009, KANE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; I&#39;d like a version.pm that behaves the same  
&gt; in xs and pure perl. Whatever that behaviour should be I&#39;m happy to 
&gt; leave  to the  version.pm developers, but right now this can lead to
&gt; strange  behaviours.
</div>
Sorry I didn&#39;t pay close enough attention this this the first time
around.  The code that vpp.pm uses to try and eliminate any exponential
notation:

  # exponential notation
  if &#40; $value =~ /\d+.?\d*e-?\d+/ &#41; {
    $value = sprintf&#40;&#34;%.9f&#34;,$value&#41;;
    $value =~ s/&#40;0+&#41;$//; # trim trailing zeros
  }

wasn&#39;t tuned for very large numbers, but rather to very small numbers. 
If I change that regex to the correct form:

  # exponential notation
  if &#40; $value =~ /\d+.?\d*e[-+]?\d+/ &#41; {
    $value = sprintf&#40;&#34;%.9f&#34;,$value&#41;;
    $value =~ s/&#40;0+&#41;$//; # trim trailing zeros
  }

then it works even on 64-bit platforms.  I have no way to formulate a
portable test for that &#40;since it involves creating a large-enough number
to trigger Perl&#39;s exponential notation&#41;, so you&#39;ll just have to take my
word on it that it works.  ;-&#41;

John
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;13&nbsp;16:15:47&nbsp;2009</span>
    <span class="description">jpeacock [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
