<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #91699 for HTTP-Daemon: Extend IO::Socket::IP to replace ::INET</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #91699 for HTTP-Daemon: Extend IO::Socket::IP to replace ::INET</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/HTTP-Daemon/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/HTTP-Daemon/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/HTTP-Daemon/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/HTTP-Daemon/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/HTTP-Daemon">HTTP-Daemon CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">91699</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/HTTP-Daemon/Active/">HTTP-Daemon</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
MARKOV [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-237466-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
6.01    </td>
  </tr>
  <tr id="CF-237467-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;27&nbsp;20:38:25&nbsp;2013</span>
    <span class="description">MARKOV [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Extend IO::Socket::IP to replace ::INET</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The HTTP::Daemon::ClientConn is based on a IO::Socket::INET object, which is a pity because that does not support IPv6.  The ::IP implementation is a drop-in replacement.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;16&nbsp;11:49:48&nbsp;2017</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ppisar [...] redhat.com</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne PÃ¡ 27.pro.2013 20:38:25, MARKOV napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The HTTP::Daemon::ClientConn is based on a IO::Socket::INET object,
&gt; which is a pity because that does not support IPv6.  The ::IP
&gt; implementation is a drop-in replacement.
</div>
Attached patch implements it. Thus is should also fix CPAN RT #71395.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-Add-IPv6-support.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 7154a50af8889b385e5c83793a29bb8e9f4554e7 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Petr=20P=C3=ADsa=C5=99?= &lt;ppisar@redhat.com&gt;
Date: Mon, 16 Jan 2017 16:13:08 +0100
Subject: [PATCH] Add IPv6 support
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

This patch ports the code from IO::Socket::INET to IO::Socket::IP in
order to support IPv6.

CPAN RT #91699, #71395.

Signed-off-by: Petr PÃÂ­saÃÂ &lt;ppisar@redhat.com&gt;
---
 Makefile.PL        |  1 +
 README             | 24 ++++++++++++------------
 lib/HTTP/Daemon.pm | 42 +++++++++++++++++++++++++++---------------
 t/chunked.t        | 34 +++++++++++++++++++++++-----------
 4 files changed, 63 insertions&#40;+&#41;, 38 deletions&#40;-&#41;

diff --git a/Makefile.PL b/Makefile.PL
index 09c7e86..85d5712 100644
--- a/Makefile.PL
+++ b/Makefile.PL
@@ -14,6 +14,7 @@ WriteMakefile&#40;
     PREREQ_PM =&gt; {
 	&#39;Sys::Hostname&#39; =&gt; 0,
 	&#39;IO::Socket&#39; =&gt; 0,
+	&#39;IO::Socket::IP&#39; =&gt; 0,
 	&#39;HTTP::Request&#39; =&gt; 6,
 	&#39;HTTP::Response&#39; =&gt; 6,
 	&#39;HTTP::Status&#39; =&gt; 6,
diff --git a/README b/README
index be5a20a..ddb3b6e 100644
--- a/README
+++ b/README
@@ -24,12 +24,12 @@ SYNOPSIS
 DESCRIPTION
     Instances of the `HTTP::Daemon&#39; class are HTTP/1.1 servers that listen
     on a socket for incoming requests. The `HTTP::Daemon&#39; is a subclass of
-    `IO::Socket::INET&#39;, so you can perform socket operations directly on it
+    `IO::Socket::IP&#39;, so you can perform socket operations directly on it
     too.
 
     The accept&#40;&#41; method will return when a connection from a client is
     available. The returned value will be an `HTTP::Daemon::ClientConn&#39;
-    object which is another `IO::Socket::INET&#39; subclass. Calling the
+    object which is another `IO::Socket::IP&#39; subclass. Calling the
     get_request&#40;&#41; method on this object will read data from the client and
     return an `HTTP::Request&#39; object. The ClientConn object also provide
     methods to send back various responses.
@@ -40,13 +40,13 @@ DESCRIPTION
     responses that conform to the HTTP/1.1 protocol.
 
     The following methods of `HTTP::Daemon&#39; are new &#40;or enhanced&#41; relative
-    to the `IO::Socket::INET&#39; base class:
+    to the `IO::Socket::IP&#39; base class:
 
     $d = HTTP::Daemon-&gt;new
     $d = HTTP::Daemon-&gt;new&#40; %opts &#41;
         The constructor method takes the same arguments as the
-        `IO::Socket::INET&#39; constructor, but unlike its base class it can
-        also be called without any arguments. The daemon will then set up a
+        `IO::Socket::IP&#39; constructor, but unlike its base class it can also
+        be called without any arguments. The daemon will then set up a
         listen queue of 5 connections and allocate some random port number.
 
         A server that wants to bind to some specific address on the standard
@@ -57,8 +57,8 @@ DESCRIPTION
                    LocalPort =&gt; 80,
                &#41;;
 
-        See IO::Socket::INET for a description of other arguments that can
-        be used configure the daemon during construction.
+        See IO::Socket::IP for a description of other arguments that can be
+        used configure the daemon during construction.
 
     $c = $d-&gt;accept
     $c = $d-&gt;accept&#40; $pkg &#41;
@@ -71,7 +71,7 @@ DESCRIPTION
 
         The accept method will return `undef&#39; if timeouts have been enabled
         and no connection is made within the given time. The timeout&#40;&#41;
-        method is described in IO::Socket.
+        method is described in IO::Socket::IP.
 
         In list context both the client object and the peer address will be
         returned; see the description of the accept method IO::Socket for
@@ -89,9 +89,9 @@ DESCRIPTION
         The default is the string &#34;libwww-perl-daemon/#.##&#34; where &#34;#.##&#34; is
         replaced with the version number of this module.
 
-    The `HTTP::Daemon::ClientConn&#39; is a `IO::Socket::INET&#39; subclass.
-    Instances of this class are returned by the accept&#40;&#41; method of
-    `HTTP::Daemon&#39;. The following methods are provided:
+    The `HTTP::Daemon::ClientConn&#39; is a `IO::Socket::IP&#39; subclass. Instances
+    of this class are returned by the accept&#40;&#41; method of `HTTP::Daemon&#39;. The
+    following methods are provided:
 
     $c-&gt;get_request
     $c-&gt;get_request&#40; $headers_only &#41;
@@ -227,7 +227,7 @@ DESCRIPTION
 SEE ALSO
     RFC 2616
 
-    IO::Socket::INET, IO::Socket
+    IO::Socket::IP, IO::Socket
 
 COPYRIGHT
     Copyright 1996-2003, Gisle Aas
diff --git a/lib/HTTP/Daemon.pm b/lib/HTTP/Daemon.pm
index 27a7bf4..fc39b1c 100644
--- a/lib/HTTP/Daemon.pm
+++ b/lib/HTTP/Daemon.pm
@@ -5,8 +5,10 @@ use vars qw&#40;$VERSION @ISA $PROTO $DEBUG&#41;;
 
 $VERSION = &#34;6.01&#34;;
 
-use IO::Socket qw&#40;AF_INET INADDR_ANY INADDR_LOOPBACK inet_ntoa&#41;;
-@ISA=qw&#40;IO::Socket::INET&#41;;
+use Socket qw&#40;AF_INET AF_INET6 INADDR_ANY IN6ADDR_ANY
+	    INADDR_LOOPBACK IN6ADDR_LOOPBACK inet_ntop sockaddr_family&#41;;
+use IO::Socket::IP;
+@ISA=qw&#40;IO::Socket::IP&#41;;
 
 $PROTO = &#34;HTTP/1.1&#34;;
 
@@ -40,15 +42,25 @@ sub url
     my $self = shift;
     my $url = $self-&gt;_default_scheme . &#34;://&#34;;
     my $addr = $self-&gt;sockaddr;
-    if &#40;!$addr || $addr eq INADDR_ANY&#41; {
+    if &#40;!$addr || $addr eq INADDR_ANY || $addr eq IN6ADDR_ANY&#41; {
  	require Sys::Hostname;
  	$url .= lc Sys::Hostname::hostname&#40;&#41;;
     }
     elsif &#40;$addr eq INADDR_LOOPBACK&#41; {
-	$url .= inet_ntoa&#40;$addr&#41;;
+	$url .= inet_ntop&#40;$addr&#41;;
+    }
+    elsif &#40;$addr eq IN6ADDR_LOOPBACK&#41; {
+	$url .= &#39;[&#39; . inet_ntop&#40;$addr&#41; . &#39;]&#39;;
     }
     else {
-	$url .= gethostbyaddr&#40;$addr, AF_INET&#41; || inet_ntoa&#40;$addr&#41;;
+	my $host = $addr-&gt;sockhostname;
+        if &#40;!defined $host&#41; {
+	    $host = inet_ntop&#40;$addr&#41;;
+	    if &#40;sockaddr_family&#40;$addr&#41; eq AF_INET6&#41; {
+		$host = &#39;[&#39; . $host . &#39;]&#39;;
+	    }
+	}
+	$url .= $host;
     }
     my $port = $self-&gt;sockport;
     $url .= &#34;:$port&#34; if $port != $self-&gt;_default_port;
@@ -77,8 +89,8 @@ sub product_tokens
 package HTTP::Daemon::ClientConn;
 
 use vars qw&#40;@ISA $DEBUG&#41;;
-use IO::Socket &#40;&#41;;
-@ISA=qw&#40;IO::Socket::INET&#41;;
+use IO::Socket::IP &#40;&#41;;
+@ISA=qw&#40;IO::Socket::IP&#41;;
 *DEBUG = \$HTTP::Daemon::DEBUG;
 
 use HTTP::Request  &#40;&#41;;
@@ -645,12 +657,12 @@ HTTP::Daemon - a simple http server class
 
 Instances of the C&lt;HTTP::Daemon&gt; class are HTTP/1.1 servers that
 listen on a socket for incoming requests. The C&lt;HTTP::Daemon&gt; is a
-subclass of C&lt;IO::Socket::INET&gt;, so you can perform socket operations
+subclass of C&lt;IO::Socket::IP&gt;, so you can perform socket operations
 directly on it too.
 
 The accept&#40;&#41; method will return when a connection from a client is
 available.  The returned value will be an C&lt;HTTP::Daemon::ClientConn&gt;
-object which is another C&lt;IO::Socket::INET&gt; subclass.  Calling the
+object which is another C&lt;IO::Socket::IP&gt; subclass.  Calling the
 get_request&#40;&#41; method on this object will read data from the client and
 return an C&lt;HTTP::Request&gt; object.  The ClientConn object also provide
 methods to send back various responses.
@@ -661,7 +673,7 @@ desirable.  Also note that the user is responsible for generating
 responses that conform to the HTTP/1.1 protocol.
 
 The following methods of C&lt;HTTP::Daemon&gt; are new &#40;or enhanced&#41; relative
-to the C&lt;IO::Socket::INET&gt; base class:
+to the C&lt;IO::Socket::IP&gt; base class:
 
 =over 4
 
@@ -670,7 +682,7 @@ to the C&lt;IO::Socket::INET&gt; base class:
 =item $d = HTTP::Daemon-&gt;new&#40; %opts &#41;
 
 The constructor method takes the same arguments as the
-C&lt;IO::Socket::INET&gt; constructor, but unlike its base class it can also
+C&lt;IO::Socket::IP&gt; constructor, but unlike its base class it can also
 be called without any arguments.  The daemon will then set up a listen
 queue of 5 connections and allocate some random port number.
 
@@ -682,7 +694,7 @@ HTTP port will be constructed like this:
            LocalPort =&gt; 80,
        &#41;;
 
-See L&lt;IO::Socket::INET&gt; for a description of other arguments that can
+See L&lt;IO::Socket::IP&gt; for a description of other arguments that can
 be used configure the daemon during construction.
 
 =item $c = $d-&gt;accept
@@ -699,7 +711,7 @@ class a subclass of C&lt;HTTP::Daemon::ClientConn&gt;.
 
 The accept method will return C&lt;undef&gt; if timeouts have been enabled
 and no connection is made within the given time.  The timeout&#40;&#41; method
-is described in L&lt;IO::Socket&gt;.
+is described in L&lt;IO::Socket::IP&gt;.
 
 In list context both the client object and the peer address will be
 returned; see the description of the accept method L&lt;IO::Socket&gt; for
@@ -721,7 +733,7 @@ replaced with the version number of this module.
 
 =back
 
-The C&lt;HTTP::Daemon::ClientConn&gt; is a C&lt;IO::Socket::INET&gt;
+The C&lt;HTTP::Daemon::ClientConn&gt; is a C&lt;IO::Socket::IP&gt;
 subclass. Instances of this class are returned by the accept&#40;&#41; method
 of C&lt;HTTP::Daemon&gt;.  The following methods are provided:
 
@@ -895,7 +907,7 @@ Return a reference to the corresponding C&lt;HTTP::Daemon&gt; object.
 
 RFC 2616
 
-L&lt;IO::Socket::INET&gt;, L&lt;IO::Socket&gt;
+L&lt;IO::Socket::IP&gt;, L&lt;IO::Socket&gt;
 
 =head1 COPYRIGHT
 
diff --git a/t/chunked.t b/t/chunked.t
index e11799f..c274b11 100644
--- a/t/chunked.t
+++ b/t/chunked.t
@@ -95,18 +95,30 @@ my $can_fork = $Config{d_fork} ||
 my $tests = @TESTS;
 my $tport = 8333;
 
-my $tsock = IO::Socket::INET-&gt;new&#40;LocalAddr =&gt; &#39;0.0.0.0&#39;,
-                                  LocalPort =&gt; $tport,
-                                  Listen    =&gt; 1,
-                                  ReuseAddr =&gt; 1&#41;;
+my @addresses = &#40;
+    { server =&gt; &#39;::&#39;, client =&gt; &#39;::1&#39; },
+    { server =&gt; &#39;0.0.0.0&#39;, client =&gt; &#39;127.0.0.1&#39; }
+&#41;;
+my $family;
+for my $id &#40;0..$#addresses&#41; {
+    my $tsock = IO::Socket::IP-&gt;new&#40;LocalAddr =&gt; $addresses[$id]-&gt;{server},
+                                    LocalPort =&gt; $tport,
+                                    Listen    =&gt; 1,
+                                    ReuseAddr =&gt; 1&#41;;
+    if &#40;$tsock&#41; {
+        close $tsock;
+        $family = $id;
+        last;
+    }
+}
+
 if &#40;!$can_fork&#41; {
   plan skip_all =&gt; &#34;This system cannot fork&#34;;
 }
-elsif &#40;!$tsock&#41; {
-  plan skip_all =&gt; &#34;Cannot listen on 0.0.0.0:$tport&#34;;
+elsif &#40;!defined $family&#41; {
+  plan skip_all =&gt; &#34;Cannot listen on unspecifed address and port $tport&#34;;
 }
 else {
-  close $tsock;
   plan tests =&gt; $tests;
 }
 
@@ -132,9 +144,9 @@ if &#40;$pid = fork&#41; {
       open my $fh, &#34;| socket localhost $tport&#34; or die;
       print $fh $test;
     }
-    use IO::Socket::INET;
-    my $sock = IO::Socket::INET-&gt;new&#40;
-                                     PeerAddr =&gt; &#34;127.0.0.1&#34;,
+    use IO::Socket::IP;
+    my $sock = IO::Socket::IP-&gt;new&#40;
+                                     PeerAddr =&gt; $addresses[$family]-&gt;{client},
                                      PeerPort =&gt; $tport,
                                     &#41; or die;
     if &#40;0&#41; {
@@ -158,7 +170,7 @@ if &#40;$pid = fork&#41; {
 } else {
   die &#34;cannot fork: $!&#34; unless defined $pid;
   my $d = HTTP::Daemon-&gt;new&#40;
-                            LocalAddr =&gt; &#39;0.0.0.0&#39;,
+                            LocalAddr =&gt; $addresses[$family]-&gt;{server},
                             LocalPort =&gt; $tport,
                             ReuseAddr =&gt; 1,
                            &#41; or die;
-- 
2.7.4

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;16&nbsp;11:49:49&nbsp;2017</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;17&nbsp;09:06:39&nbsp;2017</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ppisar [...] redhat.com</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne Po 16.led.2017 11:49:48, ppisar napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Attached patch implements it. Thus is should also fix CPAN RT #71395.
</div>
This patch replaces the previous one. It fixes bad inet_ntop&#40;&#41; invocation.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-Add-IPv6-support.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 067faffb8e596a53c9ac2ed7e571472f7a163681 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Petr=20P=C3=ADsa=C5=99?= &lt;ppisar@redhat.com&gt;
Date: Mon, 16 Jan 2017 16:13:08 +0100
Subject: [PATCH] Add IPv6 support
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

This patch ports the code from IO::Socket::INET to IO::Socket::IP in
order to support IPv6.

CPAN RT #91699, #71395.

Signed-off-by: Petr PÃÂ­saÃÂ &lt;ppisar@redhat.com&gt;
---
 Makefile.PL        |  1 +
 README             | 24 ++++++++++++------------
 lib/HTTP/Daemon.pm | 43 ++++++++++++++++++++++++++++---------------
 t/chunked.t        | 34 +++++++++++++++++++++++-----------
 4 files changed, 64 insertions&#40;+&#41;, 38 deletions&#40;-&#41;

diff --git a/Makefile.PL b/Makefile.PL
index 09c7e86..85d5712 100644
--- a/Makefile.PL
+++ b/Makefile.PL
@@ -14,6 +14,7 @@ WriteMakefile&#40;
     PREREQ_PM =&gt; {
 	&#39;Sys::Hostname&#39; =&gt; 0,
 	&#39;IO::Socket&#39; =&gt; 0,
+	&#39;IO::Socket::IP&#39; =&gt; 0,
 	&#39;HTTP::Request&#39; =&gt; 6,
 	&#39;HTTP::Response&#39; =&gt; 6,
 	&#39;HTTP::Status&#39; =&gt; 6,
diff --git a/README b/README
index be5a20a..ddb3b6e 100644
--- a/README
+++ b/README
@@ -24,12 +24,12 @@ SYNOPSIS
 DESCRIPTION
     Instances of the `HTTP::Daemon&#39; class are HTTP/1.1 servers that listen
     on a socket for incoming requests. The `HTTP::Daemon&#39; is a subclass of
-    `IO::Socket::INET&#39;, so you can perform socket operations directly on it
+    `IO::Socket::IP&#39;, so you can perform socket operations directly on it
     too.
 
     The accept&#40;&#41; method will return when a connection from a client is
     available. The returned value will be an `HTTP::Daemon::ClientConn&#39;
-    object which is another `IO::Socket::INET&#39; subclass. Calling the
+    object which is another `IO::Socket::IP&#39; subclass. Calling the
     get_request&#40;&#41; method on this object will read data from the client and
     return an `HTTP::Request&#39; object. The ClientConn object also provide
     methods to send back various responses.
@@ -40,13 +40,13 @@ DESCRIPTION
     responses that conform to the HTTP/1.1 protocol.
 
     The following methods of `HTTP::Daemon&#39; are new &#40;or enhanced&#41; relative
-    to the `IO::Socket::INET&#39; base class:
+    to the `IO::Socket::IP&#39; base class:
 
     $d = HTTP::Daemon-&gt;new
     $d = HTTP::Daemon-&gt;new&#40; %opts &#41;
         The constructor method takes the same arguments as the
-        `IO::Socket::INET&#39; constructor, but unlike its base class it can
-        also be called without any arguments. The daemon will then set up a
+        `IO::Socket::IP&#39; constructor, but unlike its base class it can also
+        be called without any arguments. The daemon will then set up a
         listen queue of 5 connections and allocate some random port number.
 
         A server that wants to bind to some specific address on the standard
@@ -57,8 +57,8 @@ DESCRIPTION
                    LocalPort =&gt; 80,
                &#41;;
 
-        See IO::Socket::INET for a description of other arguments that can
-        be used configure the daemon during construction.
+        See IO::Socket::IP for a description of other arguments that can be
+        used configure the daemon during construction.
 
     $c = $d-&gt;accept
     $c = $d-&gt;accept&#40; $pkg &#41;
@@ -71,7 +71,7 @@ DESCRIPTION
 
         The accept method will return `undef&#39; if timeouts have been enabled
         and no connection is made within the given time. The timeout&#40;&#41;
-        method is described in IO::Socket.
+        method is described in IO::Socket::IP.
 
         In list context both the client object and the peer address will be
         returned; see the description of the accept method IO::Socket for
@@ -89,9 +89,9 @@ DESCRIPTION
         The default is the string &#34;libwww-perl-daemon/#.##&#34; where &#34;#.##&#34; is
         replaced with the version number of this module.
 
-    The `HTTP::Daemon::ClientConn&#39; is a `IO::Socket::INET&#39; subclass.
-    Instances of this class are returned by the accept&#40;&#41; method of
-    `HTTP::Daemon&#39;. The following methods are provided:
+    The `HTTP::Daemon::ClientConn&#39; is a `IO::Socket::IP&#39; subclass. Instances
+    of this class are returned by the accept&#40;&#41; method of `HTTP::Daemon&#39;. The
+    following methods are provided:
 
     $c-&gt;get_request
     $c-&gt;get_request&#40; $headers_only &#41;
@@ -227,7 +227,7 @@ DESCRIPTION
 SEE ALSO
     RFC 2616
 
-    IO::Socket::INET, IO::Socket
+    IO::Socket::IP, IO::Socket
 
 COPYRIGHT
     Copyright 1996-2003, Gisle Aas
diff --git a/lib/HTTP/Daemon.pm b/lib/HTTP/Daemon.pm
index 27a7bf4..0e22b77 100644
--- a/lib/HTTP/Daemon.pm
+++ b/lib/HTTP/Daemon.pm
@@ -5,8 +5,10 @@ use vars qw&#40;$VERSION @ISA $PROTO $DEBUG&#41;;
 
 $VERSION = &#34;6.01&#34;;
 
-use IO::Socket qw&#40;AF_INET INADDR_ANY INADDR_LOOPBACK inet_ntoa&#41;;
-@ISA=qw&#40;IO::Socket::INET&#41;;
+use Socket qw&#40;AF_INET AF_INET6 INADDR_ANY IN6ADDR_ANY
+	    INADDR_LOOPBACK IN6ADDR_LOOPBACK inet_ntop sockaddr_family&#41;;
+use IO::Socket::IP;
+@ISA=qw&#40;IO::Socket::IP&#41;;
 
 $PROTO = &#34;HTTP/1.1&#34;;
 
@@ -40,15 +42,26 @@ sub url
     my $self = shift;
     my $url = $self-&gt;_default_scheme . &#34;://&#34;;
     my $addr = $self-&gt;sockaddr;
-    if &#40;!$addr || $addr eq INADDR_ANY&#41; {
+    if &#40;!$addr || $addr eq INADDR_ANY || $addr eq IN6ADDR_ANY&#41; {
  	require Sys::Hostname;
  	$url .= lc Sys::Hostname::hostname&#40;&#41;;
     }
     elsif &#40;$addr eq INADDR_LOOPBACK&#41; {
-	$url .= inet_ntoa&#40;$addr&#41;;
+	$url .= inet_ntop&#40;AF_INET, $addr&#41;;
+    }
+    elsif &#40;$addr eq IN6ADDR_LOOPBACK&#41; {
+	$url .= &#39;[&#39; . inet_ntop&#40;AF_INET6, $addr&#41; . &#39;]&#39;;
     }
     else {
-	$url .= gethostbyaddr&#40;$addr, AF_INET&#41; || inet_ntoa&#40;$addr&#41;;
+	my $host = $addr-&gt;sockhostname;
+        if &#40;!defined $host&#41; {
+	    if &#40;sockaddr_family&#40;$addr&#41; eq AF_INET6&#41; {
+		$host = &#39;[&#39; . inet_ntop&#40;AF_INET6, $addr&#41; . &#39;]&#39;;
+	    } else {
+		$host = inet_ntop&#40;AF_INET6, $addr&#41;;
+	    }
+	}
+	$url .= $host;
     }
     my $port = $self-&gt;sockport;
     $url .= &#34;:$port&#34; if $port != $self-&gt;_default_port;
@@ -77,8 +90,8 @@ sub product_tokens
 package HTTP::Daemon::ClientConn;
 
 use vars qw&#40;@ISA $DEBUG&#41;;
-use IO::Socket &#40;&#41;;
-@ISA=qw&#40;IO::Socket::INET&#41;;
+use IO::Socket::IP &#40;&#41;;
+@ISA=qw&#40;IO::Socket::IP&#41;;
 *DEBUG = \$HTTP::Daemon::DEBUG;
 
 use HTTP::Request  &#40;&#41;;
@@ -645,12 +658,12 @@ HTTP::Daemon - a simple http server class
 
 Instances of the C&lt;HTTP::Daemon&gt; class are HTTP/1.1 servers that
 listen on a socket for incoming requests. The C&lt;HTTP::Daemon&gt; is a
-subclass of C&lt;IO::Socket::INET&gt;, so you can perform socket operations
+subclass of C&lt;IO::Socket::IP&gt;, so you can perform socket operations
 directly on it too.
 
 The accept&#40;&#41; method will return when a connection from a client is
 available.  The returned value will be an C&lt;HTTP::Daemon::ClientConn&gt;
-object which is another C&lt;IO::Socket::INET&gt; subclass.  Calling the
+object which is another C&lt;IO::Socket::IP&gt; subclass.  Calling the
 get_request&#40;&#41; method on this object will read data from the client and
 return an C&lt;HTTP::Request&gt; object.  The ClientConn object also provide
 methods to send back various responses.
@@ -661,7 +674,7 @@ desirable.  Also note that the user is responsible for generating
 responses that conform to the HTTP/1.1 protocol.
 
 The following methods of C&lt;HTTP::Daemon&gt; are new &#40;or enhanced&#41; relative
-to the C&lt;IO::Socket::INET&gt; base class:
+to the C&lt;IO::Socket::IP&gt; base class:
 
 =over 4
 
@@ -670,7 +683,7 @@ to the C&lt;IO::Socket::INET&gt; base class:
 =item $d = HTTP::Daemon-&gt;new&#40; %opts &#41;
 
 The constructor method takes the same arguments as the
-C&lt;IO::Socket::INET&gt; constructor, but unlike its base class it can also
+C&lt;IO::Socket::IP&gt; constructor, but unlike its base class it can also
 be called without any arguments.  The daemon will then set up a listen
 queue of 5 connections and allocate some random port number.
 
@@ -682,7 +695,7 @@ HTTP port will be constructed like this:
            LocalPort =&gt; 80,
        &#41;;
 
-See L&lt;IO::Socket::INET&gt; for a description of other arguments that can
+See L&lt;IO::Socket::IP&gt; for a description of other arguments that can
 be used configure the daemon during construction.
 
 =item $c = $d-&gt;accept
@@ -699,7 +712,7 @@ class a subclass of C&lt;HTTP::Daemon::ClientConn&gt;.
 
 The accept method will return C&lt;undef&gt; if timeouts have been enabled
 and no connection is made within the given time.  The timeout&#40;&#41; method
-is described in L&lt;IO::Socket&gt;.
+is described in L&lt;IO::Socket::IP&gt;.
 
 In list context both the client object and the peer address will be
 returned; see the description of the accept method L&lt;IO::Socket&gt; for
@@ -721,7 +734,7 @@ replaced with the version number of this module.
 
 =back
 
-The C&lt;HTTP::Daemon::ClientConn&gt; is a C&lt;IO::Socket::INET&gt;
+The C&lt;HTTP::Daemon::ClientConn&gt; is a C&lt;IO::Socket::IP&gt;
 subclass. Instances of this class are returned by the accept&#40;&#41; method
 of C&lt;HTTP::Daemon&gt;.  The following methods are provided:
 
@@ -895,7 +908,7 @@ Return a reference to the corresponding C&lt;HTTP::Daemon&gt; object.
 
 RFC 2616
 
-L&lt;IO::Socket::INET&gt;, L&lt;IO::Socket&gt;
+L&lt;IO::Socket::IP&gt;, L&lt;IO::Socket&gt;
 
 =head1 COPYRIGHT
 
diff --git a/t/chunked.t b/t/chunked.t
index e11799f..c274b11 100644
--- a/t/chunked.t
+++ b/t/chunked.t
@@ -95,18 +95,30 @@ my $can_fork = $Config{d_fork} ||
 my $tests = @TESTS;
 my $tport = 8333;
 
-my $tsock = IO::Socket::INET-&gt;new&#40;LocalAddr =&gt; &#39;0.0.0.0&#39;,
-                                  LocalPort =&gt; $tport,
-                                  Listen    =&gt; 1,
-                                  ReuseAddr =&gt; 1&#41;;
+my @addresses = &#40;
+    { server =&gt; &#39;::&#39;, client =&gt; &#39;::1&#39; },
+    { server =&gt; &#39;0.0.0.0&#39;, client =&gt; &#39;127.0.0.1&#39; }
+&#41;;
+my $family;
+for my $id &#40;0..$#addresses&#41; {
+    my $tsock = IO::Socket::IP-&gt;new&#40;LocalAddr =&gt; $addresses[$id]-&gt;{server},
+                                    LocalPort =&gt; $tport,
+                                    Listen    =&gt; 1,
+                                    ReuseAddr =&gt; 1&#41;;
+    if &#40;$tsock&#41; {
+        close $tsock;
+        $family = $id;
+        last;
+    }
+}
+
 if &#40;!$can_fork&#41; {
   plan skip_all =&gt; &#34;This system cannot fork&#34;;
 }
-elsif &#40;!$tsock&#41; {
-  plan skip_all =&gt; &#34;Cannot listen on 0.0.0.0:$tport&#34;;
+elsif &#40;!defined $family&#41; {
+  plan skip_all =&gt; &#34;Cannot listen on unspecifed address and port $tport&#34;;
 }
 else {
-  close $tsock;
   plan tests =&gt; $tests;
 }
 
@@ -132,9 +144,9 @@ if &#40;$pid = fork&#41; {
       open my $fh, &#34;| socket localhost $tport&#34; or die;
       print $fh $test;
     }
-    use IO::Socket::INET;
-    my $sock = IO::Socket::INET-&gt;new&#40;
-                                     PeerAddr =&gt; &#34;127.0.0.1&#34;,
+    use IO::Socket::IP;
+    my $sock = IO::Socket::IP-&gt;new&#40;
+                                     PeerAddr =&gt; $addresses[$family]-&gt;{client},
                                      PeerPort =&gt; $tport,
                                     &#41; or die;
     if &#40;0&#41; {
@@ -158,7 +170,7 @@ if &#40;$pid = fork&#41; {
 } else {
   die &#34;cannot fork: $!&#34; unless defined $pid;
   my $d = HTTP::Daemon-&gt;new&#40;
-                            LocalAddr =&gt; &#39;0.0.0.0&#39;,
+                            LocalAddr =&gt; $addresses[$family]-&gt;{server},
                             LocalPort =&gt; $tport,
                             ReuseAddr =&gt; 1,
                            &#41; or die;
-- 
2.7.4

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;18&nbsp;10:01:01&nbsp;2017</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ppisar [...] redhat.com</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne Ãt 17.led.2017 09:06:39, ppisar napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Dne Po 16.led.2017 11:49:48, ppisar napsal&#40;a&#41;:
<div class="message-stanza open">&gt; &gt; Attached patch implements it. Thus is should also fix CPAN RT #71395.
</div>&gt; 
&gt; This patch replaces the previous one. It fixes bad inet_ntop&#40;&#41; invocation.
</div>
Attached patch adds a special handling for undefined and emptry LocalAddr arguments to work around IO::Socket::IP incompatibility &#40;CPAN RT#123069&#41;.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> HTTP-Daemon-6.01-Handle-undef-and-empty-LocalAddr.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 607e0fa0787d12cd9f1545a9d26edb30f42201cc Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Petr=20P=C3=ADsa=C5=99?= &lt;ppisar@redhat.com&gt;
Date: Mon, 18 Sep 2017 15:21:16 +0200
Subject: [PATCH] Handle undef and empty LocalAddr
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

IO::Socket::INET interprets undefined and empty string LocalAddr
arguments as an unspecified address while IO::Socket::IP returns an
error. This seems to be one of the differences between the two
Socket implementations. Recent IO::Socket::IP &#40;0.39&#41; accepts undefined
value, but still bail outs on an empty string.

To improve compatibility, this patch adds a special handling for these
two values to be accepted as an unspecified value. Though this should
be corrected on IO::Socket:IP side probably.

CPAN RT#91699
CPAN RT#123069

Signed-off-by: Petr PÃÂ­saÃÂ &lt;ppisar@redhat.com&gt;
---
 lib/HTTP/Daemon.pm | 8 ++++++++
 1 file changed, 8 insertions&#40;+&#41;

diff --git a/lib/HTTP/Daemon.pm b/lib/HTTP/Daemon.pm
index 0e22b77..be5cdec 100644
--- a/lib/HTTP/Daemon.pm
+++ b/lib/HTTP/Daemon.pm
@@ -18,6 +18,14 @@ sub new
     my&#40;$class, %args&#41; = @_;
     $args{Listen} ||= 5;
     $args{Proto}  ||= &#39;tcp&#39;;
+    # Handle undefined or empty local address the same way as
+    # IO::Socket::INET -- use unspecified address
+    for my $key &#40;qw&#40;LocalAddr LocalHost&#41;&#41; {
+        if &#40;exists $args{$key} &#38;&#38;
+            &#40;!defined&#40;$args{$key}&#41; || $args{LocalAddr} eq &#39;&#39;&#41;&#41; {
+            delete $args{$key};
+        }
+    }
     return $class-&gt;SUPER::new&#40;%args&#41;;
 }
 
-- 
2.13.5

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;18&nbsp;10:27:38&nbsp;2017</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ppisar [...] redhat.com</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne Po 18.zÃ¡Å.2017 10:01:01, ppisar napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Attached patch adds a special handling for undefined and emptry
&gt; LocalAddr arguments to work around IO::Socket::IP incompatibility
&gt; &#40;CPAN RT#123069&#41;.
</div>
Grr. I made a typo. Attached patch replaces it.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> HTTP-Daemon-6.01-Handle-undef-and-empty-LocalAddr.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From b54702ab21edbf1ea0dbc00d978aecc89e5764d6 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Petr=20P=C3=ADsa=C5=99?= &lt;ppisar@redhat.com&gt;
Date: Mon, 18 Sep 2017 15:21:16 +0200
Subject: [PATCH] Handle undef and empty LocalAddr
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

IO::Socket::INET interprets undefined and empty string LocalAddr
arguments as an unspecified address while IO::Socket::IP returns an
error. This seems to be one of the differences between the two
Socket implementations. Recent IO::Socket::IP &#40;0.39&#41; accepts undefined
value, but still bail outs on an empty string.

To improve compatibility, this patch adds a special handling for these
two values to be accepted as an unspecified value. Though this should
be corrected on IO::Socket:IP side probably.

CPAN RT#91699
CPAN RT#123069

Signed-off-by: Petr PÃÂ­saÃÂ &lt;ppisar@redhat.com&gt;
---
 lib/HTTP/Daemon.pm | 8 ++++++++
 1 file changed, 8 insertions&#40;+&#41;

diff --git a/lib/HTTP/Daemon.pm b/lib/HTTP/Daemon.pm
index 0e22b77..1e9d48e 100644
--- a/lib/HTTP/Daemon.pm
+++ b/lib/HTTP/Daemon.pm
@@ -18,6 +18,14 @@ sub new
     my&#40;$class, %args&#41; = @_;
     $args{Listen} ||= 5;
     $args{Proto}  ||= &#39;tcp&#39;;
+    # Handle undefined or empty local address the same way as
+    # IO::Socket::INET -- use unspecified address
+    for my $key &#40;qw&#40;LocalAddr LocalHost&#41;&#41; {
+        if &#40;exists $args{$key} &#38;&#38;
+            &#40;!defined&#40;$args{$key}&#41; || $args{$key} eq &#39;&#39;&#41;&#41; {
+            delete $args{$key};
+        }
+    }
     return $class-&gt;SUPER::new&#40;%args&#41;;
 }
 
-- 
2.13.5

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;23&nbsp;11:16:43&nbsp;2018</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne Po 18.zÃ¡Å.2017 10:27:38, ppisar napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Dne Po 18.zÃ¡Å.2017 10:01:01, ppisar napsal&#40;a&#41;:
<div class="message-stanza open">&gt; &gt; Attached patch adds a special handling for undefined and emptry
&gt; &gt; LocalAddr arguments to work around IO::Socket::IP incompatibility
&gt; &gt; &#40;CPAN RT#123069&#41;.
</div>&gt; 
&gt; Grr. I made a typo. Attached patch replaces it.
&gt; 
</div>There was another bug found, CPAN RT#125242.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;01&nbsp;12:21:00&nbsp;2019</span>
    <span class="description">olaf [...] wundersolutions.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ticket migrated to github as <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/libwww-perl/HTTP-Daemon/issues/24">https://github.com/libwww-perl/HTTP-Daemon/issues/24</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;01&nbsp;12:21:01&nbsp;2019</span>
    <span class="description">olaf [...] wundersolutions.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
