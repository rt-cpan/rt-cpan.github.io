<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #132446 for PDF-API2: Corrupt fonts</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #132446 for PDF-API2: Corrupt fonts</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=PDF-API2">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=PDF-API2">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=PDF-API2">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=PDF-API2">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/PDF-API2">PDF-API2 CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">132446</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=PDF-API2">PDF-API2</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
mike.edwards [...] ceprinter.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-24958-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-24959-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




combine_PDFs.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1895510/1016239/combine_PDFs.pl">
Wed Apr 29 08:32:39 2020 (12k) by mike.edwards [...] ceprinter.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=132446">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1895412" href="/Public/Bug/Display.html?id=132446#txn-1895412">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;28&nbsp;17:03:19&nbsp;2020</span>
    <span class="description">mike.edwards [...] ceprinter.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Corrupt fonts</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 28 Apr 2020 21:03:09 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-PDF-API2 [...] rt.cpan.org&#34; &lt;bug-PDF-API2 [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike Edwards &lt;mike.edwards [...] ceprinter.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1895412/1016192/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1016192">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Not sure if this is a bug, per se, but I am getting different results on two different Ubuntu Linux boxes...

My project involves taking many individual PDFs, combining them into one, and adding a 2D barcode to every other page as I go. This works just fine on one machine &#40;Ubuntu 16.04&#41;, and does not throw errors on my other machine &#40;Ubuntu 18.04&#41; during run-time, but the end result gives errors in Acrobat, such as &#34;The font &#39;OFCCJF+MyriadPro-Bold&#39; contains bad /Flags&#34;, &#34;...contains bad /Widths&#34;, etc., with many glyphs being scrambled. &#40;The source PDFs that I am combining do not exhibit this behavior.&#41; I am guessing this is an issue with embedded fonts and the environment in which PDF::API2 finds the fonts to embed, but I&#39;m not sure. The font paths on both machines contain the fonts that are crashing, but I must be missing something. Is there a way to force a font to be explicitly and fully embedded in the final PDF that gets written out?

I am somewhat stymied as I have been running this same code &#40;with minor tweaks&#41; for a few years on this annual project but haven&#39;t figured this out yet. I could run everything on the box I know that works, but am trying to spread out the load.

Thanks,
Mike



--

Mike Edwards

[cid:9531e9c1-d5f0-4776-b636-c7a5acccb664]
2700 Bell Avenue | Des Moines, IA
w: 515-280-9765

www.cprinters.com&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.cprinters.com/">http://www.cprinters.com/</a></span>&gt;


COVID-19 Update

At Christian Edwards we have a comprehensive plan in place. We are focused on ensuring stability of services for our clients, as well as providing for the wellbeing of our employees. We will take action to respond to situations as they arise.  We thank you for your continued trust and wish you health and safety during this unprecedented situation.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1895412/1016193/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1016193">with headers</a>
<br />
<span class="downloadcontenttype">text/html 6.3k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1895429" href="/Public/Bug/Display.html?id=132446#txn-1895429">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;28&nbsp;18:54:05&nbsp;2020</span>
    <span class="description">PMPERRY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1895429/1016199/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1016199">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 986b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Is MyriadPro being used for the Barcode, or is it for other text being added? Do all source PDFs have fully embedded fonts, or are some expecting to see local font files? I assume that you&#39;ve carefully checked where this font is used, and whether it&#39;s embedded, and whether its use is added during the combine process.

It sounds like it would be difficult to provide a small sample case to show what&#39;s going on. If that&#39;s the case, can you try using PDF::Builder instead, and see if it behaves any differently from PDF::API2? It&#39;s worth a try if nothing else works. You can install it right alongside PDF::API2, and change your program to use PDF::Builder instead of PDF::API2.

If you can&#39;t or won&#39;t do that, but don&#39;t want to publicly provide source PDFs and code, you can contact me offline to provide the materials on a confidential basis. I can try it on both PDF::API2 and PDF::Builder. I can only test on Windows, so there&#39;s no guarantee that I can reproduce your Linux problem.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1895430" href="/Public/Bug/Display.html?id=132446#txn-1895430">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;28&nbsp;18:54:06&nbsp;2020</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1895510" href="/Public/Bug/Display.html?id=132446#txn-1895510">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;29&nbsp;08:32:39&nbsp;2020</span>
    <span class="description">mike.edwards [...] ceprinter.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #132446] Corrupt fonts</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 29 Apr 2020 12:32:25 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-PDF-API2 [...] rt.cpan.org&#34; &lt;bug-PDF-API2 [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike Edwards &lt;mike.edwards [...] ceprinter.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1895510/1016237/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1016237">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">MyriadPro is in the source PDFs but is not being injected as part of my script &#40;see attached&#41;. In looking at the properties of the source PDFs, the fonts are embedded subsets. The only font being used in the script is Helvetica-Condensed It doesn&#39;t look like PDF::Builder supports the creation of datamatrix &#40;2D&#41; barcodes, but I could be wrong.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">________________________________
From: Phil M. Perry via RT &lt;bug-PDF-API2@rt.cpan.org&gt;
Sent: Tuesday, April 28, 2020 17:54
To: Mike Edwards &lt;mike.edwards@ceprinter.com&gt;
Subject: [rt.cpan.org #132446] Corrupt fonts

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=132446">https://rt.cpan.org/Ticket/Display.html?id=132446</a></span> &gt;

Is MyriadPro being used for the Barcode, or is it for other text being added? Do all source PDFs have fully embedded fonts, or are some expecting to see local font files? I assume that you&#39;ve carefully checked where this font is used, and whether it&#39;s embedded, and whether its use is added during the combine process.

It sounds like it would be difficult to provide a small sample case to show what&#39;s going on. If that&#39;s the case, can you try using PDF::Builder instead, and see if it behaves any differently from PDF::API2? It&#39;s worth a try if nothing else works. You can install it right alongside PDF::API2, and change your program to use PDF::Builder instead of PDF::API2.

If you can&#39;t or won&#39;t do that, but don&#39;t want to publicly provide source PDFs and code, you can contact me offline to provide the materials on a confidential basis. I can try it on both PDF::API2 and PDF::Builder. I can only test on Windows, so there&#39;s no guarantee that I can reproduce your Linux problem.
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1895510/1016238/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1016238">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.5k</span>
</div>
<div class="messagebody">
</div>
</div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1895510/1016239/combine_PDFs.pl">Download combine_PDFs.pl</a><br />
<span class="downloadcontenttype">text/x-perl 12k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1895513" href="/Public/Bug/Display.html?id=132446#txn-1895513">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;29&nbsp;09:19:28&nbsp;2020</span>
    <span class="description">PMPERRY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1895513/1016241/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1016241">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Apr 29 08:32:39 2020, mike.edwards@ceprinter.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It doesn&#39;t look like PDF::Builder supports the creation of datamatrix
&gt;&#40;2D&#41; barcodes, but I could be wrong.
</div>
Neither PDF::API2 nor PDF::Builder natively support the datamatrix barcodes, but if you can use Barcode::DataMatrix with PDF::API2, it should work OK with PDF::Builder.

I took a very quick skim through Barcode::DataMatrix, and it doesn&#39;t appear to be pulling in any fonts. As you said, your code only adds Helvetica Condensed. If your code works fine on one machine, and fails on another, there must be some critical difference between the two configurations. Have you checked that your PDF::API2 is up to date &#40;not relying on some other system to keep it updated&#41;? Have you confirmed that the Myriad fonts are identical on the two systems? Have you tried PDF::Builder, just to see if it works more consistently &#40;on both systems&#41;?

One Ubuntu system is 2 years older than the other, which itself is almost 2 years old. Did PDF::API2 come with these install images, or did you install it? Have you double-checked your PDF source files to make sure they are clean as a whistle and not subtly corrupted themselves? And that the MyriadPro fonts are actually embedded and not expected to be on the Reader machine?

Your first post asked about embedding fonts. Only TrueType/OpenType fonts get embedded, as far as I can tell. And that&#39;s only when you use ttfont&#40;&#41;, not corefont&#40;&#41;. The default IS to embed the subset of glyphs used. I presume your Helvetica Condensed Type1 &#40;PS&#41; is going to require that font be present on the Reader machine.

The worst case scenario would be that some versions of PDF::API2 are subtly corrupting embedded fonts while incorporating them into a combined PDF. PDF::Builder uses very similar code, and may suffer from the same problem. I will try your code to combine some of my PDFs, but no promises that I can replicate it.

By the way, PDF::API2 supports up to PDF 1.4. Any 1.5 or up features MIGHT get corrupted -- that&#39;s been seen before. Check your input PDFs to see what version they are.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1895516" href="/Public/Bug/Display.html?id=132446#txn-1895516">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;29&nbsp;09:38:07&nbsp;2020</span>
    <span class="description">PMPERRY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1895516/1016244/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1016244">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 509b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I see that your code uses both &#34;openpage&#34; and &#34;import_page&#34; calls. Note that problems have been reported with both of those sometimes corrupting read-in PDF &#40;bugs 130722 and 130805&#41;. One of them involved already-corrupted PDFs being read in -- when you try to use a reader &#40;such as Adobe&#41; to read the source PDFs, does it ask to SAVE the PDF when you exit the reader? If so, it cleaned up some original damage to the file! Anyway, you might want to read those two bug reports and see if anything rings a bell.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1895554" href="/Public/Bug/Display.html?id=132446#txn-1895554">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;29&nbsp;13:58:40&nbsp;2020</span>
    <span class="description">mike.edwards [...] ceprinter.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #132446] Corrupt fonts</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 29 Apr 2020 17:58:29 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-PDF-API2 [...] rt.cpan.org&#34; &lt;bug-PDF-API2 [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike Edwards &lt;mike.edwards [...] ceprinter.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1895554/1016266/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1016266">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">It seems that it is less about which machine its run on. I tried the same script on the same set of PDFs two different times on the same machine and one set was corrupt and the other was fine. I did get a good working set from 27,982 source PDFs on the newer box, though. So now I&#39;m at somewhat of a loss, but let me see if I can answer your questions in order:

  1.  The version on the older box is 2.033-0 and was installed from cpan. The other box runs 2.033-1, installed from apt repo.
  2.  The fonts are identical, copied from one to the other.
  3.  I have not yet tried PDF::Builder as that would be time-consuming. If I get a chance, I will try it out though.
  4.  The module was installed as described above.
  5.  The source files are apparently clean, but I have not opened all of them. &#40;I am not prompted to save them when opening in Acrobat Pro on my Windows workstation.&#41;
  6.  The fonts are in the source PDFs as embedded subsets.
  7.  Source PDFs are all version 1.6 but do not have any form elements or anything funky.

I looked at those bug reports and they do not seem to apply here.

I appreciate your help.

Mike

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">________________________________
From: Phil M. Perry via RT &lt;bug-PDF-API2@rt.cpan.org&gt;
Sent: Wednesday, April 29, 2020 08:38
To: Mike Edwards &lt;mike.edwards@ceprinter.com&gt;
Subject: [rt.cpan.org #132446] Corrupt fonts

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=132446">https://rt.cpan.org/Ticket/Display.html?id=132446</a></span> &gt;

I see that your code uses both &#34;openpage&#34; and &#34;import_page&#34; calls. Note that problems have been reported with both of those sometimes corrupting read-in PDF &#40;bugs 130722 and 130805&#41;. One of them involved already-corrupted PDFs being read in -- when you try to use a reader &#40;such as Adobe&#41; to read the source PDFs, does it ask to SAVE the PDF when you exit the reader? If so, it cleaned up some original damage to the file! Anyway, you might want to read those two bug reports and see if anything rings a bell.
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1895554/1016267/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1016267">with headers</a>
<br />
<span class="downloadcontenttype">text/html 3k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1895586" href="/Public/Bug/Display.html?id=132446#txn-1895586">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;29&nbsp;20:22:12&nbsp;2020</span>
    <span class="description">PMPERRY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1895586/1016288/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1016288">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 926b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">If I understand you, you are not getting consistent pass or failure for given inputs on the same box? That&#39;s rather unsettling. One thing you expect computers to do is produce the same results &#40;correct or not&#41; consistently for the same inputs. I don&#39;t think I&#39;ve seen this behavior before for this software. I think that PDF::API2 still adds a timestamp to font object names &#40;PDF::Builder had that removed&#41;, but offhand I can&#39;t think of how that would cause time-varying results you&#39;re seeing.

Version 2.033 is a bit long of tooth &#40;3 years old this July&#41;. The current version is 2.037. You might want to think about updating to current, and if that doesn&#39;t cure it, giving PDF::Builder a try &#40;version 3.018 was just released&#41;. All you should have to do is change all occurrences of &#34;PDF::API2&#34; in your program to &#34;PDF::Builder&#34;, and it should work.

I hope to give your code a try soon and see if I can replicate any problem.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1895589" href="/Public/Bug/Display.html?id=132446#txn-1895589">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;29&nbsp;20:31:15&nbsp;2020</span>
    <span class="description">PMPERRY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1895589/1016291/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1016291">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 776b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Source PDFs are all version 1.6 but do not have any form elements or anything funky.
</div>
Hmm. There are lots of things that could give PDF::API2 indigestion that are not forms or anything especially funky. PDF::API2 is quite well behaved up to 1.4, but beyond that, who knows.

Perhaps you could make copies of some offending PDFs and use an editor &#40;such as ViM or Notepad++&#41; to change the version number from 1.6 to 1.4. Then try to read it into something like Acrobat, and see if there are any complaints. If not, it might really be 1.4 or lower, but if there are errors, you have a 1.5 or higher item in the PDF that PDF::API2 may be SILENTLY choking on. PDF::Builder may be a little better behaved concerning such things, and can tell you if it&#39;s unhappy about some things.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1895679" href="/Public/Bug/Display.html?id=132446#txn-1895679">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;30&nbsp;14:26:11&nbsp;2020</span>
    <span class="description">mike.edwards [...] ceprinter.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #132446] Corrupt fonts</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 30 Apr 2020 18:26:03 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-PDF-API2 [...] rt.cpan.org&#34; &lt;bug-PDF-API2 [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike Edwards &lt;mike.edwards [...] ceprinter.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1895679/1016340/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1016340">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Yeah, stupid computers.

Heh. I changed a sample PDF to 1.4 as you suggested and Acrobat did not complain at all when it opened it. I&#39;ve been doing this annual project for several years with PDF::API2 and have had a similar issue with font rendering but always worked it out--I just never documented the solution.

I ran a larger set &#40;138,615&#41; overnight last night on the newer machine, and they seemed to build OK. Unfortunately, I&#39;ve lost track of the different things I&#39;ve tried to resolve this, but maybe I&#39;m OK now and this is really a non-issue.

Thank you for lending an ear. I will try to give PDF::Builder a shot. What sets it apart?
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">________________________________
From: Phil M. Perry via RT &lt;bug-PDF-API2@rt.cpan.org&gt;
Sent: Wednesday, April 29, 2020 19:31
To: Mike Edwards &lt;mike.edwards@ceprinter.com&gt;
Subject: [rt.cpan.org #132446] Corrupt fonts

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=132446">https://rt.cpan.org/Ticket/Display.html?id=132446</a></span> &gt;

<div class="message-stanza open">&gt; Source PDFs are all version 1.6 but do not have any form elements or anything funky.
</div>
Hmm. There are lots of things that could give PDF::API2 indigestion that are not forms or anything especially funky. PDF::API2 is quite well behaved up to 1.4, but beyond that, who knows.

Perhaps you could make copies of some offending PDFs and use an editor &#40;such as ViM or Notepad++&#41; to change the version number from 1.6 to 1.4. Then try to read it into something like Acrobat, and see if there are any complaints. If not, it might really be 1.4 or lower, but if there are errors, you have a 1.5 or higher item in the PDF that PDF::API2 may be SILENTLY choking on. PDF::Builder may be a little better behaved concerning such things, and can tell you if it&#39;s unhappy about some things.
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1895679/1016341/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1016341">with headers</a>
<br />
<span class="downloadcontenttype">text/html 3.4k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1895710" href="/Public/Bug/Display.html?id=132446#txn-1895710">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;30&nbsp;17:57:31&nbsp;2020</span>
    <span class="description">PMPERRY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1895710/1016362/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1016362">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Apr 30 14:26:11 2020, mike.edwards@ceprinter.com wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Heh. I changed a sample PDF to 1.4 as you suggested and Acrobat did
&gt; not complain at all when it opened it. 
</div>So -- at least that PDF -- is probably actually PDF 1.4 and not using 1.5+ features. Most PDF-production programs just set their PDF version to the highest needed for features they support, rather than actually keeping track of features used. Nevertheless, PDF::API2 shouldn&#39;t have trouble with a PDF with &#34;too high&#34; a version number.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I ran a larger set &#40;138,615&#41; overnight last night on the newer
&gt; machine, and they seemed to build OK. 
</div>Just to avoid confusion, is this with unmodified PDFs &#40;i.e., not reset to version 1.4&#41;? So you just can&#39;t consistently reproduce the problem? This is one of those phase-of-the-Moon correlations with problems? Did you ever upgrade to PDF::API2 2.037?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thank you for lending an ear. I will try to give PDF::Builder a shot.
&gt; What sets it apart?
</div>Friends, Romans, countrymen,...

Builder is a fork of API2 &#40;about 4 years ago&#41; and has mostly the same function &#40;in fact, a superset&#41;. I&#39;ve fixed a number of open bugs, made enhancements to TIFF and PNG image handling, and just added support for HarfBuzz complex script hacking &#40;ligatures, kerning, cursive/connected scripts, RTL support&#41;. I&#39;ve made changes to handle read-in PDFs greater than version 1.4 a little better &#40;I feel&#41;. Other than that, it&#39;s still quite compatible with API2.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1896515" href="/Public/Bug/Display.html?id=132446#txn-1896515">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;04&nbsp;21:19:13&nbsp;2020</span>
    <span class="description">PMPERRY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1896515/1016725/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1016725">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 484b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Apr 30 14:26:11 2020, mike.edwards@ceprinter.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I will try to give PDF::Builder a shot.
</div>
FYI, I just added INFO/CONVERSION to PDF::Builder&#39;s GitHub repository &#40;for eventual release in 3.019&#41;, to assist if you run into any troubles trying to change over to Builder. It mostly pertains to removed deprecated functions and some minor incompatibilities in results. Still, for the most part, you should find Builder to be a superset of API2&#39;s functionality. Best wishes!
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.703607</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
