<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #28369 for Barcode-Code128: PNG image generated by test looks the same but is not identical</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #28369 for Barcode-Code128: PNG image generated by test looks the same but is not identical</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Barcode-Code128">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Barcode-Code128">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Barcode-Code128">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Barcode-Code128">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Barcode-Code128">Barcode-Code128 CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">28369</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Barcode-Code128">Barcode-Code128</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">WRW [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ANDK [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-3548-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.01    </td>
  </tr>
  <tr id="CF-3549-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Barcode-Code128-2.01-GDcompare.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/482057/238240/Barcode-Code128-2.01-GDcompare.patch">
Thu Jul 03 01:53:01 2008 (3.3k) by SREZIC [...] cpan.org
</a>
</font></li>
</ul>


code128.png<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/346468/155399/code128.png">
Wed Jul 18 18:57:35 2007 (250b) by WRW [...] cpan.org
</a>
</font></li>
</ul>


good.png<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/346465/155392/good.png">
Wed Jul 18 18:49:47 2007 (250b) by andreas.koenig.7os6VVqR [...] franz.ak.mind.de
</a>
</font></li>
</ul>


test.png<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/346465/155391/test.png">
Wed Jul 18 18:49:47 2007 (250b) by andreas.koenig.7os6VVqR [...] franz.ak.mind.de
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=28369">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-346418" href="/Public/Bug/Display.html?id=28369#txn-346418">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;18&nbsp;16:21:15&nbsp;2007</span>
    <span class="description">ANDK [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> test result negative maybe due to library skew</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/346418/155358/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/155358">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve steppe through the debugger with the png.t test. It shows that
there are minimal differences on the byte level. Probably due to
differing versions of the drawing libraries involved. This leads finally
to a failing test.

See for yourself

  DB&lt;0&gt; f blib/lib/Barcode/Code128.pm
  DB&lt;1&gt; b 521
  DB&lt;2&gt; c
ok 1
Barcode::Code128::png&#40;blib/lib/Barcode/Code128.pm:521&#41;:
521:        return $image-&gt;png&#40;&#41;;
                                                                       
          DB&lt;2&gt; r
scalar context return from Barcode::Code128::png:
&#34;ï¿½PNG\cM\cJ\cZ\cJ\c@\c@\c@\cMIHDR\c@\c@\cA&#38;\c@\c@\c@\@\cB\cC\c@\c@\c@ï¿½p2ï¿½\c@\c@\c@\cLPLTEï¿½ï¿½ï¿½ï¿½ï¿½ï¿½\c@\c@\c@ï¿½\c@\c
ï¼€Fï¿½\c@\c@\c@ï¿½IDATXï¿½ï¿½ï¿½1\cJï¿½0\cL\cEPï¿½&#41;ï¿½\cT\c]{!-&gt;BOa&lt;ï¿½\cBÝ»\cHï¿½?e%\cO%cï¿½\cEï¿½ï¿½ï¿½|ï¿½ï¿½pï¿½
 ï¿½ï¿½\cRR?POï¿½ï¿½ï¿½yï¿½\cXï¿½\cFGkn9ï¿½O`ï¿½Å˜[ï¿½\cNï¿½&#40;ï¿½Xï¿½ï¿½ï¿½jï¿½Nï¿½\cT&#41;Rï¿½Hï¿½\&#34;EêŸ©ï¿½\c_HR_Sï¿½9ï¿½\
@wE\cWÙ²/ ï¼€jï¿½[ï¿½BM,ë£ŽÚ¤ï¿½Â¤.ï¿½guï¿½ï¿½Uï¿½&gt;ï¿½ï¿½QÙ—ï¿½ï¿½eXï¿½\cNW\cT\cC}ï¿½Ø™3ï¿½\cF\cL3ï¿½ï¿½\c_ï¿½ï¿½&lt;\
c@\c@\c@\c@IENDï¿½B&#34;
main::&#40;t/png.t:30&#41;:     print &#34;not &#34; unless $test eq $good;
                                                                       
              
  DB&lt;2&gt; use Devel::Peek
  DB&lt;4&gt; Dump $test 
SV = PVMG&#40;0x86d5728&#41; at 0x83817f0
  REFCNT = 2
  FLAGS = &#40;PADMY,POK,pPOK&#41;
  IV = 0
  NV = 0
  PV = 0x86dcd80
&#34;\211PNG\r\n\32\n\0\0\0\rIHDR\0\0\1&#38;\0\0\0@\2\3\0\0\0\312p2\272\0\0\0\fPLTE\314\314\314\377\377\377\0\0\0\377\0\0\352\335\206\357\0\0\0\251IDATX\205\355\3261\n\3030\f\5P\241&#41;\364\24\35{!-&gt;BOa&lt;\365\2\335\273\10\302?e%\17%c\213\5\351\360\277\301|\342\360p\214\207\10\252\362\22R?PO\213\240\231y\263\30\356\6Gkn9\220O`\210\305\230[\316\16\367&#40;\206X\203\265\371j\344N\212\24&#41;R\244H\221\&#34;E\352\237\251\302\37HR_S\3149\201@wE\27\331\262/H*C\206j\326[\366\276BM,\353\243\216\332\244\204\302\244.\213gu\330\325U\313&gt;\260\227Q\331\227\250\317eX\245\16W\24\3}\345\330\2313\362\6\f3\262\353\37\274\311&lt;\0\0\0\0IEND\256B`\202&#34;\0
  CUR = 250
  LEN = 252

                                                                       
            DB&lt;5&gt; Dump $good
SV = PV&#40;0x86aaad0&#41; at 0x85667b8
  REFCNT = 2
  FLAGS = &#40;PADMY,POK,pPOK&#41;
  PV = 0x86d8ac0
&#34;\211PNG\r\n\32\n\0\0\0\rIHDR\0\0\1&#38;\0\0\0@\2\3\0\0\0\312p2\272\0\0\0\fPLTE\314\314\314\377\377\377\0\0\0\377\0\0\352\335\206\357\0\0\0\251IDATx\234\355\3261\n\3030\f\5P\241&#41;\364\24\35{!-&gt;BOa&lt;\365\2\335\273\10\302?e%\17%c\213\5\351\360\277\301|\342\360p\214\207\10\252\362\22R?PO\213\240\231y\263\30\356\6Gkn9\220O`\210\305\230[\316\16\367&#40;\206X\203\265\371j\344N\212\24&#41;R\244H\221\&#34;E\352\237\251\302\37HR_S\3149\201@wE\27\331\262/H*C\206j\326[\366\276BM,\353\243\216\332\244\204\302\244.\213gu\330\325U\313&gt;\260\227Q\331\227\250\317eX\245\16W\24\3}\345\330\2313\362\6\f3\262\353&lt;\206\346\200\0\0\0\0IEND\256B`\202&#34;\0
  CUR = 250
  LEN = 252




Hope this helps,
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-346437" href="/Public/Bug/Display.html?id=28369#txn-346437">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;18&nbsp;16:49:47&nbsp;2007</span>
    <span class="description">WRW [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-346438" href="/Public/Bug/Display.html?id=28369#txn-346438">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;18&nbsp;16:50:33&nbsp;2007</span>
    <span class="description">WRW [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/346438/155369/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/155369">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 137b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Please log into RT and attach the PNG file that was generated when you
ran the script, or email it to me as an attachment at wrw@cpan.org
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-346439" href="/Public/Bug/Display.html?id=28369#txn-346439">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;18&nbsp;16:50:35&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-346465" href="/Public/Bug/Display.html?id=28369#txn-346465">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;18&nbsp;18:49:47&nbsp;2007</span>
    <span class="description">andreas.koenig.7os6VVqR [...] franz.ak.mind.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> ANDK [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #28369] test result negative maybe due to library skew</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 19 Jul 2007 00:49:21 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Barcode-Code128 [...] rt.cpan.org, wrw [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> andreas.koenig.7os6VVqR [...] franz.ak.mind.de &#40;Andreas J. Koenig&#41;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/346465/155390/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/155390">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 593b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt;&gt;&gt;&gt; On Wed, 18 Jul 2007 16:50:35 -0400, &#34;William_R_Ward via RT&#34; &lt;bug-Barcode-Code128@rt.cpan.org&gt; said:
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=28369">http://rt.cpan.org/Ticket/Display.html?id=28369</a></span> &gt;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  &gt; Please log into RT and attach the PNG file that was generated when you
  &gt; ran the script, or email it to me as an attachment at wrw@cpan.org
</div>
I ran the debugger again and dumped the two variables into two files,
test.png and good.png. Appended below. Checksums:

% sha1sum /tmp/????.png 
8b0ab57230b692a2b5e02098e69967aeaefbf4ef  /tmp/good.png
490923a751110c4d475f0a972e74410b1ec9a0de  /tmp/test.png

HTH,
-- 
andreas
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/346465/155391/test.png">Download test.png</a><br />
<span class="downloadcontenttype">image/png 250b</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/346465/155392/good.png">Download good.png</a><br />
<span class="downloadcontenttype">image/png 250b</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-346468" href="/Public/Bug/Display.html?id=28369#txn-346468">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;18&nbsp;18:57:34&nbsp;2007</span>
    <span class="description">WRW [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/346468/155396/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/155396">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 74b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Attached is the code128.png file from the Barcode::Code128 &#34;t/&#34; directory.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/346468/155399/code128.png">Download code128.png</a><br />
<span class="downloadcontenttype">image/png 250b</span>
</div>
<div class="messagebody">
<img alt="code128.png" title="code128.png" src="/Ticket/Attachment/346468/155399/" /></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-346470" href="/Public/Bug/Display.html?id=28369#txn-346470">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;18&nbsp;19:00:24&nbsp;2007</span>
    <span class="description">bill [...] wards.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #28369] test result negative maybe due to library skew</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 18 Jul 2007 15:59:55 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Barcode-Code128 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Bill Ward&#34; &lt;bill [...] wards.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/346470/155401/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/155401">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is really a strange bug.  Both of these images are different from
the &#34;code128.png&#34; file in the distribution, and 20x as large in size
too!

ls -al *.png
-rw-r--r-- 1 bill www-data  250 May 28  2001 code128.png
-rw-rw-r-- 1 bill www-data 5510 Jul 18 15:54 good.png
-rw-rw-r-- 1 bill www-data 5510 Jul 18 15:54 test.png

sha1sum *.png
8b0ab57230b692a2b5e02098e69967aeaefbf4ef  code128.png
8356e73624f66df2360490043688bd4ec3215077  good.png
af102aec3670c483e53213650d07e440e57f4a4e  test.png

However I visually compared all the images and as far as I can tell
they are identical.  Should I include all three in the distribution?
Or should I abandon the idea of including a PNG sample file at all?

Can you provide more information about the specific versions of the
PNG and GD libraries in use on your system?


On 7/18/07, &#40;Andreas J. Koenig&#41; via RT &lt;bug-Barcode-Code128@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;        Queue: Barcode-Code128
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=28369">http://rt.cpan.org/Ticket/Display.html?id=28369</a></span> &gt;
&gt;
<div class="message-stanza open">&gt; &gt;&gt;&gt;&gt;&gt; On Wed, 18 Jul 2007 16:50:35 -0400, &#34;William_R_Ward via RT&#34; &lt;bug-Barcode-Code128@rt.cpan.org&gt; said:
</div>&gt;
<div class="message-stanza open">&gt;   &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=28369">http://rt.cpan.org/Ticket/Display.html?id=28369</a></span> &gt;
</div>&gt;
<div class="message-stanza open">&gt;   &gt; Please log into RT and attach the PNG file that was generated when you
&gt;   &gt; ran the script, or email it to me as an attachment at wrw@cpan.org
</div>&gt;
&gt; I ran the debugger again and dumped the two variables into two files,
&gt; test.png and good.png. Appended below. Checksums:
&gt;
&gt; % sha1sum /tmp/????.png
&gt; 8b0ab57230b692a2b5e02098e69967aeaefbf4ef  /tmp/good.png
&gt; 490923a751110c4d475f0a972e74410b1ec9a0de  /tmp/test.png
&gt;
&gt; HTH,
&gt; --
&gt; andreas
&gt;
&gt;
&gt;
&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-346529" href="/Public/Bug/Display.html?id=28369#txn-346529">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;19&nbsp;01:37:47&nbsp;2007</span>
    <span class="description">andreas.koenig.7os6VVqR [...] franz.ak.mind.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> ANDK [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #28369] test result negative maybe due to library skew</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 19 Jul 2007 07:37:13 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Barcode-Code128 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> andreas.koenig.7os6VVqR [...] franz.ak.mind.de &#40;Andreas J. Koenig&#41;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/346529/155447/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/155447">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt;&gt;&gt;&gt; On Wed, 18 Jul 2007 19:00:38 -0400, &#34;Bill Ward via RT&#34; &lt;bug-Barcode-Code128@rt.cpan.org&gt; said:
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=28369">http://rt.cpan.org/Ticket/Display.html?id=28369</a></span> &gt;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  &gt; This is really a strange bug.  Both of these images are different from
  &gt; the &#34;code128.png&#34; file in the distribution, and 20x as large in size
  &gt; too!
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  &gt; ls -al *.png
  &gt; -rw-r--r-- 1 bill www-data  250 May 28  2001 code128.png
  &gt; -rw-rw-r-- 1 bill www-data 5510 Jul 18 15:54 good.png
  &gt; -rw-rw-r-- 1 bill www-data 5510 Jul 18 15:54 test.png
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  &gt; sha1sum *.png
  &gt; 8b0ab57230b692a2b5e02098e69967aeaefbf4ef  code128.png
  &gt; 8356e73624f66df2360490043688bd4ec3215077  good.png
  &gt; af102aec3670c483e53213650d07e440e57f4a4e  test.png
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  &gt; However I visually compared all the images and as far as I can tell
  &gt; they are identical.  Should I include all three in the distribution?
  &gt; Or should I abandon the idea of including a PNG sample file at all?
</div>
Feel free to include both, it would get you a cheap quick fix. But
comparing images byte by byte will throw false errors from time to
time. So you would have to collect more and more valid examples over
time.

A better fix would be to resize them to one size, calculate the
difference, take the average color and decide about a threshold over
which this average must not go. This is quite easy with imagemagick,
don&#39;t know about other tools.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  &gt; Can you provide more information about the specific versions of the
  &gt; PNG and GD libraries in use on your system?
</div>
This may or may not be helpful to you, for me it is a jungle:

# apt-show-versions | egrep &#39;libgd|libpng&#39;
libgd2-dev 2.0.33-2 installed: No available version in archive
libgdbmg1/testing uptodate 1.7.3-28
libpng10-0 1.0.18-1 installed: No available version in archive
libgd2 2.0.33-2 installed: No available version in archive
libpng2 1.0.18-1 installed: No available version in archive
libgd-perl/stable uptodate 1.41-13
libgd-graph-perl/testing uptodate 1.43.08-2.1
libgd2-xpm-dev/testing upgradeable from 2.0.33-5.2 to 2.0.34-1
libpng12-0/testing upgradeable from 1.2.15~beta5-1 to 1.2.15~beta5-2
libpng12-dev/testing upgradeable from 1.2.15~beta5-1 to 1.2.15~beta5-2
libgdbm3/testing uptodate 1.8.3-3
libpng3/testing upgradeable from 1.2.15~beta5-1 to 1.2.15~beta5-2
libgd1-xpm/stable uptodate 1.8.4.debian-1
libgd-gd1-perl/stable uptodate 1.41-13
libgdbm-dev/testing uptodate 1.8.3-3
libgd-text-perl/testing upgradeable from 0.86-2 to 0.86-3.1
libgd2-xpm/testing upgradeable from 2.0.33-5.2 to 2.0.34-1

% /home/src/perl/repoperls/installed-perls/*/p*/perl-5.*@31623/bin/module_info GD     

Name:        GD
Version:     2.35
Directory:   /home/src/perl/repoperls/installed-perls/perl/plaxoaY/perl-5.8.0@31623/lib/site_perl/5.9.5/i686-linux-64int
File:        /home/src/perl/repoperls/installed-perls/perl/plaxoaY/perl-5.8.0@31623/lib/site_perl/5.9.5/i686-linux-64int/GD.pm
Core module: no



-- 
andreas
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-346708" href="/Public/Bug/Display.html?id=28369#txn-346708">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;19&nbsp;12:57:16&nbsp;2007</span>
    <span class="description">bill [...] wards.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #28369] test result negative maybe due to library skew</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 19 Jul 2007 09:57:00 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Barcode-Code128 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Bill Ward&#34; &lt;bill [...] wards.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/346708/155527/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/155527">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 63b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I don&#39;t think I want to introduce a dependency on ImageMagick.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-346819" href="/Public/Bug/Display.html?id=28369#txn-346819">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;20&nbsp;02:21:41&nbsp;2007</span>
    <span class="description">andreas.koenig.7os6VVqR [...] franz.ak.mind.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> ANDK [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #28369] test result negative maybe due to library skew</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 20 Jul 2007 08:21:17 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Barcode-Code128 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> andreas.koenig.7os6VVqR [...] franz.ak.mind.de &#40;Andreas J. Koenig&#41;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/346819/155602/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/155602">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt;&gt;&gt;&gt; On Thu, 19 Jul 2007 12:57:18 -0400, &#34;Bill Ward via RT&#34; &lt;bug-Barcode-Code128@rt.cpan.org&gt; said:
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=28369">http://rt.cpan.org/Ticket/Display.html?id=28369</a></span> &gt;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  &gt; I don&#39;t think I want to introduce a dependency on ImageMagick.
</div>
Of course not, this was not my suggestion. What I wanted to say
perhaps was: maybe, just maybe, this could be a way to turn the test
into something more robust. To have something more robust does not
necessarily mean that you want to force everybody to do it. Maybe you
could simply skip a modified/better test if it needs something like
IM. I just wanted to show a way out against the &#34;we&#39;re going to
collect any possible representation of an image&#34;.

Sorry if my intentions did not get through. So just to make clear what
I wanted to say, I thought of something like this:

if &#40;eval { require Image::Magick; 1; }&#41;{
   my $goodim = Image::Magick-&gt;new;
   $goodim-&gt;BlobToImage&#40;$good&#41;;
   my $testim = Image::Magick-&gt;new;
   $testim-&gt;BlobToImage&#40;$test&#41;;
   my&#40;$goodw,$goodh&#41; = $goodim-&gt;Get&#40;&#34;width&#34;,&#34;height&#34;&#41;;
   $testim-&gt;Resize&#40;geometry =&gt; sprintf&#40;&#34;%sx%s&#34;,$goodw,$goodh&#41;,filter=&gt;&#34;Triangle&#34;&#41;; # sharp
   $goodim-&gt;Composite&#40;image=&gt;$testim, compose=&gt;&#34;Difference&#34;&#41;;
   $goodim-&gt;Resize&#40;geometry =&gt; &#34;3x3&#34;, filter=&gt;&#34;Cubic&#34;&#41;; # blurred
   $goodim-&gt;Quantize&#40;colorspace=&gt;&#39;gray&#39;&#41;;
   my&#40;$red&#41; = split /,/, $goodim-&gt;Get&#40;&#34;pixel[1,1]&#34;&#41;;
   ok&#40;$red &lt;= 2, &#34;only tiny differences&#34;&#41;;
} else {
   skip&#40;1&#41;;
}

This is probably faster to write and easier to maintain in GD than in
IM because every version of IM seems to change a tiny aspect of the
interface. But it&#39;s easier to think through in IM because it is quite
expressive.

-- 
andreas
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-482057" href="/Public/Bug/Display.html?id=28369#txn-482057">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;03&nbsp;01:53:00&nbsp;2008</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/482057/238237/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/238237">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 358b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jul 20 02:21:41 2007, andreas.koenig.7os6VVqR@franz.ak.mind.de wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt;&gt;&gt;&gt;&gt; On Thu, 19 Jul 2007 12:57:18 -0400, &#34;Bill Ward via RT&#34; &lt;bug-
</div>&gt; Barcode-Code128@rt.cpan.org&gt; said:
&gt; 
&gt;   
</div>
GD has a compare method, which does not compare on a byte-by-byte level
&#40;which would fail on compression differences&#41;. See the attached patch.

Regards,
    Slaven
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/482057/238240/Barcode-Code128-2.01-GDcompare.patch">Download Barcode-Code128-2.01-GDcompare.patch</a><br />
<span class="downloadcontenttype">text/x-diff 3.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"># 
# 
# To apply this patch:
# STEP 1: Chdir to the source directory.
# STEP 2: Run the &#39;applypatch&#39; program with this patch file as input.
#
# If you do not have &#39;applypatch&#39;, it is part of the &#39;makepatch&#39; package
# that you can fetch from the Comprehensive Perl Archive Network:
# <span class="clickylink"><a target="new" rel="nofollow" href="http://www.perl.com/CPAN/authors/Johan_Vromans/makepatch-x.y.tar.gz">http://www.perl.com/CPAN/authors/Johan_Vromans/makepatch-x.y.tar.gz</a></span>
# In the above URL, &#39;x&#39; should be 2 or higher.
#
# To apply this patch without the use of &#39;applypatch&#39;:
# STEP 1: Chdir to the source directory.
# STEP 2: Run the &#39;patch&#39; program with this file as input.
#
#### End of Preamble ####

#### Patch data follows ####
diff -up &#39;/var/tmp/CPAN-build/Barcode-Code128-2.01-vpJVaY/t/png.t&#39; &#39;Barcode-Code128-2.01/t/png.t&#39;
Index: ./t/png.t
--- ./t/png.t	Mon May 28 23:42:51 2001
+++ ./t/png.t	Thu Jul  3 07:50:00 2008
@@ -19,13 +19,21 @@ exit unless $max;
 use strict;
 my $code = new Barcode::Code128;
 my $file = &#34;t/code128.png&#34;;
-my $good;
-{
-    open IM, $file or die &#34;Can&#39;t read $file: $!&#34;;
-    binmode IM;
-    read IM, $good, -s $file;
-    close IM;
-}
+my $expected_image = GD::Image-&gt;new&#40;$file&#41;;
+
 my $test = $code-&gt;png&#40;&#34;CODE 128&#34;&#41;;
-print &#34;not &#34; unless $test eq $good;
+my $got_image = GD::Image-&gt;new&#40;$test&#41;;
+
+my $cmp = $expected_image-&gt;compare&#40;$got_image&#41;;
+print &#34;not &#34; if $cmp != 0;
 print &#34;ok 2\n&#34;;
+
+if &#40;$cmp &#38; &#38;GD::GD_CMP_IMAGE&#41;       { warn &#34;The two images look different\n&#34; }
+if &#40;$cmp &#38; &#38;GD::GD_CMP_NUM_COLORS&#41;  { warn &#34;The two images have different numbers of colors\n&#34;}
+if &#40;$cmp &#38; &#38;GD::GD_CMP_COLOR&#41;       { warn &#34;The two images&#39; palettes differ\n&#34;}
+if &#40;$cmp &#38; &#38;GD::GD_CMP_SIZE_X&#41;      { warn &#34;The two images differ in the horizontal dimension\n&#34;}
+if &#40;$cmp &#38; &#38;GD::GD_CMP_SIZE_Y&#41;      { warn &#34;The two images differ in the vertical dimension\n&#34;}
+if &#40;$cmp &#38; &#38;GD::GD_CMP_TRANSPARENT&#41; { warn &#34;The two images have different transparency\n&#34;}
+if &#40;$cmp &#38; &#38;GD::GD_CMP_BACKGROUND&#41;  { warn &#34;The two images have different background colors\n&#34;}
+if &#40;$cmp &#38; &#38;GD::GD_CMP_INTERLACE&#41;   { warn &#34;The two images differ in their interlace\n&#34;}
+if &#40;$cmp &#38; &#38;GD::GD_CMP_TRUECOLOR&#41;   { warn &#34;The two images are not both true color\n&#34;}
#### End of Patch data ####

#### ApplyPatch data follows ####
# Data version        : 1.0
# Date generated      : Thu Jul  3 07:50:56 2008
# Generated by        : makepatch 2.03
# Recurse directories : Yes
# Excluded files      : &#40;\A|/&#41;.*\~\Z
#                       &#40;\A|/&#41;.*\.a\Z
#                       &#40;\A|/&#41;.*\.bak\Z
#                       &#40;\A|/&#41;.*\.BAK\Z
#                       &#40;\A|/&#41;.*\.elc\Z
#                       &#40;\A|/&#41;.*\.exe\Z
#                       &#40;\A|/&#41;.*\.gz\Z
#                       &#40;\A|/&#41;.*\.ln\Z
#                       &#40;\A|/&#41;.*\.o\Z
#                       &#40;\A|/&#41;.*\.obj\Z
#                       &#40;\A|/&#41;.*\.olb\Z
#                       &#40;\A|/&#41;.*\.old\Z
#                       &#40;\A|/&#41;.*\.orig\Z
#                       &#40;\A|/&#41;.*\.rej\Z
#                       &#40;\A|/&#41;.*\.so\Z
#                       &#40;\A|/&#41;.*\.Z\Z
#                       &#40;\A|/&#41;\.del\-.*\Z
#                       &#40;\A|/&#41;\.make\.state\Z
#                       &#40;\A|/&#41;\.nse_depinfo\Z
#                       &#40;\A|/&#41;core\Z
#                       &#40;\A|/&#41;tags\Z
#                       &#40;\A|/&#41;TAGS\Z
# p &#39;t/png.t&#39; 679 1215064200 0100755
#### End of ApplyPatch data ####

#### End of Patch kit [created: Thu Jul  3 07:50:56 2008] ####
#### Patch checksum: 68 2761 55017 ####
#### Checksum: 86 3385 41013 ####
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-482247" href="/Public/Bug/Display.html?id=28369#txn-482247">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;03&nbsp;20:39:26&nbsp;2008</span>
    <span class="description">bill [...] wards.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #28369] test result negative maybe due to library skew</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 3 Jul 2008 17:29:52 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Barcode-Code128 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Bill Ward&#34; &lt;bill [...] wards.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/482247/238346/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/238346">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 591b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, Jul 2, 2008 at 10:53 PM, Slaven_Rezic via RT
&lt;bug-Barcode-Code128@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       Queue: Barcode-Code128
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=28369">http://rt.cpan.org/Ticket/Display.html?id=28369</a></span> &gt;
&gt;
&gt; On Fri Jul 20 02:21:41 2007, andreas.koenig.7os6VVqR@franz.ak.mind.de wrote:
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt; &gt;&gt;&gt;&gt;&gt; On Thu, 19 Jul 2007 12:57:18 -0400, &#34;Bill Ward via RT&#34; &lt;bug-
</div>&gt;&gt; Barcode-Code128@rt.cpan.org&gt; said:
&gt;&gt;
&gt;&gt;
</div>&gt;
&gt; GD has a compare method, which does not compare on a byte-by-byte level
&gt; &#40;which would fail on compression differences&#41;. See the attached patch.
</div>
That&#39;s wonderful news!! Thanks.  I&#39;ll give that a try.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-531884" href="/Public/Bug/Display.html?id=28369#txn-531884">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;12&nbsp;07:26:35&nbsp;2008</span>
    <span class="description">ricmarques [...] spamcop.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ricmarques [...] spamcop.net</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/531884/266544/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/266544">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

On Wed, Jul 2, 2008, Slaven_Rezic via RT
&lt;bug-Barcode-Code128@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       Queue: Barcode-Code128
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=28369">http://rt.cpan.org/Ticket/Display.html?id=28369</a></span> &gt;
&gt;
&gt; GD has a compare method, which does not compare on a byte-by-byte
&gt; level&#40;which would fail on compression differences&#41;. See the attached
&gt; patch.
</div>

... and on Thu Jul 03 2008, bill@wards.net replied: 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; That&#39;s wonderful news!! Thanks.  I&#39;ll give that a try.
</div>

Are there any news regarding applying this patch to Barcode::Code128 ? 
I&#39;m installing Koha 3.0 - <span class="clickylink"><a target="new" rel="nofollow" href="http://www.koha.org">http://www.koha.org</a></span> - in a web server running
Linux &#40;openSUSE 11.0&#41;, and Koha requires the installation of the
Barcode::Code128 Perl module. The installation from CPAN fails as reported:

t/barcode....ok
t/gif........ok 1/0skipped
        all skipped: no reason given
t/png........FAILED test 2
        Failed 1/2 tests, 50.00% okay


I know that I could do a &#34;force install&#34; of this module, but I would
like to avoid that, if possible.

Could you give some feedback, please?

Thanks in advance.

Best wishes, 
Ricardo Dias Marques 
ricmarques AT spamcop DOT net
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-531947" href="/Public/Bug/Display.html?id=28369#txn-531947">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;12&nbsp;09:48:08&nbsp;2008</span>
    <span class="description">bill [...] wards.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #28369] test result negative maybe due to library skew</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 12 Nov 2008 06:47:53 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Barcode-Code128 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Bill Ward&#34; &lt;bill [...] wards.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/531947/266582/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/266582">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 356b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Are there any news regarding applying this patch to Barcode::Code128 ?
&gt; I&#39;m installing Koha 3.0 - <span class="clickylink"><a target="new" rel="nofollow" href="http://www.koha.org">http://www.koha.org</a></span> - in a web server running
&gt; Linux &#40;openSUSE 11.0&#41;, and Koha requires the installation of the
&gt; Barcode::Code128 Perl module. The installation from CPAN fails as reported:
&gt;
</div>
Thanks for the reminder - I will try to get this out soon.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/531947/266583/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/266583">with headers</a>
<br />
<span class="downloadcontenttype">text/html 595b</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-532194" href="/Public/Bug/Display.html?id=28369#txn-532194">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;12&nbsp;18:15:36&nbsp;2008</span>
    <span class="description">ricmarques [...] spamcop.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ricmarques [...] spamcop.net</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/532194/266767/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/266767">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 631b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Bill,

Today &#40;12-Nov-2008&#41; I had asked: 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Are there any news regarding applying this patch to 
&gt; &gt; Barcode::Code128?
&gt; &gt; I&#39;m installing Koha 3.0 - <span class="clickylink"><a target="new" rel="nofollow" href="http://www.koha.org">http://www.koha.org</a></span> - in a web server
&gt; &gt; running Linux &#40;openSUSE 11.0&#41;, and Koha requires the installation 
&gt; &gt; of the Barcode::Code128 Perl module. 
&gt; &gt; The installation from CPAN fails as reported:
</div></div>

... to which, on the same day, Bill Wards &#40;bill AT wards.net&#41;replied:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks for the reminder - I will try to get this out soon.
</div>
You&#39;re welcome. Thank you very much for the lightning fast answer!  :&#41;


Best wishes, 
Ricardo Dias Marques 
ricmarques AT spamcop DOT net
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-600408" href="/Public/Bug/Display.html?id=28369#txn-600408">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;04&nbsp;14:44:37&nbsp;2009</span>
    <span class="description">WRW [...] cpan.org -  Subject changed from &#39;test result negative maybe due to library skew&#39; to &#39;PNG image generated by test looks the same but is not identical&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1134428" href="/Public/Bug/Display.html?id=28369#txn-1134428">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;29&nbsp;23:21:47&nbsp;2012</span>
    <span class="description">WRW [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1134428/596970/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/596970">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 23b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">should be fixed in 2.21
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1134430" href="/Public/Bug/Display.html?id=28369#txn-1134430">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;29&nbsp;23:21:48&nbsp;2012</span>
    <span class="description">WRW [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.968811</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
