<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #54182 for Curses-UI: [Curses::UI] problems with diacritics &#40;UTF-8&#41; - cursor moves ahead 2 times faster</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #54182 for Curses-UI: [Curses::UI] problems with diacritics &#40;UTF-8&#41; - cursor moves ahead 2 times faster</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Curses-UI/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Curses-UI/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Curses-UI/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Curses-UI/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Curses-UI">Curses-UI CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">54182</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Curses-UI/Active/">Curses-UI</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
harvie [...] email.cz

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-8800-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.9607    </td>
  </tr>
  <tr id="CF-8801-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




curses.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/727357/375647/curses.pl">
Mon Feb 01 06:22:00 2010 (4.2k) by http://harvie.id.email.cz/
</a>
</font></li>
</ul>


terminal-curses-ui.png<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/727357/375646/terminal-curses-ui.png">
Mon Feb 01 06:22:00 2010 (30.6k) by http://harvie.id.email.cz/
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;01&nbsp;06:22:00&nbsp;2010</span>
    <span class="description">http://harvie.id.email.cz/ -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [Curses::UI] problems with diacritics &#40;UTF-8&#41; - cursor moves
 ahead 2 times faster</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">For example in TextEditor &#40;i believe it is not only issue in TextEditor&#41; 
when i try to type characters like &#34;ěščřžýáíé&#34;, all characters appears 
like they are supposed to, but cursor moves 2 characters ahead with each 
single character i type and there is some &#34;space&#34; for each character at 
the end of the line. i have to hit backspace 2x to delete such character 
&#40;first time it deletes the space and then it deletes the character 
itself&#41;. when i delete the character from left &#40;character and then the 
space&#41; it transforms to another character until i remove the rest.

this is very misleading and it makes editing text with &#34;diacritics&#34; 
almost impossible.


BTW when i add exact same characters directly from code, everything is 
rendered OK until i try to edit or delete it &#40;but isn&#39;t text editor 
supposed to edit?&#41;:

my $texteditor = $win1-&gt;add&#40;&#34;text&#34;, &#34;TextEditor&#34;,
  -text =&gt; &#34;Here is some text ěščřžýáíé\n&#34;
  . &#34;And some more&#34;&#41;;

i have attached code and screenshot
&#40;on screenshot you can see what i have actually typed and where is the 
cursor located&#41;
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> terminal-curses-ui.png</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/727357/375646/terminal-curses-ui.png">Download terminal-curses-ui.png</a><br />
<span class="downloadcontenttype">image/png 30.6k</span>
</div>
<div class="messagebody">
<img alt="terminal-curses-ui.png" title="terminal-curses-ui.png" src="/Ticket/Attachment/727357/375646/" /></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> curses.pl</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/env perl
#pacman -S perl-curses-ui

use strict;
use warnings;
use Curses::UI;

#use I18N::Collate;
#setlocale&#40;&#39;LC_COLLATE&#39;, &#39;cs_CZ.utf8&#39;&#41;;
#use utf8;
#use encoding;

#binmode&#40;STDOUT, &#34;:crlf&#34;&#41;;
#binmode&#40;STDIN, &#34;:crlf&#34;&#41;;

binmode&#40;STDOUT, &#34;:encoding&#40;utf8&#41;&#34;&#41;;
binmode&#40;STDIN, &#34;:encoding&#40;utf8&#41;&#34;&#41;;




my $cui = new Curses::UI&#40; -color_support =&gt; 1, -compat =&gt; 0 &#41;;

#Create a menu ^

        my @menu = &#40;
          { -label =&gt; &#39;File&#39;, 
            -submenu =&gt; [
           { -label =&gt; &#39;Exit      ^Q&#39;, -value =&gt; \&#38;exit_dialog  }
                        ]
           },
        &#41;;

#In order to describe the structure of a menu Curses::UI uses a rather ugly construct out of hash and arrayrefs. See Curses::UI::Menubar for details. What you do at this point is to create a Menubar with just one entry and one submenu. The entry is &#39;File&#39; and the submenu is &#39;Exit&#39;. The value of this menu item is a reference to a sub called exit_dialog.
#Dialogs ^

        sub exit_dialog&#40;&#41;
        {
                my $return = $cui-&gt;dialog&#40;
                        -message   =&gt; &#34;Do you really want to quit?&#34;,
                        -title     =&gt; &#34;Are you sure???&#34;, 
                        -buttons   =&gt; [&#39;yes&#39;, &#39;no&#39;],

                &#41;;

        				exit&#40;0&#41; if $return;
        }

#The dialog method of Curses::UI gives us an easy and convenient way to create dialogs on the main screen. A dialog is a way to interact with the user in order to ask him a question or give him important information. This dialog is a more complex one, which asks the question whether or not you really want to exit. As the button for &#34;yes&#34; would return us a true value, you can easily exit on this return value.
#Add the Menubar ^

        my $menu = $cui-&gt;add&#40;
                &#39;menu&#39;,&#39;Menubar&#39;, 
                -menu =&gt; \@menu,
                -fg  =&gt; &#34;blue&#34;,
        &#41;;

#To finally add the Menubar to our root object, you have to call the add method on the Curses UI object. You specify the internal name of the widget as the first argument, the widget type as the second argument &#40;like Label, TextViewer, etc.&#41; and the menu structure you created at the beginning as an array reference as third object. Because you want the Menubar to have a blue theme, you give him the -fg option &#34;blue&#34;. There are a couple of colors you can use, see Curses::UI::Color for details.
#Add a window ^

        my $win1 = $cui-&gt;add&#40;
                             &#39;win1&#39;, &#39;Window&#39;,
                             -border =&gt; 1,
                             -y    =&gt; 1,
                             -bfg  =&gt; &#39;red&#39;,
                     &#41;;

#There are only two types of object you can add to the Curses::UI root object: Menubars and Windows. All other widgets have to be inserted into a window. Of course you can add a Menubar to a window, but not vice versa ;-&#41;. The add method always has the same two first arguments: the internal name and the widget type. The internal name can be used to find an object. The method getobj takes this name and returns us the corresponding object out of the hierarchy. See Curses::UI for details. Again you want some fancy colors, so you tell the window to have a border, leave some space for the Menubar &#40;-y =&gt; 1&#41; and set the border foreground color to red.
#Add a widget ^

        my $texteditor = $win1-&gt;add&#40;&#34;text&#34;, &#34;TextEditor&#34;,
                                 -text =&gt; &#34;Here is some text ÄÅ¡ÄÅÅ¾Ã½Ã¡Ã­Ã©\n&#34;
                                        . &#34;And some more&#34;&#41;;

#The next step is to add a useful widget to our new small Curses::UI app. Here you take a TextEditor widget which performs basic tasks as a text editor. You add some initial text to the widget to make it not seem that empty.
#Making keybindings ^

        $cui-&gt;set_binding&#40;sub {$menu-&gt;focus&#40;&#41;}, &#34;\cX&#34;&#41;;
        $cui-&gt;set_binding&#40; \&#38;exit_dialog , &#34;\cQ&#34;&#41;;

#You want to be able to focus the Menubar if you finished editing in the TextEditor widget. Therefore you set a binding to the focus function of the menu and the key sequence Control &#40;specified by \c&#41; combined with X. Now you can easily return to the menu after editing. Because it is easier to have a shortcut for closing the application you add a binding for the sequence Control-Q to our nice exit_dialog method.
#The final steps ^

        $texteditor-&gt;focus&#40;&#41;;
        $cui-&gt;mainloop&#40;&#41;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;31&nbsp;13:28:37&nbsp;2011</span>
    <span class="description">GDM [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

Please try to apply my patch from
<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=56695">https://rt.cpan.org/Ticket/Display.html?id=56695</a></span>

Then specify -utf8 switch and test this issue.

The problem should be fixed.

Kind regards,
Dmytro Gorbunov
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;31&nbsp;13:28:38&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
