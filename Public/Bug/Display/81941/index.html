<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #81941 for Net-DNS: bgsend/bgread does not work correctly with long DNSKEY replys</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #81941 for Net-DNS: bgsend/bgread does not work correctly with long DNSKEY replys</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Net-DNS">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Net-DNS">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Net-DNS">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Net-DNS">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-DNS">Net-DNS CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">81941</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Net-DNS">Net-DNS</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dhyan [...] nataraj.su

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-22454-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-22455-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=81941">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1154640" href="/Public/Bug/Display.html?id=81941#txn-1154640">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;13&nbsp;08:31:21&nbsp;2012</span>
    <span class="description">dhyan [...] nataraj.su -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> bgsend/bgread does not work correctly with long DNSKEY replys</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 13 Dec 2012 17:28:14 +0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-DNS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Nikolay Shaplov &lt;dhyan [...] nataraj.su&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1154640/607250/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/607250">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">It seems to me that I&#39;ve found a bug with background request when used with 
massive DNSSEC data.

It does not returns all records that were replayed by server.

For now in org zone there are four DNSKEYs, if they finished a rotation change 
an example to a zone that has four keys in it.

=========
my $server = &#39;a0.org.afilias-nst.info&#39;;
my $host = &#39;org&#39;;

while &#40;1&#41;
{
  print scalar&#40;dig_normal&#40;&#41;&#41;,&#34;\t&#34;, scalar&#40;dig_bg&#40;&#41;&#41;,&#34;\n&#34;;
}

sub dig_normal
{
  my $res = Net::DNS::Resolver-&gt;new&#40;nameservers=&gt;[$server], usevc=&gt;0&#41;;
  my $packet = $res-&gt;send&#40;$host,&#39;DNSKEY&#39;&#41;;
  return $packet-&gt;answer;
}

sub dig_bg
{
  my $res = Net::DNS::Resolver-&gt;new&#40;nameservers=&gt;[$server]&#41;;
  my $req = $res-&gt;bgsend&#40;$host,&#39;DNSKEY&#39;&#41;;

  my $count =0;
  my $packet;
  while &#40;$count++&lt;10&#41;
  {
    if &#40;$res-&gt;bgisready&#40;$req&#41;&#41;
    {
      $packet = $res-&gt;bgread&#40;$req&#41;;
      last;
    }
    sleep 1;
  }
  return $packet-&gt;answer;
}

For me this example prints

4       1
4       1
4       0
4       2
4       0
4       2
4       2
4       1
4       2
4       1
4       2
4       0

The first number is a number of DNSKEY records obtained by normal request, and 
a second one is number of records returned by background request. Adding a 
sleep before bgread does not help.

I am using last version of IO and last stable version of Net::DNS.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1154837" href="/Public/Bug/Display.html?id=81941#txn-1154837">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;13&nbsp;21:02:23&nbsp;2012</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1154837/607351/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/607351">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 770b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Net::DNS is working as expected. The response to your query is larger
than the DNS default packet size, and is being truncated at the nameserver.


The &#34;normal&#34; query fails at the initial attempt using UDP, then falls
back on TCP to obtain the full response &#40;length 869 for your example&#41;.

It is not possible to restrict send&#40;&#41; to use UDP by setting usevc=&gt;0.


Using bgsend&#40;&#41; uses UDP only, with no fall back to TCP.

The packet is truncated by the server, which removes records to make the
response no larger than 512.

The number of RRs varies because the full response contains 4 RRs with
two different sizes, which appear in no particular order.

Use of large UDP packets is only possible by using EDNS&#40;0&#41; to negotiate
the extended UDP packet size for each server.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1154840" href="/Public/Bug/Display.html?id=81941#txn-1154840">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;13&nbsp;21:02:25&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1155060" href="/Public/Bug/Display.html?id=81941#txn-1155060">#</a>      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;14&nbsp;03:56:19&nbsp;2012</span>
    <span class="description">dhyan [...] nataraj.su -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #81941] bgsend/bgread does not work correctly with long DNSKEY replys</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 14 Dec 2012 12:53:21 +0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-DNS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Nikolay Shaplov &lt;dhyan [...] nataraj.su&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1155060/607466/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/607466">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Net::DNS is working as expected. The response to your query is larger
&gt; than the DNS default packet size, and is being truncated at the nameserver.
&gt; 
&gt; 
&gt; The &#34;normal&#34; query fails at the initial attempt using UDP, then falls
&gt; back on TCP to obtain the full response &#40;length 869 for your example&#41;.
&gt; 
&gt; It is not possible to restrict send&#40;&#41; to use UDP by setting usevc=&gt;0.
&gt; 
&gt; 
&gt; Using bgsend&#40;&#41; uses UDP only, with no fall back to TCP.
&gt; 
&gt; The packet is truncated by the server, which removes records to make the
&gt; response no larger than 512.
&gt; 
&gt; The number of RRs varies because the full response contains 4 RRs with
&gt; two different sizes, which appear in no particular order.
&gt; 
&gt; Use of large UDP packets is only possible by using EDNS&#40;0&#41; to negotiate
&gt; the extended UDP packet size for each server.
</div>
Ah! I see!

Then may be it would be good to cover this issue right in manual, in the 
description of bgread function or something. That would help less experienced 
developers &#40;like me for example&#41; to handle $packet-&gt;header-&gt;tc==1 situation 
just from the beginning, and not when they accidentally find a huge response 
packet. This would also prevent developers from explaining and closing stupid 
bugs :-&#41;

Thanks!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1155120" href="/Public/Bug/Display.html?id=81941#txn-1155120">#</a>      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;14&nbsp;07:01:10&nbsp;2012</span>
    <span class="description">NLNETLABS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1155120/607501/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/607501">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 428b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri 14 Dec 2012 03:56:19, dhyan@nataraj.su wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Then may be it would be good to cover this issue right in manual, in
&gt; the description of bgread function or something.
</div>

In Net::DNS::Resolver at the end of bgsend it says:

       bgsend does not support the usevc option &#40;TCP&#41;.

Shall I extent the line with &#34;Beware that truncated packets will not be
retried over TCP automatically and should be handled by the caller.&#34;?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1155878" href="/Public/Bug/Display.html?id=81941#txn-1155878">#</a>      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;16&nbsp;11:42:14&nbsp;2012</span>
    <span class="description">NLNETLABS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1155878/607924/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/607924">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 305b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri 14 Dec 2012 07:01:10, NLNETLABS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Shall I extent the line with &#34;Beware that truncated packets will not be
&gt; retried over TCP automatically and should be handled by the caller.&#34;?
</div>
I have applied this in trunk. If you have a better suggestion you can
reopen the ticket by replying.

-- Willem
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1155881" href="/Public/Bug/Display.html?id=81941#txn-1155881">#</a>      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;16&nbsp;11:42:15&nbsp;2012</span>
    <span class="description">NLNETLABS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1156143" href="/Public/Bug/Display.html?id=81941#txn-1156143">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;17&nbsp;03:21:24&nbsp;2012</span>
    <span class="description">dhyan [...] nataraj.su -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #81941] bgsend/bgread does not work correctly with long DNSKEY replys</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 17 Dec 2012 12:18:17 +0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-DNS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Nikolay Shaplov &lt;dhyan [...] nataraj.su&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1156143/608065/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/608065">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=81941">https://rt.cpan.org/Ticket/Display.html?id=81941</a></span> &gt;
&gt; 
&gt; On Fri 14 Dec 2012 07:01:10, NLNETLABS wrote:
<div class="message-stanza open">&gt; &gt; Shall I extent the line with &#34;Beware that truncated packets will not be
&gt; &gt; retried over TCP automatically and should be handled by the caller.&#34;?
</div>&gt; 
&gt; I have applied this in trunk. If you have a better suggestion you can
&gt; reopen the ticket by replying.
</div>
I think it would be good to add to examples of bgread and bgready code

if &#40;$packet-&gt;header-&gt;tc&#41; 
{
  warn &#40;or even die&#41; &#34;The answer were too big to fit in UDP packet and were 
truncated by server&#34;;
}

so developer would be informed that he _SHOULD_ manually control the 
consistency of the answer in this case

And the text should be something like this:

NOTE: bgread tool uses only UDP protocol to receive the answer, so big answers 
would be truncated due to UDP packet size limitations. Since there is no 
possibility to fallback to TCP request, as non-background read method do, 
developer should manually check truncated flag &#40;$packet-&gt;head-&gt;tc&#41; and properly 
handle the situation with incomplete data: throw an exception or repeat the 
request over TCP.

I am not very good in writing English. But such note wold help me better 
understand the situation, than the phrase you offered. &#40;Some people that uses 
Net::DNS might be not so good in knowing DNS internals and it is good to 
explain them some issues in places where it can directly effect the bugness  of 
the code&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1156145" href="/Public/Bug/Display.html?id=81941#txn-1156145">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;17&nbsp;03:21:25&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1156660" href="/Public/Bug/Display.html?id=81941#txn-1156660">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;18&nbsp;09:35:50&nbsp;2012</span>
    <span class="description">NLNETLABS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1156660/608296/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/608296">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 206b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks! The example code is an excellent idea! The note is a bit
excessive tough. Too much focus on the corner cases is distracting and I
believe the example code and &#34;Beware&#34; line make it explicit enough.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1156663" href="/Public/Bug/Display.html?id=81941#txn-1156663">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;18&nbsp;09:35:52&nbsp;2012</span>
    <span class="description">NLNETLABS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1157017" href="/Public/Bug/Display.html?id=81941#txn-1157017">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;19&nbsp;04:25:05&nbsp;2012</span>
    <span class="description">dhyan [...] nataraj.su -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #81941] bgsend/bgread does not work correctly with long DNSKEY replys</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 19 Dec 2012 13:22:04 +0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-DNS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Nikolay Shaplov &lt;dhyan [...] nataraj.su&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1157017/608468/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/608468">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 691b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; Shall I extent the line with &#34;Beware that truncated packets will not be
&gt;&gt; retried over TCP automatically and should be handled by the caller.&#34;?
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks! The example code is an excellent idea! The note is a bit
&gt; excessive tough. Too much focus on the corner cases is distracting and I
&gt; believe the example code and &#34;Beware&#34; line make it explicit enough.
</div>
This beware sentence does not have information that response can be truncated 
as an expected result, not as a result of some server, network or other 
errors. That is why I mentioned  UDP packet size. I think developer should be 
warned that this truncation is common thing in this routine and _should_ be 
properly processed.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1157019" href="/Public/Bug/Display.html?id=81941#txn-1157019">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;19&nbsp;04:25:06&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1157044" href="/Public/Bug/Display.html?id=81941#txn-1157044">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;19&nbsp;05:27:56&nbsp;2012</span>
    <span class="description">NLNETLABS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1157044/608476/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/608476">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 913b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Nikolay,

On Wed 19 Dec 2012 04:25:05, dhyan@nataraj.su wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This beware sentence does not have information that response can be
&gt; truncated
&gt; as an expected result, not as a result of some server, network or
&gt; other
&gt; errors. That is why I mentioned  UDP packet size. I think developer
&gt; should be
&gt; warned that this truncation is common thing in this routine and
&gt; _should_ be
&gt; properly processed.
</div>
Truncation is a common thing in DNS whatsoever and is not specific to
these bg* methods, but I appreciate that awareness should be stimulated
at this point though. How about this as the last paragraph?:

       *BEWARE*:
       bgsend does not support the usevc option &#40;TCP&#41; and operates on
       UDP only; Answers may not fit in an UDP packet and might be
       truncated.  Truncated packets will *not* be retried over TCP
       automatically and should be handled by the caller.

Regards,

-- Willem
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1157047" href="/Public/Bug/Display.html?id=81941#txn-1157047">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;19&nbsp;05:41:26&nbsp;2012</span>
    <span class="description">NLNETLABS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1157055" href="/Public/Bug/Display.html?id=81941#txn-1157055">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;19&nbsp;06:30:48&nbsp;2012</span>
    <span class="description">dhyan [...] nataraj.su -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #81941] bgsend/bgread does not work correctly with long DNSKEY replys</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 19 Dec 2012 15:27:50 +0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-DNS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Nikolay Shaplov &lt;dhyan [...] nataraj.su&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1157055/608483/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/608483">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=81941">https://rt.cpan.org/Ticket/Display.html?id=81941</a></span> &gt;
&gt; 
&gt; Hi Nikolay,
&gt; 
&gt; On Wed 19 Dec 2012 04:25:05, dhyan@nataraj.su wrote:
<div class="message-stanza open">&gt; &gt; This beware sentence does not have information that response can be
&gt; &gt; truncated
&gt; &gt; as an expected result, not as a result of some server, network or
&gt; &gt; other
&gt; &gt; errors. That is why I mentioned  UDP packet size. I think developer
&gt; &gt; should be
&gt; &gt; warned that this truncation is common thing in this routine and
&gt; &gt; _should_ be
&gt; &gt; properly processed.
</div>&gt; 
&gt; Truncation is a common thing in DNS whatsoever and is not specific to
&gt; these bg* methods, but I appreciate that awareness should be stimulated
&gt; at this point though. How about this as the last paragraph?:
&gt; 
&gt;        *BEWARE*:
&gt;        bgsend does not support the usevc option &#40;TCP&#41; and operates on
&gt;        UDP only; Answers may not fit in an UDP packet and might be
&gt;        truncated.  Truncated packets will *not* be retried over TCP
&gt;        automatically and should be handled by the caller.
</div>Yeah. This is is good in my opinion! 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1157057" href="/Public/Bug/Display.html?id=81941#txn-1157057">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;19&nbsp;06:30:49&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1287504" href="/Public/Bug/Display.html?id=81941#txn-1287504">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;13&nbsp;09:46:59&nbsp;2013</span>
    <span class="description">NLNETLABS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.654704</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
