<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #120066 for XML-Compile: Add &#34;json_friendly&#34; option</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #120066 for XML-Compile: Add &#34;json_friendly&#34; option</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/XML-Compile/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/XML-Compile/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/XML-Compile/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/XML-Compile/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/XML-Compile">XML-Compile CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">120066</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/XML-Compile/Active/">XML-Compile</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
SREZIC [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-40392-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.54    </td>
  </tr>
  <tr id="CF-40393-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.55    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;01&nbsp;12:20:32&nbsp;2017</span>
    <span class="description">SREZIC [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Add &#34;json_friendly&#34; option</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">It would be nice if it was possible to use XML::Compile for a &#34;perfect&#34; XML-to-json converter. 
In the current implementation some things are missing, e.g. the generated perl data structure does not know anything about booleans, so converting further to json looses this information. Also, some of the numeric XML values end up as strings in the json data structure.

I created a patch with a new &#34;json_friendly&#34; option which fixes some of the issues. The patch can be found at &lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/eserte/XML-Compile.forked/commit/7a14f041eff49df7419e0f67069f0d6e100a22c0">https://github.com/eserte/XML-Compile.forked/commit/7a14f041eff49df7419e0f67069f0d6e100a22c0</a></span>&gt;

An overview of the changes:

    * add new option json_friendly
    * add two new builtin types:
      * boolean_with_Types_Serialiser is like boolean, but generates
        Types::Serialiser::Boolean values which seem to be understood
        by common json serializers &#40;tried JSON::PP, JSON::XS, and
        Cpanel::JSON::XS&#41;
      * sloppy_float_force_NV is like sloppy_float, but makes sure
        that the value is numified. This means trailing zeroes and a
        trailing dot got lost, which would break tests like 55facet.t
        &#40;that&#39;s why I made another type&#41;
    * a change to bigint&#40;&#41;: the value is always numified. This does
      not break any test.
    * a new test t/92json.t, using the mentioned json serializers
    * no attempt was done for checking the other direction &#40;i.e. json
      deserialization and xml writing&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;01&nbsp;15:58:16&nbsp;2017</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #120066] Add &#34;json_friendly&#34; option</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 1 Feb 2017 21:39:36 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Slaven_Rezic via RT &lt;bug-XML-Compile [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Slaven_Rezic via RT &#40;bug-XML-Compile@rt.cpan.org&#41; [170201 17:20]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Wed Feb 01 12:20:32 2017: Request 120066 was acted upon.
&gt; Transaction: Ticket created by SREZIC
&gt;        Queue: XML-Compile
&gt;      Subject: Add &#34;json_friendly&#34; option
&gt;    Broken in: 1.54
&gt;     Severity: Wishlist
&gt; 
&gt; It would be nice if it was possible to use XML::Compile for a &#34;perfect&#34; XML-to-json converter. 
&gt; In the current implementation some things are missing, e.g. the
&gt; generated perl data structure does not know anything about booleans,
</div>
Of course, because Perl has no types: it an XML&lt;-&gt;Perl translator.  But I am
not against some level of abuse ;-&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; An overview of the changes:
&gt;     * add new option json_friendly
</div>
Couldn&#39;t that be &#39;typed_booleans&#39;, for instance?  Other people wanted to
know which values where actually booleans as well.  It is not limited to
JSON.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;     * add two new builtin types:
&gt;       * boolean_with_Types_Serialiser is like boolean, but generates
&gt;         Types::Serialiser::Boolean values which seem to be understood
&gt;         by common json serializers &#40;tried JSON::PP, JSON::XS, and
&gt;         Cpanel::JSON::XS&#41;
</div>
Ugly class name.  Why is it so badly named?  Being boolean has nothing to
do with the serialization.  And I would like to avoid an additional
dependency.  But probably we have no other option :&#40;

It works because of this:
   *Types::Serialiser::Boolean:: = *JSON::PP::Boolean::;

It&#39;s a pity that JSON::PP::Boolean itself is not overloaded.

This looks somewhat complicated:

  + while&#40;my&#40;$key, $val&#41; = each %{$builtin_types{boolean}}&#41;
  +{
  +    $builtin_types{boolean_with_Types_Serialiser}-&gt;{$key} =
  +    $key eq &#39;parse&#39;
  +         ? sub { no warnings &#39;once&#39;;
  +             $_[0] =~ m/^\s*&#40;false|0&#41;\s*/i
  +             ? $Types::Serialiser::false
  +             : $Types::Serialiser::true }
  +             : $val;
  +}

Why not simply:

  $builtin_types{boolean_with_Types_Serialiser} =
     { %{$builtin_types{boolean}}, 
     , parse =&gt; sub {
          no warnings &#39;once&#39;;
            $_[0] =~ m/^\s*&#40;false|0&#41;\s*/i
          ? $Types::Serialiser::false
          : $Types::Serialiser::true 
     };

It&#39;s a pity there is no

    $Type::Serialiser::bool&#40;$_[0] =~ m/^\s*&#40;false|0&#41;\s*/i&#41;;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       * sloppy_float_force_NV is like sloppy_float, but makes sure
&gt;         that the value is numified. This means trailing zeroes and a
&gt;         trailing dot got lost, which would break tests like 55facet.t
&gt;         &#40;that&#39;s why I made another type&#41;
</div>
Is it really bad to have fail that test?  &#40;Which test is it?&#41;
It might be a good idea to fix the sloppy_float handler to numify: the
user expects a float &#40;not a string&#41; and it is &#34;sloppy&#34; anyway ;-&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;     * a change to bigint&#40;&#41;: the value is always numified. This does
&gt;       not break any test.
</div>
That&#39;s a correct fix.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;     * a new test t/92json.t, using the mentioned json serializers
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;     * no attempt was done for checking the other direction &#40;i.e. json
&gt;       deserialization and xml writing&#41;
</div>
The XML schema already describes what the types are, so there should not be
a problem... &#40;I may need to change some ref&#39;s into reftype&#41;

-- 
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;01&nbsp;15:58:17&nbsp;2017</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;02&nbsp;05:03:26&nbsp;2017</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> Mark [...] Overmeer.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2017-02-01 15:58:16, Mark@Overmeer.net wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; * Slaven_Rezic via RT &#40;bug-XML-Compile@rt.cpan.org&#41; [170201 17:20]:
<div class="message-stanza open">&gt; &gt; Wed Feb 01 12:20:32 2017: Request 120066 was acted upon.
&gt; &gt; Transaction: Ticket created by SREZIC
&gt; &gt;        Queue: XML-Compile
&gt; &gt;      Subject: Add &#34;json_friendly&#34; option
&gt; &gt;    Broken in: 1.54
&gt; &gt;     Severity: Wishlist
&gt; &gt;
&gt; &gt; It would be nice if it was possible to use XML::Compile for a
&gt; &gt; &#34;perfect&#34; XML-to-json converter.
&gt; &gt; In the current implementation some things are missing, e.g. the
&gt; &gt; generated perl data structure does not know anything about booleans,
</div>&gt; 
&gt; Of course, because Perl has no types: it an XML&lt;-&gt;Perl translator.
&gt; But I am
&gt; not against some level of abuse ;-&#41;
&gt; 
<div class="message-stanza open">&gt; &gt; An overview of the changes:
&gt; &gt;     * add new option json_friendly
</div>&gt; 
&gt; Couldn&#39;t that be &#39;typed_booleans&#39;, for instance?  Other people wanted
&gt; to
&gt; know which values where actually booleans as well.  It is not limited
&gt; to
&gt; JSON.
</div>
There are also other attempts to get booleans into perl, but differently implemented. For example, there&#39;s boolean.pm, but it has no seamless integration with the JSON modules:

    $ perl -Mstrict -Mboolean -MJSON::MaybeXS -E &#39;say encode_json&#40;[true, false]&#41;;&#39;
    encountered object &#39;1&#39;, but neither allow_blessed, convert_blessed nor allow_tags settings are enabled &#40;or TO_JSON/FREEZE method missing&#41; at -e line 1.

The boolean.pm documentation suggests to use the &#34;convert_blessed&#34; option:

    $ perl -Mstrict -Mboolean -MJSON::MaybeXS -E &#39;say JSON::MaybeXS-&gt;new-&gt;convert_blessed-&gt;encode&#40;[true, false]&#41;;&#39;                                                                        
    [true,false]

In contrast, nothing special has to be done if using the special boolean types provided by the JSON modules or Types::Serialiser:

    $ perl -Mstrict -MJSON::MaybeXS -E &#39;say encode_json&#40;[JSON-&gt;true, JSON-&gt;false]&#41;;&#39; 
    [true,false]
    $ perl -Mstrict -MTypes::Serialiser -MJSON::MaybeXS -E &#39;say encode_json&#40;[$Types::Serialiser::true, $Types::Serialiser::false]&#41;;&#39;
    [true,false]

There&#39;s also a &#34;Bool&#34; in the Moose type system, but it seems that this is only about validation; there&#39;s no special class attached to such a value.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; * add two new builtin types:
&gt; &gt;   * boolean_with_Types_Serialiser is like boolean, but generates
&gt; &gt;     Types::Serialiser::Boolean values which seem to be understood
&gt; &gt;     by common json serializers &#40;tried JSON::PP, JSON::XS, and
&gt; &gt;     Cpanel::JSON::XS&#41;
</div>&gt; 
&gt; Ugly class name.  Why is it so badly named?  Being boolean has nothing
&gt; to
&gt; do with the serialization.  And I would like to avoid an additional
&gt; dependency.  But probably we have no other option :&#40;
&gt; 
&gt; It works because of this:
&gt;    *Types::Serialiser::Boolean:: = *JSON::PP::Boolean::;
&gt; 
&gt; It&#39;s a pity that JSON::PP::Boolean itself is not overloaded.
&gt; 
&gt; This looks somewhat complicated:
&gt; 
&gt; + while&#40;my&#40;$key, $val&#41; = each %{$builtin_types{boolean}}&#41;
&gt; +{
&gt; +    $builtin_types{boolean_with_Types_Serialiser}-&gt;{$key} =
&gt; +    $key eq &#39;parse&#39;
&gt; +         ? sub { no warnings &#39;once&#39;;
&gt; +             $_[0] =~ m/^\s*&#40;false|0&#41;\s*/i
&gt; +             ? $Types::Serialiser::false
&gt; +             : $Types::Serialiser::true }
&gt; +             : $val;
&gt; +}
&gt; 
&gt; Why not simply:
&gt; 
&gt; $builtin_types{boolean_with_Types_Serialiser} =
&gt;     { %{$builtin_types{boolean}},
&gt;    , parse =&gt; sub {
&gt;         no warnings &#39;once&#39;;
&gt;           $_[0] =~ m/^\s*&#40;false|0&#41;\s*/i
&gt;         ? $Types::Serialiser::false
&gt;          : $Types::Serialiser::true
&gt;    };
&gt; 
</div>
Yes, looks simpler.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It&#39;s a pity there is no
&gt; 
&gt; $Type::Serialiser::bool&#40;$_[0] =~ m/^\s*&#40;false|0&#41;\s*/i&#41;;
&gt; 
<div class="message-stanza open">&gt; &gt; * sloppy_float_force_NV is like sloppy_float, but makes sure
&gt; &gt;   that the value is numified. This means trailing zeroes and a
&gt; &gt;   trailing dot got lost, which would break tests like 55facet.t
&gt; &gt;   &#40;that&#39;s why I made another type&#41;
</div>&gt; 
&gt; Is it really bad to have fail that test?  &#40;Which test is it?&#41;
&gt; It might be a good idea to fix the sloppy_float handler to numify: the
&gt; user expects a float &#40;not a string&#41; and it is &#34;sloppy&#34; anyway ;-&#41;
</div>
I think it was the following three:

test_rw&#40;$schema, test12 =&gt; &#39;&lt;test12&gt;1.10&lt;/test12&gt;&#39;, &#39;1.10&#39;&#41;;
test_rw&#40;$schema, test12 =&gt; &#39;&lt;test12&gt;1.00&lt;/test12&gt;&#39;, &#39;1.00&#39;&#41;;
test_rw&#40;$schema, test12 =&gt; &#39;&lt;test12&gt;1.&lt;/test12&gt;&#39;,   &#39;1.&#39;&#41;;

If we numify here, then the information about trailing zeroes etc. is lost, and the roundtrip test fails. And there are situations where one want to like a perfect roundtrip.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; * a change to bigint&#40;&#41;: the value is always numified. This does
&gt; &gt;   not break any test.
</div>&gt; 
&gt; That&#39;s a correct fix.
&gt; 
<div class="message-stanza open">&gt; &gt; * a new test t/92json.t, using the mentioned json serializers
</div>&gt; 
<div class="message-stanza open">&gt; &gt; * no attempt was done for checking the other direction &#40;i.e. json
&gt; &gt;   deserialization and xml writing&#41;
</div>&gt; 
&gt; The XML schema already describes what the types are, so there should
&gt; not be
&gt; a problem... &#40;I may need to change some ref&#39;s into reftype&#41;
</div>
Regards,
    Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;03&nbsp;10:02:15&nbsp;2017</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> Mark [...] Overmeer.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2017-02-02 05:03:26, SREZIC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2017-02-01 15:58:16, Mark@Overmeer.net wrote:
</div>
[...]
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt;
&gt; &gt; This looks somewhat complicated:
&gt; &gt;
&gt; &gt; + while&#40;my&#40;$key, $val&#41; = each %{$builtin_types{boolean}}&#41;
&gt; &gt; +{
&gt; &gt; +    $builtin_types{boolean_with_Types_Serialiser}-&gt;{$key} =
&gt; &gt; +    $key eq &#39;parse&#39;
&gt; &gt; +         ? sub { no warnings &#39;once&#39;;
&gt; &gt; +             $_[0] =~ m/^\s*&#40;false|0&#41;\s*/i
&gt; &gt; +             ? $Types::Serialiser::false
&gt; &gt; +             : $Types::Serialiser::true }
&gt; &gt; +             : $val;
&gt; &gt; +}
&gt; &gt;
&gt; &gt; Why not simply:
&gt; &gt;
&gt; &gt; $builtin_types{boolean_with_Types_Serialiser} =
&gt; &gt;     { %{$builtin_types{boolean}},
&gt; &gt;    , parse =&gt; sub {
&gt; &gt;         no warnings &#39;once&#39;;
&gt; &gt;           $_[0] =~ m/^\s*&#40;false|0&#41;\s*/i
&gt; &gt;         ? $Types::Serialiser::false
&gt; &gt;          : $Types::Serialiser::true
&gt; &gt;    };
&gt; &gt;
</div>&gt; 
&gt; Yes, looks simpler.
&gt; 
</div>
I applied this suggestion as
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/eserte/XML-Compile.forked/commit/d3ceb3d41befb2e3e11e9ebf3eb5cdc0ac0a40d2">https://github.com/eserte/XML-Compile.forked/commit/d3ceb3d41befb2e3e11e9ebf3eb5cdc0ac0a40d2</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;08&nbsp;03:59:24&nbsp;2017</span>
    <span class="description">MARKOV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Released half a year ago
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;08&nbsp;03:59:24&nbsp;2017</span>
    <span class="description">MARKOV [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;08&nbsp;03:59:25&nbsp;2017</span>
    <span class="description">MARKOV [...] cpan.org -  Fixed in 1.55 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
