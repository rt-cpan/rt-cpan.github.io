<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #29933 for PAR-Packer: Errors from --clean packed application on HP-UX</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #29933 for PAR-Packer: Errors from --clean packed application on HP-UX</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=PAR-Packer">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=PAR-Packer">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=PAR-Packer">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=PAR-Packer">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/PAR-Packer">PAR-Packer CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">29933</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=PAR-Packer">PAR-Packer</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
stanton [...] electric-cloud.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-41710-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.976    </td>
  </tr>
  <tr id="CF-41711-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




diffs<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/370532/168400/diffs">
Thu Oct 11 18:41:32 2007 (2.4k) by stanton [...] electric-cloud.com
</a>
</font></li>
</ul>


diffs2<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/370898/168598/diffs2">
Fri Oct 12 20:47:57 2007 (1.9k) by stanton [...] electric-cloud.com
</a>
</font></li>
</ul>


diffs3<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/372758/169631/diffs3">
Thu Oct 18 14:17:43 2007 (2.7k) by stanton [...] electric-cloud.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=29933">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-370532" href="/Public/Bug/Display.html?id=29933#txn-370532">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;11&nbsp;18:41:31&nbsp;2007</span>
    <span class="description">stanton [...] electric-cloud.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Errors from --clean packed application on HP-UX</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/370532/168397/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/168397">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Iâ€™m running into a problem on HP-UX with â€“clean and shared libraries
that are packed with pp.  What happens is that my program runs as
expected, but then I see a bunch of errors as the program exits of the form:

Error removing /var/tmp/par-stanton/temp-5778/yknNbRMWLy.sl at
/opt/perl_5.8.8/lib/5.8.8/File/Temp.pm line 890.

It appears that on HP-UX &#40;11.11&#41; you cannot unlink a shared library that
is currently in use by a process.  This file is locked until it is no
longer mapped by any process.  It turns out the same thing happens on
Windows, but there is special code in PAR::Heavy::_dl_extract&#40;&#41; to turn
off the UNLINK attribute on Windows.

The attached patch resolves the error message issue by disabling UNLINK
on hpux and Windows. 

It also ensures that the temporary directory is completely removed on
hpux and Windows by adding a fallback case to the END block in par.pl
that attempts to remove the directory by exec&#39;ing a sh/cmd script. 
Because the exec releases library handles, the script is allowed to
delete all of the files.

I have tested this patch on HP-UX &#40;11.11&#41;, Solaris, Linux, Windows, and
MacOS X.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> diffs</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/370532/168400/diffs">Download diffs</a><br />
<span class="downloadcontenttype">application/octet-stream 2.4k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-370685" href="/Public/Bug/Display.html?id=29933#txn-370685">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;12&nbsp;06:26:24&nbsp;2007</span>
    <span class="description">smueller [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/370685/168493/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/168493">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 730b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks, applied.

I did one important change, though: If the cleanup-shell-script is run,
it needs to return something &#34;true&#34;. Otherwise, the tests fail. I
couldn&#39;t fix it for WIndows, since I don&#39;t know the shell well enough.
The &#34;&#38;&#38;&#34; between the commands there prohibits anything similar since the
second rmdir is allowed to fail. I&#39;ll keep the ticket open in case you
have a solution.

        my $cmd;
        if &#40;$^O =~ m/win32/i&#41; {
            $cmd = &#39;rmdir /q /s &#34;&#39; . $par_temp . &#39;&#34; &gt;nul 2&gt;nul &#38;&#38; rmdir &#34;&#39;
            . $topdir . &#39;&#34; &gt;nul 2&gt;nul &#39;;
        } else {
            $cmd = &#34;rm -rf &#39;&#34; . $par_temp . &#34;&#39; &gt;/dev/null 2&gt;&#38;1 ; rmdir &#39;&#34;
            . $topdir . &#34;&#39;  &gt;/dev/null 2&gt;&#38;1 ; true&#34;;
        }

Best regards,
Steffen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-370686" href="/Public/Bug/Display.html?id=29933#txn-370686">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;12&nbsp;06:26:54&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-370845" href="/Public/Bug/Display.html?id=29933#txn-370845">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;12&nbsp;13:54:49&nbsp;2007</span>
    <span class="description">stanton [...] electric-cloud.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #29933] Errors from --clean packed application on HP-UX </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 12 Oct 2007 10:54:34 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-PAR-Packer [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Scott Stanton&#34; &lt;stanton [...] electric-cloud.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/370845/168564/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/168564">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ah, it&#39;s worse than that.  We actually need to exit with whatever the original exit code should have been.  I think the only way to fix the windows version is to write out a temporary batch file that deletes itself as the last step.  The following block attempts to correct the exit code problem on both platforms.  I&#39;m having problems with the test suite in general, so I&#39;m not confident this passes the tests.


END { if &#40;$ENV{PAR_CLEAN}&#41; {
    my $topdir = File::Basename::dirname&#40;$par_temp&#41;;
    unlink @tmpfile;
    if &#40;rmdir $par_temp&#41; {
        rmdir $topdir;
    } else {
        # Something went wrong unlinking the temporary directory.  This
        # typically happens on platforms that disallow unlinking shared
        # libraries and executables that are in use.
        #
        # Try unlinking with an exec&#39;ed shell command so the files are no
        # longer in use by this process.  Note that this will terminate the
        # current process so no further END block processing will follow.

        my $cmd;
        if &#40;$^O =~ m/win32/i&#41; {
            my $tmp = new File::Temp&#40;
                TEMPLATE =&gt; &#39;tmpXXXXX&#39;,
                DIR =&gt; File::Basename::dirname&#40;$topdir&#41;,
                SUFFIX =&gt; &#39;.bat&#39;,
                UNLINK =&gt; 0 &#41;;

            print $tmp &#34;
rmdir /q /s \&#34;$par_temp\&#34;
rmdir \&#34;$topdir\&#34;
rm \&#34;&#34; . $tmp-&gt;filename . &#34;\&#34; &#38;&#38; exit $?
&#34;;
            $cmd = $tmp-&gt;filename . &#34; &gt;nul 2&gt;nul &#34;;
            close $tmp;
        } else {
            $cmd = &#34;rm -rf &#39;&#34; . $par_temp . &#34;&#39; &gt;/dev/null 2&gt;&#38;1 ; rmdir &#39;&#34;
            . $topdir . &#34;&#39;  &gt;/dev/null 2&gt;&#38;1; exit $?&#34;;
        }
        outs&#40;qq&#40;Unable to remove all temp files, using exec&#40;$cmd&#41;&#41;&#41;;
        exec&#40;$cmd&#41;;
    }
} }



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Steffen MÃ¼ller via RT [mailto:bug-PAR-Packer@rt.cpan.org] 
Sent: Friday, October 12, 2007 3:27 AM
To: Scott Stanton
Subject: [rt.cpan.org #29933] Errors from --clean packed application on HP-UX 


&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=29933">http://rt.cpan.org/Ticket/Display.html?id=29933</a></span> &gt;

Thanks, applied.

I did one important change, though: If the cleanup-shell-script is run,
it needs to return something &#34;true&#34;. Otherwise, the tests fail. I
couldn&#39;t fix it for WIndows, since I don&#39;t know the shell well enough.
The &#34;&#38;&#38;&#34; between the commands there prohibits anything similar since the
second rmdir is allowed to fail. I&#39;ll keep the ticket open in case you
have a solution.

        my $cmd;
        if &#40;$^O =~ m/win32/i&#41; {
            $cmd = &#39;rmdir /q /s &#34;&#39; . $par_temp . &#39;&#34; &gt;nul 2&gt;nul &#38;&#38; rmdir &#34;&#39;
            . $topdir . &#39;&#34; &gt;nul 2&gt;nul &#39;;
        } else {
            $cmd = &#34;rm -rf &#39;&#34; . $par_temp . &#34;&#39; &gt;/dev/null 2&gt;&#38;1 ; rmdir &#39;&#34;
            . $topdir . &#34;&#39;  &gt;/dev/null 2&gt;&#38;1 ; true&#34;;
        }

Best regards,
Steffen
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-370898" href="/Public/Bug/Display.html?id=29933#txn-370898">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;12&nbsp;20:47:55&nbsp;2007</span>
    <span class="description">stanton [...] electric-cloud.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> stanton [...] electric-cloud.com</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/370898/168595/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/168595">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 354b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve attached a new patch based off revision 531 with some changes to
try to avoid running the background shell script unless absolutely
necessary.  This patch also incorporates the changes needed to return
the expected exit code.

Also, I think you might be able to eliminate the @tmpfile variable now.
 It doesn&#39;t appear to be used by par.pl any more.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/370898/168598/diffs2">Download diffs2</a><br />
<span class="downloadcontenttype">application/octet-stream 1.9k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-372758" href="/Public/Bug/Display.html?id=29933#txn-372758">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;18&nbsp;14:17:42&nbsp;2007</span>
    <span class="description">stanton [...] electric-cloud.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> stanton [...] electric-cloud.com</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/372758/169628/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/169628">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 711b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ok, third time&#39;s the charm.  The previous versions of this patch failed
to preserve the exit code on Windows.  I think a slight change in
strategy is in order.  

Instead of using &#39;exec&#39; to switch to a different program, I think it
will work better if we spawn a background process that loops trying to
delete the directory while the parent process exits in the normal
manner.  This should allow the parent process to finish doing its normal
END handling and return with the expected exit code.  Meanwhile the
background process will become detached and finish the cleanup shortly
after the parent exits.

I think this new patch resolves both the normal cleanup issue and the
locked file issue at the same time.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/372758/169631/diffs3">Download diffs3</a><br />
<span class="downloadcontenttype">application/octet-stream 2.7k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-372852" href="/Public/Bug/Display.html?id=29933#txn-372852">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;18&nbsp;17:28:27&nbsp;2007</span>
    <span class="description">stanton [...] electric-cloud.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Latest patch</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> stanton [...] electric-cloud.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/372852/169693/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/169693">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 146b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Arg!  A chunk got dropped from the patch, so you&#39;ll need to add:

    eval { require Win32::Process };

to the block of requires around line 733.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-372978" href="/Public/Bug/Display.html?id=29933#txn-372978">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;19&nbsp;06:27:27&nbsp;2007</span>
    <span class="description">smueller [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/372978/169749/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/169749">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 472b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Oct 18 17:28:27 2007, snstanton wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Arg!  A chunk got dropped from the patch, so you&#39;ll need to add:
&gt; 
&gt;     eval { require Win32::Process };
&gt; 
&gt; to the block of requires around line 733.
</div>
Thanks, applied! &#40;The rest of the patch, too.&#41;

What&#39;s blocking a PAR::Packer &#40;and PAR&#41; release now is only that there
is a test failing* and I can&#39;t find enough time to investigate properly.

Best regards,
Steffen

*The test being #33 of the 02pp tests in PAR::Packer.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-372981" href="/Public/Bug/Display.html?id=29933#txn-372981">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;19&nbsp;06:27:53&nbsp;2007</span>
    <span class="description">smueller [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.65107</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
