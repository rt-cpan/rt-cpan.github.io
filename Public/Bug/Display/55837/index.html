<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #55837 for Test-Compile: pl_file_ok&#40;&#41; method to execute perl doesn&#39;t work under taint mode</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #55837 for Test-Compile: pl_file_ok&#40;&#41; method to execute perl doesn&#39;t work under taint mode</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Test-Compile/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Test-Compile/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Test-Compile/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Test-Compile/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Test-Compile">Test-Compile CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">55837</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Test-Compile/Active/">Test-Compile</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ROBINS [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
mst [...] shadowcat.co.uk

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-45474-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
0.08</li>
<li>
0.09</li>
<li>
0.10</li>
<li>
0.11</li>
<li>
0.12</li>
<li>
0.13</li>
</ul>
    </td>
  </tr>
  <tr id="CF-45475-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.17    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;23&nbsp;08:09:58&nbsp;2010</span>
    <span class="description">ROBINS [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> pl_file_ok&#40;&#41; method to execute perl doesn&#39;t work under taint mode</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Instead of trying to explain the issue I&#39;ll let the IRC conversation I
had with Matt S. Trout speak for itself.

&lt;robinsmidsrod&gt; mst: I had a look in Test::Compile::pl_file_ok&#40;&#41; - it
uses my $out = `$^X -cw $file 2&gt;&#38;1`;
&lt;mst&gt; oh wow
&lt;mst&gt; that&#39;s completely broken
&lt;robinsmidsrod&gt; mst: how else would you check if your script compiles
without letting your current perl environment possibly clobber the test?
&lt;mst&gt; that&#39;s -ish- fine but it&#39;ll fail to work under taint for e.g.
&lt;mst&gt; you need to do something like
&lt;mst&gt; system&#40;$^X, &#40;map { &#34;-I$_&#34; } split &#39;:&#39;, $ENV{PERL5LIB}&#41;, &#39;-c&#39;, $file&#41;;
&lt;robinsmidsrod&gt; maybe you should file a bug report on Test::Compile ;&#41;
&lt;mst&gt; maybe you should, since you&#39;re the one using it :&#41;
&lt;robinsmidsrod&gt; mst: well, I don&#39;t know how to quite articulate why that
piece of code is broken
&lt;mst&gt; make one of your scripts to #!perl -T
&lt;mst&gt; that loads a module
&lt;mst&gt; watch it blow up
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;19&nbsp;18:38:50&nbsp;2011</span>
    <span class="description">SILASMONK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I hope the attached patch may be of use.

On Tue Mar 23 08:09:58 2010, ROBINS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Instead of trying to explain the issue I&#39;ll let the IRC conversation I
&gt; had with Matt S. Trout speak for itself.
&gt; 
&gt; &lt;robinsmidsrod&gt; mst: I had a look in Test::Compile::pl_file_ok&#40;&#41; - it
&gt; uses my $out = `$^X -cw $file 2&gt;&#38;1`;
&gt; &lt;mst&gt; oh wow
&gt; &lt;mst&gt; that&#39;s completely broken
&gt; &lt;robinsmidsrod&gt; mst: how else would you check if your script compiles
&gt; without letting your current perl environment possibly clobber the 
</div>test?
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;mst&gt; that&#39;s -ish- fine but it&#39;ll fail to work under taint for e.g.
&gt; &lt;mst&gt; you need to do something like
&gt; &lt;mst&gt; system&#40;$^X, &#40;map { &#34;-I$_&#34; } split &#39;:&#39;, $ENV{PERL5LIB}&#41;, &#39;-c&#39;, 
</div>$file&#41;;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;robinsmidsrod&gt; maybe you should file a bug report on Test::Compile ;&#41;
&gt; &lt;mst&gt; maybe you should, since you&#39;re the one using it :&#41;
&gt; &lt;robinsmidsrod&gt; mst: well, I don&#39;t know how to quite articulate why 
</div>that
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; piece of code is broken
&gt; &lt;mst&gt; make one of your scripts to #!perl -T
&gt; &lt;mst&gt; that loads a module
&gt; &lt;mst&gt; watch it blow up
</div></div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> a.txt</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- /dev/null
+++ b/t/scripts/taint.pl
@@ -0,0 +1,2 @@
+#!/usr/bin/perl -T
+sleep 1;
--- /dev/null
+++ b/t/10_taint.t
@@ -0,0 +1,7 @@
+#!perl -w
+use strict;
+use warnings;
+use Test::More tests =&gt; 1;
+use Test::Compile;
+pl_file_ok&#40;&#39;t/scripts/taint.pl&#39;, &#39;taint.pl compiles&#39;&#41;;
+
--- a/lib/Test/Compile.pm
+++ b/lib/Test/Compile.pm
@@ -71,7 +71,8 @@
         $Test-&gt;diag&#40;&#34;$file does not exist&#34;&#41;;
         return;
     }
-    my $out = `$^X -cw $file 2&gt;&#38;1`;
+    my $taint = _is_in_taint_mode&#40;$file&#41;;
+    my $out = `$^X -cw$taint $file 2&gt;&#38;1`;
     if &#40;$?&#41; {
         $Test-&gt;ok&#40;0, &#39;Script does not compile&#39;&#41;;
         $Test-&gt;diag&#40;$out&#41;;
@@ -169,6 +170,19 @@
     return &#39;script&#39; if -e &#39;script&#39;;
     return &#39;bin&#39;    if -e &#39;bin&#39;;
 }
+
+sub _is_in_taint_mode {
+    my $file = shift;
+    open&#40;FILE, $file&#41; or die &#34;could not open $file&#34;;
+    my $shebang = &lt;FILE&gt;;
+    my $taint = undef;
+    if &#40;$shebang =~ /^#![\/\w]+\s+\-w?&#40;T&#41;/&#41; {
+        $taint = $1;
+    }
+    close FILE;
+    return $taint;
+}
+
 1;
 __END__
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;19&nbsp;18:38:51&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;19&nbsp;19:38:57&nbsp;2011</span>
    <span class="description">SILASMONK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Actually the $taint variable should be initialized with &#34;&#34; to avoid 
earnings.

On Sat Nov 19 18:38:50 2011, SILASMONK wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I hope the attached patch may be of use.
&gt; 
&gt; On Tue Mar 23 08:09:58 2010, ROBINS wrote:
<div class="message-stanza open">&gt; &gt; Instead of trying to explain the issue I&#39;ll let the IRC conversation 
</div></div>I
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; had with Matt S. Trout speak for itself.
&gt; &gt; 
&gt; &gt; &lt;robinsmidsrod&gt; mst: I had a look in Test::Compile::pl_file_ok&#40;&#41; - 
</div></div>it
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; uses my $out = `$^X -cw $file 2&gt;&#38;1`;
&gt; &gt; &lt;mst&gt; oh wow
&gt; &gt; &lt;mst&gt; that&#39;s completely broken
&gt; &gt; &lt;robinsmidsrod&gt; mst: how else would you check if your script 
</div></div>compiles
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; without letting your current perl environment possibly clobber the 
</div>&gt; test?
<div class="message-stanza open">&gt; &gt; &lt;mst&gt; that&#39;s -ish- fine but it&#39;ll fail to work under taint for e.g.
&gt; &gt; &lt;mst&gt; you need to do something like
&gt; &gt; &lt;mst&gt; system&#40;$^X, &#40;map { &#34;-I$_&#34; } split &#39;:&#39;, $ENV{PERL5LIB}&#41;, &#39;-c&#39;, 
</div>&gt; $file&#41;;
<div class="message-stanza open">&gt; &gt; &lt;robinsmidsrod&gt; maybe you should file a bug report on Test::Compile 
</div></div>;&#41;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; &lt;mst&gt; maybe you should, since you&#39;re the one using it :&#41;
&gt; &gt; &lt;robinsmidsrod&gt; mst: well, I don&#39;t know how to quite articulate why 
</div>&gt; that
<div class="message-stanza open">&gt; &gt; piece of code is broken
&gt; &gt; &lt;mst&gt; make one of your scripts to #!perl -T
&gt; &gt; &lt;mst&gt; that loads a module
&gt; &gt; &lt;mst&gt; watch it blow up
</div>&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;28&nbsp;04:41:52&nbsp;2011</span>
    <span class="description">ROBINS [...] cpan.org -  Cc mst@shadowcat.co.uk added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;28&nbsp;04:44:16&nbsp;2011</span>
    <span class="description">ROBINS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m really not very experienced in the taint mode of Perl, so I added
Matt Trout &#40;mst&#41; to the thread.

Maybe he can tell you if the patch makes sense or not.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;19&nbsp;07:50:16&nbsp;2012</span>
    <span class="description">SILASMONK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Nov 28 04:44:16 2011, ROBINS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m really not very experienced in the taint mode of Perl, so I added
&gt; Matt Trout &#40;mst&#41; to the thread.
&gt; 
&gt; Maybe he can tell you if the patch makes sense or not.
</div>
Evan,
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> taint.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Author: Nicholas Bamber &lt;nicholas@periapt.co.uk&gt;
Subject: taint mode not respected
 If the -T argument is passed on the command line to the perl executable,
 it will turn on &#34;taint&#34; treating all input as suspect until checked,
 and dieing if the scripts attempts to output tainted data. Using taint
 mode is considered good practice for sensitive programs that could
 possibly be run by untrusted users. If the -T argument is used in the
 shebang line of the script, then it needs to be passed when the script is
 invoked - otherwise the script will fail to compile. Thus it is quite
 important that this module pass the -T flag when required. We also provide
 a test script to verify the extra functionality. There is also a -t argument
 which warns rather than dies.
Last-Update: 2012-02-18
Bug-Debian: <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=649301">http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=649301</a></span>
Bug: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=55837">https://rt.cpan.org/Public/Bug/Display.html?id=55837</a></span>
--- /dev/null
+++ b/t/10_taint.t
@@ -0,0 +1,7 @@
+#!perl -w
+use strict;
+use warnings;
+use Test::More tests =&gt; 1;
+use Test::Compile;
+pl_file_ok&#40;&#39;t/scripts/taint.pl&#39;, &#39;taint.pl compiles&#39;&#41;;
+
--- a/lib/Test/Compile.pm
+++ b/lib/Test/Compile.pm
@@ -138,7 +138,8 @@
             return &#40;$@ ? 0 : 1&#41;;
         } else {
             my @perl5lib = split&#40;&#39;:&#39;, &#40;$ENV{PERL5LIB}||&#34;&#34;&#41;&#41;;
-            system&#40;$^X, &#40;map { &#34;-I$_&#34; } @perl5lib&#41;, &#39;-c&#39;, $file&#41;;
+            my $taint = _is_in_taint_mode&#40;$file&#41;;
+            system&#40;$^X, &#40;map { &#34;-I$_&#34; } @perl5lib&#41;, &#34;-c$taint&#34;, $file&#41;;
             return &#40;$? ? 0 : 1&#41;;
         }
     }
@@ -177,6 +178,19 @@
     return &#39;script&#39; if -e &#39;script&#39;;
     return &#39;bin&#39;    if -e &#39;bin&#39;;
 }
+
+sub _is_in_taint_mode {
+    my $file = shift;
+    open&#40;FILE, $file&#41; or die &#34;could not open $file&#34;;
+    my $shebang = &lt;FILE&gt;;
+    my $taint = &#34;&#34;;
+    if &#40;$shebang =~ /^#![\/\w]+\s+\-w?&#40;[tT]&#41;/&#41; {
+        $taint = $1;
+    }
+    close FILE;
+    return $taint;
+}
+
 1;
 __END__
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;19&nbsp;07:50:18&nbsp;2012</span>
    <span class="description">SILASMONK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Nov 28 04:44:16 2011, ROBINS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m really not very experienced in the taint mode of Perl, so I added
&gt; Matt Trout &#40;mst&#41; to the thread.
&gt; 
&gt; Maybe he can tell you if the patch makes sense or not.
</div>
Evan,
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;19&nbsp;07:50:21&nbsp;2012</span>
    <span class="description">SILASMONK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Nov 28 04:44:16 2011, ROBINS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m really not very experienced in the taint mode of Perl, so I added
&gt; Matt Trout &#40;mst&#41; to the thread.
&gt; 
&gt; Maybe he can tell you if the patch makes sense or not.
</div>
Evan,
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;19&nbsp;07:50:23&nbsp;2012</span>
    <span class="description">SILASMONK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Nov 28 04:44:16 2011, ROBINS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m really not very experienced in the taint mode of Perl, so I added
&gt; Matt Trout &#40;mst&#41; to the thread.
&gt; 
&gt; Maybe he can tell you if the patch makes sense or not.
</div>
Evan,
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;19&nbsp;07:50:26&nbsp;2012</span>
    <span class="description">SILASMONK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Nov 28 04:44:16 2011, ROBINS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m really not very experienced in the taint mode of Perl, so I added
&gt; Matt Trout &#40;mst&#41; to the thread.
&gt; 
&gt; Maybe he can tell you if the patch makes sense or not.
</div>
Evan,
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;19&nbsp;08:02:50&nbsp;2012</span>
    <span class="description">SILASMONK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Feb 19 07:50:26 2012, SILASMONK wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Nov 28 04:44:16 2011, ROBINS wrote:
<div class="message-stanza open">&gt; &gt; I&#39;m really not very experienced in the taint mode of Perl, so I 
</div></div>added
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Matt Trout &#40;mst&#41; to the thread.
&gt; &gt; 
&gt; &gt; Maybe he can tell you if the patch makes sense or not.
</div>&gt; 
&gt; Evan,
</div>
Evan,
   I have refreshed the patch. I was rather annoyed that the the code 
had changed substantially without actually addressing the taint or lib 
issues. I attempted to contact you as per this email: 
<span class="clickylink"><a target="new" rel="nofollow" href="http://lists.debian.org/debian-perl/2012/02/msg00064.html">http://lists.debian.org/debian-perl/2012/02/msg00064.html</a></span> . I was even 
more annoyed when this email bounced, especially as &#34;egiles@cpan.org&#34; is 
listed as a contact in  the Test::Compile. I then attempted to contact 
you via github which failed. I did however realize at this point that 
you are finally looking at this issue. I should however point out that 
the _is_in_taint_mode function already returns whatever needs to go in 
the command line arguments and does not require any further 
modification. In fact there is also a lesser used &#34;-t&#34; mode &#40;only warns&#41; 
which your draft version would mess up.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;19&nbsp;08:03:49&nbsp;2012</span>
    <span class="description">SILASMONK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Patch included 


On Sun Feb 19 08:02:50 2012, SILASMONK wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sun Feb 19 07:50:26 2012, SILASMONK wrote:
<div class="message-stanza open">&gt; &gt; On Mon Nov 28 04:44:16 2011, ROBINS wrote:
<div class="message-stanza open">&gt; &gt; &gt; I&#39;m really not very experienced in the taint mode of Perl, so I 
</div></div>&gt; added
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; Matt Trout &#40;mst&#41; to the thread.
&gt; &gt; &gt; 
&gt; &gt; &gt; Maybe he can tell you if the patch makes sense or not.
</div>&gt; &gt; 
&gt; &gt; Evan,
</div>&gt; 
&gt; Evan,
&gt;    I have refreshed the patch. I was rather annoyed that the the code 
&gt; had changed substantially without actually addressing the taint or lib 
&gt; issues. I attempted to contact you as per this email: 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://lists.debian.org/debian-perl/2012/02/msg00064.html">http://lists.debian.org/debian-perl/2012/02/msg00064.html</a></span> . I was even 
&gt; more annoyed when this email bounced, especially as &#34;egiles@cpan.org&#34; 
</div>is 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; listed as a contact in  the Test::Compile. I then attempted to contact 
&gt; you via github which failed. I did however realize at this point that 
&gt; you are finally looking at this issue. I should however point out that 
&gt; the _is_in_taint_mode function already returns whatever needs to go in 
&gt; the command line arguments and does not require any further 
&gt; modification. In fact there is also a lesser used &#34;-t&#34; mode &#40;only 
</div>warns&#41; 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; which your draft version would mess up.
</div></div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> taint.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Author: Nicholas Bamber &lt;nicholas@periapt.co.uk&gt;
Subject: taint mode not respected
 If the -T argument is passed on the command line to the perl executable,
 it will turn on &#34;taint&#34; treating all input as suspect until checked,
 and dieing if the scripts attempts to output tainted data. Using taint
 mode is considered good practice for sensitive programs that could
 possibly be run by untrusted users. If the -T argument is used in the
 shebang line of the script, then it needs to be passed when the script is
 invoked - otherwise the script will fail to compile. Thus it is quite
 important that this module pass the -T flag when required. We also provide
 a test script to verify the extra functionality. There is also a -t argument
 which warns rather than dies.
Last-Update: 2012-02-18
Bug-Debian: <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=649301">http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=649301</a></span>
Bug: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=55837">https://rt.cpan.org/Public/Bug/Display.html?id=55837</a></span>
--- /dev/null
+++ b/t/10_taint.t
@@ -0,0 +1,7 @@
+#!perl -w
+use strict;
+use warnings;
+use Test::More tests =&gt; 1;
+use Test::Compile;
+pl_file_ok&#40;&#39;t/scripts/taint.pl&#39;, &#39;taint.pl compiles&#39;&#41;;
+
--- a/lib/Test/Compile.pm
+++ b/lib/Test/Compile.pm
@@ -138,7 +138,8 @@
             return &#40;$@ ? 0 : 1&#41;;
         } else {
             my @perl5lib = split&#40;&#39;:&#39;, &#40;$ENV{PERL5LIB}||&#34;&#34;&#41;&#41;;
-            system&#40;$^X, &#40;map { &#34;-I$_&#34; } @perl5lib&#41;, &#39;-c&#39;, $file&#41;;
+            my $taint = _is_in_taint_mode&#40;$file&#41;;
+            system&#40;$^X, &#40;map { &#34;-I$_&#34; } @perl5lib&#41;, &#34;-c$taint&#34;, $file&#41;;
             return &#40;$? ? 0 : 1&#41;;
         }
     }
@@ -177,6 +178,19 @@
     return &#39;script&#39; if -e &#39;script&#39;;
     return &#39;bin&#39;    if -e &#39;bin&#39;;
 }
+
+sub _is_in_taint_mode {
+    my $file = shift;
+    open&#40;FILE, $file&#41; or die &#34;could not open $file&#34;;
+    my $shebang = &lt;FILE&gt;;
+    my $taint = &#34;&#34;;
+    if &#40;$shebang =~ /^#![\/\w]+\s+\-w?&#40;[tT]&#41;/&#41; {
+        $taint = $1;
+    }
+    close FILE;
+    return $taint;
+}
+
 1;
 __END__
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;20&nbsp;16:42:48&nbsp;2012</span>
    <span class="description">EGILES [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Feb 19 08:03:49 2012, SILASMONK wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Patch included 
&gt; 
&gt; 
<div class="message-stanza open">&gt; &gt; Evan,
&gt; &gt;    I have refreshed the patch. I was rather annoyed that the the 
</div></div>code 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; had changed substantially without actually addressing the taint or 
</div></div>lib 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; issues. I attempted to contact you as per this email: 
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://lists.debian.org/debian-perl/2012/02/msg00064.html">http://lists.debian.org/debian-perl/2012/02/msg00064.html</a></span> . I was 
</div></div>even 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; more annoyed when this email bounced, especially as 
</div></div>&#34;egiles@cpan.org&#34; 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; is 
<div class="message-stanza open">&gt; &gt; listed as a contact in  the Test::Compile. I then attempted to 
</div></div>contact 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; you via github which failed. I did however realize at this point 
</div></div>that 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; you are finally looking at this issue. I should however point out 
</div></div>that 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; the _is_in_taint_mode function already returns whatever needs to go 
</div></div>in 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; the command line arguments and does not require any further 
&gt; &gt; modification. In fact there is also a lesser used &#34;-t&#34; mode &#40;only 
</div>&gt; warns&#41; 
<div class="message-stanza open">&gt; &gt; which your draft version would mess up.
</div>&gt; 
</div>Wow, you raise quite a few points there, and to be honest, they are 
mostly justified.  I apologise for making you task more difficult than 
necessary.

Please leave it with me for a short while, and I will endeavour to 
resolve those issues as soon as possible.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;29&nbsp;17:10:56&nbsp;2012</span>
    <span class="description">EGILES [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have now released v0.17 of Test::Compile to CPAN.

This version includes the supplied patch, almost unchanged, and I am 
fairly certain that it resolves the your issue.

I hope this is an acceptable solution to all involved.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;29&nbsp;17:10:57&nbsp;2012</span>
    <span class="description">EGILES [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;29&nbsp;17:11:30&nbsp;2012</span>
    <span class="description">EGILES [...] cpan.org -  Fixed in 0.17 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
