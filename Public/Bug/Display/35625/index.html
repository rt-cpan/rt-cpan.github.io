<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #35625 for POE: POE::Wheel::Run kill&#40;&#41; on Windows</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #35625 for POE: POE::Wheel::Run kill&#40;&#41; on Windows</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/POE/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/POE/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/POE/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/POE/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/POE">POE CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">35625</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/POE/Active/">POE</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
kr1shnakk [...] yahoo.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-26342-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.0001    </td>
  </tr>
  <tr id="CF-26343-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;04&nbsp;23:29:55&nbsp;2008</span>
    <span class="description">kr1shnakk [...] yahoo.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> POE::Wheel::Run kill&#40;&#41; on Windows</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,
  I am trying to use POE::Wheel::Run to start and stop another perl 
process &#40;loop.pl&#41;. I want to be able to kill this process from my main 
POE program &#40;test.pl&#41;. But it seems like the kill&#40;&#41; method of 
POE::Wheel::Run doesn&#39;t stop the process started. The parent process 
terminates but the child process continues to run as a detached 
process. I tried the same on Linux FC5 and it seems to run as expected 
&#40;kills the child process fine&#41;. Also, I tried with 
POE::Wheel::Run::Win32 which didn&#39;t help either. I would really 
appreciate any help at this time. 

OS: Windows XP SP2
Active Perl version : v5.8.8 built for MSWin32-x86-multi-thread Build 
822
POE package installed version :  POE-1.0001

Here is my sample code:

loop.pl:
########
while &#40;1&#41; {sleep 1;}


test.pl:
########
use strict;
use warnings;

use POE qw&#40;Wheel::Run Filter::Reference&#41;;

POE::Session-&gt;create&#40;inline_states =&gt; { 
        _start =&gt; \&#38;start,
        stop =&gt; \&#38;stop,
    }
&#41;;
$poe_kernel-&gt;run;

sub start {
    my &#40;$heap, $session, $kernel&#41; = @_[HEAP, SESSION, KERNEL];
    print &#34;Starting child\n&#34;;
    $heap-&gt;{task} = POE::Wheel::Run-&gt;new&#40;
        Program =&gt; &#39;perl loop.pl&#39;,
        StdoutFilter =&gt; POE::Filter::Reference-&gt;new&#40;&#41;,
        StdoutEvent  =&gt; &#34;handle_task_result&#34;,
        StderrEvent  =&gt; &#34;handle_task_debug&#34;,
        CloseEvent   =&gt; &#34;handle_task_done&#34;,
    &#41;;
    $kernel-&gt;delay&#40;stop =&gt; 10&#41;;
}

sub stop {
    my &#40;$heap, $kernel&#41; = @_[HEAP, KERNEL];
    print &#34;Stopping child\n&#34;;
    $heap-&gt;{task}-&gt;kill&#40;9&#41;; ### kill the child process
    delete $heap-&gt;{task};
}

sub handle_task_result {
    my $result = $_[ARG0];
    print &#34;Result for $result-&gt;{task}: $result-&gt;{status}\n&#34;;
}

sub handle_task_debug {
    my $result = $_[ARG0];
    print &#34;Debug: $result\n&#34;;
}

sub handle_task_done {
    my &#40; $kernel, $heap, $task_id &#41; = @_[ KERNEL, HEAP, ARG0 ];
    delete $heap-&gt;{task}-&gt;{$task_id};
}
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;12&nbsp;09:47:47&nbsp;2008</span>
    <span class="description">acferen [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> acferen [...] yahoo.com</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun May 04 23:29:55 2008, kr1shnakk wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt;   I am trying to use POE::Wheel::Run to start and stop another perl 
&gt; process &#40;loop.pl&#41;. I want to be able to kill this process from my main 
&gt; POE program &#40;test.pl&#41;. But it seems like the kill&#40;&#41; method of 
&gt; POE::Wheel::Run doesn&#39;t stop the process started. The parent process 
&gt; terminates but the child process continues to run as a detached 
&gt; process. I tried the same on Linux FC5 and it seems to run as expected 
&gt; &#40;kills the child process fine&#41;. Also, I tried with 
&gt; POE::Wheel::Run::Win32 which didn&#39;t help either. I would really 
&gt; appreciate any help at this time. 
</div>
Getting POE::Wheel::Run two work consistently on Win32 and Linux has
been an adventure for me too.  Attached is a modified version of your
script that works for me  &#40;tested on Ubuntu and XP&#41;.  It requires you to
do a little more bookkeeping, but it works.

Basically I just use a POE::Filter::Reference to communicate the pid
back to the main POE loop and kill it from there.  I think Wheel::Run
probably can and should deal with this little song and dance, but until
someone has time to figure out why it doesn&#39;t this should work.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!perl -w

use strict;
use warnings;

use POE qw&#40;Wheel::Run Filter::Reference&#41;;

POE::Session-&gt;create&#40;inline_states =&gt; { _start =&gt; \&#38;start,
                                        stop =&gt; \&#38;stop,
                                        handle_task_result =&gt; \&#38;handle_task_result,
                                        handle_task_debug =&gt; \&#38;handle_task_debug,
                                      },
                    &#41;;
$poe_kernel-&gt;run;

sub start {
  my &#40;$heap, $session, $kernel&#41; = @_[HEAP, SESSION, KERNEL];
  print &#34;Starting child\n&#34;;
  $heap-&gt;{task} = POE::Wheel::Run-&gt;new&#40;
                                       Program =&gt; sub { a_task&#40;&#39;loop.pl&#39;&#41; },
                                       StdoutFilter =&gt; POE::Filter::Reference-&gt;new&#40;&#41;,
                                       StdoutEvent =&gt; &#34;handle_task_result&#34;,
                                       StderrEvent =&gt; &#34;handle_task_debug&#34;,
                                       CloseEvent =&gt; &#34;handle_task_done&#34;,
                                      &#41;;
  $kernel-&gt;delay&#40;stop =&gt; 10&#41;;
}

sub stop {
  my &#40;$heap, $kernel&#41; = @_[HEAP, KERNEL];
  print &#34;Stopping child &#40;$heap-&gt;{pid}&#41;\n&#34;;

  kill&#40;9, $heap-&gt;{pid}&#41;;        ### kill the child process
  #$heap-&gt;{task}-&gt;kill&#40;&#41;;
  delete $heap-&gt;{task};
  delete $heap-&gt;{pid};
}

sub handle_task_result {
  my $result = $_[ARG0];
  $_[HEAP]-&gt;{pid} = $result-&gt;{pid} if $result-&gt;{pid};
}

sub handle_task_debug {
  my $result = $_[ARG0];
  print &#34;Debug: $result\n&#34;;
}

sub handle_task_done {
  my &#40; $kernel, $heap, $task_id &#41; = @_[ KERNEL, HEAP, ARG0 ];
  delete $heap-&gt;{task}-&gt;{$task_id};
}


sub a_task {
  my $task   = shift;

  binmode&#40;STDOUT&#41;;              # Required for this to work on MSWin32
  my $filter = POE::Filter::Reference-&gt;new&#40;&#41;;

  my &#40;%result, $output&#41;;
  my &#40;$pid, $status&#41;;
  $pid = open&#40;my $prgfh, &#39;-|&#39;, qq{perl $task}&#41;; # $task

  %result = &#40; state =&gt; &#39;running&#39;, pid =&gt; $pid, task =&gt; $task &#41;;
  $output = $filter-&gt;put&#40; [ \%result ] &#41;;
  print STDOUT @$output;

  close&#40;$prgfh&#41;;                # wait for result

  %result = &#40; state =&gt; &#39;finished&#39;, pid =&gt; $pid, task =&gt; $task, res =&gt; $? &#41;;
  $output = $filter-&gt;put&#40; [ \%result ] &#41;;
  print STDOUT @$output;

}
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;12&nbsp;09:47:58&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;09&nbsp;19:11:04&nbsp;2009</span>
    <span class="description">APOCAL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

 I noticed that BinGOs, the maintainer of POE::Wheel::Run::Win32
released v0.10 to CPAN with this changelog:

 - Fixed kill&#40;&#41; method.

 I did some tests on my windows VM and it seemed to make the problem go
away. If it does help please let BinGOs know and thank him for
continuing to maintain POE::Wheel::Run::Win32!

 NOTE: I had to change Program to Program =&gt; [ qw&#40; perl loop.pl &#41; ] to
get the intended results. I noticed my process count jumping from 20 to
22 and back to 20 when the program terminated.

 Could you please re-test with the latest POE/Wheel::Run::Win32 and let
us know your experience? I hope the results are positive so we don&#39;t
have to employ the workaround suggested by acferen :&#41;

 If you get a different result please file a new bug against
POE::Wheel::Run::Win32 because it&#39;s doubtful that we will mangle
POE::Wheel::Run to work with Win32 anytime soon ;&#41;

-- 
~Apocalypse
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;09&nbsp;19:11:05&nbsp;2009</span>
    <span class="description">APOCAL [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;09&nbsp;23:06:03&nbsp;2009</span>
    <span class="description">kr1shnakk [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Feb 09 19:11:04 2009, APOCAL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello,
&gt; 
&gt;  I noticed that BinGOs, the maintainer of POE::Wheel::Run::Win32
&gt; released v0.10 to CPAN with this changelog:
&gt; 
&gt;  - Fixed kill&#40;&#41; method.
&gt; 
&gt;  I did some tests on my windows VM and it seemed to make the problem go
&gt; away. If it does help please let BinGOs know and thank him for
&gt; continuing to maintain POE::Wheel::Run::Win32!
&gt; 
</div>[krishnakk] I will do! Believe it or not, I checked for the updates
against this module just 2-3 weeks back and thought nothing has changed. 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  NOTE: I had to change Program to Program =&gt; [ qw&#40; perl loop.pl &#41; ] to
&gt; get the intended results. I noticed my process count jumping from 20 to
&gt; 22 and back to 20 when the program terminated.
&gt; 
&gt;  Could you please re-test with the latest POE/Wheel::Run::Win32 and let
&gt; us know your experience? I hope the results are positive so we don&#39;t
&gt; have to employ the workaround suggested by acferen :&#41;
</div>
[kr1shnakk] Thanks for the update and as you mentioned I tried with the
updated build and it seems to work without a problem with my basic test. 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt;  If you get a different result please file a new bug against
&gt; POE::Wheel::Run::Win32 because it&#39;s doubtful that we will mangle
&gt; POE::Wheel::Run to work with Win32 anytime soon ;&#41;
</div>
[kr1shnakk] I will try more of my tests and let you all know. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;09&nbsp;23:06:04&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;22&nbsp;03:12:58&nbsp;2009</span>
    <span class="description">RCAPUTO [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sending the previous mail has failed.  Please contact your admin, they can find more details in the logs.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
