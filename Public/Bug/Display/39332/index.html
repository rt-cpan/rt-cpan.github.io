<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #39396 for devel-nytprof: Re: Weird errors using NYTProf</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #39396 for devel-nytprof: Re: Weird errors using NYTProf</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=devel-nytprof">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=devel-nytprof">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=devel-nytprof">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=devel-nytprof">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/timbunce/devel-nytprof/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/devel-nytprof">devel-nytprof CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">39396</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=devel-nytprof">devel-nytprof</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
thomas.equeter [...] ovh.net

<br />
Tim.Bunce [...] pobox.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-221012-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-221013-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




perl-V-5.10.0<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/509193/253402/perl-V-5.10.0">
Wed Sep 17 05:05:29 2008 (1.9k) by thomas.equeter [...] ovh.net
</a>
</font></li>
</ul>


perl-V-5.8.8<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/509193/253401/perl-V-5.8.8">
Wed Sep 17 05:05:29 2008 (2.9k) by thomas.equeter [...] ovh.net
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=39396">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-508999" href="/Public/Bug/Display.html?id=39396#txn-508999">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;16&nbsp;12:58:23&nbsp;2008</span>
    <span class="description">Tim.Bunce [...] pobox.com - Ticket #39332:  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Tim.Bunce [...] pobox.com, bug-devel-nytprof [...] rt.cpan.org, develnytprof-dev [...] googlegroups.com</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: Weird errors using NYTProf</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 16 Sep 2008 16:11:05 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Thomas Equeter &lt;thomas.equeter [...] ovh.net&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tim Bunce &lt;Tim.Bunce [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/508999/253275/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/253275">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, Sep 16, 2008 at 01:18:33PM +0200, Thomas Equeter wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello,
&gt; 
&gt; I&#39;m trying to profile one of our Perl applications using NYTProf 2.03,
&gt; and running into weird &#34;can&#39;t happen&#34; errors.
&gt; 
&gt; But first, the setting: this is a relatively simple perl script &#40;&lt; 1K
&gt; LoC&#41; but it leverages a number of modules from our internal
&gt; behemoth-sized library at OVH, so I can&#39;t really run it anywhere else
&gt; than our dev and production servers.
&gt; 
&gt; The details of our dev server are as follows: Linux 2.4.32 on i386, gcc
&gt; 4.1.2, perl 5.8.8 &#40;Debian-based&#41;. Needless to say that I can&#39;t alter any
&gt; of that. However, I&#39;ve also tried using a $HOME-installed perl 5.10.0,
&gt; without any change in the symptoms.
</div>
Please post the perl -V output for both as it may be useful.

I&#39;ve not been able to reproduce it with perl 5.8.6 or 5.10.0.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Among the heap of weird errors that pop up whenever I add -d:NYTProf to
&gt; the command-line, I&#39;ve located an easily reproducible one at least:
&gt; 
&gt;   $ perl -MSocket6=AI_PASSIVE -e &#39;print AI_PASSIVE, &#34;\n&#34;&#39;
&gt;   1
&gt;   $ perl -MSocket6=AI_PASSIVE -d:NYTProf -e &#39;print AI_PASSIVE, &#34;\n&#34;&#39;
&gt;   Unable to determine line number in -e.
&gt;   ...
&gt;   Your vendor has not defined Socket macro AI_PASSIVE, used at -e line 1
</div>
Please try running with NYTPROF=subs=0:blocks=0:leave=0:use_db_sub=1
and various combinations of value to isolate any that make a difference.

Also, could you hack a copy of Socket6? Modify the constant&#40;&#41; function
&#40;static double constant&#40;char *name, int arg&#41;&#41; to print a copy of the
name argument, delimited by quotes, so we can see what it&#39;s getting.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Also, the NYTProf test10 case fails &#40;tests 46, 144, 242, 340&#41;:
&gt; 
&gt;   #          got: &#39;test10.x line 3: got 0.0000000 expected ~2 for time&#39;
&gt;   #     expected: &#39;&#39;
</div>
Odd. 

Can you try all the above with the current trunk code?:
<span class="clickylink"><a target="new" rel="nofollow" href="http://code.google.com/p/perl-devel-nytprof/source/checkout">http://code.google.com/p/perl-devel-nytprof/source/checkout</a></span>

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Of course, none of this happens on my workstation, so I guess that it is
&gt; somehow related to our dev server. Would you happen to have an idea of
&gt; where the problem might lie and/or how to work around it?
</div>
Not yet.

Tim.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Create even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-509193" href="/Public/Bug/Display.html?id=39396#txn-509193">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;17&nbsp;05:05:29&nbsp;2008</span>
    <span class="description">thomas.equeter [...] ovh.net - Ticket #39350:  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> bug-devel-nytprof [...] rt.cpan.org, develnytprof-dev [...] googlegroups.com</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: Weird errors using NYTProf</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 17 Sep 2008 11:02:53 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Tim Bunce &lt;Tim.Bunce [...] pobox.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Thomas Equeter &lt;thomas.equeter [...] ovh.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/509193/253400/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/253400">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, Sep 16, 2008 at 04:11:05PM +0100, Tim Bunce wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Please post the perl -V output for both as it may be useful.
</div>Attached.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Please try running with NYTPROF=subs=0:blocks=0:leave=0:use_db_sub=1
&gt; and various combinations of value to isolate any that make a difference.
</div>No effect &#40;tried all 16 combinations&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Also, could you hack a copy of Socket6? Modify the constant&#40;&#41; function
&gt; &#40;static double constant&#40;char *name, int arg&#41;&#41; to print a copy of the
&gt; name argument, delimited by quotes, so we can see what it&#39;s getting.
</div>I did and seen that it was behaving as expected. Firing up gdb, I
also noticed that it was also returning the correct value &#40;1&#41;.

Back to the perl side, I added some debug in Socket6.pm&#39;s AUTOLOAD sub,
around the call to constant&#40;&#41;:

  $ perl -MSocket6=AI_PASSIVE -e &#39;print AI_PASSIVE, &#34;\n&#34;&#39;
  Before: $!=Bad file descriptor
  Socket6::constant&#40; AI_PASSIVE, 0 &#41;
  After: $val=1, $!=
  1

  $ perl -MSocket6=AI_PASSIVE -d:NYTProf -e &#39;print AI_PASSIVE, &#34;\n&#34;&#39;
  Before: $!=Invalid argument
  Socket6::constant&#40; AI_PASSIVE, 0 &#41;
  After: $val=1, $!=Invalid argument
  Your vendor has not defined Socket macro AI_PASSIVE, used at -e line 1


Apparently, NYTProf is affecting the value of $! pretty much everywhere.
As Socket6 checks $! to determine if the call was successful, it reports
an error and discards $val in the -d:NYTProf case.

I noticed the same problem in other parts of my script: POE signals
errors using $! as well, so my code was choking on these &#34;Invalid
arguments&#34; while the calls were actually delivered &#40;as noticed through
logging&#41;.

There are no extra system calls reported by strace between the two
prints above, and no EINVAL reported at all. Without a syscall to start
tracking from, my knowledge of XS doesn&#39;t allow me to investigate
further.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Can you try all the above with the current trunk code?:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://code.google.com/p/perl-devel-nytprof/source/checkout">http://code.google.com/p/perl-devel-nytprof/source/checkout</a></span>
</div>Same behaviour.


-Thomas Equeter.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/509193/253401/perl-V-5.8.8">Download perl-V-5.8.8</a><br />
<span class="downloadcontenttype">text/plain 2.9k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/509193/253402/perl-V-5.10.0">Download perl-V-5.10.0</a><br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-509589" href="/Public/Bug/Display.html?id=39396#txn-509589">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;18&nbsp;05:31:14&nbsp;2008</span>
    <span class="description">Tim.Bunce [...] pobox.com - Ticket #39380:  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Tim Bunce &lt;Tim.Bunce [...] pobox.com&gt;, bug-devel-nytprof [...] rt.cpan.org, develnytprof-dev [...] googlegroups.com</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: Weird errors using NYTProf</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 18 Sep 2008 10:29:28 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Thomas Equeter &lt;thomas.equeter [...] ovh.net&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tim Bunce &lt;Tim.Bunce [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/509589/253645/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/253645">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, Sep 17, 2008 at 11:02:53AM +0200, Thomas Equeter wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Apparently, NYTProf is affecting the value of $! pretty much everywhere.
</div>
Ah, interesting.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As Socket6 checks $! to determine if the call was successful, it reports
&gt; an error and discards $val in the -d:NYTProf case.
&gt; 
&gt; I noticed the same problem in other parts of my script: POE signals
&gt; errors using $! as well, so my code was choking on these &#34;Invalid
&gt; arguments&#34; while the calls were actually delivered &#40;as noticed through
&gt; logging&#41;.
</div>
Are you using compression? &#40;&#34;strings nytprof.out | head&#34; will
show a line starting with &#34;# Compressed ...&#34; if you are.&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There are no extra system calls reported by strace between the two
&gt; prints above, and no EINVAL reported at all. Without a syscall to start
&gt; tracking from, my knowledge of XS doesn&#39;t allow me to investigate
&gt; further.
</div>
Sadly I&#39;ve still not been able to reproduce this.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Can you try all the above with the current trunk code?:
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://code.google.com/p/perl-devel-nytprof/source/checkout">http://code.google.com/p/perl-devel-nytprof/source/checkout</a></span>
</div>&gt; Same behaviour.
</div>
Please try a &#34;make test&#34; after an &#34;svn update&#34;. I&#39;ve added a new
test &#40;t/50.errno.t&#41; that tries to test this.

If the test passes please hack it till it doesn&#39;t! &#40;But only use
core perl modules.&#41;

Tim.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-509597" href="/Public/Bug/Display.html?id=39396#txn-509597">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;18&nbsp;05:35:24&nbsp;2008</span>
    <span class="description">TIMB [...] cpan.org - Ticket #39350:  Merged into ticket #39396</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-509598" href="/Public/Bug/Display.html?id=39396#txn-509598">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;18&nbsp;05:35:24&nbsp;2008</span>
    <span class="description">TIMB [...] cpan.org - Ticket #39332:  Merged into ticket #39396</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-509599" href="/Public/Bug/Display.html?id=39396#txn-509599">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;18&nbsp;05:36:48&nbsp;2008</span>
    <span class="description">TIMB [...] cpan.org - Ticket #39380:  Merged into ticket #39396</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-509600" href="/Public/Bug/Display.html?id=39396#txn-509600">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;18&nbsp;05:36:48&nbsp;2008</span>
    <span class="description">TIMB [...] cpan.org - Ticket #39332:  Merged into ticket #39396</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-509601" href="/Public/Bug/Display.html?id=39396#txn-509601">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;18&nbsp;05:37:19&nbsp;2008</span>
    <span class="description">TIMB [...] cpan.org - Ticket #39332:  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-509798" href="/Public/Bug/Display.html?id=39396#txn-509798">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;18&nbsp;11:35:36&nbsp;2008</span>
    <span class="description">thomas.equeter [...] ovh.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> bug-devel-nytprof [...] rt.cpan.org, develnytprof-dev [...] googlegroups.com</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: Weird errors using NYTProf</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 18 Sep 2008 17:34:49 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Tim Bunce &lt;Tim.Bunce [...] pobox.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Thomas Equeter &lt;thomas.equeter [...] ovh.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/509798/253784/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/253784">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Sep 18, 2008 at 10:29:28AM +0100, Tim Bunce wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Are you using compression? &#40;&#34;strings nytprof.out | head&#34; will
&gt; show a line starting with &#34;# Compressed ...&#34; if you are.&#41;
</div>
No such line on the dev server nor on my workstation &#40;where NYTProf
works&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Please try a &#34;make test&#34; after an &#34;svn update&#34;. I&#39;ve added a new
&gt; test &#40;t/50.errno.t&#41; that tries to test this.
</div>
It hits the nail right on the head: both $! tests fail &#40;lines 19 and
33&#41;.

This said, in the meantime I&#39;ve managed to get an other server for my
purposes. As it runs NYTProf flawlessly, I&#39;ve been able to locate and
refactorise the chunk of code which was hogging the CPU. Therefore,
running NYTProf on the dev server is not an emergency anymore.

It would still be useful to profile other code without using a different
server however, but I&#39;d perfectly understand that you don&#39;t want to keep
chasing this weird bug that affects so few users. Otherwise, I&#39;m
available for more debugging :-&#41;

In any case, thanks a lot for the prompt support and the great software!

-Thomas.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-509837" href="/Public/Bug/Display.html?id=39396#txn-509837">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;18&nbsp;12:10:42&nbsp;2008</span>
    <span class="description">Tim.Bunce [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #39396] Re: Weird errors using NYTProf</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 18 Sep 2008 18:10:18 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Thomas Equeter via RT &lt;bug-devel-nytprof [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tim Bunce &lt;Tim.Bunce [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/509837/253820/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/253820">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Sep 18, 2008 at 11:35:41AM -0400, Thomas Equeter via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; On Thu, Sep 18, 2008 at 10:29:28AM +0100, Tim Bunce wrote:
<div class="message-stanza open">&gt; &gt; Are you using compression? &#40;&#34;strings nytprof.out | head&#34; will
&gt; &gt; show a line starting with &#34;# Compressed ...&#34; if you are.&#41;
</div>&gt; 
&gt; No such line on the dev server nor on my workstation &#40;where NYTProf
&gt; works&#41;.
&gt; 
<div class="message-stanza open">&gt; &gt; Please try a &#34;make test&#34; after an &#34;svn update&#34;. I&#39;ve added a new
&gt; &gt; test &#40;t/50.errno.t&#41; that tries to test this.
</div>&gt; 
&gt; It hits the nail right on the head: both $! tests fail &#40;lines 19 and
&gt; 33&#41;.
</div>
Great.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This said, in the meantime I&#39;ve managed to get an other server for my
&gt; purposes. As it runs NYTProf flawlessly, I&#39;ve been able to locate and
&gt; refactorise the chunk of code which was hogging the CPU. Therefore,
&gt; running NYTProf on the dev server is not an emergency anymore.
&gt; 
&gt; It would still be useful to profile other code without using a different
&gt; server however, but I&#39;d perfectly understand that you don&#39;t want to keep
&gt; chasing this weird bug that affects so few users. Otherwise, I&#39;m
&gt; available for more debugging :-&#41;
</div>
Thanks! Please sprinkle
    if &#40;errno&#41; warn&#40;&#34;errno %d&#34;,errno&#41;;
through the DB_stmt&#40;&#41; code, plus a errno=0 at the top, to try to pin
point where it&#39;s changed.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In any case, thanks a lot for the prompt support and the great software!
</div>
You&#39;re welcome.

Tim.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-509838" href="/Public/Bug/Display.html?id=39396#txn-509838">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;18&nbsp;12:10:47&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-510251" href="/Public/Bug/Display.html?id=39396#txn-510251">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;19&nbsp;11:55:31&nbsp;2008</span>
    <span class="description">thomas.equeter [...] ovh.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #39396] Re: Weird errors using NYTProf</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 19 Sep 2008 17:32:20 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Tim Bunce via RT &lt;bug-devel-nytprof [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Thomas Equeter &lt;thomas.equeter [...] ovh.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/510251/254093/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/254093">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 602b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Sep 18, 2008 at 12:10:47PM -0400, Tim Bunce via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks! Please sprinkle
&gt;     if &#40;errno&#41; warn&#40;&#34;errno %d&#34;,errno&#41;;
&gt; through the DB_stmt&#40;&#41; code, plus a errno=0 at the top, to try to pin
&gt; point where it&#39;s changed.
</div>
Hah, finally found it! CLOCK_MONOTONIC is defined in the headers but not
supported by Linux 2.4, or so it seems. Forcing the macro CLOCK_GETTIME
to compile as &#34;clock_gettime&#40;CLOCK_REALTIME, ts&#41;&#34; works around the
problem &#40;all the tests pass, in particular 10 and 50&#41;.

Now that I think about it, it&#39;s funny that test10 was screaming the
answer since day 1 :-&#41;

-Thomas.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-515443" href="/Public/Bug/Display.html?id=39396#txn-515443">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;02&nbsp;11:08:35&nbsp;2008</span>
    <span class="description">TIMB [...] cpan.org - Ticket #39332:  Merged into ticket #39396</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-515444" href="/Public/Bug/Display.html?id=39396#txn-515444">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;02&nbsp;11:08:35&nbsp;2008</span>
    <span class="description">TIMB [...] cpan.org -  Merged into ticket #39396</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-515770" href="/Public/Bug/Display.html?id=39396#txn-515770">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;03&nbsp;10:03:52&nbsp;2008</span>
    <span class="description">TIMB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/515770/257150/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/257150">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 63b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixed now &#40;r485&#41; thanks to some sleuthing work by Slaven Rezic.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-515773" href="/Public/Bug/Display.html?id=39396#txn-515773">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;03&nbsp;10:03:55&nbsp;2008</span>
    <span class="description">TIMB [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.539967</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
