<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #57704 for threads-shared: &#34;scalar keys %hash&#34; return different results with a shared %hash in  different ithreads</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #57704 for threads-shared: &#34;scalar keys %hash&#34; return different results with a shared %hash in  different ithreads</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/threads-shared/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/threads-shared/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/threads-shared/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/threads-shared/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/threads-shared">threads-shared CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">57704</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/threads-shared/Active/">threads-shared</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
huangwq.bnu [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-32722-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-32723-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




MinGOA<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/780168/404046/MinGOA">
Fri May 21 05:01:54 2010 (834b) by huangwq.bnu [...] gmail.com
</a>
</font></li>
</ul>


rs_threads_shared_hash.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1116744/587452/rs_threads_shared_hash.pl">
Wed Sep 05 11:30:17 2012 (7.5k) by jdhedden [...] cpan.org
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/780168/404047/rs_threads_shared_hash.pl">
Fri May 21 05:01:54 2010 (7.3k) by huangwq.bnu [...] gmail.com
</a>
</font></li>
</ul>


used_rss_cc<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/780168/404048/used_rss_cc">
Fri May 21 05:01:58 2010 (1971k) by huangwq.bnu [...] gmail.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;21&nbsp;05:01:54&nbsp;2010</span>
    <span class="description">huangwq.bnu [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> &#34;scalar keys %hash&#34; return different results with a shared %hash in  different ithreads</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 21 May 2010 17:01:04 +0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-threads-shared [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> WeiQi Huang &lt;huangwq.bnu [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dear friend,

Maybe this is not an appropriate place to send my bug-report, as either
&#34;keys&#34; or &#34;shared&#34;&#40;or ever othes&#41; would be a possilbe source to this
unexpected result.

As abbreviated in title, i tried my script on perl 5.8.8&#40;@RHEL5 cluster&#41;,
ActivePerl 5.10.1&#40;@WIN XP SP3&#41;, and Strawberry Perl 5.12.0@&#40;@WIN XP SP3&#41;,
with same result.

no clue can be found when i look into perl code of &#34;threads::shared&#34;,
and, when come into source code of perl 5.12.0, i feel faint immediately.

a simplified version of my script&#40;rs_threads_shared_hash.pl&#41; and two test
data file are presented in attachment.

thanks for your inspection.


yours

^_^

huang
</div></div>

<div class="messagebody">
</div>
</div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/780168/404046/MinGOA">Download MinGOA</a><br />
<span class="downloadcontenttype">application/octet-stream 834b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/780168/404048/used_rss_cc">Download used_rss_cc</a><br />
<span class="downloadcontenttype">application/octet-stream 1.9m</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;05&nbsp;11:30:17&nbsp;2012</span>
    <span class="description">jdhedden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2010-05-21 05:01:54, huangwq.bnu@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Dear friend,
&gt; 
&gt; Maybe this is not an appropriate place to send my bug-report, as 
</div>either
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#34;keys&#34; or &#34;shared&#34;&#40;or ever othes&#41; would be a possilbe source to this
&gt; unexpected result.
&gt; 
&gt; As abbreviated in title, i tried my script on perl 5.8.8&#40;@RHEL5 
</div>cluster&#41;,
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ActivePerl 5.10.1&#40;@WIN XP SP3&#41;, and Strawberry Perl 5.12.0@&#40;@WIN XP 
</div>SP3&#41;,
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; with same result.
&gt; 
&gt; no clue can be found when i look into perl code of &#34;threads::shared&#34;,
&gt; and, when come into source code of perl 5.12.0, i feel faint 
</div>immediately.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; a simplified version of my script&#40;rs_threads_shared_hash.pl&#41; and two 
</div>test
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; data file are presented in attachment.
&gt; 
&gt; thanks for your inspection.
&gt; 
&gt; 
&gt; yours
&gt; 
&gt; ^_^
&gt; 
&gt; huang
</div>

Sorry for the time delay on this.

The problem is a bug in your script.  You must never access a shared 
variable without first locking it.

You can see where I did this in the attached.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> rs_threads_shared_hash.pl</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl

use strict;
use warnings;

use threads;
use threads::shared;

use constant GENE       =&gt; 0;
use constant ANNO_TERM  =&gt; 1;

use constant ROUND_NUM  =&gt; 2;

use constant TRUE       =&gt; -1;
use constant FALSE      =&gt; 0;

use constant SUCCESS    =&gt; -1;
use constant FAILURE    =&gt; 0;

my $which_go        = &#39;C&#39;;   # BP, CC, or MF?
my $goa_file        = &#39;MinGOA&#39;;
my $rss_tab_file    = &#39;used_rss_cc&#39;;


#======== Subroutine protypes ========

sub load_gene_term_list&#40;$\@&#41;;
sub load_term_rss_lookup_tab&#40;\%&#41;;   # \% - %rss_lookup_tab
sub gen_gene_pair_rss&#40;\@\%&#41;;      	# \@ - @go_annos
                                    # \% - %rss_lookup_tab
sub rnd_sim_thread_safe&#40;$$;$&#41;;      # $ - $start_index
                                    # $ - $end_index
                                    # $ - $thread_index

#===== End of subroutine protypes =====



####========  Main procedure begins  ========####
my @genes;
my %rssLookup   :shared;

my $thread_id;
my @thread_ids;
my $thread_num      = 2;    # total thread number&#40;including main thread&#41;


if &#40;$thread_num &gt; 0&#41; {  # multi-thread mode

    $thread_id = threads-&gt;create&#40;\&#38;load_term_rss_lookup_tab,
                    \%rssLookup &#41;;

    load_gene_term_list&#40;$goa_file, @genes&#41;;

    if &#40;$thread_id-&gt;join&#40;&#41; == FAILURE&#41; {die &#39;Load %rssLookup failure.&#39;, &#34;\n&#34;;}
    else {
        print STDERR scalar keys %rssLookup, &#39; returned in %rssLookup.&#39; ,&#34;\n&#34;;
    }

    my $step    = int&#40; ROUND_NUM / $thread_num &#41;;
    my $ei      = ROUND_NUM;
    my $si      = $ei - $step;

    while &#40; --$thread_num &#41; {

        $thread_id = threads-&gt;create&#40; \&#38;rnd_sim_thread_safe, 
                            &#40;$si, $ei, $thread_num&#41; &#41;;
        push @thread_ids, $thread_id;
        $ei -= $step;
        $si -= $step;
    }

    rnd_sim_thread_safe&#40;0, $ei, 0&#41;; # thread_id 0 always refers to myself.
                                    # and, i should finish the rest rounds
                                    # of simulation &#40;remain undispatced&#41;.

    foreach $thread_id &#40;@thread_ids&#41; {
        $thread_id -&gt; join&#40;&#41;;
    }

} # if&#40;$thread_num &gt; 0&#41;
else {  # single-thread mode
    load_gene_term_list&#40;$goa_file, @genes&#41;;

    load_term_rss_lookup_tab&#40;%rssLookup&#41;;

    rnd_sim_thread_safe&#40;0, ROUND_NUM&#41;;
}


print STDERR &#39;Done!&#39;, &#34;\n&#34;;

#---- Thread-safe code begins ----
sub rnd_sim_thread_safe&#40;$$;$&#41; {

    my &#40;$s_index, $e_index, $thread_id&#41; = @_;
	my $rss_dist_hashref;

    if &#40; !defined&#40;$s_index&#41; || !defined&#40;$e_index&#41; &#41; {
        print STDERR &#34;Bad paras: rnd_sim&#40;$s_index, $e_index, $thread_id&#41;.\n&#34;;
        return FAILURE;
    }

    if &#40; !defined&#40;$thread_id&#41; &#41; { $thread_id = &#39;0&#39;; } # master thread

    { lock&#40;%rssLookup&#41;;
    # Shared hash will fail in correct generating &#39;keys&#39; in different threads!
    print STDERR &#39;Check size of main data structures in thread &#39;, $thread_id, &#34;:\n&#34;,
		&#34;\t\%rss\t&#34;, scalar keys %rssLookup, &#34;\n&#34;,
            	&#34;\t\@genes\t&#34;, scalar @genes, &#34;\n&#34;;
    if &#40;$thread_id eq &#39;0&#39;&#41; {
        print&#40;Dumper&#40;\%rssLookup&#41;&#41;;
    } else {
        print&#40;STDERR Dumper&#40;\%rssLookup&#41;&#41;;
    }
}

    print STDERR scalar localtime, 
        &#34;| Thread $thread_id runs [$s_index, $e_index&#41;.\n&#34;;

    for &#40;my $i = $s_index; $i &lt; $e_index; $i += 1&#41; {
        print STDERR scalar localtime, &#34;| Thread $thread_id\tRound $i\n&#34;;

        { lock&#40;%rssLookup&#41;;
          $rss_dist_hashref = gen_gene_pair_rss&#40;@genes, %rssLookup&#41;;
      }
	
	write_dist&#40;$rss_dist_hashref&#41;;
    }

    return SUCCESS;
}
#---- Thread-saft code ends ----

####========  Main procedure ends  ========####


#============  Subroutines definitions  ============#

sub load_gene_term_list&#40;$\@&#41; {
#1. Load GOA file into a hash, terms annotated to same gene&#40;product&#41; will be
#	pushed into a list referenced by hash-value of that gene&#40;used as key&#41;.
#2. Transform GOA hash into GOA AoAoA.

    my &#40;$goa_file, $goa_ref&#41; = @_;
	my %goa;
    my $item;
    my @fields;
    my $GF;

    if &#40; !defined&#40;$goa_file&#41; || !defined&#40;$goa_ref&#41; &#41; {
        return FAILURE;
    }

    open&#40;$GF, $goa_file&#41; or return FAILURE;

    while &#40;$item = &lt;$GF&gt;&#41; {
        chomp $item;
        @fields = split &#34;\t&#34;, $item;
        push @{$goa{$fields[GENE]}}, $fields[ANNO_TERM];
    }

    close&#40;$GF&#41;;

	undef @$goa_ref;	# Clear
	foreach $item &#40;keys %goa&#41; {
		push&#40;@$goa_ref, [$item, $goa{$item}] &#41;;
	}

    return scalar @$goa_ref;

}


sub load_term_rss_lookup_tab&#40;\%&#41; {
# Input:
#     %lookup_hash;
# Output:
#     $number of rows if success, otherwise 0&#40;i.e. FAILURE&#41;.

    my $rss_lookup_ref = shift;
    my $row_num;

    if &#40; !defined&#40;$rss_lookup_ref&#41; &#41; {
        print STDERR &#34;Bad paras: load_lookup&#40;$rss_lookup_ref&#41;.\n&#34;;
        return FAILURE;
    };

    open&#40; IF, $rss_tab_file &#41;
			or die &#39;Fail to open hash data file - &#39;, $!, &#34;.\n&#34;;

	$row_num = 0;
	while &#40;&lt;IF&gt;&#41; {
		$row_num ++;
		chomp;
		my &#40;$term1, $term2, $rss&#41; = split &#34;\t&#34;;
		$rss_lookup_ref-&gt;{&#34;$term1-$term2&#34;} = $rss;
    }
	
	close&#40;IF&#41;;
	
    return $row_num;
}


sub gen_gene_pair_rss&#40;\@\%&#41; {

    my &#40;$goa_ref, $rss_of_ref&#41; = @_;
    my &#40;$pi, $qi, $pterm, $qterm&#41;;
    my &#40;$rss, $max_rss, $zone&#41;;
    my %count_of    = &#40; &#39;[0.0]&#39;         =&gt; 0,
                        &#39;&#40;0.0, 0.1]&#39;    =&gt; 0,
                        &#39;&#40;0.1, 0.2]&#39;    =&gt; 0,
                        &#39;&#40;0.2, 0.3]&#39;    =&gt; 0,
                        &#39;&#40;0.3, 0.4]&#39;    =&gt; 0,
                        &#39;&#40;0.4, 0.5]&#39;    =&gt; 0,
                        &#39;&#40;0.5, 0.6]&#39;    =&gt; 0,
                        &#39;&#40;0.6, 0.7]&#39;    =&gt; 0,
                        &#39;&#40;0.7, 0.8]&#39;    =&gt; 0,
                        &#39;&#40;0.8, 0.9]&#39;    =&gt; 0,
                        &#39;&#40;0.9, 1.0]&#39;    =&gt; 0,
                        &#41;;

    if &#40; !defined&#40;$goa_ref&#41; || !defined&#40;$rss_of_ref&#41; &#41; {
        return FAILURE;
    }
    
        
    for &#40;$pi = 0; $pi &lt;= $#$goa_ref; $pi += 1&#41; {
        for &#40;$qi = $pi; $qi &lt;= $#$goa_ref; $qi += 1&#41; { # &#40;$qi = $pi + 1&#41; ?

            $rss = 0.0;
            $max_rss = 0.0;

            foreach $pterm &#40;@{$goa_ref-&gt;[$pi]-&gt;[ANNO_TERM]}&#41; {
                foreach $qterm &#40;@{$goa_ref-&gt;[$qi]-&gt;[ANNO_TERM]}&#41; {
                    if &#40;exists $rss_of_ref-&gt;{&#34;$pterm-$qterm&#34;} &#41; {
                        $rss = $rss_of_ref-&gt;{&#34;$pterm-$qterm&#34;}
                    }
                    else {
                        $rss = $rss_of_ref-&gt;{&#34;$qterm-$pterm&#34;}
				    }
				    if &#40; defined&#40;$rss&#41; &#41; {
					    if &#40;$rss &gt; $max_rss&#41; {$max_rss = $rss;}
				    }
			    } # foreach $qterm
		    } # foreach $pterm
			
			# for each gene-pair, we check for which zone its rss falls into.
			$zone = $max_rss = 0    ? &#39;[0.0]&#39;
				  : $max_rss &lt;= 0.1 ? &#39;&#40;0.0, 0.1]&#39;
				  : $max_rss &lt;= 0.2 ? &#39;&#40;0.1, 0.2]&#39;
				  : $max_rss &lt;= 0.3 ? &#39;&#40;0.2, 0.3]&#39;
				  : $max_rss &lt;= 0.4 ? &#39;&#40;0.3, 0.4]&#39;
				  : $max_rss &lt;= 0.5 ? &#39;&#40;0.4, 0.5]&#39;
				  : $max_rss &lt;= 0.6 ? &#39;&#40;0.5, 0.6]&#39;
				  : $max_rss &lt;= 0.7 ? &#39;&#40;0.6, 0.7]&#39;
				  : $max_rss &lt;= 0.8 ? &#39;&#40;0.7, 0.8]&#39;
				  : $max_rss &lt;= 0.9 ? &#39;&#40;0.8, 0.9]&#39;
				  : $max_rss &lt;= 1.0 ? &#39;&#40;0.9, 1.0]&#39;
				  :                   undef
				  ;
			if &#40; defined&#40;$zone&#41; &#41; { $count_of{$zone} += 1 }
#			else { #TODO: Warning? }
			
	    } # foreach $qi

    } # foreach $pi

    return \%count_of;
}


sub write_dist&#40;$&#41; {

    my $dist_hashref = shift;

    print $dist_hashref-&gt;{&#39;[0.0]&#39;       }, &#34;\t&#34;;
    print $dist_hashref-&gt;{&#39;&#40;0.0, 0.1]&#39;  }, &#34;\t&#34;;
    print $dist_hashref-&gt;{&#39;&#40;0.1, 0.2]&#39;  }, &#34;\t&#34;;
    print $dist_hashref-&gt;{&#39;&#40;0.2, 0.3]&#39;  }, &#34;\t&#34;;
    print $dist_hashref-&gt;{&#39;&#40;0.3, 0.4]&#39;  }, &#34;\t&#34;;
    print $dist_hashref-&gt;{&#39;&#40;0.4, 0.5]&#39;  }, &#34;\t&#34;;
    print $dist_hashref-&gt;{&#39;&#40;0.5, 0.6]&#39;  }, &#34;\t&#34;;
    print $dist_hashref-&gt;{&#39;&#40;0.6, 0.7]&#39;  }, &#34;\t&#34;;
    print $dist_hashref-&gt;{&#39;&#40;0.7, 0.8]&#39;  }, &#34;\t&#34;;
    print $dist_hashref-&gt;{&#39;&#40;0.8, 0.9]&#39;  }, &#34;\t&#34;;
    print $dist_hashref-&gt;{&#39;&#40;0.9, 1.0]&#39;  }, &#34;\n&#34;;    # EOL

}

#============  Subroutine definition ends  =============#
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;05&nbsp;11:30:20&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;05&nbsp;11:30:20&nbsp;2012</span>
    <span class="description">jdhedden [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
