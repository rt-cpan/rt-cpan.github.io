<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #120401 for PDF-Reuse: Reads the entire contents when extracting a single page</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #120401 for PDF-Reuse: Reads the entire contents when extracting a single page</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=PDF-Reuse">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=PDF-Reuse">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=PDF-Reuse">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=PDF-Reuse">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/PDF-Reuse">PDF-Reuse CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">120401</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">patched</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=PDF-Reuse">PDF-Reuse</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">cnighs [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
&#39;spro^^*%*^6ut# [...] &#38;$%*c

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-25004-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-25005-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




open_7PxhnnHY.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1708014/917600/open_7PxhnnHY.txt">
Tue Feb 28 14:13:06 2017 (777b) by $_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=120401">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1707308" href="/Public/Bug/Display.html?id=120401#txn-1707308">#</a>      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;26&nbsp;18:21:15&nbsp;2017</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Reads the entire contents when extracting a single page</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1707308/917220/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/917220">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 505b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Both prDoc and prSinglePage read the entire contents of the source PDF, even when extracting just a single page.

I tried extracting a page from a 160MB PDF with:

prFile&#40;&#34;pr.pdf&#34;&#41;; prSinglePage&#40;&#39;source.pdf&#39;, 1&#41;; prEnd&#40;&#41;;

And it produced a 160MB file with one page.

Since I made the same mistake when writing PDF::Tiny, my guess is that you are following the pageâ€™s /Parent pointer, which points to the page tree, which points to all the other pages, and dragging them in, too, when importing a page.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1707552" href="/Public/Bug/Display.html?id=120401#txn-1707552">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;27&nbsp;09:10:16&nbsp;2017</span>
    <span class="description">cnighs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1707552/917352/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/917352">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 53b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Do you think that this is this related to bug #120346
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1707553" href="/Public/Bug/Display.html?id=120401#txn-1707553">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;27&nbsp;09:10:16&nbsp;2017</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1707556" href="/Public/Bug/Display.html?id=120401#txn-1707556">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;27&nbsp;09:10:27&nbsp;2017</span>
    <span class="description">cnighs [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1707561" href="/Public/Bug/Display.html?id=120401#txn-1707561">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;27&nbsp;10:33:44&nbsp;2017</span>
    <span class="description">cnighs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1707561/917358/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/917358">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 279b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Feb 27 09:10:16 2017, CNIGHS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Do you think that this is this related to bug #120346
</div>
Actually I see it is not.

I have noticed this issue before. I&#39;m reading over the code trying to understand what&#39;s going  on. Unfortunately, I did not write the original code...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1707567" href="/Public/Bug/Display.html?id=120401#txn-1707567">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;27&nbsp;10:38:31&nbsp;2017</span>
    <span class="description">cnighs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1707567/917364/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/917364">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 155b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve created a branch for this bug.

Here is the relevant sub &#40;I think&#41;:

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/cnighswonger/PDF-Reuse/blob/bugs/120401/lib/PDF/Reuse.pm#L5965">https://github.com/cnighswonger/PDF-Reuse/blob/bugs/120401/lib/PDF/Reuse.pm#L5965</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1707570" href="/Public/Bug/Display.html?id=120401#txn-1707570">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;27&nbsp;10:51:28&nbsp;2017</span>
    <span class="description">cnighs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1707570/917367/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/917367">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 344b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I think this might be related to 120346 after all. This is suspect:

m&#39;/Pages\s+&#40;\d+&#41;\s{1,2}\d+\s{1,2}R&#39;os

at <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/cnighswonger/PDF-Reuse/blob/bugs/120401/lib/PDF/Reuse.pm#L6062">https://github.com/cnighswonger/PDF-Reuse/blob/bugs/120401/lib/PDF/Reuse.pm#L6062</a></span>

I wonder if the whitespace issue is causing things to get confused, and we end up with the entire original pdf rather than just the page&#40;s&#41; we wanted?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1707936" href="/Public/Bug/Display.html?id=120401#txn-1707936">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;28&nbsp;01:26:45&nbsp;2017</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1707936/917554/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/917554">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 760b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Feb 27 10:51:28 2017, CNIGHS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think this might be related to 120346 after all. This is suspect:
&gt; 
&gt; m&#39;/Pages\s+&#40;\d+&#41;\s{1,2}\d+\s{1,2}R&#39;os
&gt; 
&gt; at <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/cnighswonger/PDF-">https://github.com/cnighswonger/PDF-</a></span>
&gt; Reuse/blob/bugs/120401/lib/PDF/Reuse.pm#L6062
&gt; 
&gt; I wonder if the whitespace issue is causing things to get confused,
&gt; and we end up with the entire original pdf rather than just the
&gt; page&#40;s&#41; we wanted?
</div>
I donâ€™t believe it is.  The PDF in question is generated by ABBYY FineReader, which uses single spaces in references.  &#40;And it is 169 MB, so it is a bit hard to share.&#41;

I tried extracting a couple of pages from it with PDF::API2 and then extracting one page from the result with PDF::Reuse, and the problem went away.

Iâ€™m still looking into it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1708014" href="/Public/Bug/Display.html?id=120401#txn-1708014">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;28&nbsp;14:13:05&nbsp;2017</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1708014/917599/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/917599">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Feb 28 01:26:45 2017, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Feb 27 10:51:28 2017, CNIGHS wrote:
<div class="message-stanza open">&gt; &gt; I think this might be related to 120346 after all. This is suspect:
&gt; &gt;
&gt; &gt; m&#39;/Pages\s+&#40;\d+&#41;\s{1,2}\d+\s{1,2}R&#39;os
&gt; &gt;
&gt; &gt; at <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/cnighswonger/PDF-">https://github.com/cnighswonger/PDF-</a></span>
&gt; &gt; Reuse/blob/bugs/120401/lib/PDF/Reuse.pm#L6062
&gt; &gt;
&gt; &gt; I wonder if the whitespace issue is causing things to get confused,
&gt; &gt; and we end up with the entire original pdf rather than just the
&gt; &gt; page&#40;s&#41; we wanted?
</div>&gt; 
&gt; I donâ€™t believe it is.  The PDF in question is generated by ABBYY
&gt; FineReader, which uses single spaces in references.  &#40;And it is 169
&gt; MB, so it is a bit hard to share.&#41;
&gt; 
&gt; I tried extracting a couple of pages from it with PDF::API2 and then
&gt; extracting one page from the result with PDF::Reuse, and the problem
&gt; went away.
&gt; 
&gt; Iâ€™m still looking into it.
</div>
Iâ€™ve found the problem.  ABBYY FineReader sometimes puts a couple of whitespace characters at the offset indicated by startxref, before the xref keyword.  PDF::Reuse assumes that the word â€˜xrefâ€™, followed by a return, occurs at that location, so it skips 5 bytes before reading the xref entries.  So for the PDF in question it was starting at the â€˜fâ€™ in xref and, not seeing any numbers on that line, assumed it had reached the end.

Since the PDF was linearized and had two cross-reference tables, it was only reading the first one &#40;with about 50 entries&#41;, whereas the combined cross-reference table was supposed to have nearly two thousand entries.

The way PDF::Reuse reads objects is interesting.  It sorts all the offsets in the xref table and then uses them to determine how many bytes to read for each object, under the assumption that the next offset marks the end of the object.  &#40;Makes sense.  It also makes PDF::Reuse immune to bugs like #120397.&#41;

if the xref table was misread, then the objects whose xref entries were not read will be considered part of whichever object preceded them in the file.  So *that* explains the file bloat.

With the attached patch, PDF::Reuse will extract a page from my 169.5 MB file in a split second, rather than 15 seconds.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> open_7PxhnnHY.txt</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1708014/917600/open_7PxhnnHY.txt">Download open_7PxhnnHY.txt</a><br />
<span class="downloadcontenttype">text/plain 777b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- /Users/sprout/.cpan/build/PDF-Reuse-0.39-tvZelW/lib/PDF/Reuse.pm	2016-09-27 08:48:32.000000000 -0700
+++ /Users/sprout/Perl/dist/PDF-Tiny/lib/PDF/Reuse.pm	2017-02-28 11:03:51.000000000 -0800
@@ -4479,11 +4480,19 @@
     my &#40;$i, $root, $antal&#41;;
     $nr++;
     $oldObject{&#40;&#39;xref&#39; . &#34;$nr&#34;&#41;} = $xref;  # Offset fÃ¶r xref sparas
-    $xref += 5;
     sysseek INFIL, $xref, 0;
+    sysread INFIL, my $buf, 30;
+    if &#40;$buf =~ /xref/&#41; {
+        sysseek INFIL, $xref+$-[0]+5, 0;
+    }
+    else {
+       # If the regexp fails &#40;it shouldn&#39;t&#41;, fall back to the previous
+       # behaviour.
+       sysseek INFIL, $xref + 5, 0;
+    }
     $xref  = 0;
     my $inrad = &#39;&#39;;
-    my $buf   = &#39;&#39;;
+    $buf   = &#39;&#39;;
     my $c;
     sysread INFIL, $c, 1;
     while &#40;$c =~ m!\s!s&#41;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1708088" href="/Public/Bug/Display.html?id=120401#txn-1708088">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;28&nbsp;18:52:16&nbsp;2017</span>
    <span class="description">cnighs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1708088/917639/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/917639">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 187b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">That looks great.

I&#39;ve pushed this up to the related branch and will include it in the next release.

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/cnighswonger/PDF-Reuse/commits/bugs/120401">https://github.com/cnighswonger/PDF-Reuse/commits/bugs/120401</a></span>

Thanks for your help!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1708091" href="/Public/Bug/Display.html?id=120401#txn-1708091">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;28&nbsp;18:52:22&nbsp;2017</span>
    <span class="description">cnighs [...] cpan.org -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.514469</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
