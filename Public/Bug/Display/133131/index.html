<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #133131 for PDF-API2: how do I file an issue for PDF::API2?</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #133131 for PDF-API2: how do I file an issue for PDF::API2?</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/PDF-API2/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/PDF-API2/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/PDF-API2/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/PDF-API2/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/PDF-API2">PDF-API2 CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">133131</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/PDF-API2/Active/">PDF-API2</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
Christopher.Papademetrious [...] synopsys.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-24958-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-24959-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




bad.pdf<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1907715/1022095/bad.pdf">
Sat Aug 08 14:26:24 2020 (6.9k) by chrispitude [...] gmail.com
</a>
</font></li>
</ul>


bad2.pdf<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1907739/1022108/bad2.pdf">
Sat Aug 08 16:15:08 2020 (7.2k) by chrispitude [...] gmail.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;08&nbsp;11:48:56&nbsp;2020</span>
    <span class="description">Christopher.Papademetrious [...] synopsys.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> how do I file an issue for PDF::API2?</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 8 Aug 2020 15:42:53 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-PDF-API2 [...] rt.cpan.org&#34; &lt;bug-PDF-API2 [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Chris Papademetrious &lt;Christopher.Papademetrious [...] synopsys.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Steve,

I hope this email finds you at all! We&#39;re using PDF::API2 at our company, and I ran into a PDF that it doesn&#39;t like:

Reading &#39;chrispy/fcdm.pdf&#39;...
Can&#39;t parse `&#39; near 2316292767724077056 length 0. at /u/doc/perl5/lib/perl5/PDF/API2/Basic/PDF/File.pm line 694.

The parser hits a zero-length string and doesn&#39;t know what to do with it. I was going to file an issue in the Github repo, but there&#39;s no &#34;Issues&#34; tab like I see for other repos.

How do you suggest that I proceed?

And thank you for taking on ownership of this repo! It&#39;s a tremendously powerful library, and there&#39;s not an alternative that does everything that it does.

-----
Chris Papademetrious
Tech Writer, Implementation Group
&#40;610&#41; 628-9718 home office
&#40;570&#41; 460-6078 cell
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;08&nbsp;11:51:54&nbsp;2020</span>
    <span class="description">chrispitude [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ugh, I didn&#39;t realize this was going to create a ticket. I guess you&#39;re using rt.cpan.org for issue tracking but Github for revision control?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;08&nbsp;11:51:55&nbsp;2020</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;08&nbsp;12:43:44&nbsp;2020</span>
    <span class="description">PMPERRY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">An empty string $str was fed to the readval&#40;&#41; method, so it doesn&#39;t know what to do &#40;how to handle it&#41;. Can you tell us what you were trying to do &#40;read in an existing PDF?&#41; and maybe show a small test case Perl code? Feeding an empty &#40;or nonsense format&#41; string &#40;PDF file content&#41; into this routine will produce this error, but we need to figure out what happened &#34;upstream&#34; that triggered it.

A file offset of 232 quadrillion? That&#39;s bigger than any PDF file I&#39;ve ever heard of, and possibly bigger than any filesystem can handle. Something seems to have gone very wrong there, but without knowing what you were doing, it&#39;s hard to diagnose.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; there&#39;s not an alternative that does everything that it does
</div>
If you think that your PDF you&#39;re reading in is OK &#40;loads OK in all the readers you try, AND NO READER ASKS PERMISSION TO SAVE THE FILE WHEN YOU EXIT IT&#41;, you might give PDF::Builder a try and see if that works any better. Maybe something upstream is different enough to get past whatever is causing the problem. It includes instructions on porting from PDF::API2, but usually just changing &#34;PDF::API2&#34; to &#34;PDF::Builder&#34; in your Perl code will do the job.

By the way, if your PDF is PDF version 1.5 or higher, that can blow up PDF::API2. Builder might handle it a little better, but no promises.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;08&nbsp;14:26:24&nbsp;2020</span>
    <span class="description">chrispitude [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> PDF::API2 unable to open a compressed-stream PDF file</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks Phil! Given the history described in your docs and your desire for more aggressive issue resolution, it appears I should indeed be using PDF::Builder instead.

I&#39;m trying to open a PDF file written out by an authoring/publishing tool:

#!/usr/bin/perl
use PDF::Builder;
my $pdf = PDF::Builder-&gt;open&#40;&#39;bad.pdf&#39;&#41;;

I&#39;ve isolated the issue to a single-page 7k PDF that fails to load in PDF::API2 and PDF::Builder, yet reads into Ghostscript &#40;and every other tool I&#39;ve tried&#41; without complaint.

I tried decompressing the streams with

qpdf --qdf --object-streams=disable bad.pdf bad_decompressed.pdf

but PDF::API2 and PDF::Builder are both able to read the stream-decompressed version of the file. I&#39;m attaching the problematic PDF file for your thoughts.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> bad.pdf</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1907715/1022095/bad.pdf">Download bad.pdf</a><br />
<span class="downloadcontenttype">application/pdf 6.9k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;08&nbsp;16:15:08&nbsp;2020</span>
    <span class="description">chrispitude [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The bad.pdf attachment in the previous message is 7164 bytes:

% ls -l bad.pdf
-rwxrwxrwx 1 chrispy chrispy 7164 Aug  8 14:21 bad.pdf

It fails with an error about parsing an endstream construct:

====
Reading &#39;bad.pdf&#39;...
Can&#39;t parse `endstream
endobj

startxref
6737
%%EOF

&#39; near 7165 length 40. at /usr/local/share/perl/5.26.1/PDF/Builder/Basic/PDF/File.pm line 726.
====

I have another PDF file, bad2.pdf &#40;attached to this message&#41; that is 7406 bytes, but fails with an error about parsing an empty string:

====
Reading &#39;bad2.pdf&#39;...
Can&#39;t parse `&#39; near 6419318318863220736 length 0. at /usr/local/share/perl/5.26.1/PDF/Builder/Basic/PDF/File.pm line 726.
====

If I add or remove a few characters in the authoring tool, the resulting PDF fails with either the endstream message or the empty-string message. I suspect they&#39;re both variants of the same boundary behavior in the parsing.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> bad2.pdf</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1907739/1022108/bad2.pdf">Download bad2.pdf</a><br />
<span class="downloadcontenttype">application/pdf 7.2k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;08&nbsp;19:31:23&nbsp;2020</span>
    <span class="description">PMPERRY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I can see a major problem right away. A PDF-1.4 file should have &#39;startxref&#39; pointing to the cross-reference TABLE headed by &#39;xref&#39; and the starting object and length. Instead, your &#39;bad.pdf&#39; startxref is pointing to an object of type XRef, which appears to be a cross-reference STREAM. The minimum PDF level for a cross-reference stream is 1.5. Any idea how a PDF with 1.5 level features was labeled as 1.4? I don&#39;t think it&#39;s going to work.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;08&nbsp;19:47:14&nbsp;2020</span>
    <span class="description">PMPERRY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">When I uncompressed the content streams, using PDFtk, it also worked with the &#39;open&#39; call. I see that PDFtk gave me a proper PDF-1.4 cross-reference table structure when it created the new PDF, and this may have happened to you with qpdf.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;09&nbsp;08:19:09&nbsp;2020</span>
    <span class="description">chrispitude [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Phil,

Thanks for debugging the problem! Now I know the issue is with the PDF itself, not the parsing code. I&#39;ll take this up with the software vendor. And I&#39;m going to have a closer look at PDF::Builder today - thanks for your efforts on this too!

Admins, feel free to close this ticket. &#40;I don&#39;t have permissions to do so.&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;09&nbsp;10:08:17&nbsp;2020</span>
    <span class="description">PMPERRY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Chris,

I can&#39;t guarantee that is the problem, but using a cross-reference stream in a PDF-1.4 document looks very suspicious to me. Certainly you should take it up with the vendor and see if they have an explanation for that &#40;and why they feel it&#39;s OK to do&#41;. Please get back to us with whatever you find.

Since you opened this ticket by mail, I&#39;m not sure you can close it yourself. If you can&#39;t, only Steve &#40;the owner&#41; can.

If you have any issues with PDF::Builder, please use its GitHub issues area to discuss them. Please don&#39;t clutter up PDF::API2&#39;s CPAN RT area with other products&#39; issues.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;10&nbsp;07:01:01&nbsp;2020</span>
    <span class="description">futuramedium [...] yandex.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Now I know the issue is with the PDF
&gt; itself, not the parsing code. 
</div>
Actually, it is the issue with parsing code, a bug in PDF::API2. In this line:

<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/release/PDF-API2/source/lib/PDF/API2/Basic/PDF/File.pm#L1146">https://metacpan.org/release/PDF-API2/source/lib/PDF/API2/Basic/PDF/File.pm#L1146</a></span>

the template should be &#39;Q&gt;&#39;. Moreover, limiting possible widths to 1,2,3,4,8 bytes in enclosing subroutine is arbitrary, but &#40;1&#41; at least there&#39;s provision to die noisily; &#40;2&#41; possibility of necessity of any value above 4 is extremely low. There&#39;s probably not much need to re-write the sub except the &#39;&gt;&#39; insertion, but there&#39;s PDF::Tiny, CAM::PDF source for inspiration, if you decide otherwise. + The guys who use 8 bytes to encode offsets in their PDF lib are lazy indeed.

The version in header is overridden by document catalogue entry, so it doesn&#39;t matter.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;10&nbsp;19:42:46&nbsp;2020</span>
    <span class="description">chrispitude [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">futuramedium, THANK YOU!!

Out of 186 PDF that exhibited the problem, your suggested code change fixed all of them. And the same code change worked equally well for both PDF::API2 and PDF::Builder.

We just installed the latest release of our publishing software, and it uses Apache FOP for publishing, so it&#39;s possible that this problematic output construct might occur outside my organization too.

Phil, do you want me to file a PDF::Builder issue for this code change?

And it looks like this ticket should indeed stay open for the change to be made in PDF::API2!

Thanks again to everyone who jumped in and quickly bashed this one out.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;10&nbsp;21:48:54&nbsp;2020</span>
    <span class="description">PMPERRY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">No need to open a PDF::Builder bug ticket... I have this one on file.

I will consider putting the patch in once I have a chance to carefully examine it and determine if it&#39;s really a useful fix, or is just papering over a PDF bug. I&#39;m still very concerned over apparently putting a cross-reference stream &#40;PDF-1.5&#41; into a PDF-1.4 document. It would be nice to hear your vendor&#39;s explanation of why they did it that way. I&#39;m reluctant to allow a PDF-1.5 feature in reading in a PDF-1.4 document. If I can detect that it&#39;s a cross-reference stream, I might be able to bump up the version to 1.5 on the fly, but I have to carefully look at it first.

PDF::API2 &#40;and PDF::Builder&#41; had some code added recently to handle cross-reference streams without blowing up, but I want to make sure I understand the full picture before I start slapping in ad-hoc fixes.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;09&nbsp;21:29:41&nbsp;2020</span>
    <span class="description">PMPERRY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Christopher, did you ever get a chance to ask your vendor why they have a cross-reference stream in a file claimed to be level 1.4? With Vadim&#39;s patch, code that Steve put in earlier to handle this PDF 1.5 feature may be getting it through OK, but I&#39;m still worried about what else may be waiting to go wrong. I still say that the PDF is wrong.

Vadim, if I read the cross-reference stream documentation correctly, it allows widths of 1, 2, 3, 4, and 8. 3 is actually treated as 4, with a 00 byte shoved in front. It seems to say that these fields should be Big-Endian &#40;MSB&#41;. Are we in agreement? Then why &#40;without the &gt; flag&#41; does it properly handle 2, 3, and 4 byte lengths, but treat 8 byte widths as Little-Endian? In other words, why don&#39;t 2, 3, and 4 widths require &#39;&gt;&#39; too? Did the PDF writer create the value Little-Endian, and the &#39;&gt;&#39; turns it around &#40;flips and then reads it Big-Endian&#41;, and if so, why don&#39;t 2, 3, and 4 need this treatment? I&#39;m just uncomfortable with putting this patch in until I understand why &#39;8&#39; is so different -- or was the PDF created incorrectly, with 64-bit integers flipped around?

I have been unable to read the stream directly, as it&#39;s flate compressed, and when uncompressing it, PDFtk changes it to a cross-reference TABLE even if I first change the PDF version to 1.5. So, I can&#39;t see how the original value was stored &#40;as Big-Endian or Little-Endian&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;09&nbsp;22:00:32&nbsp;2020</span>
    <span class="description">PMPERRY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">After I sent off the last post, I figure out how to look at the cross-reference table data &#40;dumping it in File.pm&#41;. Only widths 2 and 8 are used, and in both, the data appears to be Big-Endian &#40;MSB&#41;. So this aspect of the PDF, anyway, appears to have been written correctly. &#39;n&#39; and &#39;N&#39; codes don&#39;t allow &#39;&gt;&#39;, so that&#39;s a moot point. So the question remains, why does &#39;Q&#39; require an explicit &#39;&gt;&#39; to be read correctly, and will this change on machines which are natively Big-Endian &#40;non-Intel chips&#41;? Is it that &#39;Q&#39; allows either way, and if you&#39;re possibly transferring data across chip types, you&#39;d better specify explicitly that the PDF data you&#39;re unpacking with &#39;Q&#39; is Big-Endian? Also, if writing &#40;pack&#41; with &#39;Q&#39;, will it write Little-Endian on an Intel chip?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;14&nbsp;17:19:17&nbsp;2020</span>
    <span class="description">futuramedium [...] yandex.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I read the cross-reference stream documentation correctly, it allows widths of 1, 2, 3, 4, and 8
</div>
No, width can be any, and is not limited, btw

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So the question remains, why does &#39;Q&#39; require an explicit &#39;&gt;&#39; to be read correctly, and will this change on machines which are natively Big-Endian &#40;non-Intel chips&#41;?
</div>
It won&#39;t. To quote the Reference: &#34;Fields [in a cross-reference stream] requiring more than one byte are stored with the high-order byte first.&#34;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; file claimed to be level 1.4
</div>
It didn&#39;t. The Version &#40;&#34;Optional; PDF 1.4&#34;&#41; entry in catalog dictionary takes precedence &#34;if later than the version specified in the file’s header&#34;. So, 1.4-compliant consumer must consult this entry first, before making final decision about version. It follows, that 1.5-compliant consumer &#40;which PDF::API2 is&#41; must try to read cross-reference stream if required, to check that &#34;Version&#34; entry, even if header says &#34;1.4&#34;. It&#39;s a bit of a conundrum, I agree, but it&#39;s how things are.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;15&nbsp;20:00:43&nbsp;2020</span>
    <span class="description">PMPERRY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Nov 14 17:19:17 2020, vadimr wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt; 
<div class="message-stanza open">&gt; &gt; I read the cross-reference stream documentation correctly, it allows
&gt; &gt; widths of 1, 2, 3, 4, and 8
</div>&gt; 
&gt; No, width can be any, and is not limited, btw
</div>
I&#39;m not following you. The width field is one of those widths &#40;integer byte size&#41;, isn&#39;t it? The resulting width integer can of course be any legitimate positive integer that a field of that size can hold.
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; So the question remains, why does &#39;Q&#39; require an explicit &#39;&gt;&#39; to be
&gt; &gt; read correctly, and will this change on machines which are natively
&gt; &gt; Big-Endian &#40;non-Intel chips&#41;?
</div>&gt; 
&gt; It won&#39;t. To quote the Reference: &#34;Fields [in a cross-reference
&gt; stream] requiring more than one byte are stored with the high-order
&gt; byte first.&#34;
</div>
Let me clarify what I was asking. I can see that the data *was* high-order byte first &#40;&#34;network order&#34;/Big Endian&#41; in the file, which is correct. What I was asking was what happens for just &#39;Q&#39; &#40;as the original code was&#41;, as opposed to &#39;Q&gt;&#39;. If using just &#39;Q&#39;, it appears that my Intel CPU reads &#40;and writes&#41; in low-order byte &#40;Little Endian&#41;. Why is &#39;Q&#39; treated differently, and I need to give the byte order explicitly? This isn&#39;t a PDF::API2/Builder issue; it&#39;s a Perl issue.

This also brings up the problem that if your Perl isn&#39;t compiled for 64 bit integers, supposedly it&#39;s going to blow up on a &#39;Q&#39; &#40;or &#39;Q&gt;&#39;&#41; unpack. If this particular PDF was being processed on a 32 bit Perl, it&#39;s likely to fall over dead. I wonder if we should use the Config package to query if Perl supports 64 bit integers, and if not, see if we can treat it as a 32 bit &#40;unsigned&#41; integer by just unpacking the bottom 32 bits &#40;first checking that the first 33 bits, including the bottom&#39;s sign, are 0&#41;? Or, is 32 bit Perl so rare these days that we shouldn&#39;t bother? This appears to be the only place that 64 bits are baked into the library.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; file claimed to be level 1.4
</div>&gt; 
&gt; It didn&#39;t. The Version &#40;&#34;Optional; PDF 1.4&#34;&#41; entry in catalog
&gt; dictionary takes precedence &#34;if later than the version specified in
&gt; the file’s header&#34;. So, 1.4-compliant consumer must consult this entry
&gt; first, before making final decision about version. It follows, that
&gt; 1.5-compliant consumer &#40;which PDF::API2 is&#41; must try to read cross-
&gt; reference stream if required, to check that &#34;Version&#34; entry, even if
&gt; header says &#34;1.4&#34;. It&#39;s a bit of a conundrum, I agree, but it&#39;s how
&gt; things are.
</div>
Ah, poking through the PDF I can see a Catalog entry for /Version /1.5. Still, that&#39;s pretty sloppy to declare 1.4 in the header and then 1.5 deep down inside. Anyway, it looks like I&#39;m going to have to figure out how to read this Catalog&#40;s&#41; for an overriding Version entry, before doing any checking for version-dependent features.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;16&nbsp;09:33:23&nbsp;2020</span>
    <span class="description">chrispitude [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Nov 09 21:29:41 2020, PMPERRY wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Christopher, did you ever get a chance to ask your vendor why they
&gt; have a cross-reference stream in a file claimed to be level 1.4? With
&gt; Vadim&#39;s patch, code that Steve put in earlier to handle this PDF 1.5
&gt; feature may be getting it through OK, but I&#39;m still worried about what
&gt; else may be waiting to go wrong. I still say that the PDF is wrong.
</div>
Hi Phil,

The product is PDF Chemistry, a DITA publishing tool from Syncrosoft. PDF Chemistry uses Apache FOP internally for PDF creation, but I did not learn any specifics beyond that.


On Sat Nov 14 17:19:17 2020, vadimr wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It didn&#39;t. The Version &#40;&#34;Optional; PDF 1.4&#34;&#41; entry in catalog
&gt; dictionary takes precedence &#34;if later than the version specified in
&gt; the file’s header&#34;. So, 1.4-compliant consumer must consult this entry
&gt; first, before making final decision about version. It follows, that
&gt; 1.5-compliant consumer &#40;which PDF::API2 is&#41; must try to read cross-
&gt; reference stream if required, to check that &#34;Version&#34; entry, even if
&gt; header says &#34;1.4&#34;. It&#39;s a bit of a conundrum, I agree, but it&#39;s how
&gt; things are.
</div>
Hi Vadmin,

Possibly related, possibly not... Any utility that uses a Poppler/Cairo version from around 2009 fails with the following error:

Error: PDF file is damaged - attempting to reconstruct xref table...
Error: Couldn&#39;t find trailer dictionary
Error: Couldn&#39;t read xref table

However, later versions read the PDF successfully. I wonder if they fixed a similar bug to what you describe?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;20&nbsp;13:01:21&nbsp;2020</span>
    <span class="description">PMPERRY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">A little bit of a side trip -- I have added code to PDF::Builder to validate the structure of the PDF being read, and in the process, pick up any Version override &#40;so, for example, bad.pdf is recognized as PDF-1.5 and I don&#39;t unnecessarily flag the cross-reference stream as non-1.4&#41;. 

While I&#39;m parsing the PDF, I&#39;m looking at, among other things, Parent entries. I notice that in bad.pdf, object 24 lists objects 19-23 as its children &#40;/Kids&#41;, but none of them list a /Parent &#40;presumably back to 24&#41;. Is a Parent entry mandatory for a Kid &#40;and possibly some other parent-child relationships&#41;, or is it optional? Does it always have to point back to the object who claims this object as its Kid, or is it legal to point somewhere else? I&#39;m thinking of ticket 130722&#39;s afhacked2.pdf&#39;s object 4 declaring object 6 to be its child &#40;/Kid&#41; but so does object 9, and 6 points back to 9 as its Parent. That sounds fishy to me. The PDF 1.7 Reference sometimes calls a Parent mandatory, but then often omits a Parent from the example.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;22&nbsp;07:36:50&nbsp;2020</span>
    <span class="description">futuramedium [...] yandex.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Christopher, more likely older versions of Poppler/Cairo didn&#39;t support 1.5 features.

Phil, &#34;any&#34; is literally ANY, width can be 1-2-3-4-8, but also 5-6-7-9-10-...1000-..., etc. to PDF architectural integer limit &#40;2**32 - 1&#41;. What&#39;s an integer &#40;byte offset of an object, in particular&#41; so many bytes long -- it&#39;s beyond comprehension and hardware capabilities and practical requirements. See the H.21 end-note in &#34;PDF Reference, sixth edition&#34;, which explicitly states that the Reference, itself, does not impose ANY limit on offset byte width. I don&#39;t know what you mean by &#34;reading documentation correctly&#34; and finding there allowed widths of 1-2-3-4-8.

So, a Reader, theoretically and nominally, must cope with any width, but practically -- see what I said in August about a fix, just a character insertion. 

However, you raised a valid concern about 32-bit Perls compiled without &#34;USE_64_BIT_INT&#34;, regardless of them being worth any effort. Then, again, I&#39;m repeating myself, have a look at sister packages, how they handle the issues -- quite differently from each other &#40;and PDF::API2&#41;, but BOTH can cope with ANY widths of arbitrary size, not just 1-2-3-4-8, and regardless of Perl being 32bit/64bit &#40;of course, as long as integer to be decoded fits 32/64 bits, as applicable, -- i.e. byte string may have leading zeroes&#41;.

What follows is rather off-topic.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; what happens for just &#39;Q&#39; &#40;as the original code was&#41;
</div>
The original code was tested, if ever, using big-endian CPU

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Why is &#39;Q&#39; treated differently, and I need to give the byte order explicitly?
</div>
?? Because it&#39;s documented so. By design. How is that &#34;Perl issue&#34;? It&#39;s matter of POV -- the N/V &#40;n/v&#41; pairs are peculiar exception, all other relevant templates require explicit byte order modifier to work in portable manner.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Is a Parent entry mandatory for a Kid
</div>
The Reference has comprehensive Index, I don&#39;t think there are any ambiguities where and which entries are required. There are trees of slightly different breeds. E.g., items of Pages Tree, Name Tree &#40;your example&#41;, Outlines tree&#40;-like structure&#41; require &#40;1&#41; both Kids/Parent, &#40;2&#41; Kids only, &#40;3&#41; Parent only entries, respectively. Evolving standard &#40;as PDF was&#41; can finish eclectic, which is OK as long as everything is clearly documented.

The &#34;afhacked2.pdf&#34;, IIRC, was shown to be horribly broken EXACTLY w.r.t. parental relationship in a tree, why would you pick it up as example to investigate.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;22&nbsp;15:00:02&nbsp;2020</span>
    <span class="description">PMPERRY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Nov 22 07:36:50 2020, vadimr wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Phil, &#34;any&#34; is literally ANY, width can be 1-2-3-4-8, but also 5-6-7-
&gt; 9-10-...1000-..., etc. to PDF architectural integer limit &#40;2**32 - 1&#41;.
&gt; What&#39;s an integer &#40;byte offset of an object, in particular&#41; so many
&gt; bytes long -- it&#39;s beyond comprehension and hardware capabilities and
&gt; practical requirements. See the H.21 end-note in &#34;PDF Reference, sixth
&gt; edition&#34;, which explicitly states that the Reference, itself, does not
&gt; impose ANY limit on offset byte width. I don&#39;t know what you mean by
&gt; &#34;reading documentation correctly&#34; and finding there allowed widths of
&gt; 1-2-3-4-8.
</div>
I was probably thrown by the PDF::API2 implementation, which only allows 1, 2, 3, 4, and 8 byte widths. You&#39;re saying that /any/ width up to some enormous number of bytes is theoretically possible? As very little hardware out there probably handles &gt;64 bit integers, a maximum width of 8 is probably adequate.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So, a Reader, theoretically and nominally, must cope with any width,
&gt; but practically -- see what I said in August about a fix, just a
&gt; character insertion.
</div>
So, if some joker decides to provide a PDF with a cross-reference stream field width of 5 bytes &#40;40 bit integer&#41;, PDF::API2 &#40;and until I extend it, PDF::Builder&#41; will choke on it? Even though it&#39;s legitimate? It shouldn&#39;t be too much trouble to handle 5, 6, and 7 byte width fields by padding with x00 bytes &#40;as in the manner of width 3&#41;. &gt;8 bytes is probably unreasonable for the next few years, until hardware &#40;and Perl&#41; catches up &#40;i.e., a generation of 128 bit chips&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; However, you raised a valid concern about 32-bit Perls compiled
&gt; without &#34;USE_64_BIT_INT&#34;, regardless of them being worth any effort.
&gt; Then, again, I&#39;m repeating myself, have a look at sister packages, how
&gt; they handle the issues -- quite differently from each other &#40;and
&gt; PDF::API2&#41;, but BOTH can cope with ANY widths of arbitrary size, not
&gt; just 1-2-3-4-8, and regardless of Perl being 32bit/64bit &#40;of course,
&gt; as long as integer to be decoded fits 32/64 bits, as applicable, --
&gt; i.e. byte string may have leading zeroes&#41;.
</div>
As I&#39;ve said before, I can check if the 33 leading bits for a 64 bit &#40;after x00 padding 5, 6, or 7 byte fields&#41; integer field are 0, and just decode the low 32 bits as &#39;N&#39; format. If it&#39;s not an unsigned 32 bit value, we&#39;ll just have to throw it to unpack&#40;&#39;Q&gt;&#39;&#41; and hope for the best that it&#39;s a 64 bit Perl. I understand that it will produce a smoking hole in the ground if it&#39;s a 32 bit Perl. I suppose I /could/ use some sort of &#34;extended math&#34; package to handle the field value as two 32 bit ints or four 16 bit ints, but I&#39;m not sure it&#39;s worth the effort. Do you know how &#40;in general terms&#41; these &#34;sister packages&#34; handle 64 bit integers -- perhaps some sort of extended math?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; what happens for just &#39;Q&#39; &#40;as the original code was&#41;
</div>&gt; 
&gt; The original code was tested, if ever, using big-endian CPU
</div>
Very likely. A &#40;forgivable&#41; testing flaw in PDF::API2 &#40;but how many people have both Big-Endian and Little-Endian machines available?&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Why is &#39;Q&#39; treated differently, and I need to give the byte order
&gt; &gt; explicitly?
</div>&gt; 
&gt; ?? Because it&#39;s documented so. By design. How is that &#34;Perl issue&#34;?
</div>
I just found it odd that unpack&#39;s Q is treated differently than N/V/n/v. Yes, that&#39;s a Perl issue that it was implemented that way &#40;dependent upon the machine architecture unless explicitly overridden&#41;, and not a PDF issue &#40;everything is Network &#40;Big-Endian&#41; order&#41;. Why didn&#39;t Perl give Q=unsigned Big-Endian 64 bit, q=Little-Endian, R=signed Big-Endian, and r=signed Little-Endian &#40;or something similar&#41;? q is signed, but Endian-ness still has to be explicitly given.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It&#39;s matter of POV -- the N/V &#40;n/v&#41; pairs are peculiar exception, all
&gt; other relevant templates require explicit byte order modifier to work
&gt; in portable manner.
&gt; 
<div class="message-stanza open">&gt; &gt; Is a Parent entry mandatory for a Kid
</div>&gt; 
&gt; The Reference has comprehensive Index, I don&#39;t think there are any
&gt; ambiguities where and which entries are required. There are trees of
&gt; slightly different breeds. E.g., items of Pages Tree, Name Tree &#40;your
&gt; example&#41;, Outlines tree&#40;-like structure&#41; require &#40;1&#41; both Kids/Parent,
&gt; &#40;2&#41; Kids only, &#40;3&#41; Parent only entries, respectively. Evolving
&gt; standard &#40;as PDF was&#41; can finish eclectic, which is OK as long as
&gt; everything is clearly documented.
</div>
I&#39;ve been using the ISO/Adobe final reference for PDF 1.7, 32000_2008.pdf. It has no index. Can you recommend a better PDF reference?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The &#34;afhacked2.pdf&#34;, IIRC, was shown to be horribly broken EXACTLY
&gt; w.r.t. parental relationship in a tree, why would you pick it up as
&gt; example to investigate.
</div>
I wanted an example of what appeared to be a real-life, in-the-wild, scrambled Parent/Kid relationships, for testing my new validation code. It /does/ flag it as an error, but does not attempt to correct or fix up anything. The validation code is meant to flag suspicious PDFs so that we don&#39;t waste so much time trying to fix PDF::API2/Builder &#34;bugs&#34; which are actually bad PDFs in the first place.

Speaking of which, I have several hundred PDFs that I&#39;ve accumulated over the years, and which I tested against. Many PDFs refer to objects &#40;e.g., /Font 9 0 R&#41; but there is no such object &#40;9 0 obj&#41; in the file. Many, if not all of those cases, appear to have the missing object on the Free List. I take it that it&#39;s OK to refer to an object that&#39;s on the Free List, and it will just be ignored?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;24&nbsp;06:41:56&nbsp;2020</span>
    <span class="description">futuramedium [...] yandex.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#34;sister packages&#34; 
</div>
In general terms:

$_ = &#39;bytes&#39;; 

$i = hex unpack &#39;H&#39;.&#40;2*length&#41;, $_; # PDF::Tiny

@b = unpack &#39;C*&#39;, $_; $i = 0; &#40;$i &lt;&lt;= 8&#41; += shift @b while @b; # CAM::PDF


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ...index. Can you recommend a better PDF reference?
</div>
<span class="clickylink"><a target="new" rel="nofollow" href="https://en.wikipedia.org/wiki/PDF">https://en.wikipedia.org/wiki/PDF</a></span> leads to <span class="clickylink"><a target="new" rel="nofollow" href="https://www.adobe.com/content/dam/acom/en/devnet/acrobat/pdfs/pdf_reference_1-7.pdf">https://www.adobe.com/content/dam/acom/en/devnet/acrobat/pdfs/pdf_reference_1-7.pdf</a></span>


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I take it that it&#39;s OK to refer to an object that&#39;s on the Free List, and it will just be ignored?
</div>
See page 64, link above. If object definition is missing &#40;I think it doesn&#39;t matter if number is in Free list&#41;, then reference refers to null object. If null object is allowed in particular place, definition absence appears to be &#34;ignored&#34;. E.g. if /Font entry in graphics state dict is null, then no font is set by gs operator invocation, just wait until Tf operator. Otherwise, I guess it depends on severity, either &#34;ignored&#34; so as not to disturb a user, or reported as error.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;24&nbsp;08:35:26&nbsp;2020</span>
    <span class="description">PMPERRY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Nov 24 06:41:56 2020, vadimr wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; &#34;sister packages&#34;
</div>&gt; 
&gt; In general terms:
&gt; 
&gt; $_ = &#39;bytes&#39;;
&gt; 
&gt; $i = hex unpack &#39;H&#39;.&#40;2*length&#41;, $_; # PDF::Tiny
&gt; 
&gt; @b = unpack &#39;C*&#39;, $_; $i = 0; &#40;$i &lt;&lt;= 8&#41; += shift @b while @b; #
&gt; CAM::PDF
</div>
It looks like they&#39;re just doing the same thing as unpack&#40;&#39;Q&gt;&#39;&#41;, but at a more primitive level. This still doesn&#39;t address the problem of what to do if the result doesn&#39;t fit in a 32-bit &#40;4-byte&#41; integer &#40;i.e., it overflows -- does Perl switch to double without losing precision?&#41;. BTW, I went ahead and 1&#41; handled 5, 6, and 7 byte integers by left-padding with x00, and 2&#41; check if the top 32 bits are x00 and if so, use unpack&#40;&#39;N&#39;&#41; on the lower half, only calling unpack&#40;&#39;Q&gt;&#39;&#41; as a last resort &#40;likely to blow up if not Perl-64&#41;. I think it will be very rare &#40;for a few years still&#41; to encounter a field that&#39;s actually more than 4 billion in value. If 32-bit Perl just handles that as a double, I&#39;ll have to revisit this conversion.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; ...index. Can you recommend a better PDF reference?
</div>&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://en.wikipedia.org/wiki/PDF">https://en.wikipedia.org/wiki/PDF</a></span> leads to
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://www.adobe.com/content/dam/acom/en/devnet/acrobat/pdfs/pdf_reference_1-">https://www.adobe.com/content/dam/acom/en/devnet/acrobat/pdfs/pdf_reference_1-</a></span>
&gt; 7.pdf
</div>
Thanks, that looks useful &#40;at least, it has an index!&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; I take it that it&#39;s OK to refer to an object that&#39;s on the Free List,
&gt; &gt; and it will just be ignored?
</div>&gt; 
&gt; See page 64, link above. If object definition is missing &#40;I think it
&gt; doesn&#39;t matter if number is in Free list&#41;, then reference refers to
&gt; null object. If null object is allowed in particular place, definition
&gt; absence appears to be &#34;ignored&#34;. E.g. if /Font entry in graphics state
&gt; dict is null, then no font is set by gs operator invocation, just wait
&gt; until Tf operator. Otherwise, I guess it depends on severity, either
&gt; &#34;ignored&#34; so as not to disturb a user, or reported as error.
</div>
OK, a reference to an undefined object is usually just ignored, unless it leads to the gears getting jammed. I&#39;ll make sure that at worst, it&#39;s flagged as a &#39;note&#39; &#40;informational&#41; message, not an error or warning &#40;and thus normally will not be seen&#41;.

Thanks for all the info!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;24&nbsp;10:04:23&nbsp;2020</span>
    <span class="description">futuramedium [...] yandex.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This still doesn&#39;t address the problem of what to do if the result doesn&#39;t fit in a 32-bit &#40;4-byte&#41; integer &#40;i.e., it overflows -- does Perl switch to double without losing precision?&#41;
</div>
I think a person who tries to open a 4 Gb PDF file with 32bit build of Perl is problem himself. Anyway PDF::API2 slurps its input and will fail long before dealing with hypothetical overflow, but the latter is easily investigated with a one-liner.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
