<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #18050 for Data-FormValidator: Defining messages in both the profile and by calling msgs&#40;&#41; does not result in a merging of the lists</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #18050 for Data-FormValidator: Defining messages in both the profile and by calling msgs&#40;&#41; does not result in a merging of the lists</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Data-FormValidator">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Data-FormValidator">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Data-FormValidator">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Data-FormValidator">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Data-FormValidator">Data-FormValidator CPAN distribution</a>.</p>


<h3>Maintainer&#40;s&#41;&#39; notes</h3>

<p>This is the bug queue for Data::FormValidator. </p>



<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">18050</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Data-FormValidator">Data-FormValidator</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">MARKSTOS [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
perlmonkey [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-9052-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
4.14    </td>
  </tr>
  <tr id="CF-9053-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




msgs_override.t<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/225590/93546/msgs_override.t">
Thu Jul 20 10:50:40 2006 (3.4k) by perlmonkey [...] gmail.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=18050">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-171710" href="/Public/Bug/Display.html?id=18050#txn-171710">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;07&nbsp;18:24:52&nbsp;2006</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Defining messages in both the profile and by calling msgs&#40;&#41; does
 not result in a merging of the lists</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/171710/56378/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/56378">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Per the documentation:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;Controls passed into the &lt;msgs&gt; method will be applied first, followed by
&gt; ones applied in the profile. This allows you to keep the controls you 
&gt; pass to msgs as &#34;global&#34; and override them in a specific profile if needed
</div>

Data::FormValidator::Results::_generate_msgs has this code block:
&lt;code&gt;
    my %profile = &#40;
        prefix  =&gt; &#39;&#39;,
        missing =&gt; &#39;Missing&#39;,
        invalid =&gt; &#39;Invalid&#39;,
        invalid_separator =&gt; &#39; &#39;,

        format  =&gt; &#39;&lt;span style=&#34;color:red;font-weight:bold&#34;&gt;&lt;span
class=&#34;dfv_errors&#34;&gt;* %s&lt;/span&gt;&lt;/span&gt;&#39;,
        %{ $self-&gt;{msgs} },
        %{ $self-&gt;{profile}{msgs} },
    &#41;;
&lt;/code&gt;


This does not behave the way the POD specifies -
$self-&gt;{profile}{msgs}{constraints} overrides the
$self-&gt;{msgs}{constraints}.

Like this:
&lt;code&gt;
use Data::Dumper;
my %a = &#40;a =&gt; { b =&gt; 2, c =&gt; 3}&#41;;
my %b = &#40;a =&gt; { d =&gt; 4, e =&gt; 5}&#41;;
my %c = &#40;a =&gt; {a =&gt; 1},
         %a,
         %b
&#41;;

print Dumper&#40;\%c&#41;;
&lt;/code&gt;

The above code results in:
&lt;code&gt;
$VAR1 = {
          &#39;a&#39; =&gt; {
                   &#39;e&#39; =&gt; 5,
                   &#39;d&#39; =&gt; 4
                 }
        };
&lt;/code&gt;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-207531" href="/Public/Bug/Display.html?id=18050#txn-207531">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;12&nbsp;20:06:35&nbsp;2006</span>
    <span class="description">MARKSTOS [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-207535" href="/Public/Bug/Display.html?id=18050#txn-207535">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;12&nbsp;20:08:10&nbsp;2006</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/207535/79780/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/79780">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the report. Would you mind providing a Test::More style test
case that illustrates the issue? 

If you want to go ahead and include a proposed patch, all the better. 

Thanks,

   Mark

On Tue Mar 07 18:24:52 2006, guest wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Per the documentation:
<div class="message-stanza open">&gt; &gt;Controls passed into the &lt;msgs&gt; method will be applied first, followed by
&gt; &gt; ones applied in the profile. This allows you to keep the controls you 
&gt; &gt; pass to msgs as &#34;global&#34; and override them in a specific profile if
</div></div>needed
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; 
&gt; Data::FormValidator::Results::_generate_msgs has this code block:
&gt; &lt;code&gt;
&gt;     my %profile = &#40;
&gt;         prefix  =&gt; &#39;&#39;,
&gt;         missing =&gt; &#39;Missing&#39;,
&gt;         invalid =&gt; &#39;Invalid&#39;,
&gt;         invalid_separator =&gt; &#39; &#39;,
&gt; 
&gt;         format  =&gt; &#39;&lt;span style=&#34;color:red;font-weight:bold&#34;&gt;&lt;span
&gt; class=&#34;dfv_errors&#34;&gt;* %s&lt;/span&gt;&lt;/span&gt;&#39;,
&gt;         %{ $self-&gt;{msgs} },
&gt;         %{ $self-&gt;{profile}{msgs} },
&gt;     &#41;;
&gt; &lt;/code&gt;
&gt; 
&gt; 
&gt; This does not behave the way the POD specifies -
&gt; $self-&gt;{profile}{msgs}{constraints} overrides the
&gt; $self-&gt;{msgs}{constraints}.
&gt; 
&gt; Like this:
&gt; &lt;code&gt;
&gt; use Data::Dumper;
&gt; my %a = &#40;a =&gt; { b =&gt; 2, c =&gt; 3}&#41;;
&gt; my %b = &#40;a =&gt; { d =&gt; 4, e =&gt; 5}&#41;;
&gt; my %c = &#40;a =&gt; {a =&gt; 1},
&gt;          %a,
&gt;          %b
&gt; &#41;;
&gt; 
&gt; print Dumper&#40;\%c&#41;;
&gt; &lt;/code&gt;
&gt; 
&gt; The above code results in:
&gt; &lt;code&gt;
&gt; $VAR1 = {
&gt;           &#39;a&#39; =&gt; {
&gt;                    &#39;e&#39; =&gt; 5,
&gt;                    &#39;d&#39; =&gt; 4
&gt;                  }
&gt;         };
&gt; &lt;/code&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-207536" href="/Public/Bug/Display.html?id=18050#txn-207536">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;12&nbsp;20:08:11&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-225590" href="/Public/Bug/Display.html?id=18050#txn-225590">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;20&nbsp;10:50:40&nbsp;2006</span>
    <span class="description">perlmonkey [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> perlmonkey [...] gmail.com</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/225590/93543/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/93543">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 230b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Attached is the test script that demonstrates the problem in version 4.12

No patch is neccesary as version 4.30 does not have the same problem.

It would be good to add the test to your distribution anyway for
regression testing.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/225590/93546/msgs_override.t">Download msgs_override.t</a><br />
<span class="downloadcontenttype">text/x-perl 3.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">use Test::More tests =&gt; 11;
use strict;
use Data::Dumper;
use Data::FormValidator;

#
# Prove this statement in the POD:
# The exception here is definitions for your msgs key. You will safely be able to define 
# some defaults for this key and not have them entirely clobbered just because msgs was 
# defined in a validation profile.
#
eval {
    my $defaults = {
        msgs =&gt; {
            constraints =&gt; {
                default1  =&gt; &#39;default message&#39;,
                override1 =&gt; &#39;default message&#39;,
            },
        },
    };
    my $data = {
        profile1  =&gt; 1,
        inline1   =&gt; 1,
        override1 =&gt; 1,
    };
    my $profile = {
        required_regexp =&gt; qr/./,
        constraints =&gt; {
            profile1 =&gt; {
                name =&gt; &#39;profile1&#39;,
                constraint =&gt; sub {return},
            },
        },
        constraint_methods =&gt; {
            inline1  =&gt; cl_override_msg&#40;&#39;inline1&#39;, &#39;inline message&#39;&#41;,
            override1  =&gt; cl_override_msg&#40;&#39;override1&#39;,&#39;profile message&#39;&#41;,
        },
        msgs =&gt; {
            constraints =&gt; {
                profile1  =&gt; &#39;profile message&#39;,
                override1 =&gt; &#39;profile message&#39;,
            },
        },
    };
    my $validator = Data::FormValidator-&gt;new&#40;$defaults&#41;;
    ok&#40;$validator,&#39;validator instance created&#39;&#41;;
    eval{
        my $results  = $validator-&gt;check&#40;$data, $profile&#41;;
        my $msgs = $results-&gt;msgs;
        ok&#40;$msgs,&#39;messages exists. line &#39; . __LINE__&#41;;
        like&#40;$msgs-&gt;{profile1},  qr/profile message/,&#39;profile1 uses profile message. line &#39; . __LINE__&#41;;
        like&#40;$msgs-&gt;{inline1},   qr/inline message/, &#39;inline1 uses inline message. line &#39; . __LINE__&#41;;
        like&#40;$msgs-&gt;{override1}, qr/profile message/,&#39;override1 uses profile message. line &#39; . __LINE__&#41;;
    };
    is &#40;$@, &#39;&#39;, &#34;No exception at line &#34; . __LINE__&#41;;

};
is &#40;$@, &#39;&#39;, &#34;No exception at line &#34; . __LINE__&#41;;




#
# Prove that constraint messages can be overridden using the msgs&#40;&#41; method from within the constraint.
#
eval {

    sub cl_override_msg {
        my &#40;$name,$message&#41; = @_;
        return sub {
            my $dfv = shift;
            $dfv-&gt;name_this&#40;$name&#41;;
            my $mhash = {};
            $mhash-&gt;{constraints}{$name} = $message;
            $dfv-&gt;msgs&#40; $mhash &#41;;
            return;
        };
    }
    my $results = Data::FormValidator-&gt;check&#40;
        {
            profile1 =&gt; 1,
            inline1 =&gt; 1,
            override1 =&gt; 1,
        },
        {
            required =&gt; [qw/profile1 inline1 override1/],
            constraints =&gt; =&gt; {
                profile1 =&gt; {
                    name =&gt; &#39;profile1&#39;,
                    constraint =&gt; sub {return},
                },
            },
            constraint_methods =&gt; {
                inline1  =&gt; cl_override_msg&#40;&#39;inline1&#39;, &#39;inline message&#39;&#41;,
                override1  =&gt; cl_override_msg&#40;&#39;override1&#39;,&#39;profile message&#39;&#41;,
            },
            msgs =&gt; {
                constraints =&gt; {
                    profile1 =&gt; &#39;profile message&#39;,
                    override1  =&gt; &#39;profile message&#39;,
                },
            },
        }
    &#41;;

    my $msgs = $results-&gt;msgs;
    like&#40;$msgs-&gt;{profile1},qr/profile message/,&#39;profile1 uses profile message. line &#39; . __LINE__&#41;;
    like&#40;$msgs-&gt;{inline1}, qr/inline message/,&#39;inline1 uses inline message. line &#39; . __LINE__&#41;;
    like&#40;$msgs-&gt;{override1}, qr/profile message/,&#39;override1 uses profile message. line &#39; . __LINE__&#41;;
};
is &#40;$@, &#39;&#39;, &#34;No exception at line &#34; . __LINE__&#41;;





</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-268576" href="/Public/Bug/Display.html?id=18050#txn-268576">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;25&nbsp;19:10:35&nbsp;2006</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/268576/117946/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/117946">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jul 20 10:50:40 2006, perlmonkey@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Attached is the test script that demonstrates the problem in version 4.12
&gt; 
&gt; No patch is neccesary as version 4.30 does not have the same problem.
&gt; 
&gt; It would be good to add the test to your distribution anyway for
&gt; regression testing.
</div>
Thanks for the contribution. I get the following failures when testing
it against the 4.49_1 release. Would you mind you continue looking into
this further? 

I appreciate your help distributing the open source software maintenance
work load!

ok 1 - validator instance created
ok 2 - messages exists. line 50

#   Failed test &#39;inline1 uses inline message. line 52&#39;
#   in t/msgs_override.t at line 52.
#                   &#39;&lt;span style=&#34;color:red;font-weight:bold&#34;&gt;&lt;span
class=&#34;dfv_errors&#34;&gt;* Invalid&lt;/span&gt;&lt;/span&gt;&#39;
#     doesn&#39;t match &#39;&#40;?-xism:inline message&#41;&#39;

#   Failed test &#39;inline1 uses inline message. line 108&#39;
#   in t/msgs_override.t at line 108.
#                   &#39;&lt;span style=&#34;color:red;font-weight:bold&#34;&gt;&lt;span
class=&#34;dfv_errors&#34;&gt;* Invalid&lt;/span&gt;&lt;/span&gt;&#39;
#     doesn&#39;t match &#39;&#40;?-xism:inline message&#41;&#39;
# Looks like you failed 2 tests of 11.
ok 3 - profile1 uses profile message. line 51
not ok 4 - inline1 uses inline message. line 52
ok 5 - override1 uses profile message. line 53
ok 6 - No exception at line 55
ok 7 - No exception at line 58
ok 8 - profile1 uses profile message. line 107
not ok 9 - inline1 uses inline message. line 108
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-271190" href="/Public/Bug/Display.html?id=18050#txn-271190">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;04&nbsp;21:34:10&nbsp;2006</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/271190/119492/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/119492">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 993b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Mar 07 18:24:52 2006, guest wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Per the documentation:
<div class="message-stanza open">&gt; &gt;Controls passed into the &lt;msgs&gt; method will be applied first, followed by
&gt; &gt; ones applied in the profile. This allows you to keep the controls you 
&gt; &gt; pass to msgs as &#34;global&#34; and override them in a specific profile if
</div></div>needed
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
</div>
I looked at this in more detail, and am declaring this a &#34;doc bug&#34; and
have fixed it as such.

The intent was that you could override the /top level/ keys within msgs,
and it seems to have been working that work. 

In the bigger picture, putting all this msgs functionality in DFV may
have been a mistake. You can could still design a fancy override system,
but use the new &#34;msgs&#34; callback to do that.

If some other people want the &#34;deep merging&#34; functionality here, we
could consider adding it, but I think it&#39;s a better long term plan to
use the callback system to have msg processing outside of the core, and
let DFV focus just on validation and not how to display the results. 

  Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-271193" href="/Public/Bug/Display.html?id=18050#txn-271193">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;04&nbsp;21:34:12&nbsp;2006</span>
    <span class="description">MARKSTOS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.471511</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
