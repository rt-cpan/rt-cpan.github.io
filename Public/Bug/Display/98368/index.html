<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #98368 for Net-SSLeay: Input data should be utf8::downgrad&#39;ed</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #98368 for Net-SSLeay: Input data should be utf8::downgrad&#39;ed</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-SSLeay/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-SSLeay/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-SSLeay/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-SSLeay/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-SSLeay">Net-SSLeay CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">98368</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-SSLeay/Active/">Net-SSLeay</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">MIKEM [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
victor [...] vsespb.ru

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
ether [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-44414-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-44415-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;27&nbsp;17:42:24&nbsp;2014</span>
    <span class="description">victor [...] vsespb.ru -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Input data should be utf8::downgrad&#39;ed</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">====
use strict;
use warnings;
use Net::SSLeay;
use Data::Dumper;
use Digest::MD5 qw/md5_hex/;
use Digest::SHA qw/sha256_hex/;
use MIME::Base64;

my $msg= &#34;\x80Hello&#34;;



utf8::upgrade&#40;$msg&#41; if $ARGV[0];
print md5_hex&#40;$msg&#41;, &#34;\n&#34;;
utf8::upgrade&#40;$msg&#41; if $ARGV[0];
print sha256_hex&#40;$msg&#41;, &#34;\n&#34;;
utf8::upgrade&#40;$msg&#41; if $ARGV[0];
print encode_base64&#40;$msg&#41;, &#34;\n&#34;;
utf8::upgrade&#40;$msg&#41; if $ARGV[0];

my &#40;$page, $response, %reply_headers&#41;
    = Net::SSLeay::post_https&#40;
        &#39;posttestserver.com&#39;, # see <span class="clickylink"><a target="new" rel="nofollow" href="http://www.posttestserver.com/">http://www.posttestserver.com/</a></span>
        443,
        &#39;/post.php&#39;, 
        Net::SSLeay::make_headers&#40;
                &#39;Content-Type&#39; =&gt; &#39;text/xml; charset:utf-8&#39;,
        &#41;,
        $msg
    &#41;;
print Dumper $page;

===

===
perl test.pl 
dea59e28356a94aeca613cc57dee3f68
d26e7eab001349185c929fc5a009e2ae7a5177aef4984ab83d357d419e305360
gEhlbGxv

$VAR1 = &#39;Successfully dumped 0 post variables.
View it at <span class="clickylink"><a target="new" rel="nofollow" href="http://www.posttestserver.com/data/2014/08/27/14.32.221601594009">http://www.posttestserver.com/data/2014/08/27/14.32.221601594009</a></span>
Post body was 6 chars long.&#39;;
===

===
perl test.pl 1
dea59e28356a94aeca613cc57dee3f68
d26e7eab001349185c929fc5a009e2ae7a5177aef4984ab83d357d419e305360
gEhlbGxv

$VAR1 = &#39;Successfully dumped 0 post variables.
View it at <span class="clickylink"><a target="new" rel="nofollow" href="http://www.posttestserver.com/data/2014/08/27/14.32.4362975749">http://www.posttestserver.com/data/2014/08/27/14.32.4362975749</a></span>
Post body was 7 chars long.&#39;;
===

In this example binary data which was utf8::upgrad&#39;ed &#40;UTF-8 flag on&#41; behaves differently from utf8::downgraded one &#40;see different length of body&#41;

there was a similar bug report here <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=81668">https://rt.cpan.org/Ticket/Display.html?id=81668</a></span>
you closed the bug and documented the issue. but my point is that according to perl documentation downgraded and upgraded data should behave same way, and this issue is something that should be fixed.

you can see in both example runs above that md5, sha, and base64 of the scalar are always same, no matter if it&#39;s upgraded or not.
all perl functions behave similar way with utf-8 flagged strings.

upgraed and downgraded forms of strings are same in perl &#40;they match via &#34;eq&#34;&#41;.

good article about UTF-8 flag: <span class="clickylink"><a target="new" rel="nofollow" href="http://blogs.perl.org/users/aristotle/2011/08/utf8-flag.html">http://blogs.perl.org/users/aristotle/2011/08/utf8-flag.html</a></span>

So I propose utf8::downgrade any binary data coming to module &#40;in post_https, ssl_write_all, write_partial and other functions&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;27&nbsp;17:59:21&nbsp;2014</span>
    <span class="description">mikem [...] airspayce.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #98368] Input data should be utf8::downgrad&#39;ed</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 28 Aug 2014 07:59:08 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] airspayce.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

As you note, the documentation for post_https&#40;&#41; says you should not pass UTF-8 
data as content: use utf8::downgrade first.

Unfortunately its not possible to automatically upgrade and downgrade strings 
inside net-ssleay, since utf::downgrade&#40;&#41; etc is not natively available in all 
versions of perl that net-ssleay supports. I am *very* reluctant to add that 
dependency.

So I do not expect the relevant code in net-ssleay and the warning about UTF 
strings in the documentation to  change. You will have to downgrade in your 
calling code.

Cheers.

On Wednesday, August 27, 2014 05:42:26 PM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Wed Aug 27 17:42:24 2014: Request 98368 was acted upon.
&gt; Transaction: Ticket created by vsespb
&gt;        Queue: Net-SSLeay
&gt;      Subject: Input data should be utf8::downgrad&#39;ed
&gt;    Broken in: &#40;no value&#41;
&gt;     Severity: &#40;no value&#41;
&gt;        Owner: Nobody
&gt;   Requestors: victor@vsespb.ru
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=98368">https://rt.cpan.org/Ticket/Display.html?id=98368</a></span> &gt;
&gt; 
&gt; 
&gt; ====
&gt; use strict;
&gt; use warnings;
&gt; use Net::SSLeay;
&gt; use Data::Dumper;
&gt; use Digest::MD5 qw/md5_hex/;
&gt; use Digest::SHA qw/sha256_hex/;
&gt; use MIME::Base64;
&gt; 
&gt; my $msg= &#34;\x80Hello&#34;;
&gt; 
&gt; 
&gt; 
&gt; utf8::upgrade&#40;$msg&#41; if $ARGV[0];
&gt; print md5_hex&#40;$msg&#41;, &#34;\n&#34;;
&gt; utf8::upgrade&#40;$msg&#41; if $ARGV[0];
&gt; print sha256_hex&#40;$msg&#41;, &#34;\n&#34;;
&gt; utf8::upgrade&#40;$msg&#41; if $ARGV[0];
&gt; print encode_base64&#40;$msg&#41;, &#34;\n&#34;;
&gt; utf8::upgrade&#40;$msg&#41; if $ARGV[0];
&gt; 
&gt; my &#40;$page, $response, %reply_headers&#41;
&gt;     = Net::SSLeay::post_https&#40;
&gt;         &#39;posttestserver.com&#39;, # see <span class="clickylink"><a target="new" rel="nofollow" href="http://www.posttestserver.com/">http://www.posttestserver.com/</a></span>
&gt;         443,
&gt;         &#39;/post.php&#39;,
&gt;         Net::SSLeay::make_headers&#40;
&gt;                 &#39;Content-Type&#39; =&gt; &#39;text/xml; charset:utf-8&#39;,
&gt;         &#41;,
&gt;         $msg
&gt;     &#41;;
&gt; print Dumper $page;
&gt; 
&gt; ===
&gt; 
&gt; ===
&gt; perl test.pl
&gt; dea59e28356a94aeca613cc57dee3f68
&gt; d26e7eab001349185c929fc5a009e2ae7a5177aef4984ab83d357d419e305360
&gt; gEhlbGxv
&gt; 
&gt; $VAR1 = &#39;Successfully dumped 0 post variables.
&gt; View it at <span class="clickylink"><a target="new" rel="nofollow" href="http://www.posttestserver.com/data/2014/08/27/14.32.221601594009">http://www.posttestserver.com/data/2014/08/27/14.32.221601594009</a></span>
&gt; Post body was 6 chars long.&#39;;
&gt; ===
&gt; 
&gt; ===
&gt; perl test.pl 1
&gt; dea59e28356a94aeca613cc57dee3f68
&gt; d26e7eab001349185c929fc5a009e2ae7a5177aef4984ab83d357d419e305360
&gt; gEhlbGxv
&gt; 
&gt; $VAR1 = &#39;Successfully dumped 0 post variables.
&gt; View it at <span class="clickylink"><a target="new" rel="nofollow" href="http://www.posttestserver.com/data/2014/08/27/14.32.4362975749">http://www.posttestserver.com/data/2014/08/27/14.32.4362975749</a></span>
&gt; Post body was 7 chars long.&#39;;
&gt; ===
&gt; 
&gt; In this example binary data which was utf8::upgrad&#39;ed &#40;UTF-8 flag on&#41;
&gt; behaves differently from utf8::downgraded one &#40;see different length of
&gt; body&#41;
&gt; 
&gt; there was a similar bug report here
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=81668">https://rt.cpan.org/Ticket/Display.html?id=81668</a></span> you closed the bug and
&gt; documented the issue. but my point is that according to perl documentation
&gt; downgraded and upgraded data should behave same way, and this issue is
&gt; something that should be fixed.
&gt; 
&gt; you can see in both example runs above that md5, sha, and base64 of the
&gt; scalar are always same, no matter if it&#39;s upgraded or not. all perl
&gt; functions behave similar way with utf-8 flagged strings.
&gt; 
&gt; upgraed and downgraded forms of strings are same in perl &#40;they match via
&gt; &#34;eq&#34;&#41;.
&gt; 
&gt; good article about UTF-8 flag:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://blogs.perl.org/users/aristotle/2011/08/utf8-flag.html">http://blogs.perl.org/users/aristotle/2011/08/utf8-flag.html</a></span>
&gt; 
&gt; So I propose utf8::downgrade any binary data coming to module &#40;in
&gt; post_https, ssl_write_all, write_partial and other functions&#41;
</div>
-- 
Mike McCauley           VK4AMM                   mikem@airspayce.com
Airspayce Pty Ltd 9 Bulbul Place Currumbin Waters QLD 4223 Australia   
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.airspayce.com">http://www.airspayce.com</a></span>
Phone +61 7 5598-7474
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;27&nbsp;17:59:22&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;27&nbsp;18:06:09&nbsp;2014</span>
    <span class="description">victor [...] vsespb.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">ok, thx. then I&#39;ll try to report it to other modules that use your module, so they can workaround.

On Thu Aug 28 01:59:21 2014, mikem@airspayce.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello,
&gt; 
&gt; As you note, the documentation for post_https&#40;&#41; says you should not
&gt; pass UTF-8
&gt; data as content: use utf8::downgrade first.
&gt; 
&gt; Unfortunately its not possible to automatically upgrade and downgrade
&gt; strings
&gt; inside net-ssleay, since utf::downgrade&#40;&#41; etc is not natively
&gt; available in all
&gt; versions of perl that net-ssleay supports. I am *very* reluctant to
&gt; add that
&gt; dependency.
&gt; 
&gt; So I do not expect the relevant code in net-ssleay and the warning
&gt; about UTF
&gt; strings in the documentation to  change. You will have to downgrade in
&gt; your
&gt; calling code.
&gt; 
&gt; Cheers.
&gt; 
&gt; On Wednesday, August 27, 2014 05:42:26 PM you wrote:
<div class="message-stanza open">&gt; &gt; Wed Aug 27 17:42:24 2014: Request 98368 was acted upon.
&gt; &gt; Transaction: Ticket created by vsespb
&gt; &gt;        Queue: Net-SSLeay
&gt; &gt;      Subject: Input data should be utf8::downgrad&#39;ed
&gt; &gt;    Broken in: &#40;no value&#41;
&gt; &gt;     Severity: &#40;no value&#41;
&gt; &gt;        Owner: Nobody
&gt; &gt;   Requestors: victor@vsespb.ru
&gt; &gt;       Status: new
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=98368">https://rt.cpan.org/Ticket/Display.html?id=98368</a></span> &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; ====
&gt; &gt; use strict;
&gt; &gt; use warnings;
&gt; &gt; use Net::SSLeay;
&gt; &gt; use Data::Dumper;
&gt; &gt; use Digest::MD5 qw/md5_hex/;
&gt; &gt; use Digest::SHA qw/sha256_hex/;
&gt; &gt; use MIME::Base64;
&gt; &gt;
&gt; &gt; my $msg= &#34;\x80Hello&#34;;
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; utf8::upgrade&#40;$msg&#41; if $ARGV[0];
&gt; &gt; print md5_hex&#40;$msg&#41;, &#34;\n&#34;;
&gt; &gt; utf8::upgrade&#40;$msg&#41; if $ARGV[0];
&gt; &gt; print sha256_hex&#40;$msg&#41;, &#34;\n&#34;;
&gt; &gt; utf8::upgrade&#40;$msg&#41; if $ARGV[0];
&gt; &gt; print encode_base64&#40;$msg&#41;, &#34;\n&#34;;
&gt; &gt; utf8::upgrade&#40;$msg&#41; if $ARGV[0];
&gt; &gt;
&gt; &gt; my &#40;$page, $response, %reply_headers&#41;
&gt; &gt;     = Net::SSLeay::post_https&#40;
&gt; &gt;         &#39;posttestserver.com&#39;, # see <span class="clickylink"><a target="new" rel="nofollow" href="http://www.posttestserver.com/">http://www.posttestserver.com/</a></span>
&gt; &gt;         443,
&gt; &gt;         &#39;/post.php&#39;,
&gt; &gt;         Net::SSLeay::make_headers&#40;
&gt; &gt;                 &#39;Content-Type&#39; =&gt; &#39;text/xml; charset:utf-8&#39;,
&gt; &gt;         &#41;,
&gt; &gt;         $msg
&gt; &gt;     &#41;;
&gt; &gt; print Dumper $page;
&gt; &gt;
&gt; &gt; ===
&gt; &gt;
&gt; &gt; ===
&gt; &gt; perl test.pl
&gt; &gt; dea59e28356a94aeca613cc57dee3f68
&gt; &gt; d26e7eab001349185c929fc5a009e2ae7a5177aef4984ab83d357d419e305360
&gt; &gt; gEhlbGxv
&gt; &gt;
&gt; &gt; $VAR1 = &#39;Successfully dumped 0 post variables.
&gt; &gt; View it at
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.posttestserver.com/data/2014/08/27/14.32.221601594009">http://www.posttestserver.com/data/2014/08/27/14.32.221601594009</a></span>
&gt; &gt; Post body was 6 chars long.&#39;;
&gt; &gt; ===
&gt; &gt;
&gt; &gt; ===
&gt; &gt; perl test.pl 1
&gt; &gt; dea59e28356a94aeca613cc57dee3f68
&gt; &gt; d26e7eab001349185c929fc5a009e2ae7a5177aef4984ab83d357d419e305360
&gt; &gt; gEhlbGxv
&gt; &gt;
&gt; &gt; $VAR1 = &#39;Successfully dumped 0 post variables.
&gt; &gt; View it at
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.posttestserver.com/data/2014/08/27/14.32.4362975749">http://www.posttestserver.com/data/2014/08/27/14.32.4362975749</a></span>
&gt; &gt; Post body was 7 chars long.&#39;;
&gt; &gt; ===
&gt; &gt;
&gt; &gt; In this example binary data which was utf8::upgrad&#39;ed &#40;UTF-8 flag on&#41;
&gt; &gt; behaves differently from utf8::downgraded one &#40;see different length
&gt; &gt; of
&gt; &gt; body&#41;
&gt; &gt;
&gt; &gt; there was a similar bug report here
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=81668">https://rt.cpan.org/Ticket/Display.html?id=81668</a></span> you closed the bug
&gt; &gt; and
&gt; &gt; documented the issue. but my point is that according to perl
&gt; &gt; documentation
&gt; &gt; downgraded and upgraded data should behave same way, and this issue
&gt; &gt; is
&gt; &gt; something that should be fixed.
&gt; &gt;
&gt; &gt; you can see in both example runs above that md5, sha, and base64 of
&gt; &gt; the
&gt; &gt; scalar are always same, no matter if it&#39;s upgraded or not. all perl
&gt; &gt; functions behave similar way with utf-8 flagged strings.
&gt; &gt;
&gt; &gt; upgraed and downgraded forms of strings are same in perl &#40;they match
&gt; &gt; via
&gt; &gt; &#34;eq&#34;&#41;.
&gt; &gt;
&gt; &gt; good article about UTF-8 flag:
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://blogs.perl.org/users/aristotle/2011/08/utf8-flag.html">http://blogs.perl.org/users/aristotle/2011/08/utf8-flag.html</a></span>
&gt; &gt;
&gt; &gt; So I propose utf8::downgrade any binary data coming to module &#40;in
&gt; &gt; post_https, ssl_write_all, write_partial and other functions&#41;
</div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;27&nbsp;19:32:23&nbsp;2014</span>
    <span class="description">MIKEM [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;27&nbsp;19:32:24&nbsp;2014</span>
    <span class="description">MIKEM [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;28&nbsp;12:48:22&nbsp;2014</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2014-08-27 14:59:21, mikem@airspayce.com wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Unfortunately its not possible to automatically upgrade and downgrade
&gt; strings
&gt; inside net-ssleay, since utf::downgrade&#40;&#41; etc is not natively
&gt; available in all
&gt; versions of perl that net-ssleay supports. I am *very* reluctant to
&gt; add that
&gt; dependency.
</div>
What&#39;s wrong with only calling utf8::downgrade on versions that support it?
i.e.:

    utf8::downgrade&#40;$payload&#41; if eval { utf8-&gt;can&#40;&#39;downgrade&#39;&#41; };
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;28&nbsp;12:48:54&nbsp;2014</span>
    <span class="description">ether [...] cpan.org -  Cc ETHER added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
