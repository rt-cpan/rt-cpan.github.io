<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #49758 for libintl-perl: no perl unicode support or the half one only</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #49758 for libintl-perl: no perl unicode support or the half one only</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/libintl-perl/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/libintl-perl/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/libintl-perl/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/libintl-perl/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/libintl-perl">libintl-perl CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">49758</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/libintl-perl/Active/">libintl-perl</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">GUIDO [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
STEFFENW [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-18278-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-18279-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.20    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;16&nbsp;12:21:04&nbsp;2009</span>
    <span class="description">STEFFENW [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> no perl unicode support or the half one only</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">There is a filter, but it is only an output filter for data from 
Locale::Messages back to my script.
To have a full Perl unicode support I neeed an input filter for msgid, 
msgid_plural and msgctxt too.

I would like to write:
----------------------------------------------------------------------
# bind input filter
bind_textdomain_input_filter&#40;$text_domain, \&#38;encode_utf8&#41;;
# bind output filter
bind_textdomain_filter&#40;$text_domain, \&#38;decode_utf8&#41;;
----------------------------------------------------------------------

Here is the full script:
----------------------------------------------------------------------
#!perl -T

use strict;
use warnings;
use utf8;

our $VERSION = 0;

use Carp qw&#40;croak&#41;;
use English qw&#40;-no_match_vars $OS_ERROR&#41;;
use Encode qw&#40;encode_utf8 decode_utf8&#41;;
require Locale::TextDomain;
use Locale::Messages qw&#40;bind_textdomain_filter&#41;;

local $ENV{LANGUAGE} = &#39;ru&#39;;
my $text_domain      = &#39;test&#39;;

# bind text domain
Locale::TextDomain-&gt;import&#40; $text_domain, qw&#40;./LocaleData&#41; &#41;;

# bind output filter
bind_textdomain_filter&#40;$text_domain, \&#38;decode_utf8&#41;;

# all unicode chars encode to UTF-8
binmode STDOUT, &#39;:encoding&#40;utf-8&#41;&#39;
    or croak &#34;Binmode STDOUT\n$OS_ERROR&#34;;

# run all translations
&#40;&#41; = print map {&#34;$_\n&#34;}
    __&#40;
        &#39;book&#39;,
    &#41;,
    __&#40;
        encode_utf8&#40;&#39;§ book&#39;&#41;,
    &#41;,
    __n&#40;
        encode_utf8&#40;&#39;§§ book&#39;&#41;,
        encode_utf8&#40;&#39;§§ books&#39;&#41;,
        0,
    &#41;,
    __p&#40;
        encode_utf8&#40;&#39;c§&#39;&#41;,
        encode_utf8&#40;&#39;c§ book&#39;&#41;,
    &#41;;
__END__
Output:
книга
§ книга
§§ книг
c§ книга

----------------------------------------------------------------------

Here is the po file:
----------------------------------------------------------------------
msgid &#34;&#34;
msgstr &#34;&#34;
&#34;Project-Id-Version: \n&#34;
&#34;POT-Creation-Date: \n&#34;
&#34;PO-Revision-Date: \n&#34;
&#34;Last-Translator: \n&#34;
&#34;Language-Team: \n&#34;
&#34;MIME-Version: 1.0\n&#34;
&#34;Content-Type: text/plain; charset=UTF-8\n&#34;
&#34;Content-Transfer-Encoding: 8bit\n&#34;
&#34;Plural-Forms: nplurals=3; plural=n%10==1 &#38;&#38; n%100!=11 ? 0 : n%10&gt;=2 
&#38;&#38; n%10&lt;=4 &#38;&#38; &#40;n%100&lt;10 || n%100&gt;=20&#41; ? 1 : 2;\n&#34;

# utf-8 msgstr
msgid &#34;book&#34;
msgstr &#34;книга&#34;

# utf-8 msgid + msgstr
msgid &#34;§ book&#34;
msgstr &#34;§ книга&#34;

# utf-8 msgid + msgid_plural, msgstr[n]
msgid &#34;§§ book&#34;
msgid_plural &#34;§§ books&#34;
msgstr[0] &#34;§§ книга&#34;
msgstr[1] &#34;§§ книги&#34;
msgstr[2] &#34;§§ книг&#34;

# utf-8 context
msgctxt &#34;c§&#34;
msgid &#34;c§ book&#34;
msgstr &#34;c§ книга&#34;
----------------------------------------------------------------------
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;17&nbsp;03:24:24&nbsp;2009</span>
    <span class="description">GUIDO [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;17&nbsp;04:04:12&nbsp;2009</span>
    <span class="description">GUIDO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I must admit that I don&#39;t fully understand your problem.  The input to
gettext&#40;&#41; and friends is the source code of your script.  Why would
anybody need a filter there?

If your problem is really that you use non-ASCII message IDs, don&#39;t use
them:
<span class="clickylink"><a target="new" rel="nofollow" href="http://ml.imperia.org/libintl-perl/2005/08/16/6289725913ab0bbaa57235297ed06db9/">http://ml.imperia.org/libintl-perl/2005/08/16/6289725913ab0bbaa57235297ed06db9/</a></span>
or read the summary in the pod to Locale::Messages &#40;search for
&#34;Non-ASCII&#34;&#41;.  This is not a problem specific to the Perl version of
gettext.  Non-ASCII message IDs are deprecated in general, google for
more sources.

Besides, an additional input filter would increase the calling overhead.
 The same holds true for the output filter but that solves a common
problem: Gtk-Perl &#40;contrary to other language bindings&#41; re-encodes
strings from ISO-8859-1 to UTF-8 unless the utf-8 flag is set.  The
output filter was the only possible way to work around this
ideosyncrasy, fools rush in where angels fear to tread.

An additional optional input filter would not solve a _common_ problem.
 Common usage of gettext goes like this:

    print __&#40;&#34;Hello world!&#34;&#41;;

The input is the string constant in your script itself.  Why filter?
Whatever problem you want to solve with such a filter, I don&#39;t think
that it is a common problem worth the overhead of such a feature.  If
you really need it, it is trivial to write wrappers around the functions
in question.

I&#39;m sure you will find another solution for your problem, and will
therefore close the ticket.  If you have more questions, fee free to
re-open it, or just mail me.

Cheers,
Guido
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;17&nbsp;04:04:13&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;17&nbsp;04:04:13&nbsp;2009</span>
    <span class="description">GUIDO [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
