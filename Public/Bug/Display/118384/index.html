<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #118384 for BSD-arc4random: XS wrapper for arc4random_uniform and arc4random_buf</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #118384 for BSD-arc4random: XS wrapper for arc4random_uniform and arc4random_buf</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/BSD-arc4random/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/BSD-arc4random/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/BSD-arc4random/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/BSD-arc4random/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/BSD-arc4random">BSD-arc4random CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">118384</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/BSD-arc4random/Active/">BSD-arc4random</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
alexander.bluhm [...] gmx.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-222932-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-222933-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;14&nbsp;11:37:55&nbsp;2016</span>
    <span class="description">alexander.bluhm [...] gmx.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> XS wrapper for arc4random_uniform and arc4random_buf</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I maintain the p5-BSD-arc4random Port in OpenBSD.  As the arc4random
functions are originally from there, you might be interested what
has been done.

As we only trust the arc4random&#40;3&#41; functions in our libc, I have
implemented wrappers for them.  BSD::arc4random must use them, I
have deleted everything else.  Especially we don&#39;t need or have a
possibility to stir the entropy pool from user programs.

As you mention in your TODO List that you plan to use arc4random_buf&#40;&#41;,
I like to show you the XS wrapper I have written for arc4random_uniform&#40;3&#41;
and arc4random_buf&#40;3&#41;.

bluhm
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> arc4random.pm</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"># $MirOS: contrib/hosted/tg/code/BSD::arc4random/lib/BSD/arc4random.pm,v 1.10 2011/06/05 23:19:04 tg Exp $
#-
# Copyright &#40;c&#41; 2016 Alexander Bluhm &lt;bluhm@openbsd.org&gt;
# Copyright &#40;c&#41; 2008, 2009, 2010, 2011
#	Thorsten Glaser &lt;tg@mirbsd.org&gt;
# Copyright &#40;c&#41; 2009
#	Benny Siegert &lt;bsiegert@mirbsd.org&gt;
#
# Provided that these terms and disclaimer and all copyright notices
# are retained or reproduced in an accompanying document, permission
# is granted to deal in this work without restriction, including un-
# limited rights to use, publicly perform, distribute, sell, modify,
# merge, give away, or sublicence.
#
# This work is provided &#34;AS IS&#34; and WITHOUT WARRANTY of any kind, to
# the utmost extent permitted by applicable law, neither express nor
# implied; without malicious intent or gross negligence. In no event
# may a licensor, author or contributor be held liable for indirect,
# direct, other damage, loss, or other issues arising in any way out
# of dealing in the work, even if advised of the possibility of such
# damage or existence of a defect, except proven that it results out
# of said person&#39;s immediate fault when using the work as intended.

package BSD::arc4random;

use strict;
use warnings;

BEGIN {
	require Exporter;
	require DynaLoader;
	use vars qw&#40;$VERSION @ISA @EXPORT @EXPORT_OK %EXPORT_TAGS&#41;;
	$VERSION = &#34;1.50&#34;;
	@ISA = qw&#40;Exporter DynaLoader&#41;;
	@EXPORT = qw&#40;&#41;;
	@EXPORT_OK = qw&#40;
		$RANDOM
		&#38;arc4random
		&#38;arc4random_addrandom
		&#38;arc4random_bytes
		&#38;arc4random_pushb
		&#38;arc4random_pushk
		&#38;arc4random_stir
		&#38;arc4random_uniform
	&#41;;
	%EXPORT_TAGS = &#40;
		all =&gt; [ @EXPORT_OK ],
	&#41;;
}

use vars qw&#40;$RANDOM&#41;;		# public tied integer variable
sub have_kintf&#40;&#41; {}		# public constant function, prototyped

my $have_threadlock = 1;
my $arcfour_lock;
eval { require threads::shared; };
if &#40;$@&#41; {
	$have_threadlock = 0;	# module not available
} else {
	# private thread lock
	threads::shared::share&#40;$arcfour_lock&#41;;
};

bootstrap BSD::arc4random $BSD::arc4random::VERSION;

# public thread-safe functions
sub
arc4random&#40;&#41;
{
	lock&#40;$arcfour_lock&#41; if $have_threadlock;
	return &#38;arc4random_xs&#40;&#41;;
}

sub
arc4random_addrandom&#40;$&#41;
{
	goto &#38;arc4random;
}

sub
arc4random_pushb&#40;$&#41;
{
	goto &#38;arc4random;
}

sub
arc4random_pushk&#40;$&#41;
{
	goto &#38;arc4random;
}

sub
arc4random_stir&#40;&#41;
{
	return;
}

sub
arc4random_bytes&#40;$;$&#41;
{
	my &#40;$len, $buf&#41; = @_;

	lock&#40;$arcfour_lock&#41; if $have_threadlock;
	return &#38;arc4random_buf_xs&#40;$len&#41;;
}

sub
arc4random_uniform&#40;$&#41;
{
	my $upper_bound = shift;

	lock&#40;$arcfour_lock&#41; if $have_threadlock;
	return &#38;arc4random_uniform_xs&#40;$upper_bound&#41;;
}

# private implementation for a tied $RANDOM variable
sub
TIESCALAR
{
	my $class = shift;
	my $max = shift;

	if &#40;!defined&#40;$max&#41; || &#40;$max = int&#40;$max&#41;&#41; &gt; 0xFFFFFFFE || $max &lt; 0&#41; {
		$max = 0;
	}

	return bless \$max, $class;
}

sub
FETCH
{
	my $self = shift;

	return &#40;$$self == 0 ? arc4random&#40;&#41; : arc4random_uniform&#40;$$self + 1&#41;&#41;;
}

sub
STORE
{
	my $self = shift;
	my $value = shift;

	arc4random_pushb&#40;$value&#41;;
}

# tie the public $RANDOM variable to an mksh-style implementation
tie $RANDOM, &#39;BSD::arc4random&#39;, 0x7FFF;

# we are nice and re-seed perl&#39;s internal PRNG as well
srand&#40;arc4random_pushb&#40;pack&#40;&#34;F*&#34;, rand&#40;&#41;, rand&#40;&#41;, rand&#40;&#41;, rand&#40;&#41;&#41;&#41;&#41;;

1;
__END__

=head1 NAME

BSD::arc4random - Perl interface to the arc4 random number generator

=head1 SYNOPSIS

  use BSD::arc4random qw&#40;:all&#41;;
  $v = arc4random&#40;&#41;;
  $v = arc4random_uniform&#40;$hz&#41;;
  if &#40;!BSD::arc4random::have_kintf&#40;&#41;&#41; {
    $v = arc4random_addrandom&#40;&#34;entropy to pass to the system&#34;&#41;;
  } else {
    $v = arc4random_pushb&#40;&#34;entropy to pass to the system&#34;&#41;;
    $v = arc4random_pushk&#40;&#34;entropy to pass to the kernel&#34;&#41;;
  }
  $s = arc4random_bytes&#40;16, &#34;entropy to pass to libc&#34;&#41;;
  arc4random_stir&#40;&#41;;
  $s = arc4random_bytes&#40;16&#41;;
  print $RANDOM;

=head1 DESCRIPTION

This set of functions maps the L&lt;arc4random&#40;3&#41;&gt; family of libc functions
into Perl code.
All functions listed below are ithreads-safe.
The internal XS functions are not, but you are not supposed
to call them, either.

On module load, perl&#39;s internal PRNG is re-seeded, as a bonus, using
B&lt;srand&gt; with an argument calculated from using B&lt;arc4random_pushb&gt;
on some entropy returned from B&lt;rand&gt;&#39;s previous state.

=head2 LOW-LEVEL FUNCTIONS

=over 4

=item B&lt;arc4random&gt;&#40;&#41;

This function returns an unsigned 32-bit integer random value.

=item B&lt;arc4random_addrandom&gt;&#40;I&lt;pbuf&gt;&#41;

This function adds the entropy from I&lt;pbuf&gt; into the libc pool and
returns an unsigned 32-bit integer random value from it.

=item B&lt;arc4random_pushb&gt;&#40;I&lt;pbuf&gt;&#41;

This function first pushes the I&lt;pbuf&gt; argument to the kernel if possible,
then the entropy returned by the kernel into the libc pool, then
returns an unsigned 32-bit integer random value from it.

=item B&lt;arc4random_pushk&gt;&#40;I&lt;pbuf&gt;&#41;

This function first pushes the I&lt;pbuf&gt; argument to the kernel if possible,
then returns an unsigned 32-bit integer random value from the kernel.

This function is deprecated. Use B&lt;arc4random_pushb&gt; instead.

=item B&lt;arc4random_stir&gt;&#40;&#41;

This procedure attempts to retrieve new entropy from the kernel and add
it to the libc pool.
Usually, this means you must have access to the L&lt;urandom&#40;4&#41;&gt; device;
create it inside L&lt;chroot&#40;2&#41;&gt; jails first if you use them.

=item B&lt;have_kintf&gt;&#40;&#41;

This constant function returns 1 if B&lt;arc4random_pushb&gt; and/or
B&lt;arc4random_pushk&gt; actually call the kernel interfaces, 0 if
they merely map to B&lt;arc4random_addrandom&gt; instead.

=back

=head2 HIGH-LEVEL FUNCTIONS

=over 4

=item B&lt;arc4random_bytes&gt;&#40;I&lt;num&gt;[, I&lt;pbuf&gt;]&#41;

This function returns a string containing as many random bytes as
requested by the integral argument I&lt;num&gt;.
An optional I&lt;pbuf&gt; argument is passed to the system first.

=item B&lt;arc4random_uniform&gt;&#40;I&lt;upper_bound&gt;&#41;

Calculate a uniformly distributed random number less than upper_bound
avoiding &#34;modulo bias&#34;.

=back

=head2 PACKAGE VARIABLES

=over 4

=item B&lt;$RANDOM&gt;

The B&lt;$RANDOM&gt; returns a random value in the range S&lt;[0; 32767]&gt; on
each read attempt and pushes any value it is assigned to the kernel.
It is tied at module load time.

=item tie I&lt;variable&gt;, &#39;BSD::arc4random&#39;[, I&lt;max&gt;]

You can tie any scalar variable to this package; the I&lt;max&gt; argument
is the maximum number returned; if undefined, 0 or S&lt;E&lt;62&gt;= 0xFFFFFFFF&gt;,
no bound is used, and values in the range S&lt;[0; 2**32-1]&gt; are returned.
They will behave like B&lt;$RANDOM&gt;.

=back

=head1 AUTHOR

Thorsten Glaser E&lt;lt&gt;tg@mirbsd.deE&lt;gt&gt;

=head1 SEE ALSO

The L&lt;arc4random&#40;3&#41;&gt; manual page, available online at:
L&lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://www.mirbsd.org/man/arc4random.3">https://www.mirbsd.org/man/arc4random.3</a></span>&gt;

Perl&#39;s L&lt;rand&gt; and L&lt;srand&gt; functions via L&lt;perlfunc&gt; and L&lt;perlfaq4&gt;.

The B&lt;randex.pl&gt; plugin for Irssi, implementing the MirOS RANDEX
protocol &#40;entropy exchange over IRC&#41;, with CVSweb at:
L&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://cvs.mirbsd.de/ports/net/irssi/files/randex.pl">http://cvs.mirbsd.de/ports/net/irssi/files/randex.pl</a></span>&gt;

L&lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://www.mirbsd.org/a4rp5bsd.htm">https://www.mirbsd.org/a4rp5bsd.htm</a></span>&gt; when it&#39;s done being written.

=head1 COPYRIGHT AND LICENSE

Copyright &#40;c&#41; 2008, 2009, 2010, 2011 Thorsten &#34;mirabilos&#34; Glaser
Copyright &#40;c&#41; 2009 Benny Siegert
Credits to Sebastian &#34;Vutral&#34; Schwarz

This module is covered by the MirOS Licence:
L&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://mirbsd.de/MirOS-Licence">http://mirbsd.de/MirOS-Licence</a></span>&gt;

The original C implementation of arc4random_uniform was contributed by
Damien Miller from OpenBSD, with simplifications by Jinmei Tatuya.

=cut
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> arc4rnd_xs.c</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">/*-
 * Copyright &#40;c&#41; 2016 Alexander Bluhm &lt;bluhm@openbsd.org&gt;
 * Copyright &#40;c&#41; 2008, 2009
 *	Thorsten Glaser &lt;tg@mirbsd.org&gt;
 *
 * Provided that these terms and disclaimer and all copyright notices
 * are retained or reproduced in an accompanying document, permission
 * is granted to deal in this work without restriction, including un-
 * limited rights to use, publicly perform, distribute, sell, modify,
 * merge, give away, or sublicence.
 *
 * This work is provided &#34;AS IS&#34; and WITHOUT WARRANTY of any kind, to
 * the utmost extent permitted by applicable law, neither express nor
 * implied; without malicious intent or gross negligence. In no event
 * may a licensor, author or contributor be held liable for indirect,
 * direct, other damage, loss, or other issues arising in any way out
 * of dealing in the work, even if advised of the possibility of such
 * damage or existence of a defect, except proven that it results out
 * of said person&#39;s immediate fault when using the work as intended.
 */

#include &lt;stdlib.h&gt;

#include &#34;EXTERN.h&#34;
#include &#34;perl.h&#34;
#include &#34;XSUB.h&#34;

#if !defined&#40;__attribute__&#41; &#38;&#38; &#40;!defined&#40;__GNUC__&#41; || &#40;__GNUC__ &lt; 1&#41; || &#40;__GNUC__ == 2 &#38;&#38; __GNUC_MINOR__ &lt; 5&#41;&#41;
#define __attribute__&#40;x&#41;		/* nothing */
#endif

#if !defined&#40;__RCSID&#41; || !defined&#40;__IDSTRING&#41;
#undef __RCSID
#undef __IDSTRING
#undef __IDSTRING_CONCAT
#undef __IDSTRING_EXPAND
#define __IDSTRING_CONCAT&#40;l,p&#41;		__LINTED__ ## l ## _ ## p
#define __IDSTRING_EXPAND&#40;l,p&#41;		__IDSTRING_CONCAT&#40;l,p&#41;
#define __IDSTRING&#40;prefix, string&#41;				\
	static const char __IDSTRING_EXPAND&#40;__LINE__,prefix&#41; []	\
	    __attribute__&#40;&#40;used&#41;&#41; = &#34;@&#40;&#34;&#34;#&#41;&#34; #prefix &#34;: &#34; string
#define __RCSID&#40;x&#41;			__IDSTRING&#40;rcsid,x&#41;
#endif

__RCSID&#40;&#34;$OpenBSD: patch-arc4rnd_xs_c,v 1.2 2016/10/12 17:47:23 bluhm Exp $&#34;&#41;;

XS&#40;XS_BSD__arc4random_arc4random_xs&#41;;
XS&#40;XS_BSD__arc4random_arc4random_xs&#41;
{
	dXSARGS;
	dXSTARG;
	uint32_t rv;

	rv = arc4random&#40;&#41;;

	XSprePUSH;
	PUSHu&#40;&#40;UV&#41;rv&#41;;

	XSRETURN&#40;1&#41;;
}

XS&#40;XS_BSD__arc4random_arc4random_uniform_xs&#41;;
XS&#40;XS_BSD__arc4random_arc4random_uniform_xs&#41;
{
	dXSARGS;
	dXSTARG;
	SV *sv;
	uint32_t upper_bound;
	uint32_t rv;

	sv = ST&#40;0&#41;;
	upper_bound = SvUV&#40;sv&#41;;
	rv = arc4random_uniform&#40;upper_bound&#41;;

	XSprePUSH;
	PUSHu&#40;&#40;UV&#41;rv&#41;;

	XSRETURN&#40;1&#41;;
}

XS&#40;XS_BSD__arc4random_arc4random_buf_xs&#41;;
XS&#40;XS_BSD__arc4random_arc4random_buf_xs&#41;
{
	dXSARGS;
	dXSTARG;
	SV *sv;
	char *buf;
	size_t nbytes;

	sv = ST&#40;0&#41;;
	nbytes = SvUV&#40;sv&#41;;
	sv = sv_newmortal&#40;&#41;;
	if &#40;nbytes == SIZE_T_MAX&#41;
		nbytes--;
	Newx&#40;buf, nbytes + 1, char&#41;;
	arc4random_buf&#40;buf, nbytes&#41;;
	buf[nbytes] = &#39;\0&#39;;
	sv_usepvn_flags&#40;sv, buf, nbytes, SV_SMAGIC | SV_HAS_TRAILING_NUL&#41;;

	XSprePUSH;
	PUSHs&#40;sv&#41;;

	XSRETURN&#40;1&#41;;
}

__IDSTRING&#40;api_text, &#34;BSD::arc4random &#34; XS_VERSION &#34; with {&#34;
    &#34; arc4random&#34;
    &#34; arc4random_uniform&#34;
    &#34; arc4random_buf&#34;
    &#34; }&#34;&#41;;


/* the Perl API is not const clean */
static char file[] = __FILE__;
static char func_a4r[] = &#34;BSD::arc4random::arc4random_xs&#34;;
static char func_a4r_uniform[] = &#34;BSD::arc4random::arc4random_uniform_xs&#34;;
static char func_a4r_buf[] = &#34;BSD::arc4random::arc4random_buf_xs&#34;;

#ifdef __cplusplus
extern &#34;C&#34;
#endif
XS&#40;boot_BSD__arc4random&#41;;
XS&#40;boot_BSD__arc4random&#41;
{
	dXSARGS;

	XS_VERSION_BOOTCHECK;

	newXS&#40;func_a4r, XS_BSD__arc4random_arc4random_xs, file&#41;;
	newXS&#40;func_a4r_uniform, XS_BSD__arc4random_arc4random_uniform_xs, file&#41;;
	newXS&#40;func_a4r_buf, XS_BSD__arc4random_arc4random_buf_xs, file&#41;;

	XSRETURN_YES;
}
</div></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
