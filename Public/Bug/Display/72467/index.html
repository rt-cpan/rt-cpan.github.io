<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #72467 for Carp: panic: attempt to copy freed scalar</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #72467 for Carp: panic: attempt to copy freed scalar</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Carp">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Carp">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Carp">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Carp">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Carp">Carp CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">72467</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Carp">Carp</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
sewi [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
ether [...] cpan.org

<br />
gregoa [...] cpan.org

<br />
TEAM [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-240208-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
1.22</li>
<li>
1.23</li>
</ul>
    </td>
  </tr>
  <tr id="CF-240209-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=72467">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1000465" href="/Public/Bug/Display.html?id=72467#txn-1000465">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;16&nbsp;11:37:53&nbsp;2011</span>
    <span class="description">sewi [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> panic: attempt to copy freed scalar</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1000465/521137/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/521137">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 344b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">perl -MCarp -le &#39;f&#40;@ARGV&#41;; sub f { my $x = shift&#40;@ARGV&#41;; carp&#40;$x&#41;}&#39; a v
panic: attempt to copy freed scalar 183d588 to 1854078 at /usr/share/
perl/5.12/Carp.pm line 104.

Carp&#39;s crash looses the original error message and all additional 
information.

I don&#39;t know how, but Carp should catch this error and report everything 
which is possible.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1000468" href="/Public/Bug/Display.html?id=72467#txn-1000468">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;16&nbsp;11:43:36&nbsp;2011</span>
    <span class="description">sewi [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1000468/521140/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/521140">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 311b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Using $_[0]; in line 182 seems to fix the problem:

# Transform an argument to a function into a string.
sub format_arg {
    my $arg = $_[0];
    shift;
    if &#40; ref&#40;$arg&#41; &#41; {

perl -I. -MCarp -le &#39;f&#40;@ARGV&#41;; sub f { my $x = shift&#40;@ARGV&#41;; carp&#40;$x&#41;}&#39; 
a v
a at -e line 1
        main::f&#40;undef, &#39;v&#39;&#41; called at -e line 1
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1000470" href="/Public/Bug/Display.html?id=72467#txn-1000470">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;16&nbsp;11:43:37&nbsp;2011</span>
    <span class="description">sewi [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1001797" href="/Public/Bug/Display.html?id=72467#txn-1001797">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;19&nbsp;18:13:21&nbsp;2011</span>
    <span class="description">zefram [...] fysh.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #72467] panic: attempt to copy freed scalar</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 19 Nov 2011 23:13:10 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Sebastian Willing via RT &lt;bug-Carp [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Zefram &lt;zefram [...] fysh.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1001797/521884/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/521884">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 764b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sebastian Willing via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;Using $_[0]; in line 182 seems to fix the problem:
</div>
Not really, since you&#39;re getting undef rather than the actual argument.
Getting undef consistently in place of a freed argument would be OK,
but I think you&#39;re only getting undef by accident.  There&#39;s obviously a
core bug, possibly two, behind this.  I&#39;ve reported the two core issues
as [perl #104074] and [perl #104076].  The former, involving @DB::args,
may be merely a consequence of the latter, a simpler issue with freed
sub args.  In the latter, a missing sub arg certainly can be accidentally
replaced by something other than undef.

I&#39;m going to wait until the core issue is understood before deciding what,
if anything, Carp should do.

Thanks for the report.

-zefram
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1067460" href="/Public/Bug/Display.html?id=72467#txn-1067460">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;13&nbsp;19:53:19&nbsp;2012</span>
    <span class="description">DOUGW [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1067460/561235/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/561235">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 678b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Nov 19 18:13:21 2011, zefram@fysh.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; I&#39;m going to wait until the core issue is understood before deciding what,
&gt; if anything, Carp should do.
</div>
It has been a long wait. I get &#34;Bizarre copy of ARRAY&#34; for which there&#39;s
a concise summary at
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.gossamer-threads.com/lists/perl/porters/227639">http://www.gossamer-threads.com/lists/perl/porters/227639</a></span>

My band-aid is to turn this &#40;in Carp.pm or Heavy.pm depending on version&#41;:

my @args = map {Carp::format_arg&#40;$_&#41;} @DB::args;

Into this:

my @args = eval {
  local $@;
  map {Carp::format_arg&#40;$_&#41;} @DB::args;
};

Then I at least get the sensible error that triggered carp/confess/etc.
in the first place, and not the &#39;bizarre&#39; error that tells me nothing
useful.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1067581" href="/Public/Bug/Display.html?id=72467#txn-1067581">#</a>      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;14&nbsp;13:53:47&nbsp;2012</span>
    <span class="description">DOUGW [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1067581/561280/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/561280">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 631b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Apr 13 19:53:19 2012, DOUGW wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sat Nov 19 18:13:21 2011, zefram@fysh.org wrote:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; I&#39;m going to wait until the core issue is understood before deciding
</div></div>what,
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; if anything, Carp should do.
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; my @args = map {Carp::format_arg&#40;$_&#41;} @DB::args;
&gt; 
&gt; Into this:
&gt; 
&gt; my @args = eval {
&gt;   local $@;
&gt;   map {Carp::format_arg&#40;$_&#41;} @DB::args;
&gt; };
</div>
I think with the above fix you should at least be able to close the Carp
bug, while keeping the many related bugs in perl itself open.

Or maybe the eval belongs inside the map? &#40;not tested&#41;:

my @args = map { eval { local $@; Carp::format_arg&#40;$_&#41; } } @DB::args;

??
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069027" href="/Public/Bug/Display.html?id=72467#txn-1069027">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;18&nbsp;11:34:19&nbsp;2012</span>
    <span class="description">DOUGW [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1069027/562163/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/562163">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 368b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Apr 14 13:53:47 2012, DOUGW wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; my @args = map { eval { local $@; Carp::format_arg&#40;$_&#41; } } @DB::args;
</div>
Die&#39;ing inside the eval returns an empty array, so you lose an argument
in @args. So even better so that you know you lost an argument &#40;IMHO&#41;:

@args = map {
  my $tmp = eval { Carp::format_arg&#40;$_&#41; };
  defined&#40;$tmp&#41; ? $tmp : &#39;unknown&#39;;
} @DB::args;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069784" href="/Public/Bug/Display.html?id=72467#txn-1069784">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;19&nbsp;16:12:19&nbsp;2012</span>
    <span class="description">DOUGW [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1069784/562686/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/562686">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 304b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Apr 18 11:34:19 2012, DOUGW wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; @args = map {
&gt;   my $tmp = eval { Carp::format_arg&#40;$_&#41; };
&gt;   defined&#40;$tmp&#41; ? $tmp : &#39;unknown&#39;;
&gt; } @DB::args;
</div>
Forgot the local $@:

@args = map {
    local $@;
    my $tmp = eval { Carp::format_arg&#40;$_&#41; };
    defined&#40;$tmp&#41; ? $tmp : &#39;unknown&#39;;
} @DB::args;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1072279" href="/Public/Bug/Display.html?id=72467#txn-1072279">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;27&nbsp;14:03:32&nbsp;2012</span>
    <span class="description">DOUGW [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1072279/564125/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/564125">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 263b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
A library that is supposed to report errors erroring out itself is a sad
thing. Here is my fix to make the world a little less sad:
 
my @args = map {
    local $@;
    my $tmp = eval { Carp::format_arg&#40;$_&#41; };
    defined&#40;$tmp&#41; ? $tmp : &#39;unknown&#39;;
} @DB::args;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1276472" href="/Public/Bug/Display.html?id=72467#txn-1276472">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;18&nbsp;11:54:10&nbsp;2013</span>
    <span class="description">jkeenan [...] cpan.org -  Reference to perl ticket #104074 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1276473" href="/Public/Bug/Display.html?id=72467#txn-1276473">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;18&nbsp;11:54:10&nbsp;2013</span>
    <span class="description">jkeenan [...] cpan.org -  Reference to perl ticket #42166 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1344743" href="/Public/Bug/Display.html?id=72467#txn-1344743">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;29&nbsp;13:32:06&nbsp;2014</span>
    <span class="description">ether [...] cpan.org -  Cc ETHER added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1459931" href="/Public/Bug/Display.html?id=72467#txn-1459931">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;03&nbsp;08:45:20&nbsp;2015</span>
    <span class="description">TEAM [...] cpan.org -  Cc TEAM added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1626652" href="/Public/Bug/Display.html?id=72467#txn-1626652">#</a>      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;15&nbsp;15:29:30&nbsp;2016</span>
    <span class="description">AKHUETTEL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1626652/871365/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/871365">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 378b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Seems to be still broken in 1.40 / Perl 5.24.0. 

[...]
Checking if your kit is complete...
Looks good
ERROR from evaluation of /var/tmp/portage/net-analyzer/net-snmp-5.7.3-r5/work/net-snmp-5.7.3/perl/OID/Makefile.PL: panic: attempt to copy freed scalar 1221eb8 to 1b4e308 at /usr/lib64/perl5/5.24.0/Carp.pm line 229.
Makefile:301: recipe for target &#39;perlmakefiles&#39; failed
[...]
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1626655" href="/Public/Bug/Display.html?id=72467#txn-1626655">#</a>      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;15&nbsp;15:37:05&nbsp;2016</span>
    <span class="description">zefram [...] fysh.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #72467] panic: attempt to copy freed scalar</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 15 May 2016 20:36:52 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Carp [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Zefram &lt;zefram [...] fysh.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1626655/871368/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/871368">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 111b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;Seems to be still broken in 1.40 / Perl 5.24.0. 
</div>
Yes, and it&#39;s still only fixable in the perl core.

-zefram
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1664325" href="/Public/Bug/Display.html?id=72467#txn-1664325">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;02&nbsp;09:42:31&nbsp;2016</span>
    <span class="description">gregoa [...] cpan.org -  Cc GREGOA added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1765086" href="/Public/Bug/Display.html?id=72467#txn-1765086">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;09&nbsp;19:13:26&nbsp;2018</span>
    <span class="description">DOUGW [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1765086/949925/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/949925">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 254b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Simple test case in case one is still needed &#40;the one at the beginning of this thread does not seem to trigger the error anymore&#41;:

use Carp;

Main&#40;@ARGV&#41;;

sub Main {
  my $first  = shift @ARGV;
  $ARGV[0] = [qw&#40;1 2 3&#41;];
  confess &#34;Rubbish&#34;;
  exit;
}
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.707706</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
