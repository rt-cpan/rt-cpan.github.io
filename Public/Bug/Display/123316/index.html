<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #123316 for Git-FastExport: git-stitch-repo missing commits</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #123316 for Git-FastExport: git-stitch-repo missing commits</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Git-FastExport/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Git-FastExport/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Git-FastExport/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Git-FastExport/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Git-FastExport">Git-FastExport CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">123316</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Git-FastExport/Active/">Git-FastExport</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
daniel.hammer+oss [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-222690-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.107    </td>
  </tr>
  <tr id="CF-222691-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;18&nbsp;04:43:43&nbsp;2017</span>
    <span class="description">https://launchpad.net/~daniel-hammer -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> git-stitch-repo missing commits</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve attempted to use git-stitch-repo to combine 2 git repositories containing 881 commits in total.
But when stitching the repositories together, the total commit count drops below the expected 881 in total. Also unexpected is the total number of commits seems to be dependent on which branch is checked out, see details below.

Steps to reproduce

1. clone repositories
~/tmp$ git clone <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/grails-plugins/grails-cache.git">https://github.com/grails-plugins/grails-cache.git</a></span>
~/tmp$ git clone <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/grails-plugins/grails-quartz.git">https://github.com/grails-plugins/grails-quartz.git</a></span>

2. determine total number of commits in the orginal repositories
~/tmp/grails-cache$ git rev-list --count HEAD
387
~/tmp/grails-quartz$ git rev-list --count HEAD
494

3. stitch repositories

3.1 stitch grails-cache grails-quartz

~/tmp$ mkdir cache_quartz &#38;&#38; cd cache_quartz
~/tmp/cache_quartz$ git init
~/tmp/cache_quartz$ git-stitch-repo ../grails-cache ../grails-quartz | git fast-import

3.1.1 verify total number of commits
~/tmp/cache_quartz$ git checkout master-grails-cache
~/tmp/cache_quartz$ git rev-list --count HEAD
556

Seems 325 commits are missing


~/tmp/cache_quartz$ git checkout master-grails-quartz 
~/tmp/cache_quartz$ git rev-list --count HEAD
753

Seems 128 commits are missing

Note: order of repository arguments to git-stitch-repo doesn&#39;t affect final result.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;18&nbsp;04:47:38&nbsp;2017</span>
    <span class="description">https://launchpad.net/~daniel-hammer -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> daniel.hammer+oss [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Oct 18 04:43:43 2017, <span class="clickylink"><a target="new" rel="nofollow" href="https://launchpad.net/~daniel-hammer">https://launchpad.net/~daniel-hammer</a></span> wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve attempted to use git-stitch-repo to combine 2 git repositories
&gt; containing 881 commits in total.
&gt; But when stitching the repositories together, the total commit count
&gt; drops below the expected 881 in total. Also unexpected is the total
&gt; number of commits seems to be dependent on which branch is checked
&gt; out, see details below.
&gt; 
&gt; Steps to reproduce
&gt; 
&gt; 1. clone repositories
&gt; ~/tmp$ git clone <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/grails-plugins/grails-cache.git">https://github.com/grails-plugins/grails-cache.git</a></span>
&gt; ~/tmp$ git clone <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/grails-plugins/grails-quartz.git">https://github.com/grails-plugins/grails-quartz.git</a></span>
&gt; 
&gt; 2. determine total number of commits in the orginal repositories
&gt; ~/tmp/grails-cache$ git rev-list --count HEAD
&gt; 387
&gt; ~/tmp/grails-quartz$ git rev-list --count HEAD
&gt; 494
&gt; 
&gt; 3. stitch repositories
&gt; 
&gt; 3.1 stitch grails-cache grails-quartz
&gt; 
&gt; ~/tmp$ mkdir cache_quartz &#38;&#38; cd cache_quartz
&gt; ~/tmp/cache_quartz$ git init
&gt; ~/tmp/cache_quartz$ git-stitch-repo ../grails-cache ../grails-quartz |
&gt; git fast-import
&gt; 
&gt; 3.1.1 verify total number of commits
&gt; ~/tmp/cache_quartz$ git checkout master-grails-cache
&gt; ~/tmp/cache_quartz$ git rev-list --count HEAD
&gt; 556
&gt; 
&gt; Seems 325 commits are missing
&gt; 
&gt; 
&gt; ~/tmp/cache_quartz$ git checkout master-grails-quartz
&gt; ~/tmp/cache_quartz$ git rev-list --count HEAD
&gt; 753
&gt; 
&gt; Seems 128 commits are missing
&gt; 
&gt; Note: order of repository arguments to git-stitch-repo doesn&#39;t affect
&gt; final result.
</div>
Known work-around; use <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/robinst/git-merge-repos#preserve-history-for-paths">https://github.com/robinst/git-merge-repos#preserve-history-for-paths</a></span> instead.
Utilizing git-merge-repos results in a similar directory structure and 882 commits - there&#39;s a final merge-commit.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;18&nbsp;04:47:39&nbsp;2017</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
