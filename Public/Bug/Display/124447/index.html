<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #124447 for podlators: Pod::Text::Termcap explicit width control is faulty</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #124447 for podlators: Pod::Text::Termcap explicit width control is faulty</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=podlators">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=podlators">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=podlators">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=podlators">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/podlators">podlators CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">124447</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=podlators">podlators</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">RRA [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
eponymousalias [...] yahoo.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-26322-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
4.10    </td>
  </tr>
  <tr id="CF-26323-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
4.11    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=124447">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1771503" href="/Public/Bug/Display.html?id=124447#txn-1771503">#</a>      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;16&nbsp;10:24:26&nbsp;2018</span>
    <span class="description">eponymousalias [...] yahoo.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Pod::Text::Termcap explicit width control is faulty</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1771503/953294/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/953294">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 384b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">In the Termcap.pm file of Pod::Text::Termcap version 4.10, this line:

unless &#40;defined $$self{width}&#41; {

should read like this instead:

unless &#40;defined $$self{opt_width}&#41; {

in order to properly use the documented constructor &#34;width&#34; parameter.
Currently, that parameter is just being ignored, because the parent
class creates an &#34;opt_width&#34; hash key with it, not a &#34;width&#34; hash key.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1771667" href="/Public/Bug/Display.html?id=124447#txn-1771667">#</a>      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;17&nbsp;17:39:04&nbsp;2018</span>
    <span class="description">RRA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #124447] Pod::Text::Termcap explicit width control is faulty</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 17 Feb 2018 14:30:39 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;eponymous alias via RT&#34; &lt;bug-podlators [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Russ Allbery &lt;rra [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1771667/953362/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/953362">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 878b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;eponymous alias via RT&#34; &lt;bug-podlators@rt.cpan.org&gt; writes:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In the Termcap.pm file of Pod::Text::Termcap version 4.10, this line:
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; unless &#40;defined $$self{width}&#41; {
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; should read like this instead:
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; unless &#40;defined $$self{opt_width}&#41; {
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; in order to properly use the documented constructor &#34;width&#34; parameter.
&gt; Currently, that parameter is just being ignored, because the parent
&gt; class creates an &#34;opt_width&#34; hash key with it, not a &#34;width&#34; hash key.
</div>
Wow, this has been broken since the 2.0.0 release.  Nice find!  Fixed in
Git for the next release, which should be fairly soon.

-- 
#!/usr/bin/perl -- Russ Allbery, Just Another Perl Hacker
$^=q;@!&gt;~|{&gt;krw&gt;yn{u&lt;$$&lt;[~||&lt;Juukn{=,&lt;S~|}&lt;Jwx}qn{&lt;Yn{u&lt;Qjltn{ &gt; 0gFzD gD,
 00Fz, 0,,&#40; 0hF 0g&#41;F/=, 0&gt; &#34;L$/GEIFewe{,$/ 0C$~&gt; &#34;@=,m,|,&#40;e 0.&#41;, 01,pnn,y{
rw} &gt;;,$0=q,$,,&#40;$_=$^&#41;=~y,$/ C-~&gt;&lt;@=\n\r,-~$:-u/ #y,d,s,&#40;\$.&#41;,$1,gee,print
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1771668" href="/Public/Bug/Display.html?id=124447#txn-1771668">#</a>      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;17&nbsp;17:39:05&nbsp;2018</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1771780" href="/Public/Bug/Display.html?id=124447#txn-1771780">#</a>      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;18&nbsp;12:13:20&nbsp;2018</span>
    <span class="description">eponymousalias [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> eponymousalias [...] yahoo.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1771780/953413/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/953413">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Feb 17 17:39:04 2018, RRA wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#34;eponymous alias via RT&#34; &lt;bug-podlators@rt.cpan.org&gt; writes:
&gt; 
<div class="message-stanza open">&gt; &gt; In the Termcap.pm file of Pod::Text::Termcap version 4.10, this line:
</div>&gt; 
<div class="message-stanza open">&gt; &gt; unless &#40;defined $$self{width}&#41; {
</div>&gt; 
<div class="message-stanza open">&gt; &gt; should read like this instead:
</div>&gt; 
<div class="message-stanza open">&gt; &gt; unless &#40;defined $$self{opt_width}&#41; {
</div>&gt; 
<div class="message-stanza open">&gt; &gt; in order to properly use the documented constructor &#34;width&#34; parameter.
&gt; &gt; Currently, that parameter is just being ignored, because the parent
&gt; &gt; class creates an &#34;opt_width&#34; hash key with it, not a &#34;width&#34; hash key.
</div>&gt; 
&gt; Wow, this has been broken since the 2.0.0 release.  Nice find!  Fixed in
&gt; Git for the next release, which should be fairly soon.
</div>
There is a further problem with the width option in Pod::Text::Termcap,
this one involving how wrapping is implemented.

I am using Pod::Text::Termcap v4.10 modified with the simple change
described in bug #124447 &#40;this one&#41; to get the package to pay attention
to the width parameter.

I have a bunch of =item lines that contain multi-word tags with many
embedded color changes &#40;generated by B&lt;words&gt; and I&lt;words&gt; elements&#41;.

I observe that when my formatted POD is output to an xterm, text in open
paragraphs manages to use the Pod::Text::Termcap::wrap&#40;&#41; routine, and
the characters comprising escape sequences for color changes embedded
in that text do not cause early wrapping.  However, for some reason the
text in my =item tags seems to be processed instead by Pod::Text::wrap&#40;&#41;,
meaning I get wrapping much too soon in this text.

I don&#39;t understand the internals of these two packages well enough
to know why the one case is working while the other is not, nor to
understand how to force the wrap&#40;&#41; override to work in the second case.
Here is a small test item, wherein on an 80-character terminal, I get
the ellipsis at the end wrapped onto the next line when it shouldn&#39;t be
&#40;and isn&#39;t, if the terminal is say 100 characters wide&#41;.

=over 4

=item B&lt;autosetup print analysis&gt; [B&lt;-e&gt;|B&lt;-f&gt;|B&lt;-u&gt;] I&lt;hostname&gt; ...

=back
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1771836" href="/Public/Bug/Display.html?id=124447#txn-1771836">#</a>      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;18&nbsp;15:45:47&nbsp;2018</span>
    <span class="description">RRA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #124447] Pod::Text::Termcap explicit width control is faulty</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 18 Feb 2018 12:45:02 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;eponymous alias via RT&#34; &lt;bug-podlators [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Russ Allbery &lt;rra [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1771836/953449/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/953449">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;eponymous alias via RT&#34; &lt;bug-podlators@rt.cpan.org&gt; writes:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have a bunch of =item lines that contain multi-word tags with many
&gt; embedded color changes &#40;generated by B&lt;words&gt; and I&lt;words&gt; elements&#41;.
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I observe that when my formatted POD is output to an xterm, text in open
&gt; paragraphs manages to use the Pod::Text::Termcap::wrap&#40;&#41; routine, and
&gt; the characters comprising escape sequences for color changes embedded in
&gt; that text do not cause early wrapping.  However, for some reason the
&gt; text in my =item tags seems to be processed instead by
&gt; Pod::Text::wrap&#40;&#41;, meaning I get wrapping much too soon in this text.
</div>
Thank you, and thanks for the reproducible test case!  I tracked this one
down too, although it was elusive.  The correct wrap routine was being
called, but due to a subtle error in the rather complicated regex used to
wrap text with embeded escape sequences, it wasn&#39;t recognizing the end of
the string and thought it had to wrap.

This problem also affected Pod::Text::Color, since it used a very similar
regex, and will be fixed in the next release.

-- 
#!/usr/bin/perl -- Russ Allbery, Just Another Perl Hacker
$^=q;@!&gt;~|{&gt;krw&gt;yn{u&lt;$$&lt;[~||&lt;Juukn{=,&lt;S~|}&lt;Jwx}qn{&lt;Yn{u&lt;Qjltn{ &gt; 0gFzD gD,
 00Fz, 0,,&#40; 0hF 0g&#41;F/=, 0&gt; &#34;L$/GEIFewe{,$/ 0C$~&gt; &#34;@=,m,|,&#40;e 0.&#41;, 01,pnn,y{
rw} &gt;;,$0=q,$,,&#40;$_=$^&#41;=~y,$/ C-~&gt;&lt;@=\n\r,-~$:-u/ #y,d,s,&#40;\$.&#41;,$1,gee,print
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1771931" href="/Public/Bug/Display.html?id=124447#txn-1771931">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;19&nbsp;13:42:31&nbsp;2018</span>
    <span class="description">eponymousalias [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> eponymousalias [...] yahoo.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1771931/953488/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/953488">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Feb 18 15:45:47 2018, RRA wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#34;eponymous alias via RT&#34; &lt;bug-podlators@rt.cpan.org&gt; writes:
&gt; 
<div class="message-stanza open">&gt; &gt; I have a bunch of =item lines that contain multi-word tags with many
&gt; &gt; embedded color changes &#40;generated by B&lt;words&gt; and I&lt;words&gt; elements&#41;.
</div>&gt; 
<div class="message-stanza open">&gt; &gt; I observe that when my formatted POD is output to an xterm, text in open
&gt; &gt; paragraphs manages to use the Pod::Text::Termcap::wrap&#40;&#41; routine, and
&gt; &gt; the characters comprising escape sequences for color changes embedded in
&gt; &gt; that text do not cause early wrapping.  However, for some reason the
&gt; &gt; text in my =item tags seems to be processed instead by
&gt; &gt; Pod::Text::wrap&#40;&#41;, meaning I get wrapping much too soon in this text.
</div>&gt; 
&gt; Thank you, and thanks for the reproducible test case!  I tracked this one
&gt; down too, although it was elusive.  The correct wrap routine was being
&gt; called, but due to a subtle error in the rather complicated regex used to
&gt; wrap text with embeded escape sequences, it wasn&#39;t recognizing the end of
&gt; the string and thought it had to wrap.
&gt; 
&gt; This problem also affected Pod::Text::Color, since it used a very similar
&gt; regex, and will be fixed in the next release.
</div>
I&#39;m very happy to see these corrections going in.  So much so, that I
just downloaded the current GitHub copy &#40;pre-v4.11&#41; and tried it out.
It&#39;s working well now for the reported problems.

That said, I observe a residual issue, that of sometimes losing color when
a long =item line is wrapped and the output is run through certain pagers.
Here is a variety of test lines so you can see when the problem does
and does not occur.

=over 4

=item B&lt;autosetup status&gt; [B&lt;-t&gt;] {B&lt;-a&gt;|[B&lt;-e&gt;|B&lt;-f&gt;|B&lt;-u&gt;] I&lt;hostname&gt; ...}

=item B&lt;autosetup validate&gt; I&lt;hostname&gt; ...

=item B&lt;autosetup install -p&gt; I&lt;patternfile&gt; I&lt;hostname&gt; ...

=item B&lt;autosetup print analysis&gt; [B&lt;-e&gt;|B&lt;-f&gt;|B&lt;-u&gt;] I&lt;hostname&gt; ...

=item B&lt;autosetup install -p standard_test_only_trigger host1 host2 host3&gt;

=back

When that last item in particular gets wrapped because the terminal
window is not wide enough to contain the entire item &#40;say, only 60
characters wide, set by an explicit width option in the Pod::Text::Termcap
constructor&#41;, the second and later lines of that item may lose their
coloring.  The issue seems to be that if the content enclosed in my B&lt;&gt;
formatting code contains a space character, then if the wrapping breaks
on such a space, the coloring may be lost.  I suppose the same would
be true with I&lt;&gt;.  Here is the raw wrapped text being displayed, with
escape characters made visible as ESC:

    ESC[1mautosetup install -p standard_test_only_trigger host1
    host2 host3ESC[0m

I&#39;m using an xterm and piping the output to &#34;less -R&#34;, and that&#39;s the
context where the problem shows up.  &#34;more -f&#34; doesn&#39;t have this problem.
This is clearly an issue most directly attributable to the pager, not
to Pod::Text::Termcap.  But you may want to consider some defensive
measures, namely if a wrap occurs while $$self{BOLD} or $$self{UNDL}
is in effect, close out that line with $$self{NORM} and start the next
line &#40;after leading spaces&#41; with the $$self{BOLD} or $$self{UNDL} that
was previously in effect.

To be precise, this problem is happening with both less version 436, which
is present in both RHEL 5.11 and CentOS 6.9, and with less version 458,
which is present in CentOS 7.4.1708 &#40;the most current CentOS release&#41;.
I have also downloaded, compiled, and tested less version 530, the
current upstream release &#40;2018-02-17&#41;, and it behaves the same way.
I suppose a bug could be filed on that end as well.  But these older
versions of the pager will be with us for a long time, so having the
Perl package be extra-careful seems like a sensible precaution.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1777287" href="/Public/Bug/Display.html?id=124447#txn-1777287">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;18&nbsp;16:21:04&nbsp;2018</span>
    <span class="description">eagle [...] eyrie.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #124447] Pod::Text::Termcap explicit width control is faulty</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 18 Mar 2018 13:13:06 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;eponymous alias via RT&#34; &lt;bug-podlators [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Russ Allbery &lt;eagle [...] eyrie.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1777287/956348/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/956348">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;eponymous alias via RT&#34; &lt;bug-podlators@rt.cpan.org&gt; writes:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; That said, I observe a residual issue, that of sometimes losing color
&gt; when a long =item line is wrapped and the output is run through certain
&gt; pagers.  Here is a variety of test lines so you can see when the problem
&gt; does and does not occur.
</div>
[...]

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m using an xterm and piping the output to &#34;less -R&#34;, and that&#39;s the
&gt; context where the problem shows up.  &#34;more -f&#34; doesn&#39;t have this
&gt; problem.  This is clearly an issue most directly attributable to the
&gt; pager, not to Pod::Text::Termcap.  But you may want to consider some
&gt; defensive measures, namely if a wrap occurs while $$self{BOLD} or
&gt; $$self{UNDL} is in effect, close out that line with $$self{NORM} and
&gt; start the next line &#40;after leading spaces&#41; with the $$self{BOLD} or
&gt; $$self{UNDL} that was previously in effect.
</div>
Thanks for this report!  Indeed, this is a know property of some pagers:
they clear all text attributes at the end of each line.  I think it&#39;s a
tradeoff between accurately showing the document and avoiding corrupted
output.

It took me a few weeks to get to this, but I&#39;ve now put in place the fix
you suggest, for both Pod::Text::Termcap and Pod::Text::Color, and have
pushed the patch up to GitHub.  &#40;I&#39;m not 100% happy with the text surgery
that I used to do it, but I couldn&#39;t quickly think of a better approach
and it should work.&#41;

-- 
Russ Allbery &#40;eagle@eyrie.org&#41;              &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.eyrie.org/~eagle/">http://www.eyrie.org/~eagle/</a></span>&gt;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1784686" href="/Public/Bug/Display.html?id=124447#txn-1784686">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;01&nbsp;02:41:15&nbsp;2018</span>
    <span class="description">eponymousalias [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #124447] Pod::Text::Termcap explicit width control is faulty</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 1 May 2018 06:41:06 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-podlators [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> eponymous alias &lt;eponymousalias [...] yahoo.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1784686/960071/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/960071">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 752b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun, 3/18/18, Russ Allbery via RT &lt;bug-podlators@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; That said, I observe a residual issue, that of sometimes losing color
&gt; &gt; when a long =item line is wrapped and the output is run through certain 
&gt; &gt; pagers. 
</div>&gt;
&gt; [...]
&gt;
&gt; It took me a few weeks to get to this, but I&#39;ve now put in place the fix 
&gt; you suggest, for both Pod::Text::Termcap and Pod::Text::Color, and have
&gt; pushed the patch up to GitHub.  &#40;I&#39;m not 100% happy with the text surgery 
&gt; that I used to do it, but I couldn&#39;t quickly think of a better approach
&gt; and it should work.&#41;
</div>
I have downloaded and installed the current GitHub code and run a few 
quick tests.  It&#39;s not a full test suite or anything, but it&#39;s at least
working fine in the context I see.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1785877" href="/Public/Bug/Display.html?id=124447#txn-1785877">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;10&nbsp;14:39:58&nbsp;2018</span>
    <span class="description">RRA [...] cpan.org -  Fixed in 4.11 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1785878" href="/Public/Bug/Display.html?id=124447#txn-1785878">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;10&nbsp;14:39:58&nbsp;2018</span>
    <span class="description">RRA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1785878/960598/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/960598">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 14b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixed in 4.11.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1785881" href="/Public/Bug/Display.html?id=124447#txn-1785881">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;10&nbsp;14:39:59&nbsp;2018</span>
    <span class="description">RRA [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1785883" href="/Public/Bug/Display.html?id=124447#txn-1785883">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;10&nbsp;14:39:59&nbsp;2018</span>
    <span class="description">RRA [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.37217</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
