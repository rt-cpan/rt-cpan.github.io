<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #62060 for Audio-Wav: $^X in Wav.pm breaks with mod_perl</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #62060 for Audio-Wav: $^X in Wav.pm breaks with mod_perl</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Audio-Wav/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Audio-Wav/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Audio-Wav/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Audio-Wav/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Audio-Wav">Audio-Wav CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">62060</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Audio-Wav/Active/">Audio-Wav</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
david [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-3106-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.12    </td>
  </tr>
  <tr id="CF-3107-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.13    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;11&nbsp;18:45:51&nbsp;2010</span>
    <span class="description">david [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> $^X in Wav.pm breaks with mod_perl</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Audio::Wav does this in its BEGIN block:

        my $inline_c_ok = `$^X -e &#34;require Inline::C; eval { Inline-&gt;import&#40;C =&gt; q[int foo&#40;&#41; { return 0; }]&#41; }; print \\\$\@ ? 0 : 1&#34;`;

The problem is that when running in mod_perl, $^X is not &#34;/usr/bin/perl&#34; but &#34;/usr/lib/apache2/mpm-itk/apache2&#34; or something equivalent. 
So the test runs something random which luckily doesn&#39;t take a -e argument &#40;it also spews usage errors into my apache logs&#41;.

I&#39;m guessing the same thing happens on anything that embeds a perl interpreter.

Replacing the code with the following fixes the issue for me:

        use Config;
        my $perl = $Config{perlpath};
        $perl .= $Config{_exe} unless $perl =~ m/$Config{_exe}$/i;
        my $inline_c_ok = `$perl -e &#34;require Inline::C; eval { Inline-&gt;import&#40;C =&gt; q[int foo&#40;&#41; { return 0; }]&#41; }; print \\\$\@ ? 0 : 1&#34;`;

And you could probably just get away with this if you don&#39;t care about windows:

        use Config;
        my $inline_c_ok = `$Config{perlpath} -e &#34;require Inline::C; eval { Inline-&gt;import&#40;C =&gt; q[int foo&#40;&#41; { return 0; }]&#41; }; print \\\$\@ ? 0 : 1&#34;`;

-David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;14&nbsp;19:24:09&nbsp;2012</span>
    <span class="description">mario [...] toursprung.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mario [...] toursprung.com</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I confirm too the issue with the $^X under mod_perl.

Further one needs to create and set the proper permissions for the 
_Inline
directory in order Inline to be able to compile and execute its stuff.
In my particular case I had to create an /_Inline directory. 

I attached a small patch for the Inline::C check

On Mon Oct 11 18:45:51 2010, david wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Audio::Wav does this in its BEGIN block:
&gt; 
&gt;         my $inline_c_ok = `$^X -e &#34;require Inline::C; eval { Inline-
<div class="message-stanza open">&gt; &gt;import&#40;C =&gt; q[int foo&#40;&#41; { return 0; }]&#41; }; print \\\$\@ ? 0 : 1&#34;`;
</div>&gt; 
&gt; The problem is that when running in mod_perl, $^X is not
&gt; &#34;/usr/bin/perl&#34; but &#34;/usr/lib/apache2/mpm-itk/apache2&#34; or something
&gt; equivalent.
&gt; So the test runs something random which luckily doesn&#39;t take a -e
&gt; argument &#40;it also spews usage errors into my apache logs&#41;.
&gt; 
&gt; I&#39;m guessing the same thing happens on anything that embeds a perl
&gt; interpreter.
&gt; 
&gt; Replacing the code with the following fixes the issue for me:
&gt; 
&gt;         use Config;
&gt;         my $perl = $Config{perlpath};
&gt;         $perl .= $Config{_exe} unless $perl =~ m/$Config{_exe}$/i;
&gt;         my $inline_c_ok = `$perl -e &#34;require Inline::C; eval { Inline-
<div class="message-stanza open">&gt; &gt;import&#40;C =&gt; q[int foo&#40;&#41; { return 0; }]&#41; }; print \\\$\@ ? 0 : 1&#34;`;
</div>&gt; 
&gt; And you could probably just get away with this if you don&#39;t care about
&gt; windows:
&gt; 
&gt;         use Config;
&gt;         my $inline_c_ok = `$Config{perlpath} -e &#34;require Inline::C;
&gt; eval { Inline-&gt;import&#40;C =&gt; q[int foo&#40;&#41; { return 0; }]&#41; }; print \\\$\@
&gt; ? 0 : 1&#34;`;
&gt; 
&gt; -David
</div></div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Wav.pm.0.12.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- Wav.pm.orig	2012-02-15 00:21:20.910434977 +0100
+++ Wav.pm	2012-02-15 00:54:49.215417028 +0100
@@ -1,5 +1,6 @@
 package Audio::Wav;
 
+use Config;
 use strict;
 eval { require warnings; }; #it&#39;s ok if we can&#39;t load warnings
 
@@ -18,7 +19,11 @@
         # result in errors about @INC. hack around this by launching a
         # seperate process instead of simply checking $@ after:
         #   eval { Inline-&gt;import&#40;C =&gt; &#34;int foo&#40;&#41; { return 0; }\n&#34;&#41;; };
-        my $inline_c_ok = `$^X -e &#34;require Inline::C; eval { Inline-&gt;import&#40;C =&gt; q[int foo&#40;&#41; { return 0; }]&#41; }; print \\\$\@ ? 0 : 1&#34;`;
+        my $secure_perl_path = $Config{perlpath};
+        if &#40;$^O ne &#39;VMS&#39;&#41;
+           {$secure_perl_path .= $Config{_exe}
+                unless $secure_perl_path =~ m/$Config{_exe}$/i;}
+        my $inline_c_ok = `$secure_perl_path -e &#34;require Inline::C; eval { Inline-&gt;import&#40;C =&gt; q[int foo&#40;&#41; { return 0; }]&#41; }; print \\\$\@ ? 0 : 1&#34;`;
         if&#40;$inline_c_ok&#41; {
             $Audio::Wav::_has_inline = 1;
         } else {
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;14&nbsp;19:24:10&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;30&nbsp;16:39:37&nbsp;2012</span>
    <span class="description">brianski [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks, Mario and David, and sorry it took so long to fix this simple 
problem.

I&#39;ve applied something between your two patches and uploaded it to SVN. 
It will be released with 0.13 this weekend.

If you want to send me your names to be included in the Changes file, 
feel free &#40;otherwise you will be credited by first name only&#41;

Thanks!
Brian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;30&nbsp;16:39:38&nbsp;2012</span>
    <span class="description">brianski [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;27&nbsp;01:00:48&nbsp;2014</span>
    <span class="description">brianski [...] cpan.org -  Status changed from &#39;stalled&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;27&nbsp;01:00:49&nbsp;2014</span>
    <span class="description">brianski [...] cpan.org -  Fixed in 0.13 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
