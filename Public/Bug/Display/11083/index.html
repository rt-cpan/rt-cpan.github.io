<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #11083 for Tk: Tk::Canvas: -dash, Bitmap</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #11083 for Tk: Tk::Canvas: -dash, Bitmap</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Tk/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Tk/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Tk/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Tk/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Tk">Tk CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">11083</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Tk/Active/">Tk</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
wolfgang.laun [...] alcatel.at

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-33610-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
804.027    </td>
  </tr>
  <tr id="CF-33611-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;19&nbsp;08:09:43&nbsp;2005</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Tk::Canvas: -dash, Bitmap</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here are some patches against bugs in Tk-804.027. I&#39;ve 
tested them on Linux only. Some of the fixes may have to 
go into the original Tk code and documentation. 



Correcting the handling of the -dash option for canvas items 
------------------------------------------------------------ 

The problems addressed by this patch are: 

&#40;1&#41; For all canvas items supporting the option -dash, any pattern 
specified as a list of exactly two identical integers, e.g. 
   -dash =&gt; [ 4, 4 ] 
is ignored, and a solid line is drawn. 

&#40;2&#41; With a list consisting of a single integer, or a scalar integer, 
e.g. 
   -dash =&gt; [ 4 ] 
   -dash =&gt; 4 
no error is reported. 

&#40;3&#41; Error reporting is broken in some cases &#40;producing weird 
messages about bad utf8 encoding&#41;, e.g. 
   -dash =&gt; &#39;,;&#39; 
   -dash =&gt; [ &#39;x&#39;, 4 ] 

&#40;4&#41; The feature of specifying dash patterns by a string consisting 
of [.,-_ ] isn&#39;t implemented according to the documentation: 
&#40;a&#41; The &#39;.&#39; should produce a &#34;dot&#34;, but results in a 2x1-rectangle. 
    Since all other values are longer, there is no way to produces 
    &#34;dots&#34;. 
&#40;b&#41; According to the examples, a defult gap has the same width as a 
    dash resulting from a &#34;,&#34;. An additional space, however, 
    increments the preceding gap by the -width value plus 1, which 
    is surprising and, moreover, doesn&#39;t scale well with increased 
    width. 

&#40;5&#41; If some dash or gap length resulting from a string specification 
    exceeds the capacity of a char &#40;UCHAR_MAX&#41;, the result is 
    silently taken modulo 256. Using UCHAR_MAX appears to be closer 
    to the real value. &#40;Perhaps raising a fatal error would be 
    even better.&#41; 

&#40;6&#41; Outlines of rectangles and ovals are drawn as solid lines 
    whenever the width is greater than or equal to the gap. 

The fix of &#40;4&#41; is bound to change the behaviour of existing 
programs using this form of dash specifications. If this must 
be avoided, the documentation would have to be rewritten. 

Affected files: pTk/tkCanvUtil.c, pTk/tkRectOval.c, pod/Canvas.pod 



Documenting and checking a restriction on canvas bitmaps 
-------------------------------------------------------- 

This patch does two things: 

First it documents the restriction that a set of canvas bitmaps 
specified as the normal, active and disabled bitmap must have 
identical dimensions. 

Second, it adds a check, resulting in an error if this is rule 
violated. 

Trying to use bitmaps of various x- and/or y-sizes results in 
the active or disabled bitmap to appear in wrong positions 
with respect to the anchor. Fixing this &#40;e.g. by computing the 
minimum-maximum rectangle across all bitmaps&#41; doesn&#39;t help 
because drawing a bitmap is still restricted to the bitmap&#39;s 
own rectangle. Even if this were fixed, it&#39;d still not be 
satisfactory. Consider the case where the cursor hits the 
&#39;normal&#39; bitmap in an area that is not covered by the &#39;active&#39; 
bitmap. This would then result in the &#39;active&#39; bitmap replacing 
the &#39;normal&#39; one - but then the cursor won&#39;t be on the bitmap 
any more, so that the &#39;normal&#39; one would return, and so on. 

Affected files: pTk/tkCanvBmap.c, pod/Canvas.pod 
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">{\rtf1\ansi\ansicpg1252\deff0\deflang1031{\fonttbl{\f0\froman\fcharset0 Times New Roman;}{\f1\fswiss\fcharset0 Arial;}}
\viewkind4\uc1\pard\f0\fs20 --- pTk/tkCanvUtil.c.old Sun Dec 26 19:06:26 2004\fs24  \line\fs20 +++ pTk/tkCanvUtil.c Sun Dec 26 19:06:58 2004\fs24  \line\fs20 @@ -798,9 +798,7 @@\fs24  \line\fs20 if &#40;&#40;*value == &#39;.&#39;&#41; || &#40;*value == &#39;,&#39;&#41; ||\fs24  \line\fs20 &#40;*value == &#39;-&#39;&#41; || &#40;*value == &#39;_&#39;&#41;&#41; \{\fs24  \line\fs20 i = DashConvert&#40; NULL, value, -1, 0.0&#41;;\fs24  \line\fs20 - if &#40;i&gt;0&#41; \{\fs24  \line\fs20 - i = strlen&#40;value&#41;;\fs24  \line\fs20 - \} else \{\fs24  \line\fs20 + if &#40;i&lt;0&#41; \{\fs24  \line\fs20 goto badDashList;\fs24  \line\fs20\}\fs24  \line\fs20 if &#40;i &gt; &#40;int&#41; sizeof&#40;char *&#41;&#41; \{\fs24  \line\fs20 @@ -812,7 +810,8 @@\fs24  \line\fs20 dash-&gt;number = -i;\fs24  \line\fs20 return TCL_OK;\fs24  \line\fs20\}\fs24  \line\fs20 - if &#40;Tcl_ListObjGetElements&#40;interp, ovalue, &#38;argc, &#38;objv&#41; != TCL_OK&#41;\fs24  \line\fs20\{\fs24  \line\fs20 + if &#40;Tcl_ListObjGetElements&#40;interp, ovalue, &#38;argc, &#38;objv&#41; != TCL_OK\fs24  \line\fs20 ||\fs24  \line\fs20 + argc &lt;= 1&#41; \{\fs24  \line\fs20 Tcl_ResetResult&#40;interp&#41;;\fs24  \line\fs20 badDashList:\fs24  \line\fs20 Tcl_AppendResult&#40;interp, &#34;bad dash list \\&#34;&#34;, value,\fs24  \line\fs20 @@ -841,7 +840,7 @@\fs24  \line\fs20 i &lt; 1 || i&gt;255&#41; \{\fs24  \line\fs20 Tcl_ResetResult&#40;interp&#41;;\fs24  \line\fs20 Tcl_AppendResult&#40;interp, &#34;expected integer in the range\fs24  \line\fs20 1..255 but got \\&#34;&#34;,\fs24  \line\fs20 - *largv, &#34;\\&#34;&#34;, NULL&#41;;\fs24  \line\fs20 + Tcl_GetString&#40;*largv&#41;, &#34;\\&#34;&#34;,\fs24  \line\fs20 NULL&#41;;\fs24  \line\fs20 goto syntaxError;\fs24  \line\fs20\}\fs24  \line\fs20 *pt++ = i;\fs24  \line\fs20 @@ -1054,8 +1053,6 @@\fs24  \line\fs20 gcValues-&gt;dash_offset = outline-&gt;offset;\fs24  \line\fs20 if &#40;dash-&gt;number &gt;= 2&#41; \{\fs24  \line\fs20 gcValues-&gt;dashes = 4;\fs24  \line\fs20 - \} else if &#40;dash-&gt;number &gt; 0&#41; \{\fs24  \line\fs20 - gcValues-&gt;dashes = dash-&gt;pattern.array[0];\fs24  \line\fs20\} else \{\fs24  \line\fs20 gcValues-&gt;dashes = &#40;char&#41; &#40;4 * width&#41;;\fs24  \line\fs20\}\fs24  \line\fs20 @@ -1141,7 +1138,7 @@\fs24  \line\fs20 return 0;\fs24  \line\fs20\}\fs24  \line\line\fs20 - if &#40;&#40;dash-&gt;number&lt;-1&#41; || &#40;&#40;dash-&gt;number == -1&#41; &#38;&#38;\fs24  \line\fs20 &#40;dash-&gt;pattern.array[1]!=&#39;,&#39;&#41;&#41;&#41; \{\fs24  \line\fs20 + if &#40; dash-&gt;number&lt;=-2 &#41; \{\fs24  \line\fs20 char *q;\fs24  \line\fs20 int i = -dash-&gt;number;\fs24  \line\line\fs20 @@ -1151,8 +1148,7 @@\fs24  \line\fs20 XSetDashes&#40;&#40;&#40;TkCanvas *&#41;canvas&#41;-&gt;display, outline-&gt;gc,\fs24  \line\fs20 outline-&gt;offset, q, i&#41;;\fs24  \line\fs20 values.line_style = LineOnOffDash;\fs24  \line\fs20 ckfree&#40;q&#41;;\fs24  \line\fs20 - \} else if &#40; dash-&gt;number&gt;2 || &#40;dash-&gt;number==2 &#38;&#38;\fs24  \line\fs20 - &#40;dash-&gt;pattern.array[0]!=dash-&gt;pattern.array[1]&#41;&#41;&#41; \{\fs24  \line\fs20 + \} else if &#40; dash-&gt;number&gt;=2 &#41; \{\fs24  \line\fs20 p = &#40;char *&#41; &#40;dash-&gt;number &gt; &#40;int&#41; sizeof&#40;char *&#41;&#41; ?\fs24  \line\fs20 dash-&gt;pattern.pt : dash-&gt;pattern.array;\fs24  \line\fs20 XSetDashes&#40;&#40;&#40;TkCanvas *&#41;canvas&#41;-&gt;display, outline-&gt;gc,\fs24  \line\fs20 outline-&gt;offset, p, dash-&gt;number&#41;;\fs24  \line\fs20 values.line_style = LineOnOffDash;\fs24  \line\fs20 @@ -1262,13 +1258,9 @@\fs24  \line\fs20 return 0;\fs24  \line\fs20\}\fs24  \line\line\fs20 - if &#40;&#40;dash-&gt;number &gt; 2&#41; || &#40;dash-&gt;number &lt; -1&#41; || &#40;dash-&gt;number==2\fs24  \line\fs20 &#38;&#38;\fs24  \line\fs20 - &#40;dash-&gt;pattern.array[0] != dash-&gt;pattern.array[1]&#41;&#41; ||\fs24  \line\fs20 - &#40;&#40;dash-&gt;number == -1&#41; &#38;&#38; &#40;dash-&gt;pattern.array[1] !=\fs24  \line\fs20 &#39;,&#39;&#41;&#41;&#41; \{\fs24  \line\fs20 + if &#40; &#40;dash-&gt;number &gt;= 2&#41; || &#40;dash-&gt;number &lt;= -2&#41; &#41; \{\fs24  \line\fs20 if &#40;dash-&gt;number &lt; 0&#41; \{\fs24  \line\fs20 dashList = &#40;int&#41; &#40;4 * width + 0.5&#41;;\fs24  \line\fs20 - \} else if &#40;dash-&gt;number&lt;3&#41; \{\fs24  \line\fs20 - dashList = dash-&gt;pattern.array[0];\fs24  \line\fs20\} else \{\fs24  \line\fs20 dashList = 4;\fs24  \line\fs20\}\fs24  \line\fs20 @@ -1449,7 +1441,7 @@\fs24  \line\fs20 double width;\fs24  \line\fs20\{\fs24  \line\fs20 int result = 0;\fs24  \line\fs20 - int size, intWidth;\fs24  \line\fs20 + int size, intWidth, actWidth;\fs24  \line\line\fs20 if &#40;n&lt;0&#41; \{\fs24  \line\fs20 n = strlen&#40;p&#41;;\fs24  \line\fs20 @@ -1463,7 +1455,7 @@\fs24  \line\fs20 case &#39; &#39;:\fs24  \line\fs20 if &#40;result&#41; \{\fs24  \line\fs20 if &#40;l&#41; \{\fs24  \line\fs20 - l[-1] += intWidth + 1;\fs24  \line\fs20 + l[-1] += intWidth;\fs24  \line\fs20\}\fs24  \line\fs20 continue;\fs24  \line\fs20\} else \{\fs24  \line\fs20 @@ -1471,23 +1463,25 @@\fs24  \line\fs20\}\fs24  \line\fs20 break;\fs24  \line\fs20 case &#39;_&#39;:\fs24  \line\fs20 - size = 8;\fs24  \line\fs20 + size = 4;\fs24  \line\fs20 break;\fs24  \line\fs20 case &#39;-&#39;:\fs24  \line\fs20 - size = 6;\fs24  \line\fs20 + size = 3;\fs24  \line\fs20 break;\fs24  \line\fs20 case &#39;,&#39;:\fs24  \line\fs20 - size = 4;\fs24  \line\fs20 + size = 2;\fs24  \line\fs20 break;\fs24  \line\fs20 case &#39;.&#39;:\fs24  \line\fs20 - size = 2;\fs24  \line\fs20 + size = 1;\fs24  \line\fs20 break;\fs24  \line\fs20 default:\fs24  \line\fs20 return -1;\fs24  \line\fs20\}\fs24  \line\fs20 if &#40;l&#41; \{\fs24  \line\fs20 - *l++ = size * intWidth;\fs24  \line\fs20 - *l++ = 4 * intWidth;\fs24  \line\fs20 + actWidth = size * intWidth;\fs24  \line\fs20 + *l++ = actWidth &gt; UCHAR_MAX ? UCHAR_MAX : actWidth;\fs24  \line\fs20 + actWidth = 2 * intWidth;\fs24  \line\fs20 + *l++ = actWidth &gt; UCHAR_MAX ? UCHAR_MAX : actWidth;\fs24  \line\fs20\}\fs24  \line\fs20 result += 2;\fs24  \line\fs20\}\fs24  \line\fs20 --- pTk/tkRectOval.c.old Tue Dec 28 07:39:21 2004\fs24  \line\fs20 +++ pTk/tkRectOval.c Tue Dec 28 08:07:29 2004\fs24  \line\fs20 @@ -476,8 +476,6 @@\fs24  \line\fs20 if &#40;mask &#38;&#38; \\\fs24  \line\fs20 rectOvalPtr-&gt;outline.width != 0 &#38;&#38; \\\fs24  \line\fs20 rectOvalPtr-&gt;outline.color != NULL&#41; \{\fs24  \line\fs20 - gcValues.cap_style = CapProjecting;\fs24  \line\fs20 - mask |= GCCapStyle;\fs24  \line\fs20 newGC = Tk_GetGC&#40;tkwin, mask, &#38;gcValues&#41;;\fs24  \line\fs20\} else \{\fs24  \line\fs20 newGC = None;\fs24  \line\fs20 --- pTk/tkCanvBmap.c.old Wed Nov 24 11:13:10 2004\fs24  \line\fs20 +++ pTk/tkCanvBmap.c Sat Dec 18 22:46:23 2004\fs24  \line\fs20 @@ -331,6 +331,8 @@\fs24  \line\fs20 XColor *bgColor;\fs24  \line\fs20 Pixmap bitmap;\fs24  \line\fs20 Tk_State state;\fs24  \line\fs20 + int width, height;\fs24  \line\fs20 + int width1, height1;\fs24  \line\line\fs20 tkwin = Tk_CanvasTkwin&#40;canvas&#41;;\fs24  \line\fs20 if &#40;TCL_OK != Tk_ConfigureWidget&#40;interp, tkwin, configSpecs, objc,\fs24  \line\fs20 @@ -353,6 +355,28 @@\fs24  \line\fs20 itemPtr-&gt;redraw_flags &#38;= ~TK_ITEM_STATE_DEPENDANT;\fs24  \line\fs20\}\fs24  \line\line\fs20 + /* Check that bitmaps have same width and height */\fs24  \line\fs20 + Tk_SizeOfBitmap&#40;Tk_Display&#40;Tk_CanvasTkwin&#40;canvas&#41;&#41;,\fs24  \line\fs20 bmapPtr-&gt;bitmap,\fs24  \line\fs20 + &#38;width, &#38;height&#41;;\fs24  \line\fs20 + if &#40;bmapPtr-&gt;activeBitmap!=None&#41; \{\fs24  \line\fs20 + Tk_SizeOfBitmap&#40;Tk_Display&#40;Tk_CanvasTkwin&#40;canvas&#41;&#41;,\fs24  \line\fs20 + bmapPtr-&gt;activeBitmap,\fs24  \line\fs20 + &#38;width1, &#38;height1&#41;;\fs24  \line\fs20 + if &#40;width != width1 || height != height1&#41; \{\fs24  \line\fs20 + Tcl_SetResult&#40;interp, &#34;active bitmap dimensions differ&#34;,\fs24  \line\fs20 TCL_STATIC&#41;;\fs24  \line\fs20 + return TCL_ERROR;\fs24  \line\fs20 + \}\fs24  \line\fs20 + \}\fs24  \line\fs20 + if &#40;bmapPtr-&gt;disabledBitmap!=None&#41; \{\fs24  \line\fs20 + Tk_SizeOfBitmap&#40;Tk_Display&#40;Tk_CanvasTkwin&#40;canvas&#41;&#41;,\fs24  \line\fs20 + bmapPtr-&gt;disabledBitmap,\fs24  \line\fs20 + &#38;width1, &#38;height1&#41;;\fs24  \line\fs20 + if &#40;width != width1 || height != height1&#41; \{\fs24  \line\fs20 + Tcl_SetResult&#40;interp, &#34;disabled bitmap dimensions differ&#34;,\fs24  \line\fs20 TCL_STATIC&#41;;\fs24  \line\fs20 + return TCL_ERROR;\fs24  \line\fs20 + \}\fs24  \line\fs20 + \}\fs24  \line\fs20 +\fs24  \line\fs20 if &#40;state==TK_STATE_HIDDEN&#41; \{\fs24  \line\fs20 ComputeBitmapBbox&#40;canvas, bmapPtr&#41;;\fs24  \line\fs20 return TCL_OK;\fs24  \line\fs20 --- pod/Canvas.pod.old Sat Dec 25 10:34:16 2004\fs24  \line\fs20 +++ pod/Canvas.pod Sun Dec 26 18:45:41 2004\fs24  \line\fs20 @@ -346,26 +346,29 @@\fs24  \line\fs20 The first possible syntax is a list of integers. Each element\fs24  \line\fs20 represents the number of pixels of a line segment. Only the odd\fs24  \line\fs20 segments are drawn using the &#34;outline&#34; color. The other segments\fs24  \line\fs20 -are drawn transparant.\fs24  \line\fs20 +are drawn transparent.\fs24  \line\line\fs20 The second possible syntax is a character list containing only\fs24  \line\fs20 -5 possible characters B&lt;[.,-_ ]&gt;. The space can be used\fs24  \line\fs20 -to enlarge the space between other line elements, and can not\fs24  \line\fs20 -occur as the first position in the string. Some examples:\fs24  \line\fs20 +5 possible characters B&lt;[.,-_ ]&gt;, with the first 4 characters\fs24  \line\fs20 +producing a segment of length 1 to 4, respectively, followed\fs24  \line\fs20 +by a transparent segment of length 2. The space can be used\fs24  \line\fs20 +repeatedly to enlarge the space between other line elements\fs24  \line\fs20 +by 1, and can not occur as the first position in the string.\fs24  \line\fs20 +The main difference of this syntax with the previous is that it\fs24  \line\fs20 +it shape-conserving. This means that all values in the dash\fs24  \line\fs20 +list will be multiplied by the line width before display. This\fs24  \line\fs20 +assures that &#34;.&#34; will always be displayed as a dot and &#34;-&#34;\fs24  \line\fs20 +always as a dash regardless of the line width.\fs24  \line\fs20 +\fs24  \line\fs20 +Some examples, for a line width of 2:\fs24  \line\line\fs20 -dash . = -dash [2,4]\fs24  \line\fs20 -dash - = -dash [6,4]\fs24  \line\fs20 -dash -. = -dash [6,4,2,4]\fs24  \line\fs20 -dash -.. = -dash [6,4,2,4,2,4]\fs24  \line\fs20 - -dash &#39;. &#39; = -dash [2,8]\fs24  \line\fs20 + -dash &#39;. &#39; = -dash [2,6]\fs24  \line\fs20 -dash &#39;,&#39; = -dash [4,4]\fs24  \line\line\fs20 -The main difference of this syntax with the previous is that it\fs24  \line\fs20 -it shape-conserving. This means that all values in the dash\fs24  \line\fs20 -list will be multiplied by the line width before display. This\fs24  \line\fs20 -assures that &#34;.&#34; will always be displayed as a dot and &#34;-&#34;\fs24  \line\fs20 -always as a dash regardless of the line width.\fs24  \line\fs20 -\fs24  \line\fs20 On systems where only a limited set of dash patterns, the dash\fs24  \line\fs20 pattern will be displayed as the most close dash pattern that\fs24  \line\fs20 is available. For example, on Windows only the first 4 of the\fs24  \line\fs20 @@ -1355,14 +1358,14 @@\fs24  \line\fs20 =item B&lt;-disabledbitmap&gt; =E&lt;gt&gt; I&lt;bitmap&gt;\fs24  \line\line\fs20 Specifies the bitmaps to display in the item in its normal, active and\fs24  \line\fs20 -disabled states.\fs24  \line\fs20 +disabled states. All bitmaps must have the same width and height.\fs24  \line\fs20 I&lt;Bitmap&gt; may have any of the forms accepted by B&lt;Tk_GetBitmap&gt;.\fs24  \line\line\fs20 =item B&lt;-foreground&gt; =E&lt;gt&gt; I&lt;color&gt;\fs24  \line\line\fs20 -=item B&lt;-activeforeground&gt; =E&lt;gt&gt; I&lt;bitmap&gt;\fs24  \line\fs20 +=item B&lt;-activeforeground&gt; =E&lt;gt&gt; I&lt;color&gt;\fs24  \line\line\fs20 -=item B&lt;-disabledforeground&gt; =E&lt;gt&gt; I&lt;bitmap&gt;\fs24  \line\fs20 +=item B&lt;-disabledforeground&gt; =E&lt;gt&gt; I&lt;color&gt;\fs24  \line\line\fs20 Specifies the color to use for each of the bitmap&#39;s &#39;1&#39; valued pixels\fs24  \line\fs20 in its normal, active and disabled states.\fs24  \par
\f1\fs20\par
}
 </div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;06&nbsp;16:36:28&nbsp;2007</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jan 19 08:09:43 2005, guest wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Here are some patches against bugs in Tk-804.027. I&#39;ve 
&gt; tested them on Linux only. Some of the fixes may have to 
&gt; go into the original Tk code and documentation. 
&gt; 
&gt; 
&gt; 
&gt; Correcting the handling of the -dash option for canvas items 
&gt; ------------------------------------------------------------ 
&gt; 
&gt; The problems addressed by this patch are: 
&gt; 
&gt; &#40;1&#41; For all canvas items supporting the option -dash, any pattern 
&gt; specified as a list of exactly two identical integers, e.g. 
&gt;    -dash =&gt; [ 4, 4 ] 
&gt; is ignored, and a solid line is drawn. 
&gt; 
&gt; &#40;2&#41; With a list consisting of a single integer, or a scalar integer, 
&gt; e.g. 
&gt;    -dash =&gt; [ 4 ] 
&gt;    -dash =&gt; 4 
&gt; no error is reported. 
&gt; 
&gt; &#40;3&#41; Error reporting is broken in some cases &#40;producing weird 
&gt; messages about bad utf8 encoding&#41;, e.g. 
&gt;    -dash =&gt; &#39;,;&#39; 
&gt;    -dash =&gt; [ &#39;x&#39;, 4 ] 
&gt; 
&gt; &#40;4&#41; The feature of specifying dash patterns by a string consisting 
&gt; of [.,-_ ] isn&#39;t implemented according to the documentation: 
&gt; &#40;a&#41; The &#39;.&#39; should produce a &#34;dot&#34;, but results in a 2x1-rectangle. 
&gt;     Since all other values are longer, there is no way to produces 
&gt;     &#34;dots&#34;. 
&gt; &#40;b&#41; According to the examples, a defult gap has the same width as a 
&gt;     dash resulting from a &#34;,&#34;. An additional space, however, 
&gt;     increments the preceding gap by the -width value plus 1, which 
&gt;     is surprising and, moreover, doesn&#39;t scale well with increased 
&gt;     width. 
&gt; 
&gt; &#40;5&#41; If some dash or gap length resulting from a string specification 
&gt;     exceeds the capacity of a char &#40;UCHAR_MAX&#41;, the result is 
&gt;     silently taken modulo 256. Using UCHAR_MAX appears to be closer 
&gt;     to the real value. &#40;Perhaps raising a fatal error would be 
&gt;     even better.&#41; 
&gt; 
&gt; &#40;6&#41; Outlines of rectangles and ovals are drawn as solid lines 
&gt;     whenever the width is greater than or equal to the gap. 
&gt; 
&gt; The fix of &#40;4&#41; is bound to change the behaviour of existing 
&gt; programs using this form of dash specifications. If this must 
&gt; be avoided, the documentation would have to be rewritten. 
&gt; 
&gt; Affected files: pTk/tkCanvUtil.c, pTk/tkRectOval.c, pod/Canvas.pod 
&gt; 
&gt; 
&gt; 
&gt; Documenting and checking a restriction on canvas bitmaps 
&gt; -------------------------------------------------------- 
&gt; 
&gt; This patch does two things: 
&gt; 
&gt; First it documents the restriction that a set of canvas bitmaps 
&gt; specified as the normal, active and disabled bitmap must have 
&gt; identical dimensions. 
&gt; 
&gt; Second, it adds a check, resulting in an error if this is rule 
&gt; violated. 
&gt; 
&gt; Trying to use bitmaps of various x- and/or y-sizes results in 
&gt; the active or disabled bitmap to appear in wrong positions 
&gt; with respect to the anchor. Fixing this &#40;e.g. by computing the 
&gt; minimum-maximum rectangle across all bitmaps&#41; doesn&#39;t help 
&gt; because drawing a bitmap is still restricted to the bitmap&#39;s 
&gt; own rectangle. Even if this were fixed, it&#39;d still not be 
&gt; satisfactory. Consider the case where the cursor hits the 
&gt; &#39;normal&#39; bitmap in an area that is not covered by the &#39;active&#39; 
&gt; bitmap. This would then result in the &#39;active&#39; bitmap replacing 
&gt; the &#39;normal&#39; one - but then the cursor won&#39;t be on the bitmap 
&gt; any more, so that the &#39;normal&#39; one would return, and so on. 
&gt; 
&gt; Affected files: pTk/tkCanvBmap.c, pod/Canvas.pod 
&gt; 
</div>

Can you check if this is still an issue in the development version of Tk
&#40;see <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~srezic/Tk-804.027_501/&#41;">http://search.cpan.org/~srezic/Tk-804.027_501/&#41;</a></span>, and if so, can you
resend the patches, as they are in an unusable format &#40;rich text files&#41;.

Regards,
    Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;06&nbsp;16:36:32&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;06&nbsp;18:17:56&nbsp;2007</span>
    <span class="description">SREZIC [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;07&nbsp;06:32:51&nbsp;2007</span>
    <span class="description">Wolfgang.Laun [...] thalesgroup.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #11083] Tk::Canvas: -dash, Bitmap</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 07 Nov 2007 12:31:50 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Tk [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Wolfgang Laun &lt;Wolfgang.Laun [...] thalesgroup.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#40;5&#41; was fixed but all the rest is still in Tk-804.027_501.
The patch is against this version; I have retested it on Linux.
Kind regards
Wolfgang



Slaven_Rezic via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=11083">http://rt.cpan.org/Ticket/Display.html?id=11083</a></span> &gt;
&gt;
&gt;On Wed Jan 19 08:09:43 2005, guest wrote:
&gt;  
&gt;
<div class="message-stanza open">&gt;&gt;Here are some patches against bugs in Tk-804.027. I&#39;ve 
&gt;&gt;tested them on Linux only. Some of the fixes may have to 
&gt;&gt;go into the original Tk code and documentation. 
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;Correcting the handling of the -dash option for canvas items 
&gt;&gt;------------------------------------------------------------ 
&gt;&gt;
&gt;&gt;The problems addressed by this patch are: 
&gt;&gt;
&gt;&gt;&#40;1&#41; For all canvas items supporting the option -dash, any pattern 
&gt;&gt;specified as a list of exactly two identical integers, e.g. 
&gt;&gt;   -dash =&gt; [ 4, 4 ] 
&gt;&gt;is ignored, and a solid line is drawn. 
&gt;&gt;
&gt;&gt;&#40;2&#41; With a list consisting of a single integer, or a scalar integer, 
&gt;&gt;e.g. 
&gt;&gt;   -dash =&gt; [ 4 ] 
&gt;&gt;   -dash =&gt; 4 
&gt;&gt;no error is reported. 
&gt;&gt;
&gt;&gt;&#40;3&#41; Error reporting is broken in some cases &#40;producing weird 
&gt;&gt;messages about bad utf8 encoding&#41;, e.g. 
&gt;&gt;   -dash =&gt; &#39;,;&#39; 
&gt;&gt;   -dash =&gt; [ &#39;x&#39;, 4 ] 
&gt;&gt;
&gt;&gt;&#40;4&#41; The feature of specifying dash patterns by a string consisting 
&gt;&gt;of [.,-_ ] isn&#39;t implemented according to the documentation: 
&gt;&gt;&#40;a&#41; The &#39;.&#39; should produce a &#34;dot&#34;, but results in a 2x1-rectangle. 
&gt;&gt;    Since all other values are longer, there is no way to produces 
&gt;&gt;    &#34;dots&#34;. 
&gt;&gt;&#40;b&#41; According to the examples, a defult gap has the same width as a 
&gt;&gt;    dash resulting from a &#34;,&#34;. An additional space, however, 
&gt;&gt;    increments the preceding gap by the -width value plus 1, which 
&gt;&gt;    is surprising and, moreover, doesn&#39;t scale well with increased 
&gt;&gt;    width. 
&gt;&gt;
&gt;&gt;&#40;5&#41; If some dash or gap length resulting from a string specification 
&gt;&gt;    exceeds the capacity of a char &#40;UCHAR_MAX&#41;, the result is 
&gt;&gt;    silently taken modulo 256. Using UCHAR_MAX appears to be closer 
&gt;&gt;    to the real value. &#40;Perhaps raising a fatal error would be 
&gt;&gt;    even better.&#41; 
&gt;&gt;
&gt;&gt;&#40;6&#41; Outlines of rectangles and ovals are drawn as solid lines 
&gt;&gt;    whenever the width is greater than or equal to the gap. 
&gt;&gt;
&gt;&gt;The fix of &#40;4&#41; is bound to change the behaviour of existing 
&gt;&gt;programs using this form of dash specifications. If this must 
&gt;&gt;be avoided, the documentation would have to be rewritten. 
&gt;&gt;
&gt;&gt;Affected files: pTk/tkCanvUtil.c, pTk/tkRectOval.c, pod/Canvas.pod 
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;Documenting and checking a restriction on canvas bitmaps 
&gt;&gt;-------------------------------------------------------- 
&gt;&gt;
&gt;&gt;This patch does two things: 
&gt;&gt;
&gt;&gt;First it documents the restriction that a set of canvas bitmaps 
&gt;&gt;specified as the normal, active and disabled bitmap must have 
&gt;&gt;identical dimensions. 
&gt;&gt;
&gt;&gt;Second, it adds a check, resulting in an error if this is rule 
&gt;&gt;violated. 
&gt;&gt;
&gt;&gt;Trying to use bitmaps of various x- and/or y-sizes results in 
&gt;&gt;the active or disabled bitmap to appear in wrong positions 
&gt;&gt;with respect to the anchor. Fixing this &#40;e.g. by computing the 
&gt;&gt;minimum-maximum rectangle across all bitmaps&#41; doesn&#39;t help 
&gt;&gt;because drawing a bitmap is still restricted to the bitmap&#39;s 
&gt;&gt;own rectangle. Even if this were fixed, it&#39;d still not be 
&gt;&gt;satisfactory. Consider the case where the cursor hits the 
&gt;&gt;&#39;normal&#39; bitmap in an area that is not covered by the &#39;active&#39; 
&gt;&gt;bitmap. This would then result in the &#39;active&#39; bitmap replacing 
&gt;&gt;the &#39;normal&#39; one - but then the cursor won&#39;t be on the bitmap 
&gt;&gt;any more, so that the &#39;normal&#39; one would return, and so on. 
&gt;&gt;
&gt;&gt;Affected files: pTk/tkCanvBmap.c, pod/Canvas.pod 
&gt;&gt;
&gt;&gt;    
&gt;&gt;
</div>&gt;
&gt;
&gt;Can you check if this is still an issue in the development version of Tk
&gt;&#40;see <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~srezic/Tk-804.027_501/&#41;">http://search.cpan.org/~srezic/Tk-804.027_501/&#41;</a></span>, and if so, can you
&gt;resend the patches, as they are in an unusable format &#40;rich text files&#41;.
&gt;
&gt;Regards,
&gt;    Slaven
&gt;
&gt;  
&gt;
</div></div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- pTk/mTk/generic/tkCanvUtil.c.old	2007-02-10 12:29:06.000000000 +0100
+++ pTk/mTk/generic/tkCanvUtil.c	2007-11-07 09:57:15.000000000 +0100
@@ -798,9 +798,7 @@
     if &#40;&#40;*value == &#39;.&#39;&#41; || &#40;*value == &#39;,&#39;&#41; ||
 	    &#40;*value == &#39;-&#39;&#41; || &#40;*value == &#39;_&#39;&#41;&#41; {
 	i = DashConvert&#40;&#40;char *&#41; NULL, value, -1, 0.0&#41;;
-	if &#40;i&gt;0&#41; {
-	    i = strlen&#40;value&#41;;
-	} else {
+	if &#40;i&lt;0&#41; {
 	    goto badDashList;
 	}
 	if &#40;i &gt; &#40;int&#41; sizeof&#40;char *&#41;&#41; {
@@ -812,7 +810,8 @@
 	dash-&gt;number = -i;
 	return TCL_OK;
     }
-    if &#40;Tcl_ListObjGetElements&#40;interp, ovalue, &#38;argc, &#38;objv&#41; != TCL_OK&#41; {
+    if &#40;Tcl_ListObjGetElements&#40;interp, ovalue, &#38;argc, &#38;objv&#41; != TCL_OK ||
+        argc &lt;= 1&#41; {
 	Tcl_ResetResult&#40;interp&#41;;
     badDashList:
 	Tcl_AppendResult&#40;interp, &#34;bad dash list \&#34;&#34;, value,
@@ -841,7 +840,7 @@
 	    i &lt; 1 || i&gt;255&#41; {
 	    Tcl_ResetResult&#40;interp&#41;;
 	    Tcl_AppendResult&#40;interp, &#34;expected integer in the range 1..255 but got \&#34;&#34;,
-			 *largv, &#34;\&#34;&#34;, &#40;char *&#41; NULL&#41;;
+			 Tcl_GetString&#40;*largv&#41;, &#34;\&#34;&#34;, &#40;char *&#41; NULL&#41;;
 	    goto syntaxError;
 	}
 	*pt++ = i;
@@ -1054,8 +1053,6 @@
 	gcValues-&gt;dash_offset = outline-&gt;offset;
 	if &#40;dash-&gt;number &gt;= 2&#41; {
 	    gcValues-&gt;dashes = 4;
-	} else if &#40;dash-&gt;number &gt; 0&#41; {
-	    gcValues-&gt;dashes = dash-&gt;pattern.array[0];
 	} else {
 	    gcValues-&gt;dashes = &#40;char&#41; &#40;4 * width&#41;;
 	}
@@ -1141,7 +1138,7 @@
 	return 0;
     }
 
-    if &#40;&#40;dash-&gt;number&lt;-1&#41; || &#40;&#40;dash-&gt;number == -1&#41; &#38;&#38; &#40;dash-&gt;pattern.array[1]!=&#39;,&#39;&#41;&#41;&#41; {
+    if &#40;dash-&gt;number&lt;=-2&#41; {
 	char *q;
 	int i = -dash-&gt;number;
 
@@ -1151,8 +1148,7 @@
 	XSetDashes&#40;&#40;&#40;TkCanvas *&#41;canvas&#41;-&gt;display, outline-&gt;gc, outline-&gt;offset, q, i&#41;;
 	values.line_style = LineOnOffDash;
 	ckfree&#40;q&#41;;
-    } else if &#40; dash-&gt;number&gt;2 || &#40;dash-&gt;number==2 &#38;&#38;
-		&#40;dash-&gt;pattern.array[0]!=dash-&gt;pattern.array[1]&#41;&#41;&#41; {
+    } else if &#40; dash-&gt;number&gt;=2 &#41; {
 	p = &#40;char *&#41; &#40;dash-&gt;number &gt; &#40;int&#41; sizeof&#40;char *&#41;&#41; ? dash-&gt;pattern.pt : dash-&gt;pattern.array;
 	XSetDashes&#40;&#40;&#40;TkCanvas *&#41;canvas&#41;-&gt;display, outline-&gt;gc, outline-&gt;offset, p, dash-&gt;number&#41;;
 	values.line_style = LineOnOffDash;
@@ -1262,13 +1258,9 @@
 	return 0;
     }
 
-    if &#40;&#40;dash-&gt;number &gt; 2&#41; || &#40;dash-&gt;number &lt; -1&#41; || &#40;dash-&gt;number==2 &#38;&#38;
-		&#40;dash-&gt;pattern.array[0] != dash-&gt;pattern.array[1]&#41;&#41; ||
-		&#40;&#40;dash-&gt;number == -1&#41; &#38;&#38; &#40;dash-&gt;pattern.array[1] != &#39;,&#39;&#41;&#41;&#41; {
+    if &#40; &#40;dash-&gt;number &gt;= 2&#41; || &#40;dash-&gt;number &lt;= -2&#41; &#41; {
 	if &#40;dash-&gt;number &lt; 0&#41; {
 	    dashList = &#40;int&#41; &#40;4 * width + 0.5&#41;;
-	} else if &#40;dash-&gt;number&lt;3&#41; {
-	    dashList = dash-&gt;pattern.array[0];
 	} else {
 	    dashList = 4;
 	}
@@ -1463,7 +1455,7 @@
 	    case &#39; &#39;:
 		if &#40;result&#41; {
 		    if &#40;l&#41; {
-			l[-1] += intWidth + 1;
+			l[-1] += intWidth;
 		    }
 		    continue;
 		} else {
@@ -1471,23 +1463,23 @@
 		}
 		break;
 	    case &#39;_&#39;:
-		size = 8;
+		size = 4;
 		break;
 	    case &#39;-&#39;:
-		size = 6;
+		size = 3;
 		break;
 	    case &#39;,&#39;:
-		size = 4;
+		size = 2;
 		break;
 	    case &#39;.&#39;:
-		size = 2;
+		size = 1;
 		break;
 	    default:
 		return -1;
 	}
 	if &#40;l&#41; {
 	    *l++ = size * intWidth;
-	    *l++ = 4 * intWidth;
+	    *l++ = 2 * intWidth;
 	}
 	result += 2;
     }
--- pTk/mTk/generic/tkRectOval.c.old	2007-02-10 12:29:06.000000000 +0100
+++ pTk/mTk/generic/tkRectOval.c	2007-11-07 10:11:20.000000000 +0100
@@ -476,8 +476,6 @@
     if &#40;mask &#38;&#38; \
 	    rectOvalPtr-&gt;outline.width != 0 &#38;&#38; \
 	    rectOvalPtr-&gt;outline.color != NULL&#41; {
-	gcValues.cap_style = CapProjecting;
-	mask |= GCCapStyle;
 	newGC = Tk_GetGC&#40;tkwin, mask, &#38;gcValues&#41;;
     } else {
 	newGC = None;
--- pTk/mTk/generic/tkCanvBmap.c.old	2007-02-10 12:29:06.000000000 +0100
+++ pTk/mTk/generic/tkCanvBmap.c	2007-11-07 12:12:47.000000000 +0100
@@ -331,6 +331,8 @@
     XColor *bgColor;
     Pixmap bitmap;
     Tk_State state;
+    int width, height;
+    int width1, height1;
 
     tkwin = Tk_CanvasTkwin&#40;canvas&#41;;
     if &#40;TCL_OK != Tk_ConfigureWidget&#40;interp, tkwin, configSpecs, objc, 
@@ -353,6 +355,31 @@
 	itemPtr-&gt;redraw_flags &#38;= ~TK_ITEM_STATE_DEPENDANT;
     }
 
+    /* Check that bitmaps have same width and height. This avoids problems
+       due to wrong position relative to the anchor point, displaying only
+       part of one of the bitmaps, etc.
+     */
+    Tk_SizeOfBitmap&#40;Tk_Display&#40;Tk_CanvasTkwin&#40;canvas&#41;&#41;, bmapPtr-&gt;bitmap,
+	    &#38;width, &#38;height&#41;;
+    if &#40;bmapPtr-&gt;activeBitmap!=None&#41; {
+        Tk_SizeOfBitmap&#40;Tk_Display&#40;Tk_CanvasTkwin&#40;canvas&#41;&#41;,
+                        bmapPtr-&gt;activeBitmap,
+	                &#38;width1, &#38;height1&#41;;
+        if &#40;width != width1 || height != height1&#41; {
+	    Tcl_SetResult&#40;interp, &#34;active bitmap dimensions differ&#34;, TCL_STATIC&#41;;
+            return TCL_ERROR;
+        }
+    }
+    if &#40;bmapPtr-&gt;disabledBitmap!=None&#41; {
+        Tk_SizeOfBitmap&#40;Tk_Display&#40;Tk_CanvasTkwin&#40;canvas&#41;&#41;,
+                        bmapPtr-&gt;disabledBitmap,
+	                &#38;width1, &#38;height1&#41;;
+        if &#40;width != width1 || height != height1&#41; {
+	    Tcl_SetResult&#40;interp, &#34;disabled bitmap dimensions differ&#34;, TCL_STATIC&#41;;
+            return TCL_ERROR;
+        }
+    }
+
     if &#40;state==TK_STATE_HIDDEN&#41; {
 	ComputeBitmapBbox&#40;canvas, bmapPtr&#41;;
 	return TCL_OK;
@@ -382,7 +409,7 @@
 	}
     }
 
-    if &#40;state==TK_STATE_DISABLED || bitmap == None&#41; {
+    if &#40;bitmap == None&#41; {
 	ComputeBitmapBbox&#40;canvas, bmapPtr&#41;;
 	return TCL_OK;
     }
--- pod/Canvas.pod.old	2007-02-10 12:28:59.000000000 +0100
+++ pod/Canvas.pod	2007-11-07 12:21:23.000000000 +0100
@@ -346,29 +346,32 @@
 The first possible syntax is a list of integers. Each element
 represents the number of pixels of a line segment. Only the odd
 segments are drawn using the &#34;outline&#34; color. The other segments
-are drawn transparant.
+are drawn transparent.
 
 The second possible syntax is a character list containing only
-5 possible characters B&lt;[.,-_ ]&gt;. The space can be used
-to enlarge the space between other line elements, and can not
-occur as the first position in the string. Some examples:
+5 possible characters B&lt;[.,-_ ]&gt;,  with the first 4 characters
+producing a segment of length 1 to 4, respectively, followed
+by a transparent segment of length 2. The space can be used
+repeatedly to enlarge the space between other line elements
+by 1, and can not occur as the first position in the string.
+The main difference of this syntax with the previous one is 
+that it it shape-conserving. This means that all values in the dash
+list will be multiplied by the line width before display. This
+assures that &#34;.&#34; will always be displayed as a dot and &#34;-&#34;
+always as a dash regardless of the line width.
+
+Some examples, for a line width of 2:
 
  -dash .     = -dash [2,4]
  -dash -     = -dash [6,4]
  -dash -.    = -dash [6,4,2,4]
  -dash -..   = -dash [6,4,2,4,2,4]
- -dash &#39;. &#39;  = -dash [2,8]
+ -dash &#39;.  &#39; = -dash [2,8]
  -dash &#39;,&#39;   = -dash [4,4]
 
-The main difference of this syntax with the previous is that it
-it shape-conserving. This means that all values in the dash
-list will be multiplied by the line width before display. This
-assures that &#34;.&#34; will always be displayed as a dot and &#34;-&#34;
-always as a dash regardless of the line width.
-
-On systems where only a limited set of dash patterns, the dash
-pattern will be displayed as the most close dash pattern that
-is available. For example, on Windows only the first 4 of the
+On systems where only a limited set of dash patterns is available,
+the dash pattern will be displayed as the closest available dash 
+pattern. For example, on Windows only the first 4 of the
 above examples are available. The last 2 examples will be
 displayed identically as the first one.
 
@@ -1355,14 +1358,14 @@
 =item B&lt;-disabledbitmap&gt; =E&lt;gt&gt; I&lt;bitmap&gt;
 
 Specifies the bitmaps to display in the item in its normal, active and
-disabled states.
+disabled states. All bitmaps must have the same width and height.
 I&lt;Bitmap&gt; may have any of the forms accepted by B&lt;Tk_GetBitmap&gt;.
 
 =item B&lt;-foreground&gt; =E&lt;gt&gt; I&lt;color&gt;
 
-=item B&lt;-activeforeground&gt; =E&lt;gt&gt; I&lt;bitmap&gt;
+=item B&lt;-activeforeground&gt; =E&lt;gt&gt; I&lt;color&gt;
 
-=item B&lt;-disabledforeground&gt; =E&lt;gt&gt; I&lt;bitmap&gt;
+=item B&lt;-disabledforeground&gt; =E&lt;gt&gt; I&lt;color&gt;
 
 Specifies the color to use for each of the bitmap&#39;s &#39;1&#39; valued pixels
 in its normal, active and disabled states.
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;07&nbsp;06:33:06&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;07&nbsp;16:14:12&nbsp;2007</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Nov 07 06:32:51 2007, Wolfgang.Laun@thalesgroup.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#40;5&#41; was fixed but all the rest is still in Tk-804.027_501.
&gt; The patch is against this version; I have retested it on Linux.
&gt; Kind regards
&gt; Wolfgang
&gt; 
</div>
Thanks. There are still two issues with this patch:
- -dash &#39;.  &#39; = -dash [2,8] still does not produce the same output
- I was able to get a segfault using -dash =&gt; &#39;.,-_.,-_.,-_.,-_&#39;

Can you look into these two?

Future versions of Tk will have a new Canvas test file t/canvas2.t, see
here: <span class="clickylink"><a target="new" rel="nofollow" href="http://svn.perl.org/modules/Tk/trunk/t/canvas2.t">http://svn.perl.org/modules/Tk/trunk/t/canvas2.t</a></span>
This file should contain all the error and special cases you mentioned
in this bug report.

If you want to peek at current Tk development, you can use the SVN
repository <span class="clickylink"><a target="new" rel="nofollow" href="http://svn.perl.org/modules/Tk/trunk">http://svn.perl.org/modules/Tk/trunk</a></span> . Your patch will be
integrated once the issues are solved.

Regards,
    Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;08&nbsp;18:30:58&nbsp;2007</span>
    <span class="description">SREZIC [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;09&nbsp;08:58:36&nbsp;2007</span>
    <span class="description">Wolfgang.Laun [...] thalesgroup.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #11083] Tk::Canvas: -dash, Bitmap</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 09 Nov 2007 14:58:05 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Tk [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Wolfgang Laun &lt;Wolfgang.Laun [...] thalesgroup.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m working on it. The string dash spec handling is
somewhat, uh, contorted.
Wolfgang

Slaven_Rezic via RT wrote

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;Thanks. There are still two issues with this patch:
&gt;- -dash &#39;.  &#39; = -dash [2,8] still does not produce the same output
&gt;- I was able to get a segfault using -dash =&gt; &#39;.,-_.,-_.,-_.,-_&#39;
&gt;
&gt;Can you look into these two?
&gt;
&gt;Future versions of Tk will have a new Canvas test file t/canvas2.t, see
&gt;here: <span class="clickylink"><a target="new" rel="nofollow" href="http://svn.perl.org/modules/Tk/trunk/t/canvas2.t">http://svn.perl.org/modules/Tk/trunk/t/canvas2.t</a></span>
&gt;This file should contain all the error and special cases you mentioned
&gt;in this bug report.
&gt;
&gt;If you want to peek at current Tk development, you can use the SVN
&gt;repository <span class="clickylink"><a target="new" rel="nofollow" href="http://svn.perl.org/modules/Tk/trunk">http://svn.perl.org/modules/Tk/trunk</a></span> . Your patch will be
&gt;integrated once the issues are solved.
&gt;
&gt;Regards,
&gt;    Slaven
&gt;
&gt;  
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;09&nbsp;08:58:39&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;14&nbsp;12:59:40&nbsp;2007</span>
    <span class="description">wolfgang.laun [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #11083] Tk::Canvas: -dash, Bitmap</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 14 Nov 2007 18:58:40 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Tk [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Wolfgang Laun&#34; &lt;wolfgang.laun [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have run the changed code against canvas2.t and it looks good to me.
The patch is against the original code. The code is somewhat more lucid
now, but it is still tricky especially in combination with the dash
definition using .,-_

Kind regards
Wolfgang


--- pTk/mTk/generic/tkCanvUtil.c.old    2007-02-10 12:29:06.000000000 +0100
+++ pTk/mTk/generic/tkCanvUtil.c    2007-11-10 19:04:26.000000000 +0100
@@ -798,21 +798,16 @@
     if &#40;&#40;*value == &#39;.&#39;&#41; || &#40;*value == &#39;,&#39;&#41; ||
         &#40;*value == &#39;-&#39;&#41; || &#40;*value == &#39;_&#39;&#41;&#41; {
     i = DashConvert&#40;&#40;char *&#41; NULL, value, -1, 0.0&#41;;
-    if &#40;i&gt;0&#41; {
-        i = strlen&#40;value&#41;;
-    } else {
+    if &#40;i&lt;0&#41; {
         goto badDashList;
     }
-    if &#40;i &gt; &#40;int&#41; sizeof&#40;char *&#41;&#41; {
-        dash-&gt;pattern.pt = pt = &#40;char *&#41; ckalloc&#40;strlen&#40;value&#41;&#41;;
-    } else {
-        pt = dash-&gt;pattern.array;
-    }
-    memcpy&#40;pt,value, &#40;unsigned int&#41; i&#41;;
+        dash-&gt;pattern.pt = pt = &#40;char *&#41; ckalloc&#40;strlen&#40;value&#41;+1&#41;;
+    strcpy&#40; pt, value &#41;;
     dash-&gt;number = -i;
     return TCL_OK;
     }
-    if &#40;Tcl_ListObjGetElements&#40;interp, ovalue, &#38;argc, &#38;objv&#41; != TCL_OK&#41; {
+    if &#40;Tcl_ListObjGetElements&#40;interp, ovalue, &#38;argc, &#38;objv&#41; != TCL_OK ||
+        argc &lt;= 1&#41; {
     Tcl_ResetResult&#40;interp&#41;;
     badDashList:
     Tcl_AppendResult&#40;interp, &#34;bad dash list \&#34;&#34;, value,
@@ -841,7 +836,7 @@
         i &lt; 1 || i&gt;255&#41; {
         Tcl_ResetResult&#40;interp&#41;;
         Tcl_AppendResult&#40;interp, &#34;expected integer in the range 1..255 but
got \&#34;&#34;,
-             *largv, &#34;\&#34;&#34;, &#40;char *&#41; NULL&#41;;
+             Tcl_GetString&#40;*largv&#41;, &#34;\&#34;&#34;, &#40;char *&#41; NULL&#41;;
         goto syntaxError;
     }
     *pt++ = i;
@@ -1054,8 +1049,6 @@
     gcValues-&gt;dash_offset = outline-&gt;offset;
     if &#40;dash-&gt;number &gt;= 2&#41; {
         gcValues-&gt;dashes = 4;
-    } else if &#40;dash-&gt;number &gt; 0&#41; {
-        gcValues-&gt;dashes = dash-&gt;pattern.array[0];
     } else {
         gcValues-&gt;dashes = &#40;char&#41; &#40;4 * width&#41;;
     }
@@ -1141,18 +1134,17 @@
     return 0;
     }

-    if &#40;&#40;dash-&gt;number&lt;-1&#41; || &#40;&#40;dash-&gt;number == -1&#41; &#38;&#38;
&#40;dash-&gt;pattern.array[1]!=&#39;,&#39;&#41;&#41;&#41;
{
+    if &#40;dash-&gt;number&lt;=-2&#41; {
     char *q;
     int i = -dash-&gt;number;

-    p = &#40;i &gt; &#40;int&#41; sizeof&#40;char *&#41;&#41; ? dash-&gt;pattern.pt : dash-&gt;pattern.array
;
+    p = dash-&gt;pattern.pt;
     q = &#40;char *&#41; ckalloc&#40;2*&#40;unsigned int&#41;i&#41;;
     i = DashConvert&#40;q, p, i, width&#41;;
     XSetDashes&#40;&#40;&#40;TkCanvas *&#41;canvas&#41;-&gt;display, outline-&gt;gc, outline-&gt;offset,
q, i&#41;;
     values.line_style = LineOnOffDash;
     ckfree&#40;q&#41;;
-    } else if &#40; dash-&gt;number&gt;2 || &#40;dash-&gt;number==2 &#38;&#38;
-        &#40;dash-&gt;pattern.array[0]!=dash-&gt;pattern.array[1]&#41;&#41;&#41; {
+    } else if &#40; dash-&gt;number&gt;=2 &#41; {
     p = &#40;char *&#41; &#40;dash-&gt;number &gt; &#40;int&#41; sizeof&#40;char *&#41;&#41; ? dash-&gt;pattern.pt :
dash-&gt;pattern.array;
     XSetDashes&#40;&#40;&#40;TkCanvas *&#41;canvas&#41;-&gt;display, outline-&gt;gc, outline-&gt;offset,
p, dash-&gt;number&#41;;
     values.line_style = LineOnOffDash;
@@ -1262,13 +1254,9 @@
     return 0;
     }

-    if &#40;&#40;dash-&gt;number &gt; 2&#41; || &#40;dash-&gt;number &lt; -1&#41; || &#40;dash-&gt;number==2 &#38;&#38;
-        &#40;dash-&gt;pattern.array[0] != dash-&gt;pattern.array[1]&#41;&#41; ||
-        &#40;&#40;dash-&gt;number == -1&#41; &#38;&#38; &#40;dash-&gt;pattern.array[1] != &#39;,&#39;&#41;&#41;&#41; {
+    if &#40; &#40;dash-&gt;number &gt;= 2&#41; || &#40;dash-&gt;number &lt;= -2&#41; &#41; {
     if &#40;dash-&gt;number &lt; 0&#41; {
         dashList = &#40;int&#41; &#40;4 * width + 0.5&#41;;
-    } else if &#40;dash-&gt;number&lt;3&#41; {
-        dashList = dash-&gt;pattern.array[0];
     } else {
         dashList = 4;
     }
@@ -1365,8 +1353,8 @@
     str = &#40;char *&#41;ckalloc&#40;&#40;unsigned int&#41; &#40;1 - 8*dash-&gt;number&#41;&#41;;
     lptr = &#40;char *&#41;ckalloc&#40;&#40;unsigned int&#41; &#40;1 - 2*dash-&gt;number&#41;&#41;;
     }
-    ptr = &#40;char *&#41; &#40;&#40;ABS&#40;dash-&gt;number&#41; &gt; sizeof&#40;char *&#41;&#41; &#41; ?
-    dash-&gt;pattern.pt : dash-&gt;pattern.array;
+    ptr = &#40;char *&#41; &#40; dash-&gt;number &gt; sizeof&#40;char *&#41;&#41; ? dash-&gt;pattern.pt :
+                   &#40; dash-&gt;number &lt; 0 &#41; ? dash-&gt;pattern.pt : dash-&gt;
pattern.array;
     if &#40;dash-&gt;number &gt; 0&#41; {
     char *ptr0 = ptr;
     sprintf&#40;str, &#34;[%d&#34;, *ptr++ &#38; 0xff&#41;;
@@ -1427,7 +1415,7 @@
  *
  *      Converts a character-like dash-list &#40;e.g. &#34;-..&#34;&#41;
  *      into an X11-style. l must point to a string that
- *      holds room to at least 2*n characters. if
+ *      holds room to at least 2*n characters. If
  *      l == NULL, this function can be used for
  *      syntax checking only.
  *
@@ -1463,7 +1451,7 @@
         case &#39; &#39;:
         if &#40;result&#41; {
             if &#40;l&#41; {
-            l[-1] += intWidth + 1;
+            l[-1] += 2 * intWidth;
             }
             continue;
         } else {
@@ -1471,23 +1459,23 @@
         }
         break;
         case &#39;_&#39;:
-        size = 8;
+        size = 4;
         break;
         case &#39;-&#39;:
-        size = 6;
+        size = 3;
         break;
         case &#39;,&#39;:
-        size = 4;
+        size = 2;
         break;
         case &#39;.&#39;:
-        size = 2;
+        size = 1;
         break;
         default:
         return -1;
     }
     if &#40;l&#41; {
         *l++ = size * intWidth;
-        *l++ = 4 * intWidth;
+        *l++ = 2 * intWidth;
     }
     result += 2;
     }
--- pTk/mTk/generic/tkRectOval.c.old    2007-02-10 12:29:06.000000000 +0100
+++ pTk/mTk/generic/tkRectOval.c    2007-11-07 10:11:20.000000000 +0100
@@ -476,8 +476,6 @@
     if &#40;mask &#38;&#38; \
         rectOvalPtr-&gt;outline.width != 0 &#38;&#38; \
         rectOvalPtr-&gt;outline.color != NULL&#41; {
-    gcValues.cap_style = CapProjecting;
-    mask |= GCCapStyle;
     newGC = Tk_GetGC&#40;tkwin, mask, &#38;gcValues&#41;;
     } else {
     newGC = None;
--- pTk/mTk/generic/tkCanvBmap.c.old    2007-02-10 12:29:06.000000000 +0100
+++ pTk/mTk/generic/tkCanvBmap.c    2007-11-07 12:12:47.000000000 +0100
@@ -331,6 +331,8 @@
     XColor *bgColor;
     Pixmap bitmap;
     Tk_State state;
+    int width, height;
+    int width1, height1;

     tkwin = Tk_CanvasTkwin&#40;canvas&#41;;
     if &#40;TCL_OK != Tk_ConfigureWidget&#40;interp, tkwin, configSpecs, objc,
@@ -353,6 +355,31 @@
     itemPtr-&gt;redraw_flags &#38;= ~TK_ITEM_STATE_DEPENDANT;
     }

+    /* Check that bitmaps have same width and height. This avoids problems
+       due to wrong position relative to the anchor point, displaying only
+       part of one of the bitmaps, etc.
+     */
+    Tk_SizeOfBitmap&#40;Tk_Display&#40;Tk_CanvasTkwin&#40;canvas&#41;&#41;, bmapPtr-&gt;bitmap,
+        &#38;width, &#38;height&#41;;
+    if &#40;bmapPtr-&gt;activeBitmap!=None&#41; {
+        Tk_SizeOfBitmap&#40;Tk_Display&#40;Tk_CanvasTkwin&#40;canvas&#41;&#41;,
+                        bmapPtr-&gt;activeBitmap,
+                    &#38;width1, &#38;height1&#41;;
+        if &#40;width != width1 || height != height1&#41; {
+        Tcl_SetResult&#40;interp, &#34;active bitmap dimensions differ&#34;,
TCL_STATIC&#41;;
+            return TCL_ERROR;
+        }
+    }
+    if &#40;bmapPtr-&gt;disabledBitmap!=None&#41; {
+        Tk_SizeOfBitmap&#40;Tk_Display&#40;Tk_CanvasTkwin&#40;canvas&#41;&#41;,
+                        bmapPtr-&gt;disabledBitmap,
+                    &#38;width1, &#38;height1&#41;;
+        if &#40;width != width1 || height != height1&#41; {
+        Tcl_SetResult&#40;interp, &#34;disabled bitmap dimensions differ&#34;,
TCL_STATIC&#41;;
+            return TCL_ERROR;
+        }
+    }
+
     if &#40;state==TK_STATE_HIDDEN&#41; {
     ComputeBitmapBbox&#40;canvas, bmapPtr&#41;;
     return TCL_OK;
@@ -382,7 +409,7 @@
     }
     }

-    if &#40;state==TK_STATE_DISABLED || bitmap == None&#41; {
+    if &#40;bitmap == None&#41; {
     ComputeBitmapBbox&#40;canvas, bmapPtr&#41;;
     return TCL_OK;
     }
--- pod/Canvas.pod.old    2007-02-10 12:28:59.000000000 +0100
+++ pod/Canvas.pod    2007-11-09 09:16:32.000000000 +0100
@@ -346,29 +346,32 @@
 The first possible syntax is a list of integers. Each element
 represents the number of pixels of a line segment. Only the odd
 segments are drawn using the &#34;outline&#34; color. The other segments
-are drawn transparant.
+are drawn transparent.

 The second possible syntax is a character list containing only
-5 possible characters B&lt;[.,-_ ]&gt;. The space can be used
-to enlarge the space between other line elements, and can not
-occur as the first position in the string. Some examples:
+5 possible characters B&lt;[.,-_ ]&gt;,  with the first 4 characters
+producing a segment of length 1 to 4, respectively, followed
+by a transparent segment of length 2. The space can be used
+repeatedly to enlarge the space between other line elements
+by 1, and can not occur as the first position in the string.
+The main difference of this syntax with the previous one is
+that it it shape-conserving. This means that all values in the dash
+list will be multiplied by the line width before display. This
+assures that &#34;.&#34; will always be displayed as a dot and &#34;-&#34;
+always as a dash regardless of the line width.
+
+Some examples, for a line width of 2:

  -dash .     = -dash [2,4]
  -dash -     = -dash [6,4]
  -dash -.    = -dash [6,4,2,4]
  -dash -..   = -dash [6,4,2,4,2,4]
- -dash &#39;. &#39;  = -dash [2,8]
+ -dash &#39;.  &#39; = -dash [2,8]
  -dash &#39;,&#39;   = -dash [4,4]

-The main difference of this syntax with the previous is that it
-it shape-conserving. This means that all values in the dash
-list will be multiplied by the line width before display. This
-assures that &#34;.&#34; will always be displayed as a dot and &#34;-&#34;
-always as a dash regardless of the line width.
-
-On systems where only a limited set of dash patterns, the dash
-pattern will be displayed as the most close dash pattern that
-is available. For example, on Windows only the first 4 of the
+On systems where only a limited set of dash patterns is available,
+the dash pattern will be displayed as the closest available dash
+pattern. For example, on Windows only the first 4 of the
 above examples are available. The last 2 examples will be
 displayed identically as the first one.

@@ -1355,14 +1358,14 @@
 =item B&lt;-disabledbitmap&gt; =E&lt;gt&gt; I&lt;bitmap&gt;

 Specifies the bitmaps to display in the item in its normal, active and
-disabled states.
+disabled states. All bitmaps must have the same width and height.
 I&lt;Bitmap&gt; may have any of the forms accepted by B&lt;Tk_GetBitmap&gt;.

 =item B&lt;-foreground&gt; =E&lt;gt&gt; I&lt;color&gt;

-=item B&lt;-activeforeground&gt; =E&lt;gt&gt; I&lt;bitmap&gt;
+=item B&lt;-activeforeground&gt; =E&lt;gt&gt; I&lt;color&gt;

-=item B&lt;-disabledforeground&gt; =E&lt;gt&gt; I&lt;bitmap&gt;
+=item B&lt;-disabledforeground&gt; =E&lt;gt&gt; I&lt;color&gt;

 Specifies the color to use for each of the bitmap&#39;s &#39;1&#39; valued pixels
 in its normal, active and disabled states.
</div></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;15&nbsp;16:59:21&nbsp;2007</span>
    <span class="description">slaven [...] rezic.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #11083] Tk::Canvas: -dash, Bitmap</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> 15 Nov 2007 22:56:46 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Tk [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Slaven Rezic &lt;slaven [...] rezic.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Wolfgang Laun via RT&#34; &lt;bug-Tk@rt.cpan.org&gt; writes:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Tk
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=11083">http://rt.cpan.org/Ticket/Display.html?id=11083</a></span> &gt;
&gt; 
&gt; I have run the changed code against canvas2.t and it looks good to me.
&gt; The patch is against the original code. The code is somewhat more lucid
&gt; now, but it is still tricky especially in combination with the dash
&gt; definition using .,-_
&gt; 
</div>
Can you attach the patch? There seem to be problems with additional
line breaks and probably whitespace...

Regards,
    Slaven

-- 
Slaven Rezic - slaven &lt;at&gt; rezic &lt;dot&gt; de
  BBBike - route planner for cyclists in Berlin
  WWW version:                           <span class="clickylink"><a target="new" rel="nofollow" href="http://www.bbbike.de">http://www.bbbike.de</a></span>
  Perl/Tk version for Unix and Windows:  <span class="clickylink"><a target="new" rel="nofollow" href="http://bbbike.sourceforge.net">http://bbbike.sourceforge.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;17&nbsp;10:56:10&nbsp;2007</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks, I applied the patch you sent by email to the subversion
repository &#40;change 10267&#41;.

Regards,
    Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;17&nbsp;10:56:13&nbsp;2007</span>
    <span class="description">SREZIC [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
