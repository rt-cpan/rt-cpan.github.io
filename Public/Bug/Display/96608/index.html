<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #96608 for Net-DNS: &#34;Insecure dependency in connect&#34; with Net::DNS::Resolver over TCP</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #96608 for Net-DNS: &#34;Insecure dependency in connect&#34; with Net::DNS::Resolver over TCP</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Net-DNS">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Net-DNS">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Net-DNS">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Net-DNS">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-DNS">Net-DNS CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">96608</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Net-DNS">Net-DNS</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
Mark.Martinec [...] ijs.si

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-22454-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.77    </td>
  </tr>
  <tr id="CF-22455-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=96608">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1377716" href="/Public/Bug/Display.html?id=96608#txn-1377716">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;20&nbsp;20:09:00&nbsp;2014</span>
    <span class="description">Mark.Martinec [...] ijs.si -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> &#34;Insecure dependency in connect&#34; with Net::DNS::Resolver over TCP</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1377716/731485/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/731485">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 334b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">$ perl -T -MNet::DNS::Resolver -le &#39;
  $r=Net::DNS::Resolver-&gt;new&#40;usevc=&gt;1&#41;; $r-&gt;send&#40;&#34;_spf.google.com&#34;,&#34;TXT&#34;&#41;&#39;

Insecure dependency in connect while running with -T switch
  at /usr/local/lib/perl5/5.20/mach/IO/Socket.pm line 115.

&#40;same happens without usevc=&gt;1 on an automatic UDP-&gt;TCP fallback
when a returned record is truncated&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1377767" href="/Public/Bug/Display.html?id=96608#txn-1377767">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;21&nbsp;08:45:08&nbsp;2014</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1377767/731521/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/731521">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 545b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jun 20 20:09:00 2014, Mark.Martinec@ijs.si wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; $ perl -T -MNet::DNS::Resolver -le &#39;
&gt;   $r=Net::DNS::Resolver-&gt;new&#40;usevc=&gt;1&#41;; $r-&gt;send&#40;&#34;_spf.google.com&#34;,&#34;TXT&#34;&#41;&#39;
&gt; 
&gt; Insecure dependency in connect while running with -T switch
&gt;   at /usr/local/lib/perl5/5.20/mach/IO/Socket.pm line 115.
&gt; 
&gt; &#40;same happens without usevc=&gt;1 on an automatic UDP-&gt;TCP fallback
&gt; when a returned record is truncated&#41;
</div>
That does not happen for me.

Where are the nameserver addresses coming from?

RES_NAMESERVERS  ?
/etc/resolv.conf ?
./.resolv.conf   ?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1377768" href="/Public/Bug/Display.html?id=96608#txn-1377768">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;21&nbsp;08:45:10&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1377790" href="/Public/Bug/Display.html?id=96608#txn-1377790">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;21&nbsp;10:37:01&nbsp;2014</span>
    <span class="description">Mark.Martinec [...] ijs.si -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #96608] &#34;Insecure dependency in connect&#34; with Net::DNS::Resolver over TCP</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 21 Jun 2014 16:36:46 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-DNS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Martinec &lt;Mark.Martinec [...] ijs.si&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1377790/731535/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/731535">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 542b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; That does not happen for me.
</div>
It was reported on the amavis mailing list &#40;not sure what version
they were running&#41;, and I can reproduce it on several of my machines
&#40;perl 5.20&#41;, but not on all. Net::DNS 0.76 or 0.77

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Where are the nameserver addresses coming from?
&gt; 
&gt; RES_NAMESERVERS  ?
</div>
No.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; /etc/resolv.conf ?
</div>
Yes:

$ cat /etc/resolv.conf
search ijs.si.
nameserver 2001:1470:ff80::53:247
nameserver 2001:1470:ff80::53:248

or &#40;on another&#41;:

$ cat /etc/resolv.conf
search ijs.si
nameserver ::1


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ./.resolv.conf   ?
</div>
No.


   Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1377824" href="/Public/Bug/Display.html?id=96608#txn-1377824">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;21&nbsp;14:18:04&nbsp;2014</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1377824/731551/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/731551">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Jun 21 10:37:01 2014, Mark.Martinec@ijs.si wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; That does not happen for me.
</div>&gt; 
&gt; It was reported on the amavis mailing list &#40;not sure what version
&gt; they were running&#41;, and I can reproduce it on several of my machines
&gt; &#40;perl 5.20&#41;, but not on all. Net::DNS 0.76 or 0.77
&gt; 
<div class="message-stanza open">&gt; &gt; Where are the nameserver addresses coming from?
&gt; &gt; 
&gt; &gt; /etc/resolv.conf ?
</div>&gt; 
&gt; Yes:
&gt; 
&gt; $ cat /etc/resolv.conf
&gt; search ijs.si.
&gt; nameserver 2001:1470:ff80::53:247
&gt; nameserver 2001:1470:ff80::53:248
&gt;
</div>So, data read from the external /etc/resolv.conf is tainted. The taint propagates all the way through to the socket code.

Question: Should /etc/resolv.conf receive some special priviledge as trustworthy material and therefore untainted? 

If yes, then user-specified config files should receive the same treatment. This is to make certain that:

 $res = new Net::DNS::Resolver&#40;&#41;;

and

 $res = new Net::DNS::Resolver&#40; config_file =&gt; &#39;/etc/resolv.conf&#39; &#41;;

both produce exactly the same result.


If no, untainting should be applied to user-specified config files only. Users would then be required either to provide their own config file or refer explicitly to /etc/resolv.conf as above.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1378347" href="/Public/Bug/Display.html?id=96608#txn-1378347">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;23&nbsp;08:00:41&nbsp;2014</span>
    <span class="description">Mark.Martinec [...] ijs.si -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #96608] &#34;Insecure dependency in connect&#34; with Net::DNS::Resolver over TCP</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 23 Jun 2014 14:00:15 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-DNS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Martinec &lt;Mark.Martinec [...] ijs.si&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1378347/731802/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/731802">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 839b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So, data read from the external /etc/resolv.conf is tainted.
&gt; The taint propagates all the way through to the socket code.
</div>
Yes. With version 0.74 and earlier data fields from resolv.conf
were blindly laundered in read_config_file&#40;&#41; &#40;as long as the field
is non-empty&#41;.

This brings up an interesting question: why does an *UDP* query
*not* fail for the same reason? Unintentional laundering somewhere else?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Question: Should /etc/resolv.conf receive some special privilege as
&gt; trustworthy material and therefore untainted?
</div>
Yes.  Same for $HOME/.resolv.conf

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If yes, then user-specified config files should receive the same
&gt; treatment.
</div>
Yes for explicitly specified config files.

&#40;I still claim that reading .resolv from a cwd can be a security
hole &#40;checking ownership does not help&#41;, but that is a subject of
some other PR&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1378913" href="/Public/Bug/Display.html?id=96608#txn-1378913">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;24&nbsp;09:33:28&nbsp;2014</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1378913/732137/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/732137">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jun 23 08:00:41 2014, Mark.Martinec@ijs.si wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; So, data read from the external /etc/resolv.conf is tainted.
&gt; &gt; The taint propagates all the way through to the socket code.
</div>&gt; 
&gt; Yes. With version 0.74 and earlier data fields from resolv.conf
&gt; were blindly laundered in read_config_file&#40;&#41; &#40;as long as the field
&gt; is non-empty&#41;.
&gt;
</div>Which was clearly not right.

 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This brings up an interesting question: why does an *UDP* query
&gt; *not* fail for the same reason? Unintentional laundering somewhere else?
&gt;
</div>Don&#39;t know the answer to that one. Perhaps we need to find out.
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Question: Should /etc/resolv.conf receive some special privilege as
&gt; &gt; trustworthy material and therefore untainted?
</div>&gt; 
&gt; Yes.
</div>I happen to disagree, but accept that it is debatable.
Interestingly, old versions have been very inconsistent about whether they accept /etc/resolv.conf with -T flag, so we cannot appeal to historical precedent. 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ... Same for $HOME/.resolv.conf
&gt; 
</div>No. Just as bad as ./.resolv.conf


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; If yes, then user-specified config files should receive the same
&gt; &gt; treatment.
</div>&gt; 
&gt; Yes for explicitly specified config files.
&gt;
</div> 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#40;I still claim that reading .resolv from a cwd can be a security
&gt; hole &#40;checking ownership does not help&#41;, but that is a subject of
&gt; some other PR&#41;.
&gt;
</div>./.resolv.conf and $HOME/.resolv.conf should be regarded as tainted. These will not be read if user provides a config file.


IMHO, security sensitive users should turn on -T and supply an explicit config file &#40;which might be /etc/resolv.conf&#41;. The onus is then on the user to make sure that a malicious actor cannot modify the specified file.  With this model, we would always ignore all the other places that bad stuff can come from.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1379812" href="/Public/Bug/Display.html?id=96608#txn-1379812">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;26&nbsp;09:46:33&nbsp;2014</span>
    <span class="description">Mark.Martinec [...] ijs.si -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #96608] &#34;Insecure dependency in connect&#34; with Net::DNS::Resolver over TCP</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 26 Jun 2014 15:46:07 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-DNS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Martinec &lt;Mark.Martinec [...] ijs.si&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1379812/732629/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/732629">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The current &#39;solution&#39; in trunk is not right &#40;r1222, 0.77+&#41;,
it does not solve the problem.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; This brings up an interesting question: why does an *UDP* query
&gt;&gt; *not* fail for the same reason? Unintentional laundering somewhere 
&gt;&gt; else?
</div>&gt; Don&#39;t know the answer to that one. Perhaps we need to find out.
</div>
It turns out that the perl builtin function send&#40;&#41; does not check
for taintedness of its fourth argument &#40;TO&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt;&gt; &gt; Question: Should /etc/resolv.conf receive some special privilege as
&gt;&gt; &gt; trustworthy material and therefore untainted?
</div>&gt;&gt; Yes.
</div>&gt; I happen to disagree, but accept that it is debatable.
</div>
It is not possible for an application to guard itself against the
operating system. If one cannot trust the underlying operating system
and its basic settings, then any attempts to do so are futile and
can be circumvented.

The purpose of taint checks is to protect against untrusted data from
the wild, not from the operating system and its basic settings.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If no, untainting should be applied to user-specified config files 
&gt; only.
&gt; Users would then be required either to provide their own config file or 
&gt; refer
&gt; explicitly to /etc/resolv.conf as above.
</div>
An application should not need to know where the system&#39;s recursive 
resolvers
configuration is located. The exact location is OS-specific and that 
logic is
already built into Net::DNS. An application should not need to replicate 
that code.
Requiring to explicitly specify a config file in 
Net::DNS::Resolver-&gt;new&#40;&#41;
is unacceptable. The system-default should suffice for most needs.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; IMHO, security sensitive users should turn on -T and supply an
&gt; explicit config file &#40;which might be /etc/resolv.conf&#41;.
</div>
Even the less security sensitive should turn on the -T option,
but should still work with a default setup.

It is not possible to selectively turn off taint checking within a perl 
block
or module. If an application happens to use Net::DNS &#40;e.g. in one of its
library modules, using a default configuration&#41;, it is not acceptable
that taint checks need to be globally disabled just because Net::DNS
version 0.75 or 0.76 or 0.77 happens to be installed on the system.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Interestingly, old versions have been very inconsistent about whether 
&gt; they
&gt; accept /etc/resolv.conf with -T flag, so we cannot appeal to historical 
&gt; precedent.
</div>
0.49 OK
0.53 OK
0.59 OK
0.61 OK
0.62 OK
0.63 OK
0.64 OK
0.65 OK
0.66 OK
0.67 OK
0.68 OK
0.69 OK
0.70 OK
0.71 OK
0.72 OK
0.73 OK
0.74 OK
0.75 Insecure dependency in connect
0.76 Insecure dependency in connect
0.77 Insecure dependency in connect

I wouldn&#39;t call it inconsistent. To me it looks like a breakage in 0.75.



It is not acceptable that an application would fail depending on a size
of a DNS response &#40;TC flag&#41;:

$ perl -T -MNet::DNS::Resolver -le &#39;$r=Net::DNS::Resolver-&gt;new;
   $r-&gt;send&#40;&#34;spop1024._domainkey.ealert.nature.com&#34;,&#34;TXT&#34;&#41; or print &#34;OK&#34;&#39;
OK

$ perl -T -MNet::DNS::Resolver -le &#39;$r=Net::DNS::Resolver-&gt;new;
   $r-&gt;send&#40;&#34;20120113._domainkey.gmail.com&#34;,&#34;TXT&#34;&#41; or print &#34;OK&#34;&#39;
Insecure dependency in connect while running with -T switch
   at /usr/local/lib/perl5/5.20/mach/IO/Socket.pm line 115.

The UDP and TCP queries should be subject to the same criteria.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1380412" href="/Public/Bug/Display.html?id=96608#txn-1380412">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;27&nbsp;18:22:13&nbsp;2014</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1380412/732938/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/732938">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  I wouldn&#39;t call it inconsistent. To me it looks like a breakage in 0.75.
</div>
I do not see things that way at all.

Neither am I convinced by your experimental evidence.

Taint propagation appears to have been broken in 0.68 and fixed again in 0.75. So now it *is* fixed, it is going to stay fixed.


$ perl -T -I/home/rwf/src/Net-DNS-0.20/lib/. test.pl 
taint not detected

$ perl -T -I/home/rwf/src/Net-DNS-0.25/lib/. test.pl 
taint not detected

$ perl -T -I/home/rwf/src/Net-DNS-0.30/lib/. test.pl 
Insecure dependency in connect while running with -T switch at /usr/lib/perl5/IO/Socket.pm line 115.

$ perl -T -I/home/rwf/src/Net-DNS-0.40/lib/. test.pl 
Insecure dependency in connect while running with -T switch at /usr/lib/perl5/IO/Socket.pm line 115.

$ perl -T -I/home/rwf/src/Net-DNS-0.50/lib/. test.pl 
Insecure dependency in connect while running with -T switch at /usr/lib/perl5/IO/Socket.pm line 115.

$ perl -T -I/home/rwf/src/Net-DNS-0.60/lib/. test.pl 
Insecure dependency in connect while running with -T switch at /usr/lib/perl5/IO/Socket.pm line 115.

$ perl -T -I/home/rwf/src/Net-DNS-0.65/lib/. test.pl 
Insecure dependency in connect while running with -T switch at /usr/lib/perl5/IO/Socket.pm line 115.

$ perl -T -I/home/rwf/src/Net-DNS-0.66/lib/. test.pl 
Insecure dependency in connect while running with -T switch at /usr/lib/perl5/IO/Socket.pm line 115.

$ perl -T -I/home/rwf/src/Net-DNS-0.67/lib/. test.pl 
Insecure dependency in connect while running with -T switch at /usr/lib/perl5/IO/Socket.pm line 115.

$ perl -T -I/home/rwf/src/Net-DNS-0.68/lib/. test.pl 
taint not detected

$ perl -T -I/home/rwf/src/Net-DNS-0.69/lib/. test.pl 
taint not detected

$ perl -T -I/home/rwf/src/Net-DNS-0.70/lib/. test.pl 
taint not detected

$ perl -T -I/home/rwf/src/Net-DNS-0.71/lib/. test.pl 
taint not detected

$ perl -T -I/home/rwf/src/Net-DNS-0.72/lib/. test.pl 
taint not detected

$ perl -T -I/home/rwf/src/Net-DNS-0.73/lib/. test.pl 
taint not detected

$ perl -T -I/home/rwf/src/Net-DNS-0.74/lib/. test.pl 
taint not detected

$ perl -T -I/home/rwf/src/Net-DNS-0.75/lib/. test.pl 
Insecure dependency in connect while running with -T switch at /usr/lib/perl5/IO/Socket.pm line 115.

$ perl -T -I/home/rwf/src/Net-DNS-0.76/lib/. test.pl 
Insecure dependency in connect while running with -T switch at 
/usr/lib/perl5/IO/Socket.pm line 115.

$ perl -T -I/home/rwf/src/Net-DNS-0.77/lib/. test.pl 
Insecure dependency in connect while running with -T switch at /usr/lib/perl5/IO/Socket.pm line 115.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1380442" href="/Public/Bug/Display.html?id=96608#txn-1380442">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;27&nbsp;20:56:12&nbsp;2014</span>
    <span class="description">Mark.Martinec [...] ijs.si -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #96608] &#34;Insecure dependency in connect&#34; with Net::DNS::Resolver over TCP</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 28 Jun 2014 02:55:55 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-DNS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Martinec &lt;Mark.Martinec [...] ijs.si&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1380442/732954/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/732954">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 592b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Neither am I convinced by your experimental evidence.
&gt; 
&gt; Taint propagation appears to have been broken in 0.68 and fixed again
&gt; in 0.75. So now it *is* fixed, it is going to stay fixed.
</div>
This was my test &#40;using perl 5.20.0&#41; which produced my results
across all the versions of Net::DNS that I could find since 0.49:

for j in Net-DNS-0.??; do &#40;cd $j; echo; echo $j; perl Makefile.PL; make 
install;
   perl -T -MNet::DNS::Resolver -le &#39;print Net::DNS-&gt;VERSION;
   $r=Net::DNS::Resolver-&gt;new&#40;usevc=&gt;1&#41;; 
$r-&gt;send&#40;&#34;_spf.google.com&#34;,&#34;TXT&#34;&#41;;
   print &#34;\nOK\n\n&#34;&#39;; sleep 5; make clean&#41;; done
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1380550" href="/Public/Bug/Display.html?id=96608#txn-1380550">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;28&nbsp;08:18:38&nbsp;2014</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1380550/733009/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/733009">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 514b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">One of us has a problem with the experiment, but it is not obvious what it is.

However, perhaps we do not need to solve that problem in order to reach a conclusion.

If your result is right, untainting /etc/resolv.conf is the right way to go.

If my result is right, the decision is, at best, split 50-50.

Way forward:

  /etc/resolv.conf    untainted
  $HOME/.resolv.conf  tainted
  ./.resolv.conf      tainted

  Environment variables always tainted

  Security sensitive users provide their own config file.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1380694" href="/Public/Bug/Display.html?id=96608#txn-1380694">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;28&nbsp;20:28:37&nbsp;2014</span>
    <span class="description">Mark.Martinec [...] ijs.si -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #96608] &#34;Insecure dependency in connect&#34; with Net::DNS::Resolver over TCP</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 29 Jun 2014 02:28:20 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-DNS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Martinec &lt;Mark.Martinec [...] ijs.si&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1380694/733073/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/733073">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; One of us has a problem with the experiment, but it is not obvious what 
&gt; it is.
</div>
I have repeated my experiment &#40;perl 5.20.0, on FreeBSD 10.0&#41;, this time
with some additional checking for receiving a valid DNS answer, and 
avoiding
to manually force a TCP query but relying on a long DNS reply with a TC
flag set and automatic failover by Net::DNS to re-do a query over TCP.
I have also specified a single IPv4 nameserver in my /etc/resolv.conf,
just in case &#40;previously I had two IPv6 entries there&#41;. ...
... essentially all the same as previously, just avoiding some
potential traps.

# for j in Net-DNS-0.??.tar.gz; do
   echo $j; tar xf $j;
   &#40; cd ${j%.tar.gz}; perl Makefile.PL; make; make install;
     perl -T -MNet::DNS -MNet::DNS::Resolver -le &#39;
     $|=1; print &#34;\n\n----- &#34;,Net::DNS-&gt;VERSION;
     
$a=Net::DNS::Resolver-&gt;new-&gt;send&#40;&#34;20120113._domainkey.gmail.com&#34;,&#34;TXT&#34;&#41;
       or die &#34;Err: $!&#34;;
     print &#34;OK: &#34;,$a-&gt;string&#39;; make clean
   &#41;; done 2&gt;&#38;1 | tee 0.log

# egrep &#39;^----- |OK: ;; Answer received|Insecure&#39; 0.log

&#40;just manually inserting a newline before every version for clarity&#41;:

----- 0.49
OK: ;; Answer received from 193.2.4.247 &#40;605 bytes&#41;

----- 0.53

----- 0.59

OK: ;; Answer received from 193.2.4.247 &#40;605 bytes&#41;

----- 0.61
OK: ;; Answer received from 193.2.4.247 &#40;605 bytes&#41;

----- 0.62
OK: ;; Answer received from 193.2.4.247 &#40;605 bytes&#41;

----- 0.63
OK: ;; Answer received from 193.2.4.247 &#40;605 bytes&#41;

----- 0.64
OK: ;; Answer received from 193.2.4.247 &#40;605 bytes&#41;

----- 0.65
OK: ;; Answer received from 193.2.4.247 &#40;605 bytes&#41;

----- 0.66
OK: ;; Answer received from 193.2.4.247 &#40;605 bytes&#41;

----- 0.67
OK: ;; Answer received from 193.2.4.247 &#40;605 bytes&#41;

----- 0.68
OK: ;; Answer received from 193.2.4.247 &#40;605 bytes&#41;

----- 0.69
OK: ;; Answer received from 193.2.4.247 &#40;605 bytes&#41;

----- 0.70
OK: ;; Answer received from 193.2.4.247 &#40;605 bytes&#41;

----- 0.71
OK: ;; Answer received from 193.2.4.247 &#40;605 bytes&#41;

----- 0.72
OK: ;; Answer received from 193.2.4.247 &#40;605 bytes&#41;

----- 0.73
OK: ;; Answer received from 193.2.4.247 &#40;605 bytes&#41;

----- 0.74
OK: ;; Answer received from 193.2.4.247 &#40;605 bytes&#41;

----- 0.75
Insecure dependency in connect while running with -T switch at 
/usr/local/lib/perl5/5.20/mach/IO/Socket.pm line 115.
----- 0.76

Insecure dependency in connect while running with -T switch at 
/usr/local/lib/perl5/5.20/mach/IO/Socket.pm line 115.
----- 0.77

Insecure dependency in connect while running with -T switch at 
/usr/local/lib/perl5/5.20/mach/IO/Socket.pm line 115.


The version 0.53 didn&#39;t provide any answer &#40;and didn&#39;t fail either&#41;, but
I didn&#39;t investigate, as it&#39;s nine years old anyway.

So the result matches my previous experiment, versions 0.49 to 0.74
are happy with a default setup, versions 0.75, 0.76 and 0.77 fail.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; However, perhaps we do not need to solve that problem in order to
&gt; reach a conclusion.
&gt; 
&gt; If your result is right, untainting /etc/resolv.conf is the right way 
&gt; to go.
</div>
I think it is the right thing to do.

Btw, there shouldn&#39;t be any differences between getting the
information from /etc/resolv.conf or from a Windows registry,
both sources hold trusted system&#39;s settings &#40;unless system has been
compromised or seriously misconfigured, in which case anything
can happen anyway&#41;.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Way forward:
&gt;   /etc/resolv.conf    untainted
</div>
Ok.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;   $HOME/.resolv.conf  tainted
&gt;   ./.resolv.conf      tainted
&gt;   Environment variables always tainted
</div>
I don&#39;t care much for these, although I think that if such a setup
is already known to fail eventually when an application happens to
stumble over a DNS reply with a TC flag set, then it would be better
to fail right away with some sensible diagnostic, or just disallow
$HOME/.resolv.conf and /.resolv.conf and document the change.
Leaving an application to its chances of eventually stumbling
over such DNS answer and failing at some &#39;random&#39; time is not
polite.

Still, there shouldn&#39;t be a difference &#40;regarding trustworthiness
of name server sources&#41; between a DNS query over UDP vs. TCP.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;   Security sensitive users provide their own config file.
</div>
Right, or just use a system default.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1385010" href="/Public/Bug/Display.html?id=96608#txn-1385010">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;10&nbsp;12:03:47&nbsp;2014</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1385010/735422/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/735422">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Jun 28 20:28:37 2014, Mark.Martinec@ijs.si wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; One of us has a problem with the experiment, but it is not obvious what 
&gt; &gt; it is.
</div>&gt; 
&gt; I have repeated my experiment &#40;perl 5.20.0, on FreeBSD 10.0&#41;
</div>
Good work, thanks.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Btw, there shouldn&#39;t be any differences between getting the
&gt; information from /etc/resolv.conf or from a Windows registry,
&gt;
</div>Possibly, but off-topic here.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; Way forward:
&gt; &gt;   /etc/resolv.conf    untainted
</div>&gt; 
</div>Fixed in 0.78

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt;   $HOME/.resolv.conf  tainted
&gt; &gt;   ./.resolv.conf      tainted
&gt; &gt;   Environment variables always tainted
</div>&gt; 
&gt; I don&#39;t care much for these,
&gt;
</div>Neither do I, but they have their uses.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; , or just disallow
&gt; $HOME/.resolv.conf and /.resolv.conf and document the change.
&gt;
</div>Not going to happen.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Leaving an application to its chances of eventually stumbling
&gt; over such DNS answer and failing at some &#39;random&#39; time is not
&gt; polite.
&gt; 
&gt; Still, there shouldn&#39;t be a difference &#40;regarding trustworthiness
&gt; of name server sources&#41; between a DNS query over UDP vs. TCP.
&gt;
</div>Different issue; arguably UDP should fail in the same way as TCP. There is no quick fix for this, but it is well worth investigating.

 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt;   Security sensitive users provide their own config file.
</div>&gt; 
&gt; Right, or just use a system default.
&gt; 
</div>Not &#34;just use&#34; but &#34;deliberately use&#34; system default.

$res = new Net::DNS::Resolver&#40; config_file =&gt; &#39;/etc/resolv.conf&#39; &#41;;

Provides untainted config and does not read ${HOME}/.resolv.conf, ./.resolv.conf or environment variables.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1385464" href="/Public/Bug/Display.html?id=96608#txn-1385464">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;11&nbsp;07:10:10&nbsp;2014</span>
    <span class="description">Mark.Martinec [...] ijs.si -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #96608] &#34;Insecure dependency in connect&#34; with Net::DNS::Resolver over TCP</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 11 Jul 2014 13:09:47 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-DNS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Martinec &lt;Mark.Martinec [...] ijs.si&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1385464/735678/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/735678">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; Still, there shouldn&#39;t be a difference &#40;regarding trustworthiness
&gt;&gt; of name server sources&#41; between a DNS query over UDP vs. TCP.
&gt;&gt;
</div>&gt; Different issue; arguably UDP should fail in the same way as TCP.
&gt; There is no quick fix for this, but it is well worth investigating.
</div>
Already investigated, as reported earlier: perl decided that
it does not care if arguments to a send&#40;&#41; builtin are tainted,
in particular its forth argument &#40;TO&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt; Security sensitive users provide their own config file.
</div>&gt;&gt; Right, or just use a system default.
</div>&gt; Not &#34;just use&#34; but &#34;deliberately use&#34; system default.
&gt; $res = new Net::DNS::Resolver&#40; config_file =&gt; &#39;/etc/resolv.conf&#39; &#41;;
</div>
It is wrong that an application would need to know the exact
OS-specific location of its list of default resolvers &#40;Unix vs
Windows vs OpenVMS vs whatever&#41;. That&#39;s what a library &#40;or a perl
module&#41; is there for - and in fact the Net::DNS already does so.
It makes no sense that an application would need to re-do and
duplicate the reconnaissance efforts on its environment.

The need for config_file =&gt; &#39;/etc/resolv.conf&#39; is not portable.
Some other mechanism should be provided to select &#40;only&#41; a system&#39;s
default set of resolvers.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1392199" href="/Public/Bug/Display.html?id=96608#txn-1392199">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;29&nbsp;14:07:56&nbsp;2014</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1392199/739333/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/739333">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jul 11 07:10:10 2014, Mark.Martinec@ijs.si wrote:
[snip]
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Already investigated, as reported earlier: perl decided that
&gt; it does not care if arguments to a send&#40;&#41; builtin are tainted,
&gt; in particular its forth argument &#40;TO&#41;.
</div>
If so, I guess we will have to live with it.


Latest incarnation &#40;in 0.79&#41; now behaves as follows:

   /etc/resolv.conf         untainted
   $HOME/.resolv.conf       tainted
   ~/.resolv.conf           tainted

   Environment variables    tainted

   Windows registry         untainted


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It is wrong that an application would need to know the exact
&gt; OS-specific location of its list of default resolvers &#40;Unix vs
&gt; Windows vs OpenVMS vs whatever&#41;.
</div>
Disagree. Secure systems requirements specify explicitly where all the information comes from, *including* &#34;standard&#34; config files.

Supplying a custom config file fulfils that requirement, and excludes all other sources of config information.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It makes no sense that an application would need to re-do and
&gt; duplicate the reconnaissance efforts on its environment.
&gt; 
</div>but then you cannot meet the above security requirement because some other party specified where the config information comes from.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The need for config_file =&gt; &#39;/etc/resolv.conf&#39; is not portable.
&gt; Some other mechanism should be provided to select &#40;only&#41; a system&#39;s
&gt; default set of resolvers.
&gt;
</div>Not possible without a radical re-write of the resolver.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1392693" href="/Public/Bug/Display.html?id=96608#txn-1392693">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;30&nbsp;14:43:47&nbsp;2014</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1392693/739620/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/739620">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 338b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jun 26 09:46:33 2014, Mark.Martinec@ijs.si wrote:
[snip]

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It turns out that the perl builtin function send&#40;&#41; does not check
&gt; for taintedness of its fourth argument &#40;TO&#41;.
</div>
We would all be happier if it did.

[snip] 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The UDP and TCP queries should be subject to the same criteria.
</div>
Agree.

Plan B added to trunk this very day.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1408445" href="/Public/Bug/Display.html?id=96608#txn-1408445">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;08&nbsp;08:58:13&nbsp;2014</span>
    <span class="description">NLNETLABS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.724682</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
