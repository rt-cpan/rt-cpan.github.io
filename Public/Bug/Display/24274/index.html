<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #24274 for SQL-Translator: patch - parse MySQL/Oracle ALTER TABLE ADD CONSTRAINT/INDEX</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #24274 for SQL-Translator: patch - parse MySQL/Oracle ALTER TABLE ADD CONSTRAINT/INDEX</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/SQL-Translator/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/SQL-Translator/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/SQL-Translator/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/SQL-Translator/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/SQL-Translator">SQL-Translator CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">24274</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/SQL-Translator/Active/">SQL-Translator</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
T.J.Adye [...] rl.ac.uk

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-29610-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.08_04    </td>
  </tr>
  <tr id="CF-29611-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;08&nbsp;13:22:05&nbsp;2007</span>
    <span class="description">T.J.Adye [...] rl.ac.uk -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> patch - parse MySQL/Oracle ALTER TABLE ADD CONSTRAINT/INDEX</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This patch allows the MySQL and Oracle parsers to interpret ALTER TABLE
ADD CONSTRAINT and ALTER TABLE ADD INDEX as can already be specified in
the CREATE TABLE. The MySQL parser already accepted foreign key
constraints in ALTER. This change adds support for other constraints and
index ALTERations, and makes them available also for the Oracle parser.

The patch also adds GRANT to the list of ignored SQL statements for the
MySQL and Oracle parsers.

Also includes a fix to the Oracle parser to allow non-alphanumeric
default values if they are quoted.

&#40;Linux 2.4.21-47.EL, perl 5.0.8, SQL-Translator-0.08_04&#41;
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> SQL-Translator-0.08-1.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -ur SQL-Translator-0.08-orig/lib/SQL/Translator/Parser/MySQL.pm SQL-Translator-0.08/lib/SQL/Translator/Parser/MySQL.pm
--- SQL-Translator-0.08-orig/lib/SQL/Translator/Parser/MySQL.pm	2006-12-07 14:05:17.000000000 +0000
+++ SQL-Translator-0.08/lib/SQL/Translator/Parser/MySQL.pm	2007-01-08 18:15:31.000000000 +0000
@@ -117,14 +117,19 @@
   or      DATA DIRECTORY=&#34;absolute path to directory&#34;
   or      INDEX DIRECTORY=&#34;absolute path to directory&#34;
 
-A subset of the ALTER TABLE syntax that allows addition of foreign keys:
+A subset of the ALTER TABLE syntax that allows addition of foreign keys,
+constraints, and indices:
 
   ALTER [IGNORE] TABLE tbl_name alter_specification [, alter_specification] ...
 
   alter_specification:
-          ADD [CONSTRAINT [symbol]]
-          FOREIGN KEY [index_name] &#40;index_col_name,...&#41;
-             [reference_definition]
+          ADD PRIMARY KEY &#40;index_col_name,...&#41;
+    or    ADD KEY [index_name] &#40;index_col_name,...&#41;
+    or    ADD INDEX [index_name] &#40;index_col_name,...&#41;
+    or    ADD UNIQUE [INDEX] [index_name] &#40;index_col_name,...&#41;
+    or    ADD FULLTEXT [INDEX] [index_name] &#40;index_col_name,...&#41;
+    or    ADD [CONSTRAINT [symbol]] FOREIGN KEY [index_name] &#40;index_col_name,...&#41;
+              [reference_definition]
 
 A subset of INSERT that we ignore:
 
@@ -175,6 +180,7 @@
     | create
     | alter
     | insert
+    | grant
     | delimiter
     | empty_statement
     | &lt;error&gt;
@@ -208,25 +214,38 @@
 
 insert : /insert/i  statement_body &#34;$delimiter&#34;
 
+grant : /grant/i  statement_body &#34;$delimiter&#34;
+
 delimiter : /delimiter/i /[\S]+/
 	{ $delimiter = $item[2] }
 
 empty_statement : &#34;$delimiter&#34;
 
-alter : ALTER TABLE table_name alter_specification&#40;s /,/&#41; &#34;$delimiter&#34;
-    {
+alter : ALTER IGNORE&#40;?&#41; TABLE table_name alter_specification&#40;s /,/&#41; &#34;$delimiter&#34;
+    { 
         my $table_name                       = $item{&#39;table_name&#39;};
-    die &#34;Cannot ALTER table &#39;$table_name&#39;; it does not exist&#34;
-        unless $tables{ $table_name };
-        for my $definition &#40; @{ $item[4] } &#41; { 
-        $definition-&gt;{&#39;extra&#39;}-&gt;{&#39;alter&#39;} = 1;
-        push @{ $tables{ $table_name }{&#39;constraints&#39;} }, $definition;
-    }
+        die &#34;Cannot ALTER table &#39;$table_name&#39;; it does not exist&#34;
+            unless $tables{ $table_name };
+        for my $definition &#40; @{ $item[5] } &#41; {
+            $definition-&gt;{&#39;extra&#39;}-&gt;{&#39;alter&#39;} = 1;
+            if &#40; $definition-&gt;{&#39;supertype&#39;} eq &#39;constraint&#39; &#41; {
+                push @{ $tables{ $table_name }{&#39;constraints&#39;} }, $definition;
+            }
+            elsif &#40; $definition-&gt;{&#39;supertype&#39;} eq &#39;index&#39; &#41; {
+                push @{ $tables{ $table_name }{&#39;indices&#39;} }, $definition;
+            }
+        }
+        1;
     }
 
-alter_specification : ADD foreign_key_def
+alter_specification : ADD alter_definition
     { $return = $item[2] }
 
+alter_definition : constraint 
+    | index
+    | comment
+    | &lt;error&gt;
+
 create : CREATE /database/i WORD &#34;$delimiter&#34;
     { @table_comments = &#40;&#41; }
 
@@ -678,6 +697,8 @@
 
 ALTER : /alter/i
 
+IGNORE : /ignore/i
+
 CREATE : /create/i
 
 TEMPORARY : /temporary/i
diff -ur SQL-Translator-0.08-orig/lib/SQL/Translator/Parser/Oracle.pm SQL-Translator-0.08/lib/SQL/Translator/Parser/Oracle.pm
--- SQL-Translator-0.08-orig/lib/SQL/Translator/Parser/Oracle.pm	2006-12-07 14:05:17.000000000 +0000
+++ SQL-Translator-0.08/lib/SQL/Translator/Parser/Oracle.pm	2007-01-04 22:25:54.000000000 +0000
@@ -72,6 +72,14 @@
 partitioning_options:
    Partition_clause {ENABLE|DISABLE} ROW MOVEMENT
 
+From <span class="clickylink"><a target="new" rel="nofollow" href="http://www.ss64.com/ora/table_a_cons.html">http://www.ss64.com/ora/table_a_cons.html</a></span>:
+
+ ALTER TABLE [schema.]table
+     constraint_clause,...
+
+constraint_clause:
+   ADD table_ref_constraint
+
 Column Constraints
 &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.ss64.com/ora/clause_constraint_col.html&#41;">http://www.ss64.com/ora/clause_constraint_col.html&#41;</a></span>
 
@@ -141,17 +149,33 @@
     | comment_on_table
     | comment_on_column
     | alter
+    | grant
     | drop
     | &lt;error&gt;
 
-alter : /alter/i WORD /[^;]+/ &#39;;&#39;
-    { @table_comments = &#40;&#41; }
+alter : alter_table table_name alter_specification&#40;s /,/&#41; &#39;;&#39;
+    {
+        my $table_name                       = $item{&#39;table_name&#39;};
+        die &#34;Cannot ALTER table &#39;$table_name&#39;; it does not exist&#34;
+            unless $tables{ $table_name };
+        for my $definition &#40; @{ $item[3] } &#41; {
+          $definition-&gt;{&#39;extra&#39;}-&gt;{&#39;alter&#39;} = 1;
+          $definition-&gt;{&#39;type&#39;} = $definition-&gt;{&#39;constraint_type&#39;};
+          push @{ $tables{ $table_name }{&#39;constraints&#39;} }, $definition;
+        }
+    }
+
+alter_specification : /add/i table_constraint
+    { $return = $item[2] }
 
 drop : /drop/i TABLE &#39;;&#39;
 
 drop : /drop/i WORD&#40;s&#41; &#39;;&#39;
     { @table_comments = &#40;&#41; }
 
+grant : /grant/i TERM&#40;s&#41; &#39;;&#39;
+    { @table_comments = &#40;&#41; }
+
 create : create_table table_name &#39;&#40;&#39; create_definition&#40;s /,/&#41; &#39;&#41;&#39; table_option&#40;s?&#41; &#39;;&#39;
     {
         my $table_name                       = $item{&#39;table_name&#39;};
@@ -437,7 +461,7 @@
 field_meta : default_val
     | column_constraint
 
-default_val  : /default/i /&#40;?:&#39;&#41;?[\w\d.-]*&#40;?:&#39;&#41;?/ 
+default_val  : /default/i /&#39;.*?&#39;|[\w\d.-]/
     { 
         my $val =  $item[2];
         $val    =~ s/&#39;//g if defined $val; 
@@ -457,6 +481,7 @@
     }
 
 create_table : /create/i global_temporary&#40;?&#41; /table/i
+alter_table : /alter/i /table/i
 
 table_option : /organization/i WORD
     {
@@ -549,6 +574,8 @@
 
 WORD : /\w+/
 
+TERM : /[^;\s]+/
+
 NAME : /\w+/ { $item[1] }
 
 TABLE : /table/i
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;08&nbsp;14:41:12&nbsp;2007</span>
    <span class="description">T.J.Adye [...] rl.ac.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> T.J.Adye [...] rl.ac.uk</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry, I&#39;m using perl 5.8.0 &#40;not 5.0.8, of course&#41;!
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
