<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #28722 for Net-SSH2: deprecated LIBSSH2_APINO in libssh2 0.16+ causes test suite failure</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #28722 for Net-SSH2: deprecated LIBSSH2_APINO in libssh2 0.16+ causes test suite failure</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-SSH2/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-SSH2/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-SSH2/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-SSH2/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-SSH2">Net-SSH2 CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">28722</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-SSH2/Active/">Net-SSH2</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
RYBSKEJ [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-23280-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.10    </td>
  </tr>
  <tr id="CF-23281-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;07&nbsp;17:24:15&nbsp;2007</span>
    <span class="description">RYBSKEJ [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> deprecated LIBSSH2_APINO in libssh2 0.16+ causes test suite failure</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The current error is as follows:

# make test
PERL_DL_NONLAZY=1 /usr/bin/perl &#34;-MExtUtils::Command::MM&#34; &#34;-e&#34;
&#34;test_harness&#40;0, &#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/*.t
t/Net-SSH2....ok 1/72
#   Failed test &#39;API date yyyymmddhhmm&#39;
#   in t/Net-SSH2.t at line 33.
#                   &#39;LIBSSH2_APINO&#39;
#     doesn&#39;t match &#39;&#40;?-xism:^\d{12}$&#41;&#39;
t/Net-SSH2....NOK 8# Looks like you failed 1 test of 72.
t/Net-SSH2....dubious
        Test returned status 1 &#40;wstat 256, 0x100&#41;
DIED. FAILED test 8
        Failed 1/72 tests, 98.61% okay &#40;less 61 skipped tests: 10 okay,
13.89%&#41;
Failed Test  Stat Wstat Total Fail  List of Failed
-------------------------------------------------------------------------------
t/Net-SSH2.t    1   256    72    1  8
61 subtests skipped.
Failed 1/1 test scripts. 1/72 subtests failed.
Files=1, Tests=72,  1 wallclock secs &#40; 0.16 cusr +  0.08 csys =  0.24 CPU&#41;


According to the libssh2 documentation:

2007-08-03  Daniel Stenberg

        * include/libssh2.h: LIBSSH2_APINO is now gone, the sooner the
        better. This is gonna cause some pains in apps relying on it, but it
        is broken by design and we should not rely on it at all. Go for the
        LIBSSH2_VERSION_* defines instead if you need to check for versions.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;10&nbsp;15:47:19&nbsp;2007</span>
    <span class="description">fischerdk [...] earthlink.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here&#39;s a patch I hacked together that should do the trick.

Cheers,

Doug

On Tue Aug 07 17:24:15 2007, RYBSKEJ wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The current error is as follows:
&gt; 
&gt; # make test
&gt; PERL_DL_NONLAZY=1 /usr/bin/perl &#34;-MExtUtils::Command::MM&#34; &#34;-e&#34;
&gt; &#34;test_harness&#40;0, &#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/*.t
&gt; t/Net-SSH2....ok 1/72
&gt; #   Failed test &#39;API date yyyymmddhhmm&#39;
&gt; #   in t/Net-SSH2.t at line 33.
&gt; #                   &#39;LIBSSH2_APINO&#39;
&gt; #     doesn&#39;t match &#39;&#40;?-xism:^\d{12}$&#41;&#39;
&gt; t/Net-SSH2....NOK 8# Looks like you failed 1 test of 72.
&gt; t/Net-SSH2....dubious
&gt;         Test returned status 1 &#40;wstat 256, 0x100&#41;
&gt; DIED. FAILED test 8
&gt;         Failed 1/72 tests, 98.61% okay &#40;less 61 skipped tests: 10
&gt; okay,
&gt; 13.89%&#41;
&gt; Failed Test  Stat Wstat Total Fail  List of Failed
&gt;
</div>-------------------------------------------------------------------------------
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; t/Net-SSH2.t    1   256    72    1  8
&gt; 61 subtests skipped.
&gt; Failed 1/1 test scripts. 1/72 subtests failed.
&gt; Files=1, Tests=72,  1 wallclock secs &#40; 0.16 cusr +  0.08 csys =  0.24
&gt; CPU&#41;
&gt; 
&gt; 
&gt; According to the libssh2 documentation:
&gt; 
&gt; 2007-08-03  Daniel Stenberg
&gt; 
&gt;         * include/libssh2.h: LIBSSH2_APINO is now gone, the sooner the
&gt;         better. This is gonna cause some pains in apps relying on it,
&gt; but it
&gt;         is broken by design and we should not rely on it at all. Go
&gt; for the
&gt;         LIBSSH2_VERSION_* defines instead if you need to check for
&gt; versions.
&gt; 
</div></div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -PurN Net-SSH2-0.10.orig/SSH2.xs Net-SSH2-0.10/SSH2.xs
--- Net-SSH2-0.10.orig/SSH2.xs	2007-02-24 11:43:30.000000000 -0500
+++ Net-SSH2-0.10/SSH2.xs	2007-10-10 15:29:51.000000000 -0400
@@ -14,10 +14,10 @@
 #include &lt;libssh2_sftp.h&gt;
 
 /* include public key support if available */
-#if LIBSSH2_APINO &gt;= 200507211326  /* 0.12+ */
+#if LIBSSH2_VERSION_NUM &gt;= 0x000c00  /* 0.12+ */
 #include &lt;libssh2_publickey.h&gt;
 #define NET_SSH2_PUBLICKEY
-#endif  /* LIBSSH2_APINO &gt;= 200507211326 */
+#endif  /* LIBSSH2_VERSION_NUM &gt;= 0x000c00 */
 
 
 #include &#34;const-c.inc&#34;
@@ -562,7 +562,6 @@
 
 #define NET_SSH2_STROF1&#40;x&#41; #x
 #define NET_SSH2_STROF&#40;x&#41; NET_SSH2_STROF1&#40;x&#41;
-#define LIBSSH2_APINO_STR NET_SSH2_STROF&#40;LIBSSH2_APINO&#41;
 
 void
 net_ss_debug&#40;SV*, SV* debug&#41;
@@ -576,14 +575,12 @@
     case G_SCALAR:
         XSRETURN_PV&#40;LIBSSH2_VERSION&#41;;
     case G_ARRAY:
-        EXTEND&#40;SP, 3&#41;;
+        EXTEND&#40;SP, 2&#41;;
         ST&#40;0&#41; = sv_2mortal&#40;newSVpv&#40;LIBSSH2_VERSION, 0&#41;&#41;;
-        ST&#40;1&#41; = sv_2mortal&#40;newSVpv&#40;LIBSSH2_APINO_STR, 0&#41;&#41;;
-        ST&#40;2&#41; = sv_2mortal&#40;newSVpv&#40;LIBSSH2_SSH_DEFAULT_BANNER, 0&#41;&#41;;
+        ST&#40;1&#41; = sv_2mortal&#40;newSVpv&#40;LIBSSH2_SSH_DEFAULT_BANNER, 0&#41;&#41;;
-        XSRETURN&#40;3&#41;;
+        XSRETURN&#40;2&#41;;
     }
 
-#undef LIBSSH2_APINO_STR
 #undef NET_SSH2_STROF
 #undef NET_SSH2_STROF1
     
diff -PurN Net-SSH2-0.10.orig/t/Net-SSH2.t Net-SSH2-0.10/t/Net-SSH2.t
--- Net-SSH2-0.10.orig/t/Net-SSH2.t	2007-10-10 15:31:25.000000000 -0400
+++ Net-SSH2-0.10/t/Net-SSH2.t	2007-10-10 15:30:44.000000000 -0400
@@ -4,7 +4,7 @@
 
 #########################
 
-use Test::More tests =&gt; 72;
+use Test::More tests =&gt; 71;
 
 use strict;
 use File::Basename;
@@ -25,12 +25,11 @@
 ok&#40;$ssh2-&gt;banner&#40;&#39;SSH TEST&#39;&#41;, &#39;set banner&#39;&#41;;
 is&#40;LIBSSH2_ERROR_SOCKET_NONE&#40;&#41;, -1, &#39;LIBSSH2_* constants&#39;&#41;;
 
-# &#40;4&#41; version
+# &#40;3&#41; version
 my $version = $ssh2-&gt;version&#40;&#41;;
 ok&#40;$version &gt;= 0.11, &#34;libSSH2 version $version &gt; 0.11&#34;&#41;;
-my &#40;$version2, $apino, $banner&#41; = $ssh2-&gt;version&#40;&#41;;
+my &#40;$version2, $banner&#41; = $ssh2-&gt;version&#40;&#41;;
 is&#40;$version, $version2, &#39;list version match&#39;&#41;;
-like&#40;$apino, qr/^\d{12}$/, &#39;API date yyyymmddhhmm&#39;&#41;;
 is&#40;$banner, &#34;SSH-2.0-libssh2_$version&#34;, &#34;banner is $banner&#34;&#41;;
 
 # &#40;2&#41; timeout
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;10&nbsp;15:47:41&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;29&nbsp;12:48:20&nbsp;2007</span>
    <span class="description">lammel [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> LAMMEL [...] cpan.org</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here&#39;s a patch that uses the new LIBSSH2_VERSION_NUM instead of
LIBSSH2_APINO, which allows for easy version comparison.

The apino reported by $ssh2-&gt;version is now returned as 0x001100 &#40;for
v0.17&#41; which can be easily compared &#40;as string&#41; in perl.

Apply with:   patch -p1 &lt; net-ssh2-0.10-noapino.patch

Cheers

Roland

On Wed Oct 10 15:47:19 2007, DKF wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Here&#39;s a patch I hacked together that should do the trick.
&gt; 
&gt; Cheers,
&gt; 
&gt; Doug
&gt; 
&gt; On Tue Aug 07 17:24:15 2007, RYBSKEJ wrote:
<div class="message-stanza open">&gt; &gt; The current error is as follows:
&gt; &gt;
&gt; &gt; # make test
&gt; &gt; PERL_DL_NONLAZY=1 /usr/bin/perl &#34;-MExtUtils::Command::MM&#34; &#34;-e&#34;
&gt; &gt; &#34;test_harness&#40;0, &#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/*.t
&gt; &gt; t/Net-SSH2....ok 1/72
&gt; &gt; #   Failed test &#39;API date yyyymmddhhmm&#39;
&gt; &gt; #   in t/Net-SSH2.t at line 33.
&gt; &gt; #                   &#39;LIBSSH2_APINO&#39;
&gt; &gt; #     doesn&#39;t match &#39;&#40;?-xism:^\d{12}$&#41;&#39;
&gt; &gt; t/Net-SSH2....NOK 8# Looks like you failed 1 test of 72.
&gt; &gt; t/Net-SSH2....dubious
&gt; &gt;         Test returned status 1 &#40;wstat 256, 0x100&#41;
&gt; &gt; DIED. FAILED test 8
&gt; &gt;         Failed 1/72 tests, 98.61% okay &#40;less 61 skipped tests: 10
&gt; &gt; okay,
&gt; &gt; 13.89%&#41;
&gt; &gt; Failed Test  Stat Wstat Total Fail  List of Failed
&gt; &gt;
</div>&gt;
</div>-------------------------------------------------------------------------------
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; t/Net-SSH2.t    1   256    72    1  8
&gt; &gt; 61 subtests skipped.
&gt; &gt; Failed 1/1 test scripts. 1/72 subtests failed.
&gt; &gt; Files=1, Tests=72,  1 wallclock secs &#40; 0.16 cusr +  0.08 csys =
</div>&gt; 0.24
<div class="message-stanza open">&gt; &gt; CPU&#41;
&gt; &gt;
&gt; &gt;
&gt; &gt; According to the libssh2 documentation:
&gt; &gt;
&gt; &gt; 2007-08-03  Daniel Stenberg
&gt; &gt;
&gt; &gt;         * include/libssh2.h: LIBSSH2_APINO is now gone, the sooner
</div>&gt; the
<div class="message-stanza open">&gt; &gt;         better. This is gonna cause some pains in apps relying on
</div>&gt; it,
<div class="message-stanza open">&gt; &gt; but it
&gt; &gt;         is broken by design and we should not rely on it at all. Go
&gt; &gt; for the
&gt; &gt;         LIBSSH2_VERSION_* defines instead if you need to check for
&gt; &gt; versions.
&gt; &gt;
</div>&gt; 
&gt; 
</div></div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Nur in Net-SSH2-0.10: build-stamp.
Nur in Net-SSH2-0.10: const-c.inc.
Nur in Net-SSH2-0.10: const-xs.inc.
Nur in Net-SSH2-0.10: debian.
Nur in Net-SSH2-0.10: install-stamp.
Nur in Net-SSH2-0.10: Makefile.old.
diff -u --recursive Net-SSH2-0.10.orig/SSH2.xs Net-SSH2-0.10/SSH2.xs
--- Net-SSH2-0.10.orig/SSH2.xs	2007-02-24 17:43:30.000000000 +0100
+++ Net-SSH2-0.10/SSH2.xs	2007-10-29 17:24:12.000000000 +0100
@@ -15,10 +15,16 @@
 
 /* include public key support if available */
 #if LIBSSH2_APINO &gt;= 200507211326  /* 0.12+ */
-#include &lt;libssh2_publickey.h&gt;
 #define NET_SSH2_PUBLICKEY
 #endif  /* LIBSSH2_APINO &gt;= 200507211326 */
+/* as of libssh2 0.17 the new LIBSSH2_VERSION_NUM is supported */
+#ifdef LIBSSH2_VERSION_NUM
+#define NET_SSH2_PUBLICKEY
+#endif
 
+#ifdef NET_SSH2_PUBLICKEY
+#include &lt;libssh2_publickey.h&gt;
+#endif  /* NET_SSH2_PUBLICKEY */
 
 #include &#34;const-c.inc&#34;
 
@@ -562,7 +568,11 @@
 
 #define NET_SSH2_STROF1&#40;x&#41; #x
 #define NET_SSH2_STROF&#40;x&#41; NET_SSH2_STROF1&#40;x&#41;
-#define LIBSSH2_APINO_STR NET_SSH2_STROF&#40;LIBSSH2_APINO&#41;
+#ifdef LIBSSH2_VERSION_NUM
+#define LIBSSH2_VERSION_NUM_STR NET_SSH2_STROF&#40;LIBSSH2_VERSION_NUM&#41;
+#else
+#define LIBSSH2_VERSION_NUM_STR NET_SSH2_STROF&#40;LIBSSH2_APINO&#41;
+#endif
 
 void
 net_ss_debug&#40;SV*, SV* debug&#41;
@@ -578,7 +588,7 @@
     case G_ARRAY:
         EXTEND&#40;SP, 3&#41;;
         ST&#40;0&#41; = sv_2mortal&#40;newSVpv&#40;LIBSSH2_VERSION, 0&#41;&#41;;
-        ST&#40;1&#41; = sv_2mortal&#40;newSVpv&#40;LIBSSH2_APINO_STR, 0&#41;&#41;;
+        ST&#40;1&#41; = sv_2mortal&#40;newSVpv&#40;LIBSSH2_VERSION_NUM_STR, 0&#41;&#41;;
         ST&#40;2&#41; = sv_2mortal&#40;newSVpv&#40;LIBSSH2_SSH_DEFAULT_BANNER, 0&#41;&#41;;
         XSRETURN&#40;3&#41;;
     }
diff -u --recursive Net-SSH2-0.10.orig/t/Net-SSH2.t Net-SSH2-0.10/t/Net-SSH2.t
--- Net-SSH2-0.10.orig/t/Net-SSH2.t	2007-02-24 16:27:18.000000000 +0100
+++ Net-SSH2-0.10/t/Net-SSH2.t	2007-10-29 17:32:05.000000000 +0100
@@ -30,7 +30,7 @@
 ok&#40;$version &gt;= 0.11, &#34;libSSH2 version $version &gt; 0.11&#34;&#41;;
 my &#40;$version2, $apino, $banner&#41; = $ssh2-&gt;version&#40;&#41;;
 is&#40;$version, $version2, &#39;list version match&#39;&#41;;
-like&#40;$apino, qr/^\d{12}$/, &#39;API date yyyymmddhhmm&#39;&#41;;
+like&#40;$apino, qr/^0x[0-9a-f]{6}$/ || qr/^\d{12}$/, &#39;API version matches 0xMMmmpp or yyyymmddhhmm$&#39;&#41;;
 is&#40;$banner, &#34;SSH-2.0-libssh2_$version&#34;, &#34;banner is $banner&#34;&#41;;
 
 # &#40;2&#41; timeout
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;10&nbsp;18:48:20&nbsp;2007</span>
    <span class="description">dbrobins [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixed in 0.18.  I elected to use LIBSSH2_VERSION_NUM in place of
LIBSSH2_APINO, without even looking at the comments or patch attached to
this bug.  Test also updated.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;10&nbsp;18:48:22&nbsp;2007</span>
    <span class="description">dbrobins [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
