<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #22374 for Object-InsideOut: New Attribute style Type: dies with subs or objects</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #22374 for Object-InsideOut: New Attribute style Type: dies with subs or objects</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Object-InsideOut/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Object-InsideOut/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Object-InsideOut/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Object-InsideOut/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Object-InsideOut">Object-InsideOut CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">22374</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Object-InsideOut/Active/">Object-InsideOut</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
pause [...] erichacker.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-23956-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.14    </td>
  </tr>
  <tr id="CF-23957-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
2.15    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;20&nbsp;14:55:37&nbsp;2006</span>
    <span class="description">pause [...] erichacker.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> New Attribute style Type: dies with subs or objects</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From t/15-type.t added:

 my @cc1 :Field
         :Acc&#40;cc1&#41;
         :Type&#40;sub{ shift &gt; 0 }&#41;;

Got error:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"> &gt;perl -w 15-type.t
</div> OIO::Attribute error: Malformed attribute in package &#39;My::Class&#39;
 Error: Odd number of elements in anonymous hash
 Attribute: Type&#40;sub{ shift &gt; 0 }&#41;
 Package: main
 File: 15-type.t
 Line: 49

 Trace begun at 15-type.t line 49
 # Looks like your test died before it could output anything.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"> &gt;Exit code: 255
</div>
I have attached a revised test file using the new attribute technique.
Not much, but it might save you five minutes. Note that currently all
the bad declaration forms are commented out so as to figure out which
ones were working.

Version info: OIO 2.14
This is perl, v5.8.8 built for MSWin32-x86-multi-thread
&#40;with 33 registered patches, see perl -V for more detail&#41;
Binary build 819 [267479] provided by ActiveState 
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 15a-type.t</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">use strict;
use warnings;

use Test::More &#39;no_plan&#39;;

package My::Class; {
    use Object::InsideOut;

    sub is_scalar : Private { return &#40;! ref&#40;shift&#41;&#41;; }

    sub is_int {
        my $arg = $_[0];
        return &#40;Scalar::Util::looks_like_number&#40;$arg&#41; &#38;&#38;
                &#40;int&#40;$arg&#41; == $arg&#41;&#41;;
    }

    my @aa : Field
				:Acc&#40;&#39;aa&#39;&#41;
				:Type&#40;&#39;array&#39;&#41;;
    my @ar : Field
				: Acc&#40;&#39;ar&#39;&#41; 
				: Type&#40;&#39;array_ref&#39;&#41;;
#    my @cc : Field&#40;{&#39;acc&#39;=&gt;&#39;cc&#39;, &#39;type&#39; =&gt; sub{ shift &gt; 0 } }&#41;;
#    my @cc : Field
#				: Acc&#40;cc1&#41;
#				: Type&#40;sub{ shift &gt; 0 }&#41;;
    my @hh : Field
				:Acc&#40;&#39;hh&#39;&#41;
				:Type&#40;&#39;hash&#39;&#41;;
    my @hr : Field
				:Acc&#40;&#39;hr&#39;&#41;
				:Type&#40;&#39;hashref&#39;&#41;;
#    my @mc : Field
#				:Acc&#40;&#39;mc&#39;&#41;
#				:Type&#40;&#39;My::Class&#39;&#41;;
    my @nn : Field
				:Acc&#40;&#39;nn&#39;&#41;
				:Type&#40;&#39;num&#39;&#41;;
#    my @ss : Field
#				: Acc&#40;&#39;ss&#39;&#41;
#				: Type&#40;\&#38;My::Class::is_scalar&#41;;

    my %init_args :InitArgs = &#40;
        &#39;DATA&#39; =&gt; {
            &#39;Field&#39; =&gt; \@nn,
            &#39;Type&#39;  =&gt; \&#38;is_int,
        },
        &#39;INFO&#39; =&gt; {
            &#39;Type&#39;  =&gt; sub { $_[0] }
        },
        &#39;BAD&#39; =&gt; {
            &#39;Type&#39;  =&gt; sub { shift &gt; 0 }
        },
    &#41;;
}

package main;

MAIN:
{
    my $obj = My::Class-&gt;new&#40;&#39;DATA&#39; =&gt; 5&#41;;

    $obj-&gt;aa&#40;&#39;test&#39;&#41;;
    is_deeply&#40;$obj-&gt;aa&#40;&#41;, [&#39;test&#39;]              =&gt; &#39;Array single value&#39;&#41;;
    $obj-&gt;aa&#40;&#39;zero&#39;, 5&#41;;
    is_deeply&#40;$obj-&gt;aa&#40;&#41;, [&#39;zero&#39;, 5]           =&gt; &#39;Array multiple values&#39;&#41;;
    $obj-&gt;aa&#40;[&#39;x&#39;, 42, &#39;z&#39;]&#41;;
    is_deeply&#40;$obj-&gt;aa&#40;&#41;, [&#39;x&#39;, 42, &#39;z&#39;]        =&gt; &#39;Array ref value&#39;&#41;;

    eval { $obj-&gt;ar&#40;&#39;test&#39;&#41;; };
    like&#40;$@-&gt;message, qr/Wrong type/            =&gt; &#39;Not array ref&#39;&#41;;
    $obj-&gt;ar&#40;[3, [ &#39;a&#39; ]]&#41;;
    is_deeply&#40;$obj-&gt;ar&#40;&#41;, [3, [ &#39;a&#39; ]]          =&gt; &#39;Array ref&#39;&#41;;

    $obj-&gt;cc&#40;12&#41;;
    is&#40;$obj-&gt;cc&#40;&#41;, 12                           =&gt; &#39;Type sub&#39;&#41;;
    eval { $obj-&gt;cc&#40;-5&#41;; };
    like&#40;$@-&gt;message, qr/failed type check/     =&gt; &#39;Type failure&#39;&#41;;
    eval { $obj-&gt;cc&#40;&#39;hello&#39;&#41;; };
    like&#40;$@-&gt;message, qr/Problem with type check routine/  =&gt; &#39;Type sub failure&#39;&#41;;

    $obj-&gt;hh&#40;&#39;x&#39; =&gt; 5&#41;;
    is_deeply&#40;$obj-&gt;hh&#40;&#41;, {&#39;x&#39;=&gt;5}              =&gt; &#39;Hash single pair&#39;&#41;;
    $obj-&gt;hh&#40;&#39;a&#39; =&gt; &#39;z&#39;, &#39;0&#39; =&gt; &#39;9&#39;&#41;;
    is_deeply&#40;$obj-&gt;hh&#40;&#41;, {&#39;a&#39;=&gt;&#39;z&#39;,&#39;0&#39;=&gt;&#39;9&#39;}   =&gt; &#39;Hash multiple pairs&#39;&#41;;
    $obj-&gt;hh&#40;{&#39;2b&#39;=&gt;&#39;not&#39;}&#41;;
    is_deeply&#40;$obj-&gt;hh&#40;&#41;, {&#39;2b&#39;=&gt;&#39;not&#39;}         =&gt; &#39;Hash ref value&#39;&#41;;

    eval { $obj-&gt;hr&#40;&#39;test&#39;&#41;; };
    like&#40;$@-&gt;message, qr/Wrong type/            =&gt; &#39;Not hash ref&#39;&#41;;
    $obj-&gt;hr&#40;{&#39;frog&#39;=&gt;{&#39;prince&#39;=&gt;&#39;John&#39;}}&#41;;
    is_deeply&#40;$obj-&gt;hr&#40;&#41;, {&#39;frog&#39;=&gt;{&#39;prince&#39;=&gt;&#39;John&#39;}} =&gt; &#39;Hash ref&#39;&#41;;

    my $obj2 = My::Class-&gt;new&#40;&#41;;
    $obj-&gt;mc&#40;$obj2&#41;;
    my $obj3 = $obj-&gt;mc&#40;&#41;;
    isa_ok&#40;$obj3, &#39;My::Class&#39;                   =&gt; &#39;Object&#39;&#41;;
    is&#40;$$obj3, $$obj2                           =&gt; &#39;Objects equal&#39;&#41;;
    eval { $obj2-&gt;mc&#40;&#39;test&#39;&#41;; };
    like&#40;$@-&gt;message, qr/Wrong type/            =&gt; &#39;Not object&#39;&#41;;

    $obj-&gt;nn&#40;99&#41;;
    is_deeply&#40;$obj-&gt;nn&#40;&#41;, 99                    =&gt; &#39;Numeric&#39;&#41;;
    eval { $obj-&gt;nn&#40;&#39;x&#39;&#41;; };
    like&#40;$@-&gt;message, qr/Bad argument/          =&gt; &#39;Numeric failure&#39;&#41;;

    $obj-&gt;ss&#40;&#39;hello&#39;&#41;;
    is&#40;$obj-&gt;ss&#40;&#41;, &#39;hello&#39;                      =&gt; &#39;Scalar&#39;&#41;;
    eval { $obj-&gt;ss&#40;[1]&#41;; };
    like&#40;$@-&gt;message, qr/failed type check/     =&gt; &#39;Scalar failure&#39;&#41;;

    eval { $obj2 = My::Class-&gt;new&#40;&#39;DATA&#39; =&gt; &#39;hello&#39;&#41;; };
    like&#40;$@-&gt;message, qr/failed type check/     =&gt; &#39;Type failure&#39;&#41;;

    eval { $obj2 = My::Class-&gt;new&#40;&#39;INFO&#39; =&gt; &#39;&#39;&#41;; };
    like&#40;$@-&gt;message, qr/failed type check/     =&gt; &#39;Type failure&#39;&#41;;

    eval { $obj2 = My::Class-&gt;new&#40;&#39;BAD&#39; =&gt; &#39;&#39;&#41;; };
    like&#40;$@-&gt;message, qr/Problem with type check routine/  =&gt; &#39;Type sub failure&#39;&#41;;
}

exit&#40;0&#41;;

# EOF
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;20&nbsp;15:49:08&nbsp;2006</span>
    <span class="description">jdhedden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Oct 20 14:55:37 2006, hacker wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  my @cc1 :Field
&gt;        :Acc&#40;cc1&#41;
&gt;        :Type&#40;sub{ shift &gt; 0 }&#41;;
</div>
Thanks for finding this bug and for the new test file.  I fixed the
problem and uploaded a new version to CPAN.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;20&nbsp;15:49:08&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;23&nbsp;11:30:39&nbsp;2006</span>
    <span class="description">jdhedden [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;23&nbsp;11:30:40&nbsp;2006</span>
    <span class="description">jdhedden [...] cpan.org -  Fixed in 2.15 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
