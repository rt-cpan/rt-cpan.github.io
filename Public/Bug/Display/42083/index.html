<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #42083 for GD: Patched Makefile.PL to detect GD version below 2.0.28</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #42083 for GD: Patched Makefile.PL to detect GD version below 2.0.28</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/GD/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/GD/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/GD/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/GD/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/GD">GD CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">42083</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">patched</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/GD/Active/">GD</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
gyles19 [...] visi.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-14260-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.41    </td>
  </tr>
  <tr id="CF-14261-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
2.41    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;01&nbsp;16:24:25&nbsp;2009</span>
    <span class="description">gyles19 [...] visi.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Patched Makefile.PL to detect GD version below 2.0.28</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have GD 2.0.15 and that version already provides gdlib-config.  The 
current Makefile.PL reads the version but does not check that it matches the 
minimum required version as in the README.  This allows the build to proceed 
further than it should, and since the tests don&#39;t check for the version, 
they fail oddly on various missing symbols.

I have attached a patch that enhances Makefile.PL to check for 2.0.28 and
die if an older version is found.  This honors the --ignore-missing-gd
option.

I tested my patch by running &#39;perl Makefile.PL&#39; with my old libgd 2.0.15 to 
watch the install die with the new error. I also did this with the --ignore-
missing-gd option, which built but failed its tests, as expected.

Then I installed libgd 2.0.35 and ran &#39;perl Makefile.PL&#39;, which succeeded.

And an FYI, the gd-2.0.35.tar.gz unpacks into directory gd-2.0.35, but it 
failed to make until I created an empty configure.in file, and then it 
built.  However, the library installed reports its internal version as 
2.0.34, so the libgd folks need to tweak the 2.0.35 build.  The libgd 
website shows a fix for the version issue, but not the build issue I 
experienced.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> add_GD_version_test.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/Makefile.PL b/Makefile.PL
index 4365139..cd99053 100644
--- a/Makefile.PL
+++ b/Makefile.PL
@@ -21,7 +21,7 @@ my &#40;$options,$lib_gd_path,$lib_ft_path,$lib_png_path,$lib_jpeg_path,$lib_xpm_pat
 use Getopt::Long;
 GetOptions&#40;&#34;ignore_missing_gd&#34; =&gt; \$force&#41;;
 
-unless &#40;try_to_autoconfigure&#40;\$options,\$lib_gd_path,\@INC,\@LIBPATH,\@LIBS&#41; || $force&#41; {
+unless &#40;try_to_autoconfigure&#40;\$options,\$lib_gd_path,\@INC,\@LIBPATH,\@LIBS, $force&#41; || $force&#41; {
     die &lt;&lt;END;
 **UNRECOVERABLE ERROR**
 Could not find gdlib-config in the search path. Please install libgd 2.0.28 or higher.
@@ -255,7 +255,7 @@ WriteMakefile&#40;
 exit 0;
 
 sub try_to_autoconfigure {
-  my &#40;$options,$lib_gd_path,$INC,$LIBPATH,$LIBS&#41; = @_;
+  my &#40;$options,$lib_gd_path,$INC,$LIBPATH,$LIBS,$force&#41; = @_;
   my $config = `gdlib-config --all`;
   return unless $config;
   $AUTOCONFIG++;
@@ -280,7 +280,8 @@ sub try_to_autoconfigure {
   $$options      = $features;
 
   my &#40;$major, $middle, $minor&#41;    = $version =~ /^&#40;\d+&#41;\.&#40;\d+&#41;\.&#40;\d+&#41;$/;
-  if &#40; !$force &#38;&#38; &#40;&#40; $major &lt; 2 &#41; or &#40; &#34;$major.middle&#34; eq &#34;2.0&#34; &#38;&#38; $minor &lt; 28 &#41; &#41;&#41; {
+  $DB::single=1;
+  if &#40; !$force &#38;&#38; &#40;&#40; $major &lt; 2 &#41; or &#40; &#34;$major.$middle&#34; eq &#34;2.0&#34; &#38;&#38; $minor &lt; 28 &#41; &#41;&#41; {
     die &lt;&lt;END;
 **UNRECOVERABLE ERROR**
 Your GD library version $version is too old. Please install libgd 2.0.28 or higher.
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;01&nbsp;16:39:11&nbsp;2009</span>
    <span class="description">gyles19 [...] visi.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Patched Makefile.PL to detect GD version below 2.0.28 CORRECTED</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I attached the wrong patch file on my original report.  This is the correct 
patch file.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/Makefile.PL b/Makefile.PL
index 6a1ea34..ca43568 100644
--- a/Makefile.PL
+++ b/Makefile.PL
@@ -21,7 +21,7 @@ my &#40;$options,$lib_gd_path,$lib_ft_path,$lib_png_path,$lib_jpeg_path,$lib_xpm_pat
 use Getopt::Long;
 GetOptions&#40;&#34;ignore_missing_gd&#34; =&gt; \$force&#41;;
 
-unless &#40;try_to_autoconfigure&#40;\$options,\$lib_gd_path,\@INC,\@LIBPATH,\@LIBS&#41; || $force&#41; {
+unless &#40;try_to_autoconfigure&#40;\$options,\$lib_gd_path,\@INC,\@LIBPATH,\@LIBS, $force&#41; || $force&#41; {
     die &lt;&lt;END;
 **UNRECOVERABLE ERROR**
 Could not find gdlib-config in the search path. Please install libgd 2.0.28 or higher.
@@ -255,7 +255,7 @@ WriteMakefile&#40;
 exit 0;
 
 sub try_to_autoconfigure {
-  my &#40;$options,$lib_gd_path,$INC,$LIBPATH,$LIBS&#41; = @_;
+  my &#40;$options,$lib_gd_path,$INC,$LIBPATH,$LIBS,$force&#41; = @_;
   my $config = `gdlib-config --all`;
   return unless $config;
   $AUTOCONFIG++;
@@ -279,7 +279,14 @@ sub try_to_autoconfigure {
   &#40;$$lib_gd_path = $libdir&#41; =~ s!/[^/]+$!!;
   $$options      = $features;
 
-  my &#40;$minor&#41;    = $version =~ /^2\.\d+\.&#40;\d+&#41;$/;
+  my &#40;$major, $middle, $minor&#41;    = $version =~ /^&#40;\d+&#41;\.&#40;\d+&#41;\.&#40;\d+&#41;$/;
+  if &#40; !$force &#38;&#38; &#40;&#40; $major &lt; 2 &#41; or &#40; &#34;$major.$middle&#34; eq &#34;2.0&#34; &#38;&#38; $minor &lt; 28 &#41; &#41;&#41; {
+    die &lt;&lt;END;
+**UNRECOVERABLE ERROR**
+Your GD library version $version is too old. Please install libgd 2.0.28 or higher.
+If you want to try to compile anyway, please rerun this script with the option --ignore_missing_gd.
+END
+  }
   $$options     .= &#34; GD_UNCLOSEDPOLY GD_ANIMGIF GD_FTCIRCLE VERSION_33&#34; if defined&#40;$minor&#41; &#38;&#38; $minor &gt;= 33;
 
   my @correct_inc = map {s/^-I// &#38;&#38; $_} split /\s+/,$cflags;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;01&nbsp;16:39:12&nbsp;2009</span>
    <span class="description">gyles19 [...] visi.com -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;22&nbsp;11:59:33&nbsp;2017</span>
    <span class="description">RURBAN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I don&#39;t think this 2.0.28 check is needed anymore.
We protected all old symbols with #ifdef VERSION_33 in the XS.

But I haven&#39;t tested it yet with such an old libgd, will do eventually.
-- 
Reini Urban
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;22&nbsp;11:59:39&nbsp;2017</span>
    <span class="description">RURBAN [...] cpan.org -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
