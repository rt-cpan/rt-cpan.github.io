<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #72470 for JIRA-Client: Ticket type not updated when calling JIRA::Client::update_issue</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #72470 for JIRA-Client: Ticket type not updated when calling JIRA::Client::update_issue</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/JIRA-Client/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/JIRA-Client/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/JIRA-Client/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/JIRA-Client/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/gnustavo/JIRA-Client/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/JIRA-Client">JIRA-Client CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">72470</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/JIRA-Client/Active/">JIRA-Client</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">GNUSTAVO [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dbaber [...] corvisa.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-227150-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-227151-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;16&nbsp;12:34:42&nbsp;2011</span>
    <span class="description">dbaber [...] corvisa.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Ticket type not updated when calling JIRA::Client::update_issue</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 16 Nov 2011 17:34:27 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-JIRA-Client [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dan Baber &lt;dbaber [...] corvisa.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello, I believe I found a bug in the update_issue&#40;&#41; method of JIRA::Client. I have attached some test code and I am providing the output of my test run which should illustrate the bug. Basically when passing &#34;type&#34; into the hash to update the ticket the ticket type is not updated. 

Here is info about my working env and the module version being used: 



dbaber@atlas:~/src/blackjack/t$ perl -MJIRA::Client -e &#39;print &#34;$JIRA::Client::VERSION\n&#34;&#39; 
0.30 
dbaber@atlas:~/src/blackjack/t$ perl -v 


This is perl, v5.10.1 &#40;*&#41; built for x86_64-linux-gnu-thread-multi 


Copyright 1987-2009, Larry Wall 


Perl may be copied only under the terms of either the Artistic License or the 
GNU General Public License, which may be found in the Perl 5 source kit. 


Complete documentation for Perl, including FAQ lists, should be found on 
this system using &#34;man perl&#34; or &#34;perldoc perl&#34;. If you have access to the 
Internet, point your browser at <span class="clickylink"><a target="new" rel="nofollow" href="http://www.perl.org/">http://www.perl.org/</a></span>, the Perl Home Page. 


dbaber@atlas:~/src/blackjack/t$ uname -a 
Linux atlas 2.6.32-35-generic #78-Ubuntu SMP Tue Oct 11 16:11:24 UTC 2011 x86_64 GNU/Linux 
dbaber@atlas:~/src/blackjack/t$ cat /etc/lsb-release 
DISTRIB_ID=Ubuntu 
DISTRIB_RELEASE=10.04 
DISTRIB_CODENAME=lucid 
DISTRIB_DESCRIPTION=&#34;Ubuntu 10.04.3 LTS&#34; 




Here is the test run results: 

[11:32:15] t/Blackjack/jira_client_bug.t .. 
# Fixture: everything 
1..10 
ok 1 - instantiated JIRA::Client isa JIRA::Client 
ok 2 - instantiated RemoteIssue isa RemoteIssue 
ok 3 - ... issue assignee is &#39;dbaber&#39; 
ok 4 - ... issue summary is &#39;TEST Ticket from Unit test&#39; 
ok 5 - ... issue project is &#39;TESTPROJECT&#39; 
ok 6 - ... issue type is &#39;7&#39; 
ok 7 - ... issue description is &#39;Test ticket to illustrate bug in JIRA::Client where the ticket type is not updated.&#39; 
ok 8 - ... issue summary after update is &#39;TEST Ticket from Unit test- UPDATED&#39; 
not ok 9 - ... issue type after update is &#39;1&#39; 


# Failed test &#39;... issue type after update is &#39;1&#39;&#39; 
# at t/Blackjack/jira_client_bug.t line 72. 
# got: &#39;7&#39; 
# expected: &#39;1&#39; 
ok 10 - ... issue description after update is &#39;UDATED - Test ticket to illustrate bug in JIRA::Client where the ticket type is not updated.&#39; 
Failed 1/10 subtests 
[11:32:26] 


Test Summary Report 
------------------- 
t/Blackjack/jira_client_bug.t &#40;Wstat: 0 Tests: 10 Failed: 1&#41; 
Failed test: 9 
Files=1, Tests=10, 11 wallclock secs &#40; 0.04 usr 0.00 sys + 0.47 cusr 0.05 csys = 0.56 CPU&#41; 
Result: FAIL 


And I have attached the code. 


Thanks, 
Dan 
-- 


Dan Baber | StreetLinks Lender Solutions | Software Developer 

365 N. Mayfair Road, Second Floor, Milwaukee, WI 53226 

www.streetlinks.com | dbaber@corvisa.com 
</div></div>
<div class="messageattachments">

<div class="messagebody">
</div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
</div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;16&nbsp;18:13:34&nbsp;2011</span>
    <span class="description">dbaber [...] corvisa.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #72470] AutoReply: Ticket type not updated when calling JIRA::Client::update_issue</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 16 Nov 2011 23:13:21 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-JIRA-Client [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dan Baber &lt;dbaber [...] corvisa.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">After mucking about in the guts of this module I think it is JIRA&#39;s SOAP API itself that is not honoring changing the ticket type. 



sub AUTOLOAD { 
my &#40;$self, @args&#41; = @_; 
&#40;my $method = $AUTOLOAD&#41; =~ s/.*:://; 


say STDERR &#34;AUTOLOAD = &#34; . $AUTOLOAD if $method eq &#39;updateIssue&#39;; 
say STDERR &#34;Before madness, \@args = &#34; . Dumper&#40; \@args &#41; if $method eq &#39;updateIssue&#39;; 


# Perform any non-default type coersion 
if &#40;my $typeof = $typeof{$method}&#41; { 
if &#40;ref $typeof eq &#39;HASH&#39;&#41; { 
while &#40;my &#40;$i, $type&#41; = each %$typeof&#41; { 
if &#40;ref $type&#41; { 
ref $type eq &#39;CODE&#39; 
or croak &#34;Invalid coersion spec to &#40;&#34;, ref&#40;$type&#41;, &#34;&#41;.\n&#34;; 
$args[$i] = $type-&gt;&#40;$self, $args[$i]&#41;; 
} elsif &#40;! ref $args[$i]&#41; { 
$args[$i] = SOAP::Data-&gt;type&#40;$type =&gt; $args[$i]&#41;; 
} elsif &#40;ref $args[$i] eq &#39;ARRAY&#39;&#41; { 
foreach &#40;@{$args[$i]}&#41; { 
$_ = SOAP::Data-&gt;type&#40;$type =&gt; $_&#41;; 
} 
} elsif &#40;ref $args[$i] eq &#39;HASH&#39;&#41; { 
foreach &#40;values %{$args[$i]}&#41; { 
$_ = SOAP::Data-&gt;type&#40;$type =&gt; $_&#41;; 
} 
} else { 
croak &#34;Can&#39;t coerse argument $i of method $AUTOLOAD.\n&#34;; 
} 
} 
} 
elsif &#40;ref $typeof eq &#39;CODE&#39;&#41; { 
$typeof-&gt;&#40;$self, \$method, \@args&#41;; 
} 
} 


say STDERR &#34;After madness, \@args = &#34; . Dumper&#40; \@args &#41; if $method eq &#39;updateIssue&#39;; 


my $call = $self-&gt;{soap}-&gt;call&#40;$method, $self-&gt;{auth}, @args&#41;; 
croak $call-&gt;faultcode&#40;&#41;, &#39;, &#39;, $call-&gt;faultstring&#40;&#41; 



if defined $call-&gt;fault&#40;&#41;; 
say STDERR &#34;result = &#34; . Dumper&#40; $call-&gt;result&#40;&#41; &#41; if $method eq &#39;updateIssue&#39;; 
return $call-&gt;result&#40;&#41;; 
} 





[17:05:06] t/Blackjack/jira_client_bug.t .. 
# Fixture: everything 
1..10 
ok 1 - instantiated JIRA::Client isa JIRA::Client 
ok 2 - instantiated RemoteIssue isa RemoteIssue 
ok 3 - ... issue assignee is &#39;dbaber&#39; 
ok 4 - ... issue summary is &#39;TEST Ticket from Unit test&#39; 
ok 5 - ... issue project is &#39;TESTPROJECT&#39; 
ok 6 - ... issue type is &#39;7&#39; 
ok 7 - ... issue description is &#39;Test ticket to illustrate bug in JIRA::Client where the ticket type is not updated.&#39; 
AUTOLOAD = JIRA::Client::updateIssue 
Before madness, @args = [ 
&#34;TESTPROJECT-219&#34;, 
{ 
description =&gt; &#34;UDATED - Test ticket to illustrate bug in JIRA::Client where the ticket type is not updated.&#34;, 
summary =&gt; &#34;TEST Ticket from Unit test- UPDATED&#34;, 
type =&gt; 1 
} 
] 


After madness, @args = [ 
&#34;TESTPROJECT-219&#34;, 
[ 
bless&#40; { 
id =&gt; &#34;summary&#34;, 
values =&gt; [ 
&#34;TEST Ticket from Unit test- UPDATED&#34; 
] 
}, &#39;RemoteFieldValue&#39; &#41;, 
bless&#40; { 
id =&gt; &#34;type&#34;, 
values =&gt; [ 
1 
] 
}, &#39;RemoteFieldValue&#39; &#41;, 
bless&#40; { 
id =&gt; &#34;description&#34;, 
values =&gt; [ 

1 
] 
}, &#39;RemoteFieldValue&#39; &#41;, 
bless&#40; { 
id =&gt; &#34;description&#34;, 
values =&gt; [ 
&#34;UDATED - Test ticket to illustrate bug in JIRA::Client where the ticket type is not updated.&#34; 
] 
}, &#39;RemoteFieldValue&#39; &#41; 
] 
] 

result = bless&#40; { 
affectsVersions =&gt; [], 
assignee =&gt; &#34;dbaber&#34;, 
attachmentNames =&gt; [], 
components =&gt; [], 
created =&gt; &#34;2011-11-16T23:05:00.676Z&#34;, 
customFieldValues =&gt; [ 
bless&#40; { 
customfieldId =&gt; &#34;customfield_10002&#34;, 
key =&gt; undef, 
values =&gt; [ 
&#34;2180000000.95&#34; 
] 
}, &#39;RemoteCustomFieldValue&#39; &#41; 
], 
description =&gt; &#34;UDATED - Test ticket to illustrate bug in JIRA::Client where the ticket type is not updated.&#34;, 
duedate =&gt; undef, 
environment =&gt; undef, 
fixVersions =&gt; [], 
id =&gt; 15348, 
key =&gt; &#34;TESTPROJECT-219&#34;, 
priority =&gt; 3, 
project =&gt; &#34;TESTPROJECT&#34;, 
reporter =&gt; &#34;integrations&#34;, 
resolution =&gt; undef, 
status =&gt; 1, 
summary =&gt; &#34;TEST Ticket from Unit test- UPDATED&#34;, 
type =&gt; 7, 
updated =&gt; &#34;2011-11-16T23:05:00.676Z&#34;, 
votes =&gt; 0 
}, &#39;RemoteIssue&#39; &#41; 


ok 8 - ... issue summary after update is &#39;TEST Ticket from Unit test- UPDATED&#39; 
not ok 9 - ... issue type after update is &#39;1&#39; 


# Failed test &#39;... issue type after update is &#39;1&#39;&#39; 
# at t/Blackjack/jira_client_bug.t line 72. 
# got: &#39;7&#39; 
# expected: &#39;1&#39; 
ok 10 - ... issue description after update is &#39;UDATED - Test ticket to illustrate bug in JIRA::Client where the ticket type is not updated.&#39; 
Failed 1/10 subtests 



[17:05:17] 


Test Summary Report 
------------------- 
t/Blackjack/jira_client_bug.t &#40;Wstat: 0 Tests: 10 Failed: 1&#41; 
Failed test: 9 
Files=1, Tests=10, 11 wallclock secs &#40; 0.04 usr 0.01 sys + 0.48 cusr 0.05 csys = 0.58 CPU&#41; 
Result: FAIL 


Dan 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">----- Original Message -----
From: &#34;Bugs in JIRA-Client via RT&#34; &lt;bug-JIRA-Client@rt.cpan.org&gt; 
To: dbaber@corvisa.com 
Sent: Wednesday, November 16, 2011 11:34:42 AM 
Subject: [rt.cpan.org #72470] AutoReply: Ticket type not updated when calling JIRA::Client::update_issue 


Greetings, 

This message has been automatically generated in response to the 
creation of a trouble ticket regarding: 
&#34;Ticket type not updated when calling JIRA::Client::update_issue&#34;, 
a summary of which appears below. 

There is no need to reply to this message right now. Your ticket has been 
assigned an ID of [rt.cpan.org #72470]. Your ticket is accessible 
on the web at: 

<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=72470">https://rt.cpan.org/Ticket/Display.html?id=72470</a></span> 

Please include the string: 

[rt.cpan.org #72470] 

in the subject line of all future correspondence about this issue. To do so, 
you may reply to this message. 

Thank you, 
bug-JIRA-Client@rt.cpan.org 

------------------------------------------------------------------------- 
Hello, I believe I found a bug in the update_issue&#40;&#41; method of JIRA::Client. I have attached some test code and I am providing the output of my test run which should illustrate the bug. Basically when passing &#34;type&#34; into the hash to update the ticket the ticket type is not updated. 

Here is info about my working env and the module version being used: 



dbaber@atlas:~/src/blackjack/t$ perl -MJIRA::Client -e &#39;print &#34;$JIRA::Client::VERSION\n&#34;&#39; 
0.30 
dbaber@atlas:~/src/blackjack/t$ perl -v 


This is perl, v5.10.1 &#40;*&#41; built for x86_64-linux-gnu-thread-multi 


Copyright 1987-2009, Larry Wall 


Perl may be copied only under the terms of either the Artistic License or the 
GNU General Public License, which may be found in the Perl 5 source kit. 


Complete documentation for Perl, including FAQ lists, should be found on 
this system using &#34;man perl&#34; or &#34;perldoc perl&#34;. If you have access to the 
Internet, point your browser at <span class="clickylink"><a target="new" rel="nofollow" href="http://www.perl.org/">http://www.perl.org/</a></span>, the Perl Home Page. 


dbaber@atlas:~/src/blackjack/t$ uname -a 
Linux atlas 2.6.32-35-generic #78-Ubuntu SMP Tue Oct 11 16:11:24 UTC 2011 x86_64 GNU/Linux 
dbaber@atlas:~/src/blackjack/t$ cat /etc/lsb-release 
DISTRIB_ID=Ubuntu 
DISTRIB_RELEASE=10.04 
DISTRIB_CODENAME=lucid 
DISTRIB_DESCRIPTION=&#34;Ubuntu 10.04.3 LTS&#34; 




Here is the test run results: 

[11:32:15] t/Blackjack/jira_client_bug.t .. 
# Fixture: everything 
1..10 
ok 1 - instantiated JIRA::Client isa JIRA::Client 
ok 2 - instantiated RemoteIssue isa RemoteIssue 
ok 3 - ... issue assignee is &#39;dbaber&#39; 
ok 4 - ... issue summary is &#39;TEST Ticket from Unit test&#39; 
ok 5 - ... issue project is &#39;TESTPROJECT&#39; 
ok 6 - ... issue type is &#39;7&#39; 
ok 7 - ... issue description is &#39;Test ticket to illustrate bug in JIRA::Client where the ticket type is not updated.&#39; 
ok 8 - ... issue summary after update is &#39;TEST Ticket from Unit test- UPDATED&#39; 
not ok 9 - ... issue type after update is &#39;1&#39; 


# Failed test &#39;... issue type after update is &#39;1&#39;&#39; 
# at t/Blackjack/jira_client_bug.t line 72. 
# got: &#39;7&#39; 
# expected: &#39;1&#39; 
ok 10 - ... issue description after update is &#39;UDATED - Test ticket to illustrate bug in JIRA::Client where the ticket type is not updated.&#39; 
Failed 1/10 subtests 
[11:32:26] 


Test Summary Report 
------------------- 
t/Blackjack/jira_client_bug.t &#40;Wstat: 0 Tests: 10 Failed: 1&#41; 
Failed test: 9 
Files=1, Tests=10, 11 wallclock secs &#40; 0.04 usr 0.00 sys + 0.47 cusr 0.05 csys = 0.56 CPU&#41; 
Result: FAIL 


And I have attached the code. 


Thanks, 
Dan 
-- 


Dan Baber | StreetLinks Lender Solutions | Software Developer 

365 N. Mayfair Road, Second Floor, Milwaukee, WI 53226 

www.streetlinks.com | dbaber@corvisa.com 







-- 


Dan Baber | StreetLinks Lender Solutions | Software Developer 

2365 N. Mayfair Road, Second Floor, Milwaukee, WI 53226 

www.streetlinks.com | dbaber@corvisa.com 
</div></div></div>
<div class="messageattachments">

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;17&nbsp;05:13:42&nbsp;2011</span>
    <span class="description">GNUSTAVO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #72470] AutoReply: Ticket type not updated when calling JIRA::Client::update_issue</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 17 Nov 2011 08:13:30 -0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-JIRA-Client [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gustavo Leite de Mendonça Chaves &lt;gnustavo [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">2011/11/16 Dan Baber via RT &lt;bug-JIRA-Client@rt.cpan.org&gt;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       Queue: JIRA-Client
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=72470">https://rt.cpan.org/Ticket/Display.html?id=72470</a></span> &gt;
&gt;
&gt; After mucking about in the guts of this module I think it is JIRA&#39;s SOAP
&gt; API itself that is not honoring changing the ticket type.
&gt;
</div>
Hi Dan.

Please, confirm that the &#34;Issue Type&#34; field is added to your edit screen.
If it&#39;s not this is precisely the behaviour you would see, as I understand
from this &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://forums.atlassian.com/thread.jspa?messageID=257314110">http://forums.atlassian.com/thread.jspa?messageID=257314110</a></span>&gt;.

--
Gustavo
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;17&nbsp;05:13:43&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;17&nbsp;10:16:06&nbsp;2011</span>
    <span class="description">dbaber [...] corvisa.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #72470] AutoReply: Ticket type not updated when calling JIRA::Client::update_issue</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 17 Nov 2011 15:15:52 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-JIRA-Client [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dan Baber &lt;dbaber [...] corvisa.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I can update the issue type for tickets using the account that our system creates the tickets as. That does not appear to be a problem for me. I see &#34;Issue Type&#34; on the edit screen and I am able to change it and save it. 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">----- Original Message -----
From: &#34;Gustavo Leite de Mendonça Chaves via RT&#34; &lt;bug-JIRA-Client@rt.cpan.org&gt; 
To: dbaber@corvisa.com 
Sent: Thursday, November 17, 2011 4:13:43 AM 
Subject: Re: [rt.cpan.org #72470] AutoReply: Ticket type not updated when calling JIRA::Client::update_issue 

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=72470">https://rt.cpan.org/Ticket/Display.html?id=72470</a></span> &gt; 

2011/11/16 Dan Baber via RT &lt;bug-JIRA-Client@rt.cpan.org&gt; 

<div class="message-stanza open">&gt; Queue: JIRA-Client 
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=72470">https://rt.cpan.org/Ticket/Display.html?id=72470</a></span> &gt; 
&gt; 
&gt; After mucking about in the guts of this module I think it is JIRA&#39;s SOAP 
&gt; API itself that is not honoring changing the ticket type. 
&gt; 
</div>
Hi Dan. 

Please, confirm that the &#34;Issue Type&#34; field is added to your edit screen. 
If it&#39;s not this is precisely the behaviour you would see, as I understand 
from this &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://forums.atlassian.com/thread.jspa?messageID=257314110">http://forums.atlassian.com/thread.jspa?messageID=257314110</a></span>&gt;. 

-- 
Gustavo 



-- 


Dan Baber | StreetLinks Lender Solutions | Software Developer 

2365 N. Mayfair Road, Second Floor, Milwaukee, WI 53226 

www.streetlinks.com | dbaber@corvisa.com 
</div></div></div>
<div class="messageattachments">

<div class="messagebody">
</div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;19&nbsp;15:42:07&nbsp;2011</span>
    <span class="description">GNUSTAVO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #72470] AutoReply: Ticket type not updated when calling JIRA::Client::update_issue</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 19 Nov 2011 18:41:57 -0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-JIRA-Client [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gustavo Leite de Mendonça Chaves &lt;gnustavo [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">2011/11/17 Dan Baber via RT &lt;bug-JIRA-Client@rt.cpan.org&gt;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       Queue: JIRA-Client
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=72470">https://rt.cpan.org/Ticket/Display.html?id=72470</a></span> &gt;
&gt;
&gt; I can update the issue type for tickets using the account that our system
&gt; creates the tickets as. That does not appear to be a problem for me. I see
&gt; &#34;Issue Type&#34; on the edit screen and I am able to change it and save it.
</div>

You&#39;re right.

I found out that this is due to this issue:
<span class="clickylink"><a target="new" rel="nofollow" href="https://jira.atlassian.com/browse/JRA-12300">https://jira.atlassian.com/browse/JRA-12300</a></span>.

Some fields in JIRA must be named one way when you set them but are named
otherwise when you get them from JIRA. I knew about &#34;affectVersions&#34; which
must be named &#34;versions&#34; when set and I had special code to deal with it in
JIRA::Client. Now I learned that &#34;type&#34; is another case. It must be named
&#34;issuetype&#34; when you set it. Try it.

I&#39;m going to generalize the code I have in JIRA::Client to deal with any
number of such cases. I don&#39;t know of any other, but there might be some
more.

I&#39;ll let you know when I release it.

Thank you for the report.

--
Gustavo.
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;19&nbsp;15:59:24&nbsp;2011</span>
    <span class="description">GNUSTAVO [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;19&nbsp;16:00:49&nbsp;2011</span>
    <span class="description">GNUSTAVO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dan, I&#39;ve just released JIRA::Client 0.31 which should solve the problem.

Now you can call the field &#39;type&#39; or &#39;issuetype&#39; and both should work.

The same problem affects the field &#39;affectVersions&#39; which can be called 
&#39;versions&#39; also.

Please, try it out.

Thanks.

Gustavo.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;19&nbsp;16:00:51&nbsp;2011</span>
    <span class="description">GNUSTAVO [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;21&nbsp;12:29:45&nbsp;2011</span>
    <span class="description">dbaber [...] corvisa.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #72470] Ticket type not updated when calling JIRA::Client::update_issue</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 21 Nov 2011 17:29:23 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-JIRA-Client [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dan Baber &lt;dbaber [...] corvisa.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Things seem to work except when trying to loop through the keys in my hash and compare values. My tests were failing because the input hash that was passed by reference got modified and the issue object did not contain the &#39;issuetype&#39; key &#40;I would assume you&#39;d have the same problem with the affectVersions -&gt; versions translation&#41;. The existing type key is also removed from the input params hash which caused failures. 


Test code snippet: 


&lt;snip&gt; 

my %update_attrs = &#40; 
type =&gt; &#39;Bug&#39;, 
summary =&gt; $attrs{summary} . &#34;- UPDATED&#34;, 
description =&gt; &#34;UDATED - &#34; . $attrs{description}, 
&#41;; 


$issue = $client-&gt;update_issue&#40; $issue, \%update_attrs &#41;; 


#say STDERR &#34;######DEBUG&gt; issue = &#34; . Dumper&#40; $issue &#41;; 
#say STDERR &#34;######DEBUG&gt; \%update_attrs = &#34; . Dumper&#40; \%update_attrs &#41;; 


foreach my $attr &#40; keys %update_attrs &#41; { 
is $issue-&gt;{$attr}, $update_attrs{$attr}, &#34;... issue $attr after update is &#39;$update_attrs{$attr}&#39;&#34;; 
} 


I made this modification to the code in Client.pm: 



--- Client.pm.old 2011-11-19 14:49:43.000000000 -0600 
+++ Client.pm 2011-11-21 11:27:52.946685770 -0600 
@@ -490,9 +490,9 @@ 

# Due to a bug in JIRA we have to substitute the names of some fields. 
foreach my $field &#40;keys %JRA12300&#41; { 
- if &#40;my $value = delete $params-&gt;{$field}&#41; { 
- $params-&gt;{$JRA12300{$field}} = $value; 
- } 
+ if &#40;my $value = $params-&gt;{$field}&#41; { 
+ $params-&gt;{$JRA12300{$field}} = $value; 
+ } 
} 

# Expand the custom_fields hash into the custom fields themselves. 
@@ -502,7 +502,14 @@ 
} 
} 

- return $self-&gt;updateIssue&#40;$key, $params&#41;; 
+ $issue = $self-&gt;updateIssue&#40;$key, $params&#41;; 
+ 
+ # Scrub renamed fields out of the input hash after update 
+ foreach my $key &#40; keys %JRA12300 &#41; { 
+ delete $params-&gt;{ $JRA12300{$key} }; 
+ } 
+ 
+ return $issue; 
} 

=item B&lt;get_issue_types&gt; 


so that my test code would pass. I was assuming that we don&#39;t want to modify the input hash on the calling code, do we? 


I attached the diff file as well. 


Dan 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">----- Original Message -----
From: &#34;Gustavo Leite de Mendonça Chaves via RT&#34; &lt;bug-JIRA-Client@rt.cpan.org&gt; 
To: dbaber@corvisa.com 
Sent: Saturday, November 19, 2011 3:00:50 PM 
Subject: [rt.cpan.org #72470] Ticket type not updated when calling JIRA::Client::update_issue 

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=72470">https://rt.cpan.org/Ticket/Display.html?id=72470</a></span> &gt; 

Dan, I&#39;ve just released JIRA::Client 0.31 which should solve the problem. 

Now you can call the field &#39;type&#39; or &#39;issuetype&#39; and both should work. 

The same problem affects the field &#39;affectVersions&#39; which can be called 
&#39;versions&#39; also. 

Please, try it out. 

Thanks. 

Gustavo. 



-- 


Dan Baber | StreetLinks Lender Solutions | Software Developer 

2365 N. Mayfair Road, Second Floor, Milwaukee, WI 53226 

www.streetlinks.com | dbaber@corvisa.com 
</div></div></div>
<div class="messageattachments">

<div class="messagebody">
</div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
</div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;21&nbsp;12:29:45&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;21&nbsp;13:04:05&nbsp;2011</span>
    <span class="description">dbaber [...] corvisa.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #72470] Ticket type not updated when calling JIRA::Client::update_issue</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 21 Nov 2011 18:03:43 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-JIRA-Client [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dan Baber &lt;dbaber [...] corvisa.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Or you can make a copy of the params and modify them to your heart&#39;s content? 



--- Client.pm.old 2011-11-19 14:49:43.000000000 -0600 
+++ Client.pm 2011-11-21 12:00:10.236134752 -0600 
@@ -471,38 +471,40 @@ 

my &#40;$project&#41; = &#40;$key =~ /^&#40;[^-]+&#41;/&#41;; 

+ my $params_copy = { %$params }; 
+ 
# Convert some fields&#39; values 
- foreach my $field &#40;grep {exists $_converters{$_}} keys %$params&#41; { 
- $_converters{$field}-&gt;&#40;$self, $params, $field, $project&#41;; 
+ foreach my $field &#40;grep {exists $_converters{$_}} keys %$params_copy&#41; { 
+ $_converters{$field}-&gt;&#40;$self, $params_copy, $field, $project&#41;; 
} 

# Convert RemoteComponent objects into component ids 
- if &#40;my $comps = $params-&gt;{components}&#41; { 
+ if &#40;my $comps = $params_copy-&gt;{components}&#41; { 
$_ = $_-&gt;{id} foreach @$comps; 
} 

# Convert RemoteVersion objects into version ids 
for my $field &#40;qw/fixVersions affectsVersions/&#41; { 
- if &#40;my $versions = $params-&gt;{$field}&#41; { 
+ if &#40;my $versions = $params_copy-&gt;{$field}&#41; { 
$_ = $_-&gt;{id} foreach @$versions; 
} 
} 

# Due to a bug in JIRA we have to substitute the names of some fields. 
foreach my $field &#40;keys %JRA12300&#41; { 
- if &#40;my $value = delete $params-&gt;{$field}&#41; { 
- $params-&gt;{$JRA12300{$field}} = $value; 
- } 
+ if &#40;my $value = $params_copy-&gt;{$field}&#41; { 
+ $params_copy-&gt;{$JRA12300{$field}} = $value; 
+ } 
} 

# Expand the custom_fields hash into the custom fields themselves. 
- if &#40;my $custom_fields = delete $params-&gt;{custom_fields}&#41; { 
+ if &#40;my $custom_fields = delete $params_copy-&gt;{custom_fields}&#41; { 
while &#40;my &#40;$id, $values&#41; = each %$custom_fields&#41; { 
- $params-&gt;{$id} = $values; 
+ $params_copy-&gt;{$id} = $values; 
} 
} 

- return $self-&gt;updateIssue&#40;$key, $params&#41;; 
+ return $self-&gt;updateIssue&#40;$key, $params_copy&#41;; 
} 

=item B&lt;get_issue_types&gt; 




I had to fix the mapping in my test code because 1 != &#39;Bug&#39;: 



my %update_attrs = &#40; 
type =&gt; &#39;Bug&#39;, 
summary =&gt; $attrs{summary} . &#34;- UPDATED&#34;, 
description =&gt; &#34;UDATED - &#34; . $attrs{description}, 
&#41;; 


$issue = $client-&gt;update_issue&#40; $issue, \%update_attrs &#41;; 


#say STDERR &#34;######DEBUG&gt; issue = &#34; . Dumper&#40; $issue &#41;; 
#say STDERR &#34;######DEBUG&gt; \%update_attrs = &#34; . Dumper&#40; \%update_attrs &#41;; 


foreach my $attr &#40; keys %update_attrs &#41; { 
my $val = $issue-&gt;{$attr}; 
$val = $TYPES-&gt;{ $issue-&gt;{$attr} } if $attr =~ /type/; 


is $val, $update_attrs{$attr}, &#34;... issue $attr after update is &#39;$update_attrs{$attr}&#39;&#34;; 
} 




Either way works I guess. I don&#39;t know if your intention is to not modify the input hash or what. 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">----- Original Message -----
From: &#34;Gustavo Leite de Mendonça Chaves via RT&#34; &lt;bug-JIRA-Client@rt.cpan.org&gt; 
To: dbaber@corvisa.com 
Sent: Saturday, November 19, 2011 3:00:50 PM 
Subject: [rt.cpan.org #72470] Ticket type not updated when calling JIRA::Client::update_issue 

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=72470">https://rt.cpan.org/Ticket/Display.html?id=72470</a></span> &gt; 

Dan, I&#39;ve just released JIRA::Client 0.31 which should solve the problem. 

Now you can call the field &#39;type&#39; or &#39;issuetype&#39; and both should work. 

The same problem affects the field &#39;affectVersions&#39; which can be called 
&#39;versions&#39; also. 

Please, try it out. 

Thanks. 

Gustavo. 



-- 


Dan Baber | StreetLinks Lender Solutions | Software Developer 

2365 N. Mayfair Road, Second Floor, Milwaukee, WI 53226 

www.streetlinks.com | dbaber@corvisa.com 
</div></div></div>
<div class="messageattachments">

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
</div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;21&nbsp;20:50:37&nbsp;2011</span>
    <span class="description">GNUSTAVO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #72470] Ticket type not updated when calling JIRA::Client::update_issue</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 21 Nov 2011 23:50:21 -0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-JIRA-Client [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gustavo Leite de Mendonça Chaves &lt;gnustavo [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">2011/11/21 Dan Baber via RT &lt;bug-JIRA-Client@rt.cpan.org&gt;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       Queue: JIRA-Client
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=72470">https://rt.cpan.org/Ticket/Display.html?id=72470</a></span> &gt;
&gt;
&gt; Things seem to work except when trying to loop through the keys in my hash
&gt; and compare values. My tests were failing because the input hash that was
&gt; passed by reference got modified and the issue object did not contain the
&gt; &#39;issuetype&#39; key &#40;I would assume you&#39;d have the same problem with the
&gt; affectVersions -&gt; versions translation&#41;. The existing type key is also
&gt; removed from the input params hash which caused failures.
&gt;
</div>
I see. I have to confess that I&#39;ve never given a second thought to the need
to preserve the hash&#39;s keys. The hash&#39;s values must be modified but I can
see value in preserving the hash&#39;s keys.

Please, tell me what you thing of the attached patch. It tries to preserve
the params hash&#39;s keys in the functions create_issue, update_issue,
and progress_workflow_action_safely. It also documents the need to modify
the hash&#39;s values and the preservation of its keys.

If it&#39;s good I&#39;ll make another release.

Thank you.

Gustavo.
</div></div>

<div class="messagebody">
</div>
</div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;22&nbsp;11:14:12&nbsp;2011</span>
    <span class="description">dbaber [...] corvisa.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #72470] Ticket type not updated when calling JIRA::Client::update_issue</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 22 Nov 2011 16:13:57 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-JIRA-Client [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dan Baber &lt;dbaber [...] corvisa.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">You know the more I think about it the more I say we stick w/ what&#39;s in 0.31 and I can just pass a copy of my hash in like so { %hash } because all your docs say pass a literal hashref w/ the proper key/val pairs. Besides, this patch doesn&#39;t work for create_issue ;P. I got a SOAP error back from the server complaining about issuetype which I worked around by just commenting out the 2 foreach loops. Let&#39;s just go with 0.31 and not bother hacking anything else. 

Dan 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">----- Original Message -----
From: &#34;Gustavo Leite de Mendonça Chaves via RT&#34; &lt;bug-JIRA-Client@rt.cpan.org&gt; 
To: dbaber@corvisa.com 
Sent: Monday, November 21, 2011 7:50:37 PM 
Subject: Re: [rt.cpan.org #72470] Ticket type not updated when calling JIRA::Client::update_issue 

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=72470">https://rt.cpan.org/Ticket/Display.html?id=72470</a></span> &gt; 

2011/11/21 Dan Baber via RT &lt;bug-JIRA-Client@rt.cpan.org&gt; 

<div class="message-stanza open">&gt; Queue: JIRA-Client 
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=72470">https://rt.cpan.org/Ticket/Display.html?id=72470</a></span> &gt; 
&gt; 
&gt; Things seem to work except when trying to loop through the keys in my hash 
&gt; and compare values. My tests were failing because the input hash that was 
&gt; passed by reference got modified and the issue object did not contain the 
&gt; &#39;issuetype&#39; key &#40;I would assume you&#39;d have the same problem with the 
&gt; affectVersions -&gt; versions translation&#41;. The existing type key is also 
&gt; removed from the input params hash which caused failures. 
&gt; 
</div>
I see. I have to confess that I&#39;ve never given a second thought to the need 
to preserve the hash&#39;s keys. The hash&#39;s values must be modified but I can 
see value in preserving the hash&#39;s keys. 

Please, tell me what you thing of the attached patch. It tries to preserve 
the params hash&#39;s keys in the functions create_issue, update_issue, 
and progress_workflow_action_safely. It also documents the need to modify 
the hash&#39;s values and the preservation of its keys. 

If it&#39;s good I&#39;ll make another release. 

Thank you. 

Gustavo. 



[Text Documents:Client.pm.patch] 


-- 


Dan Baber | StreetLinks Lender Solutions | Software Developer 

2365 N. Mayfair Road, Second Floor, Milwaukee, WI 53226 

www.streetlinks.com | dbaber@corvisa.com 
</div></div></div>
<div class="messageattachments">

<div class="messagebody">
</div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/lib/JIRA/Client.pm b/lib/JIRA/Client.pm
index e3ed635..75d0df3 100644
--- a/lib/JIRA/Client.pm
+++ b/lib/JIRA/Client.pm
@@ -400,50 +400,69 @@ You can do it like this:
 
     {customfield_10011 =&gt; {&#39;0&#39; =&gt; 10031, &#39;1&#39; =&gt; 10188}},
 
+Note that the hash&#39;s values will be modified to make them comply to
+JIRA&#39;s data requirements. However, the hash&#39;s keys will be preserved.
 
 =cut
 
 sub create_issue
 {
-    my &#40;$self, $hash, $seclevel&#41; = @_;
+    my &#40;$self, $params, $seclevel&#41; = @_;
     croak &#34;create_issue requires an argument.\n&#34;
-        unless defined $hash;
+        unless defined $params;
     croak &#34;create_issue&#39;s argument must be a HASH ref.\n&#34;
-        unless ref $hash &#38;&#38; ref $hash eq &#39;HASH&#39;;
+        unless ref $params &#38;&#38; ref $params eq &#39;HASH&#39;;
     for my $field &#40;qw/project summary type/&#41; {
         croak &#34;create_issue&#39;s HASH ref must define a &#39;$field&#39;.\n&#34;
-            unless exists $hash-&gt;{$field};
+            unless exists $params-&gt;{$field};
     }
 
     # Convert some fields&#39; values
-    foreach my $field &#40;grep {exists $_converters{$_}} keys %$hash&#41; {
-       $_converters{$field}-&gt;&#40;$self, $hash, $field, $hash-&gt;{project}&#41;;
+    foreach my $field &#40;grep {exists $_converters{$_}} keys %$params&#41; {
+       $_converters{$field}-&gt;&#40;$self, $params, $field, $params-&gt;{project}&#41;;
     }
 
     # Substitute customFieldValues for custom_fields
-    if &#40;my $cfs = delete $hash-&gt;{custom_fields}&#41; {
-        $hash-&gt;{customFieldValues} = [map {RemoteCustomFieldValue-&gt;new&#40;$_, $cfs-&gt;{$_}&#41;} keys %$cfs];
+    if &#40;my $cfs = delete $params-&gt;{custom_fields}&#41; {
+        $params-&gt;{customFieldValues} = [map {RemoteCustomFieldValue-&gt;new&#40;$_, $cfs-&gt;{$_}&#41;} keys %$cfs];
+    }
+
+    # Due to a bug in JIRA we have to substitute the names of some fields.
+    foreach my $field &#40;grep {exists $params-&gt;{$_}} keys %JRA12300&#41; {
+       $params-&gt;{$JRA12300{$field}} = delete $params-&gt;{$field};
     }
 
-    if &#40;my $parent = delete $hash-&gt;{parent}&#41; {
+    my $issue;
+
+    if &#40;my $parent = delete $params-&gt;{parent}&#41; {
        if &#40;defined $seclevel&#41; {
-           return $self-&gt;createIssueWithParentWithSecurityLevel&#40;$hash, _convert_security_level&#40;$self, $parent, $seclevel&#41;&#41;;
+           $issue = $self-&gt;createIssueWithParentWithSecurityLevel&#40;$params, _convert_security_level&#40;$self, $parent, $seclevel&#41;&#41;;
        } else {
-           return $self-&gt;createIssueWithParent&#40;$hash, $parent&#41;;
+           $issue = $self-&gt;createIssueWithParent&#40;$params, $parent&#41;;
        }
     } else {
        if &#40;defined $seclevel&#41; {
-           return $self-&gt;createIssueWithSecurityLevel&#40;$hash, _convert_security_level&#40;$self, $seclevel&#41;&#41;;
+           $issue = $self-&gt;createIssueWithSecurityLevel&#40;$params, _convert_security_level&#40;$self, $seclevel&#41;&#41;;
        } else {
-           return $self-&gt;createIssue&#40;$hash&#41;;
+           $issue = $self-&gt;createIssue&#40;$params&#41;;
        }
     }
+
+    # Restore substituted field names in hash passed by reference
+    foreach my $field &#40;grep {exists $params-&gt;{$_}} keys %JRA12300_backwards&#41; {
+       $params-&gt;{$JRA12300_backwards{$field}} = delete $params-&gt;{$field};
+    }
+
+    return $issue;
 }
 
 =item B&lt;update_issue&gt; ISSUE_OR_KEY, HASH_REF
 
 Update a issue given a hash containing the values for its fields. The
-first argument may be an issue key or a RemoteIssue object.
+first argument may be an issue key or a RemoteIssue object. The second
+argument must be a hash-ref specifying the fields&#39;s values just like
+documented in the create_issue function above. In particular, note
+that its values will be modified, but not its keys.
 
 This is an easier to use version of the updateIssue API method because
 it accepts the same shortcuts that create_issue does.
@@ -489,10 +508,8 @@ sub update_issue
     }
 
     # Due to a bug in JIRA we have to substitute the names of some fields.
-    foreach my $field &#40;keys %JRA12300&#41; {
-       if &#40;my $value = delete $params-&gt;{$field}&#41; {
-           $params-&gt;{$JRA12300{$field}} = $value;
-       }
+    foreach my $field &#40;grep {exists $params-&gt;{$_}} keys %JRA12300&#41; {
+       $params-&gt;{$JRA12300{$field}} = delete $params-&gt;{$field};
     }
 
     # Expand the custom_fields hash into the custom fields themselves.
@@ -502,7 +519,14 @@ sub update_issue
         }
     }
 
-    return $self-&gt;updateIssue&#40;$key, $params&#41;;
+    $issue = $self-&gt;updateIssue&#40;$key, $params&#41;;
+
+    # Restore substituted field names in hash passed by reference
+    foreach my $field &#40;grep {exists $params-&gt;{$_}} keys %JRA12300_backwards&#41; {
+       $params-&gt;{$JRA12300_backwards{$field}} = delete $params-&gt;{$field};
+    }
+
+    return $issue;
 }
 
 =item B&lt;get_issue_types&gt;
@@ -760,8 +784,9 @@ returned by a previous call to, e.g., C&lt;getIssue&gt;.
 =item C&lt;ACTION&gt; can be either an action I&lt;id&gt; or an action I&lt;name&gt;.
 
 =item C&lt;PARAMS&gt; must be a hash mapping field names to field
-values. This hash accepts the same shortcuts as the argument to
-B&lt;create_issue&gt;.
+values. This hash is treated in the same way as the hash passed to the
+function B&lt;create_issue&gt; above. In particular, note that its values
+will be modified, but not its keys.
 
 =back
 
@@ -780,11 +805,15 @@ And risking to forget to pass some field you can do this:
 =cut
 
 sub progress_workflow_action_safely {
-    my &#40;$self, $key, $action, $params&#41; = @_;
-    my $issue;
-    if &#40;ref $key&#41; {
-        $issue = $key;
+    my &#40;$self, $issue, $action, $params&#41; = @_;
+    my $key;
+    if &#40;ref $issue&#41; {
+       croak &#34;progress_workflow_action_safely&#39;s first argument must be a RemoteIssue reference.\n&#34;
+           unless ref $key eq &#39;RemoteIssue&#39;;
         $key   = $issue-&gt;{key};
+    } else {
+       $key   = $issue;
+       $issue = undef;
     }
     my &#40;$project&#41; = &#40;split /-/, $key&#41;[0];
     $params = {} unless defined $params;
@@ -846,10 +875,8 @@ sub progress_workflow_action_safely {
     }
 
     # Due to a bug in JIRA we have to substitute the names of some fields.
-    foreach my $field &#40;keys %JRA12300&#41; {
-       if &#40;my $value = delete $params-&gt;{$field}&#41; {
-           $params-&gt;{$JRA12300{$field}} = $value;
-       }
+    foreach my $field &#40;grep {exists $params-&gt;{$_}} keys %JRA12300&#41; {
+       $params-&gt;{$JRA12300{$field}} = delete $params-&gt;{$field};
     }
 
     # Expand the custom_fields hash into the custom fields themselves.
@@ -859,7 +886,14 @@ sub progress_workflow_action_safely {
         }
     }
 
-    return $self-&gt;progressWorkflowAction&#40;$key, $action, $params&#41;;
+    $issue = $self-&gt;progressWorkflowAction&#40;$key, $action, $params&#41;;
+
+    # Restore substituted field names in hash passed by reference
+    foreach my $field &#40;grep {exists $params-&gt;{$_}} keys %JRA12300_backwards&#41; {
+       $params-&gt;{$JRA12300_backwards{$field}} = delete $params-&gt;{$field};
+    }
+
+    return $issue;
 }
 
 =item B&lt;get_issue_custom_field_values&gt; ISSUE, NAME_OR_IDs
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;25&nbsp;21:51:23&nbsp;2011</span>
    <span class="description">GNUSTAVO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #72470] Ticket type not updated when calling JIRA::Client::update_issue</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 26 Nov 2011 00:51:12 -0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-JIRA-Client [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gustavo Leite de Mendonça Chaves &lt;gnustavo [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">2011/11/22 Dan Baber via RT &lt;bug-JIRA-Client@rt.cpan.org&gt;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: JIRA-Client
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=72470">https://rt.cpan.org/Ticket/Display.html?id=72470</a></span> &gt;
&gt;
&gt; You know the more I think about it the more I say we stick w/ what&#39;s in
&gt; 0.31 and I can just pass a copy of my hash in like so { %hash } because all
&gt; your docs say pass a literal hashref w/ the proper key/val pairs. Besides,
&gt; this patch doesn&#39;t work for create_issue ;P. I got a SOAP error back from
&gt; the server complaining about issuetype which I worked around by just
&gt; commenting out the 2 foreach loops. Let&#39;s just go with 0.31 and not bother
&gt; hacking anything else.
&gt;
</div>
Not so fast. :-&#41;

I performed a serious refactoring in all the conversion code necessary for
create_issue, update_issue and progress_workflow_action_safely. I tested it
agains Atlassian&#39;s OnDemand JIRA Demo &#40;
<span class="clickylink"><a target="new" rel="nofollow" href="http://sandbox.onjira.com/browse/TST-2551&#41;">http://sandbox.onjira.com/browse/TST-2551&#41;</a></span> and I was able to create and to
progress an issue correctly.

The hashes passed to those three methods are completely preserved now. I
decided to construct new ones instead of performing the necessary
conversions in the argument. This makes the code cleaner and is saner to
the programmer, I guess.

Would you care to check it one more time?

I&#39;m attaching the file and not the patch because the later is half the size
of the former.

--
Gustavo.
</div></div>

<div class="messagebody">
</div>
</div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;28&nbsp;11:31:40&nbsp;2011</span>
    <span class="description">dbaber [...] corvisa.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #72470] Ticket type not updated when calling JIRA::Client::update_issue</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 28 Nov 2011 16:31:24 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-JIRA-Client [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dan Baber &lt;dbaber [...] corvisa.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have no idea how this works for you, there was an infinite loop in _convert_params: 


# Convert fields&#39; values 
while &#40;my &#40;$field, $value&#41; = %$params&#41; { 
$converted{$field} = 
exists $_converters{$field} 
? $_converters{$field}-&gt;&#40;$self, $value, $project&#41; 
: $value; 
} 

I changed it to &#40;added each before the %$params&#41;: 


# Convert fields&#39; values 
while &#40;my &#40;$field, $value&#41; = each %$params&#41; { 
$converted{$field} = 
exists $_converters{$field} 
? $_converters{$field}-&gt;&#40;$self, $value, $project&#41; 
: $value; 
} 
and JIRA still yells at me w/ this error: 

soapenv:Server.userException, org.xml.sax.SAXException: Invalid element in com.atlassian.jira.rpc.soap.beans.RemoteIssue - issuetype at /home/dbaber/src/blackjack/script/../lib/Blackjack/JIRA.pm line 373 
soapenv:Server.userException, org.xml.sax.SAXException: Invalid element in com.atlassian.jira.rpc.soap.beans.RemoteIssue - issuetype at /home/dbaber/src/blackjack/script/../lib/Blackjack/JIRA.pm line 373 
...caught at /home/dbaber/src/blackjack/script/../lib/Persistent/Blackjack.pm line 156. 

I am not getting the same result&#40;s&#41; as you are. 

Dan ----- Original Message -----
From: &#34;Gustavo Leite de Mendonça Chaves via RT&#34; &lt;bug-JIRA-Client@rt.cpan.org&gt; 
To: dbaber@corvisa.com 
Sent: Friday, November 25, 2011 8:51:24 PM 
Subject: Re: [rt.cpan.org #72470] Ticket type not updated when calling JIRA::Client::update_issue 

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=72470">https://rt.cpan.org/Ticket/Display.html?id=72470</a></span> &gt; 

2011/11/22 Dan Baber via RT &lt;bug-JIRA-Client@rt.cpan.org&gt; 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Queue: JIRA-Client 
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=72470">https://rt.cpan.org/Ticket/Display.html?id=72470</a></span> &gt; 
&gt; 
&gt; You know the more I think about it the more I say we stick w/ what&#39;s in 
&gt; 0.31 and I can just pass a copy of my hash in like so { %hash } because all 
&gt; your docs say pass a literal hashref w/ the proper key/val pairs. Besides, 
&gt; this patch doesn&#39;t work for create_issue ;P. I got a SOAP error back from 
&gt; the server complaining about issuetype which I worked around by just 
&gt; commenting out the 2 foreach loops. Let&#39;s just go with 0.31 and not bother 
&gt; hacking anything else. 
&gt; 
</div>
Not so fast. :-&#41; 

I performed a serious refactoring in all the conversion code necessary for 
create_issue, update_issue and progress_workflow_action_safely. I tested it 
agains Atlassian&#39;s OnDemand JIRA Demo &#40; 
<span class="clickylink"><a target="new" rel="nofollow" href="http://sandbox.onjira.com/browse/TST-2551&#41;">http://sandbox.onjira.com/browse/TST-2551&#41;</a></span> and I was able to create and to 
progress an issue correctly. 

The hashes passed to those three methods are completely preserved now. I 
decided to construct new ones instead of performing the necessary 
conversions in the argument. This makes the code cleaner and is saner to 
the programmer, I guess. 

Would you care to check it one more time? 

I&#39;m attaching the file and not the patch because the later is half the size 
of the former. 

-- 
Gustavo. 



-- 


Dan Baber | StreetLinks Lender Solutions | Software Developer 

2365 N. Mayfair Road, Second Floor, Milwaukee, WI 53226 

www.streetlinks.com | dbaber@corvisa.com 
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;29&nbsp;20:10:26&nbsp;2011</span>
    <span class="description">GNUSTAVO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #72470] Ticket type not updated when calling JIRA::Client::update_issue</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 29 Nov 2011 23:10:15 -0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-JIRA-Client [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gustavo Leite de Mendonça Chaves &lt;gnustavo [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">2011/11/28 Dan Baber via RT &lt;bug-JIRA-Client@rt.cpan.org&gt;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       Queue: JIRA-Client
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=72470">https://rt.cpan.org/Ticket/Display.html?id=72470</a></span> &gt;
&gt;
&gt; I have no idea how this works for you, there was an infinite loop in
&gt; _convert_params:
&gt;
</div>
I&#39;m sorry. I think I got caught again by the prove command. I tend to
forget to pass the -b option to it and then it uses the installed
JIRA::Client in my system in the tests.

I saw the missing &#39;each&#39; but there are other errors. It seems that the
field name convertion must be performed when calling updateIssue and
progressWorkflowAction but not on createIssue.

I&#39;ll check and work on this over the weekend.

Thank you.

BTW, I saw your other ticket &#40;rt72667&#41; and fixed it in my git repository.
I&#39;ll try to have them both fixed for the next release.

Gustavo.
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;05&nbsp;20:22:24&nbsp;2011</span>
    <span class="description">GNUSTAVO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #72470] Ticket type not updated when calling JIRA::Client::update_issue</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 5 Dec 2011 23:22:14 -0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-JIRA-Client [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gustavo Leite de Mendonça Chaves &lt;gnustavo [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dan, I&#39;ve just released JIRA::Client 0.32. It should fix both
rt72470&lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=72470">https://rt.cpan.org/Public/Bug/Display.html?id=72470</a></span>&gt;
 and rt72667 &lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=72667">https://rt.cpan.org/Ticket/Display.html?id=72667</a></span>&gt;. Please,
give it a try.

Gustavo.
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;05&nbsp;20:24:44&nbsp;2011</span>
    <span class="description">GNUSTAVO [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;06&nbsp;13:09:47&nbsp;2011</span>
    <span class="description">dbaber [...] corvisa.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #72470] Ticket type not updated when calling JIRA::Client::update_issue</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 6 Dec 2011 18:09:32 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-JIRA-Client [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dan Baber &lt;dbaber [...] corvisa.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Everything seems to be working accept update_issue was failing w/ 


# soapenv:Server.userException, org.xml.sax.SAXException: SimpleDeserializer encountered a child element, which is NOT expected, in something it was trying to deserialize. 


I did some digging and the affectsVersion was not being flattened until I changed this in _flaten_components_and_versions&#40;&#41;: 




--- Client.pm.orig 2011-12-06 12:04:54.616137832 -0600 
+++ Client.pm 2011-12-06 12:09:39.036977299 -0600 
@@ -388,7 +388,7 @@ 
my &#40;$params&#41; = @_; 

# Flaten Component and Version fields 
- for my $field &#40;grep {exists $params-&gt;{$_}} qw/components versions fixVersions/&#41; { 
+ for my $field &#40;grep {exists $params-&gt;{$_}} qw/components affectsVersions fixVersions/&#41; { 
$params-&gt;{$field} = [map {$_-&gt;{id}} @{$params-&gt;{$field}}]; 
} 


This gets changed to &#39;versions&#39; a few lines after that when you do the JRA12300 field name conversion. 


Dan ----- Original Message -----
From: &#34;Gustavo Leite de Mendonça Chaves via RT&#34; &lt;bug-JIRA-Client@rt.cpan.org&gt; 
To: dbaber@corvisa.com 
Sent: Monday, December 5, 2011 7:22:24 PM 
Subject: Re: [rt.cpan.org #72470] Ticket type not updated when calling JIRA::Client::update_issue 

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=72470">https://rt.cpan.org/Ticket/Display.html?id=72470</a></span> &gt; 

Dan, I&#39;ve just released JIRA::Client 0.32. It should fix both 
rt72470&lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=72470">https://rt.cpan.org/Public/Bug/Display.html?id=72470</a></span>&gt; 
and rt72667 &lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=72667">https://rt.cpan.org/Ticket/Display.html?id=72667</a></span>&gt;. Please, 
give it a try. 

Gustavo. 



-- 


Dan Baber | StreetLinks Lender Solutions | Software Developer 

2365 N. Mayfair Road, Second Floor, Milwaukee, WI 53226 

www.streetlinks.com | dbaber@corvisa.com 
</div></div>
<div class="messageattachments">

<div class="messagebody">
</div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;06&nbsp;13:09:48&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;06&nbsp;16:46:44&nbsp;2011</span>
    <span class="description">GNUSTAVO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #72470] Ticket type not updated when calling JIRA::Client::update_issue</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 6 Dec 2011 19:46:35 -0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-JIRA-Client [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gustavo Leite de Mendonça Chaves &lt;gnustavo [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">2011/12/6 Dan Baber via RT &lt;bug-JIRA-Client@rt.cpan.org&gt;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       Queue: JIRA-Client
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=72470">https://rt.cpan.org/Ticket/Display.html?id=72470</a></span> &gt;
&gt;
&gt; Everything seems to be working accept update_issue was failing w/
&gt;
&gt;
&gt; # soapenv:Server.userException, org.xml.sax.SAXException:
&gt; SimpleDeserializer encountered a child element, which is NOT expected, in
&gt; something it was trying to deserialize.
&gt;
&gt; I did some digging and the affectsVersion was not being flattened until I
&gt; changed this in _flaten_components_and_versions&#40;&#41;:
&gt;
</div>
Thank you, Dan.

I&#39;ll fix this in a new release, hopefully with a solution to the duedate
problem too.

Gustavo.
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;18&nbsp;09:51:42&nbsp;2012</span>
    <span class="description">GNUSTAVO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixed in v0.33.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;18&nbsp;09:51:43&nbsp;2012</span>
    <span class="description">GNUSTAVO [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
