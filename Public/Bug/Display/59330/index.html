<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #59330 for Net-IMAP-Simple: possible bug in _process_flags&#40;&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #59330 for Net-IMAP-Simple: possible bug in _process_flags&#40;&#41;</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-IMAP-Simple/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-IMAP-Simple/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-IMAP-Simple/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-IMAP-Simple/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-IMAP-Simple">Net-IMAP-Simple CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">59330</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-IMAP-Simple/Active/">Net-IMAP-Simple</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
hawkexploretalent [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-22730-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-22731-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;13&nbsp;18:15:15&nbsp;2010</span>
    <span class="description">hawkexploretalent [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> possible bug in _process_flags&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 13 Jul 2010 15:15:05 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-IMAP-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Hawk ExploreTalent &lt;hawkexploretalent [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Greetings Mr. Miller &#40;or whoever is maintaining this package&#41;,

I&#39;m working on a project to migrate email from one server to another using
IMAP.  In my loop, my Perl script reads messages one at a time from the
source server and checks to see if the message is on the target server &#40;just
the headers&#41;.

If the message isn&#39;t found on the target server, then the message flags are
pulled and the message is copied to the target server.  During the operation
which reads the message flags from the source server, I get an error like
this:

GLOB&#40;0xa34030&#41;2010-07-13 13:57:31 unable to get flags for source msg #2:
warning unknown return string &#40;id=174&#41;: &#41;

There are two messages in this box, and all works well if I don&#39;t pull the
flags.  However, I&#39;m trying to maintain the seen/unseen nature of each
message so that the script can be run as many times as necessary to get all
the email migrated over and keep the read/unread state of each message.

In the source code for Net::IMAP::Simple.pl, the sub _process_flags calls
shift for $self as the first action &#40;from @_ presumably&#41;, but $self is never
passed to _process_flags when it&#39;s called from elsewhere, such as from the
sub msg_flags.  Is this right?

-Hawk

sub _process_flags {
    my $self = shift;

    return grep { m/^\\\w+\z/ }
            map { split m/\s+/, $_ }
            @_;
}

sub msg_flags {
    my &#40; $self, $number &#41; = @_;

    my @flags;
    $self-&gt;{_waserr} = 1; # assume something went wrong.

    #  _send_cmd] 15 FETCH 12 &#40;FLAGS&#41;\r\n
    #  _process_cmd] * 12 FETCH &#40;FLAGS &#40;\Seen&#41;&#41;\r\n
    #  _cmd_ok] * 12 FETCH &#40;FLAGS &#40;\Seen&#41;&#41;\r\n
    #  _seterrstr] warning unknown return string &#40;id=15&#41;: * 12 FETCH
&#40;FLAGS &#40;\Seen&#41;&#41;\r\n
    #  _process_cmd] 15 OK Success\r\n

    return $self-&gt;_process_cmd&#40;
        cmd =&gt; [ FETCH =&gt; qq[$number &#40;FLAGS&#41;] ],
        final =&gt; sub {
            return if $self-&gt;{_waserr};
            wantarray ? @flags : &#34;@flags&#34;;
        },
        process =&gt; sub {
            if&#40; $_[0] =~ m/\* $number FETCH \&#40;FLAGS \&#40;&#40;[^&#40;&#41;]+?&#41;\&#41;\&#41;/i &#41; {
                @flags = $self-&gt;_process_flags&#40;$1&#41;;
                delete $self-&gt;{_waserr};
            }
        },
    &#41;;
}
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;13&nbsp;19:26:34&nbsp;2010</span>
    <span class="description">jettero [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #59330] possible bug in _process_flags&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 13 Jul 2010 19:26:24 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-IMAP-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Paul Miller &lt;jettero [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, Jul 13, 2010 at 6:15 PM, Hawk ExploreTalent via RT
&lt;bug-Net-IMAP-Simple@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Greetings Mr. Miller &#40;or whoever is maintaining this package&#41;,
</div>
It&#39;s me!!



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m working on a project to migrate email from one server to another using
&gt; IMAP.  In my loop, my Perl script reads messages one at a time from the
&gt; source server and checks to see if the message is on the target server &#40;just
&gt; the headers&#41;.
</div>
I do this too.

my @flags = $server1-&gt;msg_flags&#40;$msg_number&#41;;
my $msg   = $server1-&gt;get&#40;$msg_number&#41;;

# many boring things

$server2-&gt;put&#40; ux =&gt; $msg, @flags &#41;;



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; GLOB&#40;0xa34030&#41;2010-07-13 13:57:31 unable to get flags for source msg #2:
&gt; warning unknown return string &#40;id=174&#41;: &#41;
</div>
I&#39;m not totally sure what&#39;s going on here.  If it&#39;s possible, please
paste the relevant log lines &#40;just the relevant ones please&#41; into the
ticket.

I inherited this module in a state that generates a great deal of
spurious warnings and errors that ... apparently don&#39;t affect
behavior.  I constructed quite a few tests -- by no means complete,
but quite a few -- to ensure that most things work correctly, but I
haven&#39;t really spent any energy hunting down those errors.  They seem
to be part of it&#39;s correct functioning.

That said, if you&#39;re not getting the flags you expect, I want to dig
into it lickety split!!

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In the source code for Net::IMAP::Simple.pl, the sub _process_flags calls
&gt; shift for $self as the first action &#40;from @_ presumably&#41;, but $self is never
&gt; passed to _process_flags when it&#39;s called from elsewhere, such as from the
&gt; sub msg_flags.  Is this right?
</div>
It&#39;s probably right.  I didn&#39;t look very carefully, but it seems to
work and didn&#39;t look wrong to me.   Check the &#34;perldoc perlboot&#34; pages
for details on this... but basically:

ClassName-&gt;afunction&#40;&#34;arg&#34;&#41;;
$instance-&gt;afunction&#40;&#34;arg&#34;&#41;;
afunction&#40;&#34;arg&#34;&#41;;

sub afunction {
    my &#40;$self, $arg&#41; = @_;
   # &#40;&#34;ClassName&#34;, &#34;arg&#34;&#41; for a class,
   # &#40;$instance, &#34;arg&#34;&#41; for instance.
   # &#40;&#34;arg&#34;, undef&#41; for the naked function call
}

-- 
If riding in an airplane is flying, then riding in a boat is swimming.
115 jumps, 47.9 minutes of freefall, 91.6 freefall miles.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;13&nbsp;19:26:35&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;13&nbsp;20:43:22&nbsp;2010</span>
    <span class="description">hawkexploretalent [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #59330] possible bug in _process_flags&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 13 Jul 2010 17:43:10 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-IMAP-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Hawk ExploreTalent &lt;hawkexploretalent [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;15&nbsp;11:32:33&nbsp;2010</span>
    <span class="description">jettero [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m glad I thought to check RT today.  I didn&#39;t receive an email
from RT either due to the size of the message &#40;which it seems to
object to&#41; or due to spam filtering.  Who knows.


On Tue Jul 13 20:43:22 2010, hawkexploretalent@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Okay...  I&#39;m going round and round here with this thing.  It
&gt; seems if I query message flags, then things go wierd.  If I
&gt; skip the flags, all messages which were read are marked &#34;seen&#34;
&gt; &#40;which is not what I want&#41;, and all messages which are copied
&gt; to the new server are marked &#34;unseen&#34; or &#34;new&#34; or &#34;unread&#34;, and
&gt; this is not what I want unless it was marked that way in the
&gt; original server.
</div>
I think I&#39;m seeing in the log file you attached that you actually
set seen explicitly.  The log formatting is a little messed up
though.  Perhaps you could send an email to me directly with the
log file and sources attached?

Perhaps not the whole program, but preferably a smallish example
that produces the problem?

--
If riding in an airplane is flying, then riding in a boat is swimming.
116 jumps, 48.6 minutes of freefall, 92.9 freefall miles.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;15&nbsp;11:40:05&nbsp;2010</span>
    <span class="description">jettero [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hrm, actually, I was not looking at a flag change command.  It was an
illusion.  But I can say that ...  RFC3501 &#40;under the FETCH command&#41; says
that messages are \Seen once you FETCH them:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The \Seen flag is implicitly set; if this causes the flags to
&gt; change, they SHOULD be included as part of the FETCH responses.
</div>

-- 
If riding in an airplane is flying, then riding in a boat is swimming.
116 jumps, 48.6 minutes of freefall, 92.9 freefall miles.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;20&nbsp;20:11:01&nbsp;2010</span>
    <span class="description">hawkexploretalent [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #59330] possible bug in _process_flags&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 20 Jul 2010 17:10:51 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-IMAP-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Hawk ExploreTalent &lt;hawkexploretalent [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dear Paul,

Don&#39;t know what the issue was with the Flags, but it definitely didn&#39;t
work with Net::IMAP::Simple.  I switched to Net::IMAP::Client and,
with a few tweaks, all is well.  I tweaked the timeout, and added an
examine sub &#40;instead of select&#41;, and now I can migrate thousands of
email accounts with one command.  The script checks the target server
to see if the message is already there before appending it, so I can
run it as many times as necessary to keep the target server up-to-date
before we switch DNS.

Thanks again for your help.  I hope you figure it out some day.

-Hawk


On Thu, Jul 15, 2010 at 8:40 AM, Paul Miller via RT
&lt;bug-Net-IMAP-Simple@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=59330">https://rt.cpan.org/Ticket/Display.html?id=59330</a></span> &gt;
&gt;
&gt; Hrm, actually, I was not looking at a flag change command.  It was an
&gt; illusion.  But I can say that ...  RFC3501 &#40;under the FETCH command&#41; says
&gt; that messages are \Seen once you FETCH them:
&gt;
<div class="message-stanza open">&gt;&gt; The \Seen flag is implicitly set; if this causes the flags to
&gt;&gt; change, they SHOULD be included as part of the FETCH responses.
</div>&gt;
&gt;
&gt; --
&gt; If riding in an airplane is flying, then riding in a boat is swimming.
&gt; 116 jumps, 48.6 minutes of freefall, 92.9 freefall miles.
&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;21&nbsp;10:55:09&nbsp;2010</span>
    <span class="description">jettero [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m glad you got everything working.  In my mind, there&#39;s no bug here. 
It&#39;s definitely doing what it&#39;s supposed to.  When you get the body of a
message the client is supposed to mark the message \Seen, which may not
be the same as &#34;read&#34; but it is still correct to set the flag. 

If that&#39;s not what you want, then you&#39;d have to manually set it back
yourself.  I did describe a work around &#40;using msg_flags&#40;&#41;&#41; but if
IMAP::Client is easier, then it seems you&#39;re all set either way.

I&#39;m closing this, replies will re-open it.


-- 
If riding in an airplane is flying, then riding in a boat is swimming.
116 jumps, 48.6 minutes of freefall, 92.9 freefall miles.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;21&nbsp;10:55:10&nbsp;2010</span>
    <span class="description">jettero [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
