<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #35572 for JavaScript: Once you bind_object, you can never unbind it or replace the binding</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #35572 for JavaScript: Once you bind_object, you can never unbind it or replace the binding</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/JavaScript/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/JavaScript/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/JavaScript/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/JavaScript/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/JavaScript">JavaScript CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">35572</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/JavaScript/Active/">JavaScript</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
CRAKRJACK [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-17548-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.06    </td>
  </tr>
  <tr id="CF-17549-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.07    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;01&nbsp;14:13:00&nbsp;2008</span>
    <span class="description">CRAKRJACK [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Once you bind_object, you can never unbind it or replace the binding</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">When this script is run, it attempts to create 10 objects in the
ThisObjectWillNotLeak class. Unfortunately, although it does create 10
objects of this class, only the first one that is bound ever makes it
into the JavaScript interpreter.

You will see 10 &#34;leaky&#34; objects get passed into JavaScript, but only one
&#34;Sealed&#34; object. I also have a feeling that if the &#34;Sealed&#34; objects were
all passed into javascript, they would leak as well.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> leaktest.pl</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!perl

use strict;
use warnings;
use Devel::Leak::Object qw&#40;GLOBAL_bless&#41;;
use JavaScript qw&#40;:all&#41;;

{
  package ThisObjectWillLeak;

  sub new {
    my&#40;$class, $num&#41; = @_;
    return bless { n =&gt; $num }, $class;
  }

  sub whoami {
    my $self = shift;
    return &#34;Leaky object #$self-&gt;{n}&#34;;
  }
}

{
  package ThisObjectWillNotLeak;

  sub new {
    my&#40;$class, $num&#41; = @_;
    return bless { n =&gt; $num }, $class;
  }

  sub whoami {
    my $self = shift;
    return &#34;Sealed object #$self-&gt;{n}&#34;;
  }
}

our $rt = JavaScript::Runtime-&gt;new;
our $cx = JavaScript::Context-&gt;new&#40;$rt&#41;;

sub dont_leak_an_object {
  my $sealed = ThisObjectWillNotLeak-&gt;new&#40;shift&#41;;
  $cx-&gt;bind_object&#40;sealed =&gt; $sealed&#41;;
  return;
}

sub leak_an_object {
  my $leaky = ThisObjectWillLeak-&gt;new&#40;shift&#41;;
  return $leaky;
}

sub write {
  my $msg = shift;
  print &#34;$msg\n&#34;;
}

foreach my $i &#40;&#39;ThisObjectWillLeak&#39;, &#39;ThisObjectWillNotLeak&#39;&#41; {
  $cx-&gt;bind_class&#40;
    name =&gt; $i,
    constructor =&gt; sub {},
    methods =&gt; { whoami =&gt; $i-&gt;can&#40;&#39;whoami&#39;&#41; },
    flags =&gt; JS_CLASS_NO_INSTANCE,
    package =&gt; $i
  &#41;;
}

$cx-&gt;bind_function&#40;leak_an_object =&gt; \&#38;leak_an_object&#41;;
$cx-&gt;bind_function&#40;dont_leak_an_object =&gt; \&#38;dont_leak_an_object&#41;;
$cx-&gt;bind_function&#40;write =&gt; \&#38;write&#41;;

foreach my $i &#40;1 .. 10&#41; {
  $cx-&gt;eval&#40;&#34;leaky = leak_an_object&#40;$i&#41;&#34;&#41;;
  $cx-&gt;eval&#40;&#34;dont_leak_an_object&#40;$i&#41;&#34;&#41;;
  $cx-&gt;eval&#40;&#34;write&#40;leaky.whoami&#40;&#41;&#41;&#34;&#41;;
  $cx-&gt;eval&#40;&#34;write&#40;sealed.whoami&#40;&#41;&#41;&#34;&#41;;
}
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;01&nbsp;14:46:12&nbsp;2008</span>
    <span class="description">CRAKRJACK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I just ran a few more tests, bind_value&#40;&#41; has this problem as well,
*even* when dealing with simple scalars / integers :-&#40;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;01&nbsp;15:07:42&nbsp;2008</span>
    <span class="description">claes [...] versed.se -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35572] Once you bind_object, you can never unbind it or replace the binding </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 1 May 2008 21:06:30 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-JavaScript [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Claes Jakobsson &lt;claes [...] versed.se&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

On 1 maj 2008, at 20.46, CRAKRJACK via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;       Queue: JavaScript
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=35572">http://rt.cpan.org/Ticket/Display.html?id=35572</a></span> &gt;
&gt;
&gt; I just ran a few more tests, bind_value&#40;&#41; has this problem as well,
&gt; *even* when dealing with simple scalars / integers :-&#40;
&gt;
</div>
bind_object &#40;and bind_function&#41; uses bind_value internally so they  
should both have the same problem. One of the memory leaks has been  
&#40;the one that causes ThisObjectWillNotLeak 5 has been address in the  
latest SVN version.

I&#39;m not quite sure if I want bind_value just to silently replace a  
property with a new value or if it should croak and you would have to  
use unbind_value &#40;function|object as aliases&#41; first.

/Claes
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;01&nbsp;15:07:46&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;01&nbsp;18:09:38&nbsp;2008</span>
    <span class="description">tyler [...] yi.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35572] Once you bind_object, you can never unbind it or replace the binding</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 1 May 2008 13:21:38 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Claes Jakobsson via RT &lt;bug-JavaScript [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tyler MacDonald &lt;tyler [...] yi.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Claes Jakobsson via RT &lt;bug-JavaScript@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; bind_object &#40;and bind_function&#41; uses bind_value internally so they  
&gt; should both have the same problem. One of the memory leaks has been  
&gt; &#40;the one that causes ThisObjectWillNotLeak 5 has been address in the  
&gt; latest SVN version.
&gt; 
&gt; I&#39;m not quite sure if I want bind_value just to silently replace a  
&gt; property with a new value or if it should croak and you would have to  
&gt; use unbind_value &#40;function|object as aliases&#41; first.
</div>
        unbind_value! Can I do that? It&#39;s not in the API docs :-&#41;

        - Tyler
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;01&nbsp;18:14:39&nbsp;2008</span>
    <span class="description">claes [...] versed.se -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35572] Once you bind_object, you can never unbind it or replace the binding</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 2 May 2008 00:14:21 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-JavaScript [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Claes Jakobsson &lt;claes [...] versed.se&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2 maj 2008, at 00.09, tyler@yi.org via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;       Queue: JavaScript
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=35572">http://rt.cpan.org/Ticket/Display.html?id=35572</a></span> &gt;
&gt;
&gt; Claes Jakobsson via RT &lt;bug-JavaScript@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt;&gt; bind_object &#40;and bind_function&#41; uses bind_value internally so they
&gt;&gt; should both have the same problem. One of the memory leaks has been
&gt;&gt; &#40;the one that causes ThisObjectWillNotLeak 5 has been address in the
&gt;&gt; latest SVN version.
&gt;&gt;
&gt;&gt; I&#39;m not quite sure if I want bind_value just to silently replace a
&gt;&gt; property with a new value or if it should croak and you would have to
&gt;&gt; use unbind_value &#40;function|object as aliases&#41; first.
</div>&gt;
&gt;       unbind_value! Can I do that? It&#39;s not in the API docs :-&#41;
</div>
It&#39;s not in 1.06 but will be in the next release. If you want it now  
you&#39;ll have to check it out form my repository.

svn://svn.surfar.nu/public/JavaScript/trunk

/Claes
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;09&nbsp;08:46:03&nbsp;2008</span>
    <span class="description">CLAESJAC [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;May&nbsp;09&nbsp;08:46:05&nbsp;2008</span>
    <span class="description">CLAESJAC [...] cpan.org -  Fixed in 1.07 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
