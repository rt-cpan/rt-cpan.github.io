<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #99578 for RPC-XML: t/60_net_server.t failure</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #99578 for RPC-XML: t/60_net_server.t failure</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/RPC-XML/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/RPC-XML/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/RPC-XML/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/RPC-XML/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/RPC-XML">RPC-XML CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">99578</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/RPC-XML/Active/">RPC-XML</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">rjray [...] blackperl.com
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dmacks [...] netspace.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-28026-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-28027-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.80    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;19&nbsp;03:04:33&nbsp;2014</span>
    <span class="description">dmacks [...] netspace.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> t/60_net_server.t failure</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 19 Oct 2014 03:04:24 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-RPC-XML [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Daniel Macks&#34; &lt;dmacks [...] netspace.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On OS X 10.8 using apple&#39;s perl-5.12.4, RPC-XML-0.78, with all CPAN dependencies supplied via fink, self-test fails:

t/60_net_server.t ............... 2/30
#   Failed test &#39;system.identity matches $srv-&gt;product_tokens&#39;
#   at t/60_net_server.t line 60.
#          got: undef
#     expected: &#39;RPC::XML::Server/1.73&#39;

#   Failed test &#39;system.listMethods returned ARRAY ref&#39;
#   at t/60_net_server.t line 68.
#          got: &#39;&#39;
#     expected: &#39;ARRAY&#39;

#   Failed test &#39;system.listMethods returned ARRAY ref&#39;
#   at t/60_net_server.t line 80.
#          got: &#39;&#39;
#     expected: &#39;ARRAY&#39;

#   Failed test &#39;system.listMethods returned ARRAY ref&#39;
#   at t/60_net_server.t line 90.
#          got: &#39;&#39;
#     expected: &#39;ARRAY&#39;

#   Failed test &#39;system.listMethods returned HASH ref&#39;
#   at t/60_net_server.t line 100.
#          got: &#39;&#39;
#     expected: &#39;HASH&#39;

#   Failed test &#39;system.methodHelp returned correct string&#39;
#   at t/60_net_server.t line 110.
#          got: undef
#     expected: &#39;Return the server name and version as a string&#39;

#   Failed test &#39;system.methodHelp returned ARRAY ref&#39;
#   at t/60_net_server.t line 116.
#          got: &#39;&#39;
#     expected: &#39;ARRAY&#39;

#   Failed test &#39;&#39;system.methodHelp &#40;bad arg&#41; response&#39; isa &#39;RPC::XML::fault&#39;&#39;
#   at t/60_net_server.t line 127.
#     &#39;system.methodHelp &#40;bad arg&#41; response&#39; isn&#39;t a &#39;RPC::XML::fault&#39;

#   Failed test &#39;system.methodHelp returned ARRAY ref&#39;

#   at t/60_net_server.t line 136.
#          got: &#39;&#39;
#     expected: &#39;ARRAY&#39;

#   Failed test &#39;&#39;system.methodSignature &#40;bad arg&#41; response&#39; isa &#39;RPC::XML::fault&#39;&#39;
#   at t/60_net_server.t line 146.
#     &#39;system.methodSignature &#40;bad arg&#41; response&#39; isn&#39;t a &#39;RPC::XML::fault&#39;

#   Failed test &#39;system.methodHelp returned ARRAY ref&#39;
#   at t/60_net_server.t line 193.
#          got: &#39;&#39;
#     expected: &#39;ARRAY&#39;
# Looks like you planned 30 tests but ran 29.
# Looks like you failed 11 tests of 29 run.
t/60_net_server.t ............... Dubious, test returned 11 &#40;wstat 2816, 0xb00&#41;
Failed 12/30 subtests
        &#40;less 16 skipped subtests: 2 okay&#41;

It looks like a similar result to:

<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=77992">https://rt.cpan.org/Public/Bug/Display.html?id=77992</a></span>

that was claimed fixed in a previous version. I do have Net::Server &#40;2.008, latest CPAN version&#41; installed.

dan

 --
Daniel Macks
dmacks@netspace.org
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;19&nbsp;11:24:36&nbsp;2014</span>
    <span class="description">rjray [...] blackperl.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Oct 19 03:04:33 2014, dmacks@netspace.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On OS X 10.8 using apple&#39;s perl-5.12.4, RPC-XML-0.78, with all CPAN
&gt; dependencies supplied via fink, self-test fails:
</div>
I&#39;ve been seeing this intermittently from CPAN Testers reports, lately. It&#39;s been happening under different Perls and different O/S versions &#40;seems to be mostly Macs, though&#41;, but happening randomly. That is, I&#39;m not getting regular reports of it, only one or two per month.

It doesn&#39;t exhibit on my development platform, but I will spin up a 5.12.X installation via perlbrew and see if I can reproduce it.

Randy
-- 
Randy J. Ray
rjray@blackperl.com
randy.j.ray@gmail.com
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;19&nbsp;11:24:36&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;19&nbsp;20:36:20&nbsp;2014</span>
    <span class="description">rjray [...] blackperl.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This one beats me.

I&#39;ve perlbrew&#39;d a 5.12.5 installation and tested it against both my dev version and the 0.78 distribution. All passed. I&#39;ve tested my system perl &#40;5.16.2 on MacOS 10.9, I don&#39;t have access to a 10.8 machine&#41; against both dev and 0.78, again all passed. For completeness&#39; sake I even tested both dev and 0.78 on a Linux box running 5.14.2, and that all passed.

I don&#39;t know what else I can do at this point.

Randy
-- 
Randy J. Ray
rjray@blackperl.com
randy.j.ray@gmail.com
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;16&nbsp;15:04:43&nbsp;2015</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2014-10-19 20:36:20, RJRAY wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This one beats me.
&gt; 
&gt; I&#39;ve perlbrew&#39;d a 5.12.5 installation and tested it against both my
&gt; dev version and the 0.78 distribution. All passed. I&#39;ve tested my
&gt; system perl &#40;5.16.2 on MacOS 10.9, I don&#39;t have access to a 10.8
&gt; machine&#41; against both dev and 0.78, again all passed. For
&gt; completeness&#39; sake I even tested both dev and 0.78 on a Linux box
&gt; running 5.14.2, and that all passed.
&gt; 
&gt; I don&#39;t know what else I can do at this point.
</div>
I see the same problem on a FreeBSD 10.1 system. Running 60_net_server.t with ktrace shows the following lines:


 72447 perl5.20.3 GIO   fd 3 wrote 72 bytes
       &#34;2015/11/16-20:43:36 CONNECT TCP Peer: &#34;[::1]:10931&#34; Local: &#34;[::1]:9000&#34;
       &#34;
 72447 perl5.20.3 RET   write 72/0x48
 72447 perl5.20.3 CALL  write&#40;0x2,0x80535d000,0x8b&#41;
 72447 perl5.20.3 GIO   fd 2 wrote 139 bytes
       &#34;Bad arg length for Socket::unpack_sockaddr_in, length is 28, should be 16 at /usr/perl5.20.3p/lib/5.20.3/amd64-freebsd/Socket.pm line 830.
       &#34;


An IPv6 vs. IPv4 problem maybe? My /etc/hosts has following lines:

::1             localhost localhost.my.domain
127.0.0.1       localhost localhost.my.domain

Maybe the IPv6 address for localhost has precedence over the IPv4 address? So I changed:

--- a/t/60_net_server.t
+++ b/t/60_net_server.t
@@ -69,7 +69,7 @@ start_server&#40;$srv,
              log_level   =&gt; 4,
              pid_file    =&gt; $pid_file,
              port        =&gt; $port,
-             host        =&gt; &#39;localhost&#39;,
+             host        =&gt; &#39;127.0.0.1&#39;,
              background  =&gt; 1&#41;;
 sleep 1; # Allow time for server to spin up
 # Unless we see &#34;ok 2&#34;, we have a problem


-&gt; the test runs fine! Maybe this might help for further research...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;08&nbsp;14:31:23&nbsp;2016</span>
    <span class="description">rjray [...] blackperl.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have found the cause. The problem stems from the fact that Net::Server will use IO::Socket::IP if it is available. And with that module, this error occurs. But only when the IPv6 def of localhost appears before the IPv4 def.

Perplexing. For one thing, this should have worked with IPv6 in the first place. And I seem to recall that I had a problem when I hard-coded localhost as 127.0.0.1, but I can&#39;t remember the details.

I&#39;ll see what I can do with this. Maybe scan/parse /etc/hosts myself, to see if the IPv6 line is before the IPv4. The bigger question is why it fails just because of IPv6...

Randy
-- 
Randy J. Ray
rjray@blackperl.com
randy.j.ray@gmail.com
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;12&nbsp;01:01:55&nbsp;2016</span>
    <span class="description">rjray [...] blackperl.com -  Fixed in 0.80 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;12&nbsp;01:01:56&nbsp;2016</span>
    <span class="description">rjray [...] blackperl.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;May&nbsp;12&nbsp;01:01:57&nbsp;2016</span>
    <span class="description">rjray [...] blackperl.com -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
