<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #1616 for Net-DNS: Problem with AUTHORITY records?</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #1616 for Net-DNS: Problem with AUTHORITY records?</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-DNS/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-DNS/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-DNS/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-DNS/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-DNS">Net-DNS CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">1616</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-DNS/Active/">Net-DNS</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dizzy [...] wurley.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-22454-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.29    </td>
  </tr>
  <tr id="CF-22455-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;05&nbsp;10:34:06&nbsp;2002</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Problem with AUTHORITY records?</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi, I&#39;m having trouble getting data out of an AUTHORITY section, when there is no ANSWER section. &#40;And it seems that the arcount is the same as ancount, when there are ANSWER records.&#41; Am I doing something wrong?

For example: I am querying a COM.AU DNS Server for centralkitchens.com.au, which gives me the following:

;; query&#40;centralkitchens.com.au, NS, IN&#41;
;; send_udp&#40;210.8.15.253:53&#41;
;; answer from 210.8.15.253:53 : 113 bytes
;; HEADER SECTION
;; id = 24503
;; qr = 1    opcode = QUERY    aa = 0    tc = 0    rd = 1
;; ra = 0    ad = 0    cd = 0    rcode  = NOERROR
;; qdcount = 1  ancount = 0  nscount = 3  arcount = 0

;; QUESTION SECTION &#40;1 record&#41;
;; centralkitchens.com.au.      IN      NS

;; ANSWER SECTION &#40;0 records&#41;

;; AUTHORITY SECTION &#40;3 records&#41;
centralkitchens.com.au. 86400   IN      NS      lnk.maets.com.
centralkitchens.com.au. 86400   IN      NS      lnk.wurley.net.
centralkitchens.com.au. 86400   IN      NS      dsl.wurley.net.

;; ADDITIONAL SECTION &#40;0 records&#41;

My $query-&gt;header-&gt;arcount complains &#34;Cant call method on undefined value.&#34; And $query-&gt;authority is undef.

If I query a root COM.AU server which returns the following result:

;; query&#40;com.au, NS, IN&#41;
;; send_udp&#40;10.1.3.65:53&#41;
;; answer from 10.1.3.65:53 : 357 bytes
;; HEADER SECTION
;; id = 23973
;; qr = 1    opcode = QUERY    aa = 0    tc = 0    rd = 1
;; ra = 1    ad = 0    cd = 0    rcode  = NOERROR
;; qdcount = 1  ancount = 8  nscount = 0  arcount = 8

;; QUESTION SECTION &#40;1 record&#41;
;; com.au.      IN      NS

;; ANSWER SECTION &#40;8 records&#41;
com.au. 69442   IN      NS      ns3.melbourneit.com.
com.au. 69442   IN      NS      ns4.ausregistry.net.
com.au. 69442   IN      NS      dns1.telstra.net.
com.au. 69442   IN      NS      dmssyd.nsw.cmis.csiro.au.
com.au. 69442   IN      NS      ns.ripe.net.
com.au. 69442   IN      NS      ns1.ausregistry.net.
com.au. 69442   IN      NS      ns2.ausregistry.net.
com.au. 69442   IN      NS      ns3.ausregistry.net.

;; AUTHORITY SECTION &#40;0 records&#41;

;; ADDITIONAL SECTION &#40;8 records&#41;
ns.ripe.net.    169647  IN      A       193.0.0.193
ns1.ausregistry.net.    113504  IN      A       203.18.56.41
ns2.ausregistry.net.    113504  IN      A       203.18.56.42
ns3.ausregistry.net.    113504  IN      A       203.18.56.43
ns3.melbourneit.com.    27105   IN      A       203.27.227.10
ns4.ausregistry.net.    113504  IN      A       210.8.15.253
dns1.telstra.net.       862     IN      A       203.50.5.200
dmssyd.nsw.cmis.csiro.au.       243265  IN      A       130.155.16.1

Then, header-&gt;arcount = 8 and header-&gt;ancount = 8 ??

Is the authority records and answer records being confused somewhere?

How can I find out the AUTHORITY results and there are no ANSWER results?

&#40;I&#39;m using this in my code:

      foreach $rr &#40;$gQuery-&gt;authority&#41; {
        print &#34;Working AUTHORITY record [&#34;.$rr-&gt;type.&#34;] [&#34;.$rr-&gt;nsdname.&#34;]\n&#34;;
        next unless $rr-&gt;type eq &#34;NS&#34;;
        push &#40;@lResults, $rr-&gt;nsdname&#41;;
      }

Which never prints anything.&#41;
</div></div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;05&nbsp;10:36:17&nbsp;2002</span>
    <span class="description">dizzy [...] wurley.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Deon George&#34; &lt;dizzy [...] wurley.net&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Net-DNS [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [cpan #1616] AutoReply: Problem with AUTHORITY records?</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 6 Oct 2002 00:35:56 +1000</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ohh.. Forgot to add.

Here is my perl -V:

Summary of my perl5 &#40;revision 5.0 version 6 subversion 1&#41; configuration:
  Platform:
    osname=linux, osvers=2.4.17-0.13smp, archname=i386-linux
    uname=&#39;linux daffy.perf.redhat.com 2.4.17-0.13smp #1 smp fri feb 1
10:30:48 est 2002 i686 unknown &#39;




config_args=&#39;-des -Doptimize=-O2 -march=i386 -mcpu=i686 -Dcc=gcc -Dcf_by=Red
Hat,
Inc. -Dcccdlflags=-fPIC -Dinstallprefix=/usr -Dprefix=/usr -Darchname=i386-l
inux -Dvendorprefix=/usr -Dsiteprefix=/usr -Uusethreads -Uuseithreads -Uusel
argefiles -Dd_dosuid -Dd_semctl_semun -Di_db -Di_ndbm -Di_gdbm -Di_shadow -D
i_syslog -Dman3ext=3pm&#39;
    hint=recommended, useposix=true, d_sigaction=define
    usethreads=undef use5005threads=undef useithreads=undef
usemultiplicity=undef
    useperlio=undef d_sfio=undef uselargefiles=undef usesocks=undef
    use64bitint=undef use64bitall=undef uselongdouble=undef
  Compiler:
    cc=&#39;gcc&#39;, ccflags =&#39;-fno-strict-aliasing -I/usr/local/include&#39;,
    optimize=&#39;-O2 -march=i386 -mcpu=i686&#39;,
    cppflags=&#39;-fno-strict-aliasing -I/usr/local/include&#39;
    ccversion=&#39;&#39;, gccversion=&#39;2.96 20000731 &#40;Red Hat Linux 7.2 2.96-109&#41;&#39;,
gccosandvers=&#39;&#39;
    intsize=4, longsize=4, ptrsize=4, doublesize=8, byteorder=1234
    d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=12
    ivtype=&#39;long&#39;, ivsize=4, nvtype=&#39;double&#39;, nvsize=8, Off_t=&#39;off_t&#39;,
lseeksize=4
    alignbytes=4, usemymalloc=n, prototype=define
  Linker and Libraries:
    ld=&#39;gcc&#39;, ldflags =&#39; -L/usr/local/lib&#39;
    libpth=/usr/local/lib /lib /usr/lib
    libs=-lnsl -ldl -lm -lc -lcrypt -lutil
    perllibs=-lnsl -ldl -lm -lc -lcrypt -lutil
    libc=/lib/libc-2.2.5.so, so=so, useshrplib=false, libperl=libperl.a
  Dynamic Linking:
    dlsrc=dl_dlopen.xs, dlext=so, d_dlsymun=undef, ccdlflags=&#39;-rdynamic&#39;
    cccdlflags=&#39;-fPIC&#39;, lddlflags=&#39;-shared -L/usr/local/lib&#39;


Characteristics of this binary &#40;from libperl&#41;:
  Compile-time options:
  Built under linux
  Compiled at Apr  1 2002 12:23:22
  @INC:
    /usr/lib/perl5/5.6.1/i386-linux
    /usr/lib/perl5/5.6.1
    /usr/lib/perl5/site_perl/5.6.1/i386-linux
    /usr/lib/perl5/site_perl/5.6.1
    /usr/lib/perl5/site_perl
    /usr/lib/perl5/vendor_perl/5.6.1/i386-linux
    /usr/lib/perl5/vendor_perl/5.6.1
    /usr/lib/perl5/vendor_perl
    .
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;05&nbsp;19:35:38&nbsp;2002</span>
    <span class="description">dizzy [...] wurley.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Deon George&#34; &lt;dizzy [...] wurley.net&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Net-DNS [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [cpan #1616] Fixed my problem, and here is a patch if you are interested.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 6 Oct 2002 09:35:28 +1000</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">OK - I was confused before with the arcount and ancount... They appear to be
set to the correct values.

What I have noticed is that the query is undef, unless you get an ANSWER.
Unfortunatly, the COM.AU DNS servers dont return answer records when you
query for NS records, and the records are not in the .COM.AU domain. &#40;Which
is probably a good thing - but anyway...&#41;

So, I&#39;ve patched Resolver.pm so that it will return a query object if it has
ANSWER or AUTHORITY results - which gets me what I want... The patch is
below, if you are interested...

Is there a reason why you would discard the AUTHORITY records if your query
doesnt return any ANSWER?  Is there another way of getting the AUTHORITY
information &#40;that I should be doing, instead of this patch?&#41;

Lemme know!

Here is the patch:

--- Resolver.pm.orig    Wed Oct  2 16:02:37 2002
+++ Resolver.pm Sun Oct  6 09:30:13 2002
@@ -523,7 +523,7 @@
        if &#40;index&#40;$name, &#39;.&#39;&#41; &gt;= 0&#41; {
                print &#34;;; search&#40;$name, $type, $class&#41;\n&#34; if
$self-&gt;{&#39;debug&#39;};
                $ans = $self-&gt;query&#40;$name, $type, $class&#41;;
-               return $ans if &#40;defined $ans&#41; &#38;&#38; &#40;$ans-&gt;header-&gt;ancount &gt;
0&#41;;
+               return $ans if &#40;defined $ans&#41; &#38;&#38; &#40;&#40;$ans-&gt;header-&gt;ancount &gt;
0&#41; || &#40;$ans-&gt;header-&gt;nscount &gt; 0&#41;&#41;;
        }

        # If the name doesn&#39;t end in a dot then apply the search list.
@@ -533,7 +533,7 @@
                        print &#34;;; search&#40;$newname, $type, $class&#41;\n&#34;
                                if $self-&gt;{&#39;debug&#39;};
                        $ans = $self-&gt;query&#40;$newname, $type, $class&#41;;
-                       return $ans if &#40;defined $ans&#41; &#38;&#38;
&#40;$ans-&gt;header-&gt;ancount &gt; 0&#41;;
+                       return $ans if &#40;defined $ans&#41; &#38;&#38;
&#40;&#40;$ans-&gt;header-&gt;ancount &gt; 0&#41; || &#40;$ans-&gt;header-&gt;nscount &gt; 0&#41;&#41;;
                }
        }

@@ -541,7 +541,7 @@
        if &#40;index&#40;$name, &#39;.&#39;&#41; &lt; 0&#41; {
                print &#34;;; search&#40;$name, $type, $class&#41;\n&#34; if
$self-&gt;{&#39;debug&#39;};
                $ans = $self-&gt;query&#40;&#34;$name.&#34;, $type, $class&#41;;
-               return $ans if &#40;defined $ans&#41; &#38;&#38; &#40;$ans-&gt;header-&gt;ancount &gt;
0&#41;;
+               return $ans if &#40;defined $ans&#41; &#38;&#38; &#40;&#40;$ans-&gt;header-&gt;ancount &gt;
0&#41; || &#40;$ans-&gt;header-&gt;nscount &gt; 0&#41;&#41;;
        }

        # No answer was found.
@@ -595,7 +595,7 @@

        my $ans = $self-&gt;send&#40;$packet&#41;;

-       return &#40;defined&#40;$ans&#41; &#38;&#38; &#40;$ans-&gt;header-&gt;ancount &gt; 0&#41;&#41; ? $ans :
undef;
+       return &#40;defined&#40;$ans&#41; &#38;&#38; &#40;&#40;$ans-&gt;header-&gt;ancount &gt; 0&#41; ||
&#40;$ans-&gt;header-&gt;nscount &gt; 0&#41;&#41;&#41; ? $ans : undef;
 }

...deon
Wurley Solutions
---
 _--_|\   | Deon George &lt;dizzy@wurley.net&gt;
/      \  |
\_.--.*/  |
      v   | This email coming to you from the &#39;burbs of Melbourne,
Australia.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;06&nbsp;15:30:54&nbsp;2002</span>
    <span class="description">rt-cpan [...] triv.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[dizzy@wurley.net - Sat Oct  5 19:35:38 2002]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; OK - I was confused before with the arcount and ancount... They appear to be
&gt; set to the correct values.
&gt; 
&gt; What I have noticed is that the query is undef, unless you get an ANSWER.
&gt; Unfortunatly, the COM.AU DNS servers dont return answer records when you
&gt; query for NS records, and the records are not in the .COM.AU domain. &#40;Which
&gt; is probably a good thing - but anyway...&#41;
</div>
If you need the answer object even when the answer section is empty, you 
should use Net::DNS::Resolver::send&#40;&#41;.  This always returns the answer &#40;as 
long as it got an answer that is&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So, I&#39;ve patched Resolver.pm so that it will return a query object if it has
&gt; ANSWER or AUTHORITY results - which gets me what I want... The patch is
&gt; below, if you are interested...
</div>
The patch will break exsisting code, where people are expecting query to return 
undef if no answers were found.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Is there a reason why you would discard the AUTHORITY records if your
&gt;  query doesnt return any ANSWER?  Is there another way of getting the 
&gt; AUTHORITY information &#40;that I should be doing, instead of this patch?&#41;
</div>
It is the traditional way that C function res_query&#40;&#41; from libresolv behaves.  
Net::DNS&#39;s query function is modeled after that behavoir.  See my above 
comments about send&#40;&#41; for getting around this.

-- 
Chris Reinhardt
ctriv@dyndns.org
Systems Architect
Dynamic DNS Network Services
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.dyndns.org/">http://www.dyndns.org/</a></span>
</div></div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;06&nbsp;15:30:55&nbsp;2002</span>
    <span class="description">rt-cpan [...] triv.org -  Status changed from &#39;new&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
