<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #78224 for Log-Report: Log::Report uses exit not die</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #78224 for Log-Report: Log::Report uses exit not die</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Log-Report/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Log-Report/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Log-Report/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Log-Report/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Log-Report">Log-Report CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">78224</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Log-Report/Active/">Log-Report</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
chm [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
Mark [...] Overmeer.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-43686-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.94    </td>
  </tr>
  <tr id="CF-43687-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;05&nbsp;13:44:08&nbsp;2012</span>
    <span class="description">chm [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Mark [...] Overmeer.net</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Log::Report uses exit not die</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza">It appears that Log::Report will actually call exit<br>

within an error reporter if the interpreter state is<br>

not $^S as true.<br>

<br>

This is problematic for users of this module since<br>

there is no way from perl to &quot;handle&quot; a live exit call.<br>

An error failure should not lead to an exit unless<br>

the user has requested error and exit.&nbsp; See the<br>

problem report for Geo::KML leading to this report.<br>

<br>

--Chris<br>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;05&nbsp;15:51:38&nbsp;2012</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #78224] Log::Report uses exit not die</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 5 Jul 2012 21:51:22 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Chris Marshall via RT &lt;bug-Log-Report [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Chris Marshall via RT &#40;bug-Log-Report@rt.cpan.org&#41; [120705 18:06]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=78224">https://rt.cpan.org/Ticket/Display.html?id=78224</a></span> &gt;
&gt; 
&gt; It appears that Log::Report will actually call exit
&gt; within an error reporter if the interpreter state is
&gt; not $^S as true.
&gt; 
&gt; This is problematic for users of this module since
&gt; there is no way from perl to &#34;handle&#34; a live exit call.
&gt; An error failure should not lead to an exit unless
&gt; the user has requested error and exit. See the
&gt; problem report for Geo::KML leading to this report.
</div>
You are totally mistaken.  It is very normal for a &#34;die&#34; to terminate
the program with an exit unless within an eval... the same for &#34;error&#34;
in Log::Report: it will exit unless in an eval &#40;indicated by $^S&#41;

So: error handling via Log::Report&#39;s error&#40;&#41; works the same as via
die&#40;&#41;.  They both have the same mechanism to catch it:  eval{}
As I explained before.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;05&nbsp;15:51:39&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;05&nbsp;16:23:24&nbsp;2012</span>
    <span class="description">devel.chm.01 [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> chm [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #78224] Log::Report uses exit not die</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 5 Jul 2012 16:23:15 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Log-Report [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Chris Marshall &lt;devel.chm.01 [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Jul 5, 2012 at 3:51 PM, Mark Overmeer via RT
&lt;bug-Log-Report@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=78224">https://rt.cpan.org/Ticket/Display.html?id=78224</a></span> &gt;
&gt;
&gt; * Chris Marshall via RT &#40;bug-Log-Report@rt.cpan.org&#41; [120705 18:06]:
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=78224">https://rt.cpan.org/Ticket/Display.html?id=78224</a></span> &gt;
&gt;&gt;
&gt;&gt; It appears that Log::Report will actually call exit
&gt;&gt; within an error reporter if the interpreter state is
&gt;&gt; not $^S as true.
&gt;&gt;
&gt;&gt; This is problematic for users of this module since
&gt;&gt; there is no way from perl to &#34;handle&#34; a live exit call.
&gt;&gt; An error failure should not lead to an exit unless
&gt;&gt; the user has requested error and exit. See the
&gt;&gt; problem report for Geo::KML leading to this report.
</div>&gt;
&gt; You are totally mistaken.  It is very normal for a &#34;die&#34; to terminate
&gt; the program with an exit unless within an eval... the same for &#34;error&#34;
&gt; in Log::Report: it will exit unless in an eval &#40;indicated by $^S&#41;
&gt;
&gt; So: error handling via Log::Report&#39;s error&#40;&#41; works the same as via
&gt; die&#40;&#41;.  They both have the same mechanism to catch it:  eval{}
&gt; As I explained before.
</div>
From perldoc -f exit:
    ...
    Don&#39;t use &#34;exit&#34; to abort a subroutine if there&#39;s any chance
    that someone might want to trap whatever error happened.  Use
    &#34;die&#34; instead, which can be trapped by an &#34;eval&#34;.
    ...

I know what Log::Report is _trying_ to do but the scheme
to determine if one is in an eval gives a different result than
perl by itself.  This can be demonstrated by replacing the
exit in the routine by a die which is the recommended style
per the above excerpt, and that works as expected inside
an eval and inside the Devel::REPL shell.

Given that exit *can never be caught at the perl level* it is
not useful for any type of embedded functionality as it will
kill perl itself.  In my experience, a direct exit is only
useful if you have control of the entire program being run
and not just a sub being called.

This is either a bug at the Geo::KML level since it is not
calling Log::Report within an eval to catch the exception
and thus allowing an exit call from the interpreter,

or

a bug in Log::Report resulting from using exit rather than
the recommended die.  I think a fix at the lower level
would be cleaner and simpler.

--Chris
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;05&nbsp;16:33:21&nbsp;2012</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> chm [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #78224] Log::Report uses exit not die</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 5 Jul 2012 22:33:06 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;devel.chm.01 [...] gmail.com via RT&#34; &lt;bug-Log-Report [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* devel.chm.01@gmail.com via RT &#40;bug-Log-Report@rt.cpan.org&#41; [120705 20:23]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=78224">https://rt.cpan.org/Ticket/Display.html?id=78224</a></span> &gt;
<div class="message-stanza open">&gt; &gt;From perldoc -f exit:
</div>&gt;     ...
&gt;     Don&#39;t use &#34;exit&#34; to abort a subroutine if there&#39;s any chance
&gt;     that someone might want to trap whatever error happened.  Use
&gt;     &#34;die&#34; instead, which can be trapped by an &#34;eval&#34;.
&gt;     ...
&gt; 
&gt; I know what Log::Report is _trying_ to do but the scheme
&gt; to determine if one is in an eval gives a different result than
&gt; perl by itself.  This can be demonstrated by replacing the
&gt; exit in the routine by a die which is the recommended style
&gt; per the above excerpt, and that works as expected inside
&gt; an eval and inside the Devel::REPL shell.
</div>
Log::Report is implementing a more sophisticated system of
exceptions than perl&#39;s print/warn/die.  So, it is very understandable
that it does call exit&#40;&#41;, not die&#40;&#41;.  Ever tried to let die&#40;&#41; end a
problem with a nice RC?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Given that exit *can never be caught at the perl level* it is
&gt; not useful for any type of embedded functionality as it will
&gt; kill perl itself.  In my experience, a direct exit is only
&gt; useful if you have control of the entire program being run
&gt; and not just a sub being called.
</div>
The exit in Log::Report::report&#40;&#41; is only called when we really
want the program to stop, just like die&#40;&#41; outside eval&#40;&#41;.  I know
that modules should not exit, but Log::Report is an alternative
for CORE features ... that has different rules.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This is either a bug at the Geo::KML level since it is not
&gt; calling Log::Report within an eval to catch the exception
&gt; and thus allowing an exit call from the interpreter,
</div>
No.  The program using Geo::KML cannot continue because the module
gets XML which is does not understand.  Say, you are reading from
a CSV file with 10 fields per line.  The program finds a line with
only 2 fields.  What would you do?  Die or return undef?  The main
program will not be able to continue anyway.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; or
&gt; 
&gt; a bug in Log::Report resulting from using exit rather than
&gt; the recommended die.  I think a fix at the lower level
&gt; would be cleaner and simpler.
</div>
You can simply say:

    my $data = try { Geo::KML-&gt;readFrom&#40;$file&#41; };
    die $@ if $@;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;05&nbsp;16:54:16&nbsp;2012</span>
    <span class="description">devel.chm.01 [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> &#34;devel.chm.01 [...] gmail.com via RT&#34; &lt;bug-Log-Report [...] rt.cpan.org&gt;, chm [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #78224] Log::Report uses exit not die</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 5 Jul 2012 16:54:05 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Chris Marshall &lt;devel.chm.01 [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Jul 5, 2012 at 4:33 PM, Mark Overmeer &lt;mark@overmeer.net&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; * devel.chm.01@gmail.com via RT &#40;bug-Log-Report@rt.cpan.org&#41; [120705 20:23]:
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=78224">https://rt.cpan.org/Ticket/Display.html?id=78224</a></span> &gt;
<div class="message-stanza open">&gt;&gt; &gt;From perldoc -f exit:
</div>&gt;&gt;     ...
&gt;&gt;     Don&#39;t use &#34;exit&#34; to abort a subroutine if there&#39;s any chance
&gt;&gt;     that someone might want to trap whatever error happened.  Use
&gt;&gt;     &#34;die&#34; instead, which can be trapped by an &#34;eval&#34;.
&gt;&gt;     ...
&gt;&gt;
&gt;&gt; I know what Log::Report is _trying_ to do but the scheme
&gt;&gt; to determine if one is in an eval gives a different result than
&gt;&gt; perl by itself.  This can be demonstrated by replacing the
&gt;&gt; exit in the routine by a die which is the recommended style
&gt;&gt; per the above excerpt, and that works as expected inside
&gt;&gt; an eval and inside the Devel::REPL shell.
</div>&gt;
&gt; Log::Report is implementing a more sophisticated system of
&gt; exceptions than perl&#39;s print/warn/die.  So, it is very understandable
&gt; that it does call exit&#40;&#41;, not die&#40;&#41;.  Ever tried to let die&#40;&#41; end a
&gt; problem with a nice RC?
</div>
I&#39;m not sure what an RC is but calling exit essentially
puts a stop to any possible perl operations past that
point in the code.  I don&#39;t know of any cases where
calling exit from perl is a good approach unless you
are controlling the entire application/program and you
really want to stop everything in its tracks with no
possible recovery.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; Given that exit *can never be caught at the perl level* it is
&gt;&gt; not useful for any type of embedded functionality as it will
&gt;&gt; kill perl itself.  In my experience, a direct exit is only
&gt;&gt; useful if you have control of the entire program being run
&gt;&gt; and not just a sub being called.
</div>&gt;
&gt; The exit in Log::Report::report&#40;&#41; is only called when we really
&gt; want the program to stop, just like die&#40;&#41; outside eval&#40;&#41;.  I know
&gt; that modules should not exit, but Log::Report is an alternative
&gt; for CORE features ... that has different rules.
</div>
Since replacing exit with die makes the error
work the same way as perl, it is arguable that
something is different between your detection
of when a user cares about handling failures and
when it is ok to destroy/kill/terminate/exit...the
entire perl interpreter and the program instead.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; This is either a bug at the Geo::KML level since it is not
&gt;&gt; calling Log::Report within an eval to catch the exception
&gt;&gt; and thus allowing an exit call from the interpreter,
</div>&gt;
&gt; No.  The program using Geo::KML cannot continue because the module
&gt; gets XML which is does not understand.  Say, you are reading from
&gt; a CSV file with 10 fields per line.  The program finds a line with
&gt; only 2 fields.  What would you do?  Die or return undef?  The main
&gt; program will not be able to continue anyway.
</div>
That is the problem with exiting.  There is no way for
any other level of code to handle the situation further.
In this case, I&#39;m in a REPL loop command shell and
*definitely* don&#39;t want perl to exit just because an XML
file has bad data.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; or
&gt;&gt;
&gt;&gt; a bug in Log::Report resulting from using exit rather than
&gt;&gt; the recommended die.  I think a fix at the lower level
&gt;&gt; would be cleaner and simpler.
</div>&gt;
&gt; You can simply say:
&gt;
&gt;     my $data = try { Geo::KML-&gt;readFrom&#40;$file&#41; };
&gt;     die $@ if $@;
</div>
This is the first file IO routine that I have seen
that kills perl rather than returning some sort
of status or exception.

I saw nothing in the Geo::KML docs to suggest
that an eval is needed to keep perl alive after
trying to read a KML file.  At the least, please
document your recommended usage so folks
will know the danger and how to work around
the problem.

I&#39;m sorry I don&#39;t know more about why the check
for $^S fails in this case.  I do know that $^S is
undef when you call exit in my case.  If you
checked for defined&#40;&#41; first and then hand off to
exit, I think that would work around the crash
in the REPL for me.

At least I can work around the issue going
forwards.

Regards,
Chris
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;05&nbsp;17:21:29&nbsp;2012</span>
    <span class="description">devel.chm.01 [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> chm [...] cpan.org, Mark [...] overmeer.net</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #78224] Log::Report uses exit not die</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 5 Jul 2012 17:21:19 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Log-Report [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Chris Marshall &lt;devel.chm.01 [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Well, I re-re-read the description of $^S and caught:

       $EXCEPTIONS_BEING_CAUGHT
       $^S     Current state of the interpreter.

                   $^S         State
                   ---------   -------------------
                   undef       Parsing module/eval
                   true &#40;1&#41;    Executing an eval
                   false &#40;0&#41;   Otherwise

               The first state may happen in $SIG{__DIE__} and $SIG{__WARN__}
               handlers.

Where the key observation is that $^S can take on the
undef value in parsing an _eval_ so that the exit usage
would be correct if you do check that $^S is defined and
false before calling exit.

I still think it would be simpler/safe to use die directly.

Cheers,
Chris


On Thu, Jul 5, 2012 at 4:54 PM, devel.chm.01@gmail.com via RT
&lt;bug-Log-Report@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=78224">https://rt.cpan.org/Ticket/Display.html?id=78224</a></span> &gt;
&gt;
&gt; On Thu, Jul 5, 2012 at 4:33 PM, Mark Overmeer &lt;mark@overmeer.net&gt; wrote:
<div class="message-stanza open">&gt;&gt; * devel.chm.01@gmail.com via RT &#40;bug-Log-Report@rt.cpan.org&#41; [120705 20:23]:
<div class="message-stanza open">&gt;&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=78224">https://rt.cpan.org/Ticket/Display.html?id=78224</a></span> &gt;
<div class="message-stanza open">&gt;&gt;&gt; &gt;From perldoc -f exit:
</div>&gt;&gt;&gt;     ...
&gt;&gt;&gt;     Don&#39;t use &#34;exit&#34; to abort a subroutine if there&#39;s any chance
&gt;&gt;&gt;     that someone might want to trap whatever error happened.  Use
&gt;&gt;&gt;     &#34;die&#34; instead, which can be trapped by an &#34;eval&#34;.
&gt;&gt;&gt;     ...
&gt;&gt;&gt;
&gt;&gt;&gt; I know what Log::Report is _trying_ to do but the scheme
&gt;&gt;&gt; to determine if one is in an eval gives a different result than
&gt;&gt;&gt; perl by itself.  This can be demonstrated by replacing the
&gt;&gt;&gt; exit in the routine by a die which is the recommended style
&gt;&gt;&gt; per the above excerpt, and that works as expected inside
&gt;&gt;&gt; an eval and inside the Devel::REPL shell.
</div>&gt;&gt;
&gt;&gt; Log::Report is implementing a more sophisticated system of
&gt;&gt; exceptions than perl&#39;s print/warn/die.  So, it is very understandable
&gt;&gt; that it does call exit&#40;&#41;, not die&#40;&#41;.  Ever tried to let die&#40;&#41; end a
&gt;&gt; problem with a nice RC?
</div>&gt;
&gt; I&#39;m not sure what an RC is but calling exit essentially
&gt; puts a stop to any possible perl operations past that
&gt; point in the code.  I don&#39;t know of any cases where
&gt; calling exit from perl is a good approach unless you
&gt; are controlling the entire application/program and you
&gt; really want to stop everything in its tracks with no
&gt; possible recovery.
&gt;
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt; Given that exit *can never be caught at the perl level* it is
&gt;&gt;&gt; not useful for any type of embedded functionality as it will
&gt;&gt;&gt; kill perl itself.  In my experience, a direct exit is only
&gt;&gt;&gt; useful if you have control of the entire program being run
&gt;&gt;&gt; and not just a sub being called.
</div>&gt;&gt;
&gt;&gt; The exit in Log::Report::report&#40;&#41; is only called when we really
&gt;&gt; want the program to stop, just like die&#40;&#41; outside eval&#40;&#41;.  I know
&gt;&gt; that modules should not exit, but Log::Report is an alternative
&gt;&gt; for CORE features ... that has different rules.
</div>&gt;
&gt; Since replacing exit with die makes the error
&gt; work the same way as perl, it is arguable that
&gt; something is different between your detection
&gt; of when a user cares about handling failures and
&gt; when it is ok to destroy/kill/terminate/exit...the
&gt; entire perl interpreter and the program instead.
&gt;
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt; This is either a bug at the Geo::KML level since it is not
&gt;&gt;&gt; calling Log::Report within an eval to catch the exception
&gt;&gt;&gt; and thus allowing an exit call from the interpreter,
</div>&gt;&gt;
&gt;&gt; No.  The program using Geo::KML cannot continue because the module
&gt;&gt; gets XML which is does not understand.  Say, you are reading from
&gt;&gt; a CSV file with 10 fields per line.  The program finds a line with
&gt;&gt; only 2 fields.  What would you do?  Die or return undef?  The main
&gt;&gt; program will not be able to continue anyway.
</div>&gt;
&gt; That is the problem with exiting.  There is no way for
&gt; any other level of code to handle the situation further.
&gt; In this case, I&#39;m in a REPL loop command shell and
&gt; *definitely* don&#39;t want perl to exit just because an XML
&gt; file has bad data.
&gt;
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt; or
&gt;&gt;&gt;
&gt;&gt;&gt; a bug in Log::Report resulting from using exit rather than
&gt;&gt;&gt; the recommended die.  I think a fix at the lower level
&gt;&gt;&gt; would be cleaner and simpler.
</div>&gt;&gt;
&gt;&gt; You can simply say:
&gt;&gt;
&gt;&gt;     my $data = try { Geo::KML-&gt;readFrom&#40;$file&#41; };
&gt;&gt;     die $@ if $@;
</div>&gt;
&gt; This is the first file IO routine that I have seen
&gt; that kills perl rather than returning some sort
&gt; of status or exception.
&gt;
&gt; I saw nothing in the Geo::KML docs to suggest
&gt; that an eval is needed to keep perl alive after
&gt; trying to read a KML file.  At the least, please
&gt; document your recommended usage so folks
&gt; will know the danger and how to work around
&gt; the problem.
&gt;
&gt; I&#39;m sorry I don&#39;t know more about why the check
&gt; for $^S fails in this case.  I do know that $^S is
&gt; undef when you call exit in my case.  If you
&gt; checked for defined&#40;&#41; first and then hand off to
&gt; exit, I think that would work around the crash
&gt; in the REPL for me.
&gt;
&gt; At least I can work around the issue going
&gt; forwards.
&gt;
&gt; Regards,
&gt; Chris
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;05&nbsp;17:58:02&nbsp;2012</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> &#34;devel.chm.01 [...] gmail.com via RT&#34; &lt;bug-Log-Report [...] rt.cpan.org&gt;, chm [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #78224] Log::Report uses exit not die</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 5 Jul 2012 23:57:45 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Chris Marshall &lt;devel.chm.01 [...] gmail.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Chris Marshall &#40;devel.chm.01@gmail.com&#41; [120705 20:54]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt;     my $data = try { Geo::KML-&gt;readFrom&#40;$file&#41; };
&gt; &gt;     die $@ if $@;
</div>&gt; 
&gt; This is the first file IO routine that I have seen that kills perl
&gt; rather than returning some sort of status or exception.
</div>
Traditional modules in Perl do not use exception mechanisms.  If they
have such mechanisms, than I expect they will also die on fatal exceptions
which are not caught.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I saw nothing in the Geo::KML docs to suggest
&gt; that an eval is needed to keep perl alive after
&gt; trying to read a KML file.  At the least, please
&gt; document your recommended usage so folks
&gt; will know the danger and how to work around
&gt; the problem.
</div>
I do not see how people would be able to implement a generic
work-around for file-formats which are not supported.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m sorry I don&#39;t know more about why the check
&gt; for $^S fails in this case.  I do know that $^S is
&gt; undef when you call exit in my case.  If you
&gt; checked for defined&#40;&#41; first and then hand off to
&gt; exit, I think that would work around the crash
&gt; in the REPL for me.
</div>
According to perlvar/EXCEPTIONS_BEING_CAUGHT, &#34;undef&#34; means: error
during compilation of the code.

I think defined&#40;$^S&#41; will not work, because we need to stop the
program on compilation errors as well.  I will check this...
currently on holidays... so will take some time.
-- 
Regards,

               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
drs Mark A.C.J. Overmeer                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;05&nbsp;19:59:01&nbsp;2012</span>
    <span class="description">devel.chm.01 [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> &#34;devel.chm.01 [...] gmail.com via RT&#34; &lt;bug-Log-Report [...] rt.cpan.org&gt;,  chm [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #78224] Log::Report uses exit not die</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 05 Jul 2012 19:58:49 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> chm &lt;devel.chm.01 [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 7/5/2012 5:57 PM, Mark Overmeer wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; * Chris Marshall &#40;devel.chm.01@gmail.com&#41; [120705 20:54]:
<div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt;      my $data = try { Geo::KML-&gt;readFrom&#40;$file&#41; };
&gt;&gt;&gt;      die $@ if $@;
</div>&gt;&gt;
&gt;&gt; This is the first file IO routine that I have seen that kills perl
&gt;&gt; rather than returning some sort of status or exception.
</div>&gt;
&gt; Traditional modules in Perl do not use exception mechanisms.  If they
&gt; have such mechanisms, than I expect they will also die on fatal exceptions
&gt; which are not caught.
</div>
Correct, but the problem is that the current default
kills perl without the ability to recover.  It is ok
for that to be the implementation you choose but it
needs to be documented so folks can work around the
death of the interpreter.  The perl read builtin does
not die if it fails, just returns undef:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        read FILEHANDLE,SCALAR,LENGTH,OFFSET
&gt;        read FILEHANDLE,SCALAR,LENGTH
&gt;                Attempts to read LENGTH characters of data into variable SCALAR
&gt;                from the specified FILEHANDLE.  Returns the number of
&gt;                characters actually read, 0 at end of file, or undef if there
&gt;                was an error &#40;in the latter case $! is also set&#41;.  SCALAR will
&gt;                be grown or shrunk so that the last character actually read is
&gt;                the last character of the scalar after the read.
&gt;
&gt;                An OFFSET may be specified to place the read data at some place
&gt;                in the string other than the beginning.  A negative OFFSET
&gt;                specifies placement at that many characters counting backwards
&gt;                from the end of the string.  A positive OFFSET greater than the
&gt;                length of SCALAR results in the string being padded to the
&gt;                required size with &#34;\0&#34; bytes before the result of the read is
&gt;                appended.
&gt;
&gt;                The call is actually implemented in terms of either Perl&#39;s or
&gt;                system&#39;s fread&#40;&#41; call.  To get a true read&#40;2&#41; system call, see
&gt;                &#34;sysread&#34;.
&gt;
&gt;                Note the characters: depending on the status of the filehandle,
&gt;                either &#40;8-bit&#41; bytes or characters are read.  By default all
&gt;                filehandles operate on bytes, but for example if the filehandle
&gt;                has been opened with the &#34;:utf8&#34; I/O layer &#40;see &#34;open&#34;, and the
&gt;                &#34;open&#34; pragma, open&#41;, the I/O will operate on UTF-8 encoded
&gt;                Unicode characters, not bytes.  Similarly for the &#34;:encoding&#34;
&gt;                pragma: in that case pretty much any characters can be read.
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; I saw nothing in the Geo::KML docs to suggest
&gt;&gt; that an eval is needed to keep perl alive after
&gt;&gt; trying to read a KML file.  At the least, please
&gt;&gt; document your recommended usage so folks
&gt;&gt; will know the danger and how to work around
&gt;&gt; the problem.
</div>&gt;
&gt; I do not see how people would be able to implement a generic
&gt; work-around for file-formats which are not supported.
</div>
The problem isn&#39;t whether you can anticipate every
possible use of the modules, just that the current
implementation prevents any possible use outside
the scope you have envisioned.

In my case, if the file is bad, I can ask for another
file.  At the least, I would like the perl shell &#40;a.k.a.
the REPL to keep running&#41;...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; I&#39;m sorry I don&#39;t know more about why the check
&gt;&gt; for $^S fails in this case.  I do know that $^S is
&gt;&gt; undef when you call exit in my case.  If you
&gt;&gt; checked for defined&#40;&#41; first and then hand off to
&gt;&gt; exit, I think that would work around the crash
&gt;&gt; in the REPL for me.
</div>&gt;
&gt; According to perlvar/EXCEPTIONS_BEING_CAUGHT, &#34;undef&#34; means: error
&gt; during compilation of the code.
&gt;
&gt; I think defined&#40;$^S&#41; will not work, because we need to stop the
&gt; program on compilation errors as well.  I will check this...
&gt; currently on holidays... so will take some time.
</div>
Again, the approach appears to be kill perl if you
think something is wrong rather than letting the
user of your modules make that determination.  I&#39;m
just pointing out why some users might need a
different implementation and how it might be done.

Unfortunately, I&#39;m not enough of a perl5-porter to
understand or explain why $^S could be undef when it
*is* being run in an eval structure somewhere.  The
current approach makes Log::Report pretty much
unusable for a my application&#40;s&#41; since in general I
try to localize the exception handling as much as
possible rather than having to wrap every line with
try {} catch {}.  It needs to be documented at
the least.

I appreciate the dialog.  Have a good holiday.

--Chris
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;06&nbsp;09:59:01&nbsp;2012</span>
    <span class="description">chm [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza">On Thu Jul 05 19:59:01 2012, devel.chm.01@gmail.com wrote: <br>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 7/5/2012 5:57 PM, Mark Overmeer wrote: <br>
<div class="message-stanza open">&gt; &gt; <br>

&gt; &gt; According to perlvar/EXCEPTIONS_BEING_CAUGHT, &quot;undef&quot; means: error <br>

&gt; &gt; during compilation of the code. <br>
</div></div><br>

I read perlvar/EXCEPTIONS_BEING_CAUGHT as<br>

undef means we are parsing a module or eval *and*<br>

that the undef may also occur in $SIG{__DIE__} and<br>

$SIG{__WARN__} handlers.<br>

<br>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &gt; I think defined($^S) will not work, because we need to stop the <br>

&gt; &gt; program on compilation errors as well.  I will check this... <br>

&gt; &gt; currently on holidays... so will take some time. <br>
</div><br>

This is not a compile time error in Geo::KML which<br>

is using Log::Report and the exit here is not because<br>

of a perl compile/syntax problem.<br>

<br>

I tried this on a win32 Strawberry Perl Portable install<br>

v5.16.0 and saw the identical behavior so the issue<br>

is not v5.10.1 specific (cygwin has an old perl).&nbsp; The<br>

simplest way to reproduce exactly my test case, just<br>

install Devel::REPL and run the re.pl shell script.<br>

Then:<br>

<br>

$ use Geo::KML<br>

$ my ($ns,$data) = Geo::KML-&gt;from('a_kml_data_file.kml')<br>

&lt;boom&gt;<br>

<br>

Back to your command prompt, le perl est mort.<br>

<br>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;06&nbsp;10:00:29&nbsp;2012</span>
    <span class="description">chm [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza">On Fri Jul 06 09:59:01 2012, CHM wrote: <br>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Jul 05 19:59:01 2012, devel.chm.01@gmail.com wrote: <br>
<div class="message-stanza open">&gt; &gt; On 7/5/2012 5:57 PM, Mark Overmeer wrote: <br>
<div class="message-stanza open">&gt; &gt; &gt; <br>

&gt; &gt; &gt; According to perlvar/EXCEPTIONS_BEING_CAUGHT, &quot;undef&quot; means: error <br>

&gt; &gt; &gt; during compilation of the code. <br>
</div></div>&gt;  <br>

&gt; I read perlvar/EXCEPTIONS_BEING_CAUGHT as <br>

&gt; undef means we are parsing a module or eval *and* <br>

&gt; that the undef may also occur in $SIG{__DIE__} and <br>

&gt; $SIG{__WARN__} handlers. <br>

&gt;  <br>
<div class="message-stanza open">&gt; &gt; &gt; I think defined($^S) will not work, because we need to stop the <br>

&gt; &gt; &gt; program on compilation errors as well. I will check this... <br>

&gt; &gt; &gt; currently on holidays... so will take some time. <br>
</div>&gt;  <br>

&gt; This is not a compile time error in Geo::KML which <br>

&gt; is using Log::Report and the exit here is not because <br>

&gt; of a perl compile/syntax problem. <br>

&gt;  <br>

&gt; I tried this on a win32 Strawberry Perl Portable install <br>

&gt; v5.16.0 and saw the identical behavior so the issue <br>

&gt; is not v5.10.1 specific (cygwin has an old perl). The <br>

&gt; simplest way to reproduce exactly my test case, just <br>

&gt; install Devel::REPL and run the re.pl shell script. <br>

&gt; Then: <br>

&gt;  <br>

&gt; $ use Geo::KML <br>

&gt; $ my ($ns,$data) = Geo::KML-&gt;from('a_kml_data_file.kml') <br>

&gt; &lt;boom&gt; <br>

&gt;  <br>

&gt; Back to your command prompt, le perl est mort. <br>
</div><br>

Where a_kml_data_file.kml should be a one that<br>

fails to load so the $stop code is called.<br>

<br>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;06&nbsp;16:01:21&nbsp;2012</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #78224] Log::Report uses exit not die</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 6 Jul 2012 22:01:05 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;devel.chm.01 [...] gmail.com via RT&#34; &lt;bug-Log-Report [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* chm &#40;devel.c hm.01@gmail.com&#41; [120705 23:58]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Correct, but the problem is that the current default kills perl without
&gt; the ability to recover. 
</div>
It seems that you are not reading my responses.  You are totally
Mistake.  I will try it for a last time &#40;let&#39;s hope the coin drops&#41;
This way you avoid Perl to be killed and implement recovery:

   use Log::Report qw/error try/;
   my $r = try { error &#34;crash&#34; };

try&#40;&#41; is a smart eval&#40;&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The perl read builtin does not die if it fails, just returns undef:
</div>
Of course, because read&#40;&#41; is an abstraction level lower.  And read&#40;&#41; of
Perl is not in the simplistic exception model.  Log::Report implements
an exception model. In Java, for instance, readLine&#40;&#41; does throw an
IOException, which is an exit when not caught.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The problem isn&#39;t whether you can anticipate every
&gt; possible use of the modules, just that the current
&gt; implementation prevents any possible use outside
&gt; the scope you have envisioned.
</div>
Geo::KML is a &#34;Final&#34; module with respect to parsing the KML files,
not meant to be extended.  &#40;I really do not see any real-life purpose
for that.&#41;  And you can always catch&#40;&#41; as in any Exception model.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In my case, if the file is bad, I can ask for another
&gt; file.  At the least, I would like the perl shell &#40;a.k.a.
&gt; the REPL to keep running&#41;...
</div>
So, wrap try&#40;&#41; around it.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; try {} catch {}.  It needs to be documented at
&gt; the least.
</div>
If you wish.  In this respect you have a point: the synopsis tell
us that failure is reported as simple &#34;undef&#34; on the namespace...
but that&#39;s only for a subset of problems.

In general, Perl programmers know that they can wrap &#34;die&#40;&#41;s&#34; with
evals, which works here as well.  Log::Report::try&#40;&#41; is a bit more
powerful in this particular case.  Many modules carp&#40;&#41; and confess&#40;&#41;
where you have to eval them as well.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
drs Mark A.C.J. Overmeer                                MARKOV Solutions
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;06&nbsp;21:22:06&nbsp;2012</span>
    <span class="description">devel.chm.01 [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> chm [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #78224] Log::Report uses exit not die</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 06 Jul 2012 21:21:53 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Log-Report [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> chm &lt;devel.chm.01 [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 7/6/2012 4:01 PM, Mark Overmeer via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=78224">https://rt.cpan.org/Ticket/Display.html?id=78224</a></span> &gt;
&gt;
&gt; * chm &#40;devel.c hm.01@gmail.com&#41; [120705 23:58]:
<div class="message-stanza open">&gt;&gt; Correct, but the problem is that the current default kills perl without
&gt;&gt; the ability to recover.
</div>&gt;
&gt; It seems that you are not reading my responses.  You are totally
&gt; Mistake.  I will try it for a last time &#40;let&#39;s hope the coin drops&#41;
</div>
I think we disagree on the &#34;benefit&#34; of calls
to exit from perl modules from a software reuse
point of view.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This way you avoid Perl to be killed and implement recovery:
</div>
I have already explained that I don&#39;t want to
special-case wrap things in extra evals so that
exit won&#39;t be called.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;     use Log::Report qw/error try/;
&gt;     my $r = try { error &#34;crash&#34; };
&gt;
&gt; try&#40;&#41; is a smart eval&#40;&#41;
</div>
The Devel::REPL is running its code in an eval but
I realized that since it uses Moose stuff with all
the meta-object abstractions---that implementation
happens at compile time &#40;which is how undef can be
returned in $^S.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; The perl read builtin does not die if it fails, just returns undef:
</div>&gt;
&gt; Of course, because read&#40;&#41; is an abstraction level lower.  And read&#40;&#41; of
&gt; Perl is not in the simplistic exception model.  Log::Report implements
&gt; an exception model. In Java, for instance, readLine&#40;&#41; does throw an
&gt; IOException, which is an exit when not caught.
</div>
Apparenty, Log::Read requires one to use its own
try mechanism as it apparently ignores plain perl
eval in some cases &#40;unfortunately the one I have&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; The problem isn&#39;t whether you can anticipate every
&gt;&gt; possible use of the modules, just that the current
&gt;&gt; implementation prevents any possible use outside
&gt;&gt; the scope you have envisioned.
</div>&gt;
&gt; Geo::KML is a &#34;Final&#34; module with respect to parsing the KML files,
&gt; not meant to be extended.  &#40;I really do not see any real-life purpose
&gt; for that.&#41;  And you can always catch&#40;&#41; as in any Exception model.
&gt;
<div class="message-stanza open">&gt;&gt; In my case, if the file is bad, I can ask for another
&gt;&gt; file.  At the least, I would like the perl shell &#40;a.k.a.
&gt;&gt; the REPL to keep running&#41;...
</div>&gt;
&gt; So, wrap try&#40;&#41; around it.
</div>
I have already explained that I don&#39;t want to
special-case wrap things in extra evals so that
exit won&#39;t be called.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; try {} catch {}.  It needs to be documented at
&gt;&gt; the least.
</div>&gt;
&gt; If you wish.  In this respect you have a point: the synopsis tell
&gt; us that failure is reported as simple &#34;undef&#34; on the namespace...
&gt; but that&#39;s only for a subset of problems.
&gt;
&gt; In general, Perl programmers know that they can wrap &#34;die&#40;&#41;s&#34; with
&gt; evals, which works here as well.  Log::Report::try&#40;&#41; is a bit more
&gt; powerful in this particular case.  Many modules carp&#40;&#41; and confess&#40;&#41;
&gt; where you have to eval them as well.
</div>
If by &#34;powerful&#34; you mean &#34;fatal in some cases&#34;,
yes.

I&#39;ve managed to convince myself that I understand
why $^S was undef for my Devel::REPL and still be
in an evident eval.  &#40;See the Devel::REPL source
for details&#41;.

I still believe that Log::Report would be a more
powerful and useful module if it did not exit
the perl interpreter &#40;perhaps unless requested
by the use-er&#41;.

Regards and thanks for the Geo::KML and contributing
to perl.

Regards,
Chris
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;28&nbsp;03:13:52&nbsp;2012</span>
    <span class="description">MARKOV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">User mistaken
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;28&nbsp;03:13:53&nbsp;2012</span>
    <span class="description">MARKOV [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
