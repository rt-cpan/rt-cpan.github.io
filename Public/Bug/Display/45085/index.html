<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #45085 for Image-EXIF: Patch to Image-EXIF-1.00.3</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #45085 for Image-EXIF: Patch to Image-EXIF-1.00.3</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Image-EXIF/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Image-EXIF/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Image-EXIF/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Image-EXIF/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Image-EXIF">Image-EXIF CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">45085</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Image-EXIF/Active/">Image-EXIF</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
kivinen [...] iki.fi

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-16622-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-16623-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;16&nbsp;09:55:44&nbsp;2009</span>
    <span class="description">kivinen [...] iki.fi -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Patch to Image-EXIF-1.00.3</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 16 Apr 2009 16:55:07 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Image-EXIF [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tero Kivinen &lt;kivinen [...] iki.fi&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Following patch fixed 2 bugs in the Image-EXIF-1.00.3. The first bug
is that the the get_props returns next ep pointer, and if that is used
to check whether value should be returned or not, the perl part will
never get the last key in the ep list &#40;i.e. when the ep points to last
item, it fills in the value, and field, but returns null as return
value, as the next ep is null, the c_fetch then didn&#39;t return those
filled values up as it checked return value&#41;. I changed this now so
that we still  return values in that situation and only check in the
next call that if ep is null when c_fetch is called, then we return
undef.

Another bug is in the exifgps where it uses unsigned n and d, and then
tries to multiple n with -1 to make it negative, when this is
converted to the doubles, it will get unsigned value, thus returning
huge positive value instead of negative. I fixed this by moving the
check for negative values after double alt has been calculated and
multiplied it with -1 if negative values were needed.
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -ur Image-EXIF-1.00.3/EXIF.xs Image-EXIF-1.00.3.patched/EXIF.xs
--- Image-EXIF-1.00.3/EXIF.xs	2004-08-12 22:32:32.000000000 +0300
+++ Image-EXIF-1.00.3.patched/EXIF.xs	2009-04-16 14:10:29.000000000 +0300
@@ -205,8 +205,8 @@
 	char field[256] = &#34;&#34;;
 	char value[256] = &#34;&#34;;
 
-	int rc = get_props&#40;field, value&#41;;
-	if &#40;rc&#41;{
+	if &#40;ep&#41; {
+		int rc = get_props&#40;field, value&#41;;
 		EXTEND&#40;sp, 2&#41;;
 		PUSHs&#40;sv_2mortal&#40;newSVpv&#40;&#40;char*&#41;field, 0&#41;&#41;&#41;;
 		PUSHs&#40;sv_2mortal&#40;newSVpv&#40;&#40;char*&#41;value, 0&#41;&#41;&#41;;
Only in Image-EXIF-1.00.3: Makefile
diff -ur Image-EXIF-1.00.3/exifgps.c Image-EXIF-1.00.3.patched/exifgps.c
--- Image-EXIF-1.00.3/exifgps.c	2005-01-05 02:28:22.000000000 +0200
+++ Image-EXIF-1.00.3.patched/exifgps.c	2009-04-16 15:11:06.000000000 +0300
@@ -339,17 +339,17 @@
 		n = exif4byte&#40;t-&gt;md.btiff + prop-&gt;value, o&#41;;
 		d = exif4byte&#40;t-&gt;md.btiff + prop-&gt;value + 4, o&#41;;
 
-		/* Look up reference.  Non-zero means negative altitude. */
-
-		tmpprop = findprop&#40;t-&gt;props, gpstags, 0x0005&#41;;
-		if &#40;tmpprop &#38;&#38; tmpprop-&gt;value&#41;
-			n *= -1;
-
 		if &#40;!n || !d&#41;
 			alt = 0.0;
 		else
 			alt = &#40;double&#41;n / &#40;double&#41;d;
 
+		/* Look up reference.  Non-zero means negative altitude. */
+
+		tmpprop = findprop&#40;t-&gt;props, gpstags, 0x0005&#41;;
+		if &#40;tmpprop &#38;&#38; tmpprop-&gt;value&#41;
+			alt *= -1;
+
 		/* Should already have a 32-byte buffer from parsetag&#40;&#41;. */
 
 		snprintf&#40;prop-&gt;str, 31, &#34;%.2f m&#34;, alt&#41;;
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">-- 
kivinen@iki.fi
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;07&nbsp;06:41:01&nbsp;2012</span>
    <span class="description">cpan [...] aaroncrane.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for your report, Tero. I’ve recently taken over maintainership of Image::EXIF, and I’ve just 
released Image::EXIF 2.00:

<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/release/Image-EXIF">https://metacpan.org/release/Image-EXIF</a></span>

This new release contains a fix for the first part of your bug report &#40;though the implementation 
is now completely different, so your patch isn&#39;t included&#41;.

However, I’m a little hesitant to apply your exifgps.c patch, because that file comes directly from 
the underlying exiftags software by Eric Johnston:

<span class="clickylink"><a target="new" rel="nofollow" href="http://johnst.org/sw/exiftags/">http://johnst.org/sw/exiftags/</a></span>

Could I suggest you submit that part of your report to him? If he accepts it, I&#39;ll do another 
Image::EXIF release with the updated exiftags. If he doesn&#39;t accept it for whatever reason, I’ll 
reconsider the situation, but I do think it’s valuable to keep the embedded copy of exiftags 
pristine if possible.

Does that make sense?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;07&nbsp;06:41:04&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;26&nbsp;10:11:57&nbsp;2012</span>
    <span class="description">cpan [...] aaroncrane.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m marking this ticket &#34;rejected&#34;, because I haven&#39;t heard back from you on the question of 
resubmitting the bug upstream.

If you disagree, please reopen this ticket, or submit a new one.

Thanks.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;26&nbsp;10:11:57&nbsp;2012</span>
    <span class="description">cpan [...] aaroncrane.co.uk -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
