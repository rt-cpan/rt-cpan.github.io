<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #124941 for DBD-SQLite: Using SQLite::VirtualTable::PerlData, can&#39;t find completely numeric values in a virtual table column defined as text</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #124941 for DBD-SQLite: Using SQLite::VirtualTable::PerlData, can&#39;t find completely numeric values in a virtual table column defined as text</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBD-SQLite">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBD-SQLite">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBD-SQLite">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBD-SQLite">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-SQLite">DBD-SQLite CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">124941</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBD-SQLite">DBD-SQLite</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
tomwitt2 [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10248-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10249-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=124941">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1779006" href="/Public/Bug/Display.html?id=124941#txn-1779006">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;27&nbsp;11:17:10&nbsp;2018</span>
    <span class="description">tomwitt2 [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Using SQLite::VirtualTable::PerlData, can&#39;t find completely numeric values in a virtual table column defined as text</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 27 Mar 2018 15:16:42 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-SQLite [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tom Wittbrodt &lt;tomwitt2 [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1779006/957221/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/957221">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi.

I&#39;m trying to use the SQLite::VirtualTable::PerlData module but I&#39;ve run
into a snag where values which are entirely numeric values, in a defined
text column, are not being found.

Text values are seen correctly but text values comprised solely of numbers
are not being seen.

These are the details of the system on which I&#39;m testing.

Module of concern: SQLite::VirtualTable::PerlData

$&gt; cat /etc/lsb-release
DISTRIB_ID=Ubuntu
DISTRIB_RELEASE=14.04
DISTRIB_CODENAME=trusty
DISTRIB_DESCRIPTION=&#34;Ubuntu 14.04.5 LTS&#34;

$&gt; uname -a
Linux hostname_redacted 3.13.0-132-generic #181-Ubuntu SMP Wed Sep 13
13:25:03 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux

perl version 5.18.2

$&gt;perlmodver DBD::SQLite DBI  Test::More
DBD::SQLite         : 1.56
DBI                 : 1.636
Test::More          : 1.302062

A sample script which illustrates the problem follows.  The mixed data
&#40;searching for numbers and text&#41; and number only &#40;searching for only number
values&#41; fail.


#!/usr/bin/env perl
#-----------------------------------------------------------------------------
#
#  test_sqlite_virtual_perldata.pl
#
#  Quick test program to show problems where the SQLite::Virtual::PerlData
#  issues when selecting numbers from a column defined as text
#
#-----------------------------------------------------------------------------

use DBI;
use DBD::SQLite;
use Test::More tests =&gt; 4;

my $dbh = DBI-&gt;connect&#40;&#34;dbi:SQLite:dbname=mixed_data.db&#34;, &#39;&#39;, &#39;&#39;,
{RaiseError =&gt; 1, AutoCommit =&gt; 1}&#41;;
# register the module and declare the virtual table
$dbh-&gt;sqlite_create_module&#40;perl =&gt; &#34;DBD::SQLite::VirtualTable::PerlData&#34;&#41;;

# create a table, reference_values,  with 2 columns
# ref_value - a text column which will have strings and numeric data &#40;as
text&#41;
# our_id    - a numeric column with integers
$dbh-&gt;do&#40;&#39;DROP TABLE IF EXISTS reference_values&#39;&#41;;
$dbh-&gt;do&#40;&#39;CREATE TABLE reference_values&#40;ref_value text, our_id int&#41;&#39;&#41;;

my @data_to_insert = &#40;
    [ &#39;aaaa&#39;, 1 ],
    [ &#39;bbbb&#39;, 2 ],
    [ &#39;cccc&#39;, 3 ],
    [ &#39;xxxx&#39;, 4 ],
    [ &#39;yyyy&#39;, 5 ],
    [ &#39;0003&#39;, 6 ],
    [ &#39;1000&#39;, 7 ],
    [ &#39;2222&#39;, 8 ],
    [ &#39;3000&#39;, 9 ],
    [ &#39;4000&#39;, 10 ],
    [ &#39;5abc&#39;, 11 ],
    [ &#39;a6cd&#39;, 12 ],
    [ &#39;ab7d&#39;, 13 ],
    [ &#39;abc8&#39;, 14 ],
    [ &#39;9aaa&#39;, 15 ],
&#41;;

my $sth = $dbh-&gt;prepare&#40;&#39;INSERT INTO reference_values VALUES &#40;?, ?&#41;&#39;&#41;;
foreach my $data_aref &#40;@data_to_insert&#41; {
    $sth-&gt;execute&#40;@$data_aref&#41;
or die &#34;Couldn&#39;t insert data row:&#34; . $dbh-&gt;errstr;
}

# these are data sets that will be used by the virtual perldata function
# we&#39;ll add these as a virtual table then do an inner join on our
reference_value
# table to find matching values
my $text_column_search_sets = {
    strings_only  =&gt; [ qw&#40; aaaa abcd bbbb bcde cccc yyyy &#41; ],
    mixed         =&gt; [ qw&#40; aaaa 0003 z8z8 6666 cccc 1000 zzzz 7777 &#41; ],
    initial_digit =&gt; [ qw&#40; 1aaa 2bbb 5abc 6abc 9aaa 3aaa 1aaa 2aaa &#41; ],
    numbers_only  =&gt; [ qw&#40; 0001 0003 9999 1000 5555 3000 6666 4000 &#41; ] ,
};

my $expected_answers = {
    strings_only =&gt;
        [ [ &#39;aaaa&#39;, 1 ], [ &#39;bbbb&#39;, 2 ], [ &#39;cccc&#39;, 3 ], [ &#39;yyyy&#39;, 5 ] ],
    mixed =&gt; [ [ &#39;aaaa&#39;, 1 ], [ &#39;cccc&#39;, 3 ], [ &#39;0003&#39;, 6 ], [ &#39;1000&#39;, 7 ] ],
    initial_digit =&gt; [ [ &#39;5abc&#39;, 11 ], [ &#39;9aaa&#39;, 15 ] ],
    numbers_only =&gt;
        [ [ &#39;0003&#39;, 6 ], [ &#39;1000&#39;, 7 ], [ &#39;3000&#39;, 9 ], [ &#39;4000&#39;, 10 ] ]
};

our $search_value_set;
my $temp_table_number = 0;

my @test_order = qw&#40;strings_only mixed initial_digit numbers_only &#41;;

foreach my $test_desc &#40;@test_order&#41; {

    $temp_table_number++;
    my $temp_table_name = &#39;temp.lookup_values_&#39; . $temp_table_number;
    $search_value_set    = $text_column_search_sets-&gt;{$test_desc};

    my $virt_table_sql =&lt;&lt; &#34;EOT&#34;;
    CREATE VIRTUAL TABLE $temp_table_name
    USING perl&#40;lookup_value text, colref=&#34;main::search_value_set&#34;&#41;
EOT

    $dbh-&gt;do&#40;$virt_table_sql&#41;;

    my $lookup_sql =&lt;&lt; &#34;EOT&#34;;
    select ref_value, our_id from reference_values
    inner join $temp_table_name
    on $temp_table_name.lookup_value = reference_values.ref_value
EOT

    my $got_aref = $dbh-&gt;selectall_arrayref&#40;$lookup_sql&#41;;
    my $expected_aref = $expected_answers-&gt;{$test_desc};

    is_deeply&#40;$got_aref, $expected_aref, $test_desc&#41;;
}
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1779006/957222/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/957222">with headers</a>
<br />
<span class="downloadcontenttype">text/html 6k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1818043" href="/Public/Bug/Display.html?id=124941#txn-1818043">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;03&nbsp;08:05:51&nbsp;2018</span>
    <span class="description">ishigaki [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1818043/978183/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/978183">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Mar 28 00:17:10 2018, tomwitt2@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi.
&gt; 
&gt; I&#39;m trying to use the SQLite::VirtualTable::PerlData module but I&#39;ve
&gt; run
&gt; into a snag where values which are entirely numeric values, in a
&gt; defined
&gt; text column, are not being found.
&gt; 
&gt; Text values are seen correctly but text values comprised solely of
&gt; numbers
&gt; are not being seen.
&gt; 
&gt; These are the details of the system on which I&#39;m testing.
&gt; 
&gt; Module of concern: SQLite::VirtualTable::PerlData
&gt; 
&gt; $&gt; cat /etc/lsb-release
&gt; DISTRIB_ID=Ubuntu
&gt; DISTRIB_RELEASE=14.04
&gt; DISTRIB_CODENAME=trusty
&gt; DISTRIB_DESCRIPTION=&#34;Ubuntu 14.04.5 LTS&#34;
&gt; 
&gt; $&gt; uname -a
&gt; Linux hostname_redacted 3.13.0-132-generic #181-Ubuntu SMP Wed Sep 13
&gt; 13:25:03 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux
&gt; 
&gt; perl version 5.18.2
&gt; 
&gt; $&gt;perlmodver DBD::SQLite DBI  Test::More
&gt; DBD::SQLite         : 1.56
&gt; DBI                 : 1.636
&gt; Test::More          : 1.302062
&gt; 
&gt; A sample script which illustrates the problem follows.  The mixed data
&gt; &#40;searching for numbers and text&#41; and number only &#40;searching for only
&gt; number
&gt; values&#41; fail.
&gt; 
&gt; 
&gt; #!/usr/bin/env perl
&gt; #-----------------------------------------------------------------------------
&gt; #
&gt; #  test_sqlite_virtual_perldata.pl
&gt; #
&gt; #  Quick test program to show problems where the
&gt; SQLite::Virtual::PerlData
&gt; #  issues when selecting numbers from a column defined as text
&gt; #
&gt; #-----------------------------------------------------------------------------
&gt; 
&gt; use DBI;
&gt; use DBD::SQLite;
&gt; use Test::More tests =&gt; 4;
&gt; 
&gt; my $dbh = DBI-&gt;connect&#40;&#34;dbi:SQLite:dbname=mixed_data.db&#34;, &#39;&#39;, &#39;&#39;,
&gt; {RaiseError =&gt; 1, AutoCommit =&gt; 1}&#41;;
&gt; # register the module and declare the virtual table
&gt; $dbh-&gt;sqlite_create_module&#40;perl =&gt;
&gt; &#34;DBD::SQLite::VirtualTable::PerlData&#34;&#41;;
&gt; 
&gt; # create a table, reference_values,  with 2 columns
&gt; # ref_value - a text column which will have strings and numeric data
&gt; &#40;as
&gt; text&#41;
&gt; # our_id    - a numeric column with integers
&gt; $dbh-&gt;do&#40;&#39;DROP TABLE IF EXISTS reference_values&#39;&#41;;
&gt; $dbh-&gt;do&#40;&#39;CREATE TABLE reference_values&#40;ref_value text, our_id int&#41;&#39;&#41;;
&gt; 
&gt; my @data_to_insert = &#40;
&gt;     [ &#39;aaaa&#39;, 1 ],
&gt;     [ &#39;bbbb&#39;, 2 ],
&gt;     [ &#39;cccc&#39;, 3 ],
&gt;     [ &#39;xxxx&#39;, 4 ],
&gt;     [ &#39;yyyy&#39;, 5 ],
&gt;     [ &#39;0003&#39;, 6 ],
&gt;     [ &#39;1000&#39;, 7 ],
&gt;     [ &#39;2222&#39;, 8 ],
&gt;     [ &#39;3000&#39;, 9 ],
&gt;     [ &#39;4000&#39;, 10 ],
&gt;     [ &#39;5abc&#39;, 11 ],
&gt;     [ &#39;a6cd&#39;, 12 ],
&gt;     [ &#39;ab7d&#39;, 13 ],
&gt;     [ &#39;abc8&#39;, 14 ],
&gt;     [ &#39;9aaa&#39;, 15 ],
&gt; &#41;;
&gt; 
&gt; my $sth = $dbh-&gt;prepare&#40;&#39;INSERT INTO reference_values VALUES &#40;?, ?&#41;&#39;&#41;;
&gt; foreach my $data_aref &#40;@data_to_insert&#41; {
&gt;     $sth-&gt;execute&#40;@$data_aref&#41;
&gt; or die &#34;Couldn&#39;t insert data row:&#34; . $dbh-&gt;errstr;
&gt; }
&gt; 
&gt; # these are data sets that will be used by the virtual perldata
&gt; function
&gt; # we&#39;ll add these as a virtual table then do an inner join on our
&gt; reference_value
&gt; # table to find matching values
&gt; my $text_column_search_sets = {
&gt;     strings_only  =&gt; [ qw&#40; aaaa abcd bbbb bcde cccc yyyy &#41; ],
&gt;     mixed         =&gt; [ qw&#40; aaaa 0003 z8z8 6666 cccc 1000 zzzz 7777 &#41;
&gt; ],
&gt;     initial_digit =&gt; [ qw&#40; 1aaa 2bbb 5abc 6abc 9aaa 3aaa 1aaa 2aaa &#41;
&gt; ],
&gt;     numbers_only  =&gt; [ qw&#40; 0001 0003 9999 1000 5555 3000 6666 4000 &#41; ]
&gt; ,
&gt; };
&gt; 
&gt; my $expected_answers = {
&gt;     strings_only =&gt;
&gt;         [ [ &#39;aaaa&#39;, 1 ], [ &#39;bbbb&#39;, 2 ], [ &#39;cccc&#39;, 3 ], [ &#39;yyyy&#39;, 5 ]
&gt; ],
&gt;     mixed =&gt; [ [ &#39;aaaa&#39;, 1 ], [ &#39;cccc&#39;, 3 ], [ &#39;0003&#39;, 6 ], [ &#39;1000&#39;,
&gt; 7 ] ],
&gt;     initial_digit =&gt; [ [ &#39;5abc&#39;, 11 ], [ &#39;9aaa&#39;, 15 ] ],
&gt;     numbers_only =&gt;
&gt;         [ [ &#39;0003&#39;, 6 ], [ &#39;1000&#39;, 7 ], [ &#39;3000&#39;, 9 ], [ &#39;4000&#39;, 10 ]
&gt; ]
&gt; };
&gt; 
&gt; our $search_value_set;
&gt; my $temp_table_number = 0;
&gt; 
&gt; my @test_order = qw&#40;strings_only mixed initial_digit numbers_only &#41;;
&gt; 
&gt; foreach my $test_desc &#40;@test_order&#41; {
&gt; 
&gt; $temp_table_number++;
&gt; my $temp_table_name = &#39;temp.lookup_values_&#39; . $temp_table_number;
&gt; $search_value_set    = $text_column_search_sets-&gt;{$test_desc};
&gt; 
&gt; my $virt_table_sql =&lt;&lt; &#34;EOT&#34;;
&gt; CREATE VIRTUAL TABLE $temp_table_name
&gt; USING perl&#40;lookup_value text, colref=&#34;main::search_value_set&#34;&#41;
&gt; EOT
&gt; 
&gt; $dbh-&gt;do&#40;$virt_table_sql&#41;;
&gt; 
&gt; my $lookup_sql =&lt;&lt; &#34;EOT&#34;;
&gt; select ref_value, our_id from reference_values
&gt; inner join $temp_table_name
&gt; on $temp_table_name.lookup_value = reference_values.ref_value
&gt; EOT
&gt; 
&gt; my $got_aref = $dbh-&gt;selectall_arrayref&#40;$lookup_sql&#41;;
&gt; my $expected_aref = $expected_answers-&gt;{$test_desc};
&gt; 
&gt; is_deeply&#40;$got_aref, $expected_aref, $test_desc&#41;;
&gt; }
</div>

Fixed with <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/DBD-SQLite/DBD-SQLite/commit/113ca70aa55e35f22909ba6ba36e0b1c50d50a65">https://github.com/DBD-SQLite/DBD-SQLite/commit/113ca70aa55e35f22909ba6ba36e0b1c50d50a65</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1818044" href="/Public/Bug/Display.html?id=124941#txn-1818044">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;03&nbsp;08:05:53&nbsp;2018</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1818047" href="/Public/Bug/Display.html?id=124941#txn-1818047">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;03&nbsp;08:05:55&nbsp;2018</span>
    <span class="description">ishigaki [...] cpan.org -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1822598" href="/Public/Bug/Display.html?id=124941#txn-1822598">#</a>      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;01&nbsp;03:02:52&nbsp;2018</span>
    <span class="description">ishigaki [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1822598/980550/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/980550">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Nov 03 21:05:51 2018, ISHIGAKI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Mar 28 00:17:10 2018, tomwitt2@gmail.com wrote:
<div class="message-stanza open">&gt; &gt; Hi.
&gt; &gt;
&gt; &gt; I&#39;m trying to use the SQLite::VirtualTable::PerlData module but I&#39;ve
&gt; &gt; run
&gt; &gt; into a snag where values which are entirely numeric values, in a
&gt; &gt; defined
&gt; &gt; text column, are not being found.
&gt; &gt;
&gt; &gt; Text values are seen correctly but text values comprised solely of
&gt; &gt; numbers
&gt; &gt; are not being seen.
&gt; &gt;
&gt; &gt; These are the details of the system on which I&#39;m testing.
&gt; &gt;
&gt; &gt; Module of concern: SQLite::VirtualTable::PerlData
&gt; &gt;
&gt; &gt; $&gt; cat /etc/lsb-release
&gt; &gt; DISTRIB_ID=Ubuntu
&gt; &gt; DISTRIB_RELEASE=14.04
&gt; &gt; DISTRIB_CODENAME=trusty
&gt; &gt; DISTRIB_DESCRIPTION=&#34;Ubuntu 14.04.5 LTS&#34;
&gt; &gt;
&gt; &gt; $&gt; uname -a
&gt; &gt; Linux hostname_redacted 3.13.0-132-generic #181-Ubuntu SMP Wed Sep 13
&gt; &gt; 13:25:03 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux
&gt; &gt;
&gt; &gt; perl version 5.18.2
&gt; &gt;
&gt; &gt; $&gt;perlmodver DBD::SQLite DBI  Test::More
&gt; &gt; DBD::SQLite         : 1.56
&gt; &gt; DBI                 : 1.636
&gt; &gt; Test::More          : 1.302062
&gt; &gt;
&gt; &gt; A sample script which illustrates the problem follows.  The mixed
&gt; &gt; data
&gt; &gt; &#40;searching for numbers and text&#41; and number only &#40;searching for only
&gt; &gt; number
&gt; &gt; values&#41; fail.
&gt; &gt;
&gt; &gt;
&gt; &gt; #!/usr/bin/env perl
&gt; &gt; #-----------------------------------------------------------------------------
&gt; &gt; #
&gt; &gt; #  test_sqlite_virtual_perldata.pl
&gt; &gt; #
&gt; &gt; #  Quick test program to show problems where the
&gt; &gt; SQLite::Virtual::PerlData
&gt; &gt; #  issues when selecting numbers from a column defined as text
&gt; &gt; #
&gt; &gt; #-----------------------------------------------------------------------------
&gt; &gt;
&gt; &gt; use DBI;
&gt; &gt; use DBD::SQLite;
&gt; &gt; use Test::More tests =&gt; 4;
&gt; &gt;
&gt; &gt; my $dbh = DBI-&gt;connect&#40;&#34;dbi:SQLite:dbname=mixed_data.db&#34;, &#39;&#39;, &#39;&#39;,
&gt; &gt; {RaiseError =&gt; 1, AutoCommit =&gt; 1}&#41;;
&gt; &gt; # register the module and declare the virtual table
&gt; &gt; $dbh-&gt;sqlite_create_module&#40;perl =&gt;
&gt; &gt; &#34;DBD::SQLite::VirtualTable::PerlData&#34;&#41;;
&gt; &gt;
&gt; &gt; # create a table, reference_values,  with 2 columns
&gt; &gt; # ref_value - a text column which will have strings and numeric data
&gt; &gt; &#40;as
&gt; &gt; text&#41;
&gt; &gt; # our_id    - a numeric column with integers
&gt; &gt; $dbh-&gt;do&#40;&#39;DROP TABLE IF EXISTS reference_values&#39;&#41;;
&gt; &gt; $dbh-&gt;do&#40;&#39;CREATE TABLE reference_values&#40;ref_value text, our_id
&gt; &gt; int&#41;&#39;&#41;;
&gt; &gt;
&gt; &gt; my @data_to_insert = &#40;
&gt; &gt;     [ &#39;aaaa&#39;, 1 ],
&gt; &gt;     [ &#39;bbbb&#39;, 2 ],
&gt; &gt;     [ &#39;cccc&#39;, 3 ],
&gt; &gt;     [ &#39;xxxx&#39;, 4 ],
&gt; &gt;     [ &#39;yyyy&#39;, 5 ],
&gt; &gt;     [ &#39;0003&#39;, 6 ],
&gt; &gt;     [ &#39;1000&#39;, 7 ],
&gt; &gt;     [ &#39;2222&#39;, 8 ],
&gt; &gt;     [ &#39;3000&#39;, 9 ],
&gt; &gt;     [ &#39;4000&#39;, 10 ],
&gt; &gt;     [ &#39;5abc&#39;, 11 ],
&gt; &gt;     [ &#39;a6cd&#39;, 12 ],
&gt; &gt;     [ &#39;ab7d&#39;, 13 ],
&gt; &gt;     [ &#39;abc8&#39;, 14 ],
&gt; &gt;     [ &#39;9aaa&#39;, 15 ],
&gt; &gt; &#41;;
&gt; &gt;
&gt; &gt; my $sth = $dbh-&gt;prepare&#40;&#39;INSERT INTO reference_values VALUES &#40;?,
&gt; &gt; ?&#41;&#39;&#41;;
&gt; &gt; foreach my $data_aref &#40;@data_to_insert&#41; {
&gt; &gt;     $sth-&gt;execute&#40;@$data_aref&#41;
&gt; &gt; or die &#34;Couldn&#39;t insert data row:&#34; . $dbh-&gt;errstr;
&gt; &gt; }
&gt; &gt;
&gt; &gt; # these are data sets that will be used by the virtual perldata
&gt; &gt; function
&gt; &gt; # we&#39;ll add these as a virtual table then do an inner join on our
&gt; &gt; reference_value
&gt; &gt; # table to find matching values
&gt; &gt; my $text_column_search_sets = {
&gt; &gt;     strings_only  =&gt; [ qw&#40; aaaa abcd bbbb bcde cccc yyyy &#41; ],
&gt; &gt;     mixed         =&gt; [ qw&#40; aaaa 0003 z8z8 6666 cccc 1000 zzzz 7777 &#41;
&gt; &gt; ],
&gt; &gt;     initial_digit =&gt; [ qw&#40; 1aaa 2bbb 5abc 6abc 9aaa 3aaa 1aaa 2aaa &#41;
&gt; &gt; ],
&gt; &gt;     numbers_only  =&gt; [ qw&#40; 0001 0003 9999 1000 5555 3000 6666 4000 &#41;
&gt; &gt; ]
&gt; &gt; ,
&gt; &gt; };
&gt; &gt;
&gt; &gt; my $expected_answers = {
&gt; &gt;     strings_only =&gt;
&gt; &gt;         [ [ &#39;aaaa&#39;, 1 ], [ &#39;bbbb&#39;, 2 ], [ &#39;cccc&#39;, 3 ], [ &#39;yyyy&#39;, 5 ]
&gt; &gt; ],
&gt; &gt;     mixed =&gt; [ [ &#39;aaaa&#39;, 1 ], [ &#39;cccc&#39;, 3 ], [ &#39;0003&#39;, 6 ], [ &#39;1000&#39;,
&gt; &gt; 7 ] ],
&gt; &gt;     initial_digit =&gt; [ [ &#39;5abc&#39;, 11 ], [ &#39;9aaa&#39;, 15 ] ],
&gt; &gt;     numbers_only =&gt;
&gt; &gt;         [ [ &#39;0003&#39;, 6 ], [ &#39;1000&#39;, 7 ], [ &#39;3000&#39;, 9 ], [ &#39;4000&#39;, 10 ]
&gt; &gt; ]
&gt; &gt; };
&gt; &gt;
&gt; &gt; our $search_value_set;
&gt; &gt; my $temp_table_number = 0;
&gt; &gt;
&gt; &gt; my @test_order = qw&#40;strings_only mixed initial_digit numbers_only &#41;;
&gt; &gt;
&gt; &gt; foreach my $test_desc &#40;@test_order&#41; {
&gt; &gt;
&gt; &gt; $temp_table_number++;
&gt; &gt; my $temp_table_name = &#39;temp.lookup_values_&#39; . $temp_table_number;
&gt; &gt; $search_value_set    = $text_column_search_sets-&gt;{$test_desc};
&gt; &gt;
&gt; &gt; my $virt_table_sql =&lt;&lt; &#34;EOT&#34;;
&gt; &gt; CREATE VIRTUAL TABLE $temp_table_name
&gt; &gt; USING perl&#40;lookup_value text, colref=&#34;main::search_value_set&#34;&#41;
&gt; &gt; EOT
&gt; &gt;
&gt; &gt; $dbh-&gt;do&#40;$virt_table_sql&#41;;
&gt; &gt;
&gt; &gt; my $lookup_sql =&lt;&lt; &#34;EOT&#34;;
&gt; &gt; select ref_value, our_id from reference_values
&gt; &gt; inner join $temp_table_name
&gt; &gt; on $temp_table_name.lookup_value = reference_values.ref_value
&gt; &gt; EOT
&gt; &gt;
&gt; &gt; my $got_aref = $dbh-&gt;selectall_arrayref&#40;$lookup_sql&#41;;
&gt; &gt; my $expected_aref = $expected_answers-&gt;{$test_desc};
&gt; &gt;
&gt; &gt; is_deeply&#40;$got_aref, $expected_aref, $test_desc&#41;;
&gt; &gt; }
</div>&gt; 
&gt; 
&gt; Fixed with <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/DBD-SQLite/DBD-">https://github.com/DBD-SQLite/DBD-</a></span>
&gt; SQLite/commit/113ca70aa55e35f22909ba6ba36e0b1c50d50a65
</div>

DBD::SQLite 1.60 with this patch was released. Thanks.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1822601" href="/Public/Bug/Display.html?id=124941#txn-1822601">#</a>      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;01&nbsp;03:02:54&nbsp;2018</span>
    <span class="description">ishigaki [...] cpan.org -  Status changed from &#39;patched&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.309145</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
