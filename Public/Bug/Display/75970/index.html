<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #75970 for Net-SSLeay: Adding NPN &#40;Next Protocol Negotiation&#41; support</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #75970 for Net-SSLeay: Adding NPN &#40;Next Protocol Negotiation&#41; support</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Net-SSLeay">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Net-SSLeay">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Net-SSLeay">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Net-SSLeay">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-SSLeay">Net-SSLeay CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">75970</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">30 min

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Net-SSLeay">Net-SSLeay</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">MIKEM [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
kmx [...] volny.cz

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-44414-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-44415-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




40_npn_support.t<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1055988/552495/40_npn_support.t">
Wed Mar 28 11:46:50 2012 (2.9k) by kmx [...] volny.cz
</a>
</font></li>
</ul>


callback_big_redesign_r238.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1054805/551758/callback_big_redesign_r238.diff">
Mon Mar 26 10:08:27 2012 (36.2k) by kmx [...] volny.cz
</a>
</font></li>
</ul>


callback_big_redesign_V2_r238.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1054976/551876/callback_big_redesign_V2_r238.diff">
Mon Mar 26 18:31:25 2012 (36.3k) by kmx [...] volny.cz
</a>
</font></li>
</ul>


fixing_compiler_warnings_r333.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1056248/552615/fixing_compiler_warnings_r333.diff">
Thu Mar 29 07:55:57 2012 (1.2k) by kmx [...] volny.cz
</a>
</font></li>
</ul>


fixing_compiler_warnings_V2_r333.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1056341/552668/fixing_compiler_warnings_V2_r333.diff">
Thu Mar 29 14:45:51 2012 (9k) by kmx [...] cpan.org
</a>
</font></li>
</ul>


improving_callback_stuff_r329.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1055807/552384/improving_callback_stuff_r329.diff">
Wed Mar 28 04:30:32 2012 (15.6k) by kmx [...] volny.cz
</a>
</font></li>
</ul>


npn_support_DRAFT_NOT_FOR_COMMIT.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1055254/552043/npn_support_DRAFT_NOT_FOR_COMMIT.diff">
Tue Mar 27 09:40:16 2012 (10.1k) by kmx [...] volny.cz
</a>
</font></li>
</ul>


npn_support_r331.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1055988/552494/npn_support_r331.diff">
Wed Mar 28 11:46:50 2012 (16.9k) by kmx [...] volny.cz
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=75970">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1053422" href="/Public/Bug/Display.html?id=75970#txn-1053422">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;22&nbsp;07:16:48&nbsp;2012</span>
    <span class="description">kmx [...] volny.cz -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Adding NPN &#40;Next Protocol Negotiation&#41; support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 22 Mar 2012 12:16:36 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kmx &lt;kmx [...] volny.cz&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1053422/550979/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/550979">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 476b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">NPN is new in openssl-1.0.1 and is required for such things as SPDY

To add support into Net::SSLeay means IMHO adding the following functions:
- Net::SSleay::CTX_set_next_protos_advertised_cb&#40;$ctx_server, 
\&#38;cb_function, $cb_data&#41;;
- Net::SSleay::CTX_set_next_proto_select_cb&#40;$ctx_client, \&#38;cb_function, 
$cb_data&#41;;
- Net::SSleay::get0_next_proto_negotiated&#40;$ssl&#41;;

But it will definitely need more investigation. I will do some work on 
this in the following weeks.

--
kmx
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1054805" href="/Public/Bug/Display.html?id=75970#txn-1054805">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;26&nbsp;10:08:27&nbsp;2012</span>
    <span class="description">kmx [...] volny.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75970] AutoReply: Adding NPN &#40;Next Protocol Negotiation&#41; support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 26 Mar 2012 16:08:05 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kmx &lt;kmx [...] volny.cz&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1054805/551757/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/551757">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 869b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">While hacking on NPN supports &#40;which is callback oriented&#41; I have ended 
up first with reorganizing callback related implementations in SSLeay.xs

I have prepared callback_big_redesign_r238.diff which:
- reduces repreated code in SSleay.xs
- makes existing callback implementation easier to follow
- and makes adding a new callback &#40;what I will need for NPN&#41; quite 
simple and straightforward

I have fixed also one bug in t/local/07_sslecho.t when running on 
openssl-0.9.6 &#40;with old callback implementation it used to simply crash 
- with new implementation it showed couple of falling tests&#41;.

I have tested mostly on MS Windows with 
openssl-0.9.6/0.9.7/0.9.8/1.0.0/1.0.1 + perl 5.8/5.10/5.14 &#40;however I am 
not sure if our testsuite covers all callbacks used in SSLeay.xs&#41;

Of course I might have introduced some new bug so any kind of review is 
welcome.

--
kmx
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1054805/551758/callback_big_redesign_r238.diff">Download callback_big_redesign_r238.diff</a><br />
<span class="downloadcontenttype">text/x-diff 36.2k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1054964" href="/Public/Bug/Display.html?id=75970#txn-1054964">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;26&nbsp;17:44:20&nbsp;2012</span>
    <span class="description">mikem [...] open.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75970] AutoReply: Adding NPN &#40;Next Protocol Negotiation&#41; support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 27 Mar 2012 07:44:21 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] open.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1054964/551864/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/551864">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

tests OK on a variety of platforms and openssls.
Do you want this committed?

Cheers.

BTW, where are we with the apache2 crash. Solved?

Cheers.

On Monday, March 26, 2012 10:08:28 AM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=75970">https://rt.cpan.org/Ticket/Display.html?id=75970</a></span> &gt;
&gt; 
&gt; While hacking on NPN supports &#40;which is callback oriented&#41; I have ended
&gt; up first with reorganizing callback related implementations in SSLeay.xs
&gt; 
&gt; I have prepared callback_big_redesign_r238.diff which:
&gt; - reduces repreated code in SSleay.xs
&gt; - makes existing callback implementation easier to follow
&gt; - and makes adding a new callback &#40;what I will need for NPN&#41; quite
&gt; simple and straightforward
&gt; 
&gt; I have fixed also one bug in t/local/07_sslecho.t when running on
&gt; openssl-0.9.6 &#40;with old callback implementation it used to simply crash
&gt; - with new implementation it showed couple of falling tests&#41;.
&gt; 
&gt; I have tested mostly on MS Windows with
&gt; openssl-0.9.6/0.9.7/0.9.8/1.0.0/1.0.1 + perl 5.8/5.10/5.14 &#40;however I am
&gt; not sure if our testsuite covers all callbacks used in SSLeay.xs&#41;
&gt; 
&gt; Of course I might have introduced some new bug so any kind of review is
&gt; welcome.
&gt; 
&gt; --
&gt; kmx
</div>-- 
Mike McCauley                               mikem@open.com.au
Open System Consultants Pty. Ltd
9 Bulbul Place Currumbin Waters QLD 4223 Australia   <span class="clickylink"><a target="new" rel="nofollow" href="http://www.open.com.au">http://www.open.com.au</a></span>
Phone +61 7 5598-7474                       Fax   +61 7 5598-7070

Radiator: the most portable, flexible and configurable RADIUS server 
anywhere. SQL, proxy, DBM, files, LDAP, NIS+, password, NT, Emerald, 
Platypus, Freeside, TACACS+, PAM, external, Active Directory, EAP, TLS, 
TTLS, PEAP, TNC, WiMAX, RSA, Vasco, Yubikey, MOTP, HOTP, TOTP,
DIAMETER etc. Full source on Unix, Windows, MacOSX, Solaris, VMS, NetWare etc.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1054967" href="/Public/Bug/Display.html?id=75970#txn-1054967">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;26&nbsp;17:44:22&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1054968" href="/Public/Bug/Display.html?id=75970#txn-1054968">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;26&nbsp;17:47:49&nbsp;2012</span>
    <span class="description">mikem [...] open.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75970] AutoReply: Adding NPN &#40;Next Protocol Negotiation&#41; support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 27 Mar 2012 07:47:48 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] open.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1054968/551867/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/551867">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi again,

On Tuesday, March 27, 2012 07:44:21 AM Mike McCauley wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt; 
&gt; tests OK on a variety of platforms and openssls.
</div>
Correction, I saw this with 0.9.8a on Linux perl v5.14.2:

PERL_DL_NONLAZY=1 /usr/bin/perl &#34;-MExtUtils::Command::MM&#34; &#34;-e&#34; 
&#34;test_harness&#40;0, &#39;inc&#39;, &#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/local/*.t 
t/handle/local/*.t
t/handle/local/05_use.t ................ ok   
t/local/01_pod.t ....................... ok   
t/local/02_pod_coverage.t .............. ok   
t/local/03_use.t ....................... ok   
t/local/04_basic.t ..................... 1/6 # Version info:
# Testing Net::SSLeay 1.46, Perl 5.014002, /usr/bin/perl
# OpenSSL version:  &#39;OpenSSL 0.9.8a 11 Oct 2005&#39;
# OpenSSL platform: &#39;platform: linux-elf&#39;
t/local/04_basic.t ..................... ok   
t/local/05_passwd_cb.t ................. ok     
t/local/06_tcpecho.t ................... ok   
t/local/07_sslecho.t ................... Failed 76/78 subtests 
t/local/08_pipe.t ...................... 

and 08_pipe.t hung forever

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Do you want this committed?
&gt; 
&gt; Cheers.
&gt; 
&gt; BTW, where are we with the apache2 crash. Solved?
&gt; 
&gt; Cheers.
&gt; 
&gt; On Monday, March 26, 2012 10:08:28 AM you wrote:
<div class="message-stanza open">&gt; &gt;        Queue: Net-SSLeay
&gt; &gt;  
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=75970">https://rt.cpan.org/Ticket/Display.html?id=75970</a></span> &gt;
&gt; &gt; 
&gt; &gt; While hacking on NPN supports &#40;which is callback oriented&#41; I have ended
&gt; &gt; up first with reorganizing callback related implementations in SSLeay.xs
&gt; &gt; 
&gt; &gt; I have prepared callback_big_redesign_r238.diff which:
&gt; &gt; - reduces repreated code in SSleay.xs
&gt; &gt; - makes existing callback implementation easier to follow
&gt; &gt; - and makes adding a new callback &#40;what I will need for NPN&#41; quite
&gt; &gt; simple and straightforward
&gt; &gt; 
&gt; &gt; I have fixed also one bug in t/local/07_sslecho.t when running on
&gt; &gt; openssl-0.9.6 &#40;with old callback implementation it used to simply crash
&gt; &gt; - with new implementation it showed couple of falling tests&#41;.
&gt; &gt; 
&gt; &gt; I have tested mostly on MS Windows with
&gt; &gt; openssl-0.9.6/0.9.7/0.9.8/1.0.0/1.0.1 + perl 5.8/5.10/5.14 &#40;however I am
&gt; &gt; not sure if our testsuite covers all callbacks used in SSLeay.xs&#41;
&gt; &gt; 
&gt; &gt; Of course I might have introduced some new bug so any kind of review is
&gt; &gt; welcome.
&gt; &gt; 
&gt; &gt; --
&gt; &gt; kmx
</div></div>-- 
Mike McCauley                               mikem@open.com.au
Open System Consultants Pty. Ltd
9 Bulbul Place Currumbin Waters QLD 4223 Australia   <span class="clickylink"><a target="new" rel="nofollow" href="http://www.open.com.au">http://www.open.com.au</a></span>
Phone +61 7 5598-7474                       Fax   +61 7 5598-7070

Radiator: the most portable, flexible and configurable RADIUS server 
anywhere. SQL, proxy, DBM, files, LDAP, NIS+, password, NT, Emerald, 
Platypus, Freeside, TACACS+, PAM, external, Active Directory, EAP, TLS, 
TTLS, PEAP, TNC, WiMAX, RSA, Vasco, Yubikey, MOTP, HOTP, TOTP,
DIAMETER etc. Full source on Unix, Windows, MacOSX, Solaris, VMS, NetWare etc.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1054976" href="/Public/Bug/Display.html?id=75970#txn-1054976">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;26&nbsp;18:31:25&nbsp;2012</span>
    <span class="description">kmx [...] volny.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75970] AutoReply: Adding NPN &#40;Next Protocol Negotiation&#41; support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 27 Mar 2012 00:31:07 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kmx &lt;kmx [...] volny.cz&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1054976/551875/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/551875">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 172b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; and 08_pipe.t hung forever
&gt;    
</div>
I have experienced and fixed another issue on my Linux with perl 5.8 + 
openssl 0.9.8

Try callback_big_redesign_V2_r238.diff

--
kmx
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1054976/551876/callback_big_redesign_V2_r238.diff">Download callback_big_redesign_V2_r238.diff</a><br />
<span class="downloadcontenttype">text/x-diff 36.3k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1054978" href="/Public/Bug/Display.html?id=75970#txn-1054978">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;26&nbsp;18:50:49&nbsp;2012</span>
    <span class="description">mikem [...] open.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75970] AutoReply: Adding NPN &#40;Next Protocol Negotiation&#41; support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 27 Mar 2012 08:50:47 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] open.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1054978/551878/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/551878">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

Tests ok on all platforms except openssl-0.9.8a linux perl 5.14 as before:

PERL_DL_NONLAZY=1 /usr/bin/perl &#34;-MExtUtils::Command::MM&#34; &#34;-e&#34; 
&#34;test_harness&#40;0, &#39;inc&#39;, &#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/local/*.t 
t/handle/local/*.t
t/handle/local/05_use.t ................ ok   
t/local/01_pod.t ....................... ok   
t/local/02_pod_coverage.t .............. ok   
t/local/03_use.t ....................... ok   
t/local/04_basic.t ..................... 1/6 # Version info:
# Testing Net::SSLeay 1.46, Perl 5.014002, /usr/bin/perl
# OpenSSL version:  &#39;OpenSSL 0.9.8a 11 Oct 2005&#39;
# OpenSSL platform: &#39;platform: linux-elf&#39;
t/local/04_basic.t ..................... ok   
t/local/05_passwd_cb.t ................. ok     
t/local/06_tcpecho.t ................... ok   
t/local/07_sslecho.t ................... Failed 76/78 subtests 
t/local/08_pipe.t ...................... ^Cmake: *** [test_dynamic] Interrupt


On Monday, March 26, 2012 06:31:27 PM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=75970">https://rt.cpan.org/Ticket/Display.html?id=75970</a></span> &gt;
&gt; 
<div class="message-stanza open">&gt; &gt; and 08_pipe.t hung forever
</div>&gt; 
&gt; I have experienced and fixed another issue on my Linux with perl 5.8 +
&gt; openssl 0.9.8
&gt; 
&gt; Try callback_big_redesign_V2_r238.diff
&gt; 
&gt; --
&gt; kmx
</div>-- 
Mike McCauley                               mikem@open.com.au
Open System Consultants Pty. Ltd
9 Bulbul Place Currumbin Waters QLD 4223 Australia   <span class="clickylink"><a target="new" rel="nofollow" href="http://www.open.com.au">http://www.open.com.au</a></span>
Phone +61 7 5598-7474                       Fax   +61 7 5598-7070

Radiator: the most portable, flexible and configurable RADIUS server 
anywhere. SQL, proxy, DBM, files, LDAP, NIS+, password, NT, Emerald, 
Platypus, Freeside, TACACS+, PAM, external, Active Directory, EAP, TLS, 
TTLS, PEAP, TNC, WiMAX, RSA, Vasco, Yubikey, MOTP, HOTP, TOTP,
DIAMETER etc. Full source on Unix, Windows, MacOSX, Solaris, VMS, NetWare etc.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1054981" href="/Public/Bug/Display.html?id=75970#txn-1054981">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;26&nbsp;18:54:18&nbsp;2012</span>
    <span class="description">kmx [...] volny.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75970] AutoReply: Adding NPN &#40;Next Protocol Negotiation&#41; support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 27 Mar 2012 00:54:08 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kmx &lt;kmx [...] volny.cz&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1054981/551881/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/551881">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 130b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Tests ok on all platforms except openssl-0.9.8a linux perl 5.14 as before
</div>
Not good, I will try to investigate more.

--
kmx
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1054996" href="/Public/Bug/Display.html?id=75970#txn-1054996">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;26&nbsp;20:45:23&nbsp;2012</span>
    <span class="description">kmx [...] volny.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75970] AutoReply: Adding NPN &#40;Next Protocol Negotiation&#41; support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 27 Mar 2012 02:45:12 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kmx &lt;kmx [...] volny.cz&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1054996/551892/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/551892">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 102b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">None of my Linux boxes is able to reproduce t/local/08_pipe.t failure :&#40;

Giving up for today

--
kmx
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1055057" href="/Public/Bug/Display.html?id=75970#txn-1055057">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;27&nbsp;01:52:41&nbsp;2012</span>
    <span class="description">mikem [...] open.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75970] AutoReply: Adding NPN &#40;Next Protocol Negotiation&#41; support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 27 Mar 2012 15:52:27 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] open.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1055057/551920/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/551920">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Monday, March 26, 2012 08:45:24 PM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=75970">https://rt.cpan.org/Ticket/Display.html?id=75970</a></span> &gt;
&gt; 
&gt; None of my Linux boxes is able to reproduce t/local/08_pipe.t failure :&#40;
</div>
Ill get to that soon, but in the meantime, Im looking at the 
t/local/07_sslecho.t faiilure:

This test failure is not new: it occurs with the 1.45 dist as well:

t/local/07_sslecho.t ........... Failed 69/71 subtests 

 07_sslecho.t actually crashes on an illegal instruction:


&#40;gdb&#41; where
#0  0xb7b4f4a0 in PEM_read_bio_X509 &#40;&#41; from 
blib/arch/auto/Net/SSLeay/SSLeay.so
#1  0xb7b11c0e in SSL_CTX_use_certificate_file &#40;&#41; from 
blib/arch/auto/Net/SSLeay/SSLeay.so
#2  0xb7ae0dba in XS_Net__SSLeay_CTX_use_certificate_file &#40;my_perl=0x81a5008, 
cv=0x8345af0&#41;
    at SSLeay.c:2196
#3  0x080e62c3 in Perl_pp_entersub &#40;&#41;
#4  0x080dd868 in Perl_runops_standard &#40;&#41;
#5  0x0807df5b in perl_run &#40;&#41;
#6  0x08060fa7 in main &#40;&#41;
&#40;gdb&#41; quit


also, openssl prog from openssl-0.9.8a also crashes trying to read the test 
cert

/tmp/openssl-0.9.8a/bin/openssl x509 -inform PEM -text -in  t/data/cert.pem
Illegal instruction

I have a vague memory that there was a similar bug in openssl due to some 
incompatibility with some versions of gcc compiler on some platforms? 
Something to do with the openssl asm files?

Do you have any memory of that?

I have gcc &#40;SUSE Linux&#41; 4.6.2


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Giving up for today
&gt; 
&gt; --
&gt; kmx
</div>-- 
Mike McCauley                               mikem@open.com.au
Open System Consultants Pty. Ltd
9 Bulbul Place Currumbin Waters QLD 4223 Australia   <span class="clickylink"><a target="new" rel="nofollow" href="http://www.open.com.au">http://www.open.com.au</a></span>
Phone +61 7 5598-7474                       Fax   +61 7 5598-7070

Radiator: the most portable, flexible and configurable RADIUS server 
anywhere. SQL, proxy, DBM, files, LDAP, NIS+, password, NT, Emerald, 
Platypus, Freeside, TACACS+, PAM, external, Active Directory, EAP, TLS, 
TTLS, PEAP, TNC, WiMAX, RSA, Vasco, Yubikey, MOTP, HOTP, TOTP,
DIAMETER etc. Full source on Unix, Windows, MacOSX, Solaris, VMS, NetWare etc.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1055088" href="/Public/Bug/Display.html?id=75970#txn-1055088">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;27&nbsp;02:27:19&nbsp;2012</span>
    <span class="description">kmx [...] volny.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75970] AutoReply: Adding NPN &#40;Next Protocol Negotiation&#41; support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 27 Mar 2012 08:27:04 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kmx &lt;kmx [...] volny.cz&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1055088/551932/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/551932">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 42b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ad t/local/07_sslecho.t try V2 of my patch
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1055090" href="/Public/Bug/Display.html?id=75970#txn-1055090">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;27&nbsp;02:42:39&nbsp;2012</span>
    <span class="description">mikem [...] open.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75970] AutoReply: Adding NPN &#40;Next Protocol Negotiation&#41; support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 27 Mar 2012 16:42:39 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] open.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1055090/551934/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/551934">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 848b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tuesday, March 27, 2012 02:27:20 AM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=75970">https://rt.cpan.org/Ticket/Display.html?id=75970</a></span> &gt;
&gt; 
&gt; Ad t/local/07_sslecho.t try V2 of my patch
</div>
tried. Its definitely a problem inside openssl

Cheers.

-- 
Mike McCauley                               mikem@open.com.au
Open System Consultants Pty. Ltd
9 Bulbul Place Currumbin Waters QLD 4223 Australia   <span class="clickylink"><a target="new" rel="nofollow" href="http://www.open.com.au">http://www.open.com.au</a></span>
Phone +61 7 5598-7474                       Fax   +61 7 5598-7070

Radiator: the most portable, flexible and configurable RADIUS server 
anywhere. SQL, proxy, DBM, files, LDAP, NIS+, password, NT, Emerald, 
Platypus, Freeside, TACACS+, PAM, external, Active Directory, EAP, TLS, 
TTLS, PEAP, TNC, WiMAX, RSA, Vasco, Yubikey, MOTP, HOTP, TOTP,
DIAMETER etc. Full source on Unix, Windows, MacOSX, Solaris, VMS, NetWare etc.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1055093" href="/Public/Bug/Display.html?id=75970#txn-1055093">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;27&nbsp;02:58:16&nbsp;2012</span>
    <span class="description">mikem [...] open.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75970] AutoReply: Adding NPN &#40;Next Protocol Negotiation&#41; support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 27 Mar 2012 16:58:10 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] open.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1055093/551937/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/551937">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I see this problem with 0.9.8a and 0.9.8b, as least as far back as net-ssleay 
1.40

Its clear to me that what I am seeing is a bug in openssl &#40;at least when built 
and run on my OPenSuSE 12.1, maybe something to do with my CPU type&#41;. I am not 
going to pursue it further.

Cheers.

On Tuesday, March 27, 2012 02:42:40 AM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=75970">https://rt.cpan.org/Ticket/Display.html?id=75970</a></span> &gt;
&gt; 
&gt; On Tuesday, March 27, 2012 02:27:20 AM you wrote:
<div class="message-stanza open">&gt; &gt;        Queue: Net-SSLeay
&gt; &gt;  
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=75970">https://rt.cpan.org/Ticket/Display.html?id=75970</a></span> &gt;
&gt; &gt; 
&gt; &gt; Ad t/local/07_sslecho.t try V2 of my patch
</div>&gt; 
&gt; tried. Its definitely a problem inside openssl
&gt; 
&gt; Cheers.
</div>-- 
Mike McCauley                               mikem@open.com.au
Open System Consultants Pty. Ltd
9 Bulbul Place Currumbin Waters QLD 4223 Australia   <span class="clickylink"><a target="new" rel="nofollow" href="http://www.open.com.au">http://www.open.com.au</a></span>
Phone +61 7 5598-7474                       Fax   +61 7 5598-7070

Radiator: the most portable, flexible and configurable RADIUS server 
anywhere. SQL, proxy, DBM, files, LDAP, NIS+, password, NT, Emerald, 
Platypus, Freeside, TACACS+, PAM, external, Active Directory, EAP, TLS, 
TTLS, PEAP, TNC, WiMAX, RSA, Vasco, Yubikey, MOTP, HOTP, TOTP,
DIAMETER etc. Full source on Unix, Windows, MacOSX, Solaris, VMS, NetWare etc.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1055135" href="/Public/Bug/Display.html?id=75970#txn-1055135">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;27&nbsp;04:04:42&nbsp;2012</span>
    <span class="description">kmx [...] volny.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75970] AutoReply: Adding NPN &#40;Next Protocol Negotiation&#41; support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 27 Mar 2012 10:04:30 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kmx &lt;kmx [...] volny.cz&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1055135/551964/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/551964">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 64b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">OK, could you please commit my last &#40;V2&#41; patch

Thanks.

--
kmx
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1055140" href="/Public/Bug/Display.html?id=75970#txn-1055140">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;27&nbsp;04:17:20&nbsp;2012</span>
    <span class="description">mikem [...] open.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75970] AutoReply: Adding NPN &#40;Next Protocol Negotiation&#41; support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 27 Mar 2012 18:17:22 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] open.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1055140/551969/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/551969">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 851b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,


On Tuesday, March 27, 2012 04:04:43 AM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=75970">https://rt.cpan.org/Ticket/Display.html?id=75970</a></span> &gt;
&gt; 
&gt; OK, could you please commit my last &#40;V2&#41; patch
</div>
done at 329.

Cheers.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Thanks.
&gt; 
&gt; --
&gt; kmx
</div>-- 
Mike McCauley                               mikem@open.com.au
Open System Consultants Pty. Ltd
9 Bulbul Place Currumbin Waters QLD 4223 Australia   <span class="clickylink"><a target="new" rel="nofollow" href="http://www.open.com.au">http://www.open.com.au</a></span>
Phone +61 7 5598-7474                       Fax   +61 7 5598-7070

Radiator: the most portable, flexible and configurable RADIUS server 
anywhere. SQL, proxy, DBM, files, LDAP, NIS+, password, NT, Emerald, 
Platypus, Freeside, TACACS+, PAM, external, Active Directory, EAP, TLS, 
TTLS, PEAP, TNC, WiMAX, RSA, Vasco, Yubikey, MOTP, HOTP, TOTP,
DIAMETER etc. Full source on Unix, Windows, MacOSX, Solaris, VMS, NetWare etc.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1055254" href="/Public/Bug/Display.html?id=75970#txn-1055254">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;27&nbsp;09:40:16&nbsp;2012</span>
    <span class="description">kmx [...] volny.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75970]  Adding NPN &#40;Next Protocol Negotiation&#41; support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 27 Mar 2012 15:40:03 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kmx &lt;kmx [...] volny.cz&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1055254/552042/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/552042">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 890b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">My first draft of NPN support &#40;just XS code&#41; - see enclosed 
npn_support_DRAFT_NOT_FOR_COMMIT.diff - do not commit yet.

Currently it seems that I will add these functions:
- Net::SSLeay::CTX_set_next_protos_advertised_cb
- Net::SSLeay::CTX_set_next_proto_select_cb
- Net::SSLeay::P_next_proto_negotiated
- Net::SSLeay::P_next_proto_last_status
- Net::SSLeay::P_next_proto_support    &#40;not sure about this one&#41;

I am not sure about P_next_proto_support as it IMHO does not fit the 
rest of Net::SSLeay

Mike, what do you think

1/ do we need Net::SSLeay::P_next_proto_support  &#40;retval 1 = have NPN 
support, 0 = non NPN&#41; ?

disadvantage: it cannot be used for NPN detection in older Net::SSLeay 
versions

2/ or should I recommend in pod NPN support detection like:

if &#40;exists &#38;Net::SSLeay::P_next_proto_negotiated&#41; {
   #do NPN stuff
}

My opinion is slightly moving from 1/ to 2/

--
kmx
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1055254/552043/npn_support_DRAFT_NOT_FOR_COMMIT.diff">Download npn_support_DRAFT_NOT_FOR_COMMIT.diff</a><br />
<span class="downloadcontenttype">text/x-diff 10.1k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1055644" href="/Public/Bug/Display.html?id=75970#txn-1055644">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;27&nbsp;18:56:39&nbsp;2012</span>
    <span class="description">mikem [...] open.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75970]  Adding NPN &#40;Next Protocol Negotiation&#41; support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 28 Mar 2012 08:56:41 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] open.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1055644/552285/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/552285">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

On Tuesday, March 27, 2012 09:40:17 AM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=75970">https://rt.cpan.org/Ticket/Display.html?id=75970</a></span> &gt;
&gt; 
&gt; My first draft of NPN support &#40;just XS code&#41; - see enclosed
&gt; npn_support_DRAFT_NOT_FOR_COMMIT.diff - do not commit yet.
</div>
Compiles and tests fine here. I have now reverted, so it wont be committed.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Currently it seems that I will add these functions:
&gt; - Net::SSLeay::CTX_set_next_protos_advertised_cb
&gt; - Net::SSLeay::CTX_set_next_proto_select_cb
&gt; - Net::SSLeay::P_next_proto_negotiated
&gt; - Net::SSLeay::P_next_proto_last_status
&gt; - Net::SSLeay::P_next_proto_support    &#40;not sure about this one&#41;
&gt; 
&gt; I am not sure about P_next_proto_support as it IMHO does not fit the
&gt; rest of Net::SSLeay
&gt; 
&gt; Mike, what do you think
&gt; 
&gt; 1/ do we need Net::SSLeay::P_next_proto_support  &#40;retval 1 = have NPN
&gt; support, 0 = non NPN&#41; ?
&gt; 
&gt; disadvantage: it cannot be used for NPN detection in older Net::SSLeay
&gt; versions
&gt; 
&gt; 2/ or should I recommend in pod NPN support detection like:
&gt; 
&gt; if &#40;exists &#38;Net::SSLeay::P_next_proto_negotiated&#41; {
&gt;    #do NPN stuff
&gt; }
&gt; 
&gt; My opinion is slightly moving from 1/ to 2/
</div>
Much prefer 2/

Cheers.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; --
&gt; kmx
</div>-- 
Mike McCauley                               mikem@open.com.au
Open System Consultants Pty. Ltd
9 Bulbul Place Currumbin Waters QLD 4223 Australia   <span class="clickylink"><a target="new" rel="nofollow" href="http://www.open.com.au">http://www.open.com.au</a></span>
Phone +61 7 5598-7474                       Fax   +61 7 5598-7070

Radiator: the most portable, flexible and configurable RADIUS server 
anywhere. SQL, proxy, DBM, files, LDAP, NIS+, password, NT, Emerald, 
Platypus, Freeside, TACACS+, PAM, external, Active Directory, EAP, TLS, 
TTLS, PEAP, TNC, WiMAX, RSA, Vasco, Yubikey, MOTP, HOTP, TOTP,
DIAMETER etc. Full source on Unix, Windows, MacOSX, Solaris, VMS, NetWare etc.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1055807" href="/Public/Bug/Display.html?id=75970#txn-1055807">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;28&nbsp;04:30:32&nbsp;2012</span>
    <span class="description">kmx [...] volny.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75970]  Adding NPN &#40;Next Protocol Negotiation&#41; support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 28 Mar 2012 10:30:18 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kmx &lt;kmx [...] volny.cz&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1055807/552383/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/552383">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">could you please test &#38; commit enclosed 
improving_callback_stuff_r329.diff  &#40;it passes fine on all my platforms 
&#38; openssl versions&#41;

Now the new callback stuff should be IMHO pretty good/stable.

The only thing I am not sure about is whether cleaning data from global 
hash is really working correctly.

Let us have an existing callback related data in global hash - e.g. 
&#40;using pseudo code&#41;:

globalHV-&gt;{&#34;ptr_123456&#34;}-&gt;{&#34;ssleay_ctx_cert_verify_cb!!func&#34;} = 
SV_with_func_ref;
globalHV-&gt;{&#34;ptr_123456&#34;}-&gt;{&#34;ssleay_ctx_cert_verify_cb!!func&#34;} = 
SV_with_data;

The question is whether:
hv_delete&#40;globalHV, &#34;ptr_123456&#34;, strlen&#40;&#34;ptr_123456&#34;&#41;, G_DISCARD&#41;;
will correctly destroy also SV_with_func_ref and SV_with_data

I assume yes but have no idea how to test this.

Here is the test case:
{
   my $ctx = Net::SSLeay::CTX_new&#40;&#41;;
   my $data = &#34;aaaaa&#34;;
   Net::SSLeay::SSL_CTX_set_cert_verify_callback&#40;$ctx, sub { return 11 
}, $data&#41;;  #this calls newSVsv&#40;$param2&#41;  + newSVsv&#40;$data&#41;
   Net::SSLeay::CTX_free&#40;$ctx&#41;;
}
after this block all SVs should be correctly destroyed.

If you have time please check whether my idea of cleaning up the data 
from global hash is ok.

--
kmx
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1055807/552384/improving_callback_stuff_r329.diff">Download improving_callback_stuff_r329.diff</a><br />
<span class="downloadcontenttype">text/x-diff 15.6k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1055879" href="/Public/Bug/Display.html?id=75970#txn-1055879">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;28&nbsp;07:03:54&nbsp;2012</span>
    <span class="description">mikem [...] open.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75970]  Adding NPN &#40;Next Protocol Negotiation&#41; support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 28 Mar 2012 21:03:52 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] open.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1055879/552425/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/552425">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

On Wednesday, March 28, 2012 04:30:33 AM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=75970">https://rt.cpan.org/Ticket/Display.html?id=75970</a></span> &gt;
&gt; 
&gt; could you please test &#38; commit enclosed
&gt; improving_callback_stuff_r329.diff  &#40;it passes fine on all my platforms
&gt; &#38; openssl versions&#41;
</div>

Tests OK here.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Now the new callback stuff should be IMHO pretty good/stable.
&gt; 
&gt; The only thing I am not sure about is whether cleaning data from global
&gt; hash is really working correctly.
&gt; 
&gt; Let us have an existing callback related data in global hash - e.g.
&gt; &#40;using pseudo code&#41;:
&gt; 
&gt; globalHV-&gt;{&#34;ptr_123456&#34;}-&gt;{&#34;ssleay_ctx_cert_verify_cb!!func&#34;} =
&gt; SV_with_func_ref;
&gt; globalHV-&gt;{&#34;ptr_123456&#34;}-&gt;{&#34;ssleay_ctx_cert_verify_cb!!func&#34;} =
&gt; SV_with_data;
</div>
Surely SV_with_data  will replace SV_with_func_ref and SV_with_func_ref wil be 
destroyed?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; The question is whether:
&gt; hv_delete&#40;globalHV, &#34;ptr_123456&#34;, strlen&#40;&#34;ptr_123456&#34;&#41;, G_DISCARD&#41;;
&gt; will correctly destroy also SV_with_func_ref and SV_with_data
&gt; 
&gt; I assume yes but have no idea how to test this.
&gt; 
&gt; Here is the test case:
&gt; {
&gt;    my $ctx = Net::SSLeay::CTX_new&#40;&#41;;
&gt;    my $data = &#34;aaaaa&#34;;
&gt;    Net::SSLeay::SSL_CTX_set_cert_verify_callback&#40;$ctx, sub { return 11
&gt; }, $data&#41;;  #this calls newSVsv&#40;$param2&#41;  + newSVsv&#40;$data&#41;
&gt;    Net::SSLeay::CTX_free&#40;$ctx&#41;;
&gt; }
&gt; after this block all SVs should be correctly destroyed.
&gt; 
&gt; If you have time please check whether my idea of cleaning up the data
&gt; from global hash is ok.
</div>
I tested this in an infinite loop and it doesnt leak:


use Net::SSLeay;

&#38;Net::SSLeay::randomize&#40;&#41;;
&#38;Net::SSLeay::load_error_strings&#40;&#41;;
&#38;Net::SSLeay::ERR_load_crypto_strings&#40;&#41;;
&#38;Net::SSLeay::SSLeay_add_ssl_algorithms&#40;&#41;;

sub test
{
    my $ctx = Net::SSLeay::CTX_new&#40;&#41;;
    my $data = &#34;aaaaa&#34;;
    &#38;Net::SSLeay::CTX_set_cert_verify_callback&#40;$ctx, sub { return 11 }, 
$data&#41;;
    &#38;Net::SSLeay::CTX_free&#40;$ctx&#41;;
}

while &#40;1&#41;
{
    &#38;test&#40;&#41;;
}


Committed your patch at 331

Cheers.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; --
&gt; kmx
</div>-- 
Mike McCauley                               mikem@open.com.au
Open System Consultants Pty. Ltd
9 Bulbul Place Currumbin Waters QLD 4223 Australia   <span class="clickylink"><a target="new" rel="nofollow" href="http://www.open.com.au">http://www.open.com.au</a></span>
Phone +61 7 5598-7474                       Fax   +61 7 5598-7070

Radiator: the most portable, flexible and configurable RADIUS server 
anywhere. SQL, proxy, DBM, files, LDAP, NIS+, password, NT, Emerald, 
Platypus, Freeside, TACACS+, PAM, external, Active Directory, EAP, TLS, 
TTLS, PEAP, TNC, WiMAX, RSA, Vasco, Yubikey, MOTP, HOTP, TOTP,
DIAMETER etc. Full source on Unix, Windows, MacOSX, Solaris, VMS, NetWare etc.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1055893" href="/Public/Bug/Display.html?id=75970#txn-1055893">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;28&nbsp;07:19:32&nbsp;2012</span>
    <span class="description">kmx [...] volny.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75970]  Adding NPN &#40;Next Protocol Negotiation&#41; support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 28 Mar 2012 13:19:21 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kmx &lt;kmx [...] volny.cz&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1055893/552434/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/552434">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 673b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; globalHV-&gt;{&#34;ptr_123456&#34;}-&gt;{&#34;ssleay_ctx_cert_verify_cb!!func&#34;} = SV_with_func_ref;
&gt;&gt; globalHV-&gt;{&#34;ptr_123456&#34;}-&gt;{&#34;ssleay_ctx_cert_verify_cb!!func&#34;} = SV_with_data;
&gt;&gt;      
</div>&gt; Surely SV_with_data  will replace SV_with_func_ref and SV_with_func_ref wil be
&gt; destroyed?
&gt;    
</div>
grr, typo, I meant

globalHV-&gt;{&#34;ptr_123456&#34;}-&gt;{&#34;ssleay_ctx_cert_verify_cb!!func&#34;} = 
SV_with_func_ref;
globalHV-&gt;{&#34;ptr_123456&#34;}-&gt;{&#34;ssleay_ctx_cert_verify_cb!!data&#34;} = 
SV_with_data;

Anyway even the first case will not leak as I always destroy the old 
value via hv_delete&#40;&#41;


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I tested this in an infinite loop and it doesnt leak:
&gt;    
</div>
OK

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Committed your patch at 331
&gt;    
</div>
Thanks

--
kmx
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1055988" href="/Public/Bug/Display.html?id=75970#txn-1055988">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;28&nbsp;11:46:50&nbsp;2012</span>
    <span class="description">kmx [...] volny.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75970]  Adding NPN &#40;Next Protocol Negotiation&#41; support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 28 Mar 2012 17:46:35 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kmx &lt;kmx [...] volny.cz&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1055988/552493/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/552493">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 169b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Please check enclosed npn_support_r331.diff and please commit to svn if 
it works for you.

Add to repository also a new attached file: t/local/40_npn_support.t

--
kmx
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1055988/552494/npn_support_r331.diff">Download npn_support_r331.diff</a><br />
<span class="downloadcontenttype">text/x-diff 16.9k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1055988/552495/40_npn_support.t">Download 40_npn_support.t</a><br />
<span class="downloadcontenttype">text/x-perl 2.9k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1056111" href="/Public/Bug/Display.html?id=75970#txn-1056111">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;28&nbsp;17:28:17&nbsp;2012</span>
    <span class="description">mikem [...] open.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75970]  Adding NPN &#40;Next Protocol Negotiation&#41; support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 29 Mar 2012 07:28:17 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] open.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1056111/552554/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/552554">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

Tests fine here, although I could only test against 1.0.1 on Linux

Committed at 333

BTW, I am away for the next 4 days &#40;starting a few hours from now&#41;, and wont 
be able to do any more ssleay stuff in that time.

Cheers.

On Wednesday, March 28, 2012 11:46:51 AM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=75970">https://rt.cpan.org/Ticket/Display.html?id=75970</a></span> &gt;
&gt; 
&gt; Please check enclosed npn_support_r331.diff and please commit to svn if
&gt; it works for you.
&gt; 
&gt; Add to repository also a new attached file: t/local/40_npn_support.t
&gt; 
&gt; --
&gt; kmx
</div>-- 
Mike McCauley                               mikem@open.com.au
Open System Consultants Pty. Ltd
9 Bulbul Place Currumbin Waters QLD 4223 Australia   <span class="clickylink"><a target="new" rel="nofollow" href="http://www.open.com.au">http://www.open.com.au</a></span>
Phone +61 7 5598-7474                       Fax   +61 7 5598-7070

Radiator: the most portable, flexible and configurable RADIUS server 
anywhere. SQL, proxy, DBM, files, LDAP, NIS+, password, NT, Emerald, 
Platypus, Freeside, TACACS+, PAM, external, Active Directory, EAP, TLS, 
TTLS, PEAP, TNC, WiMAX, RSA, Vasco, Yubikey, MOTP, HOTP, TOTP,
DIAMETER etc. Full source on Unix, Windows, MacOSX, Solaris, VMS, NetWare etc.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1056220" href="/Public/Bug/Display.html?id=75970#txn-1056220">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;29&nbsp;03:21:10&nbsp;2012</span>
    <span class="description">kmx [...] volny.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75970]  Adding NPN &#40;Next Protocol Negotiation&#41; support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 29 Mar 2012 09:20:58 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kmx &lt;kmx [...] volny.cz&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1056220/552597/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/552597">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 572b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Tests fine here, although I could only test against 1.0.1 on Linux
&gt;
&gt; Committed at 333
&gt;    
</div>
Thanks.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; BTW, I am away for the next 4 days &#40;starting a few hours from now&#41;, and wont
&gt; be able to do any more ssleay stuff in that time.
&gt;    
</div>
I am not planning any other huge changes - NPN was last thing on my 
list. I&#39;ll do only some testing over the weekend and maybe only some 
cosmetic changes.

IMHO current changelist is quite long and after fixing crashing 
apache@debian I am not aware of any other critical bug - so perhaps time 
for the next release.

--
kmx
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1056248" href="/Public/Bug/Display.html?id=75970#txn-1056248">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;29&nbsp;07:55:57&nbsp;2012</span>
    <span class="description">kmx [...] volny.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75970]  Adding NPN &#40;Next Protocol Negotiation&#41; support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 29 Mar 2012 13:55:44 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kmx &lt;kmx [...] volny.cz&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1056248/552614/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/552614">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 66b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixing compiler warnings - see fixing_compiler_warnings_r333.diff
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1056248/552615/fixing_compiler_warnings_r333.diff">Download fixing_compiler_warnings_r333.diff</a><br />
<span class="downloadcontenttype">text/x-diff 1.2k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1056341" href="/Public/Bug/Display.html?id=75970#txn-1056341">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;29&nbsp;14:45:51&nbsp;2012</span>
    <span class="description">kmx [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1056341/552667/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/552667">with headers</a>
<br />
<span class="downloadcontenttype">text/html 99b</span>
</div>
<div class="messagebody">
<div class="message-stanza">Fixing compiler warnings even more - see fixing_compiler_warnings_V2_r333.diff <br>

<br>

<br>
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> fixing_compiler_warnings_V2_r333.diff</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1056341/552668/fixing_compiler_warnings_V2_r333.diff">Download fixing_compiler_warnings_V2_r333.diff</a><br />
<span class="downloadcontenttype">text/x-diff 9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: SSLeay.xs
===================================================================
--- SSLeay.xs	&#40;revision 333&#41;
+++ SSLeay.xs	&#40;working copy&#41;
@@ -744,7 +744,7 @@
 
 int next_proto_helper_protodata2AV&#40;AV * list, const unsigned char *in, unsigned int inlen&#41;
 {
-    int i = 0;
+    unsigned int i = 0;
     unsigned char il;
     if &#40;!list || inlen&lt;2&#41; return 0;   
     while &#40;i&lt;inlen&#41; {
@@ -761,7 +761,7 @@
 {
     SV *cb_func, *cb_data;
     unsigned char *next_proto_data;
-    unsigned short next_proto_len;
+    unsigned char next_proto_len;
     int next_proto_status;
     SSL_CTX *ctx = SSL_get_SSL_CTX&#40;ssl&#41;;
 
@@ -793,11 +793,12 @@
             croak &#40;&#34;Net::SSLeay: next_proto_select_cb_invoke perl function did not return 2 values.\n&#34;&#41;;
         next_proto_data = POPpx;
         next_proto_status = POPi;
-        next_proto_len = strlen&#40;next_proto_data&#41;;
         PUTBACK;
         FREETMPS;
         LEAVE;
 
+        if &#40;strlen&#40;next_proto_data&#41;&gt;255&#41; return SSL_TLSEXT_ERR_ALERT_FATAL;
+        next_proto_len = &#40;unsigned char&#41;strlen&#40;next_proto_data&#41;;
         /* store last_status + last_negotiated into global hash */
         cb_data_advanced_put&#40;ssl, &#34;next_proto_select_cb!!last_status&#34;, newSViv&#40;next_proto_status&#41;&#41;;
         tmpsv = newSVpv&#40;next_proto_data, next_proto_len&#41;;
@@ -1893,7 +1894,7 @@
 	char * buf;
 	CODE:
 	ST&#40;0&#41; = sv_newmortal&#40;&#41;;   /* Undefined to start with */
-	if &#40;buf = X509_NAME_oneline&#40;name, NULL, 0&#41;&#41; {
+	if &#40;&#40;buf = X509_NAME_oneline&#40;name, NULL, 0&#41;&#41;&#41; {
 		sv_setpvn&#40; ST&#40;0&#41;, buf, strlen&#40;buf&#41;&#41;;
 		OPENSSL_free&#40;buf&#41;; /* mem was allocated by openssl */
 	}
@@ -1957,7 +1958,7 @@
     PREINIT:
         STRLEN len;
     INPUT:
-        unsigned char *bytes = SvPV&#40;ST&#40;3&#41;, len&#41;;
+        unsigned char *bytes = &#40;unsigned char *&#41;SvPV&#40;ST&#40;3&#41;, len&#41;;
     CODE:
         RETVAL = X509_NAME_add_entry_by_NID&#40;name,nid,type,bytes,len,loc,set&#41;;
     OUTPUT:
@@ -1973,15 +1974,12 @@
     PREINIT:
         STRLEN len;
     INPUT:
-        unsigned char *bytes = SvPV&#40;ST&#40;3&#41;, len&#41;;
+        unsigned char *bytes = &#40;unsigned char *&#41;SvPV&#40;ST&#40;3&#41;, len&#41;;
     CODE:
         RETVAL = X509_NAME_add_entry_by_OBJ&#40;name,obj,type,bytes,len,loc,set&#41;;
     OUTPUT:
         RETVAL
 
-#if OPENSSL_VERSION_NUMBER &lt; 0x0090707fL
-#define REM18 &#34;before 0.9.7g&#34;
-
 int
 X509_NAME_add_entry_by_txt&#40;name,field,type,bytes,loc=-1,set=0&#41;
         X509_NAME *name
@@ -1992,34 +1990,14 @@
     PREINIT:
         STRLEN len;
     INPUT:
-        unsigned char *bytes = SvPV&#40;ST&#40;3&#41;, len&#41;;
+        unsigned char *bytes = &#40;unsigned char *&#41;SvPV&#40;ST&#40;3&#41;, len&#41;;
     CODE:
         RETVAL = X509_NAME_add_entry_by_txt&#40;name,field,type,bytes,len,loc,set&#41;;
     OUTPUT:
         RETVAL
 
-#else
-
-int
-X509_NAME_add_entry_by_txt&#40;name,field,type,bytes,len=-1,loc=-1,set=0&#41;
-        X509_NAME *name
-        const char *field
-        int type
-        int loc
-        int set
-    PREINIT:
-        STRLEN len;
-    INPUT:
-        const unsigned char *bytes = SvPV&#40;ST&#40;3&#41;, len&#41;;
-    CODE:
-        RETVAL = X509_NAME_add_entry_by_txt&#40;name,field,type,bytes,len,loc,set&#41;;
-    OUTPUT:
-        RETVAL
-
 #endif
 
-#endif
-
 int
 X509_NAME_cmp&#40;const X509_NAME *a, const X509_NAME *b&#41;
 
@@ -2196,9 +2174,6 @@
 int
 X509_REQ_get_attr_by_OBJ&#40;const X509_REQ *req, ASN1_OBJECT *obj, int lastpos=-1&#41;
 
-#if OPENSSL_VERSION_NUMBER &lt; 0x0090700fL
-#define REM22 &#34;NOTE: before 0.9.7&#34;
-
 int
 X509_REQ_add1_attr_by_NID&#40;req,nid,type,bytes&#41;
         X509_REQ *req
@@ -2207,30 +2182,12 @@
     PREINIT:
         STRLEN len;
     INPUT:
-        unsigned char *bytes = SvPV&#40;ST&#40;3&#41;, len&#41;;
+        unsigned char *bytes = &#40;unsigned char *&#41;SvPV&#40;ST&#40;3&#41;, len&#41;;
     CODE:
         RETVAL = X509_REQ_add1_attr_by_NID&#40;req,nid,type,bytes,len&#41;;
     OUTPUT:
         RETVAL
 
-#else
-
-int
-X509_REQ_add1_attr_by_NID&#40;req,nid,type,bytes&#41;
-        X509_REQ *req
-        int nid
-        int type
-    PREINIT:
-        STRLEN len;
-    INPUT:
-        const unsigned char *bytes = SvPV&#40;ST&#40;3&#41;, len&#41;;
-    CODE:
-        RETVAL = X509_REQ_add1_attr_by_NID&#40;req,nid,type,bytes,len&#41;;
-    OUTPUT:
-        RETVAL
-
-#endif
-
 #if OPENSSL_VERSION_NUMBER &gt;= 0x0090700fL
 #define REM21 &#34;requires 0.9.7+&#34;
 
@@ -2492,7 +2449,7 @@
                 gnames = p-&gt;distpoint-&gt;name.fullname;
                 for &#40;j = 0; j &lt; sk_GENERAL_NAME_num&#40;gnames&#41;; j++&#41; {
                     gn = sk_GENERAL_NAME_value&#40;gnames, j&#41;;
-                    XPUSHs&#40;sv_2mortal&#40;newSVpv&#40;ASN1_STRING_data&#40;gn-&gt;d.ia5&#41;,ASN1_STRING_length&#40;gn-&gt;d.ia5&#41;&#41;&#41;&#41;;
+                    XPUSHs&#40;sv_2mortal&#40;newSVpv&#40;&#40;char*&#41;ASN1_STRING_data&#40;gn-&gt;d.ia5&#41;,ASN1_STRING_length&#40;gn-&gt;d.ia5&#41;&#41;&#41;&#41;;
                 }
             }
             else {
@@ -2865,15 +2822,15 @@
      ASN1_TIME_to_generalizedtime&#40;tm,&#38;tmp&#41;;
      if &#40;tmp&#41; {
        if &#40;ASN1_GENERALIZEDTIME_check&#40;tmp&#41;&#41; {
-         if &#40;strlen&#40;tmp-&gt;data&#41;&gt;=14 &#38;&#38; strlen&#40;tmp-&gt;data&#41;&lt;200&#41; {
+         if &#40;strlen&#40;&#40;char*&#41;tmp-&gt;data&#41;&gt;=14 &#38;&#38; strlen&#40;&#40;char*&#41;tmp-&gt;data&#41;&lt;200&#41; {
            strcpy &#40;buf,&#34;yyyy-mm-ddThh:mm:ss&#34;&#41;;
-           strncpy&#40;buf,   tmp-&gt;data,   4&#41;;
-           strncpy&#40;buf+5, tmp-&gt;data+4, 2&#41;;
-           strncpy&#40;buf+8, tmp-&gt;data+6, 2&#41;;
-           strncpy&#40;buf+11,tmp-&gt;data+8, 2&#41;;
-           strncpy&#40;buf+14,tmp-&gt;data+10,2&#41;;
-           strncpy&#40;buf+17,tmp-&gt;data+12,2&#41;;
-           if &#40;strlen&#40;tmp-&gt;data&#41;&gt;14&#41; strcat&#40;buf+19,tmp-&gt;data+14&#41;;
+           strncpy&#40;buf,   &#40;char*&#41;tmp-&gt;data,   4&#41;;
+           strncpy&#40;buf+5, &#40;char*&#41;tmp-&gt;data+4, 2&#41;;
+           strncpy&#40;buf+8, &#40;char*&#41;tmp-&gt;data+6, 2&#41;;
+           strncpy&#40;buf+11,&#40;char*&#41;tmp-&gt;data+8, 2&#41;;
+           strncpy&#40;buf+14,&#40;char*&#41;tmp-&gt;data+10,2&#41;;
+           strncpy&#40;buf+17,&#40;char*&#41;tmp-&gt;data+12,2&#41;;
+           if &#40;strlen&#40;&#40;char*&#41;tmp-&gt;data&#41;&gt;14&#41; strcat&#40;buf+19,&#40;char*&#41;tmp-&gt;data+14&#41;;
          }
        }
        ASN1_GENERALIZEDTIME_free&#40;tmp&#41;;
@@ -2888,7 +2845,6 @@
      PREINIT:
      ASN1_TIME t;
      char buf[256];
-     int y=0,M=0,d=0,h=0,m=0,s=0;
      int i,rv;
      CODE:
      if &#40;!tm&#41; XSRETURN_UNDEF;
@@ -3044,13 +3000,13 @@
             if &#40;passwd_len&gt;0&#41; {
                 /* encrypted key */
                 if &#40;!enc_alg&#41;
-                    PEM_write_bio_PrivateKey&#40;bp,pk,EVP_des_cbc&#40;&#41;,passwd,passwd_len,cb,u&#41;;
+                    PEM_write_bio_PrivateKey&#40;bp,pk,EVP_des_cbc&#40;&#41;,&#40;unsigned char *&#41;passwd,passwd_len,cb,u&#41;;
                 else
-                    PEM_write_bio_PrivateKey&#40;bp,pk,enc_alg,passwd,passwd_len,cb,u&#41;;
+                    PEM_write_bio_PrivateKey&#40;bp,pk,enc_alg,&#40;unsigned char *&#41;passwd,passwd_len,cb,u&#41;;
             }
             else {
                 /* unencrypted key */
-                PEM_write_bio_PrivateKey&#40;bp,pk,NULL,passwd,passwd_len,cb,u&#41;;
+                PEM_write_bio_PrivateKey&#40;bp,pk,NULL,&#40;unsigned char *&#41;passwd,passwd_len,cb,u&#41;;
             }
             n = BIO_ctrl_pending&#40;bp&#41;;
             New&#40;0, buf, n, char&#41;;
@@ -3074,13 +3030,13 @@
         FILE *fp;
     CODE:
         RETVAL = 0;
-        if &#40;fp = fopen &#40;file, &#34;rb&#34;&#41;&#41; {
+        if &#40;&#40;fp = fopen &#40;file, &#34;rb&#34;&#41;&#41;&#41; {
 #if OPENSSL_VERSION_NUMBER &gt;= 0x0090700fL
             OPENSSL_add_all_algorithms_noconf&#40;&#41;;
 #else
             OpenSSL_add_all_algorithms&#40;&#41;;
 #endif
-            if &#40;p12 = d2i_PKCS12_fp&#40;fp, NULL&#41;&#41; {
+            if &#40;&#40;p12 = d2i_PKCS12_fp&#40;fp, NULL&#41;&#41;&#41; {
                 if &#40;PKCS12_parse&#40;p12, password, &#38;private_key, &#38;certificate, NULL&#41;&#41; {
                     if &#40;private_key&#41; {
                         if &#40;SSL_CTX_use_PrivateKey&#40;ctx, private_key&#41;&#41; RETVAL = 1;
@@ -3113,13 +3069,13 @@
         FILE *fp;
         int i, result;
     PPCODE:
-        if &#40;fp = fopen &#40;file, &#34;rb&#34;&#41;&#41; {
+        if &#40;&#40;fp = fopen &#40;file, &#34;rb&#34;&#41;&#41;&#41; {
 #if OPENSSL_VERSION_NUMBER &gt;= 0x0090700fL
             OPENSSL_add_all_algorithms_noconf&#40;&#41;;
 #else
             OpenSSL_add_all_algorithms&#40;&#41;;
 #endif
-            if &#40;p12 = d2i_PKCS12_fp&#40;fp, NULL&#41;&#41; {
+            if &#40;&#40;p12 = d2i_PKCS12_fp&#40;fp, NULL&#41;&#41;&#41; {
                 if&#40;load_chain&#41;
                     result= PKCS12_parse&#40;p12, password, &#38;private_key, &#38;certificate, &#38;cachain&#41;;
                 else
@@ -4165,6 +4121,7 @@
     PREINIT:
         simple_cb_data_t* cb = NULL;
     CODE:
+        RETVAL = 0;
         if &#40;SvOK&#40;perl_cb&#41;&#41; {
             /* setup our callback */
             cb = simple_cb_data_new&#40;perl_cb, perl_data&#41;;
@@ -4663,7 +4620,7 @@
         unsigned int md_size;
     PPCODE:
         if &#40;X509_digest&#40;data,type,md,&#38;md_size&#41;&#41;
-            XSRETURN_PVN&#40;&#40;unsigned char *&#41;md, md_size&#41;;
+            XSRETURN_PVN&#40;&#40;char *&#41;md, md_size&#41;;
         XSRETURN_UNDEF;
 
 void
@@ -4675,7 +4632,7 @@
         unsigned int md_size;
     PPCODE:
         if &#40;X509_CRL_digest&#40;data,type,md,&#38;md_size&#41;&#41;
-            XSRETURN_PVN&#40;&#40;unsigned char *&#41;md, md_size&#41;;
+            XSRETURN_PVN&#40;&#40;char *&#41;md, md_size&#41;;
         XSRETURN_UNDEF;
 
 void
@@ -4687,7 +4644,7 @@
         unsigned int md_size;
     PPCODE:
         if &#40;X509_REQ_digest&#40;data,type,md,&#38;md_size&#41;&#41;
-            XSRETURN_PVN&#40;&#40;unsigned char *&#41;md, md_size&#41;;
+            XSRETURN_PVN&#40;&#40;char *&#41;md, md_size&#41;;
         XSRETURN_UNDEF;
 
 void
@@ -4699,7 +4656,7 @@
         unsigned int md_size;
     PPCODE:
         if &#40;X509_NAME_digest&#40;data,type,md,&#38;md_size&#41;&#41;
-            XSRETURN_PVN&#40;&#40;unsigned char *&#41;md, md_size&#41;;
+            XSRETURN_PVN&#40;&#40;char *&#41;md, md_size&#41;;
         XSRETURN_UNDEF;
 
 unsigned long
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1057682" href="/Public/Bug/Display.html?id=75970#txn-1057682">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;02&nbsp;04:39:45&nbsp;2012</span>
    <span class="description">mikem [...] open.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #75970] Adding NPN &#40;Next Protocol Negotiation&#41; support</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 02 Apr 2012 18:39:53 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] open.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1057682/553361/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/553361">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 870b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

Thanks.
Committed in 334.

Cheers.

On Thursday, March 29, 2012 02:45:53 PM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=75970">https://rt.cpan.org/Ticket/Display.html?id=75970</a></span> &gt;
&gt; 
&gt; Fixing compiler warnings even more - see
&gt; fixing_compiler_warnings_V2_r333.diff
</div>-- 
Mike McCauley                               mikem@open.com.au
Open System Consultants Pty. Ltd
9 Bulbul Place Currumbin Waters QLD 4223 Australia   <span class="clickylink"><a target="new" rel="nofollow" href="http://www.open.com.au">http://www.open.com.au</a></span>
Phone +61 7 5598-7474                       Fax   +61 7 5598-7070

Radiator: the most portable, flexible and configurable RADIUS server 
anywhere. SQL, proxy, DBM, files, LDAP, NIS+, password, NT, Emerald, 
Platypus, Freeside, TACACS+, PAM, external, Active Directory, EAP, TLS, 
TTLS, PEAP, TNC, WiMAX, RSA, Vasco, Yubikey, MOTP, HOTP, TOTP,
DIAMETER etc. Full source on Unix, Windows, MacOSX, Solaris, VMS, NetWare etc.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1058020" href="/Public/Bug/Display.html?id=75970#txn-1058020">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;02&nbsp;17:10:19&nbsp;2012</span>
    <span class="description">MIKEM [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">30 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1058020/553547/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/553547">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 37b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for your valuable contribution
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1058023" href="/Public/Bug/Display.html?id=75970#txn-1058023">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;02&nbsp;17:10:21&nbsp;2012</span>
    <span class="description">MIKEM [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Give odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1058025" href="/Public/Bug/Display.html?id=75970#txn-1058025">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;02&nbsp;17:10:21&nbsp;2012</span>
    <span class="description">MIKEM [...] cpan.org -  Given to MIKEM</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 1.198219</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
