<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #67994 for DBD-ODBC: DBD::ODBC doesn&#39;t handle windows-1252 characters correctly</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #67994 for DBD-ODBC: DBD::ODBC doesn&#39;t handle windows-1252 characters correctly</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBD-ODBC">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBD-ODBC">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBD-ODBC">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBD-ODBC">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-ODBC">DBD-ODBC CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">67994</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBD-ODBC">DBD-ODBC</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
bitcard [...] mscha.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-10188-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.29    </td>
  </tr>
  <tr id="CF-10189-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.30_5    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




create_enctest_db.sql<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/938764/487959/create_enctest_db.sql">
Tue May 24 06:49:33 2011 (321b) by bitcard [...] mscha.org
</a>
</font></li>
</ul>


enctest.log<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/937946/487011/enctest.log">
Sun May 22 14:22:03 2011 (71.9k) by bitcard [...] mscha.org
</a>
</font></li>
</ul>


enctest.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/937946/487012/enctest.pl">
Sun May 22 14:22:03 2011 (1.4k) by bitcard [...] mscha.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=67994">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-931707" href="/Public/Bug/Display.html?id=67994#txn-931707">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;06&nbsp;11:41:59&nbsp;2011</span>
    <span class="description">bitcard [...] mscha.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> DBD::ODBC doesn&#39;t handle windows-1252 characters correctly</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/931707/483622/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/483622">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 808b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Using DBI 1.616 and DBD::ODBC 1.29 in ActivePerl 5.12.2 Build 1202 on
Windows 7 to connect to an SQL Server database with default collation
SQL_Latin1_General_CP1_CI_AS, I get data in varchar columns &#40;normal, not
wide&#41; back in un-decoded windows-1252.
&#40;For instance a Euro sign, &#34;€&#34;, is 0x80 instead of 0x20AC.&#41;

Workarounds are:
 - decode myself, using Encode::decode&#40;&#39;windows-1252&#39;, $val&#41; for each
column after each fetch
 - explicitly set column type to SQL_WCHAR

This shouldn&#39;t be necessary, though.

If it isn&#39;t possible for DBD::ODBC to detect that data is encoded in
windows-1252, perhaps a database handle attribute could be added to tell
DBD::ODBC the encoding of the ODBC connection?

See also:
<span class="clickylink"><a target="new" rel="nofollow" href="http://stackoverflow.com/questions/5912082/automatic-character-encoding-handling-in-perl-dbi-dbdodbc">http://stackoverflow.com/questions/5912082/automatic-character-encoding-handling-in-perl-dbi-dbdodbc</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-933505" href="/Public/Bug/Display.html?id=67994#txn-933505">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;11&nbsp;03:45:13&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/933505/484621/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/484621">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri May 06 11:41:59 2011, mscha wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Using DBI 1.616 and DBD::ODBC 1.29 in ActivePerl 5.12.2 Build 1202 on
&gt; Windows 7 to connect to an SQL Server database with default collation
&gt; SQL_Latin1_General_CP1_CI_AS, I get data in varchar columns &#40;normal,
&gt; not
&gt; wide&#41; back in un-decoded windows-1252.
&gt; &#40;For instance a Euro sign, &#34;€&#34;, is 0x80 instead of 0x20AC.&#41;
&gt; 
&gt; Workarounds are:
&gt;  - decode myself, using Encode::decode&#40;&#39;windows-1252&#39;, $val&#41; for each
&gt; column after each fetch
&gt;  - explicitly set column type to SQL_WCHAR
&gt; 
&gt; This shouldn&#39;t be necessary, though.
&gt; 
&gt; If it isn&#39;t possible for DBD::ODBC to detect that data is encoded in
&gt; windows-1252, perhaps a database handle attribute could be added to
&gt; tell
&gt; DBD::ODBC the encoding of the ODBC connection?
&gt; 
&gt; See also:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://stackoverflow.com/questions/5912082/automatic-character-">http://stackoverflow.com/questions/5912082/automatic-character-</a></span>
&gt; encoding-handling-in-perl-dbi-dbdodbc
</div>
See
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.nntp.perl.org/group/perl.dbi.dev/2011/05/msg6559.html">http://www.nntp.perl.org/group/perl.dbi.dev/2011/05/msg6559.html</a></span>

If I was to make the suggested change are you in a position to test it?

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-933508" href="/Public/Bug/Display.html?id=67994#txn-933508">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;11&nbsp;03:45:14&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-935343" href="/Public/Bug/Display.html?id=67994#txn-935343">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;16&nbsp;03:46:20&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/935343/485620/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/485620">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed May 11 03:45:13 2011, MJEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri May 06 11:41:59 2011, mscha wrote:
<div class="message-stanza open">&gt; &gt; Using DBI 1.616 and DBD::ODBC 1.29 in ActivePerl 5.12.2 Build 1202 on
&gt; &gt; Windows 7 to connect to an SQL Server database with default collation
&gt; &gt; SQL_Latin1_General_CP1_CI_AS, I get data in varchar columns &#40;normal,
&gt; &gt; not
&gt; &gt; wide&#41; back in un-decoded windows-1252.
&gt; &gt; &#40;For instance a Euro sign, &#34;€&#34;, is 0x80 instead of 0x20AC.&#41;
&gt; &gt; 
&gt; &gt; Workarounds are:
&gt; &gt;  - decode myself, using Encode::decode&#40;&#39;windows-1252&#39;, $val&#41; for each
&gt; &gt; column after each fetch
&gt; &gt;  - explicitly set column type to SQL_WCHAR
&gt; &gt; 
&gt; &gt; This shouldn&#39;t be necessary, though.
&gt; &gt; 
&gt; &gt; If it isn&#39;t possible for DBD::ODBC to detect that data is encoded in
&gt; &gt; windows-1252, perhaps a database handle attribute could be added to
&gt; &gt; tell
&gt; &gt; DBD::ODBC the encoding of the ODBC connection?
&gt; &gt; 
&gt; &gt; See also:
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://stackoverflow.com/questions/5912082/automatic-character-">http://stackoverflow.com/questions/5912082/automatic-character-</a></span>
&gt; &gt; encoding-handling-in-perl-dbi-dbdodbc
</div>&gt; 
&gt; See
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.nntp.perl.org/group/perl.dbi.dev/2011/05/msg6559.html">http://www.nntp.perl.org/group/perl.dbi.dev/2011/05/msg6559.html</a></span>
&gt; 
&gt; If I was to make the suggested change are you in a position to test it?
&gt; 
&gt; Martin
</div>
Try 1.30_1 on CPAN now.

Please let me know if this addresses your issue so I can write this rt off.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-937944" href="/Public/Bug/Display.html?id=67994#txn-937944">#</a>      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;22&nbsp;14:19:59&nbsp;2011</span>
    <span class="description">bitcard [...] mscha.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> bitcard [...] mscha.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/937944/487007/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/487007">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon May 16 03:46:20 2011, MJEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed May 11 03:45:13 2011, MJEVANS wrote:
<div class="message-stanza open">&gt; &gt; On Fri May 06 11:41:59 2011, mscha wrote:
<div class="message-stanza open">&gt; &gt; &gt; Using DBI 1.616 and DBD::ODBC 1.29 in ActivePerl 5.12.2 Build 1202 on
&gt; &gt; &gt; Windows 7 to connect to an SQL Server database with default collation
&gt; &gt; &gt; SQL_Latin1_General_CP1_CI_AS, I get data in varchar columns &#40;normal,
&gt; &gt; &gt; not
&gt; &gt; &gt; wide&#41; back in un-decoded windows-1252.
&gt; &gt; &gt; &#40;For instance a Euro sign, &#34;€&#34;, is 0x80 instead of 0x20AC.&#41;
&gt; &gt; &gt; 
&gt; &gt; &gt; Workarounds are:
&gt; &gt; &gt;  - decode myself, using Encode::decode&#40;&#39;windows-1252&#39;, $val&#41; for each
&gt; &gt; &gt; column after each fetch
&gt; &gt; &gt;  - explicitly set column type to SQL_WCHAR
&gt; &gt; &gt; 
&gt; &gt; &gt; This shouldn&#39;t be necessary, though.
&gt; &gt; &gt; 
&gt; &gt; &gt; If it isn&#39;t possible for DBD::ODBC to detect that data is encoded in
&gt; &gt; &gt; windows-1252, perhaps a database handle attribute could be added to
&gt; &gt; &gt; tell
&gt; &gt; &gt; DBD::ODBC the encoding of the ODBC connection?
&gt; &gt; &gt; 
&gt; &gt; &gt; See also:
&gt; &gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://stackoverflow.com/questions/5912082/automatic-character-">http://stackoverflow.com/questions/5912082/automatic-character-</a></span>
&gt; &gt; &gt; encoding-handling-in-perl-dbi-dbdodbc
</div>&gt; &gt; 
&gt; &gt; See
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.nntp.perl.org/group/perl.dbi.dev/2011/05/msg6559.html">http://www.nntp.perl.org/group/perl.dbi.dev/2011/05/msg6559.html</a></span>
&gt; &gt; 
&gt; &gt; If I was to make the suggested change are you in a position to test it?
&gt; &gt; 
&gt; &gt; Martin
</div>&gt; 
&gt; Try 1.30_1 on CPAN now.
&gt; 
&gt; Please let me know if this addresses your issue so I can write this rt
</div>off.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
</div>
Apologies for the late response.

The chosen solution sounds like the right one to me.
However, it does not appear to work...

I installed 1.30_4 as described in README.windows:
    cpan MJEVANS/DBD-ODBC-1.30_4.tar.gz
&#40;The compiler is MS Visual Studio 2008.&#41;

I then wrote a little test script.  Without specifying a bind type, I
still get data back in the legacy encoding &#40;Windows-1252, a Euro sign
&#40;€&#41; is 0x80&#41;.  If I bind explicitly as SQL_WCHAR, I do get a properly
encoded Euro sign &#40;0x8364&#41;.

    DBD::ODBC version 1.30_4
    odbc_has_unicode: 1
    odbc_old_unicode:
    Title with default bind type:   &#39;eBookbon: ▒ 10&#39;
        &#39;▒&#39;: 128
    Title with bind type SQL_WCHAR: &#39;eBookbon: € 10&#39;
        &#39;€&#39;: 8364

I&#39;ll attach the script &#40;enctest.pl&#41; to this bug report, together with
the output using  DBI_TRACE=15=enctest.log.

&#40;I also tried 1.30_1, in case it worked there and had been broken again
in one of the later releases, but it behaves exactly the same.&#41;

Thanks,

 - Michael
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-937946" href="/Public/Bug/Display.html?id=67994#txn-937946">#</a>      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;22&nbsp;14:22:02&nbsp;2011</span>
    <span class="description">bitcard [...] mscha.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> bitcard [...] mscha.org</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/937946/487010/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/487010">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun May 22 14:19:59 2011, mscha wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon May 16 03:46:20 2011, MJEVANS wrote:
<div class="message-stanza open">&gt; &gt; On Wed May 11 03:45:13 2011, MJEVANS wrote:
<div class="message-stanza open">&gt; &gt; &gt; On Fri May 06 11:41:59 2011, mscha wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; Using DBI 1.616 and DBD::ODBC 1.29 in ActivePerl 5.12.2 Build
</div></div></div></div>1202 on
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; &gt; &gt; Windows 7 to connect to an SQL Server database with default
</div></div>collation
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; &gt; &gt; SQL_Latin1_General_CP1_CI_AS, I get data in varchar columns &#40;normal,
&gt; &gt; &gt; &gt; not
&gt; &gt; &gt; &gt; wide&#41; back in un-decoded windows-1252.
&gt; &gt; &gt; &gt; &#40;For instance a Euro sign, &#34;€&#34;, is 0x80 instead of 0x20AC.&#41;
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Workarounds are:
&gt; &gt; &gt; &gt;  - decode myself, using Encode::decode&#40;&#39;windows-1252&#39;, $val&#41; for
</div></div>each
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt; column after each fetch
&gt; &gt; &gt; &gt;  - explicitly set column type to SQL_WCHAR
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; This shouldn&#39;t be necessary, though.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; If it isn&#39;t possible for DBD::ODBC to detect that data is encoded in
&gt; &gt; &gt; &gt; windows-1252, perhaps a database handle attribute could be added to
&gt; &gt; &gt; &gt; tell
&gt; &gt; &gt; &gt; DBD::ODBC the encoding of the ODBC connection?
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; See also:
&gt; &gt; &gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://stackoverflow.com/questions/5912082/automatic-character-">http://stackoverflow.com/questions/5912082/automatic-character-</a></span>
&gt; &gt; &gt; &gt; encoding-handling-in-perl-dbi-dbdodbc
</div>&gt; &gt; &gt; 
&gt; &gt; &gt; See
&gt; &gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.nntp.perl.org/group/perl.dbi.dev/2011/05/msg6559.html">http://www.nntp.perl.org/group/perl.dbi.dev/2011/05/msg6559.html</a></span>
&gt; &gt; &gt; 
&gt; &gt; &gt; If I was to make the suggested change are you in a position to
</div></div>test it?
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; 
&gt; &gt; &gt; Martin
</div>&gt; &gt; 
&gt; &gt; Try 1.30_1 on CPAN now.
&gt; &gt; 
&gt; &gt; Please let me know if this addresses your issue so I can write this rt
</div>&gt; off.
<div class="message-stanza open">&gt; &gt; 
</div>&gt; 
&gt; Apologies for the late response.
&gt; 
&gt; The chosen solution sounds like the right one to me.
&gt; However, it does not appear to work...
&gt; 
&gt; I installed 1.30_4 as described in README.windows:
&gt;     cpan MJEVANS/DBD-ODBC-1.30_4.tar.gz
&gt; &#40;The compiler is MS Visual Studio 2008.&#41;
&gt; 
&gt; I then wrote a little test script.  Without specifying a bind type, I
&gt; still get data back in the legacy encoding &#40;Windows-1252, a Euro sign
&gt; &#40;€&#41; is 0x80&#41;.  If I bind explicitly as SQL_WCHAR, I do get a properly
&gt; encoded Euro sign &#40;0x8364&#41;.
&gt; 
&gt;     DBD::ODBC version 1.30_4
&gt;     odbc_has_unicode: 1
&gt;     odbc_old_unicode:
&gt;     Title with default bind type:   &#39;eBookbon: ▒ 10&#39;
&gt;         &#39;▒&#39;: 128
&gt;     Title with bind type SQL_WCHAR: &#39;eBookbon: € 10&#39;
&gt;         &#39;€&#39;: 8364
&gt; 
&gt; I&#39;ll attach the script &#40;enctest.pl&#41; to this bug report, together with
&gt; the output using  DBI_TRACE=15=enctest.log.
</div>
And here they are...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; &#40;I also tried 1.30_1, in case it worked there and had been broken again
&gt; in one of the later releases, but it behaves exactly the same.&#41;
&gt; 
&gt; Thanks,
&gt; 
&gt;  - Michael
</div></div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> enctest.log</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/937946/487011/enctest.log">Download enctest.log</a><br />
<span class="downloadcontenttype">application/octet-stream 71.9k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> enctest.pl</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/937946/487012/enctest.pl">Download enctest.pl</a><br />
<span class="downloadcontenttype">text/x-perl 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/opt/perl/bin/perl 

use strict;
use warnings;
use 5.010;
use utf8;
use autodie;

use DBI qw&#40;:sql_types&#41;;
use DBD::ODBC;

############################################################

my $DB_NAME = &#39;&#40;censored&#41;&#39;;
my $DB = &#34;dbi:ODBC:Driver={SQL Server Native Client 10.0};Server=localhost;Database=$DB_NAME;Trusted_Connection=yes;&#34;;
my $DB_USER = &#39;&#40;censored&#41;&#39;;
my $DB_PASS = &#39;&#40;censored&#41;&#39;;
my $DB_OPTIONS = { RaiseError =&gt; 1, AutoCommit =&gt; 1 };

############################################################

#binmode STDOUT, &#39;:utf8&#39;;

say &#34;DBD::ODBC version $DBD::ODBC::VERSION&#34;;

my $dbh = DBI-&gt;connect&#40;$DB, $DB_USER, $DB_PASS, $DB_OPTIONS&#41;;
foreach my $attr &#40;qw&#40;odbc_has_unicode odbc_old_unicode&#41;&#41; {
    say &#34;$attr: &#34;, $dbh-&gt;{$attr} // &#39;&#39;;
}

# Title is a varchar&#40;2000&#41;.  The collation is SQL_Latin1_General_CP1_CI_AS, better known as windows-1252.
my $sth = $dbh-&gt;prepare&#40;&#34;SELECT Title, Title FROM Product WHERE EAN = &#39;3880060000010&#39;&#34;&#41;;
$sth-&gt;execute&#40;&#41;;
my &#40;$title1, $title2&#41;;
$sth-&gt;bind_col&#40;1, \$title1&#41;;
$sth-&gt;bind_col&#40;2, \$title2, SQL_WCHAR&#41;;
while &#40;$sth-&gt;fetch&#40;&#41;&#41; {
    printf&#40;&#34;Title with default bind type:   &#39;%s&#39;\n&#34;, $title1&#41;;
    my @high1 = $title1 =~ m{&#40;[^\x00-\x7F]&#41;}g;
    foreach my $h &#40;@high1&#41; {
        printf&#40;&#34;    &#39;%s&#39;: %d\n&#34;, $h, ord&#40;$h&#41;&#41;;
    }
    printf&#40;&#34;Title with bind type SQL_WCHAR: &#39;%s&#39;\n&#34;, $title2&#41;;
    my @high2 = $title2 =~ m{&#40;[^\x00-\x7F]&#41;}g;
    foreach my $h &#40;@high2&#41; {
        printf&#40;&#34;    &#39;%s&#39;: %d\n&#34;, $h, ord&#40;$h&#41;&#41;;
    }
}

$dbh-&gt;disconnect&#40;&#41;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-938701" href="/Public/Bug/Display.html?id=67994#txn-938701">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;24&nbsp;04:36:30&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/938701/487911/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/487911">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun May 22 14:22:02 2011, mscha wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; I installed 1.30_4 as described in README.windows:
&gt; &gt;     cpan MJEVANS/DBD-ODBC-1.30_4.tar.gz
&gt; &gt; &#40;The compiler is MS Visual Studio 2008.&#41;
&gt; &gt; 
&gt; &gt; I then wrote a little test script.  Without specifying a bind type, I
&gt; &gt; still get data back in the legacy encoding &#40;Windows-1252, a Euro sign
&gt; &gt; &#40;€&#41; is 0x80&#41;.  If I bind explicitly as SQL_WCHAR, I do get a properly
&gt; &gt; encoded Euro sign &#40;0x8364&#41;.
&gt; &gt; 
&gt; &gt;     DBD::ODBC version 1.30_4
&gt; &gt;     odbc_has_unicode: 1
&gt; &gt;     odbc_old_unicode:
&gt; &gt;     Title with default bind type:   &#39;eBookbon: ▒ 10&#39;
&gt; &gt;         &#39;▒&#39;: 128
&gt; &gt;     Title with bind type SQL_WCHAR: &#39;eBookbon: € 10&#39;
&gt; &gt;         &#39;€&#39;: 8364
&gt; &gt; 
&gt; &gt; I&#39;ll attach the script &#40;enctest.pl&#41; to this bug report, together with
&gt; &gt; the output using  DBI_TRACE=15=enctest.log.
</div>&gt; 
&gt; And here they are...
&gt; 
<div class="message-stanza open">&gt; &gt; 
&gt; &gt; &#40;I also tried 1.30_1, in case it worked there and had been broken again
&gt; &gt; in one of the later releases, but it behaves exactly the same.&#41;
&gt; &gt; 
&gt; &gt; Thanks,
&gt; &gt; 
&gt; &gt;  - Michael
</div>&gt; 
</div>
Thanks Michael.

Unfortunately I cannot reproduce your problem here which is making this
difficult. Is there any way you could send me some SQL exported from
your SQL Server which sets the table and columns up as you have it and a
row of data?

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-938764" href="/Public/Bug/Display.html?id=67994#txn-938764">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;24&nbsp;06:49:33&nbsp;2011</span>
    <span class="description">bitcard [...] mscha.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> bitcard [...] mscha.org</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/938764/487958/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/487958">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 749b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue May 24 04:36:30 2011, MJEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Unfortunately I cannot reproduce your problem here which is making this
&gt; difficult. Is there any way you could send me some SQL exported from
&gt; your SQL Server which sets the table and columns up as you have it and a
&gt; row of data?
</div>
The attached script should do the trick.  Tested on SQL Server 2008,
works with enctest.pl which I posted earlier &#40;if you change database,
username and password accordingly&#41;.

Of course, you should check if the encoding doesn&#39;t get corrupted
somewhere along the way, and the row is inserted correctly.  The SELECT
at the end of the script should return:
3880060000010   eBookbon: € 10
&#40;i.e. with a Euro sign between the colon and the number 10&#41;.

Thanks,

 - Michael
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> create_enctest_db.sql</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/938764/487959/create_enctest_db.sql">Download create_enctest_db.sql</a><br />
<span class="downloadcontenttype">application/octet-stream 321b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-938783" href="/Public/Bug/Display.html?id=67994#txn-938783">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;24&nbsp;08:50:53&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/938783/487975/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/487975">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue May 24 06:49:33 2011, mscha wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Tue May 24 04:36:30 2011, MJEVANS wrote:
<div class="message-stanza open">&gt; &gt; 
&gt; &gt; Unfortunately I cannot reproduce your problem here which is making 
</div></div>this
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; difficult. Is there any way you could send me some SQL exported from
&gt; &gt; your SQL Server which sets the table and columns up as you have it 
</div></div>and a
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; row of data?
</div>&gt; 
&gt; The attached script should do the trick.  Tested on SQL Server 2008,
&gt; works with enctest.pl which I posted earlier &#40;if you change database,
&gt; username and password accordingly&#41;.
&gt; 
&gt; Of course, you should check if the encoding doesn&#39;t get corrupted
&gt; somewhere along the way, and the row is inserted correctly.  The 
</div>SELECT
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; at the end of the script should return:
&gt; 3880060000010 eBookbon: € 10
&gt; &#40;i.e. with a Euro sign between the colon and the number 10&#41;.
&gt; 
&gt; Thanks,
&gt; 
&gt;  - Michael
</div>
Michael,

Could you try changing the lines around line 2239 in dbdimp.c to:

if &#40;!imp_sth-&gt;odbc_old_unicode &#38;&#38;
   &#40;fbh-&gt;ColSqlType == SQL_CHAR || fbh-&gt;ColSqlType == SQL_VARCHAR&#41;&#41; {
                  fbh-&gt;ColSqlType = SQL_WCHAR;
}

note, I&#39;ve added || fbh-&gt;ColSqlType == SQL_VARCHAR

run nmake/dmake or whatever you did before to rebuild it and try again.

You can either make install it or do something like:

perl -Iblib\lib -Iblib\arch myscript.pl

from the build directory.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-938857" href="/Public/Bug/Display.html?id=67994#txn-938857">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;24&nbsp;12:19:09&nbsp;2011</span>
    <span class="description">bitcard [...] mscha.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> bitcard [...] mscha.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/938857/488027/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/488027">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue May 24 08:50:53 2011, MJEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Tue May 24 06:49:33 2011, mscha wrote:
<div class="message-stanza open">&gt; &gt; On Tue May 24 04:36:30 2011, MJEVANS wrote:
<div class="message-stanza open">&gt; &gt; &gt; 
&gt; &gt; &gt; Unfortunately I cannot reproduce your problem here which is making 
</div></div>&gt; this
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; difficult. Is there any way you could send me some SQL exported from
&gt; &gt; &gt; your SQL Server which sets the table and columns up as you have it 
</div></div>&gt; and a
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; row of data?
</div>&gt; &gt; 
&gt; &gt; The attached script should do the trick.  Tested on SQL Server 2008,
&gt; &gt; works with enctest.pl which I posted earlier &#40;if you change database,
&gt; &gt; username and password accordingly&#41;.
&gt; &gt; 
&gt; &gt; Of course, you should check if the encoding doesn&#39;t get corrupted
&gt; &gt; somewhere along the way, and the row is inserted correctly.  The 
</div>&gt; SELECT
<div class="message-stanza open">&gt; &gt; at the end of the script should return:
&gt; &gt; 3880060000010       eBookbon: € 10
&gt; &gt; &#40;i.e. with a Euro sign between the colon and the number 10&#41;.
&gt; &gt; 
&gt; &gt; Thanks,
&gt; &gt; 
&gt; &gt;  - Michael
</div>&gt; 
&gt; Michael,
&gt; 
&gt; Could you try changing the lines around line 2239 in dbdimp.c to:
&gt; 
&gt; if &#40;!imp_sth-&gt;odbc_old_unicode &#38;&#38;
&gt;    &#40;fbh-&gt;ColSqlType == SQL_CHAR || fbh-&gt;ColSqlType == SQL_VARCHAR&#41;&#41; {
&gt;                 fbh-&gt;ColSqlType = SQL_WCHAR;
&gt; }
&gt; 
&gt; note, I&#39;ve added || fbh-&gt;ColSqlType == SQL_VARCHAR
&gt; 
&gt; run nmake/dmake or whatever you did before to rebuild it and try again.
&gt; 
&gt; You can either make install it or do something like:
&gt; 
&gt; perl -Iblib\lib -Iblib\arch myscript.pl
&gt; 
&gt; from the build directory.
&gt; 
&gt; Martin
</div>
DBD::ODBC version 1.30_4
odbc_has_unicode: 1
odbc_old_unicode:
Title with default bind type:   &#39;eBookbon: € 10&#39;
    &#39;€&#39;: 8364
Title with bind type SQL_WCHAR: &#39;eBookbon: € 10&#39;
    &#39;€&#39;: 8364

:-&#41;

Thanks,

 - Michael
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-938885" href="/Public/Bug/Display.html?id=67994#txn-938885">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;24&nbsp;12:40:32&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/938885/488039/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/488039">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue May 24 12:19:09 2011, mscha wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Tue May 24 08:50:53 2011, MJEVANS wrote:
<div class="message-stanza open">&gt; &gt; On Tue May 24 06:49:33 2011, mscha wrote:
<div class="message-stanza open">&gt; &gt; &gt; On Tue May 24 04:36:30 2011, MJEVANS wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Unfortunately I cannot reproduce your problem here which is 
</div></div></div></div>making 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; this
<div class="message-stanza open">&gt; &gt; &gt; &gt; difficult. Is there any way you could send me some SQL exported 
</div></div></div>from
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; &gt; &gt; your SQL Server which sets the table and columns up as you have 
</div></div>it 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; and a
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt; row of data?
</div>&gt; &gt; &gt; 
&gt; &gt; &gt; The attached script should do the trick.  Tested on SQL Server 
</div></div></div>2008,
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; &gt; works with enctest.pl which I posted earlier &#40;if you change 
</div></div>database,
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; username and password accordingly&#41;.
&gt; &gt; &gt; 
&gt; &gt; &gt; Of course, you should check if the encoding doesn&#39;t get corrupted
&gt; &gt; &gt; somewhere along the way, and the row is inserted correctly.  The 
</div>&gt; &gt; SELECT
<div class="message-stanza open">&gt; &gt; &gt; at the end of the script should return:
&gt; &gt; &gt; 3880060000010     eBookbon: € 10
&gt; &gt; &gt; &#40;i.e. with a Euro sign between the colon and the number 10&#41;.
&gt; &gt; &gt; 
&gt; &gt; &gt; Thanks,
&gt; &gt; &gt; 
&gt; &gt; &gt;  - Michael
</div>&gt; &gt; 
&gt; &gt; Michael,
&gt; &gt; 
&gt; &gt; Could you try changing the lines around line 2239 in dbdimp.c to:
&gt; &gt; 
&gt; &gt; if &#40;!imp_sth-&gt;odbc_old_unicode &#38;&#38;
&gt; &gt;    &#40;fbh-&gt;ColSqlType == SQL_CHAR || fbh-&gt;ColSqlType == SQL_VARCHAR&#41;&#41; 
</div></div>{
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt;               fbh-&gt;ColSqlType = SQL_WCHAR;
&gt; &gt; }
&gt; &gt; 
&gt; &gt; note, I&#39;ve added || fbh-&gt;ColSqlType == SQL_VARCHAR
&gt; &gt; 
&gt; &gt; run nmake/dmake or whatever you did before to rebuild it and try 
</div></div>again.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; 
&gt; &gt; You can either make install it or do something like:
&gt; &gt; 
&gt; &gt; perl -Iblib\lib -Iblib\arch myscript.pl
&gt; &gt; 
&gt; &gt; from the build directory.
&gt; &gt; 
&gt; &gt; Martin
</div>&gt; 
&gt; DBD::ODBC version 1.30_4
&gt; odbc_has_unicode: 1
&gt; odbc_old_unicode:
&gt; Title with default bind type:   &#39;eBookbon: € 10&#39;
&gt;     &#39;€&#39;: 8364
&gt; Title with bind type SQL_WCHAR: &#39;eBookbon: € 10&#39;
&gt;     &#39;€&#39;: 8364
&gt; 
&gt; :-&#41;
&gt; 
&gt; Thanks,
&gt; 
&gt;  - Michael
</div>
\o/

I will release this as 1.30_5 development release later tonight.

Thanks for sticking with this to the end and providing enough detail to 
find a solution.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-939268" href="/Public/Bug/Display.html?id=67994#txn-939268">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;25&nbsp;09:43:34&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-939270" href="/Public/Bug/Display.html?id=67994#txn-939270">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;May&nbsp;25&nbsp;09:43:34&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Fixed in 1.30_5 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.740612</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
