<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #63034 for Log-Syslog-Fast: die on EAGAIN</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #63034 for Log-Syslog-Fast: die on EAGAIN</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Log-Syslog-Fast/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Log-Syslog-Fast/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Log-Syslog-Fast/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Log-Syslog-Fast/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Log-Syslog-Fast">Log-Syslog-Fast CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">63034</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Log-Syslog-Fast/Active/">Log-Syslog-Fast</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
POWERMAN [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-227984-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.45    </td>
  </tr>
  <tr id="CF-227985-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;16&nbsp;06:04:16&nbsp;2010</span>
    <span class="description">POWERMAN [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> die on EAGAIN</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">When sending too many log messages too fast Log::Syslog::Fast will die 
because it got EAGAIN in LogSyslogFast.c at LSF_send&#40;&#41;. I&#39;ve tested 
this using UNIX socket on Linux, but this can happens with any socket 
type.

It&#39;s possible to fix it this way:

    int ret = send&#40;logger-&gt;sock, logger-&gt;linebuf, logger-&gt;prefix_len + 
msg_len, MSG_DONTWAIT&#41;;
    if &#40;ret &lt; 0&#41; {
        if &#40;errno == EAGAIN&#41;
            ret = send&#40;logger-&gt;sock, logger-&gt;linebuf, logger-
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;prefix_len + msg_len, 0&#41;;
</div>        if &#40;ret &lt; 0&#41;
            logger-&gt;err = strerror&#40;errno&#41;;
    }

but in my tests this solution has same speed as much simpler fix:

    int ret = send&#40;logger-&gt;sock, logger-&gt;linebuf, logger-&gt;prefix_len + 
msg_len, 0&#41;;
    if &#40;ret &lt; 0&#41;
        logger-&gt;err = strerror&#40;errno&#41;;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;16&nbsp;18:07:50&nbsp;2010</span>
    <span class="description">athomason [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">What is the advantage of handling these retries here rather than after
catching the exception?

On Tue Nov 16 06:04:16 2010, POWERMAN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; When sending too many log messages too fast Log::Syslog::Fast will die 
&gt; because it got EAGAIN in LogSyslogFast.c at LSF_send&#40;&#41;. I&#39;ve tested 
&gt; this using UNIX socket on Linux, but this can happens with any socket 
&gt; type.
&gt; 
&gt; It&#39;s possible to fix it this way:
&gt; 
&gt;     int ret = send&#40;logger-&gt;sock, logger-&gt;linebuf, logger-&gt;prefix_len + 
&gt; msg_len, MSG_DONTWAIT&#41;;
&gt;     if &#40;ret &lt; 0&#41; {
&gt;         if &#40;errno == EAGAIN&#41;
&gt;             ret = send&#40;logger-&gt;sock, logger-&gt;linebuf, logger-
<div class="message-stanza open">&gt; &gt;prefix_len + msg_len, 0&#41;;
</div>&gt;         if &#40;ret &lt; 0&#41;
&gt;             logger-&gt;err = strerror&#40;errno&#41;;
&gt;     }
&gt; 
&gt; but in my tests this solution has same speed as much simpler fix:
&gt; 
&gt;     int ret = send&#40;logger-&gt;sock, logger-&gt;linebuf, logger-&gt;prefix_len + 
&gt; msg_len, 0&#41;;
&gt;     if &#40;ret &lt; 0&#41;
&gt;         logger-&gt;err = strerror&#40;errno&#41;;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;16&nbsp;18:07:51&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;16&nbsp;19:58:40&nbsp;2010</span>
    <span class="description">POWERMAN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Nov 16 18:07:50 2010, ATHOMASON wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; What is the advantage of handling these retries here rather than after
&gt; catching the exception?
</div>
Advantage? Raising exception while, possibly, logging another exception 
isn&#39;t good idea at all! Especially in this situation, because it isn&#39;t 
real error, it&#39;s just EAGAIN. How user can handle it? Retry sending same 
message to log in loop until success or some other, real error?

The right question is what advantage in using non-blocking send&#40;&#41; there?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;16&nbsp;20:40:39&nbsp;2010</span>
    <span class="description">athomason [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Nov 16 19:58:40 2010, POWERMAN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Tue Nov 16 18:07:50 2010, ATHOMASON wrote:
<div class="message-stanza open">&gt; &gt; What is the advantage of handling these retries here rather than after
&gt; &gt; catching the exception?
</div>&gt; 
&gt; Advantage? Raising exception while, possibly, logging another exception 
&gt; isn&#39;t good idea at all!
</div>Why not? Just wrap the send call in an eval.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Especially in this situation, because it isn&#39;t 
&gt; real error, it&#39;s just EAGAIN.
</div>That is a real error for applications for which blocking on I/O is
unacceptable.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; How user can handle it? Retry sending same 
&gt; message to log in loop until success or some other, real error?
</div>Unless I&#39;m missing something, a single retry is exactly what you&#39;re
proposing. But since that&#39;s a policy decision that may be undesirable to
some clients, and it&#39;s doable at a higher level, I don&#39;t think it&#39;s
appropriate to address here.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; The right question is what advantage in using non-blocking send&#40;&#41; there?
</div>For applications which are not ever allowed to block &#40;like event-loop
based multiplexing servers&#41;, immediate return of an undeliverable
message is the only acceptable behavior. The exception is thrown so that
buffering and retries can be done at a higher layer if desirable.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;16&nbsp;22:00:58&nbsp;2010</span>
    <span class="description">POWERMAN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Nov 16 20:40:39 2010, ATHOMASON wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Unless I&#39;m missing something, a single retry is exactly what you&#39;re
&gt; proposing.
</div>I&#39;ve proposed single _blocking_ retry call.
But I got your point now, and it have sense, thanks.

Probably your implied policy have to be documented. Actually, current 
documentation doesn&#39;t match that policy:

1&#41; METHODS - new&#40;&#41; - $proto states $logger-&gt;send&#40;&#41; will block for 
LOG_UNIX
2&#41; UNREACHABLE SERVERS - LOG_UNIX doesn&#39;t mention raised exception on 
EAGAIN, and that&#39;s only place where exceptions documented.

BTW, I&#39;m using only non-blocking I/O for years in nearly all projects, 
so I understood your needs, but don&#39;t 100% agree with proposed 
solution. In event-loop based applications with non-blocking I/O it&#39;s 
usual to have all sockets managed by epoll&#40;&#41;-like thing. There usually 
some low level engine, which control _all_ sockets, automatically 
handle EAGAIN, keep outgoing buffers for all sockets, etc. So, if you 
design your logger module for such environment it have much more sense 
to provide some way to delegate managing of log socket to same low-
level engine used in user&#39;s application &#40;like EV or AnyEvent modules&#41;. 
And throw exception/send error event to user only when buffer is full 
or something like that, not on every EAGAIN.

IMHO handing EAGAIN on user level is just plain wrong in such 
applications - that&#39;s too low level thing, it require complex enough 
handing &#40;especially when log socket doesn&#39;t delegated to epoll and user 
can&#39;t just get event notification when socket will be ready to accept 
more data&#41;, and there not much things user can do with this.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;16&nbsp;22:12:35&nbsp;2010</span>
    <span class="description">athomason [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Nov 16 22:00:58 2010, POWERMAN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Tue Nov 16 20:40:39 2010, ATHOMASON wrote:
<div class="message-stanza open">&gt; &gt; Unless I&#39;m missing something, a single retry is exactly what you&#39;re
&gt; &gt; proposing.
</div>&gt; I&#39;ve proposed single _blocking_ retry call.
&gt; But I got your point now, and it have sense, thanks.
&gt; 
&gt; Probably your implied policy have to be documented. Actually, current 
&gt; documentation doesn&#39;t match that policy:
&gt; 
&gt; 1&#41; METHODS - new&#40;&#41; - $proto states $logger-&gt;send&#40;&#41; will block for 
&gt; LOG_UNIX
&gt; 2&#41; UNREACHABLE SERVERS - LOG_UNIX doesn&#39;t mention raised exception on 
&gt; EAGAIN, and that&#39;s only place where exceptions documented.
</div>Oh, this is about LOG_UNIX? I just assumed you were using LOG_UDP since
that&#39;s the only one that&#39;s configured to be non-blocking &#40;see
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/athomason/Log-Syslog-Fast/blob/master/LogSyslogFast.c#L143&#41;">https://github.com/athomason/Log-Syslog-Fast/blob/master/LogSyslogFast.c#L143&#41;</a></span>.
AFAIK LOG_UNIX should never have an EAGAIN error since send&#40;2&#41; is only
supposed to return that for a nonblocking socket. Do you have a test
case showing that behavior?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; BTW, I&#39;m using only non-blocking I/O for years in nearly all projects, 
&gt; so I understood your needs, but don&#39;t 100% agree with proposed 
&gt; solution. In event-loop based applications with non-blocking I/O it&#39;s 
&gt; usual to have all sockets managed by epoll&#40;&#41;-like thing. There usually 
&gt; some low level engine, which control _all_ sockets, automatically 
&gt; handle EAGAIN, keep outgoing buffers for all sockets, etc. So, if you 
&gt; design your logger module for such environment it have much more sense 
&gt; to provide some way to delegate managing of log socket to same low-
&gt; level engine used in user&#39;s application &#40;like EV or AnyEvent modules&#41;. 
&gt; And throw exception/send error event to user only when buffer is full 
&gt; or something like that, not on every EAGAIN.
</div>Indeed, that&#39;s what something like Log::Syslog::DangaSocket is for
&#40;using the Danga::Socket epoll-based event loop&#41;. The assumption in
L::S::Fast is that use of the unreliable UDP transport goes with a
desire for &#34;fire and forget&#34; logging.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; IMHO handing EAGAIN on user level is just plain wrong in such 
&gt; applications - that&#39;s too low level thing, it require complex enough 
&gt; handing &#40;especially when log socket doesn&#39;t delegated to epoll and user 
&gt; can&#39;t just get event notification when socket will be ready to accept 
&gt; more data&#41;, and there not much things user can do with this.
</div>There&#39;s not much the module can do either; the &#34;right&#34; behavior on
failure depends on the application. In the frequent case where the retry
fails as well, the policy decision needs to be made again. But that
decision should be at a higher level; not necessarily as high as the
client code, but possibly as a subclass which overrides send&#40;&#41; to handle
retries.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;16&nbsp;22:43:14&nbsp;2010</span>
    <span class="description">POWERMAN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Nov 16 22:12:35 2010, ATHOMASON wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Oh, this is about LOG_UNIX? I just assumed you were using LOG_UDP 
</div>since
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; that&#39;s the only one that&#39;s configured to be non-blocking &#40;see https://
</div>github.com/athomason/Log-Syslog-Fast/blob/master/LogSyslogFast.c#L143&#41;.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; AFAIK LOG_UNIX should never have an EAGAIN error since send&#40;2&#41; is only
&gt; supposed to return that for a nonblocking socket. Do you have a test
&gt; case showing that behavior?
</div>
Yeah, it&#39;s about LOG_UNIX. You&#39;re using send&#40;MSG_DONTWAIT&#41;, and this 
force non-blocking behavior even on blocking sockets. 
Test case &#40;carefully, it will flood your system&#39;s syslog&#41;:

$ LANG= ./lsf_EAGAIN
[iteration 340] Error while sending: Resource temporarily unavailable 
at ./lsf_EAGAIN line 9.

$ LANG= ./lsf_EAGAIN
[iteration 2499] Error while sending: Resource temporarily unavailable 
at ./lsf_EAGAIN line 9.

$ cat ./lsf_EAGAIN 
#!/usr/bin/perl
use warnings;
use strict;
use Log::Syslog::Fast qw&#40;:all&#41;;
my $logger = Log::Syslog::Fast-&gt;new&#40;LOG_UNIX, &#39;/dev/log&#39;, 0,
    LOG_USER, LOG_INFO, &#39;myhost&#39;, &#39;myapp&#39;&#41;;
$logger-&gt;set_priority&#40;LOG_USER, LOG_DEBUG&#41;;
for &#40;1 .. 10000&#41; {
    eval { $logger-&gt;send&#40;&#39;x&#39; x 40&#41; };
    die &#34;[iteration $_] $@\n&#34; if $@;
}
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;16&nbsp;22:48:36&nbsp;2010</span>
    <span class="description">athomason [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ah now I see, that was unintentionally left from when it was a pure-UDP
module. I&#39;ll remove it since the UDP sockets are already marked
non-blocking. Thanks.

On Tue Nov 16 22:43:14 2010, POWERMAN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Tue Nov 16 22:12:35 2010, ATHOMASON wrote:
<div class="message-stanza open">&gt; &gt; Oh, this is about LOG_UNIX? I just assumed you were using LOG_UDP 
</div>&gt; since
<div class="message-stanza open">&gt; &gt; that&#39;s the only one that&#39;s configured to be non-blocking &#40;see https://
</div>&gt; github.com/athomason/Log-Syslog-Fast/blob/master/LogSyslogFast.c#L143&#41;.
<div class="message-stanza open">&gt; &gt; AFAIK LOG_UNIX should never have an EAGAIN error since send&#40;2&#41; is only
&gt; &gt; supposed to return that for a nonblocking socket. Do you have a test
&gt; &gt; case showing that behavior?
</div>&gt; 
&gt; Yeah, it&#39;s about LOG_UNIX. You&#39;re using send&#40;MSG_DONTWAIT&#41;, and this 
&gt; force non-blocking behavior even on blocking sockets. 
&gt; Test case &#40;carefully, it will flood your system&#39;s syslog&#41;:
&gt; 
&gt; $ LANG= ./lsf_EAGAIN
&gt; [iteration 340] Error while sending: Resource temporarily unavailable 
&gt; at ./lsf_EAGAIN line 9.
&gt; 
&gt; $ LANG= ./lsf_EAGAIN
&gt; [iteration 2499] Error while sending: Resource temporarily unavailable 
&gt; at ./lsf_EAGAIN line 9.
&gt; 
&gt; $ cat ./lsf_EAGAIN 
&gt; #!/usr/bin/perl
&gt; use warnings;
&gt; use strict;
&gt; use Log::Syslog::Fast qw&#40;:all&#41;;
&gt; my $logger = Log::Syslog::Fast-&gt;new&#40;LOG_UNIX, &#39;/dev/log&#39;, 0,
&gt;     LOG_USER, LOG_INFO, &#39;myhost&#39;, &#39;myapp&#39;&#41;;
&gt; $logger-&gt;set_priority&#40;LOG_USER, LOG_DEBUG&#41;;
&gt; for &#40;1 .. 10000&#41; {
&gt;     eval { $logger-&gt;send&#40;&#39;x&#39; x 40&#41; };
&gt;     die &#34;[iteration $_] $@\n&#34; if $@;
&gt; }
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;17&nbsp;00:23:56&nbsp;2010</span>
    <span class="description">athomason [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Non-blocking behavior for TCP and UNIX sockets is removed in 0.46.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;17&nbsp;00:23:57&nbsp;2010</span>
    <span class="description">athomason [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
