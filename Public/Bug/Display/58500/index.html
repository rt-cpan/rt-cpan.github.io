<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #58500 for MongoDB: Circular data structure in query causes segmentation fault</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #58500 for MongoDB: Circular data structure in query causes segmentation fault</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/MongoDB/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/MongoDB/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/MongoDB/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/MongoDB/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://jira.mongodb.org/browse/PERL">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/MongoDB">MongoDB CPAN distribution</a>.</p>


<h3>Maintainer&#40;s&#41;&#39; notes</h3>

<p>Please don't report bugs here.  Please use the <a href="https://jira.mongodb.org/browse/PERL">MongoDB Perl driver issue tracker</a> instead.</p>



<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">58500</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/MongoDB/Active/">MongoDB</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
arkadiy [...] mindhole.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-227304-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-227305-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




signature.asc<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/793027/411090/signature.asc">
Fri Jun 18 14:04:50 2010 (189b) by rafl [...] debian.org
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/793017/411079/signature.asc">
Fri Jun 18 13:46:04 2010 (189b) by rafl [...] debian.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;17&nbsp;18:34:15&nbsp;2010</span>
    <span class="description">arkadiy [...] mindhole.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Circular data structure in query causes segmentation fault</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 17 Jun 2010 18:34:02 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MongoDB [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Arkadiy Kukarkin &lt;arkadiy [...] mindhole.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Perl segfaults when a structure with circular references is passed to
MongoCollection::query&#40;&#41;;

To reproduce:

#!/usr/bin/perl

use MongoDB;

my $mcon = MongoDB::Connection-&gt;new&#40;&#41;;
my $md = $mcon-&gt;get_database&#40;&#39;test&#39;&#41;;
my $mc = $md-&gt;get_collection&#40;&#39;test&#39;&#41;;

my $query = {};

$query-&gt;{&#39;q&#39;} = $query;

my $cur = $mc-&gt;query&#40;$query&#41;;
my @res = $cur-&gt;all&#40;&#41;;

This is v5.10.1 on x86_64-linux-gnu-thread-multi, MongoDB 0.33.

The short answer is, obviously, &#34;don&#39;t do that&#34;, but a more graceful
way to handle this would be nice. I actually had &#40;what I assume to be&#41;
the same or a related bug come up in production code, which generated
the following backtrace:

*** glibc detected *** perl: malloc&#40;&#41;: memory corruption: 0x0000000004923ce0 ***
*** glibc detected *** perl: malloc&#40;&#41;: memory corruption: 0x0000000004923cc0 ***
** child 2696 finished &#40;255&#41;
======= Backtrace: =========
======= Backtrace: =========
/lib/libc.so.6&#40;+0x775b6&#41;[0x7fb41af265b6]
/lib/libc.so.6&#40;+0x775b6&#41;[0x7fb41af265b6]
/lib/libc.so.6&#40;+0x7b6d8&#41;[0x7fb41af2a6d8]
/lib/libc.so.6&#40;+0x7b6d8&#41;[0x7fb41af2a6d8]
/lib/libc.so.6&#40;__libc_calloc+0xc4&#41;[0x7fb41af2d424]
/lib/libc.so.6&#40;__libc_calloc+0xc4&#41;[0x7fb41af2d424]
/usr/lib/libperl.so.5.10&#40;Perl_safesyscalloc+0x7b&#41;[0x7fb41b96975b]
/usr/lib/libperl.so.5.10&#40;Perl_safesyscalloc+0x7b&#41;[0x7fb41b96975b]
/usr/lib/libperl.so.5.10&#40;PerlIOBuf_get_base+0x2f&#41;[0x7fb41b9f22af]
/usr/lib/libperl.so.5.10&#40;PerlIOBuf_get_base+0x2f&#41;[0x7fb41b9f22af]
/usr/lib/libperl.so.5.10&#40;PerlIOBuf_write+0x1f2&#41;[0x7fb41b9f38e2]
/usr/lib/libperl.so.5.10&#40;PerlIOBuf_write+0x1f2&#41;[0x7fb41b9f38e2]
/usr/lib/libperl.so.5.10&#40;Perl_vcroak+0x3d&#41;[0x7fb41b96a6ed]
/usr/lib/libperl.so.5.10&#40;Perl_vcroak+0x3d&#41;[0x7fb41b96a6ed]
/usr/local/lib/perl/5.10.1/auto/MongoDB/MongoDB.so&#40;+0xaed9&#41;[0x7fb4191b8ed9]
/usr/local/lib/perl/5.10.1/auto/MongoDB/MongoDB.so&#40;perl_mongo_bson_to_sv+0x5d&#41;[0x7fb4191b96ed]
/usr/local/lib/perl/5.10.1/auto/MongoDB/MongoDB.so&#40;XS_MongoDB__Cursor_next+0x179&#41;[0x7fb4191b4809]
/usr/lib/libperl.so.5.10&#40;+0x97e05&#41;[0x7fb41b96ce05]
/usr/local/lib/perl/5.10.1/auto/MongoDB/MongoDB.so&#40;+0xaed9&#41;[0x7fb4191b8ed9]
/usr/local/lib/perl/5.10.1/auto/MongoDB/MongoDB.so&#40;perl_mongo_bson_to_sv+0x5d&#41;[0x7fb4191b96ed]
/usr/local/lib/perl/5.10.1/auto/MongoDB/MongoDB.so&#40;XS_MongoDB__Cursor_next+0x/usr/lib/libperl.so.5.10&#40;Perl_pp_entersub+0x5a5&#41;[0x7fb41b980045]
/usr/lib/libperl.so.5.10&#40;Perl_pp_entersub+0x5a5&#41;[0x7fb41b980045]
/usr/lib/libperl.so.5.10&#40;perl_run+0x33c&#41;[0x7fb41b9263cc]
perl&#40;main+0xec&#41;[0x400d7c]
/usr/lib/libperl.so.5.10&#40;perl_run+0x33c&#41;[0x7fb41b9263cc]
/lib/libc.so.6&#40;__libc_start_main+0xfd&#41;[0x7fb41aecdc4d]
perl[0x400bc9]
======= Memory map: ========
/lib/libc.so.6&#40;__libc_start_main+0xfd&#41;[0x7fb41aecdc4d]
perl[0x400bc9]
======= Memory map: ========
00400000-00401000 r-xp 00000000 08:03 18579737
  /usr/bin/perl
00601000-00602000 r--p 00001000 08:03 18579737
  /usr/bin/perl
00602000-00603000 rw-p 00002000 08:03 18579737
  /usr/bin/perl
02508000-049c2000 rw-p 00000000 00:00 0                                  [heap]
7fb410000000-7fb410021000 rw-p 00000000 00:00 0
7fb410021000-7fb414000000 ---p 00000000 00:00 0
7fb4159a8000-7fb4159be000 r-xp 00000000 08:03 7413789
  /lib/libgcc_s.so.1
7fb4159be000-7fb415bbd000 ---p 00016000 08:03 7413789
  /lib/libgcc_s.so.1
7fb415bbd000-7fb415bbe000 r--p 00015000 08:03 7413789
  /lib/libgcc_s.so.1
7fb415bbe000-7fb415bbf000 rw-p 00016000 08:03 7413789
  /lib/libgcc_s.so.1
7fb415bbf000-7fb415bcc000 r-xp 00000000 08:03 18743629
  /usr/local/lib/perl/5.10.1/auto/Params/Validate/Validate.so
7fb415bcc000-7fb415dcb000 ---p 0000d000 08:03 18743629
  /usr/local/00400000-00401000 r-xp 00000000 08:03 18579737
               /usr/bin/perl
00601000-00602000 r--p 00001000 08:03 18579737
  /usr/bin/perl
00602000-00603000 rw-p 00002000 08:03 18579737
  /usr/bin/perl
02508000-049c2000 rw-p 00000000 00:00 0                                  [heap]
7fb410000000-7fb410021000 rw-p 00000000 00:00 0
7fb410021000-7fb414000000 ---p 00000000 00:00 0
7fb4159a8000-7fb4159be000 r-xp 00000000 08:03 7413789
  /lib/libgcc_s.so.1
7fb4159be000-7fb415bbd000 ---p 00016000 08:03 7413789
  /lib/libgcc_s.so.1
7fb415bbd000-7fb415bbe000 r--p 00015000 08:03 7413789
  /lib/libgcc_s.so.1
7fb415bbe000-7fb415bbf000 rw-p 00016000 08:03 7413789
  /lib/libgcc_s.so.1
7fb415bbf000-7fb415bcc000 r-xp 00000000 08:03 18743629
  /usr/local/lib/perl/5.10.1/auto/Params/Validate/Validate.so
7fb415bcc000-7fb415dcb000 ---p 0000d000 08:03 18743629
  /usr/local/lib/perl/5.10.1/auto/Params/Validate/Validate.so
7fb415dcb000-7fb415dcc000 r--p 0000c000 08:03 18743629
  /usr/local/lib/perl/5.10.1/auto/Params/Validate/Validate.so
7fb415dcc000-7fb415dcd000 rw-p 0000d000 08:03 18743629
  /usr/local/lib/perl/5.10.1/auto/Params/Validate/Validate.so
7fb415dcd000-7fb415dd2000 r-xp 00000000 08:03 18737259
  /usr/local/lib/perl/5.10.1/auto/DateTime/DateTime.so
7fb415dd2000-7fb415fd1000 ---p 00005000 08:03 18737259
  /usr/local/lib/perl/5.10.1/auto/DateTime/DateTime.so
7fb415fd1000-7fb415fd2000 r--p 00004000 08:03 18737259
  /usr/local/lib/perl/5.10.1/auto/DateTime/DateTime.so
7fb415fd2000-7fb415fd3000 rw-p 00005000 08:03 18737259
  /usr/local/lib/perl/5.10.1/auto/DateTime/DateTime.so
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;18&nbsp;13:29:34&nbsp;2010</span>
    <span class="description">KRISTINA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The best &#40;and not very good&#41; way I can think of for checking this is to
call backtrace&#40;&#41; after every 10000 key/value pairs are serialized.  If
we&#39;re more than, I dunno, 5000 stackframes deep, croak.  

Obviously this isn&#39;t very elegant, but I think it would work and it
shouldn&#39;t have too big a performance hit.  

If anyone has any better ideas, please share!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;18&nbsp;13:29:36&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;18&nbsp;13:46:04&nbsp;2010</span>
    <span class="description">rafl [...] debian.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #58500] Circular data structure in query causes segmentation fault</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 18 Jun 2010 19:45:53 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Kristina Chodorow via RT &lt;bug-MongoDB [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Florian Ragwitz &lt;rafl [...] debian.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Jun 18, 2010 at 01:29:34PM -0400, Kristina Chodorow via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If anyone has any better ideas, please share!
</div>
Just tracking the addresses of references as they&#39;re being serialized,
and throwing an exception when trying to recurse into something that has
already been recursed into would be another option.

In fact, this sounds much better than limiting the possible depth for
non-circular structures to me.


-- 
BOFH excuse #207:
We are currently trying a new concept of using a live mouse.
Unfortunately, one has yet to survive being hooked up to the
computer.....please bear with us.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/793017/411079/signature.asc">Download signature.asc</a><br />
<span class="downloadcontenttype">application/pgp-signature 189b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;18&nbsp;13:54:05&nbsp;2010</span>
    <span class="description">KRISTINA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m little hesitant to throw all of the addresses in a hash table
because there could be millions of values in a legit document, but I
guess that&#39;s only a few MB.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;18&nbsp;14:04:50&nbsp;2010</span>
    <span class="description">rafl [...] debian.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #58500] Circular data structure in query causes segmentation fault</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 18 Jun 2010 20:04:38 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Kristina Chodorow via RT &lt;bug-MongoDB [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Florian Ragwitz &lt;rafl [...] debian.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Jun 18, 2010 at 01:54:05PM -0400, Kristina Chodorow via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m little hesitant to throw all of the addresses in a hash table
&gt; because there could be millions of values in a legit document, but I
&gt; guess that&#39;s only a few MB.
</div>
You only need to track reference values, and you can remove the entry
for that from whatever you use for tracking as soon as you return from a
recursion into it. I can&#39;t see this taking an unreasonable amount of
memory for any even not-so-common usecase.


-- 
BOFH excuse #325:
Your processor does not develop enough heat.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/793027/411090/signature.asc">Download signature.asc</a><br />
<span class="downloadcontenttype">application/pgp-signature 189b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;18&nbsp;15:17:53&nbsp;2010</span>
    <span class="description">arkadiy [...] mindhole.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #58500] Circular data structure in query causes  segmentation fault</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 18 Jun 2010 15:17:44 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MongoDB [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Arkadiy Kukarkin &lt;arkadiy [...] mindhole.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Incidentally, the above stack trace is an unrelated issue. Just wanted
to clear that up.

On Fri, Jun 18, 2010 at 2:04 PM, Florian Ragwitz via RT
&lt;bug-MongoDB@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=58500">https://rt.cpan.org/Ticket/Display.html?id=58500</a></span> &gt;
&gt;
&gt; On Fri, Jun 18, 2010 at 01:54:05PM -0400, Kristina Chodorow via RT wrote:
<div class="message-stanza open">&gt;&gt; I&#39;m little hesitant to throw all of the addresses in a hash table
&gt;&gt; because there could be millions of values in a legit document, but I
&gt;&gt; guess that&#39;s only a few MB.
</div>&gt;
&gt; You only need to track reference values, and you can remove the entry
&gt; for that from whatever you use for tracking as soon as you return from a
&gt; recursion into it. I can&#39;t see this taking an unreasonable amount of
&gt; memory for any even not-so-common usecase.
&gt;
&gt;
&gt; --
&gt; BOFH excuse #325:
&gt; Your processor does not develop enough heat.
&gt;
&gt;
&gt; -----BEGIN PGP SIGNATURE-----
&gt; Version: GnuPG v1.4.6 &#40;GNU/Linux&#41;
&gt;
&gt; iD8DBQFMG7UsdC8qQo5jWl4RAqb1AJ9fKU8F88Q4UfV20halPC+shi5FaQCbBe9f
&gt; kPsmT2dYvvctqQuk9A3oLNU=
&gt; =Uy2N
&gt; -----END PGP SIGNATURE-----
&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;24&nbsp;14:35:56&nbsp;2010</span>
    <span class="description">KRISTINA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">@Florian: Good point.  

Added to master, will be in 0.35.  Now it croaks with:

circular ref at /usr/local/lib/perl5/...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;24&nbsp;14:35:58&nbsp;2010</span>
    <span class="description">KRISTINA [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
