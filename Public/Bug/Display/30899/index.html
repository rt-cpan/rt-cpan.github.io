<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #30899 for Log-Log4perl: [PATCH] Add configuration options to Appender::ScreenColoredLevels</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #30899 for Log-Log4perl: [PATCH] Add configuration options to Appender::ScreenColoredLevels</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Log-Log4perl/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Log-Log4perl/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Log-Log4perl/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Log-Log4perl/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Log-Log4perl">Log-Log4perl CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">30899</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Log-Log4perl/Active/">Log-Log4perl</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
email [...] jasonkohles.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-19484-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-19485-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;21&nbsp;12:57:42&nbsp;2007</span>
    <span class="description">jasonk [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [PATCH] Add configuration options to Appender::ScreenColoredLevels</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The attached patch for Log::Log4perl::Appender::ScreenColoredLevels
corrects a documentation error &#40;the color for DEBUG messages is not
black, it is uncolored, so it appears as whatever the default color of
your terminal is.

Additionally, this patch adds configurability for the colors for each
level, so you can say:

    log4perl.appender.Screen.color.TRACE=cyan

or

    log4perl.appender.Screen.color.DEBUG=bold blue

or if you want to get really crazy, you can even say

    log4perl.appender.Screen.color.FATAL=bold underline blink red on_white

The default settings for each level produce exactly the same output as
the current version, so if your configuration doesn&#39;t change any colors,
then you get identical behavior to the current version, making the patch
100% backwards-compatible.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> appender-screencoloredlevels.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- /usr/local/lib/perl5/site_perl/5.8.8/Log/Log4perl/Appender/ScreenColoredLevels.pm	2007-10-11 22:39:45.000000000 -0400
+++ ScreenColoredLevels.pm	2007-11-21 12:55:18.000000000 -0500
@@ -6,7 +6,7 @@
 use warnings;
 use strict;
 
-use Term::ANSIColor qw&#40;:constants&#41;;
+use Term::ANSIColor qw&#40;&#41;;
 use Log::Log4perl::Level;
 
 ##################################################
@@ -17,9 +17,24 @@
     my $self = {
         name   =&gt; &#34;unknown name&#34;,
         stderr =&gt; 1,
+        color  =&gt; {},
         @options,
     };
 
+    my %default_colors = &#40;
+        TRACE   =&gt; &#39;yellow&#39;,
+        DEBUG   =&gt; &#39;&#39;,
+        INFO    =&gt; &#39;green&#39;,
+        WARN    =&gt; &#39;blue&#39;,
+        ERROR   =&gt; &#39;magenta&#39;,
+        FATAL   =&gt; &#39;red&#39;,
+    &#41;;
+    for my $level &#40; keys %default_colors &#41; {
+        if &#40; ! exists $self-&gt;{ &#39;color&#39; }-&gt;{ $level } &#41; {
+            $self-&gt;{ &#39;color&#39; }-&gt;{ $level } = $default_colors{ $level };
+        }
+    }
+
     bless $self, $class;
 }
     
@@ -28,35 +43,16 @@
 ##################################################
     my&#40;$self, %params&#41; = @_;
 
-    $params{message} = color&#40;$params{log4p_level}, $params{message}&#41;;
+    my $msg = $params{ &#39;message&#39; };
+
+    if &#40; my $color = $self-&gt;{ &#39;color&#39; }-&gt;{ $params{ &#39;log4p_level&#39; } } &#41; {
+        $msg = Term::ANSIColor::colored&#40; $msg, $color &#41;;
+    }
     
     if&#40;$self-&gt;{stderr}&#41; {
-        print STDERR $params{message};
-    } else {
-        print $params{message};
-    }
-}
-
-##################################################
-sub color {
-##################################################
-    my&#40;$level, $message&#41; = @_;
-
-    if&#40;0&#41; {
-    } elsif&#40;$level eq &#34;TRACE&#34;&#41; {
-        return YELLOW . $message . RESET;
-    } elsif&#40;$level eq &#34;DEBUG&#34;&#41; {
-        return $message;
-    } elsif&#40;$level eq &#34;INFO&#34;&#41; {
-        return GREEN . $message . RESET;
-    } elsif&#40;$level eq &#34;WARN&#34;&#41; {
-        return BLUE . $message . RESET;
-    } elsif&#40;$level eq &#34;ERROR&#34;&#41; {
-        return MAGENTA . $message . RESET;
-    } elsif&#40;$level eq &#34;FATAL&#34;&#41; {
-        return RED . $message . RESET;
+        print STDERR $msg;
     } else {
-        return $message;
+        print $msg;
     }
 }
 
@@ -102,13 +98,56 @@
 This appender acts like Log::Log4perl::Appender::Screen, except that
 it colorizes its output, based on the priority of the message sent.
 
-The color scheme is
+You can configure the colors and attributes used for the different
+levels, by specifying them in your configuration:
+
+    log4perl.appender.Screen.color.TRACE=cyan
+    log4perl.appender.Screen.color.DEBUG=bold blue
+
+You can also specify nothing, to indicate that level should not have
+coloring applied, which means the text will be whatever the default
+color for your terminal is.  This is the default for debug messages.
+
+    log4perl.appender.Screen.color.DEBUG=
+
+You can use any attribute supported by L&lt;Term::ANSIColor&gt; as a configuration
+option.
+
+    log4perl.appender.Screen.color.FATAL=\
+        bold underline blink red on_white
+
+The commonly used colors and attributes are:
+
+=over 4
+
+=item attributes
+
+BOLD, DARK, UNDERLINE, UNDERSCORE, BLINK
+
+=item colors
+
+BLACK, RED, GREEN, YELLOW, BLUE, MAGENTA, CYAN, WHITE
+
+=item background colors
+
+ON_BLACK, ON_RED, ON_GREEN, ON_YELLOW, ON_BLUE, ON_MAGENTA, ON_CYAN, ON_WHITE
+
+=back
+
+See L&lt;Term::ANSIColor&gt; for a complete list, and information on which are
+supported by various common terminal emulators.
+
+The default values for these options are:
 
 =over 4
 
+=item Trace
+
+Yellow
+
 =item Debug
 
-Black
+None &#40;whatever the terminal default is&#41;
 
 =item Info
 
@@ -132,9 +171,15 @@
 if set to a true value, the appender will log to STDERR. If C&lt;stderr&gt;
 is set to a false value, it will log to STDOUT. The default setting
 for C&lt;stderr&gt; is 1, so messages will be logged to STDERR by default.
+The constructor can also take an optional parameter C&lt;color&gt;, whose
+value is a  hashref of color configuration options, any levels that
+are not included in the hashref will be set to their default values.
 
 =head1 AUTHOR
 
-Mike Schilli &lt;log4perl@perlmeister.com&gt;, 2004
+Mike Schilli C&lt;&lt; &lt;log4perl@perlmeister.com&gt; &gt;&gt;, 2004
+
+Color configuration and attribute support added 2007 by
+Jason Kohles C&lt;&lt; &lt;email@jasonkohles.com&gt; &gt;&gt;.
 
 =cut
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;10&nbsp;12:50:35&nbsp;2009</span>
    <span class="description">MSCHILLI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry for the long wait, finally applied to Log4perl 1.25:

<span class="clickylink"><a target="new" rel="nofollow" href="http://github.com/mschilli/log4perl/commit/35b1fbed45e3b4372d66ea8be200d1a7a50815ae">http://github.com/mschilli/log4perl/commit/35b1fbed45e3b4372d66ea8be200d1a7a50815ae</a></span>

Thanks for your contribution.

-- Mike
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;10&nbsp;12:50:36&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;10&nbsp;12:50:37&nbsp;2009</span>
    <span class="description">MSCHILLI [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
