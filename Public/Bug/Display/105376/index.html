<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #105376 for DBIx-Class: Actions on txn commit &#40; was: Conflict with autodie &lt; 2.26 &#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #105376 for DBIx-Class: Actions on txn commit &#40; was: Conflict with autodie &lt; 2.26 &#41;</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBIx-Class">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBIx-Class">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBIx-Class">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBIx-Class">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBIx-Class">DBIx-Class CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">105376</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBIx-Class">DBIx-Class</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
mca [...] sanger.ac.uk

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10410-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10411-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=105376">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1509839" href="/Public/Bug/Display.html?id=105376#txn-1509839">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;19&nbsp;08:34:57&nbsp;2015</span>
    <span class="description">mca [...] sanger.ac.uk -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Conflict with autodie &lt; 2.26 ?</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 19 Jun 2015 13:34:42 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Matthew Astley &lt;mca [...] sanger.ac.uk&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1509839/804986/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/804986">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for DBIx::Class, and &#40;specifically in this instance&#41; the
explanation about what&#39;s going on with Text::Balanced.

I found that autodie 2.22 has the exception comparison problem,

 DBIx::Class::_Util::is_exception&#40;&#41;: External exception class
 autodie::exception implements partial &#40;broken&#41; overloading preventing its
 instances from being used in simple &#40;$x eq $y&#41; comparisons. Given Perl&#39;s
 &#34;globally cooperative&#34; exception handling this type of brokenness is
 extremely dangerous on exception objects, as it may &#40;and often does&#41; result
 in silent &#34;exception substitution&#34;. DBIx::Class tries to work around this as
 much as possible, but other parts of your software stack may not be even
 aware of this. Please submit a bugreport against the distribution containing
 autodie::exception and in the meantime apply a fix similar to the one shown
 at <span class="clickylink"><a target="new" rel="nofollow" href="http://v.gd/DBIC_overload_tempfix/">http://v.gd/DBIC_overload_tempfix/</a></span>, in order to ensure your exception
 handling is saner application-wide. What follows is the actual error text as
 generated by Perl itself:

 Operation &#34;ne&#34;: no method found,
       left argument in overloaded package autodie::exception,
       right argument has no overloaded magic at [...]/dbix-class/blib/lib/DBIx/Class/_Util.pm line 133.

and this is fixed in autodie 2.26 due to
  <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/pjf/autodie/pull/57">https://github.com/pjf/autodie/pull/57</a></span>


Therefore, would it be appropriate to declare in DBIx::Class a conflict
against the earlier versions?  Possibly Module::Install::CheckConflicts
or Dist::CheckConflicts ?


It might save someone else these couple of hours&#39; digging...
-- 
Matthew


-- 
 The Wellcome Trust Sanger Institute is operated by Genome Research 
 Limited, a charity registered in England with number 1021457 and a 
 company registered in England with number 2742969, whose registered 
 office is 215 Euston Road, London, NW1 2BE. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1509857" href="/Public/Bug/Display.html?id=105376#txn-1509857">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;19&nbsp;08:42:08&nbsp;2015</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #105376] Conflict with autodie &lt; 2.26 ?</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 19 Jun 2015 14:41:41 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Rabbitson &lt;ribasushi [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1509857/804995/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/804995">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 06/19/2015 02:34 PM, Matthew Astley via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Fri Jun 19 08:34:57 2015: Request 105376 was acted upon.
&gt; Transaction: Ticket created by mca@sanger.ac.uk
&gt;         Queue: DBIx-Class
&gt;       Subject: Conflict with autodie &lt; 2.26 ?
&gt;     Broken in: &#40;no value&#41;
&gt;      Severity: &#40;no value&#41;
&gt;         Owner: Nobody
&gt;    Requestors: mca@sanger.ac.uk
&gt;        Status: new
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=105376">https://rt.cpan.org/Ticket/Display.html?id=105376</a></span> &gt;
&gt;
&gt;
&gt; Thanks for DBIx::Class, and &#40;specifically in this instance&#41; the
&gt; explanation about what&#39;s going on with Text::Balanced.
&gt;
&gt; I found that autodie 2.22 has the exception comparison problem,
&gt;
&gt;   DBIx::Class::_Util::is_exception&#40;&#41;: External exception class
&gt;   autodie::exception implements partial &#40;broken&#41; overloading preventing its
&gt;   instances from being used in simple &#40;$x eq $y&#41; comparisons. Given Perl&#39;s
&gt;   &#34;globally cooperative&#34; exception handling this type of brokenness is
&gt;   extremely dangerous on exception objects, as it may &#40;and often does&#41; result
&gt;   in silent &#34;exception substitution&#34;. DBIx::Class tries to work around this as
&gt;   much as possible, but other parts of your software stack may not be even
&gt;   aware of this. Please submit a bugreport against the distribution containing
&gt;   autodie::exception and in the meantime apply a fix similar to the one shown
&gt;   at <span class="clickylink"><a target="new" rel="nofollow" href="http://v.gd/DBIC_overload_tempfix/">http://v.gd/DBIC_overload_tempfix/</a></span>, in order to ensure your exception
&gt;   handling is saner application-wide. What follows is the actual error text as
&gt;   generated by Perl itself:
&gt;
&gt;   Operation &#34;ne&#34;: no method found,
&gt;         left argument in overloaded package autodie::exception,
&gt;         right argument has no overloaded magic at [...]/dbix-class/blib/lib/DBIx/Class/_Util.pm line 133.
&gt;
&gt; and this is fixed in autodie 2.26 due to
&gt;    <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/pjf/autodie/pull/57">https://github.com/pjf/autodie/pull/57</a></span>
&gt;
&gt;
&gt; Therefore, would it be appropriate to declare in DBIx::Class a conflict
&gt; against the earlier versions?  Possibly Module::Install::CheckConflicts
&gt; or Dist::CheckConflicts ?
</div>
It wouldn&#39;t for the simple reason that DBIx::Class itself does not use 
autodie for anything. All you see is a &#34;Public Service Announcement&#34; of 
sorts &#40;there are several of those&#41; - DBIC keeps on trucking after it 
encounters &#40;and recovers&#41; from such a condition. Therefor a &#34;conflicts&#34; 
would be a lie, as everything continues working.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It might save someone else these couple of hours&#39; digging...
</div>
Can you expand on this? What was the exact failure mode and why did it 
end up costing you hours? The very goal of this PSA was to save people 
time...

Cheers!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1509858" href="/Public/Bug/Display.html?id=105376#txn-1509858">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;19&nbsp;08:42:08&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1509872" href="/Public/Bug/Display.html?id=105376#txn-1509872">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;19&nbsp;10:27:29&nbsp;2015</span>
    <span class="description">mca [...] sanger.ac.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #105376] Conflict with autodie &lt; 2.26 ?</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 19 Jun 2015 15:27:07 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Peter Rabbitson via RT &lt;bug-DBIx-Class [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Matthew Astley &lt;mca [...] sanger.ac.uk&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1509872/805004/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/805004">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Jun 19, 2015 at 08:42:08AM -0400, Peter Rabbitson via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 06/19/2015 02:34 PM, Matthew Astley via RT wrote:
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; I found that autodie 2.22 has the exception comparison problem,
&gt; &gt;
&gt; &gt;   DBIx::Class::_Util::is_exception&#40;&#41;: External exception class
&gt; &gt;   autodie::exception implements partial &#40;broken&#41; overloading [...]
&gt; &gt;
&gt; &gt;   Operation &#34;ne&#34;: no method found,
&gt; &gt;         left argument in overloaded package autodie::exception,
&gt; &gt;         right argument has no overloaded magic at [...]/dbix-class/blib/lib/DBIx/Class/_Util.pm line 133.
</div></div>
&#40;This PSA text was from a cloned dbix-class on current/blead&#41;


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; [...] would it be appropriate to declare in DBIx::Class a conflict
&gt; &gt; against the earlier versions?
</div>&gt; 
&gt; It wouldn&#39;t for the simple reason that DBIx::Class itself does not use 
&gt; autodie for anything. All you see is a &#34;Public Service Announcement&#34; of 
&gt; sorts [...]
</div>
OK.  It does seem that, in every case, the transaction was rolled
back.  The fallout was afterwards.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; It might save someone else these couple of hours&#39; digging...
</div>&gt; 
&gt; Can you expand on this? What was the exact failure mode
</div>
In short, an old DBIx::Class gave a strange and less helpful error
message and then interacted badly with DESTROY of other objects.


When I first met it, I was using

 DBIx::Class 0.08250
 autodie 2.22

and my code, which did this...

  mca@cgpfoo:~/gitwk-cgp/cgpDataOut$ perl script/cgpout --db canpg init -d /foo
          &#40;in cleanup&#41;    &#40;in cleanup&#41; Operation &#34;ne&#34;: no method found,
          left argument in overloaded package autodie::exception,
          right argument has no overloaded magic at /software/perl-5.16.2/lib/site_perl/5.16.2/DBIx/Class/Storage/TxnScopeGuard.pm line 60.
  Not an ARRAY reference at /nfs/users/nfs_m/mca/gitwk-cgp/cgpDataOut/lib/Sanger/CGP/DataOut/TxnMinder.pm line 96.
  13@cgpfoo:~/gitwk-cgp/cgpDataOut$ 

&#40;the 13 is $? being non-zero, and I&#39;m not sure where it came from&#41;

...for the &#40;execution-ordered&#41; pseudocode

 use warnings FATAL=&gt;&#39;all&#39;;  # not relevant?
 use autodie &#39;:all&#39;;  # a local convention
 try { # Try::Tiny

   my $g = $schema-&gt;txn_minder; # my wrapper object

   # in $g constructor
     $g-&gt;{_dbtxn} = $schema-&gt;txn_scope_guard;

   open my $fh, &#39;&lt;&#39;, &#39;/does/not/exist&#39;;  # boom

   # in $g-&gt;DESTROY
     my &#40;$self&#41; = @_; # that $g again
     my $R = delete $self-&gt;{_rollbacks};  # ARRAY of CODE

     delete $self-&gt;{_dbtxn}; # database ROLLBACK, if necessary

     # I deduce that it went boom again here, in $_dbtxn-&gt;DESTROY

     if &#40;$R &#38;&#38; @$R&#41; {  # the error that stops the program?

   # then $g-&gt;DESTROY happens again later, because we made a new
   # reference to it and then dropped it

 } catch {
   # didn&#39;t happen
 };
 # not reached


Actually it looks like the entire try{} block is happening again,
because when I put a print at the top it happens twice..?!
Presumably this is due to some deep failure with DESTROYing things
while propagating exceptions.

Then, more weirdly, that @$R changes to the printed text &#40;?!&#41; when I&#39;m
printing at the top of the try.

  try {
    my $g = $schema-&gt;txn_minder;
    print &#34;init = $self&lt;\n&#34;;
     ... and code similar to above, with more prints ...

produces

  mca@cgpfoo:~/gitwk-cgp/cgpDataOut$ perl script/cgpout --db canpg init -d /foo
  init = Sanger::CGP::DataOut::Command::init=HASH&#40;0x1e9f268&#41;&lt;
  DESTROY!
  deleted _rollbacks: r=ARRAY&#40;0x22c4d30&#41;=r
    deleted _dbtxn g=DBIx::Class::Storage::TxnScopeGuard=HASH&#40;0x1fdd608&#41;=g
          &#40;in cleanup&#41;    &#40;in cleanup&#41; Operation &#34;ne&#34;: no method found,
          left argument in overloaded package autodie::exception,
          right argument has no overloaded magic at /software/perl-5.16.2/lib/site_perl/5.16.2/DBIx/Class/Storage/TxnScopeGuard.pm line 60.
  init = Sanger::CGP::DataOut::Command::init=HASH&#40;0x1e9f268&#41;&lt;
  Can&#39;t use string &#40;&#34;init = Sanger::CGP::DataOut::Com&#34;...&#41; as an ARRAY ref while &#34;strict refs&#34; in use at /nfs/users/nfs_m/mca/gitwk-cgp/cgpDataOut/lib/Sanger/CGP/DataOut/TxnMinder.pm line 101.
  20160DESTROY!
  13@cgpfoo:~/gitwk-cgp/cgpDataOut$ 


The only place 20160 appears is as 14 days&#39; worth of minutes, which
will be the value of a field in the row INSERTed &#38; rolled back.
I don&#39;t know why it was printed.  &#34;DESTROY!\n&#34; is my $g going away.
I haven&#39;t done anything fancy with STDOUT.


We weren&#39;t planning on publishing this because it depends strongly on
internal systems, but I can put it up somewhere if you want to look..?
Above was with branch weirdness commitid 86e4455, with a set of
dependencies I can trace from commitid 909e9053 in ./CPAN/ on top of a
potentially variable background install of perl-5.16.2 plus site-wide
libraries.


The TxnMinder itself might interest you.  Its purpose is to run a LIFO
list of CODE blocks, after the database rollbacks are completed, for
things like removing files which were being built off the uncommitted
rows.

However, I&#39;m now suspecting that doing this much work in DESTROY is
inadvisable.



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; and why did it end up costing you hours? The very goal of this PSA
&gt; was to save people time...
</div>
It was obvious that autodie&#39;s exception class was disagreeing with
TxnScopeGuard, but I had not yet seen the PSA and started digging.

I concluded fairly quickly that there was a bug, so I set about
writing a test:

  clone dbix-class

  build enough of it to `prove -bv t/storage/txn_scope_guard.t`

  start trying to provoke the problem, and see how the outcome shows
  up.

Possibly this was premature, since I didn&#39;t know how the failure in my
$g-&gt;DESTROY or $_dbtxn-&gt;DESTROY was managing to change $R to something
true-but-not-ARRAYref in time for the @$R.

At this point I saw the PSA...

Why am I using an old Perl with old libraries installed?  It is our
production environment.  You could say we chose stability and old bugs
over instability, fixes and new bugs.


Thanks for reading.  Does this answer your question?
-- 
Matthew


-- 
 The Wellcome Trust Sanger Institute is operated by Genome Research 
 Limited, a charity registered in England with number 1021457 and a 
 company registered in England with number 2742969, whose registered 
 office is 215 Euston Road, London, NW1 2BE. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1612839" href="/Public/Bug/Display.html?id=105376#txn-1612839">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;30&nbsp;11:18:45&nbsp;2016</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1612839/863064/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/863064">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi, sorry for the delayed reply.

On Fri Jun 19 16:27:29 2015, mca@sanger.ac.uk wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Actually it looks like the entire try{} block is happening again,
&gt; because when I put a print at the top it happens twice..?!
&gt; Presumably this is due to some deep failure with DESTROYing things
&gt; while propagating exceptions.
&gt; 
</div>
This is most likely due to the behavior of txn_do &#40;it tries to run things twice on a disconnect&#41; There have been many &#40;not yet released&#41; improvements in the last couple months in this area. Set DBIC_STORAGE_RETRY_DEBUG=1 for extra info on if this is happening or not.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; The TxnMinder itself might interest you.  Its purpose is to run a LIFO
&gt; list of CODE blocks, after the database rollbacks are completed, for
&gt; things like removing files which were being built off the uncommitted
&gt; rows.
&gt; 
</div>
I am very interested in what is the API that you are using for this &#40;the implementation isn&#39;t that important&#41;. I am going to implement something very similar next week to fix another problem with the DBIC deferred constraint support.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; However, I&#39;m now suspecting that doing this much work in DESTROY is
&gt; inadvisable.
&gt; 
</div>
Generally yes, but it may be moot if I can fit your needs into the thing I mentioned above. So please do get back to me with what your calling conventions look like &#40;in private if need be&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Why am I using an old Perl with old libraries installed?  It is our
&gt; production environment.  You could say we chose stability and old bugs
&gt; over instability, fixes and new bugs.
</div>
I wouldn&#39;t say that. Instead I&#39;d say you are being a reasonable user of software, in a world where this is not the norm: <span class="clickylink"><a target="new" rel="nofollow" href="https://gist.github.com/ribasushi/d3769fa75822b7b080e9#file-tilt_description-L178-L201">https://gist.github.com/ribasushi/d3769fa75822b7b080e9#file-tilt_description-L178-L201</a></span>

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Thanks for reading.  Does this answer your question?
</div>
Yes it did, in full! Thank you very much for taking the time to explain this.

I will keep the ticket open to remind myself about the TxnMinder thing.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1613468" href="/Public/Bug/Display.html?id=105376#txn-1613468">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;01&nbsp;09:52:44&nbsp;2016</span>
    <span class="description">mca [...] sanger.ac.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #105376] Conflict with autodie &lt; 2.26 ?</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 1 Apr 2016 14:52:28 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Peter Rabbitson via RT &lt;bug-DBIx-Class [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Matthew Astley &lt;mca [...] sanger.ac.uk&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1613468/863470/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/863470">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, Mar 30, 2016 at 11:18:46AM -0400, Peter Rabbitson via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=105376">https://rt.cpan.org/Ticket/Display.html?id=105376</a></span> &gt;
&gt; 
&gt; Hi, sorry for the delayed reply.
</div>
No worries.  It does mean I have semi-garbage-collected most of the
context, so I don&#39;t remember what was important for me.

I think my original request, that others be warned of autodie&lt;2.26, is
addressed by your explanation of the PSA messages.  And maybe also the
fact that search engines can find this thread.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri Jun 19 16:27:29 2015, mca@sanger.ac.uk wrote:
</div>
[ execution-event-annotated pseudocode was here ]

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Actually it looks like the entire try{} block is happening again,
&gt; &gt; because when I put a print at the top it happens twice..?!
&gt; &gt; Presumably this is due to some deep failure with DESTROYing things
&gt; &gt; while propagating exceptions.
</div>&gt; 
&gt; This is most likely due to the behavior of txn_do &#40;it tries to run
&gt; things twice on a disconnect&#41;
</div>
OK.  I guess a &#39;cluck&#39; might show that up, but I didn&#39;t think of that
at the time.

I had previously concluded that DESTROY blocks may happen more than
once per object, even without the re-blessing mentioned in
L&lt;perlobj/Destructors&gt;, so I try to remember to keep them idempotent.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There have been many &#40;not yet released&#41; improvements in the last
&gt; couple months in this area. Set DBIC_STORAGE_RETRY_DEBUG=1 for extra
&gt; info on if this is happening or not.
</div>
Thanks for the tip.  I made a note on my cgpDataOut project to try
this,
  &#40;internal : <span class="clickylink"><a target="new" rel="nofollow" href="https://gitlab.internal.sanger.ac.uk/CancerIT/cgpDataOut/issues/1">https://gitlab.internal.sanger.ac.uk/CancerIT/cgpDataOut/issues/1</a></span> &#41;
but it may be a while before I&#39;m back on the DBIC side of this.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; The TxnMinder itself might interest you.  Its purpose is to run a LIFO
&gt; &gt; list of CODE blocks, after the database rollbacks are completed, for
&gt; &gt; things like removing files which were being built off the uncommitted
&gt; &gt; rows.
</div>&gt; 
&gt; I am very interested in what is the API that you are using for this
&gt; &#40;the implementation isn&#39;t that important&#41;. I am going to implement
&gt; something very similar next week to fix another problem with the
&gt; DBIC deferred constraint support.
</div>
&#40;I&#39;m not sure I understood your question.&#41;

I was building a command line tool and underlying API to supply
temporary copies of large data files to a compute cluster, and track
those files in the database via DBIC in order to clean them up later.

What I wanted was a way to keep the disk and database in sync, for
commit or rollback, and to report on the progress of this.  Assuming
that the Perl process doesn&#39;t suddenly disappear.

It seemed that a D:C:S:TxnScopeGuard-like object was the answer,
because then I can ask it to &#40;e.g.&#41; mkdir and it will correctly rmdir
if the database transaction is rolled back.

Therefore I create my object &#40;to BEGIN transaction&#41;, add to it some
CODE to undo each non-db piece of work as I do the work, and then tell
it when to COMMIT.


The last line of POD says

| This &#34;has a&#34; DBIx::Class::Storage::TxnScopeGuard rather than
| inheriting, to avoid needing to mess with the privates of the
| superclass.

Possibly I would have had less trouble if subclassing TxnScopeGuard
was explicitly OK?  In this case I preferred to avoid poking
undocumented magic.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; However, I&#39;m now suspecting that doing this much work in DESTROY
&gt; &gt; is inadvisable.
</div></div>
&#40;But I haven&#39;t found a more convenient way.  Scope::Guard-like
behaviour really simplifies code and that removes places to hide
bugs.&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Generally yes, but it may be moot if I can fit your needs into the
&gt; thing I mentioned above. So please do get back to me with what your
&gt; calling conventions look like &#40;in private if need be&#41;.
</div>
If the description above isn&#39;t enough, I can probably just publish the
project.  It would probably be GPL if it could possibly be interesting
to anyone outside the organisation; but I should do the licensing
thing if I do.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Why am I using an old Perl with old libraries installed?  It is
&gt; &gt; our production environment.  You could say we chose stability and
&gt; &gt; old bugs over instability, fixes and new bugs.
</div>&gt; 
&gt; I wouldn&#39;t say that. Instead I&#39;d say you are being a reasonable user
&gt; of software, in a world where this is not the norm:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://gist.github.com/ribasushi/d3769fa75822b7b080e9#file-tilt_description-L178-L201">https://gist.github.com/ribasushi/d3769fa75822b7b080e9#file-tilt_description-L178-L201</a></span>
</div>
Thanks.  8-&#41;

-- 
Matthew


-- 
 The Wellcome Trust Sanger Institute is operated by Genome Research 
 Limited, a charity registered in England with number 1021457 and a 
 company registered in England with number 2742969, whose registered 
 office is 215 Euston Road, London, NW1 2BE. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1613571" href="/Public/Bug/Display.html?id=105376#txn-1613571">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;01&nbsp;12:41:36&nbsp;2016</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #105376] Conflict with autodie &lt; 2.26 ?</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 1 Apr 2016 18:41:14 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Rabbitson &lt;ribasushi [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1613571/863565/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/863565">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 04/01/2016 03:52 PM, Matthew Astley via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think my original request, that others be warned of autodie&lt;2.26, is 
&gt; addressed by your explanation of the PSA messages. And maybe also the 
&gt; fact that search engines can find this thread. 
</div>
This is correct. The ticket is alive due to secondary concerns now, see 
below.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I had previously concluded that DESTROY blocks may happen more than 
&gt; once per object, even without the re-blessing mentioned in 
&gt; L&lt;perlobj/Destructors&gt;, so I try to remember to keep them idempotent. 
</div>
This is half-incorrect &#40;funny word that ;&#41;. In general DESTROY can not 
happen twice on the same object by definition, as DESTROY is called 
right before the refcount goes to 0 and a free&#40;&#41; cascade is triggered. 
However there is a loophole in how DESTROY works itself that allows to 
re-reference the object, thus preventing the entire process &#40;and of 
course someone could just do $foo-&gt;DESTROY&#41;.

Sometimes this is used for good[1] which allows [2] to work

Sometimes it can result in evil[3]

My recommendation would be to use a guard like [4] &#40;employed as [5]&#41; 
instead of trying to make your destructors idempotent.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#40;I&#39;m not sure I understood your question.&#41;
</div>
See last paragraph of this email.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The last line of POD says
&gt;
&gt; | This &#34;has a&#34; DBIx::Class::Storage::TxnScopeGuard rather than
&gt; | inheriting, to avoid needing to mess with the privates of the
&gt; | superclass.
&gt;
&gt; Possibly I would have had less trouble if subclassing TxnScopeGuard
&gt; was explicitly OK?  In this case I preferred to avoid poking
&gt; undocumented magic.
</div>
It is besides the point: the scope guard is the wrong spot to implement 
any of this &#40;i.e. what about txn_do&#40;&#41;? &#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; Generally yes, but it may be moot if I can fit your needs into the
&gt;&gt; thing I mentioned above. So please do get back to me with what your
&gt;&gt; calling conventions look like &#40;in private if need be&#41;.
</div>&gt; If the description above isn&#39;t enough, I can probably just publish the
&gt; project.  It would probably be GPL if it could possibly be interesting
&gt; to anyone outside the organisation; but I should do the licensing
&gt; thing if I do.
</div>
Basically what I am trying to get a good grasp on is *how exactly* does 
your implementation get used &#40;note - not how it works internally&#41;. Going 
all the way to publish just for that is way more effort than needed, 
especially given I won&#39;t be able to reuse any of it &#40;both on conceptual 
and possibly on licensing grounds&#41;. It would be best if you can show me 
&#40;in private&#41; snippets of code where you define the &#34;run these tasks on 
commit/rollback&#34;, so I can confirm the new system in question will be 
able to replicate your needs in full.

Does this make more sense?

[1] 
<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/RIBASUSHI/DBIx-Class-0.082821/lib/DBIx/Class/Schema.pm#L1387-1417">https://metacpan.org/source/RIBASUSHI/DBIx-Class-0.082821/lib/DBIx/Class/Schema.pm#L1387-1417</a></span>
[2] 
<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/RIBASUSHI/DBIx-Class-0.082821/t/52leaks.t#L400-434">https://metacpan.org/source/RIBASUSHI/DBIx-Class-0.082821/t/52leaks.t#L400-434</a></span>
[3] <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/dbsrgits/dbix-class/pull/63">https://github.com/dbsrgits/dbix-class/pull/63</a></span>
[4] 
<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/RIBASUSHI/DBIx-Class-0.082821/lib/DBIx/Class/_Util.pm#L170-216">https://metacpan.org/source/RIBASUSHI/DBIx-Class-0.082821/lib/DBIx/Class/_Util.pm#L170-216</a></span>
[5] 
<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/RIBASUSHI/DBIx-Class-0.082821/lib/DBIx/Class/Storage/TxnScopeGuard.pm#L52-53">https://metacpan.org/source/RIBASUSHI/DBIx-Class-0.082821/lib/DBIx/Class/Storage/TxnScopeGuard.pm#L52-53</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1768318" href="/Public/Bug/Display.html?id=105376#txn-1768318">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;28&nbsp;11:56:46&nbsp;2018</span>
    <span class="description">ribasushi [...] leporine.io -  Subject changed from &#39;Conflict with autodie &lt; 2.26 ?&#39; to &#39;Actions on txn commit &#40; was: Conflict with autodie &lt; 2.26 &#41;&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.400688</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
