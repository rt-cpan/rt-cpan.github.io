<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #68173 for DBD-Oracle: [1.28] Major problem with ORA_VARCHAR2 inout parameters on Oracle 11</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #68173 for DBD-Oracle: [1.28] Major problem with ORA_VARCHAR2 inout parameters on Oracle 11</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBD-Oracle">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBD-Oracle">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBD-Oracle">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBD-Oracle">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/pythian/DBD-Oracle/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-Oracle">DBD-Oracle CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">68173</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBD-Oracle">DBD-Oracle</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
tim.vanholder [...] anubex.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10192-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10193-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=68173">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-934542" href="/Public/Bug/Display.html?id=68173#txn-934542">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;13&nbsp;07:56:29&nbsp;2011</span>
    <span class="description">tim.vanholder [...] anubex.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [1.28] Major problem with ORA_VARCHAR2 inout parameters on Oracle 11</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 13 May 2011 13:52:04 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-Oracle [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tim Van Holder &lt;tim.vanholder [...] anubex.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/934542/485188/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/485188">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Problem seen in:
- 64-bit DBD::Oracle 1.27 as supplied by ActiveState PPM
- 32-bit DBD::Oracle 1.27 as supplied by ActiveState PPM
- 32-bit DBD::Oracle 1.28 as built via the CPAN module on
  ActiveState Perl

Code has:

  my $sth = $dbh-&gt;prepare&#40;&#34;BEGIN :filename := mypackage.myfunc; END;&#34;&#41;;
  return unless $sth;
  my $filename;
  $sth-&gt;bind_param_inout&#40;&#39;:filename&#39;, \$filename, 4000, ORA_VARCHAR2&#41;
    or return;
  $sth-&gt;execute&#40;&#41; or return;
  $filename =~ s/\s+$// if defined $filename; # strip trailing spaces
  return $filename;

This code triggers no warnings or errors whatsoever, but $filename ends
up completely blank. Use of dbms_output shows that a value is returned
properly by the package functions - it is the binding itself that seemed
to be &#40;silently&#41; failing.
Using SQL_VARCHAR instead of ORA_VARCHAR2 works, so we have a viable
workaround, but it is not exactly nice to have behaviour silently
failing like this.
ORA_NUMBER inout parameters do work as expected.

I&#39;m currently assuming this to be an Oracle 11 issue; I have not yet
been able to test the behaviour on a non-Windows platform with Oracle 11
client, so it _may_ be Windows-specific too.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-934549" href="/Public/Bug/Display.html?id=68173#txn-934549">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;13&nbsp;08:18:12&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/934549/485194/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/485194">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri May 13 07:56:29 2011, tim.vanholder@anubex.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Problem seen in:
&gt; - 64-bit DBD::Oracle 1.27 as supplied by ActiveState PPM
&gt; - 32-bit DBD::Oracle 1.27 as supplied by ActiveState PPM
&gt; - 32-bit DBD::Oracle 1.28 as built via the CPAN module on
&gt;   ActiveState Perl
&gt; 
&gt; Code has:
&gt; 
&gt;   my $sth = $dbh-&gt;prepare&#40;&#34;BEGIN :filename := mypackage.myfunc; 
</div>END;&#34;&#41;;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;   return unless $sth;
&gt;   my $filename;
&gt;   $sth-&gt;bind_param_inout&#40;&#39;:filename&#39;, \$filename, 4000, ORA_VARCHAR2&#41;
&gt;     or return;
&gt;   $sth-&gt;execute&#40;&#41; or return;
&gt;   $filename =~ s/\s+$// if defined $filename; # strip trailing spaces
&gt;   return $filename;
&gt; 
&gt; This code triggers no warnings or errors whatsoever, but $filename 
</div>ends
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; up completely blank. Use of dbms_output shows that a value is returned
&gt; properly by the package functions - it is the binding itself that 
</div>seemed
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; to be &#40;silently&#41; failing.
&gt; Using SQL_VARCHAR instead of ORA_VARCHAR2 works, so we have a viable
&gt; workaround, but it is not exactly nice to have behaviour silently
&gt; failing like this.
&gt; ORA_NUMBER inout parameters do work as expected.
&gt; 
&gt; I&#39;m currently assuming this to be an Oracle 11 issue; I have not yet
&gt; been able to test the behaviour on a non-Windows platform with Oracle 
</div>11
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; client, so it _may_ be Windows-specific too.
</div>
Works for me fine with:

perl -le &#39;use DBI; my $h = DBI-
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;connect&#40;&#34;dbi:Oracle:host=xxx;sid=xxx&#34;,&#34;xxx&#34;,&#34;xxx&#34;&#41;;my $s = $h-
&gt;prepare&#40;q{begin ? := mypkg.f_encryptString&#40;?,?&#41;; end;}&#41;;$s-
&gt;bind_param_inout&#40;1, \my $string, 4000, {TYPE =&gt; ORA_VARCHAR2}&#41;; $s-
&gt;bind_param&#40;2, &#34;fredfredfred&#34;&#41;;$s-&gt;bind_param&#40;3, &#34;fredfredfred&#34;&#41;;$s-
&gt;execute; print $string;&#39; 
</div>
Where f_encryptString takes 2 VARCHAR2s and returns a VARCHAR2. This is 
to Oracle 11 with the latest Oracle Instant Client for Linux.

What does mypackage.myfunc look like?

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-934552" href="/Public/Bug/Display.html?id=68173#txn-934552">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;13&nbsp;08:18:13&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-936358" href="/Public/Bug/Display.html?id=68173#txn-936358">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;18&nbsp;06:53:40&nbsp;2011</span>
    <span class="description">tim.vanholder [...] anubex.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #68173] [1.28] Major problem with ORA_VARCHAR2 inout parameters on Oracle 11</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 18 May 2011 12:49:15 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-Oracle [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tim Van Holder &lt;tim.vanholder [...] anubex.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/936358/486161/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/486161">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I did some follow-up tests.

These work:

perl -le &#39;
use DBI;
my $v;
my $h = DBI-&gt;connect&#40;&#34;dbi:Oracle:xxx&#34;,&#34;xxx&#34;,&#34;xxx&#34;&#41;;
my $s = $h-&gt;prepare&#40;q{begin :myparam := &#39;Hello World&#39;; end;}&#41;;
$s-&gt;bind_param_inout&#40;&#39;myparam&#39;, \$v, 4000, { TYPE =&gt; ORA_VARCHAR2 }&#41;;
$s-&gt; execute;
print &#34;result: [$v]\n&#34;;
&#39;

perl -le &#39;
use DBI;
use DBD::Oracle qw&#40;:ora_types&#41;;
my $v;
my $h = DBI-&gt;connect&#40;&#34;dbi:Oracle:xxx&#34;,&#34;xxx&#34;,&#34;xxx&#34;&#41;;
my $s = $h-&gt;prepare&#40;q{begin :myparam := &#39;Hello World&#39;; end;}&#41;;
$s-&gt;bind_param_inout&#40;&#39;myparam&#39;, \$v, 4000, { TYPE =&gt; &#39;ORA_VARCHAR2&#39; }&#41;;
$s-&gt; execute;
print &#34;result: [$v]\n&#34;;
&#39;

&#40;reporting [Hello World]&#41;, but these do not:

perl -le &#39;
use DBI;
use DBD::Oracle qw&#40;:ora_types&#41;;
my $v;
my $h = DBI-&gt;connect&#40;&#34;dbi:Oracle:xxx&#34;,&#34;xxx&#34;,&#34;xxx&#34;&#41;;
my $s = $h-&gt;prepare&#40;q{begin :myparam := &#39;Hello World&#39;; end;}&#41;;
$s-&gt;bind_param_inout&#40;&#39;myparam&#39;, \$v, 4000, ORA_VARCHAR2&#41;;
$s-&gt; execute;
print &#34;result: [$v]\n&#34;;
&#39;

perl -le &#39;
use DBI;
use DBD::Oracle qw&#40;:ora_types&#41;;
my $v;
my $h = DBI-&gt;connect&#40;&#34;dbi:Oracle:xxx&#34;,&#34;xxx&#34;,&#34;xxx&#34;&#41;;
my $s = $h-&gt;prepare&#40;q{begin :myparam := &#39;Hello World&#39;; end;}&#41;;
$s-&gt;bind_param_inout&#40;&#39;myparam&#39;, \$v, 4000, { TYPE =&gt; ORA_VARCHAR2 }&#41;;
$s-&gt; execute;
print &#34;result: [$v]\n&#34;;
&#39;

&#40;reporting [&lt;lots of spaces&gt;]&#41;.
So the ORA_VARCHAR2 does not seem to be processed correctly if it comes
from DBD::Oracle&#39;s exported values &#40;is it being treated as CHAR instead
of VARCHAR2?&#41;.

Then I found that I did not get the same issue with the same
code/versions against a different database - and both databases are the
same Oracle version too.
Further tests showed that the results were identical even on an old
debian box with an Oracle 10.2 client and an old DBD::Oracle &#40;1.19 I think&#41;.

Turns out this was cause by the database&#39;s NLS character set &#40;the
&#34;failing&#34; database has AL32UTF8 where the &#34;working&#34; one has &#34;WE8MSWIN1252&#34;&#41;.
Setting NLS_LANG causes same results as with the non-UTF8 database
&#40;space-padded &#34;Hello World&#34;&#41;.

This still does not &#40;to me&#41; explain why:
- I do get a value when using SQL_VARCHAR or a ORA_VARCHAR2 as a string
- I get space-padded results when ORA_VARCHAR2 is used as an import
  from DBD::Oracle

On 13/05/2011 14:18, Martin J Evans via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=68173">https://rt.cpan.org/Ticket/Display.html?id=68173</a></span> &gt;
&gt; 
&gt; On Fri May 13 07:56:29 2011, tim.vanholder@anubex.com wrote:
<div class="message-stanza open">&gt;&gt; Problem seen in:
&gt;&gt; - 64-bit DBD::Oracle 1.27 as supplied by ActiveState PPM
&gt;&gt; - 32-bit DBD::Oracle 1.27 as supplied by ActiveState PPM
&gt;&gt; - 32-bit DBD::Oracle 1.28 as built via the CPAN module on
&gt;&gt;   ActiveState Perl
&gt;&gt;
&gt;&gt; Code has:
&gt;&gt;
&gt;&gt;   my $sth = $dbh-&gt;prepare&#40;&#34;BEGIN :filename := mypackage.myfunc; 
</div>&gt; END;&#34;&#41;;
<div class="message-stanza open">&gt;&gt;   return unless $sth;
&gt;&gt;   my $filename;
&gt;&gt;   $sth-&gt;bind_param_inout&#40;&#39;:filename&#39;, \$filename, 4000, ORA_VARCHAR2&#41;
&gt;&gt;     or return;
&gt;&gt;   $sth-&gt;execute&#40;&#41; or return;
&gt;&gt;   $filename =~ s/\s+$// if defined $filename; # strip trailing spaces
&gt;&gt;   return $filename;
&gt;&gt;
&gt;&gt; This code triggers no warnings or errors whatsoever, but $filename 
</div>&gt; ends
<div class="message-stanza open">&gt;&gt; up completely blank. Use of dbms_output shows that a value is returned
&gt;&gt; properly by the package functions - it is the binding itself that 
</div>&gt; seemed
<div class="message-stanza open">&gt;&gt; to be &#40;silently&#41; failing.
&gt;&gt; Using SQL_VARCHAR instead of ORA_VARCHAR2 works, so we have a viable
&gt;&gt; workaround, but it is not exactly nice to have behaviour silently
&gt;&gt; failing like this.
&gt;&gt; ORA_NUMBER inout parameters do work as expected.
&gt;&gt;
&gt;&gt; I&#39;m currently assuming this to be an Oracle 11 issue; I have not yet
&gt;&gt; been able to test the behaviour on a non-Windows platform with Oracle 
</div>&gt; 11
<div class="message-stanza open">&gt;&gt; client, so it _may_ be Windows-specific too.
</div>&gt; 
&gt; Works for me fine with:
&gt; 
&gt; perl -le &#39;use DBI; my $h = DBI-
<div class="message-stanza open">&gt;&gt; connect&#40;&#34;dbi:Oracle:host=xxx;sid=xxx&#34;,&#34;xxx&#34;,&#34;xxx&#34;&#41;;my $s = $h-
&gt;&gt; prepare&#40;q{begin ? := mypkg.f_encryptString&#40;?,?&#41;; end;}&#41;;$s-
&gt;&gt; bind_param_inout&#40;1, \my $string, 4000, {TYPE =&gt; ORA_VARCHAR2}&#41;; $s-
&gt;&gt; bind_param&#40;2, &#34;fredfredfred&#34;&#41;;$s-&gt;bind_param&#40;3, &#34;fredfredfred&#34;&#41;;$s-
&gt;&gt; execute; print $string;&#39; 
</div>&gt; 
&gt; Where f_encryptString takes 2 VARCHAR2s and returns a VARCHAR2. This is 
&gt; to Oracle 11 with the latest Oracle Instant Client for Linux.
&gt; 
&gt; What does mypackage.myfunc look like?
&gt; 
&gt; Martin
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-936428" href="/Public/Bug/Display.html?id=68173#txn-936428">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;18&nbsp;10:55:21&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/936428/486208/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/486208">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed May 18 06:53:40 2011, tim.vanholder@anubex.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I did some follow-up tests.
&gt; 
&gt; These work:
</div>
OK, we are both guilty of not using strict and warnings:

BTW, your examples don&#39;t work for me. I get &#34;Can&#39;t bind unknown 
placeholder &#39;myparam&#39;&#34; presumably because that should be &#34;:myparam&#34; in 
the bind_param_inout call.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; perl -le &#39;
&gt; use DBI;
&gt; my $v;
&gt; my $h = DBI-&gt;connect&#40;&#34;dbi:Oracle:xxx&#34;,&#34;xxx&#34;,&#34;xxx&#34;&#41;;
&gt; my $s = $h-&gt;prepare&#40;q{begin :myparam := &#39;Hello World&#39;; end;}&#41;;
&gt; $s-&gt;bind_param_inout&#40;&#39;myparam&#39;, \$v, 4000, { TYPE =&gt; ORA_VARCHAR2 }&#41;;
&gt; $s-&gt; execute;
&gt; print &#34;result: [$v]\n&#34;;
&gt; &#39;
</div>
If you add strict you&#39;ll see
Bareword &#34;ORA_VARCHAR2&#34; not allowed while &#34;strict subs&#34; in use
I&#39;m not sure right now what TYPE gets set to if you use ORA_VARCHAR2 
without importing it first &#40;probably 0 which probably causes DBD::Oracle 
to use the default type&#41;.

The following one should say:

Argument &#34;ORA_VARCHAR2&#34; isn&#39;t numeric

It needs to be numeric not a string &#39;ORA_VARCHAR2&#39;. However because you 
have not got strict or warnings enabled you do not see that and I guess 
the default type is chosen.

Always use strict and warnings when you get strange results.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; perl -le &#39;
&gt; use DBI;
&gt; use DBD::Oracle qw&#40;:ora_types&#41;;
&gt; my $v;
&gt; my $h = DBI-&gt;connect&#40;&#34;dbi:Oracle:xxx&#34;,&#34;xxx&#34;,&#34;xxx&#34;&#41;;
&gt; my $s = $h-&gt;prepare&#40;q{begin :myparam := &#39;Hello World&#39;; end;}&#41;;
&gt; $s-&gt;bind_param_inout&#40;&#39;myparam&#39;, \$v, 4000, { TYPE =&gt; &#39;ORA_VARCHAR2&#39; 
</div>}&#41;;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; $s-&gt; execute;
&gt; print &#34;result: [$v]\n&#34;;
&gt; &#39;
</div>


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; &#40;reporting [Hello World]&#41;, but these do not:
&gt; perl -le &#39;
&gt; use DBI;
&gt; use DBD::Oracle qw&#40;:ora_types&#41;;
&gt; my $v;
&gt; my $h = DBI-&gt;connect&#40;&#34;dbi:Oracle:xxx&#34;,&#34;xxx&#34;,&#34;xxx&#34;&#41;;
&gt; my $s = $h-&gt;prepare&#40;q{begin :myparam := &#39;Hello World&#39;; end;}&#41;;
&gt; $s-&gt;bind_param_inout&#40;&#39;myparam&#39;, \$v, 4000, ORA_VARCHAR2&#41;;
&gt; $s-&gt; execute;
&gt; print &#34;result: [$v]\n&#34;;
&gt; &#39;
</div>
The above one is correct systax and uses ORA_VARCHAR2. Like you I get a 
large string of what appears to be spaces.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; perl -le &#39;
&gt; use DBI;
&gt; use DBD::Oracle qw&#40;:ora_types&#41;;
&gt; my $v;
&gt; my $h = DBI-&gt;connect&#40;&#34;dbi:Oracle:xxx&#34;,&#34;xxx&#34;,&#34;xxx&#34;&#41;;
&gt; my $s = $h-&gt;prepare&#40;q{begin :myparam := &#39;Hello World&#39;; end;}&#41;;
&gt; $s-&gt;bind_param_inout&#40;&#39;myparam&#39;, \$v, 4000, { TYPE =&gt; ORA_VARCHAR2 }&#41;;
&gt; $s-&gt; execute;
&gt; print &#34;result: [$v]\n&#34;;
&gt; &#39;
</div>
The above one is also correct syntax etc and I believe uses 
ORA_VARCHAR2.
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#40;reporting [&lt;lots of spaces&gt;]&#41;.
</div>
You missed out the {ora_type =&gt; ORA_VARCHAR2} which I believe is the 
correct way to do it.

Bare in mind some notes in the pod about different string padding 
behaviour - search for ORA_VARCHAR2. Here are some excerpts:

 ORA_VARCHAR2

    Oracle clients using OCI 8 will strip trailing spaces and allow 
embedded \0 bytes. Oracle clients using OCI 9.2 do not strip trailing 
spaces and allow embedded \0 bytes. This is the normal default 
placeholder type.

Padded Char Fields

Oracle Clients after OCI 9.2 will automatically pad CHAR placeholder 
values to the size of the CHAR. As the default placeholder type value in 
DBD::Oracle is ORA_VARCHAR2 to access this behaviour you will have to 
change the default placeholder type with &#34;ora_ph_type&#34; or placeholder 
type for a particular call with &#34;bind&#34; in DBI or &#34;bind_param_inout&#34; in 
DBI with &#34;ORA_CHAR&#34;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So the ORA_VARCHAR2 does not seem to be processed correctly if it 
</div>comes
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; from DBD::Oracle&#39;s exported values &#40;is it being treated as CHAR 
</div>instead
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; of VARCHAR2?&#41;.
&gt; 
&gt; Then I found that I did not get the same issue with the same
&gt; code/versions against a different database - and both databases are 
</div>the
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; same Oracle version too.
&gt; Further tests showed that the results were identical even on an old
&gt; debian box with an Oracle 10.2 client and an old DBD::Oracle &#40;1.19 I 
</div>think&#41;.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Turns out this was cause by the database&#39;s NLS character set &#40;the
&gt; &#34;failing&#34; database has AL32UTF8 where the &#34;working&#34; one has 
</div>&#34;WE8MSWIN1252&#34;&#41;.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Setting NLS_LANG causes same results as with the non-UTF8 database
&gt; &#40;space-padded &#34;Hello World&#34;&#41;.
&gt; 
&gt; This still does not &#40;to me&#41; explain why:
&gt; - I do get a value when using SQL_VARCHAR or a ORA_VARCHAR2 as a 
</div>string
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; - I get space-padded results when ORA_VARCHAR2 is used as an import
&gt;   from DBD::Oracle
</div>

Hope this helps.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-936719" href="/Public/Bug/Display.html?id=68173#txn-936719">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;19&nbsp;03:08:15&nbsp;2011</span>
    <span class="description">tim.vanholder [...] anubex.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #68173] [1.28] Major problem with ORA_VARCHAR2 inout parameters on Oracle 11</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 19 May 2011 09:04:03 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-Oracle [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tim Van Holder &lt;tim.vanholder [...] anubex.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/936719/486374/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/486374">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 18/05/2011 16:55, Martin J Evans via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=68173">https://rt.cpan.org/Ticket/Display.html?id=68173</a></span> &gt;
&gt; 
&gt; On Wed May 18 06:53:40 2011, tim.vanholder@anubex.com wrote:
<div class="message-stanza open">&gt;&gt; I did some follow-up tests.
&gt;&gt;
&gt;&gt; These work:
</div>&gt; 
&gt; OK, we are both guilty of not using strict and warnings:
&gt; 
&gt; BTW, your examples don&#39;t work for me. I get &#34;Can&#39;t bind unknown 
&gt; placeholder &#39;myparam&#39;&#34; presumably because that should be &#34;:myparam&#34; in 
&gt; the bind_param_inout call.
</div>
Yeah that&#39;s my bad - started out with what&#39;s in the mail, but then added
in the real connect strings and fixed the placeholder name, but forgot
to update the mail to match.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; perl -le &#39;
&gt;&gt; use DBI;
&gt;&gt; my $v;
&gt;&gt; my $h = DBI-&gt;connect&#40;&#34;dbi:Oracle:xxx&#34;,&#34;xxx&#34;,&#34;xxx&#34;&#41;;
&gt;&gt; my $s = $h-&gt;prepare&#40;q{begin :myparam := &#39;Hello World&#39;; end;}&#41;;
&gt;&gt; $s-&gt;bind_param_inout&#40;&#39;myparam&#39;, \$v, 4000, { TYPE =&gt; ORA_VARCHAR2 }&#41;;
&gt;&gt; $s-&gt; execute;
&gt;&gt; print &#34;result: [$v]\n&#34;;
&gt;&gt; &#39;
</div>&gt; 
&gt; If you add strict you&#39;ll see
&gt; Bareword &#34;ORA_VARCHAR2&#34; not allowed while &#34;strict subs&#34; in use
&gt; I&#39;m not sure right now what TYPE gets set to if you use ORA_VARCHAR2 
&gt; without importing it first &#40;probably 0 which probably causes DBD::Oracle 
&gt; to use the default type&#41;.
</div>
I only tried it this way because that&#39;s what was in your sample :-&#41;
I did think it was odd that this was allowed &#40;forgot about strict&#41;, but
incorrectly assumed that it was stringifying ORA_VARCHAR2 and that
DBD::Oracle was checking both the real number and a string.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The following one should say:
&gt; 
&gt; Argument &#34;ORA_VARCHAR2&#34; isn&#39;t numeric
&gt; 
&gt; It needs to be numeric not a string &#39;ORA_VARCHAR2&#39;. However because you 
&gt; have not got strict or warnings enabled you do not see that and I guess 
&gt; the default type is chosen.
&gt; 
&gt; Always use strict and warnings when you get strange results.
</div>
My real scripts do - just tend to forget to add it to perl -e samples.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; &#40;reporting [Hello World]&#41;, but these do not:
&gt;&gt; perl -le &#39;
&gt;&gt; use DBI;
&gt;&gt; use DBD::Oracle qw&#40;:ora_types&#41;;
&gt;&gt; my $v;
&gt;&gt; my $h = DBI-&gt;connect&#40;&#34;dbi:Oracle:xxx&#34;,&#34;xxx&#34;,&#34;xxx&#34;&#41;;
&gt;&gt; my $s = $h-&gt;prepare&#40;q{begin :myparam := &#39;Hello World&#39;; end;}&#41;;
&gt;&gt; $s-&gt;bind_param_inout&#40;&#39;myparam&#39;, \$v, 4000, ORA_VARCHAR2&#41;;
&gt;&gt; $s-&gt; execute;
&gt;&gt; print &#34;result: [$v]\n&#34;;
&gt;&gt; &#39;
&gt;&gt; &#40;reporting [&lt;lots of spaces&gt;]&#41;.
</div>&gt; 
&gt; The above one is correct systax and uses ORA_VARCHAR2. Like you I get a 
&gt; large string of what appears to be spaces.
</div>
It&#39;s the syntax I had.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; You missed out the {ora_type =&gt; ORA_VARCHAR2} which I believe is the 
&gt; correct way to do it.
&gt; 
&gt; Bare in mind some notes in the pod about different string padding 
&gt; behaviour - search for ORA_VARCHAR2. Here are some excerpts:
&gt; 
&gt;  ORA_VARCHAR2
&gt; 
&gt;     Oracle clients using OCI 8 will strip trailing spaces and allow 
&gt; embedded \0 bytes. Oracle clients using OCI 9.2 do not strip trailing 
&gt; spaces and allow embedded \0 bytes. This is the normal default 
&gt; placeholder type.
</div>
OK, I guess that explains the space padding &#40;which was not a real issue
anyway, since I was stripping them in code&#41;. Just what seemed like an
odd discrepancy between the two invocations &#40;and am slightly surprised
that OCI is actually space-padding VARCHAR2s&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; So the ORA_VARCHAR2 does not seem to be processed correctly if it 
</div>&gt; comes
<div class="message-stanza open">&gt;&gt; from DBD::Oracle&#39;s exported values &#40;is it being treated as CHAR 
</div>&gt; instead
<div class="message-stanza open">&gt;&gt; of VARCHAR2?&#41;.
&gt;&gt;
&gt;&gt; Then I found that I did not get the same issue with the same
&gt;&gt; code/versions against a different database - and both databases are 
</div>&gt; the
<div class="message-stanza open">&gt;&gt; same Oracle version too.
&gt;&gt; Further tests showed that the results were identical even on an old
&gt;&gt; debian box with an Oracle 10.2 client and an old DBD::Oracle &#40;1.19 I 
</div>&gt; think&#41;.
<div class="message-stanza open">&gt;&gt;
&gt;&gt; Turns out this was cause by the database&#39;s NLS character set &#40;the
&gt;&gt; &#34;failing&#34; database has AL32UTF8 where the &#34;working&#34; one has 
</div>&gt; &#34;WE8MSWIN1252&#34;&#41;.
<div class="message-stanza open">&gt;&gt; Setting NLS_LANG causes same results as with the non-UTF8 database
&gt;&gt; &#40;space-padded &#34;Hello World&#34;&#41;.
&gt;&gt;
&gt;&gt; This still does not &#40;to me&#41; explain why:
&gt;&gt; - I do get a value when using SQL_VARCHAR or a ORA_VARCHAR2 as a 
</div>&gt; string
<div class="message-stanza open">&gt;&gt; - I get space-padded results when ORA_VARCHAR2 is used as an import
&gt;&gt;   from DBD::Oracle
</div>&gt; 
&gt; Hope this helps.
</div>
It does. I guess the only remaining question is: why does ORA_VARCHAR2
care about NLS_LANG, but SQL_VARCHAR doesn&#39;t &#40;both are for
variable-length character data so I would rather expect them to do the
same basic thing&#41;?
Note that I also do _not_ get space padding &#40;or NLS_LANG issues&#41; if I
specify no placeholder type at all, which is odd since the man page says
that ORA_VARCHAR2 is the default placeholder type.

I guess the best thing for me to do is to just use SQL_VARCHAR and
SQL_NUMERIC instead of ORA_VARCHAR2 and ORA_NUMBER; aside from getting
the preferred behaviour for the strings that should still work if I ever
need my code to run against a database other than Oracle.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-936733" href="/Public/Bug/Display.html?id=68173#txn-936733">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;19&nbsp;04:22:03&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/936733/486379/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/486379">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&lt;snipped a lot&gt;

On Thu May 19 03:08:15 2011, tim.vanholder@anubex.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 18/05/2011 16:55, Martin J Evans via RT wrote:
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=68173">https://rt.cpan.org/Ticket/Display.html?id=68173</a></span> &gt;
&gt; &gt; 
&gt; &gt; On Wed May 18 06:53:40 2011, tim.vanholder@anubex.com wrote:
<div class="message-stanza open">&gt; &gt;&gt; I did some follow-up tests.
</div></div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; If you add strict you&#39;ll see
&gt; &gt; Bareword &#34;ORA_VARCHAR2&#34; not allowed while &#34;strict subs&#34; in use
&gt; &gt; I&#39;m not sure right now what TYPE gets set to if you use ORA_VARCHAR2 
&gt; &gt; without importing it first &#40;probably 0 which probably causes
</div></div>DBD::Oracle 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; to use the default type&#41;.
</div>&gt; 
&gt; I only tried it this way because that&#39;s what was in your sample :-&#41;
</div>
Really? I only see TYPE =&gt; in my example.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; You missed out the {ora_type =&gt; ORA_VARCHAR2} which I believe is the 
&gt; &gt; correct way to do it.
&gt; &gt; 
&gt; &gt; Bare in mind some notes in the pod about different string padding 
&gt; &gt; behaviour - search for ORA_VARCHAR2. Here are some excerpts:
&gt; &gt; 
&gt; &gt;  ORA_VARCHAR2
&gt; &gt; 
&gt; &gt;     Oracle clients using OCI 8 will strip trailing spaces and allow 
&gt; &gt; embedded \0 bytes. Oracle clients using OCI 9.2 do not strip trailing 
&gt; &gt; spaces and allow embedded \0 bytes. This is the normal default 
&gt; &gt; placeholder type.
</div>&gt; 
&gt; OK, I guess that explains the space padding &#40;which was not a real issue
&gt; anyway, since I was stripping them in code&#41;. Just what seemed like an
&gt; odd discrepancy between the two invocations &#40;and am slightly surprised
&gt; that OCI is actually space-padding VARCHAR2s&#41;.
</div>
There is also DBI&#39;s ChopBlanks.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Hope this helps.
</div>&gt; 
&gt; It does. I guess the only remaining question is: why does ORA_VARCHAR2
&gt; care about NLS_LANG, but SQL_VARCHAR doesn&#39;t &#40;both are for
&gt; variable-length character data so I would rather expect them to do the
&gt; same basic thing&#41;?
&gt; Note that I also do _not_ get space padding &#40;or NLS_LANG issues&#41; if I
&gt; specify no placeholder type at all, which is odd since the man page says
&gt; that ORA_VARCHAR2 is the default placeholder type.
&gt; 
&gt; I guess the best thing for me to do is to just use SQL_VARCHAR and
&gt; SQL_NUMERIC instead of ORA_VARCHAR2 and ORA_NUMBER; aside from getting
&gt; the preferred behaviour for the strings that should still work if I ever
&gt; need my code to run against a database other than Oracle.
</div>
I don&#39;t know why you see different behavior. If you want to pursue it I
suggest you post to the dbi-users list where there are a lot more Oracle
people than read these RTs.

What would you consider would close this RT to your satisfaction?

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-936747" href="/Public/Bug/Display.html?id=68173#txn-936747">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;19&nbsp;04:33:53&nbsp;2011</span>
    <span class="description">tim.vanholder [...] anubex.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #68173] [1.28] Major problem with ORA_VARCHAR2 inout parameters on Oracle 11</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 19 May 2011 10:29:42 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-Oracle [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tim Van Holder &lt;tim.vanholder [...] anubex.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/936747/486389/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/486389">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 19/05/2011 10:22, Martin J Evans via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=68173">https://rt.cpan.org/Ticket/Display.html?id=68173</a></span> &gt;
&gt; 
&gt; &lt;snipped a lot more&gt;
<div class="message-stanza open">&gt;&gt;
&gt;&gt; I only tried it this way because that&#39;s what was in your sample :-&#41;
</div>&gt; 
&gt; Really? I only see TYPE =&gt; in my example.
</div>
I meant that your sample had TYPE =&gt; ORA_VARCHAR2 without the import of
:ora_types from DBD::Oracle &#40;only a &#34;use DBI&#34;&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt;&gt;&gt; Hope this helps.
</div>&gt;&gt;
&gt;&gt; It does. I guess the only remaining question is: why does ORA_VARCHAR2
&gt;&gt; care about NLS_LANG, but SQL_VARCHAR doesn&#39;t &#40;both are for
&gt;&gt; variable-length character data so I would rather expect them to do the
&gt;&gt; same basic thing&#41;?
&gt;&gt; Note that I also do _not_ get space padding &#40;or NLS_LANG issues&#41; if I
&gt;&gt; specify no placeholder type at all, which is odd since the man page says
&gt;&gt; that ORA_VARCHAR2 is the default placeholder type.
&gt;&gt;
&gt;&gt; I guess the best thing for me to do is to just use SQL_VARCHAR and
&gt;&gt; SQL_NUMERIC instead of ORA_VARCHAR2 and ORA_NUMBER; aside from getting
&gt;&gt; the preferred behaviour for the strings that should still work if I ever
&gt;&gt; need my code to run against a database other than Oracle.
</div>&gt; 
&gt; I don&#39;t know why you see different behavior. If you want to pursue it I
&gt; suggest you post to the dbi-users list where there are a lot more Oracle
&gt; people than read these RTs.
&gt; 
&gt; What would you consider would close this RT to your satisfaction?
</div>
As far as I&#39;m concerned, it can be closed:
- the initial case was basically user error &#40;the man page does mention
  the need for NLS_LANG/NLS_NCHAR for Unicode databases&#41;
- I have 2 viable workarounds:
  - using SQL_VARCHAR instead of ORA_VARCHAR
  - ensuring that NLS_LANG is set correctly and/or documenting that it
    should be

It just seems like there is some buggyness somewhere:
- SQL_VARCHAR doesn&#39;t have NLS_LANG issues
- even for the NLS_LANG issues: the data being sent is basically US
  ASCII, so even if character set translation is applied, it should
  still result in a valid, identical, string &#40;and not blanks without
  any kind of error&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-936787" href="/Public/Bug/Display.html?id=68173#txn-936787">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;19&nbsp;05:39:22&nbsp;2011</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/936787/486410/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/486410">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu May 19 04:33:53 2011, tim.vanholder@anubex.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 19/05/2011 10:22, Martin J Evans via RT wrote:
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=68173">https://rt.cpan.org/Ticket/Display.html?id=68173</a></span> &gt;
&gt; &gt; 
&gt; &gt; &lt;snipped a lot more&gt;
<div class="message-stanza open">&gt; &gt;&gt;
&gt; &gt;&gt; I only tried it this way because that&#39;s what was in your sample :-&#41;
</div>&gt; &gt; 
&gt; &gt; Really? I only see TYPE =&gt; in my example.
</div>&gt; 
&gt; I meant that your sample had TYPE =&gt; ORA_VARCHAR2 without the import of
&gt; :ora_types from DBD::Oracle &#40;only a &#34;use DBI&#34;&#41;.
</div>
ok

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt;&gt; Hope this helps.
</div>&gt; &gt;&gt;
&gt; &gt;&gt; It does. I guess the only remaining question is: why does ORA_VARCHAR2
&gt; &gt;&gt; care about NLS_LANG, but SQL_VARCHAR doesn&#39;t &#40;both are for
&gt; &gt;&gt; variable-length character data so I would rather expect them to do the
&gt; &gt;&gt; same basic thing&#41;?
&gt; &gt;&gt; Note that I also do _not_ get space padding &#40;or NLS_LANG issues&#41; if I
&gt; &gt;&gt; specify no placeholder type at all, which is odd since the man page
</div></div>says
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt;&gt; that ORA_VARCHAR2 is the default placeholder type.
&gt; &gt;&gt;
&gt; &gt;&gt; I guess the best thing for me to do is to just use SQL_VARCHAR and
&gt; &gt;&gt; SQL_NUMERIC instead of ORA_VARCHAR2 and ORA_NUMBER; aside from getting
&gt; &gt;&gt; the preferred behaviour for the strings that should still work if I
</div></div>ever
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; need my code to run against a database other than Oracle.
</div>&gt; &gt; 
&gt; &gt; I don&#39;t know why you see different behavior. If you want to pursue it I
&gt; &gt; suggest you post to the dbi-users list where there are a lot more Oracle
&gt; &gt; people than read these RTs.
&gt; &gt; 
&gt; &gt; What would you consider would close this RT to your satisfaction?
</div>&gt; 
&gt; As far as I&#39;m concerned, it can be closed:
&gt; - the initial case was basically user error &#40;the man page does mention
&gt;   the need for NLS_LANG/NLS_NCHAR for Unicode databases&#41;
&gt; - I have 2 viable workarounds:
&gt;   - using SQL_VARCHAR instead of ORA_VARCHAR
&gt;   - ensuring that NLS_LANG is set correctly and/or documenting that it
&gt;     should be
&gt; 
&gt; It just seems like there is some buggyness somewhere:
&gt; - SQL_VARCHAR doesn&#39;t have NLS_LANG issues
&gt; - even for the NLS_LANG issues: the data being sent is basically US
&gt;   ASCII, so even if character set translation is applied, it should
&gt;   still result in a valid, identical, string &#40;and not blanks without
&gt;   any kind of error&#41;
</div>
I only help maintain DBD::Oracle and don&#39;t know all the answers. It
would be worth you posting an example to the dbi-users list you can find
at <span class="clickylink"><a target="new" rel="nofollow" href="http://dbi.perl.org">http://dbi.perl.org</a></span> and may be someone else can help identify if
there is a real problem.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1092818" href="/Public/Bug/Display.html?id=68173#txn-1092818">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;24&nbsp;06:10:04&nbsp;2012</span>
    <span class="description">bohica [...] ntlworld.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.56198</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
