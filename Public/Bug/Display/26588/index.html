<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #26588 for XML-SAX: charset decoding is broken</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #26588 for XML-SAX: charset decoding is broken</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=XML-SAX">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=XML-SAX">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=XML-SAX">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=XML-SAX">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/XML-SAX">XML-SAX CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">26588</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=XML-SAX">XML-SAX</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ntyni [...] iki.fi

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-37552-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.15    </td>
  </tr>
  <tr id="CF-37553-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




XML-SAX-patch-new<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/312603/142379/XML-SAX-patch-new">
Mon Apr 23 16:53:30 2007 (4k) by ntyni [...] iki.fi
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=26588">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-312603" href="/Public/Bug/Display.html?id=26588#txn-312603">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;23&nbsp;16:53:30&nbsp;2007</span>
    <span class="description">ntyni [...] iki.fi -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> charset decoding is broken</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/312603/142376/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/142376">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 0.15, when reading from a stream, XML::SAX::PurePerl does not decode
the first 4096 bytes into the Perl internal UTF-8 representation,
although it sets the filehandle PerlIO encoding to UTF-8.

This is a regression from 0.12. The problem is that the Unicode version
of XML::SAX::PurePerl::Reader::switch_encoding_string&#40;&#41; uses
Encode::from_to&#40;&#41;, which does not set the Perl internal UTF-8 flag.
Replacing this with eg. Encode::decode&#40;&#41; fixes the bug. This affects
those bytes that are first read into the buffer before setting the
PerlIO encoding.

With the fix to SAX/PurePerl/Reader/UnicodeExt.pm, there&#39;s a test
failure from t/14encoding.t. It turns out that there are bugs in
XML::SAX::PurePerl::Productions : the $NameChar regexp shouldn&#39;t use
$Letter, since that contains beginning and end anchors &#40;^ and $&#41;. In
fact, it looks like the $Letter production is unused now and $NameChar
shouldn&#39;t have any anchors either. &#40;It also looks like the binding of
the anchors is broken, since  /^a|b$/ means &#40;/^a/ || /b$/&#41;, not /^&#40;a|b&#41;$/.&#41;

I&#39;m attaching a proposed patch that adds a testcase for these issues and
fixes them for me. The tests pass for me on 0.12 and fail on 0.15. I
haven&#39;t tested on an old non-Unicode Perl; this is on Perl 5.8.8 on
Debian Etch &#40;4.0&#41;.

I&#39;m a bit uneasy that switch_encoding_string&#40;&#41; can&#39;t be called twice now
without a fatal error, but I&#39;m not sure what is the best thing to do.
Maybe just make it a no-op if the new charset is UTF-8 and
Encode::is_utf8 is set? I suppose it has never worked if the charset is
not UTF-8 on the second call....

FWIW, this issue has caused Debian bug #405186,
<span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/405186">http://bugs.debian.org/405186</a></span> .

Please let me know if you need more information; I&#39;ll be happy to help
in any way I can.

Cheers,
-- 
Niko Tyni
ntyni@iki.fi
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> XML-SAX-patch-new</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/312603/142379/XML-SAX-patch-new">Download XML-SAX-patch-new</a><br />
<span class="downloadcontenttype">application/octet-stream 4k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-312643" href="/Public/Bug/Display.html?id=26588#txn-312643">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;23&nbsp;17:42:13&nbsp;2007</span>
    <span class="description">grant [...] mclean.net.nz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #26588] charset decoding is broken</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 24 Apr 2007 09:41:43 +1200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-SAX [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Grant McLean &lt;grant [...] mclean.net.nz&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/312643/142397/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/142397">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi

Thanks for the comprehensive report and patch.  I hope to integrate it
and get a release out &#39;soon&#39; :-&#41;

One thing that intrigues me is that the Debian bug you referred to was a
build failure in the package docbook2x.  That package sepcifies a
dependency on libxml-sax-expat-perl.  If that package is installed, then
the XML::SAX::PurePerl module shouldn&#39;t be being used at all.

I&#39;d recommend only using the PurePerl parser in situations where
building expat of libxml2 libraries is problematic - that is certainly
not the case with Debian.  The dependencies do seem to be sane, I just
don&#39;t understand why the PurePerl module was being used.  Or did the
dependency get changed to libxml-sax-expat-perl *after* the bug report?

Notwithstanding my confusion above, I am interested in tracking down and
fixing bugs in XML::SAX::PurePerl, so thanks again.

Regards
Grant

On Mon, 2007-04-23 at 16:53 -0400, ntyni@iki.fi via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Mon Apr 23 16:53:30 2007: Request 26588 was acted upon.
&gt; Transaction: Ticket created by ntyni@iki.fi
&gt;        Queue: XML-SAX
&gt;      Subject: charset decoding is broken
&gt;    Broken in: 0.15
&gt;     Severity: Important
&gt;        Owner: Nobody
&gt;   Requestors: ntyni@iki.fi
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=26588">http://rt.cpan.org/Ticket/Display.html?id=26588</a></span> &gt;
&gt; 
&gt; 
&gt; On 0.15, when reading from a stream, XML::SAX::PurePerl does not decode
&gt; the first 4096 bytes into the Perl internal UTF-8 representation,
&gt; although it sets the filehandle PerlIO encoding to UTF-8.
&gt; 
&gt; This is a regression from 0.12. The problem is that the Unicode version
&gt; of XML::SAX::PurePerl::Reader::switch_encoding_string&#40;&#41; uses
&gt; Encode::from_to&#40;&#41;, which does not set the Perl internal UTF-8 flag.
&gt; Replacing this with eg. Encode::decode&#40;&#41; fixes the bug. This affects
&gt; those bytes that are first read into the buffer before setting the
&gt; PerlIO encoding.
&gt; 
&gt; With the fix to SAX/PurePerl/Reader/UnicodeExt.pm, there&#39;s a test
&gt; failure from t/14encoding.t. It turns out that there are bugs in
&gt; XML::SAX::PurePerl::Productions : the $NameChar regexp shouldn&#39;t use
&gt; $Letter, since that contains beginning and end anchors &#40;^ and $&#41;. In
&gt; fact, it looks like the $Letter production is unused now and $NameChar
&gt; shouldn&#39;t have any anchors either. &#40;It also looks like the binding of
&gt; the anchors is broken, since  /^a|b$/ means &#40;/^a/ || /b$/&#41;, not /^&#40;a|b&#41;$/.&#41;
&gt; 
&gt; I&#39;m attaching a proposed patch that adds a testcase for these issues and
&gt; fixes them for me. The tests pass for me on 0.12 and fail on 0.15. I
&gt; haven&#39;t tested on an old non-Unicode Perl; this is on Perl 5.8.8 on
&gt; Debian Etch &#40;4.0&#41;.
&gt; 
&gt; I&#39;m a bit uneasy that switch_encoding_string&#40;&#41; can&#39;t be called twice now
&gt; without a fatal error, but I&#39;m not sure what is the best thing to do.
&gt; Maybe just make it a no-op if the new charset is UTF-8 and
&gt; Encode::is_utf8 is set? I suppose it has never worked if the charset is
&gt; not UTF-8 on the second call....
&gt; 
&gt; FWIW, this issue has caused Debian bug #405186,
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/405186">http://bugs.debian.org/405186</a></span> .
&gt; 
&gt; Please let me know if you need more information; I&#39;ll be happy to help
&gt; in any way I can.
&gt; 
&gt; Cheers,
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-312644" href="/Public/Bug/Display.html?id=26588#txn-312644">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;23&nbsp;17:42:29&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-312656" href="/Public/Bug/Display.html?id=26588#txn-312656">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;23&nbsp;18:00:36&nbsp;2007</span>
    <span class="description">ntyni [...] iki.fi -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #26588] charset decoding is broken</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 24 Apr 2007 01:00:23 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Grant McLean via RT &lt;bug-XML-SAX [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Niko Tyni &lt;ntyni [...] iki.fi&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/312656/142403/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/142403">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, Apr 23, 2007 at 05:42:30PM -0400, Grant McLean via RT wrote:
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; One thing that intrigues me is that the Debian bug you referred to was a
&gt; build failure in the package docbook2x.  That package sepcifies a
&gt; dependency on libxml-sax-expat-perl.  If that package is installed, then
&gt; the XML::SAX::PurePerl module shouldn&#39;t be being used at all.
&gt; 
&gt; I&#39;d recommend only using the PurePerl parser in situations where
&gt; building expat of libxml2 libraries is problematic - that is certainly
&gt; not the case with Debian.  The dependencies do seem to be sane, I just
&gt; don&#39;t understand why the PurePerl module was being used.  Or did the
&gt; dependency get changed to libxml-sax-expat-perl *after* the bug report?
</div>
It looks like docbook2x depends on libxml-sax-perl for building the
package &#40;&#39;Build-Depends&#39;&#41;, and libxml-sax-expat-perl for actually using
it. See

<span class="clickylink"><a target="new" rel="nofollow" href="http://packages.debian.org/unstable/source/docbook2x">http://packages.debian.org/unstable/source/docbook2x</a></span>

&#40;or &#39;apt-cache showsrc docbook2x&#39; if you are on Debian yourself.&#41;

I agree that this is confusing. I&#39;m not very familiar with docbook2x
myself, I just tracked the problem into this decoding difference.
I don&#39;t know why they don&#39;t use libxml-sax-expat-perl for building the
package too. Probably because they assume libxml-sax-perl is simpler
because its name is shorter :&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Notwithstanding my confusion above, I am interested in tracking down and
&gt; fixing bugs in XML::SAX::PurePerl, so thanks again.
</div>
Thank you for maintaining the module!

Cheers,
--
Niko Tyni   ntyni@iki.fi
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-421109" href="/Public/Bug/Display.html?id=26588#txn-421109">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;12&nbsp;14:58:19&nbsp;2008</span>
    <span class="description">ntyni [...] iki.fi -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ntyni [...] iki.fi</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/421109/205729/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/205729">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Apr 23 17:42:13 2007, grant@mclean.net.nz wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; One thing that intrigues me is that the Debian bug you referred to was
&gt; a
&gt; build failure in the package docbook2x.  That package sepcifies a
&gt; dependency on libxml-sax-expat-perl.  If that package is installed,
&gt; then
&gt; the XML::SAX::PurePerl module shouldn&#39;t be being used at all.
&gt; 
&gt; I&#39;d recommend only using the PurePerl parser in situations where
&gt; building expat of libxml2 libraries is problematic - that is certainly
&gt; not the case with Debian.  The dependencies do seem to be sane, I just
&gt; don&#39;t understand why the PurePerl module was being used.  Or did the
&gt; dependency get changed to libxml-sax-expat-perl *after* the bug
&gt; report?
</div>
Sorry it took me so long to get back to this, but the real reason why
the PurePerl parser was used was a bug in the Debian-specific
ParserDetails.ini handling. See <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/430118">http://bugs.debian.org/430118</a></span> .

I have since assumed the maintainership of this module in Debian
&#40;together with others in the Debian Perl Group&#41;, and this should now be
finally fixed so that all other SAX parsers will now override the
PurePerl one.

You can find some more information on how the ParserDetails.ini file is
handled in Debian at eg.

<span class="clickylink"><a target="new" rel="nofollow" href="http://svn.debian.org/wsvn/pkg-perl/trunk/libxml-sax-perl/debian/libxml-sax-perl.README.Debian?op=file&#38;rev=0&#38;sc=0">http://svn.debian.org/wsvn/pkg-perl/trunk/libxml-sax-perl/debian/libxml-sax-perl.README.Debian?op=file&#38;rev=0&#38;sc=0</a></span>

I&#39;d be happy if we could find some way to converge on a common way of
doing this, but obviously backward compatibility is going to hinder this
for both of us. Still, if you&#39;d like to discuss this more &#40;possibly in
another ticket or direct email, preferably via
pkg-perl-maintainers@lists.alioth.debian.org&#41;, I&#39;d be glad to help in
any way I can.

Again, thanks for your work on XML::SAX.

Cheers,
-- 
Niko Tyni
ntyni@debian.org
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-494104" href="/Public/Bug/Display.html?id=26588#txn-494104">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;06&nbsp;06:35:17&nbsp;2008</span>
    <span class="description">grantm [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/494104/244478/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/244478">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 221b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for your patch and detailed analysis &#40;and also for your
patience&#41;.  I have integrated the patch in the recent 0.96 release of
XML::SAX.  Expect further releases as I work my way through the RT queue.

Regards
Grant
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-494107" href="/Public/Bug/Display.html?id=26588#txn-494107">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;06&nbsp;06:35:20&nbsp;2008</span>
    <span class="description">grantm [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.388683</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
