<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #65042 for YAPE-Regex: Compatibility with the upcoming perl 5.14</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #65042 for YAPE-Regex: Compatibility with the upcoming perl 5.14</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/YAPE-Regex/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/YAPE-Regex/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/YAPE-Regex/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/YAPE-Regex/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/YAPE-Regex">YAPE-Regex CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">65042</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/YAPE-Regex/Active/">YAPE-Regex</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
smueller [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-37932-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
3.04    </td>
  </tr>
  <tr id="CF-37933-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
4.00    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;23&nbsp;10:07:11&nbsp;2011</span>
    <span class="description">smueller [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Compatibility with the upcoming perl 5.14</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Jeff,

I know YAPE::Regex is deprecated in favour of Regexp::Parser, but there
is real-world code depending on YAPE::Regex, so it would be great if you
could update it to support Perl 5.14. There are several changes to the
regex engine, but the only one that I know of to break YAPE::Regex big
time is that the default modifiers are now stringified to ^. The
perl5136delta gives this example:

The stringification of regular expressions now uses this
notation.  E.g., before, C&lt;qr/hlagh/i&gt; would be stringified as
C&lt;&#40;?i-xsm:hlagh&#41;&gt;, but now it&#39;s stringified as C&lt;&#40;?^i:hlagh&#41;&gt;.

The main purpose of this is to allow tests that rely on the
stringification to not have to change when new modifiers are added.
See L&lt;perlre/Extended Patterns&gt;.

This means that the ^ will be VERY common even in old code that doesn&#39;t
magically start using new features. This is why I think it would be very
important to support it even in case YAPE::Regex doesn&#39;t support some
other features of, say 5.10, the big regexp overhaul.

I expect the necessary change to be small &#40;for someone who understands
the code base&#41; and to be more of a special case hack than any kind of
big modification. Any chance to get this done before 5.14 is released?
If not, a lot of code using YAPE::Regex to parse regexes will simply not
work on 5.14.

Best regards,
Steffen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;23&nbsp;10:45:12&nbsp;2011</span>
    <span class="description">japhy.734 [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #65042] Compatibility with the upcoming perl 5.14</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 23 Jan 2011 10:45:01 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-YAPE-Regex [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jeffrey Pinyan &lt;japhy.734 [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun, Jan 23, 2011 at 10:07 AM, Steffen Mueller via RT &lt;
bug-YAPE-Regex@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I expect the necessary change to be small &#40;for someone who understands
&gt; the code base&#41; and to be more of a special case hack than any kind of
&gt; big modification. Any chance to get this done before 5.14 is released?
&gt; If not, a lot of code using YAPE::Regex to parse regexes will simply not
&gt; work on 5.14.
&gt;
</div>
Do you know when that is expected to be?

I haven&#39;t had a lot of time for serious Perl module development in a few
years, but I&#39;ll see what I can do to get YAPE::Regex up to code.

-- 
Jeffrey Pinyan &#40;*@PrayingTheMass* &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://twitter.com/PrayingTheMass/">http://twitter.com/PrayingTheMass/</a></span>&gt; on
Twitter&#41;
Author of *Praying the Mass &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.PrayingTheMass.com/">http://www.PrayingTheMass.com/</a></span>&gt;*, a series of
books on the new English translation of the Mass
Blogger at *The Cross Reference*
&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://thecrossreference.blogspot.com/">http://thecrossreference.blogspot.com/</a></span>&gt;&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://thecrossreference.blogspot.com">http://thecrossreference.blogspot.com</a></span>&gt;

[Mary said,] &#34;Do whatever he tells you.&#34; ~ John 2:5
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;23&nbsp;10:45:16&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;23&nbsp;12:27:08&nbsp;2011</span>
    <span class="description">smueller [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #65042] Compatibility with the upcoming perl 5.14</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 23 Jan 2011 18:26:54 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-YAPE-Regex [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Steffen Mueller &lt;smueller [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Jeff,

On 01/23/2011 04:45 PM, japhy.734@gmail.com via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=65042">https://rt.cpan.org/Ticket/Display.html?id=65042</a></span>&gt;
&gt;
&gt; On Sun, Jan 23, 2011 at 10:07 AM, Steffen Mueller via RT&lt;
&gt; bug-YAPE-Regex@rt.cpan.org&gt;  wrote:
&gt;
<div class="message-stanza open">&gt;&gt; I expect the necessary change to be small &#40;for someone who understands
&gt;&gt; the code base&#41; and to be more of a special case hack than any kind of
&gt;&gt; big modification. Any chance to get this done before 5.14 is released?
&gt;&gt; If not, a lot of code using YAPE::Regex to parse regexes will simply not
&gt;&gt; work on 5.14.
&gt;&gt;
</div>&gt;
&gt; Do you know when that is expected to be?
</div>
April 2011.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I haven&#39;t had a lot of time for serious Perl module development in a few
&gt; years, but I&#39;ll see what I can do to get YAPE::Regex up to code.
</div>
I know you&#39;ve been busy. All the more, I appreciate your looking into 
this in due time.

Best regards,
Steffen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;25&nbsp;15:53:28&nbsp;2011</span>
    <span class="description">gsullivan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I believe I may have a solution, although I can&#39;t prove it yet because
I do not have access to perl version 5.13.6 &#40;or later&#41;.  However, if I
upload this fix to CPAN, the CPAN testers can prove if my fix works.

The approach is to make the qr stringification introduced in 5.14
look like the old qr stringification.  In the Regex.pm &#34;new&#34; sub,
I check the stringified regex for the new &#34;&#40;?^:&#34; syntax.
If present, I would replace it with the old syntax.  For example,
&#40;?^i:foo&#41; would be replaced with &#40;?i-xsm:foo&#41;.

This should work with perl versions before and after 5.13.6.

I have tested this change locally on perl 5.12.2, and it does not break
the existing YAPE::Regex test.

Please let me know if I have grossly overlooked something.

My patch is probably not very elegant.  If you can think of a way to
improve it, please let me know.

Gene
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> diff-u.txt</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- Regex.pm.orig	2011-01-25 15:25:58.000000000 -0500
+++ Regex.pm	2011-01-25 15:23:52.000000000 -0500
@@ -7,7 +7,7 @@
 use vars &#39;$VERSION&#39;;
 
 
-$VERSION = &#39;3.04&#39;;
+$VERSION = &#39;4.00&#39;;
 
 
 my $valid_POSIX = qr{
@@ -97,6 +97,23 @@
 
   $regex = &#34;&#40;?-imsx:$regex&#41;&#34; if $@;
 
+  # Make the qr stringification introduced in 5.14 look like the old
+  # qr stringification.
+  if &#40;$regex =~ / ^ \&#40; \? \^ &#40;[imsx]+&#41; &#40;: .*&#41; $ /x&#41; {
+    my $switches = $1;
+    my $rest     = $2;
+    my $inverted = invert&#40;$switches&#41;;
+    if &#40;length $inverted&#41; {
+      $regex = &#34;&#40;?$switches-$inverted$rest&#34;;
+    }
+    else {
+      $regex = &#34;&#40;?imsx$rest&#34;;
+    }
+  }
+  elsif &#40;$regex =~ / ^ \&#40; \? \^ : /x&#41; {
+    $regex =~ s/\^/-imsx/;
+  }
+
   my $self = bless {
     TREE =&gt; [],
     TREE_STACK =&gt; [],
@@ -110,6 +127,16 @@
 }
 
 
+sub invert {
+    # Given an input string which looks like modifiers &#40;ismx&#41;,
+    # return the inverse string.
+    # For example, if the input is &#39;ix&#39;, return &#39;ms&#39;.
+    my %mods = map { $_ =&gt; 1 } qw&#40;i m s x&#41;;
+    delete $mods{$_} for &#40;split //, shift&#41;;
+    return join &#39;&#39;, keys %mods;
+}
+
+
 sub state { $_[0]{STATE} }
 sub error { $_[0]{ERROR} }
 sub depth { $_[0]{DEPTH} }
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;05&nbsp;10:34:45&nbsp;2011</span>
    <span class="description">gsullivan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have applied my patch and released a new version of YAPE-Regex 
&#40;4.00&#41;.  The new CPAN Tester results look better now.  There are no 
more error messages in the test reports for post-5.13.6 versions of 
perl.  So far, it has been tested on 5.13.8 and 5.13.9.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;05&nbsp;10:34:46&nbsp;2011</span>
    <span class="description">gsullivan [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;05&nbsp;10:36:18&nbsp;2011</span>
    <span class="description">gsullivan [...] cpan.org -  Fixed in 4.00 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
