<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #58089 for GSSAPI: GSSAPI samples generate either warnings or failures on exit</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #58089 for GSSAPI: GSSAPI samples generate either warnings or failures on exit</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/GSSAPI/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/GSSAPI/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/GSSAPI/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/GSSAPI/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/GSSAPI">GSSAPI CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">58089</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/GSSAPI/Active/">GSSAPI</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
w.phillip.moore@gmail.com
(no email address)

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-15108-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.27    </td>
  </tr>
  <tr id="CF-15109-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;03&nbsp;08:38:00&nbsp;2010</span>
    <span class="description">w.phillip.moore [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> GSSAPI samples generate either warnings or failures on exit</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have just installed GSSAPI-0.27, using perl5.10.1, on several different systems, and 
discovered a problem common to all of them.  On two different Linux systems &#40;CentOS 5.4 
and Debian 5.0&#41;, using the latest libgssapi_krb5 available on both, glibc generates a 
backtrace upon exit when gss-client.pl is run, but only when authentication has been 
successful.  On FreeBSD, which includes Heimdal instead of MIT, a similar error occurs, but 
there is no backtrace generated.

The errors remind me of similar issues I had when working on the MQSeries module I 
developed in the late 1990s: XS reference count leaks.   Here&#39;s the error you get on FreeBSD, 
for example:

[root@rpefst07 /var/tmp/GSSAPI-0.27/examples]# perl ./gss-client.pl -port 12345 -
hostname rpefst07.test.efs -prodid host -mutual
./gss-client.pl: using [host@…:12345]
CLIENT::principal [host@…] means going to communicate with server name [host@…]
SERVER::accepted connection from client ...
CLIENT::gss_init_sec_context success
CLIENT::going to identify client to server
CLIENT::have token to send ...
CLIENT::GSS token length is 583
SERVER::received token &#40;length is 583&#41;:
CLIENT::sent token to server
SERVER::authenticated client name is efsops@…
SERVER::Have mutual token to send ...
SERVER::GSS token size: 161
SERVER::sent token &#40;length is 161&#41;
SERVER::waiting for request ...
CLIENT::Mutual auth requested ...
CLIENT::got mutual auth token from server
CLIENT::mutual auth token length is 161
CLIENT::gss_init_sec_context success
CLIENT::confirmed server identity from mutual token
CLIENT::authenticated server name is host@…
Argument &#34;&#34; isn&#39;t numeric in null operation at ./gss-client.pl line 153.
&#40;in cleanup&#41; oid has no value at ./gss-client.pl line 153.

Line 153 is &#34;exit 0&#34;, of course.  This only occurs upon exit.  On FreeBSD&lt; this is just an 
annoying warning, since the code still exits 0.

However, on both CentOS and Debian, the script fails and generate the following backtrace:

rpefst03:/var/tmp/GSSAPI-0.27/examples# perl ./gss-client.pl -port 12345 -hostname 
rpefst03.test.efs -prodid host
./gss-client.pl: using [host@…:12345]
CLIENT::principal [host@…] means going to communicate with server name [host@…]
SERVER::accepted connection from client ...
CLIENT::gss_init_sec_context success
CLIENT::going to identify client to server
CLIENT::have token to send ...
CLIENT::GSS token length is 526
SERVER::received token &#40;length is 526&#41;:
CLIENT::sent token to server
*** glibc detected *** perl: munmap_chunk&#40;&#41;: invalid pointer: 0x00007f0e4a2ee798 ***
======= Backtrace: =========
/lib/libc.so.6[0x7f0e4ab8c928]
/usr/lib/libgssapi_krb5.so.2[0x7f0e4a2d8689]
/usr/efs/lib/perl5/site_perl/5.10.1/x86_64-linux-thread-
multi/auto/GSSAPI/GSSAPI.so&#40;XS_GSSAPIOID_DESTROY+0x158&#41;[0x7f0e4a5078d8]
perl&#40;Perl_pp_entersub+0x594&#41;[0x4942d4]
perl&#40;Perl_call_sv+0x64e&#41;[0x43638e]
perl&#40;Perl_sv_clear+0x157&#41;[0x4a7017]
perl&#40;Perl_sv_free2+0x52&#41;[0x4a77b2]
perl&#40;Perl_leave_scope+0xd9a&#41;[0x4c4f2a]
perl&#40;Perl_pp_leave+0x106&#41;[0x494936]
perl&#40;Perl_runops_standard+0x12&#41;[0x492782]
perl&#40;perl_run+0x30f&#41;[0x436cdf]
perl&#40;main+0xd4&#41;[0x4217e4]
/lib/libc.so.6&#40;libc_start_main+0xe6&#41;[0x7f0e4ab371a6]
perl&#40;sin+0xc1&#41;[0x421649]
======= Memory map: ========
00400000-00557000 r-xp 00000000 08:01 304271 /usr/efs-2010-06-01/bin/perl
00756000-0075a000 rw-p 00156000 08:01 304271 /usr/efs-2010-06-01/bin/perl
0075a000-00a30000 rw-p 0075a000 00:00 0 [heap]
7f0e48db4000-7f0e48dca000 r-xp 00000000 08:01 466035 /lib/libgcc_s.so.1
7f0e48dca000-7f0e48fca000 ---p 00016000 08:01 466035 /lib/libgcc_s.so.1
7f0e48fca000-7f0e48fcb000 rw-p 00016000 08:01 466035 /lib/libgcc_s.so.1
7f0e48fcb000-7f0e48fcf000 r-xp 00000000 08:01 466383 /lib/libnss_dns-2.7.so
7f0e48fcf000-7f0e491ce000 ---p 00004000 08:01 466383 /lib/libnss_dns-2.7.so
7f0e491ce000-7f0e491d0000 rw-p 00003000 08:01 466383 /lib/libnss_dns-2.7.so
7f0e491d0000-7f0e491da000 r-xp 00000000 08:01 466364 /lib/libnss_files-2.7.so
7f0e491da000-7f0e493da000 ---p 0000a000 08:01 466364 /lib/libnss_files-2.7.so
7f0e493da000-7f0e493dc000 rw-p 0000a000 08:01 466364 /lib/libnss_files-2.7.so
7f0e493dc000-7f0e493df000 r-xp 00000000 08:01 368524 /usr/efs-2010-06-
01/lib/perl5/5.10.1/x86_64-linux-thread-multi/auto/MIME/Base64/Base64.so
7f0e493df000-7f0e495de000 ---p 00003000 08:01 368524 /usr/efs-2010-06-
01/lib/perl5/5.10.1/x86_64-linux-thread-multi/auto/MIME/Base64/Base64.so
7f0e495de000-7f0e495df000 rw-p 00002000 08:01 368524 /usr/efs-2010-06-
01/lib/perl5/5.10.1/x86_64-linux-thread-multi/auto/MIME/Base64/Base64.so
7f0e495df000-7f0e495ef000 r-xp 00000000 08:01 466382 /lib/libresolv-2.7.so
7f0e495ef000-7f0e497ef000 ---p 00010000 08:01 466382 /lib/libresolv-2.7.so
7f0e497ef000-7f0e497f1000 rw-p 00010000 08:01 466382 /lib/libresolv-2.7.so
7f0e497f1000-7f0e497f3000 rw-p 7f0e497f1000 00:00 0 
7f0e497f3000-7f0e497f5000 r-xp 00000000 08:01 466034 /lib/libkeyutils-1.2.so
7f0e497f5000-7f0e499f4000 ---p 00002000 08:01 466034 /lib/libkeyutils-1.2.so
7f0e499f4000-7f0e499f5000 rw-p 00001000 08:01 466034 /lib/libkeyutils-1.2.so
7f0e499f5000-7f0e499fc000 r-xp 00000000 08:01 279311 /usr/lib/libkrb5support.so.0.1
7f0e499fc000-7f0e49bfc000 ---p 00007000 08:01 279311 /usr/lib/libkrb5support.so.0.1
7f0e49bfc000-7f0e49bfd000 rw-p 00007000 08:01 279311 /usr/lib/libkrb5support.so.0.1
7f0e49bfd000-7f0e49c00000 r-xp 00000000 08:01 466085 /lib/libcom_err.so.2.1
7f0e49c00000-7f0e49dff000 ---p 00003000 08:01 466085 /lib/libcom_err.so.2.1
7f0e49dff000-7f0e49e00000 rw-p 00002000 08:01 466085 /lib/libcom_err.so.2.1
7f0e49e00000-7f0e49e24000 r-xp 00000000 08:01 279312 /usr/lib/libk5crypto.so.3.1
7f0e49e24000-7f0e4a024000 ---p 00024000 08:01 279312 /usr/lib/libk5crypto.so.3.1
7f0e4a024000-7f0e4a026000 rw-p 00024000 08:01 279312 /usr/lib/libk5crypto.so.3.1
7f0e4a026000-7f0e4a0c3000 r-xp 00000000 08:01 279309 /usr/lib/libkrb5.so.3.3
7f0e4a0c3000-7f0e4a2c3000 ---p 0009d000 08:01 279309 /usr/lib/libkrb5.so.3.3
7f0e4a2c3000-7f0e4a2c7000 rw-p 0009d000 08:01 279309 /usr/lib/libkrb5.so.3.3
7f0e4a2c7000-7f0e4a2f2000 r-xp 00000000 08:01 279308 /usr/lib/libgssapi_krb5.so.2.2
7f0e4a2f2000-7f0e4a4f1000 ---p 0002b000 08:01 279308 /usr/lib/libgssapi_krb5.so.2.2
7f0e4a4f1000-7f0e4a4f3000 rw-p 0002a000 08:01 279308 /usr/lib/libgssapi_krb5.so.2.2
7f0e4a4f3000-7f0e4a50e000 r-xp 00000000 08:01 354228 /usr/efs-2010-06-
01/lib/perl5/site_perl/5.10.1/x86_64-linux-thread-multi/auto/GSSAPI/GSSAPI.so
7f0e4a50e000-7f0e4a70d000 ---p 0001b000 08:01 354228 /usr/efs-2010-06-
01/lib/perl5/site_perl/5.10.1/x86_64-linux-thread-multi/auto/GSSAPI/GSSAPI.so
7f0e4a70d000-7f0e4a70e000 rw-p 0001a000 08:01 354228 /usr/efs-2010-06-
01/lib/perl5/site_perl/5.10.1/x86_64-linux-thread-multi/auto/GSSAPI/GSSAPI.so
7f0e4a70e000-7f0e4a713000 r-xp 00000000 08:01 368478 /usr/efs-2010-06-
01/lib/perl5/5.10.1/x86_64-linux-thread-multi/auto/Socket/Socket.so
7f0e4a713000-7f0e4a912000 ---p 00005000 08:01 368478 /usr/efs-2010-06-
01/lib/perl5/5.10.1/x86_64-linux-thread-multi/auto/Socket/Socket.so
7f0e4a912000-7f0e4a914000 rw-p 00004000 08:01 368478 /usr/efs-2010-06-
01/lib/perl5/5.10.1/x86_64-linux-thread-multi/auto/Socket/Socket.so
7f0e4a914000-7f0e4a919000 r-xp 00000000 08:01 368383 /usr/efs-2010-06-
01/lib/perl5/5.10.1/x86_64-linux-thread-multi/auto/IO/IO.so
7f0e4a919000-7f0e4ab18000 ---p 00005000 08:01 368383 /usr/efs-2010-06-
01/lib/perl5/5.10.1/x86_64-linux-thread-multi/auto/IO/IO.so
7f0e4ab18000-7f0e4ab19000 rw-p 00004000 08:01 368383 /usr/efs-2010-06-
01/lib/perl5/5.10.1/x86_64-linux-thread-multi/auto/IO/IO.so
7f0e4ab19000-7f0e4ac63000 r-xp 00000000 08:01 466381 /lib/libc-2.7.so
7f0e4ac63000-7f0e4ae62000 ---p 0014a000 08:01 466381 /lib/libc-2.7.so
7f0e4ae62000-7f0e4ae65000 r--p 00149000 08:01 466381 /lib/libc-2.7.so
7f0e4ae65000-7f0e4ae67000 rw-p 0014c000 08:01 466381 /lib/libc-2.7.so
7f0e4ae67000-7f0e4ae6c000 rw-p 7f0e4ae67000 00:00 0 
7f0e4ae6c000-7f0e4ae82000 r-xp 00000000 08:01 466384 /lib/libpthread-2.7.so
7f0e4ae82000-7f0e4b082000 ---p 00016000 08:01 466384 /lib/libpthread-2.7.so
7f0e4b082000-7f0e4b084000 rw-p 00016000 08:01 466384 /lib/libpthread-2.7.so
7f0e4b084000-7f0e4b088000 rw-p 7f0e4b084000 00:00 0 
7f0e4b088000-7f0e4b08a000 r-xp 00000000 08:01 466367 /lib/libutil-2.7.so
7f0e4b08a000-7f0e4b289000 ---p 00002000 08:01 466367 /lib/libutil-2.7.so
7f0e4b289000-7f0e4b28b000 rw-p 00001000 08:01 466367 /lib/libutil-2.7.so
7f0e4b28b000-7f0e4b293000 r-xp 00000000 08:01 466378 /lib/libcrypt-2.7.so
7f0e4b293000-7f0e4b493000 ---p 00008000 08:01 466378 /lib/libcrypt-2.7.so
7f0e4b493000-7f0e4b495000 rw-p 00008000 08:01 466378 /lib/libcrypt-2.7.so
7f0e4b495000-7f0e4b4c3000 rw-p 7f0e4b495000 00:00 0 
7f0e4b4c3000-7f0e4b545000 r-xp 00000000 08:01 466386 /lib/libm-2.7.so
7f0e4b545000-7f0e4b744000 ---p 00082000 08:01 466386 /lib/libm-2.7.so
7f0e4b744000-7f0e4b746000 rw-p 00081000 08:01 466386 /lib/libm-2.7.so
7f0e4b746000-7f0e4b748000 r-xp 00000000 08:01 466370 /lib/libdl-2.7.so
7f0e4b748000-7f0e4b948000 ---p 00002000 08:01 466370 /lib/libdl-2.7.so
7f0e4b948000-7f0e4b94a000 rw-p 00002000 08:01 466370 /lib/libdl-2.7.so
7f0e4b94a000-7f0e4b95f000 r-xp 00000000 08:01 466379 /lib/libnsl-2.7.so
7f0e4b95f000-7f0e4bb5e000 ---p 00015000 08:01 466379 /lib/libnsl-2.7.so
7f0e4bb5e000-7f0e4bb60000 rw-p 00014000 08:01 466379 /lib/libnsl-2.7.so
7f0e4bb60000-7f0e4bb62000 rw-p 7f0e4bb60000 00:00 0 
7f0e4bb62000-7f0e4bb7e000 r-xp 00000000 08:01 466372 /lib/ld-2.7.so
7f0e4bc38000-7f0e4bd72000 r--p 00000000 08:01 295075 /usr/lib/locale/locale-archive
7f0e4bd72000-7f0e4bd76000 rw-p 7f0e4bd72000 00:00 0 
7f0e4bd7a000-7f0e4bd7d000 rw-p 7f0e4bd7a000 00:00 0 
7f0e4bd7d000-7f0e4bd7f000 rw-p 0001b000 08:01 466372 /lib/ld-2.7.so
7ffffffe9000-7fffffffe000 rw-p 7ffffffea000 00:00 0 [stack]
7fffffffe000-7ffffffff000 r-xp 7fffffffe000 00:00 0 [vdso]
ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0 [vsyscall]
Aborted

When authentication is not successful, say after running kdestroy to purge the client&#39;s 
credentials cache, then the script generates a warning as well:

[root@rpefst01 examples]# perl ./gss-client.pl -port 12345 -hostname rpefst01.test.efs -
prodid host -mutual
./gss-client.pl: using [host@…:12345]
CLIENT::principal [host@…] means going to communicate with server name [host@…]
SERVER::accepted connection from client ...
CLIENT::Unable to initialize security context:
MAJOR::Unspecified GSS failure. Minor code may provide more information
MINOR::Unknown code krb5 195
&#40;in cleanup&#41; oid has no value at ./gss-client.pl line 171.
Use of uninitialized value in subroutine entry at ./gss-server.pl line 78.
SERVER::received token &#40;length is 0&#41;:
SERVER::waiting for request ...
Argument &#34;&#34; isn&#39;t numeric in null operation at ./gss-client.pl line 171.

I am not new to Kerberos or XS programming, but I am new to GSSAPI.  I fought numerous 
similar errors in the development of the MQSeries CPAN module, and they were all subtle 
issues about managing the reference counts of SVs and IVs and other perl data structures 
created in the XS code.   

I have not included the specific krb5 library versions here, since the same error occurs on 
numerous platforms, and I think we can safely assume the error is in the GSSAPI XS code.  
Somewhere.... Just have to find it now.  

I&#39;ll be spending time investigation this today, and will follow up with additional information 
as I have it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;03&nbsp;09:03:51&nbsp;2010</span>
    <span class="description">w.phillip.moore [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">FWIW, I&#39;ve just verified that the problem is reproducible, at least on CentOS, for every GSSAPI 
release from 0.22 through 0.27 &#40;all the ones available in the author&#39;s download directory&#41;.

Investigation continues....  Next, I&#39;ll be compiling debug versions of perl5.10.1 and GSSAPI, and 
see what new information I can glean.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;03&nbsp;09:03:52&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;03&nbsp;09:48:14&nbsp;2010</span>
    <span class="description">achim [...] grolmsnet.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #58089] GSSAPI samples generate either warnings or failures on exit</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 3 Jun 2010 15:47:58 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-GSSAPI [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Achim Grolms &lt;achim [...] grolmsnet.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thursday 03 June 2010, Phillip Moore via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; FWIW, I&#39;ve just verified that the problem is reproducible, at least on
&gt; CentOS, for every GSSAPI release from 0.22 through 0.27 &#40;all the ones
&gt; available in the author&#39;s download directory&#41;.
</div>
Hi Phillip,

thank you very much for investigating!

If you need older Versions of code:

You can access older releases by SVN at
&lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://perlgssapi.svn.sourceforge.net/svnroot/perlgssapi/GSSAPI/releases">https://perlgssapi.svn.sourceforge.net/svnroot/perlgssapi/GSSAPI/releases</a></span>&gt;


More older Versions are available at
&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~pguen/">http://search.cpan.org/~pguen/</a></span>&gt;



Or the complete set Versions in Backpan:


to 0.13 at
&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://backpan.perl.org/authors/id/P/PG/PGUEN/">http://backpan.perl.org/authors/id/P/PG/PGUEN/</a></span>&gt;

0.14 until now at
&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://backpan.perl.org/authors/id/A/AG/AGROLMS/">http://backpan.perl.org/authors/id/A/AG/AGROLMS/</a></span>&gt;

Thank you very much for your work!

Best Regards,
Achim
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;03&nbsp;10:00:34&nbsp;2010</span>
    <span class="description">w.phillip.moore [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">You&#39;re more than welcome.  

However, I really don&#39;t want to keep going back in time, if at all possible.   Are you able to 
run the gss-server.pl and gss-client.pl examples without errors on any platform right now?   
If so, perhaps comparing the versions of kerberos, perl, etc between a working and non-
working environment will provide some useful clues.

I&#39;ve just verified that the problems happens both for threaded and non-threaded perl, and I 
have a debugging perl to work with as well.   Sadly, the last time I tried to figure out how to 
step through XS code inside gdb, I was never able to figure it out &#40;this was 10 years ago, 
when working on the MQSeries code&#41;.

This is a critical issue to me: we need to add Kerberos support to our application, and I really 
would prefer to use the GSSAPI, so getting this working is very important to me.  Any 
additional clues of suggestions for where to investigate next would be very welcome.

On Thu Jun 03 09:48:14 2010, achim@grolmsnet.de wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thursday 03 June 2010, Phillip Moore via RT wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; FWIW, I&#39;ve just verified that the problem is reproducible, at least on
&gt; &gt; CentOS, for every GSSAPI release from 0.22 through 0.27 &#40;all the ones
&gt; &gt; available in the author&#39;s download directory&#41;.
</div>&gt; 
&gt; Hi Phillip,
&gt; 
&gt; thank you very much for investigating!
&gt; 
&gt; If you need older Versions of code:
&gt; 
&gt; You can access older releases by SVN at
&gt; &lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://perlgssapi.svn.sourceforge.net/svnroot/perlgssapi/GSSAPI/releases">https://perlgssapi.svn.sourceforge.net/svnroot/perlgssapi/GSSAPI/releases</a></span>&gt;
&gt; 
&gt; 
&gt; More older Versions are available at
&gt; &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~pguen/">http://search.cpan.org/~pguen/</a></span>&gt;
&gt; 
&gt; 
&gt; 
&gt; Or the complete set Versions in Backpan:
&gt; 
&gt; 
&gt; to 0.13 at
&gt; &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://backpan.perl.org/authors/id/P/PG/PGUEN/">http://backpan.perl.org/authors/id/P/PG/PGUEN/</a></span>&gt;
&gt; 
&gt; 0.14 until now at
&gt; &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://backpan.perl.org/authors/id/A/AG/AGROLMS/">http://backpan.perl.org/authors/id/A/AG/AGROLMS/</a></span>&gt;
&gt; 
&gt; Thank you very much for your work!
&gt; 
&gt; Best Regards,
&gt; Achim
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;03&nbsp;10:37:40&nbsp;2010</span>
    <span class="description">achim [...] grolmsnet.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> bug-GSSAPI [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #58089] GSSAPI samples generate either warnings or failures on exit</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 3 Jun 2010 16:37:28 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> w.phillip.moore [...] gmail.com</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Achim Grolms &lt;achim [...] grolmsnet.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thursday 03 June 2010, Phillip Moore via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: GSSAPI
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=58089">https://rt.cpan.org/Ticket/Display.html?id=58089</a></span> &gt;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Are you able to run the gss-server.pl and gss-client.pl
&gt; examples without errors on any platform right now? 
</div>
Hi Phillip,

1. I&#39;ve never used gss-client.pl and gss-server.pl by myself,
and currently I have no access to my Test-environment with the KDC and  
keytabs required. &#40;I will setup one for this test, but at the moment I have 
no access&#41;.

2. gss-client.pl makes use of display&#40;&#41; method, and GSSAPI 0.28 includes some
   fixes related to the buffers used by display&#40;&#41;.

Can you please give the SVN version at 
<span class="clickylink"><a target="new" rel="nofollow" href="https://perlgssapi.svn.sourceforge.net/svnroot/perlgssapi/GSSAPI/trunk/GSSAPI">https://perlgssapi.svn.sourceforge.net/svnroot/perlgssapi/GSSAPI/trunk/GSSAPI</a></span>
a try if this version shows the same results?

3. gss-client.pl makes use of the GSSAPI calls &#39;display&#40;&#41;&#39; and &#39;init&#40;&#41;&#39;.

Can you do a quick &#34;debug&#34; of your gss-client.pl and uncomment the calls to
&#39;display&#40;&#41;&#39; &#40;Line 117-119&#41; 
to check if the problems result by the use of &#39;display&#40;&#41;&#39;?

4. Does your test fail when not running with &#39;-mutual&#39; flag?


Best Regards,
Achim
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;03&nbsp;11:29:51&nbsp;2010</span>
    <span class="description">w.phillip.moore@gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> bug-GSSAPI [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #58089] GSSAPI samples generate either warnings or  failures on exit</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 3 Jun 2010 11:29:36 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> achim [...] grolmsnet.de</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Phillip Moore &lt;w.phillip.moore [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Is there a packaged tarball of 0.28 available?  That URL leads me to the
indiviudual files, which are tedious to download, and highly error-prone.

I just verified that after commenting all of the calls to -&gt;display, the
same error occurs.

I get this with and without the -mutual call.

On Thu, Jun 3, 2010 at 10:37 AM, Achim Grolms &lt;achim@grolmsnet.de&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thursday 03 June 2010, Phillip Moore via RT wrote:
<div class="message-stanza open">&gt; &gt;        Queue: GSSAPI
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=58089">https://rt.cpan.org/Ticket/Display.html?id=58089</a></span> &gt;
</div>&gt;
<div class="message-stanza open">&gt; &gt; Are you able to run the gss-server.pl and gss-client.pl
&gt; &gt; examples without errors on any platform right now?
</div>&gt;
&gt; Hi Phillip,
&gt;
&gt; 1. I&#39;ve never used gss-client.pl and gss-server.pl by myself,
&gt; and currently I have no access to my Test-environment with the KDC and
&gt; keytabs required. &#40;I will setup one for this test, but at the moment I have
&gt; no access&#41;.
&gt;
&gt; 2. gss-client.pl makes use of display&#40;&#41; method, and GSSAPI 0.28 includes
&gt; some
&gt;   fixes related to the buffers used by display&#40;&#41;.
&gt;
&gt; Can you please give the SVN version at
&gt;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://perlgssapi.svn.sourceforge.net/svnroot/perlgssapi/GSSAPI/trunk/GSSAPI">https://perlgssapi.svn.sourceforge.net/svnroot/perlgssapi/GSSAPI/trunk/GSSAPI</a></span>
&gt; a try if this version shows the same results?
&gt;
&gt; 3. gss-client.pl makes use of the GSSAPI calls &#39;display&#40;&#41;&#39; and &#39;init&#40;&#41;&#39;.
&gt;
&gt; Can you do a quick &#34;debug&#34; of your gss-client.pl and uncomment the calls
&gt; to
&gt; &#39;display&#40;&#41;&#39; &#40;Line 117-119&#41;
&gt; to check if the problems result by the use of &#39;display&#40;&#41;&#39;?
&gt;
&gt; 4. Does your test fail when not running with &#39;-mutual&#39; flag?
&gt;
&gt;
&gt; Best Regards,
&gt; Achim
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;03&nbsp;17:10:18&nbsp;2010</span>
    <span class="description">w.phillip.moore [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">First of all, thanks to Achim for working with me remotely to figure this out.

We have agreed that there is a reference count leak of some kind in the XS code.  Finding it 
won&#39;t be fun.  However, the attached patch worksaround the issue seen in the examples, and 
also sets default CLI arguments for both so that they can be run more easily:

./gss-server.pl &#38;
./gss-client.pl -mutual

IOW, all of the arguments are optional now.

Thanks again for the module, and the help.   I expect to use this code to secure some critical 
infrastructure now.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> GSSAPI-0.27.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -r -u GSSAPI-0.27/examples/gss-client.pl GSSAPI-0.27-patched/examples/gss-client.pl
--- GSSAPI-0.27/examples/gss-client.pl	2008-02-02 08:36:21.000000000 -0500
+++ GSSAPI-0.27-patched/examples/gss-client.pl	2010-06-03 17:05:13.000000000 -0400
@@ -6,37 +6,23 @@
 use Getopt::Long;
 
 use IO::Socket::INET;
-
+use Sys::Hostname;
 use GSSAPI;
 use MIME::Base64;
 
-my %opt;
-
-unless&#40;GetOptions&#40;\%opt, qw&#40;prodid=s hostname=s port=s mutual&#41;&#41;&#41; {
-  print &#34;$0 needs arguments, provide at least -prodid and -hostname, optionally -port &#40;defauly 10000&#41; or -mutual &#40;for two sided authentication&#41;\n&#34;;
-  exit&#40;1&#41;;
-}
+my %opt = &#40;
+    prodid   =&gt; &#39;host&#39;,
+    port     =&gt; 10000,
+    hostname =&gt; hostname&#40;&#41;,
+&#41;;
 
-if&#40;! $opt{hostname}&#41; {
-  die &#34;$0: must specify -hostname\n&#34;;
-}
+GetOptions&#40;\%opt, qw&#40;prodid=s hostname=s port=s mutual&#41;&#41; or
+    die &#34;Usage: $0 [ --hostname &#39;hostname&#39; ] [ --prodid &#39;prodid&#39; ] [ --port &#39;port&#39; ] [ -mutual ]\n&#34;;
 
-if&#40;! $opt{prodid}&#41; {
-  die &#34;$0: must specify -prodid\n&#34;;
-}
-
-if&#40;! $opt{port}&#41; {
-  warn &#34;$0: -port not specified, defaulting to 10000\n&#34;;
-  $opt{port} = 10000;
-}
-
-if&#40;! $opt{prodid}&#41; {
-  $opt{prodid} = &#34;host&#34;;
-}
+my $authtype = $opt{mutual} ? &#39;mutual&#39; : &#39;one-way&#39;;
 
 warn &#34;$0: using [$opt{prodid}\@$opt{hostname}:$opt{port}]\n&#34;;
 
-
 #
 # GSSAPI::Name-&gt;import produces $gss_server_name
 # which is then passed in to GSSAPI::Context::init
@@ -48,7 +34,7 @@
 my $status = GSSAPI::Name-&gt;import&#40;my $gss_server_name, $server_name, gss_nt_service_name&#41;;
 $status || gss_exit&#40;&#34;CLIENT::Unable to import server name: $server_name&#34;, $status&#41;;
 
-$status = $gss_server_name-&gt;display&#40;my $display_name, my $type&#41;;
+$status = $gss_server_name-&gt;display&#40;my $display_name&#41;;
 print &#34;CLIENT::principal [$server_name] means going to communicate with server name [$display_name]\n&#34;;
 
 my $gss_input_token = q{};
@@ -93,7 +79,7 @@
 				    0,                         # input time
 				    GSS_C_NO_CHANNEL_BINDINGS, # no channel binding
 				    $gss_input_token,          # input token
-				    my $out_mech,
+				    undef,
 				    my $gss_output_token,
 				    my $out_flags,
 				    my $out_time&#41;;
diff -r -u GSSAPI-0.27/examples/gss-server.pl GSSAPI-0.27-patched/examples/gss-server.pl
--- GSSAPI-0.27/examples/gss-server.pl	2008-02-02 08:36:21.000000000 -0500
+++ GSSAPI-0.27-patched/examples/gss-server.pl	2010-06-03 17:05:50.000000000 -0400
@@ -12,7 +12,11 @@
 use MIME::Base64;
 
 
-my %opt;
+my %opt = &#40;
+    keytabfile =&gt; &#39;/etc/krb5.keytab&#39;,
+    port       =&gt; 10000,
+    hostname   =&gt; hostname&#40;&#41;,
+&#41;;
 
 #
 # Arguments:
@@ -25,16 +29,8 @@
     exit&#40;1&#41;;
 }
 
-if&#40;! $opt{port}&#41; {
-    warn &#34;$0: -port not specified, defaulting to 10000\n&#34;;
-    $opt{port} = 10000;
-}
-
-if&#40;! $opt{hostname}&#41; {
-    $opt{hostname} = hostname&#40;&#41;;
-    warn &#34;$0: -name not specified, using hostname result [&#34; . $opt{hostname} . &#34;]\n&#34;;
-}
 warn &#34;$0: using [&#34; . $opt{hostname} .&#39;:&#39; .$opt{port} . &#34;]\n&#34;;
+
 #
 # Servers need keytab files, the only standard so far is /etc/krb5.keytab.
 # That&#39;s the file meant to contain keys for the local machine. It is readable
</div></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
