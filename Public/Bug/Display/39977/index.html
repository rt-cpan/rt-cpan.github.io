<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #39977 for XML-Twig: XML::Twig::Elt-&gt;set_atts&#40;&#41; destroys any existing attributes; set_att&#40;&#41; fails silently on hashref</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #39977 for XML-Twig: XML::Twig::Elt-&gt;set_atts&#40;&#41; destroys any existing attributes; set_att&#40;&#41; fails silently on hashref</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=XML-Twig">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=XML-Twig">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=XML-Twig">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=XML-Twig">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/XML-Twig">XML-Twig CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">39977</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=XML-Twig">XML-Twig</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
AZED [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-37682-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
3.32    </td>
  </tr>
  <tr id="CF-37683-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




test_set_atts.t<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/518569/258816/test_set_atts.t">
Sat Oct 11 19:56:02 2008 (1.3k) by AZED [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=39977">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-518569" href="/Public/Bug/Display.html?id=39977#txn-518569">#</a>      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;11&nbsp;19:56:02&nbsp;2008</span>
    <span class="description">AZED [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> XML::Twig::Elt-&gt;set_atts&#40;&#41; destroys any existing attributes;
 set_att&#40;&#41; fails silently on hashref</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/518569/258813/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/258813">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From the documentation, one would think that the only difference between
set_att&#40;&#41; and set_atts&#40;&#41; is that the latter accepts hash references and
the former doesn&#39;t &#40;and in fact, you&#39;d think that set_atts&#40;&#41; wouldn&#39;t
accept a list, even though it does&#41;.  I saw no indication of any time
one might want to use set_att&#40;&#41; instead of set_atts&#40;&#41;...  but a subtle
difference just bit me: set_atts&#40;&#41; apparently destroys all existing
attributes on the element before adding the new ones.  

This led to a sanity-questioning moment for me, since I found this by
inspecting output from my own project by eye, but the unit test covering
the code that generated the missing attribute passed.  Fortunately, the
project is still relatively small and well-organized, so it didn&#39;t take
me too long to find the completely unrelated method that was causing the
damage.

While I was writing the Test::More entry that catches the issue, I
discovered a secondary issue with set_att&#40;&#41;: namely that it fails in
absolute silence if handed a hashref.  It doesn&#39;t throw an exception, it
doesn&#39;t spit out a warning, it just silently fails to change anything at
all.  The attached file catches both issues.

These two interfaces are close enough in name that one would expect them
to either behave in the same way or fail noisily if they were switched
-- it&#39;s just too easy to add or a remove an &#39;s&#39; when typing.  I would
ask that set_att&#40;&#41; please either be updated to accept hashrefs, or croak
if fed one.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> test_set_atts.t</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/518569/258816/test_set_atts.t">Download test_set_atts.t</a><br />
<span class="downloadcontenttype">text/x-perl 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#
# Check for XML::Twig::Elt-&gt;set_atts destroying existing attributes
#

use warnings; use strict;

use Test::More tests =&gt; 9;
BEGIN { use_ok&#40;&#39;XML::Twig&#39;&#41; };

my $twig = XML::Twig-&gt;new&#40;
    output_encoding =&gt; &#39;utf-8&#39;,
    pretty_print =&gt; &#39;record&#39;
    &#41;;
my $sky;

my $xml = &lt;&lt;END;
&lt;root&gt;
&lt;sky sun=&#34;yellow&#34; cloud=&#34;white&#34; /&gt;
&lt;/root&gt;
END
my %atthash = &#40;&#39;color&#39; =&gt; &#39;purple&#39;&#41;;

$twig-&gt;parse&#40;$xml&#41;;
$sky = $twig-&gt;root-&gt;first_child&#40;&#39;sky&#39;&#41;;
$sky-&gt;set_att&#40;&#39;color&#39; =&gt; &#39;blue&#39;&#41;;
is&#40;$sky-&gt;att&#40;&#39;sun&#39;&#41;,&#39;yellow&#39;,
   &#39;set_att&#40;key =&gt; value&#41; preserves previous attributes&#39;&#41;;
is&#40;$sky-&gt;att&#40;&#39;color&#39;&#41;,&#39;blue&#39;,&#39;set_att&#40;key =&gt; value&#41; sets new attribute&#39;&#41;;

$twig-&gt;parse&#40;$xml&#41;;
$sky = $twig-&gt;root-&gt;first_child&#40;&#39;sky&#39;&#41;;
$sky-&gt;set_att&#40;\%atthash&#41;;
is&#40;$sky-&gt;att&#40;&#39;sun&#39;&#41;,&#39;yellow&#39;,
   &#39;set_att&#40;\%hash&#41; preserves previous attributes&#39;&#41;;
is&#40;$sky-&gt;att&#40;&#39;color&#39;&#41;,&#39;blue&#39;,&#39;set_att&#40;\%hash&#41; sets new attribute&#39;&#41;;

$twig-&gt;parse&#40;$xml&#41;;
$sky = $twig-&gt;root-&gt;first_child&#40;&#39;sky&#39;&#41;;
$sky-&gt;set_atts&#40;&#39;color&#39; =&gt; &#39;cerulean&#39;&#41;;
is&#40;$sky-&gt;att&#40;&#39;sun&#39;&#41;,&#39;yellow&#39;,
   &#39;set_atts&#40;key =&gt; value&#41; preserves previous attributes&#39;&#41;;
is&#40;$sky-&gt;att&#40;&#39;color&#39;&#41;,&#39;cerulean&#39;,&#39;set_atts&#40;key =&gt; value&#41; sets new attribute&#39;&#41;;

$twig-&gt;parse&#40;$xml&#41;;
$sky = $twig-&gt;root-&gt;first_child&#40;&#39;sky&#39;&#41;;
$sky-&gt;set_atts&#40;\%atthash&#41;;
is&#40;$sky-&gt;att&#40;&#39;sun&#39;&#41;,&#39;yellow&#39;,&#39;set_atts&#40;\%hash&#41; preserves previous attributes&#39;&#41;;
is&#40;$sky-&gt;att&#40;&#39;color&#39;&#41;,&#39;purple&#39;,&#39;set_atts&#40;\%hash&#41; sets new attribute&#39;&#41;;

__DATA__
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-519028" href="/Public/Bug/Display.html?id=39977#txn-519028">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;13&nbsp;08:02:00&nbsp;2008</span>
    <span class="description">xmltwig [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #39977] XML::Twig::Elt-&gt;set_atts&#40;&#41; destroys any existing attributes; set_att&#40;&#41; fails silently on hashref</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 13 Oct 2008 14:02:00 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-Twig [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mirod &lt;xmltwig [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/519028/259052/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/259052">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Zed Pobre via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sat Oct 11 19:56:02 2008: Request 39977 was acted upon.
&gt; Transaction: Ticket created by AZED
&gt;        Queue: XML-Twig
&gt;      Subject: XML::Twig::Elt-&gt;set_atts&#40;&#41; destroys any existing attributes;
&gt;  set_att&#40;&#41; fails silently on hashref
&gt;    Broken in: 3.32
&gt;     Severity: Important
&gt;        Owner: Nobody
&gt;   Requestors: AZED@cpan.org
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=39977">http://rt.cpan.org/Ticket/Display.html?id=39977</a></span> &gt;
&gt; 
&gt; 
&gt; From the documentation, one would think that the only difference between
&gt; set_att&#40;&#41; and set_atts&#40;&#41; is that the latter accepts hash references and
&gt; the former doesn&#39;t &#40;and in fact, you&#39;d think that set_atts&#40;&#41; wouldn&#39;t
&gt; accept a list, even though it does&#41;.  I saw no indication of any time
&gt; one might want to use set_att&#40;&#41; instead of set_atts&#40;&#41;...  but a subtle
&gt; difference just bit me: set_atts&#40;&#41; apparently destroys all existing
&gt; attributes on the element before adding the new ones.  
&gt; 
&gt; This led to a sanity-questioning moment for me, since I found this by
&gt; inspecting output from my own project by eye, but the unit test covering
&gt; the code that generated the missing attribute passed.  Fortunately, the
&gt; project is still relatively small and well-organized, so it didn&#39;t take
&gt; me too long to find the completely unrelated method that was causing the
&gt; damage.
&gt; 
&gt; While I was writing the Test::More entry that catches the issue, I
&gt; discovered a secondary issue with set_att&#40;&#41;: namely that it fails in
&gt; absolute silence if handed a hashref.  It doesn&#39;t throw an exception, it
&gt; doesn&#39;t spit out a warning, it just silently fails to change anything at
&gt; all.  The attached file catches both issues.
&gt; 
&gt; These two interfaces are close enough in name that one would expect them
&gt; to either behave in the same way or fail noisily if they were switched
&gt; -- it&#39;s just too easy to add or a remove an &#39;s&#39; when typing.  I would
&gt; ask that set_att&#40;&#41; please either be updated to accept hashrefs, or croak
&gt; if fed one.
</div>
It makes sense. I have added a test that will make set_att croak if passed
a hashref.

The interface is still a bit messy, and you could still end-up thinking you&#39;re 
doing a set_att &#40;no s&#41; with a list of attribute name / values and because of a 
typo doing a set_atts &#40;with s&#41;. This would be accepted but would delete all 
pre-existing attribute.

In hindsight, set_atts should not accept a list of attribute name / values, but 
it&#39;s too late to change that. set_att used to only accept 1 attribute / value 
pair, but I found myself chaining calls often enough that I allowed passing 
several pairs in a single call.

The updated version is at the usual place &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://xmltwig.com/xmltwig">http://xmltwig.com/xmltwig</a></span> &#41;.

Let me know if you have any question or comment.

Thanks

-- 
mirod
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-519029" href="/Public/Bug/Display.html?id=39977#txn-519029">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;13&nbsp;08:02:02&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-519162" href="/Public/Bug/Display.html?id=39977#txn-519162">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;13&nbsp;13:42:17&nbsp;2008</span>
    <span class="description">AZED [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/519162/259143/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/259143">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Well, set_att&#40;&#41; is now croaking well, which I like, but the first thing
I noticed is that the croak message is a little odd:

improper call to set_att, usage is
XML::Twig::Elt=HASH&#40;0x86630c0&#41;-&gt;set_att&#40; att1 =&gt; &#39;val1&#39;, att2 =&gt; &#39;val2&#39;,...&#41;

XML::Twig::Elt=HASH?  You maybe meant to stick the GI in there?  I&#39;m
afraid I haven&#39;t poked at your code to see what you changed yet.

I also see that you&#39;ve updated the twig devel documentation for
set_atts&#40;&#41;, which is better than no warning at all, but honestly, this
interface scares me.  I only caught my error by Mark 1 Eyeball
inspection, because it was a subtle &#39;action-at-a-distance&#39; type of bug
that I would not ordinarily have thought to test for.  The thought of
trying to find the extra &#39;s&#39; in a very large project is quite daunting,
especially considering how natural it is to type the plural form just
because you are altering multiple attributes at once.

I really would have much preferred to see set_att&#40;&#41; and set_atts&#40;&#41;
become aliases of each other with identical interface and output, and
create a clobbering version called set_all_atts&#40;&#41; or set_atts_exactly&#40;&#41;
or some such.  It was the attribute deletion that prompted me to write
the original bug report; the discovery of the set_att&#40;&#41; issue was really
just a side-effect of my testing.

I take it that you are concerned about breaking someone else&#39;s code that
was relying on this previously undocumented feature; I would strongly
urge you to reconsider, on the grounds that a clean break now,
well-documented in the README, is very easy to repair &#40;it&#39;s just a
search-and-replace from &#39;set_atts&#39; to &#39;set_all_atts&#39; or some such for
those people that really were relying on attribute deletion by
set_atts&#40;&#41;, and quickly findable by grep&#41;, but code broken by an extra
&#40;or missing&#41; letter in a method whose name does not imply the extra
functionality could be very difficult to repair later.

This would pretty much have to be done now, though -- people relying on
an undocumented feature when a documented method would have done the
same thing safely in two lines have very little room to gripe, but once
you&#39;ve documented it in a stable release, users could be expecting to
rely on it staying that way.  Again, I strongly urge you to present a
clearer interface now, before you officially sanction one that I feel is
extremely dangerous.

Thanks for your time.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-519178" href="/Public/Bug/Display.html?id=39977#txn-519178">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;13&nbsp;14:21:31&nbsp;2008</span>
    <span class="description">xmltwig [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #39977] XML::Twig::Elt-&gt;set_atts&#40;&#41; destroys any existing attributes; set_att&#40;&#41; fails silently on hashref</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 13 Oct 2008 20:21:19 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-Twig [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mirod &lt;xmltwig [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/519178/259148/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/259148">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Zed Pobre via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: XML-Twig
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=39977">http://rt.cpan.org/Ticket/Display.html?id=39977</a></span> &gt;
&gt; 
&gt; Well, set_att&#40;&#41; is now croaking well, which I like, but the first thing
&gt; I noticed is that the croak message is a little odd:
&gt; 
&gt; improper call to set_att, usage is
&gt; XML::Twig::Elt=HASH&#40;0x86630c0&#41;-&gt;set_att&#40; att1 =&gt; &#39;val1&#39;, att2 =&gt; &#39;val2&#39;,...&#41;
&gt; 
&gt; XML::Twig::Elt=HASH?  You maybe meant to stick the GI in there?  I&#39;m
&gt; afraid I haven&#39;t poked at your code to see what you changed yet.
</div>
Oops! The test on the error message passed because it matched just the beginning 
of the error message, so I did not see the message. It&#39;s fixed now, I has 
$elt-&gt;set_att interpolated in the string. Duh!

As for changing the methods, sorry, but I won&#39;t do that. As a general policy I 
try really really hard not to break backward compatibility. Pretty much anything 
that has been written using XML::Twig since version 3.01 in January 2002 can 
still run just the same in the current version. I do not want to change that. I 
have suffered enough from that kind of behavior to be very reluctant to do it to 
others.

If that&#39;s really a problem for you, several options are available:

- you can subclass the module and rewrite one of the 2 methods,
- if your project uses its own modules, you could monkeypatch XML::Twig to fix 
&#40;or remove&#41; one of the methods,
- I could add an option to XML::Twig&#39;s new method that would help you, either by
making the methods identical as you suggest, or by issuing a warning if set_att 
is used with more than 1 pair.

But in any case the default behaviour will stay as is.

-- 
mirod
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-519232" href="/Public/Bug/Display.html?id=39977#txn-519232">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;13&nbsp;16:47:51&nbsp;2008</span>
    <span class="description">AZED [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/519232/259173/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/259173">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Actually, an option to new&#40;&#41; to fix this would be fine by me.  While
considering the mechanic to propose to you, however, I discovered a
similar issue with del_att&#40;&#41; and del_atts&#40;&#41;, so this response will cover
that as well.

Let me propose the following:

1. Let set_att&#40;&#41; accept a hashref the same way set_atts&#40;&#41; does.  This
makes set_att&#40;&#41; the safe method to use in all circumstances.

2. create set_all_atts&#40;&#41; and del_all_atts&#40;&#41; to do the same thing that
set_atts&#40;&#41; and del_atts&#40;&#41; do now, unaffected by the safe_atts option
described below.  Have the documentation entries for set_atts&#40;&#41; and
del_atts&#40;&#41; recommend that the user use set_all_atts&#40;&#41; and del_all_atts&#40;&#41;
for clarity instead.

3. del_all_atts&#40;&#41; and del_atts&#40;&#41; should both croak if fed any argument
at all.  Right now, del_atts&#40;&#39;att1&#39;,att2&#39;&#41; will silently delete
everything it can find and not even warn you that you almost certainly
did something wrong.

4. new&#40;safe_atts =&gt; 1&#41;
   a. causes set_atts&#40;&#41; to not clobber existing attributes
   b. causes set_atts&#40;&#41; to always carp a warning that set_atts&#40;&#41;
      is ambiguous, use set_att&#40;&#41; or set_all_atts&#40;&#41; instead
   c. causes del_att&#40;&#41; to croak if it is fed no arguments at all
      &#40;this is placed here instead of with #3 because I don&#39;t know
      any way to distinguish between passing no arguments and passing
      an empty list&#41;
   d. causes del_atts&#40;&#41; to always carp a warning that del_atts&#40;&#41; is 
      easily confused with del_att&#40;&#41;, use del_all_atts&#40;&#41; instead.

I&#39;m torn about the warnings in 4b and 4d, simply because set_atts&#40;&#41;
rolls off of the fingers so nicely when thinking about multiple
attributes, but there&#39;s no getting around the fact that set_att&#40;&#41; is the
only safe and consistent interface, even assuming the existence of
safe_atts.  If I &#40;using safe_atts in my new at the top of my code&#41; wrote
a sub using set_atts&#40;&#41; relying on them not to clobber attributes, and
someone cuts-and-pastes that sub but doesn&#39;t use safe_atts, havoc may
ensue, so as much as I hate asking for the warnings, I am.

Does that meet with your approval?
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.448508</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
