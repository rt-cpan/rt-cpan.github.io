<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #84301 for Math-Factor-XS: Unexpected behaviour with floating point errors</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #84301 for Math-Factor-XS: Unexpected behaviour with floating point errors</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Math-Factor-XS">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Math-Factor-XS">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Math-Factor-XS">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Math-Factor-XS">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Math-Factor-XS">Math-Factor-XS CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">84301</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Math-Factor-XS">Math-Factor-XS</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
bkb [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-20640-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.40    </td>
  </tr>
  <tr id="CF-20641-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=84301">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1196406" href="/Public/Bug/Display.html?id=84301#txn-1196406">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;29&nbsp;23:31:58&nbsp;2013</span>
    <span class="description">bkb [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Unexpected behaviour with floating point errors</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1196406/631454/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/631454">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 965b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The output of the following test is surprising:

#!/home/ben/software/install/bin/perl
use warnings;
use strict;
use Test::More;
use Math::Factor::XS &#39;:all&#39;;
my @p = &#40;0.7, 0.1&#41;;
my @q;
for my $x &#40;@p&#41; {
    for my $y &#40;@p&#41; {
        push @q, $x * $y;
    }
}
my @r = map {$_ * 100} @q;
print &#34;\@r = @r\n&#34;;
for my $r &#40;@r&#41; {
    my @factors = prime_factors &#40;$r&#41;;
    if &#40;$r == 7&#41; {
        is &#40;scalar @factors, 1&#41;;
        is_deeply &#40;\@factors, [7]&#41;;
    }
    else {
        print $r - 7, &#34;\n&#34;;
        print &#34;$r -&gt; @factors\n&#34;;
    }
}
done_testing &#40;&#41;;

Output follows:

@r = 49 7 7 1
42
49 -&gt; 2 2 2 2 3
-8.88178419700125e-16
7 -&gt; 2 3
-8.88178419700125e-16
7 -&gt; 2 3
-6
1 -&gt; 
1..0
# No tests run!

What Perl prints as &#34;7&#34; is taken to be 6 by the module and factorized as &#34;2 3&#34;. The difference between the value 7 and the actual value is a tiny floating point error.

I would suggest that either the module should round the number to the nearest integer, or simply refuse to process a non-integer value.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1196409" href="/Public/Bug/Display.html?id=84301#txn-1196409">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;29&nbsp;23:48:01&nbsp;2013</span>
    <span class="description">bkb [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1196409/631457/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/631457">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 472b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This adds a test file, uses &#34;round&#34; to fix the bug in &#34;prime_factors&#34;.

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/benkasminbullock/Math-Factor-XS/commit/3121550ebd15c5271218b8c1c3b79f34e5ce2422">https://github.com/benkasminbullock/Math-Factor-XS/commit/3121550ebd15c5271218b8c1c3b79f34e5ce2422</a></span>

I have also added the tests for this one:

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/benkasminbullock/Math-Factor-XS/commit/dd791dbd8206c4326fab9c961c4fbaac48dcf36f">https://github.com/benkasminbullock/Math-Factor-XS/commit/dd791dbd8206c4326fab9c961c4fbaac48dcf36f</a></span>

This is one way to fix the bug. I tried another way using SvNOK and friends but this did not work for me, so the above crude method is the one I settled on.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1196411" href="/Public/Bug/Display.html?id=84301#txn-1196411">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;29&nbsp;23:48:02&nbsp;2013</span>
    <span class="description">bkb [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1196412" href="/Public/Bug/Display.html?id=84301#txn-1196412">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;29&nbsp;23:53:33&nbsp;2013</span>
    <span class="description">bkb [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1196412/631459/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/631459">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 285b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Mar 29 23:48:01 2013, BKB wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have also added the tests for this one:
</div>
Sorry, this message is in error. It should read &#34;I have also added the same functioning &#40;using &#34;round&#34; from the C maths library&#41; to round off the input &#34;number&#34; for the other two routines in XS.xs&#34;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1197312" href="/Public/Bug/Display.html?id=84301#txn-1197312">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;01&nbsp;19:45:33&nbsp;2013</span>
    <span class="description">KRYDE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1197312/631955/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/631955">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 750b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I would suggest that either the module should round the number to the
&gt; nearest integer,
</div>
Math::Factor::XS uses SvUV via the typemap to get its desired integer, and that has the effect of rounding towards 0.  Almost everything in perl which wants an integer uses SvUV that way.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; or simply refuse to process a non-integer value.
</div>
Perhaps, since it doesn&#39;t make much sense to factorize a non-integer.  The only thing I&#39;d be a little wary of is attempting to have a lone module like Math::Factor::XS do anything too fancy about ints versus floats.  Does anywhere else notice and reject non-integers?

There&#39;s a great deal of slackness in perl between integers and floats.  Sometimes it&#39;s quite convenient, if the rounding goes the way you want :-&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1197316" href="/Public/Bug/Display.html?id=84301#txn-1197316">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;01&nbsp;19:56:20&nbsp;2013</span>
    <span class="description">benkasminbullock [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #84301] Unexpected behaviour with floating point errors</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 2 Apr 2013 08:56:05 +0900</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Math-Factor-XS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ben Bullock &lt;benkasminbullock [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1197316/631959/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/631959">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2 April 2013 08:45, Kevin Ryde via RT &lt;bug-Math-Factor-XS@rt.cpan.org&gt;wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=84301">https://rt.cpan.org/Ticket/Display.html?id=84301</a></span> &gt;
&gt;
<div class="message-stanza open">&gt; &gt; I would suggest that either the module should round the number to the
&gt; &gt; nearest integer,
</div>&gt;
&gt; Math::Factor::XS uses SvUV via the typemap to get its desired integer, and
&gt; that has the effect of rounding towards 0.  Almost everything in perl which
&gt; wants an integer uses SvUV that way.
&gt;
</div>
It doesn&#39;t round to 0 though. Did you look at my example? It is given 007 *
100 and then factorizes it into 3 and 2. That&#39;s not rounding of any kind,
it is truncating the floating point.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; or simply refuse to process a non-integer value.
</div>&gt;
&gt; Perhaps, since it doesn&#39;t make much sense to factorize a non-integer.  The
&gt; only thing I&#39;d be a little wary of is attempting to have a lone module like
&gt; Math::Factor::XS do anything too fancy about ints versus floats.  Does
&gt; anywhere else notice and reject non-integers?
&gt;
</div>
I don&#39;t know.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There&#39;s a great deal of slackness in perl between integers and floats.
&gt;  Sometimes it&#39;s quite convenient, if the rounding goes the way you want :-&#41;.
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1197316/631960/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/631960">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.7k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1198578" href="/Public/Bug/Display.html?id=84301#txn-1198578">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;04&nbsp;17:05:12&nbsp;2013</span>
    <span class="description">KRYDE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1198578/632741/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/632741">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 476b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Apr 01 19:56:20 2013, benkasminbullock@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Did you look at my example?
</div>
Yes.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It is given 007 * 100 and then factorizes it into 3 and 2.
</div>
0.7 * 0.1 * 100 gives for me 6.99999999999999911182, when printed with &#34;%.20f&#34;, and which rounds towards zero to factorize as 6 = 2*3.  Similarly the 0.7 * 0.7 * 100 as
48.99999999999999289457 factorizing 48 = 2 2 2 2 3.

I believe neither 0.1 nor 0.7 are exactly representable in binary, so both lose exactness.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1198642" href="/Public/Bug/Display.html?id=84301#txn-1198642">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;04&nbsp;22:07:47&nbsp;2013</span>
    <span class="description">benkasminbullock [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #84301] Unexpected behaviour with floating point errors</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 5 Apr 2013 11:07:33 +0900</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Math-Factor-XS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ben Bullock &lt;benkasminbullock [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1198642/632773/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/632773">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I was able to confirm that this is what Perl does:

----------------------

use warnings;
use strict;

my $y = 0.1;
my $x = 0.7;
$x *= $y;
$x *= 100;

printf &#40;&#34;%.100g\n&#34;, $x&#41;;
printf &#40;&#34;%g\n&#34;, $x&#41;;

for my $f &#40;1..7&#41; {
    if &#40;$x % $f == 0&#41; {
        print &#34;$f ok\n&#34;;
    }
}

---------------
6.99999999999999911182158029987476766109466552734375
7
1 ok
2 ok
3 ok
6 ok
--------------
It&#39;s really up to you what you think it should do. I find this default
rather bizarre but that is apparently the &#34;Perl way of doing things&#34;.



On 5 April 2013 06:05, Kevin Ryde via RT &lt;bug-Math-Factor-XS@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=84301">https://rt.cpan.org/Ticket/Display.html?id=84301</a></span> &gt;
&gt;
&gt; On Mon Apr 01 19:56:20 2013, benkasminbullock@gmail.com wrote:
<div class="message-stanza open">&gt;&gt;
&gt;&gt; Did you look at my example?
</div>&gt;
&gt; Yes.
&gt;
<div class="message-stanza open">&gt;&gt; It is given 007 * 100 and then factorizes it into 3 and 2.
</div>&gt;
&gt; 0.7 * 0.1 * 100 gives for me 6.99999999999999911182, when printed with &#34;%.20f&#34;, and which rounds towards zero to factorize as 6 = 2*3.  Similarly the 0.7 * 0.7 * 100 as
&gt; 48.99999999999999289457 factorizing 48 = 2 2 2 2 3.
&gt;
&gt; I believe neither 0.1 nor 0.7 are exactly representable in binary, so both lose exactness.
</div></div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.464773</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
