<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #52027 for Email-Outlook-Message: Outlook X.400 address</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #52027 for Email-Outlook-Message: Outlook X.400 address</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Email-Outlook-Message/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Email-Outlook-Message/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Email-Outlook-Message/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Email-Outlook-Message/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Email-Outlook-Message">Email-Outlook-Message CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">52027</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Email-Outlook-Message/Active/">Email-Outlook-Message</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">matijs [...] matijs.net
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jordan.hrycaj [...] 7safe.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-45688-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.909    </td>
  </tr>
  <tr id="CF-45689-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;24&nbsp;07:09:09&nbsp;2009</span>
    <span class="description">jordan.hrycaj [...] 7safe.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Outlook X.400 address</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Microsoft Outlook tends to prefer X.400 addresses before Internet email
addresses. In some cases, this results to email address headers using
the distinguished name like

   From: Willi Wacker &lt;/O=HQ/OU=ADMIN GROUP/CN=RECIPIENTS/CN=WWACKER&gt;

rather than something like

   From: Willi Wacker &lt;willi@wacker.org&gt;

Nevertheless, Outlook seems to bury the email address in the MSG file
under the OLE tags 0E28&#39; and 0E29&#39;. Applying the patch attached as
Message-x400-patch.diff, the Internet email address can be found under
one of the hash entries X400DN1 X400DN2.

More general, ugly extensions like the X.400 patch above cannot be made
easily without modifying the module source. This is so because all the
the parser tables are lexical scope variables &#40;allocated with the
keyword &#34;my&#34;&#41;.

Applying the patch attached as Message-our-patch.diff patch, the X.400
and similar modifications would simply be introduced as

  $Email::Outlook::Message::MAP_SUBITEM_FILE {&#39;0E28&#39;} = &#34;X400DN1&#34;;
  $Email::Outlook::Message::MAP_SUBITEM_FILE {&#39;0E29&#39;} = &#34;X400DN2&#34;;

rather than overwriting methods &#40;as I do at the moment&#41; copying and
modifying large parts of the module code &#40;the _process_root_dir &#40;&#41;
method in the X.400 case&#41;.

Jordan
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Message-x400-patch.diff</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- /usr/share/perl5/Email/Outlook/old/Message.bak	2009-11-24 11:17:09.000000000 +0000
+++ /usr/share/perl5/Email/Outlook/Message.pm	2009-11-24 11:28:48.000000000 +0000
@@ -200,6 +200,20 @@
   &#39;1035&#39; =&gt; &#34;MESSAGEID&#34;,       # Message-Id
   &#39;1039&#39; =&gt; &#34;REFERENCES&#34;,      # References: Header
   &#39;1042&#39; =&gt; &#34;INREPLYTO&#34;,       # In reply to Message-Id
+
+   # An X400 address is coded as an array of ascii strings separated by
+   # SOH &#40;^A&#41;, it may be parsed like
+   #       &#40;$num_items, @fields&#41; = split /\cA/, X400_ADDRESS
+   # where
+   #       $num_items should be scalar
+   # and
+   #       @fields may look like &#40;distinguised-name-fragment, email-address&#41;.
+   #
+   # It is guessed that
+   #       email-address is always @fields [$#fields].
+   #
+   &#39;0E28&#39; =&gt; &#34;X400DN1&#34;,        # group address distinguished name
+   &#39;0E29&#39; =&gt; &#34;X400DN2&#34;,        # alternate group address distinguished name
 };
 
 my $MAP_ADDRESSITEM_FILE = {
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Message-our-patch.diff</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- /usr/share/perl5/Email/Outlook/old/Message.pm	2009-11-24 11:17:09.000000000 +0000
+++ /usr/share/perl5/Email/Outlook/Message.pm	2009-11-24 11:23:26.000000000 +0000
@@ -74,7 +74,7 @@
 #
 # Descriptions partially based on mapitags.h
 #
-my $skipproperties = {
+our $skipproperties = {
   # Envelope properties
   &#39;000B&#39; =&gt; &#34;Conversation key?&#34;,
   &#39;001A&#39; =&gt; &#34;Type of message&#34;,
@@ -158,14 +158,14 @@
 my $ENCODING_BINARY = &#39;0102&#39;;
 my $ENCODING_DIRECTORY = &#39;000D&#39;;
 
-my $KNOWN_ENCODINGS = {
+our $KNOWN_ENCODINGS = {
   &#39;000D&#39; =&gt; &#39;Directory&#39;,
   &#39;001F&#39; =&gt; &#39;Unicode&#39;,
   &#39;001E&#39; =&gt; &#39;Ascii?&#39;,
   &#39;0102&#39; =&gt; &#39;Binary&#39;,
 };
 
-my $MAP_ATTACHMENT_FILE = {
+our $MAP_ATTACHMENT_FILE = {
   &#39;3701&#39; =&gt; &#34;DATA&#34;,        # Data
   &#39;3704&#39; =&gt; &#34;SHORTNAME&#34;,   # Short file name
   &#39;3707&#39; =&gt; &#34;LONGNAME&#34;,    # Long file name
@@ -174,7 +174,7 @@
   &#39;3716&#39; =&gt; &#34;DISPOSITION&#34;, # disposition
 };
 
-my $skipheaders = {
+our $skipheaders = {
   map { uc&#40;$_&#41; =&gt; 1 }
   &#34;MIME-Version&#34;,
   &#34;Content-Type&#34;,
@@ -185,7 +185,7 @@
   &#34;X-MS-Has-Attach&#34;
 };
 
-my $MAP_SUBITEM_FILE = {
+our $MAP_SUBITEM_FILE = {
   &#39;1000&#39; =&gt; &#34;BODY_PLAIN&#34;,      # Body
   &#39;1009&#39; =&gt; &#34;BODY_RTF&#34;,	       # Compressed-RTF version of body
   &#39;1013&#39; =&gt; &#34;BODY_HTML&#34;,       # HTML Version of body
@@ -202,7 +202,7 @@
   &#39;1042&#39; =&gt; &#34;INREPLYTO&#34;,       # In reply to Message-Id
 };
 
-my $MAP_ADDRESSITEM_FILE = {
+our $MAP_ADDRESSITEM_FILE = {
   &#39;3001&#39; =&gt; &#34;NAME&#34;,	    # Real name
   &#39;3002&#39; =&gt; &#34;TYPE&#34;,         # Address type
   &#39;403D&#39; =&gt; &#34;TYPE&#34;,         # Address type
@@ -211,7 +211,7 @@
   &#39;39FE&#39; =&gt; &#34;SMTPADDRESS&#34;,  # SMTP Address variant
 };
 
-my $MAP_PROPSTREAM_TAG = {
+our $MAP_PROPSTREAM_TAG = {
     0x3007 =&gt; &#39;DATE2ND&#39;,    # Outlook created??
     0x0039 =&gt; &#39;DATE1ST&#39;,    # Outlook sent date
  #  0x0E06 =&gt; &#39;DATE2ND&#39;,    # more dates, not needed here
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;11&nbsp;02:06:12&nbsp;2010</span>
    <span class="description">matijs [...] matijs.net -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;11&nbsp;02:06:51&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction dates Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;11&nbsp;02:06:51&nbsp;2010</span>
    <span class="description">matijs [...] matijs.net -  Started changed from Wed Aug 11 02:06:51 2010 to Mon Aug 09 00:00:00 2010</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;11&nbsp;02:13:56&nbsp;2010</span>
    <span class="description">matijs [...] matijs.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Jordan,

As per version 0.910, the parser tables are allocated using the keyword &#39;our&#39;.

I still need to look into using the tags 0E28 and 0E29 to find the &#39;proper&#39; email adress in 
case X.400 addresses are used.

Regards,
Matijs.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;11&nbsp;04:03:49&nbsp;2010</span>
    <span class="description">jordan.hrycaj [...] 7safe.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #52027] Outlook X.400 address </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 11 Aug 2010 09:03:26 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Email-Outlook-Message [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Jordan Hrycaj&#34; &lt;Jordan.Hrycaj [...] 7safe.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Matijs

Thanks for using the &#39;our&#39; keyword.

As for the tags, I use most of the tags also in PST file decoding:

        0x0e28 PidTagPrimarySendAccount documented in [MS-OXPROPS] 2.941
        0x0e29 PidTagNextSendAcct               documented in [MS-OXPROPS] 2.877

There might be some information somewhere in the heap of MS documents but I am really too lazy to try to find something there when looking at the data does the job :&#41;.

Jordan

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Matijs van Zuijlen via RT [mailto:bug-Email-Outlook-Message@rt.cpan.org] 
Sent: 11 August 2010 07:14
To: Jordan Hrycaj
Subject: [rt.cpan.org #52027] Outlook X.400 address 

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=52027">https://rt.cpan.org/Ticket/Display.html?id=52027</a></span> &gt;

Hi Jordan,

As per version 0.910, the parser tables are allocated using the keyword &#39;our&#39;.

I still need to look into using the tags 0E28 and 0E29 to find the &#39;proper&#39; email adress in 
case X.400 addresses are used.

Regards,
Matijs.


This message has been scanned for malware by SurfControl plc. www.surfcontrol.com
</div></div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
