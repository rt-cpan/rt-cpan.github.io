<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #23544 for Net-DHCP-Packet: unhandled multiple options</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #23544 for Net-DHCP-Packet: unhandled multiple options</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Net-DHCP-Packet">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Net-DHCP-Packet">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Net-DHCP-Packet">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Net-DHCP-Packet">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-DHCP-Packet">Net-DHCP-Packet CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">23544</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Net-DHCP-Packet">Net-DHCP-Packet</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
Christof [...] chen.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-22422-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.1    </td>
  </tr>
  <tr id="CF-22423-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




net-dhcp-options.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/267552/117357/net-dhcp-options.patch">
Wed Nov 22 07:14:55 2006 (7.2k) by Christof [...] chen.de
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=23544">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-267552" href="/Public/Bug/Display.html?id=23544#txn-267552">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;22&nbsp;07:14:54&nbsp;2006</span>
    <span class="description">Christof [...] chen.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> unhandled multiple options</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/267552/117354/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/117354">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 677b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Concerning Net::DHCP:Packet 0.66.

A packet with two VENDOR_ENCAPSULATED_OPTION fields &#40;e.g. very large PXE
options&#41; gets malformed by marshall/serialize. Packet.pm stores the
option data in a hash, so only the last data is assigned to every
instance of an option during serialize.

&#40;In general, the code does not provision for multiple options of the
same key&#41;.

The attached patch works around this problem by storing the data for an
option in an array.

addOption appends to this array.
replaceOption replaces the array.
addOptionRaw appends to this array.
replaceOptionRaw replaces the array.

getOptionValue returns an array of option values.


Best regards,
Christof Chen
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> net-dhcp-options.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/267552/117357/net-dhcp-options.patch">Download net-dhcp-options.patch</a><br />
<span class="downloadcontenttype">text/x-diff 7.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: lib/Net/DHCP/Packet.pm
===================================================================
--- lib/Net/DHCP/Packet.pm	&#40;.../original/Net-DHCP-0.66/lib/Net/DHCP/Packet.pm&#41;	&#40;Revision 35&#41;
+++ lib/Net/DHCP/Packet.pm	&#40;.../trunk/current/lib/Net/DHCP/Packet.pm&#41;	&#40;Arbeitskopie&#41;
@@ -1,6 +1,7 @@
 # Net::DHCP::Packet.pm
 # Original Author: F. van Dun
 # Author : S. Hadinger
+# modifications: Christof Chen
 
 package Net::DHCP::Packet;
 
@@ -9,7 +10,7 @@
 use strict;
 our &#40;@ISA, @EXPORT, @EXPORT_OK, $VERSION&#41;;
 use Exporter;
-$VERSION = 0.66;
+$VERSION = 0.661;
 @ISA = qw&#40;Exporter&#41;;
 @EXPORT = qw&#40; packinet packinets unpackinet unpackinets &#41;;
 @EXPORT_OK = qw&#40; &#41;;
@@ -241,17 +242,42 @@
 
 sub addOptionRaw {
   my &#40;$self,$key,$value_bin&#41; = @_;
-  $self-&gt;{options}-&gt;{$key} = $value_bin;
-  push @{$self-&gt;{options_order}}, &#40;$key&#41;;
+  if &#40;!exists $self-&gt;{options}-&gt;{$key}&#41; {
+     push @{$self-&gt;{options_order}}, $key;
+  }
+  push @{$self-&gt;{options}-&gt;{$key}}, $value_bin;
 }
 
+sub replaceOptionRaw {
+  my &#40;$self,$key,$value_bin&#41; = @_;
+  if &#40;!exists $self-&gt;{options}-&gt;{$key}&#41; {
+     push @{$self-&gt;{options_order}}, &#40;$key&#41;;
+  }
+  @{$self-&gt;{options}-&gt;{$key}} = &#40;$value_bin&#41;;
+}
+
 sub addOptionValue&#40;$$$&#41; {
   my $self = shift;
   my $code = shift;           # option code
   my $value = shift;
+
+  my $value_bin = makevalbin&#40;$code, $value&#41;;
+  $self-&gt;addOptionRaw&#40;$code, $value_bin&#41;;
+}
+
+sub replaceOptionValue&#40;$$$&#41; {
+  my $self = shift;
+  my $code = shift;           # option code
+  my $value = shift;
+
+  my $value_bin = makevalbin&#40;$code, $value&#41;;
+  $self-&gt;replaceOptionRaw&#40;$code, $value_bin&#41;;
+}
+
+sub makevalbin &#40;&#41; {
+my &#40;$code,$value&#41; = @_;
+  my $format = &#39;&#39;;            # format for the option
   my $value_bin;              # option value in binary format
-  my $format = &#39;&#39;;            # format for the option
-
   carp&#40;&#34;addOptionValue: unknown format for code &#40;$code&#41;&#34;&#41; unless exists&#40;$DHO_FORMATS{$code}&#41;;
   $format = $DHO_FORMATS{$code} if exists&#40;$DHO_FORMATS{$code}&#41;;
 
@@ -267,9 +293,9 @@
   } elsif &#40;$format =~ /s$/&#41; {      # ends with an &#39;s&#39;, meaning any number of parameters
     ;
   } elsif &#40;$format =~ /2$/&#41; { # ends with a &#39;2&#39;, meaning couples of parameters
-    croak&#40;&#34;addOptionValue: only pairs of values expected for option &#39;$code&#39;&#34;&#41; if &#40;&#40;@values % 2&#41; != 0&#41;;
+    croak&#40;&#34;makevalbin: only pairs of values expected for option &#39;$code&#39;&#34;&#41; if &#40;&#40;@values % 2&#41; != 0&#41;;
   } else {                    # only one parameter
-    croak&#40;&#34;addOptionValue: exactly one value expected for option &#39;$code&#39;&#34;&#41; if &#40;@values != 1&#41;;
+    croak&#40;&#34;makevalbin: exactly one value expected for option &#39;$code&#39;&#34;&#41; if &#40;@values != 1&#41;;
   }
 
   if &#40;$format eq &#39;inet&#39;&#41; {
@@ -294,10 +320,10 @@
   } else {
     $value_bin = $values[0];
   }
-
-  $self-&gt;addOptionRaw&#40;$code, $value_bin&#41;;
+  return $value_bin; 
 }
 
+
 #sub getOption {               # deprecated
 #  my $self = shift;
 #  return $self-&gt;getOptionRaw&#40;@_&#41;;
@@ -316,38 +342,27 @@
 
   carp&#40;&#34;getOptionValue: unknown format for code &#40;$code&#41;&#34;&#41; unless exists&#40;$DHO_FORMATS{$code}&#41;;
   $format = $DHO_FORMATS{$code} if exists&#40;$DHO_FORMATS{$code}&#41;;
-  my $value_bin = $self-&gt;getOptionRaw&#40;$code&#41;;
-  return undef unless defined&#40;$value_bin&#41;;
-  my @values = &#40;&#41;;
+  my $values_arr = &#40;$self-&gt;getOptionRaw&#40;$code&#41;&#41;;
+  return undef unless defined&#40;$values_arr-&gt;[0]&#41;;
+  my @value = &#40;&#41;;
   
-  if &#40;$format eq &#39;inet&#39;&#41; {
-    $values[0] = unpackinet&#40;$value_bin&#41;;
-  } elsif &#40;&#40;$format eq &#39;inets&#39;&#41; || &#40;$format eq &#39;inets2&#39;&#41;&#41; {
-    @values = unpackinets_array&#40;$value_bin&#41;;
-  } elsif &#40;$format eq &#39;int&#39;&#41; {
-    $values[0] = unpack&#40;&#39;N&#39;, $value_bin&#41;;
-  } elsif &#40;$format eq &#39;short&#39;&#41; {
-    $values[0] = unpack&#40;&#39;n&#39;, $value_bin&#41;;
-  } elsif &#40;$format eq &#39;shorts&#39;&#41; {
-    @values = unpack&#40;&#39;n*&#39;, $value_bin&#41;;
-  } elsif &#40;$format eq &#39;byte&#39;&#41; {
-    $values[0] = unpack&#40;&#39;C&#39;, $value_bin&#41;;
-  } elsif &#40;$format eq &#39;bytes&#39;&#41; {
-    @values = unpack&#40;&#39;C*&#39;, $value_bin&#41;;
-  } elsif &#40;$format eq &#39;string&#39;&#41; {
-    $values[0] = $value_bin;
-#  } elsif &#40;$format eq &#39;relays&#39;&#41; {
-#    @values = $self-&gt;decodeRelayAgent&#40;$value_bin&#41;;
-#    # TBM, bad format
-#  } elsif &#40;$format eq &#39;ids&#39;&#41; {
-#    $values[0] = $value_bin;
-#    # TBM, bad format
-  } else {
-    $values[0] = $value_bin;
+  foreach my $value_bin &#40;@{$values_arr}&#41; {
+     my $data = join &#34; &#34;, $format eq &#39;inet&#39;   ? unpackinet&#40;$value_bin&#41; 
+			: $format eq &#39;inets&#39; || &#40;$format eq &#39;inets2&#39;&#41; ? unpackinets_array&#40;$value_bin&#41;
+			: $format eq &#39;int&#39;    ? unpack&#40;&#39;N&#39;, $value_bin&#41;
+			: $format eq &#39;short&#39;  ? unpack&#40;&#39;n&#39;, $value_bin&#41;
+			: $format eq &#39;shorts&#39; ? unpack&#40;&#39;n*&#39;, $value_bin&#41;
+			: $format eq &#39;byte&#39;   ? unpack&#40;&#39;C&#39;, $value_bin&#41;
+			: $format eq &#39;bytes&#39;  ? unpack&#40;&#39;C*&#39;, $value_bin&#41;
+			: $format eq &#39;string&#39; ? $value_bin
+			: 			$value_bin
+			;
+    push @value, $data;			
   }
 
-  return join&#40;&#34; &#34;, @values&#41;; 
-#  return wantarray ? @values : $values[0];
+
+  #return join&#40;&#34; &#34;, @values&#41;; 
+  return wantarray ? @value : $value[0];
 }
 
 sub removeOption {
@@ -394,8 +409,10 @@
   if &#40;$self-&gt;{isDhcp}&#41; {    # add MAGIC_COOKIE and options
     $bytes .= MAGIC_COOKIE&#40;&#41;; 
     foreach my $key &#40; @{$self-&gt;{options_order}} &#41; {
-      $bytes .= pack&#40;&#39;C&#39;, $key&#41;;
-      $bytes .= pack&#40;&#39;C/a*&#39;, $self-&gt;{options}-&gt;{$key}&#41;;
+	foreach my $value &#40;@{$self-&gt;{options}-&gt;{$key}}&#41; {
+      		$bytes .= pack&#40;&#39;C&#39;, $key&#41;;
+      		$bytes .= pack&#40;&#39;C/a*&#39;, $value&#41;;
+	}
     }
     $bytes .= pack&#40;&#39;C&#39;, 255&#41;;
   }
@@ -555,22 +572,16 @@
   
   foreach my $key &#40; @{$self-&gt;{options_order}} &#41; {
     my $value;    # value of option to be printed
-    
-    if &#40;$key == DHO_DHCP_MESSAGE_TYPE&#40;&#41;&#41; {
-      $value = $self-&gt;getOptionValue&#40;$key&#41;;
-      $value = &#40;exists&#40;$REV_DHCP_MESSAGE{$value}&#41; &#38;&#38; $REV_DHCP_MESSAGE{$value}&#41; || $self-&gt;getOptionValue&#40;$key&#41;;
-    } else {
-      if &#40;exists&#40;$DHO_FORMATS{$key}&#41;&#41; {
-        $value = join&#40;&#34; &#34;, $self-&gt;getOptionValue&#40;$key&#41;&#41;;
-      } else {
-        $value = $self-&gt;getOptionRaw&#40;$key&#41;;
-      }
-      $value =~ s/&#40;[[:^print:]]&#41;/ sprintf q[\x%02X], ord $1 /eg;  # printable text
-    }    
-    $s .= sprintf&#40;&#34; %s&#40;%d&#41; = %s\n&#34;, exists $REV_DHO_CODES{$key} ? $REV_DHO_CODES{$key}: &#39;&#39;, $key, $value&#41;;
+    #my @data  = exists&#40;$DHO_FORMATS{$key}&#41; ? $self-&gt;getOptionValue&#40;$key&#41; : $self-&gt;getOptionRaw&#40;$key&#41;;
+    foreach $value &#40;$self-&gt;getOptionValue&#40;$key&#41;&#41; {
+    	  if &#40;$key == DHO_DHCP_MESSAGE_TYPE&#40;&#41;&#41; {
+            $value = &#40;exists&#40;$REV_DHCP_MESSAGE{$value}&#41; &#38;&#38; $REV_DHCP_MESSAGE{$value}&#41; || $value;
+  	  }
+        $value =~ s/&#40;[[:^print:]]&#41;/ sprintf q[\x%02X], ord $1 /eg;  # printable text
+        $s .= sprintf&#40;&#34; %s&#40;%d&#41; = %s\n&#34;, exists $REV_DHO_CODES{$key} ? $REV_DHO_CODES{$key}: &#39;&#39;, $key, $value&#41;;
+    }
   }
   $s .= sprintf&#40;&#34;padding [%s] = %s\n&#34;, length&#40;$self-&gt;{padding}&#41;, unpack&#40;&#39;H*&#39;, $self-&gt;{padding}&#41;&#41;;
-  
   return $s;
 }
 #=======================================================================
@@ -858,7 +869,7 @@
 
 =item addOptionValue &#40; CODE, VALUE &#41;
 
-Adds a DHCP option field. Common code values are listed in
+Adds/appends a DHCP option field. Common code values are listed in
 C&lt;Net::DHCP::Constants&gt; C&lt;DHO_&gt;*.
 
 Values are automatically converted according to their data types,
@@ -872,6 +883,9 @@
    $pac-&gt;addOption&#40;DHO_DHCP_MESSAGE_TYPE&#40;&#41;, DHCPINFORM&#40;&#41;&#41;;
    $pac-&gt;addOption&#40;DHO_NAME_SERVERS&#40;&#41;, &#34;10.0.0.1&#34;, &#34;10.0.0.2&#34;&#41;&#41;;
 
+=item replaceOptionValue &#40; CODE, VALUE &#41;
+Replaces a DHCP option field.
+
 =item getOptionValue &#40; CODE &#41;
 
 Returns the value of a DHCP option.
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-267569" href="/Public/Bug/Display.html?id=23544#txn-267569">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;22&nbsp;07:27:43&nbsp;2006</span>
    <span class="description">Christof [...] chen.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christof [...] chen.de</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/267569/117370/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/117370">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 81b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Oops. wrong queue. 
This is now a duplicate to #23546
Please close this bug here.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-267687" href="/Public/Bug/Display.html?id=23544#txn-267687">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;22&nbsp;12:46:26&nbsp;2006</span>
    <span class="description">stephan [...] hadinger.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #23544] unhandled multiple options </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 22 Nov 2006 09:45:39 -0800 &#40;PST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-DHCP-Packet [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Stephan Hadinger &lt;stephan [...] hadinger.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/267687/117437/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/117437">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 388b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Christof,

Thank you for this patch. I will try to find time to
make and publish a new build this week.

Regards
Stephan
--- Christof Chen via RT
&lt;bug-Net-DHCP-Packet@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt;        Queue: Net-DHCP-Packet
&gt;  Ticket &lt;URL:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=23544">http://rt.cpan.org/Ticket/Display.html?id=23544</a></span> &gt;
&gt; 
&gt; Oops. wrong queue. 
&gt; This is now a duplicate to #23546
&gt; Please close this bug here.
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-267688" href="/Public/Bug/Display.html?id=23544#txn-267688">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;22&nbsp;12:46:27&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.358824</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
