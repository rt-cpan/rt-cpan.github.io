<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #72314 for Net-DNS: t/13-udp-trunc.t failures under Cygwin on Windows</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #72314 for Net-DNS: t/13-udp-trunc.t failures under Cygwin on Windows</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-DNS/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-DNS/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-DNS/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-DNS/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-DNS">Net-DNS CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">72314</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-DNS/Active/">Net-DNS</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">willem [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jdhedden [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-22454-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.67    </td>
  </tr>
  <tr id="CF-22455-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;09&nbsp;09:34:08&nbsp;2011</span>
    <span class="description">jdhedden [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> t/13-udp-trunc.t failures under Cygwin on Windows</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Net-DNS-0.67 &gt; perl -Mblib t/13-udp-trunc.t 
# Testing availability of 127.0.0.1
1..100
ok 1 - use Net::DNS::Nameserver;
Couldn&#39;t create TCP socket: Address family not supported by protocol at
/var/perl/cpan/build/Net-DNS-0.67/blib/lib/Net/DNS/Nameserver.pm line 98
        Net::DNS::Nameserver::new&#40;&#39;Net::DNS::Nameserver&#39;, &#39;LocalPort&#39;,
5334, &#39;LocalAddres&#39;, 127.0.0.1, &#39;ReplyHandler&#39;, &#39;CODE&#40;0x1016d3c0&#41;&#39;&#41;
called at t/13-udp-trunc.t line 63
Couldn&#39;t create UDP socket: Address family not supported by protocol at
/var/perl/cpan/build/Net-DNS-0.67/blib/lib/Net/DNS/Nameserver.pm line 117
        Net::DNS::Nameserver::new&#40;&#39;Net::DNS::Nameserver&#39;, &#39;LocalPort&#39;,
5334, &#39;LocalAddres&#39;, 127.0.0.1, &#39;ReplyHandler&#39;, &#39;CODE&#40;0x1016d3c0&#41;&#39;&#41;
called at t/13-udp-trunc.t line 63
Can&#39;t call method &#34;udp_connection&#34; on an undefined value at
t/13-udp-trunc.t line 90.
# Looks like you planned 100 tests but ran 1.
# Looks like your test exited with 9 just after 1.


Subject: FAIL Net-DNS-0.67 i686-cygwin-thread-multi-64int 1.7.5&#40;0.22553&#41;
To: cpan-testers@perl.org
From: jdhedden@cpan.org

TEST RESULTS:

PERL_DL_NONLAZY=1 /usr/bin/perl.exe &#34;-MExtUtils::Command::MM&#34; &#34;-e&#34;
&#34;test_harness&#40;0, &#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/*.t
# 
# These tests were run using:
# Net::DNS::VERSION:    0.67
# set environment variable NET_DNS_DEBUG to get all versions
t/00-load.t ....................... ok
t/00-pod.t ........................ ok
t/00-version.t .................... ok
t/01-resolver-env.t ............... ok
t/01-resolver-file.t .............. ok
t/01-resolver-flags.t ............. ok
t/01-resolver-opt.t ............... ok
t/01-resolver.t ................... ok
t/02-domain.t ..................... ok
t/02-domainname.t ................. ok
t/02-header.t ..................... ok
t/03-question.t ................... ok
t/04-packet-unique-push.t ......... ok
t/04-packet.t ..................... ok
t/05-apl.t ........................ ok
t/05-rr-opt.t ..................... ok
t/05-rr-rrsort.t .................. ok
t/05-rr-sshfp.t ................... skipped: Digest::BubbleBabble not
installed.
t/05-rr-txt.t ..................... ok
t/05-rr-unknown.t ................. ok
t/05-rr-various.t ................. ok
# Number of RRs: 33 Number of methods: 127
t/05-rr.t ......................... ok
t/06-update.t ..................... ok
t/07-misc.t ....................... ok
t/08-online.t ..................... ok
t/09-tkey.t ....................... ok
t/10-recurse.t .................... skipped: Cannot run these tests from
this IP: 192.168.44.161
# Using the  XS compiled dn_expand function 
# 
# disabling XS based dns_expand for a moment.
# 
# Continuing to use the XS based dn_expand&#40;&#41;
t/11-escapedchars.t ............... ok
t/11-inet6.t ...................... skipped: Online tests disabled.

123456789112345678921234567893123456789412345678951234567896123...
truncated to 63 octets &#40;RFC1035 2.3.1&#41; at t/12-compression.t line 56
t/12-compression.t ................ ok
# Testing availability of 127.0.0.1
Couldn&#39;t create TCP socket: Address family not supported by protocol at
/var/perl/cpan/build/Net-DNS-0.67/blib/lib/Net/DNS/Nameserver.pm line 98
        Net::DNS::Nameserver::new&#40;&#39;Net::DNS::Nameserver&#39;, &#39;LocalPort&#39;, 5334,
&#39;LocalAddres&#39;, 127.0.0.1, &#39;ReplyHandler&#39;, &#39;CODE&#40;0x100fe000&#41;&#39;&#41; called at
t/13-udp-trunc.t line 63
Couldn&#39;t create UDP socket: Address family not supported by protocol at
/var/perl/cpan/build/Net-DNS-0.67/blib/lib/Net/DNS/Nameserver.pm line 117
        Net::DNS::Nameserver::new&#40;&#39;Net::DNS::Nameserver&#39;, &#39;LocalPort&#39;, 5334,
&#39;LocalAddres&#39;, 127.0.0.1, &#39;ReplyHandler&#39;, &#39;CODE&#40;0x100fe000&#41;&#39;&#41; called at
t/13-udp-trunc.t line 63
Can&#39;t call method &#34;udp_connection&#34; on an undefined value at
t/13-udp-trunc.t line 90.
# Looks like you planned 100 tests but ran 1.
# Looks like your test exited with 9 just after 1.
t/13-udp-trunc.t .................. 
Dubious, test returned 9 &#40;wstat 2304, 0x900&#41;
Failed 99/100 subtests 
t/17-pure-virtual-replyhandler.t .. ok
# Cleaning
t/99-cleanup.t .................... ok

Test Summary Report
-------------------
t/13-udp-trunc.t                &#40;Wstat: 2304 Tests: 1 Failed: 0&#41;
  Non-zero exit status: 9
  Parse errors: Bad plan.  You planned 100 tests but ran 1.
Files=33, Tests=1666, 79 wallclock secs &#40; 0.28 usr  0.38 sys + 11.06
cusr  7.99 csys = 19.71 CPU&#41;
Result: FAIL
Failed 1/33 test programs. 0/1666 subtests failed.
make: *** [test_dynamic] Error 255

--

Summary of my perl5 &#40;revision 5 version 10 subversion 1&#41; configuration:
   
  Platform:
    osname=cygwin, osvers=1.7.5&#40;0.22553&#41;,
archname=i686-cygwin-thread-multi-64int
    uname=&#39;cygwin_nt-5.1 reini 1.7.5&#40;0.22553&#41; 2010-04-12 19:07 i686 cygwin &#39;
    config_args=&#39;-de -Dlibperl=cygperl5_10.dll -Dcc=gcc-4 -Dld=g++-4
-Dmksymlinks -Dusethreads -Dmad=y -Doptimize=-O3 -Accflags=-g3&#39;
    hint=recommended, useposix=true, d_sigaction=define
    useithreads=define, usemultiplicity=define
    useperlio=define, d_sfio=undef, uselargefiles=define, usesocks=undef
    use64bitint=define, use64bitall=undef, uselongdouble=undef
    usemymalloc=y, bincompat5005=undef
  Compiler:
    cc=&#39;gcc-4&#39;, ccflags =&#39;-DPERL_USE_SAFE_PUTENV -U__STRICT_ANSI__ -g3
-fno-strict-aliasing -pipe -fstack-protector -I/usr/local/include&#39;,
    optimize=&#39;-O3&#39;,
    cppflags=&#39;-DPERL_USE_SAFE_PUTENV -U__STRICT_ANSI__ -g3
-fno-strict-aliasing -pipe -fstack-protector -I/usr/local/include&#39;
    ccversion=&#39;&#39;, gccversion=&#39;4.3.4 20090804 &#40;release&#41; 1&#39;, gccosandvers=&#39;&#39;
    intsize=4, longsize=4, ptrsize=4, doublesize=8, byteorder=12345678
    d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=12
    ivtype=&#39;long long&#39;, ivsize=8, nvtype=&#39;double&#39;, nvsize=8,
Off_t=&#39;off_t&#39;, lseeksize=8
    alignbytes=8, prototype=define
  Linker and Libraries:
    ld=&#39;g++-4&#39;, ldflags =&#39; -Wl,--enable-auto-import
-Wl,--export-all-symbols -Wl,--stack,8388608
-Wl,--enable-auto-image-base -fstack-protector -L/usr/local/lib&#39;
    libpth=/usr/local/lib /usr/lib /lib
    libs=-lgdbm -ldb -ldl -lcrypt -lgdbm_compat
    perllibs=-ldl -lcrypt
    libc=/usr/lib/libc.a, so=dll, useshrplib=true, libperl=cygperl5_10.dll
    gnulibc_version=&#39;&#39;
  Dynamic Linking:
    dlsrc=dl_dlopen.xs, dlext=dll, d_dlsymun=undef, ccdlflags=&#39; &#39;
    cccdlflags=&#39; &#39;, lddlflags=&#39; --shared  -Wl,--enable-auto-import
-Wl,--export-all-symbols -Wl,--stack,8388608
-Wl,--enable-auto-image-base -L/usr/local/lib -fstack-protector&#39;


Characteristics of this binary &#40;from libperl&#41;: 
  Compile-time options: MULTIPLICITY MYMALLOC PERL_DONT_CREATE_GVSV
                        PERL_IMPLICIT_CONTEXT PERL_MAD PERL_USE_SAFE_PUTENV
                        USE_64_BIT_INT USE_ITHREADS USE_LARGE_FILES
                        USE_PERLIO USE_REENTRANT_API
  Locally applied patches:
        CYG11 no-bs
        CYG12 no archlib in otherlibdirs
        CYG14 Dynaloader
        CYG15 static-Win32CORE
        CYG17 utf8-paths
        CYG21 LibList-Kid.patch
        CYG22 cygwin-1.7 hints
        CYG23 544-stat
        CYG24 build man pages
        CYG25 rebase_privlib
        Module-Build-0.36_13
        Bug#55162 CYG18 File::Spec::case_tolerant performance
        disable ExtUtils::MakeMaker::Coverage in Sys-Syslog
  Built under cygwin
  Compiled at Aug 28 2010 20:17:29
  %ENV:
    PERLIO=&#34;perlio&#34;
    PERL_CORE=&#34;&#34;
    CYGWIN=&#34;nodosfilewarning&#34;
  @INC:
    /usr/lib/perl5/5.10/i686-cygwin
    /usr/lib/perl5/5.10
    /usr/lib/perl5/site_perl/5.10/i686-cygwin
    /usr/lib/perl5/site_perl/5.10
    /usr/lib/perl5/vendor_perl/5.10/i686-cygwin
    /usr/lib/perl5/vendor_perl/5.10
    /usr/lib/perl5/vendor_perl/5.10
    /usr/lib/perl5/site_perl/5.8
    /usr/lib/perl5/vendor_perl/5.8
    .
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;10&nbsp;05:34:52&nbsp;2011</span>
    <span class="description">willem [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Jerry,

This is quiet mysterious. Test nameservers are also spawn in
17-pure-virtual-replyhandler.t which *did* work in your case...
The major difference between those two tests is that 17 tries to find a
free port, and 13 uses port 5334.
I have modified test 13 to also test for a free port &#40;attached&#41;, could
you try it out and let me know if that is working?

Thanks! Willem
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 13-udp-trunc.t</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"># $Id: 13-udp-trunc.t 837 2009-12-30 10:23:25Z olaf $ -*-perl-*-
# Bulk of this code is contributed by Aaron Crane in 2008
# via rt.cpan.org ticket 33547
# Portions &#40;c&#41; 2009 Olaf Kolkman

use Test::More;
use strict;
use Data::Dumper;

my $ZONE = &#39;example.com&#39;;

use_ok&#40;&#39;Net::DNS::Nameserver&#39;&#41;;

use vars qw&#40;
	    $Address
	    $TestPort
            $numberoftests
	    &#41;;

sub freeport {
	my @sockets = map { IO::Socket::INET-&gt;new&#40;Listen =&gt; 1&#41; } &#40;1..shift&#41;;
	return map { $_-&gt;sockport } @sockets;
}

BEGIN{
    $TestPort  = 5334;
    $Address = &#34;127.0.0.1&#34;;

    $numberoftests=100;
    
    if&#40; eval {require IO::Socket;}&#41;{

	diag &#40;&#34;Test nameserver will be listening on port...&#34;&#41;;
	&#40;$TestPort&#41; = freeport&#40;1&#41;;
	diag &#40;&#34;$TestPort.&#34;&#41;;
	
	plan tests =&gt; $numberoftests;
    }else{
	
	plan skip_all =&gt; &#39;Some modules required for this test are not available &#40;dont\&#39;t worry about this&#41;&#39;;          
	exit;
    }
    
}


{
    my @full_response;
    my $ns = Net::DNS::Nameserver-&gt;new&#40;
        LocalPort    =&gt; $TestPort,
	LocalAddres  =&gt; $Address,
        ReplyHandler =&gt; sub { NOERROR =&gt; @full_response },
    &#41;;
    for &#40;trad_query&#40;&#41;, edns_query&#40;1024&#41;, edns_query&#40;2048&#41;&#41; {
        my &#40;$query, $size&#41; = @$_;
        for my $n &#40; 
	    [1, 1, 1],
	    [5, 1, 1],
	    [10, 1, 1],
	    [1, 1, 30],
	    [40, 40, 40],
	    [50, 1, 1],
	    [1, 50, 1],
	    [20, 20, 1],
	    [20, 1, 50],
	    [60, 60, 60],
	    [60, 100, 60],
	    &#41; {
            @full_response = make_response&#40;$n&#41;;
	    

	    my $notcomp=Net::DNS::Packet-&gt;new&#40;&#41;;
	    $notcomp-&gt;push&#40;&#34;question&#34;, $query-&gt;question&#41;;
	    my &#40;$ans, $auth, $add&#41;=@full_response;
	    $notcomp-&gt;push&#40;&#34;answer&#34;,	 @$ans&#41;  if $ans;
	    $notcomp-&gt;push&#40;&#34;authority&#34;,  @$auth&#41; if $auth;
	    $notcomp-&gt;push&#40;&#34;additional&#34;, @$add&#41;  if $add;
	    #$notcomp-&gt;print;
            my $socket = Mock::UDP-&gt;new&#40;$query-&gt;data&#41;;
            $ns-&gt;udp_connection&#40;$socket&#41;;
            my $reply_data = $socket-&gt;output;
	    my $reply = Net::DNS::Packet-&gt;new&#40;\$reply_data&#41;;
	    #$reply-&gt;print;
	    
	    cmp_ok&#40;length $reply_data, &#39;&lt;=&#39;, $size,
		   &#34;UDP-$size reply for\t&#40;$n-&gt;[0] , $n-&gt;[1], $n-&gt;[2]&#41;\t records short enough &#40;$size: &#34;.length&#40;$notcomp-&gt;data&#41; .&#34;-&gt;&#34;. length &#40; $reply_data &#41; . &#34;&#41;&#34;&#41; || $reply-&gt;print;
            ok&#40;$reply, &#34;UDP-$size reply for\t&#40;$n-&gt;[0] , $n-&gt;[1], $n-&gt;[2]&#41;\t received answer&#34;&#41;;
            my $got      = reply_records&#40;$reply&#41;;
            my $expected = response_records&#40;$query, @full_response&#41;;
            ok&#40;is_prefix&#40;$reply-&gt;header-&gt;tc, $got, $expected&#41;,
               &#34;UDP-$size reply for\t&#40;$n-&gt;[0] , $n-&gt;[1], $n-&gt;[2]&#41;\t records complete or sanely truncated&#34;&#41;;
        }
    }
}

sub trad_query {
    return [Net::DNS::Packet-&gt;new&#40;$ZONE&#41;, 512];
}

sub edns_query {
    my $size = shift;
    my $edns_rr = Net::DNS::RR-&gt;new&#40;type =&gt; &#39;OPT&#39;, class =&gt; $size, name =&gt; &#39;&#39;&#41;;
    my $query = Net::DNS::Packet-&gt;new&#40;$ZONE&#41;;
    $query-&gt;push&#40;additional =&gt; $edns_rr&#41;;
    return [$query, $size];
}

sub reply_records {
    my &#40;$reply&#41; = @_;
    my @records;
    for my $section &#40;qw&lt;question answer authority additional&gt;&#41; {
        push @records, map { [$section =&gt; $_] } $reply-&gt;$section;
    }
    return \@records;
}

sub response_records {
    my &#40;$query, @response&#41; = @_;
    unshift @response, [$query-&gt;question];
    my @records;
    for my $section &#40;qw&lt;question answer authority additional&gt;&#41; {
        push @records, map { [$section =&gt; $_] } @{ shift @response };
    }
    return \@records;
}

sub is_prefix {
    my &#40;$truncated, $got_list, $expected_list&#41; = @_;
    die &#39;TEST BUG: no records expected&#39; if !@$expected_list;
    if &#40;@$got_list &gt; @$expected_list&#41; {
        diag&#40;&#34;Most peculiar: got too many records&#34;&#41;;
        return 0;
    }
    my @seen;

    my $rr_got;
    my $rr_exp;

    # Start investigating the additonal section
    # if we find an RR with a certain &#40;name,class,type&#41; in the additonal section &#40;in got&#41; then
    # we expect all RRs from from that &#40;name,class,type&#41; from the expected array to be in the packet.

    # if a certain RR &#40;name,class,type&#41; from the expected array is not found in the packet than all
    # RRs from that set expect to be stripped.


    foreach my $tst &#40; @$expected_list &#41;{
	next unless $tst-&gt;[0] eq &#34;additional&#34;;
	$rr_exp-&gt;{$tst-&gt;[1]-&gt;name. &#34;--&#34;.
		      $tst-&gt;[1]-&gt;class. &#34;--&#34;.
		      $tst-&gt;[1]-&gt;type}{$tst-&gt;[1]-&gt;rdatastr} = 1;
	
    }

    foreach my $tst &#40; @$got_list &#41;{
	next unless $tst-&gt;[0] eq &#34;additional&#34;;
	$rr_got-&gt;{$tst-&gt;[1]-&gt;name. &#34;--&#34;.
		      $tst-&gt;[1]-&gt;class. &#34;--&#34;.
		      $tst-&gt;[1]-&gt;type}{$tst-&gt;[1]-&gt;rdatastr} = 1;
    }
	

    foreach my $a &#40;keys %$rr_exp&#41;{
	if &#40;defined $rr_got-&gt;{$a}&#41;{
	    foreach my $b &#40;keys %{$rr_got-&gt;{$a}}&#41;{
		if  &#40;defined&#40;$rr_exp-&gt;{$a}-&gt;{$b}&#41;&#41;{
		    delete $rr_got-&gt;{$a}-&gt;{$b};
		    delete $rr_exp-&gt;{$a}-&gt;{$b};
		}
		delete $rr_got-&gt;{$a} unless &#40;keys %{$rr_got-&gt;{$a}}&#41;;
		delete $rr_exp-&gt;{$a} unless &#40;keys %{$rr_exp-&gt;{$a}}&#41;;
	    }

	}else{
	    delete $rr_exp-&gt;{ $a }
	    
	}
    }

    if &#40;my @a=keys %$rr_exp&#41;{
	foreach my $a &#40; @a&#41; {
	    diag &#40;&#34;One RR of name-class-type $a got stripped from the packet while leaving others in the additional section&#34;&#41;;
	}
	return 0;
    }

    if &#40;my @b=keys %$rr_got&#41;{
	foreach my $b &#40; @b&#41; {
	    diag &#40;&#34;One RR of name-class-type $b did not get stripped from the additional section&#34;&#41;;
	}
	return 0;
    }



    
    for &#40;;;&#41; {
        #return !$truncated == !@$expected_list if !@$got_list;
	last if ! @$got_list;
        my $got      = shift @$got_list;
	push @seen, $got;
        my $expected = shift @$expected_list;
	my &#40;$got_s, $expected_s&#41; = map { $_-&gt;[1]-&gt;string } $got, $expected;


       	if &#40;$got-&gt;[0] eq &#34;additional&#34; &#38;&#38; $expected-&gt;[0] eq &#34;additional&#34;&#41;{
	    # this is the situation where we are looking at the truncated additional section.
	    # Since there are still records left the the TC bit should not be set.
	    if &#40;$truncated&#41;{
		diag &#40;&#34;There are still records in the additonal section but the truncation bit seems set&#34;&#41;;
		return 0;
	    }
	    next;
	}elsif &#40;$got-&gt;[0] ne $expected-&gt;[0] || $got_s ne $expected_s&#41; {
            diag&#40;&#34;Got[$got-&gt;[0] $got_s] Expected[$expected-&gt;[0] $expected_s]&#34;&#41;;
            return 0;
        }
    }

    return&#40;1&#41;;
    
}

sub make_response {
    my &#40;$n,$m,$p&#41; = @{shift&#40;&#41;};
    # create sets of nameservers ns0... ns2
    my @ans  = map { Net::DNS::RR-&gt;new&#40;&#34;$ZONE 9 IN A 10.0.0.$_&#34;&#41; } 1 .. $n;
    my @auth = map { Net::DNS::RR-&gt;new&#40;&#34;$ZONE 9 IN NS ns&#34;. $_%3 .&#34;.$ZONE&#34;&#41;    } 1 .. $m;
    my @add  = map { Net::DNS::RR-&gt;new&#40;&#34;ns&#34;. $_%3 .&#34;.$ZONE 9 IN A 10.0.1.&#34;.$_%256&#41; } 1 .. $p;
    return \@ans, \@auth, \@add;
}



{
package Mock::UDP;

sub new {
    my &#40;$class, $data&#41; = @_;
    return bless {
	input  =&gt; $data,
	output =&gt; &#39;&#39;,
    }, $class;
}

sub peerhost { &#39;127.0.0.1&#39; }
sub peerport { 65534 }
sub output   { $_[0]{output} }
sub sockhost {$main::Address}
sub sockport {$main::TestPort}
sub recv {
    my &#40;$self, $buf, $len&#41; = @_;
    return if $self-&gt;{input} eq &#39;&#39;;
    my $data = substr $self-&gt;{input}, 0, $len, &#39;&#39;;
    $_[1] = $data;
}

sub send {
    my &#40;$self, $data&#41; = @_;
    $self-&gt;{output} .= $data;
    1;
}
}
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;10&nbsp;05:34:53&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Give even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;10&nbsp;07:45:25&nbsp;2011</span>
    <span class="description">willem [...] cpan.org -  Given to WILLEM</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;10&nbsp;08:33:03&nbsp;2011</span>
    <span class="description">jdhedden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #72314] t/13-udp-trunc.t failures under Cygwin on Windows</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 10 Nov 2011 08:32:23 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-DNS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Jerry D. Hedden&#34; &lt;jdhedden [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Results are the same:

 Net-DNS-0.67 &gt; perl -Mblib /xfer/13-udp-trunc.t
# Test nameserver will be listening on port...
# 1388.
1..100
ok 1 - use Net::DNS::Nameserver;
Couldn&#39;t create TCP socket: Address family not supported by protocol
at /var/perl/cpan/build/Net-DNS-0.67/blib/lib/Net/DNS/Nameserver.pm
line 98
        Net::DNS::Nameserver::new&#40;&#39;Net::DNS::Nameserver&#39;, &#39;LocalPort&#39;,
1388, &#39;LocalAddres&#39;, 127.0.0.1, &#39;ReplyHandler&#39;, &#39;CODE&#40;0x1016d3c0&#41;&#39;&#41;
called at /xfer/13-udp-trunc.t line 53
Couldn&#39;t create UDP socket: Address family not supported by protocol
at /var/perl/cpan/build/Net-DNS-0.67/blib/lib/Net/DNS/Nameserver.pm
line 117
        Net::DNS::Nameserver::new&#40;&#39;Net::DNS::Nameserver&#39;, &#39;LocalPort&#39;,
1388, &#39;LocalAddres&#39;, 127.0.0.1, &#39;ReplyHandler&#39;, &#39;CODE&#40;0x1016d3c0&#41;&#39;&#41;
called at /xfer/13-udp-trunc.t line 53
Can&#39;t call method &#34;udp_connection&#34; on an undefined value at
/xfer/13-udp-trunc.t line 80.
# Looks like you planned 100 tests but ran 1.
# Looks like your test exited with 9 just after 1.


On Thu, Nov 10, 2011 at 05:34, Willem Toorop via RT
&lt;bug-Net-DNS@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=72314">https://rt.cpan.org/Ticket/Display.html?id=72314</a></span> &gt;
&gt;
&gt; Hi Jerry,
&gt;
&gt; This is quiet mysterious. Test nameservers are also spawn in
&gt; 17-pure-virtual-replyhandler.t which *did* work in your case...
&gt; The major difference between those two tests is that 17 tries to find a
&gt; free port, and 13 uses port 5334.
&gt; I have modified test 13 to also test for a free port &#40;attached&#41;, could
&gt; you try it out and let me know if that is working?
&gt;
&gt; Thanks! Willem
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;10&nbsp;10:26:57&nbsp;2011</span>
    <span class="description">willem [...] nlnetlabs.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #72314] t/13-udp-trunc.t failures under Cygwin on Windows</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 10 Nov 2011 16:26:44 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-DNS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Willem Toorop &lt;Willem [...] NLnetLabs.nl&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The silly thing is that the nameserver object doesn&#39;t even receive the
test queries over the socket &#40;that&#39;s were the Mock::UDP package in the
test is for&#41;.

Did you have this error with the 0.66 release too? If not, it might have
something to do with the disabling of IPv6...

-- Willem
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;10&nbsp;12:30:44&nbsp;2011</span>
    <span class="description">jdhedden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #72314] t/13-udp-trunc.t failures under Cygwin on Windows</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 10 Nov 2011 12:30:00 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-DNS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Jerry D. Hedden&#34; &lt;jdhedden [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Seems that Net::DNS comes pre-installed with the version of Perl I&#39;m using:
    Module:  Net::DNS
    Version: 0.66_01
    File:    /usr/lib/perl5/vendor_perl/5.10/i686-cygwin/Net/DNS.pm

When I tried to test v0.66 from CPAN, it fails all over the place
because of no Win32::Registry, and I can&#39;t install that because of
compilation errors &#40;Could not find a typemap for C type &#39;FILETIME&#39; in
Registry.xs, line 548&#41;.

Also, I don&#39;t know whether or not my Perl and/or PC handles IPv6.

On Thu, Nov 10, 2011 at 10:26, Willem Toorop via RT
&lt;bug-Net-DNS@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=72314">https://rt.cpan.org/Ticket/Display.html?id=72314</a></span> &gt;
&gt;
&gt; The silly thing is that the nameserver object doesn&#39;t even receive the
&gt; test queries over the socket &#40;that&#39;s were the Mock::UDP package in the
&gt; test is for&#41;.
&gt;
&gt; Did you have this error with the 0.66 release too? If not, it might have
&gt; something to do with the disabling of IPv6...
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;22&nbsp;08:42:56&nbsp;2011</span>
    <span class="description">willem [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The system I used for the 0.67 release unfortunately didn&#39;t produce the
error, so I woke up and older virtual machine with an older Cygwin
installation that I had lying around and it produces the error as well!

The error was actually in two places.
First in 13-udp-trunc.t there is a typo on line 61.

        LocalAddres  =&gt; $Address,

should become:

        LocalAddr    =&gt; $Address,

But, this wouldn&#39;t be a problem if not also the default address
selection in Net::DNS::Nameserver was broken. A fix for it is committed
in trunk and will be in the next Net::DNS release: 0.68.

Thanks for you report!

Willem
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;22&nbsp;08:42:58&nbsp;2011</span>
    <span class="description">willem [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
