<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #97269 for LMDB_File: Database/Transaction dependency is unclear</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #97269 for LMDB_File: Database/Transaction dependency is unclear</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=LMDB_File">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=LMDB_File">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=LMDB_File">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=LMDB_File">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/LMDB_File">LMDB_File CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">97269</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=LMDB_File">LMDB_File</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">sog [...] msg.com.mx
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
hyc [...] symas.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-251222-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.05    </td>
  </tr>
  <tr id="CF-251223-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=97269">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1387416" href="/Public/Bug/Display.html?id=97269#txn-1387416">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;15&nbsp;23:16:14&nbsp;2014</span>
    <span class="description">https://launchpad.net/~hyc -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Database/Transaction dependency is unclear</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1387416/736788/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/736788">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">It looks to me like the lifetime of a DB handle is bounded by the lifetime of a transaction. Which means a typical app that just grabs a DB handle once is performing all of its operations inside a single transaction. Or alternatively, if an app explicitly commits a txn, it must obtain a new DB handle when it obtains a new txn. I may have misunderstood the code, but that is definitely not how it should work.

DB handles are meant to be long-lived - once the txn in which a DB handle is created has committed, the DB handle is valid for the lifetime of that environment. &#40;It may be explicitly closed sooner, using mdb_dbi_close, but generally there is no good reason to do so.&#41;

Currently as I read it, you return [db,txn] pairs and the put/get ops will fail in _chkalive if the txn isn&#39;t currently valid. I see no way to associate a new txn to an existing DBI.

Also, it appears that you support only a single txn at a time, while LMDB itself supports 1 write txn and arbtirarily many read txns concurrently. Is that right?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1387826" href="/Public/Bug/Display.html?id=97269#txn-1387826">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;16&nbsp;17:52:51&nbsp;2014</span>
    <span class="description">sog [...] msg.com.mx -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1387826/737004/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/737004">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">El Mar Jul 15 23:16:14 2014, <span class="clickylink"><a target="new" rel="nofollow" href="https://launchpad.net/~hyc">https://launchpad.net/~hyc</a></span> escribió:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It looks to me like the lifetime of a DB handle is bounded by the
&gt; lifetime of a transaction. Which means a typical app that just grabs a
&gt; DB handle once is performing all of its operations inside a single
&gt; transaction. Or alternatively, if an app explicitly commits a txn, it
&gt; must obtain a new DB handle when it obtains a new txn. I may have
&gt; misunderstood the code, but that is definitely not how it should work.
</div>
You understood the code well, maybe I misuderstood something.

lmdb.h states that 

  &#34;All database operations require a transaction handle.&#34;

and in mdb_dbi_open 

         * The database handle will be private to the current transaction until
         * the transaction is successfully committed. If the transaction is
         * aborted the handle will be closed automatically.
         * After a successful commit the
         * handle will reside in the shared environment, and may be used
         * by other transactions.

So I assumed that a DB handle without a transaction is useless and if needed inside another transaction
is safer &#40;and cheaper&#41; to explicitly open it.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; DB handles are meant to be long-lived - once the txn in which a DB
&gt; handle is created has committed, the DB handle is valid for the
&gt; lifetime of that environment. &#40;It may be explicitly closed sooner,
&gt; using mdb_dbi_close, but generally there is no good reason to do so.&#41;
</div>
When a transaction terminates the Perl level &#34;LMDB_File&#34; object is
invalidated, but the low level DBI remains alive in the environment.
&#40;Unless implicitly closed if the transaction was aborted&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Currently as I read it, you return [db,txn] pairs and the put/get ops
&gt; will fail in _chkalive if the txn isn&#39;t currently valid. I see no way
&gt; to associate a new txn to an existing DBI.
</div>
At the Perl level I don&#39;t want to expose a &#34;naked&#34; DBI, so to associate
it with a new transaction, the user must &#34;open&#34; it again, a fast operation 
because, if already opened, mdb_dbi_open only &#40;re&#41;validates it.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Also, it appears that you support only a single txn at a time, while
&gt; LMDB itself supports 1 write txn and arbtirarily many read txns
&gt; concurrently. Is that right?
</div>
Yes, right now and per thread, the high level Perl API support only one
transaction at a time. I don&#39;t feel the need for more than one read transaction.
Can you show me an user case?

Regards.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1387827" href="/Public/Bug/Display.html?id=97269#txn-1387827">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;16&nbsp;17:52:51&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1398141" href="/Public/Bug/Display.html?id=97269#txn-1398141">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;13&nbsp;13:56:47&nbsp;2014</span>
    <span class="description">FRACTAL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1398141/742278/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/742278">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jul 16 17:52:51 2014, SORTIZ wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; El Mar Jul 15 23:16:14 2014, <span class="clickylink"><a target="new" rel="nofollow" href="https://launchpad.net/~hyc">https://launchpad.net/~hyc</a></span> escribió:
<div class="message-stanza open">&gt; &gt; DB handles are meant to be long-lived - once the txn in which a DB
&gt; &gt; handle is created has committed, the DB handle is valid for the
&gt; &gt; lifetime of that environment. &#40;It may be explicitly closed sooner,
&gt; &gt; using mdb_dbi_close, but generally there is no good reason to do so.&#41;
</div>&gt; 
&gt; When a transaction terminates the Perl level &#34;LMDB_File&#34; object is
&gt; invalidated, but the low level DBI remains alive in the environment.
&gt; &#40;Unless implicitly closed if the transaction was aborted&#41;
&gt; 
<div class="message-stanza open">&gt; &gt; Currently as I read it, you return [db,txn] pairs and the put/get ops
&gt; &gt; will fail in _chkalive if the txn isn&#39;t currently valid. I see no way
&gt; &gt; to associate a new txn to an existing DBI.
</div>&gt; 
&gt; At the Perl level I don&#39;t want to expose a &#34;naked&#34; DBI, so to
&gt; associate
&gt;  it with a new transaction, the user must &#34;open&#34; it again, a fast
&gt; operation
&gt; because, if already opened, mdb_dbi_open only &#40;re&#41;validates it.
</div>
I think Salvador&#39;s approach is reasonable. What is the advantage of re-using the DB in multiple transactions? Is constantly creating/destroying DBs for every transaction costly? &#40;How about costly relative to a perl method call? :&#41;

The perl interface feels very convenient to me, not requiring me to persist DB handles that I might need in subsequent transactions.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Also, it appears that you support only a single txn at a time, while
&gt; &gt; LMDB itself supports 1 write txn and arbtirarily many read txns
&gt; &gt; concurrently. Is that right?
</div>&gt; 
&gt; Yes, right now and per thread, the high level Perl API support only
&gt; one
&gt; transaction at a time. I don&#39;t feel the need for more than one read
&gt; transaction.
&gt; Can you show me an user case?
</div>
Salvador: There does seem to be some strangeness with having multiple transactions outstanding in the current env. If this isn&#39;t supported &#40;as probably makes sense in perl since there isn&#39;t really any threading&#41; could we maybe add some error detection and/or some notes in the docs?

Here is a simple program that trips an assertion when using two transactions simultaneously:


use strict;

use LMDB_File qw&#40;:flags :cursor_op&#41;;

mkdir&#40;&#34;junkdb&#34;&#41;;

my $env = LMDB::Env-&gt;new&#40;&#34;junkdb&#34;, { mapsize =&gt; 100 * 1024 * 1024 * 1024, }&#41;;

my $txn = $env-&gt;BeginTxn;
my $db = $txn-&gt;OpenDB&#40;{ dbname =&gt; &#34;rofl&#34;, flags =&gt; MDB_CREATE }&#41;;

my $txn2 = $env-&gt;BeginTxn;
my $db2 = $txn2-&gt;OpenDB&#40;{ dbname =&gt; &#34;rofl&#34;, flags =&gt; MDB_CREATE }&#41;;

$db-&gt;put&#40;&#34;hello&#34;, &#34;world&#34;&#41;;

$txn-&gt;commit;

$db2-&gt;get&#40;&#34;hello&#34;&#41;;


And running it:

$ perl tp.pl
perl: mdb.c:2916: mdb_txn_commit: Assertion `i == x&#39; failed.
Aborted &#40;core dumped&#41;


PS: Previously I tested the nested transaction support and that *does* seem to work as expected.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1409888" href="/Public/Bug/Display.html?id=97269#txn-1409888">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;11&nbsp;10:37:02&nbsp;2014</span>
    <span class="description">sog [...] msg.com.mx -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1409888/748368/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/748368">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 711b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">El Mié Ago 13 13:56:47 2014, FRACTAL escribió:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ...
&gt; Salvador: There does seem to be some strangeness with having multiple
&gt; transactions outstanding in the current env. If this isn&#39;t supported
&gt; &#40;as probably makes sense in perl since there isn&#39;t really any
&gt; threading&#41; could we maybe add some error detection and/or some notes
&gt; in the docs?
&gt; ...
</div>
This particular issue, which should have had its own ticket, was addressed.

Version 0.06 will be enforcing the rule that &#34;A parent transaction and
its cursors may not issue any other operations than commit and abort while
it has active child transactions.&#34;, avoiding the low level failed assertion.

For the main issue, I&#39;ll wait for Howard&#39;s feedback.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1409890" href="/Public/Bug/Display.html?id=97269#txn-1409890">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;11&nbsp;10:37:03&nbsp;2014</span>
    <span class="description">sog [...] msg.com.mx -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1409891" href="/Public/Bug/Display.html?id=97269#txn-1409891">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;11&nbsp;10:37:03&nbsp;2014</span>
    <span class="description">sog [...] msg.com.mx -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1409896" href="/Public/Bug/Display.html?id=97269#txn-1409896">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;11&nbsp;10:59:23&nbsp;2014</span>
    <span class="description">https://launchpad.net/~hyc -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1409896/748373/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/748373">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Aug 13 13:56:47 2014, FRACTAL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Jul 16 17:52:51 2014, SORTIZ wrote:
<div class="message-stanza open">&gt; &gt; At the Perl level I don&#39;t want to expose a &#34;naked&#34; DBI, so to
&gt; &gt; associate
&gt; &gt;  it with a new transaction, the user must &#34;open&#34; it again, a fast
&gt; &gt; operation
&gt; &gt; because, if already opened, mdb_dbi_open only &#40;re&#41;validates it.
</div>&gt; 
&gt; I think Salvador&#39;s approach is reasonable. What is the advantage of
&gt; re-using the DB in multiple transactions? Is constantly
&gt; creating/destroying DBs for every transaction costly? &#40;How about
&gt; costly relative to a perl method call? :&#41;
&gt; 
&gt; The perl interface feels very convenient to me, not requiring me to
&gt; persist DB handles that I might need in subsequent transactions.
</div>
A DBI handle is simply an integer, I don&#39;t believe it&#39;s especially cumbersome to maintain it.

The cost of opening it on every transaction is a linear search in LMDB&#39;s internal array of open handles, followed by a Btree search if it wasn&#39;t already open &#40;the handle wasn&#39;t found&#41;. I suppose, compared to a perl method call, all of this is cheap. But it&#39;s still unnecessary when you could simply remember the integer and use it directly on subsequent operations. If you have many transactions to perform, or many DBs in use simultaneously, the costs add up.

Ultimately you can do whatever is most convenient for you. Just understand that the API was designed for mdb_dbi_open to be called very infrequently - once at application startup - which is why it doesn&#39;t do anything more efficient than a linear search. If you have hundreds of DBs open simultaneously, it may get ugly.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1409897" href="/Public/Bug/Display.html?id=97269#txn-1409897">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;11&nbsp;10:59:24&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1410261" href="/Public/Bug/Display.html?id=97269#txn-1410261">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;12&nbsp;01:16:03&nbsp;2014</span>
    <span class="description">sog [...] msg.com.mx -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1410261/748585/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/748585">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">El Jue Sep 11 10:59:23 2014, <span class="clickylink"><a target="new" rel="nofollow" href="https://launchpad.net/~hyc">https://launchpad.net/~hyc</a></span> escribió:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Aug 13 13:56:47 2014, FRACTAL wrote:
<div class="message-stanza open">&gt; &gt; On Wed Jul 16 17:52:51 2014, SORTIZ wrote:
<div class="message-stanza open">&gt; &gt; &gt; At the Perl level I don&#39;t want to expose a &#34;naked&#34; DBI, so to
&gt; &gt; &gt; associate
&gt; &gt; &gt;  it with a new transaction, the user must &#34;open&#34; it again, a fast
&gt; &gt; &gt; operation
&gt; &gt; &gt; because, if already opened, mdb_dbi_open only &#40;re&#41;validates it.
</div>&gt; &gt;
&gt; &gt; I think Salvador&#39;s approach is reasonable. What is the advantage of
&gt; &gt; re-using the DB in multiple transactions? Is constantly
&gt; &gt; creating/destroying DBs for every transaction costly? &#40;How about
&gt; &gt; costly relative to a perl method call? :&#41;
&gt; &gt;
&gt; &gt; The perl interface feels very convenient to me, not requiring me to
&gt; &gt; persist DB handles that I might need in subsequent transactions.
</div>&gt; 
&gt; A DBI handle is simply an integer, I don&#39;t believe it&#39;s especially
&gt; cumbersome to maintain it.
&gt; 
&gt; The cost of opening it on every transaction is a linear search in
&gt; LMDB&#39;s internal array of open handles, followed by a Btree search if
&gt; it wasn&#39;t already open &#40;the handle wasn&#39;t found&#41;. I suppose, compared
&gt; to a perl method call, all of this is cheap. But it&#39;s still
&gt; unnecessary when you could simply remember the integer and use it
&gt; directly on subsequent operations. If you have many transactions to
&gt; perform, or many DBs in use simultaneously, the costs add up.
&gt; 
&gt; Ultimately you can do whatever is most convenient for you. Just
&gt; understand that the API was designed for mdb_dbi_open to be called
&gt; very infrequently - once at application startup - which is why it
&gt; doesn&#39;t do anything more efficient than a linear search. If you have
&gt; hundreds of DBs open simultaneously, it may get ugly.
</div>
Yes, I understand well.

For the next release I included a few new methods that expose and allow the reuse of
bare DBI handlers when the need arises.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.442235</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
