<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #133371 for Net-Telnet: Connections occasionally time out and cause errors</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #133371 for Net-Telnet: Connections occasionally time out and cause errors</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-Telnet/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-Telnet/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-Telnet/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-Telnet/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-Telnet">Net-Telnet CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">133371</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-Telnet/Active/">Net-Telnet</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
AsDaGo [...] posteo.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
gregoa [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-23316-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-23317-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;19&nbsp;23:36:32&nbsp;2020</span>
    <span class="description">AsDaGo [...] posteo.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Connections occasionally time out and cause errors</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 19 Sep 2020 23:27:01 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-Telnet [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Asher Gordon &lt;AsDaGo [...] posteo.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

I found this bug in Net::Telnet 3.04, but the supplied patch is patched
against 3.04_01 &#40;although it also applies against 3.04&#41;.

I used Net::Telnet to write a chat bot for the Free Internet Chess
Server &#40;freechess.org&#41;, called blikII. However, sometimes it seems to
timeout, but Net::Telnet does not recognize it as a timeout, and thus
does not flag it as such. I believe that the attached patch should fix
the problem, but I haven&#39;t tested it much.

Here is the output of &#39;perl -v&#39;:
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is perl 5, version 30, subversion 3 &#40;v5.30.3&#41; built for x86_64-linux-gnu-thread-multi
&#40;with 50 registered patches, see perl -V for more detail&#41;

Copyright 1987-2020, Larry Wall

Perl may be copied only under the terms of either the Artistic License or the
GNU General Public License, which may be found in the Perl 5 source kit.

Complete documentation for Perl, including FAQ lists, should be found on
this system using &#34;man perl&#34; or &#34;perldoc perl&#34;.  If you have access to the
Internet, point your browser at <span class="clickylink"><a target="new" rel="nofollow" href="http://www.perl.org/">http://www.perl.org/</a></span>, the Perl Home Page.
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">And my operating system version is Debian GNU/Linux 11 &#34;Bullseye&#34;. The
output of &#39;uname -a&#39; is as follows:

Linux Xanthus 5.8.0-1-amd64 #1 SMP Debian 5.8.7-1 &#40;2020-09-05&#41; x86_64 GNU/Linux

Also, I believe the error message was &#34;read error: Connection timed out
at &lt;...&gt;&#34; &#40;since errno &#40;$!&#41; was ETIMEDOUT&#41;.

Here is the patch which &#40;I believe&#41; fixes the problem:
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -pur Net-Telnet-3.04_01.orig/lib/Net/Telnet.pm Net-Telnet-3.04_01/lib/Net/Telnet.pm
--- Net-Telnet-3.04_01.orig/lib/Net/Telnet.pm	2020-02-17 08:12:07.000000000 -0500
+++ Net-Telnet-3.04_01/lib/Net/Telnet.pm	2020-09-19 23:02:58.031015494 -0400
@@ -43,6 +43,7 @@ my $AF_UNSPEC = &#38;_import_af_unspec&#40;&#41; ||
 my $AI_ADDRCONFIG = &#38;_import_ai_addrconfig&#40;&#41; || 0;
 my $EAI_BADFLAGS = &#38;_import_eai_badflags&#40;&#41; || -1;
 my $EINTR = &#38;_import_eintr&#40;&#41;;
+my $ETIMEDOUT = &#38;_import_etimedout&#40;&#41;;
 
 ## Global variables.
 use vars qw&#40;$VERSION @Telopts&#41;;
@@ -2602,6 +2603,12 @@ sub _fillbuf {
 		else {
 		    next if $! =~ /^interrupted/i;  # restart select&#40;&#41;
 		}
+		if &#40;defined $ETIMEDOUT&#41; {
+		    next if $! == $ETIMEDOUT;  # restart select&#40;&#41;
+		}
+		else {
+		    next if $! =~ /timed out/i;  # restart select&#40;&#41;
+		}
 
 		$s-&gt;{opened} = &#39;&#39;;
 		return $self-&gt;error&#40;&#34;read error: $!&#34;&#41;;
@@ -2628,6 +2635,12 @@ sub _fillbuf {
 	    else {
 		next if $! =~ /^interrupted/i;  # restart sysread&#40;&#41;
 	    }
+	    if &#40;defined $ETIMEDOUT&#41; {
+		next if $! == $ETIMEDOUT;  # restart sysread&#40;&#41;
+	    }
+	    else {
+		next if $! =~ /timed out/i;  # restart sysread&#40;&#41;
+	    }
 
 	    $s-&gt;{opened} = &#39;&#39;;
 	    return $self-&gt;error&#40;&#34;read error: $!&#34;&#41;;
@@ -2778,6 +2791,14 @@ sub _import_eintr {
 } # end sub _import_eintr
 
 
+sub _import_etimedout {
+    local $@;
+    local $SIG{&#34;__DIE__&#34;} = &#34;DEFAULT&#34;;
+
+    eval &#34;require Errno; Errno::ETIMEDOUT&#40;&#41;;&#34;;
+} # end sub _import_etimedout
+
+
 sub _interpret_cr {
     my &#40;$s, $pos&#41; = @_;
     my &#40;
@@ -3645,6 +3666,12 @@ sub _put {
 		else {
 		    next if $! =~ /^interrupted/i;  # restart select&#40;&#41;
 		}
+		if &#40;defined $ETIMEDOUT&#41; {
+		    next if $! == $ETIMEDOUT;  # restart select&#40;&#41;
+		}
+		else {
+		    next if $! =~ /timed out/i;  # restart select&#40;&#41;
+		}
 
 		$s-&gt;{opened} = &#39;&#39;;
 		return $self-&gt;error&#40;&#34;write error: $!&#34;&#41;;
@@ -3662,6 +3689,12 @@ sub _put {
 	    else {
 		next if $! =~ /^interrupted/i;  # restart syswrite&#40;&#41;
 	    }
+	    if &#40;defined $ETIMEDOUT&#41; {
+		next if $! == $ETIMEDOUT;  # restart syswrite&#40;&#41;
+	    }
+	    else {
+		next if $! =~ /timed out/i;  # restart syswrite&#40;&#41;
+	    }
 
 	    $s-&gt;{opened} = &#39;&#39;;
 	    return $self-&gt;error&#40;&#34;write error: $!&#34;&#41;;
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks,
Asher

-- 
Hi! I&#39;m a .signature virus! Copy me into your ~/.signature to help me sprea=
d!
                               --------
I prefer to send and receive mail encrypted. Please send me your
public key, and if you do not have my public key, please let me
know. Thanks.

GPG fingerprint: 38F3 975C D173 4037 B397  8095 D4C9 C4FC 5460 8E68
</div></div>
</div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;21&nbsp;22:30:38&nbsp;2020</span>
    <span class="description">jay [...] rgrs.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Asher, thanks for reaching out to me.

I understand you are sometimes getting the error message &#34;Connection timed out&#34; indicating the errno is ETIMEDOUT.  I do not agree this is a bug.  The errno ETIMEDOUT indicates the remote side did not respond to a keepalive.  Under this condition the correct action is to assume the connection is lost.

I cannot explain why it appears you are getting ETIMEOUT and you are able to continue reading.  If the server is on the Internet and you want to send me your code with the problem, I can try to debug the problem.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;21&nbsp;22:30:39&nbsp;2020</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;22&nbsp;01:06:07&nbsp;2020</span>
    <span class="description">AsDaGo [...] posteo.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #133371] Connections occasionally time out and cause errors</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 22 Sep 2020 01:05:40 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-Telnet [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Asher Gordon &lt;AsDaGo [...] posteo.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Jay,

&#34;Jay Rogers via RT&#34; &lt;bug-Net-Telnet@rt.cpan.org&gt; writes:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I understand you are sometimes getting the error message &#34;Connection
&gt; timed out&#34; indicating the errno is ETIMEDOUT.  I do not agree this is
&gt; a bug.  The errno ETIMEDOUT indicates the remote side did not respond
&gt; to a keepalive.  Under this condition the correct action is to assume
&gt; the connection is lost.
</div>
Well I don&#39;t know a lot about networking, but after applying the patch I
attached in my previous message, it seemed to stay connected. But it&#39;s
possible that happened just by chance too.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I cannot explain why it appears you are getting ETIMEOUT and you are
&gt; able to continue reading.  If the server is on the Internet and you
&gt; want to send me your code with the problem, I can try to debug the
&gt; problem.
</div>
I submitted my code to the Savannah software forge &#40;sv.nongnu.org&#41;, but
it hasn&#39;t been accepted yet, so I&#39;ve attached the code below. It will
require some modifications in order to be able to run as an unregistered
user on FICS, so it may not be easy for you to test it. I will try
running the code without my patch and see if the problem occurs again.

I will also try to write a more minimal script that shows the
problem. It&#39;s also possible that it could be a bug in FICS. Thanks a lot
for your help. Here is the code:
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks,
Asher

-- 
I hate quotations.
                -- Ralph Waldo Emerson
                               --------
I prefer to send and receive mail encrypted. Please send me your
public key, and if you do not have my public key, please let me
know. Thanks.

GPG fingerprint: 38F3 975C D173 4037 B397  8095 D4C9 C4FC 5460 8E68
</div></div>
</div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;22&nbsp;11:18:40&nbsp;2020</span>
    <span class="description">AsDaGo [...] posteo.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #133371] Connections occasionally time out and cause errors</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 22 Sep 2020 11:18:18 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-Telnet [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Asher Gordon &lt;AsDaGo [...] posteo.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Asher Gordon &lt;AsDaGo@posteo.net&gt; writes:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I will try running the code without my patch and see if the problem
&gt; occurs again.
</div>
I tried running the code without my patch, and it failed with an
ETIMEDOUT error after about nine hours. So I think I can definitely say
that my patch fixed the problem. I&#39;ll now try to write a more minimal
example and see if I can reproduce the bug with that.

Thanks,
Asher

-- 
I hate quotations.
                -- Ralph Waldo Emerson
                               --------
I prefer to send and receive mail encrypted. Please send me your
public key, and if you do not have my public key, please let me
know. Thanks.

GPG fingerprint: 38F3 975C D173 4037 B397  8095 D4C9 C4FC 5460 8E68
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;22&nbsp;11:41:20&nbsp;2020</span>
    <span class="description">gregoa [...] cpan.org -  Cc GREGOA added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;22&nbsp;12:23:45&nbsp;2020</span>
    <span class="description">AsDaGo [...] posteo.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #133371] Connections occasionally time out and cause errors</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 22 Sep 2020 12:23:25 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-Telnet [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Asher Gordon &lt;AsDaGo [...] posteo.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Asher Gordon &lt;AsDaGo@posteo.net&gt; writes:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ll now try to write a more minimal example and see if I can
&gt; reproduce the bug with that.
</div>
I now wrote a minimal example. I&#39;m running two instances of it now on
FICS. One is named TimeoutBotNoPatch and the other is named
TimeoutBotPatched. One is running with my patch and the other is not
&#40;can you guess which is which?&#41;. I&#39;m going to keep them running for a
day or two and see if my patch works on these bots.

You can run the code as a guest on FICS, so it should be easy for you to
test it if you want. If you want to change the handle that the bot uses,
just use the -n option or change the $name variable.

Also, I haven&#39;t tested this on any other servers besides FICS, so it&#39;s
possible that the problem only occurs on FICS. It does seem strange that
that would be the case, though...

Here is the code:
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/env perl

######################################################################
# TimeoutBot is a bot to test a timeout error                        #
# Copyright &#40;C&#41; 2020  Asher Gordon &lt;AsDaGo@posteo.net&gt;               #
#                                                                    #
# Copying and distribution of this file, with or without             #
# modification, are permitted in any medium without royalty provided #
# the copyright notice and this notice are preserved.  This file is  #
# offered as-is, without any warranty.                               #
######################################################################

use strict;
use warnings;
use Net::Telnet;
use Getopt::Long;
use subs &#39;tell&#39;; # Override CORE::tell with Main::tell functions

my $name = &#39;TimeoutBot&#39;;
my $host = &#39;freechess.org&#39;;
my $port = 5000;

# The time &#40;in seconds&#41; that we need to do something in order to
# prevent the server from kicking us off.
my $ping_time = 3600;

# The time of the last tell.
my $last_tell_time;

my $usage = &lt;&lt;EOF;
Usage: $0 [-n NAME] [-l FILE] [HOST [PORT]]
Connect to the chess server at HOST &#40;default $host&#41; through port PORT
&#40;default $port&#41; and start running.

  -n, --name=NAME       use NAME to log in rather than $name
  -l, --log-file=FILE   log all I/O to FILE
  -h, --help            print this help and exit
EOF

GetOptions
    &#39;n|name=s&#39;		=&gt; \$name,
    &#39;l|log-file=s&#39;	=&gt; \my $log_filename,
    &#39;h|help&#39;		=&gt; sub { print $usage; exit }
    or die $usage;

$host = shift if @ARGV;
$port = shift if @ARGV;
die if @ARGV;

die &#34;Invalid handle: $name&#34; unless $name =~ /^[[:alpha:]]+$/;
die &#34;Handle too long &#40;must be at most 17 characters&#41;: $name&#34;
    if &#40;length $name&#41; &gt; 17;

my $log_file;
if &#40;defined $log_filename &#38;&#38; ! open $log_file, &#39;&gt;&#39;, $log_filename&#41; {
    warn &#34;Cannot open $log_filename: $!&#34;;
    undef $log_filename;
    undef $log_file;
}

my $telnet;

# Die unless the error was a timeout.
sub die_unless_timeout {
    die $_[0] unless $telnet-&gt;timed_out;
}

sub tell {
    my $user = shift;
    my $msg = @_ ? &#34;@_&#34; : $_;
    my $ret = $telnet-&gt;cmd&#40;&#34;tell $user $msg&#34;&#41;;
    $last_tell_time = time;
    return $ret;
}

# Connect to the server.
print &#34;Opening connection to $host on port $port\n&#34;;
$telnet = new Net::Telnet
    Host	=&gt; $host,
    Port	=&gt; $port;
$telnet-&gt;input_log&#40;$log_file&#41; if defined $log_file;
$telnet-&gt;open;

# Log in.
print &#34;Waiting for login prompt\n&#34;;
$telnet-&gt;waitfor&#40;&#39;/\rlogin: $/&#39;&#41;;
print &#34;Logging in\n&#34;;
$telnet-&gt;print&#40;$name&#41;;
$telnet-&gt;print&#40;&#41;;

# Initialize the last tell time.
$last_tell_time = time;

# Wait for the prompt.
$telnet-&gt;waitfor&#40;&#39;/\rfics% /&#39;&#41;;

# Wait a bit for all the initialization text to finish coming.
sleep 1;

# Run the initialization commands.
$telnet-&gt;cmd&#40;&#39;set open 0&#39;&#41;;
$telnet-&gt;cmd&#40;&#39;set seek 0&#39;&#41;;
$telnet-&gt;cmd&#40;&#39;set width 240&#39;&#41;;
$telnet-&gt;cmd&#40;&#34;set interface $name&#34;&#41;;
$telnet-&gt;cmd&#40;&#39;set 1 I am a bot to test a timeout error that occurs &#39; .
	     &#39;with blikII.&#39;&#41;;

my $timeout = 10;

# Start the main loop.
while &#40;1&#41; {
    my $period = time - $last_tell_time;

    # Check if we should do something so that the server doesn&#39;t kick
    # us off. Allow for an extra grace period of $timeout.
    tell $name, &#39;ping&#39;
	if defined $ping_time &#38;&#38; $period &gt; $ping_time - $timeout;

    $_ = $telnet-&gt;getline&#40;Timeout =&gt; $timeout,
			  Errmode =&gt; \&#38;die_unless_timeout&#41;;
    next unless defined;
    chomp;
    s/^\r//;

    if &#40;/^&#40;[[:alpha:]]+&#41;.*? tells you:\s+&#40;.*&#41;$/&#41; {
	tell $1, qq/Hi $1. You told me &#34;$2&#34;./;
    }
}
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">-- 
&lt;cas&gt; well there ya go.  say something stupid in irc and have it
      immortalised forever in someone&#39;s .sig file
                               --------
I prefer to send and receive mail encrypted. Please send me your
public key, and if you do not have my public key, please let me
know. Thanks.

GPG fingerprint: 38F3 975C D173 4037 B397  8095 D4C9 C4FC 5460 8E68
</div></div>
</div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;22&nbsp;13:27:26&nbsp;2020</span>
    <span class="description">AsDaGo [...] posteo.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #133371] Connections occasionally time out and cause errors</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 22 Sep 2020 13:27:06 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-Telnet [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Asher Gordon &lt;AsDaGo [...] posteo.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Asher Gordon &lt;AsDaGo@posteo.net&gt; writes:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I now wrote a minimal example.
</div>
In the example, I forgot to close the telnet handle, which causes the
bot to remain logged in for an hour if it is killed. Here is a patch to
fix that:
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- timeout.pl~	2020-09-22 12:13:19.131749592 -0400
+++ timeout.pl	2020-09-22 13:23:03.308904610 -0400
@@ -81,6 +81,10 @@ $telnet = new Net::Telnet
 $telnet-&gt;input_log&#40;$log_file&#41; if defined $log_file;
 $telnet-&gt;open;
 
+$_ = sub { $telnet-&gt;close; exit }
+    foreach @SIG{qw&#40;INT PWR QUIT TERM&#41;};
+$SIG{__DIE__} = sub { $telnet-&gt;close; die @_ };
+
 # Log in.
 print &#34;Waiting for login prompt\n&#34;;
 $telnet-&gt;waitfor&#40;&#39;/\rlogin: $/&#39;&#41;;
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">-- 
A witty saying proves nothing, but saying something pointless gets
people&#39;s attention.
                               --------
I prefer to send and receive mail encrypted. Please send me your
public key, and if you do not have my public key, please let me
know. Thanks.

GPG fingerprint: 38F3 975C D173 4037 B397  8095 D4C9 C4FC 5460 8E68

**************************************************************
BONUS!!! BONUS!!! BONUS!!! BONUS!!! BONUS!!! BONUS!!! BONUS!!!
**************************************************************

You are the lucky recipient of one of my Flame Signatures&#40;TM&#41;!
Only one out of every 100 signatures is a Flame Signature&#40;TM&#41;!
A Flame Signature&#40;TM&#41; is a signature in which an auto-generated
flame &#40;generated by flame.el&#41; is included.

Here is the auto-generated flame for your reading pleasure.
WARNING: may be offensive &#40;that&#39;s kind of the point of flames&#41;.

V pbhyqa&#39;g pner yrff nobhg lbhe chax unvephg.  Vtabenzhf!  Ubj pna lbh
or fb yhqvpebhf?  Vg gnxrf n juvgr pbjneq yvxr lbh gb fnl gung
fhogyrgl vf cerggl sha.  V&#39;ir arire urneq nalguvat nf evqvphybhf nf
gur vqrn gung nyy penml qhqrf fubhyq trg fubccvat znyyf.
</div></div>
</div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;22&nbsp;14:06:48&nbsp;2020</span>
    <span class="description">AsDaGo [...] posteo.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #133371] Connections occasionally time out and cause errors</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 22 Sep 2020 14:06:18 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-Telnet [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Asher Gordon &lt;AsDaGo [...] posteo.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Asher Gordon &lt;AsDaGo@posteo.net&gt; writes:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In the example, I forgot to close the telnet handle, which causes the
&gt; bot to remain logged in for an hour if it is killed. Here is a patch
&gt; to fix that:
</div>
Ugh, I forgot a couple more important things. I need to make the bot
ignore tells from itself and I forgot to update $last_tell_time. Here is
a patch to fix those:
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- timeout.pl~	2020-09-22 13:23:03.308904610 -0400
+++ timeout.pl	2020-09-22 14:01:20.685688625 -0400
@@ -14,7 +14,8 @@ use strict;
 use warnings;
 use Net::Telnet;
 use Getopt::Long;
-use subs &#39;tell&#39;; # Override CORE::tell with Main::tell functions
+use v5.16;	       # For fc
+use subs &#39;tell&#39;;       # Override CORE::tell with Main::tell functions
 
 my $name = &#39;TimeoutBot&#39;;
 my $host = &#39;freechess.org&#39;;
@@ -126,7 +127,9 @@ while &#40;1&#41; {
     chomp;
     s/^\r//;
 
-    if &#40;/^&#40;[[:alpha:]]+&#41;.*? tells you:\s+&#40;.*&#41;$/&#41; {
+    if &#40;/^&#40;[[:alpha:]]+&#41;.*? tells you:\s+&#40;.*&#41;$/ &#38;&#38;
+	&#40;fc $1&#41; ne &#40;fc $name&#41;&#41; {
 	tell $1, qq/Hi $1. You told me &#34;$2&#34;./;
+	$last_tell_time = time;
     }
 }
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">If you&#39;re too lazy to apply both of my patches, here is the full code
again:
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks,
Asher

-- 
Yesterday upon the stair
I met a man who wasn&#39;t there.
He wasn&#39;t there again today --
I think he&#39;s from the CIA.
                               --------
I prefer to send and receive mail encrypted. Please send me your
public key, and if you do not have my public key, please let me
know. Thanks.

GPG fingerprint: 38F3 975C D173 4037 B397  8095 D4C9 C4FC 5460 8E68
</div></div>
</div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;22&nbsp;20:06:30&nbsp;2020</span>
    <span class="description">AsDaGo [...] posteo.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #133371] Connections occasionally time out and cause errors</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 22 Sep 2020 20:06:10 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-Telnet [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Asher Gordon &lt;AsDaGo [...] posteo.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">So far, the test without my patch did time out, and at about the same
time the other test &#40;with my patch&#41; started using up 100% CPU, as if it
had gotten stuck in an infinite loop. I actually did notice this with
blikII once or twice.

Strangely, however, this infinite loop seems to occur much less often
&#40;in blikII, at least&#41; than timing out without the patch. I&#39;m not sure,
though...

What I&#39;m going to do now is modify Net::Telnet to print a message
whenever ETIMEDOUT is caught. Then, I can see for sure whether it really
is possible to continue using the Net::Telnet handle even after
ETIMEDOUT.

Thanks,
Asher

-- 
On two occasions I have been asked [by members of Parliament!], &#34;Pray, Mr.
Babbage, if you put into the machine wrong figures, will the right answers
come out?&#34;  I am not able rightly to apprehend the kind of confusion of
ideas that could provoke such a question.
                -- Charles Babbage
                               --------
I prefer to send and receive mail encrypted. Please send me your
public key, and if you do not have my public key, please let me
know. Thanks.

GPG fingerprint: 38F3 975C D173 4037 B397  8095 D4C9 C4FC 5460 8E68
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;22&nbsp;21:23:26&nbsp;2020</span>
    <span class="description">jay [...] rgrs.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #133371] Connections occasionally time out and cause errors</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 22 Sep 2020 21:23:04 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-Telnet [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jay Rogers &lt;jay [...] rgrs.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">If you modify Net::Telnet to print a message whenever ETIMEDOUT is caught,
also have it indicate whether it is the select&#40;&#41; or sysread&#40;&#41; that is
returning with an error.
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;22&nbsp;23:52:32&nbsp;2020</span>
    <span class="description">AsDaGo [...] posteo.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> gregoa [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #133371] Connections occasionally time out and cause errors</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 22 Sep 2020 23:52:07 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;Jay Rogers via RT&#34; &lt;bug-Net-Telnet [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Asher Gordon &lt;AsDaGo [...] posteo.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Jay Rogers via RT&#34; &lt;bug-Net-Telnet@rt.cpan.org&gt; writes:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If you modify Net::Telnet to print a message whenever ETIMEDOUT is
&gt; caught, also have it indicate whether it is the select&#40;&#41; or sysread&#40;&#41;
&gt; that is returning with an error.
</div>
Well I did modify it to print a message, although I didn&#39;t think to
indicate whether it was select&#40;&#41; or sysread&#40;&#41; that returned the
error. It seemed to go into the infinite loop right after it got
ETIMEDOUT, but it&#39;s a bit hard to tell. Again, both tests &#40;with and
without the patch&#41; seemed to receive ETIMEDOUT and around the same time.

I&#39;ll now modify it to print whether it was select&#40;&#41; or sysread&#40;&#41; &#40;and
I&#39;ll use warn&#40;&#41; to print the source line as well&#41;. I&#39;ll also try sending
something to the server when I get an ETIMEDOUT error, so it&#39;s easier to
tell if that&#39;s actually possible after ETIMEDOUT.

So I think that you&#39;re probably right, that it&#39;s not a bug. Or that it&#39;s
a bug somewhere else. But I&#39;m going to run some more tests and see what
they indicate.

Thanks,
Asher

-- 
Hi! I&#39;m a .signature virus! Copy me into your ~/.signature to help me sprea=
d!
                               --------
I prefer to send and receive mail encrypted. Please send me your
public key, and if you do not have my public key, please let me
know. Thanks.

GPG fingerprint: 38F3 975C D173 4037 B397  8095 D4C9 C4FC 5460 8E68
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;23&nbsp;14:47:25&nbsp;2020</span>
    <span class="description">AsDaGo [...] posteo.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> gregoa [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #133371] Connections occasionally time out and cause errors</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 23 Sep 2020 14:47:02 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;Jay Rogers via RT&#34; &lt;bug-Net-Telnet [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Asher Gordon &lt;AsDaGo [...] posteo.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Asher Gordon &lt;AsDaGo@posteo.net&gt; writes:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So I think that you&#39;re probably right, that it&#39;s not a bug. Or that
&gt; it&#39;s a bug somewhere else. But I&#39;m going to run some more tests and
&gt; see what they indicate.
</div>
Well after running the tests overnight, neither of them timed out. I
think this could be because I had the test program send something to the
server every 10 seconds. So I tried running them without sending every
10 seconds, and it&#39;s been a little over three hours and neither of them
have timed out yet.

So I think it was probably something with my WiFi or the server or
something. Not a bug in the library. I think I was just confused because
of the similarity of the error messages &#40;&#34;FOO timed-out&#34; vs. &#34;read
error: Connection timed out&#34;&#41;. Like I said, I don&#39;t have much experience
with network programming.

So I think you can close this bug now. Sorry for leading you on a wild
goose chase. :-&#41;

Thanks,
Asher

-- 
On two occasions I have been asked [by members of Parliament!], &#34;Pray, Mr.
Babbage, if you put into the machine wrong figures, will the right answers
come out?&#34;  I am not able rightly to apprehend the kind of confusion of
ideas that could provoke such a question.
                -- Charles Babbage
                               --------
I prefer to send and receive mail encrypted. Please send me your
public key, and if you do not have my public key, please let me
know. Thanks.

GPG fingerprint: 38F3 975C D173 4037 B397  8095 D4C9 C4FC 5460 8E68
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;23&nbsp;20:16:55&nbsp;2020</span>
    <span class="description">AsDaGo [...] posteo.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> gregoa [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #133371] Connections occasionally time out and cause errors</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 23 Sep 2020 20:16:35 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;Jay Rogers via RT&#34; &lt;bug-Net-Telnet [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Asher Gordon &lt;AsDaGo [...] posteo.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The test with my patch timed out a while ago. Then, it said the
filehandle was closed when it tried to send something to the server. So
again, I&#39;m pretty sure it&#39;s either a problem on my end, or on the
server&#39;s end, not in the middle.

I&#39;m not sure how to close this issue, so you&#39;ll have to do that.

Thanks,
Asher

-- 
I hate quotations.
                -- Ralph Waldo Emerson
                               --------
I prefer to send and receive mail encrypted. Please send me your
public key, and if you do not have my public key, please let me
know. Thanks.

GPG fingerprint: 38F3 975C D173 4037 B397  8095 D4C9 C4FC 5460 8E68
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;23&nbsp;20:29:01&nbsp;2020</span>
    <span class="description">jay [...] rgrs.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #133371] Connections occasionally time out and cause errors</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 23 Sep 2020 20:28:37 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-Telnet [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jay Rogers &lt;jay [...] rgrs.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Asher,

I would still like to try to debug this.  I would like to understand why
either select&#40;&#41; or sysread&#40;&#41; is failing with ETIMEDOUT.  That should only
happen if SO_KEEPALIVE is enabled on the socket which by default it isn&#39;t.
I am wondering if something changed in perl 5.30 or Debian 11.

If you can get me access to your test code, I can try to figure it out.
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;24&nbsp;00:55:59&nbsp;2020</span>
    <span class="description">AsDaGo [...] posteo.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> gregoa [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #133371] Connections occasionally time out and cause errors</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 24 Sep 2020 00:55:37 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;Jay Rogers via RT&#34; &lt;bug-Net-Telnet [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Asher Gordon &lt;AsDaGo [...] posteo.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Jay,

&#34;Jay Rogers via RT&#34; &lt;bug-Net-Telnet@rt.cpan.org&gt; writes:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I would still like to try to debug this.  I would like to understand
&gt; why either select&#40;&#41; or sysread&#40;&#41; is failing with ETIMEDOUT.  That
&gt; should only happen if SO_KEEPALIVE is enabled on the socket which by
&gt; default it isn&#39;t.  I am wondering if something changed in perl 5.30 or
&gt; Debian 11.
</div>
Hmm, that&#39;s strange. Although I did modify Net::Telnet to say what
function caused the ETIMEDOUT error, I forgot which function it actually
was. So I&#39;m running it again now &#40;this time I have it die when it sees
ETIMEDOUT&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If you can get me access to your test code, I can try to figure it
&gt; out.
</div>
I think I already gave it to you, but here it is again:
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/env perl

######################################################################
# TimeoutBot is a bot to test a timeout error                        #
# Copyright &#40;C&#41; 2020  Asher Gordon &lt;AsDaGo@posteo.net&gt;               #
#                                                                    #
# Copying and distribution of this file, with or without             #
# modification, are permitted in any medium without royalty provided #
# the copyright notice and this notice are preserved.  This file is  #
# offered as-is, without any warranty.                               #
######################################################################

use strict;
use warnings;
use Net::Telnet;
use Getopt::Long;
use POSIX &#39;strftime&#39;;
use v5.16;	       # For fc
use subs &#39;tell&#39;;       # Override CORE::tell with Main::tell functions

my $name = &#39;TimeoutBot&#39;;
my $host = &#39;freechess.org&#39;;
my $port = 5000;

# The time &#40;in seconds&#41; that we need to do something in order to
# prevent the server from kicking us off.
my $ping_time = 3600;

# The time of the last tell.
my $last_tell_time;

my $usage = &lt;&lt;EOF;
Usage: $0 [-n NAME] [-l FILE] [HOST [PORT]]
Connect to the chess server at HOST &#40;default $host&#41; through port PORT
&#40;default $port&#41; and start running.

  -n, --name=NAME       use NAME to log in rather than $name
  -l, --log-file=FILE   log all I/O to FILE
  -h, --help            print this help and exit
EOF

GetOptions
    &#39;n|name=s&#39;		=&gt; \$name,
    &#39;l|log-file=s&#39;	=&gt; \my $log_filename,
    &#39;h|help&#39;		=&gt; sub { print $usage; exit }
    or die $usage;

$host = shift if @ARGV;
$port = shift if @ARGV;
die if @ARGV;

die &#34;Invalid handle: $name&#34; unless $name =~ /^[[:alpha:]]+$/;
die &#34;Handle too long &#40;must be at most 17 characters&#41;: $name&#34;
    if &#40;length $name&#41; &gt; 17;

my $log_file;
if &#40;defined $log_filename &#38;&#38; ! open $log_file, &#39;&gt;&#39;, $log_filename&#41; {
    warn &#34;Cannot open $log_filename: $!&#34;;
    undef $log_filename;
    undef $log_file;
}

my $telnet;

# Die unless the error was a timeout.
sub die_unless_timeout {
    die $_[0] unless $telnet-&gt;timed_out;
}

sub tell {
    my $user = shift;
    my $msg = @_ ? &#34;@_&#34; : $_;
    my $ret = $telnet-&gt;cmd&#40;&#34;tell $user $msg&#34;&#41;;
    $last_tell_time = time;
    return $ret;
}

# Return the time in a human-readable format.
sub get_time {
    strftime &#39;%Y-%m-%d %H:%M:%S&#39;, localtime;    
}

# Connect to the server.
print &#34;Opening connection to $host on port $port\n&#34;;
$telnet = new Net::Telnet
    Host	=&gt; $host,
    Port	=&gt; $port;
$telnet-&gt;input_log&#40;$log_file&#41; if defined $log_file;
$telnet-&gt;open;

$_ = sub { $telnet-&gt;close; exit }
    foreach @SIG{qw&#40;INT PWR QUIT TERM&#41;};
$SIG{__DIE__} = sub { $telnet-&gt;close; die $_[0] };
$SIG{__WARN__} = sub { warn get_time . &#34;: $_[0]&#34; };

# Log in.
print &#34;Waiting for login prompt\n&#34;;
$telnet-&gt;waitfor&#40;&#39;/\rlogin: $/&#39;&#41;;
print &#34;Logging in\n&#34;;
$telnet-&gt;print&#40;$name&#41;;
$telnet-&gt;print&#40;&#41;;

# Initialize the last tell time.
$last_tell_time = time;

# Wait for the prompt.
$telnet-&gt;waitfor&#40;&#39;/\rfics% /&#39;&#41;;

# Wait a bit for all the initialization text to finish coming.
sleep 1;

# Run the initialization commands.
$telnet-&gt;cmd&#40;&#39;set open 0&#39;&#41;;
$telnet-&gt;cmd&#40;&#39;set seek 0&#39;&#41;;
$telnet-&gt;cmd&#40;&#39;set width 240&#39;&#41;;
$telnet-&gt;cmd&#40;&#34;set interface $name&#34;&#41;;
$telnet-&gt;cmd&#40;&#39;set 1 I am a bot to test a timeout error that occurs &#39; .
	     &#39;with blikII.&#39;&#41;;

my $timeout = 10;

# Start the main loop.
while &#40;1&#41; {
    my $period = time - $last_tell_time;

    # Check if we should do something so that the server doesn&#39;t kick
    # us off. Allow for an extra grace period of $timeout.
    tell $name, &#39;ping&#39;
	if defined $ping_time &#38;&#38; $period &gt; $ping_time - $timeout;

    $_ = $telnet-&gt;getline&#40;Timeout =&gt; $timeout,
			  Errmode =&gt; \&#38;die_unless_timeout&#41;;
    next unless defined;

    chomp;
    s/^\r//;

    if &#40;/^&#40;[[:alpha:]]+&#41;.*? tells you:\s+&#40;.*&#41;$/ &#38;&#38;
	&#40;fc $1&#41; ne &#40;fc $name&#41;&#41; {
	tell $1, qq/Hi $1. You told me &#34;$2&#34;./;
	$last_tell_time = time;
    }
}
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Let me know if you figure it out.

Thanks,
Asher

P.S. Sorry about the long signature. I usually only add fairly short
ones to my collection, but this one was too good to waste &#40;at least I
think so&#41;. ;-&#41;

-- 
         A Plan for the Improvement of English Spelling
                    attributed to Mark Twain

        For example, in Year 1 that useless letter &#34;c&#34; would be dropped
to be replased either by &#34;k&#34; or &#34;s&#34;, and likewise &#34;x&#34; would no longer
be part of the alphabet.  The only kase in which &#34;c&#34; would be retained
would be the &#34;ch&#34; formation, which will be dealt with later.  Year 2
might reform &#34;w&#34; spelling, so that &#34;which&#34; and &#34;one&#34; would take the
same konsonant, wile Year 3 might well abolish &#34;y&#34; replasing it with
&#34;i&#34; and Iear 4 might fiks the &#34;g/j&#34; anomali wonse and for all.
        Jenerally, then, the improvement would kontinue iear bai iear
with Iear 5 doing awai with useless double konsonants, and Iears 6-12
or so modifaiing vowlz and the rimeining voist and unvoist konsonants.
Bai Iear 15 or sou, it wud fainali bi posibl tu meik ius ov thi
ridandant letez &#34;c&#34;, &#34;y&#34; and &#34;x&#34; -- bai now jast a memori in the maindz
ov ould doderez -- tu riplais &#34;ch&#34;, &#34;sh&#34;, and &#34;th&#34; rispektivli.
        Fainali, xen, aafte sam 20 iers ov orxogrefkl riform, wi wud
hev a lojikl, kohirnt speling in ius xrewawt xe Ingliy-spiking werld.
                               --------
I prefer to send and receive mail encrypted. Please send me your
public key, and if you do not have my public key, please let me
know. Thanks.

GPG fingerprint: 38F3 975C D173 4037 B397  8095 D4C9 C4FC 5460 8E68
</div></div>
</div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
