<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #13195 for Graph: add_vertex_get_id/add_edge_get_id&#40;&#41; return wrong result on first call</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #13195 for Graph: add_vertex_get_id/add_edge_get_id&#40;&#41; return wrong result on first call</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Graph/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Graph/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Graph/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Graph/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Graph">Graph CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">13195</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Graph/Active/">Graph</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
nospam-abuse [...] bloodgate.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-14928-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.65    </td>
  </tr>
  <tr id="CF-14929-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;10&nbsp;15:12:33&nbsp;2005</span>
    <span class="description">TELS [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> add_vertex_get_id/add_edge_get_id&#40;&#41; return wrong result on first call</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Moin,

the first time you call add_edge_get_id&#40;&#41;, you do not get back the expected ID &#34;0&#34;, but an array ref containing the IDs of the two nodes &#40;aka &#34;[0,1]&#34;&#41;. Here is a sample script to demonstrate the problem:

# cat graph.pl
#!/usr/bin/perl -w

use Graph;
use Data::Dumper;
use strict;

my $graph = Graph-&gt;new &#40;multiedged =&gt; 1&#41;;

for &#40;0..2&#41;
  {
  print &#34;Adding &#39;A&#39; - &#39;B&#39;\n&#34;;
  my $id = $graph-&gt;add_edge_get_id&#40; &#39;A&#39;, &#39;B&#39;&#41;;

  print Dumper&#40;$id&#41;;

  my @ids = $graph-&gt;get_multiedge_ids&#40;&#39;A&#39;,&#39;B&#39;&#41;;
  print &#34;IDs:\n&#34;, Dumper&#40;\@ids&#41;;
  }


# perl graph.pl
Adding &#39;A&#39; - &#39;B&#39;
$VAR1 = [
          0,
          1
        ];
IDs:
$VAR1 = [
          &#39;0&#39;
        ];
Adding &#39;A&#39; - &#39;B&#39;
$VAR1 = 1;
IDs:
$VAR1 = [
          &#39;1&#39;,
          &#39;0&#39;
        ];
Adding &#39;A&#39; - &#39;B&#39;
$VAR1 = 2;
IDs:
$VAR1 = [
          &#39;1&#39;,
          &#39;0&#39;,
          &#39;2&#39;
        ];

I am pretty sure it has something to do with &#34;0&#34; being false, while &#34;1&#34; etc is true. Starting the IDs simple with &#34;1&#34; might solve that, or find out if there is somewhere along the code path a &#34;$ID || ...&#34; :&#41;

Some misc. things I noticed while hunting the bug:

* add_vertex_get_id&#40;&#41; has the same problem &#40;returning &#39;A&#39; on first call instead of &#39;0&#39;&#41;
* Using &#34;return &#34; is a bit wastefull, I am sure you could eliminate it in a few places and thus improve performance :o&#41;
* add_edge_get_id&#40;&#41; always checks multiedged&#40;&#41;. This should be a per-graph flag, which can be queried fast. Maybe it even is, but traveling through the source it seems to call at least two subroutines to find this out and somewhere along the path I lost track at what it actually does to find out whether the graph is multiedged or not :&#41;
* The documentation for the multiedged methods could be a bit more verbose. For instance, it is unclear in what order get_multiedge_ids&#40;&#41; returns the results.
* Graph requires Data::Dumper. It would be better if it required it only inside _dump&#40;&#41; so that other modules do not get Data::Dumper just by loading Graph :&#41;

Thanx for your work &#40;sorry to cause you more :&#41;,

Tels
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;20&nbsp;05:01:57&nbsp;2005</span>
    <span class="description">JHI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[TELS - Fri Jun 10 15:12:33 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Moin,
&gt; 
&gt; the first time you call add_edge_get_id&#40;&#41;, you do not get back the
&gt;    expected ID &#34;0&#34;, but an array ref containing the IDs of the two
&gt;    nodes &#40;aka &#34;[0,1]&#34;&#41;. Here is a sample script to demonstrate the
&gt;    problem:
&gt; 
&gt; # cat graph.pl
&gt; #!/usr/bin/perl -w
&gt; 
&gt; use Graph;
&gt; use Data::Dumper;
&gt; use strict;
&gt; 
&gt; my $graph = Graph-&gt;new &#40;multiedged =&gt; 1&#41;;
&gt; 
&gt; for &#40;0..2&#41;
&gt;   {
&gt;   print &#34;Adding &#39;A&#39; - &#39;B&#39;\n&#34;;
&gt;   my $id = $graph-&gt;add_edge_get_id&#40; &#39;A&#39;, &#39;B&#39;&#41;;
&gt; 
&gt;   print Dumper&#40;$id&#41;;
&gt; 
&gt;   my @ids = $graph-&gt;get_multiedge_ids&#40;&#39;A&#39;,&#39;B&#39;&#41;;
&gt;   print &#34;IDs:\n&#34;, Dumper&#40;\@ids&#41;;
&gt;   }
&gt; 
&gt; 
&gt; # perl graph.pl
&gt; Adding &#39;A&#39; - &#39;B&#39;
&gt; $VAR1 = [
&gt;           0,
&gt;           1
&gt;         ];
&gt; IDs:
&gt; $VAR1 = [
&gt;           &#39;0&#39;
&gt;         ];
&gt; Adding &#39;A&#39; - &#39;B&#39;
&gt; $VAR1 = 1;
&gt; IDs:
&gt; $VAR1 = [
&gt;           &#39;1&#39;,
&gt;           &#39;0&#39;
&gt;         ];
&gt; Adding &#39;A&#39; - &#39;B&#39;
&gt; $VAR1 = 2;
&gt; IDs:
&gt; $VAR1 = [
&gt;           &#39;1&#39;,
&gt;           &#39;0&#39;,
&gt;           &#39;2&#39;
&gt;         ];
&gt; 
&gt; I am pretty sure it has something to do with &#34;0&#34; being false, while
&gt;    &#34;1&#34; etc is true. Starting the IDs simple with &#34;1&#34; might solve that,
&gt;    or find out if there is somewhere along the code path a &#34;$ID ||
&gt;    ...&#34; :&#41;
&gt; 
&gt; Some misc. things I noticed while hunting the bug:
&gt; 
&gt; * add_vertex_get_id&#40;&#41; has the same problem &#40;returning &#39;A&#39; on first
&gt;    call instead of &#39;0&#39;&#41;
&gt; * Using &#34;return &#34; is a bit wastefull, I am sure you could eliminate it
&gt;    in a few places and thus improve performance :o&#41;
&gt; * add_edge_get_id&#40;&#41; always checks multiedged&#40;&#41;. This should be a per-
&gt;    graph flag, which can be queried fast. Maybe it even is, but
&gt;    traveling through the source it seems to call at least two
&gt;    subroutines to find this out and somewhere along the path I lost
&gt;    track at what it actually does to find out whether the graph is
&gt;    multiedged or not :&#41;
&gt; * The documentation for the multiedged methods could be a bit more
&gt;    verbose. For instance, it is unclear in what order
&gt;    get_multiedge_ids&#40;&#41; returns the results.
&gt; * Graph requires Data::Dumper. It would be better if it required it
&gt;    only inside _dump&#40;&#41; so that other modules do not get Data::Dumper
&gt;    just by loading Graph :&#41;
&gt; 
&gt; Thanx for your work &#40;sorry to cause you more :&#41;,
&gt; 
&gt; Tels
</div>
Please retry with Graph 0.66.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;06&nbsp;06:09:49&nbsp;2005</span>
    <span class="description">JHI [...] cpan.org -  Status changed from &#39;new&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
