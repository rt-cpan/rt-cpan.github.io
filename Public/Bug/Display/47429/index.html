<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #47429 for DBD-DB2: DB2-Perl - fieldlength error because of Unicode Multibyte Character</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #47429 for DBD-DB2: DB2-Perl - fieldlength error because of Unicode Multibyte Character</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DBD-DB2/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DBD-DB2/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DBD-DB2/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DBD-DB2/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-DB2">DBD-DB2 CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">47429</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">2/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DBD-DB2/Active/">DBD-DB2</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">opendev [...] us.ibm.com
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
christian.miksch [...] at.ibm.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
Philipp-Michael.Guehring [...] unicreditgroup.at

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-10084-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
1.71</li>
<li>
1.84</li>
<li>
1.85</li>
</ul>
    </td>
  </tr>
  <tr id="CF-10085-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;29&nbsp;05:28:28&nbsp;2009</span>
    <span class="description">christian.miksch [...] at.ibm.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Philipp-Michael.Guehring [...] unicreditgroup.at,</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
I discovered an incompatibility between DBD::DB2 1.71 &#40;with DB2-Connect
V9.5&#41; and DB2 v9 on z/OS.

When I SELECT a  CHAR field that includes characters that are multi-byte
characters in UTF-8,

then DBD::DB2 only allocates the number of characters that the field has
in general &#40;SQL_DESC_DISPLAY_SIZE&#41;

as the amount of bytes, retrieves that many bytes from DB2, and cuts off
the rest of the field.


Example:


A field has the content &#34;Gühring&#34; and is defined as CHAR&#40;7&#41;.


The ü is a multi-byte character in UTF-8, therefore the string is 8 Bytes
long in UTF-8.


DBD::DB2 allocates only 7 bytes, discards the 8th byte, and returns
&#34;Gührin&#34; to my application, which completely breaks the application..


There are several issues:

·       For querying, how much memory is needed, you should use
SQL_DESC_OCTET_LENGTH instead of SQL_DESC_DISPLAY_SIZE, I guess.


·       Due to UTF-8 being dynamically multi-byte, the same CHAR field can
have various different lengthes for every row, so if you want to allocate
the needed memory dynamically, you have to allocate it on every row
individually &#40;like BLOB´s I guess&#41;, you can´t pre-allocate it for all rows.


A workaround that helps a bit is to do fbh-&gt;dsize*=4; on line 1199 in the
dbdimp.c , but that´s not the whole solution yet.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;29&nbsp;23:54:58&nbsp;2009</span>
    <span class="description">opendev [...] us.ibm.com -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Take odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;29&nbsp;23:55:03&nbsp;2009</span>
    <span class="description">opendev [...] us.ibm.com -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;30&nbsp;02:36:48&nbsp;2009</span>
    <span class="description">opendev [...] us.ibm.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> opendev [...] us.ibm.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Philipp

I would like to request you the following information to help me out
reproduce this problem.

1. Test case that helps me insert special characters into the table.
2. Sample create database statement with the correct codepage
example for Japanese Characters:- 
db2 CREATE DATABASE SJISDB USING CODESET IBM-943 TERRITORY JP


On Mon Jun 29 05:28:28 2009, Chris27x wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; I discovered an incompatibility between DBD::DB2 1.71 &#40;with DB2-Connect
&gt; V9.5&#41; and DB2 v9 on z/OS.
&gt; 
&gt; When I SELECT a  CHAR field that includes characters that are multi-byte
&gt; characters in UTF-8,
&gt; 
&gt; then DBD::DB2 only allocates the number of characters that the field has
&gt; in general &#40;SQL_DESC_DISPLAY_SIZE&#41;
&gt; 
&gt; as the amount of bytes, retrieves that many bytes from DB2, and cuts off
&gt; the rest of the field.
&gt; 
&gt; 
&gt; Example:
&gt; 
&gt; 
&gt; A field has the content &#34;Gühring&#34; and is defined as CHAR&#40;7&#41;.
&gt; 
&gt; 
&gt; The ü is a multi-byte character in UTF-8, therefore the string is 8 Bytes
&gt; long in UTF-8.
&gt; 
&gt; 
&gt; DBD::DB2 allocates only 7 bytes, discards the 8th byte, and returns
&gt; &#34;Gührin&#34; to my application, which completely breaks the application..
&gt; 
&gt; 
&gt; There are several issues:
&gt; 
&gt; ·       For querying, how much memory is needed, you should use
&gt; SQL_DESC_OCTET_LENGTH instead of SQL_DESC_DISPLAY_SIZE, I guess.
&gt; 
&gt; 
&gt; ·       Due to UTF-8 being dynamically multi-byte, the same CHAR field can
&gt; have various different lengthes for every row, so if you want to allocate
&gt; the needed memory dynamically, you have to allocate it on every row
&gt; individually &#40;like BLOB´s I guess&#41;, you can´t pre-allocate it for all
</div>rows.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; 
&gt; A workaround that helps a bit is to do fbh-&gt;dsize*=4; on line 1199 in the
&gt; dbdimp.c , but that´s not the whole solution yet.
</div>

-- 
Thanks
Tarun Pasrija
IBM OpenSource Application Development Team
India Software Labs, Bangalore &#40;India&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;30&nbsp;08:07:06&nbsp;2009</span>
    <span class="description">christian.miksch [...] at.ibm.com -  Fixed in 1.71 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;30&nbsp;08:07:06&nbsp;2009</span>
    <span class="description">christian.miksch [...] at.ibm.com -  Broken in 1.71 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;30&nbsp;08:09:34&nbsp;2009</span>
    <span class="description">christian.miksch [...] at.ibm.com -  Subject changed from &#40;no value&#41; to &#39;DB2-Perl - fieldlength error because of Unicode Multibyte Character&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;30&nbsp;10:48:00&nbsp;2009</span>
    <span class="description">Philipp-Michael.Guehring [...] unicreditgroup.at -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #47429] </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 30 Jun 2009 16:48:41 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-DBD-DB2 [...] rt.cpan.org&gt;, &lt;christian.miksch [...] at.ibm.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> GÜHRING Philipp &lt;Philipp-Michael.Guehring [...] unicreditgroup.at&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Tarun,

The table is defined as a normal EBCDIC table on z/OS, with the default values for Austria/Germany. I guess that you should also be able to reproduce it with a Japanese database. 

To insert data into the table, you can try this:
INSERT INTO EMPLOYEE &#40; EMP_ID, LASTNAME&#41; VALUES &#40; 10035, &#39;Gühring-ÄÖÜß&#39;&#41;;

Try to set the locale on the client computer to:
export LC_ALL=de_DE.UTF-8
export DB2CODEPAGE=1208
to reproduce the problem.

I previously forgot to add the error messages I get from DBD::DB2:
Warning: Data in column 1 has been truncated to 8 bytes.  A maximum of 13 bytes are available at ims.pl line 25.
Warning: Data in column 4 has been truncated to 8 bytes.  A maximum of 12 bytes are available at ims.pl line 25.
Warning: Data in column 0 has been truncated to 4018 bytes.  A maximum of 4049 bytes are available at ims.pl line 41.
Warning: Data in column 0 has been truncated to 4018 bytes.  A maximum of 4024 bytes are available at ims.pl line 48.
Warning: Data in column 0 has been truncated to 4018 bytes.  A maximum of 4019 bytes are available at ims.pl line 48.
Warning: Data in column 0 has been truncated to 4018 bytes.  A maximum of 4020 bytes are available at ims.pl line 48.

I will send you additional traces via email directly.

Best regards,
Philipp Gühring

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: IBM OpenDev via RT [mailto:bug-DBD-DB2@rt.cpan.org] 
Sent: Dienstag, 30. Juni 2009 08:37
To: christian.miksch@at.ibm.com
Cc: GÜHRING Philipp
Subject: [rt.cpan.org #47429] 

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=47429">https://rt.cpan.org/Ticket/Display.html?id=47429</a></span> &gt;

Hi Philipp

I would like to request you the following information to help me out
reproduce this problem.

1. Test case that helps me insert special characters into the table.
2. Sample create database statement with the correct codepage
example for Japanese Characters:- 
db2 CREATE DATABASE SJISDB USING CODESET IBM-943 TERRITORY JP


On Mon Jun 29 05:28:28 2009, Chris27x wrote:
<div class="message-stanza open">&gt; 
&gt; I discovered an incompatibility between DBD::DB2 1.71 &#40;with DB2-Connect
&gt; V9.5&#41; and DB2 v9 on z/OS.
&gt; 
&gt; When I SELECT a  CHAR field that includes characters that are multi-byte
&gt; characters in UTF-8,
&gt; 
&gt; then DBD::DB2 only allocates the number of characters that the field has
&gt; in general &#40;SQL_DESC_DISPLAY_SIZE&#41;
&gt; 
&gt; as the amount of bytes, retrieves that many bytes from DB2, and cuts off
&gt; the rest of the field.
&gt; 
&gt; 
&gt; Example:
&gt; 
&gt; 
&gt; A field has the content &#34;Gühring&#34; and is defined as CHAR&#40;7&#41;.
&gt; 
&gt; 
&gt; The ü is a multi-byte character in UTF-8, therefore the string is 8 Bytes
&gt; long in UTF-8.
&gt; 
&gt; 
&gt; DBD::DB2 allocates only 7 bytes, discards the 8th byte, and returns
&gt; &#34;Gührin&#34; to my application, which completely breaks the application..
&gt; 
&gt; 
&gt; There are several issues:
&gt; 
&gt; ·       For querying, how much memory is needed, you should use
&gt; SQL_DESC_OCTET_LENGTH instead of SQL_DESC_DISPLAY_SIZE, I guess.
&gt; 
&gt; 
&gt; ·       Due to UTF-8 being dynamically multi-byte, the same CHAR field can
&gt; have various different lengthes for every row, so if you want to allocate
&gt; the needed memory dynamically, you have to allocate it on every row
&gt; individually &#40;like BLOB´s I guess&#41;, you can´t pre-allocate it for all
</div>rows.
<div class="message-stanza open">&gt; 
&gt; 
&gt; A workaround that helps a bit is to do fbh-&gt;dsize*=4; on line 1199 in the
&gt; dbdimp.c , but that´s not the whole solution yet.
</div>

-- 
Thanks
Tarun Pasrija
IBM OpenSource Application Development Team
India Software Labs, Bangalore &#40;India&#41;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;30&nbsp;11:54:55&nbsp;2009</span>
    <span class="description">Philipp-Michael.Guehring [...] unicreditgroup.at -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #47429] </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 30 Jun 2009 17:55:33 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-DBD-DB2 [...] rt.cpan.org&gt;, &lt;christian.miksch [...] at.ibm.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> GÜHRING Philipp &lt;Philipp-Michael.Guehring [...] unicreditgroup.at&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Tarun,

I tested it on Windows now, and got the following results:

I tried it with the default configuration of DBD::DB2 1.71 on ActivePerl 5.10.0, with DB2-Connect v9.1.401.444.

Running it worked, and it gave a correct result in Windows - ANSI &#40;1252&#41; codepage. Nothing has been cut off.

Then I set the environment variable:
SET DB2CODEPAGE=1208

When I run it again, it gave lots of errors like &#34;Warning: Data in column 1 has been truncated to 4018 bytes. A maximum of 4033 bytes are available at ims.pl line 47&#34;, and buffer has been cut off again.

So you should be able to reproduce it by setting DB2CODEPAGE=1208 and having German Umlauts or Japanese characters in your table.

Best regards,
Philipp Gühring
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;02&nbsp;08:44:46&nbsp;2009</span>
    <span class="description">opendev [...] us.ibm.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> opendev [...] us.ibm.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Philipp

Sorry for little late reply. I was unable to reproduce the problem and
thus was tied up in trying the scenario you mentioned but finally
succeeded. :&#41;

Well, I also noticed that you mentioned when you run windows with
DB2Codepage set to 1252, it gives correct results. In our driver, we try
to get the entire information from the CLI itself and let it handle the
encodings. Thus, it is important for the client codepage to be correct.

If we see the Infocenter, 
<span class="clickylink"><a target="new" rel="nofollow" href="http://publib.boulder.ibm.com/infocenter/db2luw/v9r5/topic/com.ibm.db2.luw.admin.nls.doc/doc/r0004565.html">http://publib.boulder.ibm.com/infocenter/db2luw/v9r5/topic/com.ibm.db2.luw.admin.nls.doc/doc/r0004565.html</a></span>

we notice that for the Language DE and platform windows your client
codepage needs to be 1252 only and for Linux it needs to be 819 for
locale de_DE. I tried changing the DB2Codepage to 819 and this works fine. 

Changing the DISPLAY_SIZE to octet length does not help since there is a
mismatch in the codepages of the client and server and still truncation
would happen. Thus, while converting from EBCDIC server database to
UTF-8 on client truncation happens on incompatible codepages.

I believe creating the database mentioning the codeset and territory and
keeping the same configuration on the client too helps in case of 1208
and I have tried it too. Hope this helps.

On Tue Jun 30 11:54:55 2009, Philipp-Michael.Guehring@unicreditgroup.at
wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Tarun,
&gt; 
&gt; I tested it on Windows now, and got the following results:
&gt; 
&gt; I tried it with the default configuration of DBD::DB2 1.71 on
&gt; ActivePerl 5.10.0, with DB2-Connect v9.1.401.444.
&gt; 
&gt; Running it worked, and it gave a correct result in Windows - ANSI
&gt; &#40;1252&#41; codepage. Nothing has been cut off.
&gt; 
&gt; Then I set the environment variable:
&gt; SET DB2CODEPAGE=1208
&gt; 
&gt; When I run it again, it gave lots of errors like &#34;Warning: Data in
&gt; column 1 has been truncated to 4018 bytes. A maximum of 4033 bytes are
&gt; available at ims.pl line 47&#34;, and buffer has been cut off again.
&gt; 
&gt; So you should be able to reproduce it by setting DB2CODEPAGE=1208 and
&gt; having German Umlauts or Japanese characters in your table.
&gt; 
&gt; Best regards,
&gt; Philipp Gühring
</div>

-- 
Thanks
Tarun Pasrija
IBM OpenSource Application Development Team
India Software Labs, Bangalore &#40;India&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;03&nbsp;01:28:59&nbsp;2009</span>
    <span class="description">opendev [...] us.ibm.com -  Priority changed from &#40;no value&#41; to &#39;2&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;10&nbsp;07:36:49&nbsp;2013</span>
    <span class="description">JACOB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> opendev [...] us.ibm.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

if &#40; app_codepage != db_codepage&#41; {
  fbh-&gt;rlen = bufferSizeRequired = &#40;4*fbh-&gt;dsize&#41;+1;/* +1: STRING null terminator */
} else {
  fbh-&gt;rlen = bufferSizeRequired = fbh-&gt;dsize+1;/* +1: STRING null terminator */
}

I think this is the faulty logic here. It has evolved since the original report, but there&#39;s still one case where it fails: When application and database both use the same MBCS, e.g. 1208 &#40;UTF-8&#41;. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;10&nbsp;08:03:59&nbsp;2013</span>
    <span class="description">JACOB [...] cpan.org -  Broken in 1.84 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;10&nbsp;08:03:59&nbsp;2013</span>
    <span class="description">JACOB [...] cpan.org -  Broken in 1.85 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
