<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #83578 for Math-NumSeq: Iterated Totient uses too much memory</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #83578 for Math-NumSeq: Iterated Totient uses too much memory</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Math-NumSeq/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Math-NumSeq/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Math-NumSeq/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Math-NumSeq/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Math-NumSeq">Math-NumSeq CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">83578</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Math-NumSeq/Active/">Math-NumSeq</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
DANAJ [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-239868-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
56    </td>
  </tr>
  <tr id="CF-239869-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;23&nbsp;16:02:42&nbsp;2013</span>
    <span class="description">DANAJ [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Iterated Totient uses too much memory</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">time perl -MMath::NumSeq::Totient -E &#39;my $seq =
Math::NumSeq::Totient-&gt;new; foreach my $i &#40;1 .. 10_000_000&#41; {
my&#40;$i,$value&#41; = $seq-&gt;next; }&#39;

39.3s seconds and 1.4 GB of memory.

time perl -MMath::NumSeq::Totient -E &#39;my $seq =
Math::NumSeq::Totient-&gt;new; foreach my $i &#40;1 .. 10_000_000&#41; {
$seq-&gt;ith&#40;$i&#41;; }&#39;

28.1s and basically no memory.

It seems more efficient in time and *much* more efficient in space to
just calculate the totient each time.  Or come up with an alternate
sieve.  I get the same result when looking at smaller ranges such as 100k.


For comparison with Math::Prime::Util 0.21:

time perl -Iblib/lib -Iblib/arch -MMath::Prime::Util=:all -E &#39;foreach my
$i &#40;1 .. 10_000_000&#41; { euler_phi&#40;$i&#41;; }&#39;

27.6s  &#40;it&#39;s 19.8s if I remove the expensive input validation&#41;. 
Basically no memory since it is just factoring.

time perl -Iblib/lib -Iblib/arch -MMath::Prime::Util=:all -E
&#39;euler_phi&#40;1,10_000_000&#41;;&#39;

0.8s &#40;returns an array of all the totients using a sieve&#41;.  Can be
segmented to use a bit less memory.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;23&nbsp;18:32:10&nbsp;2013</span>
    <span class="description">DANAJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Since TotientCumulative uses the sieve from Totient, it also has the
memory and speed issues, whether iterated or not.

This hack makes TotientCumulative run slightly faster with next, and not
blow up memory:

  At top:
    *_ith_totient = \&#38;Math::NumSeq::Totient::ith;
  In rewind:
    $self-&gt;{&#39;sum&#39;} = -1;
  In next:
    return &#40;$i, $self-&gt;{&#39;sum&#39;} += _ith_totient&#40;$self,$i&#41;&#41;;

The sum change is a hack because Totient-&gt;ith&#40;0&#41; returns 1 instead of 0
like _totient_by_sieve&#40;0&#41;.  Technically it&#39;s undefined, but I think SAGE
has the right idea: &#34;We defined this to be the number of positive
integers &lt;= n that are relatively prime to n. Thus if n&lt;=0 then
euler_phi&#40;n&#41; is defined and equals 0.&#34;  I find that helpful for other
functions.

Timings for TotientCumulative with ... foreach my $i &#40;1..10_000_000&#41; {
my &#40;undef,$value&#41; = $seq-&gt;next; }:

  34.4s  Math::Prime::Util::euler_phi&#40;$i&#41;
  35.5s  _ith_totient&#40;$self,$i&#41;&#41;;
  40.7s  _totient_by_sieve&#40;$self,$i&#41;&#41;   ** 1.4GB of memory **

The next version of MPU will have a totient directly in XS which makes
the time 12-15s.  ith&#40;$i&#41; could be done using
List::Util::sum&#40;euler_phi&#40;0,$i&#41;&#41; which takes slightly over 1s for 10M.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;23&nbsp;18:32:10&nbsp;2013</span>
    <span class="description">DANAJ [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;23&nbsp;19:20:20&nbsp;2013</span>
    <span class="description">KRYDE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks.  I think the sieve was first and seemed like a good idea at the
time.  I didn&#39;t realize the prime factorization was now better.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Since TotientCumulative uses the sieve from Totient,
</div>
Yes, about four places share the sieve.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The sum change is a hack because Totient-&gt;ith&#40;0&#41; returns 1 instead of 0
&gt; like _totient_by_sieve&#40;0&#41;.  Technically it&#39;s undefined,
</div>
Hmm.  Perhaps it was never meant for i=0.  I probably mean i&lt;=0 in the
&#34;undef&#34; condition of the ith&#40;&#41; func of Totient.pm for a start.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ith&#40;$i&#41; could be done using
&gt; List::Util::sum&#40;euler_phi&#40;0,$i&#41;&#41; which takes slightly over 1s for 10M.
</div>
That pushes $i many return values on the stack does it &#40;the perl stack
that is&#41;?  Something done in chunks might be a compromise between size
and time.

I had meant to try calling some of your funcs as available, but never
got around to it.  In a few places I had the urge to try to support
bignums which are entirely small prime factors with some sort of limit
on the trial division based on the size of the input.  Doing so can
sometimes get answers when plotting big or slightly big numbers.  Though
where to put a limit is a bit arbitrary.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;23&nbsp;21:44:07&nbsp;2013</span>
    <span class="description">DANAJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Feb 23 19:20:20 2013, KRYDE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks.  I think the sieve was first and seemed like a good idea at the
&gt; time.  I didn&#39;t realize the prime factorization was now better.
</div>
It&#39;s also possible that different machines or arguments would result in
different timings.  I just did timing on a couple x86 Linux machines.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; The sum change is a hack because Totient-&gt;ith&#40;0&#41; returns 1 instead of 0
&gt; &gt; like _totient_by_sieve&#40;0&#41;.  Technically it&#39;s undefined,
</div>&gt; 
&gt; Hmm.  Perhaps it was never meant for i=0.  I probably mean i&lt;=0 in the
&gt; &#34;undef&#34; condition of the ith&#40;&#41; func of Totient.pm for a start.
</div>
Quite possible.  Apostol and Koblitz define it only for n &gt;= 1.  Hardy
and Wright define it as &#34;the number of positive integers not greater
than and prime to m, that is to say the number of integers n such that 0
&lt; n &lt;= m, &#40;n,m&#41; = 1&#34; which would support the idea that phi&#40;n&#41; = 0 for n
&lt;= 0.

Wolfram says:  &#34;By convention, phi&#40;0&#41;=1, although Mathematica defines
EulerPhi[0] equal to 0 for consistency with its FactorInteger[0] command.&#34;


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; ith&#40;$i&#41; could be done using
&gt; &gt; List::Util::sum&#40;euler_phi&#40;0,$i&#41;&#41; which takes slightly over 1s for 10M.
</div>&gt; 
&gt; That pushes $i many return values on the stack does it &#40;the perl stack
&gt; that is&#41;?  Something done in chunks might be a compromise between size
&gt; and time.
</div>
Yes, doing the one big sum could lead to big memory issues.  Segmenting
it would be better.  Right now MPU&#39;s ranged moebius function is
segmented, but the totient isn&#39;t.  It can still be helpful since the C
array is a lot smaller, but at some point I&#39;ll need to do it right.

I was interested in ranged totients for things like Project Euler
solutions, but I&#39;d never come across a need for the summation.  I added
the Mertens function separately for summing the Möbius function, as
there are efficient ways to calculate it.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I had meant to try calling some of your funcs as available, but never
&gt; got around to it.  In a few places I had the urge to try to support
&gt; bignums which are entirely small prime factors with some sort of limit
&gt; on the trial division based on the size of the input.  Doing so can
&gt; sometimes get answers when plotting big or slightly big numbers.  Though
&gt; where to put a limit is a bit arbitrary.
</div>
No problem -- there is something to be said for using well tested
modules.  The one thing it would allow is 64-bit &#40;or bignum&#41; support for
a lot of functions.  The fast prime_count and nth_prime might be nice. 
divisor_sum and jordan totient help with a few more OEIS series.  I&#39;ve
thought about making a list of OEIS sequences and the code to generate
them, especially for the ones where they&#39;re ~ one-liners.

As for the bignum idea, do you mean doing a gcd on primorials?  I have
some areas that do GCDs on primes up to 20046, but they&#39;re just for
speed of quick primality checking on big &#40;512 - 4096 bit&#41; numbers.  It&#39;s
very fast with GMP or Pari, but the default BigInt backend is deathly
slow for big GCDs.

It looks like for factoring on my 64-bit machine, MPU averages under 100
microseconds for factoring random 19-digit numbers.  Restricting to
numbers with no factors under 100 still results in times under 1
millisecond per number.  In fact, it&#39;s faster than calling
Math::Pari::factorint for almost all 64-bit inputs.  My SQUFOF code
could still use a little more optimization.  Pari is definitely better
once we get past 25 or so digits, as my ECM implementation is pretty
basic and I don&#39;t have a QS implemented.  Still, it should let you
factor most 30 digit numbers in under a second &#40;that&#39;s pathetic by the
standards of yafu, msieve, etc. but pretty good for Perl&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;03&nbsp;19:12:32&nbsp;2013</span>
    <span class="description">KRYDE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Feb 23 21:44:07 2013, DANAJ wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve
&gt; thought about making a list of OEIS sequences and the code to generate
&gt; them, especially for the ones where they&#39;re ~ one-liners.
</div>
I&#39;ve tried to catalogue the A-numbers of what I wrote, but mainly as a
cross reference rather than any attempt at coverage.  The easy ones tend
not to be very interesting, and the hard ones take work :-&#41;.  

&#40;Math::NumSeq::OEIS makes a sequence by A-number, and $seq-&gt;oeis_anum&#40;&#41;
is the A-number of a sequence if it has one and if I knew it to put it in.&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As for the bignum idea, do you mean doing a gcd on primorials?
</div>
Oh, no I just meant that say N=2^50 * 3^100 is a bignum but it&#39;s
entirely small prime factors so tractable for various calculations
involving the factorization.  Some of the &#34;path&#34; X,Y -&gt; N things I&#39;ve
tinkered with sometimes make such values.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;05&nbsp;16:43:32&nbsp;2013</span>
    <span class="description">DANAJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Mar 03 19:12:32 2013, KRYDE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Oh, no I just meant that say N=2^50 * 3^100 is a bignum but it&#39;s
&gt; entirely small prime factors so tractable for various calculations
&gt; involving the factorization.  Some of the &#34;path&#34; X,Y -&gt; N things I&#39;ve
&gt; tinkered with sometimes make such values.
</div>
I see.  I use something vaguely like that for the BLS primality proving
in Math::Prime::Util::GMP, where I can do the proof if I can get factors
up to &#40;n/2&#41;^1/3 of n-1.  I put in a quick option that does trial
division to 1000, some rounds of Pollard-Rho, then exits if it hasn&#39;t
found enough factors.  For regular is_prime on numbers less than 200
bits I have it run the quick option.  It only takes 2ms or so to prove
70% of 100-bit numbers &#40;admittedly I don&#39;t need to factor them all
completely&#41;.

It might be an interesting option to add something like that with an
external interface.  It could be done with alarms, but &#40;1&#41; not all
systems support them, and &#40;2&#41; we&#39;d like to get a partial factorization
back.  So just something like factor_partial&#40;$n, $effort&#41; where effort
is either a scale 1-3 or a time in ms &#40;which would be really
approximate&#41;.  It would return a list of factors which may not all be
prime.  It&#39;d be nice to have some way of indicating if it was a partial
factorization -- it could return &#40;[p,p,p],[c,c,c]&#41; instead I suppose &#40;p
being a prime factor, c being a composite factor&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;19&nbsp;02:13:50&nbsp;2014</span>
    <span class="description">DANAJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I think this can be closed.  It could always be optimized more, but the excessive memory use is gone.

Times on a different machine than in the original message.

59.8s 1447MB  Math::NumSeq 56  $seq-&gt;next
44.6s    5MB  Math::NumSeq 56  $seq-&gt;ith
70.5s    5MB  Math::NumSeq 67  $seq-&gt;next
41.4s    5MB  Math::NumSeq 67  $seq-&gt;ith
10.5s   10MB  MPU 0.36 individual calls
 5.3s   21MB  MPU 0.36 iterator using 100k ranges

I&#39;ve been trying to reduce the size of MPU.  Looks like 2MB of that is loading Math::BigInt, 3MB is the main PP code &#40;only used when XS and GMP can&#39;t do it&#41;, and 0.5MB is random primes.  It&#39;s under 5MB with those removed.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;27&nbsp;00:06:09&nbsp;2014</span>
    <span class="description">DANAJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">One last comment relating to the previous one...

<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/release/Math-Prime-Util">https://metacpan.org/release/Math-Prime-Util</a></span> 0.37 now uses less memory than using Math::NumSeq::PrimeFactorCount.  It also doesn&#39;t have any problems with numbers larger than 2^32  &#40;Math::NumSeq::Totient&#40;4294967296&#41; returns undef because Math::Factor::XS uses trial division&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;15&nbsp;19:52:29&nbsp;2014</span>
    <span class="description">KRYDE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Jan 19 02:13:50 2014, DANAJ wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think this can be closed.
</div>
Beaut, done.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;15&nbsp;19:52:29&nbsp;2014</span>
    <span class="description">KRYDE [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
