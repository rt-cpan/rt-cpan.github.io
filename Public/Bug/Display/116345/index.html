<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #116345 for libnet: TCP RST Issue using Net::Cmd / Net::FTP / Net::FTP::AutoReconnect</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #116345 for libnet: TCP RST Issue using Net::Cmd / Net::FTP / Net::FTP::AutoReconnect</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=libnet">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=libnet">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=libnet">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=libnet">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/libnet">libnet CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">116345</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=libnet">libnet</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
chris [...] neadwerx.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
gortan [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-18284-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-18285-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




0001-Override-timeout-method-in-Net-FTP-and-other-subclas.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1653105/887133/0001-Override-timeout-method-in-Net-FTP-and-other-subclas.patch">
Wed Jul 27 07:29:22 2016 (1.8k) by ppisar [...] redhat.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=116345">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1651025" href="/Public/Bug/Display.html?id=116345#txn-1651025">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;20&nbsp;15:21:38&nbsp;2016</span>
    <span class="description">chris [...] neadwerx.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> TCP RST Issue using Net::Cmd / Net::FTP / Net::FTP::AutoReconnect</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 20 Jul 2016 15:21:07 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-libnet [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Chris Autry &lt;chris [...] neadwerx.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1651025/885882/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/885882">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Greeting, we recently pulled the 3.09 update for Net::Cmd and began
experiencing failures to transfer and receive files using Net::FTP and
Net::FTP::AutoReconnect.

After a little debugging, we found the issue to be caused in Net::Cmd:
-our $VERSION = &#34;3.08&#34;;
+our $VERSION = &#34;3.09&#34;;
 our @ISA     = qw&#40;Exporter&#41;;
 our @EXPORT  = qw&#40;CMD_INFO CMD_OK CMD_MORE CMD_REJECT CMD_ERROR
CMD_PENDING&#41;;

@@ -190,6 +190,8 @@
   1;
 }

+sub timeout { 0 }
+
 sub _syswrite_with_timeout {
   my $cmd = shift;
   my $line = shift;
@@ -748,6 +750,12 @@

Removal of sub timeout { 0 } resolved the issue.

This can be reproduced by:

   - Initiating an FTP connection with a remote host in passive mode
   &#40;suggested setting the Debug =&gt; 1, Passive =&gt; 1 in Net::FTP constructor &#41;.
   - Running a LIST / NLST / etc command &#40;something that requires the
   opening of a second connection &#41;, Net::FTP::ls&#40;&#41; would work here.
   - Command will &#39;hang&#39;. &#40; Command channel still active however &#41;.


Symptoms of the problem include the following:

Error message &#40;in Debug mode&#41;:
Net::FTP: Net::Cmd::getline&#40;&#41;: unexpected EOF on command channel:  at
/usr/share/perl5/vendor_perl/Net/FTP/AutoReconnect.pm line 328.
Net::FTP::AutoReconnect Reconnecting to FTP server &lt;redacted&gt;

tcpdump shows the SYN, SYN-ACK, followed by RST instead of ACK.
netstat -tp | grep &lt;remote peer&gt; shows only command channel is active

Server was ruled out by executing commands using telnet on the remote host.

The following is our configuration and versions for OS, Perl, and
supporting libs:

   - Linux 3.10.0-327.4.4.el7.x86_64 &#40;CentOS 7&#41;
   - Perl 5.16
   - Net::Cmd version 3.09
   - Net::FTP version 2.27
   - Net::FTP::AutoReconnect version 0.3

Thank you


*___________________________________Chris Autry*
Nead Werx, Inc. | Senior Database Engineer
2323 Cumberland Parkway | Suite 201 | Atlanta, GA 30339
*T &lt;redacted&gt;*
chris@neadwerx.com | <span class="clickylink"><a target="new" rel="nofollow" href="http://www.neadwerx.com">http://www.neadwerx.com</a></span>
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1651025/885883/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/885883">with headers</a>
<br />
<span class="downloadcontenttype">text/html 5.6k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1651068" href="/Public/Bug/Display.html?id=116345#txn-1651068">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;20&nbsp;18:42:31&nbsp;2016</span>
    <span class="description">steve.m.hay [...] googlemail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #116345] TCP RST Issue using Net::Cmd / Net::FTP / Net::FTP::AutoReconnect</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 20 Jul 2016 23:42:19 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-libnet [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Steve Hay &lt;steve.m.hay [...] googlemail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1651068/885904/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/885904">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 20 Jul 2016 20:21, &#34;Chris Autry via RT&#34; &lt;bug-libnet@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Wed Jul 20 15:21:38 2016: Request 116345 was acted upon.
&gt; Transaction: Ticket created by chris@neadwerx.com
&gt;        Queue: libnet
&gt;      Subject: TCP RST Issue using Net::Cmd / Net::FTP /
</div>Net::FTP::AutoReconnect
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;    Broken in: &#40;no value&#41;
&gt;     Severity: &#40;no value&#41;
&gt;        Owner: Nobody
&gt;   Requestors: chris@neadwerx.com
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=116345">https://rt.cpan.org/Ticket/Display.html?id=116345</a></span> &gt;
&gt;
&gt;
&gt; Greeting, we recently pulled the 3.09 update for Net::Cmd and began
&gt; experiencing failures to transfer and receive files using Net::FTP and
&gt; Net::FTP::AutoReconnect.
&gt;
</div>[...]
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; The following is our configuration and versions for OS, Perl, and
&gt; supporting libs:
&gt;
&gt;    - Linux 3.10.0-327.4.4.el7.x86_64 &#40;CentOS 7&#41;
&gt;    - Perl 5.16
&gt;    - Net::Cmd version 3.09
&gt;    - Net::FTP version 2.27
&gt;    - Net::FTP::AutoReconnect version 0.3
&gt;
</div>
Thanks for the report. I&#39;m curious as to why you&#39;ve only pulled Net::Cmd
3.09, and still have an old Net::FTP &#40;2.27&#41;?

Does it make any difference if you update all of libnet to 3.09?
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1651068/885905/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/885905">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.5k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1651069" href="/Public/Bug/Display.html?id=116345#txn-1651069">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;20&nbsp;18:42:32&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1651320" href="/Public/Bug/Display.html?id=116345#txn-1651320">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;21&nbsp;08:30:16&nbsp;2016</span>
    <span class="description">gortan [...] cpan.org -  Cc GORTAN added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1651348" href="/Public/Bug/Display.html?id=116345#txn-1651348">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;21&nbsp;10:36:32&nbsp;2016</span>
    <span class="description">chris [...] neadwerx.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #116345] TCP RST Issue using Net::Cmd / Net::FTP / Net::FTP::AutoReconnect</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 21 Jul 2016 10:35:52 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-libnet [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Chris Autry &lt;chris [...] neadwerx.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1651348/886084/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/886084">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Apologies,  I mis-typed the version number. We are running Net::FTP version
2.77 on the server in question. Net::FTP::AutoReconnect is as version 0.3


*___________________________________Chris Autry*
Nead Werx, Inc. | Senior Database Engineer
2323 Cumberland Parkway | Suite 201 | Atlanta, GA 30339
*T 706.505.0505*
chris@neadwerx.com | <span class="clickylink"><a target="new" rel="nofollow" href="http://www.neadwerx.com">http://www.neadwerx.com</a></span>

On Wed, Jul 20, 2016 at 6:42 PM, steve.m.hay@googlemail.com via RT &lt;
bug-libnet@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=116345">https://rt.cpan.org/Ticket/Display.html?id=116345</a></span> &gt;
&gt;
&gt; On 20 Jul 2016 20:21, &#34;Chris Autry via RT&#34; &lt;bug-libnet@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; Wed Jul 20 15:21:38 2016: Request 116345 was acted upon.
&gt; &gt; Transaction: Ticket created by chris@neadwerx.com
&gt; &gt;        Queue: libnet
&gt; &gt;      Subject: TCP RST Issue using Net::Cmd / Net::FTP /
</div>&gt; Net::FTP::AutoReconnect
<div class="message-stanza open">&gt; &gt;    Broken in: &#40;no value&#41;
&gt; &gt;     Severity: &#40;no value&#41;
&gt; &gt;        Owner: Nobody
&gt; &gt;   Requestors: chris@neadwerx.com
&gt; &gt;       Status: new
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=116345">https://rt.cpan.org/Ticket/Display.html?id=116345</a></span> &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; Greeting, we recently pulled the 3.09 update for Net::Cmd and began
&gt; &gt; experiencing failures to transfer and receive files using Net::FTP and
&gt; &gt; Net::FTP::AutoReconnect.
&gt; &gt;
</div>&gt; [...]
<div class="message-stanza open">&gt; &gt;
&gt; &gt; The following is our configuration and versions for OS, Perl, and
&gt; &gt; supporting libs:
&gt; &gt;
&gt; &gt;    - Linux 3.10.0-327.4.4.el7.x86_64 &#40;CentOS 7&#41;
&gt; &gt;    - Perl 5.16
&gt; &gt;    - Net::Cmd version 3.09
&gt; &gt;    - Net::FTP version 2.27
&gt; &gt;    - Net::FTP::AutoReconnect version 0.3
&gt; &gt;
</div>&gt;
&gt; Thanks for the report. I&#39;m curious as to why you&#39;ve only pulled Net::Cmd
&gt; 3.09, and still have an old Net::FTP &#40;2.27&#41;?
&gt;
&gt; Does it make any difference if you update all of libnet to 3.09?
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1651348/886085/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/886085">with headers</a>
<br />
<span class="downloadcontenttype">text/html 3.5k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1651351" href="/Public/Bug/Display.html?id=116345#txn-1651351">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;21&nbsp;10:47:27&nbsp;2016</span>
    <span class="description">steve.m.hay [...] googlemail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #116345] TCP RST Issue using Net::Cmd / Net::FTP / Net::FTP::AutoReconnect</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 21 Jul 2016 15:47:17 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-libnet [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Steve Hay &lt;steve.m.hay [...] googlemail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1651351/886089/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/886089">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 467b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 21 Jul 2016 15:36, &#34;Chris Autry via RT&#34; &lt;bug-libnet@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;        Queue: libnet
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=116345">https://rt.cpan.org/Ticket/Display.html?id=116345</a></span> &gt;
&gt;
&gt; Apologies,  I mis-typed the version number. We are running Net::FTP
</div>version
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 2.77 on the server in question. Net::FTP::AutoReconnect is as version 0.3
&gt;
</div>
Net::FTP 2.77 is still an old version. All the libs in libnet have the same
version number now, so it should be 3.09, the same as Net::Cmd.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1651351/886090/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/886090">with headers</a>
<br />
<span class="downloadcontenttype">text/html 703b</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1651459" href="/Public/Bug/Display.html?id=116345#txn-1651459">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;21&nbsp;16:21:22&nbsp;2016</span>
    <span class="description">chris [...] neadwerx.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #116345] TCP RST Issue using Net::Cmd / Net::FTP / Net::FTP::AutoReconnect</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 21 Jul 2016 16:20:46 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-libnet [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Chris Autry &lt;chris [...] neadwerx.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1651459/886141/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/886141">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry, I was mistaken. Our Net::FTP / Cmd packages were both at 3.09. We
eventually downgraded to 2.29 for Net::Cmd and 2.77 for Net::FTP &#40;These
were pulled from a server which did not receive these package updates&#41;.
Additionally, we are using Timeout =&gt; 30 as the only constructor option for
Net::FTP.

Apologies for the confusion.


*___________________________________Chris Autry*
Nead Werx, Inc. | Senior Database Engineer
2323 Cumberland Parkway | Suite 201 | Atlanta, GA 30339
*T 706.505.0505*
chris@neadwerx.com | <span class="clickylink"><a target="new" rel="nofollow" href="http://www.neadwerx.com">http://www.neadwerx.com</a></span>

On Thu, Jul 21, 2016 at 10:47 AM, steve.m.hay@googlemail.com via RT &lt;
bug-libnet@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=116345">https://rt.cpan.org/Ticket/Display.html?id=116345</a></span> &gt;
&gt;
&gt; On 21 Jul 2016 15:36, &#34;Chris Autry via RT&#34; &lt;bug-libnet@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt; &gt;
&gt; &gt;        Queue: libnet
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=116345">https://rt.cpan.org/Ticket/Display.html?id=116345</a></span> &gt;
&gt; &gt;
&gt; &gt; Apologies,  I mis-typed the version number. We are running Net::FTP
</div>&gt; version
<div class="message-stanza open">&gt; &gt; 2.77 on the server in question. Net::FTP::AutoReconnect is as version 0.3
&gt; &gt;
</div>&gt;
&gt; Net::FTP 2.77 is still an old version. All the libs in libnet have the same
&gt; version number now, so it should be 3.09, the same as Net::Cmd.
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1651459/886142/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/886142">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.8k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1651596" href="/Public/Bug/Display.html?id=116345#txn-1651596">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;22&nbsp;03:52:53&nbsp;2016</span>
    <span class="description">shay [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1651596/886225/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/886225">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1003b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jul 21 16:21:22 2016, chris@neadwerx.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sorry, I was mistaken. Our Net::FTP / Cmd packages were both at 3.09.
&gt; We
&gt; eventually downgraded to 2.29 for Net::Cmd and 2.77 for Net::FTP
&gt; &#40;These
&gt; were pulled from a server which did not receive these package
&gt; updates&#41;.
&gt; Additionally, we are using Timeout =&gt; 30 as the only constructor
&gt; option for
&gt; Net::FTP.
&gt; 
&gt; Apologies for the confusion.
&gt; 
</div>
Are you able to supply a script that reproduces the failure? I&#39;ve followed the steps you gave earlier to reproduce the problem using a random FTP server, but it works as expected:

test.pl
-------
use strict;
use warnings;
use Net::FTP;
print &#34;Using Net::FTP $Net::FTP::VERSION\n&#34;;
my $ftp = Net::FTP-&gt;new&#40;
  Host =&gt; &#39;mirrors.uk2.net&#39;,
  Passive =&gt; 1,
  Timeout =&gt; 30&#41;
or die $@;
$ftp-&gt;login&#40;&#39;anonymous&#39;, undef&#41;;
print join&#40;&#34;\n&#34;, $ftp-&gt;ls&#40;&#41;&#41;, &#34;\n&#34;;
$ftp-&gt;quit&#40;&#41;;
print &#34;OK\n&#34;;

Output:
-------
C:\Dev\Temp&gt;perl test.pl
Using Net::FTP 3.09
debian
hirensbootcd
pub
ubuntu
ubuntu-releases
OK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1651676" href="/Public/Bug/Display.html?id=116345#txn-1651676">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;22&nbsp;09:11:54&nbsp;2016</span>
    <span class="description">chris [...] neadwerx.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> gortan [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #116345] TCP RST Issue using Net::Cmd / Net::FTP / Net::FTP::AutoReconnect</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 22 Jul 2016 09:11:14 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-libnet [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Chris Autry &lt;chris [...] neadwerx.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1651676/886281/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/886281">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Give this a shot. I tried it on the peers we are having issues with, as
well as a public Speedtest server I found:

#!/usr/bin/perl

$|=1;

use strict;
use warnings;

use Carp;
use Net::FTP;
use Data::Dumper&#40;&#41;;

my $cmd_version = $Net::FTP::VERSION;
my $ftp_version = $Net::FTP::VERSION;

print &#34;Net::CMD Version: $cmd_version\n&#34;;
print &#34;Net::FTP Version: $ftp_version\n&#34;;

my $ftp = Net::FTP-&gt;new&#40;
    &#39;speedtest.tele2.net&#39;,
    Timeout =&gt; 30,
    Passive =&gt; 1,
    Debug   =&gt; 1
&#41;;

unless&#40; $ftp &#41;
{
   croak &#39;Failed to create new FTP object&#39;;
}

unless&#40; $ftp-&gt;login&#40; &#39;anonymous&#39;, &#39;anonymous&#39; &#41; &#41;
{
   croak &#39;Unable to connect&#39;;
}

print &#34;Connected.\n&#34;;

$ftp-&gt;binary;
$ftp-&gt;cwd&#40; &#39;/&#39; &#41;;

my @files = $ftp-&gt;ls&#40;&#41;;

print &#34;Got files\n&#34;;
print Dumper&#40; @files &#41;;

$ftp-&gt;quit;
print &#34;Done\n&#34;;
exit 0;


Output:
Net::CMD Version: 3.09
Net::FTP Version: 3.09
Net::FTP&gt;&gt;&gt; Net::FTP&#40;3.09&#41;
Net::FTP&gt;&gt;&gt;   Exporter&#40;5.68&#41;
Net::FTP&gt;&gt;&gt;   Net::Cmd&#40;3.09&#41;
Net::FTP&gt;&gt;&gt;   IO::Socket::IP&#40;0.37&#41;
Net::FTP&gt;&gt;&gt;     IO::Socket&#40;1.34&#41;
Net::FTP&gt;&gt;&gt;       IO::Handle&#40;1.33&#41;
Net::FTP=GLOB&#40;0x12e6a20&#41;&lt;&lt;&lt; 220 &#40;vsFTPd 2.3.5&#41;
Net::FTP=GLOB&#40;0x12e6a20&#41;&gt;&gt;&gt; USER anonymous
Net::FTP=GLOB&#40;0x12e6a20&#41;&lt;&lt;&lt; 331 Please specify the password.
Net::FTP=GLOB&#40;0x12e6a20&#41;&gt;&gt;&gt; PASS ....
Net::FTP=GLOB&#40;0x12e6a20&#41;&lt;&lt;&lt; 230 Login successful.
Connected.
Net::FTP=GLOB&#40;0x12e6a20&#41;&gt;&gt;&gt; TYPE I
Net::FTP=GLOB&#40;0x12e6a20&#41;&lt;&lt;&lt; 200 Switching to Binary mode.
Net::FTP=GLOB&#40;0x12e6a20&#41;&gt;&gt;&gt; CWD /
Net::FTP=GLOB&#40;0x12e6a20&#41;&lt;&lt;&lt; 250 Directory successfully changed.
Net::FTP=GLOB&#40;0x12e6a20&#41;&gt;&gt;&gt; PASV
Net::FTP=GLOB&#40;0x12e6a20&#41;&lt;&lt;&lt; 227 Entering Passive Mode
&#40;90,130,70,73,115,229&#41;.
Net::FTP=GLOB&#40;0x12e6a20&#41;&gt;&gt;&gt; NLST
&lt;hangs&gt;

The speedtest&#39;s / directory should have a little over a dozen files ranging
from 1KB to 1000GB in size.



*___________________________________Chris Autry*
Nead Werx, Inc. | Senior Database Engineer
2323 Cumberland Parkway | Suite 201 | Atlanta, GA 30339
*T 706.505.0505*
chris@neadwerx.com | <span class="clickylink"><a target="new" rel="nofollow" href="http://www.neadwerx.com">http://www.neadwerx.com</a></span>

On Fri, Jul 22, 2016 at 3:52 AM, Steve Hay via RT &lt;bug-libnet@rt.cpan.org&gt;
wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=116345">https://rt.cpan.org/Ticket/Display.html?id=116345</a></span> &gt;
&gt;
&gt; On Thu Jul 21 16:21:22 2016, chris@neadwerx.com wrote:
<div class="message-stanza open">&gt; &gt; Sorry, I was mistaken. Our Net::FTP / Cmd packages were both at 3.09.
&gt; &gt; We
&gt; &gt; eventually downgraded to 2.29 for Net::Cmd and 2.77 for Net::FTP
&gt; &gt; &#40;These
&gt; &gt; were pulled from a server which did not receive these package
&gt; &gt; updates&#41;.
&gt; &gt; Additionally, we are using Timeout =&gt; 30 as the only constructor
&gt; &gt; option for
&gt; &gt; Net::FTP.
&gt; &gt;
&gt; &gt; Apologies for the confusion.
&gt; &gt;
</div>&gt;
&gt; Are you able to supply a script that reproduces the failure? I&#39;ve followed
&gt; the steps you gave earlier to reproduce the problem using a random FTP
&gt; server, but it works as expected:
&gt;
&gt; test.pl
&gt; -------
&gt; use strict;
&gt; use warnings;
&gt; use Net::FTP;
&gt; print &#34;Using Net::FTP $Net::FTP::VERSION\n&#34;;
&gt; my $ftp = Net::FTP-&gt;new&#40;
&gt;   Host =&gt; &#39;mirrors.uk2.net&#39;,
&gt;   Passive =&gt; 1,
&gt;   Timeout =&gt; 30&#41;
&gt; or die $@;
&gt; $ftp-&gt;login&#40;&#39;anonymous&#39;, undef&#41;;
&gt; print join&#40;&#34;\n&#34;, $ftp-&gt;ls&#40;&#41;&#41;, &#34;\n&#34;;
&gt; $ftp-&gt;quit&#40;&#41;;
&gt; print &#34;OK\n&#34;;
&gt;
&gt; Output:
&gt; -------
&gt; C:\Dev\Temp&gt;perl test.pl
&gt; Using Net::FTP 3.09
&gt; debian
&gt; hirensbootcd
&gt; pub
&gt; ubuntu
&gt; ubuntu-releases
&gt; OK
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1651676/886282/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/886282">with headers</a>
<br />
<span class="downloadcontenttype">text/html 6k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1651737" href="/Public/Bug/Display.html?id=116345#txn-1651737">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;22&nbsp;13:17:56&nbsp;2016</span>
    <span class="description">shay [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1651737/886312/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/886312">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jul 22 09:11:54 2016, chris@neadwerx.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Give this a shot. I tried it on the peers we are having issues with, as
&gt; well as a public Speedtest server I found:
&gt; 
&gt; #!/usr/bin/perl
&gt; 
&gt; $|=1;
&gt; 
&gt; use strict;
&gt; use warnings;
&gt; 
&gt; use Carp;
&gt; use Net::FTP;
&gt; use Data::Dumper&#40;&#41;;
&gt; 
&gt; my $cmd_version = $Net::FTP::VERSION;
&gt; my $ftp_version = $Net::FTP::VERSION;
&gt; 
&gt; print &#34;Net::CMD Version: $cmd_version\n&#34;;
&gt; print &#34;Net::FTP Version: $ftp_version\n&#34;;
&gt; 
&gt; my $ftp = Net::FTP-&gt;new&#40;
&gt;     &#39;speedtest.tele2.net&#39;,
&gt;     Timeout =&gt; 30,
&gt;     Passive =&gt; 1,
&gt;     Debug   =&gt; 1
&gt; &#41;;
&gt; 
&gt; unless&#40; $ftp &#41;
&gt; {
&gt;    croak &#39;Failed to create new FTP object&#39;;
&gt; }
&gt; 
&gt; unless&#40; $ftp-&gt;login&#40; &#39;anonymous&#39;, &#39;anonymous&#39; &#41; &#41;
&gt; {
&gt;    croak &#39;Unable to connect&#39;;
&gt; }
&gt; 
&gt; print &#34;Connected.\n&#34;;
&gt; 
&gt; $ftp-&gt;binary;
&gt; $ftp-&gt;cwd&#40; &#39;/&#39; &#41;;
&gt; 
&gt; my @files = $ftp-&gt;ls&#40;&#41;;
&gt; 
&gt; print &#34;Got files\n&#34;;
&gt; print Dumper&#40; @files &#41;;
&gt; 
&gt; $ftp-&gt;quit;
&gt; print &#34;Done\n&#34;;
&gt; exit 0;
&gt; 
&gt; 
&gt; Output:
&gt; Net::CMD Version: 3.09
&gt; Net::FTP Version: 3.09
&gt; Net::FTP&gt;&gt;&gt; Net::FTP&#40;3.09&#41;
&gt; Net::FTP&gt;&gt;&gt;   Exporter&#40;5.68&#41;
&gt; Net::FTP&gt;&gt;&gt;   Net::Cmd&#40;3.09&#41;
&gt; Net::FTP&gt;&gt;&gt;   IO::Socket::IP&#40;0.37&#41;
&gt; Net::FTP&gt;&gt;&gt;     IO::Socket&#40;1.34&#41;
&gt; Net::FTP&gt;&gt;&gt;       IO::Handle&#40;1.33&#41;
&gt; Net::FTP=GLOB&#40;0x12e6a20&#41;&lt;&lt;&lt; 220 &#40;vsFTPd 2.3.5&#41;
&gt; Net::FTP=GLOB&#40;0x12e6a20&#41;&gt;&gt;&gt; USER anonymous
&gt; Net::FTP=GLOB&#40;0x12e6a20&#41;&lt;&lt;&lt; 331 Please specify the password.
&gt; Net::FTP=GLOB&#40;0x12e6a20&#41;&gt;&gt;&gt; PASS ....
&gt; Net::FTP=GLOB&#40;0x12e6a20&#41;&lt;&lt;&lt; 230 Login successful.
&gt; Connected.
&gt; Net::FTP=GLOB&#40;0x12e6a20&#41;&gt;&gt;&gt; TYPE I
&gt; Net::FTP=GLOB&#40;0x12e6a20&#41;&lt;&lt;&lt; 200 Switching to Binary mode.
&gt; Net::FTP=GLOB&#40;0x12e6a20&#41;&gt;&gt;&gt; CWD /
&gt; Net::FTP=GLOB&#40;0x12e6a20&#41;&lt;&lt;&lt; 250 Directory successfully changed.
&gt; Net::FTP=GLOB&#40;0x12e6a20&#41;&gt;&gt;&gt; PASV
&gt; Net::FTP=GLOB&#40;0x12e6a20&#41;&lt;&lt;&lt; 227 Entering Passive Mode
&gt; &#40;90,130,70,73,115,229&#41;.
&gt; Net::FTP=GLOB&#40;0x12e6a20&#41;&gt;&gt;&gt; NLST
&gt; &lt;hangs&gt;
&gt; 
&gt; The speedtest&#39;s / directory should have a little over a dozen files ranging
&gt; from 1KB to 1000GB in size.
&gt; 
&gt; 
</div>
That works fine for me &#40;with a fix to import the Dumper function from Data::Dumper&#41;:

C:\Dev\Temp&gt;perl test2.pl
Net::CMD Version: 3.09
Net::FTP Version: 3.09
Net::FTP&gt;&gt;&gt; Net::FTP&#40;3.09&#41;
Net::FTP&gt;&gt;&gt;   Exporter&#40;5.71&#41;
Net::FTP&gt;&gt;&gt;   Net::Cmd&#40;3.09&#41;
Net::FTP&gt;&gt;&gt;   IO::Socket::SSL&#40;2.012&#41;
Net::FTP&gt;&gt;&gt;     IO::Socket::IP&#40;0.29&#41;
Net::FTP&gt;&gt;&gt;       IO::Socket&#40;1.38&#41;
Net::FTP&gt;&gt;&gt;         IO::Handle&#40;1.35&#41;
Net::FTP=GLOB&#40;0x2a2d9a8&#41;&lt;&lt;&lt; 220 &#40;vsFTPd 2.3.5&#41;
Net::FTP=GLOB&#40;0x2a2d9a8&#41;&gt;&gt;&gt; USER anonymous
Net::FTP=GLOB&#40;0x2a2d9a8&#41;&lt;&lt;&lt; 331 Please specify the password.
Net::FTP=GLOB&#40;0x2a2d9a8&#41;&gt;&gt;&gt; PASS ....
Net::FTP=GLOB&#40;0x2a2d9a8&#41;&lt;&lt;&lt; 230 Login successful.
Connected.
Net::FTP=GLOB&#40;0x2a2d9a8&#41;&gt;&gt;&gt; TYPE I
Net::FTP=GLOB&#40;0x2a2d9a8&#41;&lt;&lt;&lt; 200 Switching to Binary mode.
Net::FTP=GLOB&#40;0x2a2d9a8&#41;&gt;&gt;&gt; CWD /
Net::FTP=GLOB&#40;0x2a2d9a8&#41;&lt;&lt;&lt; 250 Directory successfully changed.
Net::FTP=GLOB&#40;0x2a2d9a8&#41;&gt;&gt;&gt; PASV
Net::FTP=GLOB&#40;0x2a2d9a8&#41;&lt;&lt;&lt; 227 Entering Passive Mode &#40;90,130,70,73,116,239&#41;.
Net::FTP=GLOB&#40;0x2a2d9a8&#41;&gt;&gt;&gt; NLST
Net::FTP=GLOB&#40;0x2a2d9a8&#41;&lt;&lt;&lt; 150 Here comes the directory listing.
Net::FTP=GLOB&#40;0x2a2d9a8&#41;&lt;&lt;&lt; 226 Directory send OK.
Got files
$VAR1 = &#39;1000GB.zip&#39;;
$VAR2 = &#39;100GB.zip&#39;;
$VAR3 = &#39;100KB.zip&#39;;
$VAR4 = &#39;100MB.zip&#39;;
$VAR5 = &#39;10GB.zip&#39;;
$VAR6 = &#39;10MB.zip&#39;;
$VAR7 = &#39;1GB.zip&#39;;
$VAR8 = &#39;1KB.zip&#39;;
$VAR9 = &#39;1MB.zip&#39;;
$VAR10 = &#39;200MB.zip&#39;;
$VAR11 = &#39;20MB.zip&#39;;
$VAR12 = &#39;2MB.zip&#39;;
$VAR13 = &#39;3MB.zip&#39;;
$VAR14 = &#39;500MB.zip&#39;;
$VAR15 = &#39;50MB.zip&#39;;
$VAR16 = &#39;512KB.zip&#39;;
$VAR17 = &#39;5MB.zip&#39;;
$VAR18 = &#39;upload&#39;;
Net::FTP=GLOB&#40;0x2a2d9a8&#41;&gt;&gt;&gt; QUIT
Net::FTP=GLOB&#40;0x2a2d9a8&#41;&lt;&lt;&lt; 221 Goodbye.
Done
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1652150" href="/Public/Bug/Display.html?id=116345#txn-1652150">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;24&nbsp;14:55:53&nbsp;2016</span>
    <span class="description">gortan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1652150/886541/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/886541">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 870b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jul 22 09:11:54 2016, chris@neadwerx.com wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Give this a shot. I tried it on the peers we are having issues with, as
&gt; well as a public Speedtest server I found:
</div>...
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;hangs&gt;
</div>
We&#39;ve seen this issue as well in $work after upgrading Net::FTP to 3.09. I was also just able to reproduce the issue on Arch Linux with perl 5.24.0 on x86_64 on a clean setup &#40;e.g., ~/perl5 cleaned&#41;. A bit of bisecting showed that the timeouts started with this commit:

91e593b615334fa76ef0454c4e601b98b6663841 is the first bad commit
commit 91e593b615334fa76ef0454c4e601b98b6663841
Author: Steve Hay &lt;steve.m.hay@googlemail.com&gt;
Date:   Thu Jul 7 08:39:04 2016 +0100

    Provide &#40;and document&#41; a default Net::Cmd::timeout&#40;&#41;
    
    Previuosly, subclasses were required to provide a timeout&#40;&#41; function, but
    this was not documented anywhere!
    
    Fixes CPAN RT#110978.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1652162" href="/Public/Bug/Display.html?id=116345#txn-1652162">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;24&nbsp;16:18:43&nbsp;2016</span>
    <span class="description">gortan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1652162/886549/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/886549">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 184b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Out of curiosity, I rebased 91e593b615334fa76ef0454c4e601b98b6663841 onto a commit before dagolden&#39;s fix-syswrite - the issue remains, so it&#39;s not something introduced by this cleanup.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1653040" href="/Public/Bug/Display.html?id=116345#txn-1653040">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;27&nbsp;04:02:27&nbsp;2016</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ppisar [...] redhat.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1653040/887097/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/887097">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 843b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne St 20.Äec.2016 15:21:38, chris@neadwerx.com napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Greeting, we recently pulled the 3.09 update for Net::Cmd and began
&gt; experiencing failures to transfer and receive files using Net::FTP and
&gt; Net::FTP::AutoReconnect.
&gt; 
</div>
I can reproduce it with both tests &#40;Fedora 24&#41;. It blocks in Net::Cmd::getline&#40;&#41; on this line:

my $select_ret = select&#40;$rout = $rin, undef, undef, $timeout&#41;;

It&#39;s because if the Net::Cmd::timeout&#40;&#41; subroutine is defined to return 0 &#40;as introduced by the commit&#41;, the $timeout variable get undef regardless what Timeout was supplied to Net::FTP-&gt;new&#40;&#41;.

It&#39;s undef because the until loop starts with:

my $timeout = $cmd-&gt;timeout || undef;

and $cmd-&gt;timeout returns 0 as written in the Net::Cmd::timeout&#40;&#41;. It should return the Timeout from Net::FTP-&gt;new&#40;&#41; or a default one which Net::FTP hard-codes to 120.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1653050" href="/Public/Bug/Display.html?id=116345#txn-1653050">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;27&nbsp;04:47:38&nbsp;2016</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ppisar [...] redhat.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1653050/887103/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/887103">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 412b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne St 27.Äec.2016 04:02:27, ppisar napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; and $cmd-&gt;timeout returns 0 as written in the Net::Cmd::timeout&#40;&#41;. It
&gt; should return the Timeout from Net::FTP-&gt;new&#40;&#41; or a default one which
&gt; Net::FTP hard-codes to 120.
</div>
If Net::Cmd::timeout&#40;&#41; does not exist, the $cmd-&gt;timout resolves to IO::Socket::IP::timeout that carry the Timeout value.

It looks like a wrong precedence of classes in method resolution.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1653053" href="/Public/Bug/Display.html?id=116345#txn-1653053">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;27&nbsp;05:01:08&nbsp;2016</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ppisar [...] redhat.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1653053/887106/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/887106">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 332b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne St 27.Äec.2016 04:47:38, ppisar napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It looks like a wrong precedence of classes in method resolution.
</div>
Net::FTP does:

our @ISA = &#40;&#39;Exporter&#39;,&#39;Net::Cmd&#39;,$IOCLASS&#41;;

because Net::Cmd::getline&#40;&#41; should override $IOCLASS::getline&#40;&#41;. For the same reason, the Net::Cmd::timeout&#40;&#41; takes precedence over $IOCLASS::timeout&#40;&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1653105" href="/Public/Bug/Display.html?id=116345#txn-1653105">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;27&nbsp;07:29:22&nbsp;2016</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ppisar [...] redhat.com</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1653105/887132/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/887132">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 319b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Attached patch fixes the regression by defining timeout&#40;&#41; method in each subclass as requested by Net::Cmd documentation.

However, I&#39;m not sure this the best way. Maybe the Net::Cmd::timeout&#40;&#41; should be reverted and the documentation changed to require the base class to be IO::Socket::INET-like instead of IO::Handle.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-Override-timeout-method-in-Net-FTP-and-other-subclas.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1653105/887133/0001-Override-timeout-method-in-Net-FTP-and-other-subclas.patch">Download 0001-Override-timeout-method-in-Net-FTP-and-other-subclas.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 72d07cb0d6a2e32a6a18a1794a592a8f6bf71665 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Petr=20P=C3=ADsa=C5=99?= &lt;ppisar@redhat.com&gt;
Date: Wed, 27 Jul 2016 12:57:23 +0200
Subject: [PATCH] Override timeout method in Net::FTP and other subclasses
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

After adding Net::Cmd::timeout&#40;&#41; in commit
91e593b615334fa76ef0454c4e601b98b6663841, the method masked
IO::Socket:IP::timeout&#40;&#41; in Net::FTP objects causing infitive block in
select&#40;&#41; on a FTP connection.

CPAN RT#116345

Signed-off-by: Petr PÃƒÂ­saÃ…Â™ &lt;ppisar@redhat.com&gt;
---
 lib/Net/FTP.pm  | 5 +++++
 lib/Net/NNTP.pm | 6 ++++++
 lib/Net/POP3.pm | 5 +++++
 lib/Net/SMTP.pm | 5 +++++
 4 files changed, 21 insertions&#40;+&#41;

diff --git a/lib/Net/FTP.pm b/lib/Net/FTP.pm
index 905d830..42c33f5 100644
--- a/lib/Net/FTP.pm
+++ b/lib/Net/FTP.pm
@@ -1210,6 +1210,11 @@ sub _data_cmd {
 ##
 
 
+sub timeout {
+  $IOCLASS-&gt;can&#40;&#39;timeout&#39;&#41;-&gt;&#40;@_&#41;;
+}
+
+
 sub debug_text { $_[2] =~ /^&#40;pass|resp|acct&#41;/i ? &#34;$1 ....\n&#34; : $_[2]; }
 
 
diff --git a/lib/Net/NNTP.pm b/lib/Net/NNTP.pm
index 764d580..f1b5c17 100644
--- a/lib/Net/NNTP.pm
+++ b/lib/Net/NNTP.pm
@@ -419,6 +419,12 @@ sub slave {
   $nntp-&gt;_SLAVE;
 }
 
+
+sub timeout {
+  $ISA[-1]-&gt;can&#40;&#39;timeout&#39;&#41;-&gt;&#40;@_&#41;;
+}
+
+
 ##
 ## The following methods are not implemented by all servers
 ##
diff --git a/lib/Net/POP3.pm b/lib/Net/POP3.pm
index bb18aaf..7f1cf5a 100644
--- a/lib/Net/POP3.pm
+++ b/lib/Net/POP3.pm
@@ -387,6 +387,11 @@ sub quit {
 }
 
 
+sub timeout {
+  $ISA[-1]-&gt;can&#40;&#39;timeout&#39;&#41;-&gt;&#40;@_&#41;;
+}
+
+
 sub DESTROY {
   my $me = shift;
 
diff --git a/lib/Net/SMTP.pm b/lib/Net/SMTP.pm
index 0dd966f..895c884 100644
--- a/lib/Net/SMTP.pm
+++ b/lib/Net/SMTP.pm
@@ -586,6 +586,11 @@ sub quit {
 }
 
 
+sub timeout {
+  $ISA[-1]-&gt;can&#40;&#39;timeout&#39;&#41;-&gt;&#40;@_&#41;;
+}
+
+
 sub DESTROY {
 
   # ignore
-- 
2.5.5

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1653411" href="/Public/Bug/Display.html?id=116345#txn-1653411">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;28&nbsp;04:18:16&nbsp;2016</span>
    <span class="description">shay [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1653411/887303/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/887303">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jul 27 07:29:22 2016, ppisar wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Attached patch fixes the regression by defining timeout&#40;&#41; method in
&gt; each subclass as requested by Net::Cmd documentation.
&gt; 
&gt; However, I&#39;m not sure this the best way. Maybe the Net::Cmd::timeout&#40;&#41;
&gt; should be reverted and the documentation changed to require the base
&gt; class to be IO::Socket::INET-like instead of IO::Handle.
</div>
Thanks for the analysis and patch. I can get my test.pl script above to fail with a Timeout if I remove IO::Socket::IP and IO::Socket::SSL from my perl installation, and I see why now.

I&#39;m tempted to revert the timeout&#40;&#41; addition and update documentation as you say, but returning to your earlier <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=110978">https://rt.cpan.org/Ticket/Display.html?id=110978</a></span> &#40;where all this started&#41;, that would require changing Net::SNPP::Server to inherit from IO::Socket::INET instead of IO::Handle in order to avoid reintroducing the #110978 bug. I haven&#39;t tested whether that really does work in practice, but I&#39;m also concerned that there could be other users of Net::Cmd that would have to make similar changes.

Providing a default timeout&#40;&#41; in Net::Cmd itself seemed like a friendlier approach than imposing a requirement for such a change on all users, although &#40;as this ticket shows&#41; breakage can still occur if that default isn&#39;t suitable, which then still requires changes in the users of Net::Cmd to fix &#40;namely, the addition of a suitable timeout&#40;&#41; override, as per your patch&#41;!

So I&#39;m torn which way to jump here. Any other opinions?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1653422" href="/Public/Bug/Display.html?id=116345#txn-1653422">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;28&nbsp;08:35:41&nbsp;2016</span>
    <span class="description">shay [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1653422/887313/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/887313">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jul 28 04:18:16 2016, SHAY wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Jul 27 07:29:22 2016, ppisar wrote:
<div class="message-stanza open">&gt; &gt; Attached patch fixes the regression by defining timeout&#40;&#41; method in
&gt; &gt; each subclass as requested by Net::Cmd documentation.
&gt; &gt;
&gt; &gt; However, I&#39;m not sure this the best way. Maybe the
&gt; &gt; Net::Cmd::timeout&#40;&#41;
&gt; &gt; should be reverted and the documentation changed to require the base
&gt; &gt; class to be IO::Socket::INET-like instead of IO::Handle.
</div>&gt; 
&gt; Thanks for the analysis and patch. I can get my test.pl script above
&gt; to fail with a Timeout if I remove IO::Socket::IP and IO::Socket::SSL
&gt; from my perl installation, and I see why now.
&gt; 
&gt; I&#39;m tempted to revert the timeout&#40;&#41; addition and update documentation
&gt; as you say, but returning to your earlier
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=110978">https://rt.cpan.org/Ticket/Display.html?id=110978</a></span> &#40;where all this
&gt; started&#41;, that would require changing Net::SNPP::Server to inherit
&gt; from IO::Socket::INET instead of IO::Handle in order to avoid
&gt; reintroducing the #110978 bug. I haven&#39;t tested whether that really
&gt; does work in practice, but I&#39;m also concerned that there could be
&gt; other users of Net::Cmd that would have to make similar changes.
&gt; 
&gt; Providing a default timeout&#40;&#41; in Net::Cmd itself seemed like a
&gt; friendlier approach than imposing a requirement for such a change on
&gt; all users, although &#40;as this ticket shows&#41; breakage can still occur if
&gt; that default isn&#39;t suitable, which then still requires changes in the
&gt; users of Net::Cmd to fix &#40;namely, the addition of a suitable timeout&#40;&#41;
&gt; override, as per your patch&#41;!
&gt; 
&gt; So I&#39;m torn which way to jump here. Any other opinions?
</div>
After searching around on grep.cpan.me it appears that almost all &#40;public&#41; users of Net::Cmd are also sub-classes of IO::Socket::INET anyway, including at least all of these: Net::APP, Net::Dict, Net::LMTP, Net::PH, Net::RGTP, Net::SNPP, NNML::Handle, Ponfish::News::MyNNTP, Roku::RCP, WAIT::Client::HTTP::Handle, WAIT::Handle and What::MTA. In fact, Net::SNPP::Server is the only one I&#39;ve found that chooses IO::Handle instead.

So I&#39;m going to revert the Net::Cmd::timeout&#40;&#41; change and document that Net::Cmd sub-classes are expected to provide the methods of IO::Socket::INET &#40;either by doing so explicitly themselves, or by also deriving from IO::Socket::INET &#40;or ::IP or ::INET6 or ::SSL&#41;&#41;.

That does mean that #110978 will be re-introduced, and Net::SNPP::Server will now have to change to fix it, but I think that&#39;s probably for the best since it will bring it into line with what most other users of Net::Cmd are doing already &#40;including Net::SNPP in the same distro!&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1653432" href="/Public/Bug/Display.html?id=116345#txn-1653432">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;28&nbsp;09:24:19&nbsp;2016</span>
    <span class="description">shay [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1653432/887319/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/887319">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jul 28 08:35:41 2016, SHAY wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Jul 28 04:18:16 2016, SHAY wrote:
<div class="message-stanza open">&gt; &gt; On Wed Jul 27 07:29:22 2016, ppisar wrote:
<div class="message-stanza open">&gt; &gt; &gt; Attached patch fixes the regression by defining timeout&#40;&#41; method in
&gt; &gt; &gt; each subclass as requested by Net::Cmd documentation.
&gt; &gt; &gt;
&gt; &gt; &gt; However, I&#39;m not sure this the best way. Maybe the
&gt; &gt; &gt; Net::Cmd::timeout&#40;&#41;
&gt; &gt; &gt; should be reverted and the documentation changed to require the
&gt; &gt; &gt; base
&gt; &gt; &gt; class to be IO::Socket::INET-like instead of IO::Handle.
</div>&gt; &gt;
&gt; &gt; Thanks for the analysis and patch. I can get my test.pl script above
&gt; &gt; to fail with a Timeout if I remove IO::Socket::IP and IO::Socket::SSL
&gt; &gt; from my perl installation, and I see why now.
&gt; &gt;
&gt; &gt; I&#39;m tempted to revert the timeout&#40;&#41; addition and update documentation
&gt; &gt; as you say, but returning to your earlier
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=110978">https://rt.cpan.org/Ticket/Display.html?id=110978</a></span> &#40;where all this
&gt; &gt; started&#41;, that would require changing Net::SNPP::Server to inherit
&gt; &gt; from IO::Socket::INET instead of IO::Handle in order to avoid
&gt; &gt; reintroducing the #110978 bug. I haven&#39;t tested whether that really
&gt; &gt; does work in practice, but I&#39;m also concerned that there could be
&gt; &gt; other users of Net::Cmd that would have to make similar changes.
&gt; &gt;
&gt; &gt; Providing a default timeout&#40;&#41; in Net::Cmd itself seemed like a
&gt; &gt; friendlier approach than imposing a requirement for such a change on
&gt; &gt; all users, although &#40;as this ticket shows&#41; breakage can still occur
&gt; &gt; if
&gt; &gt; that default isn&#39;t suitable, which then still requires changes in the
&gt; &gt; users of Net::Cmd to fix &#40;namely, the addition of a suitable
&gt; &gt; timeout&#40;&#41;
&gt; &gt; override, as per your patch&#41;!
&gt; &gt;
&gt; &gt; So I&#39;m torn which way to jump here. Any other opinions?
</div>&gt; 
&gt; After searching around on grep.cpan.me it appears that almost all
&gt; &#40;public&#41; users of Net::Cmd are also sub-classes of IO::Socket::INET
&gt; anyway, including at least all of these: Net::APP, Net::Dict,
&gt; Net::LMTP, Net::PH, Net::RGTP, Net::SNPP, NNML::Handle,
&gt; Ponfish::News::MyNNTP, Roku::RCP, WAIT::Client::HTTP::Handle,
&gt; WAIT::Handle and What::MTA. In fact, Net::SNPP::Server is the only one
&gt; I&#39;ve found that chooses IO::Handle instead.
&gt; 
&gt; So I&#39;m going to revert the Net::Cmd::timeout&#40;&#41; change and document
&gt; that Net::Cmd sub-classes are expected to provide the methods of
&gt; IO::Socket::INET &#40;either by doing so explicitly themselves, or by also
&gt; deriving from IO::Socket::INET &#40;or ::IP or ::INET6 or ::SSL&#41;&#41;.
&gt; 
&gt; That does mean that #110978 will be re-introduced, and
&gt; Net::SNPP::Server will now have to change to fix it, but I think
&gt; that&#39;s probably for the best since it will bring it into line with
&gt; what most other users of Net::Cmd are doing already &#40;including
&gt; Net::SNPP in the same distro!&#41;.
</div>
Now done in commit 95330178b26b96232dddb188f82ad33da0d0b293, which will be in 3.10 shortly.

Thanks to all for reporting/helping fix this.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1653435" href="/Public/Bug/Display.html?id=116345#txn-1653435">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;28&nbsp;09:24:25&nbsp;2016</span>
    <span class="description">shay [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 1.022236</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
