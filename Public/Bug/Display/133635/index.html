<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #133635 for Math-MPFR: = does not copy as documentation says</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #133635 for Math-MPFR: = does not copy as documentation says</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Math-MPFR">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Math-MPFR">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Math-MPFR">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Math-MPFR">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Math-MPFR">Math-MPFR CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">133635</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Math-MPFR">Math-MPFR</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
pjacklam [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-20810-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
4.13</li>
<li>
4.14</li>
</ul>
    </td>
  </tr>
  <tr id="CF-20811-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=133635">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1917332" href="/Public/Bug/Display.html?id=133635#txn-1917332">#</a>      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;31&nbsp;05:41:51&nbsp;2020</span>
    <span class="description">peter.john.acklam [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> = does not copy as documentation says</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1917332/1026662/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1026662">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The documentation says about operator overloading:

    = &#40;The copy has the same precision as the copied object.&#41;

but apparently, &#34;=&#34; does not return a copy. Consider the following code:

    use strict;
    use warnings;

    use Math::MPFR qw&lt; :mpfr &gt;;

    my $RND  = MPFR_RNDN;               # rounding mode
    my $PREC = 120;                     # precision

    Rmpfr_set_default_prec&#40;$PREC&#41;;
    print &#34;\nDefault precision is &#34;, Rmpfr_get_default_prec&#40;&#41;, &#34;\n&#34;;

    # Compute pi to 120 bits.

    my $pi0 = Rmpfr_init&#40;&#41;;             # initialize
    Rmpfr_const_pi&#40;$pi0, $RND&#41;;         # compute pi
    print &#34;pi0 = &#34;, $pi0, &#34;\n&#34;;         # print it

    # Round to 20 &#40;binary&#41; digits.

    my $pi1 = $pi0;                     # make a copy
    Rmpfr_prec_round&#40;$pi1, 20, $RND&#41;;   # round to 20 bits
    print &#34;pi1 = &#34;, $pi1, &#34;\n&#34;;         # print it

    # Print the original value.

    print &#34;pi0 = &#34;, $pi0, &#34;\n&#34;;         # why is this rounded?

The code illustrates that rounding a copy does also round the original
value. The output is

    Default precision is 120
    pi0 = 3.1415926535897932384626433832795028847
    pi1 = 3.1415939
    pi0 = 3.1415939

However, if &#34;=&#34; returned a true copy, the original value should not
have been rounded.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1917367" href="/Public/Bug/Display.html?id=133635#txn-1917367">#</a>      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;31&nbsp;21:25:40&nbsp;2020</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1917367/1026673/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1026673">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Oct 31 05:41:51 2020, pjacklam wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The documentation says about operator overloading:
&gt; 
&gt;     = &#40;The copy has the same precision as the copied object.&#41;
&gt; 
&gt; but apparently, &#34;=&#34; does not return a copy. Consider the following code:
&gt; 
&gt;     use strict;
&gt;     use warnings;
&gt; 
&gt;     use Math::MPFR qw&lt; :mpfr &gt;;
&gt; 
&gt;     my $RND  = MPFR_RNDN;               # rounding mode
&gt;     my $PREC = 120;                     # precision
&gt; 
&gt;     Rmpfr_set_default_prec&#40;$PREC&#41;;
&gt;     print &#34;\nDefault precision is &#34;, Rmpfr_get_default_prec&#40;&#41;, &#34;\n&#34;;
&gt; 
&gt;     # Compute pi to 120 bits.
&gt; 
&gt;     my $pi0 = Rmpfr_init&#40;&#41;;             # initialize
&gt;     Rmpfr_const_pi&#40;$pi0, $RND&#41;;         # compute pi
&gt;     print &#34;pi0 = &#34;, $pi0, &#34;\n&#34;;         # print it
&gt; 
&gt;     # Round to 20 &#40;binary&#41; digits.
&gt; 
&gt;     my $pi1 = $pi0;                     # make a copy
&gt;     Rmpfr_prec_round&#40;$pi1, 20, $RND&#41;;   # round to 20 bits
&gt;     print &#34;pi1 = &#34;, $pi1, &#34;\n&#34;;         # print it
&gt; 
&gt;     # Print the original value.
&gt; 
&gt;     print &#34;pi0 = &#34;, $pi0, &#34;\n&#34;;         # why is this rounded?
&gt; 
&gt; The code illustrates that rounding a copy does also round the original
&gt; value. The output is
&gt; 
&gt;     Default precision is 120
&gt;     pi0 = 3.1415926535897932384626433832795028847
&gt;     pi1 = 3.1415939
&gt;     pi0 = 3.1415939
&gt; 
&gt; However, if &#34;=&#34; returned a true copy, the original value should not
&gt; have been rounded.
</div>
It looks to me that this demonstrates a trap in creating a copy via the overloading of the &#34;=&#34; operator.
It&#39;s also a trap of which I was unaware - thanks for bringing it to my attention.

The overload documentation says:

    An object, however, is a reference to blessed data, so if $a and $b are
    objects then the assignment &#34;$a = $b&#34; copies only the reference, leaving
    $a and $b referring to the same object data. One might therefore expect
    the operation &#34;--$a&#34; to decrement $b as well as $a. However, this would
    not be consistent with how we expect the mathematical operators to work.

    Perl resolves this dilemma by transparently calling a copy constructor
    before calling a method defined to implement a mutator &#40;&#34;--&#34;, &#34;+=&#34;, and
    so on.&#41;. In the above example, when Perl reaches the decrement
    statement, it makes a copy of the object data in $a and assigns to $a a
    reference to the copied data. Only then does it call &#34;decr&#40;&#41;&#34;, which
    alters the copied data, leaving $b unchanged. Thus the object metaphor
    is preserved as far as possible, while mathemagical operations still
    work according to the arithmetic metaphor.

There&#39;s more in the &#34;Copy Constructor&#34; section of the docs, including:

   The subroutine for &#39;=&#39; does not overload the Perl assignment
   operator: it is used only to allow mutators to work as described
   here. &#40;See &#34;Assignments&#34; above.&#41;

AIUI, when you assign &#34;$x = $y;&#34; both $x and $y will refer to the same object until an operation that could change the value of one of those scalars is detected.
For example, for your script to DWIM, instead of doing:

    $pi1 = $pi0;

do

    $pi1 = $pi0;
    $pi1 += 0; # now $pi1 and $pi0 refer to separate objects

And, apparently it has to be an operation that the overload pragma recognizes as being one that can change the value.
It won&#39;t work if you call &#34;Rmpfr_add_ui&#40;$pi1, $pi1, 0, MPFR_RNDN&#41;;&#34; instead of &#34;$pi1 += 0;&#34;.

Obviously, Rmpfr_prec_round&#40;&#41; doesn&#39;t trigger the split.
Neither would many other functions, including Rmpfr_trunc&#40;&#41;, Rmpfr_ceil&#40;&#41; and Rmpfr_floor&#40;&#41;.

Math::MPFR is behaving here in essentially the same way as Math::GMP and Math::BigInt.

The following script demonstrates that with Math::GMP, Math::BigInt and Math::MPFR, $x and $y refer to the same object until the &#34;$y += 0;&#34; call is reached.

    use strict;
    use warnings;

    use Math::GMP;
    use Math::BigInt;
    use Math::MPFR;
    use Devel::Peek;

    my $x = Math::BigInt-&gt;new&#40;42&#41;;
    # my $x = Math::GMP-&gt;new&#40;42&#41;;
    # my $x = Math::MPFR-&gt;new&#40;42&#41;;

    my $y = $x;

    # $x and $y still refer to the same object

    Dump&#40;$x&#41;;
    Dump&#40;$y&#41;;

    $y += 0; # $y now refers to a separate object 

    Dump&#40;$y&#41;;

And, I believe, Math::BigFloat presents the very same trap as Math::MPFR

    use strict;
    use warnings;
    use Math::BigFloat;

    my $x = Math::BigFloat-&gt;new&#40;1 / 3&#41;;
    print &#34;$x\n&#34;; # prints 0.333333333333333

    my $y = $x;
    print &#34;$y\n&#34;; # prints 0.333333333333333

    # $y += 0; # This will make script DWIM

    $y-&gt;bround&#40;4&#41;;

    print &#34;$y\n&#34;; # prints 0.3333 - as expected
    print &#34;$x\n&#34;; # prints 0.3333 - doesn&#39;t DWIM

Now ... it could be that there&#39;s some action I could take in the Math::MPFR source that would remove this trap.
Or maybe there&#39;s some documentation that should be added to raise awareness of it.
I don&#39;t know ... and I&#39;m more than happy to consider thoughts on those aspects.

I think that, in Math::MPFR at least, there are safer ways to copy - eg Rmpfr_set&#40;&#41;, Rmpfr_setsign&#40;&#41;, Rmpfr_copysign&#40;&#41; or even &#34;$y = Math::MPFR-&gt;new&#40;$x&#41;;&#34;.
Admittedly, they all lack the convenience of doing &#34;$y = $x;&#34;.

Cheers,
Rob
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1917368" href="/Public/Bug/Display.html?id=133635#txn-1917368">#</a>      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;31&nbsp;21:25:41&nbsp;2020</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1917391" href="/Public/Bug/Display.html?id=133635#txn-1917391">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;01&nbsp;04:07:52&nbsp;2020</span>
    <span class="description">peter.john.acklam [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1917391/1026687/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1026687">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 448b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I shamefully admit that I haven&#39;t had the full understanding of how
overloading and assignments work. As you illustrate, the case I ran into
is not special for Math::MPFR, but applies to Perl objects in general. I
think this ticket can be closed.

I&#39;ll use something like the following, which is sufficient for my needs:

    sub clone {
        my $x = shift;
        my $y = Rmpfr_init&#40;&#41;;
        Rmpfr_set&#40;$y, $x, $RND&#41;;
        return $y;
    }
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1917466" href="/Public/Bug/Display.html?id=133635#txn-1917466">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;01&nbsp;06:59:14&nbsp;2020</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1917466/1026722/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1026722">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Nov 01 04:07:52 2020, pjacklam wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I shamefully admit that I haven&#39;t had the full understanding of how
&gt; overloading and assignments work.
</div>
Oh, there&#39;s nothing to be ashamed of.
I had no idea that this trap existed, and I&#39;m genuinely thankful that you took the time and effort to raise this issue.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As you illustrate, the case I ran into
&gt; is not special for Math::MPFR, but applies to Perl objects in general.
</div>
I&#39;m thinking it&#39;s a bug in perl&#39;s overloading model.
It&#39;s ok to defer the split until one of $x or $y changes, but to then not detect that a change has occurred is &#40;frankly&#41; unacceptable.
I don&#39;t know whether it is fixable.
I might yet file a bug report for this against perl ... though the response &#40;at best&#41; is likely to be &#34;patches welcome&#34;. 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think this ticket can be closed.
</div>
Yes, I&#39;ll get around to doing that.
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ll use something like the following, which is sufficient for my needs:
&gt; 
&gt;     sub clone {
&gt;         my $x = shift;
&gt;         my $y = Rmpfr_init&#40;&#41;;
&gt;         Rmpfr_set&#40;$y, $x, $RND&#41;;
&gt;         return $y;
&gt;     }
</div>
That should do it ok.
Of course, if the precision of $x is greater than the default precision, then you&#39;ll need:

    my $y = Rmpfr_init2&#40;Rmpfr_get_prec&#40;$x&#41;&#41;;

Cheers,
Rob
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1917750" href="/Public/Bug/Display.html?id=133635#txn-1917750">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;03&nbsp;04:23:46&nbsp;2020</span>
    <span class="description">peter.john.acklam [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1917750/1026864/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1026864">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Nov 01 06:59:14 2020, SISYPHUS wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m thinking it&#39;s a bug in perl&#39;s overloading model.
&gt; It&#39;s ok to defer the split until one of $x or $y changes, but to then
&gt; not detect that a change has occurred is &#40;frankly&#41; unacceptable.
</div>
I fully agree. When &#34;=&#34; is overloaded to return a true copy, the current
behaviour is counter-intuitive. In my opinion it doesn&#39;t adhere to the
DWIM philosophy of Perl.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I don&#39;t know whether it is fixable. I might yet file a bug report for
&gt; this against perl ... though the response &#40;at best&#41; is likely to be
&gt; &#34;patches welcome&#34;.
</div>
I still think it might be worth the while.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; I&#39;ll use something like the following, which is sufficient for my
&gt; &gt; needs:
&gt; &gt;
&gt; &gt; sub clone {
&gt; &gt;     my $x = shift;
&gt; &gt;     my $y = Rmpfr_init&#40;&#41;;
&gt; &gt;     Rmpfr_set&#40;$y, $x, $RND&#41;;
&gt; &gt;     return $y;
&gt; &gt; }
</div>&gt; 
&gt; That should do it ok. Of course, if the precision of $x is greater
&gt; than the default precision, then you&#39;ll need:
&gt; 
&gt; my $y = Rmpfr_init2&#40;Rmpfr_get_prec&#40;$x&#41;&#41;;
</div>
Oh, right. Of course. Thanks.

Cheers,
Peter
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1918057" href="/Public/Bug/Display.html?id=133635#txn-1918057">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;05&nbsp;08:17:12&nbsp;2020</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1918057/1027048/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1027048">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Nov 03 04:23:46 2020, pjacklam wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sun Nov 01 06:59:14 2020, SISYPHUS wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; I&#39;m thinking it&#39;s a bug in perl&#39;s overloading model.
&gt; &gt; It&#39;s ok to defer the split until one of $x or $y changes, but to then
&gt; &gt; not detect that a change has occurred is &#40;frankly&#41; unacceptable.
</div>&gt; 
&gt; I fully agree. When &#34;=&#34; is overloaded to return a true copy, the current
&gt; behaviour is counter-intuitive. In my opinion it doesn&#39;t adhere to the
&gt; DWIM philosophy of Perl.
&gt; 
<div class="message-stanza open">&gt; &gt; I don&#39;t know whether it is fixable. I might yet file a bug report for
&gt; &gt; this against perl ... though the response &#40;at best&#41; is likely to be
&gt; &gt; &#34;patches welcome&#34;.
</div>&gt; 
&gt; I still think it might be worth the while.
&gt; 
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; I&#39;ll use something like the following, which is sufficient for my
&gt; &gt; &gt; needs:
&gt; &gt; &gt;
&gt; &gt; &gt; sub clone {
&gt; &gt; &gt;     my $x = shift;
&gt; &gt; &gt;     my $y = Rmpfr_init&#40;&#41;;
&gt; &gt; &gt;     Rmpfr_set&#40;$y, $x, $RND&#41;;
&gt; &gt; &gt;     return $y;
&gt; &gt; &gt; }
</div>&gt; &gt; 
&gt; &gt; That should do it ok. Of course, if the precision of $x is greater
&gt; &gt; than the default precision, then you&#39;ll need:
&gt; &gt; 
&gt; &gt; my $y = Rmpfr_init2&#40;Rmpfr_get_prec&#40;$x&#41;&#41;;
</div>&gt; 
&gt; Oh, right. Of course. Thanks.
&gt; 
&gt; Cheers,
&gt; Peter
</div>
Thinking about it a bit more, it seems that the behaviour is as documented - which means it&#39;s &#40;technically&#41; not a bug.
It certainly doesn&#39;t DWIM, so one could possibly make a &#34;feature request&#34; that the flaw be fixed.
However, I would expect that if such a fix was readily achievable, then it would have been built into the original design in the first place.
Apparently the author of the documentation was well aware of the shortcomings.
I won&#39;t be pursuing this any further.

For Math::MPFR, I think the smart thing to do is to take a leaf out of Math::GMP&#39;s approach and include no reference whatsoever to overloading &#34;=&#34; in either the source or the documentation.
The same overloading behaviour will still exist &#40;at least that&#39;s the case with Math::GMP&#41;, but Math::MPFR will be absolved of all responsibility for what happens when a user does &#34;$x = $y;&#34;, where $y is a Math::MPFR object.

Cheers,
Rob
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1919115" href="/Public/Bug/Display.html?id=133635#txn-1919115">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;12&nbsp;07:58:31&nbsp;2020</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1919115/1027666/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1027666">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 442b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">After more pondering and some relevant discussion at <span class="clickylink"><a target="new" rel="nofollow" href="https://www.perlmonks.org/?node_id=11123464">https://www.perlmonks.org/?node_id=11123464</a></span> I&#39;ve opted for recommending caution &#40;in the &#34;OPERATOR OVERLOADING&#34; section of the Math::MPFR pod&#41; when overloading &#39;=&#39;.
This change has been pushed to <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/sisyphus/math-mpfr">https://github.com/sisyphus/math-mpfr</a></span>, and will appear in the next release &#40;Math-MPFR-4.15&#41;.

I&#39;ve also taken the same action in all of my other modules on github that overload &#39;=&#39;.

Cheers,
Rob
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1919119" href="/Public/Bug/Display.html?id=133635#txn-1919119">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;12&nbsp;07:58:32&nbsp;2020</span>
    <span class="description">sisyphus [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.433809</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
