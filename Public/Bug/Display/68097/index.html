<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #68097 for HTML-Tree: Patch for HTML::Tree to add new_from_url&#40;&#41; &#40;Using LWP&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #68097 for HTML-Tree: Patch for HTML::Tree to add new_from_url&#40;&#41; &#40;Using LWP&#41;</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/HTML-Tree/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/HTML-Tree/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/HTML-Tree/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/HTML-Tree/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/HTML-Tree">HTML-Tree CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">68097</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/HTML-Tree/Active/">HTML-Tree</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">cjm [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
spudsoup [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
Jeff.Fearn [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-16146-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
4.2    </td>
  </tr>
  <tr id="CF-16147-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
4.903-TRIAL    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;10&nbsp;16:45:40&nbsp;2011</span>
    <span class="description">spudsoup [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Jeff.Fearn [...] gmail.com</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Patch for HTML::Tree to add new_from_url&#40;&#41; &#40;Using LWP&#41;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">As discussed, I have written an enhancement to add a new_from_url&#40;&#41;
static constructor that used LWP to fetch content from a url.

-- 
David Pottage &#40;AKA: SPUDSOUP&#41;
david@electric-spoon.com
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> new_from_url.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/Makefile.PL b/Makefile.PL
index afe58c2..83c20e8 100644
--- a/Makefile.PL
+++ b/Makefile.PL
@@ -15,6 +15,7 @@ WriteMakefile
                            &#39;Test::Exception&#39; =&gt; 0,
                            &#39;HTML::Tagset&#39; =&gt; &#39;3.02&#39;,
                            &#39;HTML::Parser&#39; =&gt; &#39;3.46&#39;,
+                           &#39;LWP::UserAgent&#39; =&gt; 0,
                            &#39;Module::Build&#39; =&gt; 0
                          }
         &#41;
diff --git a/lib/HTML/Tree.pm b/lib/HTML/Tree.pm
index 31b5fde..d05f90f 100644
--- a/lib/HTML/Tree.pm
+++ b/lib/HTML/Tree.pm
@@ -55,6 +55,12 @@ sub new_from_content {
     goto &#38;HTML::TreeBuilder::new_from_content;
 }
 
+sub new_from_url {
+    shift;
+    unshift @_, &#39;HTML::TreeBuilder&#39;;
+    goto &#38;HTML::TreeBuilder::new_from_url;
+}
+
 1;
 __END__
 
diff --git a/lib/HTML/TreeBuilder.pm b/lib/HTML/TreeBuilder.pm
index 3e8b1ff..1000ce3 100644
--- a/lib/HTML/TreeBuilder.pm
+++ b/lib/HTML/TreeBuilder.pm
@@ -52,6 +52,7 @@ BEGIN {
 
 #---------------------------------------------------------------------------
 
+use LWP::UserAgent;
 use HTML::Entities &#40;&#41;;
 use HTML::Tagset 3.02 &#40;&#41;;
 
@@ -109,6 +110,19 @@ sub new_from_content {    # from any number of scalars
     return $new;
 }
 
+sub new_from_url {    # should accept anything that LWP does.
+    my $class = shift;
+    Carp::croak&#40;&#34;new_from_url takes only one argument&#34;&#41;
+        unless @_ == 1;
+    Carp::croak&#40;&#34;new_from_url is a class method only&#34;&#41;
+        if ref $class;
+    my $new = $class-&gt;new&#40;&#41;;
+    
+    my $fetch_result = LWP::UserAgent-&gt;new-&gt;get&#40; $_[0] &#41;;
+    $new-&gt;parse&#40; $fetch_result-&gt;content &#41;;
+    return $new;
+}
+
 # TODO: document more fully?
 sub parse_content {                    # from any number of scalars
     my $tree = shift;
diff --git a/t/construct_tree.t b/t/construct_tree.t
index 6b1faed..6a23b6d 100644
--- a/t/construct_tree.t
+++ b/t/construct_tree.t
@@ -1,9 +1,9 @@
-#!/usr/bin/perl -T
+#!/usr/bin/perl
 
 use warnings;
 use strict;
 
-use Test::More tests =&gt; &#40; 3 + 7 * 8 &#41;;
+use Test::More tests =&gt; &#40; 3 + 7 * 10 &#41;;
 
 #initial tests + number of tests in test_new_obj&#40;&#41; * number of times called
 
@@ -69,6 +69,29 @@ is&#40; $HTMLPart1 . $HTMLPart2, $HTML, &#34;split \$HTML correctly&#34; &#41;;
     test_new_obj&#40; $parse_content_obj, &#34;new&#40;&#41;; parse_content Scalar&#34; &#41;;
 }
 
+# URL tests
+{
+    SKIP: {
+        eval {
+            require URI::file;
+            require LWP::UserAgent;
+        };
+        skip &#34;URI::file or LWP::UserAgent not installed&#34;, 2 if $@;
+
+        my $file_url = URI-&gt;new&#40;&#34;file:&#34;.$TestInput&#41;;
+        
+        {
+            my $file_obj = HTML::Tree-&gt;new_from_url&#40;$file_url-&gt;as_string&#41;;
+            test_new_obj&#40; $file_obj, &#34;new_from_url Scalar&#34; &#41;;
+        }
+        
+        {
+            my $file_obj = HTML::Tree-&gt;new_from_url&#40;$file_url&#41;;
+            test_new_obj&#40; $file_obj, &#34;new_from_url Object&#34; &#41;;
+        }
+    }
+}
+
 # Scalar REF Tests
 {
     my $content_obj = HTML::Tree-&gt;new_from_content&#40;$HTML&#41;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;10&nbsp;16:49:22&nbsp;2011</span>
    <span class="description">spudsoup [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;10&nbsp;17:00:04&nbsp;2011</span>
    <span class="description">spudsoup [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have just spotted a bug in my patch.

The skip line in the new tests I added to t/construct_tree.t should be
skipping 14 tests not 2 if URI::file or LWP::UserAgent are not installed.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;07&nbsp;06:22:07&nbsp;2011</span>
    <span class="description">Jeff.Fearn [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed May 11 07:00:04 2011, SPUDSOUP wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have just spotted a bug in my patch.
&gt; 
&gt; The skip line in the new tests I added to t/construct_tree.t should be
&gt; skipping 14 tests not 2 if URI::file or LWP::UserAgent are not installed.
</div>
Hi I applied your patch, but I removed the skip as the test will fail if
LWP::UserAgent isn&#39;t installed since it&#39;s used in TreeBuilder.

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/jfearn/HTML-Tree/commit/5785d7fc8c33e7c43b8d3b678ed4c1f38beeab86">https://github.com/jfearn/HTML-Tree/commit/5785d7fc8c33e7c43b8d3b678ed4c1f38beeab86</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;07&nbsp;06:22:09&nbsp;2011</span>
    <span class="description">Jeff.Fearn [...] gmail.com -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;01&nbsp;23:12:49&nbsp;2012</span>
    <span class="description">cjm [...] cpan.org -  Fixed in 4.900-TRIAL added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;01&nbsp;23:12:49&nbsp;2012</span>
    <span class="description">cjm [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I added the skip back, because I made LWP an optional requirement.  It&#39;s
not loaded until new_from_url is called.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;01&nbsp;23:12:50&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;patched&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;01&nbsp;23:12:50&nbsp;2012</span>
    <span class="description">cjm [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;06&nbsp;20:14:44&nbsp;2012</span>
    <span class="description">cjm [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;06&nbsp;20:19:19&nbsp;2012</span>
    <span class="description">cjm [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve made some changes to your patch, including checking for errors and
non-HTML responses.  Please take a look at

  <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/release/CJM/HTML-Tree-4.902-TRIAL/">https://metacpan.org/release/CJM/HTML-Tree-4.902-TRIAL/</a></span>

and/or 

 
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/madsen/HTML-Tree/blob/master/lib/HTML/TreeBuilder.pm#L116">https://github.com/madsen/HTML-Tree/blob/master/lib/HTML/TreeBuilder.pm#L116</a></span>

and see if you have any comments.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;06&nbsp;20:19:21&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;08&nbsp;14:43:46&nbsp;2012</span>
    <span class="description">david [...] chrestomanci.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> spudsoup [...] cpan.org, Jeff.Fearn [...] gmail.com</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #68097] Patch for HTML::Tree to add new_from_url&#40;&#41; &#40;Using LWP&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 08 Jun 2012 19:43:20 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-HTML-Tree [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> David Pottage &lt;david [...] chrestomanci.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 07/06/12 01:19, Christopher J. Madsen via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=68097">https://rt.cpan.org/Ticket/Display.html?id=68097</a></span>&gt;
&gt;
&gt; I&#39;ve made some changes to your patch, including checking for errors and
&gt; non-HTML responses.  Please take a look at
&gt;
&gt;    <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/release/CJM/HTML-Tree-4.902-TRIAL/">https://metacpan.org/release/CJM/HTML-Tree-4.902-TRIAL/</a></span>
&gt;
&gt; and/or
&gt;
&gt;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/madsen/HTML-Tree/blob/master/lib/HTML/TreeBuilder.pm#L116">https://github.com/madsen/HTML-Tree/blob/master/lib/HTML/TreeBuilder.pm#L116</a></span>
&gt;
&gt; and see if you have any comments.
</div>
The code changes look sensible.

My concern is that there are no extra tests to cover the case where the 
remote server returns non html content. We should probably add some more 
tests were a local plain texts file is passed to the new_from_url&#40;&#41; and 
we check that we get the correct error.

I can write a patch to the tests if you like, or you can if you prefer.

-- 
David Pottage
spudsoup@cpan.org
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;09&nbsp;01:18:23&nbsp;2012</span>
    <span class="description">cjm [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Jun 8, 2012 1:43:46 PM, david@chrestomanci.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; My concern is that there are no extra tests to cover the case where
&gt; the remote server returns non html content.
</div>
Good point.  I&#39;ve added some tests to
<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/release/CJM/HTML-Tree-4.903-TRIAL/">https://metacpan.org/release/CJM/HTML-Tree-4.903-TRIAL/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;09&nbsp;01:18:24&nbsp;2012</span>
    <span class="description">cjm [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;09&nbsp;04:53:13&nbsp;2012</span>
    <span class="description">david [...] electric-spoon.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Jeff.Fearn [...] gmail.com</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #68097] Patch for HTML::Tree to add new_from_url&#40;&#41; &#40;Using LWP&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 09 Jun 2012 09:48:50 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-HTML-Tree [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> David Pottage &lt;david [...] electric-spoon.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 09/06/2012 06:18, Christopher J. Madsen via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=68097">https://rt.cpan.org/Ticket/Display.html?id=68097</a></span>&gt;
&gt;
&gt; On Fri, Jun 8, 2012 1:43:46 PM, david@chrestomanci.org wrote:
<div class="message-stanza open">&gt;&gt; My concern is that there are no extra tests to cover the case where
&gt;&gt; the remote server returns non html content.
</div>&gt; Good point.  I&#39;ve added some tests to
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/release/CJM/HTML-Tree-4.903-TRIAL/">https://metacpan.org/release/CJM/HTML-Tree-4.903-TRIAL/</a></span>
</div>Looks good.

-- 
David Pottage
spudsoup@cpan.org
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;09&nbsp;04:53:14&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;09&nbsp;10:56:55&nbsp;2012</span>
    <span class="description">cjm [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;09&nbsp;10:56:55&nbsp;2012</span>
    <span class="description">cjm [...] cpan.org -  Severity Normal changed to Wishlist</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;09&nbsp;10:56:55&nbsp;2012</span>
    <span class="description">cjm [...] cpan.org -  Fixed in 4.903-TRIAL added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;09&nbsp;10:56:55&nbsp;2012</span>
    <span class="description">cjm [...] cpan.org -  Fixed in 4.900-TRIAL deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
