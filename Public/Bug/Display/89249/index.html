<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #89249 for Moose: Test failure in t/cmop/methods.t on CentOS5 / perl 5.8.8</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #89249 for Moose: Test failure in t/cmop/methods.t on CentOS5 / perl 5.8.8</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Moose/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Moose/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Moose/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Moose/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Moose">Moose CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">89249</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">3 hours (180 min)

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Moose/Active/">Moose</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
gavin [...] openfusion.com.au

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
gortan [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-38786-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
2.1005</li>
<li>
2.1100-TRIAL</li>
<li>
2.1200</li>
</ul>
    </td>
  </tr>
  <tr id="CF-38787-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;04&nbsp;06:02:41&nbsp;2013</span>
    <span class="description">gavin [...] openfusion.com.au -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Test failure in t/cmop/methods.t on CentOS5 / perl 5.8.8</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m getting a single test failure on CentOS5 / perl 5.8.8 on Moose 2.1005 and 2.1100-TRIAL, as follows:

Failed Test      Stat Wstat Total Fail  Failed  List of Failed
-------------------------------------------------------------------------------
t/cmop/methods.t  255 65280    ??   ??       %  ??
8 tests and 2 subtests skipped.
Failed 1/398 test scripts, 99.75% okay. -13/18344 subtests failed, 100.07% okay.

hammer:~/Moose-2.1100$ perl -Iblib t/cmop/methods.t                                                                    
ok 1
ok 2 - ... got the method stub pie
ok 3 - ... got the constant method stub cake
ok 4 - ... our method is not yet blessed
ok 5 - ... we added the method successfully
ok 6 - The object isa Class::MOP::Method
ok 7 - ... got the right name for the method
ok 8 - ... got the right package name for the method
ok 9 - ... Foo-&gt;has_method&#40;foo&#41; &#40;defined with Sub::Name&#41;
ok 10 - ... Foo-&gt;get_method&#40;foo&#41; == \&#38;foo
ok 11 - ... _method_foo-&gt;execute returns &#34;Foo::foo&#34;
ok 12 - ... Foo-&gt;foo&#40;&#41; returns &#34;Foo::foo&#34;
not ok 13 - can add blessed sub as method
#   Failed test &#39;can add blessed sub as method&#39;
#   at t/cmop/methods.t line 102.
#          got: &#39;Can&#39;t locate object method &#34;body&#34; via package &#34;Non::Meta::Class&#34; at /usr/lib64/perl5/vendor_perl/5.8.8/x86_64-linux-thread-multi/Class/MOP/Mixin/HasMethods.pm line 63.
# &#39;
#     expected: undef
ok 14 - ... not Foo-&gt;has_method&#40;FOO_CONSTANT&#41; &#40;defined w/ use constant&#41;
ok 15 - ... not Foo-&gt;has_method&#40;bling&#41; &#40;defined in main:: using symbol tables &#40;no Sub::Name&#41;&#41;
ok 16 - ... Foo-&gt;has_method&#40;bar&#41; &#40;defined in Foo&#41;
ok 17 - ... Foo-&gt;has_method&#40;baz&#41; &#40;typeglob aliased within Foo&#41;
ok 18 - ... Foo-&gt;has_method&#40;baaz&#41; &#40;typeglob aliased within Foo&#41;
ok 19 - ... Foo-&gt;has_method&#40;floob&#41; &#40;defined in Foo:: using symbol tables and Sub::Name w/out package name&#41;
ok 20 - ... Foo-&gt;has_method&#40;blah&#41; &#40;defined in main:: using fully qualified package name&#41;
ok 21 - ... Foo-&gt;has_method&#40;bang&#41; &#40;defined in main:: using symbol tables and Sub::Name&#41;
ok 22 - ... Foo-&gt;has_method&#40;evaled_foo&#41; &#40;evaled in main::&#41;
ok 23 - the method &#39;elk&#39; is defined in OinkyBoinky
ok 24 - the method &#39;bar&#39; is not defined in OinkyBoinky
ok 25 - but if you look in the inheritence chain then &#39;bar&#39; does exist
ok 26 - the returned value is a code ref
ok 27 - The object isa Class::MOP::Method
ok 28 - ... body matches CODE ref in package for baaz
ok 29 - The object isa Class::MOP::Method
ok 30 - ... body matches CODE ref in package for bar
ok 31 - The object isa Class::MOP::Method
ok 32 - ... body matches CODE ref in package for baz
ok 33 - The object isa Class::MOP::Method
ok 34 - ... body matches CODE ref in package for floob
ok 35 - The object isa Class::MOP::Method
ok 36 - ... body matches CODE ref in package for blah
ok 37 - The object isa Class::MOP::Method
ok 38 - ... body matches CODE ref in package for bang
not ok 39 - The thing isa Class::MOP::Method
#   Failed test &#39;The thing isa Class::MOP::Method&#39;
#   at t/cmop/methods.t line 154.
#     The thing isn&#39;t defined
Can&#39;t call method &#34;body&#34; on an undefined value at t/cmop/methods.t line 158.
# Tests were run but no plan was declared and done_testing&#40;&#41; was not seen.

My MOP-skills are lacking, so I haven&#39;t tried to debug any further as yet. All runtime dependencies are installed, and I&#39;ve replicated on two different servers. This test works fine on CentOS6, fwiw. 

Cheers,
Gavin
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;07&nbsp;04:01:06&nbsp;2014</span>
    <span class="description">gortan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">15 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Oct 04 06:02:41 2013, GAVINC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m getting a single test failure on CentOS5 / perl 5.8.8 on Moose
&gt; 2.1005 and 2.1100-TRIAL, as follows:
</div>...
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; hammer:~/Moose-2.1100$ perl -Iblib t/cmop/methods.t
</div>...
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; not ok 13 - can add blessed sub as method
</div>
Gavin, I think that your invocation is incorrect - instead of
-Iblib
you have so say
-Iblib/lib -Iblib/arch

I just tried 2.1200 on RHEL 5.6 with perl 5.8.8 and have no issues running the unittests &#40;if I call them correctly&#41;. Can you please give 2.1200 a shot?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;07&nbsp;04:01:07&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;07&nbsp;04:01:23&nbsp;2014</span>
    <span class="description">gortan [...] cpan.org -  Cc GORTAN added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;07&nbsp;06:06:24&nbsp;2014</span>
    <span class="description">gavin [...] openfusion.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jan 07 04:01:06 2014, GORTAN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri Oct 04 06:02:41 2013, GAVINC wrote:
<div class="message-stanza open">&gt; &gt; I&#39;m getting a single test failure on CentOS5 / perl 5.8.8 on Moose
&gt; &gt; 2.1005 and 2.1100-TRIAL, as follows:
</div>&gt; ...
<div class="message-stanza open">&gt; &gt; hammer:~/Moose-2.1100$ perl -Iblib t/cmop/methods.t
</div>&gt; ...
<div class="message-stanza open">&gt; &gt; not ok 13 - can add blessed sub as method
</div>&gt; 
&gt; Gavin, I think that your invocation is incorrect - instead of
&gt; -Iblib
&gt; you have so say
&gt; -Iblib/lib -Iblib/arch
&gt; 
&gt; I just tried 2.1200 on RHEL 5.6 with perl 5.8.8 and have no issues
&gt; running the unittests &#40;if I call them correctly&#41;. Can you please give
&gt; 2.1200 a shot?
</div>
Just tried again on a fresh box, CentOS 5.10 with perl 5.8.8. I get the same error with 2.1200:

[gavin@tools Moose-2.1200]$ prove -Iblib/lib -Iblib/arch t/cmop/*.t      
t/cmop/add_attribute_alternate.............ok                                
t/cmop/add_method_debugmode................ok                                
t/cmop/add_method_modifier.................ok                                
t/cmop/advanced_methods....................ok                                
t/cmop/anon_class_create_init..............ok                                
t/cmop/anon_class_keep_alive...............ok                                
t/cmop/anon_class_leak.....................skipped
        all skipped: Test requires module &#39;Test::LeakTrace&#39; but it&#39;s not found
t/cmop/anon_class_removal..................ok                                
t/cmop/anon_class..........................ok                                
t/cmop/anon_packages.......................ok                                
t/cmop/ArrayBasedStorage_test..............ok                                
t/cmop/attribute_duplication...............ok                                
t/cmop/attribute_errors_and_edge_cases.....ok                                
t/cmop/attribute_get_read_write............ok                                
t/cmop/attribute_initializer...............ok                                
t/cmop/attribute_introspection.............ok                                
t/cmop/attribute_non_alpha_name............ok                                
t/cmop/attributes..........................ok                                
t/cmop/AttributesWithHistory_test..........ok                                
t/cmop/attribute...........................ok                                
t/cmop/basic...............................ok                                
t/cmop/before_after_dollar_under...........ok                                
t/cmop/BinaryTree_test.....................ok                                
t/cmop/C3MethodDispatchOrder_test..........ok                                
t/cmop/Class_C3_compatibility..............ok                                
t/cmop/ClassEncapsulatedAttributes_test....ok                                
t/cmop/class_errors_and_edge_cases.........ok                                
t/cmop/class_is_pristine...................ok                                
t/cmop/class_precedence_list...............ok                                
t/cmop/constant_codeinfo...................ok                                
t/cmop/create_class........................ok                                
t/cmop/custom_instance.....................ok                                
t/cmop/deprecated..........................ok                                
t/cmop/get_code_info.......................ok                                
t/cmop/immutable_custom_trait..............ok                                
t/cmop/immutable_metaclass.................ok                                
t/cmop/immutable_w_constructors............ok                                
t/cmop/immutable_w_custom_metaclass........ok                                
t/cmop/inline_and_dollar_at................ok                                
t/cmop/inline_structor.....................skipped
        all skipped: Test requires module &#39;Test::Output&#39; but it&#39;s not found
t/cmop/insertion_order.....................ok                                
t/cmop/InsideOutClass_test.................ok                                
t/cmop/InstanceCountingClass_test..........ok                                
t/cmop/instance_inline.....................ok                                
t/cmop/instance_metaclass_incompat_dyn.....ok                                
t/cmop/instance_metaclass_incompat.........ok                                
t/cmop/instance............................ok                                
t/cmop/LazyClass_test......................ok                                
t/cmop/load................................ok                                
t/cmop/magic...............................ok                                
t/cmop/make_mutable........................ok                                
t/cmop/metaclass_incompatibility_dyn.......ok                                
t/cmop/metaclass_incompatibility...........ok                                
t/cmop/metaclass_inheritance...............ok                                
t/cmop/metaclass_loads_classes.............ok                                
t/cmop/metaclass_reinitialize..............ok                                
t/cmop/metaclass...........................ok                                
t/cmop/meta_method.........................ok                                
t/cmop/meta_package_extension..............ok                                
t/cmop/meta_package........................ok                                
t/cmop/method_modifiers....................ok                                
t/cmop/methods.............................ok 1/0Can&#39;t locate object method &#34;body&#34; via package &#34;Non::Meta::Class&#34; at blib/lib/Class/MOP/Mixin/HasMethods.pm line 135.
# Tests were run but no plan was declared and done_testing&#40;&#41; was not seen.
t/cmop/methods.............................dubious                           
        Test returned status 255 &#40;wstat 65280, 0xff00&#41;
t/cmop/method..............................ok                                
t/cmop/modify_parent_method................ok                                
t/cmop/new_and_clone_metaclasses...........ok                                
t/cmop/null_stash..........................ok                                
t/cmop/numeric_defaults....................ok                                
t/cmop/package_variables...................ok                                
t/cmop/Perl6Attribute_test.................ok                                
t/cmop/random_eval_bug.....................ok                                
t/cmop/rebless_instance_away...............ok                                
t/cmop/rebless_instance....................ok                                
t/cmop/rebless_overload....................ok                                
t/cmop/rebless_with_extra_params...........ok                                
t/cmop/RT_27329_fix........................ok                                
t/cmop/RT_39001_fix........................ok                                
t/cmop/RT_41255............................ok                                
t/cmop/scala_style_mixin_composition.......skipped
        all skipped: Test requires module &#39;SUPER&#39; but it&#39;s not found
t/cmop/self_introspection..................ok                                
t/cmop/subclasses..........................ok                                
t/cmop/subname.............................ok                                
t/cmop/universal_methods...................ok                                
Failed Test      Stat Wstat Total Fail  Failed  List of Failed
-------------------------------------------------------------------------------
t/cmop/methods.t  255 65280    ??   ??       %  ??
3 tests skipped.
Failed 1/82 test scripts, 98.78% okay. -13/2568 subtests failed, 100.51% okay.

Everything fine except that one methods.t unit test.

-G
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;08&nbsp;03:24:30&nbsp;2014</span>
    <span class="description">gortan [...] cpan.org -  Broken in 2.1200 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;08&nbsp;04:30:28&nbsp;2014</span>
    <span class="description">gortan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">45 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jan 07 06:06:24 2014, GAVINC wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Just tried again on a fresh box, CentOS 5.10 with perl 5.8.8. I get
&gt; the same error with 2.1200:
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; t/cmop/methods.............................ok 1/0Can&#39;t locate object
&gt; method &#34;body&#34; via package &#34;Non::Meta::Class&#34; at
&gt; blib/lib/Class/MOP/Mixin/HasMethods.pm line 135.
</div>
Hmm, can you please also post the output of
$ perl -Iblib/lib -Iblib/arch  t/00-report-prereqs.t 
and
$ perl bin/moose-outdated

It doesn&#39;t seem to be a general issue, as the test reports look fine:
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/distro/M/Moose.html#Moose-2.1200?grade=1&#38;perlmat=2&#38;patches=2&#38;oncpan=1&#38;distmat=1&#38;perlver=ALL&#38;osname=ALL&#38;version=2.1200">http://www.cpantesters.org/distro/M/Moose.html#Moose-2.1200?grade=1&#38;perlmat=2&#38;patches=2&#38;oncpan=1&#38;distmat=1&#38;perlver=ALL&#38;osname=ALL&#38;version=2.1200</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;14&nbsp;23:37:55&nbsp;2014</span>
    <span class="description">gavin [...] openfusion.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jan 08 04:30:28 2014, GORTAN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Tue Jan 07 06:06:24 2014, GAVINC wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; Just tried again on a fresh box, CentOS 5.10 with perl 5.8.8. I get
&gt; &gt; the same error with 2.1200:
</div>&gt; 
<div class="message-stanza open">&gt; &gt; t/cmop/methods.............................ok 1/0Can&#39;t locate object
&gt; &gt; method &#34;body&#34; via package &#34;Non::Meta::Class&#34; at
&gt; &gt; blib/lib/Class/MOP/Mixin/HasMethods.pm line 135.
</div>&gt; 
&gt; Hmm, can you please also post the output of
&gt;  $ perl -Iblib/lib -Iblib/arch  t/00-report-prereqs.t
&gt; and
&gt; $ perl bin/moose-outdated
&gt; 
&gt; It doesn&#39;t seem to be a general issue, as the test reports look fine:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/distro/M/Moose.html#Moose-">http://www.cpantesters.org/distro/M/Moose.html#Moose-</a></span>
&gt; 2.1200?grade=1&#38;perlmat=2&#38;patches=2&#38;oncpan=1&#38;distmat=1&#38;perlver=ALL&#38;osname=ALL&#38;version=2.1200
</div>
[gavin@tools Moose-2.1200]$ perl -Iblib/lib -Iblib/arch  t/00-report-prereqs.t
1..1
# 
# Versions for all modules listed in META.json &#40;including optional ones&#41;:
#    Version Module                     
#   -------- ---------------------------
#   2.120921 CPAN::Meta                 
#      2.123 CPAN::Meta::Requirements   
#       1.32 Carp                       
#       0.20 Class::Load                
#       0.04 Class::Load::XS            
#      0.107 Data::OptList              
#       0.11 Devel::GlobalDestruction   
#    missing Devel::PartialDump         
#       1.30 Devel::StackTrace          
#       0.02 Dist::CheckConflicts       
#       0.08 Eval::Closure              
#     0.2703 ExtUtils::CBuilder         
#       6.30 ExtUtils::MakeMaker        
#       3.31 File::Spec                 
#       0.33 List::MoreUtils            
#       0.12 MRO::Compat                
#      0.013 Module::Runtime            
#       0.13 Package::DeprecationManager
#       0.33 Package::Stash             
#       0.25 Package::Stash::XS         
#       1.07 Params::Util               
#       1.27 Scalar::Util               
#      0.982 Sub::Exporter              
#       0.05 Sub::Name                  
#       1.04 Task::Weaken               
#      0.010 Test::Fatal                
#       0.98 Test::More                 
#       0.06 Test::Requires             
#       0.11 Try::Tiny                  
#      0.225 parent                     
ok 1

perl -Iblib/lib -Iblib/arch bin/moose-outdated
&lt;no output&gt;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;15&nbsp;18:19:55&nbsp;2014</span>
    <span class="description">gortan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">120 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I tried to reproduce your setup with the centos 5.8 image from <span class="clickylink"><a target="new" rel="nofollow" href="http://tag1consulting.com/files/centos-5.8-x86-64-minimal.box">http://tag1consulting.com/files/centos-5.8-x86-64-minimal.box</a></span>.
I upgraded Bundle::CPAN, installed Carton and used this cpanfile to reproduce the versions you mentioned: <span class="clickylink"><a target="new" rel="nofollow" href="https://gist.github.com/mephinet/8446647">https://gist.github.com/mephinet/8446647</a></span>
Still, all tests pass...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;16&nbsp;13:07:44&nbsp;2014</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #89249] Test failure in t/cmop/methods.t on CentOS5 / perl 5.8.8</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 16 Jan 2014 10:07:34 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Philipp Gortan via RT &lt;bug-Moose [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Karen Etheridge &lt;ether [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, Jan 15, 2014 at 06:19:56PM -0500, Philipp Gortan via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I tried to reproduce your setup with the centos 5.8 image from <span class="clickylink"><a target="new" rel="nofollow" href="http://tag1consulting.com/files/centos-5.8-x86-64-minimal.box">http://tag1consulting.com/files/centos-5.8-x86-64-minimal.box</a></span>.
&gt; I upgraded Bundle::CPAN, installed Carton and used this cpanfile to reproduce the versions you mentioned: <span class="clickylink"><a target="new" rel="nofollow" href="https://gist.github.com/mephinet/8446647">https://gist.github.com/mephinet/8446647</a></span>
&gt; Still, all tests pass...
</div>
Gavin, this suggests that perhaps you should try a re-install of your
modules?  Also, is the problem reproducable on more than one machine?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;16&nbsp;14:07:09&nbsp;2014</span>
    <span class="description">gortan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jan 16 13:07:44 2014, ETHER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Gavin, this suggests that perhaps you should try a re-install of your
&gt; modules?
</div>
If you re-install, you might want to update your toolchain first - your EUMM is over 8 years old, and building that version did not work out for me. I&#39;d run
$ cpan Bundle::CPAN
first...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;03&nbsp;18:52:15&nbsp;2014</span>
    <span class="description">DROLSKY [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;22&nbsp;14:08:05&nbsp;2015</span>
    <span class="description">andy [...] broadbean.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> ether [...] cpan.org</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">We run ancient perl too and hit a similar problem installing Moose 2.1403.

Just some context - the test that is failing adds a method that is a blessed sub to a class &#40;offtopic, curious if there is a use case for this?&#41;. In the OPs example, that is the test that is failing. In my example, it is the test after that that fails but I think they share the same cause.

When the package cache is built, `mop_update_method_map` in xs/HasMethods.xs walks the methods hash and calls `body` on any object it sees. In this case the object is our blessed sub, it doesn&#39;t have a `body` method and goes boom.

I think you can trigger this exception by invalidating the package cache so it is rebuilt. In perl 5.9.5 and older, the package cache rebuilds a lot because it MRO::Compat::get_pkg_gen returns a new version every time you call it which is why this test fails. Newer perl versions ship with mro so track the package cache correctly so the test passes because the package cache is not rebuilt.

I think an ISA check should fix it but this is my first time poking around the Moose internals and XS so handle with care ;&#41;

Installing Class::C3::XS also works around the problem &#40;it&#39;s implementation of get_pkg_gen does not trigger rebuilding the package cache&#41;
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RT_89249.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/t/cmop/RT_89249.t b/t/cmop/RT_89249.t
new file mode 100644
index 0000000..0a5f0b8
--- /dev/null
+++ b/t/cmop/RT_89249.t
@@ -0,0 +1,18 @@
+use strict;
+use Test::More;
+use Test::Fatal;
+
+use Class::MOP;
+
+my $meta = Class::MOP::Class-&gt;initialize&#40;&#39;Foo&#39;&#41;;
+
+my $blessed_sub = bless sub {}, &#39;No::Meta::Class&#39;;
+$meta-&gt;add_method&#40;&#39;blessed_sub&#39; =&gt; $blessed_sub&#41;;
+
+# force the package cache to rebuild
+$meta-&gt;reset_package_cache_flag;
+
+# And call something that requires the package cache
+is&#40; exception { $meta-&gt;has_method&#40;&#39;blessed_sub&#39;&#41; }, undef &#41;;
+
+done_testing;
diff --git a/xs/HasMethods.xs b/xs/HasMethods.xs
index e136abe..ed56529 100644
--- a/xs/HasMethods.xs
+++ b/xs/HasMethods.xs
@@ -24,7 +24,7 @@ mop_update_method_map&#40;pTHX_ HV *const stash, HV *const map&#41;
             continue;
         }
 
-        if &#40;sv_isobject&#40;method&#41;&#41; {
+        if &#40;sv_isobject&#40;method&#41; &#38;&#38; sv_derived_from&#40;method, &#34;Class::MOP::Method&#34;&#41;&#41; {
             /* $method_object-&gt;body&#40;&#41; */
             body = mop_call0&#40;aTHX_ method, KEY_FOR&#40;body&#41;&#41;;
         }
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;22&nbsp;14:08:06&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
