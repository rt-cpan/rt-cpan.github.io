<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #91326 for Moo: overloading %{} breaks constructor</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #91326 for Moo: overloading %{} breaks constructor</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Moo">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Moo">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Moo">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Moo">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Moo">Moo CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">91326</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Moo">Moo</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
djerius [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-235668-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-235669-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=91326">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1300762" href="/Public/Bug/Display.html?id=91326#txn-1300762">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;11&nbsp;11:53:38&nbsp;2013</span>
    <span class="description">djerius [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> overloading %{} breaks constructor</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1300762/689183/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/689183">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 761b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;d like to have my objects return a hash when explicitly dereferenced, so I tried something like this:

------------------------------

package Party;

use Moo;

use overload &#39;%{}&#39; =&gt; sub { { tea =&gt; $_[0]-&gt;tea } };

has tea =&gt; &#40; is =&gt; &#39;rw&#39; &#41;;

package main;

use Data::Dumper;

my %hash = %{ Party-&gt;new&#40; tea =&gt; &#39;Gunpowder&#39; &#41; };

print Dumper \%hash;

------------------------------


Unfortunately, this is the output:

% perl hash.pl
$VAR1 = {
          &#39;tea&#39; =&gt; undef
        };


If I comment out the overload line, I get

% perl hash.pl
$VAR1 = {
          &#39;tea&#39; =&gt; &#39;Gunpowder&#39;
        };


which is the expected result, but isn&#39;t really production code worthy, as I have to assume something about the object&#39;s underlying storage mechanism.

Thanks,

Diab
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1300798" href="/Public/Bug/Display.html?id=91326#txn-1300798">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;11&nbsp;13:54:49&nbsp;2013</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91326] overloading %{} breaks constructor</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 11 Dec 2013 10:54:33 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Diab Jerius via RT &lt;bug-Moo [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Karen Etheridge &lt;ether [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1300798/689197/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/689197">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 747b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, Dec 11, 2013 at 11:53:40AM -0500, Diab Jerius via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;d like to have my objects return a hash when explicitly dereferenced, so I tried something like this:
</div>...
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; which is the expected result, but isn&#39;t really production code worthy, as I have to assume something about the object&#39;s underlying storage mechanism.
</div>
You shouldn&#39;t assume anything about the object&#39;s underlying storage
mechanism -- that&#39;s locked away in an abstraction.

Instead, you should implement a -&gt;serialize method that will give you the
underlying data.  In Moose, this would be done with MooseX::Storage - I&#39;m
not sure if there is an equivalent in Moo, but if there isn&#39;t, the design
of this module should point you in the right direction to roll your own.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1300799" href="/Public/Bug/Display.html?id=91326#txn-1300799">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;11&nbsp;13:54:51&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1300841" href="/Public/Bug/Display.html?id=91326#txn-1300841">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;11&nbsp;17:11:41&nbsp;2013</span>
    <span class="description">djerius [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1300841/689229/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/689229">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 772b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Dec 11 13:54:49 2013, ETHER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed, Dec 11, 2013 at 11:53:40AM -0500, Diab Jerius via RT wrote:
<div class="message-stanza open">&gt; &gt; I&#39;d like to have my objects return a hash when explicitly
&gt; &gt; dereferenced, so I tried something like this:
</div>&gt; ...
<div class="message-stanza open">&gt; &gt; which is the expected result, but isn&#39;t really production code
&gt; &gt; worthy, as I have to assume something about the object&#39;s underlying
&gt; &gt; storage mechanism.
</div>&gt; 
&gt; You shouldn&#39;t assume anything about the object&#39;s underlying storage
&gt; mechanism -- that&#39;s locked away in an abstraction.
</div>
Perhaps my original point got lost.

I would like to overload %{}.  If I do, Moo&#39;s constructor breaks.

I *know* not to assume anything about internal storage, hence my comment about using %$object without the overload not being production ready code.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1300845" href="/Public/Bug/Display.html?id=91326#txn-1300845">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;11&nbsp;18:00:42&nbsp;2013</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91326] overloading %{} breaks constructor</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 11 Dec 2013 15:00:28 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Diab Jerius via RT &lt;bug-Moo [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Karen Etheridge &lt;ether [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1300845/689233/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/689233">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 401b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, Dec 11, 2013 at 05:11:43PM -0500, Diab Jerius via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I would like to overload %{}.  If I do, Moo&#39;s constructor breaks.
</div>
Overloading %{} on an object implies that you are aware that it is
implemented as a blessed hash, which you shouldn&#39;t assume.

If you want to get a serialized form of the object, then implement a
sanely-named method, rather than expecting %{} to do what you mean.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1300867" href="/Public/Bug/Display.html?id=91326#txn-1300867">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;11&nbsp;18:26:42&nbsp;2013</span>
    <span class="description">ilmari [...] ilmari.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91326] overloading %{} breaks constructor</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 12 Dec 2013 00:26:29 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Moo [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ilmari [...] ilmari.org &#40;Dagfinn Ilmari Mannsåker&#41;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1300867/689244/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/689244">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 677b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Diab Jerius via RT&#34; &lt;bug-Moo@rt.cpan.org&gt; writes:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I would like to overload %{}.  If I do, Moo&#39;s constructor breaks.
</div>
Not just the constructor, but _all_ of Moo&#39;s internal access to the
attributes &#40;except for accessors provided by Class::XSAccessor, since it
ignores overloading&#41;, The constructor and perl accessors are all
generated by Sub::Quote, so just returning the object itself if that&#39;s
the caller would work, but that also assumes too much about Moo
internals.

-- 
&#34;I use RMS as a guide in the same way that a boat captain would use
 a lighthouse.  It&#39;s good to know where it is, but you generally
 don&#39;t want to find yourself in the same spot.&#34; - Tollef Fog Heen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1300870" href="/Public/Bug/Display.html?id=91326#txn-1300870">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;11&nbsp;18:28:19&nbsp;2013</span>
    <span class="description">djerius [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1300870/689247/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/689247">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Dec 11 18:00:42 2013, ETHER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed, Dec 11, 2013 at 05:11:43PM -0500, Diab Jerius via RT wrote:
<div class="message-stanza open">&gt; &gt; I would like to overload %{}.  If I do, Moo&#39;s constructor breaks.
</div>&gt; 
&gt; Overloading %{} on an object implies that you are aware that it is
&gt; implemented as a blessed hash, which you shouldn&#39;t assume.
</div>
Overloading %{} means only one thing: I want to specify a behavior when the object is used in a context expecting a hash.  There are no assumptions about the underlying storage. It could be a blessed array, a connection to a database, anything.   As an example, here&#39;s an object which uses a blessed array.

---------------------------------------------
package Foo;

use overload &#34;%{}&#34;, sub {
    my $self = shift;
    return { map { &#40;&#34;index:$_&#34;, $self-&gt;[$_]&#41;  } 0..&#40;@$self-1&#41; }
};

sub new {
    my &#40; $class, @args &#41; = @_;
    return bless \@args, $class;
}


package main;

my $foo = Foo-&gt;new&#40; 2, 4, 6, 8 &#41;;

use Data::Dumper;
print Dumper {%$foo};
---------------------------------------------

This is no different than overloading &#34;&#34; for stringification of an object.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1300872" href="/Public/Bug/Display.html?id=91326#txn-1300872">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;11&nbsp;18:31:28&nbsp;2013</span>
    <span class="description">ilmari [...] ilmari.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients:;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91326] overloading %{} breaks constructor</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 12 Dec 2013 00:31:17 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Moo [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ilmari [...] ilmari.org &#40;Dagfinn Ilmari Mannsåker&#41;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1300872/689249/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/689249">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Karen Etheridge via RT&#34; &lt;bug-Moo@rt.cpan.org&gt; writes:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Moo
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91326">https://rt.cpan.org/Ticket/Display.html?id=91326</a></span> &gt;
&gt;
&gt; On Wed, Dec 11, 2013 at 05:11:43PM -0500, Diab Jerius via RT wrote:
<div class="message-stanza open">&gt;&gt; I would like to overload %{}.  If I do, Moo&#39;s constructor breaks.
</div>&gt;
&gt; Overloading %{} on an object implies that you are aware that it is
&gt; implemented as a blessed hash, which you shouldn&#39;t assume.
</div>
No, overloading %{} implies that you want users to be able to use it as
a hashref regardless of the implementation. The problem is that the
overload also applies when Moo itself accesses the hash.

One workaround is to use MooX::InsideOut, which doesn&#39;t use a blessed
hashref, but instead a scalarref as a key to a fieldhash.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If you want to get a serialized form of the object, then implement a
&gt; sanely-named method, rather than expecting %{} to do what you mean.
&gt;
&gt;
</div>
-- 
&#34;The surreality of the universe tends towards a maximum&#34; -- Skud&#39;s Law
&#34;Never formulate a law or axiom that you&#39;re not prepared to live with
 the consequences of.&#34;                              -- Skud&#39;s Meta-Law
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1300883" href="/Public/Bug/Display.html?id=91326#txn-1300883">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;11&nbsp;18:46:21&nbsp;2013</span>
    <span class="description">haarg [...] haarg.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1300883/689264/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/689264">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Dec 11 11:53:38 2013, DJERIUS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;d like to have my objects return a hash when explicitly
&gt; dereferenced, so I tried something like this:
&gt; 
&gt; ------------------------------
&gt; 
&gt; package Party;
&gt; 
&gt; use Moo;
&gt; 
&gt; use overload &#39;%{}&#39; =&gt; sub { { tea =&gt; $_[0]-&gt;tea } };
&gt; 
&gt; has tea =&gt; &#40; is =&gt; &#39;rw&#39; &#41;;
&gt; 
&gt; package main;
&gt; 
&gt; use Data::Dumper;
&gt; 
&gt; my %hash = %{ Party-&gt;new&#40; tea =&gt; &#39;Gunpowder&#39; &#41; };
&gt; 
&gt; print Dumper \%hash;
&gt; 
&gt; ------------------------------
&gt; 
&gt; 
&gt; Unfortunately, this is the output:
&gt; 
&gt; % perl hash.pl
&gt; $VAR1 = {
&gt;           &#39;tea&#39; =&gt; undef
&gt;         };
&gt; 
&gt; 
&gt; If I comment out the overload line, I get
&gt; 
&gt; % perl hash.pl
&gt; $VAR1 = {
&gt;           &#39;tea&#39; =&gt; &#39;Gunpowder&#39;
&gt;         };
&gt; 
&gt; 
&gt; which is the expected result, but isn&#39;t really production code worthy,
&gt; as I have to assume something about the object&#39;s underlying storage
&gt; mechanism.
&gt; 
&gt; Thanks,
&gt; 
&gt; Diab
</div>
I don&#39;t think it&#39;s reasonable to have Moo itself try to make this work.  Two possible workarounds:
1. use MooX::InsideOut
2. Write a MooX module that wraps various code bits in &#34;do { no overloading; ... }&#34;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1300886" href="/Public/Bug/Display.html?id=91326#txn-1300886">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;11&nbsp;19:03:29&nbsp;2013</span>
    <span class="description">rt-cpan [...] trout.me.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1300886/689267/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/689267">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Dec 11 11:53:38 2013, DJERIUS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Unfortunately, this is the output:
</div>
Yes, because overloading %{} on a hashref-based object is obviously broken.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If I comment out the overload line, I get
&gt; 
&gt; % perl hash.pl
&gt; $VAR1 = {
&gt;           &#39;tea&#39; =&gt; &#39;Gunpowder&#39;
&gt;         };
&gt; 
&gt; 
&gt; which is the expected result, but isn&#39;t really production code worthy,
&gt; as I have to assume something about the object&#39;s underlying storage
&gt; mechanism.
</div>
No, you don&#39;t. The problem here is you *are* making assumptions about the implementation.

The object&#39;s API can include &#34;%{} does the right thing&#34; . This is fine. External code should *not* need to know that overloading is being used to provide that API - as such, the version without overloading is *correct*.

If, later, you change to a non-hashref internal structure, at that point you would use operator overloading to maintain the API.

There is no bug in Moo here, merely a misunderstanding of encapsulation on your part. As such, I&#39;m marking this ticket invalid - if you want to discuss OO design, please feel free to do so with us on IRC.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1300889" href="/Public/Bug/Display.html?id=91326#txn-1300889">#</a>      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;11&nbsp;19:03:31&nbsp;2013</span>
    <span class="description">rt-cpan [...] trout.me.uk -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1301210" href="/Public/Bug/Display.html?id=91326#txn-1301210">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;12&nbsp;13:39:33&nbsp;2013</span>
    <span class="description">djerius [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1301210/689433/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/689433">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Dec 11 19:03:29 2013, MSTROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Dec 11 11:53:38 2013, DJERIUS wrote:
<div class="message-stanza open">&gt; &gt; Unfortunately, this is the output:
</div>&gt; 
&gt; Yes, because overloading %{} on a hashref-based object is obviously
&gt; broken.
</div>
But it seems possible to fix that, if that were so desired.  How about this?

sub new {
    my &#40; $class, %args &#41; = @_;
    return bless \{%args}, $class;
}

This retains the hash nature of the object, but hides it from the overloading magic. The attribute accessors would obviously have to be changed to handle an extra layer of indirection, but that would be transparent to the end user.  All other method calls should work the same.  

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; If I comment out the overload line, I get
&gt; &gt;
&gt; &gt; % perl hash.pl
&gt; &gt; $VAR1 = {
&gt; &gt;           &#39;tea&#39; =&gt; &#39;Gunpowder&#39;
&gt; &gt;         };
&gt; &gt;
&gt; &gt;
&gt; &gt; which is the expected result, but isn&#39;t really production code
&gt; &gt; worthy,
&gt; &gt; as I have to assume something about the object&#39;s underlying storage
&gt; &gt; mechanism.
</div>&gt; 
&gt; No, you don&#39;t. The problem here is you *are* making assumptions about
&gt; the implementation.
</div>
Unfortunately, it seems no one is intepreting the sentence I wrote in the way that I meant it, and it is leading to many assumptions.  Since it really has little bearing on the actual subject of this discussion, I&#39;d suggest we just ignore it and move on.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The object&#39;s API can include &#34;%{} does the right thing&#34; . This is
&gt; fine. External code should *not* need to know that overloading is
&gt; being used to provide that API - as such, the version without
&gt; overloading is *correct*.
</div>
I don&#39;t think that such a statement would be valid.  Since Moo doesn&#39;t document its implementation, the result of applying %{} to a Moo based object is technically undefined, and so no guarantees may be made about it.  While I may know that Moo is hash based,  I can&#39;t in good faith use that knowledge if it isn&#39;t part of its published API. &#40;I can&#39;t find any mention of that in the Moo documentation; perhaps I missed it&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There is no bug in Moo here, merely a misunderstanding of
&gt; encapsulation on your part. 
</div>
I misunderstand many, many things in life.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.361478</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
