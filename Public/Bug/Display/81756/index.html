<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #81756 for Net-DNS: Warnings and test failure with Perl 5.8 &lt; 5.8.9</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #81756 for Net-DNS: Warnings and test failure with Perl 5.8 &lt; 5.8.9</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-DNS/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-DNS/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-DNS/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-DNS/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-DNS">Net-DNS CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">81756</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-DNS/Active/">Net-DNS</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
paul [...] city-fan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-22454-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
0.69</li>
<li>
0.70</li>
</ul>
    </td>
  </tr>
  <tr id="CF-22455-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;06&nbsp;17:53:02&nbsp;2012</span>
    <span class="description">paul [...] city-fan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Warnings and test failure with Perl 5.8 &lt; 5.8.9</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Perl 5.8 &#40;highest I have for testing is 5.8.8, it may not be an issue
with 5.8.9&#41;, I see lots of warnings, e.g.:

t/05-A.....................Use of uninitialized value in lc at
/usr/lib/perl5/5.8.8/utf8_heavy.pl line 123.
Use of uninitialized value in lc at /usr/lib/perl5/5.8.8/utf8_heavy.pl
line 123.
ok
t/05-AAAA..................Use of uninitialized value in lc at
/usr/lib/perl5/5.8.8/utf8_heavy.pl line 123.
Use of uninitialized value in lc at /usr/lib/perl5/5.8.8/utf8_heavy.pl
line 123.
ok
t/05-AFSDB.................Use of uninitialized value in lc at
/usr/lib/perl5/5.8.8/utf8_heavy.pl line 123.
Use of uninitialized value in lc at /usr/lib/perl5/5.8.8/utf8_heavy.pl
line 123.
ok
t/05-APL...................Use of uninitialized value in lc at
/usr/lib/perl5/5.8.8/utf8_heavy.pl line 123.
Use of uninitialized value in lc at /usr/lib/perl5/5.8.8/utf8_heavy.pl
line 123.
ok
t/05-CERT..................Use of uninitialized value in lc at
/usr/lib/perl5/5.8.8/utf8_heavy.pl line 123.
Use of uninitialized value in lc at /usr/lib/perl5/5.8.8/utf8_heavy.pl
line 123.
ok
t/05-CNAME.................Use of uninitialized value in lc at
/usr/lib/perl5/5.8.8/utf8_heavy.pl line 123.
Use of uninitialized value in lc at /usr/lib/perl5/5.8.8/utf8_heavy.pl
line 123.
ok

This becomes more serious in t/07-zonefile.t, because
Net::DNS::ZoneFile-&gt;read is set up to die on warnings:

t/07-zonefile..............Use of uninitialized value in lc at
/usr/lib/perl5/5.8.8/utf8_heavy.pl line 123, &lt;GEN5&gt; line 1.
        zone3.txt, line 1
 at t/07-zonefile.t line 73
# Looks like you planned 46 tests but only ran 10.
# Looks like your test died just after 10.
dubious
        Test returned status 255 &#40;wstat 65280, 0xff00&#41;
DIED. FAILED tests 11-46
        Failed 36/46 tests, 21.74% okay

I was able to work around this issue using the attached hack, which
didn&#39;t break builds on more modern perls that I tried, but it&#39;s an ugly
hack and I&#39;d hope there was a cleaner solution, but my perl-fu isn&#39;t
strong enough for me to be able to think of one.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Net-DNS-0.69-warnings.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Perl 5.8 is prone to spewing warnings when operating on UTF strings,
such as:

t/05-A.....................Use of uninitialized value in lc at /usr/lib/perl5/5.8.8/utf8_heavy.pl line 123.
Use of uninitialized value in lc at /usr/lib/perl5/5.8.8/utf8_heavy.pl line 123.
ok
t/05-AAAA..................Use of uninitialized value in lc at /usr/lib/perl5/5.8.8/utf8_heavy.pl line 123.
Use of uninitialized value in lc at /usr/lib/perl5/5.8.8/utf8_heavy.pl line 123.
ok
t/05-AFSDB.................Use of uninitialized value in lc at /usr/lib/perl5/5.8.8/utf8_heavy.pl line 123.
Use of uninitialized value in lc at /usr/lib/perl5/5.8.8/utf8_heavy.pl line 123.
ok
t/05-APL...................Use of uninitialized value in lc at /usr/lib/perl5/5.8.8/utf8_heavy.pl line 123.
Use of uninitialized value in lc at /usr/lib/perl5/5.8.8/utf8_heavy.pl line 123.
ok
t/05-CERT..................Use of uninitialized value in lc at /usr/lib/perl5/5.8.8/utf8_heavy.pl line 123.
Use of uninitialized value in lc at /usr/lib/perl5/5.8.8/utf8_heavy.pl line 123.
ok
t/05-CNAME.................Use of uninitialized value in lc at /usr/lib/perl5/5.8.8/utf8_heavy.pl line 123.
Use of uninitialized value in lc at /usr/lib/perl5/5.8.8/utf8_heavy.pl line 123.
ok

This becomes more serious in t/07-zonefile.t, because Net::DNS::ZoneFile-&gt;read
is set up to die on warnings:

t/07-zonefile..............Use of uninitialized value in lc at /usr/lib/perl5/5.8.8/utf8_heavy.pl line 123, &lt;GEN5&gt; line 1.
        zone3.txt, line 1
 at t/07-zonefile.t line 73
# Looks like you planned 46 tests but only ran 10.
# Looks like your test died just after 10.
dubious
        Test returned status 255 &#40;wstat 65280, 0xff00&#41;
DIED. FAILED tests 11-46
        Failed 36/46 tests, 21.74% okay

This horrible hack stops the warnings. Hopefully there&#39;s a cleaner way to do it!

--- lib/Net/DNS/ZoneFile.pm
+++ lib/Net/DNS/ZoneFile.pm
@@ -458,6 +458,7 @@ sub DESTROY { }				## Avoid tickling AUT
 			} elsif &#40;/^\$TTL/&#41; {			# directive
 				my &#40; undef, $ttl &#41; = split;
 				die &#39;$TTL incomplete&#39; unless $ttl;
+				utf8::downgrade&#40; $ttl, 1 &#41; or die &#39;non-ASCII TTL&#39;;
 				$self-&gt;{ttl} = Net::DNS::RR::ttl&#40; {}, $ttl &#41;;
 			} elsif &#40;/^\$GENERATE/&#41; {		# directive
 				my &#40; undef, $range, @template &#41; = split;
--- lib/Net/DNS/RR/SOA.pm
+++ lib/Net/DNS/RR/SOA.pm
@@ -59,7 +59,12 @@ sub parse_rdata {			## populate RR from 
 
 	my $ttl = $self-&gt;{ttl};
 	$self-&gt;$_&#40; @_ ? shift		  : &#40;&#41; &#41; for qw&#40;mname rname serial&#41;;
-	$self-&gt;$_&#40; @_ ? $self-&gt;ttl&#40;shift&#41; : &#40;&#41; &#41; for qw&#40;refresh retry expire minimum&#41;;
+	my @times = @_;
+	utf8::downgrade&#40;$times[0], 1&#41; if $times[0];
+	utf8::downgrade&#40;$times[1], 1&#41; if $times[1];
+	utf8::downgrade&#40;$times[2], 1&#41; if $times[2];
+	utf8::downgrade&#40;$times[3], 1&#41; if $times[3];
+	$self-&gt;$_&#40; @times ? $self-&gt;ttl&#40;shift @times&#41; : &#40;&#41; &#41; for qw&#40;refresh retry expire minimum&#41;;
 	$self-&gt;{ttl} = $ttl;
 }
 
--- lib/Net/DNS/RR/LOC.pm
+++ lib/Net/DNS/RR/LOC.pm
@@ -68,7 +68,12 @@ sub parse_rdata {			## populate RR from 
 	}
 	$self-&gt;longitude&#40;@long&#41;;
 
-	$self-&gt;$_&#40; @_ ? shift : &#40;&#41; &#41; for qw&#40;altitude size hp vp&#41;;
+	my @coords = @_;
+	utf8::downgrade&#40;$coords[0], 1&#41; if $coords[0];
+	utf8::downgrade&#40;$coords[1], 1&#41; if $coords[1];
+	utf8::downgrade&#40;$coords[2], 1&#41; if $coords[2];
+	utf8::downgrade&#40;$coords[3], 1&#41; if $coords[3];
+	$self-&gt;$_&#40; @coords ? shift @coords : &#40;&#41; &#41; for qw&#40;altitude size hp vp&#41;;
 }
 
 
--- lib/Net/DNS/RR.pm
+++ lib/Net/DNS/RR.pm
@@ -108,9 +108,19 @@ sub new_string {
 
 	my $name    = shift @token;				# name [ttl] [class] type ...
 	my $ttl	    = shift @token if @token &#38;&#38; $token[0] =~ /^\d/;
-	my $rrclass = shift @token if @token &#38;&#38; $token[0] =~ /^&#40;$CLASS_REGEX&#41;$/io;
+	my $rrclass;
+	if &#40; @token &#41; {
+		my $classtest = $token[0];
+		utf8::downgrade&#40;$classtest, 1&#41;;
+		if &#40; $classtest =~ /^&#40;$CLASS_REGEX&#41;$/io &#41; {
+			shift @token;
+			$rrclass = $classtest;
+		}
+	}
 	$ttl = shift @token if @token &#38;&#38; $token[0] =~ /^\d/;	# name [class] [ttl] type ...
+	utf8::downgrade&#40;$ttl, 1&#41;;
 	my $rrtype = shift&#40;@token&#41; || croak &#39;unable to parse RR string&#39;;
+	utf8::downgrade&#40;$rrtype, 1&#41; || croak &#39;non-ASCII RR type&#39;;
 
 	my $base = new Net::DNS::Question&#40; $name, $rrtype, $rrclass &#41;;
 	my $self = $class-&gt;_subclass&#40; $base, scalar @token &#41;;	# RR with defaults &#40;if appropriate&#41;
@@ -118,7 +128,9 @@ sub new_string {
 
 	return $self unless @token;				# empty RR
 
-	if &#40; $token[0] eq &#39;\\#&#39; &#41; {
+	my $tokentest = $token[0];
+	utf8::downgrade&#40;$tokentest, 1&#41;;
+	if &#40; $tokentest eq &#39;\\#&#39; &#41; {
 		shift @token;					# RFC3597 hexadecimal format
 		my $count = shift&#40;@token&#41; || 0;
 		my $rdata = pack &#39;H*&#39;, join &#39;&#39;, @token;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;11&nbsp;07:06:49&nbsp;2012</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Case insensitive regex matching involves an implicit call of lc&#40;&#41; which
fails &#40;internally&#41; because of an undefined variable if UTF8 flag is set.

Problem is known to occur with Perl revisions 5.8.5 to 5.8.8.

Problem is not present in Perl 5.8.2 or 5.8.9.

Status of 5.8.3 and 5.8.4 not known.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;11&nbsp;07:06:50&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;16&nbsp;16:06:44&nbsp;2012</span>
    <span class="description">NLNETLABS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Paul,

With Net::DNS 0.71 we have at least one PASS on perl 5.8.8. See:
<span class="clickylink"><a target="new" rel="nofollow" href="http://217.199.168.174/cgi-bin/cpantestersmatrix.pl?dist=Net-DNS">http://217.199.168.174/cgi-bin/cpantestersmatrix.pl?dist=Net-DNS</a></span>

I assume the issue is resolved with the 0.71 release.
If not you can reopen the ticket by replying.

Thank you for reporting,

-- Willem
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;16&nbsp;16:06:44&nbsp;2012</span>
    <span class="description">NLNETLABS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
