<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #69997 for Sys-Syslog: Use the default socket timeout on GNU/kFreeBSD too</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #69997 for Sys-Syslog: Use the default socket timeout on GNU/kFreeBSD too</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Sys-Syslog">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Sys-Syslog">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Sys-Syslog">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Sys-Syslog">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Sys-Syslog">Sys-Syslog CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">69997</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Sys-Syslog">Sys-Syslog</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ntyni [...] iki.fi

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-30616-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.27    </td>
  </tr>
  <tr id="CF-30617-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.31    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




0001-Use-the-MacOS-X-socket-timeout-fix-on-Debian-GNU-kFr.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/963338/501306/0001-Use-the-MacOS-X-socket-timeout-fix-on-Debian-GNU-kFr.patch">
Wed Aug 03 15:34:19 2011 (1.1k) by ntyni [...] iki.fi
</a>
</font></li>
</ul>


0002-Lower-the-MacOS-X-FreeBSD-ICMP-unreachable-timeout-t.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/963338/501307/0002-Lower-the-MacOS-X-FreeBSD-ICMP-unreachable-timeout-t.patch">
Wed Aug 03 15:34:19 2011 (1.2k) by ntyni [...] iki.fi
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=69997">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-963338" href="/Public/Bug/Display.html?id=69997#txn-963338">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;03&nbsp;15:34:19&nbsp;2011</span>
    <span class="description">ntyni [...] iki.fi -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Use the default socket timeout on GNU/kFreeBSD too</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/963338/501305/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/501305">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">We&#39;re seeing a non-deterministic Sys-Syslog-0.27 test failure
when building Perl 5.12.4 on Debian GNU/kFreeBSD &#40;see
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.debian.org/ports/kfreebsd-gnu/">http://www.debian.org/ports/kfreebsd-gnu/</a></span> for information on this Debian
port.&#41; I have also been able to reproduce it on FreeBSD 8.2-RELEASE.

The Debian bug log can be found at <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/627821">http://bugs.debian.org/627821</a></span> .

Symptoms include

 #   Failed test &#39;[inet] syslog&#40;&#41; should return true: &#39;0&#39;&#39;
 #   at t/syslog.t line 166.
 cpan/Sys-Syslog/t/syslog.......................................FAILED
at test 142

and

 #   Failed test &#39;[inet] syslog&#40;&#41; called with level &#39;info&#39; &#40;string&#41;&#39;
 #   at t/syslog.t line 165.
 #          got: &#39;no connection to syslog available
 #   - getservbyname failed for syslog/tcp and syslogng/tcp
 #   - udp connect: nobody listening at t/syslog.t line 164
 # &#39;
 #     expected: &#39;&#39;
 cpan/Sys-Syslog/t/syslog.......................................FAILED
at test 141

In a nutshell, the problem seems to be that doing openlog&#40;&#41; on a udp
socket does not fail reliably on the FreeBSD kernel when syslogd
isn&#39;t configured for UDP reception. While this mainly happens on a
multiprocessor system, I&#39;ve been able to trigger it on a uniprocessor
system too. &#40;All tested on KVM virtual machines FWIW.&#41;

I think this is the infamous MacOS X timeout issue revisited; Darwin is
FreeBSD under the hood AFAIK. I suppose the immediate fix is to set the
connection_ok&#40;&#41; timeout when $^O matches /darwin|gnukfreebsd/.

&#40;As I mentioned, I&#39;ve also reproduced this on a FreeBSD-8.2 virtual
machine, so /darwin|freebsd/ might be more correct, but a more
conservative approach might be in order until there&#39;s a report from a
real FreeBSD user too.&#41;

However, you might want to revisit the timeout value; the london.pm post
referenced in the code mentioned a measurement of 25 microseconds and
suggested a delay of 1 millisecond, but you&#39;re using 250 milliseconds
which seems excessive and enough even for a human to notice.  Perhaps
the suggested one millisecond would be better? Just 250 microseconds
fixes this completely in my setup FWIW.

Please note that this behaviour isn&#39;t visible on 0.28 or 0.29 because
changes to setlogsock&#40;&#41; mask the behaviour there. I have filed separate
tickets &#40;[rt.cpan.org #69986] and [rt.cpan.org #69992]&#41; on those.

I&#39;m attaching proposed patches for your convenience.

Thanks for your work on Sys-Syslog,
-- 
Niko Tyni   ntyni@debian.org
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-Use-the-MacOS-X-socket-timeout-fix-on-Debian-GNU-kFr.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/963338/501306/0001-Use-the-MacOS-X-socket-timeout-fix-on-Debian-GNU-kFr.patch">Download 0001-Use-the-MacOS-X-socket-timeout-fix-on-Debian-GNU-kFr.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 1ebf50c63fc400230d0eef6e86f1391ee3314b41 Mon Sep 17 00:00:00 2001
From: Niko Tyni &lt;ntyni@debian.org&gt;
Date: Wed, 3 Aug 2011 22:01:53 +0300
Subject: [PATCH 1/2] Use the MacOS X socket timeout fix on Debian
 GNU/kFreeBSD too

See <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/627821">http://bugs.debian.org/627821</a></span>

It seems probable that all FreeBSD-based systems suffer from the
same issue, but err on the conservative side and only include
GNU/kFreeBSD for now.
---
 Syslog.pm |    6 +++++-
 1 files changed, 5 insertions&#40;+&#41;, 1 deletions&#40;-&#41;

diff --git a/Syslog.pm b/Syslog.pm
index bc6752f..51ca74a 100644
--- a/Syslog.pm
+++ b/Syslog.pm
@@ -139,7 +139,11 @@ my @fallbackMethods = &#40;&#41;;
 # happy, the timeout is now zero by default on all systems 
 # except on OSX where it is set to 250 msec, and can be set 
 # with the infamous setlogsock&#40;&#41; function.
-$sock_timeout = 0.25 if $^O =~ /darwin/;
+#
+# Update 2011-08: this issue is also been seen on multiprocessor
+# Debian GNU/kFreeBSD systems. See <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/627821">http://bugs.debian.org/627821</a></span>
+
+$sock_timeout = 0.25 if $^O =~ /darwin|gnukfreebsd/;
 
 # coderef for a nicer handling of errors
 my $err_sub = $options{nofatal} ? \&#38;warnings::warnif : \&#38;croak;
-- 
1.7.5.4

</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0002-Lower-the-MacOS-X-FreeBSD-ICMP-unreachable-timeout-t.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/963338/501307/0002-Lower-the-MacOS-X-FreeBSD-ICMP-unreachable-timeout-t.patch">Download 0002-Lower-the-MacOS-X-FreeBSD-ICMP-unreachable-timeout-t.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From e8f4ab74ce32d4e46d552aee069c66cd80d8ee90 Mon Sep 17 00:00:00 2001
From: Niko Tyni &lt;ntyni@debian.org&gt;
Date: Wed, 3 Aug 2011 22:13:46 +0300
Subject: [PATCH 2/2] Lower the MacOS X / FreeBSD ICMP unreachable timeout to
 1 ms

250 milliseconds seems to be excessive, the original suggestion in the
above london.pm message was one millisecond and the measured delay was
25 microseconds.

Use one millisecond to be on the safe side.
---
 Syslog.pm |    7 ++++++-
 1 files changed, 6 insertions&#40;+&#41;, 1 deletions&#40;-&#41;

diff --git a/Syslog.pm b/Syslog.pm
index 51ca74a..8b7b187 100644
--- a/Syslog.pm
+++ b/Syslog.pm
@@ -142,8 +142,13 @@ my @fallbackMethods = &#40;&#41;;
 #
 # Update 2011-08: this issue is also been seen on multiprocessor
 # Debian GNU/kFreeBSD systems. See <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/627821">http://bugs.debian.org/627821</a></span>
+#
+# Update 2011-08: 250 milliseconds seems to be excessive,
+# the original suggestion in the above london.pm message was one
+# millisecond and the measured delay was 25 microseconds.
+# Use one millisecond to be on the safe side.
 
-$sock_timeout = 0.25 if $^O =~ /darwin|gnukfreebsd/;
+$sock_timeout = 0.001 if $^O =~ /darwin|gnukfreebsd/;
 
 # coderef for a nicer handling of errors
 my $err_sub = $options{nofatal} ? \&#38;warnings::warnif : \&#38;croak;
-- 
1.7.5.4

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1109415" href="/Public/Bug/Display.html?id=69997#txn-1109415">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;15&nbsp;18:41:21&nbsp;2012</span>
    <span class="description">SAPER [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69997] Use the default socket timeout on GNU/kFreeBSD too </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 16 Aug 2012 00:41:04 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Sys-Syslog [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> SÃ©bastien Aperghis-Tramoni &lt;saper [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1109415/583331/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/583331">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

Niko Tyni wrote via RT:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; We&#39;re seeing a non-deterministic Sys-Syslog-0.27 test failure
&gt; when building Perl 5.12.4 on Debian GNU/kFreeBSD &#40;see
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.debian.org/ports/kfreebsd-gnu/">http://www.debian.org/ports/kfreebsd-gnu/</a></span> for information on this Debian
&gt; port.&#41; I have also been able to reproduce it on FreeBSD 8.2-RELEASE.
&gt; 
&gt; The Debian bug log can be found at <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/627821">http://bugs.debian.org/627821</a></span> .
&gt; 
&gt; Symptoms include
&gt; 
&gt; #   Failed test &#39;[inet] syslog&#40;&#41; should return true: &#39;0&#39;&#39;
&gt; #   at t/syslog.t line 166.
&gt; cpan/Sys-Syslog/t/syslog.......................................FAILED
&gt; at test 142
&gt; 
&gt; and
&gt; 
&gt; #   Failed test &#39;[inet] syslog&#40;&#41; called with level &#39;info&#39; &#40;string&#41;&#39;
&gt; #   at t/syslog.t line 165.
&gt; #          got: &#39;no connection to syslog available
&gt; #   - getservbyname failed for syslog/tcp and syslogng/tcp
&gt; #   - udp connect: nobody listening at t/syslog.t line 164
&gt; # &#39;
&gt; #     expected: &#39;&#39;
&gt; cpan/Sys-Syslog/t/syslog.......................................FAILED
&gt; at test 141
&gt; 
&gt; In a nutshell, the problem seems to be that doing openlog&#40;&#41; on a udp
&gt; socket does not fail reliably on the FreeBSD kernel when syslogd
&gt; isn&#39;t configured for UDP reception. While this mainly happens on a
&gt; multiprocessor system, I&#39;ve been able to trigger it on a uniprocessor
&gt; system too. &#40;All tested on KVM virtual machines FWIW.&#41;
&gt; 
&gt; I think this is the infamous MacOS X timeout issue revisited; Darwin is
&gt; FreeBSD under the hood AFAIK. I suppose the immediate fix is to set the
&gt; connection_ok&#40;&#41; timeout when $^O matches /darwin|gnukfreebsd/.
&gt; 
&gt; &#40;As I mentioned, I&#39;ve also reproduced this on a FreeBSD-8.2 virtual
&gt; machine, so /darwin|freebsd/ might be more correct, but a more
&gt; conservative approach might be in order until there&#39;s a report from a
&gt; real FreeBSD user too.&#41;
</div>
The surprising thing is that there are a few CPAN Testers using FreeBSD, Darwin and GNU/kFreeBSD, and none exposed this failure:
  Â» <span class="clickylink"><a target="new" rel="nofollow" href="http://matrix.cpantesters.org/?dist=Sys-Syslog-0.29">http://matrix.cpantesters.org/?dist=Sys-Syslog-0.29</a></span>

There&#39;s probably another condition that is causing the failure, but finding it will be rather difficult, and probably not worth the effort.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; However, you might want to revisit the timeout value; the london.pm post
&gt; referenced in the code mentioned a measurement of 25 microseconds and
&gt; suggested a delay of 1 millisecond, but you&#39;re using 250 milliseconds
&gt; which seems excessive and enough even for a human to notice.  Perhaps
&gt; the suggested one millisecond would be better? Just 250 microseconds
&gt; fixes this completely in my setup FWIW.
</div>
In fact, the 1 ms delay was suggested for a loopback interface, and a 1 s delay was for normal network interfaces. I used a 250 ms as a first compromise. Which was too high and led to CPAN RT #34753, which is when I added an option to configure the timeout.
  Â» <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=34753">https://rt.cpan.org/Ticket/Display.html?id=34753</a></span>

But I agree that it&#39;s still probably a bit too high, even for the OS where this delay is needed.


Thank you for your detailed explanation and patches, they are very appreciated.
And please accept my apologies for having been so long before answering.

I&#39;ve applied the patches and pushed them to github.
They will be part of Sys::Syslog version 0.31.

-- 
SÃ©bastien Aperghis-Tramoni

Close the world, txEn eht nepO.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1109418" href="/Public/Bug/Display.html?id=69997#txn-1109418">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;15&nbsp;18:41:23&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1109653" href="/Public/Bug/Display.html?id=69997#txn-1109653">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;16&nbsp;01:35:43&nbsp;2012</span>
    <span class="description">ntyni [...] iki.fi -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69997] Use the default socket timeout on GNU/kFreeBSD too</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 16 Aug 2012 08:35:21 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> SÃ©bastien Aperghis-Tramoni via RT &lt;bug-Sys-Syslog [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Niko Tyni &lt;ntyni [...] iki.fi&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1109653/583452/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/583452">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 852b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, Aug 15, 2012 at 06:41:23PM -0400, SÃ©bastien Aperghis-Tramoni via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=69997">https://rt.cpan.org/Ticket/Display.html?id=69997</a></span> &gt;
</div>
Thanks for looking at these!

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The surprising thing is that there are a few CPAN Testers using FreeBSD, Darwin and GNU/kFreeBSD, and none exposed this failure:
&gt;   Â» <span class="clickylink"><a target="new" rel="nofollow" href="http://matrix.cpantesters.org/?dist=Sys-Syslog-0.29">http://matrix.cpantesters.org/?dist=Sys-Syslog-0.29</a></span>
</div>
It&#39;s been a while and I&#39;m hazy on details, but I said in my original report:

  Please note that this behaviour isn&#39;t visible on 0.28 or 0.29 because
  changes to setlogsock&#40;&#41; mask the behaviour there. I have filed separate
  tickets &#40;[rt.cpan.org #69986] and [rt.cpan.org #69992]&#41; on those.

so perhaps that&#39;s the explanation?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve applied the patches and pushed them to github.
&gt; They will be part of Sys::Syslog version 0.31.
</div>
Great, thanks again!
-- 
Niko Tyni   ntyni@debian.org
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1113253" href="/Public/Bug/Display.html?id=69997#txn-1113253">#</a>      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;26&nbsp;08:20:18&nbsp;2012</span>
    <span class="description">SAPER [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1113255" href="/Public/Bug/Display.html?id=69997#txn-1113255">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;26&nbsp;08:20:18&nbsp;2012</span>
    <span class="description">SAPER [...] cpan.org -  Fixed in 0.31 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.3792</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
