<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #106192 for MooseX-Params-Validate: Not usable on functions or class methods</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #106192 for MooseX-Params-Validate: Not usable on functions or class methods</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/MooseX-Params-Validate/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/MooseX-Params-Validate/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/MooseX-Params-Validate/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/MooseX-Params-Validate/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/MooseX-Params-Validate">MooseX-Params-Validate CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">106192</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/MooseX-Params-Validate/Active/">MooseX-Params-Validate</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
KENTNL [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-43218-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.21    </td>
  </tr>
  <tr id="CF-43219-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;02&nbsp;00:38:10&nbsp;2015</span>
    <span class="description">KENTNL [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Not usable on functions or class methods</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza"><p>
	Class Methods and Functions are effectively unusable with MX:PV</p>

<p>
	With a class method, defacto passing \@_ causes the &quot;Get object at first and assume its self&quot; heuristic to fail, and so it sees the class name ( a string ) and assumes its the key for a parameter, causing &quot;odd number of elements in hash assignment&quot;</p>

<p>
	( See class_method.pl )</p>

<p>
	Working around this defect by explicitly shifting of $class first ( the same as Params::Validate expects ), results in a secondary defect:&nbsp; That if somebody passes an object as the first parameter to the class method, then that will be assumed to be &quot;self&quot; of a method call, changing how the returned values occur silently without exceptions, instead of rejecting the parameters as invalid</p>

<p>
	( see class_method_2.pl )</p>

<p>
	And this second case exhibits its ugly head when used for functions also, that if the first argument happens to be any kind of object, it will assume its an invocant, even if the functions definition anticipated no such thing.</p>

<p>
	( see function.pl )</p>

<p>
	As such, I would request one of two possible options:</p>

<p>
	&nbsp;</p>

<p>
	1. Have documentation to effect of stating clearly that it is not useful for functions and class methods due to permitting invalid argument lists in certain conditions.<br>

	<br>

	2. Have a parameter that disables the &quot;assume an invocant if $_[0] is a bless&quot; mechanics.</p>

<p>
	I think the second of these two would be more useful, and then that flag would be turned on<br>

	and the &quot;shift&quot; be manually done for class methods, and no other magic required for functions.</p>

<p>
	An additional set of options may also prove useful:</p>

<p>
	1. A &quot;require invocant&quot; flag that stipulates $_[0] **must** be a bless and errors otherwise.</p>

<p>
	2. An &quot;assume invocant&quot; flag that stipulates $_[0] is **always** assumed to be an invocant ( either class name or bless ), instead of magically doing it when $_[0] is a bless.</p>

<p>
	The first of these options would cause exceptions when a method is erroneously called as a function, instead of having the parameters silently get stuffed into the wrong boxes.</p>

<p>
	The second of these would be useful for methods that worked on either objects or classes, as &quot;$self&quot; would be predictably always present in the right place in the output, and the remaining args would have well defined even-numbered list semantics, and so:</p>

<p>
	Test-&gt;class_method( $object =&gt; &quot;x&quot; )</p>

<p>
	Would always be assumed to parse such that &quot;Test&quot; is the invocant, and &quot;$object&quot; is merely the first key, which is entirely realistic in the event $object is a stringifiable object that mimics a string, like a Path::Tiny instance.</p>

<p>
	&nbsp;</p>


</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> class_method.pl</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/env perl
# ABSTRACT: test class methods

use strict;
use warnings;

package Test {

  use MooseX::Params::Validate qw&#40; validated_list &#41;;

  sub class_method {
    my &#40; $class, $arg_one &#41; = validated_list&#40; \@_, arg_one =&gt; { isa =&gt; &#39;Object&#39; } &#41;;
    print &#34;class is $class&#34;;
  }
}

Test-&gt;class_method&#40; arg_one =&gt; bless&#40;{}, &#39;X&#39; &#41; &#41;;
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> class_method_2.pl</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/env perl
# ABSTRACT: test class methods

use strict;
use warnings;

package Test {

  use MooseX::Params::Validate qw&#40; validated_list &#41;;

  sub class_method {
    my &#40; $class, @args &#41; = @_;
    my &#40; $arg_one, $arg_two &#41; = validated_list&#40; \@args,  arg_one =&gt; { isa =&gt; &#39;Object&#39; } &#41;;
    print &#34;class is $class\n&#34;;
    print &#34;arg_one is $arg_one\n&#34;;
    print &#34;arg_two is $arg_two\n&#34; if $arg_two;
  }
}

print &#34;#1\n&#34;;
Test-&gt;class_method&#40; arg_one =&gt; bless&#40;{}, &#39;X&#39; &#41; &#41;;

print &#34;#2\n&#34;;
Test-&gt;class_method&#40; bless&#40;{}, &#39;Y&#39; &#41;, arg_one =&gt; bless&#40;{}, &#39;X&#39; &#41; &#41;;

</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> function.pl</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/env perl
# ABSTRACT: test functions

use strict;
use warnings;

package Test {

  use MooseX::Params::Validate qw&#40; validated_list &#41;;

  sub function {
    my &#40; $arg_one, $arg_two &#41; = validated_list&#40; \@_,  arg_one =&gt; { isa =&gt; &#39;Object&#39; } &#41;;
    print &#34;arg_one is $arg_one\n&#34;;
    print &#34;arg_two is $arg_two\n&#34; if $arg_two;
  }
}

print &#34;#1\n&#34;;
Test::function&#40; arg_one =&gt; bless&#40;{}, &#39;X&#39; &#41; &#41;;

print &#34;#2\n&#34;;
Test::function&#40; bless&#40;{}, &#39;Y&#39; &#41;, arg_one =&gt; bless&#40;{}, &#39;X&#39; &#41; &#41;;

</div></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
