<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #110988 for Math-Prime-Util-GMP: Math::GMPz / Math::GMP / Math::BigInt output</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #110988 for Math-Prime-Util-GMP: Math::GMPz / Math::GMP / Math::BigInt output</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Math-Prime-Util-GMP/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Math-Prime-Util-GMP/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Math-Prime-Util-GMP/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Math-Prime-Util-GMP/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Math-Prime-Util-GMP">Math-Prime-Util-GMP CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">110988</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Math-Prime-Util-GMP/Active/">Math-Prime-Util-GMP</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">DANAJ [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
DANAJ [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
hv [...] crypt.org

<br />
sisyphus [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-244750-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-244751-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;07&nbsp;13:05:04&nbsp;2016</span>
    <span class="description">DANAJ [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> hv [...] crypt.org, sisyphus [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Math::GMPz / Math::GMP / Math::BigInt output</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Currently Math::Prime::Util:GMP does all I/O via strings.  While this is easy and very portable, it is quite time consuming for large inputs, and can add significant overhead for some functions even with small inputs.

For an example, this takes about 6 minutes currently:

    $perl -E &#39;use ntheory &#34;:all&#34;; my $n = primorial&#40;230077&#41;/2229464046810-3131794; @f = Math::Prime::Util::GMP::sieve_primes&#40;$n+1, $n+4680156-1, 1e9&#41;; say $_-$n for @f;&#39;

but the actual *work* is about 1 minute 45 seconds.  Changing sieve_primes to return the offsets directly gives that fast time, as does a change to return the full numbers as Math::GMPz objects &#40;assuming $n is a Math::GMPz object as well&#41;.


I have code to do this, it needs to be turned on in all functions and tested.  Principles &#40;please add input&#41;:

&#40;1&#41; If the input is a Math::GMPz or Math::GMP object, the mpz_t is immediately available and is used.  Otherwise it is read as a UV/IV if it fits in both UV and long, or string otherwise.  I briefly tried getting Math::BigInt::GMP input but it&#39;s complicated.

&#40;2&#41; the return type is always identical to the input if they were Math::GMPz or Math::GMP &#40;multi-argument functions will just pick one of the arguments to be the deciding one&#41;.

Now we have debatable points:

&#40;a&#41; if the input&#40;s&#41; were some other object &#40;e.g. Math::Pari or Math::BigInt&#41; should we insist that the inputs we that same object type?  This seems nice for the user.  Making Math::GMP and Math::GMPz objects for output is very simple and fast, but other types not so much &#40;we are forced to call their new&#40;&#41; methods for each return value&#41;.

&#40;b&#41; since we obviously have GMP, I&#39;m thinking I could add a dependency on Math::GMPz and make all input returned as that type if not a Math::GMP.  This could cause havoc if someone was using Math::Pari or Math::BigInt though, as they don&#39;t always play well together.

&#40;c&#41; I could add a config option &#39;class&#39; that takes values &#39;string&#39;&#39;Math::GMP&#39;,&#39;Math::GMPz&#39;, maybe others.  Setting it would force all output to that type.  &#39;string&#39; can be useful if the caller is always doing string manipulation on the output &#40;lots of OEIS sequences do this sort of thing&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;08&nbsp;20:20:30&nbsp;2016</span>
    <span class="description">sisyphus1 [...] optusnet.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> &lt;hv [...] crypt.org&gt;, &lt;sisyphus [...] cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #110988] Math::GMPz / Math::GMP / Math::BigInt output</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 9 Jan 2016 12:19:30 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Math-Prime-Util-GMP [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;sisyphus1 [...] optusnet.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message----- 
From: Dana Jacobsen via RT
Sent: Friday, January 08, 2016 5:05 AM
Cc: hv@crypt.org ; sisyphus@cpan.org
Subject: [rt.cpan.org #110988] Math::GMPz / Math::GMP / Math::BigInt output

<div class="message-stanza open">&gt; Now we have debatable points:
&gt; &#40;a&#41; if the input&#40;s&#41; were some other object &#40;e.g. Math::Pari or 
&gt; Math::BigInt&#41; should we insist that the inputs we that same object type? 
&gt; This seems nice for the user.  Making Math::GMP and Math::GMPz objects for 
&gt; output is very simple and fast, but other types not so much &#40;we are forced 
&gt; to call their new&#40;&#41; methods for each return value&#41;.
</div>
I don&#39;t think there&#39;s any hard and fast rule here.
I would expect that the output would be the same type as the input, but you 
could set it up differently if you want - in which case the documentation 
should explain your reasons for doing so.

&#40;b&#41; since we obviously have GMP, I&#39;m thinking I could add a dependency on 
Math::GMPz and make all input returned as that type if not a Math::GMP. 
This could cause havoc if someone was using Math::Pari or Math::BigInt 
though, as they don&#39;t always play well together.

It&#39;s years since I&#39;ve used Math::Pari and I don&#39;t know anything about how it 
plays with Math::GMPz - but I would have thought that $z = 
Rmpz_init_set_str&#40;$math_pari_object, 0&#41; would work reliably, though not 
particularly quickly.
Or is there more to the problem than simply converting one to the other ?
Are there other issues with Math::BigInt and Math::GMPz that will not be 
covered by #110986 ?

&#40;c&#41; I could add a config option &#39;class&#39; that takes values 
&#39;string&#39;&#39;Math::GMP&#39;,&#39;Math::GMPz&#39;, maybe others.  Setting it would force all 
output to that type.  &#39;string&#39; can be useful if the caller is always doing 
string manipulation on the output &#40;lots of OEIS sequences do this sort of 
thing&#41;.

That sounds like a good idea - obviously the user already chooses the input 
type and, with this config option, they also get to choose the output type.
It&#39;s not going to impact upon performance, it should be easy to document 
clearly, and it will allow the user to do exactly what he wants &#40;or, at 
least, to get exactly what he asked for ;-&#41;

I like &#40;c&#41;.

Cheers,
Rob
</div></div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
