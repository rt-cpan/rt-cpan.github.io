<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #82992 for IO-Socket-SSL: Don&#39;t work with some sites</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #82992 for IO-Socket-SSL: Don&#39;t work with some sites</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/IO-Socket-SSL/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/IO-Socket-SSL/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/IO-Socket-SSL/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/IO-Socket-SSL/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/IO-Socket-SSL">IO-Socket-SSL CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">82992</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/IO-Socket-SSL/Active/">IO-Socket-SSL</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
victor [...] vsespb.ru

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-17228-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.81    </td>
  </tr>
  <tr id="CF-17229-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;27&nbsp;20:07:41&nbsp;2013</span>
    <span class="description">victor [...] vsespb.ru -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Don&#39;t work for some sites

use strict;
use IO::Socket::SSL;
my $client = IO::Socket::SSL-&gt;new&#40;&#34;www.enrich.malaysiaairlines.com:https&#34;&#41;
                || warn &#34;I encountered a problem:
&#34;.IO::Socket::SSL::errstr&#40;&#41;;
print $client &#34;GET / HTTP/1.0\r\n\r\n&#34;;
print &lt;$client&gt;;


&#40;curl and firefox work fine&#41;

See also <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=70467">https://rt.cpan.org/Ticket/Display.html?id=70467</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;27&nbsp;20:08:12&nbsp;2013</span>
    <span class="description">victor [...] vsespb.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#40;prints I encountered a problem: IO::Socket::INET configuration failed
error:00000000:lib&#40;0&#41;:func&#40;0&#41;:reason&#40;0&#41; at x2.pl line 3.
&#41;

On Mon Jan 28 05:07:41 2013, vsespb wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Don&#39;t work for some sites
&gt; 
&gt; use strict;
&gt; use IO::Socket::SSL;
&gt; my $client = IO::Socket::SSL-&gt;new&#40;&#34;www.enrich.malaysiaairlines.com:https&#34;&#41;
&gt;                 || warn &#34;I encountered a problem:
&gt; &#34;.IO::Socket::SSL::errstr&#40;&#41;;
&gt; print $client &#34;GET / HTTP/1.0\r\n\r\n&#34;;
&gt; print &lt;$client&gt;;
&gt; 
&gt; 
&gt; &#40;curl and firefox work fine&#41;
&gt; 
&gt; See also <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=70467">https://rt.cpan.org/Ticket/Display.html?id=70467</a></span>
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;27&nbsp;20:08:13&nbsp;2013</span>
    <span class="description">victor [...] vsespb.ru -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;27&nbsp;20:09:18&nbsp;2013</span>
    <span class="description">victor [...] vsespb.ru -  Subject changed from &#40;no value&#41; to &#39;Don&#39;t work with some sites&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;28&nbsp;02:49:10&nbsp;2013</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi, 
I can&#39;t reproduce the problem with the given code.
This code implicitly assumes SSL_verify_mode of 0 &#40;and issues a warning 
about it&#41; but connects w/o problems.
I assume, that your real code somehow sets SSL_verify_mode to 1.
In this case the connect will fail unless you have also set an 
SSL_ca_path containing the right CA certificates.

On Sun Jan 27 20:07:41 2013, vsespb wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Don&#39;t work for some sites
&gt; 
&gt; use strict;
&gt; use IO::Socket::SSL;
&gt; my $client = IO::Socket::SSL-
&gt;new&#40;&#34;www.enrich.malaysiaairlines.com:https&#34;&#41;
&gt;                 || warn &#34;I encountered a problem:
&gt; &#34;.IO::Socket::SSL::errstr&#40;&#41;;
&gt; print $client &#34;GET / HTTP/1.0\r\n\r\n&#34;;
&gt; print &lt;$client&gt;;
&gt; 
&gt; 
&gt; &#40;curl and firefox work fine&#41;
&gt; 
&gt; See also <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=70467">https://rt.cpan.org/Ticket/Display.html?id=70467</a></span>
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;28&nbsp;02:49:11&nbsp;2013</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;28&nbsp;05:12:10&nbsp;2013</span>
    <span class="description">victor [...] vsespb.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">That was actually my real code. It fails on one of my servers and works
fine on another.

Also this ticket <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=70467">https://rt.cpan.org/Ticket/Display.html?id=70467</a></span>
absolutely reproducable. &#40;erro in same line&#41;

On Mon Jan 28 11:49:10 2013, SULLR wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi, 
&gt; I can&#39;t reproduce the problem with the given code.
&gt; This code implicitly assumes SSL_verify_mode of 0 &#40;and issues a warning 
&gt; about it&#41; but connects w/o problems.
&gt; I assume, that your real code somehow sets SSL_verify_mode to 1.
&gt; In this case the connect will fail unless you have also set an 
&gt; SSL_ca_path containing the right CA certificates.
&gt; 
&gt; On Sun Jan 27 20:07:41 2013, vsespb wrote:
<div class="message-stanza open">&gt; &gt; Don&#39;t work for some sites
&gt; &gt; 
&gt; &gt; use strict;
&gt; &gt; use IO::Socket::SSL;
&gt; &gt; my $client = IO::Socket::SSL-
&gt; &gt;new&#40;&#34;www.enrich.malaysiaairlines.com:https&#34;&#41;
&gt; &gt;                 || warn &#34;I encountered a problem:
&gt; &gt; &#34;.IO::Socket::SSL::errstr&#40;&#41;;
&gt; &gt; print $client &#34;GET / HTTP/1.0\r\n\r\n&#34;;
&gt; &gt; print &lt;$client&gt;;
&gt; &gt; 
&gt; &gt; 
&gt; &gt; &#40;curl and firefox work fine&#41;
&gt; &gt; 
&gt; &gt; See also <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=70467">https://rt.cpan.org/Ticket/Display.html?id=70467</a></span>
</div>&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;28&nbsp;05:12:12&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;28&nbsp;05:27:55&nbsp;2013</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jan 28 05:12:10 2013, vsespb wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; That was actually my real code. It fails on one of my servers and works
&gt; fine on another.
</div>
could you please provide me with some more details about the environment, where it fails, and also about the system, where it succeeds, e.g:

use strict;
use IO::Socket::SSL;
printf &#34;perl=%s IO:Socket::SSL=%s Net::SSLeay=%s openssl=%x\n&#34;,
    $^V,
    $IO::Socket::SSL::VERSION,
    $Net::SSLeay::VERSION,
    Net::SSLeay::OPENSSL_VERSION_NUMBER&#40;&#41;;


And could you please set $IO::Socket::SSL::DEBUG=10 in your code and send me the output, so that one can better see, where it fails.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;28&nbsp;05:52:31&nbsp;2013</span>
    <span class="description">victor [...] vsespb.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">ONE SERVER:

$ perl poc.pl 
perl=v5.10.1 IO:Socket::SSL=1.81 Net::SSLeay=1.52 openssl=9080bf
*******************************************************************
 Using the default of SSL_verify_mode of SSL_VERIFY_NONE for client
 is depreciated! Please set SSL_verify_mode to SSL_VERIFY_PEER
 together with SSL_ca_file|SSL_ca_path for verification.
 If you really don&#39;t want to verify the certificate and keep the
 connection open to Man-In-The-Middle attacks please set
 SSL_verify_mode explicitly to SSL_VERIFY_NONE in your application.
*******************************************************************
  at poc.pl line 6.
DEBUG: .../IO/Socket/SSL.pm:1702: new ctx 7860368
DEBUG: .../IO/Socket/SSL.pm:411: socket not yet connected
DEBUG: .../IO/Socket/SSL.pm:413: socket connected
DEBUG: .../IO/Socket/SSL.pm:431: ssl handshake not started
DEBUG: .../IO/Socket/SSL.pm:492: Net::SSLeay::connect -&gt; -1
DEBUG: .../IO/Socket/SSL.pm:1373: SSL connect attempt failed with
unknown error error:140773F2:SSL routines:SSL23_GET_SERVER_HELLO:sslv3
alert unexpected message

DEBUG: .../IO/Socket/SSL.pm:498: fatal SSL error: SSL connect attempt
failed with unknown error error:140773F2:SSL
routines:SSL23_GET_SERVER_HELLO:sslv3 alert unexpected message
DEBUG: .../IO/Socket/SSL.pm:1373: IO::Socket::INET configuration failed
error:00000000:lib&#40;0&#41;:func&#40;0&#41;:reason&#40;0&#41;

DEBUG: .../IO/Socket/SSL.pm:1739: free ctx 7860368 open=7860368
DEBUG: .../IO/Socket/SSL.pm:1747: OK free ctx 7860368
I encountered a problem:IO::Socket::INET configuration failed
error:00000000:lib&#40;0&#41;:func&#40;0&#41;:reason&#40;0&#41; at poc.pl line 6.
Can&#39;t use string &#40;&#34;1&#34;&#41; as a symbol ref while &#34;strict refs&#34; in use at
poc.pl line 7.

$ cat poc.pl
use strict;
use IO::Socket::SSL;
$IO::Socket::SSL::DEBUG=10;
printf &#34;perl=%s IO:Socket::SSL=%s Net::SSLeay=%s openssl=%x\n&#34;, $^V,
$IO::Socket::SSL::VERSION, $Net::SSLeay::VERSION,
Net::SSLeay::OPENSSL_VERSION_NUMBER&#40;&#41;;

my $client =
IO::Socket::SSL-&gt;new&#40;&#34;www.enrich.malaysiaairlines.com:https&#34;&#41; || warn &#34;I
encountered a problem:&#34;.IO::Socket::SSL::errstr&#40;&#41;;
print $client &#34;GET / HTTP/1.0\r\n\r\n&#34;; print &lt;$client&gt;;



ANOTHER SERVER:

$ perl poc.pl 
perl=v5.14.2 IO:Socket::SSL=1.81 Net::SSLeay=1.42 openssl=1000005f
DEBUG: .../IO/Socket/SSL.pm:238: set domain to 2
*******************************************************************
 Using the default of SSL_verify_mode of SSL_VERIFY_NONE for client
 is depreciated! Please set SSL_verify_mode to SSL_VERIFY_PEER
 together with SSL_ca_file|SSL_ca_path for verification.
 If you really don&#39;t want to verify the certificate and keep the
 connection open to Man-In-The-Middle attacks please set
 SSL_verify_mode explicitly to SSL_VERIFY_NONE in your application.
*******************************************************************
  at poc.pl line 6
DEBUG: .../IO/Socket/SSL.pm:1702: new ctx 139587136
DEBUG: .../IO/Socket/SSL.pm:411: socket not yet connected
DEBUG: .../IO/Socket/SSL.pm:413: socket connected
DEBUG: .../IO/Socket/SSL.pm:431: ssl handshake not started
DEBUG: .../IO/Socket/SSL.pm:492: Net::SSLeay::connect -&gt; 1
DEBUG: .../IO/Socket/SSL.pm:547: ssl handshake done
  write_all VM at entry=vm_unknown
partial `GET / HTTP/1.0

&#39;
  written so far 18:18 bytes &#40;VM=vm_unknown&#41;
HTTP/1.1 200 OK
Accept-Ranges: bytes
ETag: W/&#34;161-1347965911198&#34;
Last-Modified: Tue, 18 Sep 2012 10:58:31 GMT
Content-Type: text/html
Content-Length: 161
Date: Mon, 28 Jan 2013 10:45:31 GMT
Connection: close
Server: Anonymous Server

&lt;html&gt;
  &lt;head&gt;
    &lt;meta http-equiv=&#34;refresh&#34;
content=&#34;0;URL=<span class="clickylink"><a target="new" rel="nofollow" href="https://www.enrich.malaysiaairlines.com/EnrichWebsite/">https://www.enrich.malaysiaairlines.com/EnrichWebsite/</a></span>&#34;&gt;
  &lt;/head&gt;
  &lt;body&gt;
  &lt;/body&gt;
DEBUG: .../IO/Socket/SSL.pm:1739: free ctx 139587136 open=139587136
DEBUG: .../IO/Socket/SSL.pm:1747: OK free ctx 139587136
&lt;/html&gt;root@li488-134:/tmp

$ cat poc.pl
use strict;
use IO::Socket::SSL;
$IO::Socket::SSL::DEBUG=10;
printf &#34;perl=%s IO:Socket::SSL=%s Net::SSLeay=%s openssl=%x\n&#34;, $^V,
$IO::Socket::SSL::VERSION, $Net::SSLeay::VERSION,
Net::SSLeay::OPENSSL_VERSION_NUMBER&#40;&#41;;

my $client =
IO::Socket::SSL-&gt;new&#40;&#34;www.enrich.malaysiaairlines.com:https&#34;&#41; || warn &#34;I
encountered a problem:&#34;.IO::Socket::SSL::errstr&#40;&#41;;
print $client &#34;GET / HTTP/1.0\r\n\r\n&#34;; print &lt;$client&gt;;



NOTES:

I use code example from your documentation, without
Net::SSLeay::VERIFY_NONE&#40;&#41;. I am not sure how to use
Net::SSLeay::VERIFY_NONE&#40;&#41;, because
obvious things 
IO::Socket::SSL-&gt;new&#40;&#34;google.com:https&#34;,
SSL_verify_mode=&gt;Net::SSLeay::VERIFY_NONE&#40;&#41;&#41;
my $client = IO::Socket::SSL-&gt;new&#40;&#34;google.com:https&#34;,
{SSL_verify_mode=&gt;Net::SSLeay::VERIFY_NONE&#40;&#41;}&#41; 

crash on both servers.


On Mon Jan 28 14:27:55 2013, SULLR wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Jan 28 05:12:10 2013, vsespb wrote:
<div class="message-stanza open">&gt; &gt; That was actually my real code. It fails on one of my servers and
</div>&gt; works
<div class="message-stanza open">&gt; &gt; fine on another.
</div>&gt; 
&gt; could you please provide me with some more details about the
&gt; environment, where it fails, and also about the system, where it
&gt; succeeds, e.g:
&gt; 
&gt; use strict;
&gt; use IO::Socket::SSL;
&gt; printf &#34;perl=%s IO:Socket::SSL=%s Net::SSLeay=%s openssl=%x\n&#34;,
&gt;     $^V,
&gt;     $IO::Socket::SSL::VERSION,
&gt;     $Net::SSLeay::VERSION,
&gt;     Net::SSLeay::OPENSSL_VERSION_NUMBER&#40;&#41;;
&gt; 
&gt; 
&gt; And could you please set $IO::Socket::SSL::DEBUG=10 in your code and
&gt; send me the output, so that one can better see, where it fails.
&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;28&nbsp;07:06:47&nbsp;2013</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jan 28 05:52:31 2013, vsespb wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ONE SERVER:
&gt; perl=v5.10.1 IO:Socket::SSL=1.81 Net::SSLeay=1.52 openssl=9080bf
&gt; ...SSL routines:SSL23_GET_SERVER_HELLO:sslv3 alert unexpected message
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ANOTHER SERVER:
&gt; perl=v5.14.2 IO:Socket::SSL=1.81 Net::SSLeay=1.42 openssl=1000005f
&gt; ssl handshake done
</div>
I doubt that the perl version is relevant here, so this leaves the Net::SSLeay
version or the OpenSSL version. Since I use 1.52 to successfully connect
to the host I would suggest, that the old openssl version causes the problem.

This would not affect firefox &#40;since it does not use openssl&#41; and might not
affect curl too &#40;which can use either GnuTLS or OpenSSL&#41;.

I can reproduce the problem on a system with an older openssl library and
a recent version of IO::Socket::SSL. A look at the exchange messages with
wireshark gives the following picture:
- the server accepts TLSv1.0 records with TLSv1.1 handshakes inside
  This is used with recent openssl versions, which support TLSv1.1
- the server accepts SSLv2 records with TLSv1.0 handshakes inside
  This is used when SSL_version is set to &#39;sslv23&#39; in IO::Socket::SSL.
  This was the default in older IO::Socket::SSL versions, but for security
  reasons SSLv2 is now disabled by default, e.g. sslv23:!sslv2
- sslv23:!sslv2 causes on older openssl versions TLSv1.0 records with TLSv1.0
  handshakes inside. For some strange reason &#40;maybe misconfiguration&#41; the 
  server does not understand these SSL messages, other servers have no problems.


Because you can probably not change the server configuration the following
workarounds are possible:
- use a newer openssl version which supports TLSv1.1 &#40;openssl&gt;=1.0&#41;
- allow SSLv2 by setting SSL_version =&gt; &#39;sslv23&#39;. Note that SSLv2 is disabled
  for security reasons, so enabling it increases your risk.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; I use code example from your documentation, without
&gt; Net::SSLeay::VERIFY_NONE&#40;&#41;. I am not sure how to use
&gt; Net::SSLeay::VERIFY_NONE&#40;&#41;, because
&gt; obvious things 
&gt; IO::Socket::SSL-&gt;new&#40;&#34;google.com:https&#34;,
&gt; SSL_verify_mode=&gt;Net::SSLeay::VERIFY_NONE&#40;&#41;&#41;
&gt; my $client = IO::Socket::SSL-&gt;new&#40;&#34;google.com:https&#34;,
&gt; {SSL_verify_mode=&gt;Net::SSLeay::VERIFY_NONE&#40;&#41;}&#41; 
&gt; 
&gt; crash on both servers.
</div>
The syntax is not class-&gt;new&#40;host,%args&#41;
but class-&gt;new&#40;host&#41; OR class-&gt;new&#40;%args&#41;
if you want to give other arguments you have to specificy the target with
PeerAddr or PeerAddr+PeerPort.

This is the same with all the other IO::Socket::* stuff.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;28&nbsp;07:06:48&nbsp;2013</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
