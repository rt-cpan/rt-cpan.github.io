<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #31290 for Tk: listbox.t fails in make test on fedora with KDE desktop</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #31290 for Tk: listbox.t fails in make test on fedora with KDE desktop</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Tk/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Tk/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Tk/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Tk/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Tk">Tk CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">31290</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Tk/Active/">Tk</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
goz_02451 [...] yahoo.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-33610-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-33611-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;07&nbsp;13:32:28&nbsp;2007</span>
    <span class="description">goz_02451 [...] yahoo.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> listbox.t fails in make test on fedora with KDE desktop</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Only the listbox test fails.  Tried under Fedora 5 and 6. Relevant
output of build on FC 5 with perl 5.8.8:

# Tk platform:    unix
# window manager: KWin
#        version: &lt;unknown&gt;
# XFT:            no

t/listbox....................NOK 425/539
#   Failed test at t/listbox.t line 1587.
#          got: &#39;1&#39;
#     expected: &#39;3&#39;
t/listbox....................NOK 426/539
#   Failed test at t/listbox.t line 1588.
#          got: &#39;1&#39;
#     expected: &#39;3&#39;
t/listbox....................NOK 435/539
#   Failed test at t/listbox.t line 1619.
#          got: &#39;9&#39;
#     expected: &#39;5&#39;
t/listbox....................NOK 436/539
#   Failed test at t/listbox.t line 1628.
#          got: &#39;0.2 0.3&#39;
#     expected: &#39;0.2 0.7&#39;
t/listbox....................NOK 437/539
#   Failed test at t/listbox.t line 1629.
#          got: &#39;y 0.2 0.3&#39;
#     expected: &#39;y 0.2 0.7&#39;
t/listbox....................NOK 438/539
#   Failed test at t/listbox.t line 1638.
#          got: &#39;0.8 0.9&#39;
#     expected: &#39;0.5 1&#39;
t/listbox....................NOK 439/539
#   Failed test at t/listbox.t line 1639.
#          got: &#39;y 0.8 0.9&#39;
#     expected: &#39;y 0.5 1&#39;
t/listbox....................NOK 440/539
#   Failed test at t/listbox.t line 1649.
#          got: &#39;0.3 0.4&#39;
#     expected: &#39;0.3 0.8&#39;
Use of uninitialized value in subtraction &#40;-&#41; at t/listbox.t line 1691.
Use of uninitialized value in subtraction &#40;-&#41; at t/listbox.t line 1692.
t/listbox....................NOK 451/539
#   Failed test at t/listbox.t line 1699.
#          got: &#39;0 0.2&#39;
#     expected: &#39;0.2 0.4&#39;
t/listbox....................NOK 452/539
#   Failed test at t/listbox.t line 1700.
#          got: &#39;0 0.05&#39;
#     expected: &#39;0.5 0.75&#39;
t/listbox....................NOK 454/539
#   Failed test at t/listbox.t line 1708.
#          got: &#39;0 0.05&#39;
#     expected: &#39;0 0.25&#39;
t/listbox....................NOK 455/539
#   Failed test at t/listbox.t line 1712.
#          got: &#39;0 0.2&#39;
#     expected: &#39;0.2 0.4&#39;
t/listbox....................NOK 456/539
#   Failed test at t/listbox.t line 1713.
#          got: &#39;0,0.2&#39;
#     expected: &#39;0.2,0.4&#39;
t/listbox....................NOK 457/539
#   Failed test at t/listbox.t line 1714.
#          got: &#39;0 0.05&#39;
#     expected: &#39;0.5 0.75&#39;
t/listbox....................NOK 458/539
#   Failed test at t/listbox.t line 1715.
#          got: &#39;0,0.05&#39;
#     expected: &#39;0.5,0.75&#39;
t/listbox....................NOK 460/539
#   Failed test at t/listbox.t line 1723.
#          got: &#39;0.95 1&#39;
#     expected: &#39;0.75 1&#39;
t/listbox....................NOK 461/539
#   Failed test at t/listbox.t line 1726.
#          got: &#39;0.8 1&#39;
#     expected: &#39;0.64 0.84&#39;
t/listbox....................NOK 462/539
#   Failed test at t/listbox.t line 1727.
#          got: &#39;0.95 1&#39;
#     expected: &#39;0.25 0.5&#39;
t/listbox....................NOK 466/539
#   Failed test at t/listbox.t line 1746.
#          got: &#39;5&#39;
#     expected: &#39;6&#39;
t/listbox....................NOK 486/539
#   Failed test at t/listbox.t line 1871.
#          got: &#39;y 0 0.333333333333333&#39;
#     expected: &#39;y 0 1&#39;
t/listbox....................NOK 487/539
#   Failed test at t/listbox.t line 1872.
#          got: &#39;y 0 0.125&#39;
#     expected: &#39;y 0 0.625&#39;
t/listbox....................ok 495/539# Looks like you failed 21 tests
of 539.
t/listbox....................dubious
        Test returned status 21 &#40;wstat 5376, 0x1500&#41;
DIED. FAILED tests 425-426, 435-440, 451-452, 454-458, 460-462, 466, 486-487
        Failed 21/539 tests, 96.10% okay &#40;less 26 skipped tests: 492
okay, 91.28%&#41;


Adding a sleep to the test just after line 1588 shows that no characters
are displayed in the listbox.  When I coded up an emulation of that test
it displays correctly, but printed 2 instead of 3 for both lines.  The
test code is attached.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> lbtest.pl</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl -w

use Tk;
use Tk::Listbox;

my $mw = MainWindow-&gt;new&#40; -title =&gt; &#34;Listbox Test&#34;&#41;;

$mw-&gt;optionAdd&#40;&#34;*Listbox.font&#34;, &#39;Helvetica -12 bold&#39;&#41;; # 2 2 
# $mw-&gt;optionAdd&#40;&#34;*Listbox.font&#34;, &#39;{Adobe Helvetica} -12 bold&#39;&#41;; # 2 2
# my $fixed = &#34;-adobe-courier-medium-r-normal--12-120-75-75-m-*-iso8859-1&#34;;
$mw-&gt;optionAdd&#40;&#34;*Listbox.font&#34;, $fixed&#41;; # 2 3 on fc5 but 3 3 on fc6

$mw-&gt;optionAdd&#40;&#34;*Listbox.borderWidth&#34;,2&#41;;
$mw-&gt;optionAdd&#40;&#34;*Listbox.highlightThickness&#34;,2&#41;;

my $lb = $mw-&gt;Listbox-&gt;pack;

$lb-&gt;delete&#40;qw/0 end/&#41;;
$lb-&gt;insert&#40;qw/0 el0 el1 el2 el3 el4 el5 el6 el7 el8 el9 el10 el11/&#41;;
$lb-&gt;update;

print &#34;Tk version $Tk::VERSION\n&#34;;
print &#34;Listbox version $Tk::Listbox::VERSION\n&#34;;
print &#34;Line 1587 result is: &#34;,$lb-&gt;index&#40;q/@5,57/&#41;,&#34; expect 3\n&#34;;
print &#34;Line 1587 result is: &#34;,$lb-&gt;index&#40;q/@5,58/&#41;,&#34; expect 3\n&#34;;

# loop so we can see what this should look like
MainLoop;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;07&nbsp;13:49:18&nbsp;2007</span>
    <span class="description">goz_02451 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> goz_02451 [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Build on same system with same installed fonts and same xfs fontserver
passes all tests under gnome desktop.

# Tk platform:    unix
# window manager: Metacity
#        version: 2.14.3
# XFT:            no

t/listbox....................ok
        26/539 skipped: various reasons, 4/539 unexpectedly succeeded
TODO PASSED tests 320-322, 328

lbtest.pl output using &#39;Helvetica -12 bold&#39; &#40;not $fixed&#41; is now:
Tk version 804.027502
Listbox version 4.014
Line 1587 result is: 3 expect 3
Line 1587 result is: 3 expect 3
     ^^ typo, should be 1588
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;07&nbsp;14:58:44&nbsp;2007</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> SREZIC [...] cpan.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Dec 07 13:32:28 2007, goz_02451@yahoo.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Only the listbox test fails.  Tried under Fedora 5 and 6. Relevant
&gt; output of build on FC 5 with perl 5.8.8:
&gt; 
</div>[...]
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Adding a sleep to the test just after line 1588 shows that no characters
&gt; are displayed in the listbox. 
</div>
Instead of a sleep, can you add

    $mw-&gt;waitVariable&#40;\my $foo&#41;;

instead at this point and then try some window manager related options
like resizing, iconifying &#38; restoring, maximizing etc. to make the
listbox contents visible?

Regards,
    Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;07&nbsp;14:58:47&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;10&nbsp;15:56:51&nbsp;2007</span>
    <span class="description">goz_02451 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> goz_02451 [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Dec 07 14:58:44 2007, SREZIC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri Dec 07 13:32:28 2007, goz_02451@yahoo.com wrote:
<div class="message-stanza open">&gt; &gt; Only the listbox test fails.  Tried under Fedora 5 and 6. Relevant
&gt; &gt; output of build on FC 5 with perl 5.8.8:
&gt; &gt; 
</div>&gt; [...]
<div class="message-stanza open">&gt; &gt; 
&gt; &gt; Adding a sleep to the test just after line 1588 shows that no characters
&gt; &gt; are displayed in the listbox. 
</div>&gt; 
&gt; Instead of a sleep, can you add
&gt; 
&gt;     $mw-&gt;waitVariable&#40;\my $foo&#41;;
&gt; 
&gt; instead at this point and then try some window manager related options
&gt; like resizing, iconifying &#38; restoring, maximizing etc. to make the
&gt; listbox contents visible?
&gt; 
&gt; Regards,
&gt;     Slaven
</div>

Good idea.  When it stopped, I found that there were two
windows.  The one in front has the title &#34;Toplevel&#34; and
is an empty frame with plain gray background.  Behind it
is a second window with title &#34;Listbox&#34; and it has the 
expected contents: el0 ... el9, although it is 
sized so that only the first two lines are showing.  
Resizing it shows the rest of the lines.  The 
font looks OK to me.

If I close Listbox then both windows get closed, but I can 
close Toplevel and Listbox will still be there.  So
that means Toplevel is a child of Listbox?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;10&nbsp;16:04:26&nbsp;2007</span>
    <span class="description">goz_02451 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> goz_02451 [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Dec 10 15:56:51 2007, goz_02451@yahoo.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri Dec 07 14:58:44 2007, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; On Fri Dec 07 13:32:28 2007, goz_02451@yahoo.com wrote:
<div class="message-stanza open">&gt; &gt; &gt; Only the listbox test fails.  Tried under Fedora 5 and 6. Relevant
&gt; &gt; &gt; output of build on FC 5 with perl 5.8.8:
&gt; &gt; &gt; 
</div>&gt; &gt; [...]
<div class="message-stanza open">&gt; &gt; &gt; 
&gt; &gt; &gt; Adding a sleep to the test just after line 1588 shows that no
</div></div></div>characters
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; are displayed in the listbox. 
</div>&gt; &gt; 
&gt; &gt; Instead of a sleep, can you add
&gt; &gt; 
&gt; &gt;     $mw-&gt;waitVariable&#40;\my $foo&#41;;
&gt; &gt; 
&gt; &gt; instead at this point and then try some window manager related options
&gt; &gt; like resizing, iconifying &#38; restoring, maximizing etc. to make the
&gt; &gt; listbox contents visible?
&gt; &gt; 
&gt; &gt; Regards,
&gt; &gt;     Slaven
</div>&gt; 
&gt; 
&gt; Good idea.  When it stopped, I found that there were two
&gt; windows.  The one in front has the title &#34;Toplevel&#34; and
&gt; is an empty frame with plain gray background.  Behind it
&gt; is a second window with title &#34;Listbox&#34; and it has the 
&gt; expected contents: el0 ... el9, although it is 
&gt; sized so that only the first two lines are showing.  
&gt; Resizing it shows the rest of the lines.  The 
&gt; font looks OK to me.
&gt; 
&gt; If I close Listbox then both windows get closed, but I can 
&gt; close Toplevel and Listbox will still be there.  So
&gt; that means Toplevel is a child of Listbox?
</div>

When I try the same test with gnome, it has the same two 
windows, but the Listbox window shows all 10 lines.  I
don&#39;t see any other obvious difference - except that the 
test passes.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;11&nbsp;11:23:57&nbsp;2007</span>
    <span class="description">goz_02451 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> goz_02451 [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">That seems to be the problem.  When I create the Listbox with
my $lb = $mw-&gt;Listbox&#40;-height=&gt;2&#41;-&gt;pack;
My lbtest.pl script reports:
Line 1587 result is: 1 expect 3
Line 1587 result is: 1 expect 3

So I&#39;m trying to figure out why the Listbox is only two lines in
KDE but 10 lines in gnome.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;11&nbsp;13:03:32&nbsp;2007</span>
    <span class="description">goz_02451 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> goz_02451 [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Just to check, I added a pause before line 1587 to allow me to resize
the  window.

SKIP: {
    skip&#40;$skip_font_test, 2&#41; if $skip_font_test;
my $line = &lt;STDIN&gt;;  $lb-&gt;update;
    is&#40;$lb-&gt;index&#40;q/@5,57/&#41;, 3&#41;;
    is&#40;$lb-&gt;index&#40;q/@5,58/&#41;, 3&#41;;
$mw-&gt;waitVariable&#40;\my $foo&#41;;
}

If I resize the window manually to a larger size, then it passes these
two tests.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;11&nbsp;16:58:07&nbsp;2007</span>
    <span class="description">slaven [...] rezic.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #31290] listbox.t fails in make test on fedora with KDE desktop</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> 11 Dec 2007 22:50:02 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Tk [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Slaven Rezic &lt;slaven [...] rezic.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Mr J Mather via RT&#34; &lt;bug-Tk@rt.cpan.org&gt; writes:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Tk
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=31290">http://rt.cpan.org/Ticket/Display.html?id=31290</a></span> &gt;
&gt; 
&gt; Just to check, I added a pause before line 1587 to allow me to resize
&gt; the  window.
&gt; 
&gt; SKIP: {
&gt;     skip&#40;$skip_font_test, 2&#41; if $skip_font_test;
&gt; my $line = &lt;STDIN&gt;;  $lb-&gt;update;
&gt;     is&#40;$lb-&gt;index&#40;q/@5,57/&#41;, 3&#41;;
&gt;     is&#40;$lb-&gt;index&#40;q/@5,58/&#41;, 3&#41;;
&gt; $mw-&gt;waitVariable&#40;\my $foo&#41;;
&gt; }
&gt; 
&gt; If I resize the window manually to a larger size, then it passes these
&gt; two tests.
&gt; 
</div>
I assume this is related to the many TODO tests in wm-tcl.t, where
toplevels are not resized as expected on some window managers &#40;notably
kwin&#41;.

Regards,
    Slaven

-- 
Slaven Rezic - slaven &lt;at&gt; rezic &lt;dot&gt; de

    tktimex - time recording tool
    <span class="clickylink"><a target="new" rel="nofollow" href="http://sourceforge.net/projects/ptktools/">http://sourceforge.net/projects/ptktools/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;18&nbsp;11:49:24&nbsp;2008</span>
    <span class="description">goz_02451 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> goz_02451 [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Dec 11 16:58:07 2007, slaven@rezic.de wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#34;Mr J Mather via RT&#34; &lt;bug-Tk@rt.cpan.org&gt; writes:
&gt; 
<div class="message-stanza open">&gt; &gt;        Queue: Tk
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=31290">http://rt.cpan.org/Ticket/Display.html?id=31290</a></span> &gt;
&gt; &gt; 
&gt; &gt; Just to check, I added a pause before line 1587 to allow me to resize
&gt; &gt; the  window.
&gt; &gt; 
&gt; &gt; SKIP: {
&gt; &gt;     skip&#40;$skip_font_test, 2&#41; if $skip_font_test;
&gt; &gt; my $line = &lt;STDIN&gt;;  $lb-&gt;update;
&gt; &gt;     is&#40;$lb-&gt;index&#40;q/@5,57/&#41;, 3&#41;;
&gt; &gt;     is&#40;$lb-&gt;index&#40;q/@5,58/&#41;, 3&#41;;
&gt; &gt; $mw-&gt;waitVariable&#40;\my $foo&#41;;
&gt; &gt; }
&gt; &gt; 
&gt; &gt; If I resize the window manually to a larger size, then it passes these
&gt; &gt; two tests.
&gt; &gt; 
</div>&gt; 
&gt; I assume this is related to the many TODO tests in wm-tcl.t, where
&gt; toplevels are not resized as expected on some window managers &#40;notably
&gt; kwin&#41;.
&gt; 
&gt; Regards,
&gt;     Slaven
&gt; 
</div>

I think KDE must be somehow causing the window to be marked
as manually resized or moved, because clearing the geometry
fixes this problem.  I can&#39;t see any reason why the geometry
should be set at this point in the test, so clearing it should
be a no-op.  Tested in KDE and Gnome.

diff -c listbox.t.orig listbox.t
*** listbox.t.orig      2008-03-17 10:05:57.000000000 -0400
--- listbox.t   2008-03-17 15:51:11.000000000 -0400
***************
*** 1579,1584 ****
--- 1579,1585 ----

  $lb-&gt;delete&#40;qw/0 end/&#41;;
  $lb-&gt;insert&#40;qw/0 el0 el1 el2 el3 el4 el5 el6 el7 el8 el9 el10 el11/&#41;;
+ $mw-&gt;geometry&#40;&#34;&#34;&#41;;
  $lb-&gt;update;

  SKIP: {
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;22&nbsp;16:49:38&nbsp;2008</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Mar 18 11:49:24 2008, goz_02451@yahoo.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Tue Dec 11 16:58:07 2007, slaven@rezic.de wrote:
<div class="message-stanza open">&gt; &gt; &#34;Mr J Mather via RT&#34; &lt;bug-Tk@rt.cpan.org&gt; writes:
&gt; &gt; 
<div class="message-stanza open">&gt; &gt; &gt;        Queue: Tk
&gt; &gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=31290">http://rt.cpan.org/Ticket/Display.html?id=31290</a></span> &gt;
&gt; &gt; &gt; 
&gt; &gt; &gt; Just to check, I added a pause before line 1587 to allow me to resize
&gt; &gt; &gt; the  window.
&gt; &gt; &gt; 
&gt; &gt; &gt; SKIP: {
&gt; &gt; &gt;     skip&#40;$skip_font_test, 2&#41; if $skip_font_test;
&gt; &gt; &gt; my $line = &lt;STDIN&gt;;  $lb-&gt;update;
&gt; &gt; &gt;     is&#40;$lb-&gt;index&#40;q/@5,57/&#41;, 3&#41;;
&gt; &gt; &gt;     is&#40;$lb-&gt;index&#40;q/@5,58/&#41;, 3&#41;;
&gt; &gt; &gt; $mw-&gt;waitVariable&#40;\my $foo&#41;;
&gt; &gt; &gt; }
&gt; &gt; &gt; 
&gt; &gt; &gt; If I resize the window manually to a larger size, then it passes these
&gt; &gt; &gt; two tests.
&gt; &gt; &gt; 
</div>&gt; &gt; 
&gt; &gt; I assume this is related to the many TODO tests in wm-tcl.t, where
&gt; &gt; toplevels are not resized as expected on some window managers &#40;notably
&gt; &gt; kwin&#41;.
&gt; &gt; 
&gt; &gt; Regards,
&gt; &gt;     Slaven
&gt; &gt; 
</div>&gt; 
&gt; 
&gt; I think KDE must be somehow causing the window to be marked
&gt; as manually resized or moved, because clearing the geometry
&gt; fixes this problem.  I can&#39;t see any reason why the geometry
&gt; should be set at this point in the test, so clearing it should
&gt; be a no-op.  Tested in KDE and Gnome.
&gt; 
&gt; diff -c listbox.t.orig listbox.t
&gt; *** listbox.t.orig      2008-03-17 10:05:57.000000000 -0400
&gt; --- listbox.t   2008-03-17 15:51:11.000000000 -0400
&gt; ***************
&gt; *** 1579,1584 ****
&gt; --- 1579,1585 ----
&gt; 
&gt;   $lb-&gt;delete&#40;qw/0 end/&#41;;
&gt;   $lb-&gt;insert&#40;qw/0 el0 el1 el2 el3 el4 el5 el6 el7 el8 el9 el10 el11/&#41;;
&gt; + $mw-&gt;geometry&#40;&#34;&#34;&#41;;
&gt;   $lb-&gt;update;
&gt; 
&gt;   SKIP: {
</div>
This hack is now in the Tk SVN repository
<span class="clickylink"><a target="new" rel="nofollow" href="https://svn.perl.org/modules/Tk/trunk">https://svn.perl.org/modules/Tk/trunk</a></span> .

Thanks,
    Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;22&nbsp;16:49:56&nbsp;2008</span>
    <span class="description">SREZIC [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
