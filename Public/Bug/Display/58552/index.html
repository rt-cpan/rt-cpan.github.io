<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #58552 for DBD-Pg: Fix marshalling of arrays containing &#39;, &#34;, and/or \</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #58552 for DBD-Pg: Fix marshalling of arrays containing &#39;, &#34;, and/or \</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBD-Pg">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBD-Pg">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBD-Pg">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBD-Pg">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-Pg">DBD-Pg CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">58552</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBD-Pg">DBD-Pg</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
noah [...] leadboat.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-10200-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.17.1    </td>
  </tr>
  <tr id="CF-10201-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
2.19.0    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




dbdpg-array-backslash-v2.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/975816/507873/dbdpg-array-backslash-v2.patch">
Fri Sep 09 09:20:57 2011 (10.9k) by MARKSTOS [...] cpan.org
</a>
</font></li>
</ul>


dbdpg-array-backslash-v3.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/986283/513492/dbdpg-array-backslash-v3.patch">
Mon Oct 10 10:49:31 2011 (11.1k) by MARKSTOS [...] cpan.org
</a>
</font></li>
</ul>


dbdpg-array-backslash.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/793692/411455/dbdpg-array-backslash.patch">
Mon Jun 21 01:53:52 2010 (10.4k) by noah [...] leadboat.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=58552">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-793692" href="/Public/Bug/Display.html?id=58552#txn-793692">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;21&nbsp;01:53:52&nbsp;2010</span>
    <span class="description">noah [...] leadboat.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Fix marshalling of arrays containing &#39;, &#34;, and/or \</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/793692/411454/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/411454">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Versions 2.14.0 and 2.15.0 included some fixes for arrays and -&gt;quote,
but there
a few more holes to plug.  Try:

use DBI;
$dbh = DBI-&gt;connect&#40;undef, undef, undef, {RaiseError =&gt; 1, PrintError =&gt;
0, AutoCommit =&gt; 1}&#41;;
for &#40;&#39;a\\b&#39;, &#39;a\&#39;b&#39;&#41; {
        print &#34;$_ =&gt; &#34;, &#40;$dbh-&gt;selectrow_array&#40;&#39;SELECT ?::text[]&#39;, {},
[$_]&#41;&#41;[0]-&gt;[0], &#34;\n&#34;;
        print &#34;$_ =&gt; &#34;, &#40;$dbh-&gt;selectrow_array&#40;&#39;SELECT &#39; .
$dbh-&gt;quote&#40;[$_]&#41;. &#39;::text[]&#39;&#41;&#41;[0]-&gt;[0], &#34;\n&#34;;
}

pg_stringify_array is doing some of the jobs of quote_string &#40;prepend/append
single-quotes, double backslashes&#41; but missing others &#40;double single-quotes,
possibly add the escape string prefix&#41;.  The attached patch changes
`quote&#39; to
pass the product of pg_stringify_array through the standard quoting
mechanism,
and it changes pg_stringify_array to only format the string for the needs of
anyarray_in, removing it from the quoted string business.

The relevant test group, 09arrays.t, checks an expected value for the
server&#39;s
raw array output by storing and retrieving the array under
pg_expand_array=0.
It checks an expected output of $dbh-&gt;quote directly and by converting
it to a
Perl array for comparison to a value retrieved under pg_expand_array=1.  The
tests passed because those expectations were incorrect.  This patch
keeps the
first test &#40;with corrected expectations&#41; and discards the second.  In
its place,
I attempt a dynamic INSERT based on $dbh-&gt;quote output, and I directly
compare
the Perl array provided to $sth-&gt;execute or $dbh-&gt;quote to the retrieved
value.
For some reason, the code in that area was checking each expected error
message
twice; I changed it to check only once, but perhaps I missed something in so
doing.  Since this change removes escape_string_warning damage from the
array
tests, I also remove the code disabling that.  Applying just the 09arrays.t
changes will illustrate the failure points in the current implementation.

Unfortunately, this is another compatibility break.  However, I inasmuch
as it
breaks compatibility, it brings $sth-&gt;bind_param and $dbh-&gt;quote closer
to their
contracts for the affected data.

Thanks,
nm
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> dbdpg-array-backslash.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/793692/411455/dbdpg-array-backslash.patch">Download dbdpg-array-backslash.patch</a><br />
<span class="downloadcontenttype">text/x-diff 10.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: dbdimp.c
===================================================================
--- dbdimp.c	&#40;revision 14181&#41;
+++ dbdimp.c	&#40;working copy&#41;
@@ -2259,7 +2259,7 @@
 		}
 		else if &#40;SvTYPE&#40;SvRV&#40;newvalue&#41;&#41; == SVt_PVAV&#41; {
 			SV * quotedval;
-			quotedval = pg_stringify_array&#40;newvalue,&#34;,&#34;,imp_dbh-&gt;pg_server_version, 0&#41;;
+			quotedval = pg_stringify_array&#40;newvalue,&#34;,&#34;,imp_dbh-&gt;pg_server_version&#41;;
 			currph-&gt;valuelen = sv_len&#40;quotedval&#41;;
 			Renew&#40;currph-&gt;value, currph-&gt;valuelen+1, char&#41;; /* freed in dbd_st_destroy */
 			currph-&gt;value = SvUTF8&#40;quotedval&#41; ? SvPVutf8_nolen&#40;quotedval&#41; : SvPV_nolen&#40;quotedval&#41;;
@@ -2393,7 +2393,7 @@
 
 
 /* ================================================================== */
-SV * pg_stringify_array&#40;SV *input, const char * array_delim, int server_version, int extraquotes&#41; {
+SV * pg_stringify_array&#40;SV *input, const char * array_delim, int server_version&#41; {
 
 	dTHX;
 	AV * toparr;
@@ -2412,14 +2412,12 @@
 	if &#40;TSTART&#41; TRC&#40;DBILOGFP, &#34;%sBegin pg_stringify_array\n&#34;, THEADER&#41;;
 
 	toparr = &#40;AV *&#41; SvRV&#40;input&#41;;
-	value = extraquotes ? newSVpv&#40;&#34;&#39;{&#34;, 2&#41; : newSVpv&#40;&#34;{&#34;, 1&#41;;
+	value = newSVpv&#40;&#34;{&#34;, 1&#41;;
 
 	/* Empty arrays are easy */
 	if &#40;av_len&#40;toparr&#41; &lt; 0&#41; {
 		av_clear&#40;toparr&#41;;
 		sv_catpv&#40;value, &#34;}&#34;&#41;;
-		if &#40;extraquotes&#41;
-			sv_catpv&#40;value, &#34;&#39;&#34;&#41;;
 		if &#40;TEND&#41; TRC&#40;DBILOGFP, &#34;%sEnd pg_stringify_array &#40;empty&#41;\n&#34;, THEADER&#41;;
 		return value;
 	}
@@ -2489,14 +2487,9 @@
 					SvUTF8_on&#40;value&#41;;
 				string = SvPV&#40;svitem, svlen&#41;;
 				while &#40;svlen--&#41; {
-
-					/* If an embedded quote, throw a backslash before it */
-					if &#40;&#39;\&#34;&#39; == *string&#41;
+					/* Escape backslashes and double-quotes. */
+					if &#40;&#39;\&#34;&#39; == *string || &#39;\\&#39; == *string&#41;
 						sv_catpvn&#40;value, &#34;\\&#34;, 1&#41;;
-					/* If a backslash, double it up */
-					if &#40;&#39;\\&#39; == *string&#41; {
-						sv_catpvn&#40;value, &#34;\\\\\\&#34;, 3&#41;;
-					}
 					sv_catpvn&#40;value, string, 1&#41;;
 					string++;
 				}
@@ -2521,8 +2514,6 @@
 	for &#40;xy=0; xy&lt;array_depth; xy++&#41; {
 		sv_catpv&#40;value, &#34;}&#34;&#41;;
 	}
-	if &#40;extraquotes&#41;
-		sv_catpv&#40;value, &#34;&#39;&#34;&#41;;
 
 	if &#40;TEND&#41; TRC&#40;DBILOGFP, &#34;%sEnd pg_stringify_array &#40;string: %s&#41;\n&#34;, THEADER, neatsvpv&#40;value,0&#41;&#41;;
 	return value;
Index: dbdimp.h
===================================================================
--- dbdimp.h	&#40;revision 14181&#41;
+++ dbdimp.h	&#40;working copy&#41;
@@ -187,7 +187,7 @@
 
 SV * pg_db_pg_notifies &#40;SV *dbh, imp_dbh_t *imp_dbh&#41;;
 
-SV * pg_stringify_array&#40;SV * input, const char * array_delim, int server_version, int extraquotes&#41;;
+SV * pg_stringify_array&#40;SV * input, const char * array_delim, int server_version&#41;;
 
 int pg_quickexec &#40;SV *dbh, const char *sql, const int asyncflag&#41;;
 
Index: Pg.xs
===================================================================
--- Pg.xs	&#40;revision 14181&#41;
+++ Pg.xs	&#40;working copy&#41;
@@ -198,15 +198,18 @@
 
 		SvGETMAGIC&#40;to_quote_sv&#41;;
 
+		/* Reject references other than overloaded objects &#40;presumed
+		  stringifiable&#41; and arrays &#40;will make a PostgreSQL array&#41;. */
+		if &#40;SvROK&#40;to_quote_sv&#41; &#38;&#38; !SvAMAGIC&#40;to_quote_sv&#41;&#41; {
+			if &#40;SvTYPE&#40;SvRV&#40;to_quote_sv&#41;&#41; != SVt_PVAV&#41;
+				croak&#40;&#34;Cannot quote a reference&#34;&#41;;
+			to_quote_sv = pg_stringify_array&#40;to_quote_sv, &#34;,&#34;, imp_dbh-&gt;pg_server_version&#41;;
+		}
+
 		/* Null is always returned as &#34;NULL&#34;, so we can ignore any type given */
 		if &#40;!SvOK&#40;to_quote_sv&#41;&#41; {
 			RETVAL = newSVpvn&#40;&#34;NULL&#34;, 4&#41;;
 		}
-		else if &#40;SvROK&#40;to_quote_sv&#41; &#38;&#38; !SvAMAGIC&#40;to_quote_sv&#41;&#41; {
-			if &#40;SvTYPE&#40;SvRV&#40;to_quote_sv&#41;&#41; != SVt_PVAV&#41;
-				croak&#40;&#34;Cannot quote a reference&#34;&#41;;
-			RETVAL = pg_stringify_array&#40;to_quote_sv, &#34;,&#34;, imp_dbh-&gt;pg_server_version, 1&#41;;
-		}
 		else {
 			sql_type_info_t *type_info;
 			char *quoted;
Index: t/09arrays.t
===================================================================
--- t/09arrays.t	&#40;revision 14181&#41;
+++ t/09arrays.t	&#40;working copy&#41;
@@ -18,7 +18,7 @@
 if &#40;! defined $dbh&#41; {
 	plan skip_all =&gt; &#39;Connection to database failed, cannot continue testing&#39;;
 }
-plan tests =&gt; 257;
+plan tests =&gt; 200;
 
 isnt &#40;$dbh, undef, &#39;Connect to database for array testing&#39;&#41;;
 
@@ -26,10 +26,6 @@
 
 my $pgversion = $dbh-&gt;{pg_server_version};
 
-if &#40;$pgversion &gt;= 80100&#41; {
-  $dbh-&gt;do&#40;&#39;SET escape_string_warning = false&#39;&#41;;
-}
-
 my $SQL = q{DELETE FROM dbd_pg_test WHERE pname = &#39;Array Testing&#39;};
 my $cleararray = $dbh-&gt;prepare&#40;$SQL&#41;;
 
@@ -62,8 +58,8 @@
 is &#40;$@, q{}, $t&#41;;
 $dbh-&gt;rollback&#40;&#41;;
 
-## Input
-## Expected
+## Input &#40;eval-able Perl&#41;
+## Expected &#40;ERROR or raw PostgreSQL output&#41;
 ## Name of test
 
 my $array_tests =
@@ -120,51 +116,51 @@
 Unbalanced array
 
 [123]
-{123} quote: {&#34;123&#34;}
+{123}
 Simple 1-D numeric array
 
 [&#39;abc&#39;]
-{abc} quote: {&#34;abc&#34;}
+{abc}
 Simple 1-D text array
 
 [&#39;a&#39;,&#39;b,c&#39;]
-{a,&#34;b,c&#34;} quote: {&#34;a&#34;,&#34;b,c&#34;}
+{a,&#34;b,c&#34;}
 Text array with commas and quotes
 
 [&#39;a&#39;,&#39;b,}&#39;]
-{a,&#34;b,}&#34;} quote: {&#34;a&#34;,&#34;b,}&#34;}
+{a,&#34;b,}&#34;}
 Text array with commas, escaped closing brace
 
 [&#39;a&#39;,&#39;b,]&#39;]
-{a,&#34;b,]&#34;} quote: {&#34;a&#34;,&#34;b,]&#34;}
+{a,&#34;b,]&#34;}
 Text array with commas, escaped closing bracket
 
 [1,2]
-{1,2} quote: {&#34;1&#34;,&#34;2&#34;}
+{1,2}
 Simple 1-D numeric array
 
 [[1]]
-{{1}} quote: {{&#34;1&#34;}}
+{{1}}
 Simple 2-D numeric array
 
 [[1,2]]
-{{1,2}} quote: {{&#34;1&#34;,&#34;2&#34;}}
+{{1,2}}
 Simple 2-D numeric array
 
 [[[1]]]
-{{{1}}} quote: {{{&#34;1&#34;}}}
+{{{1}}}
 Simple 3-D numeric array
 
 [[[&#34;alpha&#34;,2],[23,&#34;pop&#34;]]]
-{{{alpha,2},{23,pop}}} quote: {{{&#34;alpha&#34;,&#34;2&#34;},{&#34;23&#34;,&#34;pop&#34;}}}
+{{{alpha,2},{23,pop}}}
 3-D mixed array
 
 [[[1,2,3],[4,5,&#34;6&#34;],[&#34;seven&#34;,&#34;8&#34;,&#34;9&#34;]]]
-{{{1,2,3},{4,5,6},{seven,8,9}}} quote: {{{&#34;1&#34;,&#34;2&#34;,&#34;3&#34;},{&#34;4&#34;,&#34;5&#34;,&#34;6&#34;},{&#34;seven&#34;,&#34;8&#34;,&#34;9&#34;}}}
+{{{1,2,3},{4,5,6},{seven,8,9}}}
 3-D mixed array
 
 [q{O&#39;RLY?}]
-{O&#39;RLY?} quote: {&#34;O&#39;RLY?&#34;}
+{O&#39;RLY?}
 Simple single quote
 
 [q{O&#34;RLY?}]
@@ -172,19 +168,19 @@
 Simple double quote
 
 [[q{O&#34;RLY?}],[q|&#39;Ya&#39; - &#34;really&#34;|],[123]]
-{{&#34;O\&#34;RLY?&#34;},{&#34;&#39;Ya&#39; - \&#34;really\&#34;&#34;},{123}} quote: {{&#34;O\&#34;RLY?&#34;},{&#34;&#39;Ya&#39; - \&#34;really\&#34;&#34;},{&#34;123&#34;}}
+{{&#34;O\&#34;RLY?&#34;},{&#34;&#39;Ya&#39; - \&#34;really\&#34;&#34;},{123}}
 Many quotes
 
 [&#34;Single\\\\Backslash&#34;]
-{&#34;Single\\\\\\\\Backslash&#34;} quote: {&#34;Single\\\\\\\\Backslash&#34;}
+{&#34;Single\\\\Backslash&#34;}
 Single backslash testing
 
 [&#34;Double\\\\\\\\Backslash&#34;]
-{&#34;Double\\\\\\\\\\\\\\\\Backslash&#34;} quote: {&#34;Double\\\\\\\\\\\\\\\\Backslash&#34;}
+{&#34;Double\\\\\\\\Backslash&#34;}
 Double backslash testing
 
 [[&#34;Test\\\nRun&#34;,&#34;Quite \&#34;so\&#34;&#34;],[&#34;back\\\\\\\\slashes are a \&#34;pa\\\\in\&#34;&#34;,123] ]
-{{&#34;Test\\\\\\\\nRun&#34;,&#34;Quite \&#34;so\&#34;&#34;},{&#34;back\\\\\\\\\\\\\\\\slashes are a \&#34;pa\\\\\\\\in\&#34;&#34;,123}} quote: {{&#34;Test\\\\\\\nRun&#34;,&#34;Quite \&#34;so\&#34;&#34;},{&#34;back\\\\\\\\\\\\\\\\slashes are a \&#34;pa\\\\\\\\in\&#34;&#34;,&#34;123&#34;}}
+{{&#34;Test\\\nRun&#34;,&#34;Quite \&#34;so\&#34;&#34;},{&#34;back\\\\\\\\slashes are a \&#34;pa\\\\in\&#34;&#34;,123}}
 Escape party - backslash+newline, two + one
 
 [undef]
@@ -196,25 +192,25 @@
 NEED 80200: Simple undef test
 
 [[1,2],[undef,3],[&#34;four&#34;,undef],[undef,undef]]
-{{1,2},{NULL,3},{four,NULL},{NULL,NULL}} quote: {{&#34;1&#34;,&#34;2&#34;},{NULL,&#34;3&#34;},{&#34;four&#34;,NULL},{NULL,NULL}}
+{{1,2},{NULL,3},{four,NULL},{NULL,NULL}}
 NEED 80200: Multiple undef test
 
 !;
 
 ## Note: We silently allow things like this: [[[]],[]]
 
-$dbh-&gt;{pg_expand_array} = 0;
+sub safe_getarray {
+	my $ret = eval {
+		$getarray-&gt;execute&#40;&#41;;
+		$getarray-&gt;fetchall_arrayref&#40;&#41;-&gt;[0][0];
+	};
+	$@ || $ret
+}
 
 for my $test &#40;split /\n\n/ =&gt; $array_tests&#41; {
 	next unless $test =~ /\w/;
 	my &#40;$input,$expected,$msg&#41; = split /\n/ =&gt; $test;
-	my $qexpected = $expected;
-	if &#40;$expected =~ s/\s*quote:\s*&#40;.+&#41;//&#41; {
-		$qexpected = $1;
-	}
-	if &#40;$qexpected !~ /^ERROR/&#41; {
-		$qexpected = qq{&#39;$qexpected&#39;};
-	}
+	my $perl_input = eval $input;
 
 	if &#40;$msg =~ s/NEED &#40;\d+&#41;:\s*//&#41; {
 		my $ver = $1;
@@ -226,88 +222,47 @@
 		}
 	}
 
-	$t=&#34;Correct array inserted: $msg : $input&#34;;
-	$cleararray-&gt;execute&#40;&#41;;
+	# INSERT via bind values
+	$dbh-&gt;rollback;
 	eval {
-		$addarray-&gt;execute&#40;eval $input&#41;;
+		$addarray-&gt;execute&#40;$perl_input&#41;;
 	};
 	if &#40;$expected =~ /error:\s+&#40;.+&#41;/i&#41; {
-		like &#40;$@, qr{$1}, &#34;Array failed : $msg : $input&#34;&#41;;
-		like &#40;$@, qr{$1}, &#34;Array failed : $msg : $input&#34;&#41;;
+		like &#40;$@, qr{$1}, &#34;[bind] Array insert error : $msg : $input&#34;&#41;;
 	}
 	else {
-		is &#40;$@, q{}, &#34;Array worked : $msg : $input&#34;&#41;;
-		$getarray-&gt;execute&#40;&#41;;
-		$result = $getarray-&gt;fetchall_arrayref&#40;&#41;-&gt;[0][0];
-		is &#40;$result, $expected, $t&#41;;
+		is &#40;$@, q{}, &#34;[bind] Array insert success : $msg : $input&#34;&#41;;
+
+		$t=&#34;[bind][!expand] Correct array inserted: $msg : $input&#34;;
+		$dbh-&gt;{pg_expand_array} = 0;
+		is &#40;safe_getarray, $expected, $t&#41;;
+
+		$t=&#34;[bind][expand] Correct array inserted: $msg : $input&#34;;
+		$dbh-&gt;{pg_expand_array} = 1;
+		is_deeply &#40;safe_getarray, $perl_input, $t&#41;;
 	}
 
-	$t=&#34;Array quote worked : $msg : $input&#34;;
+	# INSERT via `quote&#39; and dynamic SQL
+	$dbh-&gt;rollback;
 	eval {
-		$result = $dbh-&gt;quote&#40;eval $input &#41;;
+		$quotearr = $dbh-&gt;quote&#40;$perl_input&#41;;
+		$SQL = qq{INSERT INTO dbd_pg_test&#40;id,pname,testarray&#41; VALUES &#40;99,&#39;Array Testing&#39;,$quotearr&#41;};
+		$dbh-&gt;do&#40;$SQL&#41;;
 	};
-	if &#40;$qexpected =~ /error:\s+&#40;.+&#41;/i&#41; {
+	if &#40;$expected =~ /error:\s+&#40;.+&#41;/i&#41; {
 		my $errmsg = $1;
 		$errmsg =~ s/bind/quote/;
-		like &#40;$@, qr{$errmsg}, &#34;Array quote failed : $msg : $input&#34;&#41;;
-		like &#40;$@, qr{$errmsg}, &#34;Array quote failed : $msg : $input&#34;&#41;;
+		like &#40;$@, qr{$errmsg}, &#34;[quote] Array insert error : $msg : $input&#34;&#41;;
 	}
 	else {
-		is &#40;$@, q{}, $t&#41;;
+		is &#40;$@, q{}, &#34;[quote] Array insert success : $msg : $input&#34;&#41;;
 
-		$t=&#34;Correct array quote: $msg : $input&#34;;
-		is &#40;$result, $qexpected, $t&#41;;
-	}
+		# No need to recheck !expand case.
 
-}
-
-
-## Same thing, but expand the arrays
-$dbh-&gt;{pg_expand_array} = 1;
-
-for my $test &#40;split /\n\n/ =&gt; $array_tests&#41; {
-	next unless $test =~ /\w/;
-	my &#40;$input,$expected,$msg&#41; = split /\n/ =&gt; $test;
-	my $qexpected = $expected;
-	if &#40;$expected =~ s/\s*quote:\s*&#40;.+&#41;//&#41; {
-		$qexpected = $1;
+		$t=&#34;[quote][expand] Correct array inserted: $msg : $input&#34;;
+		is_deeply &#40;safe_getarray, $perl_input, $t&#41;;
 	}
 
-	if &#40;$msg =~ s/NEED &#40;\d+&#41;:\s*//&#41; {
-		my $ver = $1;
-		if &#40;$pgversion &lt; $ver&#41; {
-		  SKIP: {
-				skip &#40;&#39;Cannot test NULL arrays unless version 8.2 or better&#39;, 2&#41;;
-			}
-			next;
-		}
-	}
-
-	$t=&#34;Array worked : $msg : $input&#34;;
-	$cleararray-&gt;execute&#40;&#41;;
-	eval {
-		$addarray-&gt;execute&#40;eval $input&#41;;
-	};
-	if &#40;$expected =~ /error:\s+&#40;.+&#41;/i&#41; {
-		like &#40;$@, qr{$1}, &#34;Array failed : $msg : $input&#34;&#41;;
-		like &#40;$@, qr{$1}, &#34;Array failed : $msg : $input&#34;&#41;;
-	}
-	else {
-		is &#40;$@, q{}, $t&#41;;
-
-		$t=&#34;Correct array inserted: $msg : $input&#34;;
-		$getarray-&gt;execute&#40;&#41;;
-		$result = $getarray-&gt;fetchall_arrayref&#40;&#41;-&gt;[0][0];
-		$qexpected =~ s/{}/{&#39;&#39;}/;
-		$qexpected =~ y/{}/[]/;
-		$qexpected =~ s/NULL/undef/g;
-		if &#40;$msg =~ /closing brace/&#41; {
-			$qexpected =~ s/]&#34;/}&#34;/;
-		}
-		$expected = eval $qexpected;
-		is_deeply &#40;$result, $expected, $t&#41;;
-	}
-
 	if &#40;$msg =~ /STOP/&#41; {
 		warn &#34;Exiting for DEBUGGING. Result is:\n&#34;;
 		warn Dumper $result;
@@ -315,7 +270,6 @@
 		$dbh-&gt;disconnect;
 		exit;
 	}
-
 }
 
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-958089" href="/Public/Bug/Display.html?id=58552#txn-958089">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;20&nbsp;18:59:35&nbsp;2011</span>
    <span class="description">RENTOCRON [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/958089/498506/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/498506">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
hello,

i&#39;m with 2.18.1 and quotes of commas and backslash is fine.

But, if you try to quote array with single quotes the quote broken, 
because on  2.15.0 when added single quotes to the end/finish of the 
string, indeed should be a recurse call to quote with the array string.

Because in the first place, you call to quote an array, so quote-char is 
doble quote.
But, the expected result is a string ready to insert to the database, so 
we need quote this string [that represent the array] &#34;again&#34;.

however, while it not fixed [it&#39;s currently written in C, not fast to 
[me] fix it] I&#39;m using another sub to fix that:

sub quoteStr{
        my &#40;$this  = $_[0];
        my $quote = $_[1];

        my $db = [here your DBI-&gt;connect object from someware]
        my $quoted;

        if &#40;ref $quote eq &#39;ARRAY&#39;&#41;{
                # quote the array
                $quoted = $db-&gt;quote&#40;$quote&#41;;

                # print &#34;quoted array is $quoted chaging str\n&#34;;

                # DBD::Pg 2.15.0 fixing
                # better check $DBD::Pg::VERSION here ?
                $quoted =~ s/^&#39;//o;
                $quoted =~ s/&#39;$//o;

                # *requote* it
                $quoted = $this-&gt;quoteStr&#40;$quoted&#41;;
        }
        else{
                $quoted = $db-&gt;quote&#40;$quote&#41;;
        }
        return $quoted;
}

**test**
        my $array = [[qw /test&#39;test 213/], [&#34;&#39;&#34;, &#34; \\    &#34;]];

        print Dumper MyClass::quoteStr&#40;$array&#41;;
# prints &lt;&lt;&lt;
&#39;{{&#34;test&#39;&#39;test&#34;,&#34;213&#34;},{&#34;&#39;&#39;&#34;,&#34;  ,   &#34;}}&#39;
# -----

so you can do &#39;{{&#34;test&#39;&#39;test&#34;,&#34;213&#34;},{&#34;&#39;&#39;&#34;,&#34;  ,   &#34;}}&#39;::text[][] and the 
sintax is fine!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-958092" href="/Public/Bug/Display.html?id=58552#txn-958092">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;20&nbsp;18:59:36&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-973506" href="/Public/Bug/Display.html?id=58552#txn-973506">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;02&nbsp;14:07:08&nbsp;2011</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/973506/506656/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/506656">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I think I&#39;ve run into the problem with sinqle quotes and arrays that is 
mentioned here. We were evaluating an upgrade to 2.18.1 from a much 
older version, and saw some test failures in our test suite. I think the 
issue can be illustrated by this simple update to the DBD::Pg test 
suite, which swaps out a simple value in an array quoting test for a 
more complex one:

diff -rN -u old-DBD-Pg-2.18.1/t/09arrays.t new-DBD-Pg-
2.18.1/t/09arrays.t
--- old-DBD-Pg-2.18.1/t/09arrays.t      2011-09-02 14:06:29.000000000 -
0400
+++ new-DBD-Pg-2.18.1/t/09arrays.t      2011-09-02 14:06:29.000000000 -
0400
@@ -54,7 +54,7 @@
 $t=&#39;Array quoting allows direct insertion into statements&#39;;
 $SQL = q{INSERT INTO dbd_pg_test &#40;id,testarray2&#41; VALUES };
 my $quoteid = $dbh-&gt;quote&#40;123&#41;;
-my $quotearr = $dbh-&gt;quote&#40;[456]&#41;;
+my $quotearr = $dbh-&gt;quote&#40;[&#34;Quote&#39;s Test&#34;]&#41;;
 $SQL .= qq{&#40;$quoteid, $quotearr&#41;};
 eval {
        $dbh-&gt;do&#40;$SQL&#41;;

#######
The result:

#   Failed test &#39;Array quoting allows direct insertion into statements&#39;
#   at t/09arrays.t line 62.
#          got: &#39;DBD::Pg::db do failed: ERROR:  syntax error at or near 
&#34;s&#34;
# LINE 1: ...d_pg_test &#40;id,testarray2&#41; VALUES &#40;&#39;123&#39;, &#39;{&#34;Quote&#39;s 
Test&#34;}&#39;&#41;
#                                                              ^ at 
t/09arrays.t line 60.
# &#39;
#     expected: &#39;&#39;
# Looks like you failed 1 test of 257.
t/09arrays.t ........ Dubious, test returned 1 &#40;wstat 256, 0x100&#41;
Failed 1/257 subtests 


#######

For now, this is blocking our upgrade to a modern DBD::Pg while we 
evaluate workarounds. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-975816" href="/Public/Bug/Display.html?id=58552#txn-975816">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;09&nbsp;09:20:57&nbsp;2011</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Fix marshalling of arrays containing &#39;, &#34;, and/or \ &#40;report on
 trying Noah&#39;s patch with my test&#41;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/975816/507872/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/507872">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 569b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">To help move this along, I tried applying Noah&#39;s proposed patch to 2.18.1 
and running &#34;make test&#34;. The patch needed a small refinement to apply. 
I&#39;ve attached my revised version of the patch that I used.

The result was that the patch passed the entire test suite, plus Noah&#39;s 
new test suite changes, but it *failed* the new test I added, above.

So, either Noah or I have the wrong idea about what the quoting behavior 
should be for arrays, or the code needs further modifications to address 
Noah&#39;s test changes as well as my test addition.

Greg: any input here?
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> dbdpg-array-backslash-v2.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/975816/507873/dbdpg-array-backslash-v2.patch">Download dbdpg-array-backslash-v2.patch</a><br />
<span class="downloadcontenttype">text/x-diff 10.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -rN -u old-DBD-Pg-2.18.1/Pg.xs new-DBD-Pg-2.18.1/Pg.xs
--- old-DBD-Pg-2.18.1/Pg.xs	2011-09-09 09:13:06.000000000 -0400
+++ new-DBD-Pg-2.18.1/Pg.xs	2011-09-09 09:13:06.000000000 -0400
@@ -200,15 +200,18 @@
 
 		SvGETMAGIC&#40;to_quote_sv&#41;;
 
+		/* Reject references other than overloaded objects &#40;presumed
+		  stringifiable&#41; and arrays &#40;will make a PostgreSQL array&#41;. */
+		if &#40;SvROK&#40;to_quote_sv&#41; &#38;&#38; !SvAMAGIC&#40;to_quote_sv&#41;&#41; {
+			if &#40;SvTYPE&#40;SvRV&#40;to_quote_sv&#41;&#41; != SVt_PVAV&#41;
+				croak&#40;&#34;Cannot quote a reference&#34;&#41;;
+			to_quote_sv = pg_stringify_array&#40;to_quote_sv, &#34;,&#34;, imp_dbh-&gt;pg_server_version&#41;;
+		}
+
 		/* Null is always returned as &#34;NULL&#34;, so we can ignore any type given */
 		if &#40;!SvOK&#40;to_quote_sv&#41;&#41; {
 			RETVAL = newSVpvn&#40;&#34;NULL&#34;, 4&#41;;
 		}
-		else if &#40;SvROK&#40;to_quote_sv&#41; &#38;&#38; !SvAMAGIC&#40;to_quote_sv&#41;&#41; {
-			if &#40;SvTYPE&#40;SvRV&#40;to_quote_sv&#41;&#41; != SVt_PVAV&#41;
-				croak&#40;&#34;Cannot quote a reference&#34;&#41;;
-			RETVAL = pg_stringify_array&#40;to_quote_sv, &#34;,&#34;, imp_dbh-&gt;pg_server_version, 1&#41;;
-		}
 		else {
 			sql_type_info_t *type_info;
 			char *quoted;
diff -rN -u old-DBD-Pg-2.18.1/dbdimp.c new-DBD-Pg-2.18.1/dbdimp.c
--- old-DBD-Pg-2.18.1/dbdimp.c	2011-09-09 09:13:06.000000000 -0400
+++ new-DBD-Pg-2.18.1/dbdimp.c	2011-09-09 09:13:06.000000000 -0400
@@ -2284,7 +2284,7 @@
 		}
 		else if &#40;SvTYPE&#40;SvRV&#40;newvalue&#41;&#41; == SVt_PVAV&#41; {
 			SV * quotedval;
-			quotedval = pg_stringify_array&#40;newvalue,&#34;,&#34;,imp_dbh-&gt;pg_server_version, 0&#41;;
+			quotedval = pg_stringify_array&#40;newvalue,&#34;,&#34;,imp_dbh-&gt;pg_server_version&#41;;
 			currph-&gt;valuelen = sv_len&#40;quotedval&#41;;
 			Renew&#40;currph-&gt;value, currph-&gt;valuelen+1, char&#41;; /* freed in dbd_st_destroy */
 			Copy&#40;SvUTF8&#40;quotedval&#41; ? SvPVutf8_nolen&#40;quotedval&#41; : SvPV_nolen&#40;quotedval&#41;,
@@ -2420,7 +2420,7 @@
 
 
 /* ================================================================== */
-SV * pg_stringify_array&#40;SV *input, const char * array_delim, int server_version, int extraquotes&#41; {
+SV * pg_stringify_array&#40;SV *input, const char * array_delim, int server_version&#41; {
 
 	dTHX;
 	AV * toparr;
@@ -2439,14 +2439,12 @@
 	if &#40;TSTART&#41; TRC&#40;DBILOGFP, &#34;%sBegin pg_stringify_array\n&#34;, THEADER&#41;;
 
 	toparr = &#40;AV *&#41; SvRV&#40;input&#41;;
-	value = extraquotes ? newSVpv&#40;&#34;&#39;{&#34;, 2&#41; : newSVpv&#40;&#34;{&#34;, 1&#41;;
+	value = newSVpv&#40;&#34;{&#34;, 1&#41;;
 
 	/* Empty arrays are easy */
 	if &#40;av_len&#40;toparr&#41; &lt; 0&#41; {
 		av_clear&#40;toparr&#41;;
 		sv_catpv&#40;value, &#34;}&#34;&#41;;
-		if &#40;extraquotes&#41;
-			sv_catpv&#40;value, &#34;&#39;&#34;&#41;;
 		if &#40;TEND&#41; TRC&#40;DBILOGFP, &#34;%sEnd pg_stringify_array &#40;empty&#41;\n&#34;, THEADER&#41;;
 		return value;
 	}
@@ -2516,14 +2514,9 @@
 					SvUTF8_on&#40;value&#41;;
 				string = SvPV&#40;svitem, stringlength&#41;;
 				while &#40;stringlength--&#41; {
-
-					/* If an embedded quote, throw a backslash before it */
-					if &#40;&#39;\&#34;&#39; == *string&#41;
+ 					/* Escape backslashes and double-quotes. */
+ 					if &#40;&#39;\&#34;&#39; == *string || &#39;\\&#39; == *string&#41;
 						sv_catpvn&#40;value, &#34;\\&#34;, 1&#41;;
-					/* If a backslash, double it up */
-					if &#40;&#39;\\&#39; == *string&#41; {
-						sv_catpvn&#40;value, &#34;\\\\\\&#34;, 3&#41;;
-					}
 					sv_catpvn&#40;value, string, 1&#41;;
 					string++;
 				}
@@ -2548,8 +2541,6 @@
 	for &#40;xy=0; xy&lt;array_depth; xy++&#41; {
 		sv_catpv&#40;value, &#34;}&#34;&#41;;
 	}
-	if &#40;extraquotes&#41;
-		sv_catpv&#40;value, &#34;&#39;&#34;&#41;;
 
 	if &#40;TEND&#41; TRC&#40;DBILOGFP, &#34;%sEnd pg_stringify_array &#40;string: %s&#41;\n&#34;, THEADER, neatsvpv&#40;value,0&#41;&#41;;
 	return value;
diff -rN -u old-DBD-Pg-2.18.1/dbdimp.h new-DBD-Pg-2.18.1/dbdimp.h
--- old-DBD-Pg-2.18.1/dbdimp.h	2011-09-09 09:13:06.000000000 -0400
+++ new-DBD-Pg-2.18.1/dbdimp.h	2011-09-09 09:13:06.000000000 -0400
@@ -190,7 +190,7 @@
 
 SV * pg_db_pg_notifies &#40;SV *dbh, imp_dbh_t *imp_dbh&#41;;
 
-SV * pg_stringify_array&#40;SV * input, const char * array_delim, int server_version, int extraquotes&#41;;
+SV * pg_stringify_array&#40;SV * input, const char * array_delim, int server_version&#41;;
 
 int pg_quickexec &#40;SV *dbh, const char *sql, const int asyncflag&#41;;
 
diff -rN -u old-DBD-Pg-2.18.1/t/09arrays.t new-DBD-Pg-2.18.1/t/09arrays.t
--- old-DBD-Pg-2.18.1/t/09arrays.t	2011-09-09 09:13:06.000000000 -0400
+++ new-DBD-Pg-2.18.1/t/09arrays.t	2011-09-09 09:13:06.000000000 -0400
@@ -18,7 +18,7 @@
 if &#40;! $dbh&#41; {
 	plan skip_all =&gt; &#39;Connection to database failed, cannot continue testing&#39;;
 }
-plan tests =&gt; 257;
+plan tests =&gt; 200;
 
 isnt &#40;$dbh, undef, &#39;Connect to database for array testing&#39;&#41;;
 
@@ -26,10 +26,6 @@
 
 my $pgversion = $dbh-&gt;{pg_server_version};
 
-if &#40;$pgversion &gt;= 80100&#41; {
-  $dbh-&gt;do&#40;&#39;SET escape_string_warning = false&#39;&#41;;
-}
-
 my $SQL = q{DELETE FROM dbd_pg_test WHERE pname = &#39;Array Testing&#39;};
 my $cleararray = $dbh-&gt;prepare&#40;$SQL&#41;;
 
@@ -54,7 +50,7 @@
 $t=&#39;Array quoting allows direct insertion into statements&#39;;
 $SQL = q{INSERT INTO dbd_pg_test &#40;id,testarray2&#41; VALUES };
 my $quoteid = $dbh-&gt;quote&#40;123&#41;;
-my $quotearr = $dbh-&gt;quote&#40;[456]&#41;;
+my $quotearr = $dbh-&gt;quote&#40;[&#34;Quote&#39;s Test&#34;]&#41;;
 $SQL .= qq{&#40;$quoteid, $quotearr&#41;};
 eval {
 	$dbh-&gt;do&#40;$SQL&#41;;
@@ -62,8 +58,8 @@
 is &#40;$@, q{}, $t&#41;;
 $dbh-&gt;rollback&#40;&#41;;
 
-## Input
-## Expected
+## Input &#40;eval-able Perl&#41;
+## Expected &#40;ERROR or raw PostgreSQL output&#41;
 ## Name of test
 
 my $array_tests =
@@ -120,51 +116,51 @@
 Unbalanced array
 
 [123]
-{123} quote: {&#34;123&#34;}
+{123}
 Simple 1-D numeric array
 
 [&#39;abc&#39;]
-{abc} quote: {&#34;abc&#34;}
+{abc}
 Simple 1-D text array
 
 [&#39;a&#39;,&#39;b,c&#39;]
-{a,&#34;b,c&#34;} quote: {&#34;a&#34;,&#34;b,c&#34;}
+{a,&#34;b,c&#34;}
 Text array with commas and quotes
 
 [&#39;a&#39;,&#39;b,}&#39;]
-{a,&#34;b,}&#34;} quote: {&#34;a&#34;,&#34;b,}&#34;}
+{a,&#34;b,}&#34;}
 Text array with commas, escaped closing brace
 
 [&#39;a&#39;,&#39;b,]&#39;]
-{a,&#34;b,]&#34;} quote: {&#34;a&#34;,&#34;b,]&#34;}
+{a,&#34;b,]&#34;}
 Text array with commas, escaped closing bracket
 
 [1,2]
-{1,2} quote: {&#34;1&#34;,&#34;2&#34;}
+{1,2}
 Simple 1-D numeric array
 
 [[1]]
-{{1}} quote: {{&#34;1&#34;}}
+{{1}}
 Simple 2-D numeric array
 
 [[1,2]]
-{{1,2}} quote: {{&#34;1&#34;,&#34;2&#34;}}
+{{1,2}}
 Simple 2-D numeric array
 
 [[[1]]]
-{{{1}}} quote: {{{&#34;1&#34;}}}
+{{{1}}}
 Simple 3-D numeric array
 
 [[[&#34;alpha&#34;,2],[23,&#34;pop&#34;]]]
-{{{alpha,2},{23,pop}}} quote: {{{&#34;alpha&#34;,&#34;2&#34;},{&#34;23&#34;,&#34;pop&#34;}}}
+{{{alpha,2},{23,pop}}}
 3-D mixed array
 
 [[[1,2,3],[4,5,&#34;6&#34;],[&#34;seven&#34;,&#34;8&#34;,&#34;9&#34;]]]
-{{{1,2,3},{4,5,6},{seven,8,9}}} quote: {{{&#34;1&#34;,&#34;2&#34;,&#34;3&#34;},{&#34;4&#34;,&#34;5&#34;,&#34;6&#34;},{&#34;seven&#34;,&#34;8&#34;,&#34;9&#34;}}}
+{{{1,2,3},{4,5,6},{seven,8,9}}}
 3-D mixed array
 
 [q{O&#39;RLY?}]
-{O&#39;RLY?} quote: {&#34;O&#39;RLY?&#34;}
+{O&#39;RLY?}
 Simple single quote
 
 [q{O&#34;RLY?}]
@@ -172,19 +168,19 @@
 Simple double quote
 
 [[q{O&#34;RLY?}],[q|&#39;Ya&#39; - &#34;really&#34;|],[123]]
-{{&#34;O\&#34;RLY?&#34;},{&#34;&#39;Ya&#39; - \&#34;really\&#34;&#34;},{123}} quote: {{&#34;O\&#34;RLY?&#34;},{&#34;&#39;Ya&#39; - \&#34;really\&#34;&#34;},{&#34;123&#34;}}
+{{&#34;O\&#34;RLY?&#34;},{&#34;&#39;Ya&#39; - \&#34;really\&#34;&#34;},{123}}
 Many quotes
 
 [&#34;Single\\\\Backslash&#34;]
-{&#34;Single\\\\\\\\Backslash&#34;} quote: {&#34;Single\\\\\\\\Backslash&#34;}
+{&#34;Single\\\\Backslash&#34;}
 Single backslash testing
 
 [&#34;Double\\\\\\\\Backslash&#34;]
-{&#34;Double\\\\\\\\\\\\\\\\Backslash&#34;} quote: {&#34;Double\\\\\\\\\\\\\\\\Backslash&#34;}
+{&#34;Double\\\\\\\\Backslash&#34;}
 Double backslash testing
 
 [[&#34;Test\\\nRun&#34;,&#34;Quite \&#34;so\&#34;&#34;],[&#34;back\\\\\\\\slashes are a \&#34;pa\\\\in\&#34;&#34;,123] ]
-{{&#34;Test\\\\\\\\nRun&#34;,&#34;Quite \&#34;so\&#34;&#34;},{&#34;back\\\\\\\\\\\\\\\\slashes are a \&#34;pa\\\\\\\\in\&#34;&#34;,123}} quote: {{&#34;Test\\\\\\\nRun&#34;,&#34;Quite \&#34;so\&#34;&#34;},{&#34;back\\\\\\\\\\\\\\\\slashes are a \&#34;pa\\\\\\\\in\&#34;&#34;,&#34;123&#34;}}
+{{&#34;Test\\\nRun&#34;,&#34;Quite \&#34;so\&#34;&#34;},{&#34;back\\\\\\\\slashes are a \&#34;pa\\\\in\&#34;&#34;,123}}
 Escape party - backslash+newline, two + one
 
 [undef]
@@ -196,25 +192,25 @@
 NEED 80200: Simple undef test
 
 [[1,2],[undef,3],[&#34;four&#34;,undef],[undef,undef]]
-{{1,2},{NULL,3},{four,NULL},{NULL,NULL}} quote: {{&#34;1&#34;,&#34;2&#34;},{NULL,&#34;3&#34;},{&#34;four&#34;,NULL},{NULL,NULL}}
+{{1,2},{NULL,3},{four,NULL},{NULL,NULL}}
 NEED 80200: Multiple undef test
 
 !;
 
 ## Note: We silently allow things like this: [[[]],[]]
 
-$dbh-&gt;{pg_expand_array} = 0;
+sub safe_getarray {
+	my $ret = eval {
+		$getarray-&gt;execute&#40;&#41;;
+		$getarray-&gt;fetchall_arrayref&#40;&#41;-&gt;[0][0];
+	};
+	$@ || $ret
+}
 
 for my $test &#40;split /\n\n/ =&gt; $array_tests&#41; {
 	next unless $test =~ /\w/;
 	my &#40;$input,$expected,$msg&#41; = split /\n/ =&gt; $test;
-	my $qexpected = $expected;
-	if &#40;$expected =~ s/\s*quote:\s*&#40;.+&#41;//&#41; {
-		$qexpected = $1;
-	}
-	if &#40;$qexpected !~ /^ERROR/&#41; {
-		$qexpected = qq{&#39;$qexpected&#39;};
-	}
+	my $perl_input = eval $input;
 
 	if &#40;$msg =~ s/NEED &#40;\d+&#41;:\s*//&#41; {
 		my $ver = $1;
@@ -226,86 +222,45 @@
 		}
 	}
 
-	$t=&#34;Correct array inserted: $msg : $input&#34;;
-	$cleararray-&gt;execute&#40;&#41;;
+	# INSERT via bind values
+	$dbh-&gt;rollback;
 	eval {
-		$addarray-&gt;execute&#40;eval $input&#41;;
+		$addarray-&gt;execute&#40;$perl_input&#41;;
 	};
 	if &#40;$expected =~ /error:\s+&#40;.+&#41;/i&#41; {
-		like &#40;$@, qr{$1}, &#34;Array failed : $msg : $input&#34;&#41;;
-		like &#40;$@, qr{$1}, &#34;Array failed : $msg : $input&#34;&#41;;
+		like &#40;$@, qr{$1}, &#34;[bind] Array insert error : $msg : $input&#34;&#41;;
 	}
 	else {
-		is &#40;$@, q{}, &#34;Array worked : $msg : $input&#34;&#41;;
-		$getarray-&gt;execute&#40;&#41;;
-		$result = $getarray-&gt;fetchall_arrayref&#40;&#41;-&gt;[0][0];
-		is &#40;$result, $expected, $t&#41;;
-	}
-
-	$t=&#34;Array quote worked : $msg : $input&#34;;
-	eval {
-		$result = $dbh-&gt;quote&#40;eval $input &#41;;
-	};
-	if &#40;$qexpected =~ /error:\s+&#40;.+&#41;/i&#41; {
-		my $errmsg = $1;
-		$errmsg =~ s/bind/quote/;
-		like &#40;$@, qr{$errmsg}, &#34;Array quote failed : $msg : $input&#34;&#41;;
-		like &#40;$@, qr{$errmsg}, &#34;Array quote failed : $msg : $input&#34;&#41;;
-	}
-	else {
-		is &#40;$@, q{}, $t&#41;;
-
-		$t=&#34;Correct array quote: $msg : $input&#34;;
-		is &#40;$result, $qexpected, $t&#41;;
-	}
-
-}
+		is &#40;$@, q{}, &#34;[bind] Array insert success : $msg : $input&#34;&#41;;
 
+		$t=&#34;[bind][!expand] Correct array inserted: $msg : $input&#34;;
+		$dbh-&gt;{pg_expand_array} = 0;
+		is &#40;safe_getarray, $expected, $t&#41;;
 
-## Same thing, but expand the arrays
-$dbh-&gt;{pg_expand_array} = 1;
-
-for my $test &#40;split /\n\n/ =&gt; $array_tests&#41; {
-	next unless $test =~ /\w/;
-	my &#40;$input,$expected,$msg&#41; = split /\n/ =&gt; $test;
-	my $qexpected = $expected;
-	if &#40;$expected =~ s/\s*quote:\s*&#40;.+&#41;//&#41; {
-		$qexpected = $1;
+		$t=&#34;[bind][expand] Correct array inserted: $msg : $input&#34;;
+		$dbh-&gt;{pg_expand_array} = 1;
+		is_deeply &#40;safe_getarray, $perl_input, $t&#41;;
 	}
 
-	if &#40;$msg =~ s/NEED &#40;\d+&#41;:\s*//&#41; {
-		my $ver = $1;
-		if &#40;$pgversion &lt; $ver&#41; {
-		  SKIP: {
-				skip &#40;&#39;Cannot test NULL arrays unless version 8.2 or better&#39;, 2&#41;;
-			}
-			next;
-		}
-	}
-
-	$t=&#34;Array worked : $msg : $input&#34;;
-	$cleararray-&gt;execute&#40;&#41;;
+	# INSERT via `quote&#39; and dynamic SQL
+	$dbh-&gt;rollback;
 	eval {
-		$addarray-&gt;execute&#40;eval $input&#41;;
+		$quotearr = $dbh-&gt;quote&#40;$perl_input&#41;;
+		$SQL = qq{INSERT INTO dbd_pg_test&#40;id,pname,testarray&#41; VALUES &#40;99,&#39;Array Testing&#39;,$quotearr&#41;};
+		$dbh-&gt;do&#40;$SQL&#41;;
 	};
 	if &#40;$expected =~ /error:\s+&#40;.+&#41;/i&#41; {
-		like &#40;$@, qr{$1}, &#34;Array failed : $msg : $input&#34;&#41;;
-		like &#40;$@, qr{$1}, &#34;Array failed : $msg : $input&#34;&#41;;
+		my $errmsg = $1;
+		$errmsg =~ s/bind/quote/;
+		like &#40;$@, qr{$errmsg}, &#34;[quote] Array insert error : $msg : $input&#34;&#41;;
 	}
 	else {
-		is &#40;$@, q{}, $t&#41;;
+		is &#40;$@, q{}, &#34;[quote] Array insert success : $msg : $input&#34;&#41;;
 
-		$t=&#34;Correct array inserted: $msg : $input&#34;;
-		$getarray-&gt;execute&#40;&#41;;
-		$result = $getarray-&gt;fetchall_arrayref&#40;&#41;-&gt;[0][0];
-		$qexpected =~ s/{}/{&#39;&#39;}/;
-		$qexpected =~ y/{}/[]/;
-		$qexpected =~ s/NULL/undef/g;
-		if &#40;$msg =~ /closing brace/&#41; {
-			$qexpected =~ s/]&#34;/}&#34;/;
-		}
-		$expected = eval $qexpected;
-		is_deeply &#40;$result, $expected, $t&#41;;
+		# No need to recheck !expand case.
+
+		$t=&#34;[quote][expand] Correct array inserted: $msg : $input&#34;;
+		is_deeply &#40;safe_getarray, $perl_input, $t&#41;;
 	}
 
 	if &#40;$msg =~ /STOP/&#41; {
@@ -315,7 +270,6 @@
 		$dbh-&gt;disconnect;
 		exit;
 	}
-
 }
 
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-986279" href="/Public/Bug/Display.html?id=58552#txn-986279">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;10&nbsp;10:43:19&nbsp;2011</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Fix marshalling of arrays containing &#39;, &#34;, and/or \ &#40;endorsing
 Noah&#39;s patch&#41;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/986279/513487/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/513487">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 479b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">As discussed on the DBD::Pg mailing list, there was a small bug in my 
additional test coverage I added. &#40; I should have used the &#34;testarray&#34; 
column instead of &#34;testarray2&#34; &#41;. Once that was corrected, Noah&#39;s patch 
passed my additional test coverage as well as own. 

Based on that, I endorse Noah&#39;s match and recommend that it be merged. 

Here&#39;s the thread from the recent mailing list discussion:

<span class="clickylink"><a target="new" rel="nofollow" href="http://thread.gmane.org/gmane.comp.db.postgresql.dbdpg.general/2740">http://thread.gmane.org/gmane.comp.db.postgresql.dbdpg.general/2740</a></span>

    Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-986283" href="/Public/Bug/Display.html?id=58552#txn-986283">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;10&nbsp;10:49:31&nbsp;2011</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Fix marshalling of arrays containing &#39;, &#34;, and/or \ &#40;patch, v3&#41;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/986283/513491/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/513491">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 102b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Attached is the revised version of Noah&#39;s patch that includes my 
corrected additional test coverage. 
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> dbdpg-array-backslash-v3.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/986283/513492/dbdpg-array-backslash-v3.patch">Download dbdpg-array-backslash-v3.patch</a><br />
<span class="downloadcontenttype">text/x-diff 11.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Mon Oct 10 10:46:33 EDT 2011  Mark Stosberg &lt;mark@summersault.com&gt;
  * Noah&#39;s patch, plus my additional test, with fix for testarray column name
diff -rN -u old-DBD-Pg-2.18.1/Pg.xs new-DBD-Pg-2.18.1/Pg.xs
--- old-DBD-Pg-2.18.1/Pg.xs	2011-10-10 10:47:52.000000000 -0400
+++ new-DBD-Pg-2.18.1/Pg.xs	2011-10-10 10:47:52.000000000 -0400
@@ -200,15 +200,18 @@
 
 		SvGETMAGIC&#40;to_quote_sv&#41;;
 
+		/* Reject references other than overloaded objects &#40;presumed
+		  stringifiable&#41; and arrays &#40;will make a PostgreSQL array&#41;. */
+		if &#40;SvROK&#40;to_quote_sv&#41; &#38;&#38; !SvAMAGIC&#40;to_quote_sv&#41;&#41; {
+			if &#40;SvTYPE&#40;SvRV&#40;to_quote_sv&#41;&#41; != SVt_PVAV&#41;
+				croak&#40;&#34;Cannot quote a reference&#34;&#41;;
+			to_quote_sv = pg_stringify_array&#40;to_quote_sv, &#34;,&#34;, imp_dbh-&gt;pg_server_version&#41;;
+		}
+
 		/* Null is always returned as &#34;NULL&#34;, so we can ignore any type given */
 		if &#40;!SvOK&#40;to_quote_sv&#41;&#41; {
 			RETVAL = newSVpvn&#40;&#34;NULL&#34;, 4&#41;;
 		}
-		else if &#40;SvROK&#40;to_quote_sv&#41; &#38;&#38; !SvAMAGIC&#40;to_quote_sv&#41;&#41; {
-			if &#40;SvTYPE&#40;SvRV&#40;to_quote_sv&#41;&#41; != SVt_PVAV&#41;
-				croak&#40;&#34;Cannot quote a reference&#34;&#41;;
-			RETVAL = pg_stringify_array&#40;to_quote_sv, &#34;,&#34;, imp_dbh-&gt;pg_server_version, 1&#41;;
-		}
 		else {
 			sql_type_info_t *type_info;
 			char *quoted;
diff -rN -u old-DBD-Pg-2.18.1/dbdimp.c new-DBD-Pg-2.18.1/dbdimp.c
--- old-DBD-Pg-2.18.1/dbdimp.c	2011-10-10 10:47:52.000000000 -0400
+++ new-DBD-Pg-2.18.1/dbdimp.c	2011-10-10 10:47:52.000000000 -0400
@@ -2284,7 +2284,7 @@
 		}
 		else if &#40;SvTYPE&#40;SvRV&#40;newvalue&#41;&#41; == SVt_PVAV&#41; {
 			SV * quotedval;
-			quotedval = pg_stringify_array&#40;newvalue,&#34;,&#34;,imp_dbh-&gt;pg_server_version, 0&#41;;
+			quotedval = pg_stringify_array&#40;newvalue,&#34;,&#34;,imp_dbh-&gt;pg_server_version&#41;;
 			currph-&gt;valuelen = sv_len&#40;quotedval&#41;;
 			Renew&#40;currph-&gt;value, currph-&gt;valuelen+1, char&#41;; /* freed in dbd_st_destroy */
 			Copy&#40;SvUTF8&#40;quotedval&#41; ? SvPVutf8_nolen&#40;quotedval&#41; : SvPV_nolen&#40;quotedval&#41;,
@@ -2420,7 +2420,7 @@
 
 
 /* ================================================================== */
-SV * pg_stringify_array&#40;SV *input, const char * array_delim, int server_version, int extraquotes&#41; {
+SV * pg_stringify_array&#40;SV *input, const char * array_delim, int server_version&#41; {
 
 	dTHX;
 	AV * toparr;
@@ -2439,14 +2439,12 @@
 	if &#40;TSTART&#41; TRC&#40;DBILOGFP, &#34;%sBegin pg_stringify_array\n&#34;, THEADER&#41;;
 
 	toparr = &#40;AV *&#41; SvRV&#40;input&#41;;
-	value = extraquotes ? newSVpv&#40;&#34;&#39;{&#34;, 2&#41; : newSVpv&#40;&#34;{&#34;, 1&#41;;
+	value = newSVpv&#40;&#34;{&#34;, 1&#41;;
 
 	/* Empty arrays are easy */
 	if &#40;av_len&#40;toparr&#41; &lt; 0&#41; {
 		av_clear&#40;toparr&#41;;
 		sv_catpv&#40;value, &#34;}&#34;&#41;;
-		if &#40;extraquotes&#41;
-			sv_catpv&#40;value, &#34;&#39;&#34;&#41;;
 		if &#40;TEND&#41; TRC&#40;DBILOGFP, &#34;%sEnd pg_stringify_array &#40;empty&#41;\n&#34;, THEADER&#41;;
 		return value;
 	}
@@ -2516,14 +2514,9 @@
 					SvUTF8_on&#40;value&#41;;
 				string = SvPV&#40;svitem, stringlength&#41;;
 				while &#40;stringlength--&#41; {
-
-					/* If an embedded quote, throw a backslash before it */
-					if &#40;&#39;\&#34;&#39; == *string&#41;
+ 					/* Escape backslashes and double-quotes. */
+ 					if &#40;&#39;\&#34;&#39; == *string || &#39;\\&#39; == *string&#41;
 						sv_catpvn&#40;value, &#34;\\&#34;, 1&#41;;
-					/* If a backslash, double it up */
-					if &#40;&#39;\\&#39; == *string&#41; {
-						sv_catpvn&#40;value, &#34;\\\\\\&#34;, 3&#41;;
-					}
 					sv_catpvn&#40;value, string, 1&#41;;
 					string++;
 				}
@@ -2548,8 +2541,6 @@
 	for &#40;xy=0; xy&lt;array_depth; xy++&#41; {
 		sv_catpv&#40;value, &#34;}&#34;&#41;;
 	}
-	if &#40;extraquotes&#41;
-		sv_catpv&#40;value, &#34;&#39;&#34;&#41;;
 
 	if &#40;TEND&#41; TRC&#40;DBILOGFP, &#34;%sEnd pg_stringify_array &#40;string: %s&#41;\n&#34;, THEADER, neatsvpv&#40;value,0&#41;&#41;;
 	return value;
diff -rN -u old-DBD-Pg-2.18.1/dbdimp.h new-DBD-Pg-2.18.1/dbdimp.h
--- old-DBD-Pg-2.18.1/dbdimp.h	2011-10-10 10:47:52.000000000 -0400
+++ new-DBD-Pg-2.18.1/dbdimp.h	2011-10-10 10:47:52.000000000 -0400
@@ -190,7 +190,7 @@
 
 SV * pg_db_pg_notifies &#40;SV *dbh, imp_dbh_t *imp_dbh&#41;;
 
-SV * pg_stringify_array&#40;SV * input, const char * array_delim, int server_version, int extraquotes&#41;;
+SV * pg_stringify_array&#40;SV * input, const char * array_delim, int server_version&#41;;
 
 int pg_quickexec &#40;SV *dbh, const char *sql, const int asyncflag&#41;;
 
diff -rN -u old-DBD-Pg-2.18.1/t/09arrays.t new-DBD-Pg-2.18.1/t/09arrays.t
--- old-DBD-Pg-2.18.1/t/09arrays.t	2011-10-10 10:47:52.000000000 -0400
+++ new-DBD-Pg-2.18.1/t/09arrays.t	2011-10-10 10:47:52.000000000 -0400
@@ -18,7 +18,7 @@
 if &#40;! $dbh&#41; {
 	plan skip_all =&gt; &#39;Connection to database failed, cannot continue testing&#39;;
 }
-plan tests =&gt; 257;
+plan tests =&gt; 200;
 
 isnt &#40;$dbh, undef, &#39;Connect to database for array testing&#39;&#41;;
 
@@ -26,10 +26,6 @@
 
 my $pgversion = $dbh-&gt;{pg_server_version};
 
-if &#40;$pgversion &gt;= 80100&#41; {
-  $dbh-&gt;do&#40;&#39;SET escape_string_warning = false&#39;&#41;;
-}
-
 my $SQL = q{DELETE FROM dbd_pg_test WHERE pname = &#39;Array Testing&#39;};
 my $cleararray = $dbh-&gt;prepare&#40;$SQL&#41;;
 
@@ -52,9 +48,9 @@
 my $getarray_bool = $dbh-&gt;prepare&#40;$SQL&#41;;
 
 $t=&#39;Array quoting allows direct insertion into statements&#39;;
-$SQL = q{INSERT INTO dbd_pg_test &#40;id,testarray2&#41; VALUES };
+$SQL = q{INSERT INTO dbd_pg_test &#40;id,testarray&#41; VALUES };
 my $quoteid = $dbh-&gt;quote&#40;123&#41;;
-my $quotearr = $dbh-&gt;quote&#40;[456]&#41;;
+my $quotearr = $dbh-&gt;quote&#40;[&#34;Quote&#39;s Test&#34;]&#41;;
 $SQL .= qq{&#40;$quoteid, $quotearr&#41;};
 eval {
 	$dbh-&gt;do&#40;$SQL&#41;;
@@ -62,8 +58,8 @@
 is &#40;$@, q{}, $t&#41;;
 $dbh-&gt;rollback&#40;&#41;;
 
-## Input
-## Expected
+## Input &#40;eval-able Perl&#41;
+## Expected &#40;ERROR or raw PostgreSQL output&#41;
 ## Name of test
 
 my $array_tests =
@@ -120,51 +116,51 @@
 Unbalanced array
 
 [123]
-{123} quote: {&#34;123&#34;}
+{123}
 Simple 1-D numeric array
 
 [&#39;abc&#39;]
-{abc} quote: {&#34;abc&#34;}
+{abc}
 Simple 1-D text array
 
 [&#39;a&#39;,&#39;b,c&#39;]
-{a,&#34;b,c&#34;} quote: {&#34;a&#34;,&#34;b,c&#34;}
+{a,&#34;b,c&#34;}
 Text array with commas and quotes
 
 [&#39;a&#39;,&#39;b,}&#39;]
-{a,&#34;b,}&#34;} quote: {&#34;a&#34;,&#34;b,}&#34;}
+{a,&#34;b,}&#34;}
 Text array with commas, escaped closing brace
 
 [&#39;a&#39;,&#39;b,]&#39;]
-{a,&#34;b,]&#34;} quote: {&#34;a&#34;,&#34;b,]&#34;}
+{a,&#34;b,]&#34;}
 Text array with commas, escaped closing bracket
 
 [1,2]
-{1,2} quote: {&#34;1&#34;,&#34;2&#34;}
+{1,2}
 Simple 1-D numeric array
 
 [[1]]
-{{1}} quote: {{&#34;1&#34;}}
+{{1}}
 Simple 2-D numeric array
 
 [[1,2]]
-{{1,2}} quote: {{&#34;1&#34;,&#34;2&#34;}}
+{{1,2}}
 Simple 2-D numeric array
 
 [[[1]]]
-{{{1}}} quote: {{{&#34;1&#34;}}}
+{{{1}}}
 Simple 3-D numeric array
 
 [[[&#34;alpha&#34;,2],[23,&#34;pop&#34;]]]
-{{{alpha,2},{23,pop}}} quote: {{{&#34;alpha&#34;,&#34;2&#34;},{&#34;23&#34;,&#34;pop&#34;}}}
+{{{alpha,2},{23,pop}}}
 3-D mixed array
 
 [[[1,2,3],[4,5,&#34;6&#34;],[&#34;seven&#34;,&#34;8&#34;,&#34;9&#34;]]]
-{{{1,2,3},{4,5,6},{seven,8,9}}} quote: {{{&#34;1&#34;,&#34;2&#34;,&#34;3&#34;},{&#34;4&#34;,&#34;5&#34;,&#34;6&#34;},{&#34;seven&#34;,&#34;8&#34;,&#34;9&#34;}}}
+{{{1,2,3},{4,5,6},{seven,8,9}}}
 3-D mixed array
 
 [q{O&#39;RLY?}]
-{O&#39;RLY?} quote: {&#34;O&#39;RLY?&#34;}
+{O&#39;RLY?}
 Simple single quote
 
 [q{O&#34;RLY?}]
@@ -172,19 +168,19 @@
 Simple double quote
 
 [[q{O&#34;RLY?}],[q|&#39;Ya&#39; - &#34;really&#34;|],[123]]
-{{&#34;O\&#34;RLY?&#34;},{&#34;&#39;Ya&#39; - \&#34;really\&#34;&#34;},{123}} quote: {{&#34;O\&#34;RLY?&#34;},{&#34;&#39;Ya&#39; - \&#34;really\&#34;&#34;},{&#34;123&#34;}}
+{{&#34;O\&#34;RLY?&#34;},{&#34;&#39;Ya&#39; - \&#34;really\&#34;&#34;},{123}}
 Many quotes
 
 [&#34;Single\\\\Backslash&#34;]
-{&#34;Single\\\\\\\\Backslash&#34;} quote: {&#34;Single\\\\\\\\Backslash&#34;}
+{&#34;Single\\\\Backslash&#34;}
 Single backslash testing
 
 [&#34;Double\\\\\\\\Backslash&#34;]
-{&#34;Double\\\\\\\\\\\\\\\\Backslash&#34;} quote: {&#34;Double\\\\\\\\\\\\\\\\Backslash&#34;}
+{&#34;Double\\\\\\\\Backslash&#34;}
 Double backslash testing
 
 [[&#34;Test\\\nRun&#34;,&#34;Quite \&#34;so\&#34;&#34;],[&#34;back\\\\\\\\slashes are a \&#34;pa\\\\in\&#34;&#34;,123] ]
-{{&#34;Test\\\\\\\\nRun&#34;,&#34;Quite \&#34;so\&#34;&#34;},{&#34;back\\\\\\\\\\\\\\\\slashes are a \&#34;pa\\\\\\\\in\&#34;&#34;,123}} quote: {{&#34;Test\\\\\\\nRun&#34;,&#34;Quite \&#34;so\&#34;&#34;},{&#34;back\\\\\\\\\\\\\\\\slashes are a \&#34;pa\\\\\\\\in\&#34;&#34;,&#34;123&#34;}}
+{{&#34;Test\\\nRun&#34;,&#34;Quite \&#34;so\&#34;&#34;},{&#34;back\\\\\\\\slashes are a \&#34;pa\\\\in\&#34;&#34;,123}}
 Escape party - backslash+newline, two + one
 
 [undef]
@@ -196,25 +192,25 @@
 NEED 80200: Simple undef test
 
 [[1,2],[undef,3],[&#34;four&#34;,undef],[undef,undef]]
-{{1,2},{NULL,3},{four,NULL},{NULL,NULL}} quote: {{&#34;1&#34;,&#34;2&#34;},{NULL,&#34;3&#34;},{&#34;four&#34;,NULL},{NULL,NULL}}
+{{1,2},{NULL,3},{four,NULL},{NULL,NULL}}
 NEED 80200: Multiple undef test
 
 !;
 
 ## Note: We silently allow things like this: [[[]],[]]
 
-$dbh-&gt;{pg_expand_array} = 0;
+sub safe_getarray {
+	my $ret = eval {
+		$getarray-&gt;execute&#40;&#41;;
+		$getarray-&gt;fetchall_arrayref&#40;&#41;-&gt;[0][0];
+	};
+	$@ || $ret
+}
 
 for my $test &#40;split /\n\n/ =&gt; $array_tests&#41; {
 	next unless $test =~ /\w/;
 	my &#40;$input,$expected,$msg&#41; = split /\n/ =&gt; $test;
-	my $qexpected = $expected;
-	if &#40;$expected =~ s/\s*quote:\s*&#40;.+&#41;//&#41; {
-		$qexpected = $1;
-	}
-	if &#40;$qexpected !~ /^ERROR/&#41; {
-		$qexpected = qq{&#39;$qexpected&#39;};
-	}
+	my $perl_input = eval $input;
 
 	if &#40;$msg =~ s/NEED &#40;\d+&#41;:\s*//&#41; {
 		my $ver = $1;
@@ -226,86 +222,45 @@
 		}
 	}
 
-	$t=&#34;Correct array inserted: $msg : $input&#34;;
-	$cleararray-&gt;execute&#40;&#41;;
+	# INSERT via bind values
+	$dbh-&gt;rollback;
 	eval {
-		$addarray-&gt;execute&#40;eval $input&#41;;
+		$addarray-&gt;execute&#40;$perl_input&#41;;
 	};
 	if &#40;$expected =~ /error:\s+&#40;.+&#41;/i&#41; {
-		like &#40;$@, qr{$1}, &#34;Array failed : $msg : $input&#34;&#41;;
-		like &#40;$@, qr{$1}, &#34;Array failed : $msg : $input&#34;&#41;;
+		like &#40;$@, qr{$1}, &#34;[bind] Array insert error : $msg : $input&#34;&#41;;
 	}
 	else {
-		is &#40;$@, q{}, &#34;Array worked : $msg : $input&#34;&#41;;
-		$getarray-&gt;execute&#40;&#41;;
-		$result = $getarray-&gt;fetchall_arrayref&#40;&#41;-&gt;[0][0];
-		is &#40;$result, $expected, $t&#41;;
-	}
-
-	$t=&#34;Array quote worked : $msg : $input&#34;;
-	eval {
-		$result = $dbh-&gt;quote&#40;eval $input &#41;;
-	};
-	if &#40;$qexpected =~ /error:\s+&#40;.+&#41;/i&#41; {
-		my $errmsg = $1;
-		$errmsg =~ s/bind/quote/;
-		like &#40;$@, qr{$errmsg}, &#34;Array quote failed : $msg : $input&#34;&#41;;
-		like &#40;$@, qr{$errmsg}, &#34;Array quote failed : $msg : $input&#34;&#41;;
-	}
-	else {
-		is &#40;$@, q{}, $t&#41;;
-
-		$t=&#34;Correct array quote: $msg : $input&#34;;
-		is &#40;$result, $qexpected, $t&#41;;
-	}
-
-}
+		is &#40;$@, q{}, &#34;[bind] Array insert success : $msg : $input&#34;&#41;;
 
+		$t=&#34;[bind][!expand] Correct array inserted: $msg : $input&#34;;
+		$dbh-&gt;{pg_expand_array} = 0;
+		is &#40;safe_getarray, $expected, $t&#41;;
 
-## Same thing, but expand the arrays
-$dbh-&gt;{pg_expand_array} = 1;
-
-for my $test &#40;split /\n\n/ =&gt; $array_tests&#41; {
-	next unless $test =~ /\w/;
-	my &#40;$input,$expected,$msg&#41; = split /\n/ =&gt; $test;
-	my $qexpected = $expected;
-	if &#40;$expected =~ s/\s*quote:\s*&#40;.+&#41;//&#41; {
-		$qexpected = $1;
+		$t=&#34;[bind][expand] Correct array inserted: $msg : $input&#34;;
+		$dbh-&gt;{pg_expand_array} = 1;
+		is_deeply &#40;safe_getarray, $perl_input, $t&#41;;
 	}
 
-	if &#40;$msg =~ s/NEED &#40;\d+&#41;:\s*//&#41; {
-		my $ver = $1;
-		if &#40;$pgversion &lt; $ver&#41; {
-		  SKIP: {
-				skip &#40;&#39;Cannot test NULL arrays unless version 8.2 or better&#39;, 2&#41;;
-			}
-			next;
-		}
-	}
-
-	$t=&#34;Array worked : $msg : $input&#34;;
-	$cleararray-&gt;execute&#40;&#41;;
+	# INSERT via `quote&#39; and dynamic SQL
+	$dbh-&gt;rollback;
 	eval {
-		$addarray-&gt;execute&#40;eval $input&#41;;
+		$quotearr = $dbh-&gt;quote&#40;$perl_input&#41;;
+		$SQL = qq{INSERT INTO dbd_pg_test&#40;id,pname,testarray&#41; VALUES &#40;99,&#39;Array Testing&#39;,$quotearr&#41;};
+		$dbh-&gt;do&#40;$SQL&#41;;
 	};
 	if &#40;$expected =~ /error:\s+&#40;.+&#41;/i&#41; {
-		like &#40;$@, qr{$1}, &#34;Array failed : $msg : $input&#34;&#41;;
-		like &#40;$@, qr{$1}, &#34;Array failed : $msg : $input&#34;&#41;;
+		my $errmsg = $1;
+		$errmsg =~ s/bind/quote/;
+		like &#40;$@, qr{$errmsg}, &#34;[quote] Array insert error : $msg : $input&#34;&#41;;
 	}
 	else {
-		is &#40;$@, q{}, $t&#41;;
+		is &#40;$@, q{}, &#34;[quote] Array insert success : $msg : $input&#34;&#41;;
 
-		$t=&#34;Correct array inserted: $msg : $input&#34;;
-		$getarray-&gt;execute&#40;&#41;;
-		$result = $getarray-&gt;fetchall_arrayref&#40;&#41;-&gt;[0][0];
-		$qexpected =~ s/{}/{&#39;&#39;}/;
-		$qexpected =~ y/{}/[]/;
-		$qexpected =~ s/NULL/undef/g;
-		if &#40;$msg =~ /closing brace/&#41; {
-			$qexpected =~ s/]&#34;/}&#34;/;
-		}
-		$expected = eval $qexpected;
-		is_deeply &#40;$result, $expected, $t&#41;;
+		# No need to recheck !expand case.
+
+		$t=&#34;[quote][expand] Correct array inserted: $msg : $input&#34;;
+		is_deeply &#40;safe_getarray, $perl_input, $t&#41;;
 	}
 
 	if &#40;$msg =~ /STOP/&#41; {
@@ -315,7 +270,6 @@
 		$dbh-&gt;disconnect;
 		exit;
 	}
-
 }
 
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-992739" href="/Public/Bug/Display.html?id=58552#txn-992739">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;27&nbsp;11:07:03&nbsp;2011</span>
    <span class="description">noah [...] leadboat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> noah [...] leadboat.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/992739/516984/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/516984">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 818b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Mark,

On Mon Oct 10 10:43:19 2011, MARKSTOS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As discussed on the DBD::Pg mailing list, there was a small bug in my 
&gt; additional test coverage I added. &#40; I should have used the &#34;testarray&#34; 
&gt; column instead of &#34;testarray2&#34; &#41;. Once that was corrected, Noah&#39;s patch 
&gt; passed my additional test coverage as well as own. 
&gt; 
&gt; Based on that, I endorse Noah&#39;s [p]atch and recommend that it be merged. 
</div>
Thanks for updating the patch and testing; I&#39;m sorry for not having
reviewed your feedback earlier.  dbdpg-array-backslash-v3.patch adds to
Pg.xs two lines having a space followed by a tab.  Other than that, it
looks good to me.  I also agree with your suggestion in [1] concerning
the naming of columns like &#34;testarray2&#34;.

Thanks,
nm

[1] <span class="clickylink"><a target="new" rel="nofollow" href="http://thread.gmane.org/gmane.comp.db.postgresql.dbdpg.general/2744">http://thread.gmane.org/gmane.comp.db.postgresql.dbdpg.general/2744</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1000419" href="/Public/Bug/Display.html?id=58552#txn-1000419">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;16&nbsp;08:41:26&nbsp;2011</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Fix marshalling of arrays containing &#39;, &#34;, and/or \ &#40;feedback
 from maintainers requested&#41;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1000419/521113/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/521113">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 492b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">To the maintainers of DBD::Pg:

In this nearly 6-month old ticket we&#39;ve identified a notable bug with 
quoting, provided automated test coverage to confirm the issue, and 
provided a complete patch to address the issue, which passes all the 
other regression tests plus the new tests. The issue has been 
independently identified by multiple peoples, and the provided patch has 
been peer-tested. 

Could you comment on when this could be merged and released, or what else 
may become of it? 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1000519" href="/Public/Bug/Display.html?id=58552#txn-1000519">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;16&nbsp;13:20:44&nbsp;2011</span>
    <span class="description">david [...] justatheory.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #58552] Fix marshalling of arrays containing &#39;, &#34;, and/or \ &#40;feedback  from maintainers requested&#41; </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 16 Nov 2011 10:20:31 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-Pg [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;david [...] justatheory.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1000519/521173/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/521173">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 296b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Nov 16, 2011, at 5:41 AM, MARKSTOS via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Could you comment on when this could be merged and released, or what else 
&gt; may become of it? 
</div>
Iâ€™m trying to chase Greg down on IRC. I would commit your patch, but we need to do some branching in the Git repository first.

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1016702" href="/Public/Bug/Display.html?id=58552#txn-1016702">#</a>      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;30&nbsp;14:05:52&nbsp;2011</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1016702/530084/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/530084">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 319b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Iâ€™m trying to chase Greg down on IRC. I would commit your patch, but
&gt; we need to do some branching in the Git repository first.
</div>
Thanks for looking at this, David. This seems like a valuable bug to get 
addressed. We are moving forward with putting the patch proposed here in 
production in the meantime. 

  Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1021784" href="/Public/Bug/Display.html?id=58552#txn-1021784">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;13&nbsp;00:15:53&nbsp;2012</span>
    <span class="description">david [...] justatheory.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #58552] Fix marshalling of arrays containing &#39;, &#34;, and/or \ </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 12 Jan 2012 21:15:38 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-Pg [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;david [...] justatheory.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1021784/532888/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/532888">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 295b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Dec 30, 2011, at 11:05 AM, MARKSTOS via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks for looking at this, David. This seems like a valuable bug to get 
&gt; addressed. We are moving forward with putting the patch proposed here in 
&gt; production in the meantime. 
</div>
Yeah, it will be done. Doing some nagging nowâ€¦

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1024418" href="/Public/Bug/Display.html?id=58552#txn-1024418">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;19&nbsp;08:42:23&nbsp;2012</span>
    <span class="description">noah [...] leadboat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> noah [...] leadboat.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1024418/534339/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/534339">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 42b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Confirmed fix in git master.  Thanks, all.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1111532" href="/Public/Bug/Display.html?id=58552#txn-1111532">#</a>      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;21&nbsp;14:05:30&nbsp;2012</span>
    <span class="description">greg [...] turnstep.com -  Severity Important added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1111533" href="/Public/Bug/Display.html?id=58552#txn-1111533">#</a>      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;21&nbsp;14:05:30&nbsp;2012</span>
    <span class="description">greg [...] turnstep.com -  Fixed in 2.19.0 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1256950" href="/Public/Bug/Display.html?id=58552#txn-1256950">#</a>      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;01&nbsp;23:46:33&nbsp;2013</span>
    <span class="description">greg [...] turnstep.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.785129</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
