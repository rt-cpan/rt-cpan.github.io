<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #68449 for RT-Authen-ExternalAuth: fix for enable user and LDAP update user info warnings</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #68449 for RT-Authen-ExternalAuth: fix for enable user and LDAP update user info warnings</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=RT-Authen-ExternalAuth">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=RT-Authen-ExternalAuth">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=RT-Authen-ExternalAuth">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=RT-Authen-ExternalAuth">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/RT-Authen-ExternalAuth">RT-Authen-ExternalAuth CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">68449</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=RT-Authen-ExternalAuth">RT-Authen-ExternalAuth</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
adaugherity [...] tamu.edu

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-221202-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-221203-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




create-user-silence-warn.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/950283/494130/create-user-silence-warn.diff">
Tue Jun 28 13:52:41 2011 (971b) by adaugherity [...] tamu.edu
</a>
</font></li>
</ul>


ExternalAuth.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/938959/488090/ExternalAuth.diff">
Tue May 24 15:24:13 2011 (2.9k) by adaugherity [...] tamu.edu
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=68449">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-938959" href="/Public/Bug/Display.html?id=68449#txn-938959">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;24&nbsp;15:24:13&nbsp;2011</span>
    <span class="description">adaugherity [...] tamu.edu -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> fix for enable user and LDAP update user info warnings</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 24 May 2011 19:24:00 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-RT-Authen-ExternalAuth [...] rt.cpan.org&#34; &lt;bug-RT-Authen-ExternalAuth [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Daugherity, Andrew W&#34; &lt;adaugherity [...] tamu.edu&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/938959/488089/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/488089">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">First of all, thanks for this module, it&#39;s much nicer than the old User_Local.pm LDAP auth we had been using.

I have fixed a couple bugs that generated warnings every time a user logged in.  With RT 3.8 only the &#34;Couldn&#39;t enable user&#34; warning is logged, but RT 4.0 apparently uses a stricter warning level and also logs several &#34;Use of uninitialized value&#34; warnings.

Here is what is logged every time a user logs in &#40;RT 4.0.0, RT::Authen::ExternalAuth 0.09, using an eDirectory LDAP server&#41;:
====
[Thu May 19 22:01:43 2011] [info]: RT::Authen::ExternalAuth::LDAP::GetAuth External Auth OK &#40; eDir_LDAP &#41;: adaugherity &#40;/opt/rt4/local/plugins/RT-Authen-ExternalAuth/lib/RT/Authen/ExternalAuth/LDAP.pm:139&#41;
[Thu May 19 22:01:43 2011] [warning]: Couldn&#39;t enable user 93751 &#40;/opt/rt4/sbin/../lib/RT/User.pm:1065&#41;
[Thu May 19 22:01:43 2011] [warning]: Use of uninitialized value $val in concatenation &#40;.&#41; or string at /opt/rt4/local/plugins/RT-Authen-ExternalAuth/lib/RT/Authen/ExternalAuth.pm line 274. &#40;/opt/rt4/local/plugins/RT-Authen-ExternalAuth/lib/RT/Authen/ExternalAuth.pm:274&#41;
[Thu May 19 22:01:43 2011] [warning]: Use of uninitialized value $message in concatenation &#40;.&#41; or string at /opt/rt4/local/plugins/RT-Authen-ExternalAuth/lib/RT/Authen/ExternalAuth.pm line 274. &#40;/opt/rt4/local/plugins/RT-Authen-ExternalAuth/lib/RT/Authen/ExternalAuth.pm:274&#41;
[Thu May 19 22:01:43 2011] [info]: User marked as ENABLED &#40; ADaugherity &#41; per External Service &#40;, &#41; &#40;/opt/rt4/local/plugins/RT-Authen-ExternalAuth/lib/RT/Authen/ExternalAuth.pm:274&#41;
[Thu May 19 22:01:43 2011] [warning]: Use of uninitialized value in string eq at /opt/rt4/local/plugins/RT-Authen-ExternalAuth/lib/RT/Authen/ExternalAuth/LDAP.pm line 236. &#40;/opt/rt4/local/plugins/RT-Authen-ExternalAuth/lib/RT/Authen/ExternalAuth/LDAP.pm:236&#41;
[Thu May 19 22:01:43 2011] [warning]: Use of uninitialized value in string eq at /opt/rt4/local/plugins/RT-Authen-ExternalAuth/lib/RT/Authen/ExternalAuth/LDAP.pm line 236. &#40;/opt/rt4/local/plugins/RT-Authen-ExternalAuth/lib/RT/Authen/ExternalAuth/LDAP.pm:236&#41;
&lt; a lot more &#34;uninitialized value in string eq&#34; errors, apparently one for each LDAP attribute &gt;

[Thu May 19 22:01:43 2011] [info]: RT::Authen::ExternalAuth::CanonicalizeUserInfo returning Address1: [$address], City: College Station, Country: US, EmailAddress: [$email], ExternalAuthId: ADaugherity, Gecos: [$gecos], Name: ADaugherity, Organization: Systems, RealName: Andrew Daugherity, State: TX, WorkPhone: [$phone], Zip: 77843 &#40;/opt/rt4/local/plugins/RT-Authen-ExternalAuth/lib/RT/Authen/ExternalAuth.pm:536&#41;
&lt; previous line sanitized a bit; actual values are properly returned &gt;
[Thu May 19 22:01:43 2011] [info]: Successful login for ADaugherity from 10.95.0.228 &#40;/opt/rt4/local/plugins/RT-Authen-ExternalAuth/lib/RT/Authen/ExternalAuth.pm:219&#41;
====

There are two bugs here:
1&#41; Calling RT::User::SetDisabled&#40;&#41; with the current disabled state &#40;e.g. attempting to enable an already-enabled user&#41; fails, returning undef.  This means that
  my &#40;$val, $message&#41; = $UserObj-&gt;SetDisabled&#40;0&#41;;
results in $val being undef and the subsequent $RT::Logger call using $val and $message generating the &#34;Use of uninitialized value&#34; warning.

FYI, RT::User::SetDisabled in turn calls RT::Principal::SetDisabled&#40;&#41;, which returns &#40;0, &#34;That is already the current value&#34;&#41; in this case.

2&#41; LDAP::CanonicalizeUserInfo&#40;&#41; is testing $RT::LdapAttrMap-&gt;{$key}, but $RT::LdapAttrMap is not defined anywhere &#40;in fact, this is the only occurrence of that name anywhere&#41;.  A simple one-line patch fixes that:
             foreach my $key &#40;keys&#40;%{$config-&gt;{&#39;attr_map&#39;}}&#41;&#41; {
-                if &#40;$RT::LdapAttrMap-&gt;{$key} eq &#39;dn&#39;&#41; {
+                if &#40;$config-&gt;{&#39;attr_map&#39;}-&gt;{$key} eq &#39;dn&#39;&#41; {

I wasn&#39;t using dn for anything, but I tested assigning it to FreeformContactInfo in the attr_map and it works now.  Also, no more uninitialized value errors every time through the loop!

A patch for both issues is attached.  I also fixed some nearby typos &#40;s/principle/principal/&#41;.


Thanks,

Andrew Daugherity
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/938959/488090/ExternalAuth.diff">Download ExternalAuth.diff</a><br />
<span class="downloadcontenttype">text/x-diff 2.9k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-938985" href="/Public/Bug/Display.html?id=68449#txn-938985">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;24&nbsp;17:13:44&nbsp;2011</span>
    <span class="description">ruz [...] bestpractical.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #68449] fix for enable user and LDAP update user info warnings</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 25 May 2011 01:13:37 +0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-RT-Authen-ExternalAuth [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ruslan Zakirov &lt;ruz [...] bestpractical.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/938985/488107/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/488107">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 747b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, May 24, 2011 at 11:24 PM, Daugherity, Andrew W via RT
&lt;bug-RT-Authen-ExternalAuth@rt.cpan.org&gt; wrote:

[snip]

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 1&#41; Calling RT::User::SetDisabled&#40;&#41; with the current disabled state &#40;e.g. attempting to enable an already-enabled user&#41; fails, returning undef.
</div>
Applied slightly modified patch and pushed into the repo as
dont-disable-disabled-user branch. Please test this branch.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 2&#41; LDAP::CanonicalizeUserInfo&#40;&#41; is testing $RT::LdapAttrMap-&gt;{$key}, but $RT::LdapAttrMap is not defined anywhere &#40;in fact, this is the only occurrence of that name anywhere&#41;.
</div>
Noticed this during development of multiple-emails branch. It&#39;s in
testing and hopefuly would be part of the next release.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks,
&gt; Andrew Daugherity
</div>
-- 
Best regards, Ruslan.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-938988" href="/Public/Bug/Display.html?id=68449#txn-938988">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;24&nbsp;17:13:46&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-939724" href="/Public/Bug/Display.html?id=68449#txn-939724">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;26&nbsp;17:06:02&nbsp;2011</span>
    <span class="description">adaugherity [...] tamu.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #68449] fix for enable user and LDAP update user info warnings</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 26 May 2011 21:05:52 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;&lt;bug-RT-Authen-ExternalAuth [...] rt.cpan.org&gt;&#34; &lt;bug-RT-Authen-ExternalAuth [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Daugherity, Andrew W&#34; &lt;adaugherity [...] tamu.edu&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/939724/488502/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/488502">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On May 24, 2011, at 4:13 PM, Ruslan Zakirov via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; 1&#41; Calling RT::User::SetDisabled&#40;&#41; with the current disabled state &#40;e.g. attempting to enable an already-enabled user&#41; fails, returning undef.
</div>&gt; 
&gt; Applied slightly modified patch and pushed into the repo as
&gt; dont-disable-disabled-user branch. Please test this branch.
</div>
Tested, and it works the same as my patch.  I tested all four possibilities: action = { disable, enable } x current status = { disabled, enabled } and it works properly.

However, I don&#39;t think the additional check/error log you added will work as intended:
        my &#40;$val, $message&#41; = $UserObj-&gt;SetDisabled&#40;0&#41;;
        unless &#40; $val &#41; {
            $RT::Logger-&gt;error&#40;&#34;Failed to enable user &#40;$username&#41; per External Service: $message&#34;&#41;;
            return &#40;$updated, &#34;Failed to enable&#34;&#41;;
        }
If $UserObj-&gt;SetDisabled&#40;0&#41; fails, it returns undef, but not any message.  $message is also going to be undef, and the $RT::Logger call is going to generate a &#34;use of uninitialized value&#34; warning.  The only way to get the actual message is to directly call $UserObj-&gt;PrincipalObj-&gt;SetDisabled, but that may not be advisable since User::SetDisabled does a HasRight check first before calling Principal::SetDisabled.

This seems like a deficiency in the API -- I think it would be preferable for User::SetDisabled to pass through the error message from Principal::SetDisabled.  It also seems inconsistent that if the HasRight check fails, it returns &#40;0, &#39;Permission Denied&#39;&#41;, but returns &#40;undef&#41; if PrincipalObj-&gt;SetDisabled fails.  But, I definitely don&#39;t know the code well enough to be demanding API changes.

Probably best to just remove $message from the Logger call.

Also, your patch doesn&#39;t include the spelling fixes &#40;principal&#41;.  It&#39;s just comments but it&#39;s annoying to read. :-&#41;


Thanks,

Andrew Daugherity
Systems Analyst
Division of Research, Texas A&#38;M University
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-950283" href="/Public/Bug/Display.html?id=68449#txn-950283">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;28&nbsp;13:52:41&nbsp;2011</span>
    <span class="description">adaugherity [...] tamu.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #68449] fix for enable user and LDAP update user info warnings</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 27 Jun 2011 18:21:28 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;&lt;bug-RT-Authen-ExternalAuth [...] rt.cpan.org&gt;&#34; &lt;bug-RT-Authen-ExternalAuth [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Daugherity, Andrew W&#34; &lt;adaugherity [...] tamu.edu&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/950283/494129/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/494129">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 758b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">One more patch; this fixes two &#34;use of uninitialized value&#34; warnings when a new user is created.  When AutoCreateNonExternalUsers is set and a new user mails in a ticket, the user is created with no password.  This later gets changed to &#39;*NO-PASSWORD*&#39; by RT but it&#39;s still null while in ExternalAuth, and causes the Logger calls to generate this warning.

There may be a better way to do this but using the ternary operator works for me.  It also might be preferable to make the undefined case log something other than the empty string, e.g. &#39;undef&#39;, &#39;NULL&#39;, &#39;&lt;not set&gt;&#39;, etc., but I&#39;ll leave that up to you.

&#40;Patch is against the dont-disable-disabled-user branch.&#41;


Thanks,

Andrew Daugherity
Systems Analyst
Division of Research, Texas A&#38;M University
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/950283/494130/create-user-silence-warn.diff">Download create-user-silence-warn.diff</a><br />
<span class="downloadcontenttype">text/x-diff 971b</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-979176" href="/Public/Bug/Display.html?id=68449#txn-979176">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;19&nbsp;14:30:42&nbsp;2011</span>
    <span class="description">cpan [...] jibsheet.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/979176/509738/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/509738">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 30b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is now merged into master
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-979179" href="/Public/Bug/Display.html?id=68449#txn-979179">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;19&nbsp;14:30:43&nbsp;2011</span>
    <span class="description">cpan [...] jibsheet.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-979282" href="/Public/Bug/Display.html?id=68449#txn-979282">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;19&nbsp;19:44:26&nbsp;2011</span>
    <span class="description">adaugherity [...] tamu.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #68449] fix for enable user and LDAP update user info warnings </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 19 Sep 2011 23:44:16 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;&lt;bug-RT-Authen-ExternalAuth [...] rt.cpan.org&gt;&#34; &lt;bug-RT-Authen-ExternalAuth [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Daugherity, Andrew W&#34; &lt;adaugherity [...] tamu.edu&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/979282/509799/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/509799">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 509b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sep 19, 2011, at 1:30 PM, Kevin Falcone via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=68449">https://rt.cpan.org/Ticket/Display.html?id=68449</a></span> &gt;
&gt; 
&gt; This is now merged into master
</div>
Excellent!  &#40;I presume the plan is to eventually merge the multiple-emails branch, which obsoleted part of my patch, as well?&#41;


Checking github, I see my second patch &#40;create-user-silence-warn.diff&#41; was never merged into the &#40;now-defunct&#41; dont-disable-disabled-user branch, let alone master.  Would it be possible to merge that as well?


Thanks,

Andrew
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-979284" href="/Public/Bug/Display.html?id=68449#txn-979284">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;19&nbsp;19:44:27&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-979304" href="/Public/Bug/Display.html?id=68449#txn-979304">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;19&nbsp;21:22:27&nbsp;2011</span>
    <span class="description">cpan [...] jibsheet.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #68449] fix for enable user and LDAP update user info warnings</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 19 Sep 2011 21:22:12 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;Daugherity, Andrew W via RT&#34; &lt;bug-RT-Authen-ExternalAuth [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Falcone &lt;cpan [...] jibsheet.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/979304/509809/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/509809">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 610b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, Sep 19, 2011 at 07:44:27PM -0400, Daugherity, Andrew W via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: RT-Authen-ExternalAuth
&gt; Excellent!  &#40;I presume the plan is to eventually merge the multiple-emails branch, which obsoleted part of my patch, as well?&#41;
</div>
Yep, I&#39;m sure we&#39;ll get some conflicts, but the warnings really needed
to die.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Checking github, I see my second patch &#40;create-user-silence-warn.diff&#41;
&gt; was never merged into the &#40;now-defunct&#41; dont-disable-disabled-user
&gt; branch, let alone master. Would it be possible to merge that as well?
</div>
It&#39;s actually been merged locally, I just forgot to push up.

-kevin
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1028357" href="/Public/Bug/Display.html?id=68449#txn-1028357">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;26&nbsp;16:00:45&nbsp;2012</span>
    <span class="description">tsibley [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.574102</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
