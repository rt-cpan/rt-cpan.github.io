<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #24823 for IO-Interactive: is_interactive&#40;&#41; and command line arguments</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #24823 for IO-Interactive: is_interactive&#40;&#41; and command line arguments</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/IO-Interactive/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/IO-Interactive/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/IO-Interactive/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/IO-Interactive/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/briandfoy/io-interactive/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/IO-Interactive">IO-Interactive CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">24823</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/IO-Interactive/Active/">IO-Interactive</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ipluta [...] wp.pl

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-17138-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-17139-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;06&nbsp;14:18:06&nbsp;2007</span>
    <span class="description">ipluta [...] wp.pl -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> is_interactive&#40;&#41; and command line arguments</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 06 Feb 2007 20:17:39 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-IO-Interactive [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ireneusz Pluta &lt;ipluta [...] wp.pl&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

it seems that is_interactive&#40;&#41; returns 0 when a script using IO::Interactive is invoked with any 
command line parameters &#40;causing @ARGV &gt; 0&#41;.

Here is my test script and its output when invoked without and with a parameter:

526-ipluta@perkoz:~/debug$ cat interactive.pl
#!/usr/bin/perl -w

use IO::Interactive qw&#40;is_interactive&#41;;

if &#40;is_interactive&#40;&#41;&#41;  {
     print &#34;interactive\n\n&#34;;
}
else  {
     print &#34;NOT interactive\n\n&#34;;
}

527-ipluta@perkoz:~/debug$ ./interactive.pl
interactive

528-ipluta@perkoz:~/debug$ ./interactive.pl param
NOT interactive


Is this a bug?

However, a quick hack with making a local @ARGV empty and testing is_interactive&#40;&#41; in a code block 
seems to work for me:

531-ipluta@perkoz:~/debug$ cat interactive1.pl
#!/usr/bin/perl -w

use IO::Interactive qw&#40;is_interactive&#41;;

{
     local @ARGV = &#40;&#41;;
     if &#40;is_interactive&#40;&#41;&#41;  {
         print &#34;interactive\n\n&#34;;
     }
     else  {
         print &#34;NOT interactive\n\n&#34;;
     }
}
532-ipluta@perkoz:~/debug$ ./interactive1.pl
interactive

533-ipluta@perkoz:~/debug$ ./interactive1.pl param
interactive

I am not sure if this is a correct universal workaround. But even if that, this case is not 
mentioned anywhere in the documentation, so I am sending this post.

Some more details of my system:

535-ipluta@perkoz:~/debug$ perl -MIO::Interactive -e &#39;print IO::Interactive-&gt;VERSION, &#34;\n&#34;;&#39;
0.000003
536-ipluta@perkoz:~/debug$ perl -v

This is perl, v5.8.6 built for i386-freebsd-64int

&lt;...&gt;
537-ipluta@perkoz:~/debug$ uname -a
FreeBSD perkoz.cmr.net.pl 4.10-RELEASE FreeBSD 4.10-RELEASE #6: Mon Sep 20 11:29:40 CEST 2004 
ipluta@perkoz.omd.pl:/usr/src/sys/compile/PERKOZ  i386


Best regards

Ireneusz Pluta
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;28&nbsp;20:46:30&nbsp;2007</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Feb 06 14:18:06 2007, ipluta@wp.pl wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Is this a bug?
</div>
It seems to be deliberate, it&#39;s mentioned in the comments.

    # If *ARGV isn&#39;t opened, it will be interactive if *STDIN is attached 
    # to a terminal and either there are no files specified on the
command line
    # or if there are files and the first is the magic &#39;-&#39; file

I would argue that the presence of command line arguments says nothing
about intractability.  It assumes that everything which can be entered
on the command line can be entered interactively and vice versa.  And
that you&#39;d want to.

Here&#39;s a simple counter-example:

    ./YAML-0.66$ perl Makefile.PL INSTALL_BASE=~

    *** WARNING ***

    This release breaks compatibility with versions earlier than version
0.60 of
    YAML::Syck and YAML.pm when serializing blessed references.

    See the COMPATIBILITY file for more information.

    Continue installing YAML.pm? [y] 

The time hammered algorithm used in MakeMaker&#39;s prompt&#40;&#41; routine is this:

my $isa_tty = -t STDIN &#38;&#38; &#40;-t STDOUT || !&#40;-f STDOUT || -c STDOUT&#41;&#41;;

Which is to say...
1&#41;  STDIN is a tty
2&#41;  STDOUT is a tty
3&#41;  STDOUT is not a file or special character file

1 must be true, that much is obvious.  On the theory that the user must
be able to see the output we also check STDOUT.  If STDOUT is a tty
that&#39;s fine.  If it&#39;s going to a file or something like /dev/null, we
assume the user can&#39;t see the output and it&#39;s not interactive.

STDOUT to a pipe is fine to allow things like tee.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;28&nbsp;20:46:32&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;01&nbsp;17:06:38&nbsp;2008</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The attached patch fixes is_interactive&#40;&#41; to ignore command line
arguments &#40;except for -&#41;.

It also fixes the docs to explain that is_interactive&#40;&#41; defaults to the
currently selected filehandle and not necessarily STDOUT.  I&#39;m not so
sure that&#39;s a good idea, but it&#39;s what the code does.

I didn&#39;t touch the -c case for piped STDOUT.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- t/is_interactive.t	&#40;revision 41361&#41;
+++ t/is_interactive.t	&#40;revision 41362&#41;
@@ -1,15 +1,40 @@
+#!/usr/bin/perl -w
+
+use Test::More &#39;no_plan&#39;;
+
 use IO::Interactive qw&#40; is_interactive &#41;;
 
-print &#34;1..2\n&#34;;
+# Tests which depend on not being connected to a terminal
+SKIP: {
+    skip &#34;connected to a terminal&#34;, 2 if -t *STDIN &#38;&#38; -t *STDOUT;
 
-if &#40;-t *STDIN &#38;&#38; -t *STDOUT&#41; {
-    print &#34;ok 1\n&#34; if is_interactive&#40;&#41;;
-    print &#34;ok 2\n&#34; if is_interactive&#40;*STDOUT&#41;;
+    ok !is_interactive&#40;&#41;;
+    ok !is_interactive&#40;*STDOUT&#41;;
 }
-else {
-    print &#34;not &#34; if is_interactive&#40;&#41;;
-    print &#34;ok 1\n&#34;;
 
-    print &#34;not &#34; if is_interactive&#40;*STDOUT&#41;;
-    print &#34;ok 2\n&#34;;
+
+# Tests which depend on being connected to a terminal.
+SKIP: {
+    skip &#34;not connected to a terminal&#34;, 7 unless -t *STDIN &#38;&#38; -t *STDOUT;
+
+    ok is_interactive&#40;&#41;;
+    ok is_interactive&#40;*STDOUT&#41;;
+
+    {
+        ok open my $manifest_fh, &#39;&lt;&#39;, &#34;MANIFEST&#34;;  # any ol file will do.
+        ok !is_interactive&#40;$manifest_fh&#41;;
+
+        my $old_fh = select $manifest_fh;
+        ok !is_interactive&#40;&#41;, &#39;defaults to selected filehandle&#39;;
+        select $old_fh;
+    }
+
+    {
+        local @ARGV = qw&#40;-&#41;;
+    
+        ok is_interactive&#40;&#41;;
+        
+        @ARGV = &#40;1,2,3&#41;;
+        ok is_interactive&#40;&#41;;
+    }
 }
--- lib/IO/Interactive.pm	&#40;revision 41361&#41;
+++ lib/IO/Interactive.pm	&#40;revision 41362&#41;
@@ -26,10 +26,9 @@
     }
 
     # If *ARGV isn&#39;t opened, it will be interactive if *STDIN is attached 
-    # to a terminal and either there are no files specified on the command line
-    # or if there are files and the first is the magic &#39;-&#39; file
+    # to a terminal.
     else {
-        return -t *STDIN &#38;&#38; &#40;@ARGV==0 || $ARGV[0] eq &#39;-&#39;&#41;;
+        return -t *STDIN;
     }
 }
 
@@ -164,16 +163,17 @@
 
 =item C&lt;is_interactive&#40;&#41;&gt;
 
-This subroutine returns true if C&lt;*ARGV&gt; and C&lt;*STDOUT&gt; are connected to 
-the terminal. The test is considerably more sophisticated than:
+This subroutine returns true if C&lt;*ARGV&gt; and the currently selected
+filehandle &#40;usually C&lt;*STDOUT&gt;&#41; are connected to the terminal. The 
+test is considerably more sophisticated than:
 
     -t *ARGV &#38;&#38; -t *STDOUT
 
 as it takes into account the magic behaviour of C&lt;*ARGV&gt;.
 
 You can also pass C&lt;is_interactive&gt; a writable filehandle, in which case it
-requires that filehandle be connected to a terminal &#40;instead of C&lt;*STDOUT&gt;&#41;.
-The usual suspect here is C&lt;*STDERR&gt;:
+requires that filehandle be connected to a terminal &#40;instead of the
+currently selected&#41;.  The usual suspect here is C&lt;*STDERR&gt;:
 
     if &#40; is_interactive&#40;*STDERR&#41; &#41; {
         carp $warning;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;31&nbsp;14:58:15&nbsp;2008</span>
    <span class="description">bdfoy [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Patch applied in 0.0.4
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;31&nbsp;14:58:20&nbsp;2008</span>
    <span class="description">bdfoy [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
