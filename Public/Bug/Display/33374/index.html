<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #33374 for Config-Validate: Per item init &#38; cleanup</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #33374 for Config-Validate: Per item init &#38; cleanup</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Config-Validate">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Config-Validate">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Config-Validate">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Config-Validate">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Config-Validate">Config-Validate CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">33374</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Config-Validate">Config-Validate</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
djerius [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-220564-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-220565-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=33374">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-423497" href="/Public/Bug/Display.html?id=33374#txn-423497">#</a>      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;17&nbsp;23:26:46&nbsp;2008</span>
    <span class="description">djerius [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Per item init &#38; cleanup</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/423497/206971/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/206971">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I would like to take advantage of Config::Validate&#39;s parsing of the
schema to piggyback type-specific data &#34;normalization&#34; onto the
validation process.  For example, one could make file or directory paths
absolute, or perform measurement unit conversion, etc.

I thought the init and cleanup callbacks would be an appropriate way of
doing this, but, if I&#39;m parsing the docs and code correctly, the init
and cleanup callbacks are invoked upon the entire config hash, not on
individual items of the given type.  I&#39;d thus need to essentially rescan
the config hash to find elements matching the callback&#39;s type.  Since
Config::Validate is already doing this, it seems just a wee bit redundant.

The easiest solution is probably to add support for the byreference
attribute, in which case one could modify the item in the validation
routine &#40;a bit bizarre, but not too horrible&#41;.  An alternative might be
to add additional init/cleanup callbacks which are invoked directly on
the item, but that&#39;s a lot more intrusive.


Thanks,
Diab
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-423775" href="/Public/Bug/Display.html?id=33374#txn-423775">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;18&nbsp;09:04:15&nbsp;2008</span>
    <span class="description">CMO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/423775/207087/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/207087">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 885b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I think the best route would be to make Config::Validate pass the value
into the per item callback by reference, instead of by values.

At this point, I don&#39;t have any code using the per item callback
mechanism, and the module is only recently released to CPAN, so I think
now would be the time to make this change, since it will not be
backwards compatible.

Alternatively, I can expose the byreference functionality and you could
define your own validation type that would do this.  I was intending to
do this long term already.

Lastly, and perhaps the best long term solution, I could add a per item
init and finish, which would be called before and after the callback. 
You could then register a new validation type called something like
&#39;normalize_files&#39;, which would look for items setup for &#39;file&#39;
validation, and then normalize them pre validation.

What are your thoughts?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-423776" href="/Public/Bug/Display.html?id=33374#txn-423776">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;18&nbsp;09:04:17&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-423778" href="/Public/Bug/Display.html?id=33374#txn-423778">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;18&nbsp;09:10:24&nbsp;2008</span>
    <span class="description">CMO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/423778/207089/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/207089">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 298b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">So I&#39;m thinking the best route is to change all validation callbacks to
take the value by reference, and add a item_init and item_finish
callback on the type interface.  This will break older validation
callbacks, but I can&#39;t imagine there are too many of those at this
point.  How does this sound?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-425774" href="/Public/Bug/Display.html?id=33374#txn-425774">#</a>      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;22&nbsp;18:07:05&nbsp;2008</span>
    <span class="description">djerius [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/425774/208247/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/208247">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Feb 18 09:10:24 2008, CMO wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So I&#39;m thinking the best route is to change all validation callbacks to
&gt; take the value by reference, and add a item_init and item_finish
&gt; callback on the type interface.  This will break older validation
&gt; callbacks, but I can&#39;t imagine there are too many of those at this
&gt; point.  How does this sound?
</div>
That would work, although passing a reference to the validation
callback makes it a bit fuzzy as to what the difference between the
callbacks is &#40;the pre- and post- callback functionality could be
rolled into the validation callback&#41;.

One way to clarify things is to provide a means of specifying which
callbacks are to be invoked.

I see two behaviors that would need to be addressed on a per _item_
&#40;rather than per _type_&#41; basis

  1. which callbacks get invoked
  2. which results are stored in the config hash based back to the
     user.

Assuming that there is control over which callback is invoked on a per
item basis, there are 4 possible scenarios:

      pre | post
use?   N     N
       Y     N
       Y     Y
       N     Y

Assuming that the validation routine does *not* modify the item value,
then there are the following ways of determining an input item &#40;V&#41;&#39;s
returned value:


     NN: v0 = V; validate&#40;v0&#41;

         V = v0

     YN: v0 = V; v1 = pre&#40;v0&#41; ; validate&#40;v1&#41;

         V ?= &#40;v0, v1 &#41;

     YY: v0 = V; v1 = pre&#40;v0&#41; ; validate&#40;v1&#41;; v2 = post&#40;v1&#41; 

         V ?= &#40;v0, v1, v2 &#41;;

     NY: v0 = V; v1 = validate&#40; v0 &#41;; v2 = post &#40; v1 &#41;

         V ?= &#40;v0, v1, v2 &#41;;

where I&#39;ve used ?= to indicate that V could be set to any of those values.

One way is to expose this is to add the options &#34;pre&#34;, &#34;post&#34;, and
&#34;return&#34;.  The first two are booleans and indicate whether those
callbacks should be invoked and the last is an integer indicating which
of the above values is copied into the final config hash.

For example, I&#39;ve been trying to figure out a means of using the
existing boolean conversion so that the returned config hash has the
converted value.   Let&#39;s say that the conversion code is moved from the
validation callback to a pre-validate callback.  An item might then
have flags

     pre = yes
     post = no
     return = 1

indicating that the converted boolean value be returned.  Or, to mimic
the current situation,

    pre = yes
    post = no
    return = 0

indicating that the input item value should be passed on as is.

There should be a means of specifying default values for these.

Does this sound too complicated?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-425795" href="/Public/Bug/Display.html?id=33374#txn-425795">#</a>      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;22&nbsp;20:01:31&nbsp;2008</span>
    <span class="description">clayton [...] oneill.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33374] Per item init &#38; cleanup</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 22 Feb 2008 20:01:11 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Config-Validate [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Clayton O&#39;Neill&#34; &lt;clayton [...] oneill.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/425795/208266/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/208266">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">So right now I have implemented what I emailed you about on Monday.
In addition, it&#39;s possible to add a pre or post validation call back
per item, even on existing items.  However, reading through your
email, I&#39;m thinking maybe something more flexible would be better.

My current thought would be to allow people to specify a validation
chain.  So if you wanted filename canonization, then you could do
something like &#34;validate =&gt; [ &#39;file_canonzize&#39;, &#39;check_exists&#39; ]&#34;.

And then you could chain as many of them as you want.  I think it&#39;d be
possible to do this in a backwards compatible way, but it&#39;d be a lot
of work.  I&#39;m inclined to finish up what I have done, and release it
and then see how things go from there.

What are your thoughts on doing validation chains, instead of
pre/validate/post hooks per item?

On Fri, Feb 22, 2008 at 6:07 PM, Diab Jerius via RT
&lt;bug-Config-Validate@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;        Queue: Config-Validate
&gt;
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=33374">http://rt.cpan.org/Ticket/Display.html?id=33374</a></span> &gt;
&gt;
&gt;  On Mon Feb 18 09:10:24 2008, CMO wrote:
<div class="message-stanza open">&gt;  &gt; So I&#39;m thinking the best route is to change all validation callbacks to
&gt;  &gt; take the value by reference, and add a item_init and item_finish
&gt;  &gt; callback on the type interface.  This will break older validation
&gt;  &gt; callbacks, but I can&#39;t imagine there are too many of those at this
&gt;  &gt; point.  How does this sound?
</div>&gt;
&gt;  That would work, although passing a reference to the validation
&gt;  callback makes it a bit fuzzy as to what the difference between the
&gt;  callbacks is &#40;the pre- and post- callback functionality could be
&gt;  rolled into the validation callback&#41;.
&gt;
&gt;  One way to clarify things is to provide a means of specifying which
&gt;  callbacks are to be invoked.
&gt;
&gt;  I see two behaviors that would need to be addressed on a per _item_
&gt;  &#40;rather than per _type_&#41; basis
&gt;
&gt;   1. which callbacks get invoked
&gt;   2. which results are stored in the config hash based back to the
&gt;      user.
&gt;
&gt;  Assuming that there is control over which callback is invoked on a per
&gt;  item basis, there are 4 possible scenarios:
&gt;
&gt;       pre | post
&gt;  use?   N     N
&gt;        Y     N
&gt;        Y     Y
&gt;        N     Y
&gt;
&gt;  Assuming that the validation routine does *not* modify the item value,
&gt;  then there are the following ways of determining an input item &#40;V&#41;&#39;s
&gt;  returned value:
&gt;
&gt;
&gt;      NN: v0 = V; validate&#40;v0&#41;
&gt;
&gt;          V = v0
&gt;
&gt;      YN: v0 = V; v1 = pre&#40;v0&#41; ; validate&#40;v1&#41;
&gt;
&gt;          V ?= &#40;v0, v1 &#41;
&gt;
&gt;      YY: v0 = V; v1 = pre&#40;v0&#41; ; validate&#40;v1&#41;; v2 = post&#40;v1&#41;
&gt;
&gt;          V ?= &#40;v0, v1, v2 &#41;;
&gt;
&gt;      NY: v0 = V; v1 = validate&#40; v0 &#41;; v2 = post &#40; v1 &#41;
&gt;
&gt;          V ?= &#40;v0, v1, v2 &#41;;
&gt;
&gt;  where I&#39;ve used ?= to indicate that V could be set to any of those values.
&gt;
&gt;  One way is to expose this is to add the options &#34;pre&#34;, &#34;post&#34;, and
&gt;  &#34;return&#34;.  The first two are booleans and indicate whether those
&gt;  callbacks should be invoked and the last is an integer indicating which
&gt;  of the above values is copied into the final config hash.
&gt;
&gt;  For example, I&#39;ve been trying to figure out a means of using the
&gt;  existing boolean conversion so that the returned config hash has the
&gt;  converted value.   Let&#39;s say that the conversion code is moved from the
&gt;  validation callback to a pre-validate callback.  An item might then
&gt;  have flags
&gt;
&gt;      pre = yes
&gt;      post = no
&gt;      return = 1
&gt;
&gt;  indicating that the converted boolean value be returned.  Or, to mimic
&gt;  the current situation,
&gt;
&gt;     pre = yes
&gt;     post = no
&gt;     return = 0
&gt;
&gt;  indicating that the input item value should be passed on as is.
&gt;
&gt;  There should be a means of specifying default values for these.
&gt;
&gt;  Does this sound too complicated?
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-425806" href="/Public/Bug/Display.html?id=33374#txn-425806">#</a>      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;22&nbsp;21:03:35&nbsp;2008</span>
    <span class="description">dj [...] head.cfa.harvard.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33374] Per item init &#38; cleanup</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 22 Feb 2008 21:03:20 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Config-Validate [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Diab Jerius &lt;dj [...] head.cfa.harvard.edu&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/425806/208272/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/208272">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, 2008-02-22 at 20:01 -0500, Clayton O&#39;Neill via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=33374">http://rt.cpan.org/Ticket/Display.html?id=33374</a></span> &gt;
&gt; 
&gt; So right now I have implemented what I emailed you about on Monday.
&gt; In addition, it&#39;s possible to add a pre or post validation call back
&gt; per item, even on existing items.  However, reading through your
&gt; email, I&#39;m thinking maybe something more flexible would be better.
&gt; 
&gt; My current thought would be to allow people to specify a validation
&gt; chain.  So if you wanted filename canonization, then you could do
&gt; something like &#34;validate =&gt; [ &#39;file_canonzize&#39;, &#39;check_exists&#39; ]&#34;.
&gt; 
&gt; And then you could chain as many of them as you want.  I think it&#39;d be
&gt; possible to do this in a backwards compatible way, but it&#39;d be a lot
&gt; of work.  I&#39;m inclined to finish up what I have done, and release it
&gt; and then see how things go from there.
&gt; 
&gt; What are your thoughts on doing validation chains, instead of
&gt; pre/validate/post hooks per item?
</div>
To be honest, I&#39;m of two minds.  On the one hand it would make it
possible to use a library of existing validation &#34;objects&#34; to perform
complex work.  On the other hand it seems overly complicated.  I would
imagine that most chains would have only a couple of steps in them.

I&#39;m a bit unclear how this scheme works in terms of specifying the final
item value.

        &#39;canonicalize&#39;, &#39;check&#39;, &#39;uncanonicalize&#39;

seems a bit clunky.

In my current application I&#39;m moving towards encoding the schema in a
Config::General parsed file, so I&#39;d like to see as much control as
possible be placed within the schema.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-425809" href="/Public/Bug/Display.html?id=33374#txn-425809">#</a>      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;22&nbsp;21:05:04&nbsp;2008</span>
    <span class="description">clayton [...] oneill.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33374] Per item init &#38; cleanup</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 22 Feb 2008 21:04:51 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Config-Validate [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Clayton O&#39;Neill&#34; &lt;clayton [...] oneill.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/425809/208275/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/208275">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Oh, it never occured to me that you&#39;d want to uncanonize the filenames.

On Fri, Feb 22, 2008 at 9:03 PM, Diab Jerius via RT
&lt;bug-Config-Validate@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;        Queue: Config-Validate
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=33374">http://rt.cpan.org/Ticket/Display.html?id=33374</a></span> &gt;
&gt;
&gt;
&gt; On Fri, 2008-02-22 at 20:01 -0500, Clayton O&#39;Neill via RT wrote:
<div class="message-stanza open">&gt;  &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=33374">http://rt.cpan.org/Ticket/Display.html?id=33374</a></span> &gt;
&gt;  &gt;
</div>&gt;
<div class="message-stanza open">&gt; &gt; So right now I have implemented what I emailed you about on Monday.
</div><div class="message-stanza open">&gt;  &gt; In addition, it&#39;s possible to add a pre or post validation call back
&gt;  &gt; per item, even on existing items.  However, reading through your
&gt;  &gt; email, I&#39;m thinking maybe something more flexible would be better.
&gt;  &gt;
&gt;  &gt; My current thought would be to allow people to specify a validation
&gt;  &gt; chain.  So if you wanted filename canonization, then you could do
&gt;  &gt; something like &#34;validate =&gt; [ &#39;file_canonzize&#39;, &#39;check_exists&#39; ]&#34;.
&gt;  &gt;
&gt;  &gt; And then you could chain as many of them as you want.  I think it&#39;d be
&gt;  &gt; possible to do this in a backwards compatible way, but it&#39;d be a lot
&gt;  &gt; of work.  I&#39;m inclined to finish up what I have done, and release it
&gt;  &gt; and then see how things go from there.
&gt;  &gt;
&gt;  &gt; What are your thoughts on doing validation chains, instead of
&gt;  &gt; pre/validate/post hooks per item?
</div>&gt;
&gt;  To be honest, I&#39;m of two minds.  On the one hand it would make it
&gt;  possible to use a library of existing validation &#34;objects&#34; to perform
&gt;  complex work.  On the other hand it seems overly complicated.  I would
&gt;  imagine that most chains would have only a couple of steps in them.
&gt;
&gt;  I&#39;m a bit unclear how this scheme works in terms of specifying the final
&gt;  item value.
&gt;
&gt;         &#39;canonicalize&#39;, &#39;check&#39;, &#39;uncanonicalize&#39;
&gt;
&gt;  seems a bit clunky.
&gt;
&gt;  In my current application I&#39;m moving towards encoding the schema in a
&gt;  Config::General parsed file, so I&#39;d like to see as much control as
&gt;  possible be placed within the schema.
&gt;
&gt;
&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-425819" href="/Public/Bug/Display.html?id=33374#txn-425819">#</a>      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;22&nbsp;21:20:51&nbsp;2008</span>
    <span class="description">clayton [...] oneill.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33374] Per item init &#38; cleanup</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 22 Feb 2008 21:20:39 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Config-Validate [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Clayton O&#39;Neill&#34; &lt;clayton [...] oneill.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/425819/208281/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/208281">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;Queue: Config-Validate
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=33374">http://rt.cpan.org/Ticket/Display.html?id=33374</a></span> &gt;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  To be honest, I&#39;m of two minds.  On the one hand it would make it
&gt;  possible to use a library of existing validation &#34;objects&#34; to perform
&gt;  complex work.  On the other hand it seems overly complicated.  I would
&gt;  imagine that most chains would have only a couple of steps in them.
&gt;
&gt;  I&#39;m a bit unclear how this scheme works in terms of specifying the final
&gt;  item value.
&gt;
&gt;         &#39;canonicalize&#39;, &#39;check&#39;, &#39;uncanonicalize&#39;
&gt;
&gt;  seems a bit clunky.
&gt;
&gt;  In my current application I&#39;m moving towards encoding the schema in a
&gt;  Config::General parsed file, so I&#39;d like to see as much control as
&gt;  possible be placed within the schema.
</div>
I tend to think the best thing to do here would be to just implement a
new type, rather than try to wrap the fairly trivial existing file
check.

The reason I suggested the chained validation hooks isn&#39;t so much for
your scenario, but for another.  Long term I&#39;d like to work out a way
to have schema be validated at runtime using Config::Validate itself.
This requires a good bit more flexibility than what is currently
available, and I&#39;ve been thinking about how to achieve that off and
on.  If you&#39;re not waiting for this functionality, then I think I&#39;m
going to think about what a better long term approach is for a few
days.  Adding the per item pre and post validate code was fairly
trivial, but if it&#39;s not the right long term approach, I&#39;d rather not
release it and have to support it long term.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-425842" href="/Public/Bug/Display.html?id=33374#txn-425842">#</a>      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;22&nbsp;22:59:35&nbsp;2008</span>
    <span class="description">dj [...] head.cfa.harvard.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> djerius [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33374] Per item init &#38; cleanup</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 22 Feb 2008 22:59:07 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Config-Validate [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Diab Jerius &lt;dj [...] head.cfa.harvard.edu&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/425842/208294/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/208294">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, 2008-02-22 at 21:20 -0500, Clayton O&#39;Neill via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=33374">http://rt.cpan.org/Ticket/Display.html?id=33374</a></span> &gt;
&gt; 
<div class="message-stanza open">&gt; &gt;Queue: Config-Validate
&gt; &gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=33374">http://rt.cpan.org/Ticket/Display.html?id=33374</a></span> &gt;
</div>&gt; 
<div class="message-stanza open">&gt; &gt;  To be honest, I&#39;m of two minds.  On the one hand it would make it
&gt; &gt;  possible to use a library of existing validation &#34;objects&#34; to perform
&gt; &gt;  complex work.  On the other hand it seems overly complicated.  I would
&gt; &gt;  imagine that most chains would have only a couple of steps in them.
&gt; &gt;
&gt; &gt;  I&#39;m a bit unclear how this scheme works in terms of specifying the final
&gt; &gt;  item value.
&gt; &gt;
&gt; &gt;         &#39;canonicalize&#39;, &#39;check&#39;, &#39;uncanonicalize&#39;
&gt; &gt;
&gt; &gt;  seems a bit clunky.
&gt; &gt;
&gt; &gt;  In my current application I&#39;m moving towards encoding the schema in a
&gt; &gt;  Config::General parsed file, so I&#39;d like to see as much control as
&gt; &gt;  possible be placed within the schema.
</div>&gt; 
&gt; I tend to think the best thing to do here would be to just implement a
&gt; new type, rather than try to wrap the fairly trivial existing file
&gt; check.
</div>
True, it&#39;s a bit of a contrived example.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; The reason I suggested the chained validation hooks isn&#39;t so much for
&gt; your scenario, but for another.  Long term I&#39;d like to work out a way
&gt; to have schema be validated at runtime using Config::Validate itself.
&gt; This requires a good bit more flexibility than what is currently
&gt; available, and I&#39;ve been thinking about how to achieve that off and
&gt; on.  If you&#39;re not waiting for this functionality, then I think I&#39;m
&gt; going to think about what a better long term approach is for a few
&gt; days.  Adding the per item pre and post validate code was fairly
&gt; trivial, but if it&#39;s not the right long term approach, I&#39;d rather not
&gt; release it and have to support it long term.
</div>
Understood.  For my application, having the ability to specify the
&#34;byreference&#34; flag for a validation callback would suffice.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-425845" href="/Public/Bug/Display.html?id=33374#txn-425845">#</a>      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;22&nbsp;23:01:20&nbsp;2008</span>
    <span class="description">clayton [...] oneill.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33374] Per item init &#38; cleanup</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 22 Feb 2008 23:01:08 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Config-Validate [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Clayton O&#39;Neill&#34; &lt;clayton [...] oneill.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/425845/208297/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/208297">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Feb 22, 2008 at 10:59 PM, Diab Jerius via RT
&lt;bug-Config-Validate@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;  &gt; The reason I suggested the chained validation hooks isn&#39;t so much for
&gt;  &gt; your scenario, but for another.  Long term I&#39;d like to work out a way
&gt;  &gt; to have schema be validated at runtime using Config::Validate itself.
&gt;  &gt; This requires a good bit more flexibility than what is currently
&gt;  &gt; available, and I&#39;ve been thinking about how to achieve that off and
&gt;  &gt; on.  If you&#39;re not waiting for this functionality, then I think I&#39;m
&gt;  &gt; going to think about what a better long term approach is for a few
&gt;  &gt; days.  Adding the per item pre and post validate code was fairly
&gt;  &gt; trivial, but if it&#39;s not the right long term approach, I&#39;d rather not
&gt;  &gt; release it and have to support it long term.
</div>&gt;
&gt;  Understood.  For my application, having the ability to specify the
&gt;  &#34;byreference&#34; flag for a validation callback would suffice.
</div>
Yeah, I&#39;m intending to make that the default and remove the flag
entirely.  It should have been that way from day one.  I&#39;ll probably
do a release with that functionality in the next few days.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.592537</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
