<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #91764 for DBIx-Class-Schema-Loader: DB2 Tables not being loaded</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #91764 for DBIx-Class-Schema-Loader: DB2 Tables not being loaded</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBIx-Class-Schema-Loader">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBIx-Class-Schema-Loader">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBIx-Class-Schema-Loader">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBIx-Class-Schema-Loader">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBIx-Class-Schema-Loader">DBIx-Class-Schema-Loader CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">91764</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">patched</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBIx-Class-Schema-Loader">DBIx-Class-Schema-Loader</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
guidugli [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-38270-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-38271-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Result_NewQuery.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1309280/693811/Result_NewQuery.txt">
Tue Jan 07 10:06:02 2014 (1.5k) by guidugli [...] gmail.com
</a>
</font></li>
</ul>


Result_OriginalQuery.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1309280/693812/Result_OriginalQuery.txt">
Tue Jan 07 10:06:02 2014 (1.2k) by guidugli [...] gmail.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=91764">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1306962" href="/Public/Bug/Display.html?id=91764#txn-1306962">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;31&nbsp;12:21:00&nbsp;2013</span>
    <span class="description">guidugli [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> DB2 Tables not being loaded</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 31 Dec 2013 15:20:51 -0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class-Schema-Loader [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Carlos Eduardo Panazzolo Guidugli &lt;guidugli [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1306962/692571/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/692571">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 779b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have the following module version installed:
DBD::DB2 &#40;1.85&#41;
DBIx::Class::Schema::Loader &#40;0.07038&#41;
DBIx::Class &#40;0.08250&#41;

Trying to load tables from DB2 10.1 FP3 into DBIx, but result always empty.
Tried to use db_schema and other flags without success. After taking a look
at the code I found the problem.

On /usr/local/share/perl5/DBIx/Class/Schema/Loader/DBI/DB2.pm, had to
change line 159 from:

return $self-&gt;dbh-&gt;tables&#40;$schema ? { TABLE_SCHEM =&gt; $schema } : undef&#41;;

to

return $self-&gt;dbh-&gt;tables&#40;$schema ? { TABLE_SCHEM =&gt; $schema,&#39;TABLE_NAME&#39;
 =&gt; &#39;%&#39; } : undef&#41;;

It seems that on DBD::DB2 1.85 it is mandatory to gave TABLE_NAME =&gt; &#39;%&#39; .
On my tests I could only fetch something with both table name and schema.

Hope this helps.

Thank you for these great modules!
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1306962/692572/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/692572">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1307381" href="/Public/Bug/Display.html?id=91764#txn-1307381">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;02&nbsp;08:47:29&nbsp;2014</span>
    <span class="description">ilmari [...] ilmari.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91764] DB2 Tables not being loaded</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 02 Jan 2014 14:47:18 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class-Schema-Loader [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ilmari [...] ilmari.org &#40;Dagfinn Ilmari MannsÃ¥ker&#41;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1307381/692790/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/692790">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 609b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Carlos Eduardo Panazzolo Guidugli via RT&#34;
&lt;bug-DBIx-Class-Schema-Loader@rt.cpan.org&gt; writes:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It seems that on DBD::DB2 1.85 it is mandatory to gave TABLE_NAME =&gt; &#39;%&#39; .
&gt; On my tests I could only fetch something with both table name and schema.
</div>
Thanks for the report. Before I change it, could you confirm that
TABLE_NAME =&gt; &#39;%&#39; also works on older versions of DBD::DB2 &#40;and DB2
itself, if possible&#41;?

-- 
&#34;I use RMS as a guide in the same way that a boat captain would use
 a lighthouse.  It&#39;s good to know where it is, but you generally
 don&#39;t want to find yourself in the same spot.&#34; - Tollef Fog Heen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1307382" href="/Public/Bug/Display.html?id=91764#txn-1307382">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;02&nbsp;08:47:31&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1307483" href="/Public/Bug/Display.html?id=91764#txn-1307483">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;02&nbsp;15:58:42&nbsp;2014</span>
    <span class="description">guidugli [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91764] DB2 Tables not being loaded</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 2 Jan 2014 18:58:33 -0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class-Schema-Loader [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Carlos Eduardo Panazzolo Guidugli &lt;guidugli [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1307483/692837/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/692837">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 926b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Tested with 1.84,1.83 and 1.81. All of them performed successfully
with TABLE_NAME
=&gt; &#39;%&#39; .

Thank you



On Thu, Jan 2, 2014 at 11:47 AM, &#40;Dagfinn Ilmari MannsÃ¥ker&#41; via RT &lt;
bug-DBIx-Class-Schema-Loader@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91764">https://rt.cpan.org/Ticket/Display.html?id=91764</a></span> &gt;
&gt;
&gt; &#34;Carlos Eduardo Panazzolo Guidugli via RT&#34;
&gt; &lt;bug-DBIx-Class-Schema-Loader@rt.cpan.org&gt; writes:
&gt;
<div class="message-stanza open">&gt; &gt; It seems that on DBD::DB2 1.85 it is mandatory to gave TABLE_NAME =&gt; &#39;%&#39;
</div>&gt; .
<div class="message-stanza open">&gt; &gt; On my tests I could only fetch something with both table name and schema.
</div>&gt;
&gt; Thanks for the report. Before I change it, could you confirm that
&gt; TABLE_NAME =&gt; &#39;%&#39; also works on older versions of DBD::DB2 &#40;and DB2
&gt; itself, if possible&#41;?
&gt;
&gt; --
&gt; &#34;I use RMS as a guide in the same way that a boat captain would use
&gt;  a lighthouse.  It&#39;s good to know where it is, but you generally
&gt;  don&#39;t want to find yourself in the same spot.&#34; - Tollef Fog Heen
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1307483/692838/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/692838">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.7k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1307520" href="/Public/Bug/Display.html?id=91764#txn-1307520">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;02&nbsp;17:07:56&nbsp;2014</span>
    <span class="description">ilmari+cpan [...] ilmari.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1307520/692862/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/692862">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 153b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you for testing.

It turns out there was already a fix for this by Matt Phillips on a branch, so I&#39;ve merged that and it&#39;ll be in the next release.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1307523" href="/Public/Bug/Display.html?id=91764#txn-1307523">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;02&nbsp;17:07:58&nbsp;2014</span>
    <span class="description">ilmari+cpan [...] ilmari.org -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1308942" href="/Public/Bug/Display.html?id=91764#txn-1308942">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;06&nbsp;12:47:54&nbsp;2014</span>
    <span class="description">guidugli [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91764] DB2 Tables not being loaded</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 6 Jan 2014 15:47:39 -0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class-Schema-Loader [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Carlos Eduardo Panazzolo Guidugli &lt;guidugli [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1308942/693617/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/693617">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 491b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you. Do you of any bug regarding relationships? Somehow the loader
detects the primary keys but is not building the has_many, belongs_to, etc
methods.
On Jan 2, 2014 8:07 PM, &#34;Dagfinn Ilmari Mannsaker via RT&#34; &lt;
bug-DBIx-Class-Schema-Loader@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91764">https://rt.cpan.org/Ticket/Display.html?id=91764</a></span> &gt;
&gt;
&gt; Thank you for testing.
&gt;
&gt; It turns out there was already a fix for this by Matt Phillips on a
&gt; branch, so I&#39;ve merged that and it&#39;ll be in the next release.
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1308942/693618/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/693618">with headers</a>
<br />
<span class="downloadcontenttype">text/html 857b</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1309027" href="/Public/Bug/Display.html?id=91764#txn-1309027">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;06&nbsp;17:46:49&nbsp;2014</span>
    <span class="description">guidugli [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91764] DB2 Tables not being loaded</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 6 Jan 2014 20:46:39 -0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class-Schema-Loader [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Carlos Eduardo Panazzolo Guidugli &lt;guidugli [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1309027/693667/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/693667">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi, found the problem that prevented DBIx-Class-Schema-Loader from getting
the relationships.

On the file /usr/local/share/perl5/DBIx/Class/Schema/Loader/DBI/DB2.pm,
method _table_fk_info, the query is currently:
    my $sth = $self-&gt;{_cache}-&gt;{db2_fk} ||= $self-&gt;dbh-&gt;prepare&#40;&lt;&lt;&#39;EOF&#39;&#41;;
SELECT tc.constname, sr.reftabschema, sr.reftabname,
       kcu.colname, rkcu.colname, kcu.colseq,
       sr.deleterule, sr.updaterule
FROM ........

The problem is that DB2 retrieves some columns preserving spaces at its
end. So, the sr.reftabschema was bringing &#39;MYSCHEMA           &#39; instead of
&#39;MYSCHEMA&#39;.

To solve this problem I changed the query to:
    my $sth = $self-&gt;{_cache}-&gt;{db2_fk} ||= $self-&gt;dbh-&gt;prepare&#40;&lt;&lt;&#39;EOF&#39;&#41;;
SELECT trim&#40;tc.constname&#41;, trim&#40;sr.reftabschema&#41;, trim&#40;sr.reftabname&#41;,
       trim&#40;kcu.colname&#41;, trim&#40;rkcu.colname&#41;, kcu.colseq,
       sr.deleterule, sr.updaterule
FROM .........

With this change I was able to retrieve relation information.

Another point that I&#39;d like to show is about UNIQUE constraint in method
_table_uniq_info. In DB2, it is possible to create a UNIQUE constraint, or
a UNIQUE index with exactly the same effect. I was using unique indexes, so
none appeared on the model. In order to make it work I created the unique
constraints as well. I am new to DBIx, but what would happen if there are
two unique constraints in the resulting class, as shown in the example
below.

__PACKAGE__-&gt;add_unique_constraint&#40;&#34;SERVICELINE_SLNAME_UN&#34;, [&#34;slname&#34;]&#41;;
__PACKAGE__-&gt;add_unique_constraint&#40;&#34;SERVICELINE_SLNAME_IDX&#34;, [&#34;slname&#34;]&#41;;

If this is not a problem, maybe the query could be changed to retrieve
unique indexes as well:

SELECT sc.colname, si.name, sc.colseq
FROM sysibm.sysindexes si, sysibm.sysindexcoluse sc
WHERE si.tbcreator=? and si.name=sc.indname and si.tbname=? AND
si.uniquerule = &#39;U&#39;

UNION

SELECT kcu.colname, kcu.constname, kcu.colseq
FROM syscat.tabconst as tc
JOIN syscat.keycoluse as kcu
    ON tc.constname = kcu.constname
        AND tc.tabschema = kcu.tabschema
        AND tc.tabname   = kcu.tabname
WHERE tc.tabschema = ? and tc.tabname = ? and tc.type = &#39;U&#39;

What do you think? Also, it may be a safe bet to add TRIM to char, varchar
columns that have strings with variable length.

Thank you


On Mon, Jan 6, 2014 at 3:47 PM, Carlos Eduardo Panazzolo Guidugli &lt;
guidugli@gmail.com&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thank you. Do you of any bug regarding relationships? Somehow the loader
&gt; detects the primary keys but is not building the has_many, belongs_to, etc
&gt; methods.
&gt; On Jan 2, 2014 8:07 PM, &#34;Dagfinn Ilmari Mannsaker via RT&#34; &lt;
&gt; bug-DBIx-Class-Schema-Loader@rt.cpan.org&gt; wrote:
&gt;
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91764">https://rt.cpan.org/Ticket/Display.html?id=91764</a></span> &gt;
&gt;&gt;
&gt;&gt; Thank you for testing.
&gt;&gt;
&gt;&gt; It turns out there was already a fix for this by Matt Phillips on a
&gt;&gt; branch, so I&#39;ve merged that and it&#39;ll be in the next release.
&gt;&gt;
</div>&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1309027/693668/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/693668">with headers</a>
<br />
<span class="downloadcontenttype">text/html 4.2k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1309240" href="/Public/Bug/Display.html?id=91764#txn-1309240">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;07&nbsp;07:22:31&nbsp;2014</span>
    <span class="description">guidugli [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91764] DB2 Tables not being loaded</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 7 Jan 2014 10:22:18 -0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class-Schema-Loader [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Carlos Eduardo Panazzolo Guidugli &lt;guidugli [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1309240/693786/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/693786">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

About the unique constraints, here is the modified method that also include
unique indexes. I put first the original query to get the unique
constraints and then the query to get unique indexes. After, I check if
there is already another constraint having the same columns. If yes, skip,
otherwise store as result.

In my tests the program below brought the unique constraints ignoring its
duplicated indexes that I had created previously. When there isn&#39;t a
constraint but only unique index, the program added that to the result.

Hope this helps.


sub _table_uniq_info {
    my &#40;$self, $table&#41; = @_;

    my @uniqs;

    my $sth = $self-&gt;{_cache}-&gt;{db2_uniq} ||= $self-&gt;dbh-&gt;prepare&#40;&lt;&lt;&#39;EOF&#39;&#41;;
SELECT trim&#40;kcu.colname&#41;, trim&#40;kcu.constname&#41;, kcu.colseq
FROM syscat.tabconst as tc
JOIN syscat.keycoluse as kcu
    ON tc.constname = kcu.constname
        AND tc.tabschema = kcu.tabschema
        AND tc.tabname   = kcu.tabname
WHERE tc.tabschema = ? and tc.tabname = ? and tc.type = &#39;U&#39;
UNION
SELECT trim&#40;sc.colname&#41;, trim&#40;si.name&#41;, sc.colseq
FROM sysibm.sysindexes si, sysibm.sysindexcoluse sc
WHERE si.tbcreator=? and si.name=sc.indname and si.tbname=? AND
si.uniquerule = &#39;U&#39;

EOF

    $sth-&gt;execute&#40;$table-&gt;schema, $table-&gt;name, $table-&gt;schema,
$table-&gt;name&#41;;

    my %keydata;
    my %cache;
    while&#40;my $row = $sth-&gt;fetchrow_arrayref&#41; {
        my &#40;$col, $constname, $seq&#41; = @$row;
        push&#40;@{$keydata{$constname}}, [ $seq, $self-&gt;_lc&#40;$col&#41; ]&#41;;
    }
    foreach my $keyname &#40;keys %keydata&#41; {
        my @ordered_cols = map { $_-&gt;[1] } sort { $a-&gt;[0] &lt;=&gt; $b-&gt;[0] }
            @{$keydata{$keyname}};
        if &#40;$cache{join &#39;+&#39;, @ordered_cols}&#41;{
            #print &#34;Skipping $keyname since another constraint exists with
the same columns\n&#34;;
            next;
        } else {
            $cache{join &#39;+&#39;, @ordered_cols}=1;
        }
        push&#40;@uniqs, [ $keyname =&gt; \@ordered_cols ]&#41;;
    }

    $sth-&gt;finish;

    return \@uniqs;
}



On Mon, Jan 6, 2014 at 8:46 PM, Carlos Eduardo Panazzolo Guidugli &lt;
guidugli@gmail.com&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi, found the problem that prevented DBIx-Class-Schema-Loader from getting
&gt; the relationships.
&gt;
&gt; On the file /usr/local/share/perl5/DBIx/Class/Schema/Loader/DBI/DB2.pm,
&gt; method _table_fk_info, the query is currently:
&gt;     my $sth = $self-&gt;{_cache}-&gt;{db2_fk} ||= $self-&gt;dbh-&gt;prepare&#40;&lt;&lt;&#39;EOF&#39;&#41;;
&gt; SELECT tc.constname, sr.reftabschema, sr.reftabname,
&gt;        kcu.colname, rkcu.colname, kcu.colseq,
&gt;        sr.deleterule, sr.updaterule
&gt; FROM ........
&gt;
&gt; The problem is that DB2 retrieves some columns preserving spaces at its
&gt; end. So, the sr.reftabschema was bringing &#39;MYSCHEMA           &#39; instead of
&gt; &#39;MYSCHEMA&#39;.
&gt;
&gt; To solve this problem I changed the query to:
&gt;     my $sth = $self-&gt;{_cache}-&gt;{db2_fk} ||= $self-&gt;dbh-&gt;prepare&#40;&lt;&lt;&#39;EOF&#39;&#41;;
&gt; SELECT trim&#40;tc.constname&#41;, trim&#40;sr.reftabschema&#41;, trim&#40;sr.reftabname&#41;,
&gt;        trim&#40;kcu.colname&#41;, trim&#40;rkcu.colname&#41;, kcu.colseq,
&gt;        sr.deleterule, sr.updaterule
&gt; FROM .........
&gt;
&gt; With this change I was able to retrieve relation information.
&gt;
&gt; Another point that I&#39;d like to show is about UNIQUE constraint in method
&gt; _table_uniq_info. In DB2, it is possible to create a UNIQUE constraint, or
&gt; a UNIQUE index with exactly the same effect. I was using unique indexes, so
&gt; none appeared on the model. In order to make it work I created the unique
&gt; constraints as well. I am new to DBIx, but what would happen if there are
&gt; two unique constraints in the resulting class, as shown in the example
&gt; below.
&gt;
&gt; __PACKAGE__-&gt;add_unique_constraint&#40;&#34;SERVICELINE_SLNAME_UN&#34;, [&#34;slname&#34;]&#41;;
&gt; __PACKAGE__-&gt;add_unique_constraint&#40;&#34;SERVICELINE_SLNAME_IDX&#34;, [&#34;slname&#34;]&#41;;
&gt;
&gt; If this is not a problem, maybe the query could be changed to retrieve
&gt; unique indexes as well:
&gt;
&gt; SELECT sc.colname, si.name, sc.colseq
&gt; FROM sysibm.sysindexes si, sysibm.sysindexcoluse sc
&gt; WHERE si.tbcreator=? and si.name=sc.indname and si.tbname=? AND
&gt; si.uniquerule = &#39;U&#39;
&gt;
&gt; UNION
&gt;
&gt; SELECT kcu.colname, kcu.constname, kcu.colseq
&gt; FROM syscat.tabconst as tc
&gt; JOIN syscat.keycoluse as kcu
&gt;     ON tc.constname = kcu.constname
&gt;         AND tc.tabschema = kcu.tabschema
&gt;         AND tc.tabname   = kcu.tabname
&gt; WHERE tc.tabschema = ? and tc.tabname = ? and tc.type = &#39;U&#39;
&gt;
&gt; What do you think? Also, it may be a safe bet to add TRIM to char, varchar
&gt; columns that have strings with variable length.
&gt;
&gt; Thank you
&gt;
&gt;
&gt; On Mon, Jan 6, 2014 at 3:47 PM, Carlos Eduardo Panazzolo Guidugli &lt;
&gt; guidugli@gmail.com&gt; wrote:
&gt;
<div class="message-stanza open">&gt;&gt; Thank you. Do you of any bug regarding relationships? Somehow the loader
&gt;&gt; detects the primary keys but is not building the has_many, belongs_to, etc
&gt;&gt; methods.
&gt;&gt;  On Jan 2, 2014 8:07 PM, &#34;Dagfinn Ilmari Mannsaker via RT&#34; &lt;
&gt;&gt; bug-DBIx-Class-Schema-Loader@rt.cpan.org&gt; wrote:
&gt;&gt;
<div class="message-stanza open">&gt;&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91764">https://rt.cpan.org/Ticket/Display.html?id=91764</a></span> &gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Thank you for testing.
&gt;&gt;&gt;
&gt;&gt;&gt; It turns out there was already a fix for this by Matt Phillips on a
&gt;&gt;&gt; branch, so I&#39;ve merged that and it&#39;ll be in the next release.
&gt;&gt;&gt;
</div>&gt;&gt;
</div>&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1309240/693787/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/693787">with headers</a>
<br />
<span class="downloadcontenttype">text/html 7.4k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1309280" href="/Public/Bug/Display.html?id=91764#txn-1309280">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;07&nbsp;10:06:02&nbsp;2014</span>
    <span class="description">guidugli [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91764] DB2 Tables not being loaded</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 7 Jan 2014 13:05:45 -0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class-Schema-Loader [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Carlos Eduardo Panazzolo Guidugli &lt;guidugli [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1309280/693809/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/693809">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 6.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry about all the emails, but I found something else related  to unique
constraints.

The query:
SELECT trim&#40;sc.colname&#41;, trim&#40;si.name&#41;, sc.colseq
FROM sysibm.sysindexes si, sysibm.sysindexcoluse sc
WHERE si.tbcreator=? and si.name=sc.indname  and si.tbname=? AND
si.uniquerule = &#39;U&#39;

Will return unique indexes AND unique constraints that do not have unique
indexes. For example, suppose I have a constraint USER_EMAIL_UN &#40;email
column only&#41;. If I did not create a unique index, it will be shown in the
query above. If I do create a unique index for the same column, then the
index will be retrieved with the query above. If the only important thing
is to know the columns that have unique restriction, than the query above
may suffice.

I am sending the result of the orginal query and the query above. I did
create unique constraint for most of the unique indexes so I could use the
original version, but notice that there are a couple of additional lines
for the index that I did not had the unique constraint created.


On Tue, Jan 7, 2014 at 10:22 AM, Carlos Eduardo Panazzolo Guidugli &lt;
guidugli@gmail.com&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt;
&gt; About the unique constraints, here is the modified method that also
&gt; include unique indexes. I put first the original query to get the unique
&gt; constraints and then the query to get unique indexes. After, I check if
&gt; there is already another constraint having the same columns. If yes, skip,
&gt; otherwise store as result.
&gt;
&gt; In my tests the program below brought the unique constraints ignoring its
&gt; duplicated indexes that I had created previously. When there isn&#39;t a
&gt; constraint but only unique index, the program added that to the result.
&gt;
&gt; Hope this helps.
&gt;
&gt;
&gt; sub _table_uniq_info {
&gt;     my &#40;$self, $table&#41; = @_;
&gt;
&gt;     my @uniqs;
&gt;
&gt;     my $sth = $self-&gt;{_cache}-&gt;{db2_uniq} ||= $self-&gt;dbh-&gt;prepare&#40;&lt;&lt;&#39;EOF&#39;&#41;;
&gt; SELECT trim&#40;kcu.colname&#41;, trim&#40;kcu.constname&#41;, kcu.colseq
&gt; FROM syscat.tabconst as tc
&gt; JOIN syscat.keycoluse as kcu
&gt;     ON tc.constname = kcu.constname
&gt;         AND tc.tabschema = kcu.tabschema
&gt;         AND tc.tabname   = kcu.tabname
&gt; WHERE tc.tabschema = ? and tc.tabname = ? and tc.type = &#39;U&#39;
&gt; UNION
&gt; SELECT trim&#40;sc.colname&#41;, trim&#40;si.name&#41;, sc.colseq
&gt; FROM sysibm.sysindexes si, sysibm.sysindexcoluse sc
&gt; WHERE si.tbcreator=? and si.name=sc.indname and si.tbname=? AND
&gt; si.uniquerule = &#39;U&#39;
&gt;
&gt; EOF
&gt;
&gt;     $sth-&gt;execute&#40;$table-&gt;schema, $table-&gt;name, $table-&gt;schema,
&gt; $table-&gt;name&#41;;
&gt;
&gt;     my %keydata;
&gt;     my %cache;
&gt;     while&#40;my $row = $sth-&gt;fetchrow_arrayref&#41; {
&gt;         my &#40;$col, $constname, $seq&#41; = @$row;
&gt;         push&#40;@{$keydata{$constname}}, [ $seq, $self-&gt;_lc&#40;$col&#41; ]&#41;;
&gt;     }
&gt;     foreach my $keyname &#40;keys %keydata&#41; {
&gt;         my @ordered_cols = map { $_-&gt;[1] } sort { $a-&gt;[0] &lt;=&gt; $b-&gt;[0] }
&gt;             @{$keydata{$keyname}};
&gt;         if &#40;$cache{join &#39;+&#39;, @ordered_cols}&#41;{
&gt;             #print &#34;Skipping $keyname since another constraint exists with
&gt; the same columns\n&#34;;
&gt;             next;
&gt;         } else {
&gt;             $cache{join &#39;+&#39;, @ordered_cols}=1;
&gt;         }
&gt;         push&#40;@uniqs, [ $keyname =&gt; \@ordered_cols ]&#41;;
&gt;     }
&gt;
&gt;     $sth-&gt;finish;
&gt;
&gt;     return \@uniqs;
&gt; }
&gt;
&gt;
&gt;
&gt; On Mon, Jan 6, 2014 at 8:46 PM, Carlos Eduardo Panazzolo Guidugli &lt;
&gt; guidugli@gmail.com&gt; wrote:
&gt;
<div class="message-stanza open">&gt;&gt; Hi, found the problem that prevented DBIx-Class-Schema-Loader from
&gt;&gt; getting the relationships.
&gt;&gt;
&gt;&gt; On the file /usr/local/share/perl5/DBIx/Class/Schema/Loader/DBI/DB2.pm,
&gt;&gt; method _table_fk_info, the query is currently:
&gt;&gt;     my $sth = $self-&gt;{_cache}-&gt;{db2_fk} ||= $self-&gt;dbh-&gt;prepare&#40;&lt;&lt;&#39;EOF&#39;&#41;;
&gt;&gt; SELECT tc.constname, sr.reftabschema, sr.reftabname,
&gt;&gt;        kcu.colname, rkcu.colname, kcu.colseq,
&gt;&gt;        sr.deleterule, sr.updaterule
&gt;&gt; FROM ........
&gt;&gt;
&gt;&gt; The problem is that DB2 retrieves some columns preserving spaces at its
&gt;&gt; end. So, the sr.reftabschema was bringing &#39;MYSCHEMA           &#39; instead of
&gt;&gt; &#39;MYSCHEMA&#39;.
&gt;&gt;
&gt;&gt; To solve this problem I changed the query to:
&gt;&gt;     my $sth = $self-&gt;{_cache}-&gt;{db2_fk} ||= $self-&gt;dbh-&gt;prepare&#40;&lt;&lt;&#39;EOF&#39;&#41;;
&gt;&gt; SELECT trim&#40;tc.constname&#41;, trim&#40;sr.reftabschema&#41;, trim&#40;sr.reftabname&#41;,
&gt;&gt;        trim&#40;kcu.colname&#41;, trim&#40;rkcu.colname&#41;, kcu.colseq,
&gt;&gt;        sr.deleterule, sr.updaterule
&gt;&gt; FROM .........
&gt;&gt;
&gt;&gt; With this change I was able to retrieve relation information.
&gt;&gt;
&gt;&gt; Another point that I&#39;d like to show is about UNIQUE constraint in method
&gt;&gt; _table_uniq_info. In DB2, it is possible to create a UNIQUE constraint, or
&gt;&gt; a UNIQUE index with exactly the same effect. I was using unique indexes, so
&gt;&gt; none appeared on the model. In order to make it work I created the unique
&gt;&gt; constraints as well. I am new to DBIx, but what would happen if there are
&gt;&gt; two unique constraints in the resulting class, as shown in the example
&gt;&gt; below.
&gt;&gt;
&gt;&gt; __PACKAGE__-&gt;add_unique_constraint&#40;&#34;SERVICELINE_SLNAME_UN&#34;, [&#34;slname&#34;]&#41;;
&gt;&gt; __PACKAGE__-&gt;add_unique_constraint&#40;&#34;SERVICELINE_SLNAME_IDX&#34;, [&#34;slname&#34;]&#41;;
&gt;&gt;
&gt;&gt; If this is not a problem, maybe the query could be changed to retrieve
&gt;&gt; unique indexes as well:
&gt;&gt;
&gt;&gt; SELECT sc.colname, si.name, sc.colseq
&gt;&gt; FROM sysibm.sysindexes si, sysibm.sysindexcoluse sc
&gt;&gt; WHERE si.tbcreator=? and si.name=sc.indname and si.tbname=? AND
&gt;&gt; si.uniquerule = &#39;U&#39;
&gt;&gt;
&gt;&gt; UNION
&gt;&gt;
&gt;&gt; SELECT kcu.colname, kcu.constname, kcu.colseq
&gt;&gt; FROM syscat.tabconst as tc
&gt;&gt; JOIN syscat.keycoluse as kcu
&gt;&gt;     ON tc.constname = kcu.constname
&gt;&gt;         AND tc.tabschema = kcu.tabschema
&gt;&gt;         AND tc.tabname   = kcu.tabname
&gt;&gt; WHERE tc.tabschema = ? and tc.tabname = ? and tc.type = &#39;U&#39;
&gt;&gt;
&gt;&gt; What do you think? Also, it may be a safe bet to add TRIM to char,
&gt;&gt; varchar columns that have strings with variable length.
&gt;&gt;
&gt;&gt; Thank you
&gt;&gt;
&gt;&gt;
&gt;&gt; On Mon, Jan 6, 2014 at 3:47 PM, Carlos Eduardo Panazzolo Guidugli &lt;
&gt;&gt; guidugli@gmail.com&gt; wrote:
&gt;&gt;
<div class="message-stanza open">&gt;&gt;&gt; Thank you. Do you of any bug regarding relationships? Somehow the loader
&gt;&gt;&gt; detects the primary keys but is not building the has_many, belongs_to, etc
&gt;&gt;&gt; methods.
&gt;&gt;&gt;  On Jan 2, 2014 8:07 PM, &#34;Dagfinn Ilmari Mannsaker via RT&#34; &lt;
&gt;&gt;&gt; bug-DBIx-Class-Schema-Loader@rt.cpan.org&gt; wrote:
&gt;&gt;&gt;
<div class="message-stanza open">&gt;&gt;&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91764">https://rt.cpan.org/Ticket/Display.html?id=91764</a></span> &gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Thank you for testing.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; It turns out there was already a fix for this by Matt Phillips on a
&gt;&gt;&gt;&gt; branch, so I&#39;ve merged that and it&#39;ll be in the next release.
&gt;&gt;&gt;&gt;
</div>&gt;&gt;&gt;
</div>&gt;&gt;
</div>&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1309280/693810/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/693810">with headers</a>
<br />
<span class="downloadcontenttype">text/html 9.1k</span>
</div>
<div class="messagebody">
</div>
</div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1309280/693811/Result_NewQuery.txt">Download Result_NewQuery.txt</a><br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1309280/693812/Result_OriginalQuery.txt">Download Result_OriginalQuery.txt</a><br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.751551</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
