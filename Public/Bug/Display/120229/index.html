<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #120229 for Pod-Perldoc: perldoc rudely interferes with pager configuration</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #120229 for Pod-Perldoc: perldoc rudely interferes with pager configuration</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Pod-Perldoc/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Pod-Perldoc/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Pod-Perldoc/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Pod-Perldoc/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Pod-Perldoc">Pod-Perldoc CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">120229</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Pod-Perldoc/Active/">Pod-Perldoc</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
zefram [...] fysh.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-26136-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-26137-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;13&nbsp;09:25:32&nbsp;2017</span>
    <span class="description">zefram [...] fysh.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> perldoc rudely interferes with pager configuration</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 13 Feb 2017 14:07:54 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Pod-Perldoc [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Zefram &lt;zefram [...] fysh.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Since Pod::Perldoc 3.25, perldoc edits the environment variable $ENV{LESS}
when running the pager, thus rudely altering pager configuration
that belongs to the user.  The change that it makes, adding &#34;-R&#34;,
is somewhat understandable as a reaction to [rt.cpan.org #88204] with
the ToTerm output method, though as I explained there it is still the
wrong approach to that issue.  But the configuration change gets made
even if I explicitly select a different output method, such as if I use
PERLDOC=-oman to get the &#40;former default&#41; ToMan output method, which
does not exhibit ToTerm&#39;s problem.  In this case there is no excuse at
all for dishonouring the user&#39;s pager configuration.

-zefram
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;01&nbsp;17:05:27&nbsp;2017</span>
    <span class="description">mrallen1 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Feb 13 09:25:32 2017, zefram@fysh.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Since Pod::Perldoc 3.25, perldoc edits the environment variable $ENV{LESS}
&gt; when running the pager, thus rudely altering pager configuration
&gt; that belongs to the user.  The change that it makes, adding &#34;-R&#34;,
&gt; is somewhat understandable as a reaction to [rt.cpan.org #88204] with
&gt; the ToTerm output method, though as I explained there it is still the
&gt; wrong approach to that issue.  But the configuration change gets made
&gt; even if I explicitly select a different output method, such as if I use
&gt; PERLDOC=-oman to get the &#40;former default&#41; ToMan output method, which
&gt; does not exhibit ToTerm&#39;s problem.  In this case there is no excuse at
&gt; all for dishonouring the user&#39;s pager configuration.
&gt; 
&gt; -zefram
</div>
Yes, sorry. I have published 3.27_02 to CPAN which addresses this issue. Please try that release. If it fixes the problem, I will publish _02 as 3.28 official.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;01&nbsp;17:05:27&nbsp;2017</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;01&nbsp;17:05:43&nbsp;2017</span>
    <span class="description">mrallen1 [...] yahoo.com -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;01&nbsp;23:46:59&nbsp;2017</span>
    <span class="description">zefram [...] fysh.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #120229] perldoc rudely interferes with pager configuration</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 2 Mar 2017 04:46:50 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Mark Allen via RT &lt;bug-Pod-Perldoc [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Zefram &lt;zefram [...] fysh.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Mark Allen via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;Yes, sorry. I have published 3.27_02 to CPAN which addresses this issue.
</div>
It no longer hits ToMan, but it hasn&#39;t been properly limited to ToTerm.

-zefram
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;02&nbsp;12:19:00&nbsp;2017</span>
    <span class="description">mrallen1 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Mar 01 23:46:59 2017, zefram@fysh.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Mark Allen via RT wrote:
<div class="message-stanza open">&gt; &gt;Yes, sorry. I have published 3.27_02 to CPAN which addresses this issue.
</div>&gt; 
&gt; It no longer hits ToMan, but it hasn&#39;t been properly limited to ToTerm.
&gt; 
&gt; -zefram
</div>
OK, would you help me understand how you would prefer I address this issue?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;02&nbsp;12:19:01&nbsp;2017</span>
    <span class="description">mrallen1 [...] yahoo.com -  Status changed from &#39;patched&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;02&nbsp;13:09:25&nbsp;2017</span>
    <span class="description">zefram [...] fysh.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #120229] perldoc rudely interferes with pager configuration</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 2 Mar 2017 18:09:13 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Mark Allen via RT &lt;bug-Pod-Perldoc [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Zefram &lt;zefram [...] fysh.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Mark Allen via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;OK, would you help me understand how you would prefer I address this issue?
</div>
Well, I&#39;d *prefer* that you leave the user&#39;s pager configuration untouched
and pick a default formatter that&#39;s compatible with that.  But that&#39;s
a bigger change than I&#39;ve sought with this ticket.  If we take as read
that this environment diddling is required with the ToTerm formatter,
then it ought to be applied *only* with that formatter.

The question then is merely how to detect the ToTerm formatter, to
which there are two obvious answers.  Firstly, there could be a method
in the generic formatter API, akin to is_pageable, indicating whether
to modify the environment.  Or secondly, Pod::Perldoc could perform an
exact string comparison on the whole of the class name &#40;where 3.27_02
has a case-insensitive substring match&#41;.

-zefram
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;02&nbsp;17:08:36&nbsp;2017</span>
    <span class="description">mrallen1 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Mar 02 13:09:25 2017, zefram@fysh.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The question then is merely how to detect the ToTerm formatter, to
&gt; which there are two obvious answers.  Firstly, there could be a method
&gt; in the generic formatter API, akin to is_pageable, indicating whether
&gt; to modify the environment.  Or secondly, Pod::Perldoc could perform an
&gt; exact string comparison on the whole of the class name &#40;where 3.27_02
&gt; has a case-insensitive substring match&#41;.
</div>
What do you think of this idea?

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/mrallen1/Pod-Perldoc/pull/33">https://github.com/mrallen1/Pod-Perldoc/pull/33</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;03&nbsp;01:03:07&nbsp;2017</span>
    <span class="description">zefram [...] fysh.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #120229] perldoc rudely interferes with pager configuration</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 3 Mar 2017 06:02:04 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Mark Allen via RT &lt;bug-Pod-Perldoc [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Zefram &lt;zefram [...] fysh.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Mark Allen via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;What do you think of this idea?
&gt;
&gt;<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/mrallen1/Pod-Perldoc/pull/33">https://github.com/mrallen1/Pod-Perldoc/pull/33</a></span>
</div>
There are two parts to this: the pager_configuration API, and the reduced
amount of environmental change.

The pager_configuration interface is an obvious generalisation of
having the formatter declare whether it needs the configuration
change.  &#40;Incidentally, I was surprised that you didn&#39;t add an empty
pager_configuration to Pod::Perldoc::BaseTo.&#41;  If the choice is made
to embrace the idea of per-formatter customisation of the pager, then
I would certainly go in this direction of generalisation.  But this is
not the place to stop: I would generalise further.

Whatever provides the code to actually change the environment settings
needs to know about specific pagers and how to configure them.
The individual formatters are very poorly placed to be burdened with
this kind of knowledge: it&#39;s way off their core concern.  That&#39;s a
maintainability problem.  There&#39;s also a maintainability problem where
pager customisations ought to be shared between formatters, as is arguably
the case with ToANSI and ToTerm.

So if I were going the generalisation route, I&#39;d introduce another
layer of abstraction: have the formatter declare *what kind of textual
features appear in its output*.  I&#39;d leave it up to framework code &#40;in
Pod::Perldoc or factored out&#41; to mediate between those requirements
and the pagers available.  This system would supersede the existing
is_pageable flag, and would give the framework a lot of flexibility in
how to respond to output features, all of which could be influenced
by user configuration of which the formatters do not need knowledge.
ToTerm would declare &#34;output contains ANSI text attribute controls&#34;,
and in response to that the framework might decide &#40;a&#41; that the pager
configuration can already handle that, so just pass it through; &#40;b&#41; that
the pager configuration needs a change to handle it, so tweak environment
and pass the output through; &#40;c&#41; that the pager can&#39;t handle it but the
terminal can, so output it without a pager; &#40;d&#41; that the ANSI controls
should be translated into some other kind of controls, with filtered
output going to a pager; &#40;e&#41; that the ANSI controls should be removed,
with filtered output going to a pager; or &#40;f&#41; that a different formatter
should be used instead.  Options to perldoc&#40;1&#41; or in the environment
could influence this, and it could perform test executions of pagers,
and so on.  It can get arbitrarily sophisticated in future versions,
without the individual formatters having to change.

However, if I were in your place I would probably go to the opposite
extreme.  I don&#39;t think there&#39;s enough value in doing the pager
configuration properly to offset its complexity and the burden of
incorporating an unbounded amount of knowledge about specific pagers.
As discussed elsewhere, I&#39;d be looking to remove the pager tweaking
entirely &#40;along with the need for it&#41;, if not for Perl 5.26 then for
5.27.1.  With that expectation, I&#39;d look to minimise the present hack,
on the basis that it&#39;s a stopgap that will shortly go away.  I&#39;d keep
the hack entirely in Pod::Perldoc, and base it on exact match of the
formatter class name.

As regards the proposed reduction in the amount of enviornmental change,
I don&#39;t think this achieves anything useful.  It retains all the downside
of dishonouring the user&#39;s configuration, including that it will entirely
break some reasonable configuration on a current OS &#40;more&#40;1&#41; on Debian
with $ENV{MORE} unset&#41;.  As far as I can see the change just makes it
less successful at setting the -R option.

-zefram
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;12&nbsp;06:24:07&nbsp;2017</span>
    <span class="description">XSAWYERX [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve looked at this issue now, and I have some comments and questions.

On Fri Mar 03 01:03:07 2017, zefram@fysh.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Mark Allen via RT wrote:
<div class="message-stanza open">&gt; &gt;What do you think of this idea?
&gt; &gt;
&gt; &gt;<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/mrallen1/Pod-Perldoc/pull/33">https://github.com/mrallen1/Pod-Perldoc/pull/33</a></span>
</div>&gt; 
&gt; There are two parts to this: the pager_configuration API, and the reduced
&gt; amount of environmental change.
&gt; 
&gt; The pager_configuration interface is an obvious generalisation of
&gt; having the formatter declare whether it needs the configuration
&gt; change.  &#40;Incidentally, I was surprised that you didn&#39;t add an empty
&gt; pager_configuration to Pod::Perldoc::BaseTo.&#41;  If the choice is made
&gt; to embrace the idea of per-formatter customisation of the pager, then
&gt; I would certainly go in this direction of generalisation.  But this is
&gt; not the place to stop: I would generalise further.
&gt;
&gt; [...]
</div>

I think these are excellent ideas. However, they would require a maintainer interested and willing to make these changes. At the moment, our problem with reverting all of these changes is that Unicode will still be broken on Mac. macOS Sierra still includes the old version of groff that doesn&#39;t support Unicode adequately.

This means that moving from theoretical good to practical necessity, this change - as beneficial as it might be, and as well thought-out as it is - is not necessary at the moment to implement to untangle the current situation.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; However, if I were in your place I would probably go to the opposite
&gt; extreme.  I don&#39;t think there&#39;s enough value in doing the pager
&gt; configuration properly to offset its complexity and the burden of
&gt; incorporating an unbounded amount of knowledge about specific pagers.
&gt; As discussed elsewhere, I&#39;d be looking to remove the pager tweaking
&gt; entirely &#40;along with the need for it&#41;, if not for Perl 5.26 then for
&gt; 5.27.1.  With that expectation, I&#39;d look to minimise the present hack,
&gt; on the basis that it&#39;s a stopgap that will shortly go away.  I&#39;d keep
&gt; the hack entirely in Pod::Perldoc, and base it on exact match of the
&gt; formatter class name.
</div>
What makes you think the stopgap would go away? I see no reason for that.

I think the approach of making it work on broken systems by adding the necessary flags &#40;and possibly changing the pipeline&#41; is correct. I would like to keep it with some alterations, proposed below.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; As regards the proposed reduction in the amount of enviornmental change,
&gt; I don&#39;t think this achieves anything useful.  It retains all the downside
&gt; of dishonouring the user&#39;s configuration, including that it will entirely
&gt; break some reasonable configuration on a current OS &#40;more&#40;1&#41; on Debian
&gt; with $ENV{MORE} unset&#41;.  As far as I can see the change just makes it
&gt; less successful at setting the -R option.
</div>
Having reviewed the code and the issues, I have the following observations:

* The old pipeline fails with Unicode on macOS because of the groff version.
* The new pipeline uses escape codes which `less` and `more` do not like, more or less. &#40;Excuse the pun.&#41;
* There is a behavior check to not disturb Windows or DOS and to not override the environment if it already is defined. I fail to understand how it is still overwriting the environment, as you noted.

My proposal is, therefore:
* Move the old pipeline to the default again. This will reduce the need for -R except for:
* Either:
  * Move macOS individually &#40;perhaps with derivatives&#41; to the new pipeline, or
  * Check groff version &#40;this is already done in the code&#41; and use the new pipeline with &#34;-R&#34; &#40;if not otherwise defined&#41; in case it is too old to display Unicode correctly.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;12&nbsp;07:04:20&nbsp;2017</span>
    <span class="description">zefram [...] fysh.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #120229] perldoc rudely interferes with pager configuration</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 12 Oct 2017 12:03:56 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Sawyer X via RT &lt;bug-Pod-Perldoc [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Zefram &lt;zefram [...] fysh.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sawyer X via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;At the moment, our problem with reverting all of these changes is that
&gt;Unicode will still be broken on Mac. macOS Sierra still includes the
&gt;old version of groff that doesn&#39;t support Unicode adequately.
</div>
I presume that by &#34;reverting all of these changes&#34; you mean returning to
defaulting to the ToMan formatter.  It would help if you were explicit
about which formatter you mean; terms like &#34;the old pipeline&#34; and &#34;the
new pipeline&#34; are unnecessarily unclear.

This groff issue was presumably the original motivation for changing the
default away from ToMan.  No one is proposing returning to that default
&#40;at least in its unconditional form&#41;.  The problems we see now arise from
the question of which formatter should be the default given that ToMan
is not acceptable.  The main candidates for this are ToTerm and ToText.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;What makes you think the stopgap would go away? I see no reason for that.
</div>
The context for the stopgap was the work immediately prior to the release
of 5.26.  The question of what version of Pod::Perldoc would go into 5.26
was distinct from the question of how it should be fixed in the long term.
An actual fix, of changing the default formatter, was vetoed for 5.26,
so for 5.26 we were looking just at tweaks to the environment-mutation
approach.  It&#39;s a stopgap in the sense that that was expected to be used
only for 5.26, with a proper fix coming along for 5.28.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;I fail to understand how it is still overwriting the environment, as you noted.
</div>
Altering the environment is the whole purpose of that bit of code.
It writes into %ENV.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  * Check groff version &#40;this is already done in the code&#41;
</div>
I&#39;m OK with ToMan being used as the default conditional on the groff
version.  That&#39;s a refinement beyond what we&#39;ve been discussing so far.
The more important question, which we need to resolve first, is what
should be the default when ToMan can&#39;t be used.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;and use the new pipeline with &#34;-R&#34; &#40;if not otherwise defined&#41; in case
&gt;it is too old to display Unicode correctly.
</div>
Anything that sticks &#34;-R&#34; into the environment is asking for trouble.
That&#39;s a portability problem, and as you noted we don&#39;t have any
volunteers to take on the full porting job.  This is why I say that
ToTerm is not suitable to be the default formatter: the fallback has to
be ToText.

-zefram
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;13&nbsp;06:45:16&nbsp;2017</span>
    <span class="description">XSAWYERX [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Oct 12 07:04:20 2017, zefram@fysh.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sawyer X via RT wrote:
<div class="message-stanza open">&gt; &gt; At the moment, our problem with reverting all of these changes is
&gt; &gt; that
&gt; &gt; Unicode will still be broken on Mac. macOS Sierra still includes the
&gt; &gt; old version of groff that doesn&#39;t support Unicode adequately.
</div>&gt; 
&gt; I presume that by &#34;reverting all of these changes&#34; you mean returning
&gt; to
&gt; defaulting to the ToMan formatter.
</div>
Yes. That was my intention.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It would help if you were explicit
&gt; about which formatter you mean; terms like &#34;the old pipeline&#34; and &#34;the
&gt; new pipeline&#34; are unnecessarily unclear.
</div>
My apoology. When I meant &#34;all of these changes&#34;, I meant returning to the ToMan to &#40;n|g&#41;roff pipeline &#40;&#34;the old pipeline&#34;&#41;.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This groff issue was presumably the original motivation for changing
&gt; the
&gt; default away from ToMan.  No one is proposing returning to that
&gt; default
&gt; &#40;at least in its unconditional form&#41;.  The problems we see now arise
&gt; from
&gt; the question of which formatter should be the default given that ToMan
&gt; is not acceptable.  The main candidates for this are ToTerm and
&gt; ToText.
</div>
My understanding was that ToMan was not acceptable simply because of Unicode in macOS. Is that correct?


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; What makes you think the stopgap would go away? I see no reason for
&gt; &gt; that.
</div>&gt; 
&gt; The context for the stopgap was the work immediately prior to the
&gt; release
&gt; of 5.26.  The question of what version of Pod::Perldoc would go into
&gt; 5.26
&gt; was distinct from the question of how it should be fixed in the long
&gt; term.
&gt; An actual fix, of changing the default formatter, was vetoed for 5.26,
&gt; so for 5.26 we were looking just at tweaks to the environment-mutation
&gt; approach.  It&#39;s a stopgap in the sense that that was expected to be
&gt; used
&gt; only for 5.26, with a proper fix coming along for 5.28.
</div>
I think I understand.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; I fail to understand how it is still overwriting the environment, as
&gt; &gt; you noted.
</div>&gt; 
&gt; Altering the environment is the whole purpose of that bit of code.
&gt; It writes into %ENV.
</div>
I see what you mean. I thought &#34;overwriting&#34; was meant in the sense of &#34;there&#39;s a value in $ENV{LESS} it is overwriting&#34;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; * Check groff version &#40;this is already done in the code&#41;
</div>&gt; 
&gt; I&#39;m OK with ToMan being used as the default conditional on the groff
&gt; version.  That&#39;s a refinement beyond what we&#39;ve been discussing so
&gt; far.
</div>
Indeed, but that is what I&#39;m proposing. ToMan be made the default again, except for older versions of groff, where we know it would screw up Unicode.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The more important question, which we need to resolve first, is what
&gt; should be the default when ToMan can&#39;t be used.
</div>
If I understand correctly, your objection to this being ToTerm is the change to the environment. Is that right?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; and use the new pipeline with &#34;-R&#34; &#40;if not otherwise defined&#41; in case
&gt; &gt; it is too old to display Unicode correctly.
</div>&gt; 
&gt; Anything that sticks &#34;-R&#34; into the environment is asking for trouble.
&gt; That&#39;s a portability problem, and as you noted we don&#39;t have any
&gt; volunteers to take on the full porting job.  This is why I say that
&gt; ToTerm is not suitable to be the default formatter: the fallback has
&gt; to
&gt; be ToText.
</div>
I agree sticking &#34;-R&#34; is, in a sense, &#34;looking for trouble&#34;, but I think it might still be a better solution than ToText. I don&#39;t know what the differences in display are between ToTerm and ToText. From ToTerm&#39;s perspective, we know the problem is simply control characters on pagers. If the pager has no configuration, I don&#39;t find it exceedingly terrible to add an environment change to fix it, since we&#39;re already calling the pager ourselves.

I should add that now Mark decided to step down from maintaining this so we have one maintainer short willing to any work.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;13&nbsp;07:38:49&nbsp;2017</span>
    <span class="description">zefram [...] fysh.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #120229] perldoc rudely interferes with pager configuration</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 13 Oct 2017 12:37:58 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Sawyer X via RT &lt;bug-Pod-Perldoc [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Zefram &lt;zefram [...] fysh.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sawyer X via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;If I understand correctly, your objection to this being ToTerm is the
&gt;change to the environment. Is that right?
</div>
That&#39;s part of it, but there are multiple failure modes.  My original
complaint, before any environment twiddling was implemented, was that it
renders badly, all &#34;ESC[1mSYNOPSISESC[0m&#34;.  There are other problematic
outcomes too.  Rough categorisation of failure modes:

0. If perldoc ever passes &#34;-R&#34; to the pager &#40;via either environment
   or command line&#41;, then sometimes this will be applied to a pager
   that doesn&#39;t support -R, so you&#39;ll get an error message instead of
   documentation.

1. If perldoc ever refrains from passing &#34;-R&#34; to the pager, then
   it&#39;ll quite often hand the escape seqeunces off to a pager
   that&#39;s not configured to handle them, so you&#39;ll get nicely-paged
   &#34;ESC[1mSYNOPSISESC[0m&#34; instead of the intended rendering.

2. If the terminal is one that doesn&#39;t use the ANSI escape sequence
   schema, then successfully configuring the pager to pass them through
   &#40;which is what -R does&#41; yields terminal-dependent garbage instead of
   the intended rendering.

Note that taking items 0 and 1 together means that you can&#39;t win.
There is no criterion for adding &#34;-R&#34; that doesn&#39;t trigger at least one
of these failure modes, and most criteria trigger both.  There are also
some situations where it&#39;s impossible to get the intended output even
given perfect knowledge of how to configure pagers: user&#39;s pager can&#39;t
be configured to pass through escape sequences; terminal doesn&#39;t support
those escape sequences.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;I don&#39;t know what the differences in display are between ToTerm and
&gt;ToText.
</div>
ToText produces plain text, no escape sequences.  That&#39;s the only
difference, AFAICS.  Both emit non-ASCII characters as UTF-8.
&#40;UTF-8 itself poses a rendering problem, but I&#39;ll let that slide for now.&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;If the pager has no configuration, I don&#39;t find it exceedingly terrible
&gt;to add an environment change to fix it,
</div>
It&#39;s terribly unportable.  We don&#39;t know what switch to pass for most
pagers; for pagers where we know how to spell &#34;-R&#34; we don&#39;t know whether
the pager actually supports that switch; and we don&#39;t know whether the
terminal supports those escape sequences anyway.  It&#39;s impossible for
us to actually fix the issue this way.

If it were actually possible to fix the rendering by sticking something
in the environment, and we could in all cases know what to stick in the
environment to do it, then I&#39;d be pretty OK with that.  But neither
of those conditions holds.  My objection to tweaking the environment
isn&#39;t an objection in principle to ever touching the environment; it&#39;s
an objection to altering configuration that we don&#39;t understand.

-zefram
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;22&nbsp;17:25:10&nbsp;2017</span>
    <span class="description">XSAWYERX [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Oct 13 07:38:49 2017, zefram@fysh.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sawyer X via RT wrote:
<div class="message-stanza open">&gt; &gt;If I understand correctly, your objection to this being ToTerm is the
&gt; &gt;change to the environment. Is that right?
</div>&gt; 
&gt; That&#39;s part of it, but there are multiple failure modes.  My original
&gt; complaint, before any environment twiddling was implemented, was that it
&gt; renders badly, all &#34;ESC[1mSYNOPSISESC[0m&#34;.  There are other problematic
&gt; outcomes too.  Rough categorisation of failure modes:
&gt; 
&gt; 0. If perldoc ever passes &#34;-R&#34; to the pager &#40;via either environment
&gt;    or command line&#41;, then sometimes this will be applied to a pager
&gt;    that doesn&#39;t support -R, so you&#39;ll get an error message instead of
&gt;    documentation.
&gt; 
&gt; 1. If perldoc ever refrains from passing &#34;-R&#34; to the pager, then
&gt;    it&#39;ll quite often hand the escape seqeunces off to a pager
&gt;    that&#39;s not configured to handle them, so you&#39;ll get nicely-paged
&gt;    &#34;ESC[1mSYNOPSISESC[0m&#34; instead of the intended rendering.
&gt; 
&gt; 2. If the terminal is one that doesn&#39;t use the ANSI escape sequence
&gt;    schema, then successfully configuring the pager to pass them through
&gt;    &#40;which is what -R does&#41; yields terminal-dependent garbage instead of
&gt;    the intended rendering.
&gt; 
&gt; Note that taking items 0 and 1 together means that you can&#39;t win.
&gt; There is no criterion for adding &#34;-R&#34; that doesn&#39;t trigger at least one
&gt; of these failure modes, and most criteria trigger both.  There are also
&gt; some situations where it&#39;s impossible to get the intended output even
&gt; given perfect knowledge of how to configure pagers: user&#39;s pager can&#39;t
&gt; be configured to pass through escape sequences; terminal doesn&#39;t support
&gt; those escape sequences.
</div>
I agree. This means we are playing some kind of odds here.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt;If the pager has no configuration, I don&#39;t find it exceedingly terrible
&gt; &gt;to add an environment change to fix it,
</div>&gt; 
&gt; It&#39;s terribly unportable.  We don&#39;t know what switch to pass for most
&gt; pagers; for pagers where we know how to spell &#34;-R&#34; we don&#39;t know whether
&gt; the pager actually supports that switch; and we don&#39;t know whether the
&gt; terminal supports those escape sequences anyway.  It&#39;s impossible for
&gt; us to actually fix the issue this way.
</div>

It is not a &#34;fix&#34; then, it&#39;s a hack. Howevr, let us not allow perfection to be the enemy of &#34;good.&#34;


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If it were actually possible to fix the rendering by sticking something
&gt; in the environment, and we could in all cases know what to stick in the
&gt; environment to do it, then I&#39;d be pretty OK with that.  But neither
&gt; of those conditions holds.  My objection to tweaking the environment
&gt; isn&#39;t an objection in principle to ever touching the environment; it&#39;s
&gt; an objection to altering configuration that we don&#39;t understand.
</div>
I think limiting the risk here is reasonable. We can return the pipeline to ToMan, knowing this works, except the following situation:

* old ngroff
* macOS

I&#39;ll add that currently perldoc already runs external programs, which means we are already assuming on a well-intentioned environment. If a user has something odd in their environment, well, that&#39;s the rub. Currently, we have broken Unicode on macOS which is a far greater factor of users than anyone who is on macOS, has an old groff, *and* decided to use some other non-standard pager. I&#39;m okay with that.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;22&nbsp;18:04:24&nbsp;2017</span>
    <span class="description">zefram [...] fysh.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #120229] perldoc rudely interferes with pager configuration</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 22 Oct 2017 23:04:11 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Sawyer X via RT &lt;bug-Pod-Perldoc [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Zefram &lt;zefram [...] fysh.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sawyer X via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;I agree. This means we are playing some kind of odds here.
</div>...
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;It is not a &#34;fix&#34; then, it&#39;s a hack. Howevr, let us not allow perfection
&gt;to be the enemy of &#34;good.&#34;
</div>
In these comments, you seem to be implying that there is a moral
equivalence between the ToTerm and ToText mechanisms.  &#40;Though you
don&#39;t mention either of those formatters explicitly, so it&#39;s not clear.&#41;
In fact there is no such equivalence in their portability.  There is a
sharp difference between ToTerm raising these huge portability problems
and ToText which reliably works.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;I think limiting the risk here is reasonable. We can return the pipeline
&gt;to ToMan, knowing this works, except the following situation:
&gt;
&gt;* old ngroff
&gt;* macOS
</div>
I&#39;m fine with conditional use of ToMan, indeed I welcome a return
to the ToMan default on the platform that I use personally, provided
that the fallback where ToMan is not usable is a properly portable one.
Once again, your discussion of ToMan here is a distraction.  These tickets
are concerned with the non-ToMan situation.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;I&#39;ll add that currently perldoc already runs external programs, which
&gt;means we are already assuming on a well-intentioned environment.
</div>
Of course, we are always relying on the user&#39;s environment to be
coherent.  None of this has been concerned with environments that are
a priori faulty.  All of the situations that I have raised that ToTerm
has difficulty with are reasonable situations, with environmental
configuration presumed to be correct.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;Currently, we have broken Unicode on macOS which is a far greater factor
&gt;of users than anyone who is on macOS, has an old groff, *and* decided
&gt;to use some other non-standard pager. I&#39;m okay with that.
</div>
I don&#39;t understand this comment.  What exactly is broken on macOS?
By &#34;currently&#34;, do you mean perldoc with its ToTerm default &#40;as in
the CPAN version&#41;, or perldoc with the ToText default &#40;as in blead&#41;,
or something else?  I&#39;m mystified by your reference to &#34;some other
non-standard pager&#34;.

To be clear, the portability issues with ToTerm arise on macOS just as
on any other platform.

I recommend that the CPAN instance of Pod-Perldoc should incorporate the
same change to Pod::Perldoc with which I customised it in blead; then
it should also remove the &#40;now never called&#41; pager_configuration method
from Pod::Perldoc::ToTerm; then from that base it should incorporate
some conditional preference for ToMan.  The first part of this is the
most important, and the last part should be postponed if the correct
form for the condition is not immediately apparent.

-zefram
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;22&nbsp;18:34:08&nbsp;2017</span>
    <span class="description">XSAWYERX [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Oct 22 18:04:24 2017, zefram@fysh.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sawyer X via RT wrote:
<div class="message-stanza open">&gt; &gt;I agree. This means we are playing some kind of odds here.
</div>&gt; ...
<div class="message-stanza open">&gt; &gt;It is not a &#34;fix&#34; then, it&#39;s a hack. Howevr, let us not allow perfection
&gt; &gt;to be the enemy of &#34;good.&#34;
</div>&gt; 
&gt; In these comments, you seem to be implying that there is a moral
&gt; equivalence between the ToTerm and ToText mechanisms.  &#40;Though you
&gt; don&#39;t mention either of those formatters explicitly, so it&#39;s not clear.&#41;
&gt; In fact there is no such equivalence in their portability.  There is a
&gt; sharp difference between ToTerm raising these huge portability problems
&gt; and ToText which reliably works.
</div>
I was comparing ToMan and ToTerm. I wasn&#39;t referring to the ToText.

The ToText removes the ability to have any highlighting &#40;of any form&#41;, rendering the documents the least readable in their text form &#40;excluding rendering issues&#41;. I&#39;m looking for a way to avoid that.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt;I think limiting the risk here is reasonable. We can return the pipeline
&gt; &gt;to ToMan, knowing this works, except the following situation:
&gt; &gt;
&gt; &gt;* old ngroff
&gt; &gt;* macOS
</div>&gt; 
&gt; I&#39;m fine with conditional use of ToMan, indeed I welcome a return
&gt; to the ToMan default on the platform that I use personally, provided
&gt; that the fallback where ToMan is not usable is a properly portable one.
</div>
The only &#34;perfect&#34; solution in which we do not lose the value of typographical emphasis is the long-term one you suggested which we cannot implement atthe moment. I prefer not to handicap these emphases.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Once again, your discussion of ToMan here is a distraction.  These tickets
&gt; are concerned with the non-ToMan situation.
</div>
Cutting out the ToMan &#34;distraction,&#34; I&#39;ll reiterate that we are able to limit the ToTerm output to a smaller set of users that I find acceptable. I have noted this several timees. &#40;I have simply included the overall solution which mentions going back to ToMan as a full answer.&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt;I&#39;ll add that currently perldoc already runs external programs, which
&gt; &gt;means we are already assuming on a well-intentioned environment.
</div>&gt; 
&gt; Of course, we are always relying on the user&#39;s environment to be
&gt; coherent.  None of this has been concerned with environments that are
&gt; a priori faulty.  All of the situations that I have raised that ToTerm
&gt; has difficulty with are reasonable situations, with environmental
&gt; configuration presumed to be correct.
</div>
Can you indicate other reasonable situations in which it would break, other than the old groff on macOS using a non-standard pager?

I can only imagine a situation of: On Mac, using old groff, using a non-less pager that uses its binary, but doesn&#39;t support &#34;-R&#34;. Are there any other situations?

If this is it, I think it&#39;s minimal. If it were this vs. no typographical emphasis for anyone, I would pick this.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt;Currently, we have broken Unicode on macOS which is a far greater factor
&gt; &gt;of users than anyone who is on macOS, has an old groff, *and* decided
&gt; &gt;to use some other non-standard pager. I&#39;m okay with that.
</div>&gt; 
&gt; I don&#39;t understand this comment.  What exactly is broken on macOS?
&gt; By &#34;currently&#34;, do you mean perldoc with its ToTerm default &#40;as in
&gt; the CPAN version&#41;, or perldoc with the ToText default &#40;as in blead&#41;,
&gt; or something else?  I&#39;m mystified by your reference to &#34;some other
&gt; non-standard pager&#34;.
</div>
macOS carries a copy of groff that breaks ToMan. That&#39;s all.

&#34;Currently&#34; referred to CPAN version.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; To be clear, the portability issues with ToTerm arise on macOS just as
&gt; on any other platform.
</div>
At the moment, we are only aware of macOS carrying such an old version of groff.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;22&nbsp;19:28:20&nbsp;2017</span>
    <span class="description">zefram [...] fysh.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #120229] perldoc rudely interferes with pager configuration</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 23 Oct 2017 00:28:09 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Sawyer X via RT &lt;bug-Pod-Perldoc [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Zefram &lt;zefram [...] fysh.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sawyer X via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;The ToText removes the ability to have any highlighting &#40;of any form&#41;,
&gt;rendering the documents the least readable in their text form &#40;excluding
&gt;rendering issues&#41;. I&#39;m looking for a way to avoid that.
</div>
OK.  Defaulting to ToMan where we&#39;re confident that it&#39;ll work would
seem to be the main way to avoid that downside as much as possible.
We cannot avoid getting unhighlighted text in some situations, though.
Don&#39;t let the &#40;sensible&#41; desire for nice formatting get in the way of
achieving legibility for everyone.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;I&#39;ll reiterate that we are able to limit the ToTerm output to a smaller
&gt;set of users that I find acceptable. I have noted this several timees.
</div>
Apparently I didn&#39;t understand the previous times you&#39;ve noted it.
This is the first time I&#39;ve been aware of you defending ToTerm on the
basis that we can limit its usage to a relatively small set of users.

So I think what you&#39;re proposing, though you still haven&#39;t actually said
it explicitly, is roughly that the default should be ToMan on platforms
other than macOS, and should be ToTerm on macOS.  Maybe we&#39;d also avoid
ToMan on Windows, as we used to, though I don&#39;t know what you&#39;re then
proposing the default should be on Windows.  Maybe also some condition
based on detecting the version of the roff toolchain, though in your
previous message you didn&#39;t say whether that&#39;s ANDed or ORed with macOS,
so I don&#39;t know where this fits into the proposal.

I think this is a poor basis on which to defend ToTerm.  It&#39;s got exactly
the same problems for macOS users that we have noted on other platforms.
Only using it on macOS would indeed reduce the number of affected users,
but this amounts to giving those users exactly the mechanism that we&#39;ve
rejected for the majority on the basis that it&#39;s broken.  The problem
here is that the condition for choosing ToTerm, namely the macOS platform,
has nothing to do with whether ToTerm would actually work.

For ToTerm to ever be the default, the conditions for selecting it need
to be conditions that give us confidence that we can actually pull it off.
This would be, roughly,

* we recognise the specific pager nominated by the environment; and

* by checking the specific version of the pager that will be executed
  we are confident that it is a version that supports -R; and

* the terminal type nominated by the environment is one that we
  specifically recognise as taking ANSI escape sequences.

If those conditions are met then we could confidently arrange to pass &#34;-R&#34;
as a command-line argument to the pager and select the ToTerm formatter.
If these conditions are not met then we&#39;re back in the usual situation
of ToTerm being hopelessly unportable, and must fall back on ToText.
It should be easy enough to arrange for the ToTerm-selecting conditions
to include most of the macOS users about which you&#39;re concerned.
Considering ToMan as well, presumably we&#39;d still prefer ToMan, and so
only look at whether ToTerm is an acceptable default if we&#39;ve already
decided that ToMan is not acceptable.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;Can you indicate other reasonable situations in which it would break,
&gt;other than the old groff on macOS using a non-standard pager?
</div>
Er, what?  Where I&#39;ve described things breaking, that&#39;s been specifically
about ToTerm breaking.  The version of groff has no influence on ToTerm.
I can&#39;t figure out what you&#39;re trying to ask here.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;macOS carries a copy of groff that breaks ToMan. That&#39;s all.
</div>
Right, so, to be clear, the current perldoc defaults &#40;in either CPAN or
blead versions&#41; don&#39;t produce any broken Unicode on macOS.

-zefram
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;23&nbsp;03:25:08&nbsp;2017</span>
    <span class="description">XSAWYERX [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Oct 22 19:28:20 2017, zefram@fysh.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sawyer X via RT wrote:
&gt; [...]
<div class="message-stanza open">&gt; &gt;I&#39;ll reiterate that we are able to limit the ToTerm output to a smaller
&gt; &gt;set of users that I find acceptable. I have noted this several timees.
</div>&gt; 
&gt; Apparently I didn&#39;t understand the previous times you&#39;ve noted it.
&gt; This is the first time I&#39;ve been aware of you defending ToTerm on the
&gt; basis that we can limit its usage to a relatively small set of users.
</div>
I apologize for my lack of clarity. This was my original point.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So I think what you&#39;re proposing, though you still haven&#39;t actually said
&gt; it explicitly, is roughly that the default should be ToMan on platforms
&gt; other than macOS, and should be ToTerm on macOS.
</div>
Yes. That is correct.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Maybe we&#39;d also avoid
&gt; ToMan on Windows, as we used to, though I don&#39;t know what you&#39;re then
&gt; proposing the default should be on Windows.
</div>
Do you have an opinion on what the default should be on Windows?


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Maybe also some condition
&gt; based on detecting the version of the roff toolchain, though in your
&gt; previous message you didn&#39;t say whether that&#39;s ANDed or ORed with macOS,
&gt; so I don&#39;t know where this fits into the proposal.
</div>
I thought it should be ANDed, but now that you raise this I realize that was naive thinking. From what I understood, the need to use ToTerm was because reports came in from macOS that ToMan was rendered inappropriately. This menas that, theoretically, one could have an older version of groff on other operating systems.

This would mean that in all such cases ToMan is sub-optimal.

Here&#39;s my updated proposal:
1. Check groff version and less binary.
2. If groff is new enough, use ToMan.
3. If groff is too old and our pager is less, use ToTerm.
4. If groff is too old and our pager is not less, use ToText.

Our use-case of macOS seems covered, and in any event of different pager, or even any other operating system that also sufferes from a groff that screws up Unicode, we will opt for the least featureful &#40;but working&#41; ToText.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; I think this is a poor basis on which to defend ToTerm.  It&#39;s got exactly
&gt; the same problems for macOS users that we have noted on other platforms.
</div>
I understand. I think this new proposal will solve the situation of other platforms who could suffer from ToTerm.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The problem
&gt; here is that the condition for choosing ToTerm, namely the macOS platform,
&gt; has nothing to do with whether ToTerm would actually work.
</div>
You&#39;re right. That was short-sighted.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; For ToTerm to ever be the default, the conditions for selecting it need
&gt; to be conditions that give us confidence that we can actually pull it off.
&gt; This would be, roughly,
&gt; 
&gt; * we recognise the specific pager nominated by the environment; and
&gt; 
&gt; * by checking the specific version of the pager that will be executed
&gt;   we are confident that it is a version that supports -R; and
&gt; 
&gt; * the terminal type nominated by the environment is one that we
&gt;   specifically recognise as taking ANSI escape sequences.
&gt; 
&gt; If those conditions are met then we could confidently arrange to pass &#34;-R&#34;
&gt; as a command-line argument to the pager and select the ToTerm formatter.
&gt; If these conditions are not met then we&#39;re back in the usual situation
&gt; of ToTerm being hopelessly unportable, and must fall back on ToText.
&gt; It should be easy enough to arrange for the ToTerm-selecting conditions
&gt; to include most of the macOS users about which you&#39;re concerned.
&gt; Considering ToMan as well, presumably we&#39;d still prefer ToMan, and so
&gt; only look at whether ToTerm is an acceptable default if we&#39;ve already
&gt; decided that ToMan is not acceptable.
</div>
This seems to me like the best approach.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt;Can you indicate other reasonable situations in which it would break,
&gt; &gt;other than the old groff on macOS using a non-standard pager?
</div>&gt; 
&gt; Er, what?  Where I&#39;ve described things breaking, that&#39;s been specifically
&gt; about ToTerm breaking.  The version of groff has no influence on ToTerm.
&gt; I can&#39;t figure out what you&#39;re trying to ask here.
</div>
I meant ToMan. It doesn&#39;t matter. :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;23&nbsp;10:37:58&nbsp;2017</span>
    <span class="description">zefram [...] fysh.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #120229] perldoc rudely interferes with pager configuration</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 23 Oct 2017 15:37:40 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Sawyer X via RT &lt;bug-Pod-Perldoc [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Zefram &lt;zefram [...] fysh.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sawyer X via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;Do you have an opinion on what the default should be on Windows?
</div>
I don&#39;t have firm platform knowledge.  I expect that Windows ordinarily
lacks a roff toolchain, making ToMan inoperable.  It seems from
the previous versions of Pod::Perldoc that ToTerm is also ordinarily
unworkable on Windows: we know that the usual pager doesn&#39;t support -R.
I don&#39;t know what its usual terminals do with the escape sequences.
So if we&#39;re making flat per-platform decisions, it looks like Windows
needs to default to ToText &#40;as it does in the current CPAN version of
Pod::Perldoc&#41;.  But...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;This menas that, theoretically, one could have an older version of
&gt;groff on other operating systems.
</div>
Yes.  I think we&#39;re converging on the concept that we should detect
what&#39;s actually workable at runtime, rather than make coarse per-platform
assumptions.  We need such detection logic for ToMan and for ToTerm.

-zefram
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;25&nbsp;17:47:16&nbsp;2017</span>
    <span class="description">XSAWYERX [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Oct 23 10:37:58 2017, zefram@fysh.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sawyer X via RT wrote:
<div class="message-stanza open">&gt; &gt;Do you have an opinion on what the default should be on Windows?
</div>&gt;
&gt; I don&#39;t have firm platform knowledge.  I expect that Windows ordinarily
&gt; lacks a roff toolchain, making ToMan inoperable.  It seems from
&gt; the previous versions of Pod::Perldoc that ToTerm is also ordinarily
&gt; unworkable on Windows: we know that the usual pager doesn&#39;t support -R.
&gt; I don&#39;t know what its usual terminals do with the escape sequences.
&gt; So if we&#39;re making flat per-platform decisions, it looks like Windows
&gt; needs to default to ToText &#40;as it does in the current CPAN version of
&gt; Pod::Perldoc&#41;.  But...
</div>
I&#39;ll verify this and report back then.



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt;This menas that, theoretically, one could have an older version of
&gt; &gt;groff on other operating systems.
</div>&gt; 
&gt; Yes.  I think we&#39;re converging on the concept that we should detect
&gt; what&#39;s actually workable at runtime, rather than make coarse per-platform
&gt; assumptions.  We need such detection logic for ToMan and for ToTerm.
</div>
\o/

Thank you for your patience.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;30&nbsp;07:48:20&nbsp;2017</span>
    <span class="description">XSAWYERX [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Oct 25 17:47:16 2017, xsawyerx wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Oct 23 10:37:58 2017, zefram@fysh.org wrote:
<div class="message-stanza open">&gt; &gt; Sawyer X via RT wrote:
<div class="message-stanza open">&gt; &gt; &gt;Do you have an opinion on what the default should be on Windows?
</div>&gt; &gt;
&gt; &gt; I don&#39;t have firm platform knowledge.  I expect that Windows ordinarily
&gt; &gt; lacks a roff toolchain, making ToMan inoperable.  It seems from
&gt; &gt; the previous versions of Pod::Perldoc that ToTerm is also ordinarily
&gt; &gt; unworkable on Windows: we know that the usual pager doesn&#39;t support -R.
&gt; &gt; I don&#39;t know what its usual terminals do with the escape sequences.
&gt; &gt; So if we&#39;re making flat per-platform decisions, it looks like Windows
&gt; &gt; needs to default to ToText &#40;as it does in the current CPAN version of
&gt; &gt; Pod::Perldoc&#41;.  But...
</div>&gt; 
&gt; I&#39;ll verify this and report back then.
&gt; 
&gt; 
&gt; 
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt;This menas that, theoretically, one could have an older version of
&gt; &gt; &gt;groff on other operating systems.
</div>&gt; &gt; 
&gt; &gt; Yes.  I think we&#39;re converging on the concept that we should detect
&gt; &gt; what&#39;s actually workable at runtime, rather than make coarse per-platform
&gt; &gt; assumptions.  We need such detection logic for ToMan and for ToTerm.
</div>&gt; 
&gt; \o/
&gt; 
&gt; Thank you for your patience.
</div>

Here is my pull request: <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/mrallen1/Pod-Perldoc/pull/36">https://github.com/mrallen1/Pod-Perldoc/pull/36</a></span>.

This is against mrallen1&#39;s account, but I can move it to the DualLife account as well.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;30&nbsp;15:40:55&nbsp;2017</span>
    <span class="description">zefram [...] fysh.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #120229] perldoc rudely interferes with pager configuration</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 30 Nov 2017 20:40:33 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Sawyer X via RT &lt;bug-Pod-Perldoc [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Zefram &lt;zefram [...] fysh.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sawyer X via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;Here is my pull request: <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/mrallen1/Pod-Perldoc/pull/36">https://github.com/mrallen1/Pod-Perldoc/pull/36</a></span>.
</div>
Your detection of less&#40;1&#41; in the pager list is dubious.  You use a
substring search for the character sequence &#34;less&#34;, but that may be
misleading because it could appear as substring in a $ENV{PAGER} that
is for a different pager.

The use of `$less_bin --version` is dubious, because, per
-&gt;pagers_guessing, $less_bin may contain shell redirection characters,
such that &#34;--version&#34; wouldn&#39;t necessarily function as a command-line
argument to less&#40;1&#41;.  You may need to parse pager strings in more detail.

The version check on less&#40;1&#41; involves a regexp copied from the groff
version check, which will never match actual &#34;less --version&#34; output.

Where the acceptability of the formatter depends on a sufficiently
recent less&#40;1&#41;, you need to ensure that that is the pager actually
used, which you are not doing.  All you are doing is detecting that a
sufficiently recent less&#40;1&#41; is somewhere in the list of candidate pagers.
You probably want to filter the pager list to contain only acceptable
versions of less&#40;1&#41;.  However, where the first pager setting comes from
$ENV{PAGER} or $ENV{PERLDOC_PAGER} it would be rude to dishonour that.
An environmental pager setting, where supplied, should be the only
candidate pager, such that you will pass up the opportunity to use ToTerm
rather than use a different pager.

When you are depending on -R, you also need to actually pass -R to the
pager, which you&#39;re not reliably doing.  You haven&#39;t changed the logic
for this, which sets $ENV{LESS} if it wasn&#39;t set but doesn&#39;t do anything
to pass -R if $ENV{LESS} was set.  If you&#39;re parsing shell code in pager
settings, it&#39;s probably best to add -R there and leave the environment
untouched.

To make ToTerm acceptable, you need to also check that the terminal is of
a type that accepts the ANSI escape sequences.  The existing logic will
avoid trying ToTerm if $ENV{TERM} has certain values indicating the lack
of cursor addressability, but that&#39;s not sufficient, in two respects.
Firstly, an addressable cursor does not in the slightest imply the
use of ANSI escape sequences.  And secondly, the check needs to be the
opposite way round, because the consequences of sending unrecognised
escape sequences are much worse than the consequences of trying to page
on a dumb terminal.  So you need to check that $ENV{TERM} is set to a
type that you specifically know accepts these sequences.  The default
behaviour, for a terminal type that is not specifically recognised,
has to be to conservatively not send the dubious sequences.

-zefram
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;01&nbsp;08:16:22&nbsp;2017</span>
    <span class="description">XSAWYERX [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Nov 30 15:40:55 2017, zefram@fysh.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sawyer X via RT wrote:
<div class="message-stanza open">&gt; &gt;Here is my pull request: <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/mrallen1/Pod-Perldoc/pull/36">https://github.com/mrallen1/Pod-Perldoc/pull/36</a></span>.
</div>&gt; 
&gt; Your detection of less&#40;1&#41; in the pager list is dubious.  You use a
&gt; substring search for the character sequence &#34;less&#34;, but that may be
&gt; misleading because it could appear as substring in a $ENV{PAGER} that
&gt; is for a different pager.
</div>
I agree. I thought about this and eventually stole it from the detection for adding &#34;-R&#34; to the pager. I figured it would at least be as consistent as it is now, despite being inaccurate.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; The use of `$less_bin --version` is dubious, because, per
&gt; -&gt;pagers_guessing, $less_bin may contain shell redirection characters,
&gt; such that &#34;--version&#34; wouldn&#39;t necessarily function as a command-line
&gt; argument to less&#40;1&#41;.  You may need to parse pager strings in more detail.
</div>
Good point. I&#39;ll improve this by finding the execution file and then calling only that with &#34;--version&#34;, which would remove any redirection characters which might have appeared.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; The version check on less&#40;1&#41; involves a regexp copied from the groff
&gt; version check, which will never match actual &#34;less --version&#34; output.
</div>
Whoops! Fixed and PR was updated.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Where the acceptability of the formatter depends on a sufficiently
&gt; recent less&#40;1&#41;, you need to ensure that that is the pager actually
&gt; used, which you are not doing.  All you are doing is detecting that a
&gt; sufficiently recent less&#40;1&#41; is somewhere in the list of candidate pagers.
&gt; You probably want to filter the pager list to contain only acceptable
&gt; versions of less&#40;1&#41;.
</div>
Makes sense. That part was evidently fragile since all I did was check whether one of the possible pagers available is less. I couldn&#39;t tell if it would be used. The code then tries each one indepdendently hoping it will work &#40;literallly checking the result of &#34;system&#40;&#41;&#34;&#41; so it&#39;s unassured which are available or will work. Reducing it to &#34;which are available&#34; and then to the first one being &#34;less&#34; makes more sense.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; However, where the first pager setting comes from
&gt; $ENV{PAGER} or $ENV{PERLDOC_PAGER} it would be rude to dishonour that.
&gt; An environmental pager setting, where supplied, should be the only
&gt; candidate pager, such that you will pass up the opportunity to use ToTerm
&gt; rather than use a different pager.
</div>
It is possible to simply let those values override my inspection of possible pagers. Instead it currenly only adds it as an optional pager candidate. I think the reason is that a user might have an environment configured for a certain pager by the operating system which doesn&#39;t actually exist or is installed.

I am in the opinion that, if you explicitly want something, that&#39;s what you should get &#40;even if you didn&#39;t personally explicitly stated, but some other configuration did&#41; and that, if that fails, you should be notified.

In other words, if Debian automatically set my EDITOR to vim but I don&#39;t have vim installed, I would like to know about instead of whatever used the EDITOR configuration would silently just try something else and open a different editor.

If we both agree on this, I can change the guessing function to explicitly override whatever pager is avaiable by those configurations and then, as a secondary measaure, try to reduce the list to existing pagers, and if the first one is less, continue with the logic.

Does that make sense?


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; When you are depending on -R, you also need to actually pass -R to the
&gt; pager, which you&#39;re not reliably doing.  You haven&#39;t changed the logic
&gt; for this, which sets $ENV{LESS} if it wasn&#39;t set but doesn&#39;t do anything
&gt; to pass -R if $ENV{LESS} was set.  If you&#39;re parsing shell code in pager
&gt; settings, it&#39;s probably best to add -R there and leave the environment
&gt; untouched.
</div>
I had left it as is since ToTerm sets it in its own formatter. I can move this out of the way, but this would make it a particular ToTerm change that appears outside it. Although, your suggestioon would be safer since it would be parsing the pager string and make sure it&#39;s in the right place. Not sure which is best.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; To make ToTerm acceptable, you need to also check that the terminal is of
&gt; a type that accepts the ANSI escape sequences.  The existing logic will
&gt; avoid trying ToTerm if $ENV{TERM} has certain values indicating the lack
&gt; of cursor addressability, but that&#39;s not sufficient, in two respects.
&gt; Firstly, an addressable cursor does not in the slightest imply the
&gt; use of ANSI escape sequences.  And secondly, the check needs to be the
&gt; opposite way round, because the consequences of sending unrecognised
&gt; escape sequences are much worse than the consequences of trying to page
&gt; on a dumb terminal.  So you need to check that $ENV{TERM} is set to a
&gt; type that you specifically know accepts these sequences.  The default
&gt; behaviour, for a terminal type that is not specifically recognised,
&gt; has to be to conservatively not send the dubious sequences.
</div>
So we would have to both make sure that we have less that can understand escape codes as escape codes and to know that the terminal supports them and can display them properly.

For the first we have a solution, for the latter we will need to create a list of known terminals that support escape codes and check ENV{TERM} for them. If we do not know your terminal, we cannot be sure it supports escape codes, and thus move to ToText as a fallback.

If so, this means the logic is:

* If you have an old version of groff
* And your less is old, or
* Your terminal is unknown &#40;meaning it&#39;s implicitly known to not support escape codes&#41;, then:
-&gt; You get ToText.

* If you have an old version of groff
* And your less is new enough
* And we know your terminal &#40;and implicitly know it to support escape codes&#41;, then:
-&gt; You get ToTerm.

* If you have a new enough version of groff, then:
-&gt; You get ToMan

Did I understand it correctly?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;01&nbsp;08:56:39&nbsp;2017</span>
    <span class="description">zefram [...] fysh.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> xsawyerx [...] gmail.com</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #120229] perldoc rudely interferes with pager configuration</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 1 Dec 2017 13:56:20 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Sawyer X via RT &lt;bug-Pod-Perldoc [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Zefram &lt;zefram [...] fysh.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sawyer X via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;I agree. I thought about this and eventually stole it from the detection
&gt;for adding &#34;-R&#34; to the pager.
</div>
That logic &#40;in its current form&#41; has rather different requirements.
It&#39;s not adding &#34;-R&#34; to the command line, but to $ENV{LESS}, so a false
positive doesn&#39;t matter there.  A pager other than less&#40;1&#41; will just
ignore the environment variable.  But a false positive is a big problem
for the new logic.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;Does that make sense?
</div>
Yes.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;I had left it as is since ToTerm sets it in its own formatter.
</div>
ToTerm is doing a bad job.  It&#39;s not strictly necessary to remove its
inadequate &#34;-R&#34; logic to replace with the correct stuff, but it *is*
necessary to implement correct &#34;-R&#34; addition.  The existing crap logic
would be superfluous but harmless if it remained.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;So we would have to both make sure that we have less that can understand
&gt;escape codes as escape codes and to know that the terminal supports them
&gt;and can display them properly.
</div>
Yes.  This is a rather strange requirement, but comes from the strange
behaviour of the -R option.  less&#40;1&#41; isn&#39;t interpreting the escape codes
itself and then rendering a fancy text image to the actual terminal,
which is what it does with backspace overstriking and which it could
readily do for escape sequences.  Instead it only understands how the
escape sequences work syntactically, and passes the escape sequences
through to the terminal without any knowledge of how the terminal will
interpret them.  So the burden is rather unpleasantly placed on the user
to ensure that the terminal is suitable before supplying &#34;-R&#34; to less&#40;1&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;Did I understand it correctly?
</div>
Yes.

-zefram
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
