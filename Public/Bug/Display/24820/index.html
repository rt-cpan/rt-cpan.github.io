<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #24820 for Pod-Simple: Pod encoding, unicode issues</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #24820 for Pod-Simple: Pod encoding, unicode issues</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Pod-Simple/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Pod-Simple/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Pod-Simple/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Pod-Simple/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/perl-pod/pod-simple/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Pod-Simple">Pod-Simple CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">24820</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">stalled</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Pod-Simple/Active/">Pod-Simple</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
cpan [...] tty.nl

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-26176-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-26177-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;06&nbsp;09:42:48&nbsp;2007</span>
    <span class="description">cpan [...] tty.nl -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Pod encoding, unicode issues</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">To get Pod working on my Perl7 branch, I discovered some problems with
it. The patch does the following things:

* It did not specify that the default file encoding is latin1. How could
  it have worked on EBCDIC platforms? This required that changing the
  encoding in the midlde of a file should be allow.

* It used the directive &#39;=encode utf8&#39; instead of &#39;=encoding utf8&#39; when
  an UTF-8 BOM was encountered.

* To test the above I have extended man.t to make a UTF-8 encoded file
  with an UTF-8 BOM, and verify that it produces the same result.

* When Unicode is enabled \s also matches \xA0 &#40;non-breaking space&#41;,
  breaking text-wrapping. I replaces some \s with [ \t], which appears
  to make things work. I am not sure this is the best way to fix it and
  all \s should be replaced, or some \s really should match all
  spaces. There is at least one \s which should be replaced, see
fullstop_spaces.t

The patch is against the current bleadperl and might not directly patch
the CPAN module.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Pod.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/lib/Pod/Escapes.pm b/lib/Pod/Escapes.pm
index de4d75a..c980eb8 100644
--- a/lib/Pod/Escapes.pm
+++ b/lib/Pod/Escapes.pm
@@ -31,6 +31,8 @@ use vars qw&#40;
   $NOT_ASCII
 &#41;;
 
+use utf8;
+
 $FAR_CHAR = &#34;?&#34; unless defined $FAR_CHAR;
 $FAR_CHAR_NUMBER = ord&#40;$FAR_CHAR&#41; unless defined $FAR_CHAR_NUMBER;
 
diff --git a/lib/Pod/Escapes/t/10_main.t b/lib/Pod/Escapes/t/10_main.t
index b42205c..145cfc4 100644
--- a/lib/Pod/Escapes/t/10_main.t
+++ b/lib/Pod/Escapes/t/10_main.t
@@ -9,6 +9,7 @@ BEGIN {
 
 use strict;
 use Test;
+use utf8;
 
 my @them;
 BEGIN { plan&#40;&#39;tests&#39; =&gt; 63&#41; };
diff --git a/lib/Pod/Html.pm b/lib/Pod/Html.pm
index 8c999cc..ade5735 100644
--- a/lib/Pod/Html.pm
+++ b/lib/Pod/Html.pm
@@ -15,7 +15,7 @@ use File::Spec;
 use File::Spec::Unix;
 use Getopt::Long;
 
-use locale;	# make \w work right in non-ASCII lands
+#use utf8;	# variable length lookbehind &#34;&#40;?&lt;=\s&#34; is not yet supported
 
 =head1 NAME
 
diff --git a/lib/Pod/Man.pm b/lib/Pod/Man.pm
index 077bd7b..4c8c2f4 100644
--- a/lib/Pod/Man.pm
+++ b/lib/Pod/Man.pm
@@ -28,6 +28,7 @@ package Pod::Man;
 require 5.005;
 
 use strict;
+use utf8;
 use subs qw&#40;makespace&#41;;
 use vars qw&#40;@ISA %ESCAPES $PREAMBLE $VERSION&#41;;
 
diff --git a/lib/Pod/Simple.pm b/lib/Pod/Simple.pm
index fa85488..8691951 100644
--- a/lib/Pod/Simple.pm
+++ b/lib/Pod/Simple.pm
@@ -8,7 +8,7 @@ use integer;
 use Pod::Escapes 1.03 &#40;&#41;;
 use Pod::Simple::LinkSection &#40;&#41;;
 use Pod::Simple::BlackBox &#40;&#41;;
-#use utf8;
+use utf8;
 
 use vars qw&#40;
   $VERSION @ISA
@@ -1373,7 +1373,7 @@ sub _change_S_to_nbsp { #  a recursive function
         $i +=  @$to_pull_up - 1;   # Make $i skip the pulled-up stuff
       }
     } else {
-      $treelet-&gt;[$i] =~ s/\s/\xA0/g if ASCII and $in_s;
+      $treelet-&gt;[$i] =~ s/\s/\x{A0}/g if ASCII and $in_s;
        # &#40;If not in ASCIIland, we can&#39;t assume that \xA0 == nbsp.&#41;
        
        # Note that if you apply nbsp_for_S to text, and so turn
@@ -1514,7 +1514,5 @@ under-E&lt;32&gt; E codes are found in the tree. And ditto \x7f-\x9f
 Option to turn highbit characters into their compromised form? &#40;applies
 to E parsing too&#41;
 
-TODO: BOM/encoding things.
-
 TODO: ascii-compat things in the XML classes?
 
diff --git a/lib/Pod/Simple/BlackBox.pm b/lib/Pod/Simple/BlackBox.pm
index 6d7fdba..4494bd9 100644
--- a/lib/Pod/Simple/BlackBox.pm
+++ b/lib/Pod/Simple/BlackBox.pm
@@ -85,8 +85,8 @@ sub parse_lines {             # Usage: $parser-&gt;parse_lines&#40;@lines&#41;
       DEBUG &gt; 2 and print &#34;First line: [$source_line]\n&#34;;
 
       if&#40; &#40;$line = $source_line&#41; =~ s/^\xEF\xBB\xBF//s &#41; {
-        DEBUG and print &#34;UTF-8 BOM seen.  Faking a &#39;=encode utf8&#39;.\n&#34;;
-        $self-&gt;_handle_encoding_line&#40; &#34;=encode utf8&#34; &#41;;
+        DEBUG and print &#34;UTF-8 BOM seen.  Faking a &#39;=encoding utf8&#39;.\n&#34;;
+        $self-&gt;_handle_encoding_line&#40; &#34;=encoding utf8&#34; &#41;;
         $line =~ tr/\n\r//d;
         
       } elsif&#40; $line =~ s/^\xFE\xFF//s &#41; {
@@ -114,7 +114,8 @@ sub parse_lines {             # Usage: $parser-&gt;parse_lines&#40;@lines&#41;
         # TODO: implement somehow?
         
       } else {
-        DEBUG &gt; 2 and print &#34;First line is BOM-less.\n&#34;;
+        DEBUG &gt; 2 and print &#34;First line is BOM-less.  Faking a &#39;=encoding latin1&#39;.\n&#34;;
+        $self-&gt;_handle_encoding_line&#40; &#34;=encoding latin1&#34; &#41;;
         &#40;$line = $source_line&#41; =~ tr/\n\r//d;
       }
     }
@@ -275,23 +276,7 @@ sub _handle_encoding_line {
 
   require Pod::Simple::Transcode;
 
-  if&#40; $self-&gt;{&#39;encoding&#39;} &#41; {
-    my $norm_current = $self-&gt;{&#39;encoding&#39;};
-    my $norm_e = $e;
-    foreach my $that &#40;$norm_current, $norm_e&#41; {
-      $that =  lc&#40;$that&#41;;
-      $that =~ s/[-_]//g;
-    }
-    if&#40;$norm_current eq $norm_e&#41; {
-      DEBUG &gt; 1 and print &#34;The &#39;=encoding $orig&#39; line is &#34;,
-       &#34;redundant.  &#40;$norm_current eq $norm_e&#41;.  Ignoring.\n&#34;;
-      $enc_error = &#39;&#39;;
-       # But that doesn&#39;t necessarily mean that the earlier one went okay
-    } else {
-      $enc_error = &#34;Encoding is already set to &#34; . $self-&gt;{&#39;encoding&#39;};
-      DEBUG &gt; 1 and print $enc_error;
-    }
-  } elsif &#40;
+  if &#40;
     # OK, let&#39;s turn on the encoding
     do {
       DEBUG &gt; 1 and print &#34; Setting encoding to $e\n&#34;;
@@ -301,11 +286,10 @@ sub _handle_encoding_line {
     and $e eq &#39;HACKRAW&#39;
   &#41; {
     DEBUG and print &#34; Putting in HACKRAW &#40;no-op&#41; encoding mode.\n&#34;;
+    $self-&gt;{&#39;_transcoder&#39;} = undef;
 
   } elsif&#40; Pod::Simple::Transcode::-&gt;encoding_is_available&#40;$e&#41; &#41; {
 
-    die&#40;$enc_error = &#34;WHAT? _transcoder is already set?!&#34;&#41;
-     if $self-&gt;{&#39;_transcoder&#39;};   # should never happen
     require Pod::Simple::Transcode;
     $self-&gt;{&#39;_transcoder&#39;} = Pod::Simple::Transcode::-&gt;make_transcoder&#40;$e&#41;;
     eval {
@@ -1885,12 +1869,10 @@ sub pretty { # adopted from Class::Classless
     } else {
       if&#40; chr&#40;65&#41; eq &#39;A&#39; &#41; {
         s&lt;&#40;[^\x20\x21\x23\x27-\x3F\x41-\x5B\x5D-\x7E]&#41;&gt;
-         #&lt;$pretty_form{$1} || &#39;\\x&#39;.&#40;unpack&#40;&#34;H2&#34;,$1&#41;&#41;&gt;eg;
          &lt;$pretty_form{$1} || &#39;\\x{&#39;.sprintf&#40;&#34;%x&#34;, ord&#40;$1&#41;&#41;.&#39;}&#39;&gt;eg;
       } else {
         # We&#39;re in some crazy non-ASCII world!
         s&lt;&#40;[^abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789]&#41;&gt;
-         #&lt;$pretty_form{$1} || &#39;\\x&#39;.&#40;unpack&#40;&#34;H2&#34;,$1&#41;&#41;&gt;eg;
          &lt;$pretty_form{$1} || &#39;\\x{&#39;.sprintf&#40;&#34;%x&#34;, ord&#40;$1&#41;&#41;.&#39;}&#39;&gt;eg;
       }
       qq{&#34;$_&#34;};
diff --git a/lib/Pod/Simple/t/corpus/fet_contradiction.xml b/lib/Pod/Simple/t/corpus/fet_contradiction.xml
index 4f4995f..332195b 100644
--- a/lib/Pod/Simple/t/corpus/fet_contradiction.xml
+++ b/lib/Pod/Simple/t/corpus/fet_contradiction.xml
@@ -15,28 +15,10 @@
     &#40;This is a test Pod pocument in KOI8-R.&#41;
   &lt;/Para&gt;
   &lt;Para start_line=&#34;17&#34;&gt;
-    15 &#38;#1092;&#38;#1077;&#38;#1074;&#38;#1088;&#38;#1072;&#38;#1083;&#38;#1103; 1887
+    15 &#38;#65414;&#38;#65413;&#38;#65431;&#38;#65426;&#38;#65409;&#38;#65420;&#38;#65425;
+    1887
   &lt;/Para&gt;
   &lt;Para start_line=&#34;19&#34;&gt;
     [end]
   &lt;/Para&gt;
-  &lt;head1 errata=&#34;1&#34; start_line=&#34;-321&#34;&gt;
-    POD ERRORS
-  &lt;/head1&gt;
-  &lt;Para errata=&#34;1&#34; start_line=&#34;-321&#34;&gt;
-    Hey! 
-    &lt;B&gt;
-      The above document had some coding errors, which are explained
-      below:
-    &lt;/B&gt;
-  &lt;/Para&gt;
-  &lt;over-text errata=&#34;1&#34; indent=&#34;4&#34; start_line=&#34;-321&#34;&gt;
-    &lt;item-text start_line=&#34;-321&#34;&gt;
-      Around line 13:
-    &lt;/item-text&gt;
-    &lt;Para start_line=&#34;-321&#34;&gt;
-      Couldn&#38;#39;t do =encoding Shift-JIS: Encoding is already
-      set to koi8-r
-    &lt;/Para&gt;
-  &lt;/over-text&gt;
 &lt;/Document&gt;
diff --git a/lib/Pod/Text.pm b/lib/Pod/Text.pm
index 03a62bf..d0ce949 100644
--- a/lib/Pod/Text.pm
+++ b/lib/Pod/Text.pm
@@ -27,6 +27,7 @@ package Pod::Text;
 require 5.004;
 
 use strict;
+use utf8;
 use vars qw&#40;@ISA @EXPORT %ESCAPES $VERSION&#41;;
 
 use Carp qw&#40;carp croak&#41;;
@@ -212,7 +213,7 @@ sub wrap {
     my $spaces = &#39; &#39; x $$self{MARGIN};
     my $width = $$self{opt_width} - $$self{MARGIN};
     while &#40;length &gt; $width&#41; {
-        if &#40;s/^&#40;[^\n]{0,$width}&#41;\s+// || s/^&#40;[^\n]{$width}&#41;//&#41; {
+        if &#40;s/^&#40;[^\n]{0,$width}&#41;[ \t]+// || s/^&#40;[^\n]{$width}&#41;//&#41; {
             $output .= $spaces . $1 . &#34;\n&#34;;
         } else {
             last;
@@ -237,7 +238,7 @@ sub reformat {
         s/\n/ /g;
         s/   +/  /g;
     } else {
-        s/\s+/ /g;
+        s/[\ \t\r\n\f]+/ /g;
     }
     return $self-&gt;wrap &#40;$_&#41;;
 }
@@ -245,7 +246,8 @@ sub reformat {
 # Output text to the output device.
 sub output {
     my &#40;$self, $text&#41; = @_;
-    $text =~ tr/\240\255/ /d;
+    $text =~ s/\x{a0}/ /g; # non-breaking space
+    $text =~ s/\x{ad}//g; # soft hyphen
     print { $$self{output_fh} } $text;
 }
 
diff --git a/lib/Pod/Text/Color.pm b/lib/Pod/Text/Color.pm
index ce95dbe..215fa72 100644
--- a/lib/Pod/Text/Color.pm
+++ b/lib/Pod/Text/Color.pm
@@ -23,6 +23,7 @@ use Term::ANSIColor qw&#40;colored&#41;;
 
 use strict;
 use vars qw&#40;@ISA $VERSION&#41;;
+use utf8;
 
 @ISA = qw&#40;Pod::Text&#41;;
 
@@ -76,7 +77,7 @@ sub wrap {
     my $shortchar = $char . &#34;{0,$width}&#34;;
     my $longchar = $char . &#34;{$width}&#34;;
     while &#40;length &gt; $width&#41; {
-        if &#40;s/^&#40;$shortchar&#41;\s+// || s/^&#40;$longchar&#41;//&#41; {
+        if &#40;s/^&#40;$shortchar&#41;[\ \t]+// || s/^&#40;$longchar&#41;//&#41; {
             $output .= $spaces . $1 . &#34;\n&#34;;
         } else {
             last;
diff --git a/lib/Pod/Text/Overstrike.pm b/lib/Pod/Text/Overstrike.pm
index 4ec2fc0..2a409a9 100644
--- a/lib/Pod/Text/Overstrike.pm
+++ b/lib/Pod/Text/Overstrike.pm
@@ -30,6 +30,7 @@ use Pod::Text &#40;&#41;;
 
 use strict;
 use vars qw&#40;@ISA $VERSION&#41;;
+use utf8;
 
 @ISA = qw&#40;Pod::Text&#41;;
 
@@ -115,7 +116,7 @@ sub wrap {
         # backspace, and a character&#41;.  Use [^\n] rather than . to protect
         # against odd settings of $*.
         my $char = &#39;&#40;?:[^\n][\b]&#41;?[^\n]&#39;;
-        if &#40;s/^&#40;&#40;?&gt;$char&#41;{0,$width}&#41;&#40;?:\Z|\s+&#41;//&#41; {
+        if &#40;s/^&#40;&#40;?&gt;$char&#41;{0,$width}&#41;&#40;?:\Z|[\ \t]+&#41;//&#41; {
             $output .= $spaces . $1 . &#34;\n&#34;;
         } else {
             last;
diff --git a/lib/Pod/Text/Termcap.pm b/lib/Pod/Text/Termcap.pm
index 0b3caf3..b40aceb 100644
--- a/lib/Pod/Text/Termcap.pm
+++ b/lib/Pod/Text/Termcap.pm
@@ -24,6 +24,7 @@ use Term::Cap;
 
 use strict;
 use vars qw&#40;@ISA $VERSION&#41;;
+use utf8;
 
 @ISA = qw&#40;Pod::Text&#41;;
 
@@ -114,7 +115,7 @@ sub wrap {
     my $shortchar = $char . &#34;{0,$width}&#34;;
     my $longchar = $char . &#34;{$width}&#34;;
     while &#40;length &gt; $width&#41; {
-        if &#40;s/^&#40;$shortchar&#41;\s+// || s/^&#40;$longchar&#41;//&#41; {
+        if &#40;s/^&#40;$shortchar&#41;[\ \t]+// || s/^&#40;$longchar&#41;//&#41; {
             $output .= $spaces . $1 . &#34;\n&#34;;
         } else {
             last;
diff --git a/lib/Pod/t/man.t b/lib/Pod/t/man.t
index e09f8de..f7ef9cb 100644
--- a/lib/Pod/t/man.t
+++ b/lib/Pod/t/man.t
@@ -17,7 +17,7 @@ BEGIN {
     }
     unshift &#40;@INC, &#39;../blib/lib&#39;&#41;;
     $| = 1;
-    print &#34;1..21\n&#34;;
+    print &#34;1..41\n&#34;;
 }
 
 END {
@@ -25,6 +25,8 @@ END {
 }
 
 use Pod::Man;
+use Encode;
+use charnames &#39;:full&#39;;
 
 $loaded = 1;
 print &#34;ok 1\n&#34;;
@@ -33,19 +35,42 @@ my $parser = Pod::Man-&gt;new or die &#34;Cannot create parser\n&#34;;
 my $n = 2;
 while &#40;&lt;DATA&gt;&#41; {
     next until $_ eq &#34;###\n&#34;;
+
+    my $input = &#34;&#34;;
+    while &#40;&lt;DATA&gt;&#41; {
+        $_ = Encode::decode&#40;&#39;iso-8859-1&#39;, $_&#41;; # DATA is ISO 8859-e encoded
+        last if $_ eq &#34;###\n&#34;;
+        $input .= $_;
+    }
+    my $expected = &#39;&#39;;
+    while &#40;&lt;DATA&gt;&#41; {
+        last if $_ eq &#34;###\n&#34;;
+        $expected .= $_;
+    }
+
     open &#40;TMP, &#39;&gt; tmp.pod&#39;&#41; or die &#34;Cannot create tmp.pod: $!\n&#34;;
 
     # We have a test in ISO 8859-1 encoding.  Make sure that nothing strange
     # happens if Perl thinks the world is Unicode.  Wrap this in eval so that
     # older versions of Perl don&#39;t croak.
     eval { binmode &#40;\*TMP, &#39;:encoding&#40;iso-8859-1&#41;&#39;&#41; };
+    no warnings &#39;utf8&#39;;
+    print TMP $input;
 
-    while &#40;&lt;DATA&gt;&#41; {
-        last if $_ eq &#34;###\n&#34;;
-        no warnings &#39;utf8&#39;;
-        print TMP $_;
-    }
     close TMP;
+
+    test_outtmp&#40;$expected&#41;;
+
+    open &#40;TMP2, &#39;&gt; tmp.pod&#39;&#41; or die &#34;Cannot create tmp.pod: $!\n&#34;;
+    eval { binmode &#40;\*TMP2, &#39;:encoding&#40;utf-8&#41;&#39;&#41; };
+    print TMP2 &#34;\N{BOM}&#34;;
+    print TMP2 $input;
+    close TMP2;
+    test_outtmp&#40;$expected&#41;;
+}
+
+sub test_outtmp {
+    my $expected = shift;
     open &#40;OUT, &#39;&gt; out.tmp&#39;&#41; or die &#34;Cannot create out.tmp: $!\n&#34;;
     $parser-&gt;parse_from_file &#40;&#39;tmp.pod&#39;, \*OUT&#41;;
     close OUT;
@@ -58,11 +83,6 @@ while &#40;&lt;DATA&gt;&#41; {
     }
     close OUT;
     unlink &#40;&#39;tmp.pod&#39;, &#39;out.tmp&#39;&#41;;
-    my $expected = &#39;&#39;;
-    while &#40;&lt;DATA&gt;&#41; {
-        last if $_ eq &#34;###\n&#34;;
-        $expected .= $_;
-    }
     if &#40;$output eq $expected&#41; {
         print &#34;ok $n\n&#34;;
     } else {
@@ -148,8 +168,6 @@ Also not a bullet.
 ###
 
 ###
-=encoding iso-8859-1
-
 =head1 ACCENTS
 
 Beyoncé!  Beyoncé!  Beyoncé!!
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;03&nbsp;11:53:38&nbsp;2007</span>
    <span class="description">ARANDAL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">How can I evaluate a patch designed to fix your own custom branch of Perl?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;03&nbsp;11:53:38&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;07&nbsp;06:34:37&nbsp;2007</span>
    <span class="description">cpan [...] tty.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> cpan [...] tty.nl</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Mar 03 11:53:38 2007, ARANDAL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; How can I evaluate a patch designed to fix your own custom branch of Perl?
</div>
The patch is NOT against my custom branch, it is against bleadperl.
The bugs it fixes have nothing to do with my branch, I just found them
using my own branch because it defaults to Unicode matching.
I have attached a new patch, againt the current bleadperl &#40;30490&#41;,
because the previous might have had some merge problems. The attached
patch works perfect against bleadperl. And all tests succeed.
A more descriptive about the patch:

the &#39;man.t&#39; test is extended to test if the input is encoded using UTF-8
with an initial UTF-8 BOM, the output is the same as the output of the
latin1 encoded input.

The above test show the following problems:
- misspelled &#39;=encode utf8&#39; instead of &#39;=encoding utf8&#39;
- \s matches much more when a string has an UTF8 flag, including the
non-breaking space. I decided to not use \s, but instead of [ \t\n\r\f].
This means that some asian whitespaces are preserved instead of replaced
with a space, in my option this would be an improvement.

Things that are not necessary, but shouldn&#39;t hurt anybody:
- adding a fake &#39;=encoding latin1&#39; whent there is no BOM. I think it
should be required for EBCDIC. But I also like being explicit that the
encoding is latin1, in case the default changes &#40;like in my branch&#41;.
- removal of indirect-object-syntax
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;26&nbsp;15:20:32&nbsp;2009</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi TTY,

Looks like your patch updates some files that have nothing to do with Pod::Simple &#40;Pod::Man, 
Pod::Text, etc.&#41;. These may be core modules that use Pod::Simple, but are not included in the 
Pod::Simple distribution. Would it be possible for you to extract just the Pod::Simple-related 
changes and re-submit them? It might be easiest to do so against the Subversion repository:

     <span class="clickylink"><a target="new" rel="nofollow" href="http://onyxneon.svnrepository.com/svn/nam/trunk/perl5/modules/Pod/Simple">http://onyxneon.svnrepository.com/svn/nam/trunk/perl5/modules/Pod/Simple</a></span>

Email allison@perl.org to request a readonly password.

—Theory
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;26&nbsp;15:22:28&nbsp;2009</span>
    <span class="description">ARANDAL [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;12&nbsp;15:12:16&nbsp;2010</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Oct 26 15:20:32 2009, DWHEELER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi TTY,
&gt; 
&gt; Looks like your patch updates some files that have nothing to do with
&gt; Pod::Simple &#40;Pod::Man,
&gt; Pod::Text, etc.&#41;. These may be core modules that use Pod::Simple, but
&gt; are not included in the
&gt; Pod::Simple distribution. Would it be possible for you to extract just
&gt; the Pod::Simple-related
&gt; changes and re-submit them? It might be easiest to do so against the
&gt; Subversion repository:
&gt; 
&gt;      <span class="clickylink"><a target="new" rel="nofollow" href="http://onyxneon.svnrepository.com/svn/nam/trunk/perl5/modules/Pod/Simple">http://onyxneon.svnrepository.com/svn/nam/trunk/perl5/modules/Pod/Simple</a></span>
&gt; 
&gt; Email allison@perl.org to request a readonly password.
&gt; 
&gt; —Theory
</div>
Ping!

BTW, new repository:

<span class="clickylink"><a target="new" rel="nofollow" href="http://github.com/theory/pod-simple/">http://github.com/theory/pod-simple/</a></span>

Thanks,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;12&nbsp;15:12:17&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;21&nbsp;20:40:28&nbsp;2011</span>
    <span class="description">dwheeler [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;28&nbsp;18:04:57&nbsp;2011</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here&#39;s a new patch, with just the Pod::Simple stuff pulled out and all the tests passing. I&#39;m going 
to see what I can extract from this. That is, what I can understand. I agree that `=encode` is a 
mis-spelling. But I don&#39;t at all understand what the code you&#39;ve removed further down, under 
`require Pod::Simple::Transcode`, is supposed to do, or why you&#39;ve removed it. I also don&#39;t 
understand the corpus changes. Can you say a bit more about the reason for these changes?

Thanks,

David
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> podsimple.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/lib/Pod/Simple/BlackBox.pm b/lib/Pod/Simple/BlackBox.pm
index d90ea79..d8410be 100644
--- a/lib/Pod/Simple/BlackBox.pm
+++ b/lib/Pod/Simple/BlackBox.pm
@@ -88,8 +88,8 @@ sub parse_lines {             # Usage: $parser-&gt;parse_lines&#40;@lines&#41;
       DEBUG &gt; 2 and print &#34;First line: [$source_line]\n&#34;;
 
       if&#40; &#40;$line = $source_line&#41; =~ s/^\xEF\xBB\xBF//s &#41; {
-        DEBUG and print &#34;UTF-8 BOM seen.  Faking a &#39;=encode utf8&#39;.\n&#34;;
-        $self-&gt;_handle_encoding_line&#40; &#34;=encode utf8&#34; &#41;;
+        DEBUG and print &#34;UTF-8 BOM seen.  Faking a &#39;=encoding utf8&#39;.\n&#34;;
+        $self-&gt;_handle_encoding_line&#40; &#34;=encoding utf8&#34; &#41;;
         $line =~ tr/\n\r//d;
         
       } elsif&#40; $line =~ s/^\xFE\xFF//s &#41; {
@@ -117,7 +117,8 @@ sub parse_lines {             # Usage: $parser-&gt;parse_lines&#40;@lines&#41;
         # TODO: implement somehow?
         
       } else {
-        DEBUG &gt; 2 and print &#34;First line is BOM-less.\n&#34;;
+        DEBUG &gt; 2 and print &#34;First line is BOM-less.  Faking a &#39;=encoding latin1&#39;.\n&#34;;
+        $self-&gt;_handle_encoding_line&#40; &#34;=encoding latin1&#34; &#41;;
         &#40;$line = $source_line&#41; =~ tr/\n\r//d;
       }
     }
@@ -278,23 +279,7 @@ sub _handle_encoding_line {
 
   require Pod::Simple::Transcode;
 
-  if&#40; $self-&gt;{&#39;encoding&#39;} &#41; {
-    my $norm_current = $self-&gt;{&#39;encoding&#39;};
-    my $norm_e = $e;
-    foreach my $that &#40;$norm_current, $norm_e&#41; {
-      $that =  lc&#40;$that&#41;;
-      $that =~ s/[-_]//g;
-    }
-    if&#40;$norm_current eq $norm_e&#41; {
-      DEBUG &gt; 1 and print &#34;The &#39;=encoding $orig&#39; line is &#34;,
-       &#34;redundant.  &#40;$norm_current eq $norm_e&#41;.  Ignoring.\n&#34;;
-      $enc_error = &#39;&#39;;
-       # But that doesn&#39;t necessarily mean that the earlier one went okay
-    } else {
-      $enc_error = &#34;Encoding is already set to &#34; . $self-&gt;{&#39;encoding&#39;};
-      DEBUG &gt; 1 and print $enc_error;
-    }
-  } elsif &#40;
+  if &#40;
     # OK, let&#39;s turn on the encoding
     do {
       DEBUG &gt; 1 and print &#34; Setting encoding to $e\n&#34;;
@@ -304,11 +289,10 @@ sub _handle_encoding_line {
     and $e eq &#39;HACKRAW&#39;
   &#41; {
     DEBUG and print &#34; Putting in HACKRAW &#40;no-op&#41; encoding mode.\n&#34;;
+    $self-&gt;{&#39;_transcoder&#39;} = undef;
 
   } elsif&#40; Pod::Simple::Transcode::-&gt;encoding_is_available&#40;$e&#41; &#41; {
 
-    die&#40;$enc_error = &#34;WHAT? _transcoder is already set?!&#34;&#41;
-     if $self-&gt;{&#39;_transcoder&#39;};   # should never happen
     require Pod::Simple::Transcode;
     $self-&gt;{&#39;_transcoder&#39;} = Pod::Simple::Transcode::-&gt;make_transcoder&#40;$e&#41;;
     eval {
@@ -1628,7 +1612,7 @@ sub _treelet_from_formatting_codes {
   my $treelet = [&#39;~Top&#39;, {&#39;start_line&#39; =&gt; $start_line},];
   
   unless &#40;$preserve_space || $self-&gt;{&#39;preserve_whitespace&#39;}&#41; {
-    $para =~ s/\s+/ /g; # collapse and trim all whitespace first.
+    $para =~ s/[ \t\n\r\f]+/ /g; # collapse and trim all whitespace first.
     $para =~ s/ $//;
     $para =~ s/^ //;
   }
diff --git a/t/corpus/fet_cont.xml b/t/corpus/fet_cont.xml
index 4f4995f..332195b 100644
--- a/t/corpus/fet_cont.xml
+++ b/t/corpus/fet_cont.xml
@@ -15,28 +15,10 @@
     &#40;This is a test Pod pocument in KOI8-R.&#41;
   &lt;/Para&gt;
   &lt;Para start_line=&#34;17&#34;&gt;
-    15 &#38;#1092;&#38;#1077;&#38;#1074;&#38;#1088;&#38;#1072;&#38;#1083;&#38;#1103; 1887
+    15 &#38;#65414;&#38;#65413;&#38;#65431;&#38;#65426;&#38;#65409;&#38;#65420;&#38;#65425;
+    1887
   &lt;/Para&gt;
   &lt;Para start_line=&#34;19&#34;&gt;
     [end]
   &lt;/Para&gt;
-  &lt;head1 errata=&#34;1&#34; start_line=&#34;-321&#34;&gt;
-    POD ERRORS
-  &lt;/head1&gt;
-  &lt;Para errata=&#34;1&#34; start_line=&#34;-321&#34;&gt;
-    Hey! 
-    &lt;B&gt;
-      The above document had some coding errors, which are explained
-      below:
-    &lt;/B&gt;
-  &lt;/Para&gt;
-  &lt;over-text errata=&#34;1&#34; indent=&#34;4&#34; start_line=&#34;-321&#34;&gt;
-    &lt;item-text start_line=&#34;-321&#34;&gt;
-      Around line 13:
-    &lt;/item-text&gt;
-    &lt;Para start_line=&#34;-321&#34;&gt;
-      Couldn&#38;#39;t do =encoding Shift-JIS: Encoding is already
-      set to koi8-r
-    &lt;/Para&gt;
-  &lt;/over-text&gt;
 &lt;/Document&gt;
diff --git a/t/corpus/laozi38.xml b/t/corpus/laozi38.xml
index 5ff7251..e62ee64 100644
--- a/t/corpus/laozi38.xml
+++ b/t/corpus/laozi38.xml
@@ -1,6 +1,6 @@
 &lt;Document start_line=&#34;1&#34;&gt;
   &lt;head1 start_line=&#34;3&#34;&gt;
-    &#38;#32769;&#38;#23376;&#38;#36947;&#38;#24503;&#38;#32147; &#38;#19977;&#38;#21313;&#38;#20843;&#38;#31456;
+    &#38;#32769;&#38;#23376;&#38;#36947;&#38;#24503;&#38;#32147;&#38;#12288;&#38;#19977;&#38;#21313;&#38;#20843;&#38;#31456;
     -- Big5 &#40;Chinese&#41; encoding test
   &lt;/head1&gt;
   &lt;Para start_line=&#34;5&#34;&gt;
diff --git a/t/corpus/laozi38b.xml b/t/corpus/laozi38b.xml
index 5ff7251..e62ee64 100644
--- a/t/corpus/laozi38b.xml
+++ b/t/corpus/laozi38b.xml
@@ -1,6 +1,6 @@
 &lt;Document start_line=&#34;1&#34;&gt;
   &lt;head1 start_line=&#34;3&#34;&gt;
-    &#38;#32769;&#38;#23376;&#38;#36947;&#38;#24503;&#38;#32147; &#38;#19977;&#38;#21313;&#38;#20843;&#38;#31456;
+    &#38;#32769;&#38;#23376;&#38;#36947;&#38;#24503;&#38;#32147;&#38;#12288;&#38;#19977;&#38;#21313;&#38;#20843;&#38;#31456;
     -- Big5 &#40;Chinese&#41; encoding test
   &lt;/head1&gt;
   &lt;Para start_line=&#34;5&#34;&gt;
diff --git a/t/corpus/laozi38p.xml b/t/corpus/laozi38p.xml
index bae00f2..269ba94 100644
--- a/t/corpus/laozi38p.xml
+++ b/t/corpus/laozi38p.xml
@@ -3,7 +3,7 @@
     NAME
   &lt;/head1&gt;
   &lt;Para start_line=&#34;6&#34;&gt;
-    &#38;#32769;&#38;#23376;&#38;#36947;&#38;#24503;&#38;#32147; &#38;#19977;&#38;#21313;&#38;#20843;&#38;#31456;
+    &#38;#32769;&#38;#23376;&#38;#36947;&#38;#24503;&#38;#32147;&#38;#12288;&#38;#19977;&#38;#21313;&#38;#20843;&#38;#31456;
     -- Big5 &#40;Chinese&#41; encoding test
   &lt;/Para&gt;
   &lt;head1 start_line=&#34;8&#34;&gt;
@@ -18,7 +18,7 @@
     .
   &lt;/Para&gt;
   &lt;head2 start_line=&#34;13&#34;&gt;
-    &#38;#32769;&#38;#23376;&#38;#36947;&#38;#24503;&#38;#32147; &#38;#19977;&#38;#21313;&#38;#20843;&#38;#31456;
+    &#38;#32769;&#38;#23376;&#38;#36947;&#38;#24503;&#38;#32147;&#38;#12288;&#38;#19977;&#38;#21313;&#38;#20843;&#38;#31456;
   &lt;/head2&gt;
   &lt;Para start_line=&#34;15&#34;&gt;
     &#38;#19978;&#38;#24503;&#38;#19981;&#38;#24503;&#38;#65292;&#38;#26159;&#38;#20197;&#38;#26377;&#38;#24503;&#38;#65108;
diff --git a/t/corpus/s2763_sjis.xml b/t/corpus/s2763_sjis.xml
index 55a4fd0..cfbafb1 100644
--- a/t/corpus/s2763_sjis.xml
+++ b/t/corpus/s2763_sjis.xml
@@ -45,8 +45,7 @@
       &#38;#26448;&#38;#36074;
     &lt;/item-text&gt;
     &lt;Para start_line=&#34;35&#34;&gt;
-      &#38;#27193;&#38;#33026; &#38;#12450;&#38;#12523;&#38;#12511;&#38;#12289;&#38;#12450;&#38;#12523;&#38;#12510;&#38;#12452;&#38;#12488;&#38;#20181;&#38;#19978;
-      &#38;#12460;&#38;#12521;&#38;#12473;
+      &#38;#27193;&#38;#33026;&#38;#12288;&#38;#12450;&#38;#12523;&#38;#12511;&#38;#12289;&#38;#12450;&#38;#12523;&#38;#12510;&#38;#12452;&#38;#12488;&#38;#20181;&#38;#19978;&#38;#12288;&#38;#12460;&#38;#12521;&#38;#12473;
     &lt;/Para&gt;
     &lt;item-text start_line=&#34;37&#34;&gt;
       &#38;#20385;&#38;#26684;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;28&nbsp;18:04:58&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;14&nbsp;13:39:30&nbsp;2011</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Feb 28 18:04:57 2011, DWHEELER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Here&#39;s a new patch, with just the Pod::Simple stuff pulled out and all
&gt; the tests passing. I&#39;m going
&gt; to see what I can extract from this. That is, what I can understand. I
&gt; agree that `=encode` is a
&gt; mis-spelling. But I don&#39;t at all understand what the code you&#39;ve
&gt; removed further down, under
&gt; `require Pod::Simple::Transcode`, is supposed to do, or why you&#39;ve
&gt; removed it. I also don&#39;t
&gt; understand the corpus changes. Can you say a bit more about the reason
&gt; for these changes?
</div>
For now I&#39;ve applied the fixing of the misspelling of &#34;=encoding&#34; in the parser. I don&#39;t 
understand the rest, and await your reply, when you have a chance. In the meantime, I&#39;ll 
release 3.16 with that fix and a few others.

Thanks,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;14&nbsp;13:39:31&nbsp;2011</span>
    <span class="description">dwheeler [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
