<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #18973 for threads-shared: variables defined after threads created not shared</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #18973 for threads-shared: variables defined after threads created not shared</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=threads-shared">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=threads-shared">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=threads-shared">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=threads-shared">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/threads-shared">threads-shared CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">18973</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=threads-shared">threads-shared</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jgmyers [...] proofpoint.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-32722-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.01    </td>
  </tr>
  <tr id="CF-32723-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




perl-shared.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/190851/69068/perl-shared.pl">
Fri Apr 28 14:26:04 2006 (616b) by Guest
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=18973">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-190851" href="/Public/Bug/Display.html?id=18973#txn-190851">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;28&nbsp;14:26:04&nbsp;2006</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> variables defined after threads created not shared</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/190851/69065/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/69065">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 375b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">As demonstrated by the attached test case, shared variables that are
defined after threads have already been cloned are not correctly shared.
 Instead, each of the existing threads gets its own private copy of the
&#34;shared&#34; variable.

&#40;In my application, it is sometimes the case that it doesn&#39;t know to
load a module until well after the application has gone multithreaded.&#41;
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> perl-shared.pl</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/190851/69068/perl-shared.pl">Download perl-shared.pl</a><br />
<span class="downloadcontenttype">text/x-perl 616b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">use strict;
use warnings;
use threads;
use threads::shared;
use Thread::Queue;

our $q = new Thread::Queue;

sub doload {
    eval &lt;&lt;&#39;EOT&#39;
package child;

use strict;
use warnings;
use threads;
use threads::shared;
our $var : shared;

sub process {
    lock&#40;$var&#41;;
    $var = 0 unless defined&#40;$var&#41;;
    print &#34;$var\n&#34;;
    ++$var;
}
EOT
    ;
}

sub child {
    &#38;doload&#40;&#41;;
    $q-&gt;dequeue&#40;&#41;;
    child::process&#40;&#41;;
}

our @thr;

#&#38;doload&#40;&#41;;

foreach my $i &#40;1..5&#41; {
    push @thr, scalar threads-&gt;create&#40;&#39;child&#39;&#41;;
}

&#38;doload&#40;&#41;;

foreach my $i &#40;1..5&#41; {
    $q-&gt;enqueue&#40;$i&#41;;
}

foreach my $t &#40;@thr&#41; {
    $t-&gt;join&#40;&#41;;
}
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-190959" href="/Public/Bug/Display.html?id=18973#txn-190959">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;28&nbsp;19:05:10&nbsp;2006</span>
    <span class="description">sky [...] nanisky.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #18973] variables defined after threads created not shared </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 28 Apr 2006 16:03:25 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-threads-shared [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Artur Bergman &lt;sky [...] nanisky.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/190959/69169/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/69169">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I am not sure what the correct semantics should be here, the variable  
doesn&#39;t exist so how can the other thread have access ot them?

Artur

On 28 Apr 2006, at 11:26, Guest via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Fri Apr 28 14:26:04 2006: Request 18973 was acted upon.
&gt; Transaction: Ticket created by guest
&gt;        Queue: threads-shared
&gt;      Subject: variables defined after threads created not shared
&gt;        Owner: Nobody
&gt;   Requestors: jgmyers@proofpoint.com
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=18973">http://rt.cpan.org/Ticket/Display.html?id=18973</a></span> &gt;
&gt;
&gt;
&gt; As demonstrated by the attached test case, shared variables that are
&gt; defined after threads have already been cloned are not correctly  
&gt; shared.
&gt;  Instead, each of the existing threads gets its own private copy of  
&gt; the
&gt; &#34;shared&#34; variable.
&gt;
&gt; &#40;In my application, it is sometimes the case that it doesn&#39;t know to
&gt; load a module until well after the application has gone  
&gt; multithreaded.&#41;
&gt;
&gt; use strict;
&gt; use warnings;
&gt; use threads;
&gt; use threads::shared;
&gt; use Thread::Queue;
&gt;
&gt; our $q = new Thread::Queue;
&gt;
&gt; sub doload {
&gt;     eval &lt;&lt;&#39;EOT&#39;
&gt; package child;
&gt;
&gt; use strict;
&gt; use warnings;
&gt; use threads;
&gt; use threads::shared;
&gt; our $var : shared;
&gt;
&gt; sub process {
&gt;     lock&#40;$var&#41;;
&gt;     $var = 0 unless defined&#40;$var&#41;;
&gt;     print &#34;$var\n&#34;;
&gt;     ++$var;
&gt; }
&gt; EOT
&gt;     ;
&gt; }
&gt;
&gt; sub child {
&gt;     &#38;doload&#40;&#41;;
&gt;     $q-&gt;dequeue&#40;&#41;;
&gt;     child::process&#40;&#41;;
&gt; }
&gt;
&gt; our @thr;
&gt;
&gt; #&#38;doload&#40;&#41;;
&gt;
&gt; foreach my $i &#40;1..5&#41; {
&gt;     push @thr, scalar threads-&gt;create&#40;&#39;child&#39;&#41;;
&gt; }
&gt;
&gt; &#38;doload&#40;&#41;;
&gt;
&gt; foreach my $i &#40;1..5&#41; {
&gt;     $q-&gt;enqueue&#40;$i&#41;;
&gt; }
&gt;
&gt; foreach my $t &#40;@thr&#41; {
&gt;     $t-&gt;join&#40;&#41;;
&gt; }
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-190960" href="/Public/Bug/Display.html?id=18973#txn-190960">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;28&nbsp;19:05:11&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-190963" href="/Public/Bug/Display.html?id=18973#txn-190963">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;28&nbsp;19:22:13&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> jgmyers [...] proofpoint.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/190963/69172/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/69172">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 496b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Apr 28 19:05:10 2006, sky@nanisky.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I am not sure what the correct semantics should be here, the variable  
&gt; doesn&#39;t exist so how can the other thread have access ot them?
</div>
The other threads should get access when they eval the &#34;our $var : shared;&#34;
It should notice there is already an existing shared sv named
$child::var and make that thread&#39;s $child::var use the same backing
shared sv.

All shared variables with the same name should have the same backing
shared-space sv.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-190966" href="/Public/Bug/Display.html?id=18973#txn-190966">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;28&nbsp;20:53:47&nbsp;2006</span>
    <span class="description">sky [...] nanisky.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #18973] variables defined after threads created not shared </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 28 Apr 2006 17:52:06 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-threads-shared [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Artur Bergman &lt;sky [...] nanisky.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/190966/69176/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/69176">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 622b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On 28 Apr 2006, at 16:22, Guest via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; The other threads should get access when they eval the &#34;our $var :  
&gt; shared;&#34;
&gt; It should notice there is already an existing shared sv named
&gt; $child::var and make that thread&#39;s $child::var use the same backing
&gt; shared sv.
&gt;
&gt; All shared variables with the same name should have the same backing
&gt; shared-space sv.
</div>
I am tempted to say, patches welcome, but the implications seem bad.

My argument would be that : shared is a compile time option, and  
threads are a compile time options.

eval &#34;use threads;&#34; is not support, so neither is eval &#34; : shared &#34;

Artur
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/190966/69177/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/69177">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.8k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-190969" href="/Public/Bug/Display.html?id=18973#txn-190969">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;28&nbsp;21:21:55&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> jgmyers [...] proofpoint.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/190969/69180/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/69180">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 508b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Apr 28 20:53:47 2006, sky@nanisky.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; My argument would be that : shared is a compile time option, and  
&gt; threads are a compile time options.
</div>
The test case was simplified to fit into a single file.  The bug can
also be demonstrated by putting the &#34;package child&#34; definitions into a
separate child.pm file and replacing the eval with a &#34;require child;&#34;

I haven&#39;t figured out how the shared attribute results in a call to the
threads::shared module, so I don&#39;t know what I&#39;d start patching.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-190972" href="/Public/Bug/Display.html?id=18973#txn-190972">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;28&nbsp;21:51:52&nbsp;2006</span>
    <span class="description">sky [...] nanisky.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #18973] variables defined after threads created not shared </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 28 Apr 2006 18:50:09 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-threads-shared [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Artur Bergman &lt;sky [...] nanisky.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/190972/69183/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/69183">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 737b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On 28 Apr 2006, at 18:21, Guest via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;        Queue: threads-shared
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=18973">http://rt.cpan.org/Ticket/Display.html?id=18973</a></span> &gt;
&gt;
&gt; On Fri Apr 28 20:53:47 2006, sky@nanisky.com wrote:
<div class="message-stanza open">&gt;&gt; My argument would be that : shared is a compile time option, and
&gt;&gt; threads are a compile time options.
</div>&gt;
&gt; The test case was simplified to fit into a single file.  The bug can
&gt; also be demonstrated by putting the &#34;package child&#34; definitions into a
&gt; separate child.pm file and replacing the eval with a &#34;require child;&#34;
&gt;
&gt; I haven&#39;t figured out how the shared attribute results in a call to  
&gt; the
&gt; threads::shared module, so I don&#39;t know what I&#39;d start patching.
&gt;
</div>
require and eval &#34;&#34; are essentially the same thing

artur
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-190978" href="/Public/Bug/Display.html?id=18973#txn-190978">#</a>      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;29&nbsp;00:55:03&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> jgmyers [...] proofpoint.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/190978/69189/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/69189">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 387b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; require and eval &#34;&#34; are essentially the same thing
</div>
And both compile their respective arguments as one step of their
processing.  So I don&#39;t see how saying something is &#34;a compile time
option&#34; is making any distinction.

&#34;use threads;&#34; works just fine under eval/require--what says it isn&#39;t
supported?  The threads POD only says one can&#39;t create a thread during
the compilation phase.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-191110" href="/Public/Bug/Display.html?id=18973#txn-191110">#</a>      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;29&nbsp;13:07:53&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> jgmyers [...] proofpoint.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/191110/69279/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/69279">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 166b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">As further proof that eval is not the problem, if you uncomment the
commented call to &#38;doload&#40;&#41; in the test program then the test program
exhibits correct behavior.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-191113" href="/Public/Bug/Display.html?id=18973#txn-191113">#</a>      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;29&nbsp;15:11:14&nbsp;2006</span>
    <span class="description">sky [...] nanisky.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #18973] variables defined after threads created not shared </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 29 Apr 2006 12:09:58 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-threads-shared [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Artur Bergman &lt;sky [...] nanisky.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/191113/69282/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/69282">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 755b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On 28 Apr 2006, at 21:55, Guest via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;        Queue: threads-shared
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=18973">http://rt.cpan.org/Ticket/Display.html?id=18973</a></span> &gt;
&gt;
<div class="message-stanza open">&gt;&gt; require and eval &#34;&#34; are essentially the same thing
</div>&gt;
&gt; And both compile their respective arguments as one step of their
&gt; processing.  So I don&#39;t see how saying something is &#34;a compile time
&gt; option&#34; is making any distinction.
&gt;
&gt; &#34;use threads;&#34; works just fine under eval/require--what says it isn&#39;t
&gt; supported?  The threads POD only says one can&#39;t create a thread during
&gt; the compilation phase.
&gt;
</div>
Uhm, I did when I wrote it.

require is compile time for that unit yes, but if you compile  
something after a thread is created it only exists in that   
interpreter, so it is per default ...

Artur
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-191585" href="/Public/Bug/Display.html?id=18973#txn-191585">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;01&nbsp;09:35:03&nbsp;2006</span>
    <span class="description">jdhedden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jerry D. Hedden</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/191585/69516/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/69516">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 960b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#34;use threads;&#34; works just fine under eval/require--what says it isn&#39;t
&gt; supported?  The threads POD only says one can&#39;t create a thread during
&gt; the compilation phase.
</div>
From the &#39;threads&#39; POD:

It is also important to note that you must enable threads by doing C&lt;use
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">threads&gt; as early as possible in the script itself, and that it is not
</div>possible to enable threading inside an C&lt;eval &#34;&#34;&gt;, C&lt;do&gt;, C&lt;require&gt;, or
C&lt;use&gt;.  In particular, if you are intending to share variables with
L&lt;threads::shared&gt;, you must C&lt;use threads&gt; before you C&lt;use
threads::shared&gt;.
&#40;C&lt;threads&gt; will emit a warning if you do it the other way around.&#41;

Also &#39;perldoc -f our&#39; states:

  &#34;our&#34; associates a simple name with a package variable in the
  current package, for use within the current scope.

Each child thread has its own scope.  When &#39;our $var : shared&#39; is
&#39;eval&#39;ed it creates a new version of the variable that is visible only
to that thread.  Therefore, there is no bug.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-191588" href="/Public/Bug/Display.html?id=18973#txn-191588">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;May&nbsp;01&nbsp;09:35:36&nbsp;2006</span>
    <span class="description">jdhedden [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.546919</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
