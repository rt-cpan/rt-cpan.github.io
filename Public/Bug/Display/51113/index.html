<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #51113 for Net-Telnet: @ &#40;at sign&#41; corruption over ssh</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #51113 for Net-Telnet: @ &#40;at sign&#41; corruption over ssh</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-Telnet/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-Telnet/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-Telnet/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-Telnet/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-Telnet">Net-Telnet CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">51113</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-Telnet/Active/">Net-Telnet</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
lordadmira [...] yahoo.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-23316-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-23317-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;04&nbsp;16:04:43&nbsp;2009</span>
    <span class="description">lordadmira [...] yahoo.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> @ &#40;at sign&#41; corruption over ssh</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Jay, I hope ur still maintaining Net-Telnet.  I&#39;ve encountered a
problem that makes no sense.  I&#39;m using the ssh example in the
documentation to connect to a Sun 10 box.  It doesn&#39;t support telnet.  I
can log in OK and do shell commands.  However I need to transfer a
dynamically generated Perl script over the connection.  I do a &#34;print
perl -&#34; and wait for a returned newline indicating that Perl is running.
 Then I iterate over each line of the HERE program sending it with a
print&#40;&#41;.  The code is transferred OK except for one thing.  All @ signs
have a CRLF after them in the code echoed back by the box.  I&#39;m using
the dump log and it shows that I send &#34;@var&#34; and get back &#34;@\r\nvar&#34; in
the return stream.  Perl then dies complaining about trying to modify a
constant.  I&#39;m using this exact same construct on a telnet connection
with no problems.  I tried changing the print&#40;&#41; to put&#40;&#41; once character
at a type and no difference.  The line position of the @ sign makes no
difference.  Setting Binmode on the object made no difference either. 
It does it on three different Perl binaries that I tried, all different
versions.  Net-Telnet is 3.03.  Ssh is OpenSSH_4.3p2-hpn, OpenSSL 0.9.7i
14 Oct 2005, HP-UX Secure Shell-A.04.30.006, HP-UX Secure Shell version.

Here&#39;s some snippets.

Dumplog
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 0x00000: 22                                                  &#34;
&gt; 0x00000: 40                                                  @
&gt; 0x00000: 62                                                  b
&gt; 0x00000: 6f                                                  o
&gt; 0x00000: 62                                                  b
&gt; 0x00000: 22                                                  &#34;
&gt; 0x00000: 3b                                                  ;
&gt; 0x00000: 0a                                                  .
&gt; 0x00000: 28                                                  &#40;
&gt; 0x00000: 40                                                  @
&gt; 0x00000: 7b                                                  {
&gt; 0x00000: 64                                                  d
&gt; 0x00000: 69                                                  i
&gt; 0x00000: 72                                                  r
&gt; 0x00000: 73                                                  s
&gt; 0x00000: 7d                                                  }
&gt; 0x00000: 20
&gt; 0x00000: 3d                                                  =
</div>...
&lt; 0x000d0: 0a 24 7c 20  3d 20 31 3b  0d 0a 22 40  0d 0a 62 6f  .$| =
1;..&#34;@..bo
&lt; 0x000e0: 62 22 3b 0d  0a 28 40 0d  0a 7b 64 69  72 73 7d 20 
b&#34;;..&#40;@..{dirs}
&lt; 0x000f0: 3d 20 67 6c  6f 62 20 24  61 72 63 68  69 76 65 73  = glob
$archives

Constructor
$pty = &#38;spawn&#40;$sshcmd, &#34;-l&#34;, $username, $server&#41;;  # spawn&#40;&#41; defined below
$ssh = new Net::Telnet &#40;-fhopen =&gt; $pty,
                        -telnetmode =&gt; 0,
                        -cmd_remove_mode =&gt; 1,
                        -output_record_separator =&gt; &#34;\r&#34;,
                        Dump_Log =&gt; &#34;cwtelnet.log&#34;,
                        Binmode =&gt; 1
                        &#41;;

sub spawn {
        my&#40;@cmd&#41; = @_;
        my&#40;$pid, $pty, $tty, $tty_fd&#41;;

        ## Create a new pseudo terminal.
        $pty = new IO::Pty or die $!;

        ## Execute the program in another process.
        unless &#40;$pid = fork&#41; {  # child process
                die &#34;problem spawning program: $!\n&#34; unless defined $pid;

                ## Disassociate process from existing controlling terminal.
                POSIX::setsid or die &#34;setsid failed: $!&#34;;

                ## Associate process with a new controlling terminal.
                $tty = $pty-&gt;slave;
                $pty-&gt;make_slave_controlling_terminal&#40;&#41;; ## fix
                $tty_fd = $tty-&gt;fileno;
                close $pty;

                ## Make stdio use the new controlling terminal.
                open STDIN, &#34;&lt;&#38;$tty_fd&#34; or die $!;
                open STDOUT, &#34;&gt;&#38;$tty_fd&#34; or die $!;
                open STDERR, &#34;&gt;&#38;STDOUT&#34; or die $!;
                close $tty;

                ## Execute requested program.
                exec @cmd or die &#34;problem executing $cmd[0]\n&#34;;
        } # end child process

        return $pty;
}


Hope u can help.  Thanks.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;29&nbsp;13:17:17&nbsp;2010</span>
    <span class="description">lordadmira [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> lordadmira [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m posting this for the benefit of other users who might happen across
this bug report.  I don&#39;t know what&#39;s causing the bug but I have found
workarounds.

The problem is that some Net-Telnet/ssh/Pty weirdness is corrupting the
remote terminal control.  Running stty -a through the connection will
reveal bizarre values for the terminal control characters.  As in a
plain @ character for kill.  The way to fix this is to make running stty
sane the very first thing u do over ur connection.  That resets the
terminal controls so u can do business.

A related problem is that sending data over the connection can overload
the other side resulting in lost data.  I&#39;ve been using this to transfer
Perl code to Perl&#39;s standard input to run HERE programs.  If the remote
Perl is overloaded it will print a ^G &#40;BELL&#41;.  To handle that u have to
monitor the $ssh-&gt;buffer value for a ^G.  If it&#39;s there, retransmit the
chucked line.  It sucks but it works.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;16&nbsp;01:29:38&nbsp;2012</span>
    <span class="description">jay [...] rgrs.com -  Broken in 3.03 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;16&nbsp;01:31:19&nbsp;2012</span>
    <span class="description">jay [...] rgrs.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry I didn&#39;t have time to help you debug this when you submitted it. 
It looks like an interesting problem and it would have been nice to know
how the stty setting was getting messed up.

However it does not appear to be a bug with Net::Telnet.

Thanks for submitting it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;16&nbsp;01:31:20&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;16&nbsp;01:31:20&nbsp;2012</span>
    <span class="description">jay [...] rgrs.com -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
