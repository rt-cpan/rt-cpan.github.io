<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #7293 for DBD-SQLite: v1.02 Commit Problem</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #7293 for DBD-SQLite: v1.02 Commit Problem</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBD-SQLite">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBD-SQLite">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBD-SQLite">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBD-SQLite">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-SQLite">DBD-SQLite CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">7293</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBD-SQLite">DBD-SQLite</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
helphand [...] pacbell.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-10248-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.02    </td>
  </tr>
  <tr id="CF-10249-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=7293">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-109516" href="/Public/Bug/Display.html?id=7293#txn-109516">#</a>      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;08&nbsp;19:48:18&nbsp;2004</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> v1.02 Commit Problem</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/109516/21553/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/21553">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Back again, sorry. I&#39;m seeing a problem with v 1.02 and journaling. The perl program, popfile, runs as a daemon in the background. After upgrading from v .31 to v 1.02 and converting the database, I see the following errors;

POPFile Engine v0.21.1 running
DBD::SQLite::db commit failed: cannot commit transaction - SQL statements in progress&#40;1&#41; at dbdimp.c line 540 at /usr/local/bin/popfile/Classifier/Bayes.pm line 1828, &lt;GEN3&gt; line 5.
DBD::SQLite::st execute failed: SQL logic error or missing database&#40;1&#41; at dbdimp.c line 371 at /usr/local/bin/popfile/Classifier/Bayes.pm line 2912, &lt;$reader&gt; line 3.
DBD::SQLite::db begin_work failed: Already in a transaction at /usr/local/bin/popfile/Classifier/Bayes.pm line 1808, &lt;GEN15&gt; line 5.
DBD::SQLite::db commit failed: cannot commit transaction - SQL statements in progress&#40;1&#41; at dbdimp.c line 203 at /usr/local/bin/popfile/Classifier/Bayes.pm line 1828, &lt;GEN15&gt; line 5.
DBD::SQLite::st execute failed: SQL logic error or missing database&#40;1&#41; at dbdimp.c line 371 at /usr/local/bin/popfile/Classifier/Bayes.pm line 2912, &lt;$reader&gt; line 3.
DBD::SQLite::db begin_work failed: Already in a transaction at /usr/local/bin/popfile/Classifier/Bayes.pm line 1808, &lt;GEN49&gt; line 5.
DBD::SQLite::db commit failed: cannot commit transaction - SQL statements in progress&#40;1&#41; at dbdimp.c line 203 at /usr/local/bin/popfile/Classifier/Bayes.pm line 1828, &lt;GEN49&gt; line 5.
DBD::SQLite::st execute failed: SQL logic error or missing database&#40;1&#41; at dbdimp.c line 371 at /usr/local/bin/popfile/Classifier/Bayes.pm line 2912, &lt;$reader&gt; line 3.

The -journal file never gets committed. The popfile perl program runs fine on v .31 and I&#39;m stumped on the &#39;SQL statements in progress&#39; message that apparently is the cause of all the rest of the errors. Can you point me in the right direction?

  Scott
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-109517" href="/Public/Bug/Display.html?id=7293#txn-109517">#</a>      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;08&nbsp;20:51:14&nbsp;2004</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/109517/21554/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/21554">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[guest - Sun Aug  8 19:48:18 2004]: 
 
 Switched to sqlite 3.04 just released. Now the error changes to  
 
POPFile Engine v0.21.1 running 
DBD::SQLite::st execute failed: database table is locked&#40;1&#41; at dbdimp.c 
line 371 at /usr/local/bin/popfile/Classifier/Bayes.pm line 2916. 
DBD::SQLite::st execute failed: database table is locked&#40;1&#41; at dbdimp.c 
line 371 at /usr/local/bin/popfile/Classifier/Bayes.pm line 2916. 
DBD::SQLite::st execute failed: database table is locked&#40;1&#41; at dbdimp.c 
line 371 at /usr/local/bin/popfile/Classifier/Bayes.pm line 2916. 
DBD::SQLite::st execute failed: database table is locked&#40;1&#41; at dbdimp.c 
line 371 at /usr/local/bin/popfile/Classifier/Bayes.pm line 2916. 
DBD::SQLite::db commit failed: cannot commit transaction - SQL 
statements in progress&#40;1&#41; at dbdimp.c line 540 
at /usr/local/bin/popfile/Classifier/Bayes.pm line 1289. 
DBD::SQLite::db begin_work failed: Already in a transaction 
at /usr/local/bin/popfile/Classifier/Bayes.pm line 1260. 
DBD::SQLite::db commit failed: cannot commit transaction - SQL 
statements in progress&#40;1&#41; at dbdimp.c line 203 
at /usr/local/bin/popfile/Classifier/Bayes.pm line 1289. 
DBD::SQLite::st execute failed: database table is locked&#40;1&#41; at dbdimp.c 
line 371 at /usr/local/bin/popfile/Classifier/Bayes.pm line 2916. 
DBD::SQLite::st execute failed: database table is locked&#40;1&#41; at dbdimp.c 
line 371 at /usr/local/bin/popfile/Classifier/Bayes.pm line 2916. 
DBD::SQLite::st execute failed: database table is locked&#40;1&#41; at dbdimp.c 
line 371 at /usr/local/bin/popfile/Classifier/Bayes.pm line 2916. 
DBD::SQLite::st execute failed: database table is locked&#40;1&#41; at dbdimp.c 
line 371 at /usr/local/bin/popfile/Classifier/Bayes.pm line 2916. 
helphand:/var/log/popfile # 
 
So it looks like it is probably some type of logic error in popfile not 
complying with the new locking strategy of SQLite3. Will take this to 
the SQLite forum since it doesn&#39;t appear to be a DBD::SQLite issue. 
 
  Scott   
 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-109518" href="/Public/Bug/Display.html?id=7293#txn-109518">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;09&nbsp;04:36:58&nbsp;2004</span>
    <span class="description">matt [...] sergeant.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Matt Sergeant &lt;matt [...] sergeant.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #7293] v1.02 Commit Problem </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 9 Aug 2004 09:31:07 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-SQLite [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-Cc:</td>
    <td class="message-header-value"> </td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/109518/21564/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/21564">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 533b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 9 Aug 2004, at 01:51, Guest via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So it looks like it is probably some type of logic error in popfile not
&gt; complying with the new locking strategy of SQLite3. Will take this to
&gt; the SQLite forum since it doesn&#39;t appear to be a DBD::SQLite issue.
</div>
Actually I think this *is* a DBD::SQLite issue, and has to do with 
slightly changed behaviour from sqlite not being handled right by 
DBD::SQLite. I believe it could be fixed in DBD::SQLite&#39;s CVS though. 
&#40;see <span class="clickylink"><a target="new" rel="nofollow" href="http://axkit.org/cvs.xml">http://axkit.org/cvs.xml</a></span> if you want access to the repo&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-109519" href="/Public/Bug/Display.html?id=7293#txn-109519">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;09&nbsp;08:39:18&nbsp;2004</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> helphand [...] pacbell.net</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/109519/21578/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/21578">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[matt@sergeant.org - Mon Aug  9 04:36:58 2004]: 
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  
&gt; Actually I think this *is* a DBD::SQLite issue, and has to do with 
&gt; slightly changed behaviour from sqlite not being handled right by 
&gt; DBD::SQLite. I believe it could be fixed in DBD::SQLite&#39;s CVS though. 
&gt; &#40;see <span class="clickylink"><a target="new" rel="nofollow" href="http://axkit.org/cvs.xml">http://axkit.org/cvs.xml</a></span> if you want access to the repo&#41;. 
&gt;  
</div> 
 Hi Matt, 
 
  I pretty much nailed this down as a problem in the application logic. 
Here&#39;s a copy of a post to the SQLite Mailing list recapping what I 
found. Those &#39;dangling SELECTS&#39; and a case of nested transactions were 
causing the errors, once I fixed those in the application, everything 
worked fine. 
 
   Scott 
  
POST TO SQLITE LIST 
 
Â  Â Solved! Just to close the loop on this for the benefit of any other  
DBD::SQLite users who may be trying to upgrade from v 0.31 to v 1.x.x. 
Watch out for cases where your former working code left unfinished 
SELECT  
statements since under SQLite v 3.x.x they will hold locks on the 
database  
causing subsequent SQL calls to fail.  
Â  
Â  Â In my case, the code had several instances where we knew there could 
only  
be one result to the query so we basically grabbed that result and 
moved on,  
e.g., 
 
Â  Â  Â  Â $sth = $dbh-&gt;prepare&#40;$statement&#41;; 
Â  Â  Â  Â $sth-&gt;execute; 
Â  Â  Â  Â return $sth-&gt;fetchrow_arrayref; 
 
Â  Â This left the SELECT statement in a not finalized state and the 
dataset  
locked. Worked fine under SQLite 2.8.xx but it fails under 3.x.x. We 
had to  
change the code to, 
 
Â  Â  Â  Â $sth = $dbh-&gt;prepare&#40;$statement&#41;; 
Â  Â  Â  Â $sth-&gt;execute; 
Â  Â  Â  Â my $result= $sth-&gt;fetchrow_arrayref; 
Â  Â  Â  Â $sth-&gt;finish&#40;&#41;; 
Â  Â  Â  Â return $result; 
 
Â  Â to solve the problem by finalizing the SELECT so the lock came off 
the  
database. 
 
Â  Â  Hope that helps someone else from banging their head against the 
wall  
searching for the problem &lt;g&gt;. Again, a big thanks to D. Richard Hipp 
for  
pointing me in the right direction! 
 
 
 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-109520" href="/Public/Bug/Display.html?id=7293#txn-109520">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;09&nbsp;13:01:51&nbsp;2004</span>
    <span class="description">matt [...] sergeant.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 9 Aug 2004 18:02:46 +0100 &#40;BST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Matt Sergeant &lt;matt [...] sergeant.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Guest via RT &lt;bug-DBD-SQLite [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #7293] v1.02 Commit Problem</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-Cc:</td>
    <td class="message-header-value"> </td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/109520/21588/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/21588">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 523b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, 9 Aug 2004, Guest via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;   I pretty much nailed this down as a problem in the application logic.
&gt; Here&#39;s a copy of a post to the SQLite Mailing list recapping what I
&gt; found. Those &#39;dangling SELECTS&#39; and a case of nested transactions were
&gt; causing the errors, once I fixed those in the application, everything
&gt; worked fine.
</div>
I still think this is a bug in the driver though. I&#39;ve now uploaded 1.03
to CPAN - can you check if this is fixed there? You should never have to
call finish&#40;&#41; manually.

Matt.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-109521" href="/Public/Bug/Display.html?id=7293#txn-109521">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;09&nbsp;21:01:20&nbsp;2004</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/109521/21600/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/21600">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[matt@sergeant.org - Mon Aug  9 13:01:51 2004]: 
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  
&gt; I still think this is a bug in the driver though. I&#39;ve now uploaded 
&gt;    1.03 
&gt; to CPAN - can you check if this is fixed there? You should never have 
&gt;    to 
&gt; call finish&#40;&#41; manually. 
&gt;  
</div> 
  OK, I downloaded 1.03 from CPAN, compiled, tested and installed it 
without any issues at all. 
 
 
  I then ran popfile with the changes in place &#40;to make sure all 
SELECT&#39;s were finished&#41; and it ran fine, no errors, warnings, or 
strange messages.  
 
  I then removed the changes from popfile to put it back to the way it 
was with version .31 &#40;dangling &#39;SELECTS&#39;&#41; and tried running again. I 
got the lock messages shown below, the -journal file showed up and 
remained on disk so it looks like your change did not work &#40;assuming 
the intent was to allow unfinished selects&#41; :&#40; 
 
  Scott 
 
DBD::SQLite::st execute failed: database table is locked&#40;1&#41; at dbdimp.c 
line 383 at /usr/local/bin/popfile/Classifier/Bayes.pm line 2922. 
DBD::SQLite::st execute failed: database table is locked&#40;1&#41; at dbdimp.c 
line 383 at /usr/local/bin/popfile/Classifier/Bayes.pm line 2922. 
DBD::SQLite::st execute failed: database table is locked&#40;1&#41; at dbdimp.c 
line 383 at /usr/local/bin/popfile/Classifier/Bayes.pm line 2922. 
DBD::SQLite::st execute failed: database table is locked&#40;1&#41; at dbdimp.c 
line 383 at /usr/local/bin/popfile/Classifier/Bayes.pm line 2922. 
DBD::SQLite::db commit failed: cannot commit transaction - SQL 
statements in progress&#40;1&#41; at dbdimp.c line 547 
at /usr/local/bin/popfile/Classifier/Bayes.pm line 1288. 
DBD::SQLite::db begin_work failed: Already in a transaction 
at /usr/local/bin/popfile/Classifier/Bayes.pm line 1259. 
DBD::SQLite::db commit failed: cannot commit transaction - SQL 
statements in progress&#40;1&#41; at dbdimp.c line 214 
at /usr/local/bin/popfile/Classifier/Bayes.pm line 1288. 
DBD::SQLite::st execute failed: database table is locked&#40;1&#41; at dbdimp.c 
line 383 at /usr/local/bin/popfile/Classifier/Bayes.pm line 2922. 
DBD::SQLite::st execute failed: database table is locked&#40;1&#41; at dbdimp.c 
line 383 at /usr/local/bin/popfile/Classifier/Bayes.pm line 2922. 
DBD::SQLite::st execute failed: database table is locked&#40;1&#41; at dbdimp.c 
line 383 at /usr/local/bin/popfile/Classifier/Bayes.pm line 2922. 
DBD::SQLite::st execute failed: database table is locked&#40;1&#41; at dbdimp.c 
line 383 at /usr/local/bin/popfile/Classifier/Bayes.pm line 2922. 
 
 
 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-109522" href="/Public/Bug/Display.html?id=7293#txn-109522">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;11&nbsp;16:40:27&nbsp;2004</span>
    <span class="description">msergeant [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/109522/21633/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/21633">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 448b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">OK, I can see how I have to fix this now. With 0.3x I did the sqlite internal &#34;fetch&#34; &#40;called 
&#34;step&#34; there&#41; before DBI&#39;s fetch got called, so by the time you call the last &#34;fetch&#34; in DBI the 
last row has already gone past, so you know to finalize the statement.

I changed this in 1.x &#40;sqlite3&#41; because I thought I could, but I can&#39;t - I have to revert to the 
old way.

I&#39;ll fix it back again, and upload 1.04 as soon as I get the time to do it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-109523" href="/Public/Bug/Display.html?id=7293#txn-109523">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;11&nbsp;16:40:28&nbsp;2004</span>
    <span class="description">msergeant [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-109524" href="/Public/Bug/Display.html?id=7293#txn-109524">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;11&nbsp;21:01:37&nbsp;2004</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> helphand [...] pacbell.net</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/109524/21636/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/21636">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[MSERGEANT - Wed Aug 11 16:40:27 2004]: 
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  
&gt; I&#39;ll fix it back again, and upload 1.04 as soon as I get the time to 
&gt;    do it. 
</div> 
  OK, I&#39;ll watch for it. I also found another possible issue. There&#39;s a 
behavior change between v .31 and earlier and v 1.00 and later. To 
demonstrate, the following small program can be used. 
 
 
  use DBI&#40;&#41;; 
  use strict; 
 
  my $dbh=DBI-&gt;connect&#40;&#34;DBI:SQLite:dbname=test.db&#34;, 
                   &#34;gluser&#34;,&#34;pgarules&#34;, 
                   {&#39;RaiseError&#39;=&gt;1}&#41;; 
 
  my $sqlversion=$DBD::SQLite::VERSION; 
  my $dbiversion=$DBI::VERSION; 
 
  print &#34;Running DBI $dbiversion and DBD::SQLite $sqlversion\n&#34;; 
 
  my @tables = $dbh-&gt;tables&#40;&#41;; 
 
  foreach my $table &#40;@tables&#41; { 
     print &#34;$table \n&#34;; 
  } 
 
  $dbh-&gt;disconnect&#40;&#41;; 
  exit&#40;0&#41;; 
 
When run from .31 or earlier, the following results; 
 
Running DBI 1.37 and DBD::SQLite 0.28 
sqlite_master 
sqlite_temp_master 
 
When run from 1.03, we get these results; 
 
Running DBI 1.43 and DBD::SQLite 1.03 
&#34;sqlite_master&#34; 
&#34;sqlite_temp_master&#34; 
 
As you can see, the table names are now returned in double quotes. 
 
 
  Scott 
 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-109526" href="/Public/Bug/Display.html?id=7293#txn-109526">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;29&nbsp;05:48:24&nbsp;2004</span>
    <span class="description">msergeant [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.386531</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
