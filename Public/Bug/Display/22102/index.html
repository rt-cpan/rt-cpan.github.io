<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #22102 for Test-Simple: Test::Builder breaks on &#39;forks&#39; CPAN module</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #22102 for Test-Simple: Test::Builder breaks on &#39;forks&#39; CPAN module</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Test-Simple">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Test-Simple">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Test-Simple">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Test-Simple">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="http://github.com/Test-More/test-more/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Test-Simple">Test-Simple CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">22102</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Test-Simple">Test-Simple</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
rybskej [...] yahoo.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-31590-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.33    </td>
  </tr>
  <tr id="CF-31591-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




test-builder_forks_patch.1<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/250249/107402/test-builder_forks_patch.1">
Sun Oct 15 03:25:05 2006 (470b) by RYBSKEJ [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=22102">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-250249" href="/Public/Bug/Display.html?id=22102#txn-250249">#</a>      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;15&nbsp;03:25:05&nbsp;2006</span>
    <span class="description">RYBSKEJ [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Test::Builder breaks on &#39;forks&#39; CPAN module</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/250249/107399/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/107399">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">When using Test::Builder with the CPAN distribution &#34;forks&#34;
&#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~rybskej/forks-0.20/&#41;">http://search.cpan.org/~rybskej/forks-0.20/&#41;</a></span> on a non-threaded perl, a
special ithreads &#34;share&#34; subroutine, conditionally defined by
Test::Builder, is incorrectly loaded.

This results in incorrect &#34;Test output counter mismatch&#34; warnings, as
exemplified by running the following test script on a non-threaded perl
with forks 0.20:
    
    <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/src/RYBSKEJ/forks-0.20/t/forks03.t">http://search.cpan.org/src/RYBSKEJ/forks-0.20/t/forks03.t</a></span>

This problem is due to the following condition not being met
&#40;Test::Builder 0.33, line 18&#41;:

    # Load threads::shared when threads are turned on
    if&#40; $] &gt;= 5.008 &#38;&#38; $Config{useithreads} &#38;&#38; $INC{&#39;threads.pm&#39;}&#41; {

which then falls back to the following else case &#40;Test::Builder 0.33,
line 61&#41;:

    # 5.8.0&#39;s threads::shared is busted when threads are off.
    # We emulate it here.
    else {
        *share = sub { return $_[0] };
        *lock  = sub { 0 };
    }

This causes the working share and lock functions of forks &#40;and
forks::shared&#41; to be incorrectly overloaded.

The simplest and most portable solution to support the forks module
would be to modify the original condition statement to the following:

    if&#40; $] &gt;= 5.006 &#38;&#38; $INC{&#39;threads.pm&#39;}&#41; {

This change would have no negative affect &#40;compilation performance or
otherwise&#41; to any applications or modules that use Test::Builder.  I
have included a patch containing this modification with this report.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> test-builder_forks_patch.1</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/250249/107402/test-builder_forks_patch.1">Download test-builder_forks_patch.1</a><br />
<span class="downloadcontenttype">application/octet-stream 470b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-251057" href="/Public/Bug/Display.html?id=22102#txn-251057">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;17&nbsp;20:26:27&nbsp;2006</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #22102] Test::Builder breaks on &#39;forks&#39; CPAN module</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 17 Oct 2006 17:26:02 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/251057/107875/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/107875">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"> via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This problem is due to the following condition not being met
&gt; &#40;Test::Builder 0.33, line 18&#41;:
&gt; 
&gt;     # Load threads::shared when threads are turned on
&gt;     if&#40; $] &gt;= 5.008 &#38;&#38; $Config{useithreads} &#38;&#38; $INC{&#39;threads.pm&#39;}&#41; {
&gt; 
&gt; which then falls back to the following else case &#40;Test::Builder 0.33,
&gt; line 61&#41;:
&gt; 
&gt;     # 5.8.0&#39;s threads::shared is busted when threads are off.
&gt;     # We emulate it here.
&gt;     else {
&gt;         *share = sub { return $_[0] };
&gt;         *lock  = sub { 0 };
&gt;     }
&gt; 
&gt; This causes the working share and lock functions of forks &#40;and
&gt; forks::shared&#41; to be incorrectly overloaded.
&gt; 
&gt; The simplest and most portable solution to support the forks module
&gt; would be to modify the original condition statement to the following:
&gt; 
&gt;     if&#40; $] &gt;= 5.006 &#38;&#38; $INC{&#39;threads.pm&#39;}&#41; {
&gt; 
&gt; This change would have no negative affect &#40;compilation performance or
&gt; otherwise&#41; to any applications or modules that use Test::Builder.  I
&gt; have included a patch containing this modification with this report.
</div>
If I&#39;m reading that correctly, if the user has threads turned on in 5.6 Test::Builder is going to try and use them.  5.8.0 is bad enough that I&#39;ve already dropped threading support for it in 0.64_01.

Lemme think out loud for a moment.

The original intention of that code was to A&#41; work around the bugs in 5.8.0&#39;s threads::shared, B&#41; 
provide share&#40;&#41; and lock&#40;&#41; for Perls without threads::shared at all, C&#41; avoid bugs in earlier perl&#39;s threading implementations.

But I&#39;ve always said Test::Builder should be as generic as possible and if you want to blow off your own foot go right ahead.  So perhaps the code should allow the user to use threads if available and only the tests skip over threading tests for 5.8.0 and older.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-251058" href="/Public/Bug/Display.html?id=22102#txn-251058">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;17&nbsp;20:26:28&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-251085" href="/Public/Bug/Display.html?id=22102#txn-251085">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;17&nbsp;22:45:16&nbsp;2006</span>
    <span class="description">rybskej [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #22102] Test::Builder breaks on &#39;forks&#39; CPAN module</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 17 Oct 2006 19:44:50 -0700 &#40;PDT&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Eric Rybski &lt;rybskej [...] yahoo.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/251085/107889/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/107889">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- Michael G Schwern via RT &lt;bug-Test-Simple@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=22102">http://rt.cpan.org/Ticket/Display.html?id=22102</a></span> &gt;
&gt; 
&gt; If I&#39;m reading that correctly, if the user has threads turned on in
&gt; 5.6 Test::Builder is going to try and use them.  5.8.0 is bad enough
&gt; that I&#39;ve already dropped threading support for it in 0.64_01.
</div>
Well, perl 5.6 doesn&#39;t have support for native ithreads &#40;threads.pm&#41;
and threads.pm from CPAN will refuse to install on perl 5.6 anyway, so
this would likely not be an issue.

I personally have found native threads.pm to be overally unreliable
&#40;both in memory and stability&#41; when using it with a variety of critical
CPAN modules &#40;such as DBI&#41;.  The goal of the forks module is to
implement the ithreads interface in a way that is portable, stable, and
efficient in memory use from perl 5.6 on up.  My hope is that it will
help give the ithreads interface a second chance for users that wish to
use an accepted, standard threading API in perl.

So my intention is not to complicate matters with your module&#39;s patches
for buggy threads.pm releases, but allow users of the forks module
&#40;such as myself&#41; to write thread-safe tests with your test module
suite.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Lemme think out loud for a moment.
&gt; 
&gt; The original intention of that code was to A&#41; work around the bugs in
&gt; 5.8.0&#39;s threads::shared, B&#41; 
&gt; provide share&#40;&#41; and lock&#40;&#41; for Perls without threads::shared at all,
&gt; C&#41; avoid bugs in earlier perl&#39;s threading implementations.
&gt; 
</div>
Perhaps I ought to insure that forks.pm emulate _all_ elements of a
standard threads.pm environment, including the $Config{useithreads}, to
be as portable as possible with existing &#34;thread-aware&#34; modules.

I&#39;m evaluating having the next forks.pm release override Config.pm and
set a runtime value $Config{useithreads} = 1; thus, the current &#34;if&#34;
statement would work fine for users of perl 5.8 and forks.pm.  I&#39;ve
already got this working in a pre-release and confirmed, with perl
5.8.7, that forks co-exists peacefully with an unmodified
Test::Builder!

That would only leave perl 5.6 users unable to use forks.pm with
Test::Builder with threaded applications.  In all practicality, this
would represent so few users &#40;if any&#41;, that it would likely not be
worth modifying Test::Builder just for them.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; But I&#39;ve always said Test::Builder should be as generic as possible
&gt; and if you want to blow off your own foot go right ahead.  So perhaps
&gt; the code should allow the user to use threads if available and only
&gt; the tests skip over threading tests for 5.8.0 and older.
&gt; 
</div>
Overall, it&#39;s up to your discretion whether a change to Test::Builder
makes sense or not.  Since I&#39;m planning to make the aforementioned
change to forks.pm to allow full &#34;threaded&#34; compatibility with current
and older Test::Builder releases, the only remaining, potentially
affected users would be perl 5.6 users writing threaded test programs
with forks.pm and Thread::Builder.

Thanks for the feedback,
Eric
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-476710" href="/Public/Bug/Display.html?id=22102#txn-476710">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;20&nbsp;15:32:35&nbsp;2008</span>
    <span class="description">hdp [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/476710/235384/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/235384">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 244b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Even taking the Config{useithreads} check out, I still get the &#39;WHOA&#39;
messages from the forks.pm tests.  I don&#39;t really understand the problem
well enough to suggest another fix.

Or are the WHOA messages because of the bug described in #19310?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-477693" href="/Public/Bug/Display.html?id=22102#txn-477693">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;23&nbsp;08:59:56&nbsp;2008</span>
    <span class="description">rybskej [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #22102] Test::Builder breaks on &#39;forks&#39; CPAN module</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 23 Jun 2008 08:52:17 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Eric Rybski&#34; &lt;rybskej [...] yahoo.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/477693/235897/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/235897">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 999b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">WOAH messages are because of bug #19310, and are unrelated to this case.
As of forks 0.21, as long as forks is loaded before any of the Test::*
modules, forks insures that Perl&#39;s Config.pm useithreads flag returns a true
value.  This eliminates the &#34;Test output counter mismatch&#34; errors originally
reported in this case.
Note that it still may not be necessary to check whether
$Config{useithreads} is enabled &#40;as I believe that native threads.pm throws
a terminal error if attempted to be loaded on a non-threaded Perl&#41; since
it&#39;s already checking whether &#34;threads.pm&#34; is in %INC.


On Fri, Jun 20, 2008 at 3:32 PM, Hans Dieter Pearcey via RT &lt;
bug-Test-Simple@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=22102">http://rt.cpan.org/Ticket/Display.html?id=22102</a></span> &gt;
&gt;
&gt; Even taking the Config{useithreads} check out, I still get the &#39;WHOA&#39;
&gt; messages from the forks.pm tests.  I don&#39;t really understand the problem
&gt; well enough to suggest another fix.
&gt;
&gt; Or are the WHOA messages because of the bug described in #19310?
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/477693/235898/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/235898">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.5k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1679276" href="/Public/Bug/Display.html?id=22102#txn-1679276">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;28&nbsp;15:44:01&nbsp;2016</span>
    <span class="description">exodist7 [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1679276/901296/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/901296">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jun 23 05:59:56 2008, rybskej@yahoo.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; WOAH messages are because of bug #19310, and are unrelated to this case.
&gt; As of forks 0.21, as long as forks is loaded before any of the Test::*
&gt; modules, forks insures that Perl&#39;s Config.pm useithreads flag returns a true
&gt; value.  This eliminates the &#34;Test output counter mismatch&#34; errors originally
&gt; reported in this case.
&gt; Note that it still may not be necessary to check whether
&gt; $Config{useithreads} is enabled &#40;as I believe that native threads.pm throws
&gt; a terminal error if attempted to be loaded on a non-threaded Perl&#41; since
&gt; it&#39;s already checking whether &#34;threads.pm&#34; is in %INC.
&gt; 
&gt; 
&gt; On Fri, Jun 20, 2008 at 3:32 PM, Hans Dieter Pearcey via RT &lt;
&gt; bug-Test-Simple@rt.cpan.org&gt; wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=22102">http://rt.cpan.org/Ticket/Display.html?id=22102</a></span> &gt;
&gt; &gt;
&gt; &gt; Even taking the Config{useithreads} check out, I still get the &#39;WHOA&#39;
&gt; &gt; messages from the forks.pm tests.  I don&#39;t really understand the problem
&gt; &gt; well enough to suggest another fix.
&gt; &gt;
&gt; &gt; Or are the WHOA messages because of the bug described in #19310?
&gt; &gt;
</div></div>
Closing this ticket for now. If this is still a problem and needs to be addressed please submit an example test failure, and a new ticket on github.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1679324" href="/Public/Bug/Display.html?id=22102#txn-1679324">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;28&nbsp;15:58:06&nbsp;2016</span>
    <span class="description">exodist7 [...] gmail.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.470802</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
