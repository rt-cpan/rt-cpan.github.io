<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #102676 for Var-Pairs: each_kv used on array-of-hashrefs</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #102676 for Var-Pairs: each_kv used on array-of-hashrefs</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Var-Pairs">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Var-Pairs">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Var-Pairs">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Var-Pairs">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Var-Pairs">Var-Pairs CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">102676</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Var-Pairs">Var-Pairs</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jep5m [...] virginia.edu

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-244808-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-244809-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=102676">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1471996" href="/Public/Bug/Display.html?id=102676#txn-1471996">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;10&nbsp;12:39:55&nbsp;2015</span>
    <span class="description">jep5m [...] virginia.edu -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> each_kv used on array-of-hashrefs</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 10 Mar 2015 12:39:45 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Var-Pairs [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Pickard &lt;jep5m [...] virginia.edu&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1471996/783766/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/783766">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

First, thank you for publishing Var::Pairs - very exciting.

I think I may have identified an issue with using each_kv&#40;&#41; as a drop-in
replacement for the built-in each. Here&#39;s a test case, the first example is
the way we are currently using each, then there&#39;s a version using the
drop-in replacement. The drop-in replacement doesn&#39;t work as expected, it
does not appear to iterate over the next hashref element in the arrayref

I did use strict / use warnings and use Var::Pairs qw&#40;each_kv&#41;; for all of
these tests.

######## Current with each keyword, need to reset iterators with keys
keyword
my $test3 = [
   { a =&gt; 1 },
   { b =&gt; 2 },
   { c =&gt; 3 },
];

foreach my $hash &#40; @{$test3} &#41; {
   my &#40;$key, $val&#41; = each %$hash;
   keys %$hash;
   print &#34;Got $key =&gt; $val\n&#34;;
}

foreach my $hash &#40; @{$test3} &#41; {
   my &#40;$key, $val&#41; = each %$hash;
   keys %$hash;
   print &#34;Got $key =&gt; $val\n&#34;;
}

######## Drop-in replacement: each_kv does not iterate over the 2nd hash
element in $test3
my $test3 = [
   { a =&gt; 1 },
   { b =&gt; 2 },
   { c =&gt; 3 },
];

foreach my $hash &#40; @{$test3} &#41; {
   my &#40;$key, $val&#41; = each_kv %$hash;
   print &#34;Got $key =&gt; $val\n&#34;;
}

foreach my $hash &#40; @{$test3} &#41; {
   my &#40;$key, $val&#41; = each_kv %$hash;
    print &#34;Got $key =&gt; $val\n&#34;;
}
########### END


It looks like in the second loop through the first foreach, each_kv is
still working on the first $hash in @$test3. Actually, I can verify that
statement by adding a second key/value to the first hash in @$test:

#### Add second key/value
my $test3 = [
   { a =&gt; 1, a1 =&gt; 3 },
   { b =&gt; 2 },
   { c =&gt; 3 },
];

foreach my $hash &#40; @{$test3} &#41; {
   my &#40;$key, $val&#41; = each_kv %$hash;
   print &#34;Got $key =&gt; $val\n&#34;;
}

### Output
Got a =&gt; 1
Got a1 =&gt; 3
Use of uninitialized value $key in concatenation &#40;.&#41; or string at ...

### Output from using each and keys to reset the iterator:
Got a =&gt; 1
Got b =&gt; 2
Got c =&gt; 3


Best,
John
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1471996/783767/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/783767">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.4k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1472153" href="/Public/Bug/Display.html?id=102676#txn-1472153">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;11&nbsp;05:26:11&nbsp;2015</span>
    <span class="description">damian [...] conway.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #102676] each_kv used on array-of-hashrefs</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 11 Mar 2015 10:25:19 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Var-Pairs [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Damian Conway &lt;damian [...] conway.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1472153/783853/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/783853">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the report, John.

This is in fact a documentation bug, as the module is working
the way it&#39;s intended &#40;i.e. each_kv&#40;&#41; is not intended to be
resettable by calling keys&#40;&#41;...or by any other mechanism&#41;.

I have updated the documentation to reflect this:

    In other words, C&lt;each_kv&#40;&#41;&gt; is a drop-in replacement for Perl&#39;s
    built-in C&lt;each&#40;&#41;&gt;, with two exceptions: one an advantage, the other
    a limitation. The advantage is that you can nest C&lt;each_kv&#40;&#41;&gt;
    iterations over the same variable without shooting yourself in the
    foot. The limitation is that, unlike C&lt;each&#40;&#41;&gt;, C&lt;each_kv&#40;&#41;&gt; does
    not reset when you call the C&lt;keys&#40;&#41;&gt; function on the hash you&#39;re
    iterating.

    C&lt;each_kv&#40;&#41;&gt; acts like a true one-time only iterator &#40;in the OO
    sense&#41;, so there is no way to reset its iteration &#40;i.e. the way that
    calling C&lt;keys&#40;&#41;&gt; on a hash or array, resets any C&lt;each&#40;&#41;&gt; that is
    iterating it&#41;. If you need to reset partially iterated hashes or
    arrays, you will need to use some other mechanism to do so.

I&#39;m sorry that the module does not meet this need for you. I will look
into whether I can change the implementation to support the behaviour
&#40;though clearly not via keys&#40;&#41; in any case&#41;, but at the moment I don&#39;t see
any obvious way to do so. The whole point is to isolate iteration from the
hash/array being iterated, so being able to alter the iteration by modifying
the variable is entirely against the module&#39;s fundamental concept.

I do, however appreciate the feedback.

All the best,

Damian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1472154" href="/Public/Bug/Display.html?id=102676#txn-1472154">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;11&nbsp;05:26:12&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1472157" href="/Public/Bug/Display.html?id=102676#txn-1472157">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;11&nbsp;05:27:50&nbsp;2015</span>
    <span class="description">DCONWAY [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1472330" href="/Public/Bug/Display.html?id=102676#txn-1472330">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;11&nbsp;11:16:54&nbsp;2015</span>
    <span class="description">jep5m [...] virginia.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #102676] each_kv used on array-of-hashrefs</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 11 Mar 2015 11:16:41 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Var-Pairs [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Pickard &lt;jep5m [...] virginia.edu&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1472330/783983/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/783983">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Damian,

Thank you for clarification of how each_kv interacts with keys. I think we
can work around our need to reset the iterator.

However, I am still confused about the behavior in the following test. I
would expect the foreach loop to print one key/value for each hashref in
$test. However, the second time through the loop prints not a key/value
from the second hash, but a second key/value from the first hash.

my $test = [
   { a =&gt; 1, a1 =&gt; 3 },
   { b =&gt; 2 },
   { c =&gt; 3 },
];

foreach my $hash &#40; @$test &#41; {
   my &#40;$key, $val&#41; = each_kv %$hash;
   print &#34;Got $key =&gt; $val\n&#34;;
}

########## OUTPUT
Got a =&gt; 1
Got a1 =&gt; 3
Use of uninitialized value $key in concatenation &#40;.&#41; or string at ...


Best,
John


On Wed, Mar 11, 2015 at 5:26 AM, damian@conway.org via RT &lt;
bug-Var-Pairs@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=102676">https://rt.cpan.org/Ticket/Display.html?id=102676</a></span> &gt;
&gt;
&gt; Thanks for the report, John.
&gt;
&gt; This is in fact a documentation bug, as the module is working
&gt; the way it&#39;s intended &#40;i.e. each_kv&#40;&#41; is not intended to be
&gt; resettable by calling keys&#40;&#41;...or by any other mechanism&#41;.
&gt;
&gt; I have updated the documentation to reflect this:
&gt;
&gt;     In other words, C&lt;each_kv&#40;&#41;&gt; is a drop-in replacement for Perl&#39;s
&gt;     built-in C&lt;each&#40;&#41;&gt;, with two exceptions: one an advantage, the other
&gt;     a limitation. The advantage is that you can nest C&lt;each_kv&#40;&#41;&gt;
&gt;     iterations over the same variable without shooting yourself in the
&gt;     foot. The limitation is that, unlike C&lt;each&#40;&#41;&gt;, C&lt;each_kv&#40;&#41;&gt; does
&gt;     not reset when you call the C&lt;keys&#40;&#41;&gt; function on the hash you&#39;re
&gt;     iterating.
&gt;
&gt;     C&lt;each_kv&#40;&#41;&gt; acts like a true one-time only iterator &#40;in the OO
&gt;     sense&#41;, so there is no way to reset its iteration &#40;i.e. the way that
&gt;     calling C&lt;keys&#40;&#41;&gt; on a hash or array, resets any C&lt;each&#40;&#41;&gt; that is
&gt;     iterating it&#41;. If you need to reset partially iterated hashes or
&gt;     arrays, you will need to use some other mechanism to do so.
&gt;
&gt; I&#39;m sorry that the module does not meet this need for you. I will look
&gt; into whether I can change the implementation to support the behaviour
&gt; &#40;though clearly not via keys&#40;&#41; in any case&#41;, but at the moment I don&#39;t see
&gt; any obvious way to do so. The whole point is to isolate iteration from the
&gt; hash/array being iterated, so being able to alter the iteration by
&gt; modifying
&gt; the variable is entirely against the module&#39;s fundamental concept.
&gt;
&gt; I do, however appreciate the feedback.
&gt;
&gt; All the best,
&gt;
&gt; Damian
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1472330/783984/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/783984">with headers</a>
<br />
<span class="downloadcontenttype">text/html 3.2k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1472408" href="/Public/Bug/Display.html?id=102676#txn-1472408">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;11&nbsp;15:15:40&nbsp;2015</span>
    <span class="description">damian [...] conway.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #102676] each_kv used on array-of-hashrefs</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 11 Mar 2015 20:14:49 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Var-Pairs [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Damian Conway &lt;damian [...] conway.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1472408/784051/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/784051">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 165b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi John,

Now that one really *is* a bug.

I&#39;ve just uploaded a new release of Var::Pairs &#40;version 0.002002&#41;
that fixes the problem.

Very much appreciated!

Damian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1474089" href="/Public/Bug/Display.html?id=102676#txn-1474089">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;16&nbsp;13:50:57&nbsp;2015</span>
    <span class="description">jep5m [...] virginia.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #102676] each_kv used on array-of-hashrefs</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 16 Mar 2015 13:50:42 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Var-Pairs [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Pickard &lt;jep5m [...] virginia.edu&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1474089/785035/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/785035">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Damian,

Thanks for the quick turn around on that!

I&#39;m sorry for continuing to dwell on this, but I&#39;m still a little confused
about how each_kv behaves. In the following example each_kv keeps its
iteration state for each call to the get_one_kv sub. On the other hand,
built-in each will create a new iterator for every call to get_one_kv.
Since each_kv is lexically scoped iterator, I would&#39;ve thought iteration
over %hash would reset once the sub exits &#40;not to mention each_kv is
iterating over a lexically scoped hash for each call&#41;.

sub get_one_kv {
   my %hash= &#40;
      a =&gt; 1,
      b =&gt; 2,
      c =&gt; 3
   &#41;;
   my &#40;$key, $val&#41; = each_kv&#40;%hash&#41;;
   print &#34;got $key =&gt; $val\n&#34;;
   return &#40;$key, $val&#41;;
}

get_one_kv_no_args&#40;&#41;;
get_one_kv_no_args&#40;&#41;;
get_one_kv_no_args&#40;&#41;;

### each_kv output
got c =&gt; 3
got a =&gt; 1
got b =&gt; 2


### replace each_kv with each: output
got c =&gt; 3
got c =&gt; 3
got c =&gt; 3

#######


I realize this is not the intended use of each_kv. I&#39;m trying to more fully
understand each_kv&#39;s behavior so that I can recommend to our development
group that we use each_kv instead of each. So my tests are beyond our
typical use cases. The behavior of each_kv is similar to built-in each when
each_kv is used in a while loop:

sub get_one_kv_while {
   my %hash= &#40;
      a =&gt; 1,
      b =&gt; 2,
      c =&gt; 3
   &#41;;
   while &#40; my &#40;$key, $val&#41; = each_kv&#40;%hash&#41; &#41; {
      print &#34;got $key =&gt; $val\n&#34;;
      return &#40;$key, $val&#41;;
   }
}

get_one_kv_while&#40;&#41;;
get_one_kv_while&#40;&#41;;
get_one_kv_while&#40;&#41;;

#### output
got c =&gt; 3
got c =&gt; 3
got c =&gt; 3


Best,
John



On Wed, Mar 11, 2015 at 3:15 PM, damian@conway.org via RT &lt;
bug-Var-Pairs@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=102676">https://rt.cpan.org/Ticket/Display.html?id=102676</a></span> &gt;
&gt;
&gt; Hi John,
&gt;
&gt; Now that one really *is* a bug.
&gt;
&gt; I&#39;ve just uploaded a new release of Var::Pairs &#40;version 0.002002&#41;
&gt; that fixes the problem.
&gt;
&gt; Very much appreciated!
&gt;
&gt; Damian
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1474089/785036/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/785036">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.8k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1475440" href="/Public/Bug/Display.html?id=102676#txn-1475440">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;19&nbsp;15:32:22&nbsp;2015</span>
    <span class="description">damian [...] conway.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #102676] each_kv used on array-of-hashrefs</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 19 Mar 2015 20:31:32 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Var-Pairs [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Damian Conway &lt;damian [...] conway.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1475440/785813/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/785813">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi John,

You asked about the behaviour of:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; sub get_one_kv {
&gt;    my %hash= &#40;
&gt;       a =&gt; 1,
&gt;       b =&gt; 2,
&gt;       c =&gt; 3
&gt;    &#41;;
&gt;    my &#40;$key, $val&#41; = each_kv&#40;%hash&#41;;
&gt;    print &#34;got $key =&gt; $val\n&#34;;
&gt;    return &#40;$key, $val&#41;;
&gt; }
</div>
The each_kv does not reset because in your example
each call to get_one_kv recreates the %hash variable
with the same memory address. Thus each_kv treats it
as the same variable each time, and so continues iterating.

But each time get_one_kv is called, the %hash is recreated
with a reset internal hash iterator, so each&#40;&#41; restarts each call.

Which behaviour is &#34;correct&#34; depends on what behaviour you
want.

A given call to each_kv&#40;&#41; when passed a variable with the same memory
address continues to iterate the variable that was passed in the
original call to each_kv&#40;&#41;, even if the variable&#39;s contents or other
state information have changed subsequently. That may not always
be desirable, but it&#39;s hard to see how each_kv&#40;&#41; can tell the difference
between two variables of the same name at the same memory location
&#40;given that it doesn&#39;t have access to the internals of the hash&#41;.

Hope this clarifies,

Damian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1477853" href="/Public/Bug/Display.html?id=102676#txn-1477853">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;24&nbsp;13:20:32&nbsp;2015</span>
    <span class="description">jep5m [...] virginia.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #102676] each_kv used on array-of-hashrefs</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 24 Mar 2015 13:20:19 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Var-Pairs [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Pickard &lt;jep5m [...] virginia.edu&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1477853/787153/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/787153">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Damian,

Thanks. This is helpful.

On Thu, Mar 19, 2015 at 3:32 PM, damian@conway.org via RT &lt;
bug-Var-Pairs@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=102676">https://rt.cpan.org/Ticket/Display.html?id=102676</a></span> &gt;
&gt;
&gt; Hi John,
&gt;
&gt; You asked about the behaviour of:
&gt;
<div class="message-stanza open">&gt; &gt; sub get_one_kv {
&gt; &gt;    my %hash= &#40;
&gt; &gt;       a =&gt; 1,
&gt; &gt;       b =&gt; 2,
&gt; &gt;       c =&gt; 3
&gt; &gt;    &#41;;
&gt; &gt;    my &#40;$key, $val&#41; = each_kv&#40;%hash&#41;;
&gt; &gt;    print &#34;got $key =&gt; $val\n&#34;;
&gt; &gt;    return &#40;$key, $val&#41;;
&gt; &gt; }
</div>&gt;
&gt; The each_kv does not reset because in your example
&gt; each call to get_one_kv recreates the %hash variable
&gt; with the same memory address. Thus each_kv treats it
&gt; as the same variable each time, and so continues iterating.
&gt;
&gt; But each time get_one_kv is called, the %hash is recreated
&gt; with a reset internal hash iterator, so each&#40;&#41; restarts each call.
&gt;
&gt; Which behaviour is &#34;correct&#34; depends on what behaviour you
&gt; want.
&gt;
&gt; A given call to each_kv&#40;&#41; when passed a variable with the same memory
&gt; address continues to iterate the variable that was passed in the
&gt; original call to each_kv&#40;&#41;, even if the variable&#39;s contents or other
&gt; state information have changed subsequently. That may not always
&gt; be desirable, but it&#39;s hard to see how each_kv&#40;&#41; can tell the difference
&gt; between two variables of the same name at the same memory location
&gt; &#40;given that it doesn&#39;t have access to the internals of the hash&#41;.
&gt;
&gt; Hope this clarifies,
&gt;
&gt; Damian
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1477853/787154/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/787154">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.479756</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
