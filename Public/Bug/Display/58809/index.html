<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #58809 for Test-Harness: Re: Perl 5.12.1 build report</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #58809 for Test-Harness: Re: Perl 5.12.1 build report</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Test-Harness">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Test-Harness">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Test-Harness">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Test-Harness">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Test-Harness">Test-Harness CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">58809</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">deleted</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Test-Harness">Test-Harness</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
wb8tyw [...] qsl.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31430-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31431-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=58809">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-796524" href="/Public/Bug/Display.html?id=58809#txn-796524">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;24&nbsp;21:24:29&nbsp;2010</span>
    <span class="description">wb8tyw [...] qsl.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> &#34;John E. Malmberg&#34; &lt;wb8tyw [...] qsl.net&gt;, Mark Berryman &lt;mark [...] theberrymans.com&gt;, vmsperl [...] perl.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: Perl 5.12.1 build report</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 24 Jun 2010 20:24:08 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;Craig A. Berry&#34; &lt;craigberry [...] mac.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;John E. Malmberg&#34; &lt;wb8tyw [...] qsl.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/796524/412951/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/412951">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 5.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 6/24/2010 7:15 PM, Craig A. Berry wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; On Jun 24, 2010, at 5:54 PM, John E. Malmberg wrote:
&gt;
<div class="message-stanza open">&gt;&gt; On 6/24/2010 2:03 PM, Mark Berryman wrote:
<div class="message-stanza open">&gt;&gt;&gt;
&gt;&gt;&gt; Link /NoTrace/NoMap/Trace/Exe=MINIPERL.EXE miniperlmain.obj,
&gt;&gt;&gt; libperlmini.olb/Library/Include=globals ,[]crtl.opt/Options
&gt;&gt;&gt; %ILINK-W-NOSUCHMOD, module GLOBALS not found
&gt;&gt;&gt; in library USERS:[BERRYMAN.PERL-5_12_1]LIBPERLMINI.OLB;1
&gt;&gt;&gt; %ILINK-W-NUDFSYMS, 8 undefined symbols:
&gt;&gt;&gt; %ILINK-I-UDFSYM, lib$find_image_symbol
&gt;&gt;&gt; %ILINK-I-UDFSYM, lib$initialize
&gt;&gt;&gt; %ILINK-I-UDFSYM, lib$rename_file
&gt;&gt;&gt; %ILINK-I-UDFSYM, sys$filescan
&gt;&gt;&gt; %ILINK-I-UDFSYM, sys$get_security
&gt;&gt;&gt; %ILINK-I-UDFSYM, sys$getdviw
&gt;&gt;&gt; %ILINK-I-UDFSYM, sys$set_security
&gt;&gt;&gt; %ILINK-I-UDFSYM, sys$sigprc
</div>&gt;&gt;
&gt;&gt; Those undefined symbols should be easy to fix, they just need to be
&gt;&gt; declared in upper case in the source file. I am trying to remember if
&gt;&gt; I submitted a patch to do that before.
&gt;&gt;
&gt;&gt; Unfortunately the system header files for defining those routines is
&gt;&gt; generated by a program that has not been updated to properly generate
&gt;&gt; function prototypes from the source file it uses. That is why I never
&gt;&gt; use that file, and instead manually prototype the system services. The
&gt;&gt; proper prototypes make several common programming errors to be
&gt;&gt; detected by the compiler.
&gt;&gt;
</div>&gt;
&gt; Well, whatever the &#34;proper&#34; prototypes are, several of the prototypes in
&gt; [.vms]vms.c have type mismatches compared to the prototypes in the
&gt; system-supplied headers. The only reason we don&#39;t see the mismatches all
&gt; the time is because the system headers have #defines to make the routine
&gt; names upper case as seen by the compiler and vms.c doesn&#39;t. If we add
&gt; #defines like that in vms.c, then the compiler sees that the functions
&gt; are the same ones already prototyped in lib$routines.h or starlet.h and
&gt; knows that we&#39;re providing incompatible prototypes.
&gt;
&gt; So I think these home-rolled prototypes have to go. It&#39;s the system&#39;s
&gt; job to prototype system-supplied routines in the system-supplied
&gt; headers. Trying to second guess that just makes the code more fragile. I
&gt; don&#39;t know of any way to undo a prototype the compiler has already seen,
&gt; and I&#39;m not about to take on the maintenance burden of keeping up our
&gt; own versions of starlet.h and lib$routines.h so that we can prevent the
&gt; compiler from seeing the system-supplied prototypes.
</div>
Unfortunately the system prototypes for lib$* and sys$* are not much 
better than no prototypes at all.  They tend to use void * and 
&#39;__unknown_params&#39; instead of the type that the program is likely to 
supply, and they are missing the const qualifiers.

Unfortunately that tool was written to generate headers for K &#38; R, and 
has never been updated to generate proper ANSI definitions.

It may be the systems job to provide the correct headers, and it does 
for the structures and the constants, but in my opinion it is not doing 
the job correctly for the sys$* and lib$* routines.  Setting the 
__NEW_STARLET macro fixes some but not all the issues for starlet.h, 
however code that needs to build on older versions of VMS can not depend 
on that macro working.

Those definitions are limited to header files named starlet.h and 
*$routines.h and with the home rolled definitions, there is no reason to 
include them, as all they have is almost useless prototypes.

If the home rolled ones are generating errors, then either they should 
be fixed or the code calling them is not using the correct types and 
should be fixed.  When used properly they will catch programming errors, 
and they can also help the compiler create more optimal code, even when 
building on the oldest version of VMS that perl can be built on.

I filed an enhancement request to get the tool that generates the system 
headers fixed, but have no idea if or when VMS engineering will get to 
it.  The source file used to generate the headers has the needed 
information, and the tool generates the prototype equivalent for other 
languages correctly.

One reason given for not enhancing the tool is that there is existing 
code depending on the incomplete prototypes.  But that can be handled by 
having a macro definition similar to the NEW_STARLET.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; The code that currently uses LIB$FIND_IMAGE_SYMBOL needs to be updated
&gt;&gt; to do the following:
&gt;&gt;
&gt;&gt; 1. If the symbol is over 31 characters:
&gt;&gt; a. Try loading it in exact case but CRC shortened the way the
&gt;&gt; C compiler does.
&gt;&gt; b. Try loading it in upper case but CRC shortened the way the
&gt;&gt; C compiler does.
&gt;&gt; c. Try loading it in exact case but truncated to 31 characters.
&gt;&gt; d. Try loading it in upper case but truncated to 31 characters.
&gt;&gt; 2. For symbols 31 characters or less, try looking for it in exact case
&gt;&gt; first and then in all upper case.
</div>&gt;
&gt; We have complete control over how the symbols are created at build time.
&gt; I can&#39;t see any good reason to add this level of complexity and
&gt; processing at run time.
</div>
It gives us more flexibility in what images that we can dynamically 
load.  It will also allow the eventual retirement of VMS specific code 
in the XS generation instead of trying to keep it in sync when there are 
changes, and it avoids issues like Mark is seeing.

-John
wb8tyw@qsl.network
Personal Opinion Only
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-802319" href="/Public/Bug/Display.html?id=58809#txn-802319">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;10&nbsp;13:19:16&nbsp;2010</span>
    <span class="description">andy [...] hexten.net -  Ticket deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.198906</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
