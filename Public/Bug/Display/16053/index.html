<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #16053 for Tk: gtk2 &gt; 2.8.0 apps are causing segfaults in Tk , with   readv&#40;3, [{&#34;_GTK_LOAD_ICONTHEMES&#34;, 20},</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #16053 for Tk: gtk2 &gt; 2.8.0 apps are causing segfaults in Tk , with   readv&#40;3, [{&#34;_GTK_LOAD_ICONTHEMES&#34;, 20},</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Tk/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Tk/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Tk/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Tk/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Tk">Tk CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">16053</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">1 hour (60 min)

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Tk/Active/">Tk</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
zentara [...] zentara.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-33610-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
804.027    </td>
  </tr>
  <tr id="CF-33611-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;23&nbsp;07:59:59&nbsp;2005</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> gtk2 &gt; 2.8.0 apps are causing segfaults in Tk , with   readv&#40;3,
 [{&#34;_GTK_LOAD_ICONTHEMES&#34;, 20},</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Start any Perl/Tk app.  If you have gtk+-2.8.7 installed, run gtk-demo. Click on Button Boxes to run it&#39;s demo, the Perl/Tk app will segfault. If you restart the Perl/Tk app, subsequent clicking of Button Box will NOT segfault Tk. Only the first time does it. I ran strace on the Perl/Tk apps, and when it segfaults, the line readv&#40;3, [{&#34;_GTK_LOAD_ICONTHEMES&#34;, 20}, {&#34;&#34;, 0}], 2&#41; = 20  always appears in strace before the crash. When I revert to earlier Gtk2 versions, say 2.8.0, it does not occur.  I first noticed this when getting mail with sylpheed-claws would crash my running Tk apps.  It does NOT crash Tcl/Tk apps, so it must be in the Perl/Tk conversion. I have seen this on ICEWM and KDE under OpenSuSE 10, and on my customized Slackware system, running the very latest libraries...glibc2.3.6, gcc-4.02, latest gtk+ libs.
I have reported this to the gtk2 people, but they claim that it is a Perl/Tk bug
since it is the Tk program which crashes.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;30&nbsp;14:29:04&nbsp;2005</span>
    <span class="description">nick [...] ing-simmons.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #16053] gtk2 &gt; 2.8.0 apps are causing segfaults in Tk ,with   readv&#40;3, [{&#34;_GTK_LOAD_ICONTHEMES&#34;, 20},</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Tk [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 30 Nov 2005 19:28:20 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Nick Ing-Simmons &lt;nick [...] ing-simmons.net&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-Cc:</td>
    <td class="message-header-value"> </td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Guest via RT &lt;bug-Tk@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;This message about Tk was sent to you by guest &lt;&gt; via rt.cpan.org
&gt;
&gt;Full context and any attached attachments can be found at: &lt;URL:
&gt;<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=16053">https://rt.cpan.org/Ticket/Display.html?id=16053</a></span> &gt;
&gt;
&gt;Start any Perl/Tk app. If you have gtk+-2.8.7 installed, run gtk-demo. Click
&gt;on Button Boxes to run it&#39;s demo, the Perl/Tk app will segfault. If you
&gt;restart the Perl/Tk app, subsequent clicking of Button Box will NOT segfault
&gt;Tk. Only the first time does it. I ran strace on the Perl/Tk apps, and when it
&gt;segfaults, the line readv&#40;3, [{&#34;_GTK_LOAD_ICONTHEMES&#34;, 20}, {&#34;&#34;, 0}], 2&#41; = 20
&gt;always appears in strace before the crash. When I revert to earlier Gtk2
&gt;versions, say 2.8.0, it does not occur. I first noticed this when getting mail
&gt;with sylpheed-claws would crash my running Tk apps. It does NOT crash Tcl/Tk
&gt;apps, so it must be in the Perl/Tk conversion. I have seen this on ICEWM and
&gt;KDE under OpenSuSE 10, and on my customized Slackware system, running the very
&gt;latest libraries...glibc2.3.6, gcc-4.02, latest gtk+ libs. I have reported
&gt;this to the gtk2 people, but they claim that it is a Perl/Tk bug since it is
&gt;the Tk program which crashes.
</div>
As one toolkit is crashing another my guess is that GTK has put something 
in a X Property that per/Tk does not like.
As it is a SEGV I am guessing that something that has been marked as a 32-bit
property &#40;or perhaps perk/Tk has _assumed_ is 32 bit&#41; has a number of 
bytes which isn&#39;t a multiple of 4.

Is file handle 3 that is being readv&#40;&#41;ed the X socket &#40;further back strace&#41;.
Or as it SEGVs if by chance you can get a backtrace from gdb 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;03&nbsp;16:10:03&nbsp;2005</span>
    <span class="description">NI-S [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Thanks for more-of the strace. As both read/write are happening 
to fd=4 &#40;number changed in last post&#41; it is likely the X socket,
but if you still have the _full_ trace to hand if you can 
look for a call like:

socket&#40;PF_FILE, SOCK_STREAM, 0&#41;         = 4

to confirm that it might help.

How do I tell which version of gtk2 I have?
This seems to suggest I have 2.4.9 ?
  nick@llama:/home/p4work/Tkutf8&gt; grep -i version          
  /opt/gnome/lib/pkgconfig/gtk+-2.0.pc
  gtk_binary_version=2.4.0
  Version: 2.4.9
  nick@llama:/home/p4work/Tkutf8&gt;               

&#40;I have SuSE9.2 + pile of online-updates, but SuSE don&#39;t use bleading
edge.&#41; 

Given that I seem to be way behind and not really a Gnome hacker
I am reluctant to install anything as I don&#39;t know what 
goes where or depends on what.

So gdb back trace would still be a help, But that really needs 
a perl &#40;and hence a Tk&#41; built with -g &#40;I usually use -O2 -g&#41;
to be really helpful, but even function name trace you should 
get without -g may be a hint.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;03&nbsp;17:11:02&nbsp;2005</span>
    <span class="description">NI-S [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Hmm, If I have read Xproto.h correctly

read&#40;4, &#34;\241 b\16\1\0\300\0\306\1\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0&#34;...,
32&#41; = 32

That is a ClientMessage Event 
   \2xx is Event
   \41 = Decimal 33 = ClientMessage
   &#39; &#39; is just a padding byte
   b\16 is sequence number
   \1\0\300\0  is Window
   \0\306\1\0  is Atom which identifies Message  

So will take a look at what Tk does when it gets unexpected 
ClientMessage-s.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;03&nbsp;17:35:02&nbsp;2005</span>
    <span class="description">NI-S [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
1st attempt to fix:

In tkGlue.c near line 4580 
&#40;in function LangClientMessage&#41; is:

 if &#40;!SvROK&#40;w&#41;&#41;
  {
   Tk_Window mainwin = &#40;Tk_Window&#41;&#40;&#40;&#40;&#40;TkWindow*&#41;tkwin&#41;-&gt;mainPtr&#41;-&gt;winPtr&#41;;
   w = TkToWidget&#40;mainwin,NULL&#41;;
  }

Please try changing that to 

 if &#40;!SvROK&#40;w&#41; &#38;&#38; tkwin&#41;
  {
   Tk_Window mainwin = &#40;Tk_Window&#41;&#40;&#40;&#40;&#40;TkWindow*&#41;tkwin&#41;-&gt;mainPtr&#41;-&gt;winPtr&#41;;
   w = TkToWidget&#40;mainwin,NULL&#41;;
  }

I suspect gtk is sending the &#34;_GTK_LOAD_ICON_THEME&#34; message 
to one of perl/Tk&#39;s X windows which don&#39;t correspond 
to Tk widgets. So core Tk has failed to find a &#34;tkwin&#34; 
and perl glue code&#39;s attempt to locate MainWindow is doomed.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;17&nbsp;11:54:34&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ben Crowell</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  if &#40;!SvROK&#40;w&#41; &#38;&#38; tkwin&#41;
</div>
I&#39;ve applied this patch, and it doesn&#39;t fix the problem. According to
gdb, the crash is inside Tk_HandleEvent&#40;&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;17&nbsp;12:15:53&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ben Crowell</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The following patch to tkEvent.c cures the crashes:

  if &#40;eventPtr &#38;&#38; winPtr &#38;&#38; winPtr-&gt;mainPtr&#41; {
    LangClientMessage&#40;winPtr-&gt;mainPtr-&gt;interp, &#40;Tk_Window&#41; winPtr,
                                      eventPtr&#41;;
  }

However, I don&#39;t know if the patch
is sufficient, because I don&#39;t understand all the surrounding code.
It could be that omitting the call to LangClientMessage causes
a loss of integrity to Perl/Tk&#39;s data, for instance.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;29&nbsp;07:48:14&nbsp;2005</span>
    <span class="description">NI-S [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">60 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Latest patch has been confirmed as a fix.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;29&nbsp;07:48:15&nbsp;2005</span>
    <span class="description">NI-S [...] cpan.org -  Status changed from &#39;new&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;24&nbsp;06:41:12&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> m_lin.nooning [...] comcast.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Dec 29 07:48:14 2005, NI-S wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Latest patch has been confirmed as a fix.
</div>
I added the patch.  However, I still get a Segmentation Fault within 20
button clicks of the short script I am pasting below, on at least two
Linux variants.  Doing a Google search for &#34;Segmentation fault after
destroying non-dependent window&#34; will reveal that this is a problem on a
number of Linux platforms.  It works fine on Windows. 

#!/usr/bin/perl -w
# File test_pop_up_a_message.pl

use Tk;
use strict;

our $answer = &#34;okay&#34;;

############
sub response {
  my &#40;$we_top, $button_response&#41; = @_;

  $we_top-&gt;destroy;
  $answer = $button_response;

}
############
sub pop_up_a_message {
  my &#40;$message&#41; = @_;

  my $okay_button;
  my $exit_button;
  print&#40;&#34;Can allways see\n&#34;&#41;;
  my $we_top = new MainWindow;
  print&#40;&#34;Cannot see if Segmentation fault\n&#34;&#41;;

  $we_top-&gt;Label &#40; -text =&gt; $message&#41;-&gt;pack&#40;&#41;;

  #.........
  $okay_button =
      $we_top-&gt;Button&#40;  -text =&gt; &#39;Okay&#39;,
                        -command =&gt; [  \&#38;response,
                                       $we_top,
                                       &#39;okay&#39;
                                    ]
                      &#41;-&gt;pack&#40;&#41;;
  #.........
  $exit_button =
      $we_top-&gt;Button&#40;  -text =&gt; &#39;Exit&#39;,
                        -command =&gt; [  \&#38;response,
                                       $we_top,
                                      &#39;exit&#39;
                                    ]
                      &#41;-&gt;pack&#40;&#41;;
  #.........

  
  $we_top-&gt;MainLoop;
  

}
############

my $message = &#34;&#34;;
my $count = 1;


while &#40;$answer eq &#34;okay&#34;&#41; {
  $message = 
      &#34;  On at least Slackware and Mandriva, Perl 5.8.7 or 5.8.8, this
code will\n&#34;   .
      &#34;  get a Segmentation fault within 20 clicks of Okay  \n &#34; . 
      $count++ . &#34;\n&#34;;
  pop_up_a_message&#40;$message&#41;;
  print &#40;&#34;You pressed $answer\n&#34;&#41;;
}
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;24&nbsp;06:41:13&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;24&nbsp;08:54:50&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> zentara [...] zentara.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Feb 24 06:41:12 2006, guest wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Dec 29 07:48:14 2005, NI-S wrote:
<div class="message-stanza open">&gt; &gt; 
&gt; &gt; Latest patch has been confirmed as a fix.
</div>&gt; 
&gt; I added the patch.  However, I still get a Segmentation Fault within 20
&gt; button clicks of the short script I am pasting below, on at least two
&gt; Linux variants.  Doing a Google search for &#34;Segmentation fault after
&gt; destroying non-dependent window&#34; will reveal that this is a problem on a
&gt; number of Linux platforms.  It works fine on Windows. 
</div>
Hi, I think you posted this bug under the wrong category. This bug
thread was caused by Gtk2 apps interfering with Tk. Your problem dosn&#39;t
even mention Gtk2. By the way, I ran your script without any segfaults,
many times. I&#39;m using linux on a customized slackware.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;24&nbsp;09:37:38&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> zentara [...] zentara.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Feb 24 06:41:12 2006, guest wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Dec 29 07:48:14 2005, NI-S wrote:
<div class="message-stanza open">&gt; &gt; 
&gt; &gt; Latest patch has been confirmed as a fix.
</div>&gt; 
&gt; I added the patch.  However, I still get a Segmentation Fault within 20
&gt; button clicks of the short script I am pasting below, on at least two
&gt; Linux variants.  Doing a Google search for &#34;Segmentation fault after
&gt; destroying non-dependent window&#34; will reveal that this is a problem on a
&gt; number of Linux platforms.  It works fine on Windows. 
&gt; 
&gt;
</div>
Oops, sorry for the premature dismissal...... I did finally see your
bug. And there is a mention of readv&#40;3, [{&#34;2400001 gTK_LOAD_ICONTHEMES\
  in the strace output lines preceding the segfault. So I guess that
this bug has not been fully worked out.  I&#39;ll try to start up my
debugging version of Tk, and see where it is crashing. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;24&nbsp;10:34:19&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> zentara [...] zentara.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Feb 24 06:41:12 2006, guest wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Dec 29 07:48:14 2005, NI-S wrote:
<div class="message-stanza open">&gt; &gt; 
&gt; &gt; Latest patch has been confirmed as a fix.
</div>&gt; 
&gt; I added the patch.  However, I still get a Segmentation Fault within 20
&gt; button clicks of the short script I am pasting below, on at least two
&gt; Linux variants.  Doing a Google search for &#34;Segmentation fault after
&gt; destroying non-dependent window&#34; will reveal that this is a problem on a
&gt; number of Linux platforms.  It works fine on Windows. 
</div>
This is the output of a debugging Tk, with the tkEvent.c patch applied,
when I run you script.
When running with a debugging Tk, with plain Perl 5.8.7
with original patch of tkEvent.c:986  if&#40;interp&#41;{...}
                      
At segfault:
#####################################################                      
Program received signal SIGSEGV, Segmentation fault.
0xb7d1861f in Tk_GetOptionValue &#40;&#41;
   from
/usr/lib/perl5/site_perl/5.8.7/i686-linux-thread-multi-ld/auto/Tk/Tk.so
&#40;gdb&#41; bt
#0  0xb7d1861f in Tk_GetOptionValue &#40;&#41;
   from
/usr/lib/perl5/site_perl/5.8.7/i686-linux-thread-multi-ld/auto/Tk/Tk.so
#1  0xb7cc723a in FrameWidgetObjCmd &#40;&#41;
   from
/usr/lib/perl5/site_perl/5.8.7/i686-linux-thread-multi-ld/auto/Tk/Tk.so
#2  0xb7c95d06 in Call_Tk &#40;info=0x83d87b8, items=3, args=0x825a184&#41; at
tkGlue.c:2283
#3  0xb7c9729c in XStoWidget &#40;my_perl=0x8154f68, cv=0x8290534&#41; at
tkGlue.c:2662
#4  0x080c6aa1 in Perl_pp_entersub &#40;&#41;
#5  0x080bf309 in Perl_runops_standard &#40;&#41;
#6  0x08064a7b in perl_run &#40;&#41;
#7  0x0805fe5d in main &#40;&#41;
&#40;gdb&#41; q
########################################################

Maybe Nick Ing Simmons will know what changes need to be made. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;01&nbsp;11:11:35&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> m.nooning [...] comcast.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">There is another clue from where I submitted this bug to the &#40;now
closed&#41; bugzilla report at 
<span class="clickylink"><a target="new" rel="nofollow" href="http://bugzilla.gnome.org/show_bug.cgi?id=332989">http://bugzilla.gnome.org/show_bug.cgi?id=332989</a></span>
I had included the already shown short script and stack trace.

There, a Matthias Clasen replied:
----paste
Tk bug. It must not segfault on receiving a ClientMessage
----end paste

Does Matthias&#39; statement add a helpful clue to anyone?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;01&nbsp;15:26:07&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> zentara [...] zentara.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Mar 01 11:11:35 2006, guest wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There is another clue from where I submitted this bug to the &#40;now
&gt; closed&#41; bugzilla report at 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://bugzilla.gnome.org/show_bug.cgi?id=332989">http://bugzilla.gnome.org/show_bug.cgi?id=332989</a></span>
&gt; I had included the already shown short script and stack trace.
&gt; 
&gt; There, a Matthias Clasen replied:
&gt; ----paste
&gt; Tk bug. It must not segfault on receiving a ClientMessage
&gt; ----end paste
&gt; 
&gt; Does Matthias&#39; statement add a helpful clue to anyone?
</div>
Well Matthias&#39; response was directed to the original bug, which is
the bug originally discussed in this thread. I posted this problem to
the Gtk 
buglist, and they responded, that no matter if Gtk was involved
in causing the segfault, it was a Tk problem....because Tk should not
be responding to Gtk&#39;s window manager signals.  That problem  was
apparently fixed to my &#40;and others&#41; satisfaction by the patch. Since
patching, I&#39;ve not seen any segfaults, and I run alot of Tk and Gtk2 code.
Your program does indeed raise the spector that this bug is not totally
fixed....i.e. there probably is another place in the code which needs
patching. I cannot easily see where, from the results of my backtrace.
It will take the mind of Nick Ing Simmons, with his more intimate
knowledge.  Furthermore, your particular code segfaults on it&#39;s own, not
as a result of something in a gtk2 app. In the original bug, a button press
in a Gtk2 app, would kill ALL running Tk programs. Your code snippet only
kills itself, so it is a different type of problem. Additionally, your
example
snippet itself may be causing it, by the way it is written. All I can
say, is that I have not seen any problem with this bug since the patch,
with the exception of your code.  I also posted it on comp.lang.perl.tk,
and no one else is complaining about noticing it. Sooo........in
summary, I think it is a different bug, &#40;although there is a similarity
in the gtk_load_iconthemes appearing in the strace output before the
crash. The main differences between your new bug and the original is....
1. Your code kills itself and only itself, where in the original bug, a
button
click in a gtk2 app would kill ALL running Tk apps.
2. Nobody is reporting seeing the bug, except when running your test code. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;01&nbsp;15:55:57&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> zentara [...] zentara.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Mar 01 11:11:35 2006, guest wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There is another clue from where I submitted this bug to the &#40;now
&gt; closed&#41; bugzilla report at 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://bugzilla.gnome.org/show_bug.cgi?id=332989">http://bugzilla.gnome.org/show_bug.cgi?id=332989</a></span>
&gt; I had included the already shown short script and stack trace.
&gt; 
&gt; There, a Matthias Clasen replied:
&gt; ----paste
&gt; Tk bug. It must not segfault on receiving a ClientMessage
&gt; ----end paste
&gt; 
&gt; Does Matthias&#39; statement add a helpful clue to anyone?
</div>
Hi, just an addendum, to explain why I think it may actually be
the way you wrote your code snippet, which is causing the segfaults.
The way you create a new mainwindow and event loop in a subroutine,
and repeatedly call that sub, is bound to lead to segfaults. You do not
want to constantly be creating a new mainwindow and redefining the
event loop from a sub. If you do it that way, &#40; which you would never do
in practice&#41; you need to clean up after the old mainwindow and loop. 
In almost all programs, you want to create the mainwindow and event loop
just once, and subsequent windows should be new toplevels, or dialogs.
Without careful cleanup, the code can keep track of which mainwindow is
the current, and which event loop is current.  You are attempting a sort
of infinite recursion with your code.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;01&nbsp;16:34:01&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">There is a pertinent reason why the test code given is relevent. 
Besides just surfacing the bug.

I have an application wherein the user makes a choice from a Perl/Tk pop
up menu.  Once a choice is made, the pop up is destroyed and something
then runs in the background.  When the user chosen task is done running,
one of a number of different pop ups could happen, depending upon the
results.  One could be a pop up wherein the user is asked if he wants to
run it again.  Different home grown Perl modules have different pop ups.
 Most are very simple informational messages but they need to be popped
up, and then destroyed when the user clicks an Okay button.  Hence I
really do need to be able to create a pop up in a routine, destroy it,
create another one from another routine, destroy it, and so on.  That is
why the test code really does reflect the problem space.  It runs just
fine on Windows, by the way.  No problems whatsoever on Windows.  It is
only the Linux varients that have the problem.

I cannot imagine that Tk really has a problem with the concept of having
a popup attempted multiple times.   This has to be a bug that can be
resolved.

I do a careful cleanup each time the user clicks the Okay button by
explicitly using the &#34;destroy&#34; method, such as $we_top-&gt;destroy.  Isn&#39;t
that supposed to destory MainWindow and take care of any needed cleanup?
 Shouldn&#39;t I then be free to call a routine that might &#40;or might not&#41;
pop up a new message?  Is there something I am missing?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;01&nbsp;16:59:01&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> zentara [...] zentara.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Mar 01 16:34:01 2006, guest wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There is a pertinent reason why the test code given is relevent. 
&gt; Besides just surfacing the bug.
&gt; 
&gt; I have an application wherein the user makes a choice from a Perl/Tk pop
&gt; up menu.  Once a choice is made, the pop up is destroyed and something
&gt; then runs in the background.  When the user chosen task is done running,
</div>
I don&#39;t want to carry on a design discussion in this Tk bug forum. All I
can say is that there are many better ways to design what you are trying
to do.
The code is not more complicated, but it will run better. The approach
you are taking seems logical to someone used to doing linear procedural
programming, but gui programming involves a thing called the &#34;event
loop&#34;, and your method of design sort of ignores it&#39;s crucial role in
running
the gui. That is probably why you would get unpredictable results in the
segfaults, sometimes a few clicks, sometimes 20. It starts depending on
system load, and timing between clicks processing your rebuilding a new
mainwindow. Finally , just running $mw-&gt;destroy does not clean up,
because you are still attempting to use the old event-loop to launch the
next event-loop, if the timing gets bad, it segfaults. Anyways, you can
post this problem on comp.lang.perl.tk  or at <span class="clickylink"><a target="new" rel="nofollow" href="http://perlmonks.org">http://perlmonks.org</a></span> and
show your code, and explain exactly what you want to do. I will give my
ideas, and others may have better solutions. But be assured, there are
ways to do what you want, without causing a segfault, where only 1
mainwindow is created, and the rest is done thru toplevels or dialogs. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;11&nbsp;12:47:31&nbsp;2006</span>
    <span class="description">nick [...] ing-simmons.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #16053] gtk2 &gt; 2.8.0 apps are causing segfaultsin Tk , with   readv&#40;3, [{&#34;_GTK_LOAD_ICONTHEMES&#34;, 20},</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 11 Mar 2006 17:47:09 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Tk [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Nick Ing-Simmons &lt;nick [...] ing-simmons.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Guest via RT &lt;bug-Tk@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=16053">http://rt.cpan.org/Ticket/Display.html?id=16053</a></span> &gt;
&gt;
&gt;Oops, sorry for the premature dismissal...... I did finally see your
&gt;bug. And there is a mention of readv&#40;3, [{&#34;2400001 gTK_LOAD_ICONTHEMES\
&gt;  in the strace output lines preceding the segfault. So I guess that
&gt;this bug has not been fully worked out.  I&#39;ll try to start up my
&gt;debugging version of Tk, and see where it is crashing. 
</div>
I am not following all this yet, but the bug fix cannot stop 
Gtk sending the message - so message will still be read from the X socket,
which is what the strace fragment shows.

The bug fix causes Tk to ignore the message.

The message likely gets sent by the window manager when a new top level 
window is created.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;12&nbsp;06:05:22&nbsp;2006</span>
    <span class="description">zentara [...] zentara.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #16053] gtk2 &gt; 2.8.0 apps are causing segfaultsin Tk , with   readv&#40;3, [{&#34;_GTK_LOAD_ICONTHEMES&#34;, 20},</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 12 Mar 2006 06:02:24 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Tk [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> zentara &lt;zentara [...] zentara.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, 11 Mar 2006 12:47:33 -0500 &#40;EST&#41;
&#34;Nick Ing-Simmons via RT&#34; &lt;bug-Tk@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=16053">http://rt.cpan.org/Ticket/Display.html?id=16053</a></span> &gt;
&gt;
&gt;Guest via RT &lt;bug-Tk@rt.cpan.org&gt; writes:
<div class="message-stanza open">&gt;&gt;&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=16053">http://rt.cpan.org/Ticket/Display.html?id=16053</a></span> &gt;
&gt;&gt;
&gt;&gt;Oops, sorry for the premature dismissal...... I did finally see your
&gt;&gt;bug. And there is a mention of readv&#40;3, [{&#34;2400001 gTK_LOAD_ICONTHEMES\
&gt;&gt;  in the strace output lines preceding the segfault. So I guess that
&gt;&gt;this bug has not been fully worked out.  I&#39;ll try to start up my
&gt;&gt;debugging version of Tk, and see where it is crashing. 
</div>&gt;
&gt;I am not following all this yet, but the bug fix cannot stop 
&gt;Gtk sending the message - so message will still be read from the X socket,
&gt;which is what the strace fragment shows.
&gt;
&gt;The bug fix causes Tk to ignore the message.
&gt;
&gt;The message likely gets sent by the window manager when a new top level 
&gt;window is created.
&gt;
</div>Don&#39;t worry about this one......it was caused by a bad program design,
calling MainLoop multiple times from a sub. He has been shown the right way
to write it.



-- 
I&#39;m not really a human, but I play one on earth.
<span class="clickylink"><a target="new" rel="nofollow" href="http://zentara.net/japh.html">http://zentara.net/japh.html</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;26&nbsp;14:06:03&nbsp;2006</span>
    <span class="description">NI-S [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;27&nbsp;07:48:37&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> peter.willendrup [...] risoe.dk</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello there,

On Sun Mar 12 06:05:22 2006, zentara@zentara.net wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Don&#39;t worry about this one......it was caused by a bad program design,
&gt; calling MainLoop multiple times from a sub. He has been shown the
</div>right way
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; to write it.
</div>
I have similar behaviour of a perl-Tk based app which to the best of my
knowledge does not call MainLoop multiple times from a sub. 

Please find attached output from a strace run.


Peter Willendrup
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;27&nbsp;07:48:40&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;27&nbsp;07:56:21&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> peter.willendrup [...] risoe.dk</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Mar 27 07:48:37 2006, guest wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have similar behaviour of a perl-Tk based app which to the best of my
&gt; knowledge does not call MainLoop multiple times from a sub. 
</div>
Oops. Feel free to close the bug, my mistake - patch fixes my problem.

Peter
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;27&nbsp;12:23:34&nbsp;2006</span>
    <span class="description">NI-S [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
