<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #53700 for Data-Dump-Streamer: Data::Dump::Streamer breaks overload magic on perl &lt;= 5.8.8</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #53700 for Data-Dump-Streamer: Data::Dump::Streamer breaks overload magic on perl &lt;= 5.8.8</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Data-Dump-Streamer">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Data-Dump-Streamer">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Data-Dump-Streamer">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Data-Dump-Streamer">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Data-Dump-Streamer">Data-Dump-Streamer CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">53700</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Data-Dump-Streamer">Data-Dump-Streamer</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
bobtfish [...] bobtfish.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-9002-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-9003-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




0001-Disable-overloading-in-a-5.8.8-safe-way-RT-53700.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/891791/462270/0001-Disable-overloading-in-a-5.8.8-safe-way-RT-53700.patch">
Thu Feb 03 13:24:28 2011 (4.1k) by jjore [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=53700">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-720073" href="/Public/Bug/Display.html?id=53700#txn-720073">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;14&nbsp;16:18:31&nbsp;2010</span>
    <span class="description">bobtfish [...] bobtfish.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Data::Dump::Streamer breaks overload magic on perl &lt;= 5.8.8</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 14 Jan 2010 21:14:28 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Data-Dump-Streamer [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tomas Doran &lt;bobtfish [...] bobtfish.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/720073/371757/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/371757">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hiya.

Data::Dump::Streamer appears to cause the overload magic to be lost on  
packages it inspects in some cases on perls &lt;= 5.8.8

Using the &#39;accessors_not_capturing_meta&#39; branch of Moose &#40;git:// 
git.moose.perl.org/Moose.git&#41; then this test fails on perl 5.8.8 &#40;and  
passes on 5.8.9 as this bug was fixed in perl core&#41;:

<span class="clickylink"><a target="new" rel="nofollow" href="http://git.shadowcat.co.uk/gitweb/gitweb.cgi?p=gitmo/MooseX-Antlers.git;a=commitdiff;h=47e1f51c0745cc717130783c8a83fe4e005d8a19">http://git.shadowcat.co.uk/gitweb/gitweb.cgi?p=gitmo/MooseX-Antlers.git;a=commitdiff;h=47e1f51c0745cc717130783c8a83fe4e005d8a19</a></span>

the failure occurs inside Moose when a Moose::Meta::Method instance is  
booleanified &#40;Moose::Meta::Method inherits from Class::MOP::Method,  
which has overloading to allow you to codeify method objects - with  
fallback =&gt; 1 set&#41; - the failure occurs as the class no longer has the  
fallback =&gt; 1 part of the overload magic.

This is the same issue worked around by XS in  
MooseX::Role::WithOverloading, and I have verified that inserting a  
call to  
MooseX 
::Role 
::WithOverloading 
::Meta::Role::Application::FixOverloadedRefs::reset_amagic into Moose  
at the relevant point causes the issue to go away.

Would it be possible for you to look into this and call code similar  
to that implemented by reset_amagic at the appropriate points within  
Data::Dump::Streamer?

Please feel to catch me &#40;or rafl who came up with the fix nominated  
above&#41; in #moose, #moose-dev, #p5p etc if you&#39;d like to chat about this.

Thanks in advance
t0m
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-758023" href="/Public/Bug/Display.html?id=53700#txn-758023">#</a>      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;03&nbsp;15:12:34&nbsp;2010</span>
    <span class="description">jjore [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/758023/392011/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/392011">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jan 14 16:18:31 2010, BOBTFISH wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hiya.
&gt; 
&gt; Data::Dump::Streamer appears to cause the overload magic to be lost on
&gt; packages it inspects in some cases on perls &lt;= 5.8.8
&gt; 
&gt; Using the &#39;accessors_not_capturing_meta&#39; branch of Moose &#40;git://
&gt; git.moose.perl.org/Moose.git&#41; then this test fails on perl 5.8.8 &#40;and
&gt; passes on 5.8.9 as this bug was fixed in perl core&#41;:
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://git.shadowcat.co.uk/gitweb/gitweb.cgi?p=gitmo/MooseX-">http://git.shadowcat.co.uk/gitweb/gitweb.cgi?p=gitmo/MooseX-</a></span>
&gt; Antlers.git;a=commitdiff;h=47e1f51c0745cc717130783c8a83fe4e005d8a19
&gt; 
&gt; the failure occurs inside Moose when a Moose::Meta::Method instance is
&gt; booleanified &#40;Moose::Meta::Method inherits from Class::MOP::Method,
&gt; which has overloading to allow you to codeify method objects - with
&gt; fallback =&gt; 1 set&#41; - the failure occurs as the class no longer has the
&gt; fallback =&gt; 1 part of the overload magic.
&gt; 
&gt; This is the same issue worked around by XS in
&gt; MooseX::Role::WithOverloading, and I have verified that inserting a
&gt; call to
&gt; MooseX
&gt; ::Role
&gt; ::WithOverloading
&gt; ::Meta::Role::Application::FixOverloadedRefs::reset_amagic into Moose
&gt; at the relevant point causes the issue to go away.
&gt; 
&gt; Would it be possible for you to look into this and call code similar
&gt; to that implemented by reset_amagic at the appropriate points within
&gt; Data::Dump::Streamer?
&gt; 
&gt; Please feel to catch me &#40;or rafl who came up with the fix nominated
&gt; above&#41; in #moose, #moose-dev, #p5p etc if you&#39;d like to chat about
&gt; this.
&gt; 
&gt; Thanks in advance
&gt; t0m
&gt; 
</div>
DDS ought to be using ordinary bless&#40;&#41; to non-magic packages, then rebless back to the 
original magic package. If that breaks your module, then bless&#40;&#41; is broken.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-758026" href="/Public/Bug/Display.html?id=53700#txn-758026">#</a>      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;03&nbsp;15:12:36&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-758041" href="/Public/Bug/Display.html?id=53700#txn-758041">#</a>      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;03&nbsp;16:04:34&nbsp;2010</span>
    <span class="description">bobtfish [...] bobtfish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #53700] Data::Dump::Streamer breaks overload magic on perl &lt;= 5.8.8 </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 3 Apr 2010 20:54:37 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Data-Dump-Streamer [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tomas Doran &lt;bobtfish [...] bobtfish.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/758041/392020/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/392020">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 222b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On 3 Apr 2010, at 20:12, Joshua ben Jore via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  If that breaks your module, then bless&#40;&#41; is broken.
</div>
Yes, yes it is.

As I noted, the issue is a bug in perl &lt;= 5.8.8, which can be worked  
around..

Cheers
t0m
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-758306" href="/Public/Bug/Display.html?id=53700#txn-758306">#</a>      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;04&nbsp;03:51:58&nbsp;2010</span>
    <span class="description">bobtfish [...] bobtfish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #53700] Data::Dump::Streamer breaks overload magic on perl &lt;= 5.8.8 </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 4 Apr 2010 08:56:53 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Data-Dump-Streamer [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tomas Doran &lt;bobtfish [...] bobtfish.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/758306/392169/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/392169">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 221b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On 3 Apr 2010, at 20:12, Joshua ben Jore via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If that breaks your module, then bless&#40;&#41; is broken.
</div>
Yes, yes it is.

As I noted, the issue is a bug in perl &lt;= 5.8.8, which can be worked  
around..

Cheers
t0m
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-891113" href="/Public/Bug/Display.html?id=53700#txn-891113">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;02&nbsp;02:23:51&nbsp;2011</span>
    <span class="description">jjore [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/891113/461852/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/461852">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 516b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Apr 04 03:51:58 2010, BOBTFISH wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; On 3 Apr 2010, at 20:12, Joshua ben Jore via RT wrote:
<div class="message-stanza open">&gt; &gt; If that breaks your module, then bless&#40;&#41; is broken.
</div>&gt; 
&gt; Yes, yes it is.
&gt; 
&gt; As I noted, the issue is a bug in perl &lt;= 5.8.8, which can be worked  
&gt; around..
&gt; 
&gt; Cheers
&gt; t0m
&gt; 
</div>
A simpler repro like the below doesn&#39;t show the bug. I was able to repro
your report by running the test you described on perl-5.8.8 however
calling reset_amagic&#40;&#41; on objects reblessed back didn&#39;t seem to correct
the problem.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-891116" href="/Public/Bug/Display.html?id=53700#txn-891116">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;02&nbsp;02:24:12&nbsp;2011</span>
    <span class="description">jjore [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/891116/461855/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/461855">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1015b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Feb 02 02:23:51 2011, JJORE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sun Apr 04 03:51:58 2010, BOBTFISH wrote:
<div class="message-stanza open">&gt; &gt; 
&gt; &gt; On 3 Apr 2010, at 20:12, Joshua ben Jore via RT wrote:
<div class="message-stanza open">&gt; &gt; &gt; If that breaks your module, then bless&#40;&#41; is broken.
</div>&gt; &gt; 
&gt; &gt; Yes, yes it is.
&gt; &gt; 
&gt; &gt; As I noted, the issue is a bug in perl &lt;= 5.8.8, which can be worked  
&gt; &gt; around..
&gt; &gt; 
&gt; &gt; Cheers
&gt; &gt; t0m
&gt; &gt; 
</div>&gt; 
&gt; A simpler repro like the below doesn&#39;t show the bug. I was able to repro
&gt; your report by running the test you described on perl-5.8.8 however
&gt; calling reset_amagic&#40;&#41; on objects reblessed back didn&#39;t seem to correct
&gt; the problem.
</div>

package magic;
use overload
    &#39;bool&#39; =&gt; sub { 0 },
    fallback =&gt; 1;
sub new {
    my &#40;$class&#41; = @_;
    return bless {}, $class;
}
package main;
use blib;
use Data::Dump::Streamer;
use Test::More tests =&gt; 4;

my $o = magic-&gt;new;
ok&#40; ! $o, &#39;Boolifies false&#39; &#41;;
is&#40; &#34;$o&#34;, &#39;0&#39;, &#39;Numifies 0 because of fallback&#39; &#41;;

diag&#40; Dump&#40;$o&#41; &#41;;

ok&#40; ! $o, &#39;Boolifies false&#39; &#41;;
is&#40; &#34;$o&#34;, &#39;0&#39;, &#39;Numifies 0 because of fallback&#39; &#41;;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-891271" href="/Public/Bug/Display.html?id=53700#txn-891271">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;02&nbsp;10:16:34&nbsp;2011</span>
    <span class="description">jjore [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/891271/461959/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/461959">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 340b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">See
<span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.git.perl.org/perl.git/commit/d485b35bef81cc45d7a87bc3fc4395a7b8308be9">http://perl5.git.perl.org/perl.git/commit/d485b35bef81cc45d7a87bc3fc4395a7b8308be9</a></span>
and
<span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.git.perl.org/perl.git/commit/4694b1ce4b686b95e440873efd144f66fabfc14a">http://perl5.git.perl.org/perl.git/commit/4694b1ce4b686b95e440873efd144f66fabfc14a</a></span>
for the fix as applied to perl.

See
<span class="clickylink"><a target="new" rel="nofollow" href="http://cpansearch.perl.org/src/FLORA/MooseX-Role-WithOverloading-0.09/WithOverloading.xs">http://cpansearch.perl.org/src/FLORA/MooseX-Role-WithOverloading-0.09/WithOverloading.xs</a></span>
for the fix as applied to a CPAN module.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-891791" href="/Public/Bug/Display.html?id=53700#txn-891791">#</a>      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;03&nbsp;13:24:28&nbsp;2011</span>
    <span class="description">jjore [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/891791/462269/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/462269">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 75b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Going to be testing the attached patch. It avoids using bless&#40;&#41; on &lt;=5.8.8.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-Disable-overloading-in-a-5.8.8-safe-way-RT-53700.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/891791/462270/0001-Disable-overloading-in-a-5.8.8-safe-way-RT-53700.patch">Download 0001-Disable-overloading-in-a-5.8.8-safe-way-RT-53700.patch</a><br />
<span class="downloadcontenttype">text/x-diff 4.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From ae0149afbf8f77c574d35c02098f4a45dd147e09 Mon Sep 17 00:00:00 2001
From: Josh ben Jore &lt;jjore@cpan.org&gt;
Date: Thu, 3 Feb 2011 10:23:02 -0800
Subject: [PATCH] Disable overloading in a &lt;=5.8.8 safe way [RT #53700]

---
 Changes                   |    3 +++
 lib/Data/Dump/Streamer.pm |   23 +++++++++++++++++------
 lib/Data/Dump/Streamer.xs |   26 +++++++++++++++++++++++++-
 3 files changed, 45 insertions&#40;+&#41;, 7 deletions&#40;-&#41;

diff --git a/Changes b/Changes
index 370e910..12c1969 100644
--- a/Changes
+++ b/Changes
@@ -1,3 +1,6 @@
+...
+Disable overloading in a &lt;=5.8.8 safe way
+
 2.31
 React to Strawberry perl $. strangeness [RT #58528]
 
diff --git a/lib/Data/Dump/Streamer.pm b/lib/Data/Dump/Streamer.pm
index 28d37b0..88f5cb2 100644
--- a/lib/Data/Dump/Streamer.pm
+++ b/lib/Data/Dump/Streamer.pm
@@ -206,6 +206,17 @@ EO_HU
         };
         *lock_keys_plus=sub&#40;\%;@&#41;{lock_ref_keys_plus&#40;@_&#41;};
     }
+    if &#40;$] &lt;= 5.008008&#41; {
+        *disable_overloading = \&#38;SvAMAGIC_off;
+        *restore_overloading = \&#38;SvAMAGIC_on;
+    } else {
+        *disable_overloading = sub &#40;$&#41; {
+            bless $_[0], &#39;Does::Not::Exist&#39;;
+        };
+        *restore_overloading = sub &#40;$$&#41; {
+            bless $_[0], $_[1];
+        };
+    }
     my %fail=map { &#40; $_ =&gt; 1 &#41; } @EXPORT_FAIL;
     @EXPORT_OK=grep { !$fail{$_} } @EXPORT_OK;
 }
@@ -1526,7 +1537,7 @@ PASS:{
             my $overloaded=undef;
             my $isoverloaded=0;
             if &#40;defined $class and overload::Overloaded&#40;$item&#41;&#41; {
-                bless $item, &#39;Does::Not::Exist&#39;;
+                disable_overloading&#40; $item &#41;;
                 $overloaded= $class;
                 $isoverloaded= 1;
             }
@@ -1639,7 +1650,7 @@ PASS:{
                     if $ENV{DDS_STRICT};
             }
             if &#40;$isoverloaded&#41; {
-                $item= bless $item, $overloaded;
+                restore_overloading&#40; $item, $overloaded &#41;;
             }
         }
         if &#40; $pass++ == 1 &#41; {
@@ -1865,7 +1876,7 @@ sub _dump_apply_fix { #handle fix statements and GLOB&#39;s here.
                 overload::Overloaded&#40; $lhs &#41; &#41;
             {
                 $overloaded=blessed $lhs;
-                bless $lhs,&#34;Does::Not::Exist&#34;;
+                disable_overloading&#40; $lhs &#41;;
                 $isoverloaded=1;
             }
             foreach my $t &#40;$self-&gt;_glob_slots&#40;&#39;&#39;&#41;&#41;
@@ -1926,7 +1937,7 @@ sub _dump_apply_fix { #handle fix statements and GLOB&#39;s here.
                 }
             }
             if &#40;$isoverloaded&#41; {
-                $lhs=bless $lhs,$overloaded;
+                restore_overloading&#40; $lhs, $overloaded &#41;;
             }
 
 
@@ -2887,7 +2898,7 @@ sub _dump_rv {
     }
     my $isoverloaded=0;
     if &#40;defined $class and overload::Overloaded&#40;$item&#41;&#41; {
-        bless $item, &#39;Does::Not::Exist&#39;;
+        disable_overloading&#40; $item &#41;;
         $overloaded= $class;
         $isoverloaded= 1;
     }
@@ -2968,7 +2979,7 @@ sub _dump_rv {
             $self-&gt;_add_fix&#40;&#39;bless&#39;,$idx,$overloaded&#41;;
         }
         if &#40;$isoverloaded&#41; {
-            $item=bless $item, $overloaded;
+            restore_overloading&#40; $item, $overloaded &#41;;
         }
     }
     if &#40;$fix_lock &#38;&#38; !defined&#40;$class&#41;&#41; {
diff --git a/lib/Data/Dump/Streamer.xs b/lib/Data/Dump/Streamer.xs
index 6af81df..c4ff2eb 100644
--- a/lib/Data/Dump/Streamer.xs
+++ b/lib/Data/Dump/Streamer.xs
@@ -107,6 +107,12 @@ my_cxinc&#40;pTHX&#41;
 #    define NV double
 #endif
 
+#if PERL_VERSION &lt; 8
+#    define MY_XS_AMAGIC
+#endif
+#if &#40;&#40;PERL_VERSION == 8&#41; &#38;&#38; &#40;PERL_SUBVERSION &lt;= 8&#41;&#41;
+#    define MY_XS_AMAGIC
+#endif
 
 /*
    the following three subs are outright stolen from Data::Dumper &#40; Dumper.xs &#41;
@@ -180,7 +186,6 @@ esc_q&#40;register char *d, register char *s, register STRLEN slen&#41;
     return ret;
 }
 
-
 XS&#40;XS_Data__Dump__Streamer_SvREADONLY&#41;;
 XS&#40;XS_Data__Dump__Streamer_SvREADONLY&#41;	/* This is dangerous stuff. */
 {
@@ -768,6 +773,25 @@ CODE:
 OUTPUT:
     RETVAL
 
+#ifdef MY_XS_AMAGIC
+
+void
+SvAMAGIC_off&#40;sv&#41;
+    SV * sv
+PROTOTYPE: $
+CODE:
+    SvAMAGIC_off&#40;sv&#41;
+
+void
+SvAMAGIC_on&#40;sv,klass&#41;
+    SV * sv
+    SV * klass
+PROTOTYPE: $
+CODE:
+    SvAMAGIC_off&#40;sv&#41;
+
+#endif
+
 
 #ifndef NEW_REGEX_ENGINE
 
-- 
1.7.1

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-892792" href="/Public/Bug/Display.html?id=53700#txn-892792">#</a>      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;04&nbsp;23:58:24&nbsp;2011</span>
    <span class="description">jjore [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/892792/462836/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/462836">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 230b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The solution is stranger than I imagined. Resolved in 2.32 by just
fetching the &#40;&#41; entry from the stash for every class the object ISA:
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/jbenjore/Data-Dump-Streamer/commit/664c3b48e5352b6881b672d58137bdb42bde7aab">https://github.com/jbenjore/Data-Dump-Streamer/commit/664c3b48e5352b6881b672d58137bdb42bde7aab</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-892795" href="/Public/Bug/Display.html?id=53700#txn-892795">#</a>      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;04&nbsp;23:58:25&nbsp;2011</span>
    <span class="description">jjore [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-892898" href="/Public/Bug/Display.html?id=53700#txn-892898">#</a>      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;05&nbsp;06:46:13&nbsp;2011</span>
    <span class="description">demerphq [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #53700] Data::Dump::Streamer breaks overload magic on perl &lt;= 5.8.8</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 5 Feb 2011 12:46:03 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Data-Dump-Streamer [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> demerphq &lt;demerphq [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/892898/462890/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/462890">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 505b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 5 February 2011 05:58, Joshua ben Jore via RT
&lt;bug-Data-Dump-Streamer@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Â  Â  Â  Queue: Data-Dump-Streamer
&gt; Â Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=53700">https://rt.cpan.org/Ticket/Display.html?id=53700</a></span> &gt;
&gt;
&gt; The solution is stranger than I imagined. Resolved in 2.32 by just
&gt; fetching the &#40;&#41; entry from the stash for every class the object ISA:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/jbenjore/Data-Dump-Streamer/commit/664c3b48e5352b6881b672d58137bdb42bde7aab">https://github.com/jbenjore/Data-Dump-Streamer/commit/664c3b48e5352b6881b672d58137bdb42bde7aab</a></span>
&gt;
</div>
thanks josh

-- 
perl -Mre=debug -e &#34;/just|another|perl|hacker/&#34;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-892901" href="/Public/Bug/Display.html?id=53700#txn-892901">#</a>      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;05&nbsp;06:46:14&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-893588" href="/Public/Bug/Display.html?id=53700#txn-893588">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;07&nbsp;00:47:21&nbsp;2011</span>
    <span class="description">jjore [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/893588/463250/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/463250">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 15b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Re-closing bug.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-893591" href="/Public/Bug/Display.html?id=53700#txn-893591">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;07&nbsp;00:47:22&nbsp;2011</span>
    <span class="description">jjore [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.56</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
