<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #105552 for DBIx-Admin-BackupRestore: restore is crashing if table is empty.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #105552 for DBIx-Admin-BackupRestore: restore is crashing if table is empty.</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBIx-Admin-BackupRestore">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBIx-Admin-BackupRestore">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBIx-Admin-BackupRestore">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBIx-Admin-BackupRestore">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBIx-Admin-BackupRestore">DBIx-Admin-BackupRestore CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">105552</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBIx-Admin-BackupRestore">DBIx-Admin-BackupRestore</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
me [...] marcosg.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10362-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10363-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=105552">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1512707" href="/Public/Bug/Display.html?id=105552#txn-1512707">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;29&nbsp;08:20:52&nbsp;2015</span>
    <span class="description">me [...] marcosg.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> restore is crashing if table is empty.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 29 Jun 2015 22:20:36 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Admin-BackupRestore [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Marcos Georgopoulos &lt;me [...] marcosg.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1512707/806617/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/806617">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 961b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

Firstly thank you for your hard work with this module.

I have an issue where restore_in_order is failing if a table has no rows.

I&#39;m not a very good coder but it appears that if there are no rows then you
go to the next record in your code below;

$self -&gt; process_table&#40;&#39;Restore&#39;, $candidate_table&#41;;

# Warning: At this point, if the input file has no data for a table,
# $$record{&#39;row&#39;} will be undef, so don&#39;t access @{$$record{&#39;row&#39;} }.

next if &#40;! $$record{&#39;row&#39;}&#41;;


If we are already at this point in the code haven&#39;t we already found the
matching resultset for the tablename specified? So wouldn&#39;t it be efficient
to break out of the loop here?

I am finding what is happening is after it finds the matching resultset for
my table with no rows it then goes on through processing the other records
and seems to eventually crash calling get_record at the top of the infinite
for loop.

I hope this makes sense.

Once again thank you for your help.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1512707/806618/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/806618">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.4k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1513181" href="/Public/Bug/Display.html?id=105552#txn-1513181">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;30&nbsp;22:37:28&nbsp;2015</span>
    <span class="description">ron [...] savage.net.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #105552] restore is crashing if table is empty.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 01 Jul 2015 12:41:22 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Admin-BackupRestore [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ron Savage &lt;ron [...] savage.net.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1513181/806870/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/806870">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Marcos

Thanx for the report.

This whole ticket raises the question of how much I should re-write this 
module using more modern code. I have not decided on that yet, but many 
things would then be changed. Perhaps I should just fix this issue.

More below.

On 29/06/15 22:20, Marcos Georgopoulos via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Mon Jun 29 08:20:52 2015: Request 105552 was acted upon.
&gt; Transaction: Ticket created by me@marcosg.com
&gt;         Queue: DBIx-Admin-BackupRestore
&gt;       Subject: restore is crashing if table is empty.
&gt;     Broken in: &#40;no value&#41;
&gt;      Severity: &#40;no value&#41;
&gt;         Owner: Nobody
&gt;    Requestors: me@marcosg.com
&gt;        Status: new
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=105552">https://rt.cpan.org/Ticket/Display.html?id=105552</a></span> &gt;
&gt;
&gt;
&gt; Hi,
&gt;
&gt; Firstly thank you for your hard work with this module.
&gt;
&gt; I have an issue where restore_in_order is failing if a table has no rows.
&gt;
&gt; I&#39;m not a very good coder but it appears that if there are no rows then you
&gt; go to the next record in your code below;
&gt;
&gt; $self -&gt; process_table&#40;&#39;Restore&#39;, $candidate_table&#41;;
&gt;
&gt; # Warning: At this point, if the input file has no data for a table,
&gt; # $$record{&#39;row&#39;} will be undef, so don&#39;t access @{$$record{&#39;row&#39;} }.
&gt;
&gt; next if &#40;! $$record{&#39;row&#39;}&#41;;
&gt;
&gt;
&gt; If we are already at this point in the code haven&#39;t we already found the
&gt; matching resultset for the tablename specified? So wouldn&#39;t it be efficient
&gt; to break out of the loop here?
</div>
The docs for XML::Records say it returns &#40;undef, undef&#41;. I need to test 
with an empty table, which I assume I did not ever do.

But this statement at the top of the loop:

last if &#40;! $record&#41;;

should handle that.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I am finding what is happening is after it finds the matching resultset for
&gt; my table with no rows it then goes on through processing the other records
&gt; and seems to eventually crash calling get_record at the top of the infinite
&gt; for loop.
</div>
The exact error message would help :-&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I hope this makes sense.
</div>
Yep.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Once again thank you for your help.
</div>
Nice to know someone is using this module.

-- 
Ron Savage - savage.net.au
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1513182" href="/Public/Bug/Display.html?id=105552#txn-1513182">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;30&nbsp;22:37:28&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1513185" href="/Public/Bug/Display.html?id=105552#txn-1513185">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;30&nbsp;23:52:47&nbsp;2015</span>
    <span class="description">me [...] marcosg.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #105552] restore is crashing if table is empty.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 1 Jul 2015 13:52:27 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Admin-BackupRestore [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Marcos Georgopoulos &lt;me [...] marcosg.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1513185/806874/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/806874">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Ron,

Thank you for getting back to me so quickly.

Sorry I wasn&#39;t as descriptive as I could have been. The program doesn&#39;t
actually crash, it just appears to never end.

It seems that at some point a call to get_record doesn&#39;t return. I did some
basic troubleshooting and it seems to be in the get token code within that
library. I&#39;m not sure if its getting caught in a loop OR if its just taking
a really long time.

My DB file generated by your program is about 500MB. I left it running for
about 3 hours and the call to get_record still hadn&#39;t finished.



On Wed, Jul 1, 2015 at 12:37 PM, ron@savage.net.au via RT &lt;
bug-DBIx-Admin-BackupRestore@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=105552">https://rt.cpan.org/Ticket/Display.html?id=105552</a></span> &gt;
&gt;
&gt; Hi Marcos
&gt;
&gt; Thanx for the report.
&gt;
&gt; This whole ticket raises the question of how much I should re-write this
&gt; module using more modern code. I have not decided on that yet, but many
&gt; things would then be changed. Perhaps I should just fix this issue.
&gt;
&gt; More below.
&gt;
&gt; On 29/06/15 22:20, Marcos Georgopoulos via RT wrote:
<div class="message-stanza open">&gt; &gt; Mon Jun 29 08:20:52 2015: Request 105552 was acted upon.
&gt; &gt; Transaction: Ticket created by me@marcosg.com
&gt; &gt;         Queue: DBIx-Admin-BackupRestore
&gt; &gt;       Subject: restore is crashing if table is empty.
&gt; &gt;     Broken in: &#40;no value&#41;
&gt; &gt;      Severity: &#40;no value&#41;
&gt; &gt;         Owner: Nobody
&gt; &gt;    Requestors: me@marcosg.com
&gt; &gt;        Status: new
&gt; &gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=105552">https://rt.cpan.org/Ticket/Display.html?id=105552</a></span> &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; Hi,
&gt; &gt;
&gt; &gt; Firstly thank you for your hard work with this module.
&gt; &gt;
&gt; &gt; I have an issue where restore_in_order is failing if a table has no rows.
&gt; &gt;
&gt; &gt; I&#39;m not a very good coder but it appears that if there are no rows then
</div>&gt; you
<div class="message-stanza open">&gt; &gt; go to the next record in your code below;
&gt; &gt;
&gt; &gt; $self -&gt; process_table&#40;&#39;Restore&#39;, $candidate_table&#41;;
&gt; &gt;
&gt; &gt; # Warning: At this point, if the input file has no data for a table,
&gt; &gt; # $$record{&#39;row&#39;} will be undef, so don&#39;t access @{$$record{&#39;row&#39;} }.
&gt; &gt;
&gt; &gt; next if &#40;! $$record{&#39;row&#39;}&#41;;
&gt; &gt;
&gt; &gt;
&gt; &gt; If we are already at this point in the code haven&#39;t we already found the
&gt; &gt; matching resultset for the tablename specified? So wouldn&#39;t it be
</div>&gt; efficient
<div class="message-stanza open">&gt; &gt; to break out of the loop here?
</div>&gt;
&gt; The docs for XML::Records say it returns &#40;undef, undef&#41;. I need to test
&gt; with an empty table, which I assume I did not ever do.
&gt;
&gt; But this statement at the top of the loop:
&gt;
&gt; last if &#40;! $record&#41;;
&gt;
&gt; should handle that.
&gt;
<div class="message-stanza open">&gt; &gt; I am finding what is happening is after it finds the matching resultset
</div>&gt; for
<div class="message-stanza open">&gt; &gt; my table with no rows it then goes on through processing the other
</div>&gt; records
<div class="message-stanza open">&gt; &gt; and seems to eventually crash calling get_record at the top of the
</div>&gt; infinite
<div class="message-stanza open">&gt; &gt; for loop.
</div>&gt;
&gt; The exact error message would help :-&#41;.
&gt;
<div class="message-stanza open">&gt; &gt; I hope this makes sense.
</div>&gt;
&gt; Yep.
&gt;
<div class="message-stanza open">&gt; &gt; Once again thank you for your help.
</div>&gt;
&gt; Nice to know someone is using this module.
&gt;
&gt; --
&gt; Ron Savage - savage.net.au
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1513185/806875/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/806875">with headers</a>
<br />
<span class="downloadcontenttype">text/html 4.1k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1513187" href="/Public/Bug/Display.html?id=105552#txn-1513187">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;01&nbsp;00:18:45&nbsp;2015</span>
    <span class="description">ron [...] savage.net.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #105552] restore is crashing if table is empty.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 01 Jul 2015 14:22:39 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Admin-BackupRestore [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ron Savage &lt;ron [...] savage.net.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1513187/806877/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/806877">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Marcos

OK. Thanx. Every bit of info helps.

On 01/07/15 13:52, Marcos Georgopoulos via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: DBIx-Admin-BackupRestore
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=105552">https://rt.cpan.org/Ticket/Display.html?id=105552</a></span> &gt;
&gt;
&gt; Hi Ron,
&gt;
&gt; Thank you for getting back to me so quickly.
&gt;
&gt; Sorry I wasn&#39;t as descriptive as I could have been. The program doesn&#39;t
&gt; actually crash, it just appears to never end.
&gt;
&gt; It seems that at some point a call to get_record doesn&#39;t return. I did some
&gt; basic troubleshooting and it seems to be in the get token code within that
&gt; library. I&#39;m not sure if its getting caught in a loop OR if its just taking
&gt; a really long time.
&gt;
&gt; My DB file generated by your program is about 500MB. I left it running for
&gt; about 3 hours and the call to get_record still hadn&#39;t finished.
&gt;
&gt;
&gt;
&gt; On Wed, Jul 1, 2015 at 12:37 PM, ron@savage.net.au via RT &lt;
&gt; bug-DBIx-Admin-BackupRestore@rt.cpan.org&gt; wrote:
&gt;
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=105552">https://rt.cpan.org/Ticket/Display.html?id=105552</a></span> &gt;
&gt;&gt;
&gt;&gt; Hi Marcos
&gt;&gt;
&gt;&gt; Thanx for the report.
&gt;&gt;
&gt;&gt; This whole ticket raises the question of how much I should re-write this
&gt;&gt; module using more modern code. I have not decided on that yet, but many
&gt;&gt; things would then be changed. Perhaps I should just fix this issue.
&gt;&gt;
&gt;&gt; More below.
&gt;&gt;
&gt;&gt; On 29/06/15 22:20, Marcos Georgopoulos via RT wrote:
<div class="message-stanza open">&gt;&gt;&gt; Mon Jun 29 08:20:52 2015: Request 105552 was acted upon.
&gt;&gt;&gt; Transaction: Ticket created by me@marcosg.com
&gt;&gt;&gt;          Queue: DBIx-Admin-BackupRestore
&gt;&gt;&gt;        Subject: restore is crashing if table is empty.
&gt;&gt;&gt;      Broken in: &#40;no value&#41;
&gt;&gt;&gt;       Severity: &#40;no value&#41;
&gt;&gt;&gt;          Owner: Nobody
&gt;&gt;&gt;     Requestors: me@marcosg.com
&gt;&gt;&gt;         Status: new
&gt;&gt;&gt;    Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=105552">https://rt.cpan.org/Ticket/Display.html?id=105552</a></span> &gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Hi,
&gt;&gt;&gt;
&gt;&gt;&gt; Firstly thank you for your hard work with this module.
&gt;&gt;&gt;
&gt;&gt;&gt; I have an issue where restore_in_order is failing if a table has no rows.
&gt;&gt;&gt;
&gt;&gt;&gt; I&#39;m not a very good coder but it appears that if there are no rows then
</div>&gt;&gt; you
<div class="message-stanza open">&gt;&gt;&gt; go to the next record in your code below;
&gt;&gt;&gt;
&gt;&gt;&gt; $self -&gt; process_table&#40;&#39;Restore&#39;, $candidate_table&#41;;
&gt;&gt;&gt;
&gt;&gt;&gt; # Warning: At this point, if the input file has no data for a table,
&gt;&gt;&gt; # $$record{&#39;row&#39;} will be undef, so don&#39;t access @{$$record{&#39;row&#39;} }.
&gt;&gt;&gt;
&gt;&gt;&gt; next if &#40;! $$record{&#39;row&#39;}&#41;;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; If we are already at this point in the code haven&#39;t we already found the
&gt;&gt;&gt; matching resultset for the tablename specified? So wouldn&#39;t it be
</div>&gt;&gt; efficient
<div class="message-stanza open">&gt;&gt;&gt; to break out of the loop here?
</div>&gt;&gt;
&gt;&gt; The docs for XML::Records say it returns &#40;undef, undef&#41;. I need to test
&gt;&gt; with an empty table, which I assume I did not ever do.
&gt;&gt;
&gt;&gt; But this statement at the top of the loop:
&gt;&gt;
&gt;&gt; last if &#40;! $record&#41;;
&gt;&gt;
&gt;&gt; should handle that.
&gt;&gt;
<div class="message-stanza open">&gt;&gt;&gt; I am finding what is happening is after it finds the matching resultset
</div>&gt;&gt; for
<div class="message-stanza open">&gt;&gt;&gt; my table with no rows it then goes on through processing the other
</div>&gt;&gt; records
<div class="message-stanza open">&gt;&gt;&gt; and seems to eventually crash calling get_record at the top of the
</div>&gt;&gt; infinite
<div class="message-stanza open">&gt;&gt;&gt; for loop.
</div>&gt;&gt;
&gt;&gt; The exact error message would help :-&#41;.
&gt;&gt;
<div class="message-stanza open">&gt;&gt;&gt; I hope this makes sense.
</div>&gt;&gt;
&gt;&gt; Yep.
&gt;&gt;
<div class="message-stanza open">&gt;&gt;&gt; Once again thank you for your help.
</div>&gt;&gt;
&gt;&gt; Nice to know someone is using this module.
&gt;&gt;
&gt;&gt; --
&gt;&gt; Ron Savage - savage.net.au
&gt;&gt;
&gt;&gt;
</div>&gt;
</div>
-- 
Ron Savage - savage.net.au
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.407671</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
