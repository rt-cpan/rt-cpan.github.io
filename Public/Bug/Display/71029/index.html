<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #71029 for Config-Tiny: Config::Tiny does not handle or enable non-ascii config text</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #71029 for Config-Tiny: Config::Tiny does not handle or enable non-ascii config text</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Config-Tiny">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Config-Tiny">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Config-Tiny">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Config-Tiny">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Config-Tiny">Config-Tiny CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">71029</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Config-Tiny">Config-Tiny</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
nomad [...] null.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-7794-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-7795-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=71029">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-978473" href="/Public/Bug/Display.html?id=71029#txn-978473">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;16&nbsp;18:45:20&nbsp;2011</span>
    <span class="description">nomad [...] null.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Config::Tiny does not handle or enable non-ascii config text</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 17 Sep 2011 10:44:58 +1200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Config-Tiny [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Lawrence &lt;nomad [...] null.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/978473/509335/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/509335">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 362b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Config files containing non-ascii characters &#40;for example &#39;ä&#39;&#41; are not
read with the correct file-handle encoding. I presume they are not
written correctly either.

Config::Tiny does not provide an encoding setting as part of its API,
and I can&#39;t seem to find any hacks to force it. Any chance of
recognizing this as a feature request?

Mark.
-- 
Mark Lawrence
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-978477" href="/Public/Bug/Display.html?id=71029#txn-978477">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;16&nbsp;20:00:57&nbsp;2011</span>
    <span class="description">nomad [...] null.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [rt.cpan.org #71029] [PATCH] Add an optional encoding argument to read&#40;&#41; and write&#40;&#41;.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 17 Sep 2011 12:00:17 +1200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Bugs in Config-Tiny via RT &lt;bug-Config-Tiny [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Lawrence &lt;nomad [...] null.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/978477/509338/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/509338">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Config::Tiny does not provide an encoding setting as part of its API,
&gt; and I can&#39;t seem to find any hacks to force it. Any chance of
&gt; recognizing this as a feature request?
</div>
I quickly worked something up which does what I need:

    my $conf = Config::Tiny-&gt;read&#40;&#39;file&#39;, &#39;utf-8&#39;&#41;
    # hack hack hack
    $conf-&gt;write&#40;&#39;file&#39;, &#39;utf-8&#39;&#41;

It relies on the PerlIO layer so may or may not be portable for all
Perls that have ever been written.

The patch below will not apply to the latest release &#40;I cleaned up my
local copy of the code using perltidy and podtidy before hand&#41; but
shows what I&#39;m suggesting. If you want the full patch set see:

    git clone git@github.com:mlawren/Config-Tiny.git

or via browser at <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/mlawren/Config-Tiny">https://github.com/mlawren/Config-Tiny</a></span>

Mark.

---
 lib/Config/Tiny.pm |   32 ++++++++++++++++++++------------
 1 files changed, 20 insertions&#40;+&#41;, 12 deletions&#40;-&#41;

diff --git a/lib/Config/Tiny.pm b/lib/Config/Tiny.pm
index 25b9b7c..05aaf8b 100644
--- a/lib/Config/Tiny.pm
+++ b/lib/Config/Tiny.pm
@@ -25,9 +25,13 @@ sub read {
     return $class-&gt;_error&#40;&#34;Insufficient permissions to read &#39;$file&#39;&#34;&#41;
       unless -r _;
 
+    my $encoding = @_ ? &#39;&lt;:encoding&#40;&#39; . &#40;shift&#41; . &#39;&#41;&#39; : &#39;&lt;&#39;;
+
     # Slurp in the file
     local $/ = undef;
-    open CFG, $file or return $class-&gt;_error&#40;&#34;Failed to open file &#39;$file&#39;: $!&#34;&#41;;
+
+    open CFG, $encoding, $file
+      or return $class-&gt;_error&#40;&#34;Failed to open file &#39;$file&#39;: $!&#34;&#41;;
     my $contents = &lt;CFG&gt;;
     close CFG;
 
@@ -76,12 +80,13 @@ sub read_string {
 
 # Save an object to a file
 sub write {
-    my $self = shift;
-    my $file = shift or return $self-&gt;_error&#40; &#39;No file name provided&#39; &#41;;
+    my $self     = shift;
+    my $file     = shift or return $self-&gt;_error&#40;&#39;No file name provided&#39;&#41;;
+    my $encoding = @_ ? &#39;&gt;:&#39; . &#40;shift&#41; : &#39;&gt;&#39;;
 
     # Write it to the file
-    open&#40; CFG, &#39;&gt;&#39; . $file &#41;
-      or return $self-&gt;_error&#40; &#34;Failed to open file &#39;$file&#39; for writing: $!&#34; &#41;;
+    open CFG, $encoding, $file
+      or return $self-&gt;_error&#40;&#34;Failed to open file &#39;$file&#39; for writing: $!&#34;&#41;;
     print CFG $self-&gt;write_string;
     close CFG;
 }
@@ -93,7 +98,8 @@ sub write_string {
     my $contents = &#39;&#39;;
     foreach my $section &#40;
         sort { &#40; &#40; $b eq &#39;_&#39; &#41; &lt;=&gt; &#40; $a eq &#39;_&#39; &#41; &#41; || &#40; $a cmp $b &#41; }
-        keys %$self &#41;
+        keys %$self
+      &#41;
     {
         my $block = $self-&gt;{$section};
         $contents .= &#34;\n&#34; if length $contents;
@@ -139,7 +145,7 @@ possible
     my $Config = Config::Tiny-&gt;new&#40;&#41;;
 
     # Open the config
-    $Config = Config::Tiny-&gt;read&#40; &#39;file.conf&#39; &#41;;
+    $Config = Config::Tiny-&gt;read&#40; &#39;file.conf&#39;, &#39;utf-8&#39; &#41;;
 
     # Reading properties
     my $rootproperty = $Config-&gt;{_}-&gt;{rootproperty};
@@ -152,7 +158,7 @@ possible
     delete $Config-&gt;{_};                        # Delete a value or section
 
     # Save a config
-    $Config-&gt;write&#40; &#39;file.conf&#39; &#41;;
+    $Config-&gt;write&#40; &#39;file.conf&#39;, &#39;utf-8&#39; &#41;;
 
 =head1 DESCRIPTION
 
@@ -197,10 +203,11 @@ something better, this module is not for you.
 The constructor C&lt;new&gt; creates and returns an empty C&lt;Config::Tiny&gt;
 object.
 
-=head2 read $filename
+=head2 read $filename [$encoding]
 
 The C&lt;read&gt; constructor reads a config file, and returns a new
-C&lt;Config::Tiny&gt; object containing the properties in the file.
+C&lt;Config::Tiny&gt; object containing the properties in the file. An
+optional argument specifies the encoding.
 
 Returns the object on success, or C&lt;undef&gt; on error.
 
@@ -215,10 +222,11 @@ C&lt;$!&gt; variable.
 The C&lt;read_string&gt; method takes as argument the contents of a config
 file as a string and returns the C&lt;Config::Tiny&gt; object for it.
 
-=head2 write $filename
+=head2 write $filename [$encoding]
 
 The C&lt;write&gt; method generates the file content for the properties, and
-writes it to disk to the filename specified.
+writes it to disk to the filename specified. The encoding can be
+optionally specified as well.
 
 Returns true on success or C&lt;undef&gt; on error.
 
-- 
Mark Lawrence
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1103951" href="/Public/Bug/Display.html?id=71029#txn-1103951">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;29&nbsp;21:15:36&nbsp;2012</span>
    <span class="description">MLAWREN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1103951/580421/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/580421">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 226b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have just released Alt::Config::Tiny::utf8 to CPAN with an alternative
Config::Tiny inside with this fix/feature added. I&#39;ll remove it as soon
as this bug is fixed.

See the &#34;Alt&#34; distribution for details.

-- 
Mark Lawrence
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1103954" href="/Public/Bug/Display.html?id=71029#txn-1103954">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;29&nbsp;21:15:37&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1119021" href="/Public/Bug/Display.html?id=71029#txn-1119021">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;12&nbsp;02:26:51&nbsp;2012</span>
    <span class="description">pushtaev [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1119021/588701/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/588701">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I wrote a letter to Adam. He said he is ok with this changes, &#34;but moving to three-argument open&#40;&#41; might be 
a bit premature &#40;It adds a Perl 5.6 dependency&#41;&#34;.

I suggest something like this:


diff --git a/Tiny.pm b/Tiny.pm
index 2496129..7271c3e 100644
--- a/Tiny.pm
+++ b/Tiny.pm
@@ -22,9 +22,18 @@ sub read {
        return $class-&gt;_error&#40; &#34;&#39;$file&#39; is a directory, not a file&#34; &#41;       unless -f _;
        return $class-&gt;_error&#40; &#34;Insufficient permissions to read &#39;$file&#39;&#34; &#41; unless -r _;

+       my $encoding = shift;
+
        # Slurp in the file
        local $/ = undef;
-       open&#40; CFG, $file &#41; or return $class-&gt;_error&#40; &#34;Failed to open file &#39;$file&#39;: $!&#34; &#41;;
+       my $open_result;
+       if &#40; defined $encoding &#41; {
+               require 5.006;
+               $open_result = open&#40; CFG, &#34;&lt;:encoding&#40;$encoding&#41;&#34;, $file &#41;;
+       } else {
+               $open_result = open&#40; CFG, $file &#41;;
+       }
+       return $class-&gt;_error&#40; &#34;Failed to open file &#39;$file&#39;: $!&#34; &#41; unless $open_result;
        my $contents = &lt;CFG&gt;;
        close&#40; CFG &#41;;

@@ -76,13 +85,19 @@ sub write {
        my $file = shift or return $self-&gt;_error&#40;
                &#39;No file name provided&#39;
                &#41;;
+       my $encoding = shift;

        # Write it to the file
        my $string = $self-&gt;write_string;
        return undef unless defined $string;
-       open&#40; CFG, &#39;&gt;&#39; . $file &#41; or return $self-&gt;_error&#40;
-               &#34;Failed to open file &#39;$file&#39; for writing: $!&#34;
-               &#41;;
+       my $open_result;
+       if &#40; $encoding &#41; {
+               require 5.006;
+               $open_result = open&#40; CFG, &#34;&gt;:&#40;$encoding&#41;&#34;, $file &#41;;
+       } else {
+               $open_result = open&#40; CFG, &#39;&gt;&#39; . $file &#41;;
+       }
+       return $self-&gt;_error&#40; &#34;Failed to open file &#39;$file&#39; for writing: $!&#34; &#41; unless $open_result;
        print CFG $string;
        close CFG;
 }
@@ -161,6 +176,10 @@ Config::Tiny - Read/Write .ini style files with as little code as possible
     # Save a config
     $Config-&gt;write&#40; &#39;file.conf&#39; &#41;;

+    # Also with encoding
+    $Config = Config::Tiny-&gt;read&#40; &#39;utf8_file.conf&#39;, &#39;utf8&#39; &#41;;
+    $Config-&gt;write&#40; &#39;utf8_file.conf&#39;, &#39;utf8&#39; &#41;;
+
 =head1 DESCRIPTION

 C&lt;Config::Tiny&gt; is a perl class to read and write .ini style configuration
@@ -200,10 +219,11 @@ something better, this module is not for you.

 The constructor C&lt;new&gt; creates and returns an empty C&lt;Config::Tiny&gt; object.

-=head2 read $filename
+=head2 read $filename [$encoding]


 The C&lt;read&gt; constructor reads a config file, and returns a new
-C&lt;Config::Tiny&gt; object containing the properties in the file.
+C&lt;Config::Tiny&gt; object containing the properties in the file. An
+optional argument specifies the encoding.

 Returns the object on success, or C&lt;undef&gt; on error.

@@ -218,10 +238,11 @@ the C&lt;$!&gt; variable.
 The C&lt;read_string&gt; method takes as argument the contents of a config file
 as a string and returns the C&lt;Config::Tiny&gt; object for it.

-=head2 write $filename
+=head2 write $filename [$encoding]

 The C&lt;write&gt; method generates the file content for the properties, and
-writes it to disk to the filename specified.
+writes it to disk to the filename specified. The encoding can be
+optionally specified as well.

 Returns true on success or C&lt;undef&gt; on error.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1119024" href="/Public/Bug/Display.html?id=71029#txn-1119024">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;12&nbsp;02:37:10&nbsp;2012</span>
    <span class="description">pushtaev [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1119024/588704/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/588704">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 176b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">By the way, the current workaround I use is:

use Config::Tiny;
use File::Slurp;
my $conf = Config::Tiny-&gt;read_string&#40;
        scalar read_file&#40; $file, binmode =&gt; &#39;:utf8&#39; &#41;
&#41;;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1119325" href="/Public/Bug/Display.html?id=71029#txn-1119325">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;12&nbsp;17:42:14&nbsp;2012</span>
    <span class="description">nomad [...] null.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #71029] Config::Tiny does not handle or enable non-ascii config text</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 13 Sep 2012 09:41:53 +1200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Pushtaev Vadim via RT &lt;bug-Config-Tiny [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Lawrence &lt;nomad [...] null.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1119325/588867/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/588867">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 968b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Sep 12, 2012 at 02:26:52AM -0400, Pushtaev Vadim via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; I wrote a letter to Adam. He said he is ok with this changes, &#34;but
&gt; moving to three-argument open&#40;&#41; might be a bit premature &#40;It adds a
&gt; Perl 5.6 dependency&#41;&#34;.
</div>
It is up to Adam how much compatability he wishes to retain, but it is
worth noting that CPAN testers do not appear to be testing against
anything less than 5.6.2:

    <span class="clickylink"><a target="new" rel="nofollow" href="http://matrix.cpantesters.org/?dist=Config-Tiny">http://matrix.cpantesters.org/?dist=Config-Tiny</a></span>

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I suggest something like this:
&gt; ...
&gt; +       my $open_result;
&gt; +       if &#40; defined $encoding &#41; {
&gt; +               require 5.006;
</div>
That doesn&#39;t feel right to me, as it looks like an unpleasant surprise
in the making.  The distribution could pass all tests during
installation but still fail at runtime, depending on some combination
of Perl version and Config::Tiny usage. If this feature is added I
think it should also come with a minimum version requirement from the
beginning.

Mark.
-- 
Mark Lawrence
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1119327" href="/Public/Bug/Display.html?id=71029#txn-1119327">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;12&nbsp;17:46:56&nbsp;2012</span>
    <span class="description">nomad [...] null.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #71029] Config::Tiny does not handle or enable non-ascii config text</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 13 Sep 2012 09:46:37 +1200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Pushtaev Vadim via RT &lt;bug-Config-Tiny [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Lawrence &lt;nomad [...] null.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1119327/588869/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/588869">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 547b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Sep 12, 2012 at 02:37:11AM -0400, Pushtaev Vadim via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=71029">https://rt.cpan.org/Ticket/Display.html?id=71029</a></span> &gt;
&gt; 
&gt; By the way, the current workaround I use is:
&gt; 
&gt; use Config::Tiny;
&gt; use File::Slurp;
&gt; my $conf = Config::Tiny-&gt;read_string&#40;
&gt;         scalar read_file&#40; $file, binmode =&gt; &#39;:utf8&#39; &#41;
&gt; &#41;;
</div>
Have you seen the amount of code in File::Slurp and the number of
modules it pulls in? Sort of cancels out the &#34;Tiny&#34; part of
Config::Tiny :-/

That&#39;s why I built the Alt::Config::Tiny::utf8 distribution.

-- 
Mark Lawrence
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1119464" href="/Public/Bug/Display.html?id=71029#txn-1119464">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;13&nbsp;02:48:16&nbsp;2012</span>
    <span class="description">pushtaev [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1119464/588922/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/588922">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 596b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Sep 12 17:46:56 2012, nomad@null.net wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Have you seen the amount of code in File::Slurp and the number of
&gt; modules it pulls in? Sort of cancels out the &#34;Tiny&#34; part of
&gt; Config::Tiny :-/
&gt; 
&gt; That&#39;s why I built the Alt::Config::Tiny::utf8 distribution.
&gt; 
</div>
In my case, I need freebsd-port within perl module I want to use, and 
there are not standard ports of alt-modules. On the other hand I don&#39;t 
really care about &#34;tiny&#34; part. But you are right, in some cases this 
workaround isn&#39;t appropriate.


Talking about &#34;require 5.006&#34;, it&#39;s Adam to decide &#40;but I share your 
opinion&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1167758" href="/Public/Bug/Display.html?id=71029#txn-1167758">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;08&nbsp;15:44:00&nbsp;2013</span>
    <span class="description">pushtaev [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1167758/615731/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/615731">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 54b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Adam, we still need your decision.

Thanks in advance.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1260135" href="/Public/Bug/Display.html?id=71029#txn-1260135">#</a>      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;08&nbsp;20:47:39&nbsp;2013</span>
    <span class="description">RSAVAGE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1260135/667152/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/667152">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 41b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanx for the ideas. V 2.15 handles utf8.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1260138" href="/Public/Bug/Display.html?id=71029#txn-1260138">#</a>      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;08&nbsp;20:47:39&nbsp;2013</span>
    <span class="description">RSAVAGE [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.543116</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
