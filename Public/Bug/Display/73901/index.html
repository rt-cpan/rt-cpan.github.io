<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #73901 for App-Cmd: t/capture-ext.t fails on Win32</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #73901 for App-Cmd: t/capture-ext.t fails on Win32</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/App-Cmd/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/App-Cmd/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/App-Cmd/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/App-Cmd/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/rjbs/App-Cmd/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/App-Cmd">App-Cmd CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">73901</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/App-Cmd/Active/">App-Cmd</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
DOUGDUDE [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-39888-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.314    </td>
  </tr>
  <tr id="CF-39889-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;11&nbsp;11:01:17&nbsp;2012</span>
    <span class="description">DOUGDUDE [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> t/capture-ext.t fails on Win32</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The t/capture-ext.t test fails in Win32 &#40;and, really, any system which
does not have an external &#34;echo&#34; program&#41;. Technically running
system&#40;&#39;echo&#39;, &#39;Hello World&#39;&#41; does work on Win32, but IPC::Cmd looks for
the program named echo, which does not exist. system&#40;&#41; is make to retry
failed commands within the cmd.exe shell on Win32, thus allowing echo to
work.

My suggestion for fixing the test is to change the test to just also
accept the valid output &#34;Program &#39;echo&#39; not found&#34; for the hello
command. I have attached what I think may be a solution.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-t-capture-ext.t-should-handle-valid-error-output.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From f03ce6b5fed7f99b0436c410ba4bbe2ad830a1bd Mon Sep 17 00:00:00 2001
From: Douglas Christopher Wilson &lt;doug@somethingdoug.com&gt;
Date: Wed, 11 Jan 2012 10:58:13 -0500
Subject: [PATCH] t/capture-ext.t should handle valid error output.

---
 t/capture-ext.t |    6 +++++-
 1 files changed, 5 insertions&#40;+&#41;, 1 deletions&#40;-&#41;

diff --git a/t/capture-ext.t b/t/capture-ext.t
index 82daf32..a6466bb 100644
--- a/t/capture-ext.t
+++ b/t/capture-ext.t
@@ -16,5 +16,9 @@ isa_ok&#40;$app, &#39;Test::MyCmd&#39;&#41;;
 
 my $return = test_app&#40;&#39;Test::MyCmd&#39;, [ qw&#40;hello&#41; ]&#41;;
 
-like&#40; $return-&gt;output, qr/Hello World/, &#34;Captured external subcommand output&#34; &#41;;
+if &#40;defined $return-&gt;error&#41; {
+  like&#40; $return-&gt;error, qr/Program &#39;echo&#39; not found/, &#34;Captured external subcommand output - no echo&#34; &#41;;
+} else {
+  like&#40; $return-&gt;output, qr/Hello World/, &#34;Captured external subcommand output&#34; &#41;;
+}
 
-- 
1.7.6.msysgit.0

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;14&nbsp;00:57:55&nbsp;2012</span>
    <span class="description">AERO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">It seems that can_run function in Module::Install has a problem.
In t\lib\Test\MyCmd\Command\hello.pm file, the below line doesn&#39;t return
command name as true value.
  my $echo = can_run&#40;&#34;echo&#34;&#41;;

can_run function can&#39;t catch window cmd.exe&#39;s internal command.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;perl -Minc::Module::Install -E &#34;say can_run&#40;&#39;notepad&#39;&#41; ? &#39;yes&#39;:&#39;no&#39;&#34;
</div>yes
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;perl -Minc::Module::Install -E &#34;say can_run&#40;&#39;dir&#39;&#41; ? &#39;yes&#39;:&#39;no&#39;&#34;
</div>no
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;perl -Minc::Module::Install -E &#34;say can_run&#40;&#39;echo&#39;&#41; ? &#39;yes&#39;:&#39;no&#39;&#34;
</div>no

Is this Module::Install module problem ?


On Wed Jan 11 11:01:17 2012, DOUGDUDE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The t/capture-ext.t test fails in Win32 &#40;and, really, any system which
&gt; does not have an external &#34;echo&#34; program&#41;. Technically running
&gt; system&#40;&#39;echo&#39;, &#39;Hello World&#39;&#41; does work on Win32, but IPC::Cmd looks for
&gt; the program named echo, which does not exist. system&#40;&#41; is make to retry
&gt; failed commands within the cmd.exe shell on Win32, thus allowing echo to
&gt; work.
&gt; 
&gt; My suggestion for fixing the test is to change the test to just also
&gt; accept the valid output &#34;Program &#39;echo&#39; not found&#34; for the hello
&gt; command. I have attached what I think may be a solution.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;14&nbsp;00:57:56&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;14&nbsp;17:53:18&nbsp;2012</span>
    <span class="description">DOUGDUDE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Jan 14 00:57:55 2012, AERO wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It seems that can_run function in Module::Install has a problem.
&gt; In t\lib\Test\MyCmd\Command\hello.pm file, the below line doesn&#39;t return
&gt; command name as true value.
&gt;   my $echo = can_run&#40;&#34;echo&#34;&#41;;
&gt; 
&gt; can_run function can&#39;t catch window cmd.exe&#39;s internal command.
&gt; 
<div class="message-stanza open">&gt; &gt;perl -Minc::Module::Install -E &#34;say can_run&#40;&#39;notepad&#39;&#41; ? &#39;yes&#39;:&#39;no&#39;&#34;
</div>&gt; yes
<div class="message-stanza open">&gt; &gt;perl -Minc::Module::Install -E &#34;say can_run&#40;&#39;dir&#39;&#41; ? &#39;yes&#39;:&#39;no&#39;&#34;
</div>&gt; no
<div class="message-stanza open">&gt; &gt;perl -Minc::Module::Install -E &#34;say can_run&#40;&#39;echo&#39;&#41; ? &#39;yes&#39;:&#39;no&#39;&#34;
</div>&gt; no
&gt; 
&gt; Is this Module::Install module problem ?
&gt; 
</div>can_run is imported from IPC::Cmd, not from Module::Install.

IMO it is not a problem with IPC::Cmd&#39;s can_run. It is documented that
can_run is a universal replacement for using which. Since Win32 does not
have a binary named echo in the PATH by default, can_run correctly
returns undef. I think this is appropriate and would affect any system
that does not have a program named echo in the PATH at the time the test
suite is run. I think the test should be altered to accept that running
the hello can correctly output an error that echo was not found.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;07&nbsp;08:21:28&nbsp;2013</span>
    <span class="description">rjbs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I believe this was fixed by 0.315

-- 
rjbs
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;07&nbsp;08:21:29&nbsp;2013</span>
    <span class="description">rjbs [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
