<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #110820 for Crypt-PKCS10: Fails to parse PEM.  Other issues.  With patch.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #110820 for Crypt-PKCS10: Fails to parse PEM.  Other issues.  With patch.</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Crypt-PKCS10">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Crypt-PKCS10">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Crypt-PKCS10">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Crypt-PKCS10">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Crypt-PKCS10">Crypt-PKCS10 CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">110820</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Crypt-PKCS10">Crypt-PKCS10</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">tlhackque [...] yahoo.com
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
tlhackque [...] yahoo.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-256372-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
1.3</li>
<li>
1.0</li>
<li>
1.1</li>
<li>
1.2</li>
</ul>
    </td>
  </tr>
  <tr id="CF-256373-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.401-TRIAL    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




PKCS10_patch_1.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1578735/843166/PKCS10_patch_1.patch">
Thu Dec 31 12:54:51 2015 (20.8k) by tlhackque [...] yahoo.com
</a>
</font></li>
</ul>


PKCS10_patch_2.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1578780/843201/PKCS10_patch_2.patch">
Thu Dec 31 15:10:36 2015 (21.4k) by tlhackque [...] yahoo.com
</a>
</font></li>
</ul>


PKCS10_patch_3.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1578787/843205/PKCS10_patch_3.patch">
Thu Dec 31 16:40:03 2015 (22.1k) by tlhackque [...] yahoo.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=110820">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1578735" href="/Public/Bug/Display.html?id=110820#txn-1578735">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;31&nbsp;12:54:51&nbsp;2015</span>
    <span class="description">tlhackque [...] yahoo.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Fails to parse PEM.  Other issues.  With patch.</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1578735/843165/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/843165">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 5.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you for creating this.

I found &#38; fixed several issues while exploring.  I also removed trailing whitespace and did a small amount of code cleanup in the attached patch.  I didn&#39;t bump the version.

1&#41; PEM CSR&#39;s output by openssl start with the PUBLIC KEY block.  There can be other data before &#40;or after&#41; the CSR in a file.

new&#40;&#41; doesn&#39;t expect this.  The test for PEM input needs /ms rather than /s.

2&#41; The access methods don&#39;t support repeated attributes.
E.g. in the first test certificate below, the subject is
/C=AU/ST=Some-State/L=my city/O=Internet Widgits Pty Ltd/OU=Big org/OU=Smaller org/CN=My Name/emailAddress=none@no-email.com

Note that /OU occurs twice.

Fix: if called in array context, return an array instead of the first item parsed.

This should be compatible with most uses; however existing calls in array context may need to do one of:
  &#40;scalar $decoded-&gt;functionName&#41;
or join&#40; &#39;, &#39;, $decoded-&gt;functionName&#41;

3&#41; extensionValue crashes if given a certificate with no extensions, e.g. test 1 below.

Fix: return undef in that case.
Also, document extensionValue

For these items, see the second CSR

4&#41; the OID for serialNumber is 2.5.4.5; you have it as 2.5.4.12

Fix: change the hash entry

5&#41; _convert_rdn doesn&#39;t handle multiple items.  Here, unstructuredName is missed.  Also doesn&#39;t handle multiple values.

Fix: loop over the array and include all items.
Also, simplify the code &#40;push will autovivify the value array&#41;

6&#41; It is not possible to obtain the actual subject of the CSR.

The order of components is lost by converting them to a hash.
The order is significant: &#34;/C=AU/CN=Fred&#34; is NOT the same as &#34;/CN=Fred/C=AU&#34;.

Fix: Add the &#39;subject&#39; access method.  This returns a string of the form /countryName=AU/organizationalUnitName=Big org ... in scalar context, or an array of &#40;name, [values]&#41; pairs in array context.

7&#41; A few useful OIDs were missing.

Fix: Added.

8&#41; domainComponent can crash if called when none are present.

Fix: Return empty list in this case.

9&#41; There is no way to determine if an extension is marked &#39;critical&#39;.

Fix:  Add extensionPresent&#40;name&#41;.  Returns 1 if present, 2 if present and marked &#39;critical&#39;, undef otherwise.

10&#41; attributes&#40;&#41; can crash if none are present.

Fix: Return empty list.

11&#41; The module has no exports; it is not necessary to use Exporter.

Fix: Remove dependency.

12&#41; There are no access methods for many subject name components.

Fix: Automatically generate them when present.  &#40;To see if a component name has a method, use $decoded-&gt;can&#40;&#39;localityName&#39;&#41; &#41;.

This approach avoids the hassle of creating a new patch every time some strange OID is encountered in a subject name.

Use a similar approach to create the documented &#39;always present&#39; subject access method.

Test data:
====Example 1

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDO8GrRcQnEVSQkQzFLLl5Y/qIE
7bhXpuQaC0vvqBXHM5ALpdrl87JVwpwfSeeIEZDuJNTkiseKOJdtLMVWEIUP2ISy
tUFxf3irt4QsrU9Xd2VG99NKq73GrEn0HwGCPBa/CHpLicqIgk2C0B1ns9CXwNKA
YxVR1MMhWDJSFfz31QIDAQAB
-----END PUBLIC KEY-----
-----BEGIN CERTIFICATE REQUEST-----
MIIB9DCCAV0CAQAwgbMxCzAJBgNVBAYTAkFVMRMwEQYDVQQIDApTb21lLVN0YXRl
MRAwDgYDVQQHDAdteSBjaXR5MSEwHwYDVQQKDBhJbnRlcm5ldCBXaWRnaXRzIFB0
eSBMdGQxEDAOBgNVBAsMB0JpZyBvcmcxFDASBgNVBAsMC1NtYWxsZXIgb3JnMRAw
DgYDVQQDDAdNeSBOYW1lMSAwHgYJKoZIhvcNAQkBFhFub25lQG5vLWVtYWlsLmNv
bTCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAzvBq0XEJxFUkJEMxSy5eWP6i
BO24V6bkGgtL76gVxzOQC6Xa5fOyVcKcH0nniBGQ7iTU5IrHijiXbSzFVhCFD9iE
srVBcX94q7eELK1PV3dlRvfTSqu9xqxJ9B8BgjwWvwh6S4nKiIJNgtAdZ7PQl8DS
gGMVUdTDIVgyUhX899UCAwEAAaAAMA0GCSqGSIb3DQEBBQUAA4GBAF0ulFJ0XAq2
+L2Y559GRB99G6OJHZG51Ze/MDN+ZKqrSw1CBV2qCxrspdhgtmzutIZliUClzaex
s7NlOgbMnrPt6TVyi5Alsw0kb6ALbIjhkFOd6rzZqSZFekTgGu+PtUkZC5ogo8O4
E+Ob8iHsm6kgbmE2sxfCURxDMVn4FlCa
-----END CERTIFICATE REQUEST-----

===Example 2

<div class="message-stanza open">-----BEGIN CERTIFICATE REQUEST-----
MIIDJzCCAg8CAQAwgcAxITAfBgkqhkiG9w0BCQEWEnNlY3VyaXR5QGxpdHRzLm5l
dDEWMBQGA1UECBMNTWFzc2FjaHVzZXR0czELMAkGA1UEBhMCVVMxGjAYBgNVBAMT
EXBpY28uc2IubGl0dHMubmV0MRAwDgYDVQQLEwdSb3V0ZXJzMRIwEAYDVQQKEwls
aXR0cy5uZXQxNDASBgNVBAUTC0ZUWDE1NTI4MFFYMB4GCSqGSIb3DQEJAhYRcGlj
by5zYi5saXR0cy5uZXQwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCV
r5YvIb2n1+jws8ntmeMRtC/ZjxMke2G4moIWioj/Cxhy9bj7fieNyEGfg712CBmh
btxBTuTZvVbFZK66W3NlugbHnbGH0LvfrIjgHIkEovwd2v34XJgFE3ETM8AZb79+
NqUr2m+uy+ukL97WctOlgW+RcE/CSHDp+S2YBlM/K8tdOQWJ4d7RB/wCaQp+Ad4c
fpWDrOZPawYEu6Saxc7Q3WxjXpUdj+qyY3t2ELcxwkgZy1PALH0KddqMQkLQfH+0
v4aIFGc23egJutDm+6PBVZQ+ShDPbkS7RSs4IXtbZvu7bHaf7pOqQt/QS0fWwBn5
zYvGaX+1+OJRrbb4t+aVAgMBAAGgITAfBgkqhkiG9w0BCQ4xEjAQMA4GA1UdDwEB
/wQEAwIFoDANBgkqhkiG9w0BAQQFAAOCAQEAJV/s65GMJkhN40dNU4cm7Gx8fD/l
+xyatoIcrFVafiSmCNnwiLqyxhFWGesx5vBiKVJNR0Mn7rWC/aBZp/jifI7sLMxW
+AeYtULI3TYTs5Q1QOcap4tlQMsxExMmSAADfn/zZUomNnHLt8/ctGtGLyTm9pyq
rI8exr1e8fYxica569Zd1d0A3i1YtUPMvYpFCQaT4WUi3EKTHE14zqKH/4eMnK6g
iJaMVNtdzH5KaBhNK8Ua6vlcBRAMKY+ynH3APK28QnUu/x+4WrCFFs95UhslmFBn
b5jb9VDmLCqcbwagLhCXLwQfDr5JhCcLMGESJ9omWpA3XWWdhdsVcig5Pg==
-----END CERTIFICATE REQUEST-----

Test program &#40;use perl -d &lt;test.csr&#41;

#!/usr/bin/perl

use warnings;
use strict;
use Crypt::PKCS10;

use Data::Dumper;

$Data::Dumper::Sortkeys = 1;

my $pem;
{
 local $/;

        $pem = &lt;&gt;;
}
my $csr = Crypt::PKCS10-&gt;new&#40;$pem&#41;;

print Dumper&#40;$csr-&gt;subject, $csr-&gt;organizationalUnitName, &#40;scalar $csr-&gt;organizationalUnitName &#41;&#41;;

print scalar $csr-&gt;subject, &#34;\n&#34;;

print &#40;scalar $csr-&gt;serialNumber, &#34;\n&#34;&#41; if&#40; $csr-&gt;can&#40;&#39;serialNumber&#39;&#41;;

Testing done under perl 5.8.8.
</div></div></div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> PKCS10_patch_1.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1578735/843166/PKCS10_patch_1.patch">Download PKCS10_patch_1.patch</a><br />
<span class="downloadcontenttype">text/x-diff 20.8k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1578780" href="/Public/Bug/Display.html?id=110820#txn-1578780">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;31&nbsp;15:10:36&nbsp;2015</span>
    <span class="description">tlhackque [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Updated patch: add ability to extract CSR</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> tlhackque [...] yahoo.com</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1578780/843200/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/843200">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 433b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve also found it useful to be able to extract the binary CSR.

For example, Crypt::PKCS10 will &#40;now&#41; find the PEM anywhere in a text file.  And it also will remove any bits in the binary that extend beyond the ASN.1 structure.  It&#39;s useful to be able to put that into OpenSSL for debugging, or to archive the bits.

The attached updated patch adds the csrRequest method, which supports extracting the CSR as either PEM or binary.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> PKCS10_patch_2.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1578780/843201/PKCS10_patch_2.patch">Download PKCS10_patch_2.patch</a><br />
<span class="downloadcontenttype">text/x-diff 21.4k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1578787" href="/Public/Bug/Display.html?id=110820#txn-1578787">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;31&nbsp;16:40:03&nbsp;2015</span>
    <span class="description">tlhackque [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Add extract public key for other tools</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> tlhackque [...] yahoo.com</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1578787/843204/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/843204">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry about the string of changes, but here&#39;s one more version of the patch &#40;includes all previous&#41;.

It&#39;s useful to be able to extract the public key as a PEM string, which other tools expect.

So this version of the patch adds a $format parameter to subjectPublicKey&#40;&#41; to do that.

With this change, it&#39;s possible to parse a CSR with Crypt::PKCS10 and generate a signed certificate using Crypt::OpenSSL::CA.

Here&#39;s a simple example:

#!/usr/bin/perl

use warnings;
use strict;
use Crypt::PKCS10;
use Crypt::OpenSSL::CA;
use MIME::Base64;

my $pem;
{
 local $/;

        $pem = &lt;&gt;;
}
my $csr = Crypt::PKCS10-&gt;new&#40;$pem&#41;;

# Validate the signature on the CSR &#38; get the public key

eval {
    my $crt = Crypt::OpenSSL::CA::PublicKey-&gt;validate_PKCS10&#40; $csr-&gt;csrRequest&#40;1&#41; &#41;;
}; if&#40; $@ &#41; {
    print &#34;CSR validation failed: $@\n&#34;;
    exit;
}

# If you don&#39;t want to validate, just get the public key:
# $crt = Crypt::OpenSSL::CA::X509-&gt;new&#40; Crypt::OpenSSL::CA::PublicKey-&gt;parse_RSA&#40; $csr-&gt;subjectPublicKey&#40;1&#41; &#41; &#41;;

# Add the necessary stuff to the certificate.
# Reformat the subject&#39;s DN to suit the CA

my @dn = $csr-&gt;subject;
my @subj = &#40;&#41;;
while&#40; @dn &#41; {
    push @subj, shift @dn;
    push @subj, join&#40; &#34;,&#34;, @{shift @dn} &#41;;
}

my $dn = Crypt::OpenSSL::CA::X509_NAME-&gt;new&#40; @subj &#41;;

$crt-&gt;set_serial&#40; &#34;0x1&#34;&#41;;
$crt-&gt;set_subject_DN&#40; $dn &#41;;
$crt-&gt;set_issuer_DN&#40; $dn &#41;;   # self-signed
$crt-&gt;set_extension&#40;&#34;basicConstraints&#34;, &#34;CA:FALSE&#34;, -critical =&gt; 1 &#41;;

my $privkey = Crypt::OpenSSL::CA::PrivateKey-&gt;parse&#40; &lt;&lt; &#34;_KEY&#34; &#41;;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----BEGIN PRIVATE KEY-----
MIICdQIBADANBgkqhkiG9w0BAQEFAASCAl8wggJbAgEAAoGBAMkWdxqw1pd+Jakt
6oyZASeXF+k6ysCRilPHDJjXZNalinIHMzU82RYepYN1h03OX1qaypc5+jtEHEQ2
f0LlOJ/BIDSjEqlKaYxgdGarbsSqVYAnVdb8TWBhyDxD4DBpZXFiIvZnKo7ggEIf
eqOwHaUUD4p8+BWI0T0ucbkQFChHAgMBAAECgYAaQvvVGYk9CbWDbcK3D/htojb2
N75o/djx7goAIAlEWyRElhoi9spnMCNvkrbT+4LKg3K341OBz/hdFDz0kJkfUHVe
a3xPV6txwV9ww85gWqdDBJGym5xOx3b1gB911k/XgL1THEnnN6Levg9kAcd/NGZ8
/Dw38lQwdQnLyVxWEQJBAPu0Xmg+xgV8BhBA8mUaj2qydGFhjB2CEnkWgRILp2ZI
gQCIK9XBjF/7fkZLzQ7mpSxTc4RC95oXYeP+SPMezskCQQDMhPcD+xM3NJusrU22
m2ObtiNv6V64qVCbkGmY/bj2+qrpq6o/L+V5INMDzQArcadYPE1yKoIlCd9SZkC7
HnaPAkB7/8malYI8ZXMfQr+na0RIDg4jg0jhqJitKpb/atpXG1TiDDN8JNOg3WbB
/snQk3O/uITqHYuZT/ebuEP78atxAkA6jM5Su2xS36K5mpum7XFkwI4AmeTeJMrI
3lz8yZZMTpLjdpu0nzeop7cBXYzw4wavggQB7R15EQx4AIIDj8MNAkBMq5LvocI2
5XKAKB77uscP/Haocx2dnd1ZGZNyGqvRun/3Xzj3s4ryUGx1SytadPFSO7vMQh8h
xx6iORYrEee5
-----END PRIVATE KEY-----
_KEY

my $signed = $crt-&gt;sign&#40; $privkey, &#34;sha1&#34; &#41;;

print $signed;
</div></div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> PKCS10_patch_3.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1578787/843205/PKCS10_patch_3.patch">Download PKCS10_patch_3.patch</a><br />
<span class="downloadcontenttype">text/x-diff 22.1k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1578992" href="/Public/Bug/Display.html?id=110820#txn-1578992">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;01&nbsp;16:44:22&nbsp;2016</span>
    <span class="description">tlhackque [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> See git pull request for latest patch</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> tlhackque [...] yahoo.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1578992/843313/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/843313">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 355b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I noticed that you have a git repo, so I generated a pull request there.

4th change is minor correction.

Thanks.


@@ -123,7 +123,7 @@ sub new {
     my $substr = substr&#40; $der, 0, unpack&#40;&#34;n*&#34;, substr&#40;$der, 2, 2&#41;&#41; + 4 &#41;;
     no bytes;
 
-    my $self = { _der =&gt; $der };
+    my $self = { _der =&gt; $substr };
     bless&#40; $self, $class &#41;;
 
     my $top =
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1580738" href="/Public/Bug/Display.html?id=110820#txn-1580738">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;05&nbsp;19:34:41&nbsp;2016</span>
    <span class="description">tlhackque [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Allow users to register OIDs</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> tlhackque [...] yahoo.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1580738/844415/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/844415">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 247b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Another pull request on github implements the ability for users to register custom OIDs &#40;or those not yet added to this module&#41;.

Cleaned up implementation of domainComponent&#40;&#41;.

Not bothering to duplicate the patch here.

Thanks for the support.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1580755" href="/Public/Bug/Display.html?id=110820#txn-1580755">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;05&nbsp;22:32:09&nbsp;2016</span>
    <span class="description">tlhackque [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> /UID missing in subject</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> tlhackque [...] yahoo.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1580755/844427/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/844427">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 415b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">UID is not recognized in an RDN.

Interestingly, the CSR used by the tests includes /UID=123456:

/DC=org/DC=OpenSSL/DC=users/CN=test/UID=123456/emailAddress=test@test.com

But it was never accessible or verified.

Fix:
Add the OID to the known OIDs hash.

As usual, an accessor for UID will materialize if UID is present in an RDN.

Add a test for the full subject to the tests.

Code is in current pull request.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1583863" href="/Public/Bug/Display.html?id=110820#txn-1583863">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;13&nbsp;15:17:43&nbsp;2016</span>
    <span class="description">tlhackque [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Fixed in the next release</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1583863/846356/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/846356">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 41b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">These will be fixed in the next release.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1583865" href="/Public/Bug/Display.html?id=110820#txn-1583865">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;13&nbsp;15:17:44&nbsp;2016</span>
    <span class="description">tlhackque [...] yahoo.com -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1583866" href="/Public/Bug/Display.html?id=110820#txn-1583866">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;13&nbsp;15:17:45&nbsp;2016</span>
    <span class="description">tlhackque [...] yahoo.com -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1584367" href="/Public/Bug/Display.html?id=110820#txn-1584367">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;15&nbsp;03:49:09&nbsp;2016</span>
    <span class="description">tlhackque [...] yahoo.com -  Fixed in 1.401-TRIAL added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1584368" href="/Public/Bug/Display.html?id=110820#txn-1584368">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;15&nbsp;03:49:09&nbsp;2016</span>
    <span class="description">tlhackque [...] yahoo.com -  Broken in 1.0 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1584369" href="/Public/Bug/Display.html?id=110820#txn-1584369">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;15&nbsp;03:49:09&nbsp;2016</span>
    <span class="description">tlhackque [...] yahoo.com -  Broken in 1.1 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1584370" href="/Public/Bug/Display.html?id=110820#txn-1584370">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;15&nbsp;03:49:10&nbsp;2016</span>
    <span class="description">tlhackque [...] yahoo.com -  Broken in 1.2 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1584371" href="/Public/Bug/Display.html?id=110820#txn-1584371">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;15&nbsp;03:49:10&nbsp;2016</span>
    <span class="description">tlhackque [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1584371/846678/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/846678">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 31b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Incorporated/fixed in V1.4_01.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1584373" href="/Public/Bug/Display.html?id=110820#txn-1584373">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;15&nbsp;03:49:11&nbsp;2016</span>
    <span class="description">tlhackque [...] yahoo.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.6161</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
