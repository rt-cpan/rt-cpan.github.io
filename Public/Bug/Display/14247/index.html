<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #14247 for Class-Std: Class::Std::Storable</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #14247 for Class-Std: Class::Std::Storable</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Class-Std">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Class-Std">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Class-Std">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Class-Std">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Class-Std">Class-Std CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">14247</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Class-Std">Class-Std</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
luke [...] daeron.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-7300-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-7301-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Class-Std-Storable.pm<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/140145/39161/Class-Std-Storable.pm">
Sun Aug 21 13:10:39 2005 (10.3k) by dspizz [...] dspizz.com
</a>
</font></li>
</ul>


Class-Std-Storable.t<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/140145/39162/Class-Std-Storable.t">
Sun Aug 21 13:10:40 2005 (3.6k) by dspizz [...] dspizz.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=14247">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-140145" href="/Public/Bug/Display.html?id=14247#txn-140145">#</a>      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;21&nbsp;13:10:39&nbsp;2005</span>
    <span class="description">luke [...] daeron.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 21 Aug 2005 13:10:30 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Luke Meyer &lt;luke [...] daeron.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Class-Std [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Class::Std::Storable</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/140145/39160/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/39160">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 731b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Alright; starting a new ticket because of too many false starts in the 
other one :-&#41;

I now have a fully-formed Class::Std::Storable, with documentation and 
everything.  It still breaks encapsulation in theory &#40;though it doesn&#39;t 
allow changing attributes on existing objects&#41;, and it relies on a few 
Class::Std internals to stay the same, but I think the approach is 
basically as sound as possible.

The question for you, Damian, is whether you would like to:
1&#41; Include this in the Class::Std distribution
2&#41; Look into including the functionality as an import option in 
Class::Std itself &#40;I&#39;d be happy to do the work&#41;
3&#41; Disavow any connection with the thing and I can upload to CPAN as a 
separate distro

All fine by me.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/140145/39161/Class-Std-Storable.pm">Download Class-Std-Storable.pm</a><br />
<span class="downloadcontenttype">text/x-perl 10.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">package Class::Std::Storable;

use version; $VERSION = qv&#40;&#39;0.0.1&#39;&#41;;
use strict;
use warnings;
use Class::Std; #get subs from parent to export
use Carp;

#hold attributes by package
my %attribute;

my @exported_subs = qw&#40;
    new
    ident
    DESTROY
    MODIFY_HASH_ATTRIBUTES
    MODIFY_CODE_ATTRIBUTES
    AUTOLOAD
    _DUMP
    STORABLE_freeze
    STORABLE_thaw
&#41;;

sub import {
    no strict &#39;refs&#39;;
    for my $sub &#40; @exported_subs &#41; {
        *{ caller&#40;&#41; . &#39;::&#39; . $sub } = \&#38;{$sub};
    }
}

#NOTE: this subroutine should override the one that&#39;s imported
#by the &#34;use Class::Std&#34; above.
{
    my $old_sub = \&#38;MODIFY_HASH_ATTRIBUTES;
    my %positional_arg_of;
    my $new_sub = sub {
        my &#40;$package, $referent, @attrs&#41; = @_;
        my @return_attrs = $old_sub-&gt;&#40;@_&#41;;

        for my $attr &#40;@attrs&#41; {
            next if $attr !~ m/\A ATTRS? \s* &#40;?:[&#40;] &#40;.*&#41; [&#41;] &#41;? \z/xms;
            my $name;
            #we have a backup if no name is given for the attribute.
            $positional_arg_of{$package} ||= &#34;__Positional_0001&#34;;
            #but we would prefer to know the argument as the class does.
            if &#40;my $config = $1&#41; {
                $name = Class::Std::_extract_init_arg&#40;$config&#41;
                    || Class::Std::_extract_get&#40;$config&#41;
                    || Class::Std::_extract_set&#40;$config&#41;;
            }
            $name ||= $positional_arg_of{$package}++;
            push @{$attribute{$package}}, {
                ref      =&gt; $referent,
                name     =&gt; $name,
            };
        }
        return @return_attrs;
    };

    no warnings; #or this complains about redefining sub
    *MODIFY_HASH_ATTRIBUTES = $new_sub;
};

sub STORABLE_freeze {
    #croak &#34;must be called from Storable&#34; unless caller eq &#39;Storable&#39;;
    #unfortunately, Storable never appears on the call stack.
    my&#40;$self, $cloning&#41; = @_;
    #we&#39;ll ignore $cloning, as there&#39;s nothing to do differently.
    my $id = ident&#40;$self&#41;;
    require Storable;
    my $serialized = Storable::freeze&#40; \ &#40;my $anon_scalar&#41; &#41;;

    my %frozen_attr; #to be constructed
    my @package_list = ref $self;
    my %package_seen = &#40; ref&#40;$self&#41; =&gt; 1 &#41;; #ignore diamond/looped base classes :-&#41;
    PACKAGE:
    while&#40; my $package = shift @package_list&#41; {
        #make sure we add any base classes to the list of
        #packages to examine for attributes.
        { no strict &#39;refs&#39;;
            for my $base_class &#40; @{&#34;${package}::ISA&#34;} &#41; {
                push @package_list, $base_class
                    if !$package_seen{$base_class}++;
            }
        }
        #examine attributes from known packages only
        my $attr_list_ref = $attribute{$package} or next PACKAGE;

        #look for any attributes of this object for this package
        ATTR:
        for my $attr_ref &#40; @{$attr_list_ref} &#41; {
            #nothing to do if attr not set for this object
            next ATTR if !exists $attr_ref-&gt;{ref}{$id};
            #save the attr by name into the package hash
            $frozen_attr{$package}{ $attr_ref-&gt;{name} }
                = $attr_ref-&gt;{ref}{$id};
        }
    }

    return &#40;$serialized, \%frozen_attr &#41;;
}

sub STORABLE_thaw {
    #croak &#34;must be called from Storable&#34; unless caller eq &#39;Storable&#39;;
    #unfortunately, Storable never appears on the call stack.
    my&#40;$self, $cloning, $serialized, $frozen_attr_ref&#41; = @_;
    #we&#39;ll ignore $cloning, as there&#39;s nothing to do differently.
    #we can ignore $serialized too, as we know it&#39;s an anon_scalar.
    my $id = ident&#40;$self&#41;;
    PACKAGE:
    while&#40; my &#40;$package, $pkg_attr_ref&#41; = each %$frozen_attr_ref &#41; {
        my $attr_list_ref = $attribute{$package};
        ATTR:
        for my $attr_ref &#40; @{$attr_list_ref} &#41; { #for known attrs...
            #nothing to do if frozen attr doesn&#39;t exist
            next ATTR if !exists $pkg_attr_ref-&gt;{ $attr_ref-&gt;{name} };
            #block attempts to meddle with existing objects
            croak &#34;trying to modify existing attributes for $package&#34;
                if exists $attr_ref-&gt;{ref}{$id};
            #ok, set the attribute
            $attr_ref-&gt;{ref}{$id}
                = delete $pkg_attr_ref-&gt;{ $attr_ref-&gt;{name} };
        }
        if&#40; my @extra_keys = keys %$pkg_attr_ref &#41; {
            #this is probably serious enough to throw an exception.
            #however, TODO: it would be nice if the class could somehow
            #indicate to ignore this problem.
            croak &#34;unknown attribute&#40;s&#41; seen during deserialization&#34;
                .&#34; for package $package: &#34; . join&#40;q{, }, @extra_keys&#41;;
        }
    }
}

1; # Magic true value required at end of module
__END__

=head1 NAME

Class::Std::Storable - Support for creating serializable &#34;inside-out&#34; classes

=head1 VERSION

This document describes Class::Std::Storable version 0.0.1

=head1 SYNOPSIS

In general, use this class exactly as you would Class::Std.

    package Ice::Cream;
    use Class::Std::Storable;
    {
        my %name_of :ATTR&#40; :get&lt;name&gt; :set&lt;name&gt; &#41;;
        my %flavor_of :ATTR&#40; :get&lt;flavor&gt; :set&lt;flavor&gt; &#41;;
    }

    package main;
    my $object = Ice::Cream-&gt;new;
    $object-&gt;set_name&#40;&#34;Vanilla Bean&#34;&#41;;
    $object-&gt;set_flavor&#40;&#34;vanilla&#34;&#41;;

But now, you may also serialize the object.

    use Storable;
    my $serialized = Storable::freeze&#40;$object&#41;;
    #store to a file, database, or wherever, and retrieve later.
    my $clone = Storable::thaw&#40;$serialized&#41;;

=head1 DESCRIPTION

This class provides the class-building functionality from Class::Std, and in
addition provides an interface to allow Storable to freeze and thaw any
declared attributes of this class and any superclasses that were built via
Class::Std::Storable.

However, in order to let Storable save attributes and construct the object,
it is necessary to expose the attributes of the class to the world.  Thus,
any code could use the same interface that Storable does to get a copy of
object attributes and create new objects with arbitrary attributes
without going through the constructor.  While the interface can&#39;t be used to
modify the existing attributes of an object, it could be used to create an
arbitrarily mutated clone of an object without going through its methods.

As true encapsulation is one of the major features of Class::Std, this
would be a good reason NOT to use this class.  But this sacrifice is
necessary to provide serialization with an inside-out class.

=head1 INTERFACE 

See Class::Std

This package provides private object methods STORABLE_freeze and STORABLE_thaw
which are not to be used directly or overridden.

=head1 DIAGNOSTICS

See Class::Std for its diagnostics.  Only the following are
particular to Class::Std::Storable.

=over

=item &#34;unknown attribute&#40;s&#41; seen during deserialization&#34;

This indicates that when Storable tried to thaw an object, it found that the
frozen object had an attribute that is not declared in the class.

This probably means the class definition changed, removing or renaming
attributes, between the freezing and thawing of the object.
Don&#39;t do that.

This would also be a problem with plain old hashref
objects, but the failure would be silent and would only show up when your
methods attempted to use the missing attributes.

=item &#34;trying to modify existing attributes for $package&#34;

This almost certainly means that some code is calling STORABLE_thaw
directly on an existing object in an attempt to fiddle with its attributes.
Don&#39;t do that.

=back

=head1 CONFIGURATION AND ENVIRONMENT

Class::Std::Storable requires no configuration files or environment variables.

=head1 DEPENDENCIES

Class::Std version 0.0.4 or newer, which is not at this time part of
the Perl core modules.

=head1 INCOMPATIBILITIES

None reported.

=head1 LIMITATIONS

Vanilla Class::Std objects are not themselves serializable.  Any base
classes that are not built using Class::Std::Storable will probably not serialize
correctly without special tricks.  This is a feature, as it means no one can
just subclass a Class::Std class and break its encapsulation.

Class::Std::Storable attempts to identify attributes by their declaration,
that is, according to how :ATTR declares their getters/setters/initializers.
If none of these are declared for an attribute, it can only be identified by
its position, that is, the order of its appearance in the source code.  This
scheme will break if you change the position of these nameless attributes, or
change the names of the named ones, between the freezing and the thawing of an
object.

Serialization of inside-out objects naturally maintains the same caveats as for
any other object.  Only declared &#40;:ATTR&#41; object attributes identified with the
object will be serialized with the object.  In particular, &#34;class data&#34; cannot
be serialized with the object.  Also, an object can&#39;t be serialized if any of
its attributes cannot themselves be serialized, e.g. if one is a closure.

=head1 BUGS

No bugs have been reported.

Please report any bugs or feature requests to
C&lt;bug-class-std-storable@rt.cpan.org&gt;, or through the web interface at
L&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org">http://rt.cpan.org</a></span>&gt;.


=head1 AUTHOR

Luke Meyer  C&lt;&lt; &lt;luke@daeron.com&gt; &gt;&gt;


=head1 LICENCE AND COPYRIGHT

Copyright &#40;c&#41; 2005, Luke Meyer C&lt;&lt; &lt;luke@daeron.com&gt; &gt;&gt;. All rights reserved.

This module is free software; you can redistribute it and/or
modify it under the same terms as Perl itself. See L&lt;perlartistic&gt;.


=head1 DISCLAIMER OF WARRANTY

BECAUSE THIS SOFTWARE IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY
FOR THE SOFTWARE, TO THE EXTENT PERMITTED BY APPLICABLE LAW. EXCEPT WHEN
OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES
PROVIDE THE SOFTWARE &#34;AS IS&#34; WITHOUT WARRANTY OF ANY KIND, EITHER
EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE
ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE SOFTWARE IS WITH
YOU. SHOULD THE SOFTWARE PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL
NECESSARY SERVICING, REPAIR, OR CORRECTION.

IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR
REDISTRIBUTE THE SOFTWARE AS PERMITTED BY THE ABOVE LICENCE, BE
LIABLE TO YOU FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL,
OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE
THE SOFTWARE &#40;INCLUDING BUT NOT LIMITED TO LOSS OF DATA OR DATA BEING
RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD PARTIES OR A
FAILURE OF THE SOFTWARE TO OPERATE WITH ANY OTHER SOFTWARE&#41;, EVEN IF
SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF
SUCH DAMAGES.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/140145/39162/Class-Std-Storable.t">Download Class-Std-Storable.t</a><br />
<span class="downloadcontenttype">text/x-perl 3.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">use strict;

package TestClass;
use Class::Std::Storable;
{
    my %name_of :ATTR&#40; :get&lt;name&gt; :set&lt;name&gt; &#41;;
    my %flavor_of :ATTR&#40; :get&lt;flavor&gt; :set&lt;flavor&gt; &#41;;
}

package LinkedList;
use Class::Std::Storable;
{
    my %info_of :ATTR&#40; :get&lt;info&gt; :set&lt;info&gt; &#41;;
    my %next_node_for :ATTR&#40; :get&lt;next_node&gt; :set&lt;next_node&gt; &#41;;
}

package TestMISubClass;
use Class::Std::Storable;
use base qw&#40; TestClass LinkedList &#41;;
{
    my %ref_copy_for :ATTR&#40; :get&lt;ref_copy&gt; &#41;;
    my %unknown1 :ATTR; #for testing with no attr name given
    my %unknown2 :ATTR; #for testing with no attr name given
    sub set_next_node {
        my $self = shift;
        my $id = ident $self;
        die &#34;no param provided&#34; unless @_;
        my $next_node = shift;
        $ref_copy_for{$id} = $next_node;
        $self-&gt;SUPER::set_next_node&#40;$next_node&#41;;
        return;
    }
    sub set_unknown1 {
        my $id = ident shift;
        $unknown1{$id} = shift;
    }
    sub get_unknown1 {
        return $unknown1{ident shift};
    }
    sub set_unknown2 {
        my $id = ident shift;
        $unknown2{$id} = shift;
    }
    sub get_unknown2 {
        return $unknown2{ident shift};
    }
}

package main;
use Test::More tests =&gt; 38;
use Class::Std::Storable;
use Storable;
use Carp;
use Data::Dumper;

##########################################################
# very basic testing of a single object
my $object = TestClass-&gt;new;
$object-&gt;set_name&#40;&#34;Vanilla Bean&#34;&#41;;
$object-&gt;set_flavor&#40;&#34;vanilla&#34;&#41;;

my $clone = Storable::dclone&#40;$object&#41;;
is&#40; $clone-&gt;get_name, &#34;Vanilla Bean&#34;, &#34;properties successfully cloned&#34;&#41;;
is&#40; $clone-&gt;get_flavor, &#34;vanilla&#34;, &#34;properties successfully cloned&#34;&#41;;

##########################################################
# testing a nested structure
my $first_node = LinkedList-&gt;new;
$first_node-&gt;set_info&#40;1&#41;;
for my $i &#40;2..10&#41; {
    my $next_node = LinkedList-&gt;new;
    $next_node-&gt;set_info&#40;$i&#41;;
    $next_node-&gt;set_next_node&#40;$first_node&#41;;
    $first_node = $next_node;
}

my $id = ident&#40;$first_node&#41;;
$first_node = Storable::dclone&#40;$first_node&#41;;

isnt&#40;$id, ident&#40;$first_node&#41;, &#34;should in fact be a different object&#34;&#41;;
for my $i &#40;reverse 1..10&#41; {
    is&#40;$first_node-&gt;get_info, $i, &#34;values in the nodes all match&#34;&#41;;
    $first_node = $first_node-&gt;get_next_node;
}


##########################################################
# testing MI and structural integrity

my @flavors = qw&#40; vanilla chocolate strawberry mango peach grape &#41;;
my $obj;
for my $flavor &#40; @flavors &#41; {
    my $next = TestMISubClass-&gt;new;
    $next-&gt;set_flavor&#40;$flavor&#41;;
    $next-&gt;set_info&#40;$flavor&#41;;
    $next-&gt;set_unknown1&#40;&#34;1_$flavor&#34;&#41;;
    $next-&gt;set_unknown2&#40;&#34;2_$flavor&#34;&#41;;
    $next-&gt;set_next_node&#40;$obj&#41;;
    $obj = $next;
}

$clone = Storable::freeze&#40;$obj&#41;;
undef $obj; #should destroy the whole list
$clone = Storable::thaw&#40;$clone&#41;;
for my $flavor &#40; reverse @flavors &#41; {
    is&#40;$flavor, $clone-&gt;get_flavor, &#34;flavor cloned the same&#34;&#41;;
    is&#40;&#34;1_$flavor&#34;, $clone-&gt;get_unknown1, &#34;unknown1 cloned the same&#34;&#41;;
    is&#40;&#34;2_$flavor&#34;, $clone-&gt;get_unknown2, &#34;unknown2 cloned the same&#34;&#41;;
    my $next = $clone-&gt;get_next_node;
    my $copy = $clone-&gt;get_ref_copy;
    last unless $next;
    is&#40;ident&#40;$next&#41;, ident&#40;$copy&#41;, &#34;clones of same object should be the same&#34;&#41;;
    $clone = $next;
}

##########################################################
# generating diagnostics
$object = TestClass-&gt;new;
$object-&gt;set_name&#40;&#34;Vanilla Bean&#34;&#41;;
$object-&gt;set_flavor&#40;&#34;vanilla&#34;&#41;;

eval { $object-&gt;STORABLE_thaw&#40;0, 0, {TestClass =&gt; { name =&gt; &#34;foo&#34; } } &#41; };
like&#40;$@, qr{trying to modify existing attributes}, &#34;block attempted manipulation&#34;&#41;;

eval { $object-&gt;STORABLE_thaw&#40;0, 0, {TestClass =&gt; { unknown =&gt; &#34;foo&#34; } } &#41; };
like&#40;$@, qr{unknown attribute}, &#34;error on unknown attribute&#34;&#41;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-140146" href="/Public/Bug/Display.html?id=14247#txn-140146">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;24&nbsp;17:46:11&nbsp;2005</span>
    <span class="description">damian [...] conway.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 25 Aug 2005 07:45:50 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Damian Conway &lt;damian [...] conway.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Class-Std [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #14247] Class::Std::Storable</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-Cc:</td>
    <td class="message-header-value"> </td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/140146/39292/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/39292">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 592b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Luke,

Just following up on this separate ticket.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The question for you, Damian, is whether you would like to:
&gt; 1&#41; Include this in the Class::Std distribution
&gt; 2&#41; Look into including the functionality as an import option in 
&gt; Class::Std itself &#40;I&#39;d be happy to do the work&#41;
&gt; 3&#41; Disavow any connection with the thing and I can upload to CPAN as a 
&gt; separate distro
</div>
As I mentioned in the other thread, I&#39;d prefer it remain a separate module. 
Mainly so that people aren&#39;t tempted to by-pass Class::Std&#39;s strong 
encapsulation via the serialization mechanism.

Thanks again,

Damian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-439761" href="/Public/Bug/Display.html?id=14247#txn-439761">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;25&nbsp;23:23:24&nbsp;2008</span>
    <span class="description">dmuey [...] cpan.org -  Status changed from &#39;new&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.284929</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
