<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #36685 for Text-LevenshteinXS: It&#39;s not utf8 safe</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #36685 for Text-LevenshteinXS: It&#39;s not utf8 safe</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Text-LevenshteinXS">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Text-LevenshteinXS">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Text-LevenshteinXS">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Text-LevenshteinXS">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Text-LevenshteinXS">Text-LevenshteinXS CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">36685</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Text-LevenshteinXS">Text-LevenshteinXS</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">JGOLDBERG [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
bkb [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-32084-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.03    </td>
  </tr>
  <tr id="CF-32085-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Text-LevenshteinXS-0.03.utf8_optimized.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/749366/387520/Text-LevenshteinXS-0.03.utf8_optimized.diff">
Wed Mar 17 16:58:40 2010 (7.3k) by http://www.google.com/profiles/sven.schoradt
</a>
</font></li>
</ul>


Text-LevenshteinXS-0.03_utf8.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/745584/385544/Text-LevenshteinXS-0.03_utf8.diff">
Wed Mar 10 11:53:30 2010 (4.1k) by http://www.google.com/profiles/sven.schoradt
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=36685">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-473172" href="/Public/Bug/Display.html?id=36685#txn-473172">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;12&nbsp;09:42:05&nbsp;2008</span>
    <span class="description">bkb [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> It&#39;s not utf8 safe</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/473172/233492/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/233492">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 129b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The module isn&#39;t utf8 safe - it breaks on utf8 encoded strings and gives
the byte distance rather than the character difference.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-530333" href="/Public/Bug/Display.html?id=36685#txn-530333">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;07&nbsp;18:49:38&nbsp;2008</span>
    <span class="description">JGOLDBERG [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-530334" href="/Public/Bug/Display.html?id=36685#txn-530334">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;07&nbsp;18:50:17&nbsp;2008</span>
    <span class="description">JGOLDBERG [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/530334/265567/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/265567">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 133b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Without details this cannot be investigated further.  All testing I have done shows it giving 
character distance for utf8 just fine.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-530335" href="/Public/Bug/Display.html?id=36685#txn-530335">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;07&nbsp;18:50:18&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-530338" href="/Public/Bug/Display.html?id=36685#txn-530338">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;07&nbsp;18:50:19&nbsp;2008</span>
    <span class="description">JGOLDBERG [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-745584" href="/Public/Bug/Display.html?id=36685#txn-745584">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;10&nbsp;11:53:30&nbsp;2010</span>
    <span class="description">http://www.google.com/profiles/sven.schoradt -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/745584/385543/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/385543">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 477b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Am Fr 07. Nov 2008, 18:50:17, JGOLDBERG schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Without details this cannot be investigated further.  All testing I
&gt; have done shows it giving
&gt; character distance for utf8 just fine.
</div>
We start to use your module with a lot of utf-8 data from a database and
found some problems.

We add some test cases that demonstrate the problems and patch the
package, so it works in our environment.

Thanks for your work, it gives us a 20 times speedup to the original
used function.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Text-LevenshteinXS-0.03_utf8.diff</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/745584/385544/Text-LevenshteinXS-0.03_utf8.diff">Download Text-LevenshteinXS-0.03_utf8.diff</a><br />
<span class="downloadcontenttype">text/x-diff 4.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -rupN Text-LevenshteinXS-0.03/LevenshteinXS.pm Text-LevenshteinXS-0.03.patched/LevenshteinXS.pm
--- Text-LevenshteinXS-0.03/LevenshteinXS.pm	2004-06-29 23:41:56.000000000 +0200
+++ Text-LevenshteinXS-0.03.patched/LevenshteinXS.pm	2010-03-10 15:19:31.000000000 +0100
@@ -19,7 +19,7 @@ our @EXPORT_OK = &#40; @{ $EXPORT_TAGS{&#39;all&#39;
 our @EXPORT = qw&#40;
 distance
 &#41;;
-our $VERSION = &#39;0.03&#39;;
+our $VERSION = &#39;0.04&#39;;
 
 bootstrap Text::LevenshteinXS $VERSION;
 
diff -rupN Text-LevenshteinXS-0.03/LevenshteinXS.xs Text-LevenshteinXS-0.03.patched/LevenshteinXS.xs
--- Text-LevenshteinXS-0.03/LevenshteinXS.xs	2004-06-29 23:40:47.000000000 +0200
+++ Text-LevenshteinXS-0.03.patched/LevenshteinXS.xs	2010-03-10 16:05:58.000000000 +0100
@@ -12,22 +12,30 @@
 #include &lt;stdlib.h&gt;
 #include &lt;string.h&gt;
 
-int levenshtein_distance&#40;char *s,char*t&#41;;
+int levenshtein_distance&#40;SV *s,SV *t&#41;;
 int minimum&#40;int a,int b,int c&#41;;
 
-int levenshtein_distance&#40;char *s,char*t&#41;
+int levenshtein_distance&#40;SV* s, SV* t&#41;
 
 /*Compute levenshtein distance between s and t*/
 {
   //Step 1
   int k,i,j,n,m,cost,*d,distance;
-  if &#40;strcmp&#40;s,t&#41; == 0&#41; {return 0;}
-  n=strlen&#40;s&#41;; 
-  m=strlen&#40;t&#41;;
+
+  n=sv_len_utf8&#40;s&#41;;
+  m=sv_len_utf8&#40;t&#41;;
+
+  U8* ps = SvPVX&#40;s&#41;;
+  U8* pt = SvPVX&#40;t&#41;;
+
+  // optimisation for equal strings
+  if&#40;m == n &#38;&#38; memEQ&#40;ps, pt, n&#41;&#41; { return 0; }
+
   if&#40;n==0&#41; {return m;}
   if&#40;m==0&#41; {return n;}
 
   d=malloc&#40;&#40;sizeof&#40;int&#41;&#41;*&#40;m+1&#41;*&#40;n+1&#41;&#41;;
+
   m++;
   n++;
   //Step 2	
@@ -39,8 +47,11 @@ int levenshtein_distance&#40;char *s,char*t&#41;
   for&#40;i=1;i&lt;n;i++&#41;
     for&#40;j=1;j&lt;m;j++&#41;
     {
+        U8* si = utf8_hop&#40;ps, i-1&#41;;
+        U8* ti = utf8_hop&#40;pt, j-1&#41;;
+
         //Step 5
-        if&#40;s[i-1]==t[j-1]&#41;
+        if&#40;memEQ&#40;si, ti, UTF8SKIP&#40;si&#41;&#41;&#41;
           cost=0;
         else
           cost=1;
@@ -67,8 +78,8 @@ MODULE = Text::LevenshteinXS		PACKAGE = 
 
 int
 distance&#40;s,t&#41;
-	char * s
-	char * t
+	SV * s
+	SV * t
 CODE:
 	RETVAL = levenshtein_distance&#40;s,t&#41;;
 OUTPUT:
diff -rupN Text-LevenshteinXS-0.03/META.yml Text-LevenshteinXS-0.03.patched/META.yml
--- Text-LevenshteinXS-0.03/META.yml	2004-06-29 23:43:35.000000000 +0200
+++ Text-LevenshteinXS-0.03.patched/META.yml	2010-03-10 15:20:28.000000000 +0100
@@ -1,7 +1,7 @@
 # <span class="clickylink"><a target="new" rel="nofollow" href="http://module-build.sourceforge.net/META-spec.html">http://module-build.sourceforge.net/META-spec.html</a></span>
 #XXXXXXX This is a prototype!!!  It will change in the future!!! XXXXX#
 name:         Text-LevenshteinXS
-version:      0.03
+version:      0.04
 version_from: LevenshteinXS.pm
 installdirs:  site
 requires:
diff -rupN Text-LevenshteinXS-0.03/test.pl Text-LevenshteinXS-0.03.patched/test.pl
--- Text-LevenshteinXS-0.03/test.pl	2004-03-05 03:11:59.000000000 +0100
+++ Text-LevenshteinXS-0.03.patched/test.pl	2010-03-10 16:21:11.000000000 +0100
@@ -1,16 +1,41 @@
-use Test;
-BEGIN { plan tests =&gt; 6 };
-
-use Text::LevenshteinXS qw&#40;distance&#41;;
-
-ok&#40;1&#41;; 
-if &#40;distance&#40;&#34;foo&#34;,&#34;four&#34;&#41; == 2&#41; {ok&#40;1&#41;} else {ok&#40;0&#41;}
-if &#40;distance&#40;&#34;foo&#34;,&#34;foo&#34;&#41;  == 0&#41; {ok&#40;1&#41;} else {ok&#40;0&#41;}
-if &#40;distance&#40;&#34;foo&#34;,&#34;&#34;&#41;  == 3&#41; {ok&#40;1&#41;} else {ok&#40;0&#41;}
-if &#40;distance&#40;&#34;four&#34;,&#34;foo&#34;&#41; == 2&#41; {ok&#40;1&#41;} else {ok&#40;0&#41;}
-if &#40;distance&#40;&#34;foo&#34;,&#34;bar&#34;&#41; == 3&#41; {ok&#40;1&#41;} else {ok&#40;0&#41;}
-
-
-
-
-
+use Test::More qw/ no_plan /;
+
+use Text::LevenshteinXS qw&#40;distance&#41;;
+
+use Encode;
+use Unicode::Normalize;
+
+ok&#40;1&#41;; 
+
+# basic tests
+is&#40;distance&#40;&#34;foo&#34;,&#34;four&#34;&#41;, 2&#41;;
+is&#40;distance&#40;&#34;foo&#34;,&#34;foo&#34;&#41;, 0&#41;;
+is&#40;distance&#40;&#34;foo&#34;,&#34;&#34;&#41;, 3&#41;;
+is&#40;distance&#40;&#34;four&#34;,&#34;foo&#34;&#41;, 2&#41;;
+is&#40;distance&#40;&#34;foo&#34;,&#34;bar&#34;&#41;, 3&#41;;
+
+# more tests from the bugtracking system
+is&#40;distance&#40;&#39;headache&#39;,&#39;heavy load&#39;&#41;, 7&#41;;
+is&#40;distance&#40;&#39;Distinction courses&#39;, &#39;Distinction Courses&#39;&#41;, 1, &#39;upper/lower&#39;&#41;;
+is&#40;distance&#40;&#34;fool&#39;s handiwork bar&#34;, &#39;food handling bar&#39;&#41;, 8&#41;;
+
+
+# utf-8 tests
+is&#40;distance&#40;&#34;ÃƒÂ¤ÃƒÂ¶ÃƒÂ¼&#34;,&#34;ÃƒÂ¤ÃƒÂ¶ÃƒÂ¼&#34;&#41;, 0&#41;;
+is&#40;distance&#40;&#34;strase&#34;,&#34;straÃƒÂŸe&#34;&#41;, 1&#41;;
+is&#40;distance&#40;&#34;strasse&#34;,&#34;straÃƒÂŸe&#34;&#41;, 2&#41;;
+is&#40;distance&#40;&#34;ÃƒÂ¤ÃƒÂ¶ÃƒÂ¼&#34;,&#34;123&#34;&#41;, 3&#41;;
+
+is&#40;distance&#40;&#34;&#34;,&#34;str&#34;&#41;, 3, &#39;length check&#39;&#41;;
+is&#40;distance&#40;&#34;&#34;,&#34;straÃƒÂŸe&#34;&#41;, 6, &#39;length check ÃŸ&#39;&#41;;
+is&#40;distance&#40;&#34;&#34;, decode&#40;&#34;utf8&#34;, &#34;stra\x{00DF}e&#34;&#41;&#41;, 6, &#39;length check \x&#39;&#41;;
+
+is&#40;distance&#40;&#34;ÃƒÂ¤ÃƒÂ¶ÃƒÂ¼&#34;,decode&#40;&#34;latin1&#34;, &#34;Ã¤Ã¶Ã¼&#34;&#41;&#41;, 0&#41;;
+is&#40;distance&#40;&#34;123&#34;,&#34;abcde&#34;&#41;, 5, &#39;foo&#39;&#41;;
+
+my $umls = &#34;ÃƒÂ¤ÃƒÂ¶ÃƒÂ¼&#34;;
+
+{
+  use encoding &#34;latin1&#34;;
+  is&#40;distance&#40;$umls, &#34;Ã¤Ã¶Ã¼&#34;&#41;, 0, &#39;encoding latin1&#39;&#41;;
+}
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-745587" href="/Public/Bug/Display.html?id=36685#txn-745587">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;10&nbsp;11:53:35&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-745821" href="/Public/Bug/Display.html?id=36685#txn-745821">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;10&nbsp;14:11:40&nbsp;2010</span>
    <span class="description">josh [...] 3io.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [spam?] [rt.cpan.org #36685] It&#39;s not utf8 safe</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 10 Mar 2010 11:09:52 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-LevenshteinXS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Josh Goldberg &lt;josh [...] 3io.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/745821/385670/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/385670">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 761b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the patch!

On Wed, Mar 10, 2010 at 8:53 AM,
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.google.com/profiles/sven.schoradt">http://www.google.com/profiles/sven.schoradt</a></span> via RT &lt;
bug-Text-LevenshteinXS@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       Queue: Text-LevenshteinXS
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=36685">https://rt.cpan.org/Ticket/Display.html?id=36685</a></span> &gt;
&gt;
&gt; Am Fr 07. Nov 2008, 18:50:17, JGOLDBERG schrieb:
<div class="message-stanza open">&gt; &gt; Without details this cannot be investigated further.  All testing I
&gt; &gt; have done shows it giving
&gt; &gt; character distance for utf8 just fine.
</div>&gt;
&gt; We start to use your module with a lot of utf-8 data from a database and
&gt; found some problems.
&gt;
&gt; We add some test cases that demonstrate the problems and patch the
&gt; package, so it works in our environment.
&gt;
&gt; Thanks for your work, it gives us a 20 times speedup to the original
&gt; used function.
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/745821/385671/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/385671">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.1k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-749366" href="/Public/Bug/Display.html?id=36685#txn-749366">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;17&nbsp;16:58:39&nbsp;2010</span>
    <span class="description">http://www.google.com/profiles/sven.schoradt -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Sven Schoradt</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/749366/387519/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/387519">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 296b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">After a second lock to the source, I find some optimisation points that
make the performance of the UTF8 version comparable to the original version.

I attach a second patch for the original code &#40;version 0.03&#41;. I do some
performance analysis with the performance.pl script, thats in the patch.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Text-LevenshteinXS-0.03.utf8_optimized.diff</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/749366/387520/Text-LevenshteinXS-0.03.utf8_optimized.diff">Download Text-LevenshteinXS-0.03.utf8_optimized.diff</a><br />
<span class="downloadcontenttype">text/x-diff 7.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -rupN Text-LevenshteinXS-0.03.orig/LevenshteinXS.pm Text-LevenshteinXS-0.03/LevenshteinXS.pm
--- Text-LevenshteinXS-0.03.orig/LevenshteinXS.pm	2004-06-29 23:41:56.000000000 +0200
+++ Text-LevenshteinXS-0.03/LevenshteinXS.pm	2010-03-17 21:48:04.000000000 +0100
@@ -19,7 +19,7 @@ our @EXPORT_OK = &#40; @{ $EXPORT_TAGS{&#39;all&#39;
 our @EXPORT = qw&#40;
 distance
 &#41;;
-our $VERSION = &#39;0.03&#39;;
+our $VERSION = &#39;0.04&#39;;
 
 bootstrap Text::LevenshteinXS $VERSION;
 
diff -rupN Text-LevenshteinXS-0.03.orig/LevenshteinXS.xs Text-LevenshteinXS-0.03/LevenshteinXS.xs
--- Text-LevenshteinXS-0.03.orig/LevenshteinXS.xs	2004-06-29 23:40:47.000000000 +0200
+++ Text-LevenshteinXS-0.03/LevenshteinXS.xs	2010-03-17 21:48:04.000000000 +0100
@@ -12,22 +12,30 @@
 #include &lt;stdlib.h&gt;
 #include &lt;string.h&gt;
 
-int levenshtein_distance&#40;char *s,char*t&#41;;
+int levenshtein_distance&#40;SV *s,SV *t&#41;;
 int minimum&#40;int a,int b,int c&#41;;
 
-int levenshtein_distance&#40;char *s,char*t&#41;
+int levenshtein_distance&#40;SV* s, SV* t&#41;
 
 /*Compute levenshtein distance between s and t*/
 {
   //Step 1
   int k,i,j,n,m,cost,*d,distance;
-  if &#40;strcmp&#40;s,t&#41; == 0&#41; {return 0;}
-  n=strlen&#40;s&#41;; 
-  m=strlen&#40;t&#41;;
+
+  n=sv_len_utf8&#40;s&#41;;
+  m=sv_len_utf8&#40;t&#41;;
+
+  U8* ps = SvPVX&#40;s&#41;;
+  U8* pt = SvPVX&#40;t&#41;;
+
+  // optimisation for equal strings
+  if&#40;m == n &#38;&#38; memEQ&#40;ps, pt, n&#41;&#41; { return 0; }
+
   if&#40;n==0&#41; {return m;}
   if&#40;m==0&#41; {return n;}
 
   d=malloc&#40;&#40;sizeof&#40;int&#41;&#41;*&#40;m+1&#41;*&#40;n+1&#41;&#41;;
+
   m++;
   n++;
   //Step 2	
@@ -35,31 +43,53 @@ int levenshtein_distance&#40;char *s,char*t&#41;
 	d[k]=k;
   for&#40;k=0;k&lt;m;k++&#41;
       d[k*n]=k;
+
+
+  U8* si = ps;
+  U8* ti = pt;
+
+  int size;
+
   //Step 3 and 4	
   for&#40;i=1;i&lt;n;i++&#41;
+  {
+    size = UTF8SKIP&#40;si&#41;;
+
+    ti = pt;
+
     for&#40;j=1;j&lt;m;j++&#41;
     {
-        //Step 5
-        if&#40;s[i-1]==t[j-1]&#41;
+        if&#40;memEQ&#40;si, ti, size&#41;&#41;
           cost=0;
         else
           cost=1;
-        //Step 6			 
+
         d[j*n+i]=minimum&#40;d[&#40;j-1&#41;*n+i]+1,d[j*n+i-1]+1,d[&#40;j-1&#41;*n+i-1]+cost&#41;;
+
+        ti = utf8_hop&#40;ti, 1&#41;;
     }
+    
+    si = utf8_hop&#40;si, 1&#41;;
+  }
+
   distance=d[n*m-1];
+
   free&#40;d&#41;;
+
   return distance;
 }
 
-int minimum&#40;int a,int b,int c&#41;
 /*Gets the minimum of three values*/
+int minimum&#40;int a, int b, int c&#41;
 {
   int min=a;
+
   if&#40;b&lt;min&#41;
     min=b;
+
   if&#40;c&lt;min&#41;
     min=c;
+
   return min;
 }
 
@@ -67,8 +97,8 @@ MODULE = Text::LevenshteinXS		PACKAGE = 
 
 int
 distance&#40;s,t&#41;
-	char * s
-	char * t
+	SV * s
+	SV * t
 CODE:
 	RETVAL = levenshtein_distance&#40;s,t&#41;;
 OUTPUT:
diff -rupN Text-LevenshteinXS-0.03.orig/Makefile.old Text-LevenshteinXS-0.03/Makefile.old
--- Text-LevenshteinXS-0.03.orig/Makefile.old	2010-03-17 21:41:20.000000000 +0100
+++ Text-LevenshteinXS-0.03/Makefile.old	2010-03-17 21:48:04.000000000 +0100
@@ -52,11 +52,11 @@ DIRFILESEP = /
 DFSEP = $&#40;DIRFILESEP&#41;
 NAME = Text::LevenshteinXS
 NAME_SYM = Text_LevenshteinXS
-VERSION = 0.03
+VERSION = 0.04
 VERSION_MACRO = VERSION
-VERSION_SYM = 0_03
+VERSION_SYM = 0_04
 DEFINE_VERSION = -D$&#40;VERSION_MACRO&#41;=\&#34;$&#40;VERSION&#41;\&#34;
-XS_VERSION = 0.03
+XS_VERSION = 0.04
 XS_VERSION_MACRO = XS_VERSION
 XS_DEFINE_VERSION = -D$&#40;XS_VERSION_MACRO&#41;=\&#34;$&#40;XS_VERSION&#41;\&#34;
 INST_ARCHLIB = blib/arch
@@ -177,13 +177,10 @@ PERL_ARCHIVE       = 
 PERL_ARCHIVE_AFTER = 
 
 
-TO_INST_PM = LevenshteinXS.pm \
-	performance.pl
+TO_INST_PM = LevenshteinXS.pm
 
 PM_TO_BLIB = LevenshteinXS.pm \
-	$&#40;INST_LIB&#41;/Text/LevenshteinXS.pm \
-	performance.pl \
-	$&#40;INST_LIB&#41;/Text/performance.pl
+	$&#40;INST_LIB&#41;/Text/LevenshteinXS.pm
 
 
 # --- MakeMaker platform_constants section:
@@ -258,7 +255,7 @@ RCS_LABEL = rcs -Nv$&#40;VERSION_SYM&#41;: -q
 DIST_CP = best
 DIST_DEFAULT = tardist
 DISTNAME = Text-LevenshteinXS
-DISTVNAME = Text-LevenshteinXS-0.03
+DISTVNAME = Text-LevenshteinXS-0.04
 
 
 # --- MakeMaker macro section:
@@ -559,7 +556,7 @@ metafile : create_distdir
 	$&#40;NOECHO&#41; $&#40;ECHO&#41; Generating META.yml
 	$&#40;NOECHO&#41; $&#40;ECHO&#41; &#39;--- #YAML:1.0&#39; &gt; META_new.yml
 	$&#40;NOECHO&#41; $&#40;ECHO&#41; &#39;name:                Text-LevenshteinXS&#39; &gt;&gt; META_new.yml
-	$&#40;NOECHO&#41; $&#40;ECHO&#41; &#39;version:             0.03&#39; &gt;&gt; META_new.yml
+	$&#40;NOECHO&#41; $&#40;ECHO&#41; &#39;version:             0.04&#39; &gt;&gt; META_new.yml
 	$&#40;NOECHO&#41; $&#40;ECHO&#41; &#39;abstract:            ~&#39; &gt;&gt; META_new.yml
 	$&#40;NOECHO&#41; $&#40;ECHO&#41; &#39;license:             ~&#39; &gt;&gt; META_new.yml
 	$&#40;NOECHO&#41; $&#40;ECHO&#41; &#39;author:              ~&#39; &gt;&gt; META_new.yml
@@ -891,7 +888,7 @@ testdb_static :: pure_all $&#40;MAP_TARGET&#41;
 # --- MakeMaker ppd section:
 # Creates a PPD &#40;Perl Package Description&#41; for a binary distribution.
 ppd :
-	$&#40;NOECHO&#41; $&#40;ECHO&#41; &#39;&lt;SOFTPKG NAME=&#34;$&#40;DISTNAME&#41;&#34; VERSION=&#34;0,03,0,0&#34;&gt;&#39; &gt; $&#40;DISTNAME&#41;.ppd
+	$&#40;NOECHO&#41; $&#40;ECHO&#41; &#39;&lt;SOFTPKG NAME=&#34;$&#40;DISTNAME&#41;&#34; VERSION=&#34;0,04,0,0&#34;&gt;&#39; &gt; $&#40;DISTNAME&#41;.ppd
 	$&#40;NOECHO&#41; $&#40;ECHO&#41; &#39;    &lt;TITLE&gt;$&#40;DISTNAME&#41;&lt;/TITLE&gt;&#39; &gt;&gt; $&#40;DISTNAME&#41;.ppd
 	$&#40;NOECHO&#41; $&#40;ECHO&#41; &#39;    &lt;ABSTRACT&gt;&lt;/ABSTRACT&gt;&#39; &gt;&gt; $&#40;DISTNAME&#41;.ppd
 	$&#40;NOECHO&#41; $&#40;ECHO&#41; &#39;    &lt;AUTHOR&gt;&lt;/AUTHOR&gt;&#39; &gt;&gt; $&#40;DISTNAME&#41;.ppd
@@ -908,8 +905,7 @@ ppd :
 
 pm_to_blib : $&#40;TO_INST_PM&#41;
 	$&#40;NOECHO&#41; $&#40;ABSPERLRUN&#41; -MExtUtils::Install -e &#39;pm_to_blib&#40;{@ARGV}, &#39;\&#39;&#39;$&#40;INST_LIB&#41;/auto&#39;\&#39;&#39;, &#39;\&#39;&#39;$&#40;PM_FILTER&#41;&#39;\&#39;&#39;&#41;&#39; -- \
-	  LevenshteinXS.pm $&#40;INST_LIB&#41;/Text/LevenshteinXS.pm \
-	  performance.pl $&#40;INST_LIB&#41;/Text/performance.pl 
+	  LevenshteinXS.pm $&#40;INST_LIB&#41;/Text/LevenshteinXS.pm 
 	$&#40;NOECHO&#41; $&#40;TOUCH&#41; pm_to_blib
 
 
diff -rupN Text-LevenshteinXS-0.03.orig/META.yml Text-LevenshteinXS-0.03/META.yml
--- Text-LevenshteinXS-0.03.orig/META.yml	2004-06-29 23:43:35.000000000 +0200
+++ Text-LevenshteinXS-0.03/META.yml	2010-03-17 21:48:04.000000000 +0100
@@ -1,7 +1,7 @@
 # <span class="clickylink"><a target="new" rel="nofollow" href="http://module-build.sourceforge.net/META-spec.html">http://module-build.sourceforge.net/META-spec.html</a></span>
 #XXXXXXX This is a prototype!!!  It will change in the future!!! XXXXX#
 name:         Text-LevenshteinXS
-version:      0.03
+version:      0.04
 version_from: LevenshteinXS.pm
 installdirs:  site
 requires:
diff -rupN Text-LevenshteinXS-0.03.orig/test.pl Text-LevenshteinXS-0.03/test.pl
--- Text-LevenshteinXS-0.03.orig/test.pl	2004-03-05 03:11:59.000000000 +0100
+++ Text-LevenshteinXS-0.03/test.pl	2010-03-17 21:48:04.000000000 +0100
@@ -1,16 +1,41 @@
-use Test;
-BEGIN { plan tests =&gt; 6 };
-
-use Text::LevenshteinXS qw&#40;distance&#41;;
-
-ok&#40;1&#41;; 
-if &#40;distance&#40;&#34;foo&#34;,&#34;four&#34;&#41; == 2&#41; {ok&#40;1&#41;} else {ok&#40;0&#41;}
-if &#40;distance&#40;&#34;foo&#34;,&#34;foo&#34;&#41;  == 0&#41; {ok&#40;1&#41;} else {ok&#40;0&#41;}
-if &#40;distance&#40;&#34;foo&#34;,&#34;&#34;&#41;  == 3&#41; {ok&#40;1&#41;} else {ok&#40;0&#41;}
-if &#40;distance&#40;&#34;four&#34;,&#34;foo&#34;&#41; == 2&#41; {ok&#40;1&#41;} else {ok&#40;0&#41;}
-if &#40;distance&#40;&#34;foo&#34;,&#34;bar&#34;&#41; == 3&#41; {ok&#40;1&#41;} else {ok&#40;0&#41;}
-
-
-
-
-
+use Test::More qw/ no_plan /;
+
+use Text::LevenshteinXS qw&#40;distance&#41;;
+
+use Encode;
+use Unicode::Normalize;
+
+ok&#40;1&#41;; 
+
+# basic tests
+is&#40;distance&#40;&#34;foo&#34;,&#34;four&#34;&#41;, 2&#41;;
+is&#40;distance&#40;&#34;foo&#34;,&#34;foo&#34;&#41;, 0&#41;;
+is&#40;distance&#40;&#34;foo&#34;,&#34;&#34;&#41;, 3&#41;;
+is&#40;distance&#40;&#34;four&#34;,&#34;foo&#34;&#41;, 2&#41;;
+is&#40;distance&#40;&#34;foo&#34;,&#34;bar&#34;&#41;, 3&#41;;
+
+# more tests from the bugtracking system
+is&#40;distance&#40;&#39;headache&#39;,&#39;heavy load&#39;&#41;, 7&#41;;
+is&#40;distance&#40;&#39;Distinction courses&#39;, &#39;Distinction Courses&#39;&#41;, 1, &#39;upper/lower&#39;&#41;;
+is&#40;distance&#40;&#34;fool&#39;s handiwork bar&#34;, &#39;food handling bar&#39;&#41;, 8&#41;;
+
+
+# utf-8 tests
+is&#40;distance&#40;&#34;ÃƒÂ¤ÃƒÂ¶ÃƒÂ¼&#34;,&#34;ÃƒÂ¤ÃƒÂ¶ÃƒÂ¼&#34;&#41;, 0&#41;;
+is&#40;distance&#40;&#34;strase&#34;,&#34;straÃƒÂŸe&#34;&#41;, 1&#41;;
+is&#40;distance&#40;&#34;strasse&#34;,&#34;straÃƒÂŸe&#34;&#41;, 2&#41;;
+is&#40;distance&#40;&#34;ÃƒÂ¤ÃƒÂ¶ÃƒÂ¼&#34;,&#34;123&#34;&#41;, 3&#41;;
+
+is&#40;distance&#40;&#34;&#34;,&#34;str&#34;&#41;, 3, &#39;length check&#39;&#41;;
+is&#40;distance&#40;&#34;&#34;,&#34;straÃƒÂŸe&#34;&#41;, 6, &#39;length check ÃŸ&#39;&#41;;
+is&#40;distance&#40;&#34;&#34;, decode&#40;&#34;utf8&#34;, &#34;stra\x{00DF}e&#34;&#41;&#41;, 6, &#39;length check \x&#39;&#41;;
+
+is&#40;distance&#40;&#34;ÃƒÂ¤ÃƒÂ¶ÃƒÂ¼&#34;,decode&#40;&#34;latin1&#34;, &#34;Ã¤Ã¶Ã¼&#34;&#41;&#41;, 0&#41;;
+is&#40;distance&#40;&#34;123&#34;,&#34;abcde&#34;&#41;, 5, &#39;foo&#39;&#41;;
+
+my $umls = &#34;ÃƒÂ¤ÃƒÂ¶ÃƒÂ¼&#34;;
+
+{
+  use encoding &#34;latin1&#34;;
+  is&#40;distance&#40;$umls, &#34;Ã¤Ã¶Ã¼&#34;&#41;, 0, &#39;encoding latin1&#39;&#41;;
+}
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-975721" href="/Public/Bug/Display.html?id=36685#txn-975721">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;09&nbsp;05:30:55&nbsp;2011</span>
    <span class="description">moocow [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/975721/507809/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/507809">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 451b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Mar 17 16:58:39 2010,
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.google.com/profiles/sven.schoradt">http://www.google.com/profiles/sven.schoradt</a></span> wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I attach a second patch for the original code &#40;version 0.03&#41;. I do some
&gt; performance analysis with the performance.pl script, thats in the patch.
</div>
Patched version fails e.g. for:

 distance&#40;pack&#40;&#39;U2&#39;,252,65&#41;,pack&#40;&#39;U2&#39;,252,66&#41;&#41;;

... returns 0, but ought to return 1 due to the final substitution
&#39;A&#39;-&gt;&#39;B&#39; &#40;chr&#40;65&#41;-&gt;chr&#40;66&#41;&#41;.  My guess is a bug in the length checks.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1212909" href="/Public/Bug/Display.html?id=36685#txn-1212909">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;16&nbsp;12:39:24&nbsp;2013</span>
    <span class="description">JGOLDBERG [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1212909/640495/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/640495">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 47b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">applied sven&#39;s patch and uploaded version 0.04.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1212912" href="/Public/Bug/Display.html?id=36685#txn-1212912">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;16&nbsp;12:39:25&nbsp;2013</span>
    <span class="description">JGOLDBERG [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1581957" href="/Public/Bug/Display.html?id=36685#txn-1581957">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;08&nbsp;17:09:56&nbsp;2016</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> josh [...] 3io.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1581957/845114/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/845114">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 161b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2013-05-16 12:39:24, JGOLDBERG wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; applied sven&#39;s patch and uploaded version 0.04.
</div>
0.04 was deleted from CPAN --- so this issue seems to be still open?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1581961" href="/Public/Bug/Display.html?id=36685#txn-1581961">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;08&nbsp;17:10:13&nbsp;2016</span>
    <span class="description">SREZIC [...] cpan.org -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1582000" href="/Public/Bug/Display.html?id=36685#txn-1582000">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;08&nbsp;20:35:28&nbsp;2016</span>
    <span class="description">benkasminbullock [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> BKB &lt;bkb [...] cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #36685] It&#39;s not utf8 safe</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 9 Jan 2016 10:35:20 +0900</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-LevenshteinXS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ben Bullock &lt;benkasminbullock [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1582000/845143/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/845143">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 499b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Was there a reason to delete from CPAN? Perhaps Joshua Goldberg would
consider allowing a co-maintainer? I&#39;m happy to take responsibility
for the module if he doesn&#39;t want to.

On 9 January 2016 at 07:09, Slaven_Rezic via RT
&lt;bug-Text-LevenshteinXS@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=36685">https://rt.cpan.org/Ticket/Display.html?id=36685</a></span> &gt;
&gt;
&gt; On 2013-05-16 12:39:24, JGOLDBERG wrote:
<div class="message-stanza open">&gt;&gt; applied sven&#39;s patch and uploaded version 0.04.
</div>&gt;
&gt; 0.04 was deleted from CPAN --- so this issue seems to be still open?
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1809967" href="/Public/Bug/Display.html?id=36685#txn-1809967">#</a>      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;15&nbsp;14:39:51&nbsp;2018</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> benkasminbullock [...] gmail.com, josh [...] 3io.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1809967/974103/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/974103">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 910b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2016-01-08 20:35:28, benkasminbullock@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Was there a reason to delete from CPAN?
</div>
Just stumbled over <span class="clickylink"><a target="new" rel="nofollow" href="http://matrix.cpantesters.org/?dist=Text-LevenshteinXS%200.04">http://matrix.cpantesters.org/?dist=Text-LevenshteinXS%200.04</a></span>
--- so there seems to be a problem with the new version. Just guessing: because the failures start with perl 5.17.6 it could be caused by hash randomization &#40;because this is the version where hash randomization was reintroduced into perl&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Perhaps Joshua Goldberg would
&gt; consider allowing a co-maintainer? I&#39;m happy to take responsibility
&gt; for the module if he doesn&#39;t want to.
&gt; 
&gt; On 9 January 2016 at 07:09, Slaven_Rezic via RT
&gt; &lt;bug-Text-LevenshteinXS@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=36685">https://rt.cpan.org/Ticket/Display.html?id=36685</a></span> &gt;
&gt; &gt;
&gt; &gt; On 2013-05-16 12:39:24, JGOLDBERG wrote:
<div class="message-stanza open">&gt; &gt;&gt; applied sven&#39;s patch and uploaded version 0.04.
</div>&gt; &gt;
&gt; &gt; 0.04 was deleted from CPAN --- so this issue seems to be still open?
&gt; &gt;
</div></div></div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.678276</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
