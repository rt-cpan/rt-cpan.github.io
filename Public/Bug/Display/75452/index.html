<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #75452 for Spreadsheet-WriteExcel: Rare digest error on image insert</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #75452 for Spreadsheet-WriteExcel: Rare digest error on image insert</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Spreadsheet-WriteExcel/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Spreadsheet-WriteExcel/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Spreadsheet-WriteExcel/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Spreadsheet-WriteExcel/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Spreadsheet-WriteExcel">Spreadsheet-WriteExcel CPAN distribution</a>.</p>


<h3>Maintainer&#40;s&#41;&#39; notes</h3>

<p><b>If you are reporting a bug in Spreadsheet::WriteExcel here are some pointers</b>
<p>

1) State the issues as clearly and as concisely as possible. A simple program or Excel test file (see below) will often explain the issue better than a lot of text.
<p>

2) Provide information on your system, version of perl and module versions. The following program will generate everything that is required. Put this information in your bug report.
<pre>
    #!/usr/bin/perl -w

    print "\n    Perl version   : $]";
    print "\n    OS name        : $^O";
    print "\n    Module versions: (not all are required)\n";

    my @modules = qw(
                      Spreadsheet::WriteExcel
                      Parse::RecDescent
                      File::Temp
                      OLE::Storage_Lite
                      IO::Stringy
                      Spreadsheet::ParseExcel
                      Scalar::Util
                      Unicode::Map
                    );

    for my $module (@modules) {
        my $version;
        eval "require $module";

        if (not $@) {
            $version = $module-&gt;VERSION;
            $version = '(unknown)' if not defined $version;
        }
        else {
            $version = '(not installed)';
        }

        printf "%21s%-24s\t%s\n", "", $module, $version;
    }

    __END__
</pre>
<p>

3) Upgrade to the latest version of Spreadsheet::WriteExcel (or at least test on a system with an upgraded version). The issue you are reporting may already have been fixed.

<p>
4) <b>Create a small but complete example program that demonstrates your problem.</b> The program should be as small as possible. At the same time it should be a complete program that generates an Excel file. If the Spreadsheet::WriteExcel section is part of a much larger program then simplify it down to the essentials. Simulate any DB reads with an array.
<p>

5) Say if you tested with Excel, OpenOffice, Gnumeric or something else. Say which version of that application you used.
<p>

6) If you are submitting a patch you should check with the author whether the issue has already been patched or if a fix is in the works. Patches should be accompanied by test cases.
<p>
<b>Asking a question</b>
<p>
If you would like to ask a more general question there is the <a href="http://groups.google.com/group/spreadsheet-writeexcel">Spreadsheet::WriteExcel Google Group</a>.
<p></p>



<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">75452</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Spreadsheet-WriteExcel/Active/">Spreadsheet-WriteExcel</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ftl [...] dnv.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Unimportant    </td>
  </tr>
  <tr id="CF-29480-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.37    </td>
  </tr>
  <tr id="CF-29481-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;01&nbsp;10:12:18&nbsp;2012</span>
    <span class="description">ftl [...] dnv.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Rare digest error on image insert</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Again, thanks a lot for a very versatile module!!!


On perl 5.8.3 with Digest::MD4 v1.1, inserting an image gives the 
following error:

Can&#39;t locate auto/Digest/MD4/md4_hex.al in @INC &#40;@INC contains: 
D:\inetpub\www\site03\root\easyrisk\DNV\33q\develop\DNVModule\EN 
D:\inetpub\www\site03\root\easyrisk\DNV\33q\develop\DNVModule 
C:/Perl/lib C:/Perl/site/lib .&#41; at D:\inetpub\www\site03
\root\easyrisk\DNV\33q\develop\DNVModule/Spreadsheet/WriteExcel/Workbook
.pm line 1696 

Running
C:\Perl_proj\bin&gt;perl doc_version.pl

    Perl version   : 5.008003
    OS name        : MSWin32
    Module versions: &#40;not all are required&#41;
                     Spreadsheet::WriteExcel    2.37
                     Parse::RecDescent          1.80
                     File::Temp                 0.14
                     OLE::Storage_Lite          0.13
                     IO::Stringy                2.109
                     Spreadsheet::ParseExcel    0.58
                     Scalar::Util               1.13
                     Unicode::Map               &#40;not installed&#41;
                     Digest::MD4                1.1
                     Digest::Perl::MD4          &#40;not installed&#41;
                     Digest::MD5                2.33

 
Works fine on Perl version   : 5.012002 where md4 is not installed.

I guess this is a digest:md4 issue, and md4 is not much in use, but the 
following fixes it in workbook.pm


the following fixes it &#40;ie add an actual call to a function to verify&#41;. 
maybe even call this only on demand &#40;ie if needed and _checksum_method 
not defied &#41;:

   eval &#34;use Digest::MD4; Digest::MD4::md4_hex&#40;&#39;xyz&#39;&#41;&#34;;
    if &#40;not $@&#41; {
        $self-&gt;{_checksum_method} = 1;
        return;
    }

    eval &#34;use Digest::Perl::MD4; Digest::Perl::MD4::md4_hex&#40;&#39;xyz&#39;&#41;&#34;;
    if &#40;not $@&#41; {
        $self-&gt;{_checksum_method} = 2;
        return;
    }

    eval &#34;use Digest::MD5;Digest::MD5::md5_hex&#40;&#39;xyz&#39;&#41;&#34;;
    if &#40;not $@&#41; {
        $self-&gt;{_checksum_method} = 3;
        return;
    }



The following  
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;01&nbsp;20:19:16&nbsp;2012</span>
    <span class="description">jmcnamara [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Mar 01 10:12:18 2012, ftl wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Again, thanks a lot for a very versatile module!!!
&gt; 
&gt; 
&gt; On perl 5.8.3 with Digest::MD4 v1.1, inserting an image gives the 
&gt; following error:
&gt; 
&gt; Can&#39;t locate auto/Digest/MD4/md4_hex.al in @INC &#40;@INC contains: 
&gt; D:\inetpub\www\site03\root\easyrisk\DNV\33q\develop\DNVModule\EN 
&gt; D:\inetpub\www\site03\root\easyrisk\DNV\33q\develop\DNVModule 
&gt; C:/Perl/lib C:/Perl/site/lib .&#41; at D:\inetpub\www\site03
&gt; \root\easyrisk\DNV\33q\develop\DNVModule/Spreadsheet/WriteExcel/Workbook
&gt; .pm line 1696 
</div>

Hi,

Thanks for the detailed report.

If you get a chance could you verify that this could also be fixed by adding an explicit call to 
Digest::MD4 the following to the client program:

    use Digest::MD4 qw&#40;md4_hex&#41;;
    use Spreadsheet::WriteExcel;
    ...

Regards,

John.
-- 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;01&nbsp;20:19:17&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;04&nbsp;14:44:22&nbsp;2012</span>
    <span class="description">frode.thue.lie [...] dnv.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #75452] Rare digest error on image insert </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 4 Mar 2012 20:43:23 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Spreadsheet-WriteExcel [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;Frode.Thue.Lie [...] dnv.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi
Thank you for responding!

The form you suggested works fine!
use Digest::MD4 qw&#40;md4_hex&#41; fails if the function is there, but loading xs or similar fails!

e.g. as below:

thanks
Frode



    eval &#34;use Digest::MD4 qw&#40;md4_hex&#41;;&#34;;
    if &#40;not $@&#41; {
        $self-&gt;{_checksum_method} = 1;
        return;
    }

    eval &#34;use Digest::Perl::MD4 qw&#40;md4_hex&#41;;&#34;;
    if &#40;not $@&#41; {
        $self-&gt;{_checksum_method} = 2;
        return;
    }

    eval &#34;use Digest::MD5 qw&#40;md5_hex&#41;;&#34;;
    if &#40;not $@&#41; {
        $self-&gt;{_checksum_method} = 3;
        return;
    }

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: John McNamara via RT [mailto:bug-Spreadsheet-WriteExcel@rt.cpan.org] 
Sent: 2. mars 2012 02:19
To: Lie, Frode Thue
Subject: [rt.cpan.org #75452] Rare digest error on image insert 

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=75452">https://rt.cpan.org/Ticket/Display.html?id=75452</a></span> &gt;

On Thu Mar 01 10:12:18 2012, ftl wrote:
<div class="message-stanza open">&gt; Again, thanks a lot for a very versatile module!!!
&gt; 
&gt; 
&gt; On perl 5.8.3 with Digest::MD4 v1.1, inserting an image gives the 
&gt; following error:
&gt; 
&gt; Can&#39;t locate auto/Digest/MD4/md4_hex.al in @INC &#40;@INC contains: 
&gt; D:\inetpub\www\site03\root\easyrisk\DNV\33q\develop\DNVModule\EN
&gt; D:\inetpub\www\site03\root\easyrisk\DNV\33q\develop\DNVModule
&gt; C:/Perl/lib C:/Perl/site/lib .&#41; at D:\inetpub\www\site03 
&gt; \root\easyrisk\DNV\33q\develop\DNVModule/Spreadsheet/WriteExcel/Workbo
&gt; ok
&gt; .pm line 1696
</div>

Hi,

Thanks for the detailed report.

If you get a chance could you verify that this could also be fixed by adding an explicit call to
Digest::MD4 the following to the client program:

    use Digest::MD4 qw&#40;md4_hex&#41;;
    use Spreadsheet::WriteExcel;
    ...

Regards,

John.
-- 




**************************************************************************************
The contents of this e-mail message and any attachments are confidential and are intended solely for the addressee. If you have received this transmission in error, please immediately notify the sender by return e-mail and delete this message and its attachments. Any unauthorized use, copying or dissemination of this transmission is prohibited. Neither the confidentiality nor the integrity of this message can be vouched for following transmission on the Internet.
**************************************************************************************
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;21&nbsp;15:14:37&nbsp;2012</span>
    <span class="description">jmcnamara [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
