<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #36220 for Frontier-RPC: [patch] Add support for handling of arbitrary perl objects, logging to syslog and client IP filtering for Frontier::*</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #36220 for Frontier-RPC: [patch] Add support for handling of arbitrary perl objects, logging to syslog and client IP filtering for Frontier::*</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Frontier-RPC/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Frontier-RPC/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Frontier-RPC/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Frontier-RPC/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Frontier-RPC">Frontier-RPC CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">36220</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Frontier-RPC/Active/">Frontier-RPC</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
max [...] rfc2324.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-13842-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-13843-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;27&nbsp;14:33:21&nbsp;2008</span>
    <span class="description">max [...] rfc2324.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [patch] Add support for handling of arbitrary perl objects,
 logging to syslog and client IP filtering for Frontier::*</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This patches for Clients.pm and RPC.pm as the rewrite of Daemon.pm add
some new features, but should be 100% compatible to older versions.

The new Frontier::* stuff is able to push any arbitrary perl object over
the wire by using Data::Serializer to put it into an ASCII stream and
including this in the XML data.

The new Frontier::Daemon has the ability to filter client connections
based on a list of given IPs which are able to make connections to the
server.

The daemon is also able to log requests including query path and method
&#40;if desired&#41; to syslog.

I would like this changes to be included in the Frontier distribution as
I think they are interesting for others, too.

Ciao
Max
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Client.pm.handle_perl_objects.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/Client.pm b/Client.pm
index 800acab..9ee5755 100644
--- a/Client.pm
+++ b/Client.pm
@@ -1,8 +1,12 @@
 #
 # Copyright &#40;C&#41; 1998 Ken MacLeod
+# Copyright &#40;C&#41; 2007-2008 Maximilian Wilhelm &lt;max@rfc2324.org&gt;
+#
 # Frontier::Client is free software; you can redistribute it
 # and/or modify it under the same terms as Perl itself.
 #
+# Handling of arbitrary perl objects added by Maximilian Wilhelm.
+#
 # $Id: Client.pm,v 1.8 2001/10/03 01:30:54 kmacleod Exp $
 #
 
@@ -47,6 +51,10 @@ sub new {
 	push @options, &#39;use_objects&#39; =&gt; $self-&gt;{&#39;use_objects&#39;};
     }
 
+    if &#40;defined $self-&gt;{&#39;handle_perl_objects&#39;} &#38;&#38; $self-&gt;{&#39;handle_perl_objects&#39;}&#41; {
+        push @options, &#39;handle_perl_objects&#39; =&gt; $self-&gt;{&#39;handle_perl_objects&#39;};
+    }
+
     $self-&gt;{&#39;enc&#39;} = Frontier::RPC2-&gt;new&#40;@options&#41;;
 
     return $self;
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Daemon.pm</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl -WT
#
# Frontier::Daemon &#40;next generation&#41;
#
# Frontier::Daemon is free software; you can redistribute it
# and/or modify it under the same terms as Perl itself.
#
# Copyright &#40;C&#41; 1998 Ken MacLeod
# Copyright &#40;C&#41; 2007-2008 Maximilian Wilhelm &lt;max@rfc2324.org&gt;
#
# This is an extended version of the Frontier::Daemon HTTP XML-RPC server.
#
# This version of Frontier::Daemon basicly does the same as the normal
# Frontier::Daemon but allows specifying a reference to a list of IPs
# allowed to open connections to this server and can log request to syslog.
#
# It is also possible to push arbitrary perl objects over the wire.
#
# All this stuff was added by Maximilian Wilhelm.
#

package Frontier::Daemon;

use strict;

use Carp;

use HTTP::Daemon;
use HTTP::Status;
use HTTP::Headers;

use Frontier::RPC2;

#
# Little bit of magic to simplify debugging
sub _options&#40;@&#41; {
	my %ret = @_;

	if &#40;$ret{debug}&#41; {
		foreach my $opt &#40;keys %ret&#41; {
			print STDERR __PACKAGE__ . &#34;-&gt;_options: $opt =&gt; $ret{$opt}\n&#34;;
		}
	}

	return \%ret;
}

sub log_msg &#40;$&#41; {
	my $self = shift;

	my $msg = shift;

	return if &#40;ref &#40;$self&#41; ne __PACKAGE__&#41;;
	return if &#40;! $self-&gt;{syslog}-&gt;{active}&#41;;

	syslog &#40;$self-&gt;{syslog}-&gt;{log_level}, $self-&gt;{syslog}-&gt;{prefix} . $msg&#41;;
}


#
# Create new Fronter HTTP RPC server
sub new { # new &#40;methods =&gt; \%, allowed_clients =&gt; \@, &lt;HTTP::Daemon opts&gt;&#41; : \__PACKAGE__
	my $self = shift;
	my $class = ref &#40;$self&#41; || $self;

	#
	# Get and check arguments
	#
	my $args = &#38;_options &#40;@_&#41;;

	my $syslog = $args-&gt;{syslog} || {};
	if &#40;defined $syslog&#41; {
		if &#40;ref &#40;$syslog&#41; ne &#39;HASH&#39;&#41; {
			$syslog = {};
		}

		# Only load syslog module when needed. &#40;compatibility&#41;
		use Sys::Syslog qw&#40;:standard :macros&#41;;;

		# Default values if not there.
		$syslog-&gt;{name} = &#39;Frontier::Daemon&#39; if &#40;! defined $syslog-&gt;{name}&#41;;
		$syslog-&gt;{prefix} = &#34;XML-RPC HTTP server: &#34; if &#40;! defined $syslog-&gt;{prefix}&#41;;
		$syslog-&gt;{facility} = &#34;daemon&#34; if &#40;! defined $syslog-&gt;{facility}&#41;;
		$syslog-&gt;{log_level} = &#34;info&#34; if &#40;! defined $syslog-&gt;{log_level}&#41;;

		openlog &#40;$syslog-&gt;{name}, &#34;ndelay,pid&#34;, $syslog-&gt;{facility}&#41;;

		$syslog-&gt;{active} = 1;

		END { closelog&#40;&#41;; }
	}

	# Reference to methods hash
	my $methods = $args-&gt;{methods};
	if &#40;! defined $methods || ref &#40;$methods&#41; ne &#39;HASH&#39;&#41; {
		confess __PACKAGE__ . &#34;::new&#40;&#41;: Missing or invalid &#39;methods&#39; argument\n&#34;;
	}

	# Check for list of allowed clients
	my $allowed_clients = $args-&gt;{allowed_clients};
	if &#40;defined $allowed_clients&#41; {
		if &#40;ref &#40;$allowed_clients&#41; ne &#39;ARRAY&#39;&#41; {
			confess __PACKAGE__ . &#34;::new&#40;&#41;: Invalid &#39;allowed_clients&#39; argument, must be list_ref\n&#34;;
		}

		use Net::CIDR;
	}

	#
	# Prepare stuff
	#

	# Fire up XML-RPC decoder
	my $rpc2_use_objects = $args-&gt;{use_objects} || undef;
	my $rpc2_handle_perl_objects = $args-&gt;{handle_perl_objects} || undef;
	my $decoder = Frontier::RPC2-&gt;new &#40;use_objects =&gt; $rpc2_use_objects,
	                                   handle_perl_objects =&gt; $rpc2_handle_perl_objects&#41;;
	if &#40;! $decoder&#41; {
		confess __PACKAGE__ . &#34;::new&#40;&#41;: Failed to fire up XML-RPC decoder\n&#34;;
	}

	# Prepare HTTP response
	my $http_header = HTTP::Headers-&gt;new &#40;&#39;Content-Type&#39; =&gt; &#39;text/xml&#39;&#41;;
	my $http_response = HTTP::Response-&gt;new &#40;200, &#34;&#34;, $http_header&#41;;
	if &#40;! $http_header || ! $http_response&#41; {
		confess __PACKAGE__ . &#34;::new&#40;&#41;: Failed to prepare HTTP stuff\n&#34;;
	}

	my $http_daemon =  HTTP::Daemon-&gt;new &#40;%{$args}&#41;;
	if &#40;! $http_daemon&#41; {
		confess __PACKAGE__ . &#34;::new&#40;&#41;: Failed to start up HTTP daemon\n&#34;;
	}

	#
	# Create instance object
	my $obj = bless {
		methods =&gt; $methods,
		allowed_clients =&gt; $allowed_clients,

		decoder =&gt; $decoder,

		http_header =&gt; $http_header,
		http_response =&gt; $http_response,
		http_daemon =&gt; $http_daemon,

		syslog =&gt; $syslog,
	}, $class;

	$obj-&gt;log_msg &#40;&#34;started.&#34;&#41;;

	if &#40;$args-&gt;{no_autolisten}&#41; {
		return $obj;
	} else {
		$obj-&gt;listen &#40;&#41;;
	}
}


#
# Start listeing for HTTP requests
sub listen&#40;&#41; { # listen&#40;&#41; :
	my $self = shift;

	if &#40;ref &#40;$self&#41; ne __PACKAGE__&#41; {
		confess __PACKAGE__ . &#34;::listen&#40;&#41; has to be called on instanciated object.\n&#34;;
	}

	while &#40;my $conn = $self-&gt;{http_daemon}-&gt;accept &#40;&#41;&#41; {
		my $request = $conn-&gt;get_request &#40;&#41;;

		my $is_allowed = 1;

		if &#40;$request&#41; {
			my &#40;$peer_port, $peer&#41; = sockaddr_in &#40;$conn-&gt;peername &#40;&#41;&#41;;
			my $peer_ip = inet_ntoa &#40;$peer&#41;;

			# Check if client is allowed to talk to us if we were asked for it
			if &#40;defined $self-&gt;{allowed_clients} &#38;&#38; ! Net::CIDR::cidrlookup &#40;$peer_ip, @{$self-&gt;{allowed_clients}}&#41;&#41; {
				$is_allowed = 0;
			}

			# Get request method and path for logging
			my $method = $request-&gt;method &#40;&#41;;
			my $path = $request-&gt;url&#40;&#41;-&gt;path &#40;&#41;;

			if &#40;$is_allowed&#41; {
				if &#40;defined $self-&gt;{syslog}-&gt;{log_request_path}&#41; {
					$self-&gt;log_msg &#40;&#34;Accepted request from $peer_ip for $path &#40;$method&#41;\n&#34;&#41;;
				} else {
					$self-&gt;log_msg &#40;&#34;Accepted request from $peer_ip\n&#34;&#41;;
				}

				# Check for valid request
				if &#40;$method eq &#39;POST&#39; &#38;&#38; $path eq &#39;/RPC2&#39;&#41; {
					# Fill response
					$self-&gt;{http_response}-&gt;content &#40;$self-&gt;{decoder}-&gt;serve &#40;$request-&gt;content &#40;&#41;, $self-&gt;{methods}&#41;&#41;;

					# Send answer
					$conn-&gt;send_response &#40;$self-&gt;{http_response}&#41;;
				# Invalid request
				} else {
					$conn-&gt;send_error &#40;RC_BAD_REQUEST&#41;;
				}

			# Client IP not listed in allowed_client list
			} else {
				if &#40;defined $self-&gt;{syslog}-&gt;{log_request_path}&#41; {
					$self-&gt;log_msg &#40;&#34;Denied request from $peer_ip for $path &#40;$method&#41;\n&#34;&#41;;
				} else {
					$self-&gt;log_msg &#40;&#34;Denied request from $peer_ip\n&#34;&#41;;
				}

				$conn-&gt;send_error &#40;RC_FORBIDDEN, &#34;You are not welcome from $peer_ip\n&#34;&#41;;
			}
		}

		$conn-&gt;close &#40;&#41;;

		# close connection
		$conn = undef;
	}
}

1;


=head1 NAME

Frontier::Daemon - receive Frontier XML RPC requests

=head1 SYNOPSIS

 use Frontier::Daemon;

 Frontier::Daemon-&gt;new&#40;methods =&gt; {
     &#39;rpcName&#39; =&gt; \&#38;sub_name,
        ...

     # Optional things
     &#39;allowed_clients&#39; =&gt; [&#39; 127.0.0.1&#39;, &#39;192.168.23.42&#39; ],

     &#39;handle_perl_objects&#39; =&gt; 1,

     &#39;syslog&#39; =&gt; {
         name =&gt; &#34;Frontier::Daemon&#34;,
	 prefix =&gt; &#34;[RPC]&#34;,
	 facility =&gt; &#34;daemon&#34;,
	 log_level =&gt; &#34;info&#34;,
	 log_request_path =&gt; 1,
     },
     }&#41;;

 my $daemon = Frontier::Daemon-&gt;new &#40;methods =&gt; { ... },
     no_autolisten =&gt; 1,

     ...
 };

 $daemon-&gt;listen &#40;&#41;;

=head1 DESCRIPTION

I&lt;Frontier::Daemon&gt; is an HTTP/1.1 server that listens on a socket for
incoming requests containing Frontier XML RPC2 method calls.
I&lt;Frontier::Daemon&gt; is a subclass of I&lt;HTTP::Daemon&gt;, which is a
subclass of I&lt;IO::Socket::INET&gt;.

I&lt;Frontier::Daemon&gt; takes a `C&lt;methods&gt;&#39; parameter, a hash that maps
an incoming RPC method name to reference to a subroutine.

I&lt;Frontier::Daemon&gt; takes a `C&lt;use_objects&gt;&#39; parameter that if set to
a non-zero value will convert incoming E&lt;lt&gt;intE&lt;gt&gt;, E&lt;lt&gt;i4E&lt;gt&gt;,
E&lt;lt&gt;floatE&lt;gt&gt;, and E&lt;lt&gt;stringE&lt;gt&gt; values to objects instead of
scalars.  See int&#40;&#41;, float&#40;&#41;, and string&#40;&#41; in Frontier::RPC2 for more
details.

I&lt;Frontier::Daemon&gt; takes an `C&lt;allowed_clients&gt;&#39; parameter that if set
to a list reference containing IP addresses will make I&lt;Frontier::Daemon&gt;
to allow only request from client with a listed address.

I&lt;Frontier::Daemon&gt; takes a `C&lt;handle_perl_objects&gt;&#39; parameter that if set
will be pushed to I&lt;Frontier::RPC2&gt; to allow pushing arbitrary perl objects
over the wire.

I&lt;Frontier::Daemon&gt; takes a `C&lt;syslog&gt;&#39; paramter that if set to a non-zero value or
hash reference contains extra options enables syslog logging support for I&lt;Frontier::Daemon&gt;.
The syslog options - and therefore hash keywords are: name, facility, log_level,
prefix and log_request_path. The options name, facility and log_level are obvious
syslog options, prefix may contain a string which will be prepended to any log entry
written by I&lt;Frontier::Daemon&gt; and log_request_path set to a non-zero value enables
logging of the request path.

I&lt;Frontier::Daemon&gt; takes a `C&lt;no_autolisten&gt;&#39; parameter for being able to just
create a new instance, which does not start listning imediatly.
This option was added for compatibility.

=head1 SEE ALSO

perl&#40;1&#41;, HTTP::Daemon&#40;3&#41;, IO::Socket::INET&#40;3&#41;, Frontier::RPC2&#40;3&#41;, Sys::Syslog&#40;3&#41;

&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.scripting.com/frontier5/xml/code/rpc.html">http://www.scripting.com/frontier5/xml/code/rpc.html</a></span>&gt;

=head1 AUTHOR

Ken MacLeod &lt;ken@bitsko.slc.ut.us&gt;
Arbitrary perl object handling and client ip flitering added by Maximilian Wilhelm &lt;max@rfc2324.org&gt;

=cut

1;
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RPC2.pm.handle_perl_objects.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/RPC2.pm b/RPC2.pm
index a42ec4d..fdf3257 100644
--- a/RPC2.pm
+++ b/RPC2.pm
@@ -1,8 +1,11 @@
 #
 # Copyright &#40;C&#41; 1998, 1999 Ken MacLeod
+# Copyright &#40;C&#41; 2007-2008 Maximilian Wilhelm &lt;max@rfc2324.org&gt;
 # Frontier::RPC is free software; you can redistribute it
 # and/or modify it under the same terms as Perl itself.
 #
+# Handling of arbitrary perl objects added by Maximilian Wilhelm.
+#
 # $Id: RPC2.pm,v 1.18 2002/08/02 18:35:21 ivan420 Exp $
 #
 
@@ -45,6 +48,16 @@ sub new {
 	$self-&gt;{&#39;encoding_&#39;} = &#34;&#34;;
     }
 
+    #
+    # This version of Frontier::RPC2 can push arbitrary perl objects across the wire...
+    #
+    # If you set &#39;handle_perl_objects&#39; are parameter this feature is actived.
+    if &#40;$self-&gt;{handle_perl_objects}&#41; {
+        use Data::Serializer;
+        $self-&gt;{serializer} = Data::Serializer-&gt;new&#40;&#41;;
+        $scalars{&#39;perl_object&#39;} = 1;
+    }
+
     return $self;
 }
 
@@ -183,7 +196,16 @@ sub _item {
 	push @text, $self-&gt;_hash&#40;$item&#41;;
     } elsif &#40;$ref =~ /=ARRAY\&#40;/&#41; {
 	push @text, $self-&gt;_array&#40;$item&#41;;
-    } else {
+    }
+
+    # If handle_perl_objects parameter was set, encode every object of any class in XML
+    elsif &#40;$self-&gt;{handle_perl_objects} &#38;&#38;
+            $item =~ /=HASH\&#40;/  &#38;&#38;
+            $ref =~ /[[:alnum:]]+/&#41; {
+            push @text, &#34;&lt;value&gt;&lt;perl_object&gt;&#34;, $self-&gt;{serializer}-&gt;serialize &#40;$item&#41;, &#34;&lt;/perl_object&gt;&lt;/value&gt;\n&#34;;
+    }
+
+    else {
 	die &#34;can&#39;t convert \`$item&#39; to XML\n&#34;;
     }
 
@@ -439,6 +461,13 @@ sub end {
 		$value = Frontier::RPC2::String-&gt;new&#40;$value&#41;;
 	    }
 	}
+
+	# Deserialize arbitrary perl objects.
+        elsif &#40;$tag eq &#39;perl_object&#39;&#41; {
+            my $ser = Data::Serializer-&gt;new &#40;&#41;;
+            $value = $ser-&gt;deserialize &#40;$value&#41;;
+        }
+
 	$expat-&gt;{&#39;rpc_value&#39;} = $value;
     } elsif &#40;$state eq &#39;member_name&#39;&#41; {
 	$expat-&gt;{&#39;rpc_member_name&#39;}[-1] = $expat-&gt;{&#39;rpc_text&#39;};
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;28&nbsp;06:33:05&nbsp;2008</span>
    <span class="description">ivan-pause [...] 420.am -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ivan-pause [...] 420.am</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi - just FYI - Frontier::RPC hasn&#39;t really been well maintained the 
past few years.

You might want consider using &#40;and submitting your changes to&#41; one of 
the other modules such as RPC::XML, XML::RPC or XMLRPC::Lite &#40;comes 
with SOAP::Lite&#41;.

On Tue May 27 14:33:21 2008, max@rfc2324.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This patches for Clients.pm and RPC.pm as the rewrite of Daemon.pm 
</div>add
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; some new features, but should be 100% compatible to older versions.
&gt; 
&gt; The new Frontier::* stuff is able to push any arbitrary perl object 
</div>over
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; the wire by using Data::Serializer to put it into an ASCII stream 
</div>and
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; including this in the XML data.
&gt; 
&gt; The new Frontier::Daemon has the ability to filter client 
</div>connections
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; based on a list of given IPs which are able to make connections to 
</div>the
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; server.
&gt; 
&gt; The daemon is also able to log requests including query path and 
</div>method
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#40;if desired&#41; to syslog.
&gt; 
&gt; I would like this changes to be included in the Frontier 
</div>distribution as
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think they are interesting for others, too.
&gt; 
&gt; Ciao
&gt; Max
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;28&nbsp;06:33:08&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
