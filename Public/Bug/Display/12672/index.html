<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #12672 for Win32-Process: Win32::Process Changes</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #12672 for Win32-Process: Win32::Process Changes</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Win32-Process/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Win32-Process/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Win32-Process/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Win32-Process/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Win32-Process">Win32-Process CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">12672</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Win32-Process/Active/">Win32-Process</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
rpirpag [...] gmx.at

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-221770-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-221771-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;04&nbsp;05:04:58&nbsp;2005</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Win32::Process Changes</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

Some Details: OS: Windows XP prof., Activestate Perl v5.6.1.
Module: libwin32-0.24

I made a change in the Process.xs because on my XP I had to add the privilege
SE_DEBUG_NAME to kill a process. With the original version I got allways access denied message. The process was a CGI script which was handled by the IIS.
The affected function is KillProcess. The function now calls EnablePrivilege&#40;&#41; to get the correct access rights for the process who want to kill an other process.

I also added a function to get the elapsed time a process was running. I named it TimeRunning&#40;&#41;.

It is only a fast hack to make the Killprocess&#40;&#41; working for me. Maybe it can be handled otherwise.

regards
Reinhard
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#include &lt;stdlib.h&gt;		// avoid BCC-5.0 brainmelt
#include &lt;math.h&gt;		// avoid VC-5.0 brainmelt
#include &#34;Process.hpp&#34;
#define WIN32_LEAN_AND_MEAN
#include &lt;windows.h&gt;

#if defined&#40;__cplusplus&#41;
#include &lt;stdlib.h&gt;
extern &#34;C&#34; {
#endif

#include &#34;EXTERN.h&#34;
#include &#34;perl.h&#34;
#include &#34;XSUB.H&#34;

#include &#34;../ppport.h&#34;


BOOL 
EnablePrivilege&#40;HANDLE hToken, LPCTSTR szPrivName, BOOL fEnable&#41; 
{
 
    TOKEN_PRIVILEGES tp;
    tp.PrivilegeCount = 1;
    LookupPrivilegeValue&#40;NULL, szPrivName, &#38;tp.Privileges[0].Luid&#41;;
    tp.Privileges[0].Attributes = fEnable ? SE_PRIVILEGE_ENABLED : 0;
    AdjustTokenPrivileges&#40;hToken, FALSE, &#38;tp, sizeof&#40;tp&#41;, NULL, NULL&#41;;
    return&#40;&#40;GetLastError&#40;&#41; == ERROR_SUCCESS&#41;&#41;;
}

static BOOL
Create&#40;cProcess* &#38;cP, char* szAppName, char* szCommLine, DWORD Inherit,
       DWORD CreateFlags, char* szCurrDir&#41;
{
    BOOL bRetVal;
    void *env = NULL;
#if PERL_VERSION &gt; 5
    env = PerlEnv_get_childenv&#40;&#41;;
#endif
    cP = NULL;
    try {
	cP = &#40;cProcess*&#41;new cProcess&#40;szAppName,szCommLine,Inherit,CreateFlags,
                                     env,szCurrDir&#41;;
        bRetVal = cP-&gt;bRetVal;
    }
    catch &#40;...&#41; {
        bRetVal = FALSE;
    }
#if PERL_VERSION &gt; 5
    PerlEnv_free_childenv&#40;env&#41;;
#endif
    return bRetVal;
}

static BOOL
CreateW&#40;cProcess* &#38;cP,WCHAR* szAppName,WCHAR* szCommLine,DWORD Inherit,DWORD CreateFlags,WCHAR* szCurrDir&#41;
{
    // XXX environment will *not* be correctly inherited.
    // Alas, we don&#39;t have corresponding Unicode accessor
    // functions for the hosts environment.
    cP = NULL;
    try {
	cP =&#40;cProcess *&#41; new cProcess&#40;szAppName,szCommLine,Inherit,CreateFlags,szCurrDir&#41;;
    }
    catch &#40;...&#41; {
	return&#40;FALSE&#41;;
    }
    return&#40;cP-&gt;bRetVal&#41;;
}

static BOOL
Open_&#40;cProcess * &#38;cP, DWORD pid, DWORD Inherit&#41;
{
    cP = NULL;
    try {
	cP = &#40;cProcess *&#41; new cProcess&#40;pid, Inherit&#41;;
    }
    catch &#40;...&#41; {
	return&#40;FALSE&#41;;
    }
    return&#40;cP-&gt;bRetVal&#41;;
}



static double
constant&#40;char* name&#41;
{
    errno = 0;
    switch &#40;*name&#41; {
    case &#39;A&#39;:
	break;
    case &#39;B&#39;:
	break;
    case &#39;C&#39;:
	if &#40;strEQ&#40;name, &#34;CREATE_DEFAULT_ERROR_MODE&#34;&#41;&#41;
#ifdef CREATE_DEFAULT_ERROR_MODE
	    return CREATE_DEFAULT_ERROR_MODE;
#else
	    goto not_there;
#endif
	if &#40;strEQ&#40;name, &#34;CREATE_NEW_CONSOLE&#34;&#41;&#41;
#ifdef CREATE_NEW_CONSOLE
	    return CREATE_NEW_CONSOLE;
#else
	    goto not_there;
#endif
	if &#40;strEQ&#40;name, &#34;CREATE_NEW_PROCESS_GROUP&#34;&#41;&#41;
#ifdef CREATE_NEW_PROCESS_GROUP
	    return CREATE_NEW_PROCESS_GROUP;
#else
	    goto not_there;
#endif
	if &#40;strEQ&#40;name, &#34;CREATE_NO_WINDOW&#34;&#41;&#41;
#ifdef CREATE_NO_WINDOW
	    return CREATE_NO_WINDOW;
#else
	    goto not_there;
#endif
	if &#40;strEQ&#40;name, &#34;CREATE_SEPARATE_WOW_VDM&#34;&#41;&#41;
#ifdef CREATE_SEPARATE_WOW_VDM
	    return CREATE_SEPARATE_WOW_VDM;
#else
	    goto not_there;
#endif
	if &#40;strEQ&#40;name, &#34;CREATE_SUSPENDED&#34;&#41;&#41;
#ifdef CREATE_SUSPENDED
	    return CREATE_SUSPENDED;
#else
	    goto not_there;
#endif
	if &#40;strEQ&#40;name, &#34;CREATE_UNICODE_ENVIRONMENT&#34;&#41;&#41;
#ifdef CREATE_UNICODE_ENVIRONMENT
	    return CREATE_UNICODE_ENVIRONMENT;
#else
	    goto not_there;
#endif
	break;
    case &#39;D&#39;:
	if &#40;strEQ&#40;name, &#34;DEBUG_ONLY_THIS_PROCESS&#34;&#41;&#41;
#ifdef DEBUG_ONLY_THIS_PROCESS
	    return DEBUG_ONLY_THIS_PROCESS;
#else
	    goto not_there;
#endif
	if &#40;strEQ&#40;name, &#34;DEBUG_PROCESS&#34;&#41;&#41;
#ifdef DEBUG_PROCESS
	    return DEBUG_PROCESS;
#else
	    goto not_there;
#endif
	if &#40;strEQ&#40;name, &#34;DETACHED_PROCESS&#34;&#41;&#41;
#ifdef DETACHED_PROCESS
	    return DETACHED_PROCESS;
#else
	    goto not_there;
#endif
	break;
    case &#39;E&#39;:
	break;
    case &#39;F&#39;:
	break;
    case &#39;G&#39;:
	break;
    case &#39;H&#39;:
	if &#40;strEQ&#40;name, &#34;HIGH_PRIORITY_CLASS&#34;&#41;&#41;
#ifdef HIGH_PRIORITY_CLASS
	    return HIGH_PRIORITY_CLASS;
#else
	    goto not_there;
#endif
	break;
    case &#39;I&#39;:
	if &#40;strEQ&#40;name, &#34;IDLE_PRIORITY_CLASS&#34;&#41;&#41;
#ifdef IDLE_PRIORITY_CLASS
	    return IDLE_PRIORITY_CLASS;
#else
	    goto not_there;
#endif
	if &#40;strEQ&#40;name, &#34;INFINITE&#34;&#41;&#41;
#ifdef INFINITE
	    return INFINITE;
#else
	    goto not_there;
#endif
	break;
    case &#39;J&#39;:
	break;
    case &#39;K&#39;:
	break;
    case &#39;L&#39;:
	break;
    case &#39;M&#39;:
	break;
    case &#39;N&#39;:
	if &#40;strEQ&#40;name, &#34;NORMAL_PRIORITY_CLASS&#34;&#41;&#41;
#ifdef NORMAL_PRIORITY_CLASS
	    return NORMAL_PRIORITY_CLASS;
#else
	    goto not_there;
#endif
	break;
    case &#39;O&#39;:
	break;
    case &#39;P&#39;:
	break;
    case &#39;Q&#39;:
	break;
    case &#39;R&#39;:
	if &#40;strEQ&#40;name, &#34;REALTIME_PRIORITY_CLASS&#34;&#41;&#41;
#ifdef REALTIME_PRIORITY_CLASS
	    return REALTIME_PRIORITY_CLASS;
#else
	    goto not_there;
#endif
	break;
    case &#39;S&#39;:
	break;
    case &#39;T&#39;:
	if &#40;strEQ&#40;name, &#34;THREAD_PRIORITY_ABOVE_NORMAL&#34;&#41;&#41;
#ifdef THREAD_PRIORITY_ABOVE_NORMAL
	    return THREAD_PRIORITY_ABOVE_NORMAL;
#else
	    goto not_there;
#endif
	if &#40;strEQ&#40;name, &#34;THREAD_PRIORITY_BELOW_NORMAL&#34;&#41;&#41;
#ifdef THREAD_PRIORITY_BELOW_NORMAL
	    return THREAD_PRIORITY_BELOW_NORMAL;
#else
	    goto not_there;
#endif
	if &#40;strEQ&#40;name, &#34;THREAD_PRIORITY_ERROR_RETURN&#34;&#41;&#41;
#ifdef THREAD_PRIORITY_ERROR_RETURN
	    return THREAD_PRIORITY_ERROR_RETURN;
#else
	    goto not_there;
#endif
	if &#40;strEQ&#40;name, &#34;THREAD_PRIORITY_HIGHEST&#34;&#41;&#41;
#ifdef THREAD_PRIORITY_HIGHEST
	    return THREAD_PRIORITY_HIGHEST;
#else
	    goto not_there;
#endif
	if &#40;strEQ&#40;name, &#34;THREAD_PRIORITY_IDLE&#34;&#41;&#41;
#ifdef THREAD_PRIORITY_IDLE
	    return THREAD_PRIORITY_IDLE;
#else
	    goto not_there;
#endif
	if &#40;strEQ&#40;name, &#34;THREAD_PRIORITY_LOWEST&#34;&#41;&#41;
#ifdef THREAD_PRIORITY_LOWEST
	    return THREAD_PRIORITY_LOWEST;
#else
	    goto not_there;
#endif
	if &#40;strEQ&#40;name, &#34;THREAD_PRIORITY_NORMAL&#34;&#41;&#41;
#ifdef THREAD_PRIORITY_NORMAL
	    return THREAD_PRIORITY_NORMAL;
#else
	    goto not_there;
#endif
	if &#40;strEQ&#40;name, &#34;THREAD_PRIORITY_TIME_CRITICAL&#34;&#41;&#41;
#ifdef THREAD_PRIORITY_TIME_CRITICAL
	    return THREAD_PRIORITY_TIME_CRITICAL;
#else
	    goto not_there;
#endif
	break;
    case &#39;U&#39;:
	break;
    case &#39;V&#39;:
	break;
    case &#39;W&#39;:
	break;
    case &#39;X&#39;:
	break;
    case &#39;Y&#39;:
	break;
    case &#39;Z&#39;:
	break;
    }
    errno = EINVAL;
    return 0;

not_there:
    errno = ENOENT;
    return 0;
}

#if defined&#40;__cplusplus&#41;
}
#endif


MODULE = Win32::Process		PACKAGE = Win32::Process

PROTOTYPES: DISABLE



BOOL
Create&#40;cP,appname,cmdline,inherit,flags,curdir&#41;
    cProcess *cP = NULL;
    char *appname
    char *cmdline
    BOOL inherit
    DWORD flags
    char *curdir
CODE:
    if &#40;USING_WIDE&#40;&#41;&#41; {
	WCHAR wappname[MAX_PATH+1];
	WCHAR wcmdline[MAX_PATH+1];
	WCHAR wcurdir[MAX_PATH+1];
	A2WHELPER&#40;appname, wappname, sizeof&#40;wappname&#41;&#41;;
	A2WHELPER&#40;cmdline, wcmdline, sizeof&#40;wcmdline&#41;&#41;;
	A2WHELPER&#40;curdir, wcurdir, sizeof&#40;wcurdir&#41;&#41;;
        RETVAL = CreateW&#40;cP, wappname, wcmdline, inherit, flags, wcurdir&#41;;
    }
    else {
        RETVAL = Create&#40;cP, appname, cmdline, inherit, flags, curdir&#41;;
    }
OUTPUT:
    cP
    RETVAL


BOOL
Open&#40;cP,pid,inherit&#41;
    cProcess *cP = NULL;
    DWORD pid
    BOOL inherit
CODE:
    RETVAL = Open_&#40;cP, pid, inherit&#41;;
OUTPUT:
    cP
    RETVAL


double
constant&#40;name&#41;
    char *name


BOOL
Kill&#40;cP,exitcode&#41;
    cProcess *cP
    unsigned int exitcode
CODE:
    RETVAL = cP-&gt;Kill&#40;exitcode&#41;;
OUTPUT:
    RETVAL

BOOL
Suspend&#40;cP&#41;
    cProcess *cP
CODE:
    RETVAL = cP-&gt;Suspend&#40;&#41;;
OUTPUT:
    RETVAL

BOOL
Resume&#40;cP&#41;
    cProcess *cP
CODE:
    RETVAL = cP-&gt;Resume&#40;&#41;;
OUTPUT:
    RETVAL

BOOL
GetPriorityClass&#40;cP,priorityclass&#41;
    cProcess *cP
    DWORD priorityclass = NO_INIT
CODE:
    RETVAL = cP-&gt;GetPriorityClass&#40;&#38;priorityclass&#41;;
OUTPUT:
    priorityclass
    RETVAL


BOOL
SetPriorityClass&#40;cP,priorityclass&#41;
    cProcess *cP
    DWORD priorityclass
CODE:
    RETVAL = cP-&gt;SetPriorityClass&#40;priorityclass&#41;;
OUTPUT:
    RETVAL


BOOL
GetProcessAffinityMask&#40;cP,processAffinityMask,systemAffinityMask&#41;
    cProcess *cP
    DWORD_PTR processAffinityMask = NO_INIT
    DWORD_PTR systemAffinityMask = NO_INIT
CODE:
    RETVAL = cP-&gt;GetProcessAffinityMask&#40;&#38;processAffinityMask,&#38;systemAffinityMask&#41;;
OUTPUT:
    processAffinityMask
    systemAffinityMask
    RETVAL


BOOL
SetProcessAffinityMask&#40;cP,processAffinityMask&#41;
    cProcess *cP
    DWORD processAffinityMask
CODE:
    RETVAL = cP-&gt;SetProcessAffinityMask&#40;processAffinityMask&#41;;
OUTPUT:
    RETVAL


BOOL
GetExitCode&#40;cP,exitcode&#41;
    cProcess *cP
    DWORD exitcode = NO_INIT
CODE:
    RETVAL = cP-&gt;GetExitCode&#40;&#38;exitcode&#41;;
OUTPUT:
    exitcode
    RETVAL


void
DESTROY&#40;cP&#41;
    cProcess *cP
CODE:
    delete cP;


BOOL
Wait&#40;cP,timeout&#41;
    cProcess *cP
    DWORD timeout
CODE:
    RETVAL = &#40;cP-&gt;Wait&#40;timeout&#41; == WAIT_OBJECT_0&#41;;
OUTPUT:
    RETVAL



IV
get_process_handle&#40;cP&#41;
    cProcess *cP
CODE:
    RETVAL = reinterpret_cast&lt;IV&gt;&#40;cP-&gt;GetProcessHandle&#40;&#41;&#41;;
OUTPUT:
    RETVAL

DWORD
GetProcessID&#40;cP&#41;
    cProcess *cP
CODE:
    RETVAL = cP-&gt;GetProcessID&#40;&#41;;
OUTPUT:
    RETVAL

BOOL
KillProcess&#40;pid, OUT exitcode&#41;
    DWORD pid
    int exitcode
PREINIT:
	HANDLE ph;
	DWORD dwExitCode;
  	HANDLE hToken;
  	int ret;
CODE:
    {
    	exitcode = 1;
    	ret = 2;
    	if&#40;OpenProcessToken&#40;GetCurrentProcess&#40;&#41;, TOKEN_ADJUST_PRIVILEGES, &#38;hToken&#41;&#41;
    	{
    		if&#40;!EnablePrivilege&#40;hToken, SE_DEBUG_NAME, TRUE&#41;&#41;
    		{
	  	   ret = GetLastError&#40;&#41;;
  		   exitcode = 0;
    		} else
    		{
		    	ph = OpenProcess&#40;PROCESS_ALL_ACCESS, FALSE, pid&#41;;
			if &#40;!ph&#41; {
  	   			ret = GetLastError&#40;&#41;;
  	   			printf&#40;&#34;Process &#40;%d&#41; could not opened. Errorcode: %d\n&#34;, pid, RETVAL&#41;;
  	   			exitcode = 0;
			} else
			{
				//printf&#40;&#34;Trying to kill process..\n&#34;&#41;; //for debug only
	    			GetExitCodeProcess&#40;ph, &#38;dwExitCode&#41;;
	    			if&#40;&#40;ret = TerminateProcess&#40;ph, dwExitCode&#41;&#41; == 0&#41;
	    			{
	    				exitcode = 0;
				} //else	//for debug only
				//{
					//printf&#40;&#34;Process %d was killed now\n&#34;, pid&#41;;
				//}
            			CloseHandle&#40;ph&#41;;
			}
    		}
	} else
	{
  	   ret = GetLastError&#40;&#41;;
  	   exitcode = 0;
	}
	RETVAL = ret;
    }
OUTPUT:
    RETVAL

long
TimeRunning&#40;pid, OUT exitcode, OUT elapsed&#41;
    DWORD pid
    int exitcode
    long elapsed;
PREINIT:
	HANDLE ph;
	FILETIME lpCreationTime;
  	FILETIME lpExitTime;
  	FILETIME lpKernelTime;
  	FILETIME lpUserTime;
  	SYSTEMTIME lpSystemTime;
  	long secs;
  	DWORD dwStart;
  	HANDLE hToken;
  	int ret;
CODE:
    {
    	// Description:
    	// returns the creation time in seconds and the elapsed time in the 3th parameter
    	exitcode = 0;
    	RETVAL = 0;
    	elapsed = 0;
    	if&#40;OpenProcessToken&#40;GetCurrentProcess&#40;&#41;, TOKEN_ADJUST_PRIVILEGES, &#38;hToken&#41;&#41;
    	{
    		if&#40;!EnablePrivilege&#40;hToken, SE_DEBUG_NAME, TRUE&#41;&#41;
    		{
	  	   RETVAL = GetLastError&#40;&#41;;
    		} else
    		{
			ph = OpenProcess&#40;PROCESS_ALL_ACCESS, FALSE, pid&#41;;
			if &#40;!ph&#41; 
			{
		  		RETVAL = GetLastError&#40;&#41;;
			} else
			{
	    			if&#40;GetProcessTimes&#40;ph, &#38;lpCreationTime, &#38;lpExitTime, &#38;lpKernelTime, &#38;lpUserTime&#41; == 0&#41;
	    			{
	    				RETVAL = GetLastError&#40;&#41;;
	    			} else
	    			{
	    				if&#40;FileTimeToSystemTime&#40;&#38;lpCreationTime, &#38;lpSystemTime&#41;==0&#41;
	    				{
	    					RETVAL =  GetLastError&#40;&#41;;
	    				} else
	    				{
				    		// time in seconds the process was created 
	    					secs = &#40;long&#41;&#40;lpSystemTime.wHour*3600 + lpSystemTime.wMinute*60 + lpSystemTime.wSecond&#41;;
	    					GetSystemTime&#40;&#38;lpSystemTime&#41;;
	    					// calculate the difference between the current system time and the process creation time
	    					elapsed = &#40;long&#41;&#40;lpSystemTime.wHour*3600 + lpSystemTime.wMinute*60 + lpSystemTime.wSecond&#41; - secs;
	    					RETVAL = secs;
	    					exitcode = 1;
	    				}
	    			}
	    		}
	    	}
        	CloseHandle&#40;ph&#41;;
	} else
	{
  	   RETVAL = GetLastError&#40;&#41;;
	}
    }	// end CODE
OUTPUT:
    RETVAL</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;20&nbsp;21:34:32&nbsp;2008</span>
    <span class="description">JDB [...] cpan.org -  Queue changed from libwin32 to Win32-Process</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;01&nbsp;18:15:32&nbsp;2015</span>
    <span class="description">cpan [...] zoffix.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This probably should be closed, based on the age alone.

RT#46688 &#40;<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=46688&#41;">https://rt.cpan.org/Ticket/Display.html?id=46688&#41;</a></span> is a related issue and the author of the ticket provided a patch.

I&#39;ve moved that patch into a PR: <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/jandubois/win32-process/pull/6">https://github.com/jandubois/win32-process/pull/6</a></span>

-- 

Cheers,
ZZ [ <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/author/ZOFFIX">https://metacpan.org/author/ZOFFIX</a></span> ]
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;01&nbsp;18:15:32&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
