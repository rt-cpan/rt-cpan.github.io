<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #130702 for Syntax-Keyword-Try: Catch exception into new lexical variable</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #130702 for Syntax-Keyword-Try: Catch exception into new lexical variable</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Syntax-Keyword-Try">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Syntax-Keyword-Try">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Syntax-Keyword-Try">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Syntax-Keyword-Try">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Syntax-Keyword-Try">Syntax-Keyword-Try CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">130702</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Syntax-Keyword-Try">Syntax-Keyword-Try</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
leonerd-cpan [...] leonerd.org.uk

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-265556-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.11    </td>
  </tr>
  <tr id="CF-265557-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<ul>
<li>
0.12</li>
<li>
0.13</li>
</ul>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




rt130702.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1867134/1002551/rt130702.patch">
Tue Oct 15 10:35:49 2019 (2.7k) by leonerd-cpan [...] leonerd.org.uk
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=130702">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1867052" href="/Public/Bug/Display.html?id=130702#txn-1867052">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;14&nbsp;11:36:43&nbsp;2019</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Catch exception into new lexical variable</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1867052/1002512/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1002512">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 537b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">A common pattern now is

  try { ... }
  catch {
    my $e = $@;
    ...
  }

A useful shortcut to this might be the syntax

  try { ... }
  catch my $e { ... }

by taking inspiration from the lexical iterator variable in `foreach` loops.

Such syntax also doesn&#39;t get in the way of whatever resolution we may eventually come to on the subject of typed dispatch, because most discussions there still agree on using parens to somehow specify how to restrict what is caught

  try { ... }
  catch my $e &#40;SOMETHING&#41; { ... }

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1867054" href="/Public/Bug/Display.html?id=130702#txn-1867054">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;14&nbsp;11:45:54&nbsp;2019</span>
    <span class="description">haarg [...] haarg.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1867054/1002514/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1002514">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 762b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Oct 14 11:36:43 2019, PEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; try { ... }
&gt; catch my $e &#40;SOMETHING&#41; { ... }
</div>
I do like the symmetry with foreach for this.  Syntactically it works very well.

I do have some slight concerns regarding the partial symmetry though.  Given how foreach works, I would possibly expect it to work without the &#39;my&#39;.  This of course adds scoping nightmares.  Luckily this could just be an error, so confusion should be minimal.

Similarly, catch without a variable would seem to imply aliasing $_ to the error.  This is rather ugly of course, but it would be my expectation.  And it couldn&#39;t throw an error, since it wouldn&#39;t be invalid syntax.

I don&#39;t think either of these are showstoppers, but they seem worth addressing, at least in the documentation.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1867055" href="/Public/Bug/Display.html?id=130702#txn-1867055">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;14&nbsp;11:45:55&nbsp;2019</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1867060" href="/Public/Bug/Display.html?id=130702#txn-1867060">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;14&nbsp;12:06:04&nbsp;2019</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1867060/1002517/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1002517">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Oct 14 11:45:54 2019, haarg wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I do have some slight concerns regarding the partial symmetry though.
&gt; Given how foreach works, I would possibly expect it to work without
&gt; the &#39;my&#39;.  This of course adds scoping nightmares.  Luckily this could
&gt; just be an error, so confusion should be minimal.
</div>
That `foreach` works without `my` by shadowing an existing &#40;package&#41; variable I expect is a historic baggage from the days of perl-before-5, when lexical variables didn&#39;t even exist. There&#39;s no reason we should copy that. I&#39;m intending to allow only

  catch { ... }
  catch my $var { ... }

and anything else be a syntax error.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Similarly, catch without a variable would seem to imply aliasing $_ to
&gt; the error.  This is rather ugly of course, but it would be my
&gt; expectation.  And it couldn&#39;t throw an error, since it wouldn&#39;t be
&gt; invalid syntax.
&gt; 
&gt; I don&#39;t think either of these are showstoppers, but they seem worth
&gt; addressing, at least in the documentation.
</div>
The existing semantics would remain - that the error ends up in `$@` - because that is core perl&#39;s provided behaviour. That is indeed a documentation point, just to remind users that lacking a new lexical, the error will be in `$@` as usual. I especially don&#39;t want to get into the realm of copying the error also into `$_` because that would overwrite what may be a useful value from outside the `try` block.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1867134" href="/Public/Bug/Display.html?id=130702#txn-1867134">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;15&nbsp;10:35:48&nbsp;2019</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1867134/1002550/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1002550">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 44b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">An initial attempt attached

-- 

Paul Evans
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> rt130702.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1867134/1002551/rt130702.patch">Download rt130702.patch</a><br />
<span class="downloadcontenttype">text/x-diff 2.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">=== modified file &#39;lib/Syntax/Keyword/Try.pm&#39;
--- lib/Syntax/Keyword/Try.pm	2019-09-07 00:19:27 +0000
+++ lib/Syntax/Keyword/Try.pm	2019-10-15 14:35:13 +0000
@@ -95,10 +95,20 @@
       STATEMENTS...
    }
 
+Or
+
+   ...
+   catch my $var {
+      STATEMENTS...
+   }
+
+I&lt;Since version NEXT.&gt;
+
 A C&lt;catch&gt; statement provides a block of code to the preceding C&lt;try&gt;
 statement that will be invoked in the case that the main block of code throws
 an exception. The C&lt;catch&gt; block can inspect the raised exception by looking
-in C&lt;$@&gt; in the usual way.
+in C&lt;$@&gt; in the usual way. Optionally, a new lexical variable can be
+introduced to store the exception in.
 
 Presence of this C&lt;catch&gt; statement causes any exception thrown by the
 preceding C&lt;try&gt; block to be non-fatal to the surrounding code. If the

=== modified file &#39;lib/Syntax/Keyword/Try.xs&#39;
--- lib/Syntax/Keyword/Try.xs	2019-09-07 00:13:49 +0000
+++ lib/Syntax/Keyword/Try.xs	2019-10-15 14:35:13 +0000
@@ -245,6 +245,23 @@
   return i;
 }
 
+#define parse_lexvar&#40;&#41;  MY_parse_lexvar&#40;aTHX&#41;
+static PADOFFSET MY_parse_lexvar&#40;pTHX&#41;
+{
+  char *lexname = PL_parser-&gt;bufptr;
+
+  if&#40;lex_read_unichar&#40;0&#41; != &#39;$&#39;&#41;
+    croak&#40;&#34;Expected a lexical scalar at %s&#34;, lexname&#41;;
+
+  if&#40;!isIDFIRST_uni&#40;lex_peek_unichar&#40;0&#41;&#41;&#41;
+    croak&#40;&#34;Expected a lexical scalar at %s&#34;, lexname&#41;;
+  lex_read_unichar&#40;0&#41;;
+  while&#40;isALNUM_uni&#40;lex_peek_unichar&#40;0&#41;&#41;&#41;
+    lex_read_unichar&#40;0&#41;;
+
+  return pad_add_name_pvn&#40;lexname, PL_parser-&gt;bufptr - lexname, 0, NULL, NULL&#41;;
+}
+
 #define newSTATEOP_nowarnings&#40;&#41;  MY_newSTATEOP_nowarnings&#40;aTHX&#41;
 static OP *MY_newSTATEOP_nowarnings&#40;pTHX&#41;
 {
@@ -463,9 +480,32 @@
   lex_read_space&#40;0&#41;;
 
   if&#40;lex_consume&#40;&#34;catch&#34;&#41;&#41; {
-    lex_read_space&#40;0&#41;;
-    catch = parse_scoped_block&#40;0&#41;;
-    lex_read_space&#40;0&#41;;
+    PADOFFSET catchvar = 0;
+    I32 save_ix = block_start&#40;TRUE&#41;;
+    lex_read_space&#40;0&#41;;
+
+    if&#40;lex_consume&#40;&#34;my&#34;&#41;&#41; {
+      lex_read_space&#40;0&#41;;
+      catchvar = parse_lexvar&#40;&#41;;
+
+      lex_read_space&#40;0&#41;;
+
+      intro_my&#40;&#41;;
+    }
+
+    catch = block_end&#40;save_ix, parse_block&#40;0&#41;&#41;;
+    lex_read_space&#40;0&#41;;
+
+    if&#40;catchvar&#41; {
+      OP *errsv_op = newGVOP&#40;OP_GVSV, 0, PL_errgv&#41;;
+      OP *catchvar_op = newOP&#40;OP_PADSV, 0&#41;;
+      catchvar_op-&gt;op_targ = catchvar;
+
+      catch = op_prepend_elem&#40;OP_LINESEQ,
+        /* $var = $@ */
+        newBINOP&#40;OP_SASSIGN, 0, errsv_op, catchvar_op&#41;,
+        catch&#41;;
+    }
   }
 
   if&#40;lex_consume&#40;&#34;finally&#34;&#41;&#41; {

=== modified file &#39;t/01trycatch.t&#39;
--- t/01trycatch.t	2016-11-23 21:38:48 +0000
+++ t/01trycatch.t	2019-10-15 14:35:13 +0000
@@ -94,4 +94,14 @@
    like&#40; $caught, qr/^oopsie at /, &#39;exception was seen by catch{}&#39; &#41;;
 }
 
+# catch into new lexical
+{
+   try {
+      die &#34;caught\n&#34;;
+   }
+   catch my $e {
+      is&#40; $e, &#34;caught\n&#34;, &#39;exception is caught into new lexical&#39; &#41;;
+   }
+}
+
 done_testing;

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1867135" href="/Public/Bug/Display.html?id=130702#txn-1867135">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;15&nbsp;10:35:49&nbsp;2019</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1903959" href="/Public/Bug/Display.html?id=130702#txn-1903959">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;30&nbsp;07:57:22&nbsp;2020</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1903959/1020247/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1020247">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 543b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This was released in 0.12/0.13.

However, ongoing design for the typed dispatch of catch suggests that actually a better design may be to follow similar syntax to subroutine signatures, and permit something such as

  try { ... }
  catch &#40;$e isa X::SomeException&#41; { ... }
  catch &#40;$e&#41; { anything else }

Which would then replace this syntax.

As a result the particular `catch my VAR` syntax is currently marked experimental and may be removed in future. Likely will be, if the above syntax idea gets implemented in its place.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1903960" href="/Public/Bug/Display.html?id=130702#txn-1903960">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;30&nbsp;07:57:22&nbsp;2020</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Status changed from &#39;patched&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1903961" href="/Public/Bug/Display.html?id=130702#txn-1903961">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;30&nbsp;07:57:22&nbsp;2020</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Fixed in 0.12 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1903962" href="/Public/Bug/Display.html?id=130702#txn-1903962">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;30&nbsp;07:57:22&nbsp;2020</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Fixed in 0.13 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.50354</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
