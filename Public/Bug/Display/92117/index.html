<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #92117 for Net-SSLeay: get_peer_cert_chain leads to seg fault with Net::SSLeay::free</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #92117 for Net-SSLeay: get_peer_cert_chain leads to seg fault with Net::SSLeay::free</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Net-SSLeay">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Net-SSLeay">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Net-SSLeay">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Net-SSLeay">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-SSLeay">Net-SSLeay CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">92117</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Net-SSLeay">Net-SSLeay</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">MIKEM [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
djburd [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-44414-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-44415-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




test3.pl.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1311997/695322/test3.pl.txt">
Mon Jan 13 23:24:39 2014 (915b) by djburd [...] gmail.com
</a>
</font></li>
</ul>


test4.pl.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1311997/695323/test4.pl.txt">
Mon Jan 13 23:24:39 2014 (1.4k) by djburd [...] gmail.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=92117">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1311843" href="/Public/Bug/Display.html?id=92117#txn-1311843">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;13&nbsp;16:31:34&nbsp;2014</span>
    <span class="description">djburd [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> get_peer_cert_chain leads to seg fault with Net::SSLeay::free</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 13 Jan 2014 16:31:25 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-NET-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dana Burd &lt;djburd [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1311843/695224/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/695224">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 342b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">thanks for adding the get_peer_cert_chain recently.  noticed though:

        my @chain = Net::SSLeay::get_peer_cert_chain&#40;$ssl&#41;;
        Net::SSLeay::free&#40;$ssl&#41;;

-&gt;causes seg fault.


replacing with get_peer_certificate does not:

        my @chain = Net::SSLeay::get_peer_certificate&#40;$ssl&#41;;
        Net::SSLeay::free&#40;$ssl&#41;;

no seg fault.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1311843/695225/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/695225">with headers</a>
<br />
<span class="downloadcontenttype">text/html 558b</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1311877" href="/Public/Bug/Display.html?id=92117#txn-1311877">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;13&nbsp;17:59:06&nbsp;2014</span>
    <span class="description">mikem [...] airspayce.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #92117] get_peer_cert_chain leads to seg fault with Net::SSLeay::free</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 14 Jan 2014 08:58:53 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] airspayce.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1311877/695247/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/695247">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello Dana,


Hmmm, I dont see that problem here.
Can you pls send an example program that demonstrates the problem?
What OS/perl are you using?

Cheers.

On Monday, January 13, 2014 04:31:35 PM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Mon Jan 13 16:31:34 2014: Request 92117 was acted upon.
&gt; Transaction: Ticket created by djburd@gmail.com
&gt;        Queue: Net-SSLeay
&gt;      Subject: get_peer_cert_chain leads to seg fault with Net::SSLeay::free
&gt;    Broken in: &#40;no value&#41;
&gt;     Severity: &#40;no value&#41;
&gt;        Owner: Nobody
&gt;   Requestors: djburd@gmail.com
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=92117">https://rt.cpan.org/Ticket/Display.html?id=92117</a></span> &gt;
&gt; 
&gt; 
&gt; thanks for adding the get_peer_cert_chain recently.  noticed though:
&gt; 
&gt;         my @chain = Net::SSLeay::get_peer_cert_chain&#40;$ssl&#41;;
&gt;         Net::SSLeay::free&#40;$ssl&#41;;
&gt; 
&gt; -&gt;causes seg fault.
&gt; 
&gt; 
&gt; replacing with get_peer_certificate does not:
&gt; 
&gt;         my @chain = Net::SSLeay::get_peer_certificate&#40;$ssl&#41;;
&gt;         Net::SSLeay::free&#40;$ssl&#41;;
&gt; 
&gt; no seg fault.
</div>-- 
Mike McCauley           VK4AMM                   mikem@airspayce.com
Airspayce Pty Ltd 9 Bulbul Place Currumbin Waters QLD 4223 Australia   
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.airspayce.com">http://www.airspayce.com</a></span>
Phone +61 7 5598-7474                       Fax   +61 7 5598-7070
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1311878" href="/Public/Bug/Display.html?id=92117#txn-1311878">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;13&nbsp;17:59:07&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1311997" href="/Public/Bug/Display.html?id=92117#txn-1311997">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;13&nbsp;23:24:39&nbsp;2014</span>
    <span class="description">djburd [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #92117] get_peer_cert_chain leads to seg fault with Net::SSLeay::free</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 13 Jan 2014 23:24:27 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dana Burd &lt;djburd [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1311997/695320/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/695320">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Mike,

test4.pl is taken directly from test included in the patch from ticket
91297, with the addition of:
        shutdown&#40;S, 2&#41;;
        Net::SSLeay::free&#40;$ssl&#41;;
        Net::SSLeay::CTX_free&#40;$ctx&#41;;
        close S;

$ ./test4.pl
1..3
ok 1 - get_peer_cert_chain returns some elements
ok 2 - X509_get_subject_name
ok 3 - X509_NAME_oneline
Segmentation fault &#40;core dumped&#41;


test3.pl is simplified version of the above, with only
Net::SSLeay::free&#40;$ssl&#41;;

$ ./test3.pl
Segmentation fault &#40;core dumped&#41;


replacing get_peer_cert_chain with get_peer_certificate in either of these,
the seg fault does not occur.

removing Net::SSLeay::free&#40;$ssl&#41;; also eliminates the seg fault, and
get_peer_cert_chain works as expected.  I haven&#39;t looked at the internals
enough to know if the free routine is really needed or not, my script is
very similar to the test4 case.


Environment is an ubuntu 12.04 LTS.

$ uname -a
Linux lindsey 3.2.0-39-generic #62-Ubuntu SMP Thu Feb 28 00:28:53 UTC 2013
x86_64 x86_64 x86_64 GNU/Linux

$ openssl version
OpenSSL 1.0.1 14 Mar 2012

$ perl -v
This is perl 5, version 14, subversion 2 &#40;v5.14.2&#41; built for
x86_64-linux-gnu-thread-multi
&#40;with 56 registered patches, see perl -V for more detail&#41;
...


Net::SSleay  Net-SSLeay-1.57.tar.gz

Note that perl, openssl and openssl dev headers come directly from ubuntu
12.04 LTS updates resource, current installed package is: openssl
&#40;1.0.1-4ubuntu5.11&#41;, perl &#40;5.14.2-6ubuntu2.3&#41;.  I believe the README in
Net-SSLeay recommended against using binary packages with Net::SSLeay, so
that could be the source of the issue.

-dana



On Mon, Jan 13, 2014 at 5:59 PM, Mike McCauley via RT &lt;
bug-Net-SSLeay@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=92117">https://rt.cpan.org/Ticket/Display.html?id=92117</a></span> &gt;
&gt;
&gt; Hello Dana,
&gt;
&gt;
&gt; Hmmm, I dont see that problem here.
&gt; Can you pls send an example program that demonstrates the problem?
&gt; What OS/perl are you using?
&gt;
&gt; Cheers.
&gt;
&gt; On Monday, January 13, 2014 04:31:35 PM you wrote:
<div class="message-stanza open">&gt; &gt; Mon Jan 13 16:31:34 2014: Request 92117 was acted upon.
&gt; &gt; Transaction: Ticket created by djburd@gmail.com
&gt; &gt;        Queue: Net-SSLeay
&gt; &gt;      Subject: get_peer_cert_chain leads to seg fault with
</div>&gt; Net::SSLeay::free
<div class="message-stanza open">&gt; &gt;    Broken in: &#40;no value&#41;
&gt; &gt;     Severity: &#40;no value&#41;
&gt; &gt;        Owner: Nobody
&gt; &gt;   Requestors: djburd@gmail.com
&gt; &gt;       Status: new
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=92117">https://rt.cpan.org/Ticket/Display.html?id=92117</a></span> &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; thanks for adding the get_peer_cert_chain recently.  noticed though:
&gt; &gt;
&gt; &gt;         my @chain = Net::SSLeay::get_peer_cert_chain&#40;$ssl&#41;;
&gt; &gt;         Net::SSLeay::free&#40;$ssl&#41;;
&gt; &gt;
&gt; &gt; -&gt;causes seg fault.
&gt; &gt;
&gt; &gt;
&gt; &gt; replacing with get_peer_certificate does not:
&gt; &gt;
&gt; &gt;         my @chain = Net::SSLeay::get_peer_certificate&#40;$ssl&#41;;
&gt; &gt;         Net::SSLeay::free&#40;$ssl&#41;;
&gt; &gt;
&gt; &gt; no seg fault.
</div>&gt; --
&gt; Mike McCauley           VK4AMM                   mikem@airspayce.com
&gt; Airspayce Pty Ltd 9 Bulbul Place Currumbin Waters QLD 4223 Australia
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.airspayce.com">http://www.airspayce.com</a></span>
&gt; Phone +61 7 5598-7474                       Fax   +61 7 5598-7070
&gt;
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1311997/695321/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/695321">with headers</a>
<br />
<span class="downloadcontenttype">text/html 4.8k</span>
</div>
<div class="messagebody">
</div>
</div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1311997/695322/test3.pl.txt">Download test3.pl.txt</a><br />
<span class="downloadcontenttype">text/plain 915b</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1311997/695323/test4.pl.txt">Download test4.pl.txt</a><br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1312018" href="/Public/Bug/Display.html?id=92117#txn-1312018">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;14&nbsp;00:47:06&nbsp;2014</span>
    <span class="description">mikem [...] airspayce.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #92117] get_peer_cert_chain leads to seg fault with Net::SSLeay::free</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 14 Jan 2014 15:46:53 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] airspayce.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1312018/695334/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/695334">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Dana,

thanks. This should be fixed in the latest SVN 395. Pls test and if OK I will 
make a new release.

Cheers.

On Monday, January 13, 2014 11:24:40 PM you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=92117">https://rt.cpan.org/Ticket/Display.html?id=92117</a></span> &gt;
&gt; 
&gt; Mike,
&gt; 
&gt; test4.pl is taken directly from test included in the patch from ticket
&gt; 91297, with the addition of:
&gt;         shutdown&#40;S, 2&#41;;
&gt;         Net::SSLeay::free&#40;$ssl&#41;;
&gt;         Net::SSLeay::CTX_free&#40;$ctx&#41;;
&gt;         close S;
&gt; 
&gt; $ ./test4.pl
&gt; 1..3
&gt; ok 1 - get_peer_cert_chain returns some elements
&gt; ok 2 - X509_get_subject_name
&gt; ok 3 - X509_NAME_oneline
&gt; Segmentation fault &#40;core dumped&#41;
&gt; 
&gt; 
&gt; test3.pl is simplified version of the above, with only
&gt; Net::SSLeay::free&#40;$ssl&#41;;
&gt; 
&gt; $ ./test3.pl
&gt; Segmentation fault &#40;core dumped&#41;
&gt; 
&gt; 
&gt; replacing get_peer_cert_chain with get_peer_certificate in either of these,
&gt; the seg fault does not occur.
&gt; 
&gt; removing Net::SSLeay::free&#40;$ssl&#41;; also eliminates the seg fault, and
&gt; get_peer_cert_chain works as expected.  I haven&#39;t looked at the internals
&gt; enough to know if the free routine is really needed or not, my script is
&gt; very similar to the test4 case.
&gt; 
&gt; 
&gt; Environment is an ubuntu 12.04 LTS.
&gt; 
&gt; $ uname -a
&gt; Linux lindsey 3.2.0-39-generic #62-Ubuntu SMP Thu Feb 28 00:28:53 UTC 2013
&gt; x86_64 x86_64 x86_64 GNU/Linux
&gt; 
&gt; $ openssl version
&gt; OpenSSL 1.0.1 14 Mar 2012
&gt; 
&gt; $ perl -v
&gt; This is perl 5, version 14, subversion 2 &#40;v5.14.2&#41; built for
&gt; x86_64-linux-gnu-thread-multi
&gt; &#40;with 56 registered patches, see perl -V for more detail&#41;
&gt; ...
&gt; 
&gt; 
&gt; Net::SSleay  Net-SSLeay-1.57.tar.gz
&gt; 
&gt; Note that perl, openssl and openssl dev headers come directly from ubuntu
&gt; 12.04 LTS updates resource, current installed package is: openssl
&gt; &#40;1.0.1-4ubuntu5.11&#41;, perl &#40;5.14.2-6ubuntu2.3&#41;.  I believe the README in
&gt; Net-SSLeay recommended against using binary packages with Net::SSLeay, so
&gt; that could be the source of the issue.
&gt; 
&gt; -dana
&gt; 
&gt; 
&gt; 
&gt; On Mon, Jan 13, 2014 at 5:59 PM, Mike McCauley via RT &lt;
&gt; 
&gt; bug-Net-SSLeay@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=92117">https://rt.cpan.org/Ticket/Display.html?id=92117</a></span> &gt;
&gt; &gt; 
&gt; &gt; Hello Dana,
&gt; &gt; 
&gt; &gt; 
&gt; &gt; Hmmm, I dont see that problem here.
&gt; &gt; Can you pls send an example program that demonstrates the problem?
&gt; &gt; What OS/perl are you using?
&gt; &gt; 
&gt; &gt; Cheers.
&gt; &gt; 
&gt; &gt; On Monday, January 13, 2014 04:31:35 PM you wrote:
<div class="message-stanza open">&gt; &gt; &gt; Mon Jan 13 16:31:34 2014: Request 92117 was acted upon.
&gt; &gt; &gt; Transaction: Ticket created by djburd@gmail.com
&gt; &gt; &gt; 
&gt; &gt; &gt;        Queue: Net-SSLeay
&gt; &gt; &gt;      
&gt; &gt; &gt;      Subject: get_peer_cert_chain leads to seg fault with
</div>&gt; &gt; 
&gt; &gt; Net::SSLeay::free
&gt; &gt; 
<div class="message-stanza open">&gt; &gt; &gt;    Broken in: &#40;no value&#41;
&gt; &gt; &gt;    
&gt; &gt; &gt;     Severity: &#40;no value&#41;
&gt; &gt; &gt;     
&gt; &gt; &gt;        Owner: Nobody
&gt; &gt; &gt;   
&gt; &gt; &gt;   Requestors: djburd@gmail.com
&gt; &gt; &gt;   
&gt; &gt; &gt;       Status: new
&gt; &gt; &gt;  
&gt; &gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=92117">https://rt.cpan.org/Ticket/Display.html?id=92117</a></span> &gt;
&gt; &gt; &gt; 
&gt; &gt; &gt; thanks for adding the get_peer_cert_chain recently.  noticed though:
&gt; &gt; &gt;         my @chain = Net::SSLeay::get_peer_cert_chain&#40;$ssl&#41;;
&gt; &gt; &gt;         Net::SSLeay::free&#40;$ssl&#41;;
&gt; &gt; &gt; 
&gt; &gt; &gt; -&gt;causes seg fault.
&gt; &gt; &gt; 
&gt; &gt; &gt; replacing with get_peer_certificate does not:
&gt; &gt; &gt;         my @chain = Net::SSLeay::get_peer_certificate&#40;$ssl&#41;;
&gt; &gt; &gt;         Net::SSLeay::free&#40;$ssl&#41;;
&gt; &gt; &gt; 
&gt; &gt; &gt; no seg fault.
</div>&gt; &gt; 
&gt; &gt; --
&gt; &gt; Mike McCauley           VK4AMM                   mikem@airspayce.com
&gt; &gt; Airspayce Pty Ltd 9 Bulbul Place Currumbin Waters QLD 4223 Australia
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.airspayce.com">http://www.airspayce.com</a></span>
&gt; &gt; Phone +61 7 5598-7474                       Fax   +61 7 5598-7070
</div></div>-- 
Mike McCauley           VK4AMM                   mikem@airspayce.com
Airspayce Pty Ltd 9 Bulbul Place Currumbin Waters QLD 4223 Australia   
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.airspayce.com">http://www.airspayce.com</a></span>
Phone +61 7 5598-7474                       Fax   +61 7 5598-7070
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1312307" href="/Public/Bug/Display.html?id=92117#txn-1312307">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;14&nbsp;11:42:02&nbsp;2014</span>
    <span class="description">djburd [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #92117] get_peer_cert_chain leads to seg fault with Net::SSLeay::free</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 14 Jan 2014 11:41:48 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dana Burd &lt;djburd [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1312307/695520/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/695520">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Confirmed, issue is resolved with SVN 395.  Thanks Mike.

$ ./test4.pl
1..3
ok 1 - get_peer_cert_chain returns some elements
ok 2 - X509_get_subject_name
ok 3 - X509_NAME_oneline
$

-dana


On Tue, Jan 14, 2014 at 12:47 AM, Mike McCauley via RT &lt;
bug-Net-SSLeay@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=92117">https://rt.cpan.org/Ticket/Display.html?id=92117</a></span> &gt;
&gt;
&gt; Hi Dana,
&gt;
&gt; thanks. This should be fixed in the latest SVN 395. Pls test and if OK I
&gt; will
&gt; make a new release.
&gt;
&gt; Cheers.
&gt;
&gt; On Monday, January 13, 2014 11:24:40 PM you wrote:
<div class="message-stanza open">&gt; &gt;        Queue: Net-SSLeay
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=92117">https://rt.cpan.org/Ticket/Display.html?id=92117</a></span> &gt;
&gt; &gt;
&gt; &gt; Mike,
&gt; &gt;
&gt; &gt; test4.pl is taken directly from test included in the patch from ticket
&gt; &gt; 91297, with the addition of:
&gt; &gt;         shutdown&#40;S, 2&#41;;
&gt; &gt;         Net::SSLeay::free&#40;$ssl&#41;;
&gt; &gt;         Net::SSLeay::CTX_free&#40;$ctx&#41;;
&gt; &gt;         close S;
&gt; &gt;
&gt; &gt; $ ./test4.pl
&gt; &gt; 1..3
&gt; &gt; ok 1 - get_peer_cert_chain returns some elements
&gt; &gt; ok 2 - X509_get_subject_name
&gt; &gt; ok 3 - X509_NAME_oneline
&gt; &gt; Segmentation fault &#40;core dumped&#41;
&gt; &gt;
&gt; &gt;
&gt; &gt; test3.pl is simplified version of the above, with only
&gt; &gt; Net::SSLeay::free&#40;$ssl&#41;;
&gt; &gt;
&gt; &gt; $ ./test3.pl
&gt; &gt; Segmentation fault &#40;core dumped&#41;
&gt; &gt;
&gt; &gt;
&gt; &gt; replacing get_peer_cert_chain with get_peer_certificate in either of
</div>&gt; these,
<div class="message-stanza open">&gt; &gt; the seg fault does not occur.
&gt; &gt;
&gt; &gt; removing Net::SSLeay::free&#40;$ssl&#41;; also eliminates the seg fault, and
&gt; &gt; get_peer_cert_chain works as expected.  I haven&#39;t looked at the internals
&gt; &gt; enough to know if the free routine is really needed or not, my script is
&gt; &gt; very similar to the test4 case.
&gt; &gt;
&gt; &gt;
&gt; &gt; Environment is an ubuntu 12.04 LTS.
&gt; &gt;
&gt; &gt; $ uname -a
&gt; &gt; Linux lindsey 3.2.0-39-generic #62-Ubuntu SMP Thu Feb 28 00:28:53 UTC
</div>&gt; 2013
<div class="message-stanza open">&gt; &gt; x86_64 x86_64 x86_64 GNU/Linux
&gt; &gt;
&gt; &gt; $ openssl version
&gt; &gt; OpenSSL 1.0.1 14 Mar 2012
&gt; &gt;
&gt; &gt; $ perl -v
&gt; &gt; This is perl 5, version 14, subversion 2 &#40;v5.14.2&#41; built for
&gt; &gt; x86_64-linux-gnu-thread-multi
&gt; &gt; &#40;with 56 registered patches, see perl -V for more detail&#41;
&gt; &gt; ...
&gt; &gt;
&gt; &gt;
&gt; &gt; Net::SSleay  Net-SSLeay-1.57.tar.gz
&gt; &gt;
&gt; &gt; Note that perl, openssl and openssl dev headers come directly from ubuntu
&gt; &gt; 12.04 LTS updates resource, current installed package is: openssl
&gt; &gt; &#40;1.0.1-4ubuntu5.11&#41;, perl &#40;5.14.2-6ubuntu2.3&#41;.  I believe the README in
&gt; &gt; Net-SSLeay recommended against using binary packages with Net::SSLeay, so
&gt; &gt; that could be the source of the issue.
&gt; &gt;
&gt; &gt; -dana
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; On Mon, Jan 13, 2014 at 5:59 PM, Mike McCauley via RT &lt;
&gt; &gt;
&gt; &gt; bug-Net-SSLeay@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt; &gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=92117">https://rt.cpan.org/Ticket/Display.html?id=92117</a></span> &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; Hello Dana,
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; Hmmm, I dont see that problem here.
&gt; &gt; &gt; Can you pls send an example program that demonstrates the problem?
&gt; &gt; &gt; What OS/perl are you using?
&gt; &gt; &gt;
&gt; &gt; &gt; Cheers.
&gt; &gt; &gt;
&gt; &gt; &gt; On Monday, January 13, 2014 04:31:35 PM you wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; Mon Jan 13 16:31:34 2014: Request 92117 was acted upon.
&gt; &gt; &gt; &gt; Transaction: Ticket created by djburd@gmail.com
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;        Queue: Net-SSLeay
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;      Subject: get_peer_cert_chain leads to seg fault with
</div>&gt; &gt; &gt;
&gt; &gt; &gt; Net::SSLeay::free
&gt; &gt; &gt;
<div class="message-stanza open">&gt; &gt; &gt; &gt;    Broken in: &#40;no value&#41;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;     Severity: &#40;no value&#41;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;        Owner: Nobody
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;   Requestors: djburd@gmail.com
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;       Status: new
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=92117">https://rt.cpan.org/Ticket/Display.html?id=92117</a></span> &gt;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; thanks for adding the get_peer_cert_chain recently.  noticed though:
&gt; &gt; &gt; &gt;         my @chain = Net::SSLeay::get_peer_cert_chain&#40;$ssl&#41;;
&gt; &gt; &gt; &gt;         Net::SSLeay::free&#40;$ssl&#41;;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; -&gt;causes seg fault.
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; replacing with get_peer_certificate does not:
&gt; &gt; &gt; &gt;         my @chain = Net::SSLeay::get_peer_certificate&#40;$ssl&#41;;
&gt; &gt; &gt; &gt;         Net::SSLeay::free&#40;$ssl&#41;;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; no seg fault.
</div>&gt; &gt; &gt;
&gt; &gt; &gt; --
&gt; &gt; &gt; Mike McCauley           VK4AMM                   mikem@airspayce.com
&gt; &gt; &gt; Airspayce Pty Ltd 9 Bulbul Place Currumbin Waters QLD 4223 Australia
&gt; &gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.airspayce.com">http://www.airspayce.com</a></span>
&gt; &gt; &gt; Phone +61 7 5598-7474                       Fax   +61 7 5598-7070
</div></div>&gt; --
&gt; Mike McCauley           VK4AMM                   mikem@airspayce.com
&gt; Airspayce Pty Ltd 9 Bulbul Place Currumbin Waters QLD 4223 Australia
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.airspayce.com">http://www.airspayce.com</a></span>
&gt; Phone +61 7 5598-7474                       Fax   +61 7 5598-7070
&gt;
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1312307/695521/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/695521">with headers</a>
<br />
<span class="downloadcontenttype">text/html 6.7k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1312444" href="/Public/Bug/Display.html?id=92117#txn-1312444">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;14&nbsp;18:09:04&nbsp;2014</span>
    <span class="description">mikem [...] airspayce.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #92117] get_peer_cert_chain leads to seg fault with Net::SSLeay::free</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 15 Jan 2014 09:08:53 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike McCauley &lt;mikem [...] airspayce.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1312444/695604/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/695604">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 5.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

thanks.
Expect a new release very soon.

Cheers.

On Tuesday, January 14, 2014 11:42:03 AM Dana Burd via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Net-SSLeay
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=92117">https://rt.cpan.org/Ticket/Display.html?id=92117</a></span> &gt;
&gt; 
&gt; Confirmed, issue is resolved with SVN 395.  Thanks Mike.
&gt; 
&gt; $ ./test4.pl
&gt; 1..3
&gt; ok 1 - get_peer_cert_chain returns some elements
&gt; ok 2 - X509_get_subject_name
&gt; ok 3 - X509_NAME_oneline
&gt; $
&gt; 
&gt; -dana
&gt; 
&gt; 
&gt; On Tue, Jan 14, 2014 at 12:47 AM, Mike McCauley via RT &lt;
&gt; 
&gt; bug-Net-SSLeay@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=92117">https://rt.cpan.org/Ticket/Display.html?id=92117</a></span> &gt;
&gt; &gt; 
&gt; &gt; Hi Dana,
&gt; &gt; 
&gt; &gt; thanks. This should be fixed in the latest SVN 395. Pls test and if OK I
&gt; &gt; will
&gt; &gt; make a new release.
&gt; &gt; 
&gt; &gt; Cheers.
&gt; &gt; 
&gt; &gt; On Monday, January 13, 2014 11:24:40 PM you wrote:
<div class="message-stanza open">&gt; &gt; &gt;        Queue: Net-SSLeay
&gt; &gt; &gt;  
&gt; &gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=92117">https://rt.cpan.org/Ticket/Display.html?id=92117</a></span> &gt;
&gt; &gt; &gt; 
&gt; &gt; &gt; Mike,
&gt; &gt; &gt; 
&gt; &gt; &gt; test4.pl is taken directly from test included in the patch from ticket
&gt; &gt; &gt; 
&gt; &gt; &gt; 91297, with the addition of:
&gt; &gt; &gt;         shutdown&#40;S, 2&#41;;
&gt; &gt; &gt;         Net::SSLeay::free&#40;$ssl&#41;;
&gt; &gt; &gt;         Net::SSLeay::CTX_free&#40;$ctx&#41;;
&gt; &gt; &gt;         close S;
&gt; &gt; &gt; 
&gt; &gt; &gt; $ ./test4.pl
&gt; &gt; &gt; 1..3
&gt; &gt; &gt; ok 1 - get_peer_cert_chain returns some elements
&gt; &gt; &gt; ok 2 - X509_get_subject_name
&gt; &gt; &gt; ok 3 - X509_NAME_oneline
&gt; &gt; &gt; Segmentation fault &#40;core dumped&#41;
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; test3.pl is simplified version of the above, with only
&gt; &gt; &gt; Net::SSLeay::free&#40;$ssl&#41;;
&gt; &gt; &gt; 
&gt; &gt; &gt; $ ./test3.pl
&gt; &gt; &gt; Segmentation fault &#40;core dumped&#41;
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; replacing get_peer_cert_chain with get_peer_certificate in either of
</div>&gt; &gt; 
&gt; &gt; these,
&gt; &gt; 
<div class="message-stanza open">&gt; &gt; &gt; the seg fault does not occur.
&gt; &gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://groups.google.com/group/rf22-arduino">http://groups.google.com/group/rf22-arduino</a></span>
&gt; &gt; &gt; removing Net::SSLeay::free&#40;$ssl&#41;; also eliminates the seg fault, and
&gt; &gt; &gt; get_peer_cert_chain works as expected.  I haven&#39;t looked at the
&gt; &gt; &gt; internals
&gt; &gt; &gt; enough to know if the free routine is really needed or not, my script is
&gt; &gt; &gt; very similar to the test4 case.
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; Environment is an ubuntu 12.04 LTS.
&gt; &gt; &gt; 
&gt; &gt; &gt; $ uname -a
&gt; &gt; &gt; Linux lindsey 3.2.0-39-generic #62-Ubuntu SMP Thu Feb 28 00:28:53 UTC
</div>&gt; &gt; 
&gt; &gt; 2013
&gt; &gt; 
<div class="message-stanza open">&gt; &gt; &gt; x86_64 x86_64 x86_64 GNU/Linux
&gt; &gt; &gt; 
&gt; &gt; &gt; $ openssl version
&gt; &gt; &gt; OpenSSL 1.0.1 14 Mar 2012
&gt; &gt; &gt; 
&gt; &gt; &gt; $ perl -v
&gt; &gt; &gt; This is perl 5, version 14, subversion 2 &#40;v5.14.2&#41; built for
&gt; &gt; &gt; x86_64-linux-gnu-thread-multi
&gt; &gt; &gt; &#40;with 56 registered patches, see perl -V for more detail&#41;
&gt; &gt; &gt; ...
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; Net::SSleay  Net-SSLeay-1.57.tar.gz
&gt; &gt; &gt; 
&gt; &gt; &gt; Note that perl, openssl and openssl dev headers come directly from
&gt; &gt; &gt; ubuntu
&gt; &gt; &gt; 12.04 LTS updates resource, current installed package is: openssl
&gt; &gt; &gt; &#40;1.0.1-4ubuntu5.11&#41;, perl &#40;5.14.2-6ubuntu2.3&#41;.  I believe the README in
&gt; &gt; &gt; Net-SSLeay recommended against using binary packages with Net::SSLeay,
&gt; &gt; &gt; so
&gt; &gt; &gt; that could be the source of the issue.
&gt; &gt; &gt; 
&gt; &gt; &gt; -dana
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; On Mon, Jan 13, 2014 at 5:59 PM, Mike McCauley via RT &lt;
&gt; &gt; &gt; 
&gt; &gt; &gt; bug-Net-SSLeay@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=92117">https://rt.cpan.org/Ticket/Display.html?id=92117</a></span> &gt;
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Hello Dana,
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Hmmm, I dont see that problem here.
&gt; &gt; &gt; &gt; Can you pls send an example program that demonstrates the problem?
&gt; &gt; &gt; &gt; What OS/perl are you using?
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Cheers.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; On Monday, January 13, 2014 04:31:35 PM you wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt; Mon Jan 13 16:31:34 2014: Request 92117 was acted upon.
&gt; &gt; &gt; &gt; &gt; Transaction: Ticket created by djburd@gmail.com
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt;        Queue: Net-SSLeay
&gt; &gt; &gt; &gt; &gt;      
&gt; &gt; &gt; &gt; &gt;      Subject: get_peer_cert_chain leads to seg fault with
</div>&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Net::SSLeay::free
&gt; &gt; &gt; &gt; 
<div class="message-stanza open">&gt; &gt; &gt; &gt; &gt;    Broken in: &#40;no value&#41;
&gt; &gt; &gt; &gt; &gt;    
&gt; &gt; &gt; &gt; &gt;     Severity: &#40;no value&#41;
&gt; &gt; &gt; &gt; &gt;     
&gt; &gt; &gt; &gt; &gt;        Owner: Nobody
&gt; &gt; &gt; &gt; &gt;   
&gt; &gt; &gt; &gt; &gt;   Requestors: djburd@gmail.com
&gt; &gt; &gt; &gt; &gt;   
&gt; &gt; &gt; &gt; &gt;       Status: new
&gt; &gt; &gt; &gt; &gt;  
&gt; &gt; &gt; &gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=92117">https://rt.cpan.org/Ticket/Display.html?id=92117</a></span> &gt;
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; thanks for adding the get_peer_cert_chain recently.  noticed though:
&gt; &gt; &gt; &gt; &gt;         my @chain = Net::SSLeay::get_peer_cert_chain&#40;$ssl&#41;;
&gt; &gt; &gt; &gt; &gt;         Net::SSLeay::free&#40;$ssl&#41;;
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; -&gt;causes seg fault.
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; replacing with get_peer_certificate does not:
&gt; &gt; &gt; &gt; &gt;         my @chain = Net::SSLeay::get_peer_certificate&#40;$ssl&#41;;
&gt; &gt; &gt; &gt; &gt;         Net::SSLeay::free&#40;$ssl&#41;;
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; no seg fault.
</div>&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; --
&gt; &gt; &gt; &gt; Mike McCauley           VK4AMM                   mikem@airspayce.com
&gt; &gt; &gt; &gt; Airspayce Pty Ltd 9 Bulbul Place Currumbin Waters QLD 4223 Australia
&gt; &gt; &gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.airspayce.com">http://www.airspayce.com</a></span>
&gt; &gt; &gt; &gt; Phone +61 7 5598-7474                       Fax   +61 7 5598-7070
</div></div>&gt; &gt; 
&gt; &gt; --
&gt; &gt; Mike McCauley           VK4AMM                   mikem@airspayce.com
&gt; &gt; Airspayce Pty Ltd 9 Bulbul Place Currumbin Waters QLD 4223 Australia
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.airspayce.com">http://www.airspayce.com</a></span>
&gt; &gt; Phone +61 7 5598-7474                       Fax   +61 7 5598-7070
</div></div>-- 
Mike McCauley           VK4AMM                   mikem@airspayce.com
Airspayce Pty Ltd 9 Bulbul Place Currumbin Waters QLD 4223 Australia   
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.airspayce.com">http://www.airspayce.com</a></span>
Phone +61 7 5598-7474                       Fax   +61 7 5598-7070
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1367533" href="/Public/Bug/Display.html?id=92117#txn-1367533">#</a>      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;24&nbsp;03:24:56&nbsp;2014</span>
    <span class="description">MIKEM [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1367535" href="/Public/Bug/Display.html?id=92117#txn-1367535">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;May&nbsp;24&nbsp;03:24:56&nbsp;2014</span>
    <span class="description">MIKEM [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.593569</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
