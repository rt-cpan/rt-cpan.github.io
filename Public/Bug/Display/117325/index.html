<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #117325 for Moose: Nested roles not flagging conflicts</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #117325 for Moose: Nested roles not flagging conflicts</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Moose">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Moose">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Moose">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Moose">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Moose">Moose CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">117325</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Moose">Moose</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
thomas.pansino [...] intel.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-38786-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-38787-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=117325">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1663183" href="/Public/Bug/Display.html?id=117325#txn-1663183">#</a>      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;30&nbsp;02:34:58&nbsp;2016</span>
    <span class="description">thomas.pansino [...] intel.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Nested roles not flagging conflicts</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 30 Aug 2016 06:34:42 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Moose [...] rt.cpan.org&#34; &lt;bug-Moose [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Pansino, Thomas&#34; &lt;thomas.pansino [...] intel.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1663183/892740/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/892740">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have some code similar to the following:



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ls
</div>
BaseRole.pm  ChildRoleA.pm  ChildRoleB.pm  MyClass.pm  test.pl



====== BaseRole.pm ======

package BaseRole;



use Moose::Role;



sub foo {

  print&#40;&#34;Calling BaseRole::foo\n&#34;&#41;;

}



1;



====== ChildRoleA.pm ======

package ChildRoleA;



use Moose::Role;



with &#39;BaseRole&#39;;



sub bar {

  print&#40;&#34;Calling ChildRoleA::bar\n&#34;&#41;;

}



1;



====== ChildRoleB.pm ======

package ChildRoleB;



use Moose::Role;



with &#39;BaseRole&#39;;



requires &#39;bar&#39;;



sub foo {

  print&#40;&#34;Calling ChildRoleB::foo\n&#34;&#41;;

}



1;



====== MyClass.pm ======

package MyClass;



use Moose;



with &#39;ChildRoleA&#39;;

with &#39;ChildRoleB&#39;;



__PACKAGE__-&gt;meta&#40;&#41;-&gt;make_immutable&#40;&#41;;

1;



====== test.pl ======

#!/usr/bin/env perl

use v5.14.1;

use strict;

use warnings;



use MyClass;

my $class = MyClass-&gt;new&#40;&#41;;

$class-&gt;foo&#40;&#41;;

$class-&gt;bar&#40;&#41;;





Running test.pl produces the following output:

Calling BaseRole::foo

Calling ChildRoleA::bar



When I originally wrote this, I was hoping that the definition of ChildRoleB::foo would override BaseRole::foo since the with call to ChildRoleB comes after the with call to ChildRoleA.

After quite a bit of manual reading and Internet research, I realized Moose roles don&#39;t really have inheritance like that. The only overriding that&#39;s valid would have been a definition for foo in MyClass, therefore having two definitions for foo in two different roles should actually have been flagged as a conflict when MyClass was composed.



So first thing - is my understanding correct? You can only override a method from a role with a definition in a composing class? All other conflicting definitions in roles needs to be dealt with via exclusion or aliasing?

If so, then the real question is, why is this not being flagged as a conflict? I tested and it does flag correctly in version 2.08, but not in 2.16 if I do the with as two separate statements like it is in my example. If I change it to be a single with call though, it works as expected.



My guess is something changed in Moose::Util::apply_all_roles between these two versions. Thoughts?
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1663183/892741/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/892741">with headers</a>
<br />
<span class="downloadcontenttype">text/html 7.8k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1667729" href="/Public/Bug/Display.html?id=117325#txn-1667729">#</a>      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;11&nbsp;00:33:56&nbsp;2016</span>
    <span class="description">DROLSKY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1667729/895056/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/895056">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 315b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Aug 30 02:34:58 2016, thomas.pansino@intel.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; with &#39;ChildRoleA&#39;;
&gt; with &#39;ChildRoleB&#39;;
</div>
This is your problem. If you consume each role separately Moose cannot detect conflicts. You should always consume all of your roles in a single &#34;with&#34; call:

    with &#39;ChildRoleA&#39;, &#39;ChildRoleB&#39;;

Cheers,

-dave
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1667730" href="/Public/Bug/Display.html?id=117325#txn-1667730">#</a>      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;11&nbsp;00:33:57&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1667733" href="/Public/Bug/Display.html?id=117325#txn-1667733">#</a>      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;11&nbsp;00:34:02&nbsp;2016</span>
    <span class="description">DROLSKY [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1668265" href="/Public/Bug/Display.html?id=117325#txn-1668265">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;12&nbsp;13:15:15&nbsp;2016</span>
    <span class="description">thomas.pansino [...] intel.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #117325] Nested roles not flagging conflicts</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 12 Sep 2016 17:14:58 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Moose [...] rt.cpan.org&#34; &lt;bug-Moose [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Pansino, Thomas&#34; &lt;thomas.pansino [...] intel.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1668265/895310/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/895310">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 937b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks Dave.

Shouldn&#39;t this be flagged though? As I mentioned it does flag correctly in 2.08, but as of 2.16 it accepts this silently and does the wrong thing.
At the very least, the requirement to use only one with call per class is unclear from the documentation and should be updated.

-Tom

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Dave Rolsky via RT [mailto:bug-Moose@rt.cpan.org] 
Sent: Saturday, September 10, 2016 21:34
To: Pansino, Thomas &lt;thomas.pansino@intel.com&gt;
Subject: [rt.cpan.org #117325] Nested roles not flagging conflicts

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=117325">https://rt.cpan.org/Ticket/Display.html?id=117325</a></span> &gt;

On Tue Aug 30 02:34:58 2016, thomas.pansino@intel.com wrote:
<div class="message-stanza open">&gt; with &#39;ChildRoleA&#39;;
&gt; with &#39;ChildRoleB&#39;;
</div>
This is your problem. If you consume each role separately Moose cannot detect conflicts. You should always consume all of your roles in a single &#34;with&#34; call:

    with &#39;ChildRoleA&#39;, &#39;ChildRoleB&#39;;

Cheers,

-dave
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1668289" href="/Public/Bug/Display.html?id=117325#txn-1668289">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;12&nbsp;13:42:16&nbsp;2016</span>
    <span class="description">DROLSKY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1668289/895315/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/895315">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 660b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2016-09-12 12:15:15, thomas.pansino@intel.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks Dave.
&gt; 
&gt; Shouldn&#39;t this be flagged though? As I mentioned it does flag
&gt; correctly in 2.08, but as of 2.16 it accepts this silently and does
&gt; the wrong thing.
&gt; At the very least, the requirement to use only one with call per class
&gt; is unclear from the documentation and should be updated.
</div>
I&#39;m surprised that this caused an error in 2.08. I&#39;m guessing that maybe it was a _different_ error than the one you get when you consume both roles in a single with statement.

I&#39;m pretty surprised the docs don&#39;t make a point of mentioning that you should just use one with statement. I&#39;ll fix that.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1668292" href="/Public/Bug/Display.html?id=117325#txn-1668292">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;12&nbsp;13:46:14&nbsp;2016</span>
    <span class="description">DROLSKY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1668292/895318/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/895318">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 39b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/moose/Moose/pull/133">https://github.com/moose/Moose/pull/133</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1668295" href="/Public/Bug/Display.html?id=117325#txn-1668295">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;12&nbsp;14:09:54&nbsp;2016</span>
    <span class="description">thomas.pansino [...] intel.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #117325] Nested roles not flagging conflicts</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 12 Sep 2016 18:09:29 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Moose [...] rt.cpan.org&#34; &lt;bug-Moose [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Pansino, Thomas&#34; &lt;thomas.pansino [...] intel.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1668295/895321/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/895321">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 833b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">That looks tremendously better, thanks!

So follow up question - could this not be flagged? It seems like it would be beneficial to have a bit somewhere that tracks if apply_all_roles &#40;and maybe ensure_all_roles too&#41; was called, and die with an appropriate error if called more than once. That would cover my case with multiple with calls as well as anyone who is doing dynamic Role addition to individual classes &#40;I think?&#41; which would also be at risk for this masking behavior.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Dave Rolsky via RT [mailto:bug-Moose@rt.cpan.org] 
Sent: Monday, September 12, 2016 10:46
To: Pansino, Thomas &lt;thomas.pansino@intel.com&gt;
Subject: [rt.cpan.org #117325] Nested roles not flagging conflicts

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=117325">https://rt.cpan.org/Ticket/Display.html?id=117325</a></span> &gt;

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/moose/Moose/pull/133">https://github.com/moose/Moose/pull/133</a></span>
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1668297" href="/Public/Bug/Display.html?id=117325#txn-1668297">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;12&nbsp;14:12:33&nbsp;2016</span>
    <span class="description">DROLSKY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1668297/895323/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/895323">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 956b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2016-09-12 13:09:54, thomas.pansino@intel.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; That looks tremendously better, thanks!
&gt; 
&gt; So follow up question - could this not be flagged? It seems like it
&gt; would be beneficial to have a bit somewhere that tracks if
&gt; apply_all_roles &#40;and maybe ensure_all_roles too&#41; was called, and die
&gt; with an appropriate error if called more than once. That would cover
&gt; my case with multiple with calls as well as anyone who is doing
&gt; dynamic Role addition to individual classes &#40;I think?&#41; which would
&gt; also be at risk for this masking behavior.
</div>
There are valid &#40;corner&#41; use cases for calling &#34;with&#34; more than once because of various limitations in how roles work.

But generally speaking, unless you encounter such a case you should consume all your roles in one shot. To do what you&#39;re suggesting would require roles to work more like a compile-time thing, which would be very hard to do in Perl 5 as it stands now. But Perl 6 gets this right ;&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1668300" href="/Public/Bug/Display.html?id=117325#txn-1668300">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;12&nbsp;14:29:55&nbsp;2016</span>
    <span class="description">thomas.pansino [...] intel.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #117325] Nested roles not flagging conflicts</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 12 Sep 2016 18:29:38 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Moose [...] rt.cpan.org&#34; &lt;bug-Moose [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Pansino, Thomas&#34; &lt;thomas.pansino [...] intel.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1668300/895326/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/895326">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There are valid &#40;corner&#41; use cases for calling &#34;with&#34; more than once because of various limitations in how roles work.
</div>Of course, it always breaks somebody ;&#41;

I guess what I&#39;m more concerned with is Moose silently retaining the first sub definition despite other definitions being applied in later roles. It seems to go against Moose&#39;s mantra of requiring conflicts be explicitly resolved by the developer, which to me is one of the big safety features here. The documentation update will at least keep people on the fairway now and out of the rough patch I was in, but I think if the intention is to flag any duplicate definitions in roles, then this should be a case where it flags too.

Thoughts? Thanks for all that you do btw, really appreciate your contributions as a whole.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Dave Rolsky via RT [mailto:bug-Moose@rt.cpan.org] 
Sent: Monday, September 12, 2016 11:13
To: Pansino, Thomas &lt;thomas.pansino@intel.com&gt;
Subject: [rt.cpan.org #117325] Nested roles not flagging conflicts

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=117325">https://rt.cpan.org/Ticket/Display.html?id=117325</a></span> &gt;

On 2016-09-12 13:09:54, thomas.pansino@intel.com wrote:
<div class="message-stanza open">&gt; That looks tremendously better, thanks!
&gt; 
&gt; So follow up question - could this not be flagged? It seems like it 
&gt; would be beneficial to have a bit somewhere that tracks if 
&gt; apply_all_roles &#40;and maybe ensure_all_roles too&#41; was called, and die 
&gt; with an appropriate error if called more than once. That would cover 
&gt; my case with multiple with calls as well as anyone who is doing 
&gt; dynamic Role addition to individual classes &#40;I think?&#41; which would 
&gt; also be at risk for this masking behavior.
</div>
There are valid &#40;corner&#41; use cases for calling &#34;with&#34; more than once because of various limitations in how roles work.

But generally speaking, unless you encounter such a case you should consume all your roles in one shot. To do what you&#39;re suggesting would require roles to work more like a compile-time thing, which would be very hard to do in Perl 5 as it stands now. But Perl 6 gets this right ;&#41;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1668302" href="/Public/Bug/Display.html?id=117325#txn-1668302">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;12&nbsp;14:42:00&nbsp;2016</span>
    <span class="description">DROLSKY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1668302/895328/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/895328">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2016-09-12 13:29:55, thomas.pansino@intel.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; There are valid &#40;corner&#41; use cases for calling &#34;with&#34; more than once
&gt; &gt; because of various limitations in how roles work.
</div>&gt; Of course, it always breaks somebody ;&#41;
&gt; 
&gt; I guess what I&#39;m more concerned with is Moose silently retaining the
&gt; first sub definition despite other definitions being applied in later
&gt; roles. It seems to go against Moose&#39;s mantra of requiring conflicts be
&gt; explicitly resolved by the developer, which to me is one of the big
&gt; safety features here. The documentation update will at least keep
&gt; people on the fairway now and out of the rough patch I was in, but I
&gt; think if the intention is to flag any duplicate definitions in roles,
&gt; then this should be a case where it flags too.
&gt; 
&gt; Thoughts? Thanks for all that you do btw, really appreciate your
&gt; contributions as a whole.
</div>
Patches welcome, but this could be really challenging. Keep in mind that when a class consumes a role with a method of the same name, it is _intentional_ that the class&#39;s version silently wins. This allow classes to override roles, which is a feature.

In the two-with situation, the second with sees the methods from the first role as being part of the class, not as being role methods. Now we _do_ keep track of where methods came from, so in theory we could check that and die, _but_ there are all sorts of corner cases I could imagine here. Only dying when necessary while still allowing meta-fun trickery could range from difficult to impossible.

That said, it has _always_ been the intention that you only call with just once, which is why I was so surprised it wasn&#39;t mentioned in the docs. It&#39;s been &#34;common&#34; knowledge among Moose users for a really long time, but obviously explicit is better.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1668775" href="/Public/Bug/Display.html?id=117325#txn-1668775">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;13&nbsp;17:07:38&nbsp;2016</span>
    <span class="description">thomas.pansino [...] intel.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #117325] Nested roles not flagging conflicts</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 13 Sep 2016 21:07:17 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Moose [...] rt.cpan.org&#34; &lt;bug-Moose [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Pansino, Thomas&#34; &lt;thomas.pansino [...] intel.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1668775/895574/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/895574">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Keep in mind that when a class consumes a role with a method of the same name, it is _intentional_ that the class&#39;s version silently wins.
</div>Right, but actually I originally expected that the second role would override methods from the first role, kind of like how inheritance works. I think that was where I went wrong - treating roles like they would inherit, which is why having a safeguard to flag if someone _else_ tries to do that would be useful I think. But I&#39;m not familiar enough with Moose internals to pull that off yet, and you all are busy doing other things, so documentation is probably enough for now. If I ever decide to go after this I&#39;ll reach out to you, get a feel for some of those corner cases you&#39;re thinking of that I might not know about.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It&#39;s been &#34;common&#34; knowledge among Moose users for a really long time, but obviously explicit is better.
</div>
I think that was the missing part - I don&#39;t know many other Moose users and am just getting into using Moose heavily on a project. The documentation so far has been excellent, kudos to you all for that, it just needed that missing part.

Thanks!


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Dave Rolsky via RT [mailto:bug-Moose@rt.cpan.org] 
Sent: Monday, September 12, 2016 11:42
To: Pansino, Thomas &lt;thomas.pansino@intel.com&gt;
Subject: [rt.cpan.org #117325] Nested roles not flagging conflicts

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=117325">https://rt.cpan.org/Ticket/Display.html?id=117325</a></span> &gt;

On 2016-09-12 13:29:55, thomas.pansino@intel.com wrote:
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; There are valid &#40;corner&#41; use cases for calling &#34;with&#34; more than once 
&gt; &gt; because of various limitations in how roles work.
</div>&gt; Of course, it always breaks somebody ;&#41;
&gt; 
&gt; I guess what I&#39;m more concerned with is Moose silently retaining the 
&gt; first sub definition despite other definitions being applied in later 
&gt; roles. It seems to go against Moose&#39;s mantra of requiring conflicts be 
&gt; explicitly resolved by the developer, which to me is one of the big 
&gt; safety features here. The documentation update will at least keep 
&gt; people on the fairway now and out of the rough patch I was in, but I 
&gt; think if the intention is to flag any duplicate definitions in roles, 
&gt; then this should be a case where it flags too.
&gt; 
&gt; Thoughts? Thanks for all that you do btw, really appreciate your 
&gt; contributions as a whole.
</div>
Patches welcome, but this could be really challenging. Keep in mind that when a class consumes a role with a method of the same name, it is _intentional_ that the class&#39;s version silently wins. This allow classes to override roles, which is a feature.

In the two-with situation, the second with sees the methods from the first role as being part of the class, not as being role methods. Now we _do_ keep track of where methods came from, so in theory we could check that and die, _but_ there are all sorts of corner cases I could imagine here. Only dying when necessary while still allowing meta-fun trickery could range from difficult to impossible.

That said, it has _always_ been the intention that you only call with just once, which is why I was so surprised it wasn&#39;t mentioned in the docs. It&#39;s been &#34;common&#34; knowledge among Moose users for a really long time, but obviously explicit is better.

</div></div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.611758</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
