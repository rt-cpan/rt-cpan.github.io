<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #4597 for Net-SSH-Perl: Net::SSH::Perl not working from cron</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #4597 for Net-SSH-Perl: Net::SSH::Perl not working from cron</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Net-SSH-Perl">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Net-SSH-Perl">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Net-SSH-Perl">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Net-SSH-Perl">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-SSH-Perl">Net-SSH-Perl CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">4597</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Net-SSH-Perl">Net-SSH-Perl</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
peter [...] adpm.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-23272-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
1.23</li>
<li>
1.24</li>
</ul>
    </td>
  </tr>
  <tr id="CF-23273-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=4597">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-93047" href="/Public/Bug/Display.html?id=4597#txn-93047">#</a>      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;06&nbsp;16:53:25&nbsp;2003</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Net::SSH::Perl not working from cron</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/93047/14201/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/14201">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 7.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have a problem with Net::SFTP / Net::SSH::Perl &#40;both the old and the current versions&#41; on Perl 5.6.0 and Linux 2.4.x

The attached program sftptest.pl tries to connect to a server and do a simple &#39;ls&#39; there.
It works absolutely flawlessly when run interactively by a regular user, but when the very same user tries to run it from cron he does not get any answers from the server.
Another strange behaviour: when root tries to run the program from cron it works as expected.

It happens on three machines with similar &#40;but not identical&#41; setup.
 
The attached files sftptest-interactive.log and sftptest-via-cron.log show the differences.
They result from a shell script that calls sftptest.pl after setting all environment variables to the values from the cron environment.
Somehow the connection seems to get closed at about the time when SSH2_FXP_INIT gets sent.

Can you give me any hint or clue how to make Net::SFTP run from cron too ?

I&#39;d really love to use Net::SFTP instead of doing some dirty tricks with Expect or calling the sftp program directly.

Thanks in advance for your help
Peter Marschall


---- sftptest.pl ----
#!/usr/bin/perl -w

use Net::SFTP;
use strict;

my $server = $ARGV[0] || &#39;&#39;;
my $user = $ARGV[1] || &#39;&#39;;
my $password = $ARGV[2] || &#39;&#39;;
my $dir = $ARGV[3] || &#39;&#39;;

my @result = &#40;&#41;;

print STDERR &#34;Environment:\n&#34;;
map { print STDERR &#34;\t$_ = $ENV{$_}\n&#34;; } keys&#40;%ENV&#41;;

print STDERR &#34;Specials:\n&#34;;
print STDERR &#34;\t\$\$ = &#34;. &#40;defined&#40;$$&#41; ? $$ : &#39;&lt;undef&gt;&#39;&#41; .&#34;\n&#34;;
print STDERR &#34;\t\$\&lt; = &#34;. &#40;defined&#40;$&lt;&#41; ? $&lt; : &#39;&lt;undef&gt;&#39;&#41; .&#34;\n&#34;;
print STDERR &#34;\t\$\&gt; = &#34;. &#40;defined&#40;$&gt;&#41; ? $&gt; : &#39;&lt;undef&gt;&#39;&#41; .&#34;\n&#34;;
print STDERR &#34;\t\$\/ = &#34;. &#40;defined&#40;$/&#41; ? $/ : &#39;&lt;undef&gt;&#39;&#41; .&#34;\n&#34;;
print STDERR &#34;\t\$\\ = &#34;. &#40;defined&#40;$\&#41; ? $\ : &#39;&lt;undef&gt;&#39;&#41; .&#34;\n&#34;;
print STDERR &#34;\t\$\~ = &#34;. &#40;defined&#40;$~&#41; ? $~ : &#39;&lt;undef&gt;&#39;&#41; .&#34;\n&#34;;
print STDERR &#34;\t\$\% = &#34;. &#40;defined&#40;$%&#41; ? $% : &#39;&lt;undef&gt;&#39;&#41; .&#34;\n&#34;;
print STDERR &#34;\t\$\= = &#34;. &#40;defined&#40;$=&#41; ? $= : &#39;&lt;undef&gt;&#39;&#41; .&#34;\n&#34;;
print STDERR &#34;\t\$\- = &#34;. &#40;defined&#40;$-&#41; ? $- : &#39;&lt;undef&gt;&#39;&#41; .&#34;\n&#34;;
print STDERR &#34;\t\$\, = &#34;. &#40;defined&#40;$,&#41; ? $, : &#39;&lt;undef&gt;&#39;&#41; .&#34;\n&#34;;
print STDERR &#34;\t\$\| = &#34;. &#40;defined&#40;$|&#41; ? $| : &#39;&lt;undef&gt;&#39;&#41; .&#34;\n&#34;;
print STDERR &#34;\t\$\! = &#34;. &#40;defined&#40;$!&#41; ? $! : &#39;&lt;undef&gt;&#39;&#41; .&#34;\n&#34;;
print STDERR &#34;\t\$\? = &#34;. &#40;defined&#40;$?&#41; ? $? : &#39;&lt;undef&gt;&#39;&#41; .&#34;\n&#34;;

my $sftp = Net::SFTP-&gt;new&#40;$server,
                          user =&gt; $user || &#39;&#39;,
                          password =&gt; $password || &#39;&#39;,
                          debug =&gt; 1&#41;
    or  die &#34;error creating SFTP object: $@&#34;;

die &#34;ls: $@&#34;
  if &#40;!defined&#40;eval { @result = $sftp-&gt;ls&#40;$dir&#41; }&#41;&#41;;

print STDERR &#34;Files:\n&#34;;
map { print STDERR &#34;\t&#34;.$_-&gt;{filename}.&#34;\n&#34;; } @result;

# EOF


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">----- results from interactive run ----
Environment:
        _ = /usr/local/src/Meta/test/sftptest.pl
        HOSTTYPE = i386
        HOME = /home/metaconn
        SHLVL = 1
        OSTYPE = linux
        TERM = dumb
        PWD = /home/metaconn
        HOSTNAME = lx0042
        MACHTYPE = i386-suse-linux
        LOGNAME = metaconn
        PATH = /usr/bin:/bin
        SHELL = /bin/sh
Specials:
        $$ = 22827
        $&lt; = 500
        $&gt; = 500
        $/ = 

        $\ = &lt;undef&gt;
        $~ = STDOUT
        $% = 0
        $= = 60
        $- = 0
        $, = &lt;undef&gt;
        $| = 0
        $! = 
        $? = 0
lx0042: Reading configuration data /home/metaconn/.ssh/config
lx0042: Reading configuration data /etc/ssh_config
lx0042: Connecting to sl00028.weimar.teagnetkom.de, port 22.
lx0042: Remote protocol version 1.99, remote software version OpenSSH_3.5p1
lx0042: Net::SSH::Perl Version 1.24, protocol version 2.0.
lx0042: No compat match: OpenSSH_3.5p1.
lx0042: Connection established.
lx0042: Sent key-exchange init &#40;KEXINIT&#41;, wait response.
lx0042: Algorithms, c-&gt;s: 3des-cbc hmac-sha1 none
lx0042: Algorithms, s-&gt;c: 3des-cbc hmac-sha1 none
lx0042: Entering Diffie-Hellman Group 1 key exchange.
lx0042: Sent DH public key, waiting for reply.
lx0042: Received host key, type &#39;ssh-dss&#39;.
lx0042: Host &#39;sl00028.weimar.teagnetkom.de&#39; is known and matches the host key.
lx0042: Computing shared secret key.
lx0042: Verifying server signature.
lx0042: Waiting for NEWKEYS message.
lx0042: Enabling incoming encryption/MAC/compression.
lx0042: Send NEWKEYS, enable outgoing encryption/MAC/compression.
lx0042: Sending request for user-authentication service.
lx0042: Service accepted: ssh-userauth.
lx0042: Trying empty user-authentication request.
lx0042: Authentication methods that can continue: publickey,password.
lx0042: Next method to try is publickey.
lx0042: Next method to try is password.
lx0042: Trying password authentication.
lx0042: Login completed, opening dummy shell channel.
lx0042: channel 0: new [client-session]
lx0042: Requesting channel_open for channel 0.
lx0042: channel 0: open confirm rwindow 0 rmax 32768
lx0042: Got channel open confirmation, requesting shell.
lx0042: Requesting service shell on channel 0.
lx0042: channel 1: new [client-session]
lx0042: Requesting channel_open for channel 1.
lx0042: Sending subsystem: sftp
lx0042: Requesting service subsystem on channel 1.
lx0042: channel 1: open confirm rwindow 0 rmax 32768
lx0042: sftp: Sending SSH2_FXP_INIT
lx0042: sftp: Remote version: 3
lx0042: sftp: Sent message T:11 I:0
lx0042: sftp: Sent message T:12 I:1
lx0042: sftp: Received reply T:104 I:1
lx0042: sftp: Received 30 SSH2_FXP_NAME responses
lx0042: sftp: Sent message T:12 I:2
lx0042: sftp: Received reply T:101 I:2
lx0042: sftp: Received SSH2_FXP_STATUS 1
lx0042: sftp: Sent message T:4 I:3
Files:
        .
        ..
        dms_mobil_031023223033.txt
        dms_mobil_031022152659.txt
        dms_mobil_031022223035.txt
        dms_mobil_031024223039.txt
        dms_mobil_031027223039.txt

<div class="message-stanza open">----- results from run under cron -----
Environment:
        _ = /usr/local/src/Meta/test/sftptest.pl
        HOSTTYPE = i386
        HOME = /home/metaconn
        SHLVL = 1
        OSTYPE = linux
        TERM = dumb
        PWD = /home/metaconn
        HOSTNAME = lx0042
        MACHTYPE = i386-suse-linux
        LOGNAME = metaconn
        PATH = /usr/bin:/bin
        SHELL = /bin/sh
Specials:
        $$ = 22796
        $&lt; = 500
        $&gt; = 500
        $/ = 

        $\ = &lt;undef&gt;
        $~ = STDOUT
        $% = 0
        $= = 60
        $- = 0
        $, = &lt;undef&gt;
        $| = 0
        $! = 
        $? = 0
lx0042: Reading configuration data /home/metaconn/.ssh/config
lx0042: Reading configuration data /etc/ssh_config
lx0042: Connecting to sl00028.weimar.teagnetkom.de, port 22.
lx0042: Remote protocol version 1.99, remote software version OpenSSH_3.5p1
lx0042: Net::SSH::Perl Version 1.24, protocol version 2.0.
lx0042: No compat match: OpenSSH_3.5p1.
lx0042: Connection established.
lx0042: Sent key-exchange init &#40;KEXINIT&#41;, wait response.
lx0042: Algorithms, c-&gt;s: 3des-cbc hmac-sha1 none
lx0042: Algorithms, s-&gt;c: 3des-cbc hmac-sha1 none
lx0042: Entering Diffie-Hellman Group 1 key exchange.
lx0042: Sent DH public key, waiting for reply.
lx0042: Received host key, type &#39;ssh-dss&#39;.
lx0042: Host &#39;sl00028.weimar.teagnetkom.de&#39; is known and matches the host key.
lx0042: Computing shared secret key.
lx0042: Verifying server signature.
lx0042: Waiting for NEWKEYS message.
lx0042: Enabling incoming encryption/MAC/compression.
lx0042: Send NEWKEYS, enable outgoing encryption/MAC/compression.
lx0042: Sending request for user-authentication service.
lx0042: Service accepted: ssh-userauth.
lx0042: Trying empty user-authentication request.
lx0042: Authentication methods that can continue: publickey,password.
lx0042: Next method to try is publickey.
lx0042: Next method to try is password.
lx0042: Trying password authentication.
lx0042: Login completed, opening dummy shell channel.
lx0042: channel 0: new [client-session]
lx0042: Requesting channel_open for channel 0.
lx0042: channel 0: open confirm rwindow 0 rmax 32768
lx0042: Got channel open confirmation, requesting shell.
lx0042: Requesting service shell on channel 0.
lx0042: channel 1: new [client-session]
lx0042: Requesting channel_open for channel 1.
lx0042: Sending subsystem: sftp
lx0042: Requesting service subsystem on channel 1.
lx0042: channel 1: open confirm rwindow 0 rmax 32768
lx0042: sftp: Sending SSH2_FXP_INIT
Use of uninitialized value in numeric eq &#40;==&#41; at /usr/lib/perl5/site_perl/5.6.0/Net/SSH/Perl/SSH2.pm line 309.
Connection closed at /usr/local/src/Meta/test/sftptest.pl line 31
</div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-93048" href="/Public/Bug/Display.html?id=4597#txn-93048">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;11&nbsp;19:26:29&nbsp;2004</span>
    <span class="description">DROLSKY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/93048/16149/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/16149">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 763b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The attached program sftptest.pl tries to connect to a server and do a
&gt;    simple &#39;ls&#39; there.
&gt; It works absolutely flawlessly when run interactively by a regular
&gt;    user, but when the very same user tries to run it from cron he does
&gt;    not get any answers from the server.
&gt; Another strange behaviour: when root tries to run the program from
&gt;    cron it works as expected.
&gt; 
&gt; It happens on three machines with similar &#40;but not identical&#41; setup.
</div>
When something doesn&#39;t work from cron that usually means that there&#39;s a
difference in the environment the code is being run under.

For some reason, Net::SSH::Perl is looking at the TERM env var, so you
could try setting that to the same thing as when it&#39;s run manually, and
see if that makes a difference.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-93049" href="/Public/Bug/Display.html?id=4597#txn-93049">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;05&nbsp;11:21:49&nbsp;2004</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> peter [...] adpm.de</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/93049/16950/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/16950">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 796b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[DROLSKY - Wed Feb 11 19:26:29 2004]: 
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; When something doesn&#39;t work from cron that usually means that there&#39;s 
</div>a 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; difference in the environment the code is being run under. 
&gt;  
&gt; For some reason, Net::SSH::Perl is looking at the TERM env var, so 
</div>you 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; could try setting that to the same thing as when it&#39;s run manually, 
</div>and 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; see if that makes a difference. 
</div> 
I did this already. 
 
The original bug report contains a test script that prints the 
environment as well as some other Perl variables and then performs the 
connection test. 
Also in the bug report are the results of an interactive run and a run 
from cron. 
In both cases TERM is set as well as HOME which is another environment 
variable that Net::SSH::Perl might use. 
 
Result: same environment, different results. 
 
 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-93050" href="/Public/Bug/Display.html?id=4597#txn-93050">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;06&nbsp;03:11:22&nbsp;2004</span>
    <span class="description">autarch [...] urth.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 6 Mar 2004 02:11:14 -0600 &#40;CST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dave Rolsky &lt;autarch [...] urth.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Guest via RT &lt;bug-Net-SSH-Perl [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #4597] Net::SSH::Perl not working from cron </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-Cc:</td>
    <td class="message-header-value"> </td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/93050/16959/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/16959">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 983b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, 5 Mar 2004, Guest via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I did this already.
&gt;  The original bug report contains a test script that prints the
&gt; environment as well as some other Perl variables and then performs the
&gt; connection test.  Also in the bug report are the results of an
&gt; interactive run and a run from cron.  In both cases TERM is set as well
&gt; as HOME which is another environment variable that Net::SSH::Perl might
&gt; use.
&gt;
&gt; Result: same environment, different results.
</div>
Well, _something_ in the environment must be different!  It&#39;s not like the
code is designed to _not_ work when run as a cron job.  I don&#39;t know what
else to suggest looking at, though.  Debugging these sorts of problems can
be incredibly painful.  Maybe try running it via strace through cron and
looking a the trace.  It&#39;s a trace of C-level calls, but it might help you
find where things break down.


-dave

/*=======================
House Absolute Consulting
www.houseabsolute.com
=======================*/
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-93051" href="/Public/Bug/Display.html?id=4597#txn-93051">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;15&nbsp;13:24:26&nbsp;2004</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> peter [...] adpm.de</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/93051/17257/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/17257">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi, 
 
[autarch@urth.org - Sat Mar  6 03:11:22 2004]: 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Well, _something_ in the environment must be different!  It&#39;s not 
</div>like the 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; code is designed to _not_ work when run as a cron job.  I don&#39;t know 
</div>what 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; else to suggest looking at, though.  Debugging these sorts of 
</div>problems can 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; be incredibly painful.  Maybe try running it via strace through cron 
</div>and 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; looking a the trace.  It&#39;s a trace of C-level calls, but it might 
</div>help you 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; find where things break down. 
</div> 
I strace&#39;d the two alternatives and found only one difference in the 
runtime environment &#40;the %ENV environment was definitively the same&#41;: 
The version in cron had one file descriptor more open &#40;although I was 
not able to determine which one&#41;. 
 
Then I played around a bit with input and output redirection and found 
the solution: 
     open&#40;STDIN, &#39;&lt;&#39;,&#39;/dev/null&#39;&#41;; 
just before the Net::SFTP Constructor did the trick. 
 
But IMHO this is only a workaround &#40;aka. dirty hack&#41; to a bug in 
Net::SSH::Perl / Net::SFTP that expects STDIN to be open. 
It seems to be closed in cron and that made my script fail. 
 
Maybe you can find a better solution than this crude workaround that 
takes care whether STDIO is open, ... 
 
Hope this helped 
Peter 
 
Peter 
 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-93052" href="/Public/Bug/Display.html?id=4597#txn-93052">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;15&nbsp;13:39:24&nbsp;2004</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> peter [...] adpm.de</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/93052/17258/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/17258">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 298b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi, 
 
Too mauch trust in the Perl documentation &#40;man perlfunc: close&#41; 
 
Instead of a simple 
      open&#40;STDIN, &#39;&lt;&#39;,&#39;/dev/null&#39;&#41;;  
you need 
      close&#40;STDIN&#41;; 
      open&#40;STDIN, &#39;&lt;&#39;,&#39;/dev/null&#39;&#41;; 
to make it work in cron. 
 
Is it possible the problem has something to do with $. ? 
 
Peter  
 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-93053" href="/Public/Bug/Display.html?id=4597#txn-93053">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;15&nbsp;15:53:26&nbsp;2004</span>
    <span class="description">autarch [...] urth.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 15 Mar 2004 14:53:13 -0600 &#40;CST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dave Rolsky &lt;autarch [...] urth.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Guest via RT &lt;bug-Net-SSH-Perl [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #4597] Net::SSH::Perl not working from cron </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-Cc:</td>
    <td class="message-header-value"> </td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/93053/17263/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/17263">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 782b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, 15 Mar 2004, Guest via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Then I played around a bit with input and output redirection and found
&gt; the solution:
&gt;      open&#40;STDIN, &#39;&lt;&#39;,&#39;/dev/null&#39;&#41;;
&gt; just before the Net::SFTP Constructor did the trick.
&gt;
&gt; But IMHO this is only a workaround &#40;aka. dirty hack&#41; to a bug in
&gt; Net::SSH::Perl / Net::SFTP that expects STDIN to be open.
&gt; It seems to be closed in cron and that made my script fail.
&gt;
&gt; Maybe you can find a better solution than this crude workaround that
&gt; takes care whether STDIO is open, ...
</div>
For some reason the code dups STDIN, STDOUT, and STDERR when the cmd,
open2, or shell methods are called.  Why does it do this?  I have no clue.


-dave

/*=======================
House Absolute Consulting
www.houseabsolute.com
=======================*/
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-159708" href="/Public/Bug/Display.html?id=4597#txn-159708">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;27&nbsp;22:17:40&nbsp;2006</span>
    <span class="description">dbrobins [...] cpan.org -  Status changed from &#39;new&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.425015</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
