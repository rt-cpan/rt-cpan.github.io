<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #9045 for DBIx-XHTML_Table: Problem with column names when using style_3 constructor.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #9045 for DBIx-XHTML_Table: Problem with column names when using style_3 constructor.</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DBIx-XHTML_Table/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DBIx-XHTML_Table/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DBIx-XHTML_Table/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DBIx-XHTML_Table/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBIx-XHTML_Table">DBIx-XHTML_Table CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">9045</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DBIx-XHTML_Table/Active/">DBIx-XHTML_Table</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ema.zep [...] libero.it

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10770-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10771-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;20&nbsp;12:19:14&nbsp;2004</span>
    <span class="description">ema.zep [...] libero.it -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Emanuele Zeppieri&#34; &lt;ema.zep [...] libero.it&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-DBIx-XHTML_Table [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Problem with column names when using style_3 constructor.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 20 Dec 2004 18:03:03 +0100</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dear Jeffrey,

first of all congratulation and thanks for your excellent
DBIx::XHTML_Table distribution and for its wonderful documentation as
well.

It seems to have an annoying problem though: when I use the style_3
constructor, that is the constructor which does not use any DBI method:

$obj_ref = new DBIx::XHTML_Table&#40;$rows, $headers&#41;

&#40;note that I&#39;m correctly passing the column names via the array ref
$headers here,&#41; then both the column names and their index numbers seem
not to work anymore, so that if I try to reference them in the modify
method like this:

$table-&gt;modify&#40;
        td =&gt; {
                style =&gt; &#39;text-align: right&#39;
        },
        [1, 2]
&#41;;

or like this:

$table-&gt;modify&#40;
        td =&gt; {
                style =&gt; &#39;text-align: right&#39;
        },
        [&#39;first_col&#39;, &#39;second_col&#39;]
&#41;;

modify is simply ignored, and no style is applied to the table anywhere.

It works perfectly instead if I use the style_1 or the style_2
constructors.

Cheers and thanks again for your invaluable work!

Emanuele Zeppieri.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;21&nbsp;11:12:54&nbsp;2004</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Emanuele Zeppieri</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[ema.zep@libero.it - Mon Dec 20 12:19:14 2004]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It seems to have an annoying problem though...
</div>
I forgot to specify:

- Module: DBIx-XHTML_Table-1.36;
- Perl: ActivePerl 5.8.4.810;
- OS: Win XP Pro SP2.

Emanuele Zeppieri.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;27&nbsp;20:17:43&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> tshinnic [...] io.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[guest - Tue Dec 21 11:12:54 2004]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It seems to have an annoying problem though: when I use the style_3
&gt; constructor, that is the constructor which does not use any DBI 
</div>method:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; $obj_ref = new DBIx::XHTML_Table&#40;$rows, $headers&#41;
</div>
One problem is that column names are expected to be in lowercase 
throughout the code, but that the &#34;style 3 plus headers&#34; constructor 
allows mixed-case column names to slip through.

DBIx::XHTML_Table 1.36 line 709 reads thusly:
    $self-&gt;{&#39;fields_arry&#39;} = $headers ? [@$headers] : [ map { lc } @{ 
shift @$ref } ];

Note that this line handles both the case where the headers are 
supplied separately or as the first record in the first argument.  But 
note also that while the column names are explicitly lowercased when 
supplied in the first record, nothing is done to names supplied by the 
second argument array.

This causes a number of problems later, as other calls &#40;e.g. modify&#40;&#41; 
at line 120&#41; expect lowercase names in order to match columns, even 
when the match argument is a column number!

The user workaround is to force column names in the headers array to 
lowercase before calling the constructor.  Then using column numbers 
will work, and using the lowercase column name match arguments will 
work.

Of course, the _other_ part of the workaround is to &#39;restore&#39; the 
original mixed-case column names when displaying the table.  You can 
do this using the map_head&#40;&#41; feature.  Something like &#40;untested - I do 
it another way&#41;:

  my @db_col_names = &#40; &#39;Date/Time&#39;, &#39;I/O&#39;, &#39;Filename&#39; &#41;;
  my @db_col_names_lc  = map { lc } @db_col_names;
  my %lc_to_display = map { lc $_ , $_ } @db_col_names;

  $table = new DBIx::XHTML_Table&#40;$rows, \@db_col_names_lc&#41;;
  $table-&gt;map_head&#40; sub { $lc_to_display{+shift} } &#41;;


Note that all this somewhat relates to bug#6962
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;06&nbsp;22:53:21&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Emanuele Zeppieri</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The workaround you suggested works fine.
Thanks!

Emanuele.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;16&nbsp;18:54:16&nbsp;2015</span>
    <span class="description">JEFFA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I was unable to recreate this problem. &#40;see attached test&#41;

Perhaps you passed a reference to your data and were unaware that DBIx::XHTML_Table will remove the first row. Pass a copy instead if this is the case.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> bug-9045.t</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!perl -T
use strict;
use warnings FATAL =&gt; &#39;all&#39;;
use DBIx::XHTML_Table;
use Test::More tests =&gt; 4;

my @data = &#40;
    [qw&#40;first_col SECOND_COL ThiRD_Col&#41;],
    [qw&#40;one two three&#41;],
    [qw&#40;four five six&#41;],
&#41;;
my $expected = &#39;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;First_col&lt;/th&gt;&lt;th&gt;Second_col&lt;/th&gt;&lt;th&gt;Third_col&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td foo=&#34;bar&#34;&gt;one&lt;/td&gt;&lt;td foo=&#34;bar&#34;&gt;two&lt;/td&gt;&lt;td&gt;three&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td foo=&#34;bar&#34;&gt;four&lt;/td&gt;&lt;td foo=&#34;bar&#34;&gt;five&lt;/td&gt;&lt;td&gt;six&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&#39;;

{
    my $table = new_ok &#39;DBIx::XHTML_Table&#39;, [ [@data] ];
    $table-&gt;modify&#40; td =&gt; { foo =&gt; &#39;bar&#39; }, [ 0, 1 ] &#41;;
    is $table-&gt;output&#40; { no_indent =&gt; 1 } &#41;, $expected, &#34;indices work&#34;;
}

{
    my $table = new_ok &#39;DBIx::XHTML_Table&#39;, [ [@data] ];
    $table-&gt;modify&#40; td =&gt; { foo =&gt; &#39;bar&#39; }, [qw&#40; first_col second_col &#41;] &#41;;
    is $table-&gt;output&#40; { no_indent =&gt; 1 } &#41;, $expected, &#34;names work&#34;;
}

__DATA__
9045 Problem with column names when using style_3 constructor.
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;16&nbsp;18:54:17&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;16&nbsp;18:54:18&nbsp;2015</span>
    <span class="description">JEFFA [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;18&nbsp;12:48:54&nbsp;2015</span>
    <span class="description">ema.zep [...] libero.it -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #9045] Problem with column names when using style_3 constructor.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 18 May 2015 18:48:32 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-XHTML_Table [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Emanuele Zeppieri &lt;ema.zep [...] libero.it&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 05/17/2015 12:54 AM, Jeffrey Hayes Anderson via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=9045">https://rt.cpan.org/Ticket/Display.html?id=9045</a></span> &gt;
&gt; 
&gt; I was unable to recreate this problem. &#40;see attached test&#41;
&gt; 
&gt; Perhaps you passed a reference to your data and were unaware that DBIx::XHTML_Table will remove the first row. Pass a copy instead if this is the case.
&gt; 
</div>
Hi!

The problem still persists: the original report was too broad in
affirming that it &#40;always&#41; happened with the &#34;style_3 constructor&#34;;
really, it happens with the style_3 constructor *only* when the $headers
parameter is provided as well, that is &#40;only&#41; when the constructor is
invoked this way:

my $table = new DBIx::XHTML_Table&#40;$rows, $headers&#41;;

I&#39;ve attached a slightly modified version of your test which indeed
still fails &#40;both because the table headers don&#39;t match and because the
apply method don&#39;t work on &#34;SECOND_COL&#34;, not even through the indices&#41;,
and also the patch to correct the problem.

About the provided patch.

I&#39;ve tried to patch the code in the way that most closely adheres to the
documentation, that is, the table headers are rendered in the exact same
way in both the following cases:

my $table = new DBIx::XHTML_Table&#40;$rows&#41;;

and

my $table = new DBIx::XHTML_Table&#40;$rows, $headers&#41;;

as the docs don&#39;t say anything about a difference in the rendering of
the headers in the two cases. And this also solves the problem of the
modify method that could not be applied in some cases.

However I can understand that this could be a non retrofitting change,
since some people could rely on the &#40;undocumented&#41; fact that with the
second constructor the headers were left intact &#40;not case-normalized&#41;,
and live with the subsequent modify method malfunction nonetheless.

It&#39;s up to you to decide...

Thank you
-Emanuele
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;18&nbsp;13:00:43&nbsp;2015</span>
    <span class="description">JEFFA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you. I&#39;ll look into this some more. The patch looks appealing because less code is always better &#40;if it fixes the issues&#41;. What i really need is some test data so that i can recreate this bug.

On Mon May 18 12:48:54 2015, ema.zep@libero.it wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 05/17/2015 12:54 AM, Jeffrey Hayes Anderson via RT wrote:
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=9045">https://rt.cpan.org/Ticket/Display.html?id=9045</a></span> &gt;
&gt; &gt;
&gt; &gt; I was unable to recreate this problem. &#40;see attached test&#41;
&gt; &gt;
&gt; &gt; Perhaps you passed a reference to your data and were unaware that
&gt; &gt; DBIx::XHTML_Table will remove the first row. Pass a copy instead if
&gt; &gt; this is the case.
&gt; &gt;
</div>&gt; 
&gt; Hi!
&gt; 
&gt; The problem still persists: the original report was too broad in
&gt; affirming that it &#40;always&#41; happened with the &#34;style_3 constructor&#34;;
&gt; really, it happens with the style_3 constructor *only* when the
&gt; $headers
&gt; parameter is provided as well, that is &#40;only&#41; when the constructor is
&gt; invoked this way:
&gt; 
&gt; my $table = new DBIx::XHTML_Table&#40;$rows, $headers&#41;;
&gt; 
&gt; I&#39;ve attached a slightly modified version of your test which indeed
&gt; still fails &#40;both because the table headers don&#39;t match and because
&gt; the
&gt; apply method don&#39;t work on &#34;SECOND_COL&#34;, not even through the
&gt; indices&#41;,
&gt; and also the patch to correct the problem.
&gt; 
&gt; About the provided patch.
&gt; 
&gt; I&#39;ve tried to patch the code in the way that most closely adheres to
&gt; the
&gt; documentation, that is, the table headers are rendered in the exact
&gt; same
&gt; way in both the following cases:
&gt; 
&gt; my $table = new DBIx::XHTML_Table&#40;$rows&#41;;
&gt; 
&gt; and
&gt; 
&gt; my $table = new DBIx::XHTML_Table&#40;$rows, $headers&#41;;
&gt; 
&gt; as the docs don&#39;t say anything about a difference in the rendering of
&gt; the headers in the two cases. And this also solves the problem of the
&gt; modify method that could not be applied in some cases.
&gt; 
&gt; However I can understand that this could be a non retrofitting change,
&gt; since some people could rely on the &#40;undocumented&#41; fact that with the
&gt; second constructor the headers were left intact &#40;not case-normalized&#41;,
&gt; and live with the subsequent modify method malfunction nonetheless.
&gt; 
&gt; It&#39;s up to you to decide...
&gt; 
&gt; Thank you
&gt; -Emanuele
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;18&nbsp;13:12:54&nbsp;2015</span>
    <span class="description">ema.zep [...] libero.it -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #9045] Problem with column names when using style_3 constructor.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 18 May 2015 19:12:35 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-XHTML_Table [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Emanuele Zeppieri &lt;ema.zep [...] libero.it&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">A new test case is the one attached to my previous message.

Of course I&#39;ve verified that with my patch all the tests in your distro
&#40;including the above mentioned new one&#41; pass cleanly.

Thank you to you
-Emanuele

On 05/18/2015 07:00 PM, Jeffrey Hayes Anderson via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=9045">https://rt.cpan.org/Ticket/Display.html?id=9045</a></span> &gt;
&gt; 
&gt; Thank you. I&#39;ll look into this some more. The patch looks appealing because less code is always better &#40;if it fixes the issues&#41;. What i really need is some test data so that i can recreate this bug.
&gt; 
&gt; On Mon May 18 12:48:54 2015, ema.zep@libero.it wrote:
<div class="message-stanza open">&gt;&gt; On 05/17/2015 12:54 AM, Jeffrey Hayes Anderson via RT wrote:
<div class="message-stanza open">&gt;&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=9045">https://rt.cpan.org/Ticket/Display.html?id=9045</a></span> &gt;
&gt;&gt;&gt;
&gt;&gt;&gt; I was unable to recreate this problem. &#40;see attached test&#41;
&gt;&gt;&gt;
&gt;&gt;&gt; Perhaps you passed a reference to your data and were unaware that
&gt;&gt;&gt; DBIx::XHTML_Table will remove the first row. Pass a copy instead if
&gt;&gt;&gt; this is the case.
&gt;&gt;&gt;
</div>&gt;&gt;
&gt;&gt; Hi!
&gt;&gt;
&gt;&gt; The problem still persists: the original report was too broad in
&gt;&gt; affirming that it &#40;always&#41; happened with the &#34;style_3 constructor&#34;;
&gt;&gt; really, it happens with the style_3 constructor *only* when the
&gt;&gt; $headers
&gt;&gt; parameter is provided as well, that is &#40;only&#41; when the constructor is
&gt;&gt; invoked this way:
&gt;&gt;
&gt;&gt; my $table = new DBIx::XHTML_Table&#40;$rows, $headers&#41;;
&gt;&gt;
&gt;&gt; I&#39;ve attached a slightly modified version of your test which indeed
&gt;&gt; still fails &#40;both because the table headers don&#39;t match and because
&gt;&gt; the
&gt;&gt; apply method don&#39;t work on &#34;SECOND_COL&#34;, not even through the
&gt;&gt; indices&#41;,
&gt;&gt; and also the patch to correct the problem.
&gt;&gt;
&gt;&gt; About the provided patch.
&gt;&gt;
&gt;&gt; I&#39;ve tried to patch the code in the way that most closely adheres to
&gt;&gt; the
&gt;&gt; documentation, that is, the table headers are rendered in the exact
&gt;&gt; same
&gt;&gt; way in both the following cases:
&gt;&gt;
&gt;&gt; my $table = new DBIx::XHTML_Table&#40;$rows&#41;;
&gt;&gt;
&gt;&gt; and
&gt;&gt;
&gt;&gt; my $table = new DBIx::XHTML_Table&#40;$rows, $headers&#41;;
&gt;&gt;
&gt;&gt; as the docs don&#39;t say anything about a difference in the rendering of
&gt;&gt; the headers in the two cases. And this also solves the problem of the
&gt;&gt; modify method that could not be applied in some cases.
&gt;&gt;
&gt;&gt; However I can understand that this could be a non retrofitting change,
&gt;&gt; since some people could rely on the &#40;undocumented&#41; fact that with the
&gt;&gt; second constructor the headers were left intact &#40;not case-normalized&#41;,
&gt;&gt; and live with the subsequent modify method malfunction nonetheless.
&gt;&gt;
&gt;&gt; It&#39;s up to you to decide...
&gt;&gt;
&gt;&gt; Thank you
&gt;&gt; -Emanuele
</div>&gt; 
&gt; 
&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
