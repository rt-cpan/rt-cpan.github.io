<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #79846 for Digest-GOST: Digest::GOST and CryptoProParamSet</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #79846 for Digest-GOST: Digest::GOST and CryptoProParamSet</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Digest-GOST/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Digest-GOST/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Digest-GOST/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Digest-GOST/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Digest-GOST">Digest-GOST CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">79846</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Digest-GOST/Active/">Digest-GOST</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dhyan [...] nataraj.su

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-235816-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-235817-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;25&nbsp;08:10:41&nbsp;2012</span>
    <span class="description">dhyan [...] nataraj.su -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Dmitry Belyavsky &lt;beldmit [...] tcinet.ru&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Digest::GOST and CryptoProParamSet</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 25 Sep 2012 16:08:08 +0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Digest-GOST [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Nikolay Shaplov &lt;dhyan [...] nataraj.su&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi!

I am trying to use Digest::GOST to calculate DS record in DNSSEC. Calculating 
DS record using GOST is covered by <span class="clickylink"><a target="new" rel="nofollow" href="https://tools.ietf.org/html/rfc5933">https://tools.ietf.org/html/rfc5933</a></span> 

I take a calculating subroutine from Net::DNS::Sec, as it does calculation for 
other types of digest and applied it to the example in 4.1. if RFC 5933. See 
attached code.

The code gives wrong result. This happens because of RFC 5933 in section 4 
tells to use CryptoProParamSet GOST param set to calculate hash, and 
Digest::GOST seems to use  TestParamSet.

I applied a small hack-patch to src/gost.c: I&#39;ve added ctx-&gt;cryptpro = 1; to 
the gost_init function:

void gost_init&#40;gost_ctx *ctx&#41;
{
  memset&#40;ctx, 0, sizeof&#40;gost_ctx&#41;&#41;;
  ctx-&gt;cryptpro = 1;
}

After building Digest::GOST with this patch an example script from the 
attachment gives the same result as shown in RFC example.

So access to CryptoProParamSet is really needed in Digest::GOST: at least for 
patching Net::DNS::Sec to support GOST hashes out of box.

The question is what is the best way to do it. If you use TestParamSet by 
mistake, then may be if would be better not to use it. If you intentionally 
used  TestParamSet for some reason &#40;you may have one&#41;, then it would be very 
good to add support for both ParamSets in Digest::GOST. I can write and offer a 
patch for this, if you give me general recommendations about the 
implementation you expect to have.

Would be glad to here from you soon. :-&#41; We are currently using custom built 
module, with the hack above,  to calculating DS. It would be great to replace 
it with a standard module asap :-&#41;&#41;&#41;&#41;&#41; This will give me a chance to send a 
GOST patch Net::DNS::Sec as well :-&#41;
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl 
use strict;
use warnings;
use utf8;


use lib &#34;.&#34;;

use MIME::Base64;
use Digest::GOST::CryptoPro qw&#40;gost gost_hex gost_base64&#41;;
use Data::Dumper;


use Net::DNS::RR;
use Net::DNS::RR::DS;

=pod
An example from RFC 5933

      example.net. 86400   DNSKEY  257 3 12 &#40;
                                   LMgXRHzSbIJGn6i16K+sDjaDf/k1o9DbxScO
                                   gEYqYS/rlh2Mf+BRAY3QHPbwoPh2fkDKBroF
                                   SRGR7ZYcx+YIQw==
                                   &#41; ; key id = 40692

   The DS RR will be

      example.net. 3600 IN DS 40692 12 3 &#40;
                22261A8B0E0D799183E35E24E2AD6BB58533CBA7E3B14D659E9CA09B
                2071398F &#41;
=cut

my $record = 
&#34;      example.net. 86400   DNSKEY  257 3 12 &#40;                                                                                                                                                  
                                   LMgXRHzSbIJGn6i16K+sDjaDf/k1o9DbxScO                                                                                                                         
                                   gEYqYS/rlh2Mf+BRAY3QHPbwoPh2fkDKBroF                                                                                                                         
                                   SRGR7ZYcx+YIQw==                                                                                                                                             
                                   &#41; ; key id = 40692                                                                                                                                           
&#34;;                                                                                                                                                                                              
                                                                                                                                                                                                
my $keyrr = Net::DNS::RR-&gt;new_from_string&#40;$record&#41;;


my $data = $keyrr-&gt;_name2wire &#40;$keyrr-&gt;name&#41; . $keyrr-&gt;_canonicalRdata;  # this is a part of Net::DNS::Sec that creates binary on whitch digest is calculated

print  uc&#40;gost_hex&#40;$data&#41;&#41;;</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;29&nbsp;16:32:30&nbsp;2012</span>
    <span class="description">gray [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Sep 25 08:10:41 2012, dhyan@nataraj.su wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi!
&gt; 
&gt; I am trying to use Digest::GOST to calculate DS record in DNSSEC.
&gt; Calculating
&gt; DS record using GOST is covered by <span class="clickylink"><a target="new" rel="nofollow" href="https://tools.ietf.org/html/rfc5933">https://tools.ietf.org/html/rfc5933</a></span>
&gt; 
&gt; I take a calculating subroutine from Net::DNS::Sec, as it does
&gt; calculation for
&gt; other types of digest and applied it to the example in 4.1. if RFC
&gt; 5933. See
&gt; attached code.
&gt; 
&gt; The code gives wrong result. This happens because of RFC 5933 in
&gt; section 4
&gt; tells to use CryptoProParamSet GOST param set to calculate hash, and
&gt; Digest::GOST seems to use  TestParamSet.
&gt; 
&gt; I applied a small hack-patch to src/gost.c: I&#39;ve added ctx-&gt;cryptpro =
&gt; 1; to
&gt; the gost_init function:
&gt; 
&gt; void gost_init&#40;gost_ctx *ctx&#41;
&gt; {
&gt;   memset&#40;ctx, 0, sizeof&#40;gost_ctx&#41;&#41;;
&gt;   ctx-&gt;cryptpro = 1;
&gt; }
&gt; 
&gt; After building Digest::GOST with this patch an example script from the
&gt; attachment gives the same result as shown in RFC example.
&gt; 
&gt; So access to CryptoProParamSet is really needed in Digest::GOST: at
&gt; least for
&gt; patching Net::DNS::Sec to support GOST hashes out of box.
&gt; 
&gt; The question is what is the best way to do it. If you use TestParamSet
&gt; by
&gt; mistake, then may be if would be better not to use it. If you
&gt; intentionally
&gt; used  TestParamSet for some reason &#40;you may have one&#41;, then it would
&gt; be very
&gt; good to add support for both ParamSets in Digest::GOST. I can write
&gt; and offer a
&gt; patch for this, if you give me general recommendations about the
&gt; implementation you expect to have.
&gt; 
&gt; Would be glad to here from you soon. :-&#41; We are currently using custom
&gt; built
&gt; module, with the hack above,  to calculating DS. It would be great to
&gt; replace
&gt; it with a standard module asap :-&#41;&#41;&#41;&#41;&#41; This will give me a chance to
&gt; send a
&gt; GOST patch Net::DNS::Sec as well :-&#41;
</div>
Thanks for the info, I&#39;m going to change the default to use the
CryptoPro values. I consulted the wikipedia page before I wrote this
module and it looks like the CryptoPro information was added only
relatively recently.

Expect a new version in the next few days. I want to also include a fix
for some of the cpantester errors in this release, so that probably
means moving away from the librhash code, which relies on fragile system
checks and ASM code.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;29&nbsp;16:32:30&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;03&nbsp;13:57:30&nbsp;2012</span>
    <span class="description">gray [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Sep 29 16:32:30 2012, GRAY wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks for the info, I&#39;m going to change the default to use the
&gt; CryptoPro values.
</div>
Implemented in 0.06.

I decided against changing the defaults after noticing other
implementations also defaulted to the test params, or didn&#39;t even
include the cryptopro params. So I&#39;ll let the base module continue to
default to the test params, which has the added benefit of not breaking
backward compatibility for anybody currently using it. To use the
cryptopro params, use the new module Digest::GOST::CryptoPro.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;03&nbsp;13:57:30&nbsp;2012</span>
    <span class="description">gray [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
