<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #72945 for IO-Compress: Compress::Zlib::memGunzip holds reference to input parameter</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #72945 for IO-Compress: Compress::Zlib::memGunzip holds reference to input parameter</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/IO-Compress/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/IO-Compress/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/IO-Compress/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/IO-Compress/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/IO-Compress">IO-Compress CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">72945</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/IO-Compress/Active/">IO-Compress</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
cpan [...] robm.fastmail.fm

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-226778-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.020    </td>
  </tr>
  <tr id="CF-226779-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;04&nbsp;18:14:36&nbsp;2011</span>
    <span class="description">cpan [...] robm.fastmail.fm -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Compress::Zlib::memGunzip holds reference to input parameter</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This code surprisingly leaks an object reference.

sub a {
  my $b = shift;
  my $u = Compress::Zlib::memGunzip&#40;$b&#41;;
  $b = SomeObj-&gt;new&#40;&#41;;
  return $u;
}

Because Compress::Zlib::memGunzip takes a reference to $_[0] and stores
it somewhere in a global. That means there&#39;s a global ref held to $b,
and when $b holds an object, that ref is held until the process exits or
the next call to memGunzip which overwrites the global.

This took ages to track down an annoying bug in my apache application
because processes are long lived.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;05&nbsp;05:16:17&nbsp;2011</span>
    <span class="description">pmqs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

thanks for the report.

You mention that &#34;Compress::Zlib::memGunzip takes a reference to $_[0] 
and stores it somewhere in a global&#34;. Can&#39;t say I&#39;m aware of any global 
that stores a reference to $_[0] in my code. Did you confirm that was 
happening in your investigation, or are you assuming that must be the 
case if you are seeing a leak?

I&#39;m having difficulty reproducing the memory leak you are getting. I ran 
the code below for 30 minutes and didn&#39;t see any memory growth in the 
process. Does the code below leak for you?

Finally, what version of Perl are you running? What platform 
&#40;linux/Windows etc&#41;. Are you running mod_perl? If so, what version?


use Compress::Zlib qw&#40;memGunzip $gzerrno&#41; ;
use IO::Compress::Gzip qw&#40;:all&#41;;
use IO::File ;


sub a {
  my $b = shift;
  my $u = Compress::Zlib::memGunzip&#40;$b&#41;;
  $b = IO::File-&gt;new&#40;&#34;&gt;/tmp/x&#34;&#41;;
  return $u;
}

my $gz ;
gzip \&#34;hello world\n&#34; =&gt;  \$gz
    or die &#34;cannot compress\n&#34;;;

while&#40;1&#41;
{
    my $d = a&#40;$gz&#41;;
}
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;05&nbsp;05:16:18&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;05&nbsp;18:51:30&nbsp;2011</span>
    <span class="description">cpan [...] robm.fastmail.fm -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; You mention that &#34;Compress::Zlib::memGunzip takes a reference to $_[0] 
&gt; and stores it somewhere in a global&#34;. Can&#39;t say I&#39;m aware of any global 
&gt; that stores a reference to $_[0] in my code. Did you confirm that was 
&gt; happening in your investigation, or are you assuming that must be the 
&gt; case if you are seeing a leak?
</div>
Yes, I confirmed it. See example code below.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m having difficulty reproducing the memory leak you are getting. I ran 
&gt; the code below for 30 minutes and didn&#39;t see any memory growth in the 
&gt; process. Does the code below leak for you?
</div>
So it&#39;s not a &#34;leak&#34; in that it doesn&#39;t grow forever. It&#39;s just that
somewhere there is a single reference held to the *last* input to
memGunzip. Normally that&#39;s not a problem, but in long lived processes
&#40;eg apache mod_perl handlers&#41; it can be because it can mean an object
lives longer than expected.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Finally, what version of Perl are you running? What platform 
&gt; &#40;linux/Windows etc&#41;. Are you running mod_perl? If so, what version?
</div>
It&#39;s debian linux, perl 5.10.1.

-----

use Compress::Zlib;

# new object
my $f = test-&gt;new&#40;&#41;;
# dummy so we can call memGunzip
my $z = Compress::Zlib::memGzip&#40;&#34;&#34;&#41;;

uz&#40;$z, $f&#41;;

# undef object reference, should cause test::DESTROY to be called
#  straight away because there should be no references left.
#  but that&#39;s not what happens, object is only destroyed in
#  global destruction phase
warn &#34;about to undef last reference&#34;;
$f = undef;
warn &#34;after undefing last reference&#34;;

sub uz {
  # $_[0] == gzip buffer, $_[1] == object reference
  my &#40;$zp, $rp&#41; = @_;

  # unzip the buffer, don&#39;t care about results.
  #  the bug is that this ends up storing a reference to $zp somewhere
  #  in a global
  Compress::Zlib::memGunzip&#40;$zp&#41;;

  # replace $zp with an object reference. because memGunzip holds a
  #  reference to $zip somewhere, we now actually have a reference to
  #  the &#34;test&#34; object held somewhere!
  $zp = $rp;

  return;
}

# Test object that logs creation/destruction
package test;

sub new {
  my $self = bless {}, &#39;test&#39;;
  warn &#34;new $self&#34;;
  return $self;
}

sub DESTROY {
  my $self = shift;
  warn &#34;destroy $self&#34;;
}

-----

What you see:

$ perl /tmp/t.pl
new test=HASH&#40;0x2059f70&#41; at /tmp/t.pl line 41.
about to undef last reference at /tmp/t.pl line 15.
after undefing last reference at /tmp/t.pl line 17.
destroy test=HASH&#40;0x2059f70&#41; at /tmp/t.pl line 47 during global destruction.

Note that the object is only destroyed &#34;during global destruction&#34;, not
when the actual last reference is undef&#39;d.

Now if you comment out the call to memGunzip you see:

$ perl /tmp/t.pl
new test=HASH&#40;0x1c25f70&#41; at /tmp/t.pl line 41.
about to undef last reference at /tmp/t.pl line 15.
destroy test=HASH&#40;0x1c25f70&#41; at /tmp/t.pl line 47.
after undefing last reference at /tmp/t.pl line 17.

Which is the correct expected behaviour, the object is destroyed when
the last reference to it is undef&#39;d.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;06&nbsp;17:40:42&nbsp;2011</span>
    <span class="description">pmqs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Brilliant test case, many thanks. I can now reproduce the issue on
5.10.1. Interestingly all is fine with perl 5.14.0 or better.

A quick test with my collection of Perl binaries shows it starts working
from 5.13.4.

I added a Devel::Peek::Dump call directly before and after this line in
your test script

$zp = $rp;

This is the before dump of $zp

SV = PV&#40;0x9e26b80&#41; at 0x9e549d8
  REFCNT = 3
  FLAGS = &#40;PADMY,POK,OOK,pPOK&#41;
  OFFSET = 18
  PV = 0x9ee0162 &#40; &#34;\37\213\10\0\0\0\0\0\0\n\0\0\0\0\0\0\0\22&#34; . &#41; &#34;&#34;\0
  CUR = 0
  LEN = 6

and this is the after

SV = PV&#40;0x9e26b80&#41; at 0x9e549d8
  REFCNT = 3
  FLAGS = &#40;PADMY,ROK&#41;
  RV = 0x9d37270
  SV = PVHV&#40;0x9d3ef98&#41; at 0x9d37270
    REFCNT = 3
    FLAGS = &#40;OBJECT,SHAREKEYS&#41;
    STASH = 0x9f69000   &#34;test&#34;
    ARRAY = 0x0
    KEYS = 0
    FILL = 0
    MAX = 7
    RITER = -1
    EITER = 0x0
  PV = 0x9d37270 &#34;&#34;
  CUR = 0
  LEN = 0

Note the reference count set to 3 in the latter. That looks like a Perl
bug to me.

Compare that with the output from 5.13.4


SV = PV&#40;0x9b87a98&#41; at 0x9d4f348
  REFCNT = 1
  FLAGS = &#40;PADMY,POK,OOK,pPOK&#41;
  OFFSET = 18
  PV = 0x9cbc3a2 &#40; &#34;\37\213\10\0\0\0\0\0\0\n\0\0\0\0\0\0\0\22&#34; . &#41; &#34;&#34;\0
  CUR = 0
  LEN = 6

SV = PV&#40;0x9b87a98&#41; at 0x9d4f348
  REFCNT = 1
  FLAGS = &#40;PADMY,ROK&#41;
  RV = 0x9b3a188
  SV = PVHV&#40;0x9b41eb0&#41; at 0x9b3a188
    REFCNT = 3
    FLAGS = &#40;OBJECT,SHAREKEYS&#41;
    STASH = 0x9d58e18   &#34;test&#34;
    ARRAY = 0x0
    KEYS = 0
    FILL = 0
    MAX = 7
    RITER = -1
    EITER = 0x0
  PV = 0x9b3a188 &#34;&#34;
  CUR = 0
  LEN = 0

Note the REFCNT set correctly se to 1 this time.

If this is a Perl bug, as I supect, your best bet is to either upgrade
to 5.14, or restructure your code to avoid making that assignment.

Will see if I can run a git bisect to see what change was responsible
for fixing the issue.

Paul
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;07&nbsp;00:05:54&nbsp;2011</span>
    <span class="description">cpan [...] robm.fastmail.fm -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Dec 06 17:40:42 2011, PMQS wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Note the reference count set to 3 in the latter. That looks like a
</div>Perl bug to me.

The thing is, that refcount is the number of references held to the $zp
variable itself. So when you do $zp = $rp, it doesn&#39;t change the number
of references to $zp at all, it&#39;s only changing the content of the $zp
scalar &#40;from a string to a reference&#41;

The more interesting thing is if you do a Dump before the memGunzip call
and after the call. Here&#39;s what you see:

Before:

SV = PV&#40;0x227c578&#41; at 0x22a9d60
  REFCNT = 1
  FLAGS = &#40;PADMY,POK,pPOK&#41;
  PV = 0x1e992d0 &#34;\37\213\10\0\0\0\0\0\0\377\3\0\0\0\0\0\0\0\0\0&#34;\0
  CUR = 20
  LEN = 24

After:

SV = PVIV&#40;0x1e83928&#41; at 0x22a9d60
  REFCNT = 3
  FLAGS = &#40;PADMY,POK,OOK,pPOK&#41;
  IV = 18  &#40;OFFSET&#41;
  PV = 0x1e992e2 &#40; &#34;\37\213\10\0\0\0\0\0\0\377\0\0\0\0\0\0\0\0&#34; . &#41; &#34;&#34;\0
  CUR = 0
  LEN = 6

So it&#39;s the memGunzip call that adds extra references to $zp &#40;2 extra in
fact!&#41;, which is what I was seeing happening.

It&#39;s possible to simulate this sort of bug by doing something like:

sub addevilref {
  our $someglobal = \$_[0];
  return &#34;bar&#34;;
}

If you now do something like:

sub {
  my $a = &#34;foo&#34;;
  addevilref&#40;$a&#41;;
  $a = SomeObj-&gt;new&#40;&#41;;
}

Then SomeObj won&#39;t actually be destroyed at the end of the sub like you
might expect, and this is what we see memGunzip doing.

Now given that different versions of perl fix it, I can see one of two
options:

1. It&#39;s an internal perl bug
2. It&#39;s a bug/change of behavior in some core module included with perl
Compress::Zlib uses

Hope you can track it down :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;08&nbsp;03:23:56&nbsp;2011</span>
    <span class="description">pmqs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">It&#39;s a Perl core issue - this is the fix that makes the issue go away.

commit 2154eca77956ce145743765bea9ce269e6227984
Author: Eric Brine &lt;ikegami@adaelis.com&gt;
Date:   Sat Jul 31 01:56:43 2010 -0700

    Fix untimely destruction introduced by lvalue ops [RT#67838] by
returning a TEMP instead of using TARG. Made appropriate TODO tests live.

:100644 100644 c1a357cc3eaa9726832fbd1f58d102fa54b7707b
903144ca86c0546ae0f51e81c7cfdcf92ac1b3a1 M      doop.c
:100644 100644 2dfca4cbc24e588fef7b4a29eb7d73257a430cb0
0da8bba494d7b8b4d424a6d34dec124e657f384e M      pp.c
:040000 040000 297b82e827da6a96bf5e598e6717bd34fcc8c1ae
6752b3a91a5bd07f2628d0fa2acb8bac79c00ac2 M      t
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;08&nbsp;22:38:35&nbsp;2011</span>
    <span class="description">cpan [...] robm.fastmail.fm -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Dec 08 03:23:56 2011, PMQS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It&#39;s a Perl core issue - this is the fix that makes the issue go away.
</div>
Interesting. I wonder what construct Compress::Zlib is using that
tickles this bug, it would be nice to try and work around it if it&#39;s not
hard to do.

Anyway, for now I&#39;ve made this patch to Cache::FastMmap to work around it.

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/robmueller/cache-fastmmap/commit/e44829c2a8e0b72ef63d9811bbfdcf79a81324ac">https://github.com/robmueller/cache-fastmmap/commit/e44829c2a8e0b72ef63d9811bbfdcf79a81324ac</a></span>

Thanks for investigating this so deeply!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;09&nbsp;08:27:47&nbsp;2011</span>
    <span class="description">pmqs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Dec 08 22:38:35 2011, ROBM wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Dec 08 03:23:56 2011, PMQS wrote:
<div class="message-stanza open">&gt; &gt; It&#39;s a Perl core issue - this is the fix that makes the issue go
</div>&gt; away.
&gt; 
&gt; Interesting. I wonder what construct Compress::Zlib is using that
&gt; tickles this bug, it would be nice to try and work around it if it&#39;s
&gt; not
&gt; hard to do.
</div>
Not sure what it is, but it has been there for a very very long time. I 
see the problem with Perl 5.6.0
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Anyway, for now I&#39;ve made this patch to Cache::FastMmap to work around
&gt; it.
</div>
Glad to hear there is a workaround. I assume upgrading to 5.14 isn&#39;t an 
option?

Paul
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;22&nbsp;09:27:15&nbsp;2011</span>
    <span class="description">pmqs [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
