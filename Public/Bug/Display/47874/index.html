<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #47874 for DBD-mysql: $dbh-&gt;commit under debugger hangs indefinitely</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #47874 for DBD-mysql: $dbh-&gt;commit under debugger hangs indefinitely</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DBD-mysql/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DBD-mysql/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DBD-mysql/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DBD-mysql/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-mysql">DBD-mysql CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">47874</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DBD-mysql/Active/">DBD-mysql</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
matt.lawrence [...] virgin.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10170-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
4.005</li>
<li>
4.011</li>
</ul>
    </td>
  </tr>
  <tr id="CF-10171-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;14&nbsp;12:05:44&nbsp;2009</span>
    <span class="description">matt.lawrence [...] virgin.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> $dbh-&gt;commit under debugger hangs indefinitely</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">A simple test case, just begin and commit a transaction:

use DBI;
my $dbh = DBI-&gt;connect&#40;&#39;dbi:mysql:...&#39;, ...&#41;;
$dbh-&gt;begin_work or die $dbh-&gt;errstr;
$dbh-&gt;commit or die $dbh-&gt;errstr;

this works fine when run normally, but in the perl debugger it hangs
indefinitely on the commit call, and won&#39;t even respond to Ctrl-C. This
doesn&#39;t happen with DBD::Pg, so it would seem to be a problem in
DBD::mysql, rather than DBI itself.

I&#39;ve replicated this on version 4.005 under linux, with a threading
perl-5.8.8 and on version 4.011 under freebsd with a non-threading
perl-5.8.8. I&#39;ll send the perl -V output for either system on request.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;27&nbsp;10:41:05&nbsp;2013</span>
    <span class="description">CAPTTOFU [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">No more hang, but I do get this with a slightly more complex version of the code:

Enter h or `h h&#39; for help, or `man perldebug&#39; for more help.

main::&#40;./blah2.pl:5&#41;:   my $dbh = DBI-&gt;connect&#40;&#34;DBI:mysql:test&#34;, &#34;xxxx&#34;, &#34;xxxx&#34;&#41;;
  DB&lt;1&gt; n
main::&#40;./blah2.pl:7&#41;:   $dbh-&gt;do&#40;&#34;drop table if exists t1&#34;&#41;;
  DB&lt;1&gt; n
main::&#40;./blah2.pl:8&#41;:   $dbh-&gt;begin_work or die $dbh-&gt;errstr;
  DB&lt;1&gt; n
main::&#40;./blah2.pl:10&#41;:  $dbh-&gt;do&#40;&#34;create table t1 &#40;a int&#41; engine=innodb&#34;&#41;;
  DB&lt;1&gt; n
main::&#40;./blah2.pl:11&#41;:  $dbh-&gt;do&#40;&#34;insert into t1 values &#40;123456789&#41;&#34;&#41;;
  DB&lt;1&gt; n
main::&#40;./blah2.pl:13&#41;:  $dbh-&gt;commit or die $dbh-&gt;errstr;
  DB&lt;1&gt; s
panic: attempt to copy freed scalar 13077d0 to d71890 at /usr/share/perl/5.14/perl5db.pl line 3737.
 at /usr/share/perl/5.14/perl5db.pl line 3737
DBI::CODE&#40;0x1060768&#41;&#40;/usr/lib/perl5/DBI.pm:514&#41;:
514:        return unless defined &#38;DBI::trace_msg; # return unless bootstrap&#39;d ok
  DB&lt;1&gt;

On Tue Jul 14 12:05:44 2009, MATTLAW wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; A simple test case, just begin and commit a transaction:
&gt; 
&gt; use DBI;
&gt; my $dbh = DBI-&gt;connect&#40;&#39;dbi:mysql:...&#39;, ...&#41;;
&gt; $dbh-&gt;begin_work or die $dbh-&gt;errstr;
&gt; $dbh-&gt;commit or die $dbh-&gt;errstr;
&gt; 
&gt; this works fine when run normally, but in the perl debugger it hangs
&gt; indefinitely on the commit call, and won&#39;t even respond to Ctrl-C. This
&gt; doesn&#39;t happen with DBD::Pg, so it would seem to be a problem in
&gt; DBD::mysql, rather than DBI itself.
&gt; 
&gt; I&#39;ve replicated this on version 4.005 under linux, with a threading
&gt; perl-5.8.8 and on version 4.011 under freebsd with a non-threading
&gt; perl-5.8.8. I&#39;ll send the perl -V output for either system on request.
</div>
I should see what other drivers give for this as well.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;27&nbsp;10:41:06&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;16&nbsp;11:58:14&nbsp;2015</span>
    <span class="description">KGOESS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m also seeing this error on perl 5.14 &#40;standard centos 6.3 build&#41; with DBD::mysql versions 4.021 and 4.029.

It only happens when you try to *examine* the return value from commit.

Any kind of comparison or assignment anywhere in the call stack will trigger the error. If you ignore the return value from commit, then it all works fine.


$ cat test-err.pl

use warnings;
use strict;

use DBI;

my &#40;$connectstr, $username, $password&#41; = @ARGV;

my $dbh = DBI-&gt;connect&#40;$connectstr, $username, $password, {}&#41;;

$dbh-&gt;begin_work;

my $sth = $dbh-&gt;prepare&#40;&#39;insert into kgtest set body=?&#39;&#41; || die $dbh-&gt;errstr;
$sth-&gt;execute&#40;&#39;kgtesting text body&#39;&#41; || die $dbh-&gt;errstr;
print &#34;PostingID is &#34;. $sth-&gt;{&#39;mysql_insertid&#39;}.&#34;\n&#34;;


print &#34;about to commit...\n&#34;;
my $rc = $dbh-&gt;commit;
print &#34;done committing...\n&#34;;

$ ./test-err.sh

Loading DB routines from perl5db.pl version 1.33
Editor support available.

Enter h or `h h&#39; for help, or `man perldebug&#39; for more help.

main::&#40;test-err.pl:7&#41;:  my &#40;$connectstr, $username, $password&#41; = @ARGV;
  DB&lt;1&gt; c
about to commit...
panic: attempt to copy freed scalar 2244548 to 1c08278 at /usr/share/perl5/perl5db.pl line 3737.
 at /usr/share/perl5/perl5db.pl line 3737
Debugged program terminated.  Use q to quit or R to restart,
  use o inhibit_exit to avoid stopping after program termination,
  h q, h R or h o to get additional info.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;16&nbsp;12:10:50&nbsp;2015</span>
    <span class="description">KGOESS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">After further investigation, it looks like the &#34;attempt to copy freed scalar&#34; but was filed as a perl debugger bug under perl, see <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.perl.org/Ticket/Display.html?id=113644">https://rt.perl.org/Ticket/Display.html?id=113644</a></span>.

I suspect this DBD::mysql ticket can be closed in favor of that one.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;25&nbsp;10:57:41&nbsp;2015</span>
    <span class="description">MICHIELB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Closing, as suggested.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;25&nbsp;10:57:43&nbsp;2015</span>
    <span class="description">MICHIELB [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
