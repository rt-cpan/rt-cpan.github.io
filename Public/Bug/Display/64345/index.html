<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #64345 for Business-OnlinePayment-TCLink: BOP:TCLink does not support CVV</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #64345 for Business-OnlinePayment-TCLink: BOP:TCLink does not support CVV</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Business-OnlinePayment-TCLink/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Business-OnlinePayment-TCLink/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Business-OnlinePayment-TCLink/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Business-OnlinePayment-TCLink/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Business-OnlinePayment-TCLink">Business-OnlinePayment-TCLink CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">64345</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Business-OnlinePayment-TCLink/Active/">Business-OnlinePayment-TCLink</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
adam.botbyl [...] revsolns.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-4714-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.03    </td>
  </tr>
  <tr id="CF-4715-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;30&nbsp;14:28:46&nbsp;2010</span>
    <span class="description">adam.botbyl [...] revsolns.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> BOP:TCLink does not support CVV</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Attached patch implements fix for Bug ID: 64322
Also adds CVV support, follows responses more along the lines of
BOP::AuthorizeNet

Features added in this patch

Adding of the following fields to processor:
   cvv2           : CVV/CVV2 Code
   order_number   : Transaction ID from previous transaction 
   invoice_number : Submitters invoice number for tracking in TC

Adding/Changing of the following fields in response from processor:
    $tx-&gt;authorization :  CHANGED - Authorization Code instead of AVS
Response
    $tx-&gt;avs_code      : AVS Response Code
    $tx-&gt;cvv2_response : CVV Response Code

Adding of the following flags:
    $tx-&gt;require_cvv&#40;1&#41; now supported
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> BOP.TCLink.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -crB Business-OnlinePayment-TCLink-1.03-orig/TCLink.pm Business-OnlinePayment-TCLink-1.03/TCLink.pm
*** Business-OnlinePayment-TCLink-1.03-orig/TCLink.pm	Fri Jan 10 15:24:25 2003
--- Business-OnlinePayment-TCLink-1.03/TCLink.pm	Thu Dec 30 14:13:49 2010
***************
*** 7,13 ****
  
  require Exporter;
  
! @ISA = qw&#40;Exporter AutoLoader Business::OnlinePayment&#41;;
  @EXPORT = qw&#40;&#41;;
  @EXPORT_OK = qw&#40;&#41;;
  $VERSION = &#39;1.03&#39;;
--- 7,13 ----
  
  require Exporter;
  
! @ISA = qw&#40;Exporter Business::OnlinePayment&#41;;
  @EXPORT = qw&#40;&#41;;
  @EXPORT_OK = qw&#40;&#41;;
  $VERSION = &#39;1.03&#39;;
***************
*** 20,26 ****
      $self-&gt;port&#40;&#39;&#39;&#41;;
      $self-&gt;path&#40;&#39;&#39;&#41;;
  
!     $self-&gt;build_subs&#40;&#39;order_number&#39;&#41;;
  }
  
  sub map_fields {
--- 20,26 ----
      $self-&gt;port&#40;&#39;&#39;&#41;;
      $self-&gt;path&#40;&#39;&#39;&#41;;
  
!     $self-&gt;build_subs&#40;&#39;order_number&#39;, &#39;avs_code&#39;, &#39;cvv2_response&#39;, &#39;require_cvv&#39;&#41;;
  }
  
  sub map_fields {
***************
*** 98,104 ****
          country        =&gt; &#39;country&#39;,
          phone          =&gt; &#39;phone&#39;,
          email          =&gt; &#39;email&#39;,
! 	order_number   =&gt; &#39;transid&#39;
      &#41;;
  
      if&#40;$self-&gt;transaction_type&#40;&#41; eq &#34;ach&#34;&#41; {
--- 98,106 ----
          country        =&gt; &#39;country&#39;,
          phone          =&gt; &#39;phone&#39;,
          email          =&gt; &#39;email&#39;,
!         order_number   =&gt; &#39;transid&#39;,
!         cvv2           =&gt; &#39;cvv&#39;,
!         invoice_number =&gt; &#39;purchaseordernum&#39;
      &#41;;
  
      if&#40;$self-&gt;transaction_type&#40;&#41; eq &#34;ach&#34;&#41; {
***************
*** 120,128 ****
      my %params = $self-&gt;get_fields&#40;qw/media custid password action amount
                                        first_name last_name address1 city state
                                        zip cc exp account routing country phone
!                                       email transid/&#41;;
      $params{&#39;demo&#39;} = $self-&gt;test_transaction&#40;&#41; ? &#39;y&#39; : &#39;n&#39;;
      $params{&#39;avs&#39;} = $self-&gt;require_avs&#40;&#41; ? &#39;y&#39; : &#39;n&#39;;
      $params{&#39;name&#39;} = $params{&#39;first_name&#39;} . &#39; &#39; . $params{&#39;last_name&#39;};
      delete $params{&#39;first_name&#39;};
      delete $params{&#39;last_name&#39;};
--- 122,131 ----
      my %params = $self-&gt;get_fields&#40;qw/media custid password action amount
                                        first_name last_name address1 city state
                                        zip cc exp account routing country phone
!                                       email transid cvv purchaseordernum/&#41;;
      $params{&#39;demo&#39;} = $self-&gt;test_transaction&#40;&#41; ? &#39;y&#39; : &#39;n&#39;;
      $params{&#39;avs&#39;} = $self-&gt;require_avs&#40;&#41; ? &#39;y&#39; : &#39;n&#39;;
+     $params{&#39;checkcvv&#39;} = $self-&gt;require_cvv&#40;&#41; ? &#39;y&#39; : &#39;n&#39;;
      $params{&#39;name&#39;} = $params{&#39;first_name&#39;} . &#39; &#39; . $params{&#39;last_name&#39;};
      delete $params{&#39;first_name&#39;};
      delete $params{&#39;last_name&#39;};
***************
*** 130,143 ****
      $params{&#39;cc&#39;} =~ s/\D//g;
      $params{&#39;exp&#39;} =~ s/\D//g;
      $params{&#39;exp&#39;} = &#39;0&#39; . $params{&#39;exp&#39;} if length&#40;$params{&#39;exp&#39;}&#41; == 3;
  
      my %results = Net::TCLink::send&#40;\%params&#41;;
  
      if&#40;$results{&#39;status&#39;} eq &#39;approved&#39; or $results{&#39;status&#39;} eq &#39;accepted&#39;&#41; {
          $self-&gt;is_success&#40;1&#41;;
          $self-&gt;result_code&#40;$results{&#39;status&#39;}&#41;;
!         $self-&gt;authorization&#40;$results{&#39;avs&#39;}&#41;;
          $self-&gt;order_number&#40;$results{&#39;transid&#39;}&#41;;
      } else {
          $self-&gt;is_success&#40;0&#41;;
          $self-&gt;result_code&#40;$results{&#39;status&#39;}&#41;;
--- 133,149 ----
      $params{&#39;cc&#39;} =~ s/\D//g;
      $params{&#39;exp&#39;} =~ s/\D//g;
      $params{&#39;exp&#39;} = &#39;0&#39; . $params{&#39;exp&#39;} if length&#40;$params{&#39;exp&#39;}&#41; == 3;
+     $params{&#39;cvv&#39;} =~ s/\D//g;
  
      my %results = Net::TCLink::send&#40;\%params&#41;;
  
      if&#40;$results{&#39;status&#39;} eq &#39;approved&#39; or $results{&#39;status&#39;} eq &#39;accepted&#39;&#41; {
          $self-&gt;is_success&#40;1&#41;;
          $self-&gt;result_code&#40;$results{&#39;status&#39;}&#41;;
!         $self-&gt;authorization&#40;$results{&#39;authcode&#39;}&#41;;
!         $self-&gt;avs_code&#40;$results{&#39;avs&#39;}&#41;;
          $self-&gt;order_number&#40;$results{&#39;transid&#39;}&#41;;
+         $self-&gt;cvv2_response&#40;$results{&#39;cvv&#39;}&#41;;
      } else {
          $self-&gt;is_success&#40;0&#41;;
          $self-&gt;result_code&#40;$results{&#39;status&#39;}&#41;;
***************
*** 184,189 ****
--- 190,196 ----
        zip            =&gt; &#39;84058&#39;,
        card_number    =&gt; &#39;4111111111111111&#39;,
        expiration     =&gt; &#39;09/05&#39;,
+       cvv2           =&gt; &#39;123&#39;
    &#41;;
    $tx-&gt;submit&#40;&#41;;
  
***************
*** 199,204 ****
--- 206,215 ----
  Carte Blanche, Japan Card, Enroute, CC
  
  Content required: type, login, password, action, amount, first_name, last_name, card_number, expiration.
+ Optional content: cvv2, invoice_number.
+ 
+ To fail on CVV failure: $tx-&gt;require_cvv&#40;1&#41;;
+ To fail on AVS failure: $tx-&gt;require_avs&#40;1&#41;;
  
  =head2 Check
  
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;30&nbsp;14:30:19&nbsp;2010</span>
    <span class="description">clientservices -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Issue Received: [rt.cpan.org #64345] BOP:TCLink does not support CVV  [1166945]</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 30 Dec 2010 11:30:09 -0800 &#40;PST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Business-OnlinePayment-TCLink [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> clientservices [...] trustcommerce.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Greetings from TrustCommerce,

Your inquiry has been received and logged as ticket number 1166945.

Please reply directly to this eMail if you have any comments or additional information.

Thank you for choosing TrustCommerce.

-------------------------------------------------------------------------

Subject: [rt.cpan.org #64345] BOP:TCLink does not support CVV 
From: Adam via RT &lt;bug-Business-OnlinePayment-TCLink@rt.cpan.org&gt;

Thu Dec 30 14:28:46 2010: Request 64345 was acted upon.
Transaction: Ticket created by abotbyl
       Queue: Business-OnlinePayment-TCLink
     Subject: BOP:TCLink does not support CVV
   Broken in: 1.03
    Severity: Important
       Owner: Nobody
  Requestors: adam.botbyl@revsolns.com
      Status: new
 Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=64345">https://rt.cpan.org/Ticket/Display.html?id=64345</a></span> &gt;


Attached patch implements fix for Bug ID: 64322
Also adds CVV support, follows responses more along the lines of
BOP::AuthorizeNet

Features added in this patch

Adding of the following fields to processor:
   cvv2           : CVV/CVV2 Code
   order_number   : Transaction ID from previous transaction 
   invoice_number : Submitters invoice number for tracking in TC

Adding/Changing of the following fields in response from processor:
    $tx-&gt;authorization :  CHANGED - 

Original Text Too Long. Truncated.  
See FullDescription.txt attached doc for full message.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;30&nbsp;14:30:20&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
