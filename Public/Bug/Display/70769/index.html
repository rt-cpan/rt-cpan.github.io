<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #70769 for Zenoss: Model an existing Device</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #70769 for Zenoss: Model an existing Device</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Zenoss/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Zenoss/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Zenoss/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Zenoss/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Zenoss">Zenoss CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">70769</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">stalled</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Zenoss/Active/">Zenoss</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">patricksbaker [...] gmail.com
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
lmacinnes [...] stargate.ca

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-235980-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
1.04</li>
<li>
1.05</li>
<li>
1.06</li>
<li>
1.07</li>
<li>
1.08</li>
<li>
1.09</li>
<li>
1.10</li>
</ul>
    </td>
  </tr>
  <tr id="CF-235981-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;06&nbsp;15:38:08&nbsp;2011</span>
    <span class="description">lmacinnes [...] stargate.ca -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Model an existing Device</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">There doesn&#39;t seem to be an API call to model an existing device. 

I&#39;m running into an issue where I need to delete interfaces add a second device then remodel 
the original device but can&#39;t seem to find a method to remodel.

There seems to be a &#34;collectDevice&#40;&#41;&#34; method in ZenOSS but I&#39;m unsure of how to modify your 
package to talk to it

grep &#39;def collectDevice&#39;  * -R
DataCollector/zenmodeler.py:    def collectDevice&#40;self, device&#41;:
ZenModel/PerformanceConf.py:    def collectDevice&#40;self, device=None, setlog=True, 
REQUEST=None,
ZenModel/Device.py:    def collectDevice&#40;self, setlog=True, REQUEST=None, 
generateEvents=False,
ZenModel/DeviceOrganizer.py:    def collectDevice&#40;self, REQUEST=None&#41;:


Is there any chance that this functionality could be added?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;06&nbsp;15:50:15&nbsp;2011</span>
    <span class="description">patricksbaker [...] gmail.com -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;06&nbsp;15:54:40&nbsp;2011</span>
    <span class="description">patricksbaker [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza">On Tue Sep 06 15:38:08 2011, Liam wrote: <br>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There doesn't seem to be an API call to model an existing device. <br>

&gt;  <br>

&gt; I'm running into an issue where I need to delete interfaces add a <br>

&gt; second device then remodel <br>

&gt; the original device but can't seem to find a method to remodel. <br>

&gt;  <br>

&gt; There seems to be a &quot;collectDevice()&quot; method in ZenOSS but I'm unsure <br>

&gt; of how to modify your <br>

&gt; package to talk to it <br>

&gt;  <br>

&gt; grep 'def collectDevice'  * -R <br>

&gt; DataCollector/zenmodeler.py:    def collectDevice(self, device): <br>

&gt; ZenModel/PerformanceConf.py:    def collectDevice(self, device=None, <br>

&gt; setlog=True, <br>

&gt; REQUEST=None, <br>

&gt; ZenModel/Device.py:    def collectDevice(self, setlog=True, <br>

&gt; REQUEST=None, <br>

&gt; generateEvents=False, <br>

&gt; ZenModel/DeviceOrganizer.py:    def collectDevice(self, REQUEST=None): <br>

&gt;  <br>

&gt;  <br>

&gt; Is there any chance that this functionality could be added? <br>
</div><br>

This might not be possible, yet.&nbsp; From using FireBug with Zenoss, I was unable to see a JSON request when modeling a device; it appears to be a url encoded POST.&nbsp; It would appear that they, Zenoss, havent created a Zuul resource for it.<br>

<br>

I&nbsp;will review this more in depth in the coming days to see if there is something I&nbsp;can implement.<br>

<br>

Thanks,<br>

<br>

Patrick<br>

<br>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;06&nbsp;15:54:41&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;08&nbsp;00:43:40&nbsp;2011</span>
    <span class="description">patricksbaker [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza">After more review it appears Zenoss has added this ability in Zenoss 4.0 with the JSON API called named 'remodel' on the Device Router.&nbsp; There is a back port that will allow this to work with Zenoss 3.X; patch attached.&nbsp; Please note that I&nbsp;make no guarantees that the patch will work successfully on your system.<br>

<br>

The patch can be applied with the command: patch -p4 &lt; changeset_r40190.diff<br>

<br>

From the Perl interface side of things, this brings up an interesting topic.&nbsp; I&nbsp;believe I'm going to have to start updating the Zenoss Perl interface to work with the latest version of Zenoss, which has new features such as remodel (however most just came out).&nbsp; If a user doesn't have the appropriate version to execute the call, then I will have to Carp with an error.&nbsp; Given that this is open source, I&nbsp;really dont want to get into maintaining documentation for the rapid development of the Zenoss Monitoring Solution across multiple versions.&nbsp; With that said, some thought process will need to go into the method call validation.<br>

<br>

For the impatient, you can add the following block of code to<span style="font-family: monospace;"> </span>Zenoss::Router::Device (Device.pm) that will allow you to execute the requested remodel command via the Zenoss module; $api-&gt;device_remodel({deviceUid =&gt; '/Servers/Linux/DeviceName})<br>

<br>

Note, I&nbsp;havent tested this!<br>

<br>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">#======================================================================<br>
</div># device_remodel<br>
<div class="message-stanza open">#======================================================================<br>
</div></div>sub device_remodel {<br>

&nbsp;&nbsp;&nbsp; my ($self, $args) = @_;<br>

&nbsp;&nbsp;&nbsp; $args = {} if !$args;<br>

<br>

&nbsp;&nbsp;&nbsp; # Argument definition<br>

&nbsp;&nbsp;&nbsp; my $definition = {<br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; required&nbsp;&nbsp;&nbsp; =&gt; ['deviceUid'],<br>

&nbsp;&nbsp;&nbsp; };<br>

<br>

&nbsp;&nbsp;&nbsp; # Check the args<br>

&nbsp;&nbsp;&nbsp; $self-&gt;_check_args($args, $definition);<br>

<br>

&nbsp;&nbsp;&nbsp; # Route the request<br>

&nbsp;&nbsp;&nbsp; $self-&gt;_router_request(<br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; location&nbsp;&nbsp;&nbsp; =&gt; $self-&gt;DEVICE_LOCATION,<br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; action&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =&gt; $self-&gt;DEVICE_ACTION,<br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; method&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =&gt; 'remodel',<br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =&gt; [$args],<br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>

&nbsp;&nbsp;&nbsp; );<br>

} # END device_remodel<br>
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> changeset_r40190.diff</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: /trunk/core/Products/Zuul/routers/device.py
===================================================================
--- /trunk/core/Products/Zuul/routers/device.py &#40;revision 39869&#41;
+++ /trunk/core/Products/Zuul/routers/device.py &#40;revision 40190&#41;
@@ -1228,4 +1228,18 @@
         return DirectResponse.succeed&#40;jobId=jobStatus.id&#41;
 
+    @require&#40;&#39;Manage Device&#39;&#41;
+    def remodel&#40;self, deviceUid&#41;:
+        &#34;&#34;&#34;
+        Submit a job to have a device remodeled.
+
+        @type  deviceUid: string
+        @param deviceUid: Device uid to have local template
+        @rtype:   DirectResponse
+        @return:  B{Properties}:
+             - jobId: &#40;string&#41; ID of the add device job
+        &#34;&#34;&#34;
+        jobStatus = self._getFacade&#40;&#41;.remodel&#40;deviceUid&#41;
+        return DirectResponse.succeed&#40;jobId=jobStatus.id&#41;
+
     @require&#40;&#39;Edit Local Templates&#39;&#41;
     def addLocalTemplate&#40;self, deviceUid, templateId&#41;:
Index: /trunk/core/Products/Zuul/facades/devicefacade.py
===================================================================
--- /trunk/core/Products/Zuul/facades/devicefacade.py &#40;revision 39524&#41;
+++ /trunk/core/Products/Zuul/facades/devicefacade.py &#40;revision 40190&#41;
@@ -279,4 +279,10 @@
         return jobStatus
 
+    def remodel&#40;self, deviceUid&#41;:
+        fake_request = {&#39;CONTENT_TYPE&#39;: &#39;xml&#39;}
+        device = self._getObject&#40;deviceUid&#41;
+        return device.getPerformanceServer&#40;&#41;.collectDevice&#40;
+            device, background=True, REQUEST=fake_request&#41;
+
     def addLocalTemplate&#40;self, deviceUid, templateId&#41;:
         &#34;&#34;&#34;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction dates Told even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;08&nbsp;00:45:41&nbsp;2011</span>
    <span class="description">patricksbaker [...] gmail.com -  Told changed from Thu Sep 08 00:43:41 2011 to Thu Sep 08 00:45:40 2011</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;20&nbsp;02:56:57&nbsp;2011</span>
    <span class="description">patricksbaker [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza">I've released version 1.11 which now checks if the API call is available on the Zenoss server. &nbsp;I'm attempting to gather what the deal is with version 4.X of Zenoss and if its publicly available. &nbsp;Until I find that out, I will keep the remodel API call omitted. &nbsp;On a happier note, I've updated some of the Routers to support new methods in version 3.2 of Zenoss.<br>

<br>

Stalling this require for now until I figure out when Zenoss 4.X &nbsp;core is going to be released.<br>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;20&nbsp;02:56:58&nbsp;2011</span>
    <span class="description">patricksbaker [...] gmail.com -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
