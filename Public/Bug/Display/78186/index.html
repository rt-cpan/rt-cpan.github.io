<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #78186 for DBD-ODBC: Issue when DBD::ODBC upgraded from 1.24 to 1.37</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #78186 for DBD-ODBC: Issue when DBD::ODBC upgraded from 1.24 to 1.37</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DBD-ODBC/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DBD-ODBC/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DBD-ODBC/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DBD-ODBC/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-ODBC">DBD-ODBC CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">78186</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DBD-ODBC/Active/">DBD-ODBC</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
gregory.ionis [...] baml.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10188-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10189-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;03&nbsp;18:22:04&nbsp;2012</span>
    <span class="description">gregory.ionis [...] baml.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Issue when DBD::ODBC upgraded from 1.24 to 1.37</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 03 Jul 2012 18:21:50 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-ODBC [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Ionis, Gregory - RSCH AMRS&#34; &lt;gregory.ionis [...] baml.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have upgraded my DBD::ODBC from version 1.24 to version 1.37 and I
observed two problems:

1&#41;Previously I could connect with the following DSN:

dbi:ODBC:Driver=libdbodbc11.so;ServerName=server;links=tcpip{host=host;p
ort=port}

Now it fails to connect with error

[unixODBC][Driver Manager]Data source name not found, and no default
driver specified &#40;SQL-IM002&#41;&#39; &#40;err#0&#41;

Using a predefined DSN &#40;same as before&#41; it connects without a problem.

2&#41;I am using the FreeTDS driver, which does not return column types, so
DBD::ODBC automaticall;y converts data to varchar. However, this
convertion changed. Specifically, I have a FLOAT value. In the old
version it is returned as .002983792917, and in the new version as
.00298.

I have looked through the release notes for DBD::ODBC, but have not
found anything relevant.

Please let me know if you need any additional details.

Thank you for your help,
Gregory Ionis

----------------------------------------------------------------------
This message w/attachments &#40;message&#41; is intended solely for the use of the intended recipient&#40;s&#41; and may contain information that is privileged, confidential or proprietary. If you are not an intended recipient, please notify the sender, and then please delete and destroy all copies and attachments, and be advised that any review or dissemination of, or the taking of any action in reliance on, the information contained in or attached to this message is prohibited. 
Unless specifically indicated, this message is not an offer to sell or a solicitation of any investment products or other financial product or service, an official confirmation of any transaction, or an official statement of Sender. Subject to applicable law, Sender may intercept, monitor, review and retain e-communications &#40;EC&#41; traveling through its networks/systems and may produce any such EC to regulators, law enforcement, in litigation and as required by law. 
The laws of the country of each sender/recipient may impact the handling of EC, and EC may be archived, supervised and produced in countries other than the country in which you are located. This message cannot be guaranteed to be secure or free of errors or viruses. 

References to &#34;Sender&#34; are references to any subsidiary of Bank of America Corporation. Securities and Insurance Products: * Are Not FDIC Insured * Are Not Bank Guaranteed * May Lose Value * Are Not a Bank Deposit * Are Not a Condition to Any Banking Service or Activity * Are Not Insured by Any Federal Government Agency. Attachments that are part of this EC may have additional important disclosures and disclaimers, which you should read. This message is subject to terms available at the following link: 
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.bankofamerica.com/emaildisclaimer">http://www.bankofamerica.com/emaildisclaimer</a></span>. By messaging with Sender you consent to the foregoing.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;04&nbsp;04:19:55&nbsp;2012</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jul 03 18:22:04 2012, gregory.ionis@baml.com wrote:

Thanks for your report.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have upgraded my DBD::ODBC from version 1.24 to version 1.37 and I
&gt; observed two problems:
</div>
I hate to think how much has changed since then.

What platform are you running on and how was DBD::ODBC built? If didn&#39;t
build it yourself can you get a connection up in Perl and print
odbc_has_unicode read-only attribute out.

What driver manager and version of it are you using?
If it is unixODBC can you run odbcinst -j.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 1&#41;Previously I could connect with the following DSN:
&gt; 
&gt; dbi:ODBC:Driver=libdbodbc11.so;ServerName=server;links=tcpip{host=host;p
&gt; ort=port}
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Now it fails to connect with error
&gt; 
&gt; [unixODBC][Driver Manager]Data source name not found, and no default
&gt; driver specified &#40;SQL-IM002&#41;&#39; &#40;err#0&#41;
&gt; 
&gt; Using a predefined DSN &#40;same as before&#41; it connects without a problem.
</div>
Below you say you are using freeTDS and that does not look like a
freeTDS driver shared object - can you explain.

IF you&#39;ve got a recent version of DBI &#40;1.617 or above&#41; could you repeat
the above code but set and export DBI_TRACE=DBD=x.log and attach a log
file. If you have not got a recent DBI could you add the following to
your Perl code at the start, set and export DBI_TRACE=15=x.log and rerun
it then send me the log:

use DBD::ODBC;
DBI-&gt;trace&#40;DBD::ODBC-&gt;parse_trace_flags&#40;&#39;odbcconnection|odbcunicode&#39;&#41;&#41;;

Lastly, try changing Driver= to DRIVER= but if this works I&#39;d still like
to see the log files please.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 2&#41;I am using the FreeTDS driver, which does not return column types,
</div>
Really. You mean SQLDescribeCol on a result-set cannot tell you what the
column is? In other words after issuing a select, the TYPE attribute
does not return column types.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;    so
&gt; DBD::ODBC automaticall;y converts data to varchar. However, this
&gt; convertion changed. Specifically, I have a FLOAT value. In the old
&gt; version it is returned as .002983792917, and in the new version as
&gt; .00298.
</div>
Could you reduce your code to a very small example &#40;preferably one which
creates the schema too and populates some date&#41; and send me it?
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have looked through the release notes for DBD::ODBC, but have not
&gt; found anything relevant.
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Please let me know if you need any additional details.
&gt; 
&gt; Thank you for your help,
&gt; Gregory Ionis
</div>
BTW, if you don&#39;t want to attach log files to the RT you can send them
to my CPAN address mjevans@cpan.org.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;04&nbsp;04:19:56&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;07&nbsp;12:11:57&nbsp;2012</span>
    <span class="description">gregory.ionis [...] baml.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #78186] Issue when DBD::ODBC upgraded from 1.24 to 1.37</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 07 Aug 2012 12:11:35 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-ODBC [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Ionis, Gregory - RSCH AMRS&#34; &lt;gregory.ionis [...] baml.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Martin,

I think I got some progress. I have 64-bit unixODBC and DBD::ODBC now.
Running the same sample again, I observe the following &#40;please let me
know if I am wrong&#41;:

1&#41;For the FLOAT result driver reports type REAL with 13 character-long
display.
2&#41;DBD::ODBC regards it as SQL_LONGVARBINARY &#40;not sure if this is as it
should be&#41;.
3&#41;If I do not set LongTruncOk=1, it will fail with the same error.
4&#41;However, if I do set LongTruncOk=1, looking at the result in the
debugger, I see &#34;123.456001281\c@&#34;, which is 14 characters long, with
the last character being NUL &#40;0x0&#41;.

Now in the guessing territory: the driver says 13-character string, but
returns a 13-character NUL-terminated C string, thus causing &#34;too much
data&#34; condition. I am not sure whose fault this is -- the Sybase driver,
or DBD::ODBC &#40;either there should be no NUL character in BINARY type, or
it should classify it as a TEXT type of some kind to get the string
representation correctly&#41;. Am I making any sense?

Note that it is not every FLOAT value that causes this &#40;extra NUL&#41;
situation. I initially thought that only small values cause this, but
this is clearly not the case, and I do not see any pattern.

Attached are the Perl source and the log.

Thank you for your help,
Gregory

 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Martin J Evans via RT [mailto:bug-DBD-ODBC@rt.cpan.org] 
Sent: Wednesday, July 04, 2012 4:20 AM
To: Ionis, Gregory - RSCH AMRS
Subject: [rt.cpan.org #78186] Issue when DBD::ODBC upgraded from 1.24 to
1.37

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=78186">https://rt.cpan.org/Ticket/Display.html?id=78186</a></span> &gt;

On Tue Jul 03 18:22:04 2012, gregory.ionis@baml.com wrote:

Thanks for your report.

<div class="message-stanza open">&gt; I have upgraded my DBD::ODBC from version 1.24 to version 1.37 and I 
&gt; observed two problems:
</div>
I hate to think how much has changed since then.

What platform are you running on and how was DBD::ODBC built? If didn&#39;t
build it yourself can you get a connection up in Perl and print
odbc_has_unicode read-only attribute out.

What driver manager and version of it are you using?
If it is unixODBC can you run odbcinst -j.

<div class="message-stanza open">&gt; 1&#41;Previously I could connect with the following DSN:
&gt; 
&gt; dbi:ODBC:Driver=libdbodbc11.so;ServerName=server;links=tcpip{host=host
&gt; ;p
&gt; ort=port}
</div>
<div class="message-stanza open">&gt; Now it fails to connect with error
&gt; 
&gt; [unixODBC][Driver Manager]Data source name not found, and no default 
&gt; driver specified &#40;SQL-IM002&#41;&#39; &#40;err#0&#41;
&gt; 
&gt; Using a predefined DSN &#40;same as before&#41; it connects without a problem.
</div>
Below you say you are using freeTDS and that does not look like a
freeTDS driver shared object - can you explain.

IF you&#39;ve got a recent version of DBI &#40;1.617 or above&#41; could you repeat
the above code but set and export DBI_TRACE=DBD=x.log and attach a log
file. If you have not got a recent DBI could you add the following to
your Perl code at the start, set and export DBI_TRACE=15=x.log and rerun
it then send me the log:

use DBD::ODBC;
DBI-&gt;trace&#40;DBD::ODBC-&gt;parse_trace_flags&#40;&#39;odbcconnection|odbcunicode&#39;&#41;&#41;;

Lastly, try changing Driver= to DRIVER= but if this works I&#39;d still like
to see the log files please.

<div class="message-stanza open">&gt; 2&#41;I am using the FreeTDS driver, which does not return column types,
</div>
Really. You mean SQLDescribeCol on a result-set cannot tell you what the
column is? In other words after issuing a select, the TYPE attribute
does not return column types.

<div class="message-stanza open">&gt;    so
&gt; DBD::ODBC automaticall;y converts data to varchar. However, this 
&gt; convertion changed. Specifically, I have a FLOAT value. In the old 
&gt; version it is returned as .002983792917, and in the new version as 
&gt; .00298.
</div>
Could you reduce your code to a very small example &#40;preferably one which
creates the schema too and populates some date&#41; and send me it?
 
<div class="message-stanza open">&gt; I have looked through the release notes for DBD::ODBC, but have not 
&gt; found anything relevant.
</div>
<div class="message-stanza open">&gt; Please let me know if you need any additional details.
&gt; 
&gt; Thank you for your help,
&gt; Gregory Ionis
</div>
BTW, if you don&#39;t want to attach log files to the RT you can send them
to my CPAN address mjevans@cpan.org.

Martin
--
Martin J. Evans
Wetherby, UK

----------------------------------------------------------------------
This message w/attachments &#40;message&#41; is intended solely for the use of the intended recipient&#40;s&#41; and may contain information that is privileged, confidential or proprietary. If you are not an intended recipient, please notify the sender, and then please delete and destroy all copies and attachments, and be advised that any review or dissemination of, or the taking of any action in reliance on, the information contained in or attached to this message is prohibited. 
Unless specifically indicated, this message is not an offer to sell or a solicitation of any investment products or other financial product or service, an official confirmation of any transaction, or an official statement of Sender. Subject to applicable law, Sender may intercept, monitor, review and retain e-communications &#40;EC&#41; traveling through its networks/systems and may produce any such EC to regulators, law enforcement, in litigation and as required by law. 
The laws of the country of each sender/recipient may impact the handling of EC, and EC may be archived, supervised and produced in countries other than the country in which you are located. This message cannot be guaranteed to be secure or free of errors or viruses. 

References to &#34;Sender&#34; are references to any subsidiary of Bank of America Corporation. Securities and Insurance Products: * Are Not FDIC Insured * Are Not Bank Guaranteed * May Lose Value * Are Not a Bank Deposit * Are Not a Condition to Any Banking Service or Activity * Are Not Insured by Any Federal Government Agency. Attachments that are part of this EC may have additional important disclosures and disclaimers, which you should read. This message is subject to terms available at the following link: 
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.bankofamerica.com/emaildisclaimer">http://www.bankofamerica.com/emaildisclaimer</a></span>. By messaging with Sender you consent to the foregoing.
</div></div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;07&nbsp;12:14:09&nbsp;2012</span>
    <span class="description">gregory.ionis [...] baml.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #78186] Issue when DBD::ODBC upgraded from 1.24 to 1.37</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 07 Aug 2012 12:13:49 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-ODBC [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Ionis, Gregory - RSCH AMRS&#34; &lt;gregory.ionis [...] baml.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry, forgot to mention that the explicit DSN &#40;same as I was using
before&#41; is working now.

Thank you,
Gregory 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Ionis, Gregory - RSCH AMRS 
Sent: Tuesday, August 07, 2012 12:12 PM
To: &#39;bug-DBD-ODBC@rt.cpan.org&#39;
Subject: RE: [rt.cpan.org #78186] Issue when DBD::ODBC upgraded from
1.24 to 1.37

Martin,

I think I got some progress. I have 64-bit unixODBC and DBD::ODBC now.
Running the same sample again, I observe the following &#40;please let me
know if I am wrong&#41;:

1&#41;For the FLOAT result driver reports type REAL with 13 character-long
display.
2&#41;DBD::ODBC regards it as SQL_LONGVARBINARY &#40;not sure if this is as it
should be&#41;.
3&#41;If I do not set LongTruncOk=1, it will fail with the same error.
4&#41;However, if I do set LongTruncOk=1, looking at the result in the
debugger, I see &#34;123.456001281\c@&#34;, which is 14 characters long, with
the last character being NUL &#40;0x0&#41;.

Now in the guessing territory: the driver says 13-character string, but
returns a 13-character NUL-terminated C string, thus causing &#34;too much
data&#34; condition. I am not sure whose fault this is -- the Sybase driver,
or DBD::ODBC &#40;either there should be no NUL character in BINARY type, or
it should classify it as a TEXT type of some kind to get the string
representation correctly&#41;. Am I making any sense?

Note that it is not every FLOAT value that causes this &#40;extra NUL&#41;
situation. I initially thought that only small values cause this, but
this is clearly not the case, and I do not see any pattern.

Attached are the Perl source and the log.

Thank you for your help,
Gregory

 

<div class="message-stanza open">-----Original Message-----
From: Martin J Evans via RT [mailto:bug-DBD-ODBC@rt.cpan.org]
Sent: Wednesday, July 04, 2012 4:20 AM
To: Ionis, Gregory - RSCH AMRS
Subject: [rt.cpan.org #78186] Issue when DBD::ODBC upgraded from 1.24 to
1.37

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=78186">https://rt.cpan.org/Ticket/Display.html?id=78186</a></span> &gt;

On Tue Jul 03 18:22:04 2012, gregory.ionis@baml.com wrote:

Thanks for your report.

<div class="message-stanza open">&gt; I have upgraded my DBD::ODBC from version 1.24 to version 1.37 and I 
&gt; observed two problems:
</div>
I hate to think how much has changed since then.

What platform are you running on and how was DBD::ODBC built? If didn&#39;t
build it yourself can you get a connection up in Perl and print
odbc_has_unicode read-only attribute out.

What driver manager and version of it are you using?
If it is unixODBC can you run odbcinst -j.

<div class="message-stanza open">&gt; 1&#41;Previously I could connect with the following DSN:
&gt; 
&gt; dbi:ODBC:Driver=libdbodbc11.so;ServerName=server;links=tcpip{host=host
&gt; ;p
&gt; ort=port}
</div>
<div class="message-stanza open">&gt; Now it fails to connect with error
&gt; 
&gt; [unixODBC][Driver Manager]Data source name not found, and no default 
&gt; driver specified &#40;SQL-IM002&#41;&#39; &#40;err#0&#41;
&gt; 
&gt; Using a predefined DSN &#40;same as before&#41; it connects without a problem.
</div>
Below you say you are using freeTDS and that does not look like a
freeTDS driver shared object - can you explain.

IF you&#39;ve got a recent version of DBI &#40;1.617 or above&#41; could you repeat
the above code but set and export DBI_TRACE=DBD=x.log and attach a log
file. If you have not got a recent DBI could you add the following to
your Perl code at the start, set and export DBI_TRACE=15=x.log and rerun
it then send me the log:

use DBD::ODBC;
DBI-&gt;trace&#40;DBD::ODBC-&gt;parse_trace_flags&#40;&#39;odbcconnection|odbcunicode&#39;&#41;&#41;;

Lastly, try changing Driver= to DRIVER= but if this works I&#39;d still like
to see the log files please.

<div class="message-stanza open">&gt; 2&#41;I am using the FreeTDS driver, which does not return column types,
</div>
Really. You mean SQLDescribeCol on a result-set cannot tell you what the
column is? In other words after issuing a select, the TYPE attribute
does not return column types.

<div class="message-stanza open">&gt;    so
&gt; DBD::ODBC automaticall;y converts data to varchar. However, this 
&gt; convertion changed. Specifically, I have a FLOAT value. In the old 
&gt; version it is returned as .002983792917, and in the new version as 
&gt; .00298.
</div>
Could you reduce your code to a very small example &#40;preferably one which
creates the schema too and populates some date&#41; and send me it?
 
<div class="message-stanza open">&gt; I have looked through the release notes for DBD::ODBC, but have not 
&gt; found anything relevant.
</div>
<div class="message-stanza open">&gt; Please let me know if you need any additional details.
&gt; 
&gt; Thank you for your help,
&gt; Gregory Ionis
</div>
BTW, if you don&#39;t want to attach log files to the RT you can send them
to my CPAN address mjevans@cpan.org.

Martin
--
Martin J. Evans
Wetherby, UK

----------------------------------------------------------------------
This message w/attachments &#40;message&#41; is intended solely for the use of the intended recipient&#40;s&#41; and may contain information that is privileged, confidential or proprietary. If you are not an intended recipient, please notify the sender, and then please delete and destroy all copies and attachments, and be advised that any review or dissemination of, or the taking of any action in reliance on, the information contained in or attached to this message is prohibited. 
Unless specifically indicated, this message is not an offer to sell or a solicitation of any investment products or other financial product or service, an official confirmation of any transaction, or an official statement of Sender. Subject to applicable law, Sender may intercept, monitor, review and retain e-communications &#40;EC&#41; traveling through its networks/systems and may produce any such EC to regulators, law enforcement, in litigation and as required by law. 
The laws of the country of each sender/recipient may impact the handling of EC, and EC may be archived, supervised and produced in countries other than the country in which you are located. This message cannot be guaranteed to be secure or free of errors or viruses. 

References to &#34;Sender&#34; are references to any subsidiary of Bank of America Corporation. Securities and Insurance Products: * Are Not FDIC Insured * Are Not Bank Guaranteed * May Lose Value * Are Not a Bank Deposit * Are Not a Condition to Any Banking Service or Activity * Are Not Insured by Any Federal Government Agency. Attachments that are part of this EC may have additional important disclosures and disclaimers, which you should read. This message is subject to terms available at the following link: 
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.bankofamerica.com/emaildisclaimer">http://www.bankofamerica.com/emaildisclaimer</a></span>. By messaging with Sender you consent to the foregoing.
</div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;09&nbsp;05:27:41&nbsp;2012</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Aug 07 12:11:57 2012, gregory.ionis@baml.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Martin,
&gt; 
&gt; I think I got some progress. I have 64-bit unixODBC and DBD::ODBC now.
&gt; Running the same sample again, I observe the following &#40;please let me
&gt; know if I am wrong&#41;:
&gt; 
&gt; 1&#41;For the FLOAT result driver reports type REAL with 13 character-long
&gt; display.
</div>
From the log file the driver reports:

DescribeCol column = 1, name = flt, namelen = 3, type = REAL&#40;7&#41;,
precision/column size = 7, scale = 0, nullable = 0
     SQL_COLUMN_DISPLAY_SIZE = 13  &lt;---- NOTE THIS IS WHAT THE DRIVER SAID
     SQL_COLUMN_LENGTH = 7
     now using col 1: type = REAL &#40;7&#41;, len = 7, display size = 14, prec
= 7, scale = 0

NOTE: we are using a display size of 14 &#40;1 more than the 13 reported&#41;

    DescribeCol column = 2, name = dbl, namelen = 3, type = DOUBLE&#40;8&#41;,
precision/column size = 15, scale = 0, nullable = 0
     SQL_COLUMN_DISPLAY_SIZE = 22
     SQL_COLUMN_LENGTH = 15
     now using col 2: type = DOUBLE &#40;8&#41;, len = 15, display size = 23,
prec = 15, scale = 0

as above

    DescribeCol column = 3, name = num, namelen = 3, type = NUMERIC&#40;2&#41;,
precision/column size = 36, scale = 30, nullable = 0
     SQL_COLUMN_DISPLAY_SIZE = 38
     SQL_COLUMN_LENGTH = 38
     now using col 3: type = NUMERIC &#40;2&#41;, len = 38, display size = 39,
prec = 36, scale = 30

then it bound them all as chars as got a data truncation which should
not happen as all buffers passed were 1 bigger than the driver reported:

    Bind 1: type = CHAR&#40;1&#41;, buf=14adfc60, buflen=14
    Bind 2: type = CHAR&#40;1&#41;, buf=14adfc70, buflen=23
    Bind 3: type = CHAR&#40;1&#41;, buf=14adfc88, buflen=39

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 2&#41;DBD::ODBC regards it as SQL_LONGVARBINARY &#40;not sure if this is as it
&gt; should be&#41;.
</div>
What makes you think that? You did not provide the output from the
script you attached.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 3&#41;If I do not set LongTruncOk=1, it will fail with the same error.
</div>
because that is what LongTruncOk does.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 4&#41;However, if I do set LongTruncOk=1, looking at the result in the
&gt; debugger, I see &#34;123.456001281\c@&#34;, which is 14 characters long, with
&gt; the last character being NUL &#40;0x0&#41;.
</div>
All strings are nul terminated. DBD::ODBC provided a buffer of 14 bytes,
the driver had no choice but to write up to 13 bytes + a Nul or it would
have gone off the end of the buffer. The driver reported data truncation
so that suggests the driver thinks it can write more than 13 chrs for
the the real BUT it told us the display size was 13 so it lied.
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Now in the guessing territory: the driver says 13-character string,
&gt;    but
&gt; returns a 13-character NUL-terminated C string, thus causing &#34;too much
&gt; data&#34; condition. I am not sure whose fault this is -- the Sybase
&gt;    driver,
&gt; or DBD::ODBC &#40;either there should be no NUL character in BINARY type,
&gt;    or
&gt; it should classify it as a TEXT type of some kind to get the string
&gt; representation correctly&#41;. Am I making any sense?
</div>
yes, a reasonable guess but see my last comment above.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Note that it is not every FLOAT value that causes this &#40;extra NUL&#41;
&gt; situation. I initially thought that only small values cause this, but
&gt; this is clearly not the case, and I do not see any pattern.
</div>
The NUL is not the issue, I believe the driver is lying.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Attached are the Perl source and the log.
&gt; 
&gt; Thank you for your help,
&gt; Gregory
</div>
There is no easy way to prove the problem unless you are able to edit
DBD::ODBC and rebuild it. If you are then you could artificially
increment the value returned for SQL_COLUMN_DISPLAY_SIZE and prove the
driver wants to write more in the buffer than it told us it could. If
you can do that let me know and I&#39;ll tell you which line to change.

It may be useful if I knew some of the details about unixODBC I asked
you in the first email e.g., odbcinst -j and whether odbc_has_unicode is
enabled?

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;07&nbsp;05:00:56&nbsp;2012</span>
    <span class="description">bohica [...] ntlworld.com -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;29&nbsp;04:59:13&nbsp;2012</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Aug 09 05:27:41 2012, MJEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Tue Aug 07 12:11:57 2012, gregory.ionis@baml.com wrote:
<div class="message-stanza open">&gt; &gt; Martin,
&gt; &gt; 
&gt; &gt; I think I got some progress. I have 64-bit unixODBC and DBD::ODBC 
</div></div>now.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Running the same sample again, I observe the following &#40;please let 
</div></div>me
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; know if I am wrong&#41;:
&gt; &gt; 
&gt; &gt; 1&#41;For the FLOAT result driver reports type REAL with 13 character-
</div></div>long
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; display.
</div>&gt; 
&gt; From the log file the driver reports:
&gt; 
&gt; DescribeCol column = 1, name = flt, namelen = 3, type = REAL&#40;7&#41;,
&gt; precision/column size = 7, scale = 0, nullable = 0
&gt;      SQL_COLUMN_DISPLAY_SIZE = 13  &lt;---- NOTE THIS IS WHAT THE DRIVER 
</div>SAID
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;      SQL_COLUMN_LENGTH = 7
&gt;      now using col 1: type = REAL &#40;7&#41;, len = 7, display size = 14, 
</div>prec
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; = 7, scale = 0
&gt; 
&gt; NOTE: we are using a display size of 14 &#40;1 more than the 13 reported&#41;
&gt; 
&gt;     DescribeCol column = 2, name = dbl, namelen = 3, type = DOUBLE&#40;8&#41;,
&gt; precision/column size = 15, scale = 0, nullable = 0
&gt;      SQL_COLUMN_DISPLAY_SIZE = 22
&gt;      SQL_COLUMN_LENGTH = 15
&gt;      now using col 2: type = DOUBLE &#40;8&#41;, len = 15, display size = 23,
&gt; prec = 15, scale = 0
&gt; 
&gt; as above
&gt; 
&gt;     DescribeCol column = 3, name = num, namelen = 3, type = 
</div>NUMERIC&#40;2&#41;,
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; precision/column size = 36, scale = 30, nullable = 0
&gt;      SQL_COLUMN_DISPLAY_SIZE = 38
&gt;      SQL_COLUMN_LENGTH = 38
&gt;      now using col 3: type = NUMERIC &#40;2&#41;, len = 38, display size = 39,
&gt; prec = 36, scale = 30
&gt; 
&gt; then it bound them all as chars as got a data truncation which should
&gt; not happen as all buffers passed were 1 bigger than the driver 
</div>reported:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt;     Bind 1: type = CHAR&#40;1&#41;, buf=14adfc60, buflen=14
&gt;     Bind 2: type = CHAR&#40;1&#41;, buf=14adfc70, buflen=23
&gt;     Bind 3: type = CHAR&#40;1&#41;, buf=14adfc88, buflen=39
&gt; 
<div class="message-stanza open">&gt; &gt; 2&#41;DBD::ODBC regards it as SQL_LONGVARBINARY &#40;not sure if this is as 
</div></div>it
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; should be&#41;.
</div>&gt; 
&gt; What makes you think that? You did not provide the output from the
&gt; script you attached.
&gt; 
<div class="message-stanza open">&gt; &gt; 3&#41;If I do not set LongTruncOk=1, it will fail with the same error.
</div>&gt; 
&gt; because that is what LongTruncOk does.
&gt; 
<div class="message-stanza open">&gt; &gt; 4&#41;However, if I do set LongTruncOk=1, looking at the result in the
&gt; &gt; debugger, I see &#34;123.456001281\c@&#34;, which is 14 characters long, 
</div></div>with
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; the last character being NUL &#40;0x0&#41;.
</div>&gt; 
&gt; All strings are nul terminated. DBD::ODBC provided a buffer of 14 
</div>bytes,
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; the driver had no choice but to write up to 13 bytes + a Nul or it 
</div>would
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; have gone off the end of the buffer. The driver reported data 
</div>truncation
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; so that suggests the driver thinks it can write more than 13 chrs for
&gt; the the real BUT it told us the display size was 13 so it lied.
&gt;  
<div class="message-stanza open">&gt; &gt; Now in the guessing territory: the driver says 13-character string,
&gt; &gt;    but
&gt; &gt; returns a 13-character NUL-terminated C string, thus causing &#34;too 
</div></div>much
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; data&#34; condition. I am not sure whose fault this is -- the Sybase
&gt; &gt;    driver,
&gt; &gt; or DBD::ODBC &#40;either there should be no NUL character in BINARY 
</div></div>type,
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt;    or
&gt; &gt; it should classify it as a TEXT type of some kind to get the string
&gt; &gt; representation correctly&#41;. Am I making any sense?
</div>&gt; 
&gt; yes, a reasonable guess but see my last comment above.
&gt; 
<div class="message-stanza open">&gt; &gt; Note that it is not every FLOAT value that causes this &#40;extra NUL&#41;
&gt; &gt; situation. I initially thought that only small values cause this, 
</div></div>but
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; this is clearly not the case, and I do not see any pattern.
</div>&gt; 
&gt; The NUL is not the issue, I believe the driver is lying.
&gt; 
<div class="message-stanza open">&gt; &gt; Attached are the Perl source and the log.
&gt; &gt; 
&gt; &gt; Thank you for your help,
&gt; &gt; Gregory
</div>&gt; 
&gt; There is no easy way to prove the problem unless you are able to edit
&gt; DBD::ODBC and rebuild it. If you are then you could artificially
&gt; increment the value returned for SQL_COLUMN_DISPLAY_SIZE and prove the
&gt; driver wants to write more in the buffer than it told us it could. If
&gt; you can do that let me know and I&#39;ll tell you which line to change.
&gt; 
&gt; It may be useful if I knew some of the details about unixODBC I asked
&gt; you in the first email e.g., odbcinst -j and whether odbc_has_unicode 
</div>is
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; enabled?
&gt; 
&gt; Martin
</div>
This issue has not had any comments in a long time. My analysis is that 
your ODBC driver is broken and it is not an issue with DBD::ODBC. Do you 
have any issue with me closing this rt now?

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;29&nbsp;04:59:14&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;29&nbsp;08:46:07&nbsp;2012</span>
    <span class="description">gregory.ionis [...] baml.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #78186] Issue when DBD::ODBC upgraded from 1.24 to 1.37</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 29 Nov 2012 08:45:51 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;&#39;bug-DBD-ODBC [...] rt.cpan.org&#39;&#34; &lt;bug-DBD-ODBC [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Ionis, Gregory - RSCH AMRS&#34; &lt;gregory.ionis [...] baml.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Please close it. I am using a work-around for now, and have not had the time to dig deeper into the  ODBC driver.

Thank you for your help,
Gregory

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Martin J Evans via RT [mailto:bug-DBD-ODBC@rt.cpan.org] 
Sent: Thursday, November 29, 2012 4:59 AM
To: Ionis, Gregory - RSCH AMRS
Subject: [rt.cpan.org #78186] Issue when DBD::ODBC upgraded from 1.24 to 1.37

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=78186">https://rt.cpan.org/Ticket/Display.html?id=78186</a></span> &gt;

On Thu Aug 09 05:27:41 2012, MJEVANS wrote:
<div class="message-stanza open">&gt; On Tue Aug 07 12:11:57 2012, gregory.ionis@baml.com wrote:
<div class="message-stanza open">&gt; &gt; Martin,
&gt; &gt; 
&gt; &gt; I think I got some progress. I have 64-bit unixODBC and DBD::ODBC
</div></div>now.
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; Running the same sample again, I observe the following &#40;please let
</div></div>me
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; know if I am wrong&#41;:
&gt; &gt; 
&gt; &gt; 1&#41;For the FLOAT result driver reports type REAL with 13 character-
</div></div>long
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; display.
</div>&gt; 
&gt; From the log file the driver reports:
&gt; 
&gt; DescribeCol column = 1, name = flt, namelen = 3, type = REAL&#40;7&#41;, 
&gt; precision/column size = 7, scale = 0, nullable = 0
&gt;      SQL_COLUMN_DISPLAY_SIZE = 13  &lt;---- NOTE THIS IS WHAT THE DRIVER
</div>SAID
<div class="message-stanza open">&gt;      SQL_COLUMN_LENGTH = 7
&gt;      now using col 1: type = REAL &#40;7&#41;, len = 7, display size = 14,
</div>prec
<div class="message-stanza open">&gt; = 7, scale = 0
&gt; 
&gt; NOTE: we are using a display size of 14 &#40;1 more than the 13 reported&#41;
&gt; 
&gt;     DescribeCol column = 2, name = dbl, namelen = 3, type = DOUBLE&#40;8&#41;, 
&gt; precision/column size = 15, scale = 0, nullable = 0
&gt;      SQL_COLUMN_DISPLAY_SIZE = 22
&gt;      SQL_COLUMN_LENGTH = 15
&gt;      now using col 2: type = DOUBLE &#40;8&#41;, len = 15, display size = 23, 
&gt; prec = 15, scale = 0
&gt; 
&gt; as above
&gt; 
&gt;     DescribeCol column = 3, name = num, namelen = 3, type =
</div>NUMERIC&#40;2&#41;,
<div class="message-stanza open">&gt; precision/column size = 36, scale = 30, nullable = 0
&gt;      SQL_COLUMN_DISPLAY_SIZE = 38
&gt;      SQL_COLUMN_LENGTH = 38
&gt;      now using col 3: type = NUMERIC &#40;2&#41;, len = 38, display size = 39, 
&gt; prec = 36, scale = 30
&gt; 
&gt; then it bound them all as chars as got a data truncation which should 
&gt; not happen as all buffers passed were 1 bigger than the driver
</div>reported:
<div class="message-stanza open">&gt; 
&gt;     Bind 1: type = CHAR&#40;1&#41;, buf=14adfc60, buflen=14
&gt;     Bind 2: type = CHAR&#40;1&#41;, buf=14adfc70, buflen=23
&gt;     Bind 3: type = CHAR&#40;1&#41;, buf=14adfc88, buflen=39
&gt; 
<div class="message-stanza open">&gt; &gt; 2&#41;DBD::ODBC regards it as SQL_LONGVARBINARY &#40;not sure if this is as
</div></div>it
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; should be&#41;.
</div>&gt; 
&gt; What makes you think that? You did not provide the output from the 
&gt; script you attached.
&gt; 
<div class="message-stanza open">&gt; &gt; 3&#41;If I do not set LongTruncOk=1, it will fail with the same error.
</div>&gt; 
&gt; because that is what LongTruncOk does.
&gt; 
<div class="message-stanza open">&gt; &gt; 4&#41;However, if I do set LongTruncOk=1, looking at the result in the 
&gt; &gt; debugger, I see &#34;123.456001281\c@&#34;, which is 14 characters long,
</div></div>with
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; the last character being NUL &#40;0x0&#41;.
</div>&gt; 
&gt; All strings are nul terminated. DBD::ODBC provided a buffer of 14
</div>bytes,
<div class="message-stanza open">&gt; the driver had no choice but to write up to 13 bytes + a Nul or it
</div>would
<div class="message-stanza open">&gt; have gone off the end of the buffer. The driver reported data
</div>truncation
<div class="message-stanza open">&gt; so that suggests the driver thinks it can write more than 13 chrs for 
&gt; the the real BUT it told us the display size was 13 so it lied.
&gt;  
<div class="message-stanza open">&gt; &gt; Now in the guessing territory: the driver says 13-character string,
&gt; &gt;    but
&gt; &gt; returns a 13-character NUL-terminated C string, thus causing &#34;too
</div></div>much
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; data&#34; condition. I am not sure whose fault this is -- the Sybase
&gt; &gt;    driver,
&gt; &gt; or DBD::ODBC &#40;either there should be no NUL character in BINARY
</div></div>type,
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;    or
&gt; &gt; it should classify it as a TEXT type of some kind to get the string 
&gt; &gt; representation correctly&#41;. Am I making any sense?
</div>&gt; 
&gt; yes, a reasonable guess but see my last comment above.
&gt; 
<div class="message-stanza open">&gt; &gt; Note that it is not every FLOAT value that causes this &#40;extra NUL&#41; 
&gt; &gt; situation. I initially thought that only small values cause this,
</div></div>but
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; this is clearly not the case, and I do not see any pattern.
</div>&gt; 
&gt; The NUL is not the issue, I believe the driver is lying.
&gt; 
<div class="message-stanza open">&gt; &gt; Attached are the Perl source and the log.
&gt; &gt; 
&gt; &gt; Thank you for your help,
&gt; &gt; Gregory
</div>&gt; 
&gt; There is no easy way to prove the problem unless you are able to edit 
&gt; DBD::ODBC and rebuild it. If you are then you could artificially 
&gt; increment the value returned for SQL_COLUMN_DISPLAY_SIZE and prove the 
&gt; driver wants to write more in the buffer than it told us it could. If 
&gt; you can do that let me know and I&#39;ll tell you which line to change.
&gt; 
&gt; It may be useful if I knew some of the details about unixODBC I asked 
&gt; you in the first email e.g., odbcinst -j and whether odbc_has_unicode
</div>is
<div class="message-stanza open">&gt; enabled?
&gt; 
&gt; Martin
</div>
This issue has not had any comments in a long time. My analysis is that your ODBC driver is broken and it is not an issue with DBD::ODBC. Do you have any issue with me closing this rt now?

Martin
--
Martin J. Evans
Wetherby, UK

----------------------------------------------------------------------
This message, and any attachments, is for the intended recipient&#40;s&#41; only, may contain information that is privileged, confidential and/or proprietary and subject to important terms and conditions available at <span class="clickylink"><a target="new" rel="nofollow" href="http://www.bankofamerica.com/emaildisclaimer">http://www.bankofamerica.com/emaildisclaimer</a></span>.   If you are not the intended recipient, please delete this message.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;29&nbsp;08:57:37&nbsp;2012</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Closing after correspondence with OP &#34;Please close it. I am using a
work-around for now, and have not had the time to dig deeper into the 
ODBC driver.&#34;

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;29&nbsp;08:57:37&nbsp;2012</span>
    <span class="description">bohica [...] ntlworld.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
