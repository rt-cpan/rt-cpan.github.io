<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #32479 for DBD-Pg: DBD-Pg 2.0.0_4, utf8 array data</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #32479 for DBD-Pg: DBD-Pg 2.0.0_4, utf8 array data</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBD-Pg">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBD-Pg">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBD-Pg">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBD-Pg">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-Pg">DBD-Pg CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">32479</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBD-Pg">DBD-Pg</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
aw [...] ice-sa.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10200-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10201-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
2.0.0    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=32479">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-411217" href="/Public/Bug/Display.html?id=32479#txn-411217">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;21&nbsp;10:58:11&nbsp;2008</span>
    <span class="description">aw [...] ice-sa.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> DBD-Pg 2.0.0_4, utf8 array data</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 21 Jan 2008 16:57:06 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-Pg [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> AndrÃ© Warnier &lt;aw [...] ice-sa.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/411217/200486/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/200486">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi.

There seems to be a problem in the handling of INSERT for utf-8 text[] 
array data.

The platform :
# DBI                   Version 1.601
# DBD::Pg               Version 2.0.0_4
# Perl                  Version 5.8.8
# OS                    linux
platform : Linux arthur 2.6.18-4-686 #1 SMP Wed May 9 23:03:12 UTC 2007 
i686 GNU/Linux   &#40;Debian Etch&#41;
Postgres version&#40;&#41; :
  PostgreSQL 8.1.11 on i486-pc-linux-gnu, compiled by GCC cc &#40;GCC&#41; 4.1.2 
20061115 &#40;prerelease&#41; &#40;Debian 4.1.1-21&#41;

The error message :
[2008/01/21-13:18:40] [warning] DBD::Pg::st execute failed: ERROR: 
invalid byte sequence for encoding &#34;UTF8&#34;: 0xfe
HINT:  This error can also happen if the byte sequence does not match 
the encoding expected by the server, which is controlled by 
&#34;client_encoding&#34;.

This occurs when executing a prepared statement, loading some text data 
into a text[] column, when the text data of one or more of the array 
contains non-US-ASCII characters.

The target Pg database was created with an encoding of UTF8.
The process loading the data via DBD-Pg has LANG and LC_CTYPE set to 
&#34;en_GB.utf8&#34;. &#40;using another locale does not change the problem&#41;.

I have also tried :
1&#41; to set the attribute { pg_enable_utf8 =&gt; 1 } in the DBI-&gt;connect&#40;&#41; call
2&#41; after the connect call, to do :
binmode&#40;$dbh-&gt;{pg_socket},&#39;:utf8&#39;&#41;;

but none of those seem to make a difference.

Description of program :
The program reads an iso-8859-1 text data file, and loads this data 
first into a Perl Hashtable, and from there into a Pg table via a 
prepared and executed INSERT statement.  The original data, and the 
columns of the Pg table are type &#39;text&#39;, or text[] arrays.
The data is read into Perl via a filhandle opened with the proper I/O 
layer, like : open&#40;IN,&#39;&lt;:encoding&#40;&#39;iso-8859-1&#39;,$file&#41;
The data loading works fine, as long as the elements of the text arrays 
do not contain multi-byte utf8 data &#40;chr codes below 128 decimal&#41;.  As 
soon as one element contains a multi-byte utf8 character however, the 
message above appears and the execute&#40;&#41; fails.
The offending data looks originally like this :

     [sbed element] = Arbeitsschutz
     [sbed element] = Atemschutz
     [sbed element] = Gruppeneinteilung
     [sbed element] = Kenntlichmachung
     [sbed element] = Markierung
     [sbed element] = SchutzausrÃ¼stung
     [sbed element] = SchutzgerÃ¤t
     [sbee element] = Classification
     [sbee element] = Marking
     [sbee element] = Markings
     [sbee element] = Occupational safety
     [sbee element] = Protective equipment
     [sbee element] = Respiratory protections
     [sbef element] = SÃ©curitÃ© industrielle
     [sbef element] = HygiÃ¨ne du travail
     [sbef element] = SÃ©curitÃ© du travail
     [sbef element] = Protection respiratoire
     [sbef element] = Marquage
     [sbef element] = Equipement de protection

If, prior to loading the data into Pg, I test it in my program with the 
Encode::is_utf8&#40;&#41; function, I can confirm that as far as Perl is 
concerned, this is properly utf8-marked data.
If, prior to loading this data into Pg, I modify the strings above with 
a regexp to replace the various &#34;diacritic&#34; characters by for example a 
&#34;-&#34; &#40;minus&#41; sign, then the data loads fine.

The execute statment is as follows :
$sth-&gt;execute&#40;@values_list&#41;
where @values_list is an array contain elements that are either
- single scalar text variables
or
- references to arrays whose element contain individual text strings.
The problem above does not seem to appear for non-array &#39;text&#39; columns, 
even when the data contains utf8 multi-byte characters, and only appears 
for array-type data and columns.

I am quite experienced at using utf8 data in Perl, and converting 
to/from various encodings.

Best regards,
AndrÃ©
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-411396" href="/Public/Bug/Display.html?id=32479#txn-411396">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;21&nbsp;23:50:09&nbsp;2008</span>
    <span class="description">greg [...] turnstep.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/411396/200585/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/200585">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 204b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the detailed report. This should be fixed as of r10631. There
are also some new tests in t/09array.t: it would be much appreciated if
someone good with utf-8 &#40;e.g. not me&#41; would look them over.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-411397" href="/Public/Bug/Display.html?id=32479#txn-411397">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;21&nbsp;23:50:11&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-411723" href="/Public/Bug/Display.html?id=32479#txn-411723">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;22&nbsp;11:28:13&nbsp;2008</span>
    <span class="description">aw [...] ice-sa.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #32479] DBD-Pg 2.0.0_4, utf8 array data</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 22 Jan 2008 17:26:41 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-Pg [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> AndrÃ© Warnier &lt;aw [...] ice-sa.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/411723/200881/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/200881">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 5.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi.

Greg Sabino Mullane via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=32479">http://rt.cpan.org/Ticket/Display.html?id=32479</a></span> &gt;
&gt; 
&gt; Thanks for the detailed report. This should be fixed as of r10631. There
&gt; are also some new tests in t/09array.t: it would be much appreciated if
&gt; someone good with utf-8 &#40;e.g. not me&#41; would look them over.
&gt; 
</div>
r10631 looks good.  I have loaded several thousand rows with utf-8 text 
scalar and array data, and so far it seems ok.
Many thanks for the quick fix.

About the tests : I do have some good experience handling utf-8 data and 
conversions to/from it in perl, but I am no wizard programmer, and a 
real beginner regarding DBI, DBD, and relational DBMS systems in general.
Thus the test code in t/09array.t is frankly beyond my capacities.
All I can say is that the creation of a perl utf-8 string via
my $utf8_str = chr&#40;0x100&#41;.&#39;dam&#39;;
will work no matter which locale the script is running under &#40;which is 
not as obvious as it seems&#41;.
As long as this string is not modified in any way, perl will not 
&#34;downgrade&#34; it back to non-utf8.
But you modify the string &#40;such as adding quotes&#41;, then you have to be 
careful.  I believe that perl might, in some cases, discard the original 
string and create a new one which may not have the utf8 flag set.
Because of the character chosen, this may never happen under an 
iso-latin-1 locale, but might happen if the script is run under a locale 
where this character is a &#34;byte&#34; in the current locale.
The way to check if the resulting string is still utf8-encoded &#40;or, 
rather, marked as such&#41;, is to test it with &#34;Encode::is_utf8&#40;$string&#41;&#34;.


As a more general note :
I find that there is some ambiguity regarding the &#39;pg_enable_utf8&#39; 
attribute, and even wonder if it should be there at all.

I know this is a messy subject, and I hope I will not mess up the 
following explanation of what I mean.

Perl has two internal representations of strings : a string is either a 
collection of &#34;bytes&#34;, or a collection of &#34;characters&#34;. In that last 
case, the characters are in utf8 encoding, and the string is internally 
marked with &#34;the utf8 flag on&#34;.
For the sake of what follows, let&#39;s just assume that Perl does it right, 
always knows the encoding of one of it&#39;s internal string values, and 
converts from the one to the other appropriately whenever there is a 
need for it.

For text data that perl reads in from the outside, perl will convert &#40;or 
not&#41; the external data to one of its internal representations, according 
to the &#34;I/O layer&#34; specified for the corresponding filehandle.
&#40;like &#34;open&#40;FH,&#39;&lt;:utf8&#39;,$file&#41;&#34;&#41;
In this case, the correct layer to use must be specified by the 
programmer, because perl has no way to know the encoding of this 
external data.
In other words, if you tell perl that the external source is data in 
UTF-8, then perl will treat all data received from there as UTF-8, 
convert it or not while reading it, and mark it accordingly in the 
internal variables in which it is read.

In the case of data read from Pg into Perl,
- perl similarly always needs to know the encoding of any data which it 
reads, so as to be able to convert it correctly into its internal 
representation &#40;*&#41;.
- the encoding of the incoming Pg data should be fixed by the encoding 
in which this data is stored in the Pg database
- unless I am mistaken, Pg always &#34;knows&#34; the encoding of the data 
stored in the columns of any given database, and DBD::Pg can find out by 
itself, and set up the appropriate conversion I/O layer if needed.
&#40;This does not only apply to UTF8, but to any encoding supported by Pg&#41;.

On the perl-&gt;to-&gt;Pg side :
The perl script has some data in either one of its internal 
representations, which it wishes to write into a Pg table, via DBD::Pg.
If the Pg database is defined as being in some encoding, then writing 
data to the db using another encoding would always be invalid.
If perl knows the correct encoding to use for the database, it can 
convert any of its internal strings to the appropriate encoding for that 
Pg database.
DBD::Pg can find out which is the appropriate encoding for the target 
database.
Ergo, there should be no need for any separate attribute to tell perl or 
DBD::Pg which conversion to use on the way from perl to Pg.

Just about the only reason I can think of, for an attribute or a setting 
to be used is if, for some unusual reason, one wanted to tell DBD::Pg to 
*not* do any character translations at all, and consider all the data as 
bytes &#40;the equivalent of the &#34;:raw&#34; layer of perl&#41;.
And maybe this could be 2 attributes :
- perl_to_pg_raw
- pg_to_perl_raw
&#40;as &#39;in&#39; or &#39;out&#39; can be confusing to mere mortals like me&#41;
so as to be able to turn this on or off separately.
I could see this as useful if one wanted to do some &#34;bulk load&#34; or &#34;bulk 
unload&#34; of data to/from Pg, and knew in advance that no translation is 
needed either way, to avoid the translation overhead.

&#40;*&#41; the main question in my mind with the &#34;pg_enable_utf8&#34; attribute is 
the following :
Suppose I create a perl script that accesses a Pg database and reads 
rows from it.
Suppose the database has the UTF8 encoding &#40;**&#41;, but I don&#39;t know this, 
so I don&#39;t set the &#34;pg_enable_utf8&#34; attribute &#40;**&#41;.
What happens when I read data from the database ?
In fact, why should I have to know the database encoding, unless my 
needs are really special?
&#40;I mean, considering that Perl and DBD::Pg could easily figure out by 
themselves and do the appropriate conversions&#41;

&#40;**&#41; or any other encoding-related setting

I can easily imagine that things might not be as simple as setting up 
the filehandles to Pg with the appropriate encoding layers.  There may 
also be a host of unintended interferences with DBI, or Proxy modules e.g.
Maybe an initial step could be
- to provide an easy call in DBD::Pg to get the internal database 
encoding &#40;with possibly a translation between the Pg encoding codes to 
the corresponding Perl Encoding charset names&#41;
- to provide explicit function calls to set the encoding layer to use 
&#40;or attributes to the connect&#40;&#41;&#41;.

Best regards,
AndrÃ©
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-411743" href="/Public/Bug/Display.html?id=32479#txn-411743">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;22&nbsp;12:36:51&nbsp;2008</span>
    <span class="description">david [...] kineticode.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #32479] DBD-Pg 2.0.0_4, utf8 array data</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 22 Jan 2008 09:36:10 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-Pg [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;david [...] kineticode.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/411743/200893/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/200893">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 346b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Jan 22, 2008, at 08:28, AndrÃ© Warnier via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&gt; Thanks for the detailed report. This should be fixed as of r10631.  
&gt;&gt; There
&gt;&gt; are also some new tests in t/09array.t: it would be much  
&gt;&gt; appreciated if
&gt;&gt; someone good with utf-8 &#40;e.g. not me&#41; would look them over.
</div>
I added a few more tests, but it looks good to me.

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-411999" href="/Public/Bug/Display.html?id=32479#txn-411999">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;22&nbsp;19:35:38&nbsp;2008</span>
    <span class="description">greg [...] turnstep.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> dbd-pg [...] perl.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> dbd-pg [...] perl.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #32479] DBD-Pg 2.0.0_4, utf8 array data</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 23 Jan 2008 00:36:41 -0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-Pg [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Greg Sabino Mullane&#34; &lt;greg [...] turnstep.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/411999/201048/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/201048">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
-----BEGIN PGP SIGNED MESSAGE-----
Hash: RIPEMD160


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Many thanks for the quick fix.
</div>
Your welcome.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The way to check if the resulting string is still utf8-encoded &#40;or,
&gt; rather, marked as such&#41;, is to test it with &#34;Encode::is_utf8&#40;$string&#41;&#34;.
</div>
David applied those checks, thanks to you both for that.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I find that there is some ambiguity regarding the &#39;pg_enable_utf8&#39;
&gt; attribute, and even wonder if it should be there at all.
</div>
Yeah, I&#39;m not sure either, but it may be due to the fact that we have
to support Perl 5.6 as well.

...snip lots of good stuff...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I could see this as useful if one wanted to do some &#34;bulk load&#34;
&gt; or &#34;bulk unload&#34; of data to/from Pg, and knew in advance that no
&gt; translation is needed either way, to avoid the translation overhead.
</div>
Yes, could be that too.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; - to provide an easy call in DBD::Pg to get the internal database
&gt; encoding &#40;with possibly a translation between the Pg encoding codes to
&gt; the corresponding Perl Encoding charset names&#41;
</div>
Yes, that should be easy enough.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; - to provide explicit function calls to set the encoding layer to use
&gt; &#40;or attributes to the connect&#40;&#41;&#41;.
</div>
Likewise.

Thanks. I&#39;m hesistant to do anything more than fix bugs at this point,
but we definitely need to hash out the whole utf-8 business in a
future release.

- --
Greg Sabino Mullane greg@turnstep.com
PGP Key: 0x14964AC8 200801221933
<span class="clickylink"><a target="new" rel="nofollow" href="http://biglumber.com/x/web?pk=2529DF6AB8F79407E94445B4BC9B906714964AC8">http://biglumber.com/x/web?pk=2529DF6AB8F79407E94445B4BC9B906714964AC8</a></span>
-----BEGIN PGP SIGNATURE-----

iD8DBQFHlot6vJuQZxSWSsgRAyoAAKC/eSGMTOn8FDBkVBtSRNloZX71qQCggJdC
ig9/pcozUZhPHoX26XMi2Wc=
=veKq
-----END PGP SIGNATURE-----
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-412002" href="/Public/Bug/Display.html?id=32479#txn-412002">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;22&nbsp;19:50:45&nbsp;2008</span>
    <span class="description">greg [...] turnstep.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> dbd-pg [...] perl.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> dbd-pg [...] perl.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #32479] DBD-Pg 2.0.0_4, utf8 array data</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 23 Jan 2008 00:36:41 -0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-Pg [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Greg Sabino Mullane&#34; &lt;greg [...] turnstep.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/412002/201051/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/201051">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
-----BEGIN PGP SIGNED MESSAGE-----
Hash: RIPEMD160


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Many thanks for the quick fix.
</div>
Your welcome.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The way to check if the resulting string is still utf8-encoded &#40;or,
&gt; rather, marked as such&#41;, is to test it with &#34;Encode::is_utf8&#40;$string&#41;&#34;.
</div>
David applied those checks, thanks to you both for that.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I find that there is some ambiguity regarding the &#39;pg_enable_utf8&#39;
&gt; attribute, and even wonder if it should be there at all.
</div>
Yeah, I&#39;m not sure either, but it may be due to the fact that we have
to support Perl 5.6 as well.

...snip lots of good stuff...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I could see this as useful if one wanted to do some &#34;bulk load&#34;
&gt; or &#34;bulk unload&#34; of data to/from Pg, and knew in advance that no
&gt; translation is needed either way, to avoid the translation overhead.
</div>
Yes, could be that too.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; - to provide an easy call in DBD::Pg to get the internal database
&gt; encoding &#40;with possibly a translation between the Pg encoding codes to
&gt; the corresponding Perl Encoding charset names&#41;
</div>
Yes, that should be easy enough.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; - to provide explicit function calls to set the encoding layer to use
&gt; &#40;or attributes to the connect&#40;&#41;&#41;.
</div>
Likewise.

Thanks. I&#39;m hesistant to do anything more than fix bugs at this point,
but we definitely need to hash out the whole utf-8 business in a
future release.

- --
Greg Sabino Mullane greg@turnstep.com
PGP Key: 0x14964AC8 200801221933
<span class="clickylink"><a target="new" rel="nofollow" href="http://biglumber.com/x/web?pk=2529DF6AB8F79407E94445B4BC9B906714964AC8">http://biglumber.com/x/web?pk=2529DF6AB8F79407E94445B4BC9B906714964AC8</a></span>
-----BEGIN PGP SIGNATURE-----

iD8DBQFHlot6vJuQZxSWSsgRAyoAAKC/eSGMTOn8FDBkVBtSRNloZX71qQCggJdC
ig9/pcozUZhPHoX26XMi2Wc=
=veKq
-----END PGP SIGNATURE-----
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-412004" href="/Public/Bug/Display.html?id=32479#txn-412004">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;22&nbsp;19:51:50&nbsp;2008</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #32479] DBD-Pg 2.0.0_4, utf8 array data</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 22 Jan 2008 16:51:25 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-Pg [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/412004/201053/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/201053">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Jan 22, 2008, at 16:35, Greg Sabino Mullane via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; I find that there is some ambiguity regarding the &#39;pg_enable_utf8&#39;
&gt;&gt; attribute, and even wonder if it should be there at all.
</div>&gt;
&gt; Yeah, I&#39;m not sure either, but it may be due to the fact that we have
&gt; to support Perl 5.6 as well.
</div>
I think that it&#39;s there for those of us who only use UTF-8 in the  
database, and so just want the flag to always be turned on, without  
doing the decoding.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ...snip lots of good stuff...
</div>
Yes, I agree that it would be ideal if the driver could tell what  
encoding to use for the database. I discussed the utf8 issue with Tim  
Bunce on the DBI developers list a few years ago, and he seemed  
interested in having some sort of flag that would indicate whether or  
not data was utf8, similar to the pg_enable_utf8 flag &#40;bug smarter&#41;,  
but this idea of yours, AndrÃ©, is an even better one. It might be  
worth bringing up on dbi-dev as a proposal for DBI in general, since  
all of the drivers have this problem, and all of the databases know  
their encodings.

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-420149" href="/Public/Bug/Display.html?id=32479#txn-420149">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;11&nbsp;09:54:48&nbsp;2008</span>
    <span class="description">greg [...] turnstep.com -  Fixed in 2.0.0 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-420150" href="/Public/Bug/Display.html?id=32479#txn-420150">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;11&nbsp;09:54:48&nbsp;2008</span>
    <span class="description">greg [...] turnstep.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/420150/205260/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/205260">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 110b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m going to resolve this particular bug, and open a new &#34;wishlist&#34; item
about better utf8 support in general.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-420153" href="/Public/Bug/Display.html?id=32479#txn-420153">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;11&nbsp;09:54:50&nbsp;2008</span>
    <span class="description">greg [...] turnstep.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.581936</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
