<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #107159 for DBIx-Class: Bug:  Spurious rollback when commit fails</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #107159 for DBIx-Class: Bug:  Spurious rollback when commit fails</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBIx-Class">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBIx-Class">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBIx-Class">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBIx-Class">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBIx-Class">DBIx-Class CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">107159</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBIx-Class">DBIx-Class</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">ribasushi [...] leporine.io
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
cpt [...] novozymes.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10410-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10411-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.082840    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=107159">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1536349" href="/Public/Bug/Display.html?id=107159#txn-1536349">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;18&nbsp;04:38:40&nbsp;2015</span>
    <span class="description">cpt [...] novozymes.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Bug:  Spurious rollback when commit fails</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 18 Sep 2015 10:38:17 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-DBIx-Class [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christopher Travers &lt;cpt [...] novozymes.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1536349/819964/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819964">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is reproduced in DBIx::Class from Ubuntu 14.04, but the code didn&#39;t 
look that different for most recent so I figured it was almost certain 
to exist there too.

Scenario:  Initially deferred constraints and PostgreSQL violated by a 
$schema-&gt;txn_do&#40;&#41; transaction.

This would be common in cases where you might have a circular foreign 
key constraint and so you check one at insert time and the other at 
commit time &#40;in our case, it is slightly different -- it is a custom 
constraint trigger but one which enforces something conceptually similar&#41;.

What happens:

rollback ineffective with AutoCommit enabled
         at 
DBIx::Class::Storage::DBI::_exec_txn_rollback&#40;/usr/share/perl5/DBIx/Class/Storage/DBI.pm 
line 1552, &lt;DATA&gt;:751&#41;
         at 
DBIx::Class::Storage::txn_rollback&#40;/usr/share/perl5/DBIx/Class/Storage.pm:255&#41;
         at 
DBIx::Class::Storage::DBI::txn_rollback&#40;/usr/share/perl5/DBIx/Class/Storage/DBI.pm:1538&#41;
         at &lt;eval&gt;&#40;/usr/share/perl5/DBIx/Class/Storage/BlockRunner.pm:174&#41;
         at 
DBIx::Class::Storage::BlockRunner::__ANON__&#40;/usr/share/perl5/DBIx/Class/Storage/BlockRunner.pm:174&#41;
         at 
Context::Preserve::preserve_context&#40;/usr/share/perl5/Context/Preserve.pm:27&#41;
         at 
DBIx::Class::Storage::BlockRunner::_run&#40;/usr/share/perl5/DBIx/Class/Storage/BlockRunner.pm:221&#41;
         at 
DBIx::Class::Storage::BlockRunner::run&#40;/usr/share/perl5/DBIx/Class/Storage/BlockRunner.pm:112&#41;
         at 
DBIx::Class::Storage::txn_do&#40;/usr/share/perl5/DBIx/Class/Storage.pm:189&#41;
         at 
DBIx::Class::Storage::DBI::txn_do&#40;/usr/share/perl5/DBIx/Class/Storage/DBI.pm:816&#41;
         at 
DBIx::Class::Schema::txn_do&#40;/usr/share/perl5/DBIx/Class/Schema.pm:656&#41;
         ....

DBIC_TRACE shows that the commit that raised the error was followed by a 
rollback.  There was no additional begin transaction statement, and 
tracing the code via the call stack shows that the commit occurs and the 
exception is handled properly.

Impact:  This is primarily an issue of clarity of the logs.  An error 
like this could indicates a transaction was committed twice but it 
doesn&#39;t say enough by itself that one can quickly/easily determine that 
it was an exception on commit.  This means that while the bug is itself 
harmless it can make it harder to spot harmful bugs in the log files, 
and that can eventually result in data loss &#40;when combined with other 
bugs of course&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1536352" href="/Public/Bug/Display.html?id=107159#txn-1536352">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;18&nbsp;04:46:53&nbsp;2015</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #107159] Bug:  Spurious rollback when commit fails</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 18 Sep 2015 10:46:38 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Rabbitson &lt;ribasushi [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1536352/819967/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819967">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 09/18/2015 10:38 AM, Christopher Travers via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Fri Sep 18 04:38:40 2015: Request 107159 was acted upon.
&gt; Transaction: Ticket created by cpt@novozymes.com
&gt;         Queue: DBIx-Class
&gt;       Subject: Bug:  Spurious rollback when commit fails
&gt;     Broken in: &#40;no value&#41;
&gt;      Severity: &#40;no value&#41;
&gt;         Owner: Nobody
&gt;    Requestors: cpt@novozymes.com
&gt;        Status: new
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107159">https://rt.cpan.org/Ticket/Display.html?id=107159</a></span> &gt;
&gt;
&gt;
&gt; This is reproduced in DBIx::Class from Ubuntu 14.04
</div>
Could you please tell me the *exact* version you are running. &#34;from 
Ubuntu 14.04&#34; is too ambiguous for correct analysis.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Scenario:  Initially deferred constraints and PostgreSQL violated by a
&gt; $schema-&gt;txn_do&#40;&#41; transaction.
</div>
Please show an example invocation of this &#40; ideally as an addition to 
this block: 
<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/RIBASUSHI/DBIx-Class-0.082820/t/72pg.t#L441-464">https://metacpan.org/source/RIBASUSHI/DBIx-Class-0.082820/t/72pg.t#L441-464</a></span>, 
or at least as some sort of pseudocode &#41;. The stacktrace while useful is 
not conductive to recreating the internal state of the various objects - 
this can be done only by executing a set of steps in an order you did.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; DBIC_TRACE shows that the commit that raised the error was followed by a
&gt; rollback.  There was no additional begin transaction statement, and
&gt; tracing the code via the call stack shows that the commit occurs and the
&gt; exception is handled properly.
&gt;
&gt; Impact:  This is primarily an issue of clarity of the logs.
</div>
This part isn&#39;t relevant. A commit followed by rollback is most 
definitely a defect and needs fixing.

Please get more of the requested info to get this fixed.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1536353" href="/Public/Bug/Display.html?id=107159#txn-1536353">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;18&nbsp;04:46:54&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1536361" href="/Public/Bug/Display.html?id=107159#txn-1536361">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;18&nbsp;05:27:08&nbsp;2015</span>
    <span class="description">cpt [...] novozymes.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #107159] Bug:  Spurious rollback when commit fails</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 18 Sep 2015 11:26:53 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-DBIx-Class [...] rt.cpan.org&#34; &lt;bug-DBIx-Class [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christopher Travers &lt;cpt [...] novozymes.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1536361/819971/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819971">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">

On 2015-09-18 10:46, Peter Rabbitson via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107159">https://rt.cpan.org/Ticket/Display.html?id=107159</a></span> &gt;
&gt;
&gt; On 09/18/2015 10:38 AM, Christopher Travers via RT wrote:
<div class="message-stanza open">&gt;&gt; Fri Sep 18 04:38:40 2015: Request 107159 was acted upon.
&gt;&gt; Transaction: Ticket created by cpt@novozymes.com
&gt;&gt;          Queue: DBIx-Class
&gt;&gt;        Subject: Bug:  Spurious rollback when commit fails
&gt;&gt;      Broken in: &#40;no value&#41;
&gt;&gt;       Severity: &#40;no value&#41;
&gt;&gt;          Owner: Nobody
&gt;&gt;     Requestors: cpt@novozymes.com
&gt;&gt;         Status: new
&gt;&gt;    Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107159">https://rt.cpan.org/Ticket/Display.html?id=107159</a></span> &gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; This is reproduced in DBIx::Class from Ubuntu 14.04
</div>&gt; Could you please tell me the *exact* version you are running. &#34;from
&gt; Ubuntu 14.04&#34; is too ambiguous for correct analysis.
</div>
$ perl -MDBIx::Class -M5.010 -e &#39;say $DBIx::Class::VERSION&#39;
0.08250


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
<div class="message-stanza open">&gt;&gt; Scenario:  Initially deferred constraints and PostgreSQL violated by a
&gt;&gt; $schema-&gt;txn_do&#40;&#41; transaction.
</div>&gt; Please show an example invocation of this &#40; ideally as an addition to
&gt; this block:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/RIBASUSHI/DBIx-Class-0.082820/t/72pg.t#L441-464">https://metacpan.org/source/RIBASUSHI/DBIx-Class-0.082820/t/72pg.t#L441-464</a></span>,
&gt; or at least as some sort of pseudocode &#41;. The stacktrace while useful is
&gt; not conductive to recreating the internal state of the various objects -
</div>REPRO SCENARIO:
===============

In our db schema, we create a deferrable, by default deferred constraint 
trigger:

CREATE CONSTRAINT TRIGGER artistid_deferred_not_null&#40;&#41;
RETURNS TRIGGER LANGUAGE PLPGSQL AS
$$
BEGIN
    IF new.artistid IS NULL THEN
        RAISE EXCEPTION &#39;Bad Transaction&#39;;
    END IF;
    RETURN new;
END
$$;

CREATE CONSTRAINT TRIGGER artistid_eventually_not_null
AFTER INSERT OR UPDATE ON cd
FOR EACH ROW EXECUTE PROCEDURE artistid_deferred_not_null&#40;&#41;
DEFERRABLE INITIALLY DEFERRED; -- the critical part is this line

This means that the trigger is fired, by default, at commit time, not at 
db insert or update time.  If it fails, it raises an exception on the 
commit statement itself.

Then in the Perl code the following would work:

$schema-&gt;txn_do&#40;sub {
      $cd = |$schema||-&gt;resultset&#40;||&#39;CD&#39;||&#41;-&gt;create&#40;{|
|||||||cdid| |=&gt; 999, ||year| |=&gt; ||&#39;2003&#39;||, ||title| |=&gt; ||&#39;deferred 
FK cd&#39;|
|||}&#41;;
     # hmmmm where is the artist?  oh ok let&#39;s assign to one after all.
     $cd-&gt;artistid&#40;1&#41;;
     $cd-&gt;update&#40;&#41;; # if you comment this out then, you get the warning.
}&#41;;

But if we comment out the $cd-&gt;update, it should fail and it does.

But the problem is then that when the commit fails, the exception 
triggers a rollback then outside the transaction. This leads to a warning.

Does this make sense?

CODE TRACING I HAVE DONE THUS FAR
==================================

What is happening in the code &#40;via the stack trace&#41;:

1.  Transaction is executed in a try block.  In the catch we catch 
errors and assign them to a variable in an outer scope.
2.  As we go through we check if we had an error and if so, roll back 
the transaction.  However because the commit statement issued the 
transaction, there is no transaction to roll back. Hence DBI throws a 
warning.....

I suspect the solution check the db handle as to whether it has begun 
work or not before issuing the roll back. Since the commit statement 
failed, we are both out of the transaction and with an exception which 
requires the commit statement itself to raise the exception.|
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1536361/819972/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819972">with headers</a>
<br />
<span class="downloadcontenttype">text/html 5.7k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1536363" href="/Public/Bug/Display.html?id=107159#txn-1536363">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;18&nbsp;05:53:38&nbsp;2015</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #107159] Bug:  Spurious rollback when commit fails</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 18 Sep 2015 11:53:23 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Rabbitson &lt;ribasushi [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1536363/819974/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819974">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 09/18/2015 11:27 AM, Christopher Travers via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; $ perl -MDBIx::Class -M5.010 -e &#39;say $DBIx::Class::VERSION&#39;
&gt; 0.08250
&gt;
</div>
rabbit@Ahasver:~/devel/dbic$ git diff -w --stat  v0.08250..v0.082820 -- 
lib/DBIx/Class/Storage.pm lib/DBIx/Class/Storage/DBI.pm 
lib/DBIx/Class/Storage/BlockRunner.pm
  lib/DBIx/Class/Storage.pm             |  40 +++++-----
  lib/DBIx/Class/Storage/BlockRunner.pm | 135 
+++++++++++++++++-----------------
  lib/DBIx/Class/Storage/DBI.pm         | 669 
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-----------------------------------------------------------------------
  3 files changed, 470 insertions&#40;+&#41;, 374 deletions&#40;-&#41;

These are changes since 0.08250 in just the files which are directly 
related to transaction handling, with likely a lot more indirect 
changes. Before going further I need you to test with 0.082820 and 
report back whether the problem persists. The easiest way to do so is 
`cpanm --look DBIx::Class` and then add the resulting tempdir to @INC.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1537622" href="/Public/Bug/Display.html?id=107159#txn-1537622">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;22&nbsp;04:00:56&nbsp;2015</span>
    <span class="description">cpt [...] novozymes.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #107159] Bug:  Spurious rollback when commit fails</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 22 Sep 2015 10:00:32 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-DBIx-Class [...] rt.cpan.org&#34; &lt;bug-DBIx-Class [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christopher Travers &lt;cpt [...] novozymes.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1537622/820716/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/820716">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">

On 2015-09-18 11:53, Peter Rabbitson via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107159">https://rt.cpan.org/Ticket/Display.html?id=107159</a></span> &gt;
&gt;
&gt; On 09/18/2015 11:27 AM, Christopher Travers via RT wrote:
<div class="message-stanza open">&gt;&gt; $ perl -MDBIx::Class -M5.010 -e &#39;say $DBIx::Class::VERSION&#39;
&gt;&gt; 0.08250
&gt;&gt;
</div>&gt; rabbit@Ahasver:~/devel/dbic$ git diff -w --stat  v0.08250..v0.082820 --
&gt; lib/DBIx/Class/Storage.pm lib/DBIx/Class/Storage/DBI.pm
&gt; lib/DBIx/Class/Storage/BlockRunner.pm
&gt;    lib/DBIx/Class/Storage.pm             |  40 +++++-----
&gt;    lib/DBIx/Class/Storage/BlockRunner.pm | 135
&gt; +++++++++++++++++-----------------
&gt;    lib/DBIx/Class/Storage/DBI.pm         | 669
&gt; ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-----------------------------------------------------------------------
&gt;    3 files changed, 470 insertions&#40;+&#41;, 374 deletions&#40;-&#41;
&gt;
&gt; These are changes since 0.08250 in just the files which are directly
&gt; related to transaction handling, with likely a lot more indirect
&gt; changes. Before going further I need you to test with 0.082820 and
&gt; report back whether the problem persists. The easiest way to do so is
&gt; `cpanm --look DBIx::Class` and then add the resulting tempdir to @INC.
</div>
My reading of the code indicates this should occur.  I will see what I 
can do about a test on it.

I first ran into a much more serious version of this problem in 0.08196, 
btw &#40;the commit is in a finally block there and therefore if the commit 
fails, $schema-&gt;txn_do&#40;&#41; reports success&#41;.  The fact that the problem is 
now fairly  minor is a major improvement :-&#41;.

Assuming I can reproduce, do you have a preferred fix?  I would be happy 
to submit a patch since I suspect the actual fix is likely to be 
trivial.  &#40;I would probably check the transaction state on the db handle&#41;.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1537624" href="/Public/Bug/Display.html?id=107159#txn-1537624">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;22&nbsp;04:12:22&nbsp;2015</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #107159] Bug:  Spurious rollback when commit fails</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 22 Sep 2015 10:12:07 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Rabbitson &lt;ribasushi [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1537624/820718/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/820718">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 09/22/2015 10:00 AM, Christopher Travers via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: DBIx-Class
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107159">https://rt.cpan.org/Ticket/Display.html?id=107159</a></span> &gt;
&gt;
&gt;
&gt;
&gt; On 2015-09-18 11:53, Peter Rabbitson via RT wrote:
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107159">https://rt.cpan.org/Ticket/Display.html?id=107159</a></span> &gt;
&gt;&gt;
&gt;&gt; On 09/18/2015 11:27 AM, Christopher Travers via RT wrote:
<div class="message-stanza open">&gt;&gt;&gt; $ perl -MDBIx::Class -M5.010 -e &#39;say $DBIx::Class::VERSION&#39;
&gt;&gt;&gt; 0.08250
&gt;&gt;&gt;
</div>&gt;&gt; rabbit@Ahasver:~/devel/dbic$ git diff -w --stat  v0.08250..v0.082820 --
&gt;&gt; lib/DBIx/Class/Storage.pm lib/DBIx/Class/Storage/DBI.pm
&gt;&gt; lib/DBIx/Class/Storage/BlockRunner.pm
&gt;&gt;     lib/DBIx/Class/Storage.pm             |  40 +++++-----
&gt;&gt;     lib/DBIx/Class/Storage/BlockRunner.pm | 135
&gt;&gt; +++++++++++++++++-----------------
&gt;&gt;     lib/DBIx/Class/Storage/DBI.pm         | 669
&gt;&gt; ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-----------------------------------------------------------------------
&gt;&gt;     3 files changed, 470 insertions&#40;+&#41;, 374 deletions&#40;-&#41;
&gt;&gt;
&gt;&gt; These are changes since 0.08250 in just the files which are directly
&gt;&gt; related to transaction handling, with likely a lot more indirect
&gt;&gt; changes. Before going further I need you to test with 0.082820 and
&gt;&gt; report back whether the problem persists. The easiest way to do so is
&gt;&gt; `cpanm --look DBIx::Class` and then add the resulting tempdir to @INC.
</div>&gt; My reading of the code indicates this should occur.  I will see what I
&gt; can do about a test on it.
&gt;
&gt; I first ran into a much more serious version of this problem in 0.08196,
&gt; btw &#40;the commit is in a finally block there and therefore if the commit
&gt; fails, $schema-&gt;txn_do&#40;&#41; reports success&#41;.  The fact that the problem is
&gt; now fairly  minor is a major improvement :-&#41;.
&gt;
&gt; Assuming I can reproduce, do you have a preferred fix?
</div>I have not looked at it at all yet. Basically 95% of the work in fixing 
these issues is constructing the proper test case. Indeed you described 
one in almost complete detail, but it is still work to integrate it into 
the test suite, while testing with the current version is something you 
can do in less than a minute.

I am not dropping this on the ground, but I am currently working on 
something unrelated, and don&#39;t want to lose steam/focus.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;    I would be happy
&gt; to submit a patch since I suspect the actual fix is likely to be
&gt; trivial.  &#40;I would probably check the transaction state on the db handle&#41;.
</div>
The fix indeed will likely be trivial, but doing anything with the db 
handle is almost certainly a mistake. The underlying problem is a desync 
of the internal transaction depth counter, which can not be papered over 
by just deferring to &#34;I will skip if it doesn&#39;t look right&#34;. The 
underlying reason for this desync needs to be found/fixed.

In summary - I would be very happy if you look into this further, and 
beat me to a solution. But please be aware that a cosmetic fixup is not 
something I am willing to go forward with. We either fix it right, or 
don&#39;t fix it at all ;&#41;

Cheers!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1552054" href="/Public/Bug/Display.html?id=107159#txn-1552054">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;03&nbsp;06:34:04&nbsp;2015</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1552054/828641/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/828641">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 281b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Issue has been reproduced, fix will be delayed a bit as the entire subsystem handling this is in the process of a rewrite.

If the warnings are *really* annoying - please chime in, and some sort of middle-ground-to-be-thrown-away-workaround will be devised.

Thanks for the report!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1552057" href="/Public/Bug/Display.html?id=107159#txn-1552057">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;03&nbsp;06:34:08&nbsp;2015</span>
    <span class="description">ribasushi [...] leporine.io -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1552071" href="/Public/Bug/Display.html?id=107159#txn-1552071">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;03&nbsp;07:49:39&nbsp;2015</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1552071/828653/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/828653">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 587b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Nov 03 12:34:04 2015, RIBASUSHI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Issue has been reproduced, fix will be delayed a bit as the entire
&gt; subsystem handling this is in the process of a rewrite.
&gt; 
&gt; If the warnings are *really* annoying - please chime in, and some sort
&gt; of middle-ground-to-be-thrown-away-workaround will be devised.
&gt; 
</div>
After spending more time looking at this, I came up with what I believe is a safe workaround &#40;but as the comment says - I am rather queasy about it&#41;: <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/dbsrgits/dbix-class/commit/0bec44d5d7">https://github.com/dbsrgits/dbix-class/commit/0bec44d5d7</a></span>

This will be a part of the 0.082899_15 devrel in some days.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1552074" href="/Public/Bug/Display.html?id=107159#txn-1552074">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;03&nbsp;07:49:47&nbsp;2015</span>
    <span class="description">ribasushi [...] leporine.io -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1552714" href="/Public/Bug/Display.html?id=107159#txn-1552714">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;04&nbsp;06:54:42&nbsp;2015</span>
    <span class="description">cpt [...] novozymes.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #107159] Bug: Spurious rollback when commit fails</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 4 Nov 2015 12:54:19 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-DBIx-Class [...] rt.cpan.org&#34; &lt;bug-DBIx-Class [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Christopher Travers &lt;cpt [...] novozymes.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1552714/828906/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/828906">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 836b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">

On 2015-11-03 12:34, Peter Rabbitson via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107159">https://rt.cpan.org/Ticket/Display.html?id=107159</a></span> &gt;
&gt;
&gt; Issue has been reproduced, fix will be delayed a bit as the entire subsystem handling this is in the process of a rewrite.
&gt;
&gt; If the warnings are *really* annoying - please chime in, and some sort of middle-ground-to-be-thrown-away-workaround will be devised.
&gt;
&gt; Thanks for the report!
</div>I have been thinking about your comment on the commit.

I am not aware of any cases where the commit needs to be rolled back if 
it fails &#40;one of the basic points in the database world is that commits 
are supposed to roll back if unsuccessful&#41;.

A quick review suggests that SQLState may be standardized well enough to 
be useful at least at the class level here &#40;i.e. first two characters 
matching&#41;.

Best Wishes,
Chris Travers
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1640105" href="/Public/Bug/Display.html?id=107159#txn-1640105">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;20&nbsp;08:32:54&nbsp;2016</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1640105/879324/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/879324">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 488b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Nov 04 12:54:42 2015, cpt@novozymes.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I am not aware of any cases where the commit needs to be rolled back
&gt; if
&gt; it fails &#40;one of the basic points in the database world is that
&gt; commits
&gt; are supposed to roll back if unsuccessful&#41;.
</div>
You would be surprised how much &#34;counterintuitive&#34; stuff is out there: <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/perl5-dbi/dbi/blob/1.635/DBI.pm#L4929-L4934">https://github.com/perl5-dbi/dbi/blob/1.635/DBI.pm#L4929-L4934</a></span>

In any case: Despite my unease, the fix is now properly in the CPAN index. Sorry it took so long :/
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1640108" href="/Public/Bug/Display.html?id=107159#txn-1640108">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;20&nbsp;08:32:55&nbsp;2016</span>
    <span class="description">ribasushi [...] leporine.io -  Status changed from &#39;patched&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1640110" href="/Public/Bug/Display.html?id=107159#txn-1640110">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;20&nbsp;08:32:55&nbsp;2016</span>
    <span class="description">ribasushi [...] leporine.io -  Fixed in 0.082840 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.619324</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
