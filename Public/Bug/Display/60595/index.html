<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #60595 for IMDB-Film: Patch: fix cover&#40;&#41; problem with foreign movies</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #60595 for IMDB-Film: Patch: fix cover&#40;&#41; problem with foreign movies</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/IMDB-Film/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/IMDB-Film/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/IMDB-Film/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/IMDB-Film/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/IMDB-Film">IMDB-Film CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">60595</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/IMDB-Film/Active/">IMDB-Film</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">STEPANOV [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
perl [...] tcbmi.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-16826-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-16827-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;21&nbsp;16:56:30&nbsp;2010</span>
    <span class="description">perl [...] tcbmi.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Patch: fix cover&#40;&#41; problem with foreign movies</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The existing cover&#40;&#41; routine assumes that the alt text of the cover
image matches the display title of the file.  This is not always the
case with foreign films, where the alt text will be the original title name.

This patch adds a original_title&#40;&#41; method that returns the original
title of the film &#40;if any&#41;.  The cover&#40;&#41; method is also patched to
support matching the original_title.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> support_original_title.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- Film.pm	2009-12-14 07:55:15.000000000 -0500
+++ Film.pm.new	2010-08-21 16:44:25.000000000 -0400
@@ -62,6 +62,7 @@
 				_cast
 				_directors
 				_writers
+				_original_title
 				_cover
 				_language
 				_country
@@ -663,6 +664,33 @@
    return $self-&gt;{_episodeof};
 }
 
+=item original_title&#40;&#41;
+
+Retrieve film&#39;s original &#40;untranslated&#41; title:
+
+	my $original_title = $film-&gt;original_title&#40;&#41;;
+
+=cut
+
+sub original_title {
+	my CLASS_NAME $self = shift;
+	my $forced = shift || 0;
+
+	if&#40;$forced&#41; {
+		my $parser = $self-&gt;_parser&#40;FORCED&#41;;
+    my $original_title;
+		while&#40;my $tag = $parser-&gt;get_tag&#40;&#39;span&#39;&#41;&#41; {
+			if &#40;$tag-&gt;[1]-&gt;{class} &#38;&#38; $tag-&gt;[1]-&gt;{class} =~ /title-extra/i&#41;
+      {
+         $original_title = $parser-&gt;get_trimmed_text&#40;&#41;;
+         last;
+      }
+    }
+		$self-&gt;{_original_title} = $original_title;
+  }
+  return $self-&gt;{_original_title};
+}
+
 =item cover&#40;&#41;
 
 Retrieve url of film cover:
@@ -680,12 +708,17 @@
 		my $cover;
 
 		my $title = quotemeta&#40;$self-&gt;title&#41;;
+		my $original_title = quotemeta&#40;$self-&gt;original_title&#41;;
 		while&#40;my $img_tag = $parser-&gt;get_tag&#40;&#39;img&#39;&#41;&#41; {
 			$img_tag-&gt;[1]{alt} ||= &#39;&#39;;	
 		
 			last if $img_tag-&gt;[1]{alt} =~ /^poster not submitted/i;			
 
-			if&#40;$img_tag-&gt;[1]{alt} =~ /^$title$/i&#41; {
+			if &#40;
+           $img_tag-&gt;[1]{alt} =~ /^$title$/i ||
+           &#40; defined $original_title &#38;&#38; $original_title ne &#39;&#39; &#38;&#38; &#40;$img_tag-&gt;[1]{alt} =~ /^$original_title$/i&#41; &#41; 
+         &#41;
+      {
 				$cover = $img_tag-&gt;[1]{src};
 				last;
 			}
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;08&nbsp;06:58:55&nbsp;2010</span>
    <span class="description">2ge [...] 2ge.us -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> 2ge [...] 2ge.us</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I confirm, this bug exists in latest Film.pm.

However, after applying patch, I get:

update_imdb.pl: Use of uninitialized value in quotemeta at
/opt/local/lib/perl5/site_perl/5.8.9/IMDB/Film.pm line 711.

This needs to be fixed, good example of such movie is
&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.imdb.com/title/tt0100263/">http://www.imdb.com/title/tt0100263/</a></span>&#34;

Also I saw, they are adding link to poster in meta:
&lt;link rel=&#34;image_src&#34;
href=&#34;http://ia.media-imdb.com/images/M/MV5BMjU5NjMxNDM1Ml5BMl5BanBnXkFtZTYwODAwNzk5._V1._SX98_SY140_.jpg&#34;&gt;&lt;meta
property=&#34;og:image&#34;
content=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://ia.media-imdb.com/images/M/MV5BMjU5NjMxNDM1Ml5BMl5BanBnXkFtZTYwODAwNzk5._V1._SX98_SY140_.jpg">http://ia.media-imdb.com/images/M/MV5BMjU5NjMxNDM1Ml5BMl5BanBnXkFtZTYwODAwNzk5._V1._SX98_SY140_.jpg</a></span>&#34;&gt;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;08&nbsp;06:58:55&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;08&nbsp;07:28:31&nbsp;2010</span>
    <span class="description">2ge [...] 2ge.us -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> 2ge [...] 2ge.us</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I am not a perl programmer, but this patch seems to work.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Film.pm.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- Film.pm	2010-03-19 21:50:22.000000000 +0700
+++ Film.pm.patched	2010-09-08 18:21:46.000000000 +0700
@@ -62,6 +62,7 @@
 				_cast
 				_directors
 				_writers
+				_original_title
 				_cover
 				_language
 				_country
@@ -663,6 +664,33 @@
    return $self-&gt;{_episodeof};
 }
 
+=item original_title&#40;&#41;
+
+Retrieve film&#39;s original &#40;untranslated&#41; title:
+
+	my $original_title = $film-&gt;original_title&#40;&#41;;
+
+=cut
+
+sub original_title {
+	my CLASS_NAME $self = shift;
+	my $forced = shift || 0;
+
+	if&#40;$forced&#41; {
+		my $parser = $self-&gt;_parser&#40;FORCED&#41;;
+    	my $original_title;
+		while&#40;my $tag = $parser-&gt;get_tag&#40;&#39;span&#39;&#41;&#41; {
+			if &#40;$tag-&gt;[1]-&gt;{class} &#38;&#38; $tag-&gt;[1]-&gt;{class} =~ /title-extra/i&#41;
+      {
+         $original_title = $parser-&gt;get_trimmed_text&#40;&#41;;
+         last;
+      }
+    }
+		$self-&gt;{_original_title} = $original_title;
+  }
+  return $self-&gt;{_original_title};
+}
+
 =item cover&#40;&#41;
 
 Retrieve url of film cover:
@@ -675,17 +703,32 @@
 	my CLASS_NAME $self = shift;
 	my $forced = shift || 0;
 
+	#print Dumper&#40;$self&#41;;
+	#die;
+
 	if&#40;$forced&#41; {
 		my $parser = $self-&gt;_parser&#40;FORCED&#41;;
 		my $cover;
 
+
 		my $title = quotemeta&#40;$self-&gt;title&#41;;
+		my $original_title;
+		if&#40;$self-&gt;original_title&#41; {
+			$original_title = quotemeta&#40;$self-&gt;original_title&#41;;
+		} else {
+			$original_title = quotemeta&#40;$self-&gt;original_title&#40;FORCED&#41;&#41;;
+		}
+		
 		while&#40;my $img_tag = $parser-&gt;get_tag&#40;&#39;img&#39;&#41;&#41; {
 			$img_tag-&gt;[1]{alt} ||= &#39;&#39;;	
 		
 			last if $img_tag-&gt;[1]{alt} =~ /^poster not submitted/i;			
 
-			if&#40;$img_tag-&gt;[1]{alt} =~ /^$title$/i&#41; {
+			if &#40;
+           $img_tag-&gt;[1]{alt} =~ /^$title$/i ||
+           &#40; defined $original_title &#38;&#38; $original_title ne &#39;&#39; &#38;&#38; &#40;$img_tag-&gt;[1]{alt} =~ /^$original_title$/i&#41; &#41; 
+         &#41;
+      {
 				$cover = $img_tag-&gt;[1]{src};
 				last;
 			}
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;08&nbsp;07:51:06&nbsp;2010</span>
    <span class="description">STEPANOV [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;08&nbsp;07:52:41&nbsp;2010</span>
    <span class="description">STEPANOV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks, guys, for the bug report and patch. I&#39;ll review it and apply to
the next release of IMDB::Film which is planned at 10/09/2010.

-- 
Best Regards,
Michael Stepanov
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
