<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #5815 for Plucene: Plucene runs afoul of limited file handles on OS X</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #5815 for Plucene: Plucene runs afoul of limited file handles on OS X</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Plucene/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Plucene/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Plucene/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Plucene/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Plucene">Plucene CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">5815</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Plucene/Active/">Plucene</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
adrianh [...] quietstars.com

<br />
andy [...] petdance.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-25988-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-25989-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




test.tar.gz<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/100501/30779/test.tar.gz">
Tue Feb 01 08:01:57 2005 (29.8k) by 
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/100500/30776/test.tar.gz">
Tue Feb 01 07:41:17 2005 (28.7k) by 
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;15&nbsp;12:59:33&nbsp;2004</span>
    <span class="description">ADIE [...] cpan.org - Ticket #5341:  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Test failure in stress.t</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dist: Plucene 1.05
Perl: 5.8.3
Platform: Mac OS X 1.2.8 &#40;Darwin davis.local. 6.8 Darwin Kernel Version 6.8: Wed Sep 10 15:20:55 PDT 2003; root:xnu/xnu-344.49.obj~2/RELEASE_PPC  Power Macintosh powerpc&#41;

stress.t gives me:

[ lots of oks]
ok 48 - Right documents
Plucene::Store::InputStream, r: t/homer_index/1209/_21.frq Too many open files at blib/lib/Plucene/Store/InputStream.pm line 41.
1..48
# Looks like your test died just after 48.

Sorry for lack of detail. Not got the time to poke at the moment. If you need any more info drop me a line.

Cheers,

Adrian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Create even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;26&nbsp;12:46:41&nbsp;2004</span>
    <span class="description">andy [...] petdance.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 26 Mar 2004 11:46:31 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Andy Lester &lt;andy [...] petdance.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> david [...] kineticode.com</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> bug-Plucene [...] rt.cpan.org, STRYTOAST [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Plucene runs afoul of limited file handles on OS X</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">David and I have both been seeing this test failure for the last few
releases of Plucene:

On Fri, Mar 26, 2004 at 09:38:17AM -0800, david@kineticode.com &#40;david@kineticode.com&#41; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This distribution has been tested as part of the cpan-testers
&gt; effort to test as many new uploads to CPAN as possible.  See
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://testers.cpan.org/">http://testers.cpan.org/</a></span>
&gt; 
&gt; Please cc any replies to cpan-testers@perl.org to keep other
&gt; test volunteers informed and to prevent any duplicate effort.
&gt;       
&gt; --
&gt; This is an error report generated automatically by CPANPLUS,
&gt; version 0.049.
&gt; 
&gt; Below is the error stack during &#39;make test&#39;:
&gt; 
&gt; t/analyzers..........ok
&gt; t/datesearch.........ok
&gt; t/dateserializer.....ok
&gt; t/deletable..........ok
&gt; t/indexsearcher......ok
&gt; t/mergefactor........ok
&gt; t/queryparser........ok
&gt; t/regress-01.........ok
&gt; t/regress-02.........ok
&gt; t/regress-04.........ok
&gt; t/search_hits........ok
&gt; t/searchtest.........ok
&gt; t/segments...........ok
&gt; t/similarity.........ok
&gt; t/sloppy_scorer......ok
&gt; t/stress.............# Indexing the entire Odyssey. This may take some time
&gt; # t/data/book1
&gt; # t/data/book10
&gt; # t/data/book11
&gt; # t/data/book12
&gt; # t/data/book13
&gt; # t/data/book14
&gt; # t/data/book15
&gt; # t/data/book16
&gt; # t/data/book17
&gt; # t/data/book18
&gt; # t/data/book19
&gt; # t/data/book2
&gt; # t/data/book20
&gt; # t/data/book21
&gt; # t/data/book22
&gt; # t/data/book23
&gt; # t/data/book24
&gt; # t/data/book3
&gt; # t/data/book4
&gt; # t/data/book5
&gt; # t/data/book6
&gt; # t/data/book7
&gt; # t/data/book8
&gt; # t/data/book9
&gt; # t/data/preface
&gt; # Closing
&gt; Plucene::Store::InputStream cannot open t/homer_index/10838/_10.f1 for reading: Too many open files at /Users/david/.cpanplus/5.8.3/build/Plucene-1.14/blib/lib/Plucene/Store/InputStream.pm line 37.
&gt; # Looks like your test died just after 48.
&gt; dubious
&gt;       Test returned status 255 &#40;wstat 65280, 0xff00&#41;
&gt;       after all the subtests completed successfully
&gt; t/terminfostest......ok
&gt; t/testbitvector......ok
&gt; t/testindexwriter....ok
&gt; t/tokenfilter........ok
&gt; t/tokenizer..........ok
&gt; t/utf8...............ok
&gt; Failed Test Stat Wstat Total Fail  Failed  List of Failed
&gt; -------------------------------------------------------------------------------
&gt; t/stress.t   255 65280    48    0   0.00%  ??
&gt; Failed 1/22 test scripts, 95.45% okay. 0/6002 subtests failed, 100.00% okay.
&gt; 
&gt; 
&gt; Additional comments:
&gt; 
&gt; Is this because of some setting on my Mac? Should Plucene be able to keep
&gt; track of this somehow?
&gt; --
&gt; 
&gt; Summary of my perl5 &#40;revision 5.0 version 8 subversion 3&#41; configuration:
&gt;   Platform:
&gt;     osname=darwin, osvers=7.2.0, archname=darwin-2level
&gt;     uname=&#39;darwin geertz.kineticode.com 7.2.0 darwin kernel version 7.2.0: thu dec 11 16:20:23 pst 2003; root:xnuxnu-517.3.7.obj~1release_ppc power macintosh powerpc &#39;
&gt;     config_args=&#39;-des -Dperladmin=david@kineticode.com -Dcf_email=david@kineticode.com&#39;
&gt;     hint=recommended, useposix=true, d_sigaction=define
&gt;     usethreads=undef use5005threads=undef useithreads=undef usemultiplicity=undef
&gt;     useperlio=define d_sfio=undef uselargefiles=define usesocks=undef
&gt;     use64bitint=undef use64bitall=undef uselongdouble=undef
&gt;     usemymalloc=n, bincompat5005=undef
&gt;   Compiler:
&gt;     cc=&#39;cc&#39;, ccflags =&#39;-pipe -fno-common -DPERL_DARWIN -no-cpp-precomp -fno-strict-aliasing&#39;,
&gt;     optimize=&#39;-Os&#39;,
&gt;     cppflags=&#39;-no-cpp-precomp -pipe -fno-common -DPERL_DARWIN -no-cpp-precomp -fno-strict-aliasing&#39;
&gt;     ccversion=&#39;&#39;, gccversion=&#39;3.1 20021003 &#40;prerelease&#41;&#39;, gccosandvers=&#39;&#39;
&gt;     intsize=4, longsize=4, ptrsize=4, doublesize=8, byteorder=4321
&gt;     d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=8
&gt;     ivtype=&#39;long&#39;, ivsize=4, nvtype=&#39;double&#39;, nvsize=8, Off_t=&#39;off_t&#39;, lseeksize=8
&gt;     alignbytes=8, prototype=define
&gt;   Linker and Libraries:
&gt;     ld=&#39;env MACOSX_DEPLOYMENT_TARGET=10.3 cc&#39;, ldflags =&#39; -L/usr/local/lib&#39;
&gt;     libpth=/usr/local/lib /usr/lib
&gt;     libs=-ldbm -ldl -lm -lc
&gt;     perllibs=-ldl -lm -lc
&gt;     libc=/usr/lib/libc.dylib, so=dylib, useshrplib=false, libperl=libperl.a
&gt;     gnulibc_version=&#39;&#39;
&gt;   Dynamic Linking:
&gt;     dlsrc=dl_dyld.xs, dlext=bundle, d_dlsymun=undef, ccdlflags=&#39; &#39;
&gt;     cccdlflags=&#39; &#39;, lddlflags=&#39; -bundle -undefined dynamic_lookup -L/usr/local/lib&#39;
</div>
-- 
Andy Lester =&gt; andy@petdance.com =&gt; www.petdance.com =&gt; AIM:petdance
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;29&nbsp;09:05:28&nbsp;2004</span>
    <span class="description">mwk [...] straytoaster.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[PETDANCE - Fri Mar 26 12:46:41 2004]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; David and I have both been seeing this test failure for the last few
&gt; releases of Plucene:
</div>
A few people have reported this. It will be investigated RNS :&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt;
&gt; &gt;
&gt; &gt; Additional comments:
&gt; &gt;
&gt; &gt; Is this because of some setting on my Mac? Should Plucene be able to
</div>&gt; keep
<div class="message-stanza open">&gt; &gt; track of this somehow?
</div></div>

It probably is, but I don&#39;t think anyone should *have* to fiddle with
machine setting just to make this work.

Plucene should keep track of this, if indeed that is the problem. &#40;I
have some other ideas, which hopefully won&#39;t be deadends!&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;09&nbsp;19:15:23&nbsp;2004</span>
    <span class="description">simon [...] cpan.org - Ticket #5341:  Ticket 5341 MergedInto ticket 5815.</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;14&nbsp;23:00:47&nbsp;2004</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Try the patch at
<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/NoAuth/Bug.html?id=6453">http://rt.cpan.org/NoAuth/Bug.html?id=6453</a></span>
to see if that fixes it
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;20&nbsp;10:49:14&nbsp;2004</span>
    <span class="description">andy [...] petdance.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> andy [...] petdance.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Version 1.18 does not fix this problem.

t/stress.............# Indexing the entire Odyssey. This may take some time
# t/data/book1
# t/data/book10
# t/data/book11
# t/data/book12
# t/data/book13
# t/data/book14
# t/data/book15
# t/data/book16
# t/data/book17
# t/data/book18
# t/data/book19
# t/data/book2
# t/data/book20
# t/data/book21
# t/data/book22
# t/data/book23
# t/data/book24
# t/data/book3
# t/data/book4
# t/data/book5
# t/data/book6
# t/data/book7
# t/data/book8
# t/data/book9
# t/data/preface
# Closing
t/stress.............ok 43/0Plucene::Store::InputStream cannot open
t/homer_index/22793/_21.fdx for reading: Too many open files at
/usr/src/Plucene-1.18/blib/lib/Plucene/Store/InputStream.pm line 37.
# Looks like your test died just after 48.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;29&nbsp;05:41:22&nbsp;2004</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[PETDANCE - Tue Jul 20 10:49:14 2004]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Version 1.18 does not fix this problem.
&gt; 
</div>
Have you tried making the change mentioned in
<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/NoAuth/Bug.html?id=6453">http://rt.cpan.org/NoAuth/Bug.html?id=6453</a></span>  ?

Version 1.19 doesn&#39;t apply this fix either
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;01&nbsp;06:18:54&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> torben-spam-cpan [...] nehmer.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[guest - Thu Jul 29 05:41:22 2004]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; [PETDANCE - Tue Jul 20 10:49:14 2004]:
&gt; 
<div class="message-stanza open">&gt; &gt; Version 1.18 does not fix this problem.
&gt; &gt; 
</div>&gt; 
&gt; Have you tried making the change mentioned in
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/NoAuth/Bug.html?id=6453">http://rt.cpan.org/NoAuth/Bug.html?id=6453</a></span>  ?
&gt; 
&gt; Version 1.19 doesn&#39;t apply this fix either
</div>

I too have this problem with 1.20 on Debian Linux, the fix mentioned
above does not help me.

If you need any example code, please contact me.

Torben
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;01&nbsp;07:09:29&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> torben-spam-cpan [...] nehmer.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi again,

[guest - Tue Feb  1 06:18:54 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Have you tried making the change mentioned in
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/NoAuth/Bug.html?id=6453">http://rt.cpan.org/NoAuth/Bug.html?id=6453</a></span>  ?
&gt; &gt; 
&gt; &gt; Version 1.19 doesn&#39;t apply this fix either
</div>&gt; 
&gt; I too have this problem with 1.20 on Debian Linux, the fix mentioned
&gt; above does not help me.
</div>
By coincidence, I noted, that this is probably related to an IO::File
problem. Its documentation states, that upon destruction any open handle
is automatically closed.

As a matter of fact this is not the case on my installation here.
undef&#39;ing does keep the file handle open, which is why Plucene runs into
the limit.

The only workaround I see right now is explicitly closing all
filehandles manually, unless someone realizes why IO::File does not do it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;01&nbsp;07:41:17&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> torben-spam-cpan [...] nehmer.net</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">One more note, from the IO::File class:

# There is no need for DESTROY to do anything, because when the
# last reference to an IO object is gone, Perl automatically
# closes its associated files &#40;if any&#41;.

So, if I get this right, as long the associated IO handle is not jet out
of scope, the file isn&#39;t closed. As a matter of fact, this seems to be
the problem:

I tried with this code:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; for &#40;$i = 0; $i &lt; 50000; $i++&#41;
&gt; {
&gt;    my $in = IO::File-&gt;new&#40;&#39;query.xml&#39;, &#34;r&#34;&#41;;
&gt;    my $out = IO::File-&gt;new&#40;&#39;/dev/null&#39;, &#34;w&#34;&#41;;
&gt;
&gt;    # my $proc = Midcom::Plucene::RequestProcessor-&gt;new&#40;$in, $out&#41;;
&gt;    # $proc-&gt;Process&#40;&#41;;
&gt; }
</div>
When you leave the two commented out segments alone, everything works
fine. If not, the references get lost somehow.

The RequestProcessor class releases all Plucene handles upon completion,
but when looking into /proc after the too many files open error, I see
that not only the query.xml and /dev/null files are open multiple times,
but also the files from the plucene index.

I admit, that I might have errors in my code, I&#39;d appreciate any
suggestions. The tarball attached to this comment holds the code I&#39;m
using at this time that triggers this error.

Try executing ./bench.pl, you need LibXML and XML::Writer installed.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/100500/30776/test.tar.gz">Download test.tar.gz</a><br />
<span class="downloadcontenttype">application/x-gzip 28.7k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;01&nbsp;08:01:57&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> torben-spam-cpan [...] nehmer.net</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

one more tarball, this time a bit more optimized. Thbench script now
only produces multiple handles on the plucene index.

Torben
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/100501/30779/test.tar.gz">Download test.tar.gz</a><br />
<span class="downloadcontenttype">application/x-gzip 29.8k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;02&nbsp;03:16:55&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> torben-spam-cpan [...] nehmer.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

digged into this a few more times, now tracking the open filehandels
through each iteration.

What I found out is interesting, after around 100 iterations my
application had these file handels open:

      1 _8.f1
      1 _8.f3
      1 _8.f4
      1 _8.f5
      1 _8.f6
      1 _8.f7
      1 _8.fdt
      1 _8.fdx
    237 _8.frq
      1 _8.prx
      1 _8.tis

Any ideas?

Torben
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;02&nbsp;03:27:20&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;     237 _8.frq
</div>
As it seems the Handle to this file gets duplicated. When tracking
SegmentTermDocs new calls, I discovered that with each iteration four of
these objects were created, while only two were actually destroyed,
which of course leaves two handels open.

As a proof for this, I changed the construcotr of termdocs so that the
stream is no longer cloned but used directly, just for proof of concept
&#40;I know that this could break other things, yes&#41;. When this was done, I
definitly had no more dangling file handels.

Now the main question, for which I won&#39;t have time today, is where these
TermDocs get lost. Perhaps some cyclic references that prevent the GC
from disposing the objects are the reason for this.

As a matter of fact, these dangling objects are causing a memory leak:

Script start         :  9,0 MB VM size
After 3000 iterations: 34,5 MB VM size
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;02&nbsp;03:27:29&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> torben-spam-cpan [...] nehmer.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;     237 _8.frq
</div>
As it seems the Handle to this file gets duplicated. When tracking
SegmentTermDocs new calls, I discovered that with each iteration four of
these objects were created, while only two were actually destroyed,
which of course leaves two handels open.

As a proof for this, I changed the construcotr of termdocs so that the
stream is no longer cloned but used directly, just for proof of concept
&#40;I know that this could break other things, yes&#41;. When this was done, I
definitly had no more dangling file handels.

Now the main question, for which I won&#39;t have time today, is where these
TermDocs get lost. Perhaps some cyclic references that prevent the GC
from disposing the objects are the reason for this.

As a matter of fact, these dangling objects are causing a memory leak:

Script start         :  9,0 MB VM size
After 3000 iterations: 34,5 MB VM size
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;May&nbsp;26&nbsp;15:06:57&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[guest - Wed Feb  2 03:27:29 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As a proof for this, I changed the construcotr of termdocs so that the
&gt; stream is no longer cloned but used directly, just for proof of concept
&gt; &#40;I know that this could break other things, yes&#41;. When this was done, I
&gt; definitly had no more dangling file handels.
</div>
Is there any kind of useful workaround?  I see this hasn&#39;t been updated
for 3 months...

I&#39;ve got a plucene database with less than 500 records in it that&#39;s
bombing out on my linux box because of filehandle issues.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
