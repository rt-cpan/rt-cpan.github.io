<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #65656 for Math-Currency: test error &#40;locale?&#41;, perl 10.0, MacOSX 10.6.6</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #65656 for Math-Currency: test error &#40;locale?&#41;, perl 10.0, MacOSX 10.6.6</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Math-Currency/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Math-Currency/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Math-Currency/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Math-Currency/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Math-Currency">Math-Currency CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">65656</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Math-Currency/Active/">Math-Currency</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
johntrammell [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-20602-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.47    </td>
  </tr>
  <tr id="CF-20603-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;11&nbsp;16:57:09&nbsp;2011</span>
    <span class="description">johntrammell [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> test error &#40;locale?&#41;, perl 10.0, MacOSX 10.6.6</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">failing test output and perl configuration attached.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> testout.txt</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">/usr/bin/perl Build --makefile_env_macros 1 test
t/001_load........ok
t/002_basic.......
#   Failed test &#39;changes to object format&#39;
#   at t/002_basic.t line 115.
#          got: &#39;Â£98,994.95&#39;
#     expected: &#39;£98,994.95&#39;

#   Failed test &#39;changes to object format&#39;
#   at t/002_basic.t line 115.
#          got: &#39;Â£98,994.95&#39;
#     expected: &#39;£98,994.95&#39;
# Looks like you failed 2 tests of 97.
dubious
	Test returned status 2 &#40;wstat 512, 0x200&#41;
DIED. FAILED tests 42, 90
	Failed 2/97 tests, 97.94% okay
t/003_subclass....ok
t/004_localize....
#   Failed test &#39; 	&#39;Â£&#39;	= &#39;£&#39;&#39;
#   at t/004_localize.t line 45.
# Looks like you failed 1 test of 32.
dubious
	Test returned status 1 &#40;wstat 256, 0x100&#41;
DIED. FAILED test 19
	Failed 1/32 tests, 96.88% okay
t/005_rounding....ok
t/006_defaults....ok
Failed Test      Stat Wstat Total Fail  List of Failed
-------------------------------------------------------------------------------
t/002_basic.t       2   512    97    2  42 90
t/004_localize.t    1   256    32    1  19
Failed 2/6 test scripts. 3/154 subtests failed.
Files=6, Tests=154,  2 wallclock secs &#40; 0.78 cusr +  0.70 csys =  1.48 CPU&#41;
Failed 2/6 test programs. 3/154 subtests failed.
make: *** [test] Error 255
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> perl-V.txt</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Summary of my perl5 &#40;revision 5 version 10 subversion 0&#41; configuration:
  Platform:
    osname=darwin, osvers=10.0, archname=darwin-thread-multi-2level
    uname=&#39;darwin b79.apple.com 10.0 darwin kernel version 10.0.0d8: tue may 5 19:29:59 pdt 2009; root:xnu-1437.2~2release_i386 i386 &#39;
    config_args=&#39;-ds -e -Dprefix=/usr -Dccflags=-g  -pipe  -Dldflags= -Dman3ext=3pm -Duseithreads -Duseshrplib -Dinc_version_list=none -Dcc=gcc-4.2&#39;
    hint=recommended, useposix=true, d_sigaction=define
    useithreads=define, usemultiplicity=define
    useperlio=define, d_sfio=undef, uselargefiles=define, usesocks=undef
    use64bitint=define, use64bitall=define, uselongdouble=undef
    usemymalloc=n, bincompat5005=undef
  Compiler:
    cc=&#39;gcc-4.2&#39;, ccflags =&#39;-arch x86_64 -arch i386 -arch ppc -g -pipe -fno-common -DPERL_DARWIN -fno-strict-aliasing -I/usr/local/include&#39;,
    optimize=&#39;-Os&#39;,
    cppflags=&#39;-g -pipe -fno-common -DPERL_DARWIN -fno-strict-aliasing -I/usr/local/include&#39;
    ccversion=&#39;&#39;, gccversion=&#39;4.2.1 &#40;Apple Inc. build 5646&#41;&#39;, gccosandvers=&#39;&#39;
    intsize=4, longsize=8, ptrsize=8, doublesize=8, byteorder=12345678
    d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=16
    ivtype=&#39;long&#39;, ivsize=8, nvtype=&#39;double&#39;, nvsize=8, Off_t=&#39;off_t&#39;, lseeksize=8
    alignbytes=8, prototype=define
  Linker and Libraries:
    ld=&#39;gcc-4.2 -mmacosx-version-min=10.6&#39;, ldflags =&#39;-arch x86_64 -arch i386 -arch ppc -L/usr/local/lib&#39;
    libpth=/usr/local/lib /usr/lib
    libs=-ldbm -ldl -lm -lutil -lc
    perllibs=-ldl -lm -lutil -lc
    libc=/usr/lib/libc.dylib, so=dylib, useshrplib=true, libperl=libperl.dylib
    gnulibc_version=&#39;&#39;
  Dynamic Linking:
    dlsrc=dl_dlopen.xs, dlext=bundle, d_dlsymun=undef, ccdlflags=&#39; &#39;
    cccdlflags=&#39; &#39;, lddlflags=&#39;-arch x86_64 -arch i386 -arch ppc -bundle -undefined dynamic_lookup -L/usr/local/lib&#39;


Characteristics of this binary &#40;from libperl&#41;: 
  Compile-time options: MULTIPLICITY PERL_DONT_CREATE_GVSV
                        PERL_IMPLICIT_CONTEXT PERL_MALLOC_WRAP USE_64_BIT_ALL
                        USE_64_BIT_INT USE_ITHREADS USE_LARGE_FILES
                        USE_PERLIO USE_REENTRANT_API
  Locally applied patches:
	/Library/Perl/Updates/&lt;version&gt; comes before system perl directories
	installprivlib and installarchlib points to the Updates directory
  Built under darwin
  Compiled at Jun 25 2009 21:54:25
  @INC:
    /Library/Perl/Updates/5.10.0/darwin-thread-multi-2level
    /Library/Perl/Updates/5.10.0
    /System/Library/Perl/5.10.0/darwin-thread-multi-2level
    /System/Library/Perl/5.10.0
    /Library/Perl/5.10.0/darwin-thread-multi-2level
    /Library/Perl/5.10.0
    /Network/Library/Perl/5.10.0/darwin-thread-multi-2level
    /Network/Library/Perl/5.10.0
    /Network/Library/Perl
    /System/Library/Perl/Extras/5.10.0/darwin-thread-multi-2level
    /System/Library/Perl/Extras/5.10.0
    .
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;11&nbsp;16:58:13&nbsp;2011</span>
    <span class="description">johntrammell [...] gmail.com -  Broken in 0.47 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;13&nbsp;10:22:54&nbsp;2011</span>
    <span class="description">jpeacock [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Unfortunately, the Locale support in Mac OS/X is really messed up.  In
some respects, it claims to support UTF-8, but it actually provides only
Latin-1 &#40;ASCII&#41;.  I haven&#39;t been doing much with Math::Currency
recently, but I hope to eventually split out the L18n support into an
independent test suite that has to be manually generated and executed.

If the Currency math part of this module works for you, that is about
all you can hope for on the Mac.  You might be able to use the Locale
support if you generate the Locale files yourself, but it isn&#39;t worth it
to try and make it work in the test suite.

Thanks for the complete but report, though.  Sorry I couldn&#39;t be more
helpful...

John
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;13&nbsp;10:22:55&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;13&nbsp;10:22:55&nbsp;2011</span>
    <span class="description">jpeacock [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;23&nbsp;16:51:26&nbsp;2011</span>
    <span class="description">johntrammell [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi JPEACKOCK:

I don&#39;t think we can lay this entirely at the feet of my OS.  Once I
&#34;got to the bottom&#34; of the failing tests, it looks to me like the
problem rests deeply in how Math::Currency handles locales.

One of the tests &#40;t/002_basic.t&#41; fails because the input &#40;&#34;GBP&#34;&#41; does
not specify an encoding, so Math::Currency then trolls the output of
`locale -a` looking for a string match.  Since `locale -a` can list the
locales in any order, you&#39;re flipping a coin as to what encoding you&#39;ll
get.  I don&#39;t see any easy way out of this with the current M::C code,
which AFAICT assumes Latin1 encoding throughout.

The other failing test &#40;t/004_localize.t&#41; fails because the test
localizes to &#34;en_GB&#34;, not &#34;en_GB.ISO8859-1&#34;.  The attached patch
addresses this on my platform.

If you make the source code publicly available &#40;on e.g. github&#41; I will
gladly supply more patches.

Thanks,
John
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-fixed-t-004_localize.t-for-MacOS.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From adbcba48ec50fd6a1dbee0396987e9ee0ebb1655 Mon Sep 17 00:00:00 2001
From: John Trammell &lt;johntrammell@gmail.com&gt;
Date: Wed, 23 Feb 2011 15:16:27 -0600
Subject: [PATCH] fixed t/004_localize.t for MacOS

---
 t/004_localize.t |   10 +++++++++-
 1 files changed, 9 insertions&#40;+&#41;, 1 deletions&#40;-&#41;

diff --git a/t/004_localize.t b/t/004_localize.t
index 227d2b9..7c95529 100644
--- a/t/004_localize.t
+++ b/t/004_localize.t
@@ -4,7 +4,15 @@ use Math::Currency qw&#40;$LC_MONETARY&#41;;
 
 # monetary_locale testing
 use POSIX qw&#40; locale_h &#41;;
-my $locale = setlocale&#40; LC_ALL, &#34;en_GB&#34; &#41;;
+
+my $locale;
+if &#40;$^O eq &#39;darwin&#39;&#41; {  # MacOS locale &#34;en_GB&#34; is UTF-8
+    $locale = setlocale&#40; LC_ALL, &#34;en_GB.ISO8859-1&#34; &#41;;
+}
+else {
+    $locale = setlocale&#40; LC_ALL, &#34;en_GB&#34; &#41;;
+}
+
 my $format = {};
 Math::Currency-&gt;localize&#40; \$format &#41;;
 
-- 
1.7.1

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;23&nbsp;16:51:26&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;23&nbsp;17:07:02&nbsp;2011</span>
    <span class="description">johntrammell [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here&#39;s a patch that works around the problem in t/002_basic.t.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0002-fixed-t-002_basic.t-for-MacOS.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 7ec3f9c4920a3d1b67d4a3662e674533a900a475 Mon Sep 17 00:00:00 2001
From: John Trammell &lt;johntrammell@gmail.com&gt;
Date: Wed, 23 Feb 2011 16:04:59 -0600
Subject: [PATCH 2/2] fixed t/002_basic.t for MacOS

---
 t/002_basic.t |   41 ++++++++++++++++++++++++++++-------------
 1 files changed, 28 insertions&#40;+&#41;, 13 deletions&#40;-&#41;

diff --git a/t/002_basic.t b/t/002_basic.t
index 3bc4cf8..6c5519e 100644
--- a/t/002_basic.t
+++ b/t/002_basic.t
@@ -104,19 +104,34 @@ sub run_tests {
     my $locale;
 
     SKIP: {
-	    $locale = setlocale&#40;LC_ALL,&#34;en_GB&#34;&#41;;
-	    skip &#40;&#34;No en_GB locale installed&#34;, 1&#41;
-	    	unless setlocale&#40;LC_ALL&#41; eq &#34;en_GB&#34;;
-	    skip &#40;&#34;No locale support&#34;, 3&#41; unless $CLASS-&gt;localize&#40;&#41;;
-	    pass &#40; &#34;Re-initialized locale with en_GB&#34; &#41;;
-	    is &#40; $FORMAT-&gt;{INT_CURR_SYMBOL}, &#34;GBP &#34;, &#34;POSIX format set properly&#34;&#41;;
-
-	    $pounds = $CLASS-&gt;new&#40; 98994.95, &#39;GBP&#39;&#41;;
-	    is &#40; $pounds, &#39;£98,994.95&#39;, &#34;changes to object format&#34; &#41;;
-	    $newpounds = $pounds + 100000;
-
-	    is &#40; ref&#40;$newpounds&#41;, ref&#40;$pounds&#41;, &#34;autoupgrade to object&#34; &#41;;
-	}
+        my $en_GB = &#40;$^O =~ /darwin/&#41; ? &#39;en_GB.ISO8859-1&#39; : &#39;en_GB&#39;;
+
+        $locale = setlocale&#40;LC_ALL,$en_GB&#41;;
+        skip &#40;&#34;No $en_GB locale installed&#34;, 1&#41;
+            unless setlocale&#40;LC_ALL&#41; eq $en_GB;
+        skip &#40;&#34;No locale support&#34;, 3&#41; unless $CLASS-&gt;localize&#40;&#41;;
+        pass &#40; &#34;Re-initialized locale with $en_GB&#34; &#41;;
+        is &#40; $FORMAT-&gt;{INT_CURR_SYMBOL}, &#34;GBP &#34;, &#34;POSIX format set properly&#34;&#41;;
+
+        if &#40;$^O eq &#39;darwin&#39;&#41; {
+            # If we don&#39;t specify a precise locale, we are not guaranteed to
+            # get the encoding we want.  This uses Math::Currency&#39;s en_GB.pm,
+            # which is encoded as Latin1.
+            $pounds = $CLASS-&gt;new&#40;98994.95, &#39;en_GB&#39;&#41;;
+        }
+        else {
+            $pounds = $CLASS-&gt;new&#40;98994.95, &#39;GBP&#39;&#41;;
+        }
+        my $correct = &#34;\x{a3}98,994.95&#34;;
+        is &#40;$pounds, $correct, &#34;changes to object format&#34; &#41; or do {
+            diag&#40;&#34;CLASS=$CLASS&#34;&#41;;
+            diag&#40;&#34;\$pounds=&#39;$pounds&#39;&#34;&#41;;
+            diag&#40;&#34;\$correct=&#39;$correct&#39;&#34;&#41;;
+        };
+        $newpounds = $pounds + 100000;
+
+        is &#40; ref&#40;$newpounds&#41;, ref&#40;$pounds&#41;, &#34;autoupgrade to object&#34; &#41;;
+    }
 
     SKIP: {
 	    $locale = setlocale&#40;LC_ALL,&#34;en_US&#34;&#41;;
-- 
1.7.1

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;16&nbsp;12:50:25&nbsp;2016</span>
    <span class="description">MSCHOUT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi.

I have just uploaded Math::Currency v0.48 to CPAN which contains numerous fixes.  It will probably take a few hours for it to mirror around CPAN.

I am unable to reproduce this issue any longer.  I notice this issue was reported on OS X 10.6, which is by now very old, and I do not have access to that.

Can you test v0.48 and tell me if you are still experiencing problems?

If not I think this ticket can finally be resolved.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;16&nbsp;14:27:20&nbsp;2016</span>
    <span class="description">johntrammell [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #65656] test error &#40;locale?&#41;, perl 10.0, MacOSX 10.6.6</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 16 Jun 2016 13:27:10 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Math-Currency [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Trammell &lt;johntrammell [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I no longer have access to that platform, so I can&#39;t say that the defect is
resolved. But feel free to close the ticket if you like.

On Thu, Jun 16, 2016 at 11:50 AM, MSCHOUT via RT &lt;
bug-Math-Currency@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=65656">https://rt.cpan.org/Ticket/Display.html?id=65656</a></span> &gt;
&gt;
&gt; Hi.
&gt;
&gt; I have just uploaded Math::Currency v0.48 to CPAN which contains numerous
&gt; fixes.  It will probably take a few hours for it to mirror around CPAN.
&gt;
&gt; I am unable to reproduce this issue any longer.  I notice this issue was
&gt; reported on OS X 10.6, which is by now very old, and I do not have access
&gt; to that.
&gt;
&gt; Can you test v0.48 and tell me if you are still experiencing problems?
&gt;
&gt; If not I think this ticket can finally be resolved.
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;16&nbsp;14:31:25&nbsp;2016</span>
    <span class="description">MSCHOUT [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
