<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #17773 for TermReadKey: Term::ReadKey trouble on Win32 Vanilla Perl.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #17773 for TermReadKey: Term::ReadKey trouble on Win32 Vanilla Perl.</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=TermReadKey">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=TermReadKey">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=TermReadKey">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=TermReadKey">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/TermReadKey">TermReadKey CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">17773</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=TermReadKey">TermReadKey</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">jns [...] gellyfish.co.uk
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
adamk [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-31276-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.30    </td>
  </tr>
  <tr id="CF-31277-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=17773">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-166814" href="/Public/Bug/Display.html?id=17773#txn-166814">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;20&nbsp;19:50:55&nbsp;2006</span>
    <span class="description">adamk [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Term::ReadKey trouble on Win32 Vanilla Perl.</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/166814/53568/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/53568">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Installed Term::ReadKey through the CPAN shell as part of my attempts to
gradually get Bundle::CPAN working.

Built ok, tests went a little funny when I could exit one of the tests,
had to force my way out of it, but things still seemed to go ok.

After installation, every time I start up the debugger or CPAN shell I
get something like the following.

-------------------------------------------------------

C:\DOCUME~1\adam\LOCALS~1\Temp\cpan\build\CPAN-1.86&gt;perl -de 1

Loading DB routines from perl5db.pl version 1.28
Editor support available.

Enter h or `h h&#39; for help, or `perldoc perldebug&#39; for more help.

main::&#40;-e:1&#41;:   1
MYDEBUGGING: Setting mode &#39;&#39; &#40;4&#41;
MYDEBUGGING: Normalised handle
MYDEBUGGING: SetReadMode&#40; 4, GLOB&#40;0x9852e0&#41; &#41;
SetConsoleMode failed, LastError=|6| at
c:/vanilla-perl/perl/site/lib/Term/ReadK
ey.pm line 267.
 at c:/vanilla-perl/perl/site/lib/Term/ReadLine/readline.pm line 1415
        readline::readline&#40;&#39;  DB&lt;1&gt; &#39;&#41; called at
c:/vanilla-perl/perl/site/lib/T
erm/ReadLine/Perl.pm line 11
       
Term::ReadLine::Perl::readline&#40;&#39;Term::ReadLine::Perl=ARRAY&#40;0xaabf7c&#41;&#39;, &#39;
  DB&lt;1&gt; &#39;&#41; called at c:/vanilla-perl/perl/lib/perl5db.pl line 6367
        DB::readline&#40;&#39;  DB&lt;1&gt; &#39;&#41; called at
c:/vanilla-perl/perl/lib/perl5db.pl l
ine 2203
        DB::DB called at -e line 1
  DB&lt;1&gt;

---------------------------------------------------------

The MYDEBUGGING lines did not change the error, and were the result of
just some print statements I inserted in ReadMode.

----------------------------------------------------------

sub ReadMode
{
    my &#40;$mode&#41; = $modes{ $_[0] };
    print &#34;MYDEBUGGING: Setting mode &#39;$mode&#39; &#40;$_[0]&#41;\n&#34;;
    my &#40;$fh&#41; = normalizehandle&#40; &#40; @_ &gt; 1 ? $_[1] : \*STDIN &#41; &#41;;
    print &#34;MYDEBUGGING: Normalised handle\n&#34;;
    if &#40; defined&#40;$mode&#41; &#41; { print &#34;MYDEBUGGING: SetReadMode&#40; $mode, $fh
&#41;\n&#34;; SetReadMode&#40; $mode, $fh &#41; }
    elsif &#40; $_[0] =~ /^\d/ &#41; { print &#34;MYDEBUGGING: SetReadMode&#40; $_[0],
$fh &#41;\n&#34;; SetReadMode&#40; $_[0], $fh &#41; }
    else { croak&#40;&#34;Unknown terminal mode `$_[0]&#39;&#34;&#41;; }
}

---------------------------------------------------------

Since I don&#39;t see SetReadMode mentioned anywhere else in the file, I&#39;m
assuming that it is implemented in XS/C.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-168834" href="/Public/Bug/Display.html?id=17773#txn-168834">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;27&nbsp;09:15:35&nbsp;2006</span>
    <span class="description">jns [...] gellyfish.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> bug-TermReadKey [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [cpan #17773] Re: Term::ReadKey on Win32</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 27 Feb 2006 14:13:04 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Adam Kennedy &lt;cpan [...] ali.as&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jonathan Stowe &lt;jns [...] gellyfish.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/168834/54698/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/54698">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, 2006-02-27 at 13:23, Adam Kennedy wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi there
&gt; 
&gt; I&#39;m working on Vanilla Perl, the new non-ActiveState Win32 perl 
&gt; distribution, trying to work my way through the bugs in the standard 
&gt; tool chain &#40;basically, what&#39;s in Bundle::CPAN&#41; and I&#39;m through most of 
&gt; them now, except for some problems in Term::ReadKey &#40;and a couple of others&#41;
&gt; 
&gt; I was wondering what your situation was WRT being able to look at the 
&gt; Win32-related Term::ReadKey bugs. Could you use some help if I could 
&gt; draft in others?
&gt; 
&gt; Just looking for an update really.
&gt; 
</div>
It appears you have me at a disadvantage, I was not aware of any
outstanding &#39;bugs&#39; in Term::ReadKey until I received this, since RT was
upgraded I don&#39;t appear to see the TermReadKey queue nor get any email
notifications of new tickets.  It also appears that I can&#39;t take the
tickets so it&#39;s not a very good way of making bug reports to  me.

Anyway, I&#39;m going to need more information from you before I can look at
this because from your report I&#39;m not actually sure it is a &#39;bug&#39;, this
looks like a class of problem on Win32 that arises due to the build
environment for a module differing from that used to build the perl
itself &#40;you can find discussion of this on p5p.&#41;  Please can you send me
the output from perl -V and the versions of both the compiler used to
build the perl and that used to build the module.

/J\
-- 

This e-mail is sponsored by <span class="clickylink"><a target="new" rel="nofollow" href="http://www.integration-house.com/">http://www.integration-house.com/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-168835" href="/Public/Bug/Display.html?id=17773#txn-168835">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;27&nbsp;09:15:36&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-168989" href="/Public/Bug/Display.html?id=17773#txn-168989">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;27&nbsp;17:47:02&nbsp;2006</span>
    <span class="description">jns [...] gellyfish.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> bug-TermReadKey [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #17773] Re: Term::ReadKey on Win32</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 27 Feb 2006 22:45:04 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Adam Kennedy &lt;cpan [...] ali.as&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jonathan Stowe &lt;jns [...] gellyfish.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/168989/54810/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/54810">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, 2006-02-27 at 14:13, Jonathan Stowe wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon, 2006-02-27 at 13:23, Adam Kennedy wrote:
<div class="message-stanza open">&gt; &gt; Hi there
&gt; &gt; 
&gt; &gt; I&#39;m working on Vanilla Perl, the new non-ActiveState Win32 perl 
&gt; &gt; distribution, trying to work my way through the bugs in the standard 
&gt; &gt; tool chain &#40;basically, what&#39;s in Bundle::CPAN&#41; and I&#39;m through most of 
&gt; &gt; them now, except for some problems in Term::ReadKey &#40;and a couple of others&#41;
&gt; &gt; 
&gt; &gt; I was wondering what your situation was WRT being able to look at the 
&gt; &gt; Win32-related Term::ReadKey bugs. Could you use some help if I could 
&gt; &gt; draft in others?
&gt; &gt; 
&gt; &gt; Just looking for an update really.
&gt; &gt; 
</div>&gt; 
&gt; It appears you have me at a disadvantage, I was not aware of any
&gt; outstanding &#39;bugs&#39; in Term::ReadKey until I received this, since RT was
&gt; upgraded I don&#39;t appear to see the TermReadKey queue nor get any email
&gt; notifications of new tickets.  It also appears that I can&#39;t take the
&gt; tickets so it&#39;s not a very good way of making bug reports to  me.
&gt; 
&gt; Anyway, I&#39;m going to need more information from you before I can look at
&gt; this because from your report I&#39;m not actually sure it is a &#39;bug&#39;, this
&gt; looks like a class of problem on Win32 that arises due to the build
&gt; environment for a module differing from that used to build the perl
&gt; itself &#40;you can find discussion of this on p5p.&#41;  Please can you send me
&gt; the output from perl -V and the versions of both the compiler used to
&gt; build the perl and that used to build the module.
</div>
I thought I might try and satisfy myself that there was no other problem
going on here and had a little poke around building my own Perl with MS
C 7 and trying to replicate the problem.  This has turned up what may be
either a bug in Term::ReadLine or in perl itself rather than in
Term::ReadKey.  The problem seems to lie with Term::ReadLine&#39;s use of
the CON: special file for the console on Windows, now this seems to work
fine and you can print to handle opened to it and so on and so forth but
it doesn&#39;t seem to work with Term::ReadKey. I have tested with a version
of Term::ReadLine that I have altered to use the default STDIN and
Term::ReadLine::Perl &#40;where you were actually seeing the error&#41; seems to
work reasonably fine with no error.

I am going to have to wait until tomorrow to workup some better test
cases just to narrow down where the problem actually lies and then
probably take some further opinion before I proceed.

/J\
-- 

This e-mail is sponsored by <span class="clickylink"><a target="new" rel="nofollow" href="http://www.integration-house.com/">http://www.integration-house.com/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-169154" href="/Public/Bug/Display.html?id=17773#txn-169154">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;28&nbsp;09:09:03&nbsp;2006</span>
    <span class="description">jns [...] gellyfish.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> bug-TermReadKey [...] rt.cpan.org, Adam Kennedy &lt;cpan [...] ali.as&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [cpan #17773]  Term::ReadLine, CON: and Term::ReadKey on Win32</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 28 Feb 2006 14:07:39 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> perl5-porters [...] perl.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jonathan Stowe &lt;jns [...] gellyfish.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/169154/54890/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/54890">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve had a few bug reports on Term::ReadKey on Windows where people are
getting stuff like:

   SetConsoleMode failed, LastError=|6| at C:/perl/site/lib/Term/ReadKey.pm line 265.

&#40;Where SetConsoleMode is the windows API function being called at the
time and the error 6 means &#39;invalid handle.&#41; I&#39;ve put these down in the
past to packaging problems or a CRT mismatch &#40;see previous discussion
here on the rôle of mismatched runtimes between Perl and XS modules with
regard to filehandles.&#41;

Anyhow in examining the reports like the above I had completely failed
to notice that it was SetConsoleMode&#40;&#41; and not GetConsoleMode&#40;&#41; which is
called earlier in the ReadMode&#40;&#41; implementation that is failing - if the
OS handle that gets passed to one is invalid it should be invalid when
it gets passed to the first one as well.

Also I hadn&#39;t really considered that the reports I was getting were from
when people were using either the debugger or the CPAN shell on the
whole, what these have in common is that they use Term::ReadLine &#40;and
thence Term::ReadLine::readline &#41;.

Anyway it seems to boil down to Term::ReadLines use of &#39;con&#39; as the
console device on Windows:

    if &#40;$^O eq &#39;MacOS&#39;&#41; {
        $console = &#34;Dev:Console&#34;;
    } elsif &#40;-e &#34;/dev/tty&#34;&#41; {
        $console = &#34;/dev/tty&#34;;
    } elsif &#40;-e &#34;con&#34; or $^O eq &#39;MSWin32&#39;&#41; {
        $console = &#34;con&#34;;
    } else {
        $console = &#34;sys\$command&#34;;
    }

Now opening CON: as a file works fine for both reading and writing in
Perl programs; it just seems that it doesn&#39;t work when you pass a
filehandle opened to it to Term::ReadKey::ReadMode, however I&#39;m pretty
certain that there is nothing that either Perl or Term::ReadKey is doing
wrong and that it is Windows behaviour as exemplified by the result of:

#include &lt;windows.h&gt;
#include &lt;stdio.h&gt;

int main &#40;int argc, char **argv&#41;
{
        HANDLE h;
        DWORD mode;

        h = CreateFile&#40;&#34;CON:&#34;,GENERIC_READ ,FILE_SHARE_READ,NULL,OPEN_EXISTING,FILE_ATTRIBUTE_NORMAL,NULL&#41;;

        if &#40; h == INVALID_HANDLE_VALUE &#41;
                printf&#40;&#34;CreateFile failed: %d\n&#34;, GetLastError&#40;&#41;&#41;;

        if &#40;! GetConsoleMode&#40;h,&#38;mode&#41; &#41;
                printf&#40;&#34;GetConsoleMode failed: %d\n&#34;, GetLastError&#40;&#41;&#41;;
        if &#40;! SetConsoleMode&#40;h,mode&#41; &#41;
                printf&#40;&#34;SetConsoleMode failed: %d\n&#34;, GetLastError&#40;&#41;&#41;;

        return 0;
}

Which shows the failure in SetConsoleMode&#40;&#41; with the same error code as
in the ReadMode failure.

Anyway, to cut to the point, should the use of &#39;CON:&#39; be changed in
Term::ReadLine?  At simplest we could just set $console to undef in the
above snippet, which works &#40;setting the input and output handles to
STDIN and STDOUT respectively&#41;, but some testing with
Term::ReadLine::Perl seems to indicate there might be some blocking &#40;at
least in the tests&#41; and I haven&#39;t had time to delve to far into that. An
alternative would be to further special case Win32 in
Term::ReadLine::getConsole and have it sysopen CONIN$ and CONOUT$ as
appropriate as they don&#39;t seem to be afflicted with the same problem
that CON: has.  If people want to do that I&#39;ll be happy to work up a
patch.  Or maybe someone has a better idea.

I&#39;m also interested in hearing any ideas about the reason for this
problem at the windows level - I can&#39;t find any reference to it on MSDN
or with some light googling and I&#39;m not really sure whether it is a bug
or whether it is just an artefact of CON: being there for backward
compatibility with MS-DOS 3.0 .

/J\


-- 

This e-mail is sponsored by <span class="clickylink"><a target="new" rel="nofollow" href="http://www.integration-house.com/">http://www.integration-house.com/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-169166" href="/Public/Bug/Display.html?id=17773#txn-169166">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;28&nbsp;09:28:08&nbsp;2006</span>
    <span class="description">steve.hay [...] uk.radan.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> perl5-porters [...] perl.org, bug-TermReadKey [...] rt.cpan.org, Adam Kennedy &lt;cpan [...] ali.as&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #17773]  Term::ReadLine, CON: and Term::ReadKey on Win32</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 28 Feb 2006 14:26:23 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Jonathan Stowe &lt;jns [...] gellyfish.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Steve Hay &lt;steve.hay [...] uk.radan.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/169166/54896/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/54896">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Jonathan Stowe wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; #include &lt;windows.h&gt;
&gt; #include &lt;stdio.h&gt;
&gt; 
&gt; int main &#40;int argc, char **argv&#41;
&gt; {
&gt;       HANDLE h;
&gt;       DWORD mode;
&gt; 
&gt;       h = CreateFile&#40;&#34;CON:&#34;,GENERIC_READ ,FILE_SHARE_READ,NULL,OPEN_EXISTING,FILE_ATTRIBUTE_NORMAL,NULL&#41;;
&gt; 
&gt;       if &#40; h == INVALID_HANDLE_VALUE &#41;
&gt;               printf&#40;&#34;CreateFile failed: %d\n&#34;, GetLastError&#40;&#41;&#41;;
&gt; 
&gt;       if &#40;! GetConsoleMode&#40;h,&#38;mode&#41; &#41;
&gt;               printf&#40;&#34;GetConsoleMode failed: %d\n&#34;, GetLastError&#40;&#41;&#41;;
&gt;       if &#40;! SetConsoleMode&#40;h,mode&#41; &#41;
&gt;               printf&#40;&#34;SetConsoleMode failed: %d\n&#34;, GetLastError&#40;&#41;&#41;;
&gt; 
&gt;       return 0;
&gt; }
&gt; 
&gt; Which shows the failure in SetConsoleMode&#40;&#41; with the same error code as
&gt; in the ReadMode failure.
</div>
The second argument &#40;DWORD dwDesiredAccess&#41; to CreateFile&#40;&#41; above is 
wrong for SetConsoleMode&#40;&#41;: you must specify GENERIC_WRITE to use 
SetConsoleMode&#40;&#41;. &#40;And likewise, you need GENERIC_READ for 
GetConsoleMode&#40;&#41;.&#41;

There is a section about handling consoles in the CreateFile&#40;&#41; 
documentation:

<span class="clickylink"><a target="new" rel="nofollow" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/fileio/fs/createfile.asp">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/fileio/fs/createfile.asp</a></span>

&#40;near the bottom of the page&#41;.


------------------------------------------------
Radan Computational Ltd.

The information contained in this message and any files transmitted with it are confidential and intended for the addressee&#40;s&#41; only. If you have received this message in error or there are any problems, please notify the sender immediately. The unauthorized use, disclosure, copying or alteration of this message is strictly forbidden. Note that any views or opinions presented in this email are solely those of the author and do not necessarily represent those of Radan Computational Ltd. The recipient&#40;s&#41; of this message should check it and any attached files for viruses: Radan Computational will accept no liability for any damage caused by any virus transmitted by this email.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-169178" href="/Public/Bug/Display.html?id=17773#txn-169178">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;28&nbsp;11:18:40&nbsp;2006</span>
    <span class="description">jns [...] gellyfish.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> perl5-porters &lt;perl5-porters [...] perl.org&gt;, bug-TermReadKey [...] rt.cpan.org, Adam Kennedy &lt;cpan [...] ali.as&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #17773]  Term::ReadLine, CON: and Term::ReadKey on Win32</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 28 Feb 2006 16:16:34 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Steve Hay &lt;steve.hay [...] uk.radan.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jonathan Stowe &lt;jns [...] gellyfish.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/169178/54902/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/54902">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, 2006-02-28 at 14:26, Steve Hay wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Jonathan Stowe wrote:
<div class="message-stanza open">&gt; &gt; #include &lt;windows.h&gt;
&gt; &gt; #include &lt;stdio.h&gt;
&gt; &gt; 
&gt; &gt; int main &#40;int argc, char **argv&#41;
&gt; &gt; {
&gt; &gt; HANDLE h;
&gt; &gt; DWORD mode;
&gt; &gt; 
&gt; &gt;     h = CreateFile&#40;&#34;CON:&#34;,GENERIC_READ,FILE_SHARE_READ,NULL,OPEN_EXISTING,FILE_ATTRIBUTE_NORMAL,NULL&#41;;
&gt; &gt; 
&gt; &gt;     if &#40; h == INVALID_HANDLE_VALUE &#41;
&gt; &gt;             printf&#40;&#34;CreateFile failed: %d\n&#34;, GetLastError&#40;&#41;&#41;;
&gt; &gt; 
&gt; &gt;     if &#40;! GetConsoleMode&#40;h,&#38;mode&#41; &#41;
&gt; &gt;             printf&#40;&#34;GetConsoleMode failed: %d\n&#34;, GetLastError&#40;&#41;&#41;;
&gt; &gt;     if &#40;! SetConsoleMode&#40;h,mode&#41; &#41;
&gt; &gt;             printf&#40;&#34;SetConsoleMode failed: %d\n&#34;, GetLastError&#40;&#41;&#41;;
&gt; &gt; 
&gt; &gt;     return 0;
&gt; &gt; }
&gt; &gt; 
&gt; &gt; Which shows the failure in SetConsoleMode&#40;&#41; with the same error code as
&gt; &gt; in the ReadMode failure.
</div>&gt;
&gt; The second argument &#40;DWORD dwDesiredAccess&#41; to CreateFile&#40;&#41; above is
&gt; wrong for SetConsoleMode&#40;&#41;: you must specify GENERIC_WRITE to use
&gt; SetConsoleMode&#40;&#41;. &#40;And likewise, you need GENERIC_READ for
&gt; GetConsoleMode&#40;&#41;.&#41;
&gt; There is a section about handling consoles in the CreateFile&#40;&#41;
&gt; documentation:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/fileio/fs/createfile.asp">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/fileio/fs/createfile.asp</a></span>
&gt; &#40;near the bottom of the page&#41;.
&gt; 
</div>
I had read that, wherein it says:

   CON GENERIC_READ GENERIC_WRITE  Causes CreateFile to fail;
GetLastError returns ERROR_FILE_NOT_FOUND.

And 
 
<span class="clickylink"><a target="new" rel="nofollow" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllproc/base/setconsolemode.asp">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dllproc/base/setconsolemode.asp</a></span>

Says:

  &#34;The handle must have the GENERIC_READ access right&#34;

If you set GENERIC_WRITE on the CreateFile&#40;&#41;, GetConsoleMode&#40;&#41; fails
with an invalid handle error and SetConsoleMode&#40;&#41; fails with
ERROR_INVALID_PARAMETER.  The CreateFile&#40;&#41; fails if you specify
GENERIC_ALL or GENERIC_READ | GENERIC_WRITE

The point of the above code was to abstract what happens when you do:

use Term::ReadKey;

open IN, &#39;&lt;CON&#39;;

Term::ReadKey::ReadMode&#40;4,\*IN&#41;;

which is, in summary, what is causing the problem that I am describing
when CON is used as the $console in Term::ReadLine.

attempting to sysopen CON with O_RDWR fails as does any attempt at +&lt; or
+&gt;&gt; with plain open.

But using sysopen on CONIN$ &#40;or CONOUT$&#41; with O_RDWR &#40;or in the above C
code with GENERIC_READ | GENERIC_WRITE&#41; does work.

So unless I&#39;m missing something else, what Term::ReadLine is doing with
&#39;con&#39; is not going to work.

/J\
-- 

This e-mail is sponsored by <span class="clickylink"><a target="new" rel="nofollow" href="http://www.integration-house.com/">http://www.integration-house.com/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-169873" href="/Public/Bug/Display.html?id=17773#txn-169873">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;02&nbsp;11:52:31&nbsp;2006</span>
    <span class="description">jns [...] gellyfish.co.uk -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-171536" href="/Public/Bug/Display.html?id=17773#txn-171536">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;07&nbsp;10:54:33&nbsp;2006</span>
    <span class="description">sthoenna [...] efn.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> perl5-porters [...] perl.org, bug-TermReadKey [...] rt.cpan.org, Adam Kennedy &lt;cpan [...] ali.as&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #17773]  Term::ReadLine, CON: and Term::ReadKey on Win32</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 7 Mar 2006 07:54:11 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Jonathan Stowe &lt;jns [...] gellyfish.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Yitzchak Scott-Thoennes &lt;sthoenna [...] efn.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/171536/56284/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/56284">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, Feb 28, 2006 at 02:07:39PM +0000, Jonathan Stowe wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Anyway it seems to boil down to Term::ReadLines use of &#39;con&#39; as the
&gt; console device on Windows:
&gt; 
&gt;     if &#40;$^O eq &#39;MacOS&#39;&#41; {
&gt;         $console = &#34;Dev:Console&#34;;
&gt;     } elsif &#40;-e &#34;/dev/tty&#34;&#41; {
&gt;       $console = &#34;/dev/tty&#34;;
&gt;     } elsif &#40;-e &#34;con&#34; or $^O eq &#39;MSWin32&#39;&#41; {
&gt;       $console = &#34;con&#34;;
&gt;     } else {
&gt;       $console = &#34;sys\$command&#34;;
&gt;     }
&gt; 
</div> ... 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Anyway, to cut to the point, should the use of &#39;CON:&#39; be changed in
&gt; Term::ReadLine?  At simplest we could just set $console to undef in the
&gt; above snippet, which works &#40;setting the input and output handles to
&gt; STDIN and STDOUT respectively&#41;, but some testing with
&gt; Term::ReadLine::Perl seems to indicate there might be some blocking &#40;at
&gt; least in the tests&#41; and I haven&#39;t had time to delve to far into that.
</div>
That wouldn&#39;t be good, since the above code presumably wants a console
even if STDIN/STDOUT are redirected elsewhere.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; An alternative would be to further special case Win32 in
&gt; Term::ReadLine::getConsole and have it sysopen CONIN$ and CONOUT$ as
&gt; appropriate as they don&#39;t seem to be afflicted with the same problem
&gt; that CON: has.  If people want to do that I&#39;ll be happy to work up a
&gt; patch.  Or maybe someone has a better idea.
</div>
What windows versions do CON&#40;IN|OUT&#41;$ exist on?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-171552" href="/Public/Bug/Display.html?id=17773#txn-171552">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;07&nbsp;11:22:53&nbsp;2006</span>
    <span class="description">jns [...] gellyfish.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> perl5-porters &lt;perl5-porters [...] perl.org&gt;, bug-TermReadKey [...] rt.cpan.org, Adam Kennedy &lt;cpan [...] ali.as&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #17773]  Term::ReadLine, CON: and Term::ReadKey on Win32</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 07 Mar 2006 16:21:08 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Yitzchak Scott-Thoennes &lt;sthoenna [...] efn.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jonathan Stowe &lt;jns [...] gellyfish.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/171552/56292/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/56292">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, 2006-03-07 at 15:54, Yitzchak Scott-Thoennes wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Tue, Feb 28, 2006 at 02:07:39PM +0000, Jonathan Stowe wrote:
<div class="message-stanza open">&gt; &gt; Anyway it seems to boil down to Term::ReadLines use of &#39;con&#39; as the
&gt; &gt; console device on Windows:
&gt; &gt; 
&gt; &gt;     if &#40;$^O eq &#39;MacOS&#39;&#41; {
&gt; &gt;         $console = &#34;Dev:Console&#34;;
&gt; &gt;     } elsif &#40;-e &#34;/dev/tty&#34;&#41; {
&gt; &gt;     $console = &#34;/dev/tty&#34;;
&gt; &gt;     } elsif &#40;-e &#34;con&#34; or $^O eq &#39;MSWin32&#39;&#41; {
&gt; &gt;     $console = &#34;con&#34;;
&gt; &gt;     } else {
&gt; &gt;     $console = &#34;sys\$command&#34;;
&gt; &gt;     }
&gt; &gt; 
</div>&gt;  ... 
<div class="message-stanza open">&gt; &gt; Anyway, to cut to the point, should the use of &#39;CON:&#39; be changed in
&gt; &gt; Term::ReadLine?  At simplest we could just set $console to undef in the
&gt; &gt; above snippet, which works &#40;setting the input and output handles to
&gt; &gt; STDIN and STDOUT respectively&#41;, but some testing with
&gt; &gt; Term::ReadLine::Perl seems to indicate there might be some blocking &#40;at
&gt; &gt; least in the tests&#41; and I haven&#39;t had time to delve to far into that.
</div>&gt; 
&gt; That wouldn&#39;t be good, since the above code presumably wants a console
&gt; even if STDIN/STDOUT are redirected elsewhere.
</div>
Yes, that&#39;s what I thought on reflection.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; An alternative would be to further special case Win32 in
&gt; &gt; Term::ReadLine::getConsole and have it sysopen CONIN$ and CONOUT$ as
&gt; &gt; appropriate as they don&#39;t seem to be afflicted with the same problem
&gt; &gt; that CON: has.  If people want to do that I&#39;ll be happy to work up a
&gt; &gt; patch.  Or maybe someone has a better idea.
</div>&gt; 
&gt; What windows versions do CON&#40;IN|OUT&#41;$ exist on?
</div>
As far as I can determine they have been part of the published Win32 API
forever, and the docs all list windows 95 and NT in the &#39;Applies to&#39;
list, some googling even suggests that it&#39;s there on Win32s. Is anyone
still testing on those older platforms BTW? 

Anyway, Unless anyone can see a compelling reason for me not to do so,
I&#39;ll knock up a patch to implement the second alternative in the next
couple of days and see how it goes.

/J\
-- 

This e-mail is sponsored by <span class="clickylink"><a target="new" rel="nofollow" href="http://www.integration-house.com/">http://www.integration-house.com/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-175390" href="/Public/Bug/Display.html?id=17773#txn-175390">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;11&nbsp;06:00:07&nbsp;2006</span>
    <span class="description">jns [...] gellyfish.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;ilya [...] Math.Berkeley.EDU&gt;, Steve Hay &lt;steve.hay [...] uk.radan.com&gt;, bug-TermReadKey [...] rt.cpan.org, Perl 5 Porters &lt;perl5-porters [...] perl.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #17773] Bug in Term::ReadKey being trigger by a bug in Term::ReadLine</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 11 Mar 2006 10:58:15 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Adam Kennedy &lt;adam [...] phase-n.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jonathan Stowe &lt;jns [...] gellyfish.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/175390/59583/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/59583">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#40;CCing in the TermReadKey rt queue&#41;

On Sat, 2006-03-11 at 05:39, Adam Kennedy wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Relaying a response from Ilya, since I believe he does not participate 
&gt; in rt.cpan.org or P5P.
&gt; 
&gt; CCing to all the relevant people &#40;and P5P for any other interested 
&gt; readers&#41;. Can you guys thrash this out between you? Let me know if 
&gt; there&#39;s anything I can do to help.
&gt; 
&gt; Thanks
&gt; 
&gt; Adam K
&gt; 
&gt; Ilya Zakharevich wrote:
<div class="message-stanza open">&gt; &gt; On Sat, Mar 11, 2006 at 01:44:42AM +1100, Adam Kennedy wrote:
<div class="message-stanza open">&gt; &gt;&gt; Hiya Ilya.
&gt; &gt;&gt;
&gt; &gt;&gt; I&#39;m down to one last show-stopper warning in my quest to get Win32 Perl sane, 
&gt; &gt;&gt; and what seemed to be a Term::ReadKey bug, I&#39;m being told is actually a 
&gt; &gt;&gt; Term::ReadLine bug. &#40;presumably in Term::ReadLine::readline.
&gt; &gt;&gt;
&gt; &gt;&gt; Can you take a look at this thread?
&gt; &gt;&gt;
&gt; &gt;&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2006-02/msg01018.html">http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2006-02/msg01018.html</a></span>
</div>&gt; &gt; 
&gt; &gt; AFAICS, there is no bug in T::R::L.  The bug is in the corresponding
&gt; &gt; Windows device driver.
&gt; &gt; 
</div></div>
Yep, my experiments indicate that the CON: device cannot handle being
opened in a way that will satisfy the SetConsoleMode&#40;&#41; API. CONIN$ works
fine.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; The place to put a workaround is in T::R, where it should open a pair
&gt; &gt; CONIN$ CONOUT$ before trying to open CON.
&gt; &gt;
</div></div>
Term::ReadKey is being passed the filehandle that is causing the
problems, by default if it isn&#39;t passed a filehandle then  ReadMode will
use STDIN which on windows is obtained at perl startup by GetStdHandle&#40;&#41;
&#40;and has thus been opened by the C runtime with the appropriate mode&#41;.
However Term::ReadLine needs to explicitly open the console whether
STDIO is redirected or not.

My initial idea was simply to fix Term::ReadLine&#39;s findConsole&#40;&#41; to
return &#39;CONIN$&#39; and &#39;CONOUT$&#39; rather than &#39;con&#39; for input and output
devices and then open &#39;CONIN$&#39; in Term::ReadLine::new&#40;&#41; for reading
*and* writing &#40;as required by SetConsoleMode&#40;&#41;,&#41; contrary to my previous
understanding a simple open with &#39;+&lt;&#39; is sufficient rather than going to
sysopen&#40;&#41; with O_RDWR.

However this doesn&#39;t work with respect of Term::ReadLine::Perl &#40;as will
be used on windows&#41; as it gets the names of the console devices by
calling Term::ReadLine-&gt;findConsole&#40;&#41; &#40;at line 45 &#41; and then opens the
devices itself rather than using the handles that would be opened by the
call to Term::ReadLine-&gt;new&#40;&#41;.  This can be remedied by changing the
mode with which the $IN device is opened to &#39;+&lt;&#39; in the line 46. I guess
Term::ReadLine::Perl may be able to use the Term::ReadLine handles but
there may be other reasons for it doing what it does.

Thus fixed the SetConsoleMode&#40;&#41; error does indeed go away, however we
now have a new problem &#40;at least in the CPAN shell and the
Term::ReadLine::Perl tests, I haven&#39;t checked in the debugger shell but
I guess it&#39;s the same:&#41; the input works fine and is echoed to the
console except four carriage returns are required to enter the input
line &#40;and it is consistently four regardless of the number of characters
entered.&#41;  I guess one would find the reason for this in Term::ReadLine,
but I haven&#39;t had the time to examine this.

Er, and that&#39;s it.

/J\
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  
<div class="message-stanza open">&gt; &gt; Hope this helps,
&gt; &gt; Ilya
</div></div>-- 

This e-mail is sponsored by <span class="clickylink"><a target="new" rel="nofollow" href="http://www.integration-house.com/">http://www.integration-house.com/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-175755" href="/Public/Bug/Display.html?id=17773#txn-175755">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;12&nbsp;00:10:54&nbsp;2006</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Adam Kennedy &lt;adam [...] phase-n.com&gt;, Steve Hay &lt;steve.hay [...] uk.radan.com&gt;, bug-TermReadKey [...] rt.cpan.org, Perl 5 Porters &lt;perl5-porters [...] perl.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #17773] Bug in Term::ReadKey being trigger by a bug in Term::ReadLine</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 11 Mar 2006 21:09:52 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Jonathan Stowe &lt;jns [...] gellyfish.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/175755/59872/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/59872">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, Mar 11, 2006 at 10:58:15AM +0000, Jonathan Stowe wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; &gt; The place to put a workaround is in T::R, where it should open a pair
&gt; &gt; &gt; CONIN$ CONOUT$ before trying to open CON.
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Term::ReadKey is being passed...
</div>
Sorry, mea culpa.  T::R above was supposed to mean Term::ReadLine.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; My initial idea was simply to fix Term::ReadLine&#39;s findConsole&#40;&#41; to
&gt; return &#39;CONIN$&#39; and &#39;CONOUT$&#39; rather than &#39;con&#39; for input and output
&gt; devices
</div>
This is what I meant.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; and then open &#39;CONIN$&#39; in Term::ReadLine::new&#40;&#41; for reading
&gt; *and* writing &#40;as required by SetConsoleMode&#40;&#41;,&#41; contrary to my previous
&gt; understanding a simple open with &#39;+&lt;&#39; is sufficient rather than going to
&gt; sysopen&#40;&#41; with O_RDWR.
</div>
Something like

  open FIN,
   &#40;$console eq &#39;CONIN$&#39;&#41; ? &#34;+&lt; $console&#34; : &#34;&lt; $console&#34;; #  Bug on Win

?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; However this doesn&#39;t work with respect of Term::ReadLine::Perl &#40;as will
&gt; be used on windows&#41; as it gets the names of the console devices by
&gt; calling Term::ReadLine-&gt;findConsole&#40;&#41; &#40;at line 45 &#41; and then opens the
&gt; devices itself rather than using the handles that would be opened by the
&gt; call to Term::ReadLine-&gt;new&#40;&#41;.
</div>
I can copy the code above...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thus fixed the SetConsoleMode&#40;&#41; error does indeed go away, however we
&gt; now have a new problem &#40;at least in the CPAN shell and the
&gt; Term::ReadLine::Perl tests, I haven&#39;t checked in the debugger shell but
&gt; I guess it&#39;s the same:&#41; the input works fine and is echoed to the
&gt; console except four carriage returns are required to enter the input
&gt; line &#40;and it is consistently four regardless of the number of characters
&gt; entered.&#41;
</div>
I observe 2, not 4 on unpatched 5.8.7 on OS/2.  This is one of very
old bugs in perlio layers; I fixed it about last Fall.  Is not it
fixed in 5.8.8?

Hope this helps,
Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-176011" href="/Public/Bug/Display.html?id=17773#txn-176011">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;12&nbsp;04:48:40&nbsp;2006</span>
    <span class="description">jns [...] gellyfish.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Adam Kennedy &lt;adam [...] phase-n.com&gt;, Steve Hay &lt;steve.hay [...] uk.radan.com&gt;, bug-TermReadKey [...] rt.cpan.org, Perl 5 Porters &lt;perl5-porters [...] perl.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #17773] Bug in Term::ReadKey being trigger by a bug in Term::ReadLine</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 12 Mar 2006 09:47:34 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jonathan Stowe &lt;jns [...] gellyfish.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/176011/60078/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/60078">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun, 2006-03-12 at 05:09, Ilya Zakharevich wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sat, Mar 11, 2006 at 10:58:15AM +0000, Jonathan Stowe wrote:
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt; The place to put a workaround is in T::R, where it should open a pair
&gt; &gt; &gt; &gt; CONIN$ CONOUT$ before trying to open CON.
</div></div>&gt; 
<div class="message-stanza open">&gt; &gt; Term::ReadKey is being passed...
</div>&gt; 
&gt; Sorry, mea culpa.  T::R above was supposed to mean Term::ReadLine.
&gt; 
<div class="message-stanza open">&gt; &gt; My initial idea was simply to fix Term::ReadLine&#39;s findConsole&#40;&#41; to
&gt; &gt; return &#39;CONIN$&#39; and &#39;CONOUT$&#39; rather than &#39;con&#39; for input and output
&gt; &gt; devices
</div>&gt; 
&gt; This is what I meant.
&gt; 
<div class="message-stanza open">&gt; &gt; and then open &#39;CONIN$&#39; in Term::ReadLine::new&#40;&#41; for reading
&gt; &gt; *and* writing &#40;as required by SetConsoleMode&#40;&#41;,&#41; contrary to my previous
&gt; &gt; understanding a simple open with &#39;+&lt;&#39; is sufficient rather than going to
&gt; &gt; sysopen&#40;&#41; with O_RDWR.
</div>&gt; 
&gt; Something like
&gt; 
&gt;   open FIN,
&gt;    &#40;$console eq &#39;CONIN$&#39;&#41; ? &#34;+&lt; $console&#34; : &#34;&lt; $console&#34;; #  Bug on Win
&gt; 
</div>
Yeah, that&#39;s the baby :-&#41;

I&#39;ll send the patch I have for Term::ReadLine when I am back on the
machine where I was testing this tomorrow.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ?
&gt; 
<div class="message-stanza open">&gt; &gt; However this doesn&#39;t work with respect of Term::ReadLine::Perl &#40;as will
&gt; &gt; be used on windows&#41; as it gets the names of the console devices by
&gt; &gt; calling Term::ReadLine-&gt;findConsole&#40;&#41; &#40;at line 45 &#41; and then opens the
&gt; &gt; devices itself rather than using the handles that would be opened by the
&gt; &gt; call to Term::ReadLine-&gt;new&#40;&#41;.
</div>&gt; 
&gt; I can copy the code above...
&gt; 
</div>
Fabulous!

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Thus fixed the SetConsoleMode&#40;&#41; error does indeed go away, however we
&gt; &gt; now have a new problem &#40;at least in the CPAN shell and the
&gt; &gt; Term::ReadLine::Perl tests, I haven&#39;t checked in the debugger shell but
&gt; &gt; I guess it&#39;s the same:&#41; the input works fine and is echoed to the
&gt; &gt; console except four carriage returns are required to enter the input
&gt; &gt; line &#40;and it is consistently four regardless of the number of characters
&gt; &gt; entered.&#41;
</div>&gt; 
&gt; I observe 2, not 4 on unpatched 5.8.7 on OS/2.  This is one of very
&gt; old bugs in perlio layers; I fixed it about last Fall.  Is not it
&gt; fixed in 5.8.8?
</div>
It appears so - I was testing against an rsync&#39;ed maint, I&#39;ll check with
blead on Monday or maybe someone can find the patch down the back of the
sofa and apply it :-&#41;

Thanks

/J\
-- 

This e-mail is sponsored by <span class="clickylink"><a target="new" rel="nofollow" href="http://www.integration-house.com/">http://www.integration-house.com/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-176025" href="/Public/Bug/Display.html?id=17773#txn-176025">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;12&nbsp;06:08:27&nbsp;2006</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Adam Kennedy &lt;adam [...] phase-n.com&gt;, Steve Hay &lt;steve.hay [...] uk.radan.com&gt;, bug-TermReadKey [...] rt.cpan.org, Perl 5 Porters &lt;perl5-porters [...] perl.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #17773] Bug in Term::ReadKey being trigger by a bug in Term::ReadLine</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 12 Mar 2006 03:07:25 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Jonathan Stowe &lt;jns [...] gellyfish.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/176025/60092/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/60092">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 405b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun, Mar 12, 2006 at 09:47:34AM +0000, Jonathan Stowe wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; I observe 2, not 4 on unpatched 5.8.7 on OS/2.  This is one of very
&gt; &gt; old bugs in perlio layers; I fixed it about last Fall.  Is not it
&gt; &gt; fixed in 5.8.8?
</div>&gt; 
&gt; It appears so - I was testing against an rsync&#39;ed maint,
</div>
Oh, my!  Msg ID is

  20050927090734.GB3687@math.berkeley.edu

change is 25618.  It should be there...

Yours,
Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-176323" href="/Public/Bug/Display.html?id=17773#txn-176323">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;13&nbsp;05:28:53&nbsp;2006</span>
    <span class="description">jns [...] gellyfish.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Adam Kennedy &lt;adam [...] phase-n.com&gt;, Steve Hay &lt;steve.hay [...] uk.radan.com&gt;, bug-TermReadKey [...] rt.cpan.org, Perl 5 Porters &lt;perl5-porters [...] perl.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #17773] Bug in Term::ReadKey being trigger by a bug in Term::ReadLine</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 13 Mar 2006 10:26:57 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jonathan Stowe &lt;jns [...] gellyfish.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/176323/60306/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/60306">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 931b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun, 2006-03-12 at 11:07, Ilya Zakharevich wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sun, Mar 12, 2006 at 09:47:34AM +0000, Jonathan Stowe wrote:
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; I observe 2, not 4 on unpatched 5.8.7 on OS/2.  This is one of very
&gt; &gt; &gt; old bugs in perlio layers; I fixed it about last Fall.  Is not it
&gt; &gt; &gt; fixed in 5.8.8?
</div>&gt; &gt; 
&gt; &gt; It appears so - I was testing against an rsync&#39;ed maint,
</div>&gt; 
&gt; Oh, my!  Msg ID is
&gt; 
&gt;   20050927090734.GB3687@math.berkeley.edu
&gt; 
&gt; change is 25618.  It should be there...
</div>
Indeed, I found it almost immediately after I replied yesterday. And
using the test case from the original message it appears that the
original problem has indeed been fixed, so it would appear that the
&#34;four returns required to enter line&#34; problem lies elsewhere.

I&#39;ll try to isolate a test case that can illustrate this behaviour when
I&#39;ve sent the patches for the original problem.

/J\


-- 

This e-mail is sponsored by <span class="clickylink"><a target="new" rel="nofollow" href="http://www.integration-house.com/">http://www.integration-house.com/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-176407" href="/Public/Bug/Display.html?id=17773#txn-176407">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;13&nbsp;11:11:25&nbsp;2006</span>
    <span class="description">jns [...] gellyfish.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> bug-TermReadKey [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [PATCH lib/Term/ReadLine] Re: [cpan #17773] Bug in Term::ReadKey being trigger by a bug in Term::ReadLine</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 13 Mar 2006 16:09:44 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> perl5-porters &lt;perl5-porters [...] perl.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jonathan Stowe &lt;jns [...] gellyfish.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/176407/60361/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/60361">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The following is a  fix for the console handles created by
Term::ReadLine being no good for Term::ReadKey on windows. I guess Ilya
will issue a new Term::ReadLine::Perl to quiet the error in the CPAN
shell and the debugger.  It should be good for blead and maint.

--- devel/perl/perl-maint/lib/Term/ReadLine.pm  2006-01-12 19:26:15.000000000 +0000
+++ work/Via/shared/jstowe/perl/lib/Term/ReadLine.pm    2006-03-13 15:46:46.000000000 +0000
@@ -209,13 +209,15 @@
  
 sub findConsole {
     my $console;
+    my $consoleOUT;
  
     if &#40;$^O eq &#39;MacOS&#39;&#41; {
         $console = &#34;Dev:Console&#34;;
     } elsif &#40;-e &#34;/dev/tty&#34;&#41; {
        $console = &#34;/dev/tty&#34;;
     } elsif &#40;-e &#34;con&#34; or $^O eq &#39;MSWin32&#39;&#41; {
-       $console = &#34;con&#34;;
+       $console = &#39;CONIN$&#39;;
+       $consoleOUT = &#39;CONOUT$&#39;;
     } else {
        $console = &#34;sys\$command&#34;;
     }
@@ -231,10 +233,10 @@
       }
     }
  
-    my $consoleOUT = $console;
+    $consoleOUT = $console unless defined $consoleOUT;
     $console = &#34;&#38;STDIN&#34; unless defined $console;
     if &#40;!defined $consoleOUT&#41; {
-      $consoleOUT = defined fileno&#40;STDERR&#41; ? &#34;&#38;STDERR&#34; : &#34;&#38;STDOUT&#34;;
+      $consoleOUT = defined fileno&#40;STDERR&#41; &#38;&#38; $^O ne &#39;MSWin32&#39; ? &#34;&#38;STDERR&#34; : &#34;&#38;STDOUT&#34;;
     }
     &#40;$console,$consoleOUT&#41;;
 }
@@ -247,8 +249,13 @@
   if &#40;@_==2&#41; {
     my&#40;$console, $consoleOUT&#41; = $_[0]-&gt;findConsole;
  
-    open&#40;FIN, &#34;&lt;$console&#34;&#41;;
-    open&#40;FOUT,&#34;&gt;$consoleOUT&#34;&#41;;
+
+    # the Windows CONIN$ needs GENERIC_WRITE mode to allow
+    # a SetConsoleMode&#40;&#41; if we end up using Term::ReadKey
+    open FIN, &#40;  $^O eq &#39;MSWin32&#39; &#38;&#38; $console eq &#39;CONIN$&#39; &#41; ? &#34;+&lt;$console&#34; :
+                                                              &#34;&lt;$console&#34;;
+    open FOUT,&#34;&gt;$consoleOUT&#34;;
+
     #OUT-&gt;autoflush&#40;1&#41;;                # Conflicts with debugger?
     my $sel = select&#40;FOUT&#41;;
     $| = 1;                            # for DB::OUT


-- 

This e-mail is sponsored by <span class="clickylink"><a target="new" rel="nofollow" href="http://www.integration-house.com/">http://www.integration-house.com/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1279602" href="/Public/Bug/Display.html?id=17773#txn-1279602">#</a>      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;26&nbsp;20:42:24&nbsp;2013</span>
    <span class="description">jns [...] gellyfish.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1279602/678022/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/678022">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 23b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I think this was sorted
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1279605" href="/Public/Bug/Display.html?id=17773#txn-1279605">#</a>      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;26&nbsp;20:42:25&nbsp;2013</span>
    <span class="description">jns [...] gellyfish.co.uk -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.844116</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
