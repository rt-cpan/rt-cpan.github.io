<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #99880 for Crypt-Random: Dubious test in t/generator.t</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #99880 for Crypt-Random: Dubious test in t/generator.t</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Crypt-Random/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Crypt-Random/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Crypt-Random/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Crypt-Random/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Crypt-Random">Crypt-Random CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">99880</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Crypt-Random/Active/">Crypt-Random</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
paul [...] city-fan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-8588-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.25    </td>
  </tr>
  <tr id="CF-8589-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;29&nbsp;07:20:18&nbsp;2014</span>
    <span class="description">paul [...] city-fan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Dubious test in t/generator.t</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">One of the tests in t/generator.t involves generating two random 10-bit integers and checking that they are not the same. The test fails if they are the same, which would normally happen about 0.1% of the time. This is probably not a big problem but for downstream distributions that do frequent rebuilds, this can trigger a &#34;fails to build from source&#34; bug that then needs to be investigated.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;25&nbsp;15:22:51&nbsp;2015</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2014-10-29 07:20:18, paul@city-fan.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; One of the tests in t/generator.t involves generating two random 10-
&gt; bit integers and checking that they are not the same. The test fails
&gt; if they are the same, which would normally happen about 0.1% of the
&gt; time. This is probably not a big problem but for downstream
&gt; distributions that do frequent rebuilds, this can trigger a &#34;fails to
&gt; build from source&#34; bug that then needs to be investigated.
</div>
This probably explains the fails visible at CPAN Testers:
<span class="clickylink"><a target="new" rel="nofollow" href="http://matrix.cpantesters.org/?dist=Crypt-Random%201.25">http://matrix.cpantesters.org/?dist=Crypt-Random%201.25</a></span>
Currently it&#39;s:
* PASS: 6801
* FAIL: 48
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;25&nbsp;15:22:51&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;01&nbsp;00:10:48&nbsp;2017</span>
    <span class="description">KENTNL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza"><p>
	replaced the == test with</p>

<p>
	&nbsp; &nbsp; warn(&quot;$x == $y Strength=$$gen{Strength} Provider=$$gen{Provider}&quot;) if $x == $y;<br>

	<br>

	And ran 10,000 times. ( == 30,000 invocations of test() )<br>

	<br>

	67/30000 = 0.22%</p>

<p>
	19 were from devurandom&nbsp; ( 0.19% )<br>

	24 were from devrandom&nbsp;&nbsp;&nbsp; ( 0.24% )<br>

	24 were from rand&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ( 0.24% )<br>

	<br>

	However, the *distribution* of where these pairs occured were a bit disturbing: 100% of them occurred above 512<br>

	<br>

	Which suggests there&#39;s a whole bit of data lost somewhere, or some kind of leak in the random.<br>

	<br>

	Image of distribution, and the data of sequential collisions attached.<br>

	<br>

	This seems potentially far more serious than a bad test.<br>

	<br>

	--&nbsp;<br>

	- CPAN kentnl@cpan.org<br>

	- Gentoo Perl Maintainer kentnl@gentoo.org ( perl@gentoo.org )<br>

	&nbsp;</p>


</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> samples.tsv</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">rand	devrandom	devurandom
584	528	527
587	529	544
607	559	581
615	597	593
617	599	599
620	600	621
637	601	666
670	603	677
714	610	701
727	679	726
732	737	835
766	761	858
772	808	883
808	821	884
815	829	911
816	855	915
817	911	964
818	913	987
822	933	1011
831	960	
850	992	
867	994	
890	1009	
937	1011	
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> snapshot_20171001_170650.png</td>
  </tr>
</table>

<div class="messagebody">
<img alt="snapshot_20171001_170650.png" title="snapshot_20171001_170650.png" src="/Ticket/Attachment/1750497/941695/" /></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;01&nbsp;04:18:48&nbsp;2017</span>
    <span class="description">KENTNL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza">Carefully reading the documentation says that this sort of distribution is intended *design*. Just from a consumer perspective is incredibly unexpected, and very poorly documented.<br>

<br>

Even conceptually, I find this design questionable, but I&#39;ll have to follow up with some people to see how reasonable it is.<br>

<br>

--&nbsp;<br>

- CPAN kentnl@cpan.org<br>

- Gentoo Perl Maintainer kentnl@gentoo.org ( perl@gentoo.org )<br>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;22&nbsp;11:12:33&nbsp;2018</span>
    <span class="description">VIPUL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I am fixing this in upcoming release.  I don&#39;t think we can keep this particular test for the reason you describe.  Even at high bitsizes, it is not guaranteed to pass. 

On Wed Oct 29 07:20:18 2014, paul@city-fan.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; One of the tests in t/generator.t involves generating two random 10-
&gt; bit integers and checking that they are not the same. The test fails
&gt; if they are the same, which would normally happen about 0.1% of the
&gt; time. This is probably not a big problem but for downstream
&gt; distributions that do frequent rebuilds, this can trigger a &#34;fails to
&gt; build from source&#34; bug that then needs to be investigated.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;22&nbsp;11:28:11&nbsp;2018</span>
    <span class="description">VIPUL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Looks worrisome.  I&#39;ll dig into it. 

On Sun Oct 01 00:10:48 2017, KENTNL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; replaced the == test with
&gt; 
&gt; warn&#40;&#34;$x == $y Strength=$$gen{Strength} Provider=$$gen{Provider}&#34;&#41; if
&gt; $x == $y;
&gt; 
&gt; And ran 10,000 times. &#40; == 30,000 invocations of test&#40;&#41; &#41;
&gt; 
&gt; 67/30000 = 0.22%
&gt; 
&gt; 19 were from devurandom &#40; 0.19% &#41;
&gt; 24 were from devrandom &#40; 0.24% &#41;
&gt; 24 were from rand &#40; 0.24% &#41;
&gt; 
&gt; However, the *distribution* of where these pairs occured were a bit
&gt; disturbing:
&gt; 100% of them occurred above 512
&gt; 
&gt; Which suggests there&#39;s a whole bit of data lost somewhere, or some
&gt; kind of leak
&gt; in the random.
&gt; 
&gt; Image of distribution, and the data of sequential collisions attached.
&gt; 
&gt; This seems potentially far more serious than a bad test.
&gt; 
&gt; --
&gt; - CPAN kentnl@cpan.org
&gt; - Gentoo Perl Maintainer kentnl@gentoo.org &#40; perl@gentoo.org &#41;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;22&nbsp;13:59:00&nbsp;2018</span>
    <span class="description">VIPUL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Probably not a great decision at the time, but uniform distribution over the interval requires passing Uniform =&gt; 1 to integer&#40;&#41;, makerandom&#40;&#41; etc.  In 1.52, I allow Uniform =&gt; 1 to be passed to the constructor and also introduced a chi-square test to test a generated distribution. 

I am going to further test dependent modules and see if I can safely make Uniform =&gt; 1 the default. 
 
On Sat Dec 22 11:28:11 2018, VIPUL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Looks worrisome.  I&#39;ll dig into it. 
&gt; 
&gt; On Sun Oct 01 00:10:48 2017, KENTNL wrote:
<div class="message-stanza open">&gt; &gt; replaced the == test with
&gt; &gt; 
&gt; &gt; warn&#40;&#34;$x == $y Strength=$$gen{Strength} Provider=$$gen{Provider}&#34;&#41; if
&gt; &gt; $x == $y;
&gt; &gt; 
&gt; &gt; And ran 10,000 times. &#40; == 30,000 invocations of test&#40;&#41; &#41;
&gt; &gt; 
&gt; &gt; 67/30000 = 0.22%
&gt; &gt; 
&gt; &gt; 19 were from devurandom &#40; 0.19% &#41;
&gt; &gt; 24 were from devrandom &#40; 0.24% &#41;
&gt; &gt; 24 were from rand &#40; 0.24% &#41;
&gt; &gt; 
&gt; &gt; However, the *distribution* of where these pairs occured were a bit
&gt; &gt; disturbing:
&gt; &gt; 100% of them occurred above 512
&gt; &gt; 
&gt; &gt; Which suggests there&#39;s a whole bit of data lost somewhere, or some
&gt; &gt; kind of leak
&gt; &gt; in the random.
&gt; &gt; 
&gt; &gt; Image of distribution, and the data of sequential collisions attached.
&gt; &gt; 
&gt; &gt; This seems potentially far more serious than a bad test.
&gt; &gt; 
&gt; &gt; --
&gt; &gt; - CPAN kentnl@cpan.org
&gt; &gt; - Gentoo Perl Maintainer kentnl@gentoo.org &#40; perl@gentoo.org &#41;
</div>&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;22&nbsp;13:59:00&nbsp;2018</span>
    <span class="description">VIPUL [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
