<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #118053 for PAR-Packer: Problem with packed perl archive for biber on 64-bit Cygwin</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #118053 for PAR-Packer: Problem with packed perl archive for biber on 64-bit Cygwin</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/PAR-Packer/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/PAR-Packer/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/PAR-Packer/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/PAR-Packer/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/PAR-Packer">PAR-Packer CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">118053</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/PAR-Packer/Active/">PAR-Packer</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
kbrown [...] cornell.edu

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-41710-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.035    </td>
  </tr>
  <tr id="CF-41711-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;23&nbsp;15:51:35&nbsp;2016</span>
    <span class="description">kbrown [...] cornell.edu -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Kime Philip &lt;philkime [...] kime.org.uk&gt;, David Carlisle &lt;d.p.carlisle [...] gmail.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Problem with packed perl archive for biber on 64-bit Cygwin</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 23 Sep 2016 15:51:18 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PAR-Packer [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ken Brown &lt;kbrown [...] cornell.edu&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Roderich,

Phil Kime suggested that I raise a ticket concerning a problem I&#39;m 
having with a packed archive for biber 
&#40;<span class="clickylink"><a target="new" rel="nofollow" href="https://sourceforge.net/projects/biblatex-biber/&#41;">https://sourceforge.net/projects/biblatex-biber/&#41;</a></span> on 64-bit Cygwin. 
The problem doesn&#39;t occur on 32-bit Cygwin.

Here&#39;s the short version: I use PAR::Packer to create a packed archive 
biber.exe.  It unpacks itself and runs fine in the Cygwin distribution 
on which I created it.  But if I run it on a fresh, bare-bones Cygwin 
installation &#40;which in particular does not have perl installed&#41;, it 
fails as follows:

$ ./biber.exe
C:/cygwin64a/tmp/par-6b62726f776e/cache-128a18f7440676b8f4632879a6f42b099bad8a05/biber: 
error while loading shared libraries: cygperl5_24.dll: cannot open 
shared object file: No such file or directory

When I look at the cache, I see the following:

$ ls -l 
/tmp/par-6b62726f776e/cache-128a18f7440676b8f4632879a6f42b099bad8a05/
total 2136
-rwxr-x--- 1 kbrown None   53248 Sep 23 15:01 biber
-rwxr-x--- 1 kbrown None 2133011 Sep 23 15:01 cygperl5_24.dll

So nothing has been unpacked except biber and one DLL.  And then the 
system tries to load that DLL and fails, because its dependent DLLs have 
not yet been unpacked.  In this case the DLL cygcrypt-0.dll is the 
problematic one, as we can see by running cygcheck:

$ cygcheck 
/tmp/par-6b62726f776e/cache-128a18f7440676b8f4632879a6f42b099bad8a05/cygperl5_24.dll
C:\cygwin64a\tmp\par-6b62726f776e\cache-128a18f7440676b8f4632879a6f42b099bad8a05\cygperl5_24.dll
   C:\cygwin64a\bin\cygwin1.dll
     C:\WINDOWS\system32\KERNEL32.dll
       C:\WINDOWS\system32\ntdll.dll
       C:\WINDOWS\system32\KERNELBASE.dll
   C:\cygwin64a\bin\cygssp-0.dll
cygcheck: track_down: could not find cygcrypt-0.dll

[Note that cygperl5_24.dll also depends on cygssp-0.dll, which also 
should have been unpacked; but in this case it doesn&#39;t matter, because 
/usr/bin/cygssp-0.dll exists in the bare-bones Cygwin install.]

Do you have any idea why biber.exe doesn&#39;t fully unpack itself before 
trying to load cygperl5_24.dll?

The rest of this message provides more details about how I built 
biber.exe.  Please let me know if there&#39;s anything else you need.

My system &#40;both build and test&#41;:

$ uname -a
CYGWIN_NT-10.0 moufang 2.6.0&#40;0.304/5/3&#41; 2016-08-31 14:32 x86_64 Cygwin

My perl on the build system:

$ perl -v

This is perl 5, version 24, subversion 0 &#40;v5.24.0&#41; built for 
x86_64-cygwin-threads-multi

I built this perl myself, because biber requires perl 5.24, and Cygwin&#39;s 
perl is currently at 5.22.

I created the build installation by doing the following:

1. Start with a fresh Cygwin installation, install my build of 
perl-5.24, and install a few other packages that are needed for the next 
steps.

2. Use cpan to install the build prerequisites for biber and to install 
PAR::Packer.  &#40;I repeated this process today to make sure my build 
environment was clean, so all modules are at their latest versions as of 
today.&#41;

3. Clone the biber git repo, checkout v2.6, and build and install biber.

4. Create the packed biber archive by running the attached script 
build.sh, which uses the attached auxiliary file biber.files.

Thanks in advance for any help you can offer.

Ken
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;24&nbsp;21:06:22&nbsp;2016</span>
    <span class="description">kbrown [...] cornell.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Kime Philip &lt;philkime [...] kime.org.uk&gt;, David Carlisle &lt;d.p.carlisle [...] gmail.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #118053] AutoReply: Problem with packed perl archive for biber on 64-bit Cygwin</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 24 Sep 2016 21:06:07 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PAR-Packer [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ken Brown &lt;kbrown [...] cornell.edu&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 9/23/2016 3:51 PM, Bugs in PAR-Packer via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Greetings,
&gt;
&gt; This message has been automatically generated in response to the
&gt; creation of a trouble ticket regarding:
&gt;       &#34;Problem with packed perl archive for biber on 64-bit Cygwin&#34;,
&gt; a summary of which appears below.
&gt;
&gt; There is no need to reply to this message right now.  Your ticket has been
&gt; assigned an ID of [rt.cpan.org #118053].  Your ticket is accessible
&gt; on the web at:
&gt;
&gt;     <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=118053">https://rt.cpan.org/Ticket/Display.html?id=118053</a></span>
&gt;
&gt; Please include the string:
&gt;
&gt;          [rt.cpan.org #118053]
&gt;
&gt; in the subject line of all future correspondence about this issue. To do so,
&gt; you may reply to this message.
&gt;
&gt;                         Thank you,
&gt;                         bug-PAR-Packer@rt.cpan.org
&gt;
&gt; -------------------------------------------------------------------------
&gt; Hi Roderich,
&gt;
&gt; Phil Kime suggested that I raise a ticket concerning a problem I&#39;m
&gt; having with a packed archive for biber
&gt; &#40;<span class="clickylink"><a target="new" rel="nofollow" href="https://sourceforge.net/projects/biblatex-biber/&#41;">https://sourceforge.net/projects/biblatex-biber/&#41;</a></span> on 64-bit Cygwin.
&gt; The problem doesn&#39;t occur on 32-bit Cygwin.
&gt;
&gt; Here&#39;s the short version: I use PAR::Packer to create a packed archive
&gt; biber.exe.  It unpacks itself and runs fine in the Cygwin distribution
&gt; on which I created it.  But if I run it on a fresh, bare-bones Cygwin
&gt; installation &#40;which in particular does not have perl installed&#41;, it
&gt; fails as follows:
&gt;
&gt; $ ./biber.exe
&gt; C:/cygwin64a/tmp/par-6b62726f776e/cache-128a18f7440676b8f4632879a6f42b099bad8a05/biber:
&gt; error while loading shared libraries: cygperl5_24.dll: cannot open
&gt; shared object file: No such file or directory
&gt;
&gt; When I look at the cache, I see the following:
&gt;
&gt; $ ls -l
&gt; /tmp/par-6b62726f776e/cache-128a18f7440676b8f4632879a6f42b099bad8a05/
&gt; total 2136
&gt; -rwxr-x--- 1 kbrown None   53248 Sep 23 15:01 biber
&gt; -rwxr-x--- 1 kbrown None 2133011 Sep 23 15:01 cygperl5_24.dll
&gt;
&gt; So nothing has been unpacked except biber and one DLL.  And then the
&gt; system tries to load that DLL and fails, because its dependent DLLs have
&gt; not yet been unpacked.  In this case the DLL cygcrypt-0.dll is the
&gt; problematic one, as we can see by running cygcheck:
&gt;
&gt; $ cygcheck
&gt; /tmp/par-6b62726f776e/cache-128a18f7440676b8f4632879a6f42b099bad8a05/cygperl5_24.dll
&gt; C:\cygwin64a\tmp\par-6b62726f776e\cache-128a18f7440676b8f4632879a6f42b099bad8a05\cygperl5_24.dll
&gt;    C:\cygwin64a\bin\cygwin1.dll
&gt;      C:\WINDOWS\system32\KERNEL32.dll
&gt;        C:\WINDOWS\system32\ntdll.dll
&gt;        C:\WINDOWS\system32\KERNELBASE.dll
&gt;    C:\cygwin64a\bin\cygssp-0.dll
&gt; cygcheck: track_down: could not find cygcrypt-0.dll
&gt;
&gt; [Note that cygperl5_24.dll also depends on cygssp-0.dll, which also
&gt; should have been unpacked; but in this case it doesn&#39;t matter, because
&gt; /usr/bin/cygssp-0.dll exists in the bare-bones Cygwin install.]
&gt;
&gt; Do you have any idea why biber.exe doesn&#39;t fully unpack itself before
&gt; trying to load cygperl5_24.dll?
&gt;
&gt; The rest of this message provides more details about how I built
&gt; biber.exe.  Please let me know if there&#39;s anything else you need.
&gt;
&gt; My system &#40;both build and test&#41;:
&gt;
&gt; $ uname -a
&gt; CYGWIN_NT-10.0 moufang 2.6.0&#40;0.304/5/3&#41; 2016-08-31 14:32 x86_64 Cygwin
&gt;
&gt; My perl on the build system:
&gt;
&gt; $ perl -v
&gt;
&gt; This is perl 5, version 24, subversion 0 &#40;v5.24.0&#41; built for
&gt; x86_64-cygwin-threads-multi
&gt;
&gt; I built this perl myself, because biber requires perl 5.24, and Cygwin&#39;s
&gt; perl is currently at 5.22.
&gt;
&gt; I created the build installation by doing the following:
&gt;
&gt; 1. Start with a fresh Cygwin installation, install my build of
&gt; perl-5.24, and install a few other packages that are needed for the next
&gt; steps.
&gt;
&gt; 2. Use cpan to install the build prerequisites for biber and to install
&gt; PAR::Packer.  &#40;I repeated this process today to make sure my build
&gt; environment was clean, so all modules are at their latest versions as of
&gt; today.&#41;
&gt;
&gt; 3. Clone the biber git repo, checkout v2.6, and build and install biber.
&gt;
&gt; 4. Create the packed biber archive by running the attached script
&gt; build.sh, which uses the attached auxiliary file biber.files.
&gt;
&gt; Thanks in advance for any help you can offer.
&gt;
&gt; Ken
</div>
I understand a little better how the packed executable is supposed to 
work.  First the embedded files are extracted, which are a perl 
interpreter &#40;named biber&#41; and cygperl5_24.dll in; it&#39;s then supposed to 
be possible to run the extracted biber, which will extract the rest of 
the files.  Roderich, is this right?

So it seems that the solution should be to add cygcrypt-0.dll as an 
embedded file.  I haven&#39;t tried to do this in the PAR::Packer source yet 
but I did test the theory as follows: I installed the libcrypt0 package 
&#40;which provides cygcrypt-0.dll&#41; in my bare-bones test installation, and 
biber.exe then unpacked itself and ran.

The reason I didn&#39;t see this problem in 32-bit Cygwin is that for some 
reason my 32-bit build of cygperl5_24.dll doesn&#39;t depend on cygcrypt-0.dll.

Roderich, should the build of PAR::Packer have detected the need to 
embed cygcrypt-0.dll?  If not, what&#39;s the right fix for this?

David, I don&#39;t think this explains your symptoms.  I&#39;ll write separately 
to you about that, since I don&#39;t think it&#39;s related to this PAR::Packer 
issue.

Ken
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;25&nbsp;03:06:46&nbsp;2016</span>
    <span class="description">RSCHUPP [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2016-09-24 21:06:22, kbrown@cornell.edu wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 9/23/2016 3:51 PM, Bugs in PAR-Packer via RT wrote:
&gt; I understand a little better how the packed executable is supposed to
&gt; work.  First the embedded files are extracted, which are a perl
&gt; interpreter &#40;named biber&#41; and cygperl5_24.dll in; it&#39;s then supposed
&gt; to
&gt; be possible to run the extracted biber, which will extract the rest of
&gt; the files.  Roderich, is this right?
</div>
Your analysis is correct.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So it seems that the solution should be to add cygcrypt-0.dll as an
&gt; embedded file.  
</div>
Yes. Try changing line 43 of myldr/embed_files.pl in the PAR::Packer source to

            *is_system_lib = sub { shift =~ m{^/usr/bin/&#40;?!cygcrypt\b&#41;|^\Q$system_root\E/}i };

i.e. /usr/bin/cygcrypt-0.dll is _not_ regarded as a &#34;system library&#34; anymore.
Then re-build and install PAR:Packer and re-pack biber.

Cheers, Roderich
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;25&nbsp;03:06:48&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;25&nbsp;11:24:43&nbsp;2016</span>
    <span class="description">kbrown [...] cornell.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #118053] Problem with packed perl archive for biber on 64-bit Cygwin</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 25 Sep 2016 11:24:27 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PAR-Packer [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ken Brown &lt;kbrown [...] cornell.edu&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">

On 9/25/2016 3:06 AM, Roderich Schupp via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=118053">https://rt.cpan.org/Ticket/Display.html?id=118053</a></span> &gt;
&gt;
&gt; On 2016-09-24 21:06:22, kbrown@cornell.edu wrote:
<div class="message-stanza open">&gt;&gt; On 9/23/2016 3:51 PM, Bugs in PAR-Packer via RT wrote:
&gt;&gt; I understand a little better how the packed executable is supposed to
&gt;&gt; work.  First the embedded files are extracted, which are a perl
&gt;&gt; interpreter &#40;named biber&#41; and cygperl5_24.dll in; it&#39;s then supposed
&gt;&gt; to
&gt;&gt; be possible to run the extracted biber, which will extract the rest of
&gt;&gt; the files.  Roderich, is this right?
</div>&gt;
&gt; Your analysis is correct.
&gt;
<div class="message-stanza open">&gt;&gt; So it seems that the solution should be to add cygcrypt-0.dll as an
&gt;&gt; embedded file.
</div>&gt;
&gt; Yes. Try changing line 43 of myldr/embed_files.pl in the PAR::Packer source to
&gt;
&gt;             *is_system_lib = sub { shift =~ m{^/usr/bin/&#40;?!cygcrypt\b&#41;|^\Q$system_root\E/}i };
&gt;
&gt; i.e. /usr/bin/cygcrypt-0.dll is _not_ regarded as a &#34;system library&#34; anymore.
&gt; Then re-build and install PAR:Packer and re-pack biber.
&gt;
&gt; Cheers, Roderich
</div>
Thanks, that fixes it.

Ken
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;25&nbsp;13:37:42&nbsp;2016</span>
    <span class="description">kbrown [...] cornell.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> Philip Kime &lt;philkime [...] kime.org.uk&gt;, David Carlisle &lt;d.p.carlisle [...] gmail.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #118053] Problem with packed perl archive for biber on 64-bit Cygwin</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 25 Sep 2016 13:37:28 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PAR-Packer [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ken Brown &lt;kbrown [...] cornell.edu&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 9/25/2016 11:24 AM, Ken Brown wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 9/25/2016 3:06 AM, Roderich Schupp via RT wrote:
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=118053">https://rt.cpan.org/Ticket/Display.html?id=118053</a></span> &gt;
&gt;&gt;
&gt;&gt; On 2016-09-24 21:06:22, kbrown@cornell.edu wrote:
<div class="message-stanza open">&gt;&gt;&gt; On 9/23/2016 3:51 PM, Bugs in PAR-Packer via RT wrote:
&gt;&gt;&gt; I understand a little better how the packed executable is supposed to
&gt;&gt;&gt; work.  First the embedded files are extracted, which are a perl
&gt;&gt;&gt; interpreter &#40;named biber&#41; and cygperl5_24.dll in; it&#39;s then supposed
&gt;&gt;&gt; to
&gt;&gt;&gt; be possible to run the extracted biber, which will extract the rest of
&gt;&gt;&gt; the files.  Roderich, is this right?
</div>&gt;&gt;
&gt;&gt; Your analysis is correct.
&gt;&gt;
<div class="message-stanza open">&gt;&gt;&gt; So it seems that the solution should be to add cygcrypt-0.dll as an
&gt;&gt;&gt; embedded file.
</div>&gt;&gt;
&gt;&gt; Yes. Try changing line 43 of myldr/embed_files.pl in the PAR::Packer
&gt;&gt; source to
&gt;&gt;
&gt;&gt;             *is_system_lib = sub { shift =~
&gt;&gt; m{^/usr/bin/&#40;?!cygcrypt\b&#41;|^\Q$system_root\E/}i };
&gt;&gt;
&gt;&gt; i.e. /usr/bin/cygcrypt-0.dll is _not_ regarded as a &#34;system library&#34;
&gt;&gt; anymore.
&gt;&gt; Then re-build and install PAR:Packer and re-pack biber.
&gt;&gt;
&gt;&gt; Cheers, Roderich
</div>&gt;
&gt; Thanks, that fixes it.
</div>
Actually, there&#39;s still one glitch.  If I run biber with no arguments, 
it unpacks itself and gives me a usage message.  It also works fine if I 
run &#39;biber --help&#39;.  But if I give it a file as an argument &#40;e.g., 
&#39;biber test.bcf&#39;&#41; before the cache is created, it unpacks itself and 
then hangs.  After I kill it, I can rerun it with no problem.

David Carlisle, who is also testing, finds that it still hangs even 
after the cache is created, but that may be a separate issue.

Do you have any idea what might cause this?  For me it&#39;s just a glitch. 
For David, it means that biber is unusable.

Thanks.

Ken
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;26&nbsp;06:16:57&nbsp;2016</span>
    <span class="description">RSCHUPP [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Am 2016-09-25 13:37:42, kbrown@cornell.edu schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Actually, there&#39;s still one glitch.  If I run biber with no arguments, 
&gt; it unpacks itself and gives me a usage message.  It also works fine if I 
&gt; run &#39;biber --help&#39;.  But if I give it a file as an argument &#40;e.g., 
&gt; &#39;biber test.bcf&#39;&#41; before the cache is created, it unpacks itself and 
&gt; then hangs.  After I kill it, I can rerun it with no problem.
</div>
Sorry, no clue. If &#34;biber --help&#34; works, then basically PAR::Packer&#39;s job
is done &#40;though there might still be missing files etc, but typically that
doesn&#39;t result in a hang&#41;. Does this hang occur also on the machine
where you packed biber?

Cheers, Roderich
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;26&nbsp;09:51:06&nbsp;2016</span>
    <span class="description">kbrown [...] cornell.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #118053] Problem with packed perl archive for biber on 64-bit Cygwin</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 26 Sep 2016 09:50:49 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PAR-Packer [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ken Brown &lt;kbrown [...] cornell.edu&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 9/26/2016 6:17 AM, Roderich Schupp via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=118053">https://rt.cpan.org/Ticket/Display.html?id=118053</a></span> &gt;
&gt;
&gt; Am 2016-09-25 13:37:42, kbrown@cornell.edu schrieb:
<div class="message-stanza open">&gt;&gt; Actually, there&#39;s still one glitch.  If I run biber with no arguments,
&gt;&gt; it unpacks itself and gives me a usage message.  It also works fine if I
&gt;&gt; run &#39;biber --help&#39;.  But if I give it a file as an argument &#40;e.g.,
&gt;&gt; &#39;biber test.bcf&#39;&#41; before the cache is created, it unpacks itself and
&gt;&gt; then hangs.  After I kill it, I can rerun it with no problem.
</div>&gt;
&gt; Sorry, no clue. If &#34;biber --help&#34; works, then basically PAR::Packer&#39;s job
&gt; is done &#40;though there might still be missing files etc, but typically that
&gt; doesn&#39;t result in a hang&#41;. Does this hang occur also on the machine
&gt; where you packed biber?
</div>
It did originally, but I just repacked biber &#40;which a slight change&#41;, 
and now I can&#39;t reproduce the problem anymore.  The change was to remove 
these two arguments from the invocation of pp:

   --link=/usr/bin/cygssp-0.dll
   --link=/usr/bin/cygcrypt-0.dll

The first is not needed because cygssp-0.dll is contained in a minimal 
Cygwin install, and the second is not needed now that cygcrypt-0.dll is 
embedded.

I&#39;m not sure whether &#40;or why&#41; these changes made a difference, but in 
any case the problem seems to be gone.

Thanks for your help.

Ken
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;26&nbsp;13:16:13&nbsp;2016</span>
    <span class="description">roderich.schupp [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #118053] Problem with packed perl archive for biber on 64-bit Cygwin</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 26 Sep 2016 19:15:57 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PAR-Packer [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Roderich Schupp &lt;roderich.schupp [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, Sep 26, 2016 at 3:51 PM, Ken Brown via RT &lt;
bug-PAR-Packer@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The change was to remove
&gt; these two arguments from the invocation of pp:
&gt;
&gt;    --link=/usr/bin/cygssp-0.dll
&gt;    --link=/usr/bin/cygcrypt-0.dll
&gt;
</div>
I was going to suggest that as well: these result in a second copy of the
DLL to be unpacked - while the first copy is probably already in use.
Which Windows doesn&#39;t allow i&#40;the Linux equivalent error would be EBUSY&#41;.
But then I convinced myself that the two copies would go to different
directories &#40;the first to the root of the cache area, the second to
cache/shlibs or similar&#41;...

Cheers, Roderich
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;26&nbsp;13:23:05&nbsp;2016</span>
    <span class="description">kbrown [...] cornell.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #118053] Problem with packed perl archive for biber on 64-bit Cygwin</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 26 Sep 2016 13:23:00 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PAR-Packer [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ken Brown &lt;kbrown [...] cornell.edu&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 9/26/2016 1:16 PM, Roderich Schupp via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=118053">https://rt.cpan.org/Ticket/Display.html?id=118053</a></span> &gt;
&gt;
&gt; On Mon, Sep 26, 2016 at 3:51 PM, Ken Brown via RT &lt;
&gt; bug-PAR-Packer@rt.cpan.org&gt; wrote:
&gt;
<div class="message-stanza open">&gt;&gt; The change was to remove
&gt;&gt; these two arguments from the invocation of pp:
&gt;&gt;
&gt;&gt;    --link=/usr/bin/cygssp-0.dll
&gt;&gt;    --link=/usr/bin/cygcrypt-0.dll
&gt;&gt;
</div>&gt;
&gt; I was going to suggest that as well: these result in a second copy of the
&gt; DLL to be unpacked - while the first copy is probably already in use.
&gt; Which Windows doesn&#39;t allow i&#40;the Linux equivalent error would be EBUSY&#41;.
&gt; But then I convinced myself that the two copies would go to different
&gt; directories &#40;the first to the root of the cache area, the second to
&gt; cache/shlibs or similar&#41;...
</div>
No, they were actually both going to the root of the cache directory. 
So you&#39;re explanation makes perfect sense.

Thanks.

Ken
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;26&nbsp;13:34:36&nbsp;2016</span>
    <span class="description">roderich.schupp [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #118053] Problem with packed perl archive for biber on 64-bit Cygwin</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 26 Sep 2016 19:34:22 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PAR-Packer [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Roderich Schupp &lt;roderich.schupp [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, Sep 26, 2016 at 7:23 PM, Ken Brown via RT &lt;
bug-PAR-Packer@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; No, they were actually both going to the root of the cache directory.
&gt; So you&#39;re explanation makes perfect sense.
&gt;
</div>
You&#39;re absolutely right. --link stuff goes into folder &#34;shlib&#34; in the
packed executable viewed as a zip,
but gets extracted into the root of the cache directory.

Cheers, Roderich
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;27&nbsp;11:23:32&nbsp;2016</span>
    <span class="description">kbrown [...] cornell.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #118053] Problem with packed perl archive for biber on 64-bit Cygwin</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 27 Sep 2016 11:23:25 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PAR-Packer [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ken Brown &lt;kbrown [...] cornell.edu&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">It looks like David Carlisle&#39;s issue is completely unrelated, so I think 
you can apply your change and close this ticket.

Thanks again for your help.

Ken
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;29&nbsp;15:37:24&nbsp;2016</span>
    <span class="description">RSCHUPP [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;29&nbsp;15:37:25&nbsp;2016</span>
    <span class="description">RSCHUPP [...] cpan.org -  Broken in 1.035 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
