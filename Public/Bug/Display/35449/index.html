<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #35449 for DBD-SQLite: Fast DBH-&gt;do</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #35449 for DBD-SQLite: Fast DBH-&gt;do</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBD-SQLite">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBD-SQLite">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBD-SQLite">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBD-SQLite">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-SQLite">DBD-SQLite CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">35449</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBD-SQLite">DBD-SQLite</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ptushnik [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-10248-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10249-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




DBD-SQLite-1.14.fast_do<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/454689/223523/DBD-SQLite-1.14.fast_do">
Sat Apr 26 06:38:15 2008 (2k) by ptushnik [...] gmail.com
</a>
</font></li>
</ul>


DBD-SQLite-1.19_10.fast_do<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/587317/297177/DBD-SQLite-1.19_10.fast_do">
Sun Apr 05 18:52:38 2009 (2.6k) by ptushnik [...] gmail.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=35449">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-454689" href="/Public/Bug/Display.html?id=35449#txn-454689">#</a>      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;26&nbsp;06:38:15&nbsp;2008</span>
    <span class="description">ptushnik [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Fast DBH-&gt;do</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/454689/223520/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/223520">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 161b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This allow to use sqlite3_exec&#40;&#41; directly from DBH-&gt;do. In result many commands executes 
faster, especially if you have big set of SQL command like &#34;dump&#34; file.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> DBD-SQLite-1.14.fast_do</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/454689/223523/DBD-SQLite-1.14.fast_do">Download DBD-SQLite-1.14.fast_do</a><br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -pruN DBD-SQLite-1.14.orig/SQLite.xs DBD-SQLite-1.14/SQLite.xs
--- DBD-SQLite-1.14.orig/SQLite.xs	2007-08-23 02:01:07.000000000 +0200
+++ DBD-SQLite-1.14/SQLite.xs	2008-02-09 09:36:53.000000000 +0100
@@ -63,6 +63,21 @@ busy_timeout&#40;dbh, timeout=0&#41;
   OUTPUT:
     RETVAL
 
+void
+_do&#40;dbh, statement&#41;
+    SV *	dbh
+    char *	statement
+    CODE:
+    {
+        D_imp_dbh&#40;dbh&#41;;
+        IV retval;
+        retval = sqlite_db_do&#40;dbh, imp_dbh, statement&#41;;
+        if &#40;retval == 0&#41;
+            XST_mPV&#40;0, &#34;0E0&#34;&#41;;	/* &#40;true but zero&#41;		*/
+        else
+            XST_mUNDEF&#40;0&#41;;		/* &lt;= -2 means error   		*/
+    }
+
 MODULE = DBD::SQLite          PACKAGE = DBD::SQLite::st
 
 PROTOTYPES: DISABLE
diff -pruN DBD-SQLite-1.14.orig/dbdimp.c DBD-SQLite-1.14/dbdimp.c
--- DBD-SQLite-1.14.orig/dbdimp.c	2007-08-24 04:51:25.000000000 +0200
+++ DBD-SQLite-1.14/dbdimp.c	2008-02-09 13:26:06.000000000 +0100
@@ -224,6 +224,25 @@ sqlite_db_commit&#40;SV *dbh, imp_dbh_t *imp
 }
 
 int
+sqlite_db_do&#40;SV *dbh, imp_dbh_t *imp_dbh, char *statement&#41;
+{
+    dTHR;
+    int retval;
+    char *errmsg;
+
+    sqlite_trace&#40;2, &#34;DO&#34;&#41;;
+    if &#40;&#40;retval = sqlite3_exec&#40;imp_dbh-&gt;db, statement,
+        NULL, NULL, &#38;errmsg&#41;&#41;
+        != SQLITE_OK&#41;
+    {
+        sqlite_error&#40;dbh, &#40;imp_xxh_t*&#41;imp_dbh, retval, errmsg&#41;;
+        return -2;
+    }
+    
+    return 0;
+}
+
+int
 sqlite_discon_all&#40;SV *drh, imp_drh_t *imp_drh&#41;
 {
     dTHR;
diff -pruN DBD-SQLite-1.14.orig/lib/DBD/SQLite.pm DBD-SQLite-1.14/lib/DBD/SQLite.pm
--- DBD-SQLite-1.14.orig/lib/DBD/SQLite.pm	2007-08-23 02:11:41.000000000 +0200
+++ DBD-SQLite-1.14/lib/DBD/SQLite.pm	2008-02-09 09:37:12.000000000 +0100
@@ -62,6 +62,15 @@ sub connect {
 
 package DBD::SQLite::db;
 
+sub do {
+    my&#40;$dbh, $statement, $attr, @params&#41; = @_;
+    return DBD::SQLite::db::_do&#40;$dbh, $statement&#41; unless defined $attr &#38;&#38; $#params &gt; -1;
+    my $sth = $dbh-&gt;prepare&#40;$statement, $attr&#41; or return undef;
+    $sth-&gt;execute&#40;@params&#41; or return undef;
+    my $rows = $sth-&gt;rows;
+    &#40;$rows == 0&#41; ? &#34;0E0&#34; : $rows;
+}
+
 sub prepare {
     my &#40;$dbh, $statement, @attribs&#41; = @_;
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-587183" href="/Public/Bug/Display.html?id=35449#txn-587183">#</a>      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;05&nbsp;13:31:13&nbsp;2009</span>
    <span class="description">adamk [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/587183/297079/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/297079">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 130b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">We agree in principle, but this patch isn&#39;t good enough.

Tests fail.

Marking as stalled pending a better implementation of this.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-587184" href="/Public/Bug/Display.html?id=35449#txn-587184">#</a>      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;05&nbsp;13:31:14&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-587187" href="/Public/Bug/Display.html?id=35449#txn-587187">#</a>      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;05&nbsp;13:31:15&nbsp;2009</span>
    <span class="description">adamk [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-587317" href="/Public/Bug/Display.html?id=35449#txn-587317">#</a>      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;05&nbsp;18:52:36&nbsp;2009</span>
    <span class="description">ptushnik [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/587317/297174/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/297174">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here is new patch that pass all tests.
But discovered new problem: busy_timeout&#40;&#41; doesn&#39;t work now.
Looks like this is sqlite3 problem. I have asked about this at SQLite3-Maillist, waiting for 
answer...

Here is example of this bug:
-------%&lt;--------------------------------------------------
#include &lt;stdio.h&gt;
#include &lt;sqlite3.h&gt;


int check_error &#40;int rc, char *zErrMsg&#41;
{
 if&#40; rc!=SQLITE_OK &#41;{
   fprintf&#40;stderr, &#34;SQL error: %s\n&#34;, zErrMsg&#41;;
   sqlite3_free&#40;zErrMsg&#41;;
 }
}

int main&#40;int argc, char **argv&#41;{
 sqlite3 *db, *db2;
 char *zErrMsg = 0;
 int rc;

 rc = sqlite3_open&#40;&#34;test.db&#34;, &#38;db&#41;;
 rc = sqlite3_open&#40;&#34;test.db&#34;, &#38;db2&#41;;

 printf&#40;&#34;db1 start trans\n&#34;&#41;;
 rc = sqlite3_exec&#40;db, &#34;BEGIN TRANSACTION&#34; , NULL, NULL, &#38;zErrMsg&#41;;
 check_error&#40;rc, zErrMsg&#41;;

 printf&#40;&#34;db1 insert\n&#34;&#41;;
 rc = sqlite3_exec&#40;db, &#34;INSERT INTO Blah VALUES &#40; 1, &#39;Test1&#39; &#41;&#34; ,
NULL, NULL, &#38;zErrMsg&#41;;
 check_error&#40;rc, zErrMsg&#41;;


 sqlite3_busy_timeout&#40;db2, 30000&#41;;

 printf&#40;&#34;db2 start trans\n&#34;&#41;;
 rc = sqlite3_exec&#40;db2, &#34;BEGIN TRANSACTION&#34; , NULL, NULL, &#38;zErrMsg&#41;;
 check_error&#40;rc, zErrMsg&#41;;

 /* SQLITE should wait for 3 second before returning error, but it doesn&#39;t  */
 printf&#40;&#34;db2 insert\n&#34;&#41;;
 rc = sqlite3_exec&#40;db2, &#34;INSERT INTO Blah VALUES &#40; 1, &#39;Test1&#39; &#41;&#34; ,
NULL, NULL, &#38;zErrMsg&#41;;
 check_error&#40;rc, zErrMsg&#41;;

 sqlite3_close&#40;db&#41;;
 return 0;
}

-------%&lt;--------------------------------------------------
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/587317/297177/DBD-SQLite-1.19_10.fast_do">Download DBD-SQLite-1.19_10.fast_do</a><br />
<span class="downloadcontenttype">application/octet-stream 2.6k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-587318" href="/Public/Bug/Display.html?id=35449#txn-587318">#</a>      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;05&nbsp;18:52:39&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-587320" href="/Public/Bug/Display.html?id=35449#txn-587320">#</a>      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;05&nbsp;18:52:42&nbsp;2009</span>
    <span class="description">ptushnik [...] gmail.com -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-587795" href="/Public/Bug/Display.html?id=35449#txn-587795">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;06&nbsp;16:39:57&nbsp;2009</span>
    <span class="description">ptushnik [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> ptushnik [...] gmail.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/587795/297462/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/297462">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is know situation described at <span class="clickylink"><a target="new" rel="nofollow" href="http://www.sqlite.org/c3ref/busy_handler.html">http://www.sqlite.org/c3ref/busy_handler.html</a></span>

The presence of a busy handler does not guarantee that it will be invoked when there is lock 
contention. If SQLite determines that invoking the busy handler could result in a deadlock, it 
will go ahead and return SQLITE_BUSY or SQLITE_IOERR_BLOCKED instead of invoking the 
busy handler. Consider a scenario where one process is holding a read lock that it is trying to 
promote to a reserved lock and a second process is holding a reserved lock that it is trying to 
promote to an exclusive lock. The first process cannot proceed because it is blocked by the 
second and the second process cannot proceed because it is blocked by the first. If both 
processes invoke the busy handlers, neither will make any progress. Therefore, SQLite 
returns SQLITE_BUSY for the first process, hoping that this will induce the first process to 
release its read lock and allow the second process to proceed.

This is all means that now my patch work correctly.

PS. My question at SQLite mail-list can be found here <span class="clickylink"><a target="new" rel="nofollow" href="http://thread.gmane.org/gmane.comp.db.sqlite.general/45858">http://thread.gmane.org/gmane.comp.db.sqlite.general/45858</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-587796" href="/Public/Bug/Display.html?id=35449#txn-587796">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;06&nbsp;16:39:57&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1464547" href="/Public/Bug/Display.html?id=35449#txn-1464547">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;17&nbsp;01:28:45&nbsp;2015</span>
    <span class="description">ishigaki [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1464547/779505/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/779505">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Implemented faster do in the master &#40;sorry for the long delay&#41;.

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/DBD-SQLite/DBD-SQLite/commit/7a234eb71b955064ce498e95d6ecc50d1f0580a7">https://github.com/DBD-SQLite/DBD-SQLite/commit/7a234eb71b955064ce498e95d6ecc50d1f0580a7</a></span>

On Mon Apr 06 07:52:36 2009, xrb wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Here is new patch that pass all tests.
&gt; But discovered new problem: busy_timeout&#40;&#41; doesn&#39;t work now.
&gt;  Looks like this is sqlite3 problem. I have asked about this at
&gt; SQLite3-Maillist, waiting for
&gt; answer...
&gt; 
&gt; Here is example of this bug:
&gt; -------%&lt;--------------------------------------------------
&gt; #include &lt;stdio.h&gt;
&gt; #include &lt;sqlite3.h&gt;
&gt; 
&gt; 
&gt; int check_error &#40;int rc, char *zErrMsg&#41;
&gt; {
&gt;  if&#40; rc!=SQLITE_OK &#41;{
&gt;    fprintf&#40;stderr, &#34;SQL error: %s\n&#34;, zErrMsg&#41;;
&gt;    sqlite3_free&#40;zErrMsg&#41;;
&gt;  }
&gt; }
&gt; 
&gt; int main&#40;int argc, char **argv&#41;{
&gt;  sqlite3 *db, *db2;
&gt;  char *zErrMsg = 0;
&gt;  int rc;
&gt; 
&gt; rc = sqlite3_open&#40;&#34;test.db&#34;, &#38;db&#41;;
&gt; rc = sqlite3_open&#40;&#34;test.db&#34;, &#38;db2&#41;;
&gt; 
&gt; printf&#40;&#34;db1 start trans\n&#34;&#41;;
&gt; rc = sqlite3_exec&#40;db, &#34;BEGIN TRANSACTION&#34; , NULL, NULL, &#38;zErrMsg&#41;;
&gt; check_error&#40;rc, zErrMsg&#41;;
&gt; 
&gt; printf&#40;&#34;db1 insert\n&#34;&#41;;
&gt; rc = sqlite3_exec&#40;db, &#34;INSERT INTO Blah VALUES &#40; 1, &#39;Test1&#39; &#41;&#34; ,
&gt; NULL, NULL, &#38;zErrMsg&#41;;
&gt; check_error&#40;rc, zErrMsg&#41;;
&gt; 
&gt; 
&gt; sqlite3_busy_timeout&#40;db2, 30000&#41;;
&gt; 
&gt; printf&#40;&#34;db2 start trans\n&#34;&#41;;
&gt; rc = sqlite3_exec&#40;db2, &#34;BEGIN TRANSACTION&#34; , NULL, NULL, &#38;zErrMsg&#41;;
&gt; check_error&#40;rc, zErrMsg&#41;;
&gt; 
&gt; /* SQLITE should wait for 3 second before returning error, but it
&gt; doesn&#39;t  */
&gt; printf&#40;&#34;db2 insert\n&#34;&#41;;
&gt; rc = sqlite3_exec&#40;db2, &#34;INSERT INTO Blah VALUES &#40; 1, &#39;Test1&#39; &#41;&#34; ,
&gt; NULL, NULL, &#38;zErrMsg&#41;;
&gt; check_error&#40;rc, zErrMsg&#41;;
&gt; 
&gt; sqlite3_close&#40;db&#41;;
&gt; return 0;
&gt; }
&gt; 
&gt; -------%&lt;--------------------------------------------------
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1464550" href="/Public/Bug/Display.html?id=35449#txn-1464550">#</a>      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;17&nbsp;01:28:51&nbsp;2015</span>
    <span class="description">ishigaki [...] cpan.org -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1522933" href="/Public/Bug/Display.html?id=35449#txn-1522933">#</a>      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;04&nbsp;07:24:41&nbsp;2015</span>
    <span class="description">ishigaki [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1522933/812288/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/812288">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Feb 17 15:28:45 2015, ISHIGAKI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Implemented faster do in the master &#40;sorry for the long delay&#41;.
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/DBD-SQLite/DBD-">https://github.com/DBD-SQLite/DBD-</a></span>
&gt; SQLite/commit/7a234eb71b955064ce498e95d6ecc50d1f0580a7
&gt; 
&gt; On Mon Apr 06 07:52:36 2009, xrb wrote:
<div class="message-stanza open">&gt; &gt; Here is new patch that pass all tests.
&gt; &gt; But discovered new problem: busy_timeout&#40;&#41; doesn&#39;t work now.
&gt; &gt;  Looks like this is sqlite3 problem. I have asked about this at
&gt; &gt; SQLite3-Maillist, waiting for
&gt; &gt; answer...
&gt; &gt;
&gt; &gt; Here is example of this bug:
&gt; &gt; -------%&lt;--------------------------------------------------
&gt; &gt; #include &lt;stdio.h&gt;
&gt; &gt; #include &lt;sqlite3.h&gt;
&gt; &gt;
&gt; &gt;
&gt; &gt; int check_error &#40;int rc, char *zErrMsg&#41;
&gt; &gt; {
&gt; &gt;  if&#40; rc!=SQLITE_OK &#41;{
&gt; &gt;    fprintf&#40;stderr, &#34;SQL error: %s\n&#34;, zErrMsg&#41;;
&gt; &gt;    sqlite3_free&#40;zErrMsg&#41;;
&gt; &gt;  }
&gt; &gt; }
&gt; &gt;
&gt; &gt; int main&#40;int argc, char **argv&#41;{
&gt; &gt;  sqlite3 *db, *db2;
&gt; &gt;  char *zErrMsg = 0;
&gt; &gt;  int rc;
&gt; &gt;
&gt; &gt; rc = sqlite3_open&#40;&#34;test.db&#34;, &#38;db&#41;;
&gt; &gt; rc = sqlite3_open&#40;&#34;test.db&#34;, &#38;db2&#41;;
&gt; &gt;
&gt; &gt; printf&#40;&#34;db1 start trans\n&#34;&#41;;
&gt; &gt; rc = sqlite3_exec&#40;db, &#34;BEGIN TRANSACTION&#34; , NULL, NULL, &#38;zErrMsg&#41;;
&gt; &gt; check_error&#40;rc, zErrMsg&#41;;
&gt; &gt;
&gt; &gt; printf&#40;&#34;db1 insert\n&#34;&#41;;
&gt; &gt; rc = sqlite3_exec&#40;db, &#34;INSERT INTO Blah VALUES &#40; 1, &#39;Test1&#39; &#41;&#34; ,
&gt; &gt; NULL, NULL, &#38;zErrMsg&#41;;
&gt; &gt; check_error&#40;rc, zErrMsg&#41;;
&gt; &gt;
&gt; &gt;
&gt; &gt; sqlite3_busy_timeout&#40;db2, 30000&#41;;
&gt; &gt;
&gt; &gt; printf&#40;&#34;db2 start trans\n&#34;&#41;;
&gt; &gt; rc = sqlite3_exec&#40;db2, &#34;BEGIN TRANSACTION&#34; , NULL, NULL, &#38;zErrMsg&#41;;
&gt; &gt; check_error&#40;rc, zErrMsg&#41;;
&gt; &gt;
&gt; &gt; /* SQLITE should wait for 3 second before returning error, but it
&gt; &gt; doesn&#39;t  */
&gt; &gt; printf&#40;&#34;db2 insert\n&#34;&#41;;
&gt; &gt; rc = sqlite3_exec&#40;db2, &#34;INSERT INTO Blah VALUES &#40; 1, &#39;Test1&#39; &#41;&#34; ,
&gt; &gt; NULL, NULL, &#38;zErrMsg&#41;;
&gt; &gt; check_error&#40;rc, zErrMsg&#41;;
&gt; &gt;
&gt; &gt; sqlite3_close&#40;db&#41;;
&gt; &gt; return 0;
&gt; &gt; }
&gt; &gt;
&gt; &gt; -------%&lt;--------------------------------------------------
</div></div>

Closed as 1.48 was out. Thanks.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1522936" href="/Public/Bug/Display.html?id=35449#txn-1522936">#</a>      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;04&nbsp;07:24:42&nbsp;2015</span>
    <span class="description">ishigaki [...] cpan.org -  Status changed from &#39;patched&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.628885</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
