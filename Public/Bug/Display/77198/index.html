<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #77198 for Math-BaseCalc: from_base truncation of large integers</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #77198 for Math-BaseCalc: from_base truncation of large integers</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Math-BaseCalc/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Math-BaseCalc/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Math-BaseCalc/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Math-BaseCalc/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Math-BaseCalc">Math-BaseCalc CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">77198</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Math-BaseCalc/Active/">Math-BaseCalc</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
BBYRD [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-20480-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.016    </td>
  </tr>
  <tr id="CF-20481-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Math-BaseCalc-v1.2.patch.gz<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1078922/567765/Math-BaseCalc-v1.2.patch.gz">
Thu May 17 14:06:54 2012 (8.3k) by BBYRD [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;14&nbsp;14:31:57&nbsp;2012</span>
    <span class="description">BBYRD [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> from_base truncation of large integers</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">use v5.10;
use bigint;
use Math::BaseCalc;

my $bignum =
85863250553302448437153211102345904505502971929758795587130289554944;
my $base89 = [0..9, &#39;A&#39;..&#39;Z&#39;, &#39;a&#39;..&#39;z&#39;, split&#40;//,
&#39;#$%&#38;&#40;&#41;*+,-/:;&lt;=&gt;?@[]^_`{|}~&#39;&#41;];  # no !, ., &#39;, &#34;, or \
my $calc89 = Math::BaseCalc-&gt;new&#40;digits =&gt; $base89&#41;;

my $hash   = $calc89-&gt;to_base&#40;$bignum&#41;;
my $newnum = $calc89-&gt;from_base&#40;$hash&#41;;

say &#34;BaseCalc via Base89&#34;;
say &#34;===================&#34;;
say $bignum;
say $hash;
say $newnum;
say $newnum + 0;
say;

my $calc64 = Math::BaseCalc-&gt;new&#40;digits =&gt; &#39;64&#39;&#41;;

$hash   = $calc64-&gt;to_base&#40;$bignum&#41;;
$newnum = $calc64-&gt;from_base&#40;$hash&#41;;

say &#34;BaseCalc via Base64&#34;;
say &#34;===================&#34;;
say $bignum;
say $hash;
say $newnum;
say $newnum + 0;

# BaseCalc via Base89
# ===================
# 85863250553302448437153211102345904505502971929758795587130289554944
# jCT3jUmD]hEtieNUC:y+`0gn$XmrbzR4U9x
# 8.58632505533025e+67
# 85863250553302500000000000000000000000000000000000000000000000000000
# 
# BaseCalc via Base64
# ===================
# 85863250553302448437153211102345904505502971929758795587130289554944
# MvUgAAACIAAQAAADz/8/////////////8AgAYA
# 8.58632505533024e+67
# 85863250553302400000000000000000000000000000000000000000000000000000
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;14&nbsp;15:15:33&nbsp;2012</span>
    <span class="description">kwilliams [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">One way to deal with this would be to turn on &#39;bigint&#39;, if it&#39;s available, 
inside from_base&#40;&#41;.  I don&#39;t have a sense of the performance penalty that 
would impose though.  And it would mean the return value is different than 
people&#39;s code might be expecting - right now it&#39;s documented to return a 
vanilla numeric scalar.

Do you have a suggested fix that&#39;s different?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;14&nbsp;15:15:35&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;16&nbsp;01:53:35&nbsp;2012</span>
    <span class="description">BBYRD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon May 14 15:15:33 2012, KWILLIAMS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Do you have a suggested fix that&#39;s different?
</div>
Lemme see.  I&#39;ve had some familiarity with this for the
SQL_FUNCTIONS_CONV thing I wrote for SQL::Statement &#40;RT #72638&#41;.  I&#39;m
going to go back to that code to see which pitfalls I ran into...

I solved the performance issues by predicting the number of digits ahead
of time and using &#40;or not using&#41; Math::BigInt/Float only when I needed
to, as well as putting in a bunch of oct/sprintf short-circuits.

......

Okay, I have something which fixes several issues &#40;basically all of the
stuff I found from building CONV&#41;, but it&#39;s late, so I&#39;ll post the patch
tomorrow.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;17&nbsp;14:06:53&nbsp;2012</span>
    <span class="description">BBYRD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">First of all, my apologies for the massive refactoring, but the whole
module should be better for it.  The list of changes are detailed in the
Changes file.

The new code will use Math::Big* right off the bat, as I realized that
not using it isn&#39;t going to gain much speed.  &#40;Perl has an accuracy
limit of around 14 digits, so using standard scalars for only 14
iterations of a loop is barely a blip on the radar.&#41;

Please let me know if you have any questions around the code.  I will be
using this module as a dependency for a pragma module of mine, so I&#39;d
like to get this out the door as soon as you&#39;re ready.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Math-BaseCalc-v1.2.patch.gz</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1078922/567765/Math-BaseCalc-v1.2.patch.gz">Download Math-BaseCalc-v1.2.patch.gz</a><br />
<span class="downloadcontenttype">application/x-gzip 8.3k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;01&nbsp;18:31:42&nbsp;2012</span>
    <span class="description">BBYRD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry to bug you, but did you get a chance to look at this one?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;16&nbsp;00:03:07&nbsp;2012</span>
    <span class="description">kwilliams [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Brendon, very sorry to take so long to look at this.

I applied your patch but I&#39;m getting a lot of test errors.  Almost all of them look like this:

#   Failed test &#39;from&#40; to &#40; 2.5 &#41; == .0,. --&gt; 2.5 &#40;using 0,.&#41;&#39;
#   at t/02_digit_dash_dot.t line 28.
#          got: &#39;25e-1&#39;
#     expected: &#39;2.5&#39;

It&#39;s over-eager to use scientific notation.

I&#39;ve also imported the code to Github, your patch is on the &#39;bbyrd&#39; branch.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;19&nbsp;12:57:46&nbsp;2012</span>
    <span class="description">BBYRD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Jun 16 00:03:07 2012, KWILLIAMS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Brendon, very sorry to take so long to look at this.
</div>
No problem.  Sorry for being impatient.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I applied your patch but I&#39;m getting a lot of test errors.  Almost all
&gt; of them look like this:
&gt; 
&gt; #   Failed test &#39;from&#40; to &#40; 2.5 &#41; == .0,. --&gt; 2.5 &#40;using 0,.&#41;&#39;
&gt; #   at t/02_digit_dash_dot.t line 28.
&gt; #          got: &#39;25e-1&#39;
&gt; #     expected: &#39;2.5&#39;
&gt; 
&gt; It&#39;s over-eager to use scientific notation.
&gt; 
&gt; I&#39;ve also imported the code to Github, your patch is on the &#39;bbyrd&#39;
&gt; branch.
</div>
Have you tested with that branch?  I&#39;m getting a clean result, on both
my Win32 laptop and Linux VM.  Note that I did need to do some test
changes as well, so the patch isn&#39;t just BaseCalc.pm.  &#40;Though, the
bbyrd branch does reflect that.&#41;

I&#39;m submitting a pull request, but it&#39;s only to fix some minor issues. 
The other branch should still pass tests.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
