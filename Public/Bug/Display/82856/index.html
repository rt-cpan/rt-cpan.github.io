<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #82856 for libintl-perl: Tests of Locale::TextDomain fail almost everywhere</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #82856 for libintl-perl: Tests of Locale::TextDomain fail almost everywhere</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/libintl-perl/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/libintl-perl/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/libintl-perl/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/libintl-perl/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/libintl-perl">libintl-perl CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">82856</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/libintl-perl/Active/">libintl-perl</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
MITHALDU [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-18278-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-18279-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;21&nbsp;06:55:12&nbsp;2013</span>
    <span class="description">MITHALDU [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Tests of Locale::TextDomain fail almost everywhere</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Heya, i don&#39;t know if you noticed, but tests of Locale::TextDomain are 
failing on almost every perl/system combination.

Another thing i noticed while trying to figure out what happened. The 
changelog was previously an actual changelog file:

<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/GUIDO/libintl-perl-1.20/ChangeLog">https://metacpan.org/source/GUIDO/libintl-perl-1.20/ChangeLog</a></span>

Now it&#39;s just a less than helpful dump from git log:

<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/GUIDO/libintl-perl-1.21/ChangeLog">https://metacpan.org/source/GUIDO/libintl-perl-1.21/ChangeLog</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;21&nbsp;06:56:37&nbsp;2013</span>
    <span class="description">MITHALDU [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Additionally it seems that your git repo is not up-to-date with the 
current release.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;21&nbsp;06:56:37&nbsp;2013</span>
    <span class="description">MITHALDU [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;21&nbsp;11:03:51&nbsp;2013</span>
    <span class="description">GUIDO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

On Mon Jan 21 06:55:12 2013, MITHALDU wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Heya, i don&#39;t know if you noticed, but tests of Locale::TextDomain are 
&gt; failing on almost every perl/system combination.
</div>
Yes, I will release 1.22 this week.

The problem &#40;I think so at least&#41; arises, when you don&#39;t have a locale
de_AT installed.  I should make the tests more robust and check for
other suitable locales but that&#39;s a lot of work.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Another thing i noticed while trying to figure out what happened. The 
&gt; changelog was previously an actual changelog file:
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/GUIDO/libintl-perl-1.20/ChangeLog">https://metacpan.org/source/GUIDO/libintl-perl-1.20/ChangeLog</a></span>
&gt; 
&gt; Now it&#39;s just a less than helpful dump from git log:
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/GUIDO/libintl-perl-1.21/ChangeLog">https://metacpan.org/source/GUIDO/libintl-perl-1.21/ChangeLog</a></span>
</div>
I switched from cvs to git and I haven&#39;t found a good replacement for
cvs2cl.  But I&#39;m open to suggestions.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;21&nbsp;11:04:53&nbsp;2013</span>
    <span class="description">GUIDO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jan 21 06:56:37 2013, MITHALDU wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Additionally it seems that your git repo is not up-to-date with the 
&gt; current release.
</div>
Are you in the branch v1?

The master branch is for 2.x.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;21&nbsp;11:08:04&nbsp;2013</span>
    <span class="description">MITHALDU [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Yes, I will release 1.22 this week.
</div>
Great. :&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The problem &#40;I think so at least&#41; arises, when you don&#39;t have a locale
&gt; de_AT installed.  I should make the tests more robust and check for
&gt; other suitable locales but that&#39;s a lot of work.
</div>
Sounds more like the test should use a hard-coded locale and not even 
touch the system, but i might be misunderstanding what it does.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I switched from cvs to git and I haven&#39;t found a good replacement for
&gt; cvs2cl.  But I&#39;m open to suggestions.
</div>
git log has many formatting options, you could try this for a starter:

git log --pretty=&#34;* %s&#34;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;21&nbsp;11:25:08&nbsp;2013</span>
    <span class="description">MITHALDU [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Are you in the branch v1?
&gt; 
&gt; The master branch is for 2.x.
</div>
Ah, i didn&#39;t realize there were multiple branches. Thanks. :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;22&nbsp;02:29:40&nbsp;2013</span>
    <span class="description">GUIDO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jan 21 11:08:04 2013, MITHALDU wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; The problem &#40;I think so at least&#41; arises, when you don&#39;t have a locale
&gt; &gt; de_AT installed.  I should make the tests more robust and check for
&gt; &gt; other suitable locales but that&#39;s a lot of work.
</div>&gt; 
&gt; Sounds more like the test should use a hard-coded locale and not even 
&gt; touch the system, but i might be misunderstanding what it does.
</div>
It is completely impossible to trigger any translation, when you don&#39;t
have at least one locale installed on the system.  See here:
<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=81315">https://rt.cpan.org/Ticket/Display.html?id=81315</a></span>

I should iterate over a list of possibly installed locales, pick the
first one found and use that one.  And if none can be found I have to
skip the gettext tests altogether.

Instead I currently check whether de_AT works, and use that one or skip
if it is not present.

Changing the strategy to a variable locale identifier requires touching
every single test in a way that cannot be done with search and replace.

In other words: lazyness ...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; I switched from cvs to git and I haven&#39;t found a good replacement for
&gt; &gt; cvs2cl.  But I&#39;m open to suggestions.
</div>&gt; 
&gt; git log has many formatting options, you could try this for a starter:
&gt; 
&gt; git log --pretty=&#34;* %s&#34;
</div>
Yes, sure, but the important part - imho - would be to add the names of
the files involved in the log messages and that is not trivial with git.
 There was some way to do it but I have to investigate again.

In other words: see above ... ;&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;22&nbsp;02:43:35&nbsp;2013</span>
    <span class="description">GUIDO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jan 21 11:03:51 2013, GUIDO wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt; 
&gt; On Mon Jan 21 06:55:12 2013, MITHALDU wrote:
<div class="message-stanza open">&gt; &gt; Heya, i don&#39;t know if you noticed, but tests of Locale::TextDomain are 
&gt; &gt; failing on almost every perl/system combination.
</div></div>
One more remark:

This mass failure is actually a good sign.  It is caused by the fix for
<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Dis">https://rt.cpan.org/Ticket/Dis</a></span> play.html?id=81315

Before that fix, it was able to make the pure Perl version return
translations although no locale was installed.  Now, the pure Perl
version behaves as the XS version with that respect.

Another downside of the fix will be that switching to the pure Perl
version, when you want translations although your system lacks the
required locale definitions will no longer work.  This could be
problematic for some users but I think that compatibility to GNU gettext
is more important than these dubious backdoors.

Instead, I plan to offer functions in libintl-perl 2.x that offer
messsage retrieval directly from mo or po files.  Then people can bypass
setlocale&#40;&#41; altogether which is usually a bad idea because you may end
up mixing output based on multiple locales, or even worse using multiple
character sets.  But in certain situations, especially for server
applications, this could work and you would not only gain performance
but also thread-safety.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;22&nbsp;05:40:35&nbsp;2013</span>
    <span class="description">MITHALDU [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It is completely impossible to trigger any translation, when you don&#39;t
&gt; have at least one locale installed on the system.
</div>
Is this about retrieving translations from application-specific po files, or about 
getting data from the OS itself on things like dates and number formats?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Instead, I plan to offer functions in libintl-perl 2.x that offer
&gt; messsage retrieval directly from mo or po files.  Then people can 
&gt; bypass setlocale&#40;&#41; altogether which is usually a bad idea because you 
&gt; may end up mixing output based on multiple locales, or even worse 
&gt; using multiple character sets.  But in certain situations, especially 
&gt; for server applications, this could work and you would not only gain 
&gt; performance but also thread-safety.
</div>
Honestly, that would be the best way. Maybe even as a separate dist. I looked at 
Locale::TextDomain as i need to localize a web application. As i&#39;m sure you can imagine, 
my users don&#39;t care about the locale of my server and everyone wants to see their own 
language. Right now there is so much magic and implicity and globals in 
Locale::TextDomain, that i cannot even tell if my use-case is possible in a sane manner 
and as such cannot use it with a clean conscience and will need to reimplement its 
syntax in a clean and simple module.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Yes, sure, but the important part - imho - would be to add the names
&gt; of the files involved in the log messages and that is not trivial 
&gt; with git.
</div>
Sure:

git log --pretty=&#34;format:* %s&#34; --name-only

There&#39;s plenty other options like shortstat, numstat, stat, name-status, etc. Just pick 
whatever you like.

Personally though, the point was rather: Perl dists should have a concise, useful and 
human-written summary of changes between releases. I looked at the changelogs in hopes 
of figuring out whether the last release was for bugfixes, or further development; to 
find out the significant changes. A prettier dump of git log won&#39;t tell me that either.

Also see: <span class="clickylink"><a target="new" rel="nofollow" href="http://changes.cpanhq.org">http://changes.cpanhq.org</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;22&nbsp;07:23:20&nbsp;2013</span>
    <span class="description">GUIDO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jan 22 05:40:35 2013, MITHALDU wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; It is completely impossible to trigger any translation, when you
</div>&gt; don&#39;t
<div class="message-stanza open">&gt; &gt; have at least one locale installed on the system.
</div>&gt; 
&gt; Is this about retrieving translations from application-specific po
&gt; files, or about
&gt; getting data from the OS itself on things like dates and number
&gt; formats?
</div>
All gettext&#40;&#41; functions will return the original msgid, unless you could
successfully switch to a locale other than C/POSIX.
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Instead, I plan to offer functions in libintl-perl 2.x that offer
&gt; &gt; messsage retrieval directly from mo or po files.  Then people can
&gt; &gt; bypass setlocale&#40;&#41; altogether which is usually a bad idea because
</div>&gt; you
<div class="message-stanza open">&gt; &gt; may end up mixing output based on multiple locales, or even worse
&gt; &gt; using multiple character sets.  But in certain situations,
</div>&gt; especially
<div class="message-stanza open">&gt; &gt; for server applications, this could work and you would not only gain
&gt; &gt; performance but also thread-safety.
</div>&gt; 
&gt; Honestly, that would be the best way. Maybe even as a separate dist. I
&gt; looked at
&gt; Locale::TextDomain as i need to localize a web application. As i&#39;m
&gt; sure you can imagine,
&gt; my users don&#39;t care about the locale of my server and everyone wants
&gt; to see their own
&gt; language. Right now there is so much magic and implicity and globals
&gt; in
&gt; Locale::TextDomain, that i cannot even tell if my use-case is possible
&gt; in a sane manner
&gt; and as such cannot use it with a clean conscience and will need to
&gt; reimplement its
&gt; syntax in a clean and simple module.
</div>
The globals in Locale::TextDomain and Locale::gettext_pp are caches,
things that are safe to remember, even under mod_perl.

If you really want to retrieve translations directly from mo files that
is quite easy.  Just look at the sources of gettext_pp.pm.  I could even
extend Locale::Messages::select_package&#40;&#41; so that it excepts other
package identifiers than gettext_pp or gettext_xs.  That way you can
roll your own message retrieval backend &#40;for example derived from
gettext_pp&#41; that bypasses all setlocale&#40;&#41; stuff.

The problem arises, when you interpolate OS output into your messages
&#40;or the other way round&#41;.  Even in a web application you may want to
interpolate $! &#40;stringified&#41; or the output of POSIX::strftime&#40;&#41;.  That
can lead to issues.  The OS locale could be set to fr_FR.utf-8 while you
get messages for ru_RU.koi8-r. 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Personally though, the point was rather: Perl dists should have a
&gt; concise, useful and
&gt; human-written summary of changes between releases. I looked at the
&gt; changelogs in hopes
&gt; of figuring out whether the last release was for bugfixes, or further
&gt; development; to
&gt; find out the significant changes. A prettier dump of git log won&#39;t
&gt; tell me that either.
</div>
But the file NEWS does.  For traditional reasons, libintl-perl rather
follows the GNU conventions for filenames, than the Perl ones.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;23&nbsp;08:16:58&nbsp;2013</span>
    <span class="description">MITHALDU [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jan 22 13:23:20 2013, GUIDO wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The problem arises, when you interpolate OS output into your messages
&gt; &#40;or the other way round&#41;.  Even in a web application you may want to
&gt; interpolate $! &#40;stringified&#41; or the output of POSIX::strftime&#40;&#41;.  That
&gt; can lead to issues.  The OS locale could be set to fr_FR.utf-8 while 
</div>you
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; get messages for ru_RU.koi8-r. 
</div>
This bit i didn&#39;t understand, so thanks for explaining.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The globals in Locale::TextDomain and Locale::gettext_pp are caches,
&gt; things that are safe to remember, even under mod_perl.
</div>
Ah, that was not clear from the way they are named. Also, how would i 
go about clearing those caches?
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If you really want to retrieve translations directly from mo files 
</div>that
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; is quite easy.  Just look at the sources of gettext_pp.pm.  I could 
</div>even
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; extend Locale::Messages::select_package&#40;&#41; so that it excepts other
&gt; package identifiers than gettext_pp or gettext_xs.  That way you can
&gt; roll your own message retrieval backend &#40;for example derived from
&gt; gettext_pp&#41; that bypasses all setlocale&#40;&#41; stuff.
</div>
And another thing i didn&#39;t realize: L::TD uses mo files to get data 
instead of reading from the po files. Since i&#39;m only starting to learn 
how gettext operates this wasn&#39;t clear to me.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; But the file NEWS does.  For traditional reasons, libintl-perl rather
&gt; follows the GNU conventions for filenames, than the Perl ones.
</div>
That&#39;s very confusing for perl developers though, since sites like 
metacpan and search.cpan.org look for files labeled Changes or 
ChangeLog to automatically link them. Maybe add a message at the top of 
that file to point out the real changelog file?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;23&nbsp;09:13:24&nbsp;2013</span>
    <span class="description">GUIDO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jan 23 08:16:58 2013, MITHALDU wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Tue Jan 22 13:23:20 2013, GUIDO wrote:
<div class="message-stanza open">&gt; &gt; The globals in Locale::TextDomain and Locale::gettext_pp are caches,
&gt; &gt; things that are safe to remember, even under mod_perl.
</div>&gt; 
&gt; Ah, that was not clear from the way they are named. Also, how would i 
&gt; go about clearing those caches?
</div>
You cannot unless you fiddle with the internals.

We are talking about mod_perl safetey here, right?

With that respect, one of the caches is slightly dangerous.  For
performance reasons, the module keeps a cache of directories it could
not open.  This cache - like all others - will survive HTTP requests in
mod_perl.  Not perfect but I think it is acceptable.

The other things that Locale::gettext_pp &#34;remembers&#34; are the currently
set textdomain, textdomain bindings, and so on.  However, the XS version
behaves the same and there is no way to reset it.

The only thing you can do is properly initialize I18N at the beginning
of every request.  In other words, call setlocale&#40;&#41;, textdomain&#40;&#41;,
bindtextdomain&#40;&#41;, bind_textdomain_codeset&#40;&#41;, and
bind_textdomain_filters&#40;&#41; when you start processing a request.

Even then you have to keep in mind that libintl-perl is not threadsafe,
because GNU gettext is not, because setlocale&#40;&#41; is not!  Therefore you
cannot use a threaded mpm with mod_perl in Apache.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; But the file NEWS does.  For traditional reasons, libintl-perl rather
&gt; &gt; follows the GNU conventions for filenames, than the Perl ones.
</div>&gt; 
&gt; That&#39;s very confusing for perl developers though, since sites like 
&gt; metacpan and search.cpan.org look for files labeled Changes or 
&gt; ChangeLog to automatically link them. Maybe add a message at the top of 
&gt; that file to point out the real changelog file?
</div>
My bad ... the file displayed in CPAN is ReleaseNotes &#40;a copy of NEWS&#41;.
 So you see both ReleaseNotes and ChangeLog.  The current way it is done
was recommended by Graham Barr to me and he runs search.cpan.org.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;23&nbsp;09:27:58&nbsp;2013</span>
    <span class="description">MITHALDU [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I should&#39;ve put the question about the caches more clearly. :&#41;

The case i have in mind is this: My app runs as fcgi, so thread-safety is not very important to me, nor mod_perl. My 
concern is that i wish to allow our translators to easily verify their translations in the website itself. This means that 
i need to be able to check whether a .mo file is of a newer date than the last time i a translation was requested, and to 
then force a reload. Right now it sounds like this is impossible without a restart of the process.

Optimally i&#39;d be able to instantiate L::TD objects which contain their own caches that can be modified via methods. The 
API inside packages would remain unchanged, as i could simply export closures on the object methods.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; My bad ... the file displayed in CPAN is ReleaseNotes &#40;a copy of NEWS&#41;.
&gt;  So you see both ReleaseNotes and ChangeLog.  The current way it is done
&gt; was recommended by Graham Barr to me and he runs search.cpan.org.
</div>
I see. In that case i&#39;ll submit a bug report to metacpan to see if they can have their change file detector check for 
releasenotes and news first. On that note: Your news file is actually different from the releasenotes file in the last 
release.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;23&nbsp;10:33:38&nbsp;2013</span>
    <span class="description">GUIDO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jan 23 09:27:58 2013, MITHALDU wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Optimally i&#39;d be able to instantiate L::TD objects which contain their
&gt; own caches that can be modified via methods. The
&gt; API inside packages would remain unchanged, as i could simply export
&gt; closures on the object methods.
</div>
Please don&#39;t forget that Locale::gettext_pp aims to be 100 % compatible
to Locale::gettext_xs and Locale::gettext_xs is just a thin wrapper
around the gettext functions in your libc or libintl.  And since the
underlying C code is not reentrant, the Perl bindings are not reentrant.

What you can do is enforce the use of the pure Perl version of the library:

    Locale::Messages-&gt;select_package &#40;&#39;gettext_pp&#39;&#41;;

And then, when you see that a MO &#40;not PO!&#41; file has changed, force
recompilation of the Perl module, so that all variables are thrown away:

    delete $INC{&#39;Locale/gettext_pp.pm&#39;};
    require Locale::gettext_pp;

Maybe, you also have re-import the symbols:

    Locale::gettext_pp-&gt;import&#40;&#39;:libintl_h&#39;, &#39;libintl_h&#39;&#41;;

Not sure about that last one.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; My bad ... the file displayed in CPAN is ReleaseNotes &#40;a copy of
</div>&gt; NEWS&#41;.
<div class="message-stanza open">&gt; &gt;  So you see both ReleaseNotes and ChangeLog.  The current way it is
</div>&gt; done
<div class="message-stanza open">&gt; &gt; was recommended by Graham Barr to me and he runs search.cpan.org.
</div>&gt; 
&gt; I see. In that case i&#39;ll submit a bug report to metacpan to see if
&gt; they can have their change file detector check for
&gt; releasenotes and news first. On that note: Your news file is actually
&gt; different from the releasenotes file in the last
&gt; release.
</div>
Hm, yes.  The Makefile obviously has a flaw.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;24&nbsp;10:41:37&nbsp;2013</span>
    <span class="description">GUIDO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Should be fixed in 1.22.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;24&nbsp;10:41:38&nbsp;2013</span>
    <span class="description">GUIDO [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
