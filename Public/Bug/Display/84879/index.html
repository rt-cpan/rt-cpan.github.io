<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #84879 for Encode: Encode::encode and Encode::decode gratuitously launders tainted data</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #84879 for Encode: Encode::encode and Encode::decode gratuitously launders tainted data</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Encode/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Encode/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Encode/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Encode/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Encode">Encode CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">84879</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Encode/Active/">Encode</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
Mark.Martinec [...] ijs.si

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-12062-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
2.35</li>
<li>
2.36</li>
<li>
2.37</li>
<li>
2.38</li>
<li>
2.39</li>
<li>
2.40</li>
<li>
2.41</li>
<li>
2.42</li>
<li>
2.43</li>
<li>
2.44</li>
<li>
2.45</li>
<li>
2.46</li>
<li>
2.47</li>
<li>
2.48</li>
<li>
2.49</li>
</ul>
    </td>
  </tr>
  <tr id="CF-12063-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;26&nbsp;13:37:26&nbsp;2013</span>
    <span class="description">Mark.Martinec [...] ijs.si -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Encode::encode and Encode::decode gratuitously launders tainted data</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The result of Encode::encode or Encode::decode
is not tainted, even if given a tainted argument.

There is no excuse for such gratuitous laundering
of data. It subverts usefulness of Perl taint
protection mechanism and can open security holes
in applications using Encode which are unaware of
this bug &#40;here is one example: [rt.cpan.org #82294]&#41;.

The bug is not new and is not specific to recent
versions of perl or versions of the module Encode
&#40;tested with Encode 2.49, 2.44, 2.42, 2.35, ...&#41;.

Some more security conscious existing applications
are already jumping hoops providing a workaround,
but this is not something which an application
should be required to do.

The following test program illustrates the problem:


#!/usr/bin/perl -T
use strict;
use Encode qw&#40;encode decode&#41;;
use Scalar::Util qw&#40;tainted&#41;;

printf&#40;&#34;Encode %s\n&#34;, Encode-&gt;VERSION&#41;;

my $str = &#34;abc&#34; . substr&#40;$ENV{PATH},0,0&#41;;  # tainted string
my $r;

$r = encode&#40;&#34;ASCII&#34;, $str&#41;;
warn &#34;encode laundering\n&#34; if tainted&#40;$str&#41; &#38;&#38; !tainted&#40;$r&#41;;

$r = encode&#40;&#34;UTF-8&#34;, $str&#41;;
warn &#34;encode laundering\n&#34; if tainted&#40;$str&#41; &#38;&#38; !tainted&#40;$r&#41;;

$r = decode&#40;&#34;ISO-8859-1&#34;, $str&#41;;
warn &#34;decode laundering\n&#34; if tainted&#40;$str&#41; &#38;&#38; !tainted&#40;$r&#41;;


There is a related PR 64642 &#40;Tainted values have the taint flag
cleared when encoded&#41;, which addresses only the encoding half
of the problem. It is disheartening that it is labeled under
severity &#34;wishlist&#34;, where in fact it is genuine security issue.

As the Encode is a core module, this issue is also tracked
as [perl #117771].
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;26&nbsp;14:22:35&nbsp;2013</span>
    <span class="description">DANKOGAI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">No excuse.  Just fixes.  Should be complete since all supported encodings are checked in t/taint.t

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/dankogai/p5-encode/commit/a352ec9d6e5e4bcdd6dde737c8a540774d87b26e">https://github.com/dankogai/p5-encode/commit/a352ec9d6e5e4bcdd6dde737c8a540774d87b26e</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/dankogai/p5-encode/commit/274673c289e7615e12e642ca54e48d8aac9d82db">https://github.com/dankogai/p5-encode/commit/274673c289e7615e12e642ca54e48d8aac9d82db</a></span>

Thank you for your report.

Dan the Maintainer Thereof

On Fri Apr 26 13:37:26 2013, Mark.Martinec@ijs.si wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The result of Encode::encode or Encode::decode
&gt; is not tainted, even if given a tainted argument.
&gt; 
&gt; There is no excuse for such gratuitous laundering
&gt; of data. It subverts usefulness of Perl taint
&gt; protection mechanism and can open security holes
&gt; in applications using Encode which are unaware of
&gt; this bug &#40;here is one example: [rt.cpan.org #82294]&#41;.
&gt; 
&gt; The bug is not new and is not specific to recent
&gt; versions of perl or versions of the module Encode
&gt; &#40;tested with Encode 2.49, 2.44, 2.42, 2.35, ...&#41;.
&gt; 
&gt; Some more security conscious existing applications
&gt; are already jumping hoops providing a workaround,
&gt; but this is not something which an application
&gt; should be required to do.
&gt; 
&gt; The following test program illustrates the problem:
&gt; 
&gt; 
&gt; #!/usr/bin/perl -T
&gt; use strict;
&gt; use Encode qw&#40;encode decode&#41;;
&gt; use Scalar::Util qw&#40;tainted&#41;;
&gt; 
&gt; printf&#40;&#34;Encode %s\n&#34;, Encode-&gt;VERSION&#41;;
&gt; 
&gt; my $str = &#34;abc&#34; . substr&#40;$ENV{PATH},0,0&#41;;  # tainted string
&gt; my $r;
&gt; 
&gt; $r = encode&#40;&#34;ASCII&#34;, $str&#41;;
&gt; warn &#34;encode laundering\n&#34; if tainted&#40;$str&#41; &#38;&#38; !tainted&#40;$r&#41;;
&gt; 
&gt; $r = encode&#40;&#34;UTF-8&#34;, $str&#41;;
&gt; warn &#34;encode laundering\n&#34; if tainted&#40;$str&#41; &#38;&#38; !tainted&#40;$r&#41;;
&gt; 
&gt; $r = decode&#40;&#34;ISO-8859-1&#34;, $str&#41;;
&gt; warn &#34;decode laundering\n&#34; if tainted&#40;$str&#41; &#38;&#38; !tainted&#40;$r&#41;;
&gt; 
&gt; 
&gt; There is a related PR 64642 &#40;Tainted values have the taint flag
&gt; cleared when encoded&#41;, which addresses only the encoding half
&gt; of the problem. It is disheartening that it is labeled under
&gt; severity &#34;wishlist&#34;, where in fact it is genuine security issue.
&gt; 
&gt; As the Encode is a core module, this issue is also tracked
&gt; as [perl #117771].
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;26&nbsp;14:22:35&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;26&nbsp;14:22:35&nbsp;2013</span>
    <span class="description">DANKOGAI [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;26&nbsp;15:01:29&nbsp;2013</span>
    <span class="description">Mark.Martinec [...] ijs.si -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #84879] Resolved: Encode::encode and Encode::decode gratuitously launders tainted data</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 26 Apr 2013 21:01:06 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Encode [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Martinec &lt;Mark.Martinec [...] ijs.si&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dan,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; No excuse.  Just fixes.  Should be complete since all
&gt; supported encodings are checked in t/taint.t
&gt;   <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/dankogai/p5">https://github.com/dankogai/p5</a></span>...
&gt; Thank you for your report.
</div>
A blazingly fast response, amazing!
Big thanks!!!

  Mark
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
