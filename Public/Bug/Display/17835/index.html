<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #17835 for Image-MetaData-JPEG: subroutine &#39;save&#39; should check for undefined filename before calling &#39;open&#39;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #17835 for Image-MetaData-JPEG: subroutine &#39;save&#39; should check for undefined filename before calling &#39;open&#39;</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Image-MetaData-JPEG">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Image-MetaData-JPEG">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Image-MetaData-JPEG">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Image-MetaData-JPEG">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Image-MetaData-JPEG">Image-MetaData-JPEG CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">17835</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Image-MetaData-JPEG">Image-MetaData-JPEG</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
brian [...] photoresearchers.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-16694-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.15    </td>
  </tr>
  <tr id="CF-16695-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.153    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Image-MetaData-JPEG-0.15-fix_save_open.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/167972/54203/Image-MetaData-JPEG-0.15-fix_save_open.patch">
Thu Feb 23 13:08:57 2006 (623b) by Guest
</a>
</font></li>
</ul>


Image-MetaData-JPEG-0.15-fix_save_working.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/167975/54210/Image-MetaData-JPEG-0.15-fix_save_working.patch">
Thu Feb 23 14:03:02 2006 (1k) by Guest
</a>
</font></li>
</ul>


Image-MetaData-JPEG-0.15-fix_thumbnail.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/168934/54769/Image-MetaData-JPEG-0.15-fix_thumbnail.patch">
Mon Feb 27 13:59:10 2006 (1.3k) by Guest
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=17835">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-167972" href="/Public/Bug/Display.html?id=17835#txn-167972">#</a>      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;23&nbsp;13:08:57&nbsp;2006</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> subroutine &#39;save&#39; should check for undefined filename before
 calling &#39;open&#39;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/167972/54200/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/54200">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 262b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">make test reports:

t/JPEG_5_exif_Thumbnail....# Testing APP1 Exif data routines &#40;thumbnail&#41;
t/JPEG_5_exif_Thumbnail....ok 16/26Use of uninitialized value in open at /path/to/
Image-MetaData-JPEG-0.15/blib/lib/Image/MetaData/JPEG.pm line 134.

patch is attached.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Image-MetaData-JPEG-0.15-fix_save_open.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/167972/54203/Image-MetaData-JPEG-0.15-fix_save_open.patch">Download Image-MetaData-JPEG-0.15-fix_save_open.patch</a><br />
<span class="downloadcontenttype">text/x-diff 623b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- lib/Image/MetaData/JPEG.pm	2006-01-05 18:58:00.000000000 -0500
+++ lib/Image/MetaData/JPEG.pm	2006-02-23 13:02:32.000000000 -0500
@@ -124,7 +124,7 @@
     # fail immediately if &#34;read_only&#34; is set
     return undef if $this-&gt;{read_only};
     # if $filename is undefined, it defaults to the original name
-    $filename = $this-&gt;{filename} unless defined $filename;
+    return undef unless defined &#40;$filename ||= $this-&gt;{filename}&#41;;
     # Open an IO handler for output on a file named $filename
     # or on an in-memory variable pointed to by $filename.
     # Use an indirect handler, which is closed authomatically
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-167975" href="/Public/Bug/Display.html?id=17835#txn-167975">#</a>      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;23&nbsp;14:03:01&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> brian [...] photoresearchers.com</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/167975/54207/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/54207">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 8.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Wow.  Disregard that last patch, as it turns out this was a bigger problem than I 
realized.  The &#39;filename&#39; argument being passed to the &#39;save&#39; function is a REFERENCE, 
but it&#39;s being treated like a scalar value.  I don&#39;t know if this was the intent or not, but 
going with the pass-by-reference design I further patched the routine to expect and 
verify the &#39;filename&#39; variable as a reference.

Running with the new patch, with which I&#39;d like to assume the &#39;save&#39; method is working 
the way it was intended, causes &#39;make test&#39; to fail 10 of 17 test scripts, reporting as 
follows:

PERL_DL_NONLAZY=1 /usr/bin/perl &#34;-MExtUtils::Command::MM&#34; &#34;-e&#34; &#34;test_harness&#40;0, 
&#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/*.t
t/JPEG_0_records...........# Testing [Image::MetaData::JPEG::Record]
t/JPEG_0_records...........ok                                                
t/JPEG_1_segments..........# Testing [Image::MetaData::JPEG::Segment]
t/JPEG_1_segments..........ok                                                
t/JPEG_2_JPEG_class........# Testing [Image::MetaData::JPEG]
t/JPEG_2_JPEG_class........ok 23/60#     Failed test &#40;t/JPEG_2_JPEG_class.t at line 119&#41;
t/JPEG_2_JPEG_class........ok 60/60# Looks like you failed 1 tests of 60.    
t/JPEG_2_JPEG_class........dubious                                           
        Test returned status 1 &#40;wstat 256, 0x100&#41;
DIED. FAILED test 24
        Failed 1/60 tests, 98.33% okay
t/JPEG_2_rare..............# Testing JPEG segments seldom used methods
t/JPEG_2_rare..............ok                                                
t/JPEG_3_comments..........# Testing comment routines
t/JPEG_3_comments..........ok 21/24Can&#39;t call method &#34;get_comments&#34; on an undefined 
value at t/JPEG_3_comments.t line 125.
# Looks like you planned 24 tests but only ran 21.
# Looks like your test died just after 21.
t/JPEG_3_comments..........dubious                                           
        Test returned status 255 &#40;wstat 65280, 0xff00&#41;
DIED. FAILED tests 22-24
        Failed 3/24 tests, 87.50% okay
t/JPEG_4_app13.............# Testing APP13 IPTC basic routines
t/JPEG_4_app13.............ok                                                
t/JPEG_4_app13_IPTC........# Testing APP13 IPTC format checker
t/JPEG_4_app13_IPTC........ok                                                
t/JPEG_4_app13_set.........# Testing APP13 IPTC set routines
t/JPEG_4_app13_set.........ok 17/53#     Failed test &#40;t/JPEG_4_app13_set.t at line 141&#41;
t/JPEG_4_app13_set.........NOK 18#     &#39;ne&#39;                                  
#         
#     undef
Can&#39;t call method &#34;get_app13_data&#34; on an undefined value at t/JPEG_4_app13_set.t line 
144.
# Looks like you planned 53 tests but only ran 18.
# Looks like your test died just after 18.
t/JPEG_4_app13_set.........dubious                                           
        Test returned status 255 &#40;wstat 65280, 0xff00&#41;
DIED. FAILED tests 18-53
        Failed 36/53 tests, 32.08% okay
t/JPEG_5_exif..............# Testing APP1 Exif data routines
t/JPEG_5_exif..............ok                                                
t/JPEG_5_exif_GPS..........# Testing APP1 Exif data routines &#40;GPS_DATA&#41;
t/JPEG_5_exif_GPS..........ok 11/47#     Failed test &#40;t/JPEG_5_exif_GPS.t at line 101&#41;
#          got: undef
#     expected: &#39;ARRAY&#40;0x83b5f74&#41;&#39;
t/JPEG_5_exif_GPS..........NOK 12Can&#39;t call method &#34;get_description&#34; on unblessed 
reference at t/JPEG_5_exif_GPS.t line 105.
# Looks like you planned 47 tests but only ran 12.
# Looks like your test died just after 12.
t/JPEG_5_exif_GPS..........dubious                                           
        Test returned status 255 &#40;wstat 65280, 0xff00&#41;
DIED. FAILED tests 12-47
        Failed 36/47 tests, 23.40% okay
t/JPEG_5_exif_IFD..........# Testing APP1 Exif data routines &#40;IFD01_DATA&#41;
t/JPEG_5_exif_IFD..........ok 30/59#     Failed test &#40;t/JPEG_5_exif_IFD.t at line 186&#41;
#          got: undef
#     expected: &#39;ARRAY&#40;0x836cde4&#41;&#39;
t/JPEG_5_exif_IFD..........NOK 31Can&#39;t call method &#34;get_description&#34; on unblessed 
reference at t/JPEG_5_exif_IFD.t line 190.
# Looks like you planned 59 tests but only ran 31.
# Looks like your test died just after 31.
t/JPEG_5_exif_IFD..........dubious                                           
        Test returned status 255 &#40;wstat 65280, 0xff00&#41;
DIED. FAILED tests 31-59
        Failed 29/59 tests, 50.85% okay
t/JPEG_5_exif_IMAGE........# Testing APP1 Exif data routines &#40;IMAGE_DATA &#38; 
ROOT_DATA&#41;
t/JPEG_5_exif_IMAGE........ok 29/52#     Failed test &#40;t/JPEG_5_exif_IMAGE.t at line 189&#41;
#          got: undef
#     expected: &#39;ARRAY&#40;0x8064588&#41;&#39;
t/JPEG_5_exif_IMAGE........NOK 30Can&#39;t call method &#34;get_description&#34; on unblessed 
reference at t/JPEG_5_exif_IMAGE.t line 193.
# Looks like you planned 52 tests but only ran 30.
# Looks like your test died just after 30.
t/JPEG_5_exif_IMAGE........dubious                                           
        Test returned status 255 &#40;wstat 65280, 0xff00&#41;
DIED. FAILED tests 30-52
        Failed 23/52 tests, 55.77% okay
t/JPEG_5_exif_Interop......# Testing APP1 Exif data routines &#40;INTEROP_DATA&#41;
t/JPEG_5_exif_Interop......ok 13/29#     Failed test &#40;t/JPEG_5_exif_Interop.t at line 90&#41;
#          got: undef
#     expected: &#39;ARRAY&#40;0x83aa6c8&#41;&#39;
t/JPEG_5_exif_Interop......NOK 14Can&#39;t call method &#34;get_description&#34; on unblessed 
reference at t/JPEG_5_exif_Interop.t line 94.
# Looks like you planned 29 tests but only ran 14.
# Looks like your test died just after 14.
t/JPEG_5_exif_Interop......dubious                                           
        Test returned status 255 &#40;wstat 65280, 0xff00&#41;
DIED. FAILED tests 14-29
        Failed 16/29 tests, 44.83% okay
t/JPEG_5_exif_Makernote....# Testing APP1 MakerNote parse / dump
t/JPEG_5_exif_Makernote....ok 7/44Can&#39;t call method &#34;get_description&#34; on an undefined 
value at t/JPEG_5_exif_Makernote.t line 85.
# Looks like you planned 44 tests but only ran 7.
# Looks like your test died just after 7.
Unbalanced string table refcount: &#40;1&#41; for &#34;Pentax_Optio430.jpg&#34; during global 
destruction.
t/JPEG_5_exif_Makernote....dubious                                           
        Test returned status 255 &#40;wstat 65280, 0xff00&#41;
DIED. FAILED tests 8-44
        Failed 37/44 tests, 15.91% okay
t/JPEG_5_exif_SubIFD.......# Testing APP1 Exif data routines &#40;SUBIFD_DATA&#41;
t/JPEG_5_exif_SubIFD.......ok 15/50#     Failed test &#40;t/JPEG_5_exif_SubIFD.t at line 125&#41;
#          got: undef
#     expected: &#39;ARRAY&#40;0x804ca28&#41;&#39;
t/JPEG_5_exif_SubIFD.......NOK 16Can&#39;t call method &#34;get_description&#34; on unblessed 
reference at t/JPEG_5_exif_SubIFD.t line 129.
# Looks like you planned 50 tests but only ran 16.
# Looks like your test died just after 16.
t/JPEG_5_exif_SubIFD.......dubious                                           
        Test returned status 255 &#40;wstat 65280, 0xff00&#41;
DIED. FAILED tests 16-50
        Failed 35/50 tests, 30.00% okay
t/JPEG_5_exif_Thumbnail....# Testing APP1 Exif data routines &#40;thumbnail&#41;
t/JPEG_5_exif_Thumbnail....ok 7/26Can&#39;t call method &#34;get_Exif_data&#34; on an undefined 
value at t/JPEG_5_exif_Thumbnail.t line 54.
# Looks like you planned 26 tests but only ran 7.
# Looks like your test died just after 7.
t/JPEG_5_exif_Thumbnail....dubious                                           
        Test returned status 255 &#40;wstat 65280, 0xff00&#41;
DIED. FAILED tests 8-26
        Failed 19/26 tests, 26.92% okay
t/JPEG_p_podchecker........# Checking documentation syntax with Pod::Checker
lib/Image/MetaData/JPEG.pod pod syntax OK.
t/JPEG_p_podchecker........ok 1/4lib/Image/MetaData/JPEG/Structures.pod pod syntax 
OK.
t/JPEG_p_podchecker........ok 2/4lib/Image/MetaData/JPEG/TagLists.pod pod syntax OK.
t/JPEG_p_podchecker........ok 3/4lib/Image/MetaData/JPEG/MakerNotes.pod pod syntax 
OK.
t/JPEG_p_podchecker........ok                                                
Failed Test               Stat Wstat Total Fail  Failed  List of Failed
--------------------------------------------------------------------------
-----
t/JPEG_2_JPEG_class.t        1   256    60    1   1.67%  24
t/JPEG_3_comments.t        255 65280    24    3  12.50%  22-24
t/JPEG_4_app13_set.t       255 65280    53   36  67.92%  18-53
t/JPEG_5_exif_GPS.t        255 65280    47   36  76.60%  12-47
t/JPEG_5_exif_IFD.t        255 65280    59   29  49.15%  31-59
t/JPEG_5_exif_IMAGE.t      255 65280    52   23  44.23%  30-52
t/JPEG_5_exif_Interop.t    255 65280    29   16  55.17%  14-29
t/JPEG_5_exif_Makernote.t  255 65280    44   37  84.09%  8-44
t/JPEG_5_exif_SubIFD.t     255 65280    50   35  70.00%  16-50
t/JPEG_5_exif_Thumbnail.t  255 65280    26   19  73.08%  8-26
Failed 10/17 test scripts, 41.18% okay. 235/817 subtests failed, 71.24% okay.
make: *** [test_dynamic] Error 29
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/167975/54210/Image-MetaData-JPEG-0.15-fix_save_working.patch">Download Image-MetaData-JPEG-0.15-fix_save_working.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- JPEG.pm.ORIG	2006-01-05 18:58:00.000000000 -0500
+++ JPEG.pm	2006-02-23 13:51:09.000000000 -0500
@@ -124,14 +124,16 @@
     # fail immediately if &#34;read_only&#34; is set
     return undef if $this-&gt;{read_only};
     # if $filename is undefined, it defaults to the original name
-    $filename = $this-&gt;{filename} unless defined $filename;
+    $filename = \$this-&gt;{filename} unless defined $filename;
+    return undef unless ref&#40;$filename&#41; eq &#39;SCALAR&#39; &#38;&#38; defined &#40;$$filename&#41;;
     # Open an IO handler for output on a file named $filename
     # or on an in-memory variable pointed to by $filename.
     # Use an indirect handler, which is closed authomatically
     # when it goes out of scope &#40;so, no need to call close&#40;&#41;&#41;.
     # If open fails, it returns false and sets the special
     # variable $! to reflect the system error.
-    open&#40;my $out, &#39;&gt;&#39;, $filename&#41; || return undef;
+    my $out;
+    open&#40;$out, &#39;&gt;&#39;, $$filename&#41; || return undef;
     # Legacy systems might need an explicit binary open.
     binmode&#40;$out&#41;;
     # For each segment in the segment list, write the content of
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-167976" href="/Public/Bug/Display.html?id=17835#txn-167976">#</a>      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;23&nbsp;14:03:03&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-167990" href="/Public/Bug/Display.html?id=17835#txn-167990">#</a>      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;23&nbsp;15:32:22&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> brian [...] photoresearchers.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/167990/54221/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/54221">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">To follow-up:  it&#39;s not clear what the tests are doing calling the &#39;save&#39; method with a 
reference &#40;particularly when that reference is to a unmodifiable constant&#41;, and 
furthermore calling the &#39;new&#39; method on the *class* with a reference to a constant.

For example, in t/JPEG_3_comments.t:

$image-&gt;remove_all_comments&#40;&#41;;
$image-&gt;add_comment&#40;$_&#41; for @savelist; $num = @savelist;
$bufferref = \ &#34;dummy&#34;;
$image-&gt;save&#40;$bufferref&#41;;
$newim = $cname-&gt;new&#40;$bufferref&#41;;
@list = $newim-&gt;get_comments&#40;&#41;;
is_deeply&#40; \@list, \@savelist, &#34;Save and re-read&#34; &#41;;

What is this code trying to accomplish?  I&#39;m having trouble figuring it out.

The variable &#39;$bufferref&#34; here is a constant value.  In order for the method call to &#39;new&#39; 
to return an in-memory object with the comments embedded &#40;in order to compare them 
to the original list?&#41;, then the call to the &#39;save&#39; method would either need to accept a 
&#39;Image::MetaData::JPEG&#39; object instead of a scalar filename or else it would need to 
create one with its own call to &#39;new&#39;, unless the author&#39;s intent is for a new file to be 
created with the name &#34;dummy&#34; &#40;which I assume is not the case, else the variable would 
likely have been named &#39;$ref&#39; instead of &#39;$bufferref&#39; which seems to suggest an in-
memory buffer&#41;.

The &#39;save&#39; method expects a single optional argument representing a new filename 
&#40;otherwise it defaults to the original&#41;.  Even if it were modified to accept an object 
reference instead, this test would still fail to utilize it because it&#39;s passing &#39;$bufferref&#39; by 
*value* instead of by reference, which makes it unmodifiable.  Since the method call to 
&#39;save&#39; is being passed a reference to a string constant &#40;but not a reference to anything ti 
can modify&#41; and its return value is being ignored, I don&#39;t see how this method call 
accomplishes anything useful.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-168556" href="/Public/Bug/Display.html?id=17835#txn-168556">#</a>      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;25&nbsp;19:25:23&nbsp;2006</span>
    <span class="description">bettelli [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Stefano Bettelli</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/168556/54569/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/54569">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I had a look at your reported error during 
self-tests, and this is my analysis. An error
occurs during test number #17 in t/JPEG_5_exif_Thumbnail:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&gt; t/JPEG_5_exif_Thumbnail....# Testing APP1 Exif data routines &#40;thumbnail&#41;
&gt;&gt; t/JPEG_5_exif_Thumbnail....ok 16/26Use of uninitialized value in open
</div>at /path/to/
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&gt; Image-MetaData-JPEG-0.15/blib/lib/Image/MetaData/JPEG.pm line 134.
</div>
This test consists in a single line of code:

    $image-&gt;set_Exif_data&#40;$thumb, &#39;THUMBNAIL&#39;&#41;;

where $thumb is a valid Image::MetaData::JPEG 
object reference, previously created with:

    $thumb = $classname-&gt;new&#40;$dataref&#41;;

What happens is that $thumb is passed to an internal
routine, set_Exif_thumbnail&#40;&#41;, which can accept various
types of input, and whose goal is to produce and appro-
priately store a JPEG stream &#40;a sequence of bytes&#41;. In
this case, therefore, the validity of the stream is
already guaranteed, and the routine only needs to extract
the image in a Perl scalar; this is done by

    if &#40;&#39;Image::MetaData::JPEG&#39; eq ref $dataref&#41; {
     my $r; $dataref-&gt;save&#40;\ $r&#41;; $dataref = \ $r; }

This is not very important, it just shows who is
calling save&#40;&#41;, which contains line 134 of JPEG.pm.
Anyway, save&#40;&#41; is invoked with a reference to a scalar
as argument: the effect should be that the JPEG stream
is written into the scalar &#40;$r&#41;. For some reason, this
works for me but not for you ... Now, you argue:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&gt; Disregard that last patch, as it turns out this was
&gt;&gt; a bigger problem than I realized. The &#39;filename&#39; argument
&gt;&gt; being passed to the &#39;save&#39; function is a REFERENCE,
&gt;&gt; but it&#39;s being treated like a scalar value. [...]
</div>
This is a misunderstanding; save&#40;&#41; can accept either a
scalar or a reference to a scalar. If it is a plain
scalar it must contain a file name &#40;and I agree that
I have to check that it is not the empty string, which
I will do in my next release&#41;; if it is a reference to
a scalar, the corresponding scalar is used as &#34;in-memory
file&#34;. This is documented by &#39;perldoc -f open&#39;:

      Since v5.8.0, perl has built using PerlIO by default.
      Unless you&#39;ve changed this &#40;i.e. Configure -Uuseperlio&#41;,
      you can open file handles to &#34;in memory&#34; files held in
      Perl scalars via:

                   open&#40;$fh, &#39;&gt;&#39;, \$variable&#41; || ..

This leads me to suppose that you are using an older
version of Perl &#40;and that I should include an appropriate
&#34;use VERSION&#34; in my code&#41;, or that your version is not
standard configured &#40;and I should check for this capability
to be present, which I don&#39;t know how to do presently&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&gt; I don&#39;t know if this was the intent or not, but going
&gt;&gt; with the pass-by-reference design I further patched the
&gt;&gt; routine to expect and verify the &#39;filename&#39; variable as
&gt;&gt; a reference. [...]
&gt;&gt;
&gt;&gt; - $filename = $this-&gt;{filename} unless defined $filename;
&gt;&gt; + $filename = \$this-&gt;{filename} unless defined $filename;
&gt;&gt; + return undef unless ref&#40;$filename&#41; eq &#39;SCALAR&#39; &#38;&#38; defined &#40;$$filename&#41;;
</div>
As I said, this is not true. This variable has not a fixed
type: it can be a scalar or a reference to a scalar. If it
is undefined it must be replaced with a scalar, not with a
reference. This is the reason of all subsequent errors.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&gt; To follow-up: it&#39;s not clear what the tests are doing calling
&gt;&gt; the &#39;save&#39; method with a reference &#40;particularly when that
&gt;&gt; reference is to a unmodifiable constant&#41;, and furthermore calling
&gt;&gt; the &#39;new&#39; method on the *class* with a reference to a constant.
&gt;&gt; For example, in t/JPEG_3_comments.t:
&gt;&gt; [...]
&gt;&gt; $bufferref = \ &#34;dummy&#34;;
&gt;&gt; $image-&gt;save&#40;$bufferref&#41;;
&gt;&gt; $newim = $cname-&gt;new&#40;$bufferref&#41;;
&gt;&gt; [...]
&gt;&gt; What is this code trying to accomplish? I&#39;m having trouble
&gt;&gt; figuring it out. The variable &#39;$bufferref&#34; here is a constant
&gt;&gt; value. [...]
</div>
Well, I agree that this code &#40;a leftover&#41; is a bit obscure,
and that the first line should be replaced by:

            my $buffer;
            $bufferref = \ $buffer;

However, I disagree with your idea that $bufferref is a constant.
It is a Perl variable holding the value of a reference; as such,
it is surely variable. Even $bufferref is not a constant, it is
just a scalar whose initial value &#40;which is disregarded in the
call to open&#40;&#41;&#41; is &#34;dummy&#34;. 

In conclusion, if I take into account also the other errors 
which you showed me in a private mail, I believe that your
Perl installation is either non-standard, or buggy or outdated
&#40;maybe it is pre 5.8 ?&#41;. Could you give me more details on your
setup? Do you have the possibility to run the self-tests on a
different machine? By the way, I develop on a Debian system
with Perl 5.8.8. You can see other setups, where all self-tests
where passed, in the following web page:

<span class="clickylink"><a target="new" rel="nofollow" href="http://cpantesters.perl.org/show/Image-MetaData-JPEG.html#Image-MetaData-JPEG-0.15">http://cpantesters.perl.org/show/Image-MetaData-JPEG.html#Image-MetaData-JPEG-0.15</a></span>

Best regards,
                                  Stefano Bettelli
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-168934" href="/Public/Bug/Display.html?id=17835#txn-168934">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;27&nbsp;13:59:09&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> brian [...] photoresearchers.com</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/168934/54766/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/54766">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Feb 25 19:25:23 2006, BETTELLI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; What happens is that $thumb is passed to an internal
&gt; routine, set_Exif_thumbnail&#40;&#41;, which can accept various
&gt; types of input, and whose goal is to produce and appro-
&gt; priately store a JPEG stream &#40;a sequence of bytes&#41;.
</div>
Aha!  Yes!  I think I found the problem then.  See attached patch.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In this case, therefore, the validity of the stream is
&gt; already guaranteed, and the routine only needs to extract
&gt; the image in a Perl scalar; this is done by
&gt; 
&gt;     if &#40;&#39;Image::MetaData::JPEG&#39; eq ref $dataref&#41; {
&gt;      my $r; $dataref-&gt;save&#40;\ $r&#41;; $dataref = \ $r; }
&gt; 
&gt; This is not very important, it just shows who is
&gt; calling save&#40;&#41;, which contains line 134 of JPEG.pm.
&gt; Anyway, save&#40;&#41; is invoked with a reference to a scalar
&gt; as argument: the effect should be that the JPEG stream
&gt; is written into the scalar &#40;$r&#41;. For some reason, this
&gt; works for me but not for you.
</div>
I don&#39;t know why it works for you.  The reason is that save&#40;&#41; contains the following line:

$filename = $this-&gt;{filename} unless defined $filename;

In this case, you&#39;ve passed a reference to an undefined variable &#40;$r, which you declare 
but do not define&#41;, so the save&#40;&#41; method ignores the destination you&#39;ve provided and 
defaults to the original filename, which I imagine &#40;although I haven&#39;t investigated this 
completely&#41; is also undefined in this instance.  Regardless this seems incorrect, given 
what you&#39;ve described it&#39;s trying to do, so the provided patch fixes the above code in 
set_Exif_thumbnail&#40;&#41; to define $r to the empty string so that it can be written.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This leads me to suppose that you are using an older
&gt; version of Perl &#40;and that I should include an appropriate
&gt; &#34;use VERSION&#34; in my code&#41;, or that your version is not
&gt; standard configured &#40;and I should check for this capability
&gt; to be present, which I don&#39;t know how to do presently&#41;.
</div>
FYI my perl is fine &#40;v5.8.0 built for i386-linux-thread-multi&#41;, and that use of open&#40;&#41; 
&#40;about which I&#39;d forgotten and you were right to correct me&#41; works fine when tested.  I 
was a bit too hasty in diagnosing the problem, which is why all previous patches should 
be disregarded as they only mess things up further.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/168934/54769/Image-MetaData-JPEG-0.15-fix_thumbnail.patch">Download Image-MetaData-JPEG-0.15-fix_thumbnail.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- lib/Image/MetaData/JPEG/JPEG_app1_exif.pl	2006-01-06 17:20:43.000000000 -0500
+++ lib/Image/MetaData/JPEG/JPEG_app1_exif.pl	2006-02-27 13:45:01.000000000 -0500
@@ -468,14 +468,15 @@
     # if $dataref points to an Image::MetaData::JPEG object, replace it
     # with a reference to its bare content and set $type to &#39;JPEG&#39;.
     if &#40;&#39;Image::MetaData::JPEG&#39; eq ref $dataref&#41; {
-	my $r; $dataref-&gt;save&#40;\ $r&#41;; $dataref = \ $r; $type = &#39;JPEG&#39;; }
+	my $r = &#34;&#34;; $dataref-&gt;save&#40;\ $r&#41;; $dataref = \ $r; $type = &#39;JPEG&#39;; }
     # $dataref must now be a scalar reference; everything else is an error
     return { &#39;ERROR&#39; =&gt; &#39;not a good reference&#39; } if ref $dataref ne &#39;SCALAR&#39;;
     # try to recognise the content of $$dataref. If it is defined but empty,
     # we just need to erase the thumbnail. If it is accepted by the JPEG
     # ctor or $type is already &#39;JPEG&#39;, we consider it a regular JPEG stream.
     $type = &#39;NONE&#39; if length $$dataref == 0;
-    $type = &#39;JPEG&#39; if ! $type &#38;&#38; Image::MetaData::JPEG-&gt;new&#40;$dataref, &#39;&#39;&#41;;
+    $type = &#39;JPEG&#39; if ! $type &#38;&#38;
+		      Image::MetaData::JPEG-&gt;new&#40;$dataref, \&#40;my $ns = &#39;&#39;&#41;&#41;;
     # If $type is not yet set, generate an error &#40;TIFF not yet supported ...&#41;
     return { &#39;Error&#39; =&gt; &#39;unsupported thumbnail format&#39; } unless $type;
     # the following lists contain all records to be erased before inserting
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-168940" href="/Public/Bug/Display.html?id=17835#txn-168940">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;27&nbsp;14:04:47&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> subroutine &#39;set_Exif_thumbnail&#39; needs to define variables before
 passing references to them</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> brian [...] photoresearchers.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/168940/54775/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/54775">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 258b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I should also point out that after patching set_Exif_thumbnail&#40;&#41; as described above, 
those warnings no longer appear and all tests pass.  &#40;I am still seeing &#34;Unbalanced string 
table refcount&#34; warnings, but if I have time I&#39;ll investigate those separately.&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-168992" href="/Public/Bug/Display.html?id=17835#txn-168992">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;27&nbsp;17:57:32&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: subroutine &#39;set_Exif_thumbnail&#39; needs to define variables
 before passing references to them</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> brian [...] photoresearchers.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/168992/54813/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/54813">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Feb 27 13:59:09 2006, guest wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I don&#39;t know why it works for you.  The reason is that save&#40;&#41; contains
&gt; the following line:
&gt; 
&gt; $filename = $this-&gt;{filename} unless defined $filename;
&gt; 
&gt; In this case, you&#39;ve passed a reference to an undefined variable
&gt; &#40;$r, which you declare but do not define&#41;, so the save&#40;&#41; method
&gt; ignores the destination you&#39;ve provided and defaults to the original
&gt; filename &lt;snip&gt;
</div>
On second thought, this isn&#39;t entirely correct either.  The variable 
$filename isn&#39;t undefined -- it&#39;s a reference with a defined value -- but
rather the scalar that it points to is.  The warnings I was reporting were
&#34;Use of uninitialized value in open&#34;; note it&#39;s saying &#34;uninitialized&#34; and 
not &#34;undefined&#34;.  So clearly open&#40;&#41;&#39;s problem is not the reference but 
the memory that it points to never being initialized.

However, altering the code by explicitly setting $r equal to undef when
it&#39;s declared doesn&#39;t seem to work in avoiding the errors; only a defined 
value like &#34;&#34; appears to do the trick.

Also, one other clarification:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; However, I disagree with your idea that $bufferref is a constant.
&gt; It is a Perl variable holding the value of a reference; as such,
&gt; it is surely variable. Even $bufferref is not a constant, it is
&gt; just a scalar whose initial value &#40;which is disregarded in the
&gt; call to open&#40;&#41;&#41; is &#34;dummy&#34;. 
</div>
I think I mistyped the second time around, but I think I was accurate 
in my initial description when I wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&gt;To follow-up: it&#39;s not clear what the tests are doing calling
&gt;&gt; the &#39;save&#39; method with a reference &#40;particularly when that
&gt;&gt; reference is to a unmodifiable constant&#41;
</div>
$bufferref, as you said, should be defined to point to a variable, not 
a constant &#40;e.g. \$buffer instead of \&#34;dummy&#34;&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-168998" href="/Public/Bug/Display.html?id=17835#txn-168998">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;27&nbsp;18:54:48&nbsp;2006</span>
    <span class="description">bettelli [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> conclusion</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/168998/54819/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/54819">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Lun. 27 Feb. 2006 17:57:32, guest wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The variable $filename isn&#39;t undefined -- it&#39;s a reference with a
&gt; defined value -- but rather the scalar that it points to is. The
&gt; warnings I was reporting were &#34;Use of uninitialized value in open&#34;;
&gt; note it&#39;s saying &#34;uninitialized&#34; and not &#34;undefined&#34;. So clearly
&gt; open&#40;&#41;&#39;s problem is not the reference but the memory that it points
&gt; to never being initialized.
</div>
So, it seems the problem was found! What happens is that some
versions of the Perl interpreter do not work correctly when the
referenced variable is not initialised. I believe this happens
because open&#40;&#41; accesses some internal representation, without
passing through the &#34;user&#34; layer which would autovivify it. Have
a look, for instance, in the newsgroup &#34;perl.perl5.porters&#34; at the
thread titled &#34;In-memory read from undefined variable can return junk&#34;.
This could explain why it works here but not at your site.

So, I will explicitely initialise $r in set_Exif_thumbnail&#40;&#41;, and
scan through all tests to convert them along the same lines. This
is the only way to guarantee a common behaviour on all interpreters
&#40;from 5.8 on&#41;, at least, I hope. However, I need some time to check
that all the bits and pieces are working correctly, and I am 
overworked right now. I hope I will be able to send out a bug-fix
release in March. Thank you very much for your collaboration!

Stefano
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-169000" href="/Public/Bug/Display.html?id=17835#txn-169000">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;27&nbsp;18:57:40&nbsp;2006</span>
    <span class="description">bettelli [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/169000/54821/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/54821">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 471b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Lun. 27 Feb. 2006 14:04:47, guest wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I should also point out that after patching set_Exif_thumbnail&#40;&#41; as
&gt; described above, those warnings no longer appear and all tests pass.
</div>
Good!

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#40;I am still seeing &#34;Unbalanced string table refcount&#34; warnings, but
&gt; if I have time I&#39;ll investigate those separately.&#41;
</div>
Thanks, I can&#39;t do much on it here, since I do not see the 
warning with my interpreter. Be sure to open a new bug report
if you find anything meaningful.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-169007" href="/Public/Bug/Display.html?id=17835#txn-169007">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;27&nbsp;19:16:15&nbsp;2006</span>
    <span class="description">bettelli [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-620074" href="/Public/Bug/Display.html?id=17835#txn-620074">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;17&nbsp;05:27:05&nbsp;2009</span>
    <span class="description">bettelli [...] cpan.org -  Fixed in 0.152 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-620963" href="/Public/Bug/Display.html?id=17835#txn-620963">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;18&nbsp;11:07:55&nbsp;2009</span>
    <span class="description">bettelli [...] cpan.org -  Fixed in 0.153 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-620964" href="/Public/Bug/Display.html?id=17835#txn-620964">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;18&nbsp;11:07:55&nbsp;2009</span>
    <span class="description">bettelli [...] cpan.org -  Fixed in 0.152 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.872669</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
