<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #57797 for Text-MicroMason: Safe-2.27 breaks t/32-safe.t</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #57797 for Text-MicroMason: Safe-2.27 breaks t/32-safe.t</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Text-MicroMason/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Text-MicroMason/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Text-MicroMason/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Text-MicroMason/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Text-MicroMason">Text-MicroMason CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">57797</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Text-MicroMason/Active/">Text-MicroMason</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">FERRENCY [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ntyni [...] iki.fi

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-32150-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.09    </td>
  </tr>
  <tr id="CF-32151-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;24&nbsp;07:50:36&nbsp;2010</span>
    <span class="description">ntyni [...] iki.fi -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Safe-2.27 breaks t/32-safe.t</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Recent CPAN tester failures, for example this:

<span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/07267833-b19f-3f77-b713-d32bba55d77f">http://www.cpantesters.org/cpan/report/07267833-b19f-3f77-b713-d32bba55d77f</a></span>

are caused by Safe.pm 2.27, which now wraps code refs returned from reval&#40;&#41;.

The symptoms are errors like

Can&#39;t locate package Class::MixinFactory::HasAFactory for
@Text::MicroMason::Base::AUTO::Safe_HTMLMason::ISA at
blib/lib/Text/MicroMason/Safe.pm line 39.
Can&#39;t locate package Class::MixinFactory::NEXT for
@Text::MicroMason::Base::AUTO::Safe_HTMLMason::ISA at
blib/lib/Text/MicroMason/Safe.pm line 39.
        &#40;in cleanup&#41; MicroMason execution failed: Can&#39;t locate object
method &#34;execute&#34; via package
&#34;Text::MicroMason::Base::AUTO::Safe_HTMLMason&#34; &#40;perhaps you forgot to
load &#34;Text::MicroMason::Base::AUTO::Safe_HTMLMason&#34;?&#41; at
blib/lib/Text/MicroMason/Safe.pm line 39.


As Safe-2.27 is bundled with Perl 5.12.1, this will bite quite many people.

Thanks for your work on Text-MicroMason,
-- 
Niko Tyni &#40;Debian Perl Group&#41;
ntyni@debian.org
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;24&nbsp;17:16:13&nbsp;2010</span>
    <span class="description">alan [...] ferrency.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #57797] Safe-2.27 breaks t/32-safe.t </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 24 May 2010 17:15:51 -0400 &#40;EDT&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;ntyni [...] iki.fi via RT&#34; &lt;bug-Text-MicroMason [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> alan [...] ferrency.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

The limitation I&#39;m facing here seems to be that code executed within a
Safe compartment doesn&#39;t seem to be able to call methods on objects that
are stored in lexical variables &#40;in this case, variables lexically
enclosed within a coderef&#41;. It looks like those objects can&#39;t see any of
the code in packages they&#39;re supposed to be inheriting from.

The intent of the MicroMason code that was broken here is to expose only
a limited subset of an object&#39;s methods to the interior of the Safe
container. Do you know if there is any official way to do this correctly
with Safe?

I&#39;m sorry I didn&#39;t pay attention to these bug reports earlier, I forgot
that 5.12 was actually released :&#41;

Thanks for your help,
Alan


On Mon, 24 May 2010, ntyni@iki.fi via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Mon May 24 07:50:36 2010: Request 57797 was acted upon.
&gt; Transaction: Ticket created by ntyni@iki.fi
&gt;       Queue: Text-MicroMason
&gt;     Subject: Safe-2.27 breaks t/32-safe.t
&gt;   Broken in: 2.09
&gt;    Severity: Important
&gt;       Owner: Nobody
&gt;  Requestors: ntyni@iki.fi
&gt;      Status: new
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=57797">https://rt.cpan.org/Ticket/Display.html?id=57797</a></span> &gt;
&gt;
&gt;
&gt; Recent CPAN tester failures, for example this:
&gt;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/07267833-b19f-3f77-b713-d32bba55d77f">http://www.cpantesters.org/cpan/report/07267833-b19f-3f77-b713-d32bba55d77f</a></span>
&gt;
&gt; are caused by Safe.pm 2.27, which now wraps code refs returned from reval&#40;&#41;.
&gt;
&gt; The symptoms are errors like
&gt;
&gt; Can&#39;t locate package Class::MixinFactory::HasAFactory for
&gt; @Text::MicroMason::Base::AUTO::Safe_HTMLMason::ISA at
&gt; blib/lib/Text/MicroMason/Safe.pm line 39.
&gt; Can&#39;t locate package Class::MixinFactory::NEXT for
&gt; @Text::MicroMason::Base::AUTO::Safe_HTMLMason::ISA at
&gt; blib/lib/Text/MicroMason/Safe.pm line 39.
&gt;        &#40;in cleanup&#41; MicroMason execution failed: Can&#39;t locate object
&gt; method &#34;execute&#34; via package
&gt; &#34;Text::MicroMason::Base::AUTO::Safe_HTMLMason&#34; &#40;perhaps you forgot to
&gt; load &#34;Text::MicroMason::Base::AUTO::Safe_HTMLMason&#34;?&#41; at
&gt; blib/lib/Text/MicroMason/Safe.pm line 39.
&gt;
&gt;
&gt; As Safe-2.27 is bundled with Perl 5.12.1, this will bite quite many people.
&gt;
&gt; Thanks for your work on Text-MicroMason,
&gt; -- 
&gt; Niko Tyni &#40;Debian Perl Group&#41;
&gt; ntyni@debian.org
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;24&nbsp;17:16:34&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;25&nbsp;05:11:13&nbsp;2010</span>
    <span class="description">ntyni [...] iki.fi -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #57797] Safe-2.27 breaks t/32-safe.t</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 25 May 2010 12:10:56 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;alan [...] ferrency.com via RT&#34; &lt;bug-Text-MicroMason [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Niko Tyni &lt;ntyni [...] iki.fi&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, May 24, 2010 at 05:16:21PM -0400, alan@ferrency.com via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=57797">https://rt.cpan.org/Ticket/Display.html?id=57797</a></span> &gt;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The limitation I&#39;m facing here seems to be that code executed within a
&gt; Safe compartment doesn&#39;t seem to be able to call methods on objects that
&gt; are stored in lexical variables &#40;in this case, variables lexically
&gt; enclosed within a coderef&#41;. It looks like those objects can&#39;t see any of
&gt; the code in packages they&#39;re supposed to be inheriting from.
&gt; 
&gt; The intent of the MicroMason code that was broken here is to expose only
&gt; a limited subset of an object&#39;s methods to the interior of the Safe
&gt; container. Do you know if there is any official way to do this correctly
&gt; with Safe?
</div>
Sorry, I can&#39;t really say offhand, nor can I find a solution easily.

I suppose you could ask the Safe maintainer Rafaël Garcia-Suarez.
-- 
Niko Tyni   ntyni@debian.org
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;25&nbsp;11:29:28&nbsp;2010</span>
    <span class="description">alan [...] ferrency.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #57797] Safe-2.27 breaks t/32-safe.t</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 25 May 2010 11:29:07 -0400 &#40;EDT&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;ntyni [...] iki.fi via RT&#34; &lt;bug-Text-MicroMason [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> alan [...] ferrency.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Do you use the safe_methods feature of Text::MicroMason?

I&#39;m afraid that I may have to stop supporting it, or stop supporting it
in a truly safe way.

I&#39;m not sure if the problem in actual practice is that safe_methods
doesn&#39;t work, or if the problem is that some tests fail and they need to
stop yelling.

It&#39;s hard to know what to do with this without knowing how it is being
used. But I think it will be very hard or impossible to get safe_methods
to work within the new version of Safe, since safe_methods isn&#39;t
actually very safe.

Thanks,
Alan

On Tue, 25 May 2010, ntyni@iki.fi via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       Queue: Text-MicroMason
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=57797">https://rt.cpan.org/Ticket/Display.html?id=57797</a></span> &gt;
&gt;
&gt; On Mon, May 24, 2010 at 05:16:21PM -0400, alan@ferrency.com via RT wrote:
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=57797">https://rt.cpan.org/Ticket/Display.html?id=57797</a></span> &gt;
</div>&gt;
<div class="message-stanza open">&gt;&gt; The limitation I&#39;m facing here seems to be that code executed within a
&gt;&gt; Safe compartment doesn&#39;t seem to be able to call methods on objects that
&gt;&gt; are stored in lexical variables &#40;in this case, variables lexically
&gt;&gt; enclosed within a coderef&#41;. It looks like those objects can&#39;t see any of
&gt;&gt; the code in packages they&#39;re supposed to be inheriting from.
&gt;&gt;
&gt;&gt; The intent of the MicroMason code that was broken here is to expose only
&gt;&gt; a limited subset of an object&#39;s methods to the interior of the Safe
&gt;&gt; container. Do you know if there is any official way to do this correctly
&gt;&gt; with Safe?
</div>&gt;
&gt; Sorry, I can&#39;t really say offhand, nor can I find a solution easily.
&gt;
&gt; I suppose you could ask the Safe maintainer RafaÃ«l Garcia-Suarez.
&gt; -- 
&gt; Niko Tyni   ntyni@debian.org
&gt;
&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;25&nbsp;11:39:21&nbsp;2010</span>
    <span class="description">simonm [...] cavalletto.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #57797] Safe-2.27 breaks t/32-safe.t </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 25 May 2010 11:39:11 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-MicroMason [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Matthew Simon Ryan Cavalletto &lt;simonm [...] cavalletto.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On May 24, 2010, at 5:16 PM, alan@ferrency.com via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=57797">https://rt.cpan.org/Ticket/Display.html?id=57797</a></span> &gt;
&gt; 
&gt; The limitation I&#39;m facing here seems to be that code executed within a
&gt; Safe compartment doesn&#39;t seem to be able to call methods on objects that
&gt; are stored in lexical variables &#40;in this case, variables lexically
&gt; enclosed within a coderef&#41;. It looks like those objects can&#39;t see any of
&gt; the code in packages they&#39;re supposed to be inheriting from.
&gt; 
&gt; The intent of the MicroMason code that was broken here is to expose only
&gt; a limited subset of an object&#39;s methods to the interior of the Safe
&gt; container. Do you know if there is any official way to do this correctly
&gt; with Safe?
</div>
I spent a few minutes looking into this yesterday, and at first glance it looks like Safe::Hole would do what we need: cause the anonymous subroutine references constructed on line 39 of Text::MicroMason::Safe to be executed in the main compartment rather than inside the safe compartment.

I haven&#39;t used Safe::Hole before, so it&#39;ll take some trial and error, and it might turn out that Safe::Hole doesn&#39;t work with the latest version of Safe, but other than that it seems workable in theory...

-Simon
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;26&nbsp;13:00:28&nbsp;2010</span>
    <span class="description">alan [...] ferrency.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #57797] Safe-2.27 breaks t/32-safe.t </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 26 May 2010 13:00:10 -0400 &#40;EDT&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;simonm [...] cavalletto.org via RT&#34; &lt;bug-Text-MicroMason [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> alan [...] ferrency.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m not sure if it&#39;s a great idea to add a dependency to Safe::Hole by
default. If it&#39;s possible to use Safe::Hole optionally and only if you
use safe_methods, that would be preferrred.

Safe::Hole does seem to pass tests with the latest Safe, but I&#39;m not
sure if it actually works or not, yet.

Alan

On Tue, 25 May 2010, simonm@cavalletto.org via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       Queue: Text-MicroMason
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=57797">https://rt.cpan.org/Ticket/Display.html?id=57797</a></span> &gt;
&gt;
&gt; On May 24, 2010, at 5:16 PM, alan@ferrency.com via RT wrote:
&gt;
<div class="message-stanza open">&gt;&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=57797">https://rt.cpan.org/Ticket/Display.html?id=57797</a></span> &gt;
&gt;&gt;
&gt;&gt; The limitation I&#39;m facing here seems to be that code executed within a
&gt;&gt; Safe compartment doesn&#39;t seem to be able to call methods on objects that
&gt;&gt; are stored in lexical variables &#40;in this case, variables lexically
&gt;&gt; enclosed within a coderef&#41;. It looks like those objects can&#39;t see any of
&gt;&gt; the code in packages they&#39;re supposed to be inheriting from.
&gt;&gt;
&gt;&gt; The intent of the MicroMason code that was broken here is to expose only
&gt;&gt; a limited subset of an object&#39;s methods to the interior of the Safe
&gt;&gt; container. Do you know if there is any official way to do this correctly
&gt;&gt; with Safe?
</div>&gt;
&gt; I spent a few minutes looking into this yesterday, and at first glance
&gt; it looks like Safe::Hole would do what we need: cause the anonymous
&gt; subroutine references constructed on line 39 of Text::MicroMason::Safe
&gt; to be executed in the main compartment rather than inside the safe
&gt; compartment.
&gt;
&gt; I haven&#39;t used Safe::Hole before, so it&#39;ll take some trial and error,
&gt; and it might turn out that Safe::Hole doesn&#39;t work with the latest
&gt; version of Safe, but other than that it seems workable in theory...
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;11&nbsp;12:01:06&nbsp;2010</span>
    <span class="description">FERRENCY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue May 25 11:39:21 2010, simonm@cavalletto.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; I spent a few minutes looking into this yesterday, and at first glance
&gt;    it looks like Safe::Hole would do what we need: cause the anonymous
&gt;    subroutine references constructed on line 39 of
&gt;    Text::MicroMason::Safe to be executed in the main compartment
&gt;    rather than inside the safe compartment.
&gt; 
&gt; I haven&#39;t used Safe::Hole before, so it&#39;ll take some trial and error,
&gt;    and it might turn out that Safe::Hole doesn&#39;t work with the latest
&gt;    version of Safe, but other than that it seems workable in theory...
</div>
Unfortunately, Safe::Hole just looks like a candy coated Safe::varglob
and/or Safe::share.  I don&#39;t think it&#39;ll give us anything that Safe
doesn&#39;t already provide, except some ease of use if we happen to want to
do what Safe::Hole does best.

However, I finally have a bit of time to look into this, so I&#39;m going to
see if there&#39;s anything else I can do about it.

Alan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;11&nbsp;12:31:14&nbsp;2010</span>
    <span class="description">FERRENCY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> simonm [...] cavalletto.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Reading the Safe::Hole pod: 
It works with the new Safe, but it doesn&#39;t do what we want.

Specifically, although I&#39;m not sure I&#39;m interpreting it correctly, this
seems to be the crux:

DESCRIPTION
         We can call outside defined subroutines from the Safe compartment
       using share&#40;&#41;, or can call methods through the object that is copied
       into the Safe compartment using varglob&#40;&#41;. But that subroutines or
       methods are executed in the Safe compartment too, so they cannot call
       another subroutines that are dinamically qualified with the package
       name such as class methods nor can they compile code that uses
opcodes
       that are forbidden within the compartment.


That is: Safe::Hole lets the Safe compartment see things outside the
Safe compartment &#40;just like share/varglob/share_from&#41;, but those things
are still executed inside the safe compartment.

This won&#39;t do what we want.

I&#39;ve tried directly using Safe&#39;s share&#40;&#41; on the internal safe_facade
coderefs which the new Safe is wrapping with &#34;wrap_code_refs_within&#34; but
that does nothing useful, as expected, since sharing still doesn&#39;t allow
code outside the Safe compartment to be called.

The basic limitation here is: the entire package code for $m is
unavailable inside the Safe compartment, therefore we can&#39;t call any
class methods of $m within the compartment.

I don&#39;t see any easy way around this.  The old safe_facade arguably took
advantage of a bug in Safe to work the way it did.


If we wrapped the entire class structure inside the safe compartment, we
could give access to $m&#39;s class hierarchy within the Safe.  However, not
only is this a huge undertaking, it&#39;s also the direct opposite of safe.
This would allow execution of all methods defined in that class
hierarchy and not only the ones that are deemed safe_methods.

The only option I can see at this point is deprecating the safe_methods
parameter, and disallow the use of $m within a Safe MicroMason template
call.

I&#39;m open to ideas, but I am likely to implement this unfortunately
draconian restriction unless a better path is revealed.

Thanks,

Alan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;11&nbsp;12:31:38&nbsp;2010</span>
    <span class="description">FERRENCY [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;29&nbsp;11:50:46&nbsp;2010</span>
    <span class="description">FERRENCY [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;29&nbsp;11:50:48&nbsp;2010</span>
    <span class="description">FERRENCY [...] cpan.org -  Severity Important changed to Normal</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;29&nbsp;11:52:35&nbsp;2010</span>
    <span class="description">FERRENCY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I just uploaded Text::MicroMason version 2.10.

This version deprecates safe_methods, and skips tests related to it.  
Pod is updated with a brief description of why the deprecation was
necessary.

If anyone can find a suitable patch for this I will accept it, but it
seems that the older versions of MicroMason were taking advantage of a
bug in Safe to provide safe_methods.

Thanks,
Alan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;29&nbsp;11:52:36&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;06&nbsp;09:56:32&nbsp;2010</span>
    <span class="description">FERRENCY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is fixed in Text::MicroMason 2.10. 

A bug in Safe.pm causes the Safe 2.27 test suite to fail under Perl
5.13.1 and Perl 5.13.2; that bug also causes MicroMason to fail t/32 and
t/85.

That can be dealt with in a separate ticket, if a patched Safe.pm
doesn&#39;t fix it.

Alan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;06&nbsp;09:56:32&nbsp;2010</span>
    <span class="description">FERRENCY [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
